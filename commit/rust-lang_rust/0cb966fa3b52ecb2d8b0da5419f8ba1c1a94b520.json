{"sha": "0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjYjk2NmZhM2I1MmVjYjJkOGIwZGE1NDE5ZjhiYTFjMWE5NGI1MjA=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-05-08T05:08:13Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-05-08T14:00:07Z"}, "message": "Rollup merge of #33404 - gsquire:cargo-lock, r=alexcrichton\n\nCargo lock tidy check\n\nA rebased PR for #32901", "tree": {"sha": "b494225414c2abc7fa4143d4069633f335c54db5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b494225414c2abc7fa4143d4069633f335c54db5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXL0ZnAAoJEDu/TT4u95+Yns0QAM32KTYT0SZK5mk48tKqwz94\nTF8Q3NU3RFmHZH8Q0JHmpj5AQwsSsnjG4mj5NH1xXPZegxlNKAUuzG3Ixsg7oN+M\nXOx1RQD3ShFZSOwx9yg+mMKWDjY5RJ/iQeHqXW7wR7iRP1GYZPwaUykfgfXX0Q3I\naZbCprbjb2kJP0t8CSoC+hf/LoLalxmqHuhcgzxUqR0FCOQHtZC9bWA/KjzcNn+I\n5+ZuoOa2bSCbeMK2+G3HpaIFJiSb39DYg3I77WGQQ/QMAtjx8Ob+Cu8ZS3qBbMzf\nBtqqpjSs6IZvKfmteTTI5B4+3bvx+1mnJDFMHvHLNk4HBJ4aYQeXP0TC2/18SeNc\nTTLI4QzZsqj4JxNy5luI564ps+0yc2puf+jdt6If64wJT05pdtqcXZMiF7rKQ8yx\n9cq93HZ+xdWwOxhynf09KOKzBGqUkCQOCppO2HqDNzj65XYeQZ8p00nCrKxrsY9I\ncuJzIneCnyQ57XIKDxmSRsqz9rrbVggWZDc+tO7qAny5Sf9Kl2iifnZ2NC/2Am7+\nn2Nx264Eu39vUmkIIqI1vNBVgZhL/u1Fa2gqX66ukPf31B83H7Ww8Qke+uKIuPB9\nwppyUYVwv4/ItXjHzOYQuS7v1wAOxn/xl0BJWVaLqahrPWgbL9/FupWIwYz/qW7o\n22zalm6JlH3zji2eDJ02\n=4pbo\n-----END PGP SIGNATURE-----", "payload": "tree b494225414c2abc7fa4143d4069633f335c54db5\nparent c89d8c58ca83449d5c011172988d3179fd9168f1\nparent b3de04214646a33fa5a14fbb2e8ba55e7ee5a707\nauthor Manish Goregaokar <manishsmail@gmail.com> 1462684093 -0700\ncommitter Manish Goregaokar <manishsmail@gmail.com> 1462716007 -0700\n\nRollup merge of #33404 - gsquire:cargo-lock, r=alexcrichton\n\nCargo lock tidy check\n\nA rebased PR for #32901\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "html_url": "https://github.com/rust-lang/rust/commit/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c89d8c58ca83449d5c011172988d3179fd9168f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/c89d8c58ca83449d5c011172988d3179fd9168f1", "html_url": "https://github.com/rust-lang/rust/commit/c89d8c58ca83449d5c011172988d3179fd9168f1"}, {"sha": "b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "html_url": "https://github.com/rust-lang/rust/commit/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707"}], "stats": {"total": 76, "additions": 49, "deletions": 27}, "files": [{"sha": "7a63742fba3427c9bff6b21fb306502da7cde221", "filename": "src/rustc/Cargo.lock", "status": "modified", "additions": 4, "deletions": 27, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Frustc%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Frustc%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2FCargo.lock?ref=0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "patch": "@@ -7,15 +7,6 @@ dependencies = [\n  \"rustdoc 0.0.0\",\n ]\n \n-[[package]]\n-name = \"advapi32-sys\"\n-version = \"0.1.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"winapi 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"winapi-build 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"arena\"\n version = \"0.0.0\"\n@@ -29,7 +20,7 @@ name = \"flate\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -38,12 +29,8 @@ version = \"0.0.0\"\n \n [[package]]\n name = \"gcc\"\n-version = \"0.3.17\"\n+version = \"0.3.28\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"advapi32-sys 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"winapi 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n \n [[package]]\n name = \"graphviz\"\n@@ -192,7 +179,7 @@ name = \"rustc_llvm\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_bitflags 0.0.0\",\n ]\n \n@@ -326,7 +313,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"arena 0.0.0\",\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n@@ -365,13 +352,3 @@ dependencies = [\n  \"syntax 0.0.0\",\n ]\n \n-[[package]]\n-name = \"winapi\"\n-version = \"0.2.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-\n-[[package]]\n-name = \"winapi-build\"\n-version = \"0.1.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-"}, {"sha": "4324db489b7f8b442eab8e72194f3de77b0b6ddf", "filename": "src/tools/tidy/src/cargo_lock.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs?ref=0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "patch": "@@ -0,0 +1,43 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::path::Path;\n+\n+const CARGO_LOCK: &'static str = \"Cargo.lock\";\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    use std::process::Command;\n+\n+    super::walk(path,\n+                &mut |path| super::filter_dirs(path) || path.ends_with(\"src/test\"),\n+                &mut |file| {\n+        let name = file.file_name().unwrap().to_string_lossy();\n+        if name == CARGO_LOCK {\n+            let rel_path = file.strip_prefix(path).unwrap();\n+            let ret_code = Command::new(\"git\")\n+                                        .arg(\"diff-index\")\n+                                        .arg(\"--quiet\")\n+                                        .arg(\"HEAD\")\n+                                        .arg(rel_path)\n+                                        .current_dir(path)\n+                                        .status()\n+                                        .unwrap_or_else(|e| {\n+                                            panic!(\"could not run git diff-index: {}\", e);\n+                                        });\n+            if !ret_code.success() {\n+                let parent_path = file.parent().unwrap().join(\"Cargo.toml\");\n+                print!(\"dirty lock file found at {} \", rel_path.display());\n+                println!(\"please commit your changes or update the lock file by running:\");\n+                println!(\"\\n\\tcargo update --manifest-path {}\", parent_path.display());\n+                *bad = true;\n+            }\n+        }\n+    });\n+}"}, {"sha": "2839bbded1a5f0cb8d171a70ba13cf3b7efadbee", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=0cb966fa3b52ecb2d8b0da5419f8ba1c1a94b520", "patch": "@@ -35,6 +35,7 @@ mod style;\n mod errors;\n mod features;\n mod cargo;\n+mod cargo_lock;\n \n fn main() {\n     let path = env::args_os().skip(1).next().expect(\"need an argument\");\n@@ -46,6 +47,7 @@ fn main() {\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n     features::check(&path, &mut bad);\n+    cargo_lock::check(&path, &mut bad);\n \n     if bad {\n         panic!(\"some tidy checks failed\");"}]}