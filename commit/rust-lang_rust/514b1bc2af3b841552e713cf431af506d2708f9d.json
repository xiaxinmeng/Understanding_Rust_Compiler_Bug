{"sha": "514b1bc2af3b841552e713cf431af506d2708f9d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxNGIxYmMyYWYzYjg0MTU1MmU3MTNjZjQzMWFmNTA2ZDI3MDhmOWQ=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-02-03T19:01:42Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-02-03T19:01:42Z"}, "message": "Do not lint `unnecessary_unwrap` in macros", "tree": {"sha": "ecdc6329d0cc47fab4d9387a7c77a472cd9583fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecdc6329d0cc47fab4d9387a7c77a472cd9583fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/514b1bc2af3b841552e713cf431af506d2708f9d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/514b1bc2af3b841552e713cf431af506d2708f9d", "html_url": "https://github.com/rust-lang/rust/commit/514b1bc2af3b841552e713cf431af506d2708f9d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/514b1bc2af3b841552e713cf431af506d2708f9d/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "536c255b43437b59243b7e2e167e95b4f80910f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/536c255b43437b59243b7e2e167e95b4f80910f7", "html_url": "https://github.com/rust-lang/rust/commit/536c255b43437b59243b7e2e167e95b4f80910f7"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "942543c7bab3ee6a6ef169f83b6220c0584327e0", "filename": "clippy_lints/src/unwrap.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/514b1bc2af3b841552e713cf431af506d2708f9d/clippy_lints%2Fsrc%2Funwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/514b1bc2af3b841552e713cf431af506d2708f9d/clippy_lints%2Fsrc%2Funwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funwrap.rs?ref=514b1bc2af3b841552e713cf431af506d2708f9d", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{higher::if_block, match_type, paths, span_lint_and_then, usage::is_potentially_mutated};\n+use crate::utils::{higher::if_block, in_macro, match_type, paths, span_lint_and_then, usage::is_potentially_mutated};\n use if_chain::if_chain;\n use rustc::hir::map::Map;\n use rustc_hir::intravisit::*;\n@@ -138,6 +138,10 @@ impl<'a, 'tcx> Visitor<'tcx> for UnwrappableVariablesVisitor<'a, 'tcx> {\n     type Map = Map<'tcx>;\n \n     fn visit_expr(&mut self, expr: &'tcx Expr<'_>) {\n+        // Shouldn't lint when `expr` is in macro.\n+        if in_macro(expr.span) {\n+            return;\n+        }\n         if let Some((cond, then, els)) = if_block(&expr) {\n             walk_expr(self, cond);\n             self.visit_branch(cond, then, false);"}, {"sha": "d50abddade46978558b354513562dd39f37f44ed", "filename": "tests/ui/checked_unwrap/simple_conditionals.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/514b1bc2af3b841552e713cf431af506d2708f9d/tests%2Fui%2Fchecked_unwrap%2Fsimple_conditionals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/514b1bc2af3b841552e713cf431af506d2708f9d/tests%2Fui%2Fchecked_unwrap%2Fsimple_conditionals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fchecked_unwrap%2Fsimple_conditionals.rs?ref=514b1bc2af3b841552e713cf431af506d2708f9d", "patch": "@@ -39,4 +39,6 @@ fn main() {\n                         // it will always panic but the lint is not smart enough to see this (it\n                         // only checks if conditions).\n     }\n+\n+    assert!(x.is_ok(), \"{:?}\", x.unwrap_err()); // ok, it's a common test pattern\n }"}]}