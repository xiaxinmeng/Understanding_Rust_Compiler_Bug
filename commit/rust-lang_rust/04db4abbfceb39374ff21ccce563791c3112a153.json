{"sha": "04db4abbfceb39374ff21ccce563791c3112a153", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZGI0YWJiZmNlYjM5Mzc0ZmYyMWNjY2U1NjM3OTFjMzExMmExNTM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-04-19T08:15:56Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-04-19T08:25:31Z"}, "message": "add gate tests and pacify tidy", "tree": {"sha": "9150ce7c1a123a4b528a7016b79585151bb6ab2b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9150ce7c1a123a4b528a7016b79585151bb6ab2b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04db4abbfceb39374ff21ccce563791c3112a153", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04db4abbfceb39374ff21ccce563791c3112a153", "html_url": "https://github.com/rust-lang/rust/commit/04db4abbfceb39374ff21ccce563791c3112a153", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04db4abbfceb39374ff21ccce563791c3112a153/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd9556956ade485ae540fa6b25d2d2b1b2e8b958", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd9556956ade485ae540fa6b25d2d2b1b2e8b958", "html_url": "https://github.com/rust-lang/rust/commit/bd9556956ade485ae540fa6b25d2d2b1b2e8b958"}], "stats": {"total": 105, "additions": 98, "deletions": 7}, "files": [{"sha": "74e5a4e26e8635a637278505b90e9c65fb9e8cb2", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -576,12 +576,6 @@ declare_features! (\n     /// Allows using and casting function pointers in a `const fn`.\n     (active, const_fn_fn_ptr_basics, \"1.48.0\", Some(57563), None),\n \n-    /// Allows trait bounds in `const fn`.\n-    (active, const_fn_trait_bound, \"1.53.0\", Some(57563), None),\n-\n-    /// Allows unsizing coercions in `const fn`.\n-    (active, const_fn_unsize, \"1.53.0\", Some(64992), None),\n-\n     /// Allows to use the `#[cmse_nonsecure_entry]` attribute.\n     (active, cmse_nonsecure_entry, \"1.48.0\", Some(75835), None),\n \n@@ -651,6 +645,12 @@ declare_features! (\n     /// Allows `extern \"wasm\" fn`\n     (active, wasm_abi, \"1.53.0\", Some(83788), None),\n \n+    /// Allows trait bounds in `const fn`.\n+    (active, const_fn_trait_bound, \"1.53.0\", Some(57563), None),\n+\n+    /// Allows unsizing coercions in `const fn`.\n+    (active, const_fn_unsize, \"1.53.0\", Some(64992), None),\n+\n     // -------------------------------------------------------------------------\n     // feature-group-end: actual feature gates\n     // -------------------------------------------------------------------------"}, {"sha": "ffeaaf60a30cf36596fac6c03ed3b60ff387972a", "filename": "compiler/rustc_mir/src/transform/check_consts/ops.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -552,7 +552,7 @@ impl NonConstOp for UnsizingCast {\n             &ccx.tcx.sess.parse_sess,\n             sym::const_fn_unsize,\n             span,\n-            \"unsizing casts to types besides slices are not allowed in const fn\"\n+            \"unsizing casts to types besides slices are not allowed in const fn\",\n         )\n     }\n }"}, {"sha": "ded05cb17c51349cd023c3542c4fb2ecd4a2ae54", "filename": "src/test/ui/consts/const_fn_trait_bound.gated.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.gated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.gated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.gated.stderr?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,8 @@\n+error: fatal error triggered by #[rustc_error]\n+  --> $DIR/const_fn_trait_bound.rs:17:1\n+   |\n+LL | fn main() {}\n+   | ^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "b1ef820d827b4b24fff5a6285550f80185f2a993", "filename": "src/test/ui/consts/const_fn_trait_bound.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.rs?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,17 @@\n+// gate-test-const_fn_trait_bound\n+\n+// revisions: stock gated\n+\n+#![feature(rustc_attrs)]\n+#![cfg_attr(gated, feature(const_fn_trait_bound))]\n+\n+const fn test1<T: std::ops::Add>() {}\n+//[stock]~^ trait bounds\n+const fn test2(_x: &dyn Send) {}\n+//[stock]~^ trait bounds\n+const fn test3() -> &'static dyn Send { loop {} }\n+//[stock]~^ trait bounds\n+\n+\n+#[rustc_error]\n+fn main() {} //[gated]~ fatal error triggered by #[rustc_error]"}, {"sha": "2ad45f3afde8f8d334a3ebf5c9416902379a739a", "filename": "src/test/ui/consts/const_fn_trait_bound.stock.stderr", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.stock.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.stock.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_trait_bound.stock.stderr?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,30 @@\n+error[E0658]: trait bounds other than `Sized` on const fn parameters are unstable\n+  --> $DIR/const_fn_trait_bound.rs:8:16\n+   |\n+LL | const fn test1<T: std::ops::Add>() {}\n+   |                ^\n+   |\n+   = note: see issue #57563 <https://github.com/rust-lang/rust/issues/57563> for more information\n+   = help: add `#![feature(const_fn_trait_bound)]` to the crate attributes to enable\n+\n+error[E0658]: trait bounds other than `Sized` on const fn parameters are unstable\n+  --> $DIR/const_fn_trait_bound.rs:10:16\n+   |\n+LL | const fn test2(_x: &dyn Send) {}\n+   |                ^^\n+   |\n+   = note: see issue #57563 <https://github.com/rust-lang/rust/issues/57563> for more information\n+   = help: add `#![feature(const_fn_trait_bound)]` to the crate attributes to enable\n+\n+error[E0658]: trait bounds other than `Sized` on const fn parameters are unstable\n+  --> $DIR/const_fn_trait_bound.rs:12:21\n+   |\n+LL | const fn test3() -> &'static dyn Send { loop {} }\n+   |                     ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #57563 <https://github.com/rust-lang/rust/issues/57563> for more information\n+   = help: add `#![feature(const_fn_trait_bound)]` to the crate attributes to enable\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "8a65c274ca933fb0aed2d17c3bffc539d4b2cc3e", "filename": "src/test/ui/consts/const_fn_unsize.gated.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.gated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.gated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.gated.stderr?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,8 @@\n+error: fatal error triggered by #[rustc_error]\n+  --> $DIR/const_fn_unsize.rs:16:1\n+   |\n+LL | fn main() {}\n+   | ^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "0cab3b0a031b1f48678965cb133a24024b697c37", "filename": "src/test/ui/consts/const_fn_unsize.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.rs?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,16 @@\n+// gate-test-const_fn_unsize\n+\n+// revisions: stock gated\n+\n+#![feature(rustc_attrs)]\n+#![cfg_attr(gated, feature(const_fn_unsize))]\n+\n+use std::ptr::NonNull;\n+\n+const fn test() {\n+    let _x = NonNull::<[i32; 0]>::dangling() as NonNull<[i32]>;\n+    //[stock]~^ unsizing cast\n+}\n+\n+#[rustc_error]\n+fn main() {} //[gated]~ fatal error triggered by #[rustc_error]"}, {"sha": "cc746d4f175cabd8a88254d95cef111a1b1dabd6", "filename": "src/test/ui/consts/const_fn_unsize.stock.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.stock.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/04db4abbfceb39374ff21ccce563791c3112a153/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.stock.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_fn_unsize.stock.stderr?ref=04db4abbfceb39374ff21ccce563791c3112a153", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: unsizing casts to types besides slices are not allowed in const fn\n+  --> $DIR/const_fn_unsize.rs:11:14\n+   |\n+LL |     let _x = NonNull::<[i32; 0]>::dangling() as NonNull<[i32]>;\n+   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #64992 <https://github.com/rust-lang/rust/issues/64992> for more information\n+   = help: add `#![feature(const_fn_unsize)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}