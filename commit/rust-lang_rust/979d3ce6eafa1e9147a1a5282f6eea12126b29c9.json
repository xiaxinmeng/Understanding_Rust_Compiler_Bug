{"sha": "979d3ce6eafa1e9147a1a5282f6eea12126b29c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3OWQzY2U2ZWFmYTFlOTE0N2ExYTUyODJmNmVlYTEyMTI2YjI5Yzk=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-12-23T15:24:29Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-12-23T15:56:24Z"}, "message": "Add more comments to trait queries\n\nThis also adds back a comment that was mistakenly removed in\nac9dfc3e7785c9bba96ebac4fd51726189e1bf91.", "tree": {"sha": "a20cc2a0e556772b3f13b6c93f0530ad41f426fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a20cc2a0e556772b3f13b6c93f0530ad41f426fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/979d3ce6eafa1e9147a1a5282f6eea12126b29c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/979d3ce6eafa1e9147a1a5282f6eea12126b29c9", "html_url": "https://github.com/rust-lang/rust/commit/979d3ce6eafa1e9147a1a5282f6eea12126b29c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/979d3ce6eafa1e9147a1a5282f6eea12126b29c9/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50a90975c0f78219db45d3bee0676a22695ec103", "url": "https://api.github.com/repos/rust-lang/rust/commits/50a90975c0f78219db45d3bee0676a22695ec103", "html_url": "https://github.com/rust-lang/rust/commit/50a90975c0f78219db45d3bee0676a22695ec103"}], "stats": {"total": 45, "additions": 32, "deletions": 13}, "files": [{"sha": "1e836d0a8425363e3b56ccb158fefa2a71f75920", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 32, "deletions": 13, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/979d3ce6eafa1e9147a1a5282f6eea12126b29c9/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979d3ce6eafa1e9147a1a5282f6eea12126b29c9/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=979d3ce6eafa1e9147a1a5282f6eea12126b29c9", "patch": "@@ -576,11 +576,13 @@ rustc_queries! {\n             desc { |tcx| \"collecting associated items of {}\", tcx.def_path_str(key) }\n         }\n \n-        query impl_trait_ref(key: DefId) -> Option<ty::TraitRef<'tcx>> {\n-            desc { |tcx| \"computing trait implemented by `{}`\", tcx.def_path_str(key) }\n+        /// Given an `impl_id`, return the trait it implements.\n+        /// Return `None` if this is an inherent impl.\n+        query impl_trait_ref(impl_id: DefId) -> Option<ty::TraitRef<'tcx>> {\n+            desc { |tcx| \"computing trait implemented by `{}`\", tcx.def_path_str(impl_id) }\n         }\n-        query impl_polarity(key: DefId) -> ty::ImplPolarity {\n-            desc { |tcx| \"computing implementation polarity of `{}`\", tcx.def_path_str(key) }\n+        query impl_polarity(impl_id: DefId) -> ty::ImplPolarity {\n+            desc { |tcx| \"computing implementation polarity of `{}`\", tcx.def_path_str(impl_id) }\n         }\n \n         query issue33140_self_ty(key: DefId) -> Option<ty::Ty<'tcx>> {\n@@ -917,8 +919,10 @@ rustc_queries! {\n     }\n \n     TypeChecking {\n-        query trait_of_item(def_id: DefId) -> Option<DefId> {\n-            desc { |tcx| \"finding trait defining `{}`\", tcx.def_path_str(def_id) }\n+        /// Given an `associated_item`, find the trait it belongs to.\n+        /// Return `None` if the `DefId` is not an associated item.\n+        query trait_of_item(associated_item: DefId) -> Option<DefId> {\n+            desc { |tcx| \"finding trait defining `{}`\", tcx.def_path_str(associated_item) }\n         }\n     }\n \n@@ -948,27 +952,37 @@ rustc_queries! {\n     }\n \n     TypeChecking {\n-        query all_local_trait_impls(key: CrateNum) -> &'tcx BTreeMap<DefId, Vec<hir::HirId>> {\n+        /// Return all `impl` blocks in the current crate.\n+        ///\n+        /// To allow caching this between crates, you must pass in [`LOCAL_CRATE`] as the crate number.\n+        /// Passing in any other crate will cause an ICE.\n+        ///\n+        /// [`LOCAL_CRATE`]: rustc_hir::def_id::LOCAL_CRATE\n+        query all_local_trait_impls(local_crate: CrateNum) -> &'tcx BTreeMap<DefId, Vec<hir::HirId>> {\n             desc { \"local trait impls\" }\n         }\n-        query trait_impls_of(key: DefId) -> ty::trait_def::TraitImpls {\n+\n+        /// Given a trait `trait_id`, return all known `impl` blocks.\n+        query trait_impls_of(trait_id: DefId) -> ty::trait_def::TraitImpls {\n             storage(ArenaCacheSelector<'tcx>)\n-            desc { |tcx| \"trait impls of `{}`\", tcx.def_path_str(key) }\n+            desc { |tcx| \"trait impls of `{}`\", tcx.def_path_str(trait_id) }\n         }\n-        query specialization_graph_of(key: DefId) -> specialization_graph::Graph {\n+\n+        query specialization_graph_of(trait_id: DefId) -> specialization_graph::Graph {\n             storage(ArenaCacheSelector<'tcx>)\n-            desc { |tcx| \"building specialization graph of trait `{}`\", tcx.def_path_str(key) }\n+            desc { |tcx| \"building specialization graph of trait `{}`\", tcx.def_path_str(trait_id) }\n             cache_on_disk_if { true }\n         }\n-        query object_safety_violations(key: DefId) -> &'tcx [traits::ObjectSafetyViolation] {\n-            desc { |tcx| \"determine object safety of trait `{}`\", tcx.def_path_str(key) }\n+        query object_safety_violations(trait_id: DefId) -> &'tcx [traits::ObjectSafetyViolation] {\n+            desc { |tcx| \"determine object safety of trait `{}`\", tcx.def_path_str(trait_id) }\n         }\n \n         /// Gets the ParameterEnvironment for a given item; this environment\n         /// will be in \"user-facing\" mode, meaning that it is suitable for\n         /// type-checking etc, and it does not normalize specializable\n         /// associated types. This is almost always what you want,\n         /// unless you are doing MIR optimizations, in which case you\n+        /// might want to use `reveal_all()` method to change modes.\n         query param_env(def_id: DefId) -> ty::ParamEnv<'tcx> {\n             desc { |tcx| \"computing normalized predicates of `{}`\", tcx.def_path_str(def_id) }\n         }\n@@ -1229,10 +1243,15 @@ rustc_queries! {\n     }\n \n     TypeChecking {\n+        /// Given a crate and a trait, look up all impls of that trait in the crate.\n+        /// Return `(impl_id, self_ty)`.\n         query implementations_of_trait(_: (CrateNum, DefId))\n             -> &'tcx [(DefId, Option<ty::fast_reject::SimplifiedType>)] {\n             desc { \"looking up implementations of a trait in a crate\" }\n         }\n+\n+        /// Given a crate, look up all trait impls in that crate.\n+        /// Return `(impl_id, self_ty)`.\n         query all_trait_implementations(_: CrateNum)\n             -> &'tcx [(DefId, Option<ty::fast_reject::SimplifiedType>)] {\n             desc { \"looking up all (?) trait implementations\" }"}]}