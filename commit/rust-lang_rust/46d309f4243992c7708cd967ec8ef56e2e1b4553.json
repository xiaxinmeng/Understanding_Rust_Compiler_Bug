{"sha": "46d309f4243992c7708cd967ec8ef56e2e1b4553", "node_id": "C_kwDOAAsO6NoAKDQ2ZDMwOWY0MjQzOTkyYzc3MDhjZDk2N2VjOGVmNTZlMmUxYjQ1NTM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-21T15:00:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-21T15:00:08Z"}, "message": "Auto merge of #2408 - RalfJung:deps, r=oli-obk\n\nmake test-cargo-miri only about cargo\n\nMove the things that actually test dependency behavior into the regular test suite, now that we can do that. :)", "tree": {"sha": "fa6861741a7231e256fad05df97508a8dad2e119", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa6861741a7231e256fad05df97508a8dad2e119"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46d309f4243992c7708cd967ec8ef56e2e1b4553", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46d309f4243992c7708cd967ec8ef56e2e1b4553", "html_url": "https://github.com/rust-lang/rust/commit/46d309f4243992c7708cd967ec8ef56e2e1b4553", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46d309f4243992c7708cd967ec8ef56e2e1b4553/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed76d20afd7f78dadb9b213389c679952bf77ae5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed76d20afd7f78dadb9b213389c679952bf77ae5", "html_url": "https://github.com/rust-lang/rust/commit/ed76d20afd7f78dadb9b213389c679952bf77ae5"}, {"sha": "5e4b64645712b0cefd3de751907d00210f735ed0", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e4b64645712b0cefd3de751907d00210f735ed0", "html_url": "https://github.com/rust-lang/rust/commit/5e4b64645712b0cefd3de751907d00210f735ed0"}], "stats": {"total": 226, "additions": 67, "deletions": 159}, "files": [{"sha": "3f61fb3d5408d3f12ca318a186875ee0d09e5355", "filename": "test-cargo-miri/Cargo.lock", "status": "modified", "additions": 11, "deletions": 97, "changes": 108, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.lock?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -2,6 +2,12 @@\n # It is not intended for manual editing.\n version = 3\n \n+[[package]]\n+name = \"byteorder\"\n+version = \"0.5.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"0fc10e8cc6b2580fda3f36eb6dc5316657f812a3df879a44a66fc9f0fdbc4855\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.4.3\"\n@@ -12,32 +18,25 @@ checksum = \"14c189c53d098945499cdfa7ecc63567cf3886b3332b312a5b4585d8d3a6a610\"\n name = \"cargo-miri-test\"\n version = \"0.1.0\"\n dependencies = [\n- \"byteorder\",\n+ \"byteorder 0.5.3\",\n+ \"byteorder 1.4.3\",\n  \"cdylib\",\n  \"exported_symbol\",\n  \"issue_1567\",\n  \"issue_1691\",\n  \"issue_1705\",\n  \"issue_1760\",\n  \"issue_rust_86261\",\n- \"page_size\",\n- \"rand\",\n  \"serde_derive\",\n ]\n \n [[package]]\n name = \"cdylib\"\n version = \"0.1.0\"\n dependencies = [\n- \"byteorder\",\n+ \"byteorder 1.4.3\",\n ]\n \n-[[package]]\n-name = \"cfg-if\"\n-version = \"1.0.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd\"\n-\n [[package]]\n name = \"exported_symbol\"\n version = \"0.1.0\"\n@@ -49,17 +48,6 @@ dependencies = [\n name = \"exported_symbol_dep\"\n version = \"0.1.0\"\n \n-[[package]]\n-name = \"getrandom\"\n-version = \"0.2.7\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4eb1a864a501629691edf6c15a593b7a51eebaa1e8468e9ddc623de7c9b58ec6\"\n-dependencies = [\n- \"cfg-if\",\n- \"libc\",\n- \"wasi\",\n-]\n-\n [[package]]\n name = \"hermit-abi\"\n version = \"0.1.19\"\n@@ -73,7 +61,7 @@ dependencies = [\n name = \"issue_1567\"\n version = \"0.1.0\"\n dependencies = [\n- \"byteorder\",\n+ \"byteorder 1.4.3\",\n ]\n \n [[package]]\n@@ -84,7 +72,7 @@ version = \"0.1.0\"\n name = \"issue_1705\"\n version = \"0.1.0\"\n dependencies = [\n- \"byteorder\",\n+ \"byteorder 1.4.3\",\n ]\n \n [[package]]\n@@ -111,22 +99,6 @@ dependencies = [\n  \"libc\",\n ]\n \n-[[package]]\n-name = \"page_size\"\n-version = \"0.4.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"eebde548fbbf1ea81a99b128872779c437752fb99f217c45245e1a61dcd9edcd\"\n-dependencies = [\n- \"libc\",\n- \"winapi\",\n-]\n-\n-[[package]]\n-name = \"ppv-lite86\"\n-version = \"0.2.16\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"eb9f9e6e233e5c4a35559a617bf40a4ec447db2e84c20b55a6f83167b7e57872\"\n-\n [[package]]\n name = \"proc-macro2\"\n version = \"1.0.40\"\n@@ -145,36 +117,6 @@ dependencies = [\n  \"proc-macro2\",\n ]\n \n-[[package]]\n-name = \"rand\"\n-version = \"0.8.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"34af8d1a0e25924bc5b7c43c079c942339d8f0a8b57c39049bef581b46327404\"\n-dependencies = [\n- \"libc\",\n- \"rand_chacha\",\n- \"rand_core\",\n-]\n-\n-[[package]]\n-name = \"rand_chacha\"\n-version = \"0.3.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e6c10a63a0fa32252be49d21e7709d4d4baf8d231c2dbce1eaa8141b9b127d88\"\n-dependencies = [\n- \"ppv-lite86\",\n- \"rand_core\",\n-]\n-\n-[[package]]\n-name = \"rand_core\"\n-version = \"0.6.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d34f1408f55294453790c48b2f1ebbb1c5b4b7563eb1f418bcfcfdbb06ebb4e7\"\n-dependencies = [\n- \"getrandom\",\n-]\n-\n [[package]]\n name = \"serde_derive\"\n version = \"1.0.137\"\n@@ -209,31 +151,3 @@ name = \"unicode-ident\"\n version = \"1.0.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"5bd2fe26506023ed7b5e1e315add59d6f584c621d037f9368fea9cfb988f368c\"\n-\n-[[package]]\n-name = \"wasi\"\n-version = \"0.11.0+wasi-snapshot-preview1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9c8d87e72b64a3b4db28d11ce29237c246188f4f51057d65a7eab63b7987e423\"\n-\n-[[package]]\n-name = \"winapi\"\n-version = \"0.3.9\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5c839a674fcd7a98952e593242ea400abe93992746761e38641405d28b00f419\"\n-dependencies = [\n- \"winapi-i686-pc-windows-gnu\",\n- \"winapi-x86_64-pc-windows-gnu\",\n-]\n-\n-[[package]]\n-name = \"winapi-i686-pc-windows-gnu\"\n-version = \"0.4.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6\"\n-\n-[[package]]\n-name = \"winapi-x86_64-pc-windows-gnu\"\n-version = \"0.4.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f\""}, {"sha": "51967c54e15cf77ddfc8a1a65e56b26d8b3d1cce", "filename": "test-cargo-miri/Cargo.toml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.toml?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -18,9 +18,8 @@ issue_1760 = { path = \"issue-1760\" }\n issue_rust_86261 = { path = \"issue-rust-86261\" }\n \n [dev-dependencies]\n-rand = { version = \"0.8\", features = [\"small_rng\"] }\n+byteorder_2 = { package = \"byteorder\", version = \"0.5\" } # to test dev-dependencies behave as expected, with renaming\n serde_derive = \"1.0\" # not actually used, but exercises some unique code path (`--extern` .so file)\n-page_size = \"0.4.1\"\n \n [lib]\n test = false # test that this is respected (will show in the output)"}, {"sha": "527602e0a888f1a5c321f25813f2ed7f87718c08", "filename": "test-cargo-miri/cdylib/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Fcdylib%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Fcdylib%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fcdylib%2FCargo.toml?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -9,4 +9,4 @@ edition = \"2018\"\n crate-type = [\"cdylib\"]\n \n [dependencies]\n-byteorder = \"1.0\"\n+byteorder = \"1.0\" # to test dependencies of sub-crates"}, {"sha": "ab43c7251158484a45c2e64db26ccd49abe6beab", "filename": "test-cargo-miri/run-test.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frun-test.py?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -134,7 +134,7 @@ def test_cargo_miri_test():\n         env={'MIRIFLAGS': \"-Zmiri-permissive-provenance -Zmiri-disable-isolation\"},\n     )\n     test(\"`cargo miri test` (with filter)\",\n-        cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"le1\"],\n+        cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"pl\"],\n         filter_ref, \"test.stderr-empty.ref\",\n     )\n     test(\"`cargo miri test` (test target)\","}, {"sha": "41c52b7017028caa8e17ce4c6e7505c02934a6a1", "filename": "test-cargo-miri/src/main.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Fmain.rs?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -45,17 +45,12 @@ fn main() {\n \n #[cfg(test)]\n mod test {\n-    use rand::{Rng, SeedableRng};\n+    use byteorder_2::{BigEndian, ByteOrder};\n \n     // Make sure in-crate tests with dev-dependencies work\n     #[test]\n-    fn rng() {\n-        let mut rng = rand::rngs::StdRng::seed_from_u64(0xcafebeef);\n-        let x: u32 = rng.gen();\n-        let y: usize = rng.gen();\n-        let z: u128 = rng.gen();\n-        assert_ne!(x as usize, y);\n-        assert_ne!(y as u128, z);\n+    fn dev_dependency() {\n+        let _n = <BigEndian as ByteOrder>::read_u64(&[1, 2, 3, 4, 5, 6, 7, 8]);\n     }\n \n     #[test]"}, {"sha": "5264530160bc59bd212e4c0c33f7fd9754c99563", "filename": "test-cargo-miri/test.bin-target.stdout.ref", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.bin-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.bin-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.bin-target.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -1,7 +1,7 @@\n \n running 2 tests\n+test test::dev_dependency ... ok\n test test::exported_symbol ... ok\n-test test::rng ... ok\n \n test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n "}, {"sha": "8c543e479f4e0fc40a9f79d4d9dfdd78423337e0", "filename": "test-cargo-miri/test.cross-target.stdout.ref", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.cross-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.cross-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.cross-target.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -5,7 +5,7 @@ test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n \n imported main\n \n-running 8 tests\n-..i.....\n-test result: ok. 7 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n+running 6 tests\n+...i..\n+test result: ok. 5 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n "}, {"sha": "9a17f3d61b6acc445cfac5aa3712ca8cd47125b7", "filename": "test-cargo-miri/test.default.stdout.ref", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.default.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.default.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.default.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -5,9 +5,9 @@ test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n \n imported main\n \n-running 8 tests\n-..i.....\n-test result: ok. 7 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n+running 6 tests\n+...i..\n+test result: ok. 5 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n \n \n running 4 tests"}, {"sha": "bb0282d6c9167a84e1be7477748d05786a8d3048", "filename": "test-cargo-miri/test.filter.cross-target.stdout.ref", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -6,7 +6,7 @@ test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out\n imported main\n \n running 1 test\n-test simple1 ... ok\n+test simple ... ok\n \n-test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 7 filtered out\n+test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 5 filtered out\n "}, {"sha": "c618956656a8a60f0c8a8be587ed729d0cef60e6", "filename": "test-cargo-miri/test.filter.stdout.ref", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.filter.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.filter.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.filter.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -6,9 +6,9 @@ test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out\n imported main\n \n running 1 test\n-test simple1 ... ok\n+test simple ... ok\n \n-test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 7 filtered out\n+test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 5 filtered out\n \n \n running 0 tests"}, {"sha": "dd59b32b780c85d7a21544f543889e1ffe0deba9", "filename": "test-cargo-miri/test.test-target.stdout.ref", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.test-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftest.test-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.test-target.stdout.ref?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -1,13 +1,11 @@\n \n-running 8 tests\n+running 6 tests\n test cargo_env ... ok\n+test deps ... ok\n test do_panic - should panic ... ok\n test does_not_work_on_miri ... ignored\n-test entropy_rng ... ok\n test fail_index_check - should panic ... ok\n-test page_size ... ok\n-test simple1 ... ok\n-test simple2 ... ok\n+test simple ... ok\n \n-test result: ok. 7 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n+test result: ok. 5 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n "}, {"sha": "9ed2152893964a569fae129a4bfdeda153398c81", "filename": "test-cargo-miri/tests/test.rs", "status": "modified", "additions": 17, "deletions": 33, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftests%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test-cargo-miri%2Ftests%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftests%2Ftest.rs?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -1,39 +1,30 @@\n-use rand::{rngs::SmallRng, Rng, SeedableRng};\n-\n-// Having more than 1 test does seem to make a difference\n-// (i.e., this calls ptr::swap which having just one test does not).\n #[test]\n-fn simple1() {\n+fn simple() {\n     assert_eq!(4, 4);\n }\n \n-#[test]\n-fn simple2() {\n-    assert_ne!(42, 24);\n-}\n-\n // A test that won't work on miri (tests disabling tests).\n #[test]\n #[cfg_attr(miri, ignore)]\n fn does_not_work_on_miri() {\n-    let x = 0u8;\n-    assert!(&x as *const _ as usize % 4 < 4);\n+    // Only do this where inline assembly is stable.\n+    #[cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))]\n+    unsafe {\n+        std::arch::asm!(\"foo\");\n+    }\n }\n \n-// Make sure integration tests can access dev-dependencies\n+// Make sure integration tests can access both dependencies and dev-dependencies\n #[test]\n-fn entropy_rng() {\n-    // Try seeding with \"real\" entropy.\n-    let mut rng = SmallRng::from_entropy();\n-    let _val = rng.gen::<i32>();\n-    let _val = rng.gen::<isize>();\n-    let _val = rng.gen::<i128>();\n-\n-    // Also try per-thread RNG.\n-    let mut rng = rand::thread_rng();\n-    let _val = rng.gen::<i32>();\n-    let _val = rng.gen::<isize>();\n-    let _val = rng.gen::<i128>();\n+fn deps() {\n+    {\n+        use byteorder::{BigEndian, ByteOrder};\n+        let _n = <BigEndian as ByteOrder>::read_u64(&[1, 2, 3, 4, 5, 6, 7, 8]);\n+    }\n+    {\n+        use byteorder_2::{BigEndian, ByteOrder};\n+        let _n = <BigEndian as ByteOrder>::read_u64(&[1, 2, 3, 4, 5, 6, 7, 8]);\n+    }\n }\n \n #[test]\n@@ -49,17 +40,10 @@ fn do_panic() // In large, friendly letters :)\n     panic!(\"Explicit panic from test!\");\n }\n \n+// A different way of raising a panic\n #[test]\n #[allow(unconditional_panic)]\n #[should_panic(expected = \"the len is 0 but the index is 42\")]\n fn fail_index_check() {\n     [][42]\n }\n-\n-#[test]\n-fn page_size() {\n-    let page_size = page_size::get();\n-\n-    // In particular, this checks that it is not 0.\n-    assert!(page_size.is_power_of_two(), \"page size not a power of two: {}\", page_size);\n-}"}, {"sha": "a492deba4c52822eae944d7651520898068e7e91", "filename": "test_dependencies/Cargo.lock", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test_dependencies%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test_dependencies%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test_dependencies%2FCargo.lock?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -107,6 +107,7 @@ dependencies = [\n  \"getrandom 0.1.16\",\n  \"getrandom 0.2.7\",\n  \"libc\",\n+ \"page_size\",\n  \"rand\",\n  \"tokio\",\n ]\n@@ -127,6 +128,16 @@ version = \"1.13.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"18a6dbe30758c9f83eb00cbea4ac95966305f5a7772f3f42ebfc7fc7eddbd8e1\"\n \n+[[package]]\n+name = \"page_size\"\n+version = \"0.4.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"eebde548fbbf1ea81a99b128872779c437752fb99f217c45245e1a61dcd9edcd\"\n+dependencies = [\n+ \"libc\",\n+ \"winapi\",\n+]\n+\n [[package]]\n name = \"parking_lot\"\n version = \"0.12.1\""}, {"sha": "0bf43aefebffbd646d745cbd9217ef2ee9c92af4", "filename": "test_dependencies/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/test_dependencies%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/test_dependencies%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test_dependencies%2FCargo.toml?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -11,6 +11,7 @@ edition = \"2021\"\n # all dependencies (and their transitive ones) listed here can be used in `tests/`.\n tokio = { version = \"1.0\", features = [\"full\"] }\n libc = \"0.2\"\n+page_size = \"0.4.1\"\n \n getrandom_1 = { package = \"getrandom\", version = \"0.1\" }\n getrandom_2 = { package = \"getrandom\", version = \"0.2\" }"}, {"sha": "7cb42c09a9677015c6dfab3772fdd0404dcfd1ca", "filename": "tests/fail/crates/tokio_mvp.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Ffail%2Fcrates%2Ftokio_mvp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Ffail%2Fcrates%2Ftokio_mvp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ffail%2Fcrates%2Ftokio_mvp.rs?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "previous_filename": "tests/fail/tokio_mvp.rs"}, {"sha": "cff948f364087733f5de80f8ec9b4b51136ab16f", "filename": "tests/fail/crates/tokio_mvp.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Ffail%2Fcrates%2Ftokio_mvp.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Ffail%2Fcrates%2Ftokio_mvp.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ffail%2Fcrates%2Ftokio_mvp.stderr?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "previous_filename": "tests/fail/tokio_mvp.stderr"}, {"sha": "cdcabf3333814cc2939e94d4d07704c7bf7659bb", "filename": "tests/pass/crates/page_size.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Fpass%2Fcrates%2Fpage_size.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Fpass%2Fcrates%2Fpage_size.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fpass%2Fcrates%2Fpage_size.rs?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "patch": "@@ -0,0 +1,6 @@\n+fn main() {\n+    let page_size = page_size::get();\n+\n+    // In particular, this checks that it is not 0.\n+    assert!(page_size.is_power_of_two(), \"page size not a power of two: {}\", page_size);\n+}"}, {"sha": "808d1006d4f3a50739674b3be89a4e27c8b0e7da", "filename": "tests/pass/crates/random.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Fpass%2Fcrates%2Frandom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d309f4243992c7708cd967ec8ef56e2e1b4553/tests%2Fpass%2Fcrates%2Frandom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fpass%2Fcrates%2Frandom.rs?ref=46d309f4243992c7708cd967ec8ef56e2e1b4553", "previous_filename": "tests/pass/random.rs"}]}