{"sha": "1b5cbd0036bfd4623a6e38897978819f737eb298", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiNWNiZDAwMzZiZmQ0NjIzYTZlMzg4OTc5Nzg4MTlmNzM3ZWIyOTg=", "commit": {"author": {"name": "Jakub Bukaj", "email": "jakub@jakub.cc", "date": "2014-11-18T21:46:49Z"}, "committer": {"name": "Jakub Bukaj", "email": "jakub@jakub.cc", "date": "2014-11-19T20:14:48Z"}, "message": "Forbid matching struct variants with tuple variant patterns", "tree": {"sha": "fc48c19466b1d0a80afef9eb7b2a3184f97c050f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc48c19466b1d0a80afef9eb7b2a3184f97c050f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b5cbd0036bfd4623a6e38897978819f737eb298", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b5cbd0036bfd4623a6e38897978819f737eb298", "html_url": "https://github.com/rust-lang/rust/commit/1b5cbd0036bfd4623a6e38897978819f737eb298", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b5cbd0036bfd4623a6e38897978819f737eb298/comments", "author": null, "committer": null, "parents": [{"sha": "3e9414463e88f01eef9953f4644ca3ffc3f17250", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e9414463e88f01eef9953f4644ca3ffc3f17250", "html_url": "https://github.com/rust-lang/rust/commit/3e9414463e88f01eef9953f4644ca3ffc3f17250"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "cdfd607d067103adb173d2a4af601ddfa9488a69", "filename": "src/librustc/middle/typeck/check/_match.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1b5cbd0036bfd4623a6e38897978819f737eb298/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b5cbd0036bfd4623a6e38897978819f737eb298/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2F_match.rs?ref=1b5cbd0036bfd4623a6e38897978819f737eb298", "patch": "@@ -379,7 +379,8 @@ pub fn check_pat_enum<'a, 'tcx>(pcx: &pat_ctxt<'a, 'tcx>, pat: &ast::Pat,\n \n     let real_path_ty = fcx.node_ty(pat.id);\n     let (arg_tys, kind_name) = match real_path_ty.sty {\n-        ty::ty_enum(enum_def_id, ref expected_substs) => {\n+        ty::ty_enum(enum_def_id, ref expected_substs)\n+            if def == def::DefVariant(enum_def_id, def.def_id(), false) => {\n             let variant = ty::enum_variant_with_id(tcx, enum_def_id, def.def_id());\n             (variant.args.iter().map(|t| t.subst(tcx, expected_substs)).collect::<Vec<_>>(),\n                 \"variant\")\n@@ -392,7 +393,7 @@ pub fn check_pat_enum<'a, 'tcx>(pcx: &pat_ctxt<'a, 'tcx>, pat: &ast::Pat,\n         _ => {\n             let name = pprust::path_to_string(path);\n             span_err!(tcx.sess, pat.span, E0164,\n-                \"`{}` does not name a variant or a tuple struct\", name);\n+                \"`{}` does not name a non-struct variant or a tuple struct\", name);\n             fcx.write_error(pat.id);\n \n             if let Some(ref subpats) = *subpats {"}, {"sha": "9fd1f228984bb5ad97baecde56e11a5d198c1eaa", "filename": "src/test/compile-fail/issue-19086.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/1b5cbd0036bfd4623a6e38897978819f737eb298/src%2Ftest%2Fcompile-fail%2Fissue-19086.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b5cbd0036bfd4623a6e38897978819f737eb298/src%2Ftest%2Fcompile-fail%2Fissue-19086.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-19086.rs?ref=1b5cbd0036bfd4623a6e38897978819f737eb298", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    enum Foo {\n+        FooB { x: i32, y: i32 }\n+    }\n+\n+    let f = FooB { x: 3, y: 4 };\n+    match f {\n+        FooB(a, b) => println!(\"{} {}\", a, b),\n+//~^ ERROR `FooB` does not name a non-struct variant or a tuple struct\n+    }\n+}"}]}