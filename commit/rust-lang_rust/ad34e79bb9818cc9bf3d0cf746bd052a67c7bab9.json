{"sha": "ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkMzRlNzliYjk4MThjYzliZjNkMGNmNzQ2YmQwNTJhNjdjN2JhYjk=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-03-09T20:54:31Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-03-09T20:54:31Z"}, "message": "use doc-comments", "tree": {"sha": "a2a097577e8bf6949cbc81064ef5cabf89a0d8ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2a097577e8bf6949cbc81064ef5cabf89a0d8ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9", "html_url": "https://github.com/rust-lang/rust/commit/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc8c40480a34aa1d233d9a34b505bee16897ef54", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc8c40480a34aa1d233d9a34b505bee16897ef54", "html_url": "https://github.com/rust-lang/rust/commit/cc8c40480a34aa1d233d9a34b505bee16897ef54"}], "stats": {"total": 43, "additions": 22, "deletions": 21}, "files": [{"sha": "11a7fb59a3b70b79a890f3292009478d545c6086", "filename": "crates/proc_macro_api/src/version.rs", "status": "modified", "additions": 22, "deletions": 21, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs?ref=ad34e79bb9818cc9bf3d0cf746bd052a67c7bab9", "patch": "@@ -64,8 +64,8 @@ pub(crate) fn read_info(dylib_path: &Path) -> io::Result<RustCInfo> {\n     Ok(RustCInfo { version, channel, commit, date })\n }\n \n-// This is used inside read_version() to locate the \".rustc\" section\n-// from a proc macro crate's binary file.\n+/// This is used inside read_version() to locate the \".rustc\" section\n+/// from a proc macro crate's binary file.\n fn read_section<'a>(dylib_binary: &'a [u8], section_name: &str) -> io::Result<&'a [u8]> {\n     BinaryFile::parse(dylib_binary)\n         .map_err(|e| io::Error::new(io::ErrorKind::InvalidData, e))?\n@@ -75,25 +75,26 @@ fn read_section<'a>(dylib_binary: &'a [u8], section_name: &str) -> io::Result<&'\n         .map_err(|e| io::Error::new(io::ErrorKind::InvalidData, e))\n }\n \n-// Check the version of rustc that was used to compile a proc macro crate's\n-// binary file.\n-// A proc macro crate binary's \".rustc\" section has following byte layout:\n-// * [b'r',b'u',b's',b't',0,0,0,5] is the first 8 bytes\n-// * ff060000 734e6150 is followed, it's the snappy format magic bytes,\n-//   means bytes from here(including this sequence) are compressed in\n-//   snappy compression format. Version info is inside here, so decompress\n-//   this.\n-// The bytes you get after decompressing the snappy format portion has\n-// following layout:\n-// * [b'r',b'u',b's',b't',0,0,0,5] is the first 8 bytes(again)\n-// * [crate root bytes] next 4 bytes is to store crate root position,\n-//   according to rustc's source code comment\n-// * [length byte] next 1 byte tells us how many bytes we should read next\n-//   for the version string's utf8 bytes\n-// * [version string bytes encoded in utf8] <- GET THIS BOI\n-// * [some more bytes that we don really care but still there] :-)\n-// Check this issue for more about the bytes layout:\n-// https://github.com/rust-analyzer/rust-analyzer/issues/6174\n+/// Check the version of rustc that was used to compile a proc macro crate's\n+///\n+/// binary file.\n+/// A proc macro crate binary's \".rustc\" section has following byte layout:\n+/// * [b'r',b'u',b's',b't',0,0,0,5] is the first 8 bytes\n+/// * ff060000 734e6150 is followed, it's the snappy format magic bytes,\n+///   means bytes from here(including this sequence) are compressed in\n+///   snappy compression format. Version info is inside here, so decompress\n+///   this.\n+/// The bytes you get after decompressing the snappy format portion has\n+/// following layout:\n+/// * [b'r',b'u',b's',b't',0,0,0,5] is the first 8 bytes(again)\n+/// * [crate root bytes] next 4 bytes is to store crate root position,\n+///   according to rustc's source code comment\n+/// * [length byte] next 1 byte tells us how many bytes we should read next\n+///   for the version string's utf8 bytes\n+/// * [version string bytes encoded in utf8] <- GET THIS BOI\n+/// * [some more bytes that we don really care but still there] :-)\n+/// Check this issue for more about the bytes layout:\n+/// https://github.com/rust-analyzer/rust-analyzer/issues/6174\n fn read_version(dylib_path: &Path) -> io::Result<String> {\n     let dylib_file = File::open(dylib_path)?;\n     let dylib_mmaped = unsafe { Mmap::map(&dylib_file) }?;"}]}