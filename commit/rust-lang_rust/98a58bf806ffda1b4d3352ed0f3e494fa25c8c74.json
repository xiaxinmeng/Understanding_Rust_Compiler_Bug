{"sha": "98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4YTU4YmY4MDZmZmRhMWI0ZDMzNTJlZDBmM2U0OTRmYTI1YzhjNzQ=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2017-12-31T13:56:33Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2017-12-31T13:56:33Z"}, "message": "Lexer: basic comments", "tree": {"sha": "7f309dee323e04dde12683bfa118d16c55249ea8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f309dee323e04dde12683bfa118d16c55249ea8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "html_url": "https://github.com/rust-lang/rust/commit/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb6f07618440859a26fd6adea63bd030da375952", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb6f07618440859a26fd6adea63bd030da375952", "html_url": "https://github.com/rust-lang/rust/commit/cb6f07618440859a26fd6adea63bd030da375952"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "79782cc5b85c7bbe896a0488859fc915bd049219", "filename": "src/lexer/comments.rs", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/src%2Flexer%2Fcomments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/src%2Flexer%2Fcomments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flexer%2Fcomments.rs?ref=98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "patch": "@@ -1,11 +1,36 @@\n use lexer::ptr::Ptr;\n \n use {SyntaxKind};\n+use syntax_kinds::*;\n \n pub(crate) fn scan_shebang(ptr: &mut Ptr) -> bool {\n-    false\n+    if ptr.next_is('!') && ptr.nnext_is('/') {\n+        ptr.bump();\n+        ptr.bump();\n+        bump_until_eol(ptr);\n+        true\n+    } else {\n+        false\n+    }\n }\n \n pub(crate) fn scan_comment(ptr: &mut Ptr) -> Option<SyntaxKind> {\n-    None\n+    if ptr.next_is('/') {\n+        bump_until_eol(ptr);\n+        Some(COMMENT)\n+    } else {\n+        None\n+    }\n+}\n+\n+\n+fn bump_until_eol(ptr: &mut Ptr) {\n+    loop {\n+        if ptr.next_is('\\n') || ptr.next_is('\\r') && ptr.nnext_is('\\n') {\n+            return;\n+        }\n+        if ptr.bump().is_none() {\n+            break;\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "71bdd1f9c329f17512756af5d49e3958e8c0d44f", "filename": "tests/data/lexer/0010_comments.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/tests%2Fdata%2Flexer%2F0010_comments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/tests%2Fdata%2Flexer%2F0010_comments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0010_comments.rs?ref=98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "patch": "@@ -0,0 +1,3 @@\n+#!/usr/bin/env bash\n+// hello\n+//! World"}, {"sha": "3c997de3f1d7fd37c432f308b76348b22e5b2dcc", "filename": "tests/data/lexer/0010_comments.txt", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/tests%2Fdata%2Flexer%2F0010_comments.txt", "raw_url": "https://github.com/rust-lang/rust/raw/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/tests%2Fdata%2Flexer%2F0010_comments.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0010_comments.txt?ref=98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "patch": "@@ -0,0 +1,6 @@\n+SHEBANG 19 \"#!/usr/bin/env bash\"\n+WHITESPACE 1 \"\\n\"\n+COMMENT 8 \"// hello\"\n+WHITESPACE 1 \"\\n\"\n+COMMENT 9 \"//! World\"\n+WHITESPACE 1 \"\\n\""}, {"sha": "e72de1ea2ef36e2046e843216f42e114fa0e14df", "filename": "validation.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/validation.md", "raw_url": "https://github.com/rust-lang/rust/raw/98a58bf806ffda1b4d3352ed0f3e494fa25c8c74/validation.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/validation.md?ref=98a58bf806ffda1b4d3352ed0f3e494fa25c8c74", "patch": "@@ -6,3 +6,4 @@ Fixmes:\n   base, and are in range\n * Validation for unclosed char literal\n * Strings are completely wrong: more tests and comparison with libsyntax.\n+* Comment lexing is completely wrong"}]}