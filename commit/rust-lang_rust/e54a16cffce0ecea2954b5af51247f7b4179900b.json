{"sha": "e54a16cffce0ecea2954b5af51247f7b4179900b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1NGExNmNmZmNlMGVjZWEyOTU0YjVhZjUxMjQ3ZjdiNDE3OTkwMGI=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-03-05T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-03-05T14:34:50Z"}, "message": "Change DIBuilderCreateEnumerator signature to match LLVM 9\n\nNo functional changes intended.", "tree": {"sha": "e07f67b94eb53416f115d143d9b56ddd2a5b5e5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e07f67b94eb53416f115d143d9b56ddd2a5b5e5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e54a16cffce0ecea2954b5af51247f7b4179900b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e54a16cffce0ecea2954b5af51247f7b4179900b", "html_url": "https://github.com/rust-lang/rust/commit/e54a16cffce0ecea2954b5af51247f7b4179900b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e54a16cffce0ecea2954b5af51247f7b4179900b/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e179690f8ad9790eb3a6b1dbb6a0ddf479f2c86", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e179690f8ad9790eb3a6b1dbb6a0ddf479f2c86", "html_url": "https://github.com/rust-lang/rust/commit/1e179690f8ad9790eb3a6b1dbb6a0ddf479f2c86"}], "stats": {"total": 28, "additions": 17, "deletions": 11}, "files": [{"sha": "7beaf134e6ba1a62aa4ae705a300c4a2da1f6052", "filename": "src/librustc_codegen_llvm/debuginfo/metadata.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs?ref=e54a16cffce0ecea2954b5af51247f7b4179900b", "patch": "@@ -1779,13 +1779,15 @@ fn prepare_enum_metadata(\n                 .discriminants(cx.tcx)\n                 .zip(&def.variants)\n                 .map(|((_, discr), v)| {\n-                    let name = SmallCStr::new(&v.ident.as_str());\n+                    let name = v.ident.as_str();\n                     unsafe {\n                         Some(llvm::LLVMRustDIBuilderCreateEnumerator(\n                             DIB(cx),\n-                            name.as_ptr(),\n+                            name.as_ptr().cast(),\n+                            name.len(),\n                             // FIXME: what if enumeration has i128 discriminant?\n-                            discr.val as u64,\n+                            discr.val as i64,\n+                            false, // FIXME: IsUnsigned.\n                         ))\n                     }\n                 })\n@@ -1794,13 +1796,15 @@ fn prepare_enum_metadata(\n                 .as_generator()\n                 .variant_range(enum_def_id, cx.tcx)\n                 .map(|variant_index| {\n-                    let name = SmallCStr::new(&substs.as_generator().variant_name(variant_index));\n+                    let name = substs.as_generator().variant_name(variant_index);\n                     unsafe {\n                         Some(llvm::LLVMRustDIBuilderCreateEnumerator(\n                             DIB(cx),\n-                            name.as_ptr(),\n+                            name.as_ptr().cast(),\n+                            name.len(),\n                             // FIXME: what if enumeration has i128 discriminant?\n-                            variant_index.as_usize() as u64,\n+                            variant_index.as_usize() as i64,\n+                            false, // FIXME: IsUnsigned.\n                         ))\n                     }\n                 })"}, {"sha": "8b796e0423b1325463d9b43cc629e569bb528115", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=e54a16cffce0ecea2954b5af51247f7b4179900b", "patch": "@@ -1776,7 +1776,9 @@ extern \"C\" {\n     pub fn LLVMRustDIBuilderCreateEnumerator(\n         Builder: &DIBuilder<'a>,\n         Name: *const c_char,\n-        Val: u64,\n+        NameLen: size_t,\n+        Value: i64,\n+        IsUnsigned: bool,\n     ) -> &'a DIEnumerator;\n \n     pub fn LLVMRustDIBuilderCreateEnumerationType("}, {"sha": "0e430d3881e60dc277ac3e64ba72cf37bd886dc4", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e54a16cffce0ecea2954b5af51247f7b4179900b/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=e54a16cffce0ecea2954b5af51247f7b4179900b", "patch": "@@ -891,10 +891,10 @@ extern \"C\" LLVMValueRef LLVMRustDIBuilderInsertDeclareAtEnd(\n       unwrap(InsertAtEnd)));\n }\n \n-extern \"C\" LLVMMetadataRef\n-LLVMRustDIBuilderCreateEnumerator(LLVMRustDIBuilderRef Builder,\n-                                  const char *Name, uint64_t Val) {\n-  return wrap(Builder->createEnumerator(Name, Val));\n+extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateEnumerator(\n+    LLVMRustDIBuilderRef Builder, const char *Name, size_t NameLen,\n+    int64_t Value, bool IsUnsigned) {\n+  return wrap(Builder->createEnumerator({Name, NameLen}, Value, IsUnsigned));\n }\n \n extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateEnumerationType("}]}