{"sha": "9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhOGJiZTlkYTlhOWM1NTM3Mzc5ZWUzOGU3NTVjZjM1YzdhNGZjOTY=", "commit": {"author": {"name": "Inokentiy Babushkin", "email": "twk@twki.de", "date": "2017-06-11T11:48:54Z"}, "committer": {"name": "Inokentiy Babushkin", "email": "twk@twki.de", "date": "2017-06-11T11:48:54Z"}, "message": "Added hash verification to external source loading.", "tree": {"sha": "fd49c9be5cd815899e40b1bcad7b54b300d57652", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd49c9be5cd815899e40b1bcad7b54b300d57652"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "comment_count": 0, "verification": {"verified": false, "reason": "unverified_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEXezFNCHL3+3lgSPSfvyOxSJN6OwFAlk9LjgACgkQfvyOxSJN\n6OzUoQ/8CMUKnq3WAzGfTJH0apAPF2VWrLH+rbFB7TMVSZ+pJJrBQINprnTmBTCy\nQ9CXScE8WVz55qe04tzYR7/Im6hEJ7Jdx4UY5XizGsIvrDULLVCo/bAsllmoJ3+0\ngPn0UaglAUYDq+sBE2ZpShswqfEjqIfRqpfvZ+QEkwaacjVvdgG+xPgTB/dn/XRT\nNBQV1feLSGiAj2e63Sg/thDL/8kQfN4VtNr0c1dtmjbQRaRUsCKt91TizyBckg1T\nhsqG6CW87Osu02eVOtCw75E8uWj4lU8wEqq6EH5pLhruYNg0fbKvEEPm2hFjpUYt\nZIFZY3Rn2xkZmeow+BeUCFRt+/4KPIsHzYrpT1rPfvY5p5TX/FpTmprdiuX4gaLX\nKyX9j7yIlF0wVDX/eoMmKpI9dbKn6199A20wVNgyovys9zg+isggXr3YZXMY5J+8\n0yybsCqalJG6NaZkGan677HIMPdYisZ5dALHuDN1hivBlkbOM+vmA+KeizANInyz\nHq4Sz/YB36oq3ZvS2UDs240JXxt3whdYK2PIvYcjR4C8C2N/7CYsrk60isuIkdDA\n5N5jgRpxRQ3pf1dVu8YIBMoGDs5slDf9uc+uh3LoGZOO3FCsJULg7EHY4NaVfCOb\nufYihhA9COkYxO0XcHltt9QeHGjgdYyMiWJ/vxDKnDstKDTbR+U=\n=bKDx\n-----END PGP SIGNATURE-----", "payload": "tree fd49c9be5cd815899e40b1bcad7b54b300d57652\nparent a5b8851e220d7a80222ea04d242603dd3392d17b\nauthor Inokentiy Babushkin <twk@twki.de> 1497181734 +0200\ncommitter Inokentiy Babushkin <twk@twki.de> 1497181734 +0200\n\nAdded hash verification to external source loading.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "html_url": "https://github.com/rust-lang/rust/commit/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96/comments", "author": {"login": "ibabushkin", "id": 10811417, "node_id": "MDQ6VXNlcjEwODExNDE3", "avatar_url": "https://avatars.githubusercontent.com/u/10811417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibabushkin", "html_url": "https://github.com/ibabushkin", "followers_url": "https://api.github.com/users/ibabushkin/followers", "following_url": "https://api.github.com/users/ibabushkin/following{/other_user}", "gists_url": "https://api.github.com/users/ibabushkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibabushkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibabushkin/subscriptions", "organizations_url": "https://api.github.com/users/ibabushkin/orgs", "repos_url": "https://api.github.com/users/ibabushkin/repos", "events_url": "https://api.github.com/users/ibabushkin/events{/privacy}", "received_events_url": "https://api.github.com/users/ibabushkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibabushkin", "id": 10811417, "node_id": "MDQ6VXNlcjEwODExNDE3", "avatar_url": "https://avatars.githubusercontent.com/u/10811417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibabushkin", "html_url": "https://github.com/ibabushkin", "followers_url": "https://api.github.com/users/ibabushkin/followers", "following_url": "https://api.github.com/users/ibabushkin/following{/other_user}", "gists_url": "https://api.github.com/users/ibabushkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibabushkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibabushkin/subscriptions", "organizations_url": "https://api.github.com/users/ibabushkin/orgs", "repos_url": "https://api.github.com/users/ibabushkin/repos", "events_url": "https://api.github.com/users/ibabushkin/events{/privacy}", "received_events_url": "https://api.github.com/users/ibabushkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5b8851e220d7a80222ea04d242603dd3392d17b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5b8851e220d7a80222ea04d242603dd3392d17b", "html_url": "https://github.com/rust-lang/rust/commit/a5b8851e220d7a80222ea04d242603dd3392d17b"}], "stats": {"total": 29, "additions": 22, "deletions": 7}, "files": [{"sha": "8e04e47e25f9c1a65037b45c6d555c6b199cad45", "filename": "src/libsyntax/codemap.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96/src%2Flibsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96/src%2Flibsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fcodemap.rs?ref=9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "patch": "@@ -567,13 +567,8 @@ impl CodeMapper for CodeMap {\n         };\n \n         if *file_map.external_src.borrow() == ExternalSource::AbsentOk {\n-            let mut external_src = file_map.external_src.borrow_mut();\n-            if let Ok(src) = self.file_loader.read_file(Path::new(&filename)) {\n-                *external_src = ExternalSource::Present(src);\n-                return true;\n-            } else {\n-                *external_src = ExternalSource::AbsentErr;\n-            }\n+            let src = self.file_loader.read_file(Path::new(&filename)).ok();\n+            return file_map.add_external_src(src);\n         }\n \n         false"}, {"sha": "719c25e2410b9102cdda0e3f2263f291352b7201", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=9a8bbe9da9a9c5537379ee38e755cf35c7a4fc96", "patch": "@@ -604,6 +604,26 @@ impl FileMap {\n         lines.push(pos);\n     }\n \n+    /// add externally loaded source.\n+    /// if the hash of the input doesn't match or no input is supplied via None,\n+    /// it is interpreted as an error and the corresponding enum variant is set.\n+    pub fn add_external_src(&self, src: Option<String>) -> bool {\n+        let mut external_src = self.external_src.borrow_mut();\n+        if let Some(src) = src {\n+            let mut hasher: StableHasher<u128> = StableHasher::new();\n+            hasher.write(src.as_bytes());\n+\n+            if hasher.finish() == self.src_hash {\n+                *external_src = ExternalSource::Present(src);\n+                return true;\n+            }\n+        } else {\n+            *external_src = ExternalSource::AbsentErr;\n+        }\n+\n+        false\n+    }\n+\n     /// get a line from the list of pre-computed line-beginnings.\n     /// line-number here is 0-based.\n     pub fn get_line(&self, line_number: usize) -> Option<Cow<str>> {"}]}