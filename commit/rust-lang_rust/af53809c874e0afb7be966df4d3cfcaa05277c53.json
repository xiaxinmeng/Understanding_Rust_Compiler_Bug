{"sha": "af53809c874e0afb7be966df4d3cfcaa05277c53", "node_id": "C_kwDOAAsO6NoAKGFmNTM4MDljODc0ZTBhZmI3YmU5NjZkZjRkM2NmY2FhMDUyNzdjNTM", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-03-10T05:30:52Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-03-11T23:26:51Z"}, "message": "Format core and std macro rules, removing needless surrounding blocks", "tree": {"sha": "b9ce5ccc496308e493103880061736a7b4485007", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9ce5ccc496308e493103880061736a7b4485007"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af53809c874e0afb7be966df4d3cfcaa05277c53", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmIr2rsACgkQ+boUO5X/\nbYJ6XQ/+IvCr7sHuZwNRea9Pw7QomNV+51pLl/GrnjRce7zfTyuweYyvr47ps7j5\n0Acl7Ktknvj5Ast3F5qMUzLKC0MXkU/4EK75j9amgJVkat/E4nuVe63dm4Wo4auA\nzTRyuXAr/rSv3UiQn2tqi2y7oinjAKmKvMHK2aJ1N9nVZrKtQ6CNzmrF9+d3ChCZ\nsNyfAqKKmW6m5Jyh4VYACulGaIZMMHFaDrFGRcM5ptwjM9YKDvQhWyRuIKXaXer5\nGhDUAHfEGsI/yJE6TNzP6Ten8Bt2XlfnyidFBVgjouDU+UDFyK0LjdLtUhd50C5W\nvR10n33WyZPLNDgtfcznbBiQGgsAWE9DFbTltD1Kq0P7UDGC08ry/eOiiQKhmrZ0\n/JQfXIXUFOxdT7GA+pvPDjqWWhiNDdbpAQ81gFHKiXLr6mUmkYWAKvPeoGo9aBQk\nRX9inK19KVkVjk/sLmbcwsqdOU0BiCLRwydIKf8VQ6vbqhbuaIjCCCs0VlFO1CQ/\nhfCNOdXgJpD81q/jlJYtMRMeYk5cQWIFgQyoHmharT1+0KVAIBQWz4V/KjhB8N31\ntiAUQsUK/oPPStBC1M0JzBLXVV1HIenhaXPLKvebjZ9LbRESa6bbq1j6oAQDrWq5\nKS/60J3jxfAmT4hIyiROIlgDbdzC59zu3sSCY/AZlVZnT2dO3ZM=\n=Q8ji\n-----END PGP SIGNATURE-----", "payload": "tree b9ce5ccc496308e493103880061736a7b4485007\nparent 335ffbfa547df94ac236f5c56130cecf99c8d82b\nauthor David Tolnay <dtolnay@gmail.com> 1646890252 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1647041211 -0800\n\nFormat core and std macro rules, removing needless surrounding blocks\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af53809c874e0afb7be966df4d3cfcaa05277c53", "html_url": "https://github.com/rust-lang/rust/commit/af53809c874e0afb7be966df4d3cfcaa05277c53", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af53809c874e0afb7be966df4d3cfcaa05277c53/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "335ffbfa547df94ac236f5c56130cecf99c8d82b", "url": "https://api.github.com/repos/rust-lang/rust/commits/335ffbfa547df94ac236f5c56130cecf99c8d82b", "html_url": "https://github.com/rust-lang/rust/commit/335ffbfa547df94ac236f5c56130cecf99c8d82b"}], "stats": {"total": 112, "additions": 72, "deletions": 40}, "files": [{"sha": "74c94680e47e54c82dd903b522a2e2cfed75d56e", "filename": "library/core/src/macros/mod.rs", "status": "modified", "additions": 50, "deletions": 26, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -34,7 +34,7 @@ macro_rules! panic {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"assert_eq_macro\")]\n #[allow_internal_unstable(core_panic)]\n macro_rules! assert_eq {\n-    ($left:expr, $right:expr $(,)?) => ({\n+    ($left:expr, $right:expr $(,)?) => {\n         match (&$left, &$right) {\n             (left_val, right_val) => {\n                 if !(*left_val == *right_val) {\n@@ -46,8 +46,8 @@ macro_rules! assert_eq {\n                 }\n             }\n         }\n-    });\n-    ($left:expr, $right:expr, $($arg:tt)+) => ({\n+    };\n+    ($left:expr, $right:expr, $($arg:tt)+) => {\n         match (&$left, &$right) {\n             (left_val, right_val) => {\n                 if !(*left_val == *right_val) {\n@@ -59,7 +59,7 @@ macro_rules! assert_eq {\n                 }\n             }\n         }\n-    });\n+    };\n }\n \n /// Asserts that two expressions are not equal to each other (using [`PartialEq`]).\n@@ -84,7 +84,7 @@ macro_rules! assert_eq {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"assert_ne_macro\")]\n #[allow_internal_unstable(core_panic)]\n macro_rules! assert_ne {\n-    ($left:expr, $right:expr $(,)?) => ({\n+    ($left:expr, $right:expr $(,)?) => {\n         match (&$left, &$right) {\n             (left_val, right_val) => {\n                 if *left_val == *right_val {\n@@ -96,8 +96,8 @@ macro_rules! assert_ne {\n                 }\n             }\n         }\n-    });\n-    ($left:expr, $right:expr, $($arg:tt)+) => ({\n+    };\n+    ($left:expr, $right:expr, $($arg:tt)+) => {\n         match (&($left), &($right)) {\n             (left_val, right_val) => {\n                 if *left_val == *right_val {\n@@ -109,7 +109,7 @@ macro_rules! assert_ne {\n                 }\n             }\n         }\n-    });\n+    };\n }\n \n /// Asserts that an expression matches any of the given patterns.\n@@ -142,7 +142,7 @@ macro_rules! assert_ne {\n #[allow_internal_unstable(core_panic)]\n #[rustc_macro_transparency = \"semitransparent\"]\n pub macro assert_matches {\n-    ($left:expr, $(|)? $( $pattern:pat_param )|+ $( if $guard: expr )? $(,)?) => ({\n+    ($left:expr, $(|)? $( $pattern:pat_param )|+ $( if $guard: expr )? $(,)?) => {\n         match $left {\n             $( $pattern )|+ $( if $guard )? => {}\n             ref left_val => {\n@@ -153,8 +153,8 @@ pub macro assert_matches {\n                 );\n             }\n         }\n-    }),\n-    ($left:expr, $(|)? $( $pattern:pat_param )|+ $( if $guard: expr )?, $($arg:tt)+) => ({\n+    },\n+    ($left:expr, $(|)? $( $pattern:pat_param )|+ $( if $guard: expr )?, $($arg:tt)+) => {\n         match $left {\n             $( $pattern )|+ $( if $guard )? => {}\n             ref left_val => {\n@@ -165,7 +165,7 @@ pub macro assert_matches {\n                 );\n             }\n         }\n-    }),\n+    },\n }\n \n /// Asserts that a boolean expression is `true` at runtime.\n@@ -214,7 +214,11 @@ pub macro assert_matches {\n #[rustc_diagnostic_item = \"debug_assert_macro\"]\n #[allow_internal_unstable(edition_panic)]\n macro_rules! debug_assert {\n-    ($($arg:tt)*) => (if $crate::cfg!(debug_assertions) { $crate::assert!($($arg)*); })\n+    ($($arg:tt)*) => {\n+        if $crate::cfg!(debug_assertions) {\n+            $crate::assert!($($arg)*);\n+        }\n+    };\n }\n \n /// Asserts that two expressions are equal to each other.\n@@ -240,7 +244,11 @@ macro_rules! debug_assert {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"debug_assert_eq_macro\")]\n macro_rules! debug_assert_eq {\n-    ($($arg:tt)*) => (if $crate::cfg!(debug_assertions) { $crate::assert_eq!($($arg)*); })\n+    ($($arg:tt)*) => {\n+        if $crate::cfg!(debug_assertions) {\n+            $crate::assert_eq!($($arg)*);\n+        }\n+    };\n }\n \n /// Asserts that two expressions are not equal to each other.\n@@ -266,7 +274,11 @@ macro_rules! debug_assert_eq {\n #[stable(feature = \"assert_ne\", since = \"1.13.0\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"debug_assert_ne_macro\")]\n macro_rules! debug_assert_ne {\n-    ($($arg:tt)*) => (if $crate::cfg!(debug_assertions) { $crate::assert_ne!($($arg)*); })\n+    ($($arg:tt)*) => {\n+        if $crate::cfg!(debug_assertions) {\n+            $crate::assert_ne!($($arg)*);\n+        }\n+    };\n }\n \n /// Asserts that an expression matches any of the given patterns.\n@@ -305,7 +317,9 @@ macro_rules! debug_assert_ne {\n #[allow_internal_unstable(assert_matches)]\n #[rustc_macro_transparency = \"semitransparent\"]\n pub macro debug_assert_matches($($arg:tt)*) {\n-    if $crate::cfg!(debug_assertions) { $crate::assert_matches::assert_matches!($($arg)*); }\n+    if $crate::cfg!(debug_assertions) {\n+        $crate::assert_matches::assert_matches!($($arg)*);\n+    }\n }\n \n /// Returns whether the given expression matches any of the given patterns.\n@@ -331,7 +345,7 @@ macro_rules! matches {\n             $( $pattern )|+ $( if $guard )? => true,\n             _ => false\n         }\n-    }\n+    };\n }\n \n /// Unwraps a result or propagates its error.\n@@ -482,7 +496,9 @@ macro_rules! r#try {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"write_macro\")]\n macro_rules! write {\n-    ($dst:expr, $($arg:tt)*) => ($dst.write_fmt($crate::format_args!($($arg)*)))\n+    ($dst:expr, $($arg:tt)*) => {\n+        $dst.write_fmt($crate::format_args!($($arg)*))\n+    };\n }\n \n /// Write formatted data into a buffer, with a newline appended.\n@@ -534,12 +550,12 @@ macro_rules! write {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"writeln_macro\")]\n #[allow_internal_unstable(format_args_nl)]\n macro_rules! writeln {\n-    ($dst:expr $(,)?) => (\n+    ($dst:expr $(,)?) => {\n         $crate::write!($dst, \"\\n\")\n-    );\n-    ($dst:expr, $($arg:tt)*) => (\n+    };\n+    ($dst:expr, $($arg:tt)*) => {\n         $dst.write_fmt($crate::format_args_nl!($($arg)*))\n-    );\n+    };\n }\n \n /// Indicates unreachable code.\n@@ -683,8 +699,12 @@ macro_rules! unreachable {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"unimplemented_macro\")]\n #[allow_internal_unstable(core_panic)]\n macro_rules! unimplemented {\n-    () => ($crate::panicking::panic(\"not implemented\"));\n-    ($($arg:tt)+) => ($crate::panic!(\"not implemented: {}\", $crate::format_args!($($arg)+)));\n+    () => {\n+        $crate::panicking::panic(\"not implemented\")\n+    };\n+    ($($arg:tt)+) => {\n+        $crate::panic!(\"not implemented: {}\", $crate::format_args!($($arg)+))\n+    };\n }\n \n /// Indicates unfinished code.\n@@ -746,8 +766,12 @@ macro_rules! unimplemented {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"todo_macro\")]\n #[allow_internal_unstable(core_panic)]\n macro_rules! todo {\n-    () => ($crate::panicking::panic(\"not yet implemented\"));\n-    ($($arg:tt)+) => ($crate::panic!(\"not yet implemented: {}\", $crate::format_args!($($arg)+)));\n+    () => {\n+        $crate::panicking::panic(\"not yet implemented\")\n+    };\n+    ($($arg:tt)+) => {\n+        $crate::panic!(\"not yet implemented: {}\", $crate::format_args!($($arg)+))\n+    };\n }\n \n /// Definitions of built-in macros."}, {"sha": "c597fb5df45d28fd49af6d3a20a95b0a49997d16", "filename": "library/std/src/macros.rs", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/library%2Fstd%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/library%2Fstd%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fmacros.rs?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -60,7 +60,9 @@ macro_rules! panic {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"print_macro\")]\n #[allow_internal_unstable(print_internals)]\n macro_rules! print {\n-    ($($arg:tt)*) => ($crate::io::_print($crate::format_args!($($arg)*)));\n+    ($($arg:tt)*) => {\n+        $crate::io::_print($crate::format_args!($($arg)*))\n+    };\n }\n \n /// Prints to the standard output, with a newline.\n@@ -94,10 +96,12 @@ macro_rules! print {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"println_macro\")]\n #[allow_internal_unstable(print_internals, format_args_nl)]\n macro_rules! println {\n-    () => ($crate::print!(\"\\n\"));\n-    ($($arg:tt)*) => ({\n-        $crate::io::_print($crate::format_args_nl!($($arg)*));\n-    })\n+    () => {\n+        $crate::print!(\"\\n\")\n+    };\n+    ($($arg:tt)*) => {\n+        $crate::io::_print($crate::format_args_nl!($($arg)*))\n+    };\n }\n \n /// Prints to the standard error.\n@@ -126,7 +130,9 @@ macro_rules! println {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"eprint_macro\")]\n #[allow_internal_unstable(print_internals)]\n macro_rules! eprint {\n-    ($($arg:tt)*) => ($crate::io::_eprint($crate::format_args!($($arg)*)));\n+    ($($arg:tt)*) => {\n+        $crate::io::_eprint($crate::format_args!($($arg)*))\n+    };\n }\n \n /// Prints to the standard error, with a newline.\n@@ -155,10 +161,12 @@ macro_rules! eprint {\n #[cfg_attr(not(test), rustc_diagnostic_item = \"eprintln_macro\")]\n #[allow_internal_unstable(print_internals, format_args_nl)]\n macro_rules! eprintln {\n-    () => ($crate::eprint!(\"\\n\"));\n-    ($($arg:tt)*) => ({\n-        $crate::io::_eprint($crate::format_args_nl!($($arg)*));\n-    })\n+    () => {\n+        $crate::eprint!(\"\\n\")\n+    };\n+    ($($arg:tt)*) => {\n+        $crate::io::_eprint($crate::format_args_nl!($($arg)*))\n+    };\n }\n \n /// Prints and returns the value of a given expression for quick and dirty"}, {"sha": "0c96fb593e659311008e39f56ca578e136808795", "filename": "src/test/pretty/dollar-crate.pp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fpretty%2Fdollar-crate.pp", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fpretty%2Fdollar-crate.pp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fdollar-crate.pp?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -9,5 +9,5 @@\n // pp-exact:dollar-crate.pp\n \n fn main() {\n-    { ::std::io::_print(::core::fmt::Arguments::new_v1(&[\"rust\\n\"], &[])); };\n+    ::std::io::_print(::core::fmt::Arguments::new_v1(&[\"rust\\n\"], &[]));\n }"}, {"sha": "c8a0fd684304e4bc18f6f43b26e143faee419ead", "filename": "src/test/ui/macros/trace-macro.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fmacros%2Ftrace-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fmacros%2Ftrace-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Ftrace-macro.stderr?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -5,5 +5,5 @@ LL |     println!(\"Hello, World!\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: expanding `println! { \"Hello, World!\" }`\n-   = note: to `{ $crate :: io :: _print($crate :: format_args_nl! (\"Hello, World!\")) ; }`\n+   = note: to `$crate :: io :: _print($crate :: format_args_nl! (\"Hello, World!\"))`\n "}, {"sha": "ed5e863bd9def1067059b00462a06fed76a8ec73", "filename": "src/test/ui/parser/issues/issue-62894.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62894.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62894.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62894.stderr?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -45,7 +45,7 @@ LL | fn main() {}\n    |\n   ::: $SRC_DIR/core/src/macros/mod.rs:LL:COL\n    |\n-LL |     ($left:expr, $right:expr $(,)?) => ({\n+LL |     ($left:expr, $right:expr $(,)?) => {\n    |      ---------- while parsing argument for this `expr` macro fragment\n \n error: aborting due to 4 previous errors"}, {"sha": "e2a65ff8524040062aefcaad59b284c07e11921a", "filename": "src/test/ui/pattern/usefulness/tuple-struct-nonexhaustive.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fpattern%2Fusefulness%2Ftuple-struct-nonexhaustive.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/af53809c874e0afb7be966df4d3cfcaa05277c53/src%2Ftest%2Fui%2Fpattern%2Fusefulness%2Ftuple-struct-nonexhaustive.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fusefulness%2Ftuple-struct-nonexhaustive.stderr?ref=af53809c874e0afb7be966df4d3cfcaa05277c53", "patch": "@@ -12,7 +12,7 @@ LL | struct Foo(isize, isize);\n    = note: the matched value is of type `Foo`\n help: ensure that all possible cases are being handled by adding a match arm with a wildcard pattern or an explicit pattern as shown\n    |\n-LL ~         Foo(2, b) => println!(\"{}\", b)\n+LL ~         Foo(2, b) => println!(\"{}\", b),\n LL +         Foo(_, _) => todo!()\n    |\n "}]}