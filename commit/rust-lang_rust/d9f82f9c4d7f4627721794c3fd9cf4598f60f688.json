{"sha": "d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "node_id": "C_kwDOAAsO6NoAKGQ5ZjgyZjljNGQ3ZjQ2Mjc3MjE3OTRjM2ZkOWNmNDU5OGY2MGY2ODg", "commit": {"author": {"name": "Caleb Zulawski", "email": "caleb.zulawski@gmail.com", "date": "2021-12-04T05:54:15Z"}, "committer": {"name": "Caleb Zulawski", "email": "caleb.zulawski@gmail.com", "date": "2021-12-04T05:54:15Z"}, "message": "Remove Select trait", "tree": {"sha": "cc946b7804819d4bb1a322cc0f07e386c4d0c4bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc946b7804819d4bb1a322cc0f07e386c4d0c4bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "html_url": "https://github.com/rust-lang/rust/commit/d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d9f82f9c4d7f4627721794c3fd9cf4598f60f688/comments", "author": {"login": "calebzulawski", "id": 563826, "node_id": "MDQ6VXNlcjU2MzgyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/563826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebzulawski", "html_url": "https://github.com/calebzulawski", "followers_url": "https://api.github.com/users/calebzulawski/followers", "following_url": "https://api.github.com/users/calebzulawski/following{/other_user}", "gists_url": "https://api.github.com/users/calebzulawski/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebzulawski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebzulawski/subscriptions", "organizations_url": "https://api.github.com/users/calebzulawski/orgs", "repos_url": "https://api.github.com/users/calebzulawski/repos", "events_url": "https://api.github.com/users/calebzulawski/events{/privacy}", "received_events_url": "https://api.github.com/users/calebzulawski/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebzulawski", "id": 563826, "node_id": "MDQ6VXNlcjU2MzgyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/563826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebzulawski", "html_url": "https://github.com/calebzulawski", "followers_url": "https://api.github.com/users/calebzulawski/followers", "following_url": "https://api.github.com/users/calebzulawski/following{/other_user}", "gists_url": "https://api.github.com/users/calebzulawski/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebzulawski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebzulawski/subscriptions", "organizations_url": "https://api.github.com/users/calebzulawski/orgs", "repos_url": "https://api.github.com/users/calebzulawski/repos", "events_url": "https://api.github.com/users/calebzulawski/events{/privacy}", "received_events_url": "https://api.github.com/users/calebzulawski/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8385522ade6f67853edac730b5bf164ddb298fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8385522ade6f67853edac730b5bf164ddb298fd", "html_url": "https://github.com/rust-lang/rust/commit/a8385522ade6f67853edac730b5bf164ddb298fd"}], "stats": {"total": 75, "additions": 21, "deletions": 54}, "files": [{"sha": "85026265956a2092545c00a1e3ffa24e543aa672", "filename": "crates/core_simd/src/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d9f82f9c4d7f4627721794c3fd9cf4598f60f688/crates%2Fcore_simd%2Fsrc%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9f82f9c4d7f4627721794c3fd9cf4598f60f688/crates%2Fcore_simd%2Fsrc%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fmod.rs?ref=d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "patch": "@@ -27,7 +27,6 @@ pub mod simd {\n \n     pub use crate::core_simd::lane_count::{LaneCount, SupportedLaneCount};\n     pub use crate::core_simd::masks::*;\n-    pub use crate::core_simd::select::Select;\n     pub use crate::core_simd::swizzle::*;\n     pub use crate::core_simd::vector::*;\n }"}, {"sha": "8d521057fbd3ed7a9da2bc540af546f7d2cf9ee2", "filename": "crates/core_simd/src/select.rs", "status": "modified", "additions": 21, "deletions": 53, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/d9f82f9c4d7f4627721794c3fd9cf4598f60f688/crates%2Fcore_simd%2Fsrc%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9f82f9c4d7f4627721794c3fd9cf4598f60f688/crates%2Fcore_simd%2Fsrc%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fselect.rs?ref=d9f82f9c4d7f4627721794c3fd9cf4598f60f688", "patch": "@@ -1,54 +1,6 @@\n use crate::simd::intrinsics;\n use crate::simd::{LaneCount, Mask, MaskElement, Simd, SimdElement, SupportedLaneCount};\n \n-mod sealed {\n-    pub trait Sealed<Mask> {\n-        fn select(mask: Mask, true_values: Self, false_values: Self) -> Self;\n-    }\n-}\n-use sealed::Sealed;\n-\n-/// Supporting trait for vector `select` function\n-pub trait Select<Mask>: Sealed<Mask> {}\n-\n-impl<T, const LANES: usize> Sealed<Mask<T::Mask, LANES>> for Simd<T, LANES>\n-where\n-    T: SimdElement,\n-    LaneCount<LANES>: SupportedLaneCount,\n-{\n-    #[inline]\n-    #[must_use = \"method returns a new vector and does not mutate the original inputs\"]\n-    fn select(mask: Mask<T::Mask, LANES>, true_values: Self, false_values: Self) -> Self {\n-        unsafe { intrinsics::simd_select(mask.to_int(), true_values, false_values) }\n-    }\n-}\n-\n-impl<T, const LANES: usize> Select<Mask<T::Mask, LANES>> for Simd<T, LANES>\n-where\n-    T: SimdElement,\n-    LaneCount<LANES>: SupportedLaneCount,\n-{\n-}\n-\n-impl<T, const LANES: usize> Sealed<Self> for Mask<T, LANES>\n-where\n-    T: MaskElement,\n-    LaneCount<LANES>: SupportedLaneCount,\n-{\n-    #[inline]\n-    #[must_use = \"method returns a new vector and does not mutate the original inputs\"]\n-    fn select(mask: Self, true_values: Self, false_values: Self) -> Self {\n-        mask & true_values | !mask & false_values\n-    }\n-}\n-\n-impl<T, const LANES: usize> Select<Self> for Mask<T, LANES>\n-where\n-    T: MaskElement,\n-    LaneCount<LANES>: SupportedLaneCount,\n-{\n-}\n-\n impl<T, const LANES: usize> Mask<T, LANES>\n where\n     T: MaskElement,\n@@ -69,21 +21,37 @@ where\n     /// let c = mask.select(a, b);\n     /// assert_eq!(c.to_array(), [0, 5, 6, 3]);\n     /// ```\n+    #[inline]\n+    #[must_use = \"method returns a new vector and does not mutate the original inputs\"]\n+    pub fn select<U>(\n+        self,\n+        true_values: Simd<U, LANES>,\n+        false_values: Simd<U, LANES>,\n+    ) -> Simd<U, LANES>\n+    where\n+        U: SimdElement<Mask = T>,\n+    {\n+        unsafe { intrinsics::simd_select(self.to_int(), true_values, false_values) }\n+    }\n+\n+    /// Choose lanes from two masks.\n+    ///\n+    /// For each lane in the mask, choose the corresponding lane from `true_values` if\n+    /// that lane mask is true, and `false_values` if that lane mask is false.\n     ///\n-    /// `select` can also be used on masks:\n     /// ```\n     /// # #![feature(portable_simd)]\n     /// # #[cfg(feature = \"std\")] use core_simd::Mask;\n     /// # #[cfg(not(feature = \"std\"))] use core::simd::Mask;\n     /// let a = Mask::<i32, 4>::from_array([true, true, false, false]);\n     /// let b = Mask::<i32, 4>::from_array([false, false, true, true]);\n     /// let mask = Mask::<i32, 4>::from_array([true, false, false, true]);\n-    /// let c = mask.select(a, b);\n+    /// let c = mask.select_mask(a, b);\n     /// assert_eq!(c.to_array(), [true, false, true, false]);\n     /// ```\n     #[inline]\n-    #[must_use = \"method returns a new vector and does not mutate the original inputs\"]\n-    pub fn select<S: Select<Self>>(self, true_values: S, false_values: S) -> S {\n-        S::select(self, true_values, false_values)\n+    #[must_use = \"method returns a new mask and does not mutate the original inputs\"]\n+    pub fn select_mask(self, true_values: Self, false_values: Self) -> Self {\n+        self & true_values | !self & false_values\n     }\n }"}]}