{"sha": "edd08e020cb1269a0f171e0502d8bc166c78e58b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkZDA4ZTAyMGNiMTI2OWEwZjE3MWUwNTAyZDhiYzE2NmM3OGU1OGI=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-12-06T23:56:19Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-12-21T10:01:24Z"}, "message": "Optimize away a move", "tree": {"sha": "9a9e0d156d3842712bb4830796f6ae40996b4f48", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a9e0d156d3842712bb4830796f6ae40996b4f48"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edd08e020cb1269a0f171e0502d8bc166c78e58b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edd08e020cb1269a0f171e0502d8bc166c78e58b", "html_url": "https://github.com/rust-lang/rust/commit/edd08e020cb1269a0f171e0502d8bc166c78e58b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edd08e020cb1269a0f171e0502d8bc166c78e58b/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d", "html_url": "https://github.com/rust-lang/rust/commit/6d34ec18c7d7e574553f6347ecf08e1e1c45c13d"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "3f90f072ddbdf860498e0e19ac4ccf73f45f6d58", "filename": "src/librustc/ty/query/plumbing.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/edd08e020cb1269a0f171e0502d8bc166c78e58b/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/edd08e020cb1269a0f171e0502d8bc166c78e58b/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs?ref=edd08e020cb1269a0f171e0502d8bc166c78e58b", "patch": "@@ -136,11 +136,14 @@ impl<'a, 'tcx, Q: QueryDescription<'tcx>> JobOwner<'a, 'tcx, Q> {\n                 Entry::Vacant(entry) => {\n                     // No job entry for this query. Return a new one to be started later\n                     return tls::with_related_context(tcx, |icx| {\n+                        // Create the `parent` variable before `info`. This allows LLVM\n+                        // to elide the move of `info`\n+                        let parent = icx.query.clone();\n                         let info = QueryInfo {\n                             span,\n                             query: Q::query(key.clone()),\n                         };\n-                        let job = Lrc::new(QueryJob::new(info, icx.query.clone()));\n+                        let job = Lrc::new(QueryJob::new(info, parent));\n                         let owner = JobOwner {\n                             cache,\n                             job: job.clone(),"}]}