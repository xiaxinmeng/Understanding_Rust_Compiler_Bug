{"sha": "602898a305eb695d48e8f2bee65bb42d6dabf3b3", "node_id": "C_kwDOAAsO6NoAKDYwMjg5OGEzMDVlYjY5NWQ0OGU4ZjJiZWU2NWJiNDJkNmRhYmYzYjM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-12T08:26:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-12T08:26:21Z"}, "message": "Rollup merge of #93595 - compiler-errors:ice-on-lifetime-arg, r=jackh726\n\nfix ICE when parsing lifetime as function argument\n\nI don't really like this, but we basically need to emit an error instead of just delaying an bug, because there are too many places in the AST that aren't covered by my previous PRs...\n\ncc: https://github.com/rust-lang/rust/issues/93282#issuecomment-1028052945", "tree": {"sha": "78df8b42d891f4006bcee21f7e215191ac54261c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/78df8b42d891f4006bcee21f7e215191ac54261c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/602898a305eb695d48e8f2bee65bb42d6dabf3b3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiB28tCRBK7hj4Ov3rIwAA3koIAARKABoMRzl1TYhhm2ttZHOY\njkG8XfOC4H8Ub3t6lLSVBS/yqclDR+CBohOkFXIpSM3lAfHtZuUjPSwGiL81D+XP\n/pkJntGbsfHLQjdl88oinZmuocHhZdgyqOwiamlvjyZFO5m3yx0WzuOygl/rEj1X\nub6a7edfaNYCboc4W6fIj8vyFviGAuTvkNIglor5MDMW9XeJI8XIIF0+HrMXFxBg\ntw+IRAXnPaj8fKTcSImu9doG4/sKPJ0HLuJ31ZZ7GHlJr+a6UsDWtsS3AS2bq5Lm\nLD2BQZswKsw/5B3oMOml1qZWq/GTZWy6fq/LwaLwKKDJmNoMhNoc46bdLAjZ8KU=\n=0HrY\n-----END PGP SIGNATURE-----\n", "payload": "tree 78df8b42d891f4006bcee21f7e215191ac54261c\nparent 661be4c782413576aae48fc4267b91bb1ad39fa0\nparent 5be9e79ae02d9e61542f12c18c1da70aa1d2d5ff\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1644654381 +0100\ncommitter GitHub <noreply@github.com> 1644654381 +0100\n\nRollup merge of #93595 - compiler-errors:ice-on-lifetime-arg, r=jackh726\n\nfix ICE when parsing lifetime as function argument\n\nI don't really like this, but we basically need to emit an error instead of just delaying an bug, because there are too many places in the AST that aren't covered by my previous PRs...\n\ncc: https://github.com/rust-lang/rust/issues/93282#issuecomment-1028052945\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/602898a305eb695d48e8f2bee65bb42d6dabf3b3", "html_url": "https://github.com/rust-lang/rust/commit/602898a305eb695d48e8f2bee65bb42d6dabf3b3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/602898a305eb695d48e8f2bee65bb42d6dabf3b3/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "661be4c782413576aae48fc4267b91bb1ad39fa0", "url": "https://api.github.com/repos/rust-lang/rust/commits/661be4c782413576aae48fc4267b91bb1ad39fa0", "html_url": "https://github.com/rust-lang/rust/commit/661be4c782413576aae48fc4267b91bb1ad39fa0"}, {"sha": "5be9e79ae02d9e61542f12c18c1da70aa1d2d5ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/5be9e79ae02d9e61542f12c18c1da70aa1d2d5ff", "html_url": "https://github.com/rust-lang/rust/commit/5be9e79ae02d9e61542f12c18c1da70aa1d2d5ff"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "e9aa4adcaf79bae5faddf019378d84bf3f8b5e29", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/602898a305eb695d48e8f2bee65bb42d6dabf3b3/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602898a305eb695d48e8f2bee65bb42d6dabf3b3/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=602898a305eb695d48e8f2bee65bb42d6dabf3b3", "patch": "@@ -1457,9 +1457,9 @@ impl<'a> Parser<'a> {\n         } else if self.check(&token::OpenDelim(token::Brace)) || self.token.is_whole_block() {\n             self.parse_block_expr(label, lo, BlockCheckMode::Default, attrs)\n         } else if !ate_colon && (self.check(&TokenKind::Comma) || self.check(&TokenKind::Gt)) {\n-            // We're probably inside of a `Path<'a>` that needs a turbofish, so suppress the\n-            // \"must be followed by a colon\" error, and the \"expected one of\" error.\n-            self.diagnostic().delay_span_bug(lo, \"this label wasn't parsed correctly\");\n+            // We're probably inside of a `Path<'a>` that needs a turbofish\n+            let msg = \"expected `while`, `for`, `loop` or `{` after a label\";\n+            self.struct_span_err(self.token.span, msg).span_label(self.token.span, msg).emit();\n             consume_colon = false;\n             Ok(self.mk_expr_err(lo))\n         } else {"}, {"sha": "261fcb5f9183e9a34b42b74ac1c1ecc95e44c556", "filename": "src/test/ui/parser/issues/issue-93282.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.rs?ref=602898a305eb695d48e8f2bee65bb42d6dabf3b3", "patch": "@@ -1,4 +1,15 @@\n fn main() {\n     f<'a,>\n     //~^ ERROR expected\n+    //~| ERROR expected\n+}\n+\n+fn bar(a: usize, b: usize) -> usize {\n+    a + b\n+}\n+\n+fn foo() {\n+    let x = 1;\n+    bar('y, x);\n+    //~^ ERROR expected\n }"}, {"sha": "900f21a7ccef461ae7465a9c8f3d846439dadd5e", "filename": "src/test/ui/parser/issues/issue-93282.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-93282.stderr?ref=602898a305eb695d48e8f2bee65bb42d6dabf3b3", "patch": "@@ -1,3 +1,9 @@\n+error: expected `while`, `for`, `loop` or `{` after a label\n+  --> $DIR/issue-93282.rs:2:9\n+   |\n+LL |     f<'a,>\n+   |         ^ expected `while`, `for`, `loop` or `{` after a label\n+\n error: expected one of `.`, `:`, `;`, `?`, `for`, `loop`, `while`, `{`, `}`, or an operator, found `,`\n   --> $DIR/issue-93282.rs:2:9\n    |\n@@ -9,5 +15,11 @@ help: use `::<...>` instead of `<...>` to specify lifetime, type, or const argum\n LL |     f::<'a,>\n    |      ++\n \n-error: aborting due to previous error\n+error: expected `while`, `for`, `loop` or `{` after a label\n+  --> $DIR/issue-93282.rs:13:11\n+   |\n+LL |     bar('y, x);\n+   |           ^ expected `while`, `for`, `loop` or `{` after a label\n+\n+error: aborting due to 3 previous errors\n "}, {"sha": "f29fd7a5472d45ce75e870a02b78979c0e94f921", "filename": "src/test/ui/parser/require-parens-for-chained-comparison.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.rs?ref=602898a305eb695d48e8f2bee65bb42d6dabf3b3", "patch": "@@ -22,10 +22,12 @@ fn main() {\n     let _ = f<'_, i8>();\n     //~^ ERROR expected one of\n     //~| HELP use `::<...>` instead of `<...>` to specify lifetime, type, or const arguments\n+    //~| ERROR expected\n \n     f<'_>();\n     //~^ comparison operators cannot be chained\n     //~| HELP use `::<...>` instead of `<...>` to specify lifetime, type, or const arguments\n+    //~| ERROR expected\n \n     let _ = f<u8>;\n     //~^ ERROR comparison operators cannot be chained"}, {"sha": "92d700753dc1b24665bce4e45eb9e056f363e215", "filename": "src/test/ui/parser/require-parens-for-chained-comparison.stderr", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/602898a305eb695d48e8f2bee65bb42d6dabf3b3/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frequire-parens-for-chained-comparison.stderr?ref=602898a305eb695d48e8f2bee65bb42d6dabf3b3", "patch": "@@ -53,6 +53,12 @@ help: use `::<...>` instead of `<...>` to specify lifetime, type, or const argum\n LL |     let _ = f::<u8, i8>();\n    |              ++\n \n+error: expected `while`, `for`, `loop` or `{` after a label\n+  --> $DIR/require-parens-for-chained-comparison.rs:22:17\n+   |\n+LL |     let _ = f<'_, i8>();\n+   |                 ^ expected `while`, `for`, `loop` or `{` after a label\n+\n error: expected one of `.`, `:`, `;`, `?`, `else`, `for`, `loop`, `while`, `{`, or an operator, found `,`\n   --> $DIR/require-parens-for-chained-comparison.rs:22:17\n    |\n@@ -64,8 +70,14 @@ help: use `::<...>` instead of `<...>` to specify lifetime, type, or const argum\n LL |     let _ = f::<'_, i8>();\n    |              ++\n \n+error: expected `while`, `for`, `loop` or `{` after a label\n+  --> $DIR/require-parens-for-chained-comparison.rs:27:9\n+   |\n+LL |     f<'_>();\n+   |         ^ expected `while`, `for`, `loop` or `{` after a label\n+\n error: comparison operators cannot be chained\n-  --> $DIR/require-parens-for-chained-comparison.rs:26:6\n+  --> $DIR/require-parens-for-chained-comparison.rs:27:6\n    |\n LL |     f<'_>();\n    |      ^  ^\n@@ -76,13 +88,13 @@ LL |     f::<'_>();\n    |      ++\n \n error: comparison operators cannot be chained\n-  --> $DIR/require-parens-for-chained-comparison.rs:30:14\n+  --> $DIR/require-parens-for-chained-comparison.rs:32:14\n    |\n LL |     let _ = f<u8>;\n    |              ^  ^\n    |\n    = help: use `::<...>` instead of `<...>` to specify lifetime, type, or const arguments\n    = help: or use `(...)` if you meant to specify fn arguments\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 10 previous errors\n "}]}