{"sha": "2eacc729e245972c3e162f144c0c4ef38c191146", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlYWNjNzI5ZTI0NTk3MmMzZTE2MmYxNDRjMGM0ZWYzOGMxOTExNDY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-02-19T00:05:05Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-02-19T00:07:09Z"}, "message": "Fix staticlib outputs linking to blank archives\n\nWhen creating a staticlib, it unzips all static archives it finds and then\ninserts the files manually into the output file. This process is done through\n`ar`, and `ar` doesn't like if you specify you want to add files and you don't\ngive it any files.\n\nThis case arose whenever you linked to an archive that didn't have any contents\nor all of the contents were filtered out. This just involved ignoring the case\nwhere the number of inputs we have is 0, because we don't have any files to add\nanyway.", "tree": {"sha": "a5c71698b57223d6c832c4f14ab36ab4563297b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a5c71698b57223d6c832c4f14ab36ab4563297b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2eacc729e245972c3e162f144c0c4ef38c191146", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2eacc729e245972c3e162f144c0c4ef38c191146", "html_url": "https://github.com/rust-lang/rust/commit/2eacc729e245972c3e162f144c0c4ef38c191146", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2eacc729e245972c3e162f144c0c4ef38c191146/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "517e38997db9f60612676c9f83dab6ed35c1b5df", "url": "https://api.github.com/repos/rust-lang/rust/commits/517e38997db9f60612676c9f83dab6ed35c1b5df", "html_url": "https://github.com/rust-lang/rust/commit/517e38997db9f60612676c9f83dab6ed35c1b5df"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "406c3026614dc8b84b4a21825a4c3073ec61e4cf", "filename": "src/librustc/back/archive.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Flibrustc%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Flibrustc%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Farchive.rs?ref=2eacc729e245972c3e162f144c0c4ef38c191146", "patch": "@@ -173,6 +173,7 @@ impl Archive {\n             if_ok!(fs::rename(file, &new_filename));\n             inputs.push(new_filename);\n         }\n+        if inputs.len() == 0 { return Ok(()) }\n \n         // Finally, add all the renamed files to this archive\n         let mut args = ~[&self.dst];"}, {"sha": "c56d1212047e86c506703b77bd9cf25c1b172536", "filename": "src/test/run-make/staticlib-blank-lib/Makefile", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2FMakefile?ref=2eacc729e245972c3e162f144c0c4ef38c191146", "patch": "@@ -0,0 +1,6 @@\n+-include ../tools.mk\n+\n+all:\n+\tar crus libfoo.a foo.rs\n+\tar d libfoo.a foo.rs\n+\t$(RUSTC) foo.rs"}, {"sha": "b3d9c006976d0279fdd128a9905db530f3269f5d", "filename": "src/test/run-make/staticlib-blank-lib/foo.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2eacc729e245972c3e162f144c0c4ef38c191146/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstaticlib-blank-lib%2Ffoo.rs?ref=2eacc729e245972c3e162f144c0c4ef38c191146", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_type = \"staticlib\"];\n+\n+#[link(name = \"foo\", kind = \"static\")]\n+extern {}\n+\n+fn main() {}"}]}