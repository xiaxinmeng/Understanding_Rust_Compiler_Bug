{"sha": "d05e28df158d6d98975dc03d39a95aded82896a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwNWUyOGRmMTU4ZDZkOTg5NzVkYzAzZDM5YTk1YWRlZDgyODk2YTU=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-23T18:44:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-23T18:44:05Z"}, "message": "Rollup merge of #84321 - Swatinem:subvariant-details, r=GuillaumeGomez\n\nrustdoc: Convert sub-variant toggle to HTML\n\nInstead of creating a JS toggle, this injects details/summary for\nsub-variants of enums. This also fixes the CSS so that the toggle button\ndoes not jump when expanding/collapsing.\n\nTakes inspiration from #83337 and should be considered part of #83332. Not quite sure if the `.sub-variant` selectors could be further simplified? AFAICS it is only used in that place, and that does not seem to allow any recursion.", "tree": {"sha": "ff85819875c1a7284654324d2f13e894c070f9c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff85819875c1a7284654324d2f13e894c070f9c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d05e28df158d6d98975dc03d39a95aded82896a5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJggxV1CRBK7hj4Ov3rIwAAyp8IAJ7gy7zVIe5zcLnGZVoeXZSS\nZwIACfDI/bd9rnjbgpbWWR9VuxEJG/QbGIvQx99B2VWMvN9cEu9bLsLMlFOmLzQj\ntuqxVbBWA0Wm9SAkaclwJ8WKmKsPKVzFhAoh167+CCmkJijWmZ0TQX1cYCp/8W4V\nJoXb6V9m1LeiDVQawdbYwEWllxWMNWv5E8SnfmyhQ8tRwvRG4hKd+c98Bq+r7FAI\nQESK+sldiLW48AJOSFhJ/CmnP15plE3/mzn7i5EBCDeWyo+szc+aV+ewF3BBmAyr\nnsCoJKvkX4UZOxuoFKo7NHudXJapZozVsMag3CfaaZcwQNFjjsUdwOxuUxVkvME=\n=UW6Z\n-----END PGP SIGNATURE-----\n", "payload": "tree ff85819875c1a7284654324d2f13e894c070f9c1\nparent 5b7c98676f66122705da47f2ef68bbd47e9a9460\nparent 85879fe83d72b46044517d390c98d2b0d942de15\nauthor Yuki Okushi <jtitor@2k36.org> 1619203445 +0900\ncommitter GitHub <noreply@github.com> 1619203445 +0900\n\nRollup merge of #84321 - Swatinem:subvariant-details, r=GuillaumeGomez\n\nrustdoc: Convert sub-variant toggle to HTML\n\nInstead of creating a JS toggle, this injects details/summary for\nsub-variants of enums. This also fixes the CSS so that the toggle button\ndoes not jump when expanding/collapsing.\n\nTakes inspiration from #83337 and should be considered part of #83332. Not quite sure if the `.sub-variant` selectors could be further simplified? AFAICS it is only used in that place, and that does not seem to allow any recursion.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d05e28df158d6d98975dc03d39a95aded82896a5", "html_url": "https://github.com/rust-lang/rust/commit/d05e28df158d6d98975dc03d39a95aded82896a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d05e28df158d6d98975dc03d39a95aded82896a5/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b7c98676f66122705da47f2ef68bbd47e9a9460", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b7c98676f66122705da47f2ef68bbd47e9a9460", "html_url": "https://github.com/rust-lang/rust/commit/5b7c98676f66122705da47f2ef68bbd47e9a9460"}, {"sha": "85879fe83d72b46044517d390c98d2b0d942de15", "url": "https://api.github.com/repos/rust-lang/rust/commits/85879fe83d72b46044517d390c98d2b0d942de15", "html_url": "https://github.com/rust-lang/rust/commit/85879fe83d72b46044517d390c98d2b0d942de15"}], "stats": {"total": 34, "additions": 26, "deletions": 8}, "files": [{"sha": "9d7d8a7cb8aef567d06831a2aebebd84c1b57bf3", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=d05e28df158d6d98975dc03d39a95aded82896a5", "patch": "@@ -963,6 +963,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n \n             use crate::clean::Variant;\n             if let clean::VariantItem(Variant::Struct(ref s)) = *variant.kind {\n+                toggle_open(w, \"fields\");\n                 let variant_id = cx.derive_id(format!(\n                     \"{}.{}.fields\",\n                     ItemType::Variant,\n@@ -996,6 +997,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n                     }\n                 }\n                 w.write_str(\"</div></div>\");\n+                toggle_close(w);\n             }\n             render_stability_since(w, variant, it, cx.tcx());\n         }"}, {"sha": "5dfc206eb2e2dda2f69f1a38513e7d7f649c52bf", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=d05e28df158d6d98975dc03d39a95aded82896a5", "patch": "@@ -455,6 +455,15 @@ function hideThemeButtonState() {\n         handleHashes(ev);\n     }\n \n+    function openParentDetails(elem) {\n+        while (elem) {\n+            if (elem.tagName === \"DETAILS\") {\n+                elem.open = true;\n+            }\n+            elem = elem.parentNode;\n+        }\n+    }\n+\n     function expandSection(id) {\n         var elem = document.getElementById(id);\n         if (elem && isHidden(elem)) {\n@@ -469,6 +478,8 @@ function hideThemeButtonState() {\n                     // The element is not visible, we need to make it appear!\n                     collapseDocs(collapses[0], \"show\");\n                 }\n+                // Open all ancestor <details> to make this element visible.\n+                openParentDetails(h3.parentNode);\n             }\n         }\n     }\n@@ -1009,7 +1020,7 @@ function hideThemeButtonState() {\n             if (hasClass(relatedDoc, \"item-info\")) {\n                 relatedDoc = relatedDoc.nextElementSibling;\n             }\n-            if (hasClass(relatedDoc, \"docblock\") || hasClass(relatedDoc, \"sub-variant\")) {\n+            if (hasClass(relatedDoc, \"docblock\")) {\n                 if (mode === \"toggle\") {\n                     if (hasClass(relatedDoc, \"hidden-by-usual-hider\")) {\n                         action = \"show\";\n@@ -1318,8 +1329,6 @@ function hideThemeButtonState() {\n                 if (hasClass(e, \"type-decl\")) {\n                     // We do something special for these\n                     return;\n-                } else if (hasClass(e, \"sub-variant\")) {\n-                    otherMessage = \"&nbsp;Show&nbsp;fields\";\n                 } else if (hasClass(e, \"non-exhaustive\")) {\n                     otherMessage = \"&nbsp;This&nbsp;\";\n                     if (hasClass(e, \"non-exhaustive-struct\")) {\n@@ -1351,7 +1360,6 @@ function hideThemeButtonState() {\n         }\n \n         onEachLazy(document.getElementsByClassName(\"docblock\"), buildToggleWrapper);\n-        onEachLazy(document.getElementsByClassName(\"sub-variant\"), buildToggleWrapper);\n \n         autoCollapse(getSettingValue(\"collapse\") === \"true\");\n "}, {"sha": "44fb531100ae4dcc04e31b2ed011f52be7059398", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=d05e28df158d6d98975dc03d39a95aded82896a5", "patch": "@@ -1046,10 +1046,11 @@ h3 > .collapse-toggle, h4 > .collapse-toggle {\n }\n \n .sub-variant, .sub-variant > h3 {\n-\tmargin-top: 1px !important;\n+\tmargin-top: 0px !important;\n+\tpadding-top: 1px;\n }\n \n-#main > .sub-variant > h3 {\n+#main > details > .sub-variant > h3 {\n \tfont-size: 15px;\n \tmargin-left: 25px;\n \tmargin-bottom: 5px;"}, {"sha": "eeba3e3f9070df5b75ea8ff101f5fd106c64c4be", "filename": "src/test/rustdoc-gui/lib.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Ftest%2Frustdoc-gui%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Ftest%2Frustdoc-gui%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Flib.rs?ref=d05e28df158d6d98975dc03d39a95aded82896a5", "patch": "@@ -29,7 +29,9 @@ pub struct Foo;\n \n impl Foo {\n     #[must_use]\n-    pub fn must_use(&self) -> bool { true }\n+    pub fn must_use(&self) -> bool {\n+        true\n+    }\n }\n \n /// Just a normal enum.\n@@ -85,3 +87,7 @@ pub trait AnotherOne {\n /// let x = 12;\n /// ```\n pub fn check_list_code_block() {}\n+\n+pub enum AnEnum {\n+    WithVariants { and: usize, sub: usize, variants: usize },\n+}"}, {"sha": "8986f72636a40bfd594e53e0e4d15e816b631bf6", "filename": "src/test/rustdoc/item-hide-threshold.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d05e28df158d6d98975dc03d39a95aded82896a5/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fitem-hide-threshold.rs?ref=d05e28df158d6d98975dc03d39a95aded82896a5", "patch": "@@ -62,7 +62,8 @@ pub struct PrivStruct {\n }\n \n // @has 'item_hide_threshold/enum.Enum.html'\n-// @count - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 0\n+// @count - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 1\n+// @has - '//details[@class=\"rustdoc-toggle type-contents-toggle\"]' 'Show fields'\n pub enum Enum {\n     A, B, C,\n     D {"}]}