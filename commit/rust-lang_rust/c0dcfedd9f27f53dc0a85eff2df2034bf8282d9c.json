{"sha": "c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwZGNmZWRkOWYyN2Y1M2RjMGE4NWVmZjJkZjIwMzRiZjgyODJkOWM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-03-13T02:33:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-03-13T02:33:46Z"}, "message": "Rollup merge of #59083 - kyren:master, r=varkor\n\nFix #54822 and associated faulty tests\n\nType checking associated constants can require trait bounds, but an empty\nparameter environment was provided to the trait solver.  Providing an\nappropriate parameter environment seems to fix #54822 and also make one of the\ncases in src/test/ui/nll/trait-associated-constant.rs that should compile\nsuccessfully do so.  It also (slightly) improves the error message in\nsrc/test/ui/associated-const/associated-const-generic-obligations.rs", "tree": {"sha": "2e4eeea86bd8d75bfb10f052451b9ab6c0d861d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e4eeea86bd8d75bfb10f052451b9ab6c0d861d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJciGwKCRBK7hj4Ov3rIwAAdHIIAHXa1YngfHTV0jYlQhdk3+l1\nxE6hyg8iwHHg2F+9PR+xr/864m23ke3Tbn+G3Vf2+2h9DwGVQBZHT+RNkXe95B7a\ncuOHRgxP4EsyUo/bx7dYR36hle+3cM8iRgFDoOVCNDZwDItrzR5VbxWL35LeQ6q/\nm6EXo2iX1Kdd4K8TrVXaKqetCQ2vlRdRUan0w9RJw4IAetxyh47ZEvmVMMPz5XIm\nbZiz9P8SuBSdqzp33GI1s8jro8UBtpYzyK4q1tcQuqn1lQpZjg5Ly1ViZVGdkhoP\nw3FWpEOOvP43Au+/55HBCeT3Mll8MoDZrRwIk5lbP0RfaYFpH1RqDzpc2TfJPA8=\n=iStm\n-----END PGP SIGNATURE-----\n", "payload": "tree 2e4eeea86bd8d75bfb10f052451b9ab6c0d861d1\nparent 13a894288f5735e58f60da40a8225f3eb4357f95\nparent aa9bd68fa8134e55ded5e65abef745f96ba0e622\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1552444426 +0100\ncommitter GitHub <noreply@github.com> 1552444426 +0100\n\nRollup merge of #59083 - kyren:master, r=varkor\n\nFix #54822 and associated faulty tests\n\nType checking associated constants can require trait bounds, but an empty\nparameter environment was provided to the trait solver.  Providing an\nappropriate parameter environment seems to fix #54822 and also make one of the\ncases in src/test/ui/nll/trait-associated-constant.rs that should compile\nsuccessfully do so.  It also (slightly) improves the error message in\nsrc/test/ui/associated-const/associated-const-generic-obligations.rs\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "html_url": "https://github.com/rust-lang/rust/commit/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13a894288f5735e58f60da40a8225f3eb4357f95", "url": "https://api.github.com/repos/rust-lang/rust/commits/13a894288f5735e58f60da40a8225f3eb4357f95", "html_url": "https://github.com/rust-lang/rust/commit/13a894288f5735e58f60da40a8225f3eb4357f95"}, {"sha": "aa9bd68fa8134e55ded5e65abef745f96ba0e622", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa9bd68fa8134e55ded5e65abef745f96ba0e622", "html_url": "https://github.com/rust-lang/rust/commit/aa9bd68fa8134e55ded5e65abef745f96ba0e622"}], "stats": {"total": 77, "additions": 41, "deletions": 36}, "files": [{"sha": "f79bf4e999d5492dc158cca4a8ae47f29fa7a441", "filename": "src/librustc_typeck/check/compare_method.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -917,7 +917,7 @@ pub fn compare_const_impl<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     debug!(\"compare_const_impl(impl_trait_ref={:?})\", impl_trait_ref);\n \n     tcx.infer_ctxt().enter(|infcx| {\n-        let param_env = ty::ParamEnv::empty();\n+        let param_env = tcx.param_env(impl_c.def_id);\n         let inh = Inherited::new(infcx, impl_c.def_id);\n         let infcx = &inh.infcx;\n "}, {"sha": "498e315b5c83cf4cef698f15596353ee8612eed8", "filename": "src/test/ui/associated-const/associated-const-generic-obligations.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.rs?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -12,7 +12,7 @@ trait Bar: Foo {\n \n impl<T: Foo> Bar for T {\n     const FROM: &'static str = \"foo\";\n-    //~^ ERROR the trait bound `T: Foo` is not satisfied [E0277]\n+    //~^ ERROR implemented const `FROM` has an incompatible type for trait [E0326]\n }\n \n fn main() {}"}, {"sha": "eeee26a75671f062f261caad1ad139a4038c98a8", "filename": "src/test/ui/associated-const/associated-const-generic-obligations.stderr", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-generic-obligations.stderr?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -1,11 +1,15 @@\n-error[E0277]: the trait bound `T: Foo` is not satisfied\n-  --> $DIR/associated-const-generic-obligations.rs:14:5\n+error[E0326]: implemented const `FROM` has an incompatible type for trait\n+  --> $DIR/associated-const-generic-obligations.rs:14:17\n    |\n+LL |     const FROM: Self::Out;\n+   |                 --------- type in trait\n+...\n LL |     const FROM: &'static str = \"foo\";\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Foo` is not implemented for `T`\n+   |                 ^^^^^^^^^^^^ expected associated type, found reference\n    |\n-   = help: consider adding a `where T: Foo` bound\n+   = note: expected type `<T as Foo>::Out`\n+              found type `&'static str`\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0277`.\n+For more information about this error, try `rustc --explain E0326`."}, {"sha": "0ce46d312afef865384080ab5011269b954719a9", "filename": "src/test/ui/associated-const/associated-const-trait-bound.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-trait-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-trait-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-const%2Fassociated-const-trait-bound.rs?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -0,0 +1,21 @@\n+// compile-pass\n+\n+trait ConstDefault {\n+    const DEFAULT: Self;\n+}\n+\n+trait Foo: Sized {}\n+\n+trait FooExt: Foo {\n+    type T: ConstDefault;\n+}\n+\n+trait Bar<F: FooExt> {\n+    const T: F::T;\n+}\n+\n+impl<F: FooExt> Bar<F> for () {\n+    const T: F::T = <F::T as ConstDefault>::DEFAULT;\n+}\n+\n+fn main() {}"}, {"sha": "31dc58185e90ab0bb38d941c68c74915e785438d", "filename": "src/test/ui/nll/trait-associated-constant.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -9,24 +9,23 @@ trait Anything<'a: 'b, 'b> {\n     const AC: Option<&'b str>;\n }\n \n-struct OKStruct { }\n+struct OKStruct1 { }\n \n-impl<'a: 'b, 'b> Anything<'a, 'b> for OKStruct {\n+impl<'a: 'b, 'b> Anything<'a, 'b> for OKStruct1 {\n     const AC: Option<&'b str> = None;\n }\n \n-struct FailStruct1 { }\n+struct FailStruct { }\n \n-impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct1 {\n+impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct {\n     const AC: Option<&'c str> = None;\n     //~^ ERROR: mismatched types\n }\n \n-struct FailStruct2 { }\n+struct OKStruct2 { }\n \n-impl<'a: 'b, 'b> Anything<'a, 'b> for FailStruct2 {\n+impl<'a: 'b, 'b> Anything<'a, 'b> for OKStruct2 {\n     const AC: Option<&'a str> = None;\n-    //~^ ERROR: mismatched types\n }\n \n fn main() {}"}, {"sha": "f39f668e2329a5c61ad69b7eb5008321335e29a9", "filename": "src/test/ui/nll/trait-associated-constant.stderr", "status": "modified", "additions": 3, "deletions": 22, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr?ref=c0dcfedd9f27f53dc0a85eff2df2034bf8282d9c", "patch": "@@ -9,33 +9,14 @@ LL |     const AC: Option<&'c str> = None;\n note: the lifetime 'c as defined on the impl at 20:18...\n   --> $DIR/trait-associated-constant.rs:20:18\n    |\n-LL | impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct1 {\n+LL | impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct {\n    |                  ^^\n note: ...does not necessarily outlive the lifetime 'b as defined on the impl at 20:14\n   --> $DIR/trait-associated-constant.rs:20:14\n    |\n-LL | impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct1 {\n+LL | impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct {\n    |              ^^\n \n-error[E0308]: mismatched types\n-  --> $DIR/trait-associated-constant.rs:28:5\n-   |\n-LL |     const AC: Option<&'a str> = None;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ lifetime mismatch\n-   |\n-   = note: expected type `std::option::Option<&'b str>`\n-              found type `std::option::Option<&'a str>`\n-note: the lifetime 'a as defined on the impl at 27:6...\n-  --> $DIR/trait-associated-constant.rs:27:6\n-   |\n-LL | impl<'a: 'b, 'b> Anything<'a, 'b> for FailStruct2 {\n-   |      ^^\n-note: ...does not necessarily outlive the lifetime 'b as defined on the impl at 27:14\n-  --> $DIR/trait-associated-constant.rs:27:14\n-   |\n-LL | impl<'a: 'b, 'b> Anything<'a, 'b> for FailStruct2 {\n-   |              ^^\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0308`."}]}