{"sha": "f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "node_id": "C_kwDOAAsO6NoAKGYxYTM0OTQ1N2ZlN2MwNjRjZDYzZDE0YzIwYmM1ZDk1MTlkMjBkYzY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-02-13T22:25:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-13T22:25:15Z"}, "message": "Rollup merge of #108013 - notriddle:notriddle/search-index-itemtype, r=GuillaumeGomez\n\nrustdoc: use a string with one-character codes for search index types\n\n    $ wc -c search-index.old.js search-index.new.js\n    3940530 search-index.old.js\n    3843222 search-index.new.js\n\n((3940530-3843222)/3940530)*100 = 2.47%\n\n    $ wc -c search-index.old.js.gz search-index.new.js.gz\n    380251 search-index.old.js.gz\n    379434 search-index.new.js.gz\n\n((380251-379434)/380251)*100 = 0.214%", "tree": {"sha": "32783c1751d563fac2ee7efab3e104a7fa991bd0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32783c1751d563fac2ee7efab3e104a7fa991bd0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj6rjLCRBK7hj4Ov3rIwAAB4IIADVZ5WZvLk6CRvDp+Fddfwo+\nOUVApO96yHHQp/7PAvnc6Mh2+UHrdJBwaFl+w+IGEXHRb70KiRGBnHk0rFK82hZP\n4e28+CEp08soS4CVP476M2knK+GymP84khqXn3PwNX3cHapb+kveTrYeWNVvqZbx\nMfHiCqvYpF88iZ5BR9oULbgimhyjHPyhPHwBiTeHk0OU37ZgDq24X6kZ5xtOBsPJ\ncCfQD23spTlV/LaJiF8wG1owKD/OYDkIUgyXIywyeoUU6wz/Zs7tc2Rfsi/NqcpK\n6QvyGGU9xdm0HbOMKWcYOJyhjjnIqZF6VK7CiPt2AsB5z0N9cqPOFIRUTSiuvnA=\n=GUir\n-----END PGP SIGNATURE-----\n", "payload": "tree 32783c1751d563fac2ee7efab3e104a7fa991bd0\nparent 9bf807e7a10ad327063eee4c547d83caf365de11\nparent a7b69ddea93f63a1e44e4c9ac8e7df264654498b\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1676327115 +0100\ncommitter GitHub <noreply@github.com> 1676327115 +0100\n\nRollup merge of #108013 - notriddle:notriddle/search-index-itemtype, r=GuillaumeGomez\n\nrustdoc: use a string with one-character codes for search index types\n\n    $ wc -c search-index.old.js search-index.new.js\n    3940530 search-index.old.js\n    3843222 search-index.new.js\n\n((3940530-3843222)/3940530)*100 = 2.47%\n\n    $ wc -c search-index.old.js.gz search-index.new.js.gz\n    380251 search-index.old.js.gz\n    379434 search-index.new.js.gz\n\n((380251-379434)/380251)*100 = 0.214%\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "html_url": "https://github.com/rust-lang/rust/commit/f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9bf807e7a10ad327063eee4c547d83caf365de11", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bf807e7a10ad327063eee4c547d83caf365de11", "html_url": "https://github.com/rust-lang/rust/commit/9bf807e7a10ad327063eee4c547d83caf365de11"}, {"sha": "a7b69ddea93f63a1e44e4c9ac8e7df264654498b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a7b69ddea93f63a1e44e4c9ac8e7df264654498b", "html_url": "https://github.com/rust-lang/rust/commit/a7b69ddea93f63a1e44e4c9ac8e7df264654498b"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "aafedc17499a7bb1a1769d2bbe321d1f4fd17f74", "filename": "src/librustdoc/formats/item_type.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fformats%2Fitem_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Fitem_type.rs?ref=f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "patch": "@@ -21,6 +21,7 @@ use crate::clean;\n /// a heading, edit the listing in `html/render.rs`, function `sidebar_module`. This uses an\n /// ordering based on a helper function inside `item_module`, in the same file.\n #[derive(Copy, PartialEq, Eq, Hash, Clone, Debug, PartialOrd, Ord)]\n+#[repr(u8)]\n pub(crate) enum ItemType {\n     Module = 0,\n     ExternCrate = 1,"}, {"sha": "090ea2cb15763ac0446cb8407ef357e7c7258d18", "filename": "src/librustdoc/html/render/search_index.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs?ref=f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "patch": "@@ -236,7 +236,16 @@ pub(crate) fn build_index<'tcx>(\n             crate_data.serialize_field(\"doc\", &self.doc)?;\n             crate_data.serialize_field(\n                 \"t\",\n-                &self.items.iter().map(|item| &item.ty).collect::<Vec<_>>(),\n+                &self\n+                    .items\n+                    .iter()\n+                    .map(|item| {\n+                        let n = item.ty as u8;\n+                        let c = char::try_from(n + b'A').expect(\"item types must fit in ASCII\");\n+                        assert!(c <= 'z', \"item types must fit within ASCII printables\");\n+                        c\n+                    })\n+                    .collect::<String>(),\n             )?;\n             crate_data.serialize_field(\n                 \"n\","}, {"sha": "1e6c94d29ba47dd0e32206573444fc6d599a80e6", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/f1a349457fe7c064cd63d14c20bc5d9519d20dc6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=f1a349457fe7c064cd63d14c20bc5d9519d20dc6", "patch": "@@ -1939,6 +1939,7 @@ function initSearch(rawSearchIndex) {\n          * @type {Array<string>}\n          */\n         const searchWords = [];\n+        const charA = \"A\".charCodeAt(0);\n         let i, word;\n         let currentIndex = 0;\n         let id = 0;\n@@ -1953,7 +1954,7 @@ function initSearch(rawSearchIndex) {\n             /**\n              * The raw search data for a given crate. `n`, `t`, `d`, and `q`, `i`, and `f`\n              * are arrays with the same length. n[i] contains the name of an item.\n-             * t[i] contains the type of that item (as a small integer that represents an\n+             * t[i] contains the type of that item (as a string of characters that represent an\n              * offset in `itemTypes`). d[i] contains the description of that item.\n              *\n              * q[i] contains the full path of the item, or an empty string indicating\n@@ -1980,7 +1981,7 @@ function initSearch(rawSearchIndex) {\n              *   doc: string,\n              *   a: Object,\n              *   n: Array<string>,\n-             *   t: Array<Number>,\n+             *   t: String,\n              *   d: Array<string>,\n              *   q: Array<string>,\n              *   i: Array<Number>,\n@@ -2009,7 +2010,7 @@ function initSearch(rawSearchIndex) {\n             searchIndex.push(crateRow);\n             currentIndex += 1;\n \n-            // an array of (Number) item types\n+            // a String of one character item type codes\n             const itemTypes = crateCorpus.t;\n             // an array of (String) item names\n             const itemNames = crateCorpus.n;\n@@ -2060,7 +2061,7 @@ function initSearch(rawSearchIndex) {\n                 }\n                 const row = {\n                     crate: crate,\n-                    ty: itemTypes[i],\n+                    ty: itemTypes.charCodeAt(i) - charA,\n                     name: itemNames[i],\n                     path: itemPaths[i] ? itemPaths[i] : lastPath,\n                     desc: itemDescs[i],"}]}