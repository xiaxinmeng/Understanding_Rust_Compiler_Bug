{"sha": "9708ef03a6c9d52daf424c933428ccdfc4e29a56", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3MDhlZjAzYTZjOWQ1MmRhZjQyNGM5MzM0MjhjY2RmYzRlMjlhNTY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-28T14:25:42Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-28T14:25:42Z"}, "message": "auto merge of #8806 : klutzy/rust/winmain, r=cmr\n\nFixes #8510.", "tree": {"sha": "dc7f798453c0d72c03b8ed1598d0334d01c329b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc7f798453c0d72c03b8ed1598d0334d01c329b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9708ef03a6c9d52daf424c933428ccdfc4e29a56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9708ef03a6c9d52daf424c933428ccdfc4e29a56", "html_url": "https://github.com/rust-lang/rust/commit/9708ef03a6c9d52daf424c933428ccdfc4e29a56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9708ef03a6c9d52daf424c933428ccdfc4e29a56/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9bfdd42703603f04681369b52ef81123ef101f5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bfdd42703603f04681369b52ef81123ef101f5f", "html_url": "https://github.com/rust-lang/rust/commit/9bfdd42703603f04681369b52ef81123ef101f5f"}, {"sha": "eaa565829db10ad5926f6fe19881010119c54162", "url": "https://api.github.com/repos/rust-lang/rust/commits/eaa565829db10ad5926f6fe19881010119c54162", "html_url": "https://github.com/rust-lang/rust/commit/eaa565829db10ad5926f6fe19881010119c54162"}], "stats": {"total": 16, "additions": 4, "deletions": 12}, "files": [{"sha": "e8186477877f423e019be698ce7719047c721add", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9708ef03a6c9d52daf424c933428ccdfc4e29a56/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9708ef03a6c9d52daf424c933428ccdfc4e29a56/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=9708ef03a6c9d52daf424c933428ccdfc4e29a56", "patch": "@@ -2366,20 +2366,12 @@ pub fn create_entry_wrapper(ccx: @mut CrateContext,\n                                &ccx.int_type);\n \n         // FIXME #4404 android JNI hacks\n-        let llfn = if *ccx.sess.building_library {\n-            decl_cdecl_fn(ccx.llmod, \"amain\", llfty)\n+        let main_name = if *ccx.sess.building_library {\n+            \"amain\"\n         } else {\n-            let main_name = match ccx.sess.targ_cfg.os {\n-                session::os_win32 => {\n-                    match ccx.sess.targ_cfg.arch {\n-                        X86 => ~\"WinMain@16\",\n-                        _ => ~\"WinMain\",\n-                    }\n-                },\n-                _ => ~\"main\",\n-            };\n-            decl_cdecl_fn(ccx.llmod, main_name, llfty)\n+            \"main\"\n         };\n+        let llfn = decl_cdecl_fn(ccx.llmod, main_name, llfty);\n         let llbb = do \"top\".with_c_str |buf| {\n             unsafe {\n                 llvm::LLVMAppendBasicBlockInContext(ccx.llcx, llfn, buf)"}]}