{"sha": "3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "node_id": "C_kwDOAAsO6NoAKDNjNzk0N2VlNDNiMTRmMTI0YjQxZjVkZTdjMjQ3ZGM4ZTQ3YTE4ZmE", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-01-18T19:37:14Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-03-03T17:50:26Z"}, "message": "Gate stability attrs with other attributes.", "tree": {"sha": "8a525aa066f1fee7113e6f111b0da55f9414e36e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a525aa066f1fee7113e6f111b0da55f9414e36e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "html_url": "https://github.com/rust-lang/rust/commit/3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "969f8735dc97a142c70768fde65937dafa6f4c0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/969f8735dc97a142c70768fde65937dafa6f4c0e", "html_url": "https://github.com/rust-lang/rust/commit/969f8735dc97a142c70768fde65937dafa6f4c0e"}], "stats": {"total": 372, "additions": 209, "deletions": 163}, "files": [{"sha": "570ec45557dea7ad1c1e599427978e6e5471fb28", "filename": "compiler/rustc_ast_passes/src/feature_gate.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -420,6 +420,31 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 }\n             }\n         }\n+\n+        // Emit errors for non-staged-api crates.\n+        if !self.features.staged_api {\n+            if attr.has_name(sym::rustc_deprecated)\n+                || attr.has_name(sym::unstable)\n+                || attr.has_name(sym::stable)\n+                || attr.has_name(sym::rustc_const_unstable)\n+                || attr.has_name(sym::rustc_const_stable)\n+            {\n+                struct_span_err!(\n+                    self.sess,\n+                    attr.span,\n+                    E0734,\n+                    \"stability attributes may not be used outside of the standard library\",\n+                )\n+                .emit();\n+            }\n+        } else {\n+            if attr.has_name(sym::deprecated) {\n+                self.sess\n+                    .struct_span_err(attr.span, \"`#[deprecated]` cannot be used in staged API\")\n+                    .span_label(attr.span, \"use `#[rustc_deprecated]` instead\")\n+                    .emit();\n+            }\n+        }\n     }\n \n     fn visit_item(&mut self, i: &'a ast::Item) {"}, {"sha": "bf108f220e0077103af60ff4bd1fa299c8abdc90", "filename": "compiler/rustc_passes/src/stability.rs", "status": "modified", "additions": 9, "deletions": 56, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fstability.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,7 +1,6 @@\n //! A pass that annotates every item and method with its stability level,\n //! propagating default levels lexically from parent to children ast nodes.\n \n-use rustc_ast::Attribute;\n use rustc_attr::{self as attr, ConstStability, Stability};\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n use rustc_errors::struct_span_err;\n@@ -113,12 +112,8 @@ impl<'a, 'tcx> Annotator<'a, 'tcx> {\n     {\n         let attrs = self.tcx.get_attrs(def_id.to_def_id());\n         debug!(\"annotate(id = {:?}, attrs = {:?})\", def_id, attrs);\n-        let mut did_error = false;\n-        if !self.tcx.features().staged_api {\n-            did_error = self.forbid_staged_api_attrs(def_id, attrs, inherit_deprecation.clone());\n-        }\n \n-        let depr = if did_error { None } else { attr::find_deprecation(&self.tcx.sess, attrs) };\n+        let depr = attr::find_deprecation(&self.tcx.sess, attrs);\n         let mut is_deprecated = false;\n         if let Some((depr, span)) = &depr {\n             is_deprecated = true;\n@@ -148,16 +143,15 @@ impl<'a, 'tcx> Annotator<'a, 'tcx> {\n             }\n         }\n \n-        if self.tcx.features().staged_api {\n-            if let Some(a) = attrs.iter().find(|a| a.has_name(sym::deprecated)) {\n-                self.tcx\n-                    .sess\n-                    .struct_span_err(a.span, \"`#[deprecated]` cannot be used in staged API\")\n-                    .span_label(a.span, \"use `#[rustc_deprecated]` instead\")\n-                    .span_label(item_sp, \"\")\n-                    .emit();\n+        if !self.tcx.features().staged_api {\n+            // Propagate unstability.  This can happen even for non-staged-api crates in case\n+            // -Zforce-unstable-if-unmarked is set.\n+            if let Some(stab) = self.parent_stab {\n+                if inherit_deprecation.yes() && stab.level.is_unstable() {\n+                    self.index.stab_map.insert(def_id, stab);\n+                }\n             }\n-        } else {\n+\n             self.recurse_with_stability_attrs(\n                 depr.map(|(d, _)| DeprecationEntry::local(d, def_id)),\n                 None,\n@@ -329,47 +323,6 @@ impl<'a, 'tcx> Annotator<'a, 'tcx> {\n             self.parent_const_stab = orig_parent_const_stab;\n         }\n     }\n-\n-    // returns true if an error occurred, used to suppress some spurious errors\n-    fn forbid_staged_api_attrs(\n-        &mut self,\n-        def_id: LocalDefId,\n-        attrs: &[Attribute],\n-        inherit_deprecation: InheritDeprecation,\n-    ) -> bool {\n-        // Emit errors for non-staged-api crates.\n-        let unstable_attrs = [\n-            sym::unstable,\n-            sym::stable,\n-            sym::rustc_deprecated,\n-            sym::rustc_const_unstable,\n-            sym::rustc_const_stable,\n-        ];\n-        let mut has_error = false;\n-        for attr in attrs {\n-            let name = attr.name_or_empty();\n-            if unstable_attrs.contains(&name) {\n-                struct_span_err!(\n-                    self.tcx.sess,\n-                    attr.span,\n-                    E0734,\n-                    \"stability attributes may not be used outside of the standard library\",\n-                )\n-                .emit();\n-                has_error = true;\n-            }\n-        }\n-\n-        // Propagate unstability.  This can happen even for non-staged-api crates in case\n-        // -Zforce-unstable-if-unmarked is set.\n-        if let Some(stab) = self.parent_stab {\n-            if inherit_deprecation.yes() && stab.level.is_unstable() {\n-                self.index.stab_map.insert(def_id, stab);\n-            }\n-        }\n-\n-        has_error\n-    }\n }\n \n impl<'a, 'tcx> Visitor<'tcx> for Annotator<'a, 'tcx> {"}, {"sha": "5c14f5ed356f321d54f21846801b1333a3c77a4d", "filename": "src/test/ui/deprecation/deprecation-in-staged-api.stderr", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-staged-api.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-staged-api.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-in-staged-api.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -3,8 +3,6 @@ error: `#[deprecated]` cannot be used in staged API\n    |\n LL | #[deprecated]\n    | ^^^^^^^^^^^^^ use `#[rustc_deprecated]` instead\n-LL | fn main() {}\n-   | ------------\n \n error: aborting due to previous error\n "}, {"sha": "951bb5a17400f16068edea5e514bbd395bc51154", "filename": "src/test/ui/feature-gates/feature-gate-staged_api.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-staged_api.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-staged_api.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-staged_api.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,15 +1,15 @@\n-error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/feature-gate-staged_api.rs:1:1\n-   |\n-LL | #![stable(feature = \"a\", since = \"b\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error[E0734]: stability attributes may not be used outside of the standard library\n   --> $DIR/feature-gate-staged_api.rs:8:1\n    |\n LL | #[stable(feature = \"a\", since = \"b\")]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n+error[E0734]: stability attributes may not be used outside of the standard library\n+  --> $DIR/feature-gate-staged_api.rs:1:1\n+   |\n+LL | #![stable(feature = \"a\", since = \"b\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0734`."}, {"sha": "3acfbd0ca23aedd6b89356c27a504d4b800e8953", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-rustc_deprecated.rs", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -6,25 +6,38 @@\n \n #![rustc_deprecated()]\n //~^ ERROR stability attributes may not be used outside of the standard library\n+//~| ERROR missing 'since' [E0542]\n \n #[rustc_deprecated()]\n //~^ ERROR stability attributes may not be used outside of the standard library\n+//~| ERROR missing 'since' [E0542]\n mod rustc_deprecated {\n-    mod inner { #![rustc_deprecated()] }\n-    //~^ ERROR stability attributes may not be used outside of the standard library\n+    mod inner {\n+        #![rustc_deprecated()]\n+        //~^ ERROR stability attributes may not be used outside of the standard library\n+        //~| ERROR missing 'since' [E0542]\n+    }\n \n-    #[rustc_deprecated()] fn f() { }\n+    #[rustc_deprecated()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    //~| ERROR missing 'since' [E0542]\n+    fn f() {}\n \n-    #[rustc_deprecated()] struct S;\n+    #[rustc_deprecated()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n-    //~| ERROR stability attributes may not be used outside of the standard library\n+    //~| ERROR missing 'since' [E0542]\n+    //~| ERROR missing 'since' [E0542]\n+    struct S;\n \n-    #[rustc_deprecated()] type T = S;\n+    #[rustc_deprecated()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    //~| ERROR missing 'since' [E0542]\n+    type T = S;\n \n-    #[rustc_deprecated()] impl S { }\n+    #[rustc_deprecated()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    //~| ERROR missing 'since' [E0542]\n+    impl S {}\n }\n \n fn main() {}"}, {"sha": "4ec78f318c2338fd6d19de21e2e3e59f5001dd7b", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-rustc_deprecated.stderr", "status": "modified", "additions": 65, "deletions": 22, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-rustc_deprecated.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,51 +1,94 @@\n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:7:1\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:16:9\n    |\n-LL | #![rustc_deprecated()]\n-   | ^^^^^^^^^^^^^^^^^^^^^^\n+LL |         #![rustc_deprecated()]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:10:1\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:21:5\n    |\n-LL | #[rustc_deprecated()]\n-   | ^^^^^^^^^^^^^^^^^^^^^\n+LL |     #[rustc_deprecated()]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:13:17\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:26:5\n    |\n-LL |     mod inner { #![rustc_deprecated()] }\n-   |                 ^^^^^^^^^^^^^^^^^^^^^^\n+LL |     #[rustc_deprecated()]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:16:5\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:32:5\n    |\n-LL |     #[rustc_deprecated()] fn f() { }\n+LL |     #[rustc_deprecated()]\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:19:5\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:37:5\n    |\n-LL |     #[rustc_deprecated()] struct S;\n+LL |     #[rustc_deprecated()]\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:19:5\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:11:1\n    |\n-LL |     #[rustc_deprecated()] struct S;\n-   |     ^^^^^^^^^^^^^^^^^^^^^\n+LL | #[rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:23:5\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:7:1\n+   |\n+LL | #![rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:7:1\n+   |\n+LL | #![rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:11:1\n+   |\n+LL | #[rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:16:9\n+   |\n+LL |         #![rustc_deprecated()]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:21:5\n    |\n-LL |     #[rustc_deprecated()] type T = S;\n+LL |     #[rustc_deprecated()]\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n-error[E0734]: stability attributes may not be used outside of the standard library\n+error[E0542]: missing 'since'\n   --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:26:5\n    |\n-LL |     #[rustc_deprecated()] impl S { }\n+LL |     #[rustc_deprecated()]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:26:5\n+   |\n+LL |     #[rustc_deprecated()]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:32:5\n+   |\n+LL |     #[rustc_deprecated()]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0542]: missing 'since'\n+  --> $DIR/issue-43106-gating-of-rustc_deprecated.rs:37:5\n+   |\n+LL |     #[rustc_deprecated()]\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 15 previous errors\n \n-For more information about this error, try `rustc --explain E0734`.\n+Some errors have detailed explanations: E0542, E0734.\n+For more information about an error, try `rustc --explain E0542`."}, {"sha": "621ec01bbe219c24d112f2151e4bb3d91403701a", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-stable.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -10,21 +10,26 @@\n #[stable()]\n //~^ ERROR stability attributes may not be used outside of the standard library\n mod stable {\n-    mod inner { #![stable()] }\n-    //~^ ERROR stability attributes may not be used outside of the standard library\n+    mod inner {\n+        #![stable()]\n+        //~^ ERROR stability attributes may not be used outside of the standard library\n+    }\n \n-    #[stable()] fn f() { }\n+    #[stable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    fn f() {}\n \n-    #[stable()] struct S;\n+    #[stable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n-    //~| ERROR stability attributes may not be used outside of the standard library\n+    struct S;\n \n-    #[stable()] type T = S;\n+    #[stable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    type T = S;\n \n-    #[stable()] impl S { }\n+    #[stable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    impl S {}\n }\n \n fn main() {}"}, {"sha": "677fef3a926b58552d7f769ffdfc3834bc3f99fc", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-stable.stderr", "status": "modified", "additions": 19, "deletions": 25, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-stable.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,51 +1,45 @@\n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:7:1\n-   |\n-LL | #![stable()]\n-   | ^^^^^^^^^^^^\n-\n-error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:10:1\n+  --> $DIR/issue-43106-gating-of-stable.rs:14:9\n    |\n-LL | #[stable()]\n-   | ^^^^^^^^^^^\n+LL |         #![stable()]\n+   |         ^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:13:17\n+  --> $DIR/issue-43106-gating-of-stable.rs:18:5\n    |\n-LL |     mod inner { #![stable()] }\n-   |                 ^^^^^^^^^^^^\n+LL |     #[stable()]\n+   |     ^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:16:5\n+  --> $DIR/issue-43106-gating-of-stable.rs:22:5\n    |\n-LL |     #[stable()] fn f() { }\n+LL |     #[stable()]\n    |     ^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:19:5\n+  --> $DIR/issue-43106-gating-of-stable.rs:26:5\n    |\n-LL |     #[stable()] struct S;\n+LL |     #[stable()]\n    |     ^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:19:5\n+  --> $DIR/issue-43106-gating-of-stable.rs:30:5\n    |\n-LL |     #[stable()] struct S;\n+LL |     #[stable()]\n    |     ^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:23:5\n+  --> $DIR/issue-43106-gating-of-stable.rs:10:1\n    |\n-LL |     #[stable()] type T = S;\n-   |     ^^^^^^^^^^^\n+LL | #[stable()]\n+   | ^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-stable.rs:26:5\n+  --> $DIR/issue-43106-gating-of-stable.rs:7:1\n    |\n-LL |     #[stable()] impl S { }\n-   |     ^^^^^^^^^^^\n+LL | #![stable()]\n+   | ^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 7 previous errors\n \n For more information about this error, try `rustc --explain E0734`."}, {"sha": "d507bcd8f15df2e9fb20feda47e781ae4228d0cb", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-unstable.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -10,21 +10,26 @@\n #[unstable()]\n //~^ ERROR stability attributes may not be used outside of the standard library\n mod unstable {\n-    mod inner { #![unstable()] }\n-    //~^ ERROR stability attributes may not be used outside of the standard library\n+    mod inner {\n+        #![unstable()]\n+        //~^ ERROR stability attributes may not be used outside of the standard library\n+    }\n \n-    #[unstable()] fn f() { }\n+    #[unstable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    fn f() {}\n \n-    #[unstable()] struct S;\n+    #[unstable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n-    //~| ERROR stability attributes may not be used outside of the standard library\n+    struct S;\n \n-    #[unstable()] type T = S;\n+    #[unstable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    type T = S;\n \n-    #[unstable()] impl S { }\n+    #[unstable()]\n     //~^ ERROR stability attributes may not be used outside of the standard library\n+    impl S {}\n }\n \n fn main() {}"}, {"sha": "a2f361878c6dba45466aa463b3a220f47afc99ec", "filename": "src/test/ui/feature-gates/issue-43106-gating-of-unstable.stderr", "status": "modified", "additions": 19, "deletions": 25, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Fissue-43106-gating-of-unstable.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,51 +1,45 @@\n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:7:1\n-   |\n-LL | #![unstable()]\n-   | ^^^^^^^^^^^^^^\n-\n-error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:10:1\n+  --> $DIR/issue-43106-gating-of-unstable.rs:14:9\n    |\n-LL | #[unstable()]\n-   | ^^^^^^^^^^^^^\n+LL |         #![unstable()]\n+   |         ^^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:13:17\n+  --> $DIR/issue-43106-gating-of-unstable.rs:18:5\n    |\n-LL |     mod inner { #![unstable()] }\n-   |                 ^^^^^^^^^^^^^^\n+LL |     #[unstable()]\n+   |     ^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:16:5\n+  --> $DIR/issue-43106-gating-of-unstable.rs:22:5\n    |\n-LL |     #[unstable()] fn f() { }\n+LL |     #[unstable()]\n    |     ^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:19:5\n+  --> $DIR/issue-43106-gating-of-unstable.rs:26:5\n    |\n-LL |     #[unstable()] struct S;\n+LL |     #[unstable()]\n    |     ^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:19:5\n+  --> $DIR/issue-43106-gating-of-unstable.rs:30:5\n    |\n-LL |     #[unstable()] struct S;\n+LL |     #[unstable()]\n    |     ^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:23:5\n+  --> $DIR/issue-43106-gating-of-unstable.rs:10:1\n    |\n-LL |     #[unstable()] type T = S;\n-   |     ^^^^^^^^^^^^^\n+LL | #[unstable()]\n+   | ^^^^^^^^^^^^^\n \n error[E0734]: stability attributes may not be used outside of the standard library\n-  --> $DIR/issue-43106-gating-of-unstable.rs:26:5\n+  --> $DIR/issue-43106-gating-of-unstable.rs:7:1\n    |\n-LL |     #[unstable()] impl S { }\n-   |     ^^^^^^^^^^^^^\n+LL | #![unstable()]\n+   | ^^^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 7 previous errors\n \n For more information about this error, try `rustc --explain E0734`."}, {"sha": "1627d1d3f9f19312f3a125ae42cd996414d21b4f", "filename": "src/test/ui/stability-attribute/stability-attribute-non-staged-force-unstable.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -3,4 +3,5 @@\n #[unstable()] //~ ERROR: stability attributes may not be used\n #[stable()] //~ ERROR: stability attributes may not be used\n #[rustc_deprecated()] //~ ERROR: stability attributes may not be used\n-fn main() { }\n+//~^ ERROR missing 'since'\n+fn main() {}"}, {"sha": "a2b2d3cbe595196388c8bf8ac4c470638e2082e0", "filename": "src/test/ui/stability-attribute/stability-attribute-non-staged-force-unstable.stderr", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged-force-unstable.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -16,6 +16,13 @@ error[E0734]: stability attributes may not be used outside of the standard libra\n LL | #[rustc_deprecated()]\n    | ^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error[E0542]: missing 'since'\n+  --> $DIR/stability-attribute-non-staged-force-unstable.rs:5:1\n+   |\n+LL | #[rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 4 previous errors\n \n-For more information about this error, try `rustc --explain E0734`.\n+Some errors have detailed explanations: E0542, E0734.\n+For more information about an error, try `rustc --explain E0542`."}, {"sha": "dfbd9ea5ebf2e5150c4a91a90dd2d0200f1674a0", "filename": "src/test/ui/stability-attribute/stability-attribute-non-staged.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.rs?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -1,4 +1,5 @@\n #[unstable()] //~ ERROR: stability attributes may not be used\n #[stable()] //~ ERROR: stability attributes may not be used\n #[rustc_deprecated()] //~ ERROR: stability attributes may not be used\n-fn main() { }\n+//~^ ERROR missing 'since'\n+fn main() {}"}, {"sha": "9af8d1df4ea040bb390700f56b4dd78d033f4ac9", "filename": "src/test/ui/stability-attribute/stability-attribute-non-staged.stderr", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3c7947ee43b14f124b41f5de7c247dc8e47a18fa/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-non-staged.stderr?ref=3c7947ee43b14f124b41f5de7c247dc8e47a18fa", "patch": "@@ -16,6 +16,13 @@ error[E0734]: stability attributes may not be used outside of the standard libra\n LL | #[rustc_deprecated()]\n    | ^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error[E0542]: missing 'since'\n+  --> $DIR/stability-attribute-non-staged.rs:3:1\n+   |\n+LL | #[rustc_deprecated()]\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 4 previous errors\n \n-For more information about this error, try `rustc --explain E0734`.\n+Some errors have detailed explanations: E0542, E0734.\n+For more information about an error, try `rustc --explain E0542`."}]}