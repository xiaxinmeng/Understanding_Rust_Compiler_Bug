{"sha": "7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlMmZjYzI3ZTFiMzU5ZWZiZGNjMTZiMGFhYWJlNmY3ZTA5ZDhiNGE=", "commit": {"author": {"name": "sinkuu", "email": "sinkuu@users.noreply.github.com", "date": "2017-01-09T03:11:12Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2017-01-09T03:11:12Z"}, "message": "Fix #1258 (#1266)\n\n* Fix #1258\r\n\r\n* Add test", "tree": {"sha": "992551ce1a8696b6d2f74c7011bd28bb3a00845a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/992551ce1a8696b6d2f74c7011bd28bb3a00845a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "html_url": "https://github.com/rust-lang/rust/commit/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad46f9af95e3eefdd0e0b46084aba50568642aea", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad46f9af95e3eefdd0e0b46084aba50568642aea", "html_url": "https://github.com/rust-lang/rust/commit/ad46f9af95e3eefdd0e0b46084aba50568642aea"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "6a187bad7d5e71cb30eb6be688652637ee39da35", "filename": "src/items.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "patch": "@@ -839,7 +839,18 @@ fn format_struct_struct(context: &RewriteContext,\n \n     // FIXME(#919): properly format empty structs and their comments.\n     if fields.is_empty() {\n-        result.push_str(&context.snippet(mk_sp(body_lo, span.hi)));\n+        let snippet = context.snippet(mk_sp(body_lo, span.hi - BytePos(1)));\n+        if snippet.trim().is_empty() {\n+            // `struct S {}`\n+        } else if snippet.trim_right_matches(&[' ', '\\t'][..]).ends_with('\\n') {\n+            // fix indent\n+            result.push_str(&snippet.trim_right());\n+            result.push('\\n');\n+            result.push_str(&offset.to_string(context.config));\n+        } else {\n+            result.push_str(&snippet);\n+        }\n+        result.push('}');\n         return Some(result);\n     }\n "}, {"sha": "5a13d59f5727a468732f817cba5a604f32f9b1ec", "filename": "tests/source/structs.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/tests%2Fsource%2Fstructs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/tests%2Fsource%2Fstructs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fstructs.rs?ref=7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "patch": "@@ -153,4 +153,15 @@ struct Issue677 {\n }\n \n struct Foo {}\n+struct Foo {\n+    }\n+struct Foo {\n+    // comment\n+    }\n+struct Foo {\n+    // trailing space ->    \n+\n+\n+    }\n+struct Foo { /* comment */ }\n struct Foo();"}, {"sha": "3d3b20a9ad6f03fbee5e8b4cf07f1d6789bb3228", "filename": "tests/target/structs.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/tests%2Ftarget%2Fstructs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a/tests%2Ftarget%2Fstructs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fstructs.rs?ref=7e2fcc27e1b359efbdcc16b0aaabe6f7e09d8b4a", "patch": "@@ -161,4 +161,12 @@ struct Issue677 {\n }\n \n struct Foo {}\n+struct Foo {}\n+struct Foo {\n+    // comment\n+}\n+struct Foo {\n+    // trailing space ->\n+}\n+struct Foo { /* comment */ }\n struct Foo();"}]}