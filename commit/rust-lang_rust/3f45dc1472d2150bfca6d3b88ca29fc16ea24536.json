{"sha": "3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "node_id": "C_kwDOAAsO6NoAKDNmNDVkYzE0NzJkMjE1MGJmY2E2ZDNiODhjYTI5ZmMxNmVhMjQ1MzY", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-09-06T00:58:12Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-09-06T14:00:29Z"}, "message": "fix RPIT ICE for implicit HRTB when missing dyn", "tree": {"sha": "23e0662d9898ed46dfa2e9891d18c2007da046e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23e0662d9898ed46dfa2e9891d18c2007da046e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmMXUn4ACgkQgTGiTgx5\n76/oCRAAkuKDGqfvI4YXm5S3EHOCMeL/E1IZ38YC+cPmAhTyp0vdH4cWxcwdQ8Ep\n68ALfNOJTJ40/UjGswSUFw2tQKSI2OXEb8hFbWNCzfrRli8bofRPE1G0TSyJyKGG\nYdG+VRQbxlu4qUogHY6Du0/FYWcTACxQUVeDSQgOStoiQQXpF/90kpPaP45PmWSI\nqbNaCVQHFKM9JUVR+jS7VXC2o1EqWtXB0tW9e3NphyP6gXWIytZYNIFOjYuXHjFS\nFf+0abLZbohtYHzCp3CCCiX2wR5n/EfTDzI+nkQ/Qc72pxbXB5mB0eTOPBBIJWtE\n/UKSQi/+H4UUsEGrugm1KelsPTovZEOY+qFDYmpX64qL/YA34LTv6imEpf7hqXCs\nO6kHXq9CNgPwQSrlpuZTyWOte9MxUlT9Y1x0cNHt+ngxzAY/4LF7CaS1UIij2jf2\nMP1x2adqa7/VxoeqY4R3xD0qacJ3X6w3YcJgf2JrQUxME/ezkqcFpx0lIs6Y/gZU\nhDX3ABLUmLbGqN1OruxmPxvJRTmVtmsBKPrI9UDxL4FyQTql6OT9bH1ig1rGf0Gd\nsYSvUB4CDviR4z6FNtIdziPFgOFQAvHZIFeC7XgENL3ikrVzGFUCBR8c41q1WejT\n5T9rBzB2Y8rIHGNn4hxph2w/7YZE1rRMD1CHjMVMJTp6vT/LJ2Q=\n=SV6o\n-----END PGP SIGNATURE-----", "payload": "tree 23e0662d9898ed46dfa2e9891d18c2007da046e7\nparent 2dc703fd6e3aaaf343828cc7dd1aec192d24c628\nauthor Santiago Pastorino <spastorino@gmail.com> 1662425892 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1662472829 -0300\n\nfix RPIT ICE for implicit HRTB when missing dyn\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "html_url": "https://github.com/rust-lang/rust/commit/3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2dc703fd6e3aaaf343828cc7dd1aec192d24c628", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dc703fd6e3aaaf343828cc7dd1aec192d24c628", "html_url": "https://github.com/rust-lang/rust/commit/2dc703fd6e3aaaf343828cc7dd1aec192d24c628"}], "stats": {"total": 46, "additions": 44, "deletions": 2}, "files": [{"sha": "17cdb6d2bb0ce442071918a821ecd191e1540a38", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "patch": "@@ -1568,8 +1568,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n \n                 LifetimeRes::Fresh { param, binder: _ } => {\n                     debug_assert_eq!(lifetime.ident.name, kw::UnderscoreLifetime);\n-                    let old_def_id = self.local_def_id(param);\n-                    if remapping.get(&old_def_id).is_none() {\n+                    if let Some(old_def_id) = self.opt_local_def_id(param) && remapping.get(&old_def_id).is_none() {\n                         let node_id = self.next_node_id();\n \n                         let new_def_id = self.create_def("}, {"sha": "fd2e454e7e4557326fceabd67fb27aa8224b610c", "filename": "src/test/ui/impl-trait/generic-with-implicit-hrtb-without-dyn.edition2015.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2015.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2015.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2015.stderr?ref=3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "patch": "@@ -0,0 +1,9 @@\n+error[E0277]: the trait bound `(): AsRef<(dyn for<'r> Fn(&'r ()) + 'static)>` is not satisfied\n+  --> $DIR/generic-with-implicit-hrtb-without-dyn.rs:6:13\n+   |\n+LL | fn ice() -> impl AsRef<Fn(&())> {\n+   |             ^^^^^^^^^^^^^^^^^^^ the trait `AsRef<(dyn for<'r> Fn(&'r ()) + 'static)>` is not implemented for `()`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "c01c33a893124a11160695b92f2d15cad9adf6ca", "filename": "src/test/ui/impl-trait/generic-with-implicit-hrtb-without-dyn.edition2021.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2021.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2021.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.edition2021.stderr?ref=3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "patch": "@@ -0,0 +1,22 @@\n+error[E0782]: trait objects must include the `dyn` keyword\n+  --> $DIR/generic-with-implicit-hrtb-without-dyn.rs:6:24\n+   |\n+LL | fn ice() -> impl AsRef<Fn(&())> {\n+   |                        ^^^^^^^\n+   |\n+help: add `dyn` keyword before this trait\n+   |\n+LL - fn ice() -> impl AsRef<Fn(&())> {\n+LL + fn ice() -> impl AsRef<dyn Fn(&())> {\n+   |\n+\n+error[E0277]: the trait bound `(): AsRef<(dyn for<'r> Fn(&'r ()) + 'static)>` is not satisfied\n+  --> $DIR/generic-with-implicit-hrtb-without-dyn.rs:6:13\n+   |\n+LL | fn ice() -> impl AsRef<Fn(&())> {\n+   |             ^^^^^^^^^^^^^^^^^^^ the trait `AsRef<(dyn for<'r> Fn(&'r ()) + 'static)>` is not implemented for `()`\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0277, E0782.\n+For more information about an error, try `rustc --explain E0277`."}, {"sha": "856dc7a3f5a22ab324207f46a223e856d0730d2e", "filename": "src/test/ui/impl-trait/generic-with-implicit-hrtb-without-dyn.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f45dc1472d2150bfca6d3b88ca29fc16ea24536/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fgeneric-with-implicit-hrtb-without-dyn.rs?ref=3f45dc1472d2150bfca6d3b88ca29fc16ea24536", "patch": "@@ -0,0 +1,12 @@\n+// revisions: edition2015 edition2021\n+//[edition2021]edition:2021\n+\n+#![allow(warnings)]\n+\n+fn ice() -> impl AsRef<Fn(&())> {\n+    //~^ ERROR: the trait bound `(): AsRef<(dyn for<'r> Fn(&'r ()) + 'static)>` is not satisfied [E0277]\n+    //[edition2021]~| ERROR: trait objects must include the `dyn` keyword [E0782]\n+    todo!()\n+}\n+\n+fn main() {}"}]}