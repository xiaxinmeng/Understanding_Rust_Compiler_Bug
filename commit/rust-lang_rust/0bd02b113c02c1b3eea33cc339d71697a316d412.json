{"sha": "0bd02b113c02c1b3eea33cc339d71697a316d412", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiZDAyYjExM2MwMmMxYjNlZWEzM2NjMzM5ZDcxNjk3YTMxNmQ0MTI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-09-20T22:14:20Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-09-20T22:14:32Z"}, "message": "rustdoc: Also don't print struct attributes", "tree": {"sha": "b80c41f6ca4e3574f94eadde0f955a4633a98d38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b80c41f6ca4e3574f94eadde0f955a4633a98d38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0bd02b113c02c1b3eea33cc339d71697a316d412", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0bd02b113c02c1b3eea33cc339d71697a316d412", "html_url": "https://github.com/rust-lang/rust/commit/0bd02b113c02c1b3eea33cc339d71697a316d412", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0bd02b113c02c1b3eea33cc339d71697a316d412/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5558ebb6b7bf54a370111a46ea7c75b5becf85ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/5558ebb6b7bf54a370111a46ea7c75b5becf85ec", "html_url": "https://github.com/rust-lang/rust/commit/5558ebb6b7bf54a370111a46ea7c75b5becf85ec"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "76a5815c9421588d39f568c321ab644f73ecbfa6", "filename": "src/rustdoc/tystr_pass.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0bd02b113c02c1b3eea33cc339d71697a316d412/src%2Frustdoc%2Ftystr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bd02b113c02c1b3eea33cc339d71697a316d412/src%2Frustdoc%2Ftystr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Ftystr_pass.rs?ref=0bd02b113c02c1b3eea33cc339d71697a316d412", "patch": "@@ -333,7 +333,7 @@ fn fold_struct(\n         sig: do astsrv::exec(srv) |ctxt| {\n             match ctxt.ast_map.get(doc.id()) {\n                 ast_map::node_item(item, _) => {\n-                    let item = strip_struct_drop_block(item);\n+                    let item = strip_struct_extra_stuff(item);\n                     Some(pprust::item_to_str(item,\n                                              extract::interner()))\n                 }\n@@ -344,13 +344,15 @@ fn fold_struct(\n     }\n }\n \n-/// Removes the drop block from structs so that they aren't displayed\n-/// as part of the type\n-fn strip_struct_drop_block(item: @ast::item) -> @ast::item {\n+/// Removes various things from the struct item definition that\n+/// shouldn't be displayed in the struct signature. Probably there\n+/// should be a simple pprust::struct_to_str function that does\n+/// what I actually want\n+fn strip_struct_extra_stuff(item: @ast::item) -> @ast::item {\n     let node = match item.node {\n         ast::item_class(def, tys) => {\n             let def = @{\n-                dtor: None,\n+                dtor: None, // Remove the drop { } block\n                 .. *def\n             };\n             ast::item_class(def, tys)\n@@ -359,6 +361,7 @@ fn strip_struct_drop_block(item: @ast::item) -> @ast::item {\n     };\n \n     @{\n+        attrs: ~[], // Remove the attributes\n         node: node,\n         .. *item\n     }\n@@ -377,6 +380,13 @@ fn should_not_serialize_struct_drop_blocks() {\n     assert !doc.cratemod().structs()[0].sig.get().contains(\"drop\");\n }\n \n+#[test]\n+fn should_not_serialize_struct_attrs() {\n+    // All we care about are the fields\n+    let doc = test::mk_doc(~\"#[wut] struct S { field: () }\");\n+    assert !doc.cratemod().structs()[0].sig.get().contains(\"wut\");\n+}\n+\n #[cfg(test)]\n mod test {\n     fn mk_doc(source: ~str) -> doc::Doc {"}]}