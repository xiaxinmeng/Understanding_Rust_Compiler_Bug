{"sha": "e189122e9a922438f02b639948f75df765cd370e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxODkxMjJlOWE5MjI0MzhmMDJiNjM5OTQ4Zjc1ZGY3NjVjZDM3MGU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-13T00:41:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-13T00:41:22Z"}, "message": "auto merge of #16452 : epdtry/rust/unreachable-item-ice, r=pcwalton\n\nThis code produces an ICE:\r\n\r\n```rust\r\n#![crate_type = \"rlib\"]\r\nfn main() {\r\n    if true { return }\r\n    // remaining code is unreachable\r\n    match () {\r\n        () => { static MAGIC: uint = 0; }\r\n    }\r\n}\r\n```\r\n([playpen](http://is.gd/iwOISB))\r\n\r\nThe error is \"encode_symbol: id not found 18\", where 18 is the `NodeId` of the declaration of `MAGIC`.  The problem is that `rustc` tries to emit metadata for `MAGIC`, but some of the information is missing because `MAGIC` never gets translated by `trans_item` - the entire body of the `match` gets skipped because the `match` itself is unreachable.\r\n\r\nThis branch simplifies the handling of inner items by always processing them using the `trans_item` visitor, instead of sometimes using the visitor and sometimes waiting until `trans_stmt` encounters the item.  This fixes the ICE by making the translation of the item no longer depend on the declaration being reachable code.  This branch also reverts #16059 and #16359, since the new change to item translation fixes the same problems as those but is simpler.", "tree": {"sha": "6909df7e52b3d51c57ed095e1944fc51e732b8c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6909df7e52b3d51c57ed095e1944fc51e732b8c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e189122e9a922438f02b639948f75df765cd370e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e189122e9a922438f02b639948f75df765cd370e", "html_url": "https://github.com/rust-lang/rust/commit/e189122e9a922438f02b639948f75df765cd370e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e189122e9a922438f02b639948f75df765cd370e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51c7e20d539eaed6e765612a02fbf2865e08a1bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/51c7e20d539eaed6e765612a02fbf2865e08a1bc", "html_url": "https://github.com/rust-lang/rust/commit/51c7e20d539eaed6e765612a02fbf2865e08a1bc"}, {"sha": "0f847ba74da083124f3d5d38d36fc1135737c12c", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f847ba74da083124f3d5d38d36fc1135737c12c", "html_url": "https://github.com/rust-lang/rust/commit/0f847ba74da083124f3d5d38d36fc1135737c12c"}], "stats": {"total": 99, "additions": 34, "deletions": 65}, "files": [{"sha": "35d32d995250645884240321304b06fa972ca31d", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 14, "deletions": 22, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -1343,8 +1343,7 @@ pub fn new_fn_ctxt<'a>(ccx: &'a CrateContext,\n                        output_type: ty::t,\n                        param_substs: &'a param_substs,\n                        sp: Option<Span>,\n-                       block_arena: &'a TypedArena<Block<'a>>,\n-                       handle_items: HandleItemsFlag)\n+                       block_arena: &'a TypedArena<Block<'a>>)\n                        -> FunctionContext<'a> {\n     param_substs.validate();\n \n@@ -1379,8 +1378,7 @@ pub fn new_fn_ctxt<'a>(ccx: &'a CrateContext,\n           block_arena: block_arena,\n           ccx: ccx,\n           debug_context: debug_context,\n-          scopes: RefCell::new(Vec::new()),\n-          handle_items: handle_items,\n+          scopes: RefCell::new(Vec::new())\n     };\n \n     if has_env {\n@@ -1708,8 +1706,7 @@ pub fn trans_closure(ccx: &CrateContext,\n                      abi: Abi,\n                      has_env: bool,\n                      is_unboxed_closure: IsUnboxedClosureFlag,\n-                     maybe_load_env: <'a> |&'a Block<'a>| -> &'a Block<'a>,\n-                     handle_items: HandleItemsFlag) {\n+                     maybe_load_env: <'a> |&'a Block<'a>| -> &'a Block<'a>) {\n     ccx.stats.n_closures.set(ccx.stats.n_closures.get() + 1);\n \n     let _icx = push_ctxt(\"trans_closure\");\n@@ -1726,8 +1723,7 @@ pub fn trans_closure(ccx: &CrateContext,\n                           output_type,\n                           param_substs,\n                           Some(body.span),\n-                          &arena,\n-                          handle_items);\n+                          &arena);\n     let mut bcx = init_function(&fcx, false, output_type);\n \n     // cleanup scope for the incoming arguments\n@@ -1836,8 +1832,7 @@ pub fn trans_fn(ccx: &CrateContext,\n                 llfndecl: ValueRef,\n                 param_substs: &param_substs,\n                 id: ast::NodeId,\n-                attrs: &[ast::Attribute],\n-                handle_items: HandleItemsFlag) {\n+                attrs: &[ast::Attribute]) {\n     let _s = StatRecorder::new(ccx, ccx.tcx.map.path_to_string(id).to_string());\n     debug!(\"trans_fn(param_substs={})\", param_substs.repr(ccx.tcx()));\n     let _icx = push_ctxt(\"trans_fn\");\n@@ -1857,8 +1852,7 @@ pub fn trans_fn(ccx: &CrateContext,\n                   abi,\n                   false,\n                   NotUnboxedClosure,\n-                  |bcx| bcx,\n-                  handle_items);\n+                  |bcx| bcx);\n }\n \n pub fn trans_enum_variant(ccx: &CrateContext,\n@@ -1964,7 +1958,7 @@ fn trans_enum_variant_or_tuple_like_struct(ccx: &CrateContext,\n \n     let arena = TypedArena::new();\n     let fcx = new_fn_ctxt(ccx, llfndecl, ctor_id, false, result_ty,\n-                          param_substs, None, &arena, TranslateItems);\n+                          param_substs, None, &arena);\n     let bcx = init_function(&fcx, false, result_ty);\n \n     assert!(!fcx.needs_ret_allocas);\n@@ -2066,24 +2060,22 @@ pub fn trans_item(ccx: &CrateContext, item: &ast::Item) {\n                                                         llfn,\n                                                         &param_substs::empty(),\n                                                         item.id,\n-                                                        None,\n-                                                        TranslateItems);\n+                                                        None);\n             } else {\n                 trans_fn(ccx,\n                          &**decl,\n                          &**body,\n                          llfn,\n                          &param_substs::empty(),\n                          item.id,\n-                         item.attrs.as_slice(),\n-                         TranslateItems);\n+                         item.attrs.as_slice());\n             }\n-        } else {\n-            // Be sure to travel more than just one layer deep to catch nested\n-            // items in blocks and such.\n-            let mut v = TransItemVisitor{ ccx: ccx };\n-            v.visit_block(&**body, ());\n         }\n+\n+        // Be sure to travel more than just one layer deep to catch nested\n+        // items in blocks and such.\n+        let mut v = TransItemVisitor{ ccx: ccx };\n+        v.visit_block(&**body, ());\n       }\n       ast::ItemImpl(ref generics, _, _, ref ms) => {\n         meth::trans_impl(ccx, item.ident, ms.as_slice(), generics, item.id);"}, {"sha": "379b53eebbb4f527cdad7f1d8049c61987e5017b", "filename": "src/librustc/middle/trans/callee.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -339,8 +339,7 @@ pub fn trans_unboxing_shim(bcx: &Block,\n                           return_type,\n                           &empty_param_substs,\n                           None,\n-                          &block_arena,\n-                          TranslateItems);\n+                          &block_arena);\n     let mut bcx = init_function(&fcx, false, return_type);\n \n     // Create the substituted versions of the self type."}, {"sha": "44c52a6739ab4de0c8c51d6e1354d2fe1bf62704", "filename": "src/librustc/middle/trans/closure.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -394,8 +394,7 @@ pub fn trans_expr_fn<'a>(\n                   ty::ty_fn_abi(fty),\n                   true,\n                   NotUnboxedClosure,\n-                  |bcx| load_environment(bcx, cdata_ty, &freevars, store),\n-                  bcx.fcx.handle_items);\n+                  |bcx| load_environment(bcx, cdata_ty, &freevars, store));\n     fill_fn_pair(bcx, dest_addr, llfn, llbox);\n     bcx\n }\n@@ -487,8 +486,7 @@ pub fn trans_unboxed_closure<'a>(\n                   ty::ty_fn_abi(function_type),\n                   true,\n                   IsUnboxedClosure,\n-                  |bcx| load_unboxed_closure_environment(bcx, freevars_ptr),\n-                  bcx.fcx.handle_items);\n+                  |bcx| load_unboxed_closure_environment(bcx, freevars_ptr));\n \n     // Don't hoist this to the top of the function. It's perfectly legitimate\n     // to have a zero-size unboxed closure (in which case dest will be\n@@ -575,7 +573,7 @@ pub fn get_wrapper_for_bare_fn(ccx: &CrateContext,\n     let arena = TypedArena::new();\n     let empty_param_substs = param_substs::empty();\n     let fcx = new_fn_ctxt(ccx, llfn, ast::DUMMY_NODE_ID, true, f.sig.output,\n-                          &empty_param_substs, None, &arena, TranslateItems);\n+                          &empty_param_substs, None, &arena);\n     let bcx = init_function(&fcx, true, f.sig.output);\n \n     let args = create_datums_for_fn_args(&fcx,"}, {"sha": "3b89c73b31da8cee0bf4ca5321d03236b4b7cc86", "filename": "src/librustc/middle/trans/common.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -224,12 +224,6 @@ impl<T:Subst+Clone> SubstP for T {\n pub type RvalueDatum = datum::Datum<datum::Rvalue>;\n pub type LvalueDatum = datum::Datum<datum::Lvalue>;\n \n-#[deriving(Clone, Eq, PartialEq)]\n-pub enum HandleItemsFlag {\n-    IgnoreItems,\n-    TranslateItems,\n-}\n-\n // Function context.  Every LLVM function we create will have one of\n // these.\n pub struct FunctionContext<'a> {\n@@ -303,9 +297,6 @@ pub struct FunctionContext<'a> {\n \n     // Cleanup scopes.\n     pub scopes: RefCell<Vec<cleanup::CleanupScope<'a>> >,\n-\n-    // How to handle items encountered during translation of this function.\n-    pub handle_items: HandleItemsFlag,\n }\n \n impl<'a> FunctionContext<'a> {"}, {"sha": "a481f92db33916345a1635176feb38926b38d280", "filename": "src/librustc/middle/trans/controlflow.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontrolflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontrolflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontrolflow.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -69,12 +69,8 @@ pub fn trans_stmt<'a>(cx: &'a Block<'a>,\n                         debuginfo::create_local_var_metadata(bcx, &**local);\n                     }\n                 }\n-                ast::DeclItem(ref i) => {\n-                    match fcx.handle_items {\n-                        TranslateItems => trans_item(cx.fcx.ccx, &**i),\n-                        IgnoreItems => {}\n-                    }\n-                }\n+                // Inner items are visited by `trans_item`/`trans_meth`.\n+                ast::DeclItem(_) => {},\n             }\n         }\n         ast::StmtMac(..) => cx.tcx().sess.bug(\"unexpanded macro\")"}, {"sha": "88bb88da3f043d31117461ef61ea42e89b283fb0", "filename": "src/librustc/middle/trans/foreign.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -577,8 +577,7 @@ pub fn trans_rust_fn_with_foreign_abi(ccx: &CrateContext,\n                                       llwrapfn: ValueRef,\n                                       param_substs: &param_substs,\n                                       id: ast::NodeId,\n-                                      hash: Option<&str>,\n-                                      handle_items: HandleItemsFlag) {\n+                                      hash: Option<&str>) {\n     let _icx = push_ctxt(\"foreign::build_foreign_fn\");\n \n     let fnty = ty::node_id_to_type(ccx.tcx(), id);\n@@ -587,8 +586,7 @@ pub fn trans_rust_fn_with_foreign_abi(ccx: &CrateContext,\n \n     unsafe { // unsafe because we call LLVM operations\n         // Build up the Rust function (`foo0` above).\n-        let llrustfn = build_rust_fn(ccx, decl, body, param_substs, attrs, id,\n-                                     hash, handle_items);\n+        let llrustfn = build_rust_fn(ccx, decl, body, param_substs, attrs, id, hash);\n \n         // Build up the foreign wrapper (`foo` above).\n         return build_wrap_fn(ccx, llrustfn, llwrapfn, &tys, mty);\n@@ -600,8 +598,7 @@ pub fn trans_rust_fn_with_foreign_abi(ccx: &CrateContext,\n                      param_substs: &param_substs,\n                      attrs: &[ast::Attribute],\n                      id: ast::NodeId,\n-                     hash: Option<&str>,\n-                     handle_items: HandleItemsFlag)\n+                     hash: Option<&str>)\n                      -> ValueRef {\n         let _icx = push_ctxt(\"foreign::foreign::build_rust_fn\");\n         let tcx = ccx.tcx();\n@@ -633,7 +630,7 @@ pub fn trans_rust_fn_with_foreign_abi(ccx: &CrateContext,\n \n         let llfn = base::decl_internal_rust_fn(ccx, t, ps.as_slice());\n         base::set_llvm_fn_attrs(attrs, llfn);\n-        base::trans_fn(ccx, decl, body, llfn, param_substs, id, [], handle_items);\n+        base::trans_fn(ccx, decl, body, llfn, param_substs, id, []);\n         llfn\n     }\n "}, {"sha": "cc7cb16334131831ce80f37a26720cb78520e93e", "filename": "src/librustc/middle/trans/glue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -468,7 +468,7 @@ fn make_generic_glue(ccx: &CrateContext,\n     let arena = TypedArena::new();\n     let empty_param_substs = param_substs::empty();\n     let fcx = new_fn_ctxt(ccx, llfn, ast::DUMMY_NODE_ID, false, ty::mk_nil(),\n-                          &empty_param_substs, None, &arena, TranslateItems);\n+                          &empty_param_substs, None, &arena);\n \n     let bcx = init_function(&fcx, false, ty::mk_nil());\n "}, {"sha": "bf39f3a6aa385842d1d2a838aafe61dcbffa9648", "filename": "src/librustc/middle/trans/inline.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Finline.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -133,7 +133,7 @@ pub fn maybe_instantiate_inline(ccx: &CrateContext, fn_id: ast::DefId)\n           if unparameterized {\n               let llfn = get_item_val(ccx, mth.id);\n                 trans_fn(ccx, &*mth.pe_fn_decl(), &*mth.pe_body(), llfn,\n-                       &param_substs::empty(), mth.id, [], TranslateItems);\n+                       &param_substs::empty(), mth.id, []);\n           }\n           local_def(mth.id)\n         }"}, {"sha": "3578b25c83957edfaade6f1a5a379711255b37d4", "filename": "src/librustc/middle/trans/meth.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmeth.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmeth.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmeth.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -75,12 +75,10 @@ pub fn trans_impl(ccx: &CrateContext,\n                      llfn,\n                      &param_substs::empty(),\n                      method.id,\n-                     [],\n-                     TranslateItems);\n-        } else {\n-            let mut v = TransItemVisitor{ ccx: ccx };\n-            visit::walk_method_helper(&mut v, &**method, ());\n+                     []);\n         }\n+        let mut v = TransItemVisitor{ ccx: ccx };\n+        visit::walk_method_helper(&mut v, &**method, ());\n     }\n }\n "}, {"sha": "6d705c7d914e39118788d7d8cad768bb7b1028cf", "filename": "src/librustc/middle/trans/monomorphize.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -164,10 +164,9 @@ pub fn monomorphic_fn(ccx: &CrateContext,\n                   if abi != abi::Rust {\n                       foreign::trans_rust_fn_with_foreign_abi(\n                           ccx, &**decl, &**body, [], d, &psubsts, fn_id.node,\n-                          Some(hash.as_slice()), IgnoreItems);\n+                          Some(hash.as_slice()));\n                   } else {\n-                      trans_fn(ccx, &**decl, &**body, d, &psubsts, fn_id.node, [],\n-                               IgnoreItems);\n+                      trans_fn(ccx, &**decl, &**body, d, &psubsts, fn_id.node, []);\n                   }\n \n                   d\n@@ -201,8 +200,7 @@ pub fn monomorphic_fn(ccx: &CrateContext,\n         ast_map::NodeMethod(mth) => {\n             let d = mk_lldecl(abi::Rust);\n             set_llvm_fn_attrs(mth.attrs.as_slice(), d);\n-            trans_fn(ccx, &*mth.pe_fn_decl(), &*mth.pe_body(), d, &psubsts, mth.id, [],\n-                     IgnoreItems);\n+            trans_fn(ccx, &*mth.pe_fn_decl(), &*mth.pe_body(), d, &psubsts, mth.id, []);\n             d\n         }\n         ast_map::NodeTraitMethod(method) => {\n@@ -211,7 +209,7 @@ pub fn monomorphic_fn(ccx: &CrateContext,\n                     let d = mk_lldecl(abi::Rust);\n                     set_llvm_fn_attrs(mth.attrs.as_slice(), d);\n                     trans_fn(ccx, &*mth.pe_fn_decl(), &*mth.pe_body(), d,\n-                             &psubsts, mth.id, [], IgnoreItems);\n+                             &psubsts, mth.id, []);\n                     d\n                 }\n                 _ => {"}, {"sha": "9caa9f681aadffe42beb6d8b8a03261a45cda3b6", "filename": "src/librustc/middle/trans/reflect.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Freflect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e189122e9a922438f02b639948f75df765cd370e/src%2Flibrustc%2Fmiddle%2Ftrans%2Freflect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Freflect.rs?ref=e189122e9a922438f02b639948f75df765cd370e", "patch": "@@ -312,7 +312,7 @@ impl<'a, 'b> Reflector<'a, 'b> {\n                 let empty_param_substs = param_substs::empty();\n                 let fcx = new_fn_ctxt(ccx, llfdecl, ast::DUMMY_NODE_ID, false,\n                                       ty::mk_u64(), &empty_param_substs,\n-                                      None, &arena, TranslateItems);\n+                                      None, &arena);\n                 let bcx = init_function(&fcx, false, ty::mk_u64());\n \n                 // we know the return type of llfdecl is an int here, so"}]}