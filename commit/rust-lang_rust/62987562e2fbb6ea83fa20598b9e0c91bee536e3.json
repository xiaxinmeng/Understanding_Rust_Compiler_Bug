{"sha": "62987562e2fbb6ea83fa20598b9e0c91bee536e3", "node_id": "C_kwDOAAsO6NoAKDYyOTg3NTYyZTJmYmI2ZWE4M2ZhMjA1OThiOWUwYzkxYmVlNTM2ZTM", "commit": {"author": {"name": "Caleb Cartwright", "email": "caleb.cartwright@outlook.com", "date": "2021-12-21T01:44:23Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2021-12-21T16:55:39Z"}, "message": "refactor: extract final rustc_parse touchpoint from macros.rs", "tree": {"sha": "be7d0bbb9e9e1582ca4847892a9f11c6141eb022", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be7d0bbb9e9e1582ca4847892a9f11c6141eb022"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/62987562e2fbb6ea83fa20598b9e0c91bee536e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/62987562e2fbb6ea83fa20598b9e0c91bee536e3", "html_url": "https://github.com/rust-lang/rust/commit/62987562e2fbb6ea83fa20598b9e0c91bee536e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/62987562e2fbb6ea83fa20598b9e0c91bee536e3/comments", "author": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8cf454173ec332acf3860863c7d2f088876e40b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8cf454173ec332acf3860863c7d2f088876e40b", "html_url": "https://github.com/rust-lang/rust/commit/c8cf454173ec332acf3860863c7d2f088876e40b"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "f29552caf8d87efb2c585ced695eb065c302c9d6", "filename": "src/macros.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/62987562e2fbb6ea83fa20598b9e0c91bee536e3/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62987562e2fbb6ea83fa20598b9e0c91bee536e3/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=62987562e2fbb6ea83fa20598b9e0c91bee536e3", "patch": "@@ -29,7 +29,7 @@ use crate::expr::{rewrite_array, rewrite_assign_rhs, RhsAssignKind};\n use crate::lists::{itemize_list, write_list, ListFormatting};\n use crate::overflow;\n use crate::parse::macros::lazy_static::parse_lazy_static;\n-use crate::parse::macros::{build_parser, parse_macro_args, ParsedMacroArgs};\n+use crate::parse::macros::{parse_expr, parse_macro_args, ParsedMacroArgs};\n use crate::rewrite::{Rewrite, RewriteContext};\n use crate::shape::{Indent, Shape};\n use crate::source_map::SpanUtils;\n@@ -1060,11 +1060,10 @@ pub(crate) fn convert_try_mac(\n     let path = &pprust::path_to_string(&mac.path);\n     if path == \"try\" || path == \"r#try\" {\n         let ts = mac.args.inner_tokens();\n-        let mut parser = build_parser(context, ts);\n \n         Some(ast::Expr {\n             id: ast::NodeId::root(), // dummy value\n-            kind: ast::ExprKind::Try(parser.parse_expr().ok()?),\n+            kind: ast::ExprKind::Try(parse_expr(context, ts)?),\n             span: mac.span(), // incorrect span, but shouldn't matter too much\n             attrs: ast::AttrVec::new(),\n             tokens: None,"}, {"sha": "414b72f2921337b92bbc1118c809d86eb3e0c1f0", "filename": "src/parse/macros/mod.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/62987562e2fbb6ea83fa20598b9e0c91bee536e3/src%2Fparse%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62987562e2fbb6ea83fa20598b9e0c91bee536e3/src%2Fparse%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparse%2Fmacros%2Fmod.rs?ref=62987562e2fbb6ea83fa20598b9e0c91bee536e3", "patch": "@@ -13,7 +13,7 @@ use crate::rewrite::{Rewrite, RewriteContext};\n \n pub(crate) mod lazy_static;\n \n-pub(crate) fn build_parser<'a>(context: &RewriteContext<'a>, tokens: TokenStream) -> Parser<'a> {\n+fn build_parser<'a>(context: &RewriteContext<'a>, tokens: TokenStream) -> Parser<'a> {\n     stream_to_parser(context.parse_sess.inner(), tokens, MACRO_ARGUMENTS)\n }\n \n@@ -155,6 +155,14 @@ pub(crate) fn parse_macro_args(\n     })\n }\n \n+pub(crate) fn parse_expr(\n+    context: &RewriteContext<'_>,\n+    tokens: TokenStream,\n+) -> Option<ptr::P<ast::Expr>> {\n+    let mut parser = build_parser(context, tokens);\n+    parser.parse_expr().ok()\n+}\n+\n const RUST_KW: [Symbol; 59] = [\n     kw::PathRoot,\n     kw::DollarCrate,"}]}