{"sha": "ba246c8262d070e946ea3886af518f84ddc7ca38", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhMjQ2YzgyNjJkMDcwZTk0NmVhMzg4NmFmNTE4Zjg0ZGRjN2NhMzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-17T03:33:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-17T03:33:01Z"}, "message": "Auto merge of #5183 - JohnTitor:fix-fp-import, r=matthiaskrgr\n\nDon't lint `single_component_path_imports` in macros\n\nFixes #5154\n\nchangelog: Fix false positive in `single_component_path_imports`", "tree": {"sha": "aa37f17d59ea5f86808a7d9f9a37d04a693f7496", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa37f17d59ea5f86808a7d9f9a37d04a693f7496"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba246c8262d070e946ea3886af518f84ddc7ca38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba246c8262d070e946ea3886af518f84ddc7ca38", "html_url": "https://github.com/rust-lang/rust/commit/ba246c8262d070e946ea3886af518f84ddc7ca38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba246c8262d070e946ea3886af518f84ddc7ca38/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da78c310ea8beb4d8f3e3f2128ef59145c64d7b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/da78c310ea8beb4d8f3e3f2128ef59145c64d7b3", "html_url": "https://github.com/rust-lang/rust/commit/da78c310ea8beb4d8f3e3f2128ef59145c64d7b3"}, {"sha": "09165ff5761bb1f397e37ee2d32d96adf7afdd86", "url": "https://api.github.com/repos/rust-lang/rust/commits/09165ff5761bb1f397e37ee2d32d96adf7afdd86", "html_url": "https://github.com/rust-lang/rust/commit/09165ff5761bb1f397e37ee2d32d96adf7afdd86"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "5a9bc73fe42b2d78b0b3abcef2cfeecf31fd78c7", "filename": "clippy_lints/src/single_component_path_imports.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ba246c8262d070e946ea3886af518f84ddc7ca38/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba246c8262d070e946ea3886af518f84ddc7ca38/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs?ref=ba246c8262d070e946ea3886af518f84ddc7ca38", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::span_lint_and_sugg;\n+use crate::utils::{in_macro, span_lint_and_sugg};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_lint::{EarlyContext, EarlyLintPass};\n@@ -39,6 +39,7 @@ declare_lint_pass!(SingleComponentPathImports => [SINGLE_COMPONENT_PATH_IMPORTS]\n impl EarlyLintPass for SingleComponentPathImports {\n     fn check_item(&mut self, cx: &EarlyContext<'_>, item: &Item) {\n         if_chain! {\n+            if !in_macro(item.span);\n             if cx.sess.opts.edition == Edition::Edition2018;\n             if !item.vis.node.is_pub();\n             if let ItemKind::Use(use_tree) = &item.kind;"}, {"sha": "9095069b09399eda7f49ca6c55c1e95bba685719", "filename": "tests/ui/single_component_path_imports.fixed", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ba246c8262d070e946ea3886af518f84ddc7ca38/tests%2Fui%2Fsingle_component_path_imports.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/ba246c8262d070e946ea3886af518f84ddc7ca38/tests%2Fui%2Fsingle_component_path_imports.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.fixed?ref=ba246c8262d070e946ea3886af518f84ddc7ca38", "patch": "@@ -7,6 +7,15 @@\n use serde as edres;\n pub use serde;\n \n+macro_rules! m {\n+    () => {\n+        use regex;\n+    };\n+}\n+\n fn main() {\n     regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+\n+    // False positive #5154, shouldn't trigger lint.\n+    m!();\n }"}, {"sha": "1ebb3ee59b8bf219f047ae45e6cbe51fc4cb5353", "filename": "tests/ui/single_component_path_imports.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ba246c8262d070e946ea3886af518f84ddc7ca38/tests%2Fui%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba246c8262d070e946ea3886af518f84ddc7ca38/tests%2Fui%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.rs?ref=ba246c8262d070e946ea3886af518f84ddc7ca38", "patch": "@@ -7,6 +7,15 @@ use regex;\n use serde as edres;\n pub use serde;\n \n+macro_rules! m {\n+    () => {\n+        use regex;\n+    };\n+}\n+\n fn main() {\n     regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+\n+    // False positive #5154, shouldn't trigger lint.\n+    m!();\n }"}]}