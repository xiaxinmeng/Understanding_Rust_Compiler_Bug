{"sha": "f4643f59cb44725ccab9ced2bfb621d09a6e3682", "node_id": "C_kwDOAAsO6NoAKGY0NjQzZjU5Y2I0NDcyNWNjYWI5Y2VkMmJmYjYyMWQwOWE2ZTM2ODI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-05T19:43:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-05T19:43:42Z"}, "message": "Rollup merge of #104953 - jyn514:fewer-submodule-updates, r=Mark-Simulacrum\n\nEnsure required submodules at the same time as updating existing submodules\n\nIn practice, this would always happen at the same time, but putting them next to each other makes that more obvious and ensures it doesn't change in the future. It also avoids the difference affecting `cargo metadata` somehow.\n\nThis is based on https://github.com/rust-lang/rust/pull/104952 for convenience to avoid merge conflicts, but doesn't depend on that PR.", "tree": {"sha": "fd4034fd606289f03f959f6266780ee5db7712e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd4034fd606289f03f959f6266780ee5db7712e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4643f59cb44725ccab9ced2bfb621d09a6e3682", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjjknuCRBK7hj4Ov3rIwAAG44IAFAW+g8fEo7wtQvRXM2W8ND7\n0z67wtLmAShTnhoguR8d29lYna2Drjjx+24hg0q8aXciD8TNVehbtAAJqG9OBwcQ\n3R6iiKWzpzTznjH8lFKOP8w5gBA1XWxS6JzC9du6W/Tr1j/lbsSymq9w/xxaS/IA\nfZ6V5GeT1tJVBCvg06o0+cFjfqdcbBAxVB0JyYIOVK6/BwYjZGQf09o5rcjY8LN4\nbllRukpj3ivujyCJ0qRzzEd0iGn/FMXwcjRXX/aEl+QIms6ypghvq62xfZwBadxh\n12iiAzxnRfdbAev8YFXgWRZElRIhEiqBDGuaIvOUFVG0rWhv7N+wqK3jnpxkF3o=\n=dLdV\n-----END PGP SIGNATURE-----\n", "payload": "tree fd4034fd606289f03f959f6266780ee5db7712e8\nparent 4b6010cbb70bb903c0d69cddaa27e262cef15761\nparent ab89c171bdb29194baca274decf86acfecd2bb9d\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1670269422 +0100\ncommitter GitHub <noreply@github.com> 1670269422 +0100\n\nRollup merge of #104953 - jyn514:fewer-submodule-updates, r=Mark-Simulacrum\n\nEnsure required submodules at the same time as updating existing submodules\n\nIn practice, this would always happen at the same time, but putting them next to each other makes that more obvious and ensures it doesn't change in the future. It also avoids the difference affecting `cargo metadata` somehow.\n\nThis is based on https://github.com/rust-lang/rust/pull/104952 for convenience to avoid merge conflicts, but doesn't depend on that PR.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4643f59cb44725ccab9ced2bfb621d09a6e3682", "html_url": "https://github.com/rust-lang/rust/commit/f4643f59cb44725ccab9ced2bfb621d09a6e3682", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4643f59cb44725ccab9ced2bfb621d09a6e3682/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b6010cbb70bb903c0d69cddaa27e262cef15761", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b6010cbb70bb903c0d69cddaa27e262cef15761", "html_url": "https://github.com/rust-lang/rust/commit/4b6010cbb70bb903c0d69cddaa27e262cef15761"}, {"sha": "ab89c171bdb29194baca274decf86acfecd2bb9d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab89c171bdb29194baca274decf86acfecd2bb9d", "html_url": "https://github.com/rust-lang/rust/commit/ab89c171bdb29194baca274decf86acfecd2bb9d"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "3ed53452309c76a54d0c11eec05cfb28b8d39447", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f4643f59cb44725ccab9ced2bfb621d09a6e3682/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4643f59cb44725ccab9ced2bfb621d09a6e3682/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=f4643f59cb44725ccab9ced2bfb621d09a6e3682", "patch": "@@ -579,6 +579,8 @@ impl Build {\n             for s in rust_submodules {\n                 build.update_submodule(Path::new(s));\n             }\n+            // Now, update all existing submodules.\n+            build.update_existing_submodules();\n \n             build.verbose(\"learning about cargo\");\n             metadata::build(&mut build);\n@@ -674,7 +676,7 @@ impl Build {\n \n     /// If any submodule has been initialized already, sync it unconditionally.\n     /// This avoids contributors checking in a submodule change by accident.\n-    pub fn maybe_update_submodules(&self) {\n+    pub fn update_existing_submodules(&self) {\n         // Avoid running git when there isn't a git checkout.\n         if !self.config.submodules(&self.rust_info()) {\n             return;\n@@ -703,8 +705,6 @@ impl Build {\n             job::setup(self);\n         }\n \n-        self.maybe_update_submodules();\n-\n         if let Subcommand::Format { check, paths } = &self.config.cmd {\n             return format::format(&builder::Builder::new(&self), *check, &paths);\n         }"}]}