{"sha": "bea1fec7a2c949d6470f2182d34c5b349605f7a1", "node_id": "C_kwDOAAsO6NoAKGJlYTFmZWM3YTJjOTQ5ZDY0NzBmMjE4MmQzNGM1YjM0OTYwNWY3YTE", "commit": {"author": {"name": "Dorian Scheidt", "email": "dorian.scheidt@gmail.com", "date": "2022-07-20T17:11:00Z"}, "committer": {"name": "Dorian Scheidt", "email": "dorian.scheidt@gmail.com", "date": "2022-08-02T18:37:12Z"}, "message": "convert generate_enum_variant to use add_variant", "tree": {"sha": "35ba89982bd41564718e9dcbe907922ffe155b8b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35ba89982bd41564718e9dcbe907922ffe155b8b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bea1fec7a2c949d6470f2182d34c5b349605f7a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bea1fec7a2c949d6470f2182d34c5b349605f7a1", "html_url": "https://github.com/rust-lang/rust/commit/bea1fec7a2c949d6470f2182d34c5b349605f7a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bea1fec7a2c949d6470f2182d34c5b349605f7a1/comments", "author": {"login": "DorianListens", "id": 5692947, "node_id": "MDQ6VXNlcjU2OTI5NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5692947?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DorianListens", "html_url": "https://github.com/DorianListens", "followers_url": "https://api.github.com/users/DorianListens/followers", "following_url": "https://api.github.com/users/DorianListens/following{/other_user}", "gists_url": "https://api.github.com/users/DorianListens/gists{/gist_id}", "starred_url": "https://api.github.com/users/DorianListens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DorianListens/subscriptions", "organizations_url": "https://api.github.com/users/DorianListens/orgs", "repos_url": "https://api.github.com/users/DorianListens/repos", "events_url": "https://api.github.com/users/DorianListens/events{/privacy}", "received_events_url": "https://api.github.com/users/DorianListens/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DorianListens", "id": 5692947, "node_id": "MDQ6VXNlcjU2OTI5NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5692947?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DorianListens", "html_url": "https://github.com/DorianListens", "followers_url": "https://api.github.com/users/DorianListens/followers", "following_url": "https://api.github.com/users/DorianListens/following{/other_user}", "gists_url": "https://api.github.com/users/DorianListens/gists{/gist_id}", "starred_url": "https://api.github.com/users/DorianListens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DorianListens/subscriptions", "organizations_url": "https://api.github.com/users/DorianListens/orgs", "repos_url": "https://api.github.com/users/DorianListens/repos", "events_url": "https://api.github.com/users/DorianListens/events{/privacy}", "received_events_url": "https://api.github.com/users/DorianListens/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "405dd77d30382f417f033e4feba2b2bd02ebe00e", "url": "https://api.github.com/repos/rust-lang/rust/commits/405dd77d30382f417f033e4feba2b2bd02ebe00e", "html_url": "https://github.com/rust-lang/rust/commit/405dd77d30382f417f033e4feba2b2bd02ebe00e"}], "stats": {"total": 20, "additions": 5, "deletions": 15}, "files": [{"sha": "04620645e6d3b941bed4115171dc19de1bd665fd", "filename": "crates/ide-assists/src/handlers/generate_enum_variant.rs", "status": "modified", "additions": 5, "deletions": 15, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/bea1fec7a2c949d6470f2182d34c5b349605f7a1/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fgenerate_enum_variant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea1fec7a2c949d6470f2182d34c5b349605f7a1/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fgenerate_enum_variant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-assists%2Fsrc%2Fhandlers%2Fgenerate_enum_variant.rs?ref=bea1fec7a2c949d6470f2182d34c5b349605f7a1", "patch": "@@ -1,8 +1,8 @@\n use hir::{HasSource, InFile};\n use ide_db::assists::{AssistId, AssistKind};\n use syntax::{\n-    ast::{self, edit::IndentLevel},\n-    AstNode, TextSize,\n+    ast::{self, make},\n+    AstNode,\n };\n \n use crate::assist_context::{AssistContext, Assists};\n@@ -65,26 +65,16 @@ fn add_variant_to_accumulator(\n ) -> Option<()> {\n     let db = ctx.db();\n     let InFile { file_id, value: enum_node } = adt.source(db)?.original_ast_node(db)?;\n-    let enum_indent = IndentLevel::from_node(&enum_node.syntax());\n-\n-    let variant_list = enum_node.variant_list()?;\n-    let offset = variant_list.syntax().text_range().end() - TextSize::of('}');\n-    let empty_enum = variant_list.variants().next().is_none();\n \n+    let variant = make::variant(make::name(&name_ref.text()), None);\n     acc.add(\n         AssistId(\"generate_enum_variant\", AssistKind::Generate),\n         \"Generate variant\",\n         target,\n         |builder| {\n             builder.edit_file(file_id.original_file(db));\n-            let text = format!(\n-                \"{maybe_newline}{indent_1}{name},\\n{enum_indent}\",\n-                maybe_newline = if empty_enum { \"\\n\" } else { \"\" },\n-                indent_1 = IndentLevel(1),\n-                name = name_ref,\n-                enum_indent = enum_indent\n-            );\n-            builder.insert(offset, text)\n+            let node = builder.make_mut(enum_node);\n+            node.variant_list().map(|it| it.add_variant(variant.clone_for_update()));\n         },\n     )\n }"}]}