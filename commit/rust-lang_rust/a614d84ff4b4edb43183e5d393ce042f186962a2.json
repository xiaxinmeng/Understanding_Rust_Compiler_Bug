{"sha": "a614d84ff4b4edb43183e5d393ce042f186962a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2MTRkODRmZjRiNGVkYjQzMTgzZTVkMzkzY2UwNDJmMTg2OTYyYTI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-07T16:38:34Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-07T16:38:34Z"}, "message": "Automate rust-analyzer promotion", "tree": {"sha": "e954e38adb5ac1702f3c93cb08763af1a6a855bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e954e38adb5ac1702f3c93cb08763af1a6a855bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a614d84ff4b4edb43183e5d393ce042f186962a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a614d84ff4b4edb43183e5d393ce042f186962a2", "html_url": "https://github.com/rust-lang/rust/commit/a614d84ff4b4edb43183e5d393ce042f186962a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a614d84ff4b4edb43183e5d393ce042f186962a2/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "faa65d7856314d60e504ebd976a1162342d3b376", "url": "https://api.github.com/repos/rust-lang/rust/commits/faa65d7856314d60e504ebd976a1162342d3b376", "html_url": "https://github.com/rust-lang/rust/commit/faa65d7856314d60e504ebd976a1162342d3b376"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "8844fa2168a9f4229c046ca92f2ee68e31c37c78", "filename": "xtask/src/not_bash.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a614d84ff4b4edb43183e5d393ce042f186962a2/xtask%2Fsrc%2Fnot_bash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a614d84ff4b4edb43183e5d393ce042f186962a2/xtask%2Fsrc%2Fnot_bash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fnot_bash.rs?ref=a614d84ff4b4edb43183e5d393ce042f186962a2", "patch": "@@ -153,7 +153,17 @@ fn run_process_inner(cmd: &str, echo: bool, stdin: Option<&[u8]>) -> Result<Stri\n \n // FIXME: some real shell lexing here\n fn shelx(cmd: &str) -> Vec<String> {\n-    cmd.split_whitespace().map(|it| it.to_string()).collect()\n+    let mut res = Vec::new();\n+    for (string_piece, in_quotes) in cmd.split('\\'').zip([false, true].iter().copied().cycle()) {\n+        if in_quotes {\n+            res.push(string_piece.to_string())\n+        } else {\n+            if !string_piece.is_empty() {\n+                res.extend(string_piece.split_ascii_whitespace().map(|it| it.to_string()))\n+            }\n+        }\n+    }\n+    res\n }\n \n struct Env {"}, {"sha": "170cfee9fe8e40e57552579ac4e5b075ae116362", "filename": "xtask/src/release.rs", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/a614d84ff4b4edb43183e5d393ce042f186962a2/xtask%2Fsrc%2Frelease.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a614d84ff4b4edb43183e5d393ce042f186962a2/xtask%2Fsrc%2Frelease.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Frelease.rs?ref=a614d84ff4b4edb43183e5d393ce042f186962a2", "patch": "@@ -1,6 +1,6 @@\n use crate::{\n     codegen, is_release_tag,\n-    not_bash::{date_iso, fs2, run},\n+    not_bash::{date_iso, fs2, pushd, run},\n     project_root, Mode, Result,\n };\n \n@@ -76,9 +76,25 @@ pub struct PromoteCmd {\n \n impl PromoteCmd {\n     pub fn run(self) -> Result<()> {\n-        run!(\"git switch release\")?;\n+        let _dir = pushd(\"../rust-rust-analyzer\");\n+        run!(\"git switch master\")?;\n         run!(\"git fetch upstream\")?;\n-        run!(\"git reset --hard upstream/release\")?;\n+        run!(\"git reset --hard upstream/master\")?;\n+        run!(\"git submodule update --recursive\")?;\n+\n+        let branch = format!(\"rust-analyzer-{}\", date_iso()?);\n+        run!(\"git switch -c {}\", branch)?;\n+        {\n+            let _dir = pushd(\"src/tools/rust-analyzer\");\n+            run!(\"git fetch origin\")?;\n+            run!(\"git reset --hard origin/release\")?;\n+        }\n+        run!(\"git add src/tools/rust-analyzer\")?;\n+        run!(\"git commit -m':arrow_up: rust-analyzer'\")?;\n+        if !self.dry_run {\n+            run!(\"git push\")?;\n+            run!(\"xdg-open https://github.com/matklad/rust/pull/new/{}\", branch)?;\n+        }\n         Ok(())\n     }\n }"}]}