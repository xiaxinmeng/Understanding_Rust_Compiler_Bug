{"sha": "a1bb10e9b805d3bd60d7c47dc453c011478245df", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExYmIxMGU5YjgwNWQzYmQ2MGQ3YzQ3ZGM0NTNjMDExNDc4MjQ1ZGY=", "commit": {"author": {"name": "Nathan Whitaker", "email": "nathan.whitaker01@gmail.com", "date": "2020-09-22T16:23:22Z"}, "committer": {"name": "Nathan Whitaker", "email": "nathan.whitaker01@gmail.com", "date": "2020-10-26T22:19:48Z"}, "message": "Remove lint from clippy", "tree": {"sha": "755b2e91ccde27d81afe3092a6ac9a0b13ef98c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/755b2e91ccde27d81afe3092a6ac9a0b13ef98c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1bb10e9b805d3bd60d7c47dc453c011478245df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1bb10e9b805d3bd60d7c47dc453c011478245df", "html_url": "https://github.com/rust-lang/rust/commit/a1bb10e9b805d3bd60d7c47dc453c011478245df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1bb10e9b805d3bd60d7c47dc453c011478245df/comments", "author": {"login": "nathanwhit", "id": 17734409, "node_id": "MDQ6VXNlcjE3NzM0NDA5", "avatar_url": "https://avatars.githubusercontent.com/u/17734409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathanwhit", "html_url": "https://github.com/nathanwhit", "followers_url": "https://api.github.com/users/nathanwhit/followers", "following_url": "https://api.github.com/users/nathanwhit/following{/other_user}", "gists_url": "https://api.github.com/users/nathanwhit/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathanwhit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathanwhit/subscriptions", "organizations_url": "https://api.github.com/users/nathanwhit/orgs", "repos_url": "https://api.github.com/users/nathanwhit/repos", "events_url": "https://api.github.com/users/nathanwhit/events{/privacy}", "received_events_url": "https://api.github.com/users/nathanwhit/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nathanwhit", "id": 17734409, "node_id": "MDQ6VXNlcjE3NzM0NDA5", "avatar_url": "https://avatars.githubusercontent.com/u/17734409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathanwhit", "html_url": "https://github.com/nathanwhit", "followers_url": "https://api.github.com/users/nathanwhit/followers", "following_url": "https://api.github.com/users/nathanwhit/following{/other_user}", "gists_url": "https://api.github.com/users/nathanwhit/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathanwhit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathanwhit/subscriptions", "organizations_url": "https://api.github.com/users/nathanwhit/orgs", "repos_url": "https://api.github.com/users/nathanwhit/repos", "events_url": "https://api.github.com/users/nathanwhit/events{/privacy}", "received_events_url": "https://api.github.com/users/nathanwhit/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df855321126580ace6e3022372991c725d3e1b0a", "url": "https://api.github.com/repos/rust-lang/rust/commits/df855321126580ace6e3022372991c725d3e1b0a", "html_url": "https://github.com/rust-lang/rust/commit/df855321126580ace6e3022372991c725d3e1b0a"}], "stats": {"total": 143, "additions": 3, "deletions": 140}, "files": [{"sha": "fc4dca5042b2a0a8e491c1383d330f18ae0845d9", "filename": ".github/driver.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a1bb10e9b805d3bd60d7c47dc453c011478245df/.github%2Fdriver.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a1bb10e9b805d3bd60d7c47dc453c011478245df/.github%2Fdriver.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdriver.sh?ref=a1bb10e9b805d3bd60d7c47dc453c011478245df", "patch": "@@ -22,9 +22,9 @@ unset CARGO_MANIFEST_DIR\n \n # Run a lint and make sure it produces the expected output. It's also expected to exit with code 1\n # FIXME: How to match the clippy invocation in compile-test.rs?\n-./target/debug/clippy-driver -Dwarnings -Aunused -Zui-testing --emit metadata --crate-type bin tests/ui/cstring.rs 2> cstring.stderr && exit 1\n-sed -e \"s,tests/ui,\\$DIR,\" -e \"/= help/d\" cstring.stderr > normalized.stderr\n-diff normalized.stderr tests/ui/cstring.stderr\n+./target/debug/clippy-driver -Dwarnings -Aunused -Zui-testing --emit metadata --crate-type bin tests/ui/cast.rs 2> cast.stderr && exit 1\n+sed -e \"s,tests/ui,\\$DIR,\" -e \"/= help/d\" cast.stderr > normalized.stderr\n+diff normalized.stderr tests/ui/cast.stderr\n \n \n # make sure \"clippy-driver --rustc --arg\" and \"rustc --arg\" behave the same"}, {"sha": "b5ca63cefec4f7ff2ca85b980be0f148512c30fd", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=a1bb10e9b805d3bd60d7c47dc453c011478245df", "patch": "@@ -707,7 +707,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &methods::SKIP_WHILE_NEXT,\n         &methods::STRING_EXTEND_CHARS,\n         &methods::SUSPICIOUS_MAP,\n-        &methods::TEMPORARY_CSTRING_AS_PTR,\n         &methods::UNINIT_ASSUMED_INIT,\n         &methods::UNNECESSARY_FILTER_MAP,\n         &methods::UNNECESSARY_FOLD,\n@@ -1417,7 +1416,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&methods::SKIP_WHILE_NEXT),\n         LintId::of(&methods::STRING_EXTEND_CHARS),\n         LintId::of(&methods::SUSPICIOUS_MAP),\n-        LintId::of(&methods::TEMPORARY_CSTRING_AS_PTR),\n         LintId::of(&methods::UNINIT_ASSUMED_INIT),\n         LintId::of(&methods::UNNECESSARY_FILTER_MAP),\n         LintId::of(&methods::UNNECESSARY_FOLD),\n@@ -1765,7 +1763,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&mem_replace::MEM_REPLACE_WITH_UNINIT),\n         LintId::of(&methods::CLONE_DOUBLE_REF),\n         LintId::of(&methods::ITERATOR_STEP_BY_ZERO),\n-        LintId::of(&methods::TEMPORARY_CSTRING_AS_PTR),\n         LintId::of(&methods::UNINIT_ASSUMED_INIT),\n         LintId::of(&methods::ZST_OFFSET),\n         LintId::of(&minmax::MIN_MAX),"}, {"sha": "d250bfd71e93661424ab1a598ac9c5cdf99c849e", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 0, "deletions": 56, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=a1bb10e9b805d3bd60d7c47dc453c011478245df", "patch": "@@ -798,40 +798,6 @@ declare_clippy_lint! {\n     \"using a single-character str where a char could be used, e.g., `_.split(\\\"x\\\")`\"\n }\n \n-declare_clippy_lint! {\n-    /// **What it does:** Checks for getting the inner pointer of a temporary\n-    /// `CString`.\n-    ///\n-    /// **Why is this bad?** The inner pointer of a `CString` is only valid as long\n-    /// as the `CString` is alive.\n-    ///\n-    /// **Known problems:** None.\n-    ///\n-    /// **Example:**\n-    /// ```rust\n-    /// # use std::ffi::CString;\n-    /// # fn call_some_ffi_func(_: *const i8) {}\n-    /// #\n-    /// let c_str = CString::new(\"foo\").unwrap().as_ptr();\n-    /// unsafe {\n-    ///     call_some_ffi_func(c_str);\n-    /// }\n-    /// ```\n-    /// Here `c_str` points to a freed address. The correct use would be:\n-    /// ```rust\n-    /// # use std::ffi::CString;\n-    /// # fn call_some_ffi_func(_: *const i8) {}\n-    /// #\n-    /// let c_str = CString::new(\"foo\").unwrap();\n-    /// unsafe {\n-    ///     call_some_ffi_func(c_str.as_ptr());\n-    /// }\n-    /// ```\n-    pub TEMPORARY_CSTRING_AS_PTR,\n-    correctness,\n-    \"getting the inner pointer of a temporary `CString`\"\n-}\n-\n declare_clippy_lint! {\n     /// **What it does:** Checks for calling `.step_by(0)` on iterators which panics.\n     ///\n@@ -1406,7 +1372,6 @@ declare_lint_pass!(Methods => [\n     SINGLE_CHAR_PATTERN,\n     SINGLE_CHAR_PUSH_STR,\n     SEARCH_IS_SOME,\n-    TEMPORARY_CSTRING_AS_PTR,\n     FILTER_NEXT,\n     SKIP_WHILE_NEXT,\n     FILTER_MAP,\n@@ -1490,7 +1455,6 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n                 lint_search_is_some(cx, expr, \"rposition\", arg_lists[1], arg_lists[0], method_spans[1])\n             },\n             [\"extend\", ..] => lint_extend(cx, expr, arg_lists[0]),\n-            [\"as_ptr\", \"unwrap\" | \"expect\"] => lint_cstring_as_ptr(cx, expr, &arg_lists[1][0], &arg_lists[0][0]),\n             [\"nth\", \"iter\"] => lint_iter_nth(cx, expr, &arg_lists, false),\n             [\"nth\", \"iter_mut\"] => lint_iter_nth(cx, expr, &arg_lists, true),\n             [\"nth\", ..] => lint_iter_nth_zero(cx, expr, arg_lists[0]),\n@@ -2207,26 +2171,6 @@ fn lint_extend(cx: &LateContext<'_>, expr: &hir::Expr<'_>, args: &[hir::Expr<'_>\n     }\n }\n \n-fn lint_cstring_as_ptr(cx: &LateContext<'_>, expr: &hir::Expr<'_>, source: &hir::Expr<'_>, unwrap: &hir::Expr<'_>) {\n-    if_chain! {\n-        let source_type = cx.typeck_results().expr_ty(source);\n-        if let ty::Adt(def, substs) = source_type.kind();\n-        if cx.tcx.is_diagnostic_item(sym!(result_type), def.did);\n-        if match_type(cx, substs.type_at(0), &paths::CSTRING);\n-        then {\n-            span_lint_and_then(\n-                cx,\n-                TEMPORARY_CSTRING_AS_PTR,\n-                expr.span,\n-                \"you are getting the inner pointer of a temporary `CString`\",\n-                |diag| {\n-                    diag.note(\"that pointer will be invalid outside this expression\");\n-                    diag.span_help(unwrap.span, \"assign the `CString` to a variable to extend its lifetime\");\n-                });\n-        }\n-    }\n-}\n-\n fn lint_iter_cloned_collect<'tcx>(cx: &LateContext<'tcx>, expr: &hir::Expr<'_>, iter_args: &'tcx [hir::Expr<'_>]) {\n     if_chain! {\n         if is_type_diagnostic_item(cx, cx.typeck_results().expr_ty(expr), sym!(vec_type));"}, {"sha": "7566da80982a0657c3e7dba2be1d9e33f4e07243", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1bb10e9b805d3bd60d7c47dc453c011478245df/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=a1bb10e9b805d3bd60d7c47dc453c011478245df", "patch": "@@ -21,7 +21,6 @@ pub const CLONE_TRAIT_METHOD: [&str; 4] = [\"core\", \"clone\", \"Clone\", \"clone\"];\n pub const CMP_MAX: [&str; 3] = [\"core\", \"cmp\", \"max\"];\n pub const CMP_MIN: [&str; 3] = [\"core\", \"cmp\", \"min\"];\n pub const COW: [&str; 3] = [\"alloc\", \"borrow\", \"Cow\"];\n-pub const CSTRING: [&str; 4] = [\"std\", \"ffi\", \"c_str\", \"CString\"];\n pub const CSTRING_AS_C_STR: [&str; 5] = [\"std\", \"ffi\", \"c_str\", \"CString\", \"as_c_str\"];\n pub const DEFAULT_TRAIT: [&str; 3] = [\"core\", \"default\", \"Default\"];\n pub const DEFAULT_TRAIT_METHOD: [&str; 4] = [\"core\", \"default\", \"Default\", \"default\"];"}, {"sha": "dcbb8a6a31da9d6583304270f55048f1f6b10ad5", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a1bb10e9b805d3bd60d7c47dc453c011478245df/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1bb10e9b805d3bd60d7c47dc453c011478245df/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=a1bb10e9b805d3bd60d7c47dc453c011478245df", "patch": "@@ -2258,13 +2258,6 @@ vec![\n         deprecation: None,\n         module: \"temporary_assignment\",\n     },\n-    Lint {\n-        name: \"temporary_cstring_as_ptr\",\n-        group: \"correctness\",\n-        desc: \"getting the inner pointer of a temporary `CString`\",\n-        deprecation: None,\n-        module: \"methods\",\n-    },\n     Lint {\n         name: \"to_digit_is_some\",\n         group: \"style\","}, {"sha": "6cdd6b4ff6e77671afb525e01d9f5398ad536a0e", "filename": "tests/ui/cstring.rs", "status": "removed", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/df855321126580ace6e3022372991c725d3e1b0a/tests%2Fui%2Fcstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df855321126580ace6e3022372991c725d3e1b0a/tests%2Fui%2Fcstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcstring.rs?ref=df855321126580ace6e3022372991c725d3e1b0a", "patch": "@@ -1,24 +0,0 @@\n-#![deny(clippy::temporary_cstring_as_ptr)]\n-\n-fn main() {}\n-\n-fn temporary_cstring() {\n-    use std::ffi::CString;\n-\n-    CString::new(\"foo\").unwrap().as_ptr();\n-    CString::new(\"foo\").expect(\"dummy\").as_ptr();\n-}\n-\n-mod issue4375 {\n-    use std::ffi::CString;\n-    use std::os::raw::c_char;\n-\n-    extern \"C\" {\n-        fn foo(data: *const c_char);\n-    }\n-\n-    pub fn bar(v: &[u8]) {\n-        let cstr = CString::new(v);\n-        unsafe { foo(cstr.unwrap().as_ptr()) }\n-    }\n-}"}, {"sha": "87cb29be57758a3f9679a2d95cebd4fe2caf321a", "filename": "tests/ui/cstring.stderr", "status": "removed", "additions": 0, "deletions": 46, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/df855321126580ace6e3022372991c725d3e1b0a/tests%2Fui%2Fcstring.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/df855321126580ace6e3022372991c725d3e1b0a/tests%2Fui%2Fcstring.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcstring.stderr?ref=df855321126580ace6e3022372991c725d3e1b0a", "patch": "@@ -1,46 +0,0 @@\n-error: you are getting the inner pointer of a temporary `CString`\n-  --> $DIR/cstring.rs:8:5\n-   |\n-LL |     CString::new(\"foo\").unwrap().as_ptr();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-note: the lint level is defined here\n-  --> $DIR/cstring.rs:1:9\n-   |\n-LL | #![deny(clippy::temporary_cstring_as_ptr)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   = note: that pointer will be invalid outside this expression\n-help: assign the `CString` to a variable to extend its lifetime\n-  --> $DIR/cstring.rs:8:5\n-   |\n-LL |     CString::new(\"foo\").unwrap().as_ptr();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: you are getting the inner pointer of a temporary `CString`\n-  --> $DIR/cstring.rs:9:5\n-   |\n-LL |     CString::new(\"foo\").expect(\"dummy\").as_ptr();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: that pointer will be invalid outside this expression\n-help: assign the `CString` to a variable to extend its lifetime\n-  --> $DIR/cstring.rs:9:5\n-   |\n-LL |     CString::new(\"foo\").expect(\"dummy\").as_ptr();\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: you are getting the inner pointer of a temporary `CString`\n-  --> $DIR/cstring.rs:22:22\n-   |\n-LL |         unsafe { foo(cstr.unwrap().as_ptr()) }\n-   |                      ^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: that pointer will be invalid outside this expression\n-help: assign the `CString` to a variable to extend its lifetime\n-  --> $DIR/cstring.rs:22:22\n-   |\n-LL |         unsafe { foo(cstr.unwrap().as_ptr()) }\n-   |                      ^^^^^^^^^^^^^\n-\n-error: aborting due to 3 previous errors\n-"}]}