{"sha": "155735aa5180c23bddd6fed1f6e659f9a0aaa346", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1NTczNWFhNTE4MGMyM2JkZGQ2ZmVkMWY2ZTY1OWY5YTBhYWEzNDY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-03-14T05:20:51Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-03-14T22:07:36Z"}, "message": "rustbuild: Fix cross compiling to FreeBSD\n\nThis commit fixes our support for cross compiling a compiler to run on FreeBSD.\nOver the weekend I managed to get a cross compiler from Linux to FreeBSD [1]\nwhich I hope to soon use to start producing FreeBSD nightly compilers. With the\n`make dist` support added in #32237 we should be able to produce standard\nrustc/rust-std packages for FreeBSD through a new slave with this cross compiler.\n\nCurrently, however, we don't \"Just Work\" when cross compiling FreeBSD and a\nnumber of changes were required (part of this PR). They include:\n\n* A few build fixes were needed in LLVM. Our own branch has been rebased on the\n  actual 3.8 release and I applied one extra commit [2] which contains two fixes:\n\n  1. The LLVM CMake build system passes the `-Wl,-z,defs` flag on many\n     platforms, but *not* when `CMAKE_SYSTEM_NAME` is \"FreeBSD\". Unfortunately\n     this doesn't take into account when we're cross compiling, and as predicted\n     the build will fail if `-Wl,-z,defs` is passed (see [3] for more info). To\n     fix this we test `TARGET_TRIPLE` instead of the `CMAKE_SYSTEM_NAME` which\n     is what we're compiling for which fixes the problem.\n  2. The `PATH_MAX` constant is apparently defined in a different location than\n     many other Unix systems, so a file which required this just needed some\n     help to keep compiling.\n\n* Support for compiling compiler-rt with CMake has been added to rustbuild. It\n  looks like it just emulates Linux in what it compiles as it didn't seem to\n  naturally produce anything else... At least the architecture is right, so\n  seems good for now at least!\n\n[1]: https://github.com/alexcrichton/port-of-rust/blob/master/prebuilt/freebsd/Dockerfile\n[2]: https://github.com/rust-lang/llvm/commit/be89e4b5\n[3]: https://bugs.webkit.org/show_bug.cgi?id=138420", "tree": {"sha": "beca05d6c53c40c6b6dff411834cfc50c9965d63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/beca05d6c53c40c6b6dff411834cfc50c9965d63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/155735aa5180c23bddd6fed1f6e659f9a0aaa346", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/155735aa5180c23bddd6fed1f6e659f9a0aaa346", "html_url": "https://github.com/rust-lang/rust/commit/155735aa5180c23bddd6fed1f6e659f9a0aaa346", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/155735aa5180c23bddd6fed1f6e659f9a0aaa346/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5880fff990ced4815130582e68c9036d7cf7dcb", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5880fff990ced4815130582e68c9036d7cf7dcb", "html_url": "https://github.com/rust-lang/rust/commit/d5880fff990ced4815130582e68c9036d7cf7dcb"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "52595d3638c27fe2a47dd2a220b040595a3d4c2c", "filename": "src/bootstrap/build/native.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/155735aa5180c23bddd6fed1f6e659f9a0aaa346/src%2Fbootstrap%2Fbuild%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/155735aa5180c23bddd6fed1f6e659f9a0aaa346/src%2Fbootstrap%2Fbuild%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fnative.rs?ref=155735aa5180c23bddd6fed1f6e659f9a0aaa346", "patch": "@@ -113,7 +113,8 @@ pub fn compiler_rt(build: &Build, target: &str) {\n     let dst = build.compiler_rt_out(target);\n     let arch = target.split('-').next().unwrap();\n     let mode = if build.config.rust_optimize {\"Release\"} else {\"Debug\"};\n-    let (dir, build_target, libname) = if target.contains(\"linux\") {\n+    let (dir, build_target, libname) = if target.contains(\"linux\") ||\n+                                          target.contains(\"freebsd\") {\n         let os = if target.contains(\"android\") {\"-android\"} else {\"\"};\n         let arch = if arch.starts_with(\"arm\") && target.contains(\"eabihf\") {\n             \"armhf\""}, {"sha": "be89e4b532fba8544f629c257460b63fe26c680d", "filename": "src/llvm", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fllvm?ref=155735aa5180c23bddd6fed1f6e659f9a0aaa346", "patch": "@@ -1 +1 @@\n-Subproject commit 69ef168544e4f15b793dd35d272008fde9a6e835\n+Subproject commit be89e4b532fba8544f629c257460b63fe26c680d"}, {"sha": "c6b01def198ad1cf45d73ecc24729087dcb371ea", "filename": "src/rustllvm/llvm-auto-clean-trigger", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/155735aa5180c23bddd6fed1f6e659f9a0aaa346/src%2Frustllvm%2Fllvm-auto-clean-trigger", "raw_url": "https://github.com/rust-lang/rust/raw/155735aa5180c23bddd6fed1f6e659f9a0aaa346/src%2Frustllvm%2Fllvm-auto-clean-trigger", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2Fllvm-auto-clean-trigger?ref=155735aa5180c23bddd6fed1f6e659f9a0aaa346", "patch": "@@ -1,4 +1,4 @@\n # If this file is modified, then llvm will be forcibly cleaned and then rebuilt.\n # The actual contents of this file do not matter, but to trigger a change on the\n # build bots then the contents should be changed so git updates the mtime.\n-2016-02-20\n+2016-03-13"}]}