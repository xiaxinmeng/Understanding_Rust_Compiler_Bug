{"sha": "0da85d62283257516a1dab97f7156a4e0cd96266", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYTg1ZDYyMjgzMjU3NTE2YTFkYWI5N2Y3MTU2YTRlMGNkOTYyNjY=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-11-09T00:06:22Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-11-09T00:06:22Z"}, "message": "rustc_metadata: don't let LLVM confuse rmeta blobs for COFF object files.", "tree": {"sha": "4a96732175e8a8d74e9f94267b4acf62f6e93949", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a96732175e8a8d74e9f94267b4acf62f6e93949"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0da85d62283257516a1dab97f7156a4e0cd96266", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0da85d62283257516a1dab97f7156a4e0cd96266", "html_url": "https://github.com/rust-lang/rust/commit/0da85d62283257516a1dab97f7156a4e0cd96266", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0da85d62283257516a1dab97f7156a4e0cd96266/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e346646e93cc243567e27bb0f4e8716d56ad1f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e346646e93cc243567e27bb0f4e8716d56ad1f1", "html_url": "https://github.com/rust-lang/rust/commit/9e346646e93cc243567e27bb0f4e8716d56ad1f1"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "81e7ef64e975a88363ec49e416858a3d0bd5083f", "filename": "src/librustc_codegen_ssa/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Flibrustc_codegen_ssa%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Flibrustc_codegen_ssa%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Flib.rs?ref=0da85d62283257516a1dab97f7156a4e0cd96266", "patch": "@@ -59,7 +59,8 @@ pub struct ModuleCodegen<M> {\n     pub kind: ModuleKind,\n }\n \n-pub const METADATA_FILENAME: &str = \"rust.metadata.bin\";\n+// FIXME(eddyb) maybe include the crate name in this?\n+pub const METADATA_FILENAME: &str = \"lib.rmeta\";\n pub const RLIB_BYTECODE_EXTENSION: &str = \"bc.z\";\n \n "}, {"sha": "990a3d984b225ef8776c23788f89eb682985ce7d", "filename": "src/librustc_metadata/rmeta/mod.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Flibrustc_metadata%2Frmeta%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Flibrustc_metadata%2Frmeta%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Frmeta%2Fmod.rs?ref=0da85d62283257516a1dab97f7156a4e0cd96266", "patch": "@@ -37,18 +37,15 @@ crate fn rustc_version() -> String {\n /// Metadata encoding version.\n /// N.B., increment this if you change the format of metadata such that\n /// the rustc version can't be found to compare with `rustc_version()`.\n-const METADATA_VERSION: u8 = 4;\n+const METADATA_VERSION: u8 = 5;\n \n /// Metadata header which includes `METADATA_VERSION`.\n-/// To get older versions of rustc to ignore this metadata,\n-/// there are 4 zero bytes at the start, which are treated\n-/// as a length of 0 by old compilers.\n ///\n /// This header is followed by the position of the `CrateRoot`,\n /// which is encoded as a 32-bit big-endian unsigned integer,\n /// and further followed by the rustc version string.\n-crate const METADATA_HEADER: &[u8; 12] =\n-    &[0, 0, 0, 0, b'r', b'u', b's', b't', 0, 0, 0, METADATA_VERSION];\n+crate const METADATA_HEADER: &[u8; 8] =\n+    &[b'r', b'u', b's', b't', 0, 0, 0, METADATA_VERSION];\n \n /// Additional metadata for a `Lazy<T>` where `T` may not be `Sized`,\n /// e.g. for `Lazy<[T]>`, this is the length (count of `T` values)."}, {"sha": "c75713c3ee53d1798915a4abfd36c4144a0669ec", "filename": "src/test/run-make-fulldeps/invalid-library/Makefile", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Ftest%2Frun-make-fulldeps%2Finvalid-library%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/0da85d62283257516a1dab97f7156a4e0cd96266/src%2Ftest%2Frun-make-fulldeps%2Finvalid-library%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Finvalid-library%2FMakefile?ref=0da85d62283257516a1dab97f7156a4e0cd96266", "patch": "@@ -1,6 +1,6 @@\n -include ../tools.mk\n \n all:\n-\ttouch $(TMPDIR)/rust.metadata.bin\n-\t$(AR) crus $(TMPDIR)/libfoo-ffffffff-1.0.rlib $(TMPDIR)/rust.metadata.bin\n+\ttouch $(TMPDIR)/lib.rmeta\n+\t$(AR) crus $(TMPDIR)/libfoo-ffffffff-1.0.rlib $(TMPDIR)/lib.rmeta\n \t$(RUSTC) foo.rs 2>&1 | $(CGREP) \"can't find crate for\""}]}