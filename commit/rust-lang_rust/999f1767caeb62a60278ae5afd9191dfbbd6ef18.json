{"sha": "999f1767caeb62a60278ae5afd9191dfbbd6ef18", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OWYxNzY3Y2FlYjYyYTYwMjc4YWU1YWZkOTE5MWRmYmJkNmVmMTg=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "arielb1@mail.tau.ac.il", "date": "2016-02-07T20:46:39Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2016-02-19T23:38:27Z"}, "message": "add -Z mir-opt-level to disable MIR optimizations\n\nsetting -Z mir-opt-level=0 will disable all MIR optimizations\nfor easier debugging", "tree": {"sha": "9eeb51bcded945389e162dcad5ff600e12108456", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9eeb51bcded945389e162dcad5ff600e12108456"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/999f1767caeb62a60278ae5afd9191dfbbd6ef18", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/999f1767caeb62a60278ae5afd9191dfbbd6ef18", "html_url": "https://github.com/rust-lang/rust/commit/999f1767caeb62a60278ae5afd9191dfbbd6ef18", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/999f1767caeb62a60278ae5afd9191dfbbd6ef18/comments", "author": null, "committer": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "addc653da5fa6d0541c445f32350d95d84f3de57", "url": "https://api.github.com/repos/rust-lang/rust/commits/addc653da5fa6d0541c445f32350d95d84f3de57", "html_url": "https://github.com/rust-lang/rust/commit/addc653da5fa6d0541c445f32350d95d84f3de57"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "f835613cfcbb998d29cbdee60b35e70b1fe745f9", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/999f1767caeb62a60278ae5afd9191dfbbd6ef18/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f1767caeb62a60278ae5afd9191dfbbd6ef18/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=999f1767caeb62a60278ae5afd9191dfbbd6ef18", "patch": "@@ -138,6 +138,7 @@ pub struct Options {\n     pub no_trans: bool,\n     pub error_format: ErrorOutputType,\n     pub treat_err_as_bug: bool,\n+    pub mir_opt_level: usize,\n \n     /// if true, build up the dep-graph\n     pub build_dep_graph: bool,\n@@ -254,6 +255,7 @@ pub fn basic_options() -> Options {\n         parse_only: false,\n         no_trans: false,\n         treat_err_as_bug: false,\n+        mir_opt_level: 1,\n         build_dep_graph: false,\n         dump_dep_graph: false,\n         no_analysis: false,\n@@ -655,6 +657,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n           \"show spans for compiler debugging (expr|pat|ty)\"),\n     print_trans_items: Option<String> = (None, parse_opt_string,\n           \"print the result of the translation item collection pass\"),\n+    mir_opt_level: Option<usize> = (None, parse_opt_uint,\n+          \"set the MIR optimization level (0-3)\"),\n }\n \n pub fn default_lib_output() -> CrateType {\n@@ -988,6 +992,7 @@ pub fn build_session_options(matches: &getopts::Matches) -> Options {\n     let parse_only = debugging_opts.parse_only;\n     let no_trans = debugging_opts.no_trans;\n     let treat_err_as_bug = debugging_opts.treat_err_as_bug;\n+    let mir_opt_level = debugging_opts.mir_opt_level.unwrap_or(1);\n     let incremental_compilation = debugging_opts.incr_comp;\n     let dump_dep_graph = debugging_opts.dump_dep_graph;\n     let no_analysis = debugging_opts.no_analysis;\n@@ -1166,6 +1171,7 @@ pub fn build_session_options(matches: &getopts::Matches) -> Options {\n         parse_only: parse_only,\n         no_trans: no_trans,\n         treat_err_as_bug: treat_err_as_bug,\n+        mir_opt_level: mir_opt_level,\n         build_dep_graph: incremental_compilation || dump_dep_graph,\n         dump_dep_graph: dump_dep_graph,\n         no_analysis: no_analysis,"}, {"sha": "58b6d69ba5c1a85b293667b899d0ceee882dd3ac", "filename": "src/librustc_mir/mir_map.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/999f1767caeb62a60278ae5afd9191dfbbd6ef18/src%2Flibrustc_mir%2Fmir_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f1767caeb62a60278ae5afd9191dfbbd6ef18/src%2Flibrustc_mir%2Fmir_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmir_map.rs?ref=999f1767caeb62a60278ae5afd9191dfbbd6ef18", "patch": "@@ -148,10 +148,11 @@ impl<'a, 'm, 'tcx> Visitor<'tcx> for InnerDump<'a,'m,'tcx> {\n \n         match build_mir(Cx::new(&infcx), implicit_arg_tys, id, span, decl, body) {\n             Ok(mut mir) => {\n-                simplify_cfg::SimplifyCfg::new().run_on_mir(&mut mir, self.tcx);\n                 type_check::TypeckMir::new(&infcx).run_on_mir(&mut mir, self.tcx);\n                 no_landing_pads::NoLandingPads.run_on_mir(&mut mir, self.tcx);\n-\n+                if self.tcx.sess.opts.mir_opt_level > 0 {\n+                    simplify_cfg::SimplifyCfg::new().run_on_mir(&mut mir, self.tcx);\n+                }\n                 let meta_item_list = self.attr\n                                          .iter()\n                                          .flat_map(|a| a.meta_item_list())"}]}