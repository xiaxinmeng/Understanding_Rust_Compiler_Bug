{"sha": "af175ddcdcfeddf6814b67bce8abb68a954981eb", "node_id": "C_kwDOAAsO6NoAKGFmMTc1ZGRjZGNmZWRkZjY4MTRiNjdiY2U4YWJiNjhhOTU0OTgxZWI", "commit": {"author": {"name": "Zachary S", "email": "zasample18+github@gmail.com", "date": "2022-08-07T05:02:25Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-03-15T12:10:35Z"}, "message": "Add test for async closure types.\n\n(rebased onto 6dfd8ae)", "tree": {"sha": "390db5f046ce6f87fda64042fa371d6a4e0917e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/390db5f046ce6f87fda64042fa371d6a4e0917e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af175ddcdcfeddf6814b67bce8abb68a954981eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af175ddcdcfeddf6814b67bce8abb68a954981eb", "html_url": "https://github.com/rust-lang/rust/commit/af175ddcdcfeddf6814b67bce8abb68a954981eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af175ddcdcfeddf6814b67bce8abb68a954981eb/comments", "author": {"login": "zachs18", "id": 8355914, "node_id": "MDQ6VXNlcjgzNTU5MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8355914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zachs18", "html_url": "https://github.com/zachs18", "followers_url": "https://api.github.com/users/zachs18/followers", "following_url": "https://api.github.com/users/zachs18/following{/other_user}", "gists_url": "https://api.github.com/users/zachs18/gists{/gist_id}", "starred_url": "https://api.github.com/users/zachs18/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zachs18/subscriptions", "organizations_url": "https://api.github.com/users/zachs18/orgs", "repos_url": "https://api.github.com/users/zachs18/repos", "events_url": "https://api.github.com/users/zachs18/events{/privacy}", "received_events_url": "https://api.github.com/users/zachs18/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6746a08b442d25dc63a90ace1682ebd9ec9b50b8", "url": "https://api.github.com/repos/rust-lang/rust/commits/6746a08b442d25dc63a90ace1682ebd9ec9b50b8", "html_url": "https://github.com/rust-lang/rust/commit/6746a08b442d25dc63a90ace1682ebd9ec9b50b8"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "de3d995c9a06d643d5fc497c5b0b15d880ee865b", "filename": "crates/hir-def/src/body/pretty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af175ddcdcfeddf6814b67bce8abb68a954981eb/crates%2Fhir-def%2Fsrc%2Fbody%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af175ddcdcfeddf6814b67bce8abb68a954981eb/crates%2Fhir-def%2Fsrc%2Fbody%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fbody%2Fpretty.rs?ref=af175ddcdcfeddf6814b67bce8abb68a954981eb", "patch": "@@ -386,7 +386,7 @@ impl<'a> Printer<'a> {\n                         self.print_type_ref(ret_ty);\n                     }\n                     (None, ClosureKind::Async) => {\n-                        w!(self, \" -> impl Future<Output = {{unknown}}>\"); // FIXME(zachs18): {unknown} or ()?\n+                        w!(self, \" -> impl Future<Output = {{unknown}}>\");\n                     }\n                     (None, _) => {}\n                 }"}, {"sha": "4e9b1611fb2c7e71adbc51019e038396ec4346aa", "filename": "crates/hir-ty/src/tests/traits.rs", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/af175ddcdcfeddf6814b67bce8abb68a954981eb/crates%2Fhir-ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af175ddcdcfeddf6814b67bce8abb68a954981eb/crates%2Fhir-ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Ftests%2Ftraits.rs?ref=af175ddcdcfeddf6814b67bce8abb68a954981eb", "patch": "@@ -82,6 +82,46 @@ async fn test() {\n     );\n }\n \n+#[test]\n+fn infer_async_closure() {\n+    check_types(\n+        r#\"\n+//- minicore: future, option\n+async fn test() {\n+    let f = async move |x: i32| x + 42;\n+    f;\n+//  ^ |i32| -> impl Future<Output = i32>\n+    let a = f(4);\n+    a;\n+//  ^ impl Future<Output = i32>\n+    let x = a.await;\n+    x;\n+//  ^ i32\n+    let f = async move || 42;\n+    f;\n+//  ^ || -> impl Future<Output = i32>\n+    let a = f();\n+    a;\n+//  ^ impl Future<Output = i32>\n+    let x = a.await;\n+    x;\n+//  ^ i32\n+    let b = ((async move || {})()).await;\n+    b;\n+//  ^ ()\n+    let c = async move || {\n+        let y = None;\n+        y\n+    //  ^ Option<u64>\n+    };\n+    let _: Option<u64> = c().await;\n+    c;\n+//  ^ || -> impl Future<Output = Option<u64>>\n+}\n+\"#,\n+    );\n+}\n+\n #[test]\n fn auto_sized_async_block() {\n     check_no_mismatches("}]}