{"sha": "6713dde898ef81042a51d940d36150c52cb697b6", "node_id": "C_kwDOAAsO6NoAKDY3MTNkZGU4OThlZjgxMDQyYTUxZDk0MGQzNjE1MGM1MmNiNjk3YjY", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-07T22:20:08Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-07T22:20:08Z"}, "message": "diagnostics: suggest naming a field after failing to parse", "tree": {"sha": "b188e771ae70c770fa730a17d23cecd2855f6ef0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b188e771ae70c770fa730a17d23cecd2855f6ef0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6713dde898ef81042a51d940d36150c52cb697b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6713dde898ef81042a51d940d36150c52cb697b6", "html_url": "https://github.com/rust-lang/rust/commit/6713dde898ef81042a51d940d36150c52cb697b6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6713dde898ef81042a51d940d36150c52cb697b6/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d496a4f8bb26709e58ce8821de07f7078d2f615d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d496a4f8bb26709e58ce8821de07f7078d2f615d", "html_url": "https://github.com/rust-lang/rust/commit/d496a4f8bb26709e58ce8821de07f7078d2f615d"}], "stats": {"total": 32, "additions": 27, "deletions": 5}, "files": [{"sha": "f2765e4997ce4590ebfab14b743287f399a0ecc3", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6713dde898ef81042a51d940d36150c52cb697b6/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6713dde898ef81042a51d940d36150c52cb697b6/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=6713dde898ef81042a51d940d36150c52cb697b6", "patch": "@@ -3037,6 +3037,19 @@ impl<'a> Parser<'a> {\n                                 \",\",\n                                 Applicability::MachineApplicable,\n                             );\n+                        } else if is_shorthand\n+                            && (AssocOp::from_token(&self.token).is_some()\n+                                || matches!(&self.token.kind, token::OpenDelim(_))\n+                                || self.token.kind == token::Dot)\n+                        {\n+                            // Looks like they tried to write a shorthand, complex expression.\n+                            let ident = parsed_field.expect(\"is_shorthand implies Some\").ident;\n+                            e.span_suggestion(\n+                                ident.span.shrink_to_lo(),\n+                                \"try naming a field\",\n+                                &format!(\"{ident}: \"),\n+                                Applicability::HasPlaceholders,\n+                            );\n                         }\n                     }\n                     if !recover {"}, {"sha": "77335c64c212093ea59cc6ea39087bfe9adcced0", "filename": "src/test/ui/parser/issues/issue-52496.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6713dde898ef81042a51d940d36150c52cb697b6/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6713dde898ef81042a51d940d36150c52cb697b6/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr?ref=6713dde898ef81042a51d940d36150c52cb697b6", "patch": "@@ -8,8 +8,9 @@ error: expected one of `,`, `:`, or `}`, found `.`\n   --> $DIR/issue-52496.rs:8:22\n    |\n LL |     let _ = Foo { bar.into(), bat: -1, . };\n-   |             ---      ^ expected one of `,`, `:`, or `}`\n-   |             |\n+   |             ---   -  ^ expected one of `,`, `:`, or `}`\n+   |             |     |\n+   |             |     help: try naming a field: `bar:`\n    |             while parsing this struct\n \n error: expected identifier, found `.`"}, {"sha": "4737bc71860c24ef903af60947b32c449d636955", "filename": "src/test/ui/parser/issues/issue-62973.stderr", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6713dde898ef81042a51d940d36150c52cb697b6/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6713dde898ef81042a51d940d36150c52cb697b6/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr?ref=6713dde898ef81042a51d940d36150c52cb697b6", "patch": "@@ -24,11 +24,19 @@ error: expected one of `,`, `:`, or `}`, found `{`\n   --> $DIR/issue-62973.rs:6:8\n    |\n LL | fn p() { match s { v, E { [) {) }\n-   |        ^       -       -^ expected one of `,`, `:`, or `}`\n-   |        |       |       |\n-   |        |       |       help: `}` may belong here\n+   |        ^       -        ^ expected one of `,`, `:`, or `}`\n+   |        |       |\n    |        |       while parsing this struct\n    |        unclosed delimiter\n+   |\n+help: `}` may belong here\n+   |\n+LL | fn p() { match s { v, E} { [) {) }\n+   |                        +\n+help: try naming a field\n+   |\n+LL | fn p() { match s { v, E: E { [) {) }\n+   |                       ++\n \n error: struct literals are not allowed here\n   --> $DIR/issue-62973.rs:6:16"}]}