{"sha": "5634c8da02862653be557c6ab1242a6c9ce86ce8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2MzRjOGRhMDI4NjI2NTNiZTU1N2M2YWIxMjQyYTZjOWNlODZjZTg=", "commit": {"author": {"name": "ThibsG", "email": "Thibs@debian.com", "date": "2020-08-12T19:37:27Z"}, "committer": {"name": "ThibsG", "email": "Thibs@debian.com", "date": "2020-08-12T19:44:02Z"}, "message": "Fix: keep parenthesis for suggestion in `useless_conversion` lint", "tree": {"sha": "01a0b8ed405d58204d9d27f6eacca33f8a8420c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/01a0b8ed405d58204d9d27f6eacca33f8a8420c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5634c8da02862653be557c6ab1242a6c9ce86ce8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5634c8da02862653be557c6ab1242a6c9ce86ce8", "html_url": "https://github.com/rust-lang/rust/commit/5634c8da02862653be557c6ab1242a6c9ce86ce8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5634c8da02862653be557c6ab1242a6c9ce86ce8/comments", "author": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ed0a4ce5dd199c2abb1241fd59a5bdfb3bc5ee8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ed0a4ce5dd199c2abb1241fd59a5bdfb3bc5ee8", "html_url": "https://github.com/rust-lang/rust/commit/3ed0a4ce5dd199c2abb1241fd59a5bdfb3bc5ee8"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "4ab2b5e796deb75f7361fc466c9d69306e7c7db4", "filename": "clippy_lints/src/useless_conversion.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5634c8da02862653be557c6ab1242a6c9ce86ce8/clippy_lints%2Fsrc%2Fuseless_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5634c8da02862653be557c6ab1242a6c9ce86ce8/clippy_lints%2Fsrc%2Fuseless_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuseless_conversion.rs?ref=5634c8da02862653be557c6ab1242a6c9ce86ce8", "patch": "@@ -1,3 +1,4 @@\n+use crate::utils::sugg::Sugg;\n use crate::utils::{\n     get_parent_expr, is_type_diagnostic_item, match_def_path, match_trait_method, paths, snippet,\n     snippet_with_macro_callsite, span_lint_and_help, span_lint_and_sugg,\n@@ -158,7 +159,7 @@ impl<'tcx> LateLintPass<'tcx> for UselessConversion {\n                             if TyS::same_type(a, b);\n \n                             then {\n-                                let sugg = snippet(cx, args[0].span.source_callsite(), \"<expr>\").into_owned();\n+                                let sugg = Sugg::hir_with_macro_callsite(cx, &args[0], \"<expr>\").maybe_par();\n                                 let sugg_msg =\n                                     format!(\"consider removing `{}()`\", snippet(cx, path.span, \"From::from\"));\n                                 span_lint_and_sugg(\n@@ -167,7 +168,7 @@ impl<'tcx> LateLintPass<'tcx> for UselessConversion {\n                                     e.span,\n                                     \"useless conversion to the same type\",\n                                     &sugg_msg,\n-                                    sugg,\n+                                    sugg.to_string(),\n                                     Applicability::MachineApplicable, // snippet\n                                 );\n                             }"}, {"sha": "8a9b0cd3cf019466d3786f7be3eb08ceda2f0509", "filename": "tests/ui/useless_conversion.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_conversion.fixed?ref=5634c8da02862653be557c6ab1242a6c9ce86ce8", "patch": "@@ -64,4 +64,9 @@ fn main() {\n     let _ = \"\".lines();\n     let _ = vec![1, 2, 3].into_iter();\n     let _: String = format!(\"Hello {}\", \"world\");\n+\n+    // keep parenthesis around `a + b` for suggestion (see #4750)\n+    let a: i32 = 1;\n+    let b: i32 = 1;\n+    let _ = (a + b) * 3;\n }"}, {"sha": "4faa1572973bc0ff5df24d3c2fe392e49d219c0d", "filename": "tests/ui/useless_conversion.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_conversion.rs?ref=5634c8da02862653be557c6ab1242a6c9ce86ce8", "patch": "@@ -64,4 +64,9 @@ fn main() {\n     let _ = \"\".lines().into_iter();\n     let _ = vec![1, 2, 3].into_iter().into_iter();\n     let _: String = format!(\"Hello {}\", \"world\").into();\n+\n+    // keep parenthesis around `a + b` for suggestion (see #4750)\n+    let a: i32 = 1;\n+    let b: i32 = 1;\n+    let _ = i32::from(a + b) * 3;\n }"}, {"sha": "f1e880d2696c40c430e23e11f2a60aec52e5dc7f", "filename": "tests/ui/useless_conversion.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5634c8da02862653be557c6ab1242a6c9ce86ce8/tests%2Fui%2Fuseless_conversion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_conversion.stderr?ref=5634c8da02862653be557c6ab1242a6c9ce86ce8", "patch": "@@ -64,5 +64,11 @@ error: useless conversion to the same type\n LL |     let _: String = format!(\"Hello {}\", \"world\").into();\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider removing `.into()`: `format!(\"Hello {}\", \"world\")`\n \n-error: aborting due to 10 previous errors\n+error: useless conversion to the same type\n+  --> $DIR/useless_conversion.rs:71:13\n+   |\n+LL |     let _ = i32::from(a + b) * 3;\n+   |             ^^^^^^^^^^^^^^^^ help: consider removing `i32::from()`: `(a + b)`\n+\n+error: aborting due to 11 previous errors\n "}]}