{"sha": "1670fb93a671e01511429918eb80cd66493c0af4", "node_id": "C_kwDOAAsO6NoAKDE2NzBmYjkzYTY3MWUwMTUxMTQyOTkxOGViODBjZDY2NDkzYzBhZjQ", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2023-05-03T23:42:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-03T23:42:50Z"}, "message": "Rollup merge of #110970 - est31:test_dirs_relax, r=petrochenkov\n\ntidy: remove ENTRY_LIMIT maximum checking and set it to 900\n\nRemoves checking of `ENTRY_LIMIT` towards an actually reached maximum, and sets it to 900.\n\nThe number 900 is safely below github's limit of 1000 entries for a directory.\nPRs to move tests can still decrease the sizes of various directories,\nbut adjusting the limit won't be neccessary any more. In fact, such reduction PRs are a great idea so that no unrelated PR is hitting the limit: ideally there would always be a (manually maintained) safety margin between the actually reached maximum and `ENTRY_LIMIT`, for all directories.\n\nIn general, the limit is a bad tool to direct people to put tests into\nfitting directories because when those are available, usually the limit\nis not hit, while the limit is hit in directories that have a weak\nsubstructure themselves. I got into this situation myself when writing #110694: tests/ui/parser is hitting the limit, but has few directories of its own.\n\nSuggested by ```@petrochenkov``` in https://github.com/rust-lang/rust/pull/110694#discussion_r1177694339.\n\nr? ```@petrochenkov```", "tree": {"sha": "60788e7a249e11b982b240dbf6ba84b83399b952", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60788e7a249e11b982b240dbf6ba84b83399b952"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1670fb93a671e01511429918eb80cd66493c0af4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkUvF6CRBK7hj4Ov3rIwAA5ZIIABKnbIoePxela67CPEciZe2u\ngd8uvHg2WG03AxMjoSBeqx+sHlHUvbxIrezRero4k0fOnoac+C/T/TKa8Y6Dixm1\nnJNfbpyoClMwzDlZ2k7kSaXRLwRaZQUdyyQBl2F52mh3C99mr/idAzD8A0j2Xm44\nxP1nu8dduwT06WOXPuMdgQrCHRJnbvafas8uwvKg1U/2Q3pb/0Lejn4m3cZbtpRu\nNBa7pAjLlG1OR2HQzBZ7dCxq3aAdaaI/f15LwaDT3vIV72CPAzPn4ythiUKU/KNs\no49bVveEI9TzWbXA8c/yYclnXiLaZtBbjs+w+WHNzNcqXQ23QX6ctnzuTWApc0k=\n=ZSHE\n-----END PGP SIGNATURE-----\n", "payload": "tree 60788e7a249e11b982b240dbf6ba84b83399b952\nparent 09839bfdb1c76f4dd78899d813de12d40127fbee\nparent e498402bbcec45abe5ac5050b96e7a06c792cded\nauthor Manish Goregaokar <manishsmail@gmail.com> 1683157370 -0700\ncommitter GitHub <noreply@github.com> 1683157370 -0700\n\nRollup merge of #110970 - est31:test_dirs_relax, r=petrochenkov\n\ntidy: remove ENTRY_LIMIT maximum checking and set it to 900\n\nRemoves checking of `ENTRY_LIMIT` towards an actually reached maximum, and sets it to 900.\n\nThe number 900 is safely below github's limit of 1000 entries for a directory.\nPRs to move tests can still decrease the sizes of various directories,\nbut adjusting the limit won't be neccessary any more. In fact, such reduction PRs are a great idea so that no unrelated PR is hitting the limit: ideally there would always be a (manually maintained) safety margin between the actually reached maximum and `ENTRY_LIMIT`, for all directories.\n\nIn general, the limit is a bad tool to direct people to put tests into\nfitting directories because when those are available, usually the limit\nis not hit, while the limit is hit in directories that have a weak\nsubstructure themselves. I got into this situation myself when writing #110694: tests/ui/parser is hitting the limit, but has few directories of its own.\n\nSuggested by ```@petrochenkov``` in https://github.com/rust-lang/rust/pull/110694#discussion_r1177694339.\n\nr? ```@petrochenkov```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1670fb93a671e01511429918eb80cd66493c0af4", "html_url": "https://github.com/rust-lang/rust/commit/1670fb93a671e01511429918eb80cd66493c0af4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1670fb93a671e01511429918eb80cd66493c0af4/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09839bfdb1c76f4dd78899d813de12d40127fbee", "url": "https://api.github.com/repos/rust-lang/rust/commits/09839bfdb1c76f4dd78899d813de12d40127fbee", "html_url": "https://github.com/rust-lang/rust/commit/09839bfdb1c76f4dd78899d813de12d40127fbee"}, {"sha": "e498402bbcec45abe5ac5050b96e7a06c792cded", "url": "https://api.github.com/repos/rust-lang/rust/commits/e498402bbcec45abe5ac5050b96e7a06c792cded", "html_url": "https://github.com/rust-lang/rust/commit/e498402bbcec45abe5ac5050b96e7a06c792cded"}], "stats": {"total": 7, "additions": 2, "deletions": 5}, "files": [{"sha": "a2f7b8ba7be300ce075f3849338ccd2fe7bc423b", "filename": "src/tools/tidy/src/ui_tests.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1670fb93a671e01511429918eb80cd66493c0af4/src%2Ftools%2Ftidy%2Fsrc%2Fui_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1670fb93a671e01511429918eb80cd66493c0af4/src%2Ftools%2Ftidy%2Fsrc%2Fui_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fui_tests.rs?ref=1670fb93a671e01511429918eb80cd66493c0af4", "patch": "@@ -7,10 +7,10 @@ use std::collections::HashMap;\n use std::fs;\n use std::path::{Path, PathBuf};\n \n+const ENTRY_LIMIT: usize = 900;\n // FIXME: The following limits should be reduced eventually.\n-const ENTRY_LIMIT: usize = 885;\n-const ROOT_ENTRY_LIMIT: usize = 894;\n const ISSUES_ENTRY_LIMIT: usize = 1953;\n+const ROOT_ENTRY_LIMIT: usize = 894;\n \n fn check_entries(tests_path: &Path, bad: &mut bool) {\n     let mut directories: HashMap<PathBuf, usize> = HashMap::new();\n@@ -46,9 +46,6 @@ fn check_entries(tests_path: &Path, bad: &mut bool) {\n             );\n         }\n     }\n-    if ENTRY_LIMIT > max {\n-        tidy_error!(bad, \"`ENTRY_LIMIT` is too high (is {ENTRY_LIMIT}, should be {max})\");\n-    }\n     if ROOT_ENTRY_LIMIT > max_root {\n         tidy_error!(\n             bad,"}]}