{"sha": "1284081d33d0e7856c6d242b3e311876c4eec048", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyODQwODFkMzNkMGU3ODU2YzZkMjQyYjNlMzExODc2YzRlZWMwNDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-09-09T21:04:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-09T21:04:31Z"}, "message": "Auto merge of #36256 - rjgoldsborough:make-configure-detect-nodejs-36207, r=alexcrichton\n\nadding a check to bootstrap script\n\nand a check to the rust config script\n\nrefs #36207\n\nfirst crack at making configure detect nodejs", "tree": {"sha": "79f20cc3b90fab6ae38ce34dfc236616bf2b10c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79f20cc3b90fab6ae38ce34dfc236616bf2b10c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1284081d33d0e7856c6d242b3e311876c4eec048", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1284081d33d0e7856c6d242b3e311876c4eec048", "html_url": "https://github.com/rust-lang/rust/commit/1284081d33d0e7856c6d242b3e311876c4eec048", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1284081d33d0e7856c6d242b3e311876c4eec048/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1f40f850e2546c2c187514e3d61d17544ba433f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1f40f850e2546c2c187514e3d61d17544ba433f", "html_url": "https://github.com/rust-lang/rust/commit/f1f40f850e2546c2c187514e3d61d17544ba433f"}, {"sha": "89bc13c37d0fc58b583f07a5902f62e598c69b0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/89bc13c37d0fc58b583f07a5902f62e598c69b0e", "html_url": "https://github.com/rust-lang/rust/commit/89bc13c37d0fc58b583f07a5902f62e598c69b0e"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "a1b62e6267f5105e8d0430df1fd6c50ad4fa77bc", "filename": "configure", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1284081d33d0e7856c6d242b3e311876c4eec048/configure", "raw_url": "https://github.com/rust-lang/rust/raw/1284081d33d0e7856c6d242b3e311876c4eec048/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=1284081d33d0e7856c6d242b3e311876c4eec048", "patch": "@@ -633,6 +633,7 @@ valopt datadir \"${CFG_PREFIX}/share\" \"install data\"\n valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt llvm-root \"\" \"set LLVM root\"\n valopt python \"\" \"set path to python\"\n+valopt nodejs \"\" \"set path to nodejs\"\n valopt jemalloc-root \"\" \"set directory where libjemalloc_pic.a is located\"\n valopt build \"${DEFAULT_BUILD}\" \"GNUs ./configure syntax LLVM build triple\"\n valopt android-cross-path \"\" \"Android NDK standalone path (deprecated)\"\n@@ -748,6 +749,9 @@ if [ $(echo $python_version | grep -c '^Python 2\\.7') -ne 1 ]; then\n     err \"Found $python_version, but Python 2.7 is required\"\n fi\n \n+# Checking for node, but not required\n+probe CFG_NODEJS nodejs node\n+\n # If we have no git directory then we are probably a tarball distribution\n # and shouldn't attempt to load submodules\n if [ ! -e ${CFG_SRC_DIR}.git ]"}, {"sha": "0f69bcfbb649da101c12e05e574e7f5a371a2732", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1284081d33d0e7856c6d242b3e311876c4eec048/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1284081d33d0e7856c6d242b3e311876c4eec048/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=1284081d33d0e7856c6d242b3e311876c4eec048", "patch": "@@ -80,6 +80,7 @@ pub struct Config {\n     pub musl_root: Option<PathBuf>,\n     pub prefix: Option<String>,\n     pub codegen_tests: bool,\n+    pub nodejs: Option<PathBuf>,\n }\n \n /// Per-target configuration stored in the global configuration structure.\n@@ -395,6 +396,9 @@ impl Config {\n                     self.rustc = Some(PathBuf::from(value).join(\"bin/rustc\"));\n                     self.cargo = Some(PathBuf::from(value).join(\"bin/cargo\"));\n                 }\n+                \"CFG_NODEJS\" if value.len() > 0 => {\n+                    self.nodejs = Some(PathBuf::from(value));\n+                }\n                 _ => {}\n             }\n         }"}, {"sha": "05c35543e3e5b0584407531eb546b20a14c325b7", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1284081d33d0e7856c6d242b3e311876c4eec048/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1284081d33d0e7856c6d242b3e311876c4eec048/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=1284081d33d0e7856c6d242b3e311876c4eec048", "patch": "@@ -75,6 +75,12 @@ pub fn check(build: &mut Build) {\n \n     need_cmd(\"python\".as_ref());\n \n+    // If a manual nodejs was added to the config,\n+    // of if a nodejs install is detected through config, use it.\n+    if let Some(ref s) = build.config.nodejs {\n+        need_cmd(s.as_ref());\n+    }\n+\n     // We're gonna build some custom C code here and there, host triples\n     // also build some C++ shims for LLVM so we need a C++ compiler.\n     for target in build.config.target.iter() {"}]}