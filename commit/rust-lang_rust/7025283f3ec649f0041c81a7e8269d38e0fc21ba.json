{"sha": "7025283f3ec649f0041c81a7e8269d38e0fc21ba", "node_id": "C_kwDOAAsO6NoAKDcwMjUyODNmM2VjNjQ5ZjAwNDFjODFhN2U4MjY5ZDM4ZTBmYzIxYmE", "commit": {"author": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-03-29T12:32:12Z"}, "committer": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-04-02T03:18:47Z"}, "message": "Remove cargo_metadata dependency from clippy_dev", "tree": {"sha": "6ec5076a608c99431a2b5fd1b465e9339f287c57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ec5076a608c99431a2b5fd1b465e9339f287c57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7025283f3ec649f0041c81a7e8269d38e0fc21ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7025283f3ec649f0041c81a7e8269d38e0fc21ba", "html_url": "https://github.com/rust-lang/rust/commit/7025283f3ec649f0041c81a7e8269d38e0fc21ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7025283f3ec649f0041c81a7e8269d38e0fc21ba/comments", "author": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3f8415032a4b86f72aa7a99c7fe62a25c302927", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3f8415032a4b86f72aa7a99c7fe62a25c302927", "html_url": "https://github.com/rust-lang/rust/commit/b3f8415032a4b86f72aa7a99c7fe62a25c302927"}], "stats": {"total": 28, "additions": 17, "deletions": 11}, "files": [{"sha": "1f2d8adecee74c39840e2e4f144259e211e8e03b", "filename": "clippy_dev/Cargo.toml", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2FCargo.toml?ref=7025283f3ec649f0041c81a7e8269d38e0fc21ba", "patch": "@@ -4,15 +4,12 @@ version = \"0.0.1\"\n edition = \"2021\"\n \n [dependencies]\n-bytecount = \"0.6\"\n clap = \"2.33\"\n indoc = \"1.0\"\n itertools = \"0.10.1\"\n opener = \"0.5\"\n shell-escape = \"0.1\"\n walkdir = \"2.3\"\n-cargo_metadata = \"0.14\"\n-\n \n [features]\n deny-warnings = []"}, {"sha": "414b403827d9e3b394990aa46d9b642c0e328840", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=7025283f3ec649f0041c81a7e8269d38e0fc21ba", "patch": "@@ -1,3 +1,4 @@\n+#![feature(let_else)]\n #![feature(once_cell)]\n #![feature(rustc_private)]\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]"}, {"sha": "7a3fd1317619e39d3021f8dafe8e0281dc4a99a1", "filename": "clippy_dev/src/new_lint.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2Fsrc%2Fnew_lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7025283f3ec649f0041c81a7e8269d38e0fc21ba/clippy_dev%2Fsrc%2Fnew_lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fnew_lint.rs?ref=7025283f3ec649f0041c81a7e8269d38e0fc21ba", "patch": "@@ -133,15 +133,23 @@ fn to_camel_case(name: &str) -> String {\n }\n \n fn get_stabilisation_version() -> String {\n-    let mut command = cargo_metadata::MetadataCommand::new();\n-    command.no_deps();\n-    if let Ok(metadata) = command.exec() {\n-        if let Some(pkg) = metadata.packages.iter().find(|pkg| pkg.name == \"clippy\") {\n-            return format!(\"{}.{}.0\", pkg.version.minor, pkg.version.patch);\n-        }\n+    fn parse_manifest(contents: &str) -> Option<String> {\n+        let version = contents\n+            .lines()\n+            .filter_map(|l| l.split_once('='))\n+            .find_map(|(k, v)| (k.trim() == \"version\").then(|| v.trim()))?;\n+        let Some((\"0\", version)) = version.get(1..version.len() - 1)?.split_once('.') else {\n+            return None;\n+        };\n+        let (minor, patch) = version.split_once('.')?;\n+        Some(format!(\n+            \"{}.{}.0\",\n+            minor.parse::<u32>().ok()?,\n+            patch.parse::<u32>().ok()?\n+        ))\n     }\n-\n-    String::from(\"<TODO set version(see doc/adding_lints.md)>\")\n+    let contents = fs::read_to_string(\"Cargo.toml\").expect(\"Unable to read `Cargo.toml`\");\n+    parse_manifest(&contents).expect(\"Unable to find package version in `Cargo.toml`\")\n }\n \n fn get_test_file_contents(lint_name: &str, header_commands: Option<&str>) -> String {"}]}