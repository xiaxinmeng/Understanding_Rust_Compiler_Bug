{"sha": "8e597b295f05bfad803baf9354af66af2d14585c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlNTk3YjI5NWYwNWJmYWQ4MDNiYWY5MzU0YWY2NmFmMmQxNDU4NWM=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-19T21:26:12Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-19T21:26:12Z"}, "message": "rustc: Allow arguments to be captured as upvars. std.rc compiles now, except for the lack of a main fn.", "tree": {"sha": "7eba3b132d67d91a510bb8a76bfff1350de64ed5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7eba3b132d67d91a510bb8a76bfff1350de64ed5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e597b295f05bfad803baf9354af66af2d14585c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e597b295f05bfad803baf9354af66af2d14585c", "html_url": "https://github.com/rust-lang/rust/commit/8e597b295f05bfad803baf9354af66af2d14585c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e597b295f05bfad803baf9354af66af2d14585c/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c710c9a1b81f9231b3227159c9655ac7a2a5e099", "url": "https://api.github.com/repos/rust-lang/rust/commits/c710c9a1b81f9231b3227159c9655ac7a2a5e099", "html_url": "https://github.com/rust-lang/rust/commit/c710c9a1b81f9231b3227159c9655ac7a2a5e099"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "852e6d01530ebdef16961307d3ab2b33a1d8dce0", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8e597b295f05bfad803baf9354af66af2d14585c/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e597b295f05bfad803baf9354af66af2d14585c/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=8e597b295f05bfad803baf9354af66af2d14585c", "patch": "@@ -3002,7 +3002,12 @@ fn trans_for_each(@block_ctxt cx,\n             auto llbinding;\n             alt (cx.fcx.lllocals.find(did)) {\n                 case (none[ValueRef]) {\n-                    llbinding = cx.fcx.llupvars.get(did);\n+                    alt (cx.fcx.llupvars.find(did)) {\n+                        case (none[ValueRef]) {\n+                            llbinding = cx.fcx.llargs.get(did);\n+                        }\n+                        case (some[ValueRef](?llval)) { llbinding = llval; }\n+                    }\n                 }\n                 case (some[ValueRef](?llval)) { llbinding = llval; }\n             }\n@@ -3384,8 +3389,15 @@ fn trans_path(@block_ctxt cx, &ast.path p, &option.t[ast.def] dopt,\n         case (some[ast.def](?def)) {\n             alt (def) {\n                 case (ast.def_arg(?did)) {\n-                    check (cx.fcx.llargs.contains_key(did));\n-                    ret lval_mem(cx, cx.fcx.llargs.get(did));\n+                    alt (cx.fcx.llargs.find(did)) {\n+                        case (none[ValueRef]) {\n+                            check (cx.fcx.llupvars.contains_key(did));\n+                            ret lval_mem(cx, cx.fcx.llupvars.get(did));\n+                        }\n+                        case (some[ValueRef](?llval)) {\n+                            ret lval_mem(cx, llval);\n+                        }\n+                    }\n                 }\n                 case (ast.def_local(?did)) {\n                     alt (cx.fcx.lllocals.find(did)) {"}]}