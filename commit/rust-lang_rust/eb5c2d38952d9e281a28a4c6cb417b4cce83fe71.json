{"sha": "eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "node_id": "C_kwDOAAsO6NoAKGViNWMyZDM4OTUyZDllMjgxYTI4YTRjNmNiNDE3YjRjY2U4M2ZlNzE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-23T18:28:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-23T18:28:07Z"}, "message": "Rollup merge of #91103 - jsha:non-toggle-click-doesnt-toggle, r=Manishearth,GuillaumeGomez\n\nInhibit clicks on summary's children\n\nA byproduct of using `<details>` and `<summary>` to show/hide detailed documentation was that clicking any part of a method heading (or impl heading) would show or hide the documentation. This was not super noticeable because clicking a link inside the method heading would navigate to that link. But clicking any unlinked black text in a method heading would trigger the behavior.\n\nThat behavior was somewhat unexpected, and means that if you try to click a type name in a method heading, but miss by a few pixels, you get a confusing surprise.\n\nThis change inhibits that behavior by putting an event listener on most summaries that cancels the event unless the event target was the summary itself. In practice, that means it cancels the event unless the target was the \"[+]\" / \"[-]\", because the rest of the heading is wrapped inside a `<div>`, which is the target for anything that doesn't have a more specific target.\n\nr? ``@Manishearth``", "tree": {"sha": "0a19d334070b03eba95f6d15d0e62b917ae903a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0a19d334070b03eba95f6d15d0e62b917ae903a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhnTK4CRBK7hj4Ov3rIwAATkEIAFQt/KdkWWWetQbVkdrblU3A\nO5/jQ86l+e75wYNeh6ra0IlpkaBtqutSDCAF6j2z2j+vpHWem8UbJ0uIbNo/EYbP\nVZF4kVpE+A0kLiPtjGc2psXcCoWMYfpEsBJwCqiYNUidyTO9gAn6okA5Ok+d6C86\nnPiSoQcREbFJfAaxdqdHXQBGkiZpop+FUJ6z+F6HCdInPZff/cuDu9hLbmMixSPY\nwYFtoEJjEPR5d66x1FXani+Q0KUX7gl7iQNxUUaTMlRL4aFVfUAnn4dbzdziyPBl\nt2TMJ9/ChjGOeSa/kTaB8rLce0Dt4bVyoTng0wIkDVg8bySc34zI8zLlTJE+3XM=\n=rpqe\n-----END PGP SIGNATURE-----\n", "payload": "tree 0a19d334070b03eba95f6d15d0e62b917ae903a4\nparent 68a44c8228cc482ac45e2148116ee250b18aefeb\nparent 7f35556a256241579f6f1b0905fd671bc1182af1\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1637692087 +0100\ncommitter GitHub <noreply@github.com> 1637692087 +0100\n\nRollup merge of #91103 - jsha:non-toggle-click-doesnt-toggle, r=Manishearth,GuillaumeGomez\n\nInhibit clicks on summary's children\n\nA byproduct of using `<details>` and `<summary>` to show/hide detailed documentation was that clicking any part of a method heading (or impl heading) would show or hide the documentation. This was not super noticeable because clicking a link inside the method heading would navigate to that link. But clicking any unlinked black text in a method heading would trigger the behavior.\n\nThat behavior was somewhat unexpected, and means that if you try to click a type name in a method heading, but miss by a few pixels, you get a confusing surprise.\n\nThis change inhibits that behavior by putting an event listener on most summaries that cancels the event unless the event target was the summary itself. In practice, that means it cancels the event unless the target was the \"[+]\" / \"[-]\", because the rest of the heading is wrapped inside a `<div>`, which is the target for anything that doesn't have a more specific target.\n\nr? ``@Manishearth``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "html_url": "https://github.com/rust-lang/rust/commit/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68a44c8228cc482ac45e2148116ee250b18aefeb", "url": "https://api.github.com/repos/rust-lang/rust/commits/68a44c8228cc482ac45e2148116ee250b18aefeb", "html_url": "https://github.com/rust-lang/rust/commit/68a44c8228cc482ac45e2148116ee250b18aefeb"}, {"sha": "7f35556a256241579f6f1b0905fd671bc1182af1", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f35556a256241579f6f1b0905fd671bc1182af1", "html_url": "https://github.com/rust-lang/rust/commit/7f35556a256241579f6f1b0905fd671bc1182af1"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "32aa82195a962013c7567543e8b5645cb2fada57", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "patch": "@@ -886,6 +886,14 @@ function hideThemeButtonState() {\n         }\n     });\n \n+    onEachLazy(document.querySelectorAll(\".rustdoc-toggle > summary:not(.hideme)\"), function(el) {\n+        el.addEventListener(\"click\", function(e) {\n+            if (e.target.tagName != \"SUMMARY\") {\n+                e.preventDefault();\n+            }\n+        });\n+    });\n+\n     onEachLazy(document.getElementsByClassName(\"notable-traits\"), function(e) {\n         e.onclick = function() {\n             this.getElementsByClassName('notable-traits-tooltiptext')[0]"}, {"sha": "79354ec8745073b229e330607b2709b71c2631f4", "filename": "src/test/rustdoc-gui/src/lib2/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsrc%2Flib2%2Flib.rs?ref=eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "patch": "@@ -22,6 +22,8 @@ pub struct Foo {\n }\n \n impl Foo {\n+    /// Some documentation\n+    /// # A Heading\n     pub fn a_method(&self) {}\n }\n "}, {"sha": "4d08927a7bede7b807bc9d2a34e00b368e8c109b", "filename": "src/test/rustdoc-gui/toggle-click-deadspace.goml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml", "raw_url": "https://github.com/rust-lang/rust/raw/eb5c2d38952d9e281a28a4c6cb417b4cce83fe71/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml?ref=eb5c2d38952d9e281a28a4c6cb417b4cce83fe71", "patch": "@@ -0,0 +1,8 @@\n+// This test ensures that clicking on a method summary, but not on the \"[-]\",\n+// doesn't toggle the <details>.\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n+assert-attribute: (\".impl-items .rustdoc-toggle\", {\"open\": \"\"})\n+click: \"h4.code-header\" // This is the position of \"pub\" in \"pub fn a_method\"\n+assert-attribute: (\".impl-items .rustdoc-toggle\", {\"open\": \"\"})\n+click: \".impl-items .rustdoc-toggle summary::before\" // This is the position of \"[-]\" next to that pub fn.\n+assert-attribute-false: (\".impl-items .rustdoc-toggle\", {\"open\": \"\"})"}]}