{"sha": "8723eb603524c00df8a224740cb813cfca5c433f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3MjNlYjYwMzUyNGMwMGRmOGEyMjQ3NDBjYjgxM2NmY2E1YzQzM2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-12-22T09:55:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-12-22T09:55:50Z"}, "message": "Auto merge of #4937 - mikerite:fix-4824, r=phansch\n\nFix `map_clone` false positive\n\nDon't lint when the item type is not a reference. `copied` only applies to references.\n\nchangelog: Fix `map_clone` false positive", "tree": {"sha": "9c69da39ee71fd6ddb4590059d66c78e1a553b4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c69da39ee71fd6ddb4590059d66c78e1a553b4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8723eb603524c00df8a224740cb813cfca5c433f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8723eb603524c00df8a224740cb813cfca5c433f", "html_url": "https://github.com/rust-lang/rust/commit/8723eb603524c00df8a224740cb813cfca5c433f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8723eb603524c00df8a224740cb813cfca5c433f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19dbb22032c74fb9b6e0ee0534a8a3a64db2003b", "url": "https://api.github.com/repos/rust-lang/rust/commits/19dbb22032c74fb9b6e0ee0534a8a3a64db2003b", "html_url": "https://github.com/rust-lang/rust/commit/19dbb22032c74fb9b6e0ee0534a8a3a64db2003b"}, {"sha": "b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "html_url": "https://github.com/rust-lang/rust/commit/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "7931fabf8d7183031a418d19e607ee8d231621a1", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8723eb603524c00df8a224740cb813cfca5c433f/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8723eb603524c00df8a224740cb813cfca5c433f/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=8723eb603524c00df8a224740cb813cfca5c433f", "patch": "@@ -69,8 +69,10 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MapClone {\n                     hir::PatKind::Binding(hir::BindingAnnotation::Unannotated, .., name, None) => {\n                         match closure_expr.kind {\n                             hir::ExprKind::Unary(hir::UnOp::UnDeref, ref inner) => {\n-                                if ident_eq(name, inner) && !cx.tables.expr_ty(inner).is_box() {\n-                                    lint(cx, e.span, args[0].span, true);\n+                                if ident_eq(name, inner) {\n+                                    if let ty::Ref(..) = cx.tables.expr_ty(inner).kind {\n+                                        lint(cx, e.span, args[0].span, true);\n+                                    }\n                                 }\n                             },\n                             hir::ExprKind::MethodCall(ref method, _, ref obj) => {"}, {"sha": "5e6b3fad41ce08584b46cf93bb5d92c280e4a9a9", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8723eb603524c00df8a224740cb813cfca5c433f/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8723eb603524c00df8a224740cb813cfca5c433f/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=8723eb603524c00df8a224740cb813cfca5c433f", "patch": "@@ -23,4 +23,14 @@ fn main() {\n \n     // Issue #498\n     let _ = std::env::args();\n+\n+    // Issue #4824 item types that aren't references\n+    {\n+        use std::rc::Rc;\n+\n+        let o: Option<Rc<u32>> = Some(Rc::new(0_u32));\n+        let _: Option<u32> = o.map(|x| *x);\n+        let v: Vec<Rc<u32>> = vec![Rc::new(0_u32)];\n+        let _: Vec<u32> = v.into_iter().map(|x| *x).collect();\n+    }\n }"}, {"sha": "2fe078b2752663fd5dcf45e559a1eec475ac2596", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8723eb603524c00df8a224740cb813cfca5c433f/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8723eb603524c00df8a224740cb813cfca5c433f/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=8723eb603524c00df8a224740cb813cfca5c433f", "patch": "@@ -23,4 +23,14 @@ fn main() {\n \n     // Issue #498\n     let _ = std::env::args().map(|v| v.clone());\n+\n+    // Issue #4824 item types that aren't references\n+    {\n+        use std::rc::Rc;\n+\n+        let o: Option<Rc<u32>> = Some(Rc::new(0_u32));\n+        let _: Option<u32> = o.map(|x| *x);\n+        let v: Vec<Rc<u32>> = vec![Rc::new(0_u32)];\n+        let _: Vec<u32> = v.into_iter().map(|x| *x).collect();\n+    }\n }"}]}