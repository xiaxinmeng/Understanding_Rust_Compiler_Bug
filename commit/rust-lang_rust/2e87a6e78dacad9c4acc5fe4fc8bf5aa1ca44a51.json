{"sha": "2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlODdhNmU3OGRhY2FkOWM0YWNjNWZlNGZjOGJmNWFhMWNhNDRhNTE=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-09-12T19:10:13Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-09-12T19:10:55Z"}, "message": "Set link-shared if LLVM ThinLTO is enabled in config.rs\n\nThis avoids missing a shared build when uplifting LLVM artifacts into the\nsysroot. We were already producing a shared link anyway, though, so this is not\na visible change from the end user's perspective.", "tree": {"sha": "f1796161199482f62c4eba1f6b4e25533001166a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1796161199482f62c4eba1f6b4e25533001166a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "html_url": "https://github.com/rust-lang/rust/commit/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a7b092f4188e927b3456fe6fe5ee2bd72c53cb57", "url": "https://api.github.com/repos/rust-lang/rust/commits/a7b092f4188e927b3456fe6fe5ee2bd72c53cb57", "html_url": "https://github.com/rust-lang/rust/commit/a7b092f4188e927b3456fe6fe5ee2bd72c53cb57"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "08907edef1d1e52b5984070e2a60775ff8bf9d02", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "patch": "@@ -593,7 +593,7 @@ pub fn rustc_cargo_env(builder: &Builder<'_>, cargo: &mut Cargo, target: TargetS\n             let file = compiler_file(builder, builder.cxx(target).unwrap(), target, \"libstdc++.a\");\n             cargo.env(\"LLVM_STATIC_STDCPP\", file);\n         }\n-        if builder.config.llvm_link_shared || builder.config.llvm_thin_lto {\n+        if builder.config.llvm_link_shared {\n             cargo.env(\"LLVM_LINK_SHARED\", \"1\");\n         }\n         if builder.config.llvm_use_libcxx {"}, {"sha": "000f8cef61492438f321d4c6a2fa9b779fca5572", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=2e87a6e78dacad9c4acc5fe4fc8bf5aa1ca44a51", "patch": "@@ -667,6 +667,13 @@ impl Config {\n                 // CI-built LLVM is shared\n                 config.llvm_link_shared = true;\n             }\n+\n+            if config.llvm_thin_lto {\n+                // If we're building with ThinLTO on, we want to link to LLVM\n+                // shared, to avoid re-doing ThinLTO (which happens in the link\n+                // step) with each stage.\n+                config.llvm_link_shared = true;\n+            }\n         }\n \n         if let Some(ref rust) = toml.rust {"}]}