{"sha": "de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "node_id": "C_kwDOAAsO6NoAKGRlM2U4Y2EyZjM5MDhkYzQ4ZmRkYjBkNWI0YzE0Yzc3NjAxN2I0M2U", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-05-07T06:26:03Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-05-12T06:21:51Z"}, "message": "errors: `set_arg` takes `IntoDiagnosticArg`\n\nManual implementors of translatable diagnostics will need to call\n`set_arg`, not just the derive, so make this function a bit more\nergonomic by taking `IntoDiagnosticArg` rather than\n`DiagnosticArgValue`.\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "73536ec335942051c8bf762c654f0fcf224dcfd8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/73536ec335942051c8bf762c654f0fcf224dcfd8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "html_url": "https://github.com/rust-lang/rust/commit/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5545f1b0c28a7acba27d1985a934845a013af1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5545f1b0c28a7acba27d1985a934845a013af1b", "html_url": "https://github.com/rust-lang/rust/commit/b5545f1b0c28a7acba27d1985a934845a013af1b"}], "stats": {"total": 37, "additions": 23, "deletions": 14}, "files": [{"sha": "909ed566f64ea9c45d11b234bed23a6269f44174", "filename": "compiler/rustc_errors/src/diagnostic.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -821,9 +821,9 @@ impl Diagnostic {\n     pub fn set_arg(\n         &mut self,\n         name: impl Into<Cow<'static, str>>,\n-        arg: DiagnosticArgValue<'static>,\n+        arg: impl IntoDiagnosticArg,\n     ) -> &mut Self {\n-        self.args.push((name.into(), arg));\n+        self.args.push((name.into(), arg.into_diagnostic_arg()));\n         self\n     }\n "}, {"sha": "53ad6e5a0edea56ce07c06bb7a2e3188024e1a38", "filename": "compiler/rustc_errors/src/diagnostic_builder.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -1,4 +1,4 @@\n-use crate::diagnostic::DiagnosticArgValue;\n+use crate::diagnostic::IntoDiagnosticArg;\n use crate::{Diagnostic, DiagnosticId, DiagnosticMessage, DiagnosticStyledString, ErrorGuaranteed};\n use crate::{Handler, Level, MultiSpan, StashKey};\n use rustc_lint_defs::Applicability;\n@@ -528,7 +528,7 @@ impl<'a, G: EmissionGuarantee> DiagnosticBuilder<'a, G> {\n     forward!(pub fn set_arg(\n         &mut self,\n         name: impl Into<Cow<'static, str>>,\n-        arg: DiagnosticArgValue<'static>,\n+        arg: impl IntoDiagnosticArg,\n     ) -> &mut Self);\n \n     forward!(pub fn subdiagnostic("}, {"sha": "dac3e986e7ad4bc142377300304f92262f8c3f68", "filename": "compiler/rustc_macros/src/diagnostics/diagnostic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fdiagnostic.rs?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -113,7 +113,7 @@ impl<'a> SessionDiagnosticDerive<'a> {\n                         quote! {\n                             #diag.set_arg(\n                                 stringify!(#ident),\n-                                #field_binding.into_diagnostic_arg()\n+                                #field_binding\n                             );\n                         }\n                     } else {"}, {"sha": "ae5b9dbd9ba1c2677c604253eccefbd36b82eceb", "filename": "compiler/rustc_macros/src/diagnostics/subdiagnostic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fsubdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fsubdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Fsubdiagnostic.rs?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -349,7 +349,7 @@ impl<'a> SessionSubdiagnosticDeriveBuilder<'a> {\n         let generated = quote! {\n             #diag.set_arg(\n                 stringify!(#ident),\n-                #binding.into_diagnostic_arg()\n+                #binding\n             );\n         };\n "}, {"sha": "1cdc5d18c28983cb8506f78cbd3f19f311e0e9b1", "filename": "src/test/ui-fulldeps/session-diagnostic/diagnostic-derive.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.rs?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -327,7 +327,7 @@ struct ErrorWithDefaultLabelAttr<'a> {\n }\n \n #[derive(SessionDiagnostic)]\n-//~^ ERROR no method named `into_diagnostic_arg` found for struct `Hello` in the current scope\n+//~^ ERROR the trait bound `Hello: IntoDiagnosticArg` is not satisfied\n #[error(code = \"E0123\", slug = \"foo\")]\n struct ArgFieldWithoutSkip {\n     #[primary_span]"}, {"sha": "2583363120a2950e1e2a1c2ab7acfaca436a757f", "filename": "src/test/ui-fulldeps/session-diagnostic/diagnostic-derive.stderr", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/de3e8ca2f3908dc48fddb0d5b4c14c776017b43e/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fdiagnostic-derive.stderr?ref=de3e8ca2f3908dc48fddb0d5b4c14c776017b43e", "patch": "@@ -349,17 +349,26 @@ error: cannot find attribute `nonsense` in this scope\n LL |     #[nonsense]\n    |       ^^^^^^^^\n \n-error[E0599]: no method named `into_diagnostic_arg` found for struct `Hello` in the current scope\n+error[E0277]: the trait bound `Hello: IntoDiagnosticArg` is not satisfied\n   --> $DIR/diagnostic-derive.rs:329:10\n    |\n-LL | struct Hello {}\n-   | ------------ method `into_diagnostic_arg` not found for this\n-...\n LL | #[derive(SessionDiagnostic)]\n-   |          ^^^^^^^^^^^^^^^^^ method not found in `Hello`\n-   |\n+   |          ^^^^^^^^^^^^^^^^^ the trait `IntoDiagnosticArg` is not implemented for `Hello`\n+   |\n+   = help: the following other types implement trait `IntoDiagnosticArg`:\n+             &'a str\n+             Ident\n+             String\n+             Symbol\n+             rustc_middle::ty::Ty<'tcx>\n+             usize\n+note: required by a bound in `DiagnosticBuilder::<'a, G>::set_arg`\n+  --> $COMPILER_DIR/rustc_errors/src/diagnostic_builder.rs:531:19\n+   |\n+LL |         arg: impl IntoDiagnosticArg,\n+   |                   ^^^^^^^^^^^^^^^^^ required by this bound in `DiagnosticBuilder::<'a, G>::set_arg`\n    = note: this error originates in the derive macro `SessionDiagnostic` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to 43 previous errors\n \n-For more information about this error, try `rustc --explain E0599`.\n+For more information about this error, try `rustc --explain E0277`."}]}