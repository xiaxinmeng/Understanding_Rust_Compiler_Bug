{"sha": "c559cf62c21f9e4f804fae633f6d0499be7fae1c", "node_id": "C_kwDOAAsO6NoAKGM1NTljZjYyYzIxZjllNGY4MDRmYWU2MzNmNmQwNDk5YmU3ZmFlMWM", "commit": {"author": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2022-12-06T01:01:42Z"}, "committer": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2022-12-06T01:05:17Z"}, "message": "Simplify attribute handling in rustc_ast_lowering\n\nGiven that attributes is stored in a separate BTreeMap, it's not necessary\nto pass it in when constructing `hir::Expr`. We can just construct\n`hir::Expr` and then call `self.lower_attrs` later if it needs attributes.\n\nAs most desugaring code don't use attributes, this allows some code cleanup.", "tree": {"sha": "fbf679176af631fe265f5b33451f4ff05e238ea4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fbf679176af631fe265f5b33451f4ff05e238ea4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c559cf62c21f9e4f804fae633f6d0499be7fae1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c559cf62c21f9e4f804fae633f6d0499be7fae1c", "html_url": "https://github.com/rust-lang/rust/commit/c559cf62c21f9e4f804fae633f6d0499be7fae1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c559cf62c21f9e4f804fae633f6d0499be7fae1c/comments", "author": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e440b03761f725d452120a992723c7e261822b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e440b03761f725d452120a992723c7e261822b2", "html_url": "https://github.com/rust-lang/rust/commit/8e440b03761f725d452120a992723c7e261822b2"}], "stats": {"total": 151, "additions": 45, "deletions": 106}, "files": [{"sha": "77b7ee38bde0447d1961c6e1091297ba8f612044", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 39, "deletions": 94, "changes": 133, "blob_url": "https://github.com/rust-lang/rust/blob/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=c559cf62c21f9e4f804fae633f6d0499be7fae1c", "patch": "@@ -436,18 +436,14 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 let lhs = self.lower_cond(lhs);\n                 let rhs = self.lower_cond(rhs);\n \n-                self.arena.alloc(self.expr(\n-                    cond.span,\n-                    hir::ExprKind::Binary(op, lhs, rhs),\n-                    AttrVec::new(),\n-                ))\n+                self.arena.alloc(self.expr(cond.span, hir::ExprKind::Binary(op, lhs, rhs)))\n             }\n             ExprKind::Let(..) => self.lower_expr(cond),\n             _ => {\n                 let cond = self.lower_expr(cond);\n                 let reason = DesugaringKind::CondTemporary;\n                 let span_block = self.mark_span_with_reason(reason, cond.span, None);\n-                self.expr_drop_temps(span_block, cond, AttrVec::new())\n+                self.expr_drop_temps(span_block, cond)\n             }\n         }\n     }\n@@ -477,12 +473,12 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     ) -> hir::ExprKind<'hir> {\n         let lowered_cond = self.with_loop_condition_scope(|t| t.lower_cond(cond));\n         let then = self.lower_block_expr(body);\n-        let expr_break = self.expr_break(span, AttrVec::new());\n+        let expr_break = self.expr_break(span);\n         let stmt_break = self.stmt_expr(span, expr_break);\n         let else_blk = self.block_all(span, arena_vec![self; stmt_break], None);\n-        let else_expr = self.arena.alloc(self.expr_block(else_blk, AttrVec::new()));\n+        let else_expr = self.arena.alloc(self.expr_block(else_blk));\n         let if_kind = hir::ExprKind::If(lowered_cond, self.arena.alloc(then), Some(else_expr));\n-        let if_expr = self.expr(span, if_kind, AttrVec::new());\n+        let if_expr = self.expr(span, if_kind);\n         let block = self.block_expr(self.arena.alloc(if_expr));\n         let span = self.lower_span(span.with_hi(cond.span.hi()));\n         let opt_label = self.lower_label(opt_label);\n@@ -538,12 +534,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         expr: &'hir hir::Expr<'hir>,\n         overall_span: Span,\n     ) -> &'hir hir::Expr<'hir> {\n-        let constructor = self.arena.alloc(self.expr_lang_item_path(\n-            method_span,\n-            lang_item,\n-            AttrVec::new(),\n-            None,\n-        ));\n+        let constructor = self.arena.alloc(self.expr_lang_item_path(method_span, lang_item, None));\n         self.expr_call(overall_span, constructor, std::slice::from_ref(expr))\n     }\n \n@@ -694,12 +685,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         // E0700 in src/test/ui/self/self_lifetime-async.rs\n \n         // `future::identity_future`:\n-        let identity_future = self.expr_lang_item_path(\n-            unstable_span,\n-            hir::LangItem::IdentityFuture,\n-            AttrVec::new(),\n-            None,\n-        );\n+        let identity_future =\n+            self.expr_lang_item_path(unstable_span, hir::LangItem::IdentityFuture, None);\n \n         // `future::identity_future(generator)`:\n         hir::ExprKind::Call(self.arena.alloc(identity_future), arena_vec![self; generator])\n@@ -802,7 +789,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             let break_x = self.with_loop_scope(loop_node_id, move |this| {\n                 let expr_break =\n                     hir::ExprKind::Break(this.lower_loop_destination(None), Some(x_expr));\n-                this.arena.alloc(this.expr(gen_future_span, expr_break, AttrVec::new()))\n+                this.arena.alloc(this.expr(gen_future_span, expr_break))\n             });\n             self.arm(ready_pat, break_x)\n         };\n@@ -835,17 +822,13 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             let yield_expr = self.expr(\n                 span,\n                 hir::ExprKind::Yield(unit, hir::YieldSource::Await { expr: Some(expr_hir_id) }),\n-                AttrVec::new(),\n             );\n             let yield_expr = self.arena.alloc(yield_expr);\n \n             if let Some(task_context_hid) = self.task_context {\n                 let lhs = self.expr_ident(span, task_context_ident, task_context_hid);\n-                let assign = self.expr(\n-                    span,\n-                    hir::ExprKind::Assign(lhs, yield_expr, self.lower_span(span)),\n-                    AttrVec::new(),\n-                );\n+                let assign =\n+                    self.expr(span, hir::ExprKind::Assign(lhs, yield_expr, self.lower_span(span)));\n                 self.stmt_expr(span, assign)\n             } else {\n                 // Use of `await` outside of an async context. Return `yield_expr` so that we can\n@@ -1029,7 +1012,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     hir::AsyncGeneratorKind::Closure,\n                     |this| this.with_new_scopes(|this| this.lower_expr_mut(body)),\n                 );\n-                this.expr(fn_decl_span, async_body, AttrVec::new())\n+                this.expr(fn_decl_span, async_body)\n             });\n             body_id\n         });\n@@ -1289,7 +1272,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let ident = self.expr_ident(lhs.span, ident, binding);\n         let assign =\n             hir::ExprKind::Assign(self.lower_expr(lhs), ident, self.lower_span(eq_sign_span));\n-        let expr = self.expr(lhs.span, assign, AttrVec::new());\n+        let expr = self.expr(lhs.span, assign);\n         assignments.push(self.stmt_expr(lhs.span, expr));\n         pat\n     }\n@@ -1330,8 +1313,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let e2 = self.lower_expr_mut(e2);\n         let fn_path =\n             hir::QPath::LangItem(hir::LangItem::RangeInclusiveNew, self.lower_span(span), None);\n-        let fn_expr =\n-            self.arena.alloc(self.expr(span, hir::ExprKind::Path(fn_path), AttrVec::new()));\n+        let fn_expr = self.arena.alloc(self.expr(span, hir::ExprKind::Path(fn_path)));\n         hir::ExprKind::Call(fn_expr, arena_vec![self; e1, e2])\n     }\n \n@@ -1503,8 +1485,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n         // `None => break`\n         let none_arm = {\n-            let break_expr =\n-                self.with_loop_scope(e.id, |this| this.expr_break_alloc(for_span, AttrVec::new()));\n+            let break_expr = self.with_loop_scope(e.id, |this| this.expr_break_alloc(for_span));\n             let pat = self.pat_none(for_span);\n             self.arm(pat, break_expr)\n         };\n@@ -1513,7 +1494,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let some_arm = {\n             let some_pat = self.pat_some(pat_span, pat);\n             let body_block = self.with_loop_scope(e.id, |this| this.lower_block(body, false));\n-            let body_expr = self.arena.alloc(self.expr_block(body_block, AttrVec::new()));\n+            let body_expr = self.arena.alloc(self.expr_block(body_block));\n             self.arm(some_pat, body_expr)\n         };\n \n@@ -1576,7 +1557,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         // surrounding scope of the `match` since the `match` is not a terminating scope.\n         //\n         // Also, add the attributes to the outer returned expr node.\n-        self.expr_drop_temps_mut(for_span, match_expr, e.attrs.clone())\n+        let expr = self.expr_drop_temps_mut(for_span, match_expr);\n+        self.lower_attrs(expr.hir_id, &e.attrs);\n+        expr\n     }\n \n     /// Desugar `ExprKind::Try` from: `<expr>?` into:\n@@ -1631,12 +1614,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let continue_arm = {\n             let val_ident = Ident::with_dummy_span(sym::val);\n             let (val_pat, val_pat_nid) = self.pat_ident(span, val_ident);\n-            let val_expr = self.arena.alloc(self.expr_ident_with_attrs(\n-                span,\n-                val_ident,\n-                val_pat_nid,\n-                attrs.clone(),\n-            ));\n+            let val_expr = self.expr_ident(span, val_ident, val_pat_nid);\n+            self.lower_attrs(val_expr.hir_id, &attrs);\n             let continue_pat = self.pat_cf_continue(unstable_span, val_pat);\n             self.arm(continue_pat, val_expr)\n         };\n@@ -1662,15 +1641,11 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                         hir::Destination { label: None, target_id },\n                         Some(from_residual_expr),\n                     ),\n-                    attrs,\n                 ))\n             } else {\n-                self.arena.alloc(self.expr(\n-                    try_span,\n-                    hir::ExprKind::Ret(Some(from_residual_expr)),\n-                    attrs,\n-                ))\n+                self.arena.alloc(self.expr(try_span, hir::ExprKind::Ret(Some(from_residual_expr))))\n             };\n+            self.lower_attrs(ret_expr.hir_id, &attrs);\n \n             let break_pat = self.pat_cf_break(try_span, residual_local);\n             self.arm(break_pat, ret_expr)\n@@ -1735,18 +1710,16 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         &mut self,\n         span: Span,\n         expr: &'hir hir::Expr<'hir>,\n-        attrs: AttrVec,\n     ) -> &'hir hir::Expr<'hir> {\n-        self.arena.alloc(self.expr_drop_temps_mut(span, expr, attrs))\n+        self.arena.alloc(self.expr_drop_temps_mut(span, expr))\n     }\n \n     pub(super) fn expr_drop_temps_mut(\n         &mut self,\n         span: Span,\n         expr: &'hir hir::Expr<'hir>,\n-        attrs: AttrVec,\n     ) -> hir::Expr<'hir> {\n-        self.expr(span, hir::ExprKind::DropTemps(expr), attrs)\n+        self.expr(span, hir::ExprKind::DropTemps(expr))\n     }\n \n     fn expr_match(\n@@ -1756,29 +1729,25 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         arms: &'hir [hir::Arm<'hir>],\n         source: hir::MatchSource,\n     ) -> hir::Expr<'hir> {\n-        self.expr(span, hir::ExprKind::Match(arg, arms, source), AttrVec::new())\n+        self.expr(span, hir::ExprKind::Match(arg, arms, source))\n     }\n \n-    fn expr_break(&mut self, span: Span, attrs: AttrVec) -> hir::Expr<'hir> {\n+    fn expr_break(&mut self, span: Span) -> hir::Expr<'hir> {\n         let expr_break = hir::ExprKind::Break(self.lower_loop_destination(None), None);\n-        self.expr(span, expr_break, attrs)\n+        self.expr(span, expr_break)\n     }\n \n-    fn expr_break_alloc(&mut self, span: Span, attrs: AttrVec) -> &'hir hir::Expr<'hir> {\n-        let expr_break = self.expr_break(span, attrs);\n+    fn expr_break_alloc(&mut self, span: Span) -> &'hir hir::Expr<'hir> {\n+        let expr_break = self.expr_break(span);\n         self.arena.alloc(expr_break)\n     }\n \n     fn expr_mut_addr_of(&mut self, span: Span, e: &'hir hir::Expr<'hir>) -> hir::Expr<'hir> {\n-        self.expr(\n-            span,\n-            hir::ExprKind::AddrOf(hir::BorrowKind::Ref, hir::Mutability::Mut, e),\n-            AttrVec::new(),\n-        )\n+        self.expr(span, hir::ExprKind::AddrOf(hir::BorrowKind::Ref, hir::Mutability::Mut, e))\n     }\n \n     fn expr_unit(&mut self, sp: Span) -> &'hir hir::Expr<'hir> {\n-        self.arena.alloc(self.expr(sp, hir::ExprKind::Tup(&[]), AttrVec::new()))\n+        self.arena.alloc(self.expr(sp, hir::ExprKind::Tup(&[])))\n     }\n \n     fn expr_call_mut(\n@@ -1787,7 +1756,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         e: &'hir hir::Expr<'hir>,\n         args: &'hir [hir::Expr<'hir>],\n     ) -> hir::Expr<'hir> {\n-        self.expr(span, hir::ExprKind::Call(e, args), AttrVec::new())\n+        self.expr(span, hir::ExprKind::Call(e, args))\n     }\n \n     fn expr_call(\n@@ -1806,8 +1775,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         args: &'hir [hir::Expr<'hir>],\n         hir_id: Option<hir::HirId>,\n     ) -> hir::Expr<'hir> {\n-        let path =\n-            self.arena.alloc(self.expr_lang_item_path(span, lang_item, AttrVec::new(), hir_id));\n+        let path = self.arena.alloc(self.expr_lang_item_path(span, lang_item, hir_id));\n         self.expr_call_mut(span, path, args)\n     }\n \n@@ -1825,13 +1793,11 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         &mut self,\n         span: Span,\n         lang_item: hir::LangItem,\n-        attrs: AttrVec,\n         hir_id: Option<hir::HirId>,\n     ) -> hir::Expr<'hir> {\n         self.expr(\n             span,\n             hir::ExprKind::Path(hir::QPath::LangItem(lang_item, self.lower_span(span), hir_id)),\n-            attrs,\n         )\n     }\n \n@@ -1845,20 +1811,10 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     }\n \n     pub(super) fn expr_ident_mut(\n-        &mut self,\n-        sp: Span,\n-        ident: Ident,\n-        binding: hir::HirId,\n-    ) -> hir::Expr<'hir> {\n-        self.expr_ident_with_attrs(sp, ident, binding, AttrVec::new())\n-    }\n-\n-    fn expr_ident_with_attrs(\n         &mut self,\n         span: Span,\n         ident: Ident,\n         binding: hir::HirId,\n-        attrs: AttrVec,\n     ) -> hir::Expr<'hir> {\n         let hir_id = self.next_id();\n         let res = Res::Local(binding);\n@@ -1871,7 +1827,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             }),\n         ));\n \n-        self.expr(span, expr_path, attrs)\n+        self.expr(span, expr_path)\n     }\n \n     fn expr_unsafe(&mut self, expr: &'hir hir::Expr<'hir>) -> hir::Expr<'hir> {\n@@ -1890,32 +1846,21 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 }),\n                 None,\n             ),\n-            AttrVec::new(),\n         )\n     }\n \n     fn expr_block_empty(&mut self, span: Span) -> &'hir hir::Expr<'hir> {\n         let blk = self.block_all(span, &[], None);\n-        let expr = self.expr_block(blk, AttrVec::new());\n+        let expr = self.expr_block(blk);\n         self.arena.alloc(expr)\n     }\n \n-    pub(super) fn expr_block(\n-        &mut self,\n-        b: &'hir hir::Block<'hir>,\n-        attrs: AttrVec,\n-    ) -> hir::Expr<'hir> {\n-        self.expr(b.span, hir::ExprKind::Block(b, None), attrs)\n+    pub(super) fn expr_block(&mut self, b: &'hir hir::Block<'hir>) -> hir::Expr<'hir> {\n+        self.expr(b.span, hir::ExprKind::Block(b, None))\n     }\n \n-    pub(super) fn expr(\n-        &mut self,\n-        span: Span,\n-        kind: hir::ExprKind<'hir>,\n-        attrs: AttrVec,\n-    ) -> hir::Expr<'hir> {\n+    pub(super) fn expr(&mut self, span: Span, kind: hir::ExprKind<'hir>) -> hir::Expr<'hir> {\n         let hir_id = self.next_id();\n-        self.lower_attrs(hir_id, &attrs);\n         hir::Expr { hir_id, kind, span: self.lower_span(span) }\n     }\n "}, {"sha": "d73d6d3918ea618dde2c3bbaa77e0954c73f5627", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=c559cf62c21f9e4f804fae633f6d0499be7fae1c", "patch": "@@ -796,7 +796,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n     /// Construct `ExprKind::Err` for the given `span`.\n     pub(crate) fn expr_err(&mut self, span: Span) -> hir::Expr<'hir> {\n-        self.expr(span, hir::ExprKind::Err, AttrVec::new())\n+        self.expr(span, hir::ExprKind::Err)\n     }\n \n     fn lower_impl_item(&mut self, i: &AssocItem) -> &'hir hir::ImplItem<'hir> {\n@@ -1151,11 +1151,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     // Transform into `drop-temps { <user-body> }`, an expression:\n                     let desugared_span =\n                         this.mark_span_with_reason(DesugaringKind::Async, user_body.span, None);\n-                    let user_body = this.expr_drop_temps(\n-                        desugared_span,\n-                        this.arena.alloc(user_body),\n-                        AttrVec::new(),\n-                    );\n+                    let user_body =\n+                        this.expr_drop_temps(desugared_span, this.arena.alloc(user_body));\n \n                     // As noted above, create the final block like\n                     //\n@@ -1172,14 +1169,11 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                         Some(user_body),\n                     );\n \n-                    this.expr_block(body, AttrVec::new())\n+                    this.expr_block(body)\n                 },\n             );\n \n-            (\n-                this.arena.alloc_from_iter(parameters),\n-                this.expr(body.span, async_expr, AttrVec::new()),\n-            )\n+            (this.arena.alloc_from_iter(parameters), this.expr(body.span, async_expr))\n         })\n     }\n "}, {"sha": "07558ca075d3c022521fc73ba082a59b047149ac", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c559cf62c21f9e4f804fae633f6d0499be7fae1c/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=c559cf62c21f9e4f804fae633f6d0499be7fae1c", "patch": "@@ -2291,7 +2291,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     /// has no attributes and is not targeted by a `break`.\n     fn lower_block_expr(&mut self, b: &Block) -> hir::Expr<'hir> {\n         let block = self.lower_block(b, false);\n-        self.expr_block(block, AttrVec::new())\n+        self.expr_block(block)\n     }\n \n     fn lower_array_length(&mut self, c: &AnonConst) -> hir::ArrayLen {"}]}