{"sha": "54744601bfae6d3e09ea8c958beab8d58e850434", "node_id": "C_kwDOAAsO6NoAKDU0NzQ0NjAxYmZhZTZkM2UwOWVhOGM5NThiZWFiOGQ1OGU4NTA0MzQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-26T22:56:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-26T22:56:26Z"}, "message": "Rollup merge of #100817 - vincenzopalazzo:macros/bool_spelling_sugg, r=davidtwco\n\nsugg: suggest the usage of boolean value when there is a typo in the keyword\n\nFixes https://github.com/rust-lang/rust/issues/100686\n\nThis adds a new suggestion when there is a well-known typo\n\nWith the following program\n\n```rust\nfn main() {\n    let x = True;\n}\n```\n\nNow we have the following suggestion\n\n```\nerror[E0425]: cannot find value `True` in this scope\n --> test.rs:2:13\n  |\n2 |     let x = True;\n  |             ^^^^ not found in this scope\n  |\nhelp: you may want to use a bool value instead\n  |\n2 |     let x = true;\n  |             ~~~~\n\nerror: aborting due to previous error\n```\n\nSigned-off-by: Vincenzo Palazzo <vincenzopalazzodev@gmail.com>", "tree": {"sha": "55c483d009372461096b597086e2606c076cc1a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/55c483d009372461096b597086e2606c076cc1a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54744601bfae6d3e09ea8c958beab8d58e850434", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjCU+aCRBK7hj4Ov3rIwAAclgIAF8fb7+3fW5oA+ItZNSYSomW\nqMPCqHj3A/UwSzei2RJ8bJH1FAuNJzvLXsfguJlgDkyTPmDHbR0p1x266VAGmbuz\nIA/d6lbN5yoLbWnAHDcZcHQRmVym1uST3YLY34Wfi5ip2yCyccO5U7G/6VF04WkA\ncp7x1ES3cMlMdVGfQAbncyb1xPR8t1ParePrF/cQ5hcio0ERfcUe9DL1ysTdoga4\nslUN6jSz2YpnzrM+FnQT6hLn/FDLgKfPD7jrCDlCmHT9CFIgkdfqcgXkwyFgOzE4\n8D0IOaWdEIX/jiSQIFmsanZiqL3kr5Od5Q3Vsx2fzg2oPSy9EgZyCXljXNmgork=\n=/jGi\n-----END PGP SIGNATURE-----\n", "payload": "tree 55c483d009372461096b597086e2606c076cc1a4\nparent 389dda149c0524c7d5b8d2020ace3cbc97bda60b\nparent 69715c903312c3e734bfd9098a5e8773f2e19d01\nauthor Michael Goulet <michael@errs.io> 1661554586 -0700\ncommitter GitHub <noreply@github.com> 1661554586 -0700\n\nRollup merge of #100817 - vincenzopalazzo:macros/bool_spelling_sugg, r=davidtwco\n\nsugg: suggest the usage of boolean value when there is a typo in the keyword\n\nFixes https://github.com/rust-lang/rust/issues/100686\n\nThis adds a new suggestion when there is a well-known typo\n\nWith the following program\n\n```rust\nfn main() {\n    let x = True;\n}\n```\n\nNow we have the following suggestion\n\n```\nerror[E0425]: cannot find value `True` in this scope\n --> test.rs:2:13\n  |\n2 |     let x = True;\n  |             ^^^^ not found in this scope\n  |\nhelp: you may want to use a bool value instead\n  |\n2 |     let x = true;\n  |             ~~~~\n\nerror: aborting due to previous error\n```\n\nSigned-off-by: Vincenzo Palazzo <vincenzopalazzodev@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54744601bfae6d3e09ea8c958beab8d58e850434", "html_url": "https://github.com/rust-lang/rust/commit/54744601bfae6d3e09ea8c958beab8d58e850434", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54744601bfae6d3e09ea8c958beab8d58e850434/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "389dda149c0524c7d5b8d2020ace3cbc97bda60b", "url": "https://api.github.com/repos/rust-lang/rust/commits/389dda149c0524c7d5b8d2020ace3cbc97bda60b", "html_url": "https://github.com/rust-lang/rust/commit/389dda149c0524c7d5b8d2020ace3cbc97bda60b"}, {"sha": "69715c903312c3e734bfd9098a5e8773f2e19d01", "url": "https://api.github.com/repos/rust-lang/rust/commits/69715c903312c3e734bfd9098a5e8773f2e19d01", "html_url": "https://github.com/rust-lang/rust/commit/69715c903312c3e734bfd9098a5e8773f2e19d01"}], "stats": {"total": 64, "additions": 59, "deletions": 5}, "files": [{"sha": "b08d2b376a6806a190a9a7e60f8af3709ed34026", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/54744601bfae6d3e09ea8c958beab8d58e850434/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54744601bfae6d3e09ea8c958beab8d58e850434/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=54744601bfae6d3e09ea8c958beab8d58e850434", "patch": "@@ -250,13 +250,30 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                 .map_or_else(String::new, |res| format!(\"{} \", res.descr()));\n                 (mod_prefix, format!(\"`{}`\", Segment::names_to_string(mod_path)), None)\n             };\n+\n+            let (fallback_label, suggestion) = if path_str == \"async\"\n+                && expected.starts_with(\"struct\")\n+            {\n+                (\"`async` blocks are only allowed in Rust 2018 or later\".to_string(), suggestion)\n+            } else {\n+                // check if we are in situation of typo like `True` instead of `true`.\n+                let override_suggestion =\n+                    if [\"true\", \"false\"].contains(&item_str.to_string().to_lowercase().as_str()) {\n+                        let item_typo = item_str.to_string().to_lowercase();\n+                        Some((\n+                            item_span,\n+                            \"you may want to use a bool value instead\",\n+                            format!(\"{}\", item_typo),\n+                        ))\n+                    } else {\n+                        suggestion\n+                    };\n+                (format!(\"not found in {mod_str}\"), override_suggestion)\n+            };\n+\n             BaseError {\n                 msg: format!(\"cannot find {expected} `{item_str}` in {mod_prefix}{mod_str}\"),\n-                fallback_label: if path_str == \"async\" && expected.starts_with(\"struct\") {\n-                    \"`async` blocks are only allowed in Rust 2018 or later\".to_string()\n-                } else {\n-                    format!(\"not found in {mod_str}\")\n-                },\n+                fallback_label,\n                 span: item_span,\n                 span_label: None,\n                 could_be_expr: false,"}, {"sha": "deab0fb05b76b4cbe2e5ab4c7e41410b436e50f0", "filename": "src/test/ui/suggestions/bool_typo_err_suggest.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/54744601bfae6d3e09ea8c958beab8d58e850434/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54744601bfae6d3e09ea8c958beab8d58e850434/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.rs?ref=54744601bfae6d3e09ea8c958beab8d58e850434", "patch": "@@ -0,0 +1,12 @@\n+// Suggest the boolean value instead of emit a generic error that the value\n+// True is not in the scope.\n+\n+fn main() {\n+    let x = True;\n+    //~^ ERROR cannot find value `True` in this scope\n+    //~| HELP you may want to use a bool value instead\n+\n+    let y = False;\n+    //~^ ERROR cannot find value `False` in this scope\n+    //~| HELP you may want to use a bool value instead\n+}"}, {"sha": "52bde07ca07701e0f786a40f604fff1cb5a7b484", "filename": "src/test/ui/suggestions/bool_typo_err_suggest.stderr", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/54744601bfae6d3e09ea8c958beab8d58e850434/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/54744601bfae6d3e09ea8c958beab8d58e850434/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fbool_typo_err_suggest.stderr?ref=54744601bfae6d3e09ea8c958beab8d58e850434", "patch": "@@ -0,0 +1,25 @@\n+error[E0425]: cannot find value `True` in this scope\n+  --> $DIR/bool_typo_err_suggest.rs:5:13\n+   |\n+LL |     let x = True;\n+   |             ^^^^ not found in this scope\n+   |\n+help: you may want to use a bool value instead\n+   |\n+LL |     let x = true;\n+   |             ~~~~\n+\n+error[E0425]: cannot find value `False` in this scope\n+  --> $DIR/bool_typo_err_suggest.rs:9:13\n+   |\n+LL |     let y = False;\n+   |             ^^^^^ not found in this scope\n+   |\n+help: you may want to use a bool value instead\n+   |\n+LL |     let y = false;\n+   |             ~~~~~\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0425`."}]}