{"sha": "6bae4a763df95c436ce9f1286b1d593e67218932", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiYWU0YTc2M2RmOTVjNDM2Y2U5ZjEyODZiMWQ1OTNlNjcyMTg5MzI=", "commit": {"author": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2019-01-03T12:49:56Z"}, "committer": {"name": "Shotaro Yamada", "email": "sinkuu@sinkuu.xyz", "date": "2019-01-03T14:25:41Z"}, "message": "Fix unused_assignments false positive\n\nMake `continue` jump to the loop condition's `LiveNode` instead of one\nof the loop body.", "tree": {"sha": "d8f9cb57d24824dcefacdb5bb592a06601804968", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8f9cb57d24824dcefacdb5bb592a06601804968"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6bae4a763df95c436ce9f1286b1d593e67218932", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6bae4a763df95c436ce9f1286b1d593e67218932", "html_url": "https://github.com/rust-lang/rust/commit/6bae4a763df95c436ce9f1286b1d593e67218932", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6bae4a763df95c436ce9f1286b1d593e67218932/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "140936307e692c324815c9640696b3e3f0c7ae78", "url": "https://api.github.com/repos/rust-lang/rust/commits/140936307e692c324815c9640696b3e3f0c7ae78", "html_url": "https://github.com/rust-lang/rust/commit/140936307e692c324815c9640696b3e3f0c7ae78"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "71a104ba6e761a654c1ae1816978d2cbc80de860", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6bae4a763df95c436ce9f1286b1d593e67218932/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bae4a763df95c436ce9f1286b1d593e67218932/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=6bae4a763df95c436ce9f1286b1d593e67218932", "patch": "@@ -911,7 +911,7 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n     }\n \n     fn compute(&mut self, body: &hir::Expr) -> LiveNode {\n-        // if there is a `break` or `again` at the top level, then it's\n+        // if there is a `break` or `continue` at the top level, then it's\n         // effectively a return---this only occurs in `for` loops,\n         // where the body is really a closure.\n \n@@ -1407,15 +1407,16 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n         debug!(\"propagate_through_loop: using id for loop body {} {}\",\n                expr.id, self.ir.tcx.hir().node_to_pretty_string(body.id));\n \n-        let break_ln = succ;\n-        let cont_ln = ln;\n-        self.break_ln.insert(expr.id, break_ln);\n-        self.cont_ln.insert(expr.id, cont_ln);\n+\n+        self.break_ln.insert(expr.id, succ);\n \n         let cond_ln = match kind {\n             LoopLoop => ln,\n             WhileLoop(ref cond) => self.propagate_through_expr(&cond, ln),\n         };\n+\n+        self.cont_ln.insert(expr.id, cond_ln);\n+\n         let body_ln = self.propagate_through_block(body, cond_ln);\n \n         // repeat until fixed point is reached:"}, {"sha": "004663c85ee5018371b1e2dbe1601b573f752a55", "filename": "src/test/ui/liveness/liveness-dead.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6bae4a763df95c436ce9f1286b1d593e67218932/src%2Ftest%2Fui%2Fliveness%2Fliveness-dead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bae4a763df95c436ce9f1286b1d593e67218932/src%2Ftest%2Fui%2Fliveness%2Fliveness-dead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fliveness%2Fliveness-dead.rs?ref=6bae4a763df95c436ce9f1286b1d593e67218932", "patch": "@@ -27,4 +27,13 @@ fn f5(mut x: i32) {\n     x = 4; //~ ERROR: value assigned to `x` is never read\n }\n \n+// #22630\n+fn f6() {\n+    let mut done = false;\n+    while !done {\n+        done = true; // no error\n+        continue;\n+    }\n+}\n+\n fn main() {}"}]}