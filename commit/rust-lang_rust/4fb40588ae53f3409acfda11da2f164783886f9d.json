{"sha": "4fb40588ae53f3409acfda11da2f164783886f9d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmYjQwNTg4YWU1M2YzNDA5YWNmZGExMWRhMmYxNjQ3ODM4ODZmOWQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-14T15:59:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-14T15:59:08Z"}, "message": "Rollup merge of #53229 - varkor:rlimits_min, r=nikomatsakis\n\nMake sure rlimit is only ever increased\n\n`libc::setrlimit` will fail if we try to set the rlimit to a value lower than it is currently, so make sure we're never trying to do this. Fixes #52801.", "tree": {"sha": "15b94d16e933445b32bd97c72204642196ca73fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15b94d16e933445b32bd97c72204642196ca73fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fb40588ae53f3409acfda11da2f164783886f9d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbcvxMCRBK7hj4Ov3rIwAAdHIIAHY32iFNqC63PuKgWuwYiRk3\npa+5ty0frDgRPzd/NRp5XvKu9Utix6McTBm18HyOcZdNfoh8Dm4fUNjNROUFZVhP\n3o4NI0t/ruyDFqIZoGvruCBUCtoaufzVm7ikEpITW/tFmIJ8u2RvUWbTCcnYEo7v\nWPxMklL1oprnpPK4dM/wnzySconRkyYSmGPZamncIFkLX0s+ns/PInAMVmplpbqR\nzouNcO+GBl5S5BdsmKTi1t24NaCMcN+uJs6vbHs1QOBchC6v/dfcEXzDktEJffrR\nXsSZmKmoliR16flfwfjw5+ZSJcUdKZGusdjAbS9aASdojYdyUliG3V6FexJL73Y=\n=ehSJ\n-----END PGP SIGNATURE-----\n", "payload": "tree 15b94d16e933445b32bd97c72204642196ca73fc\nparent eeab08e97a86475446164600b0f144738b2bb567\nparent 82a704abe70c6f3ee4577254a963566639f4720c\nauthor kennytm <kennytm@gmail.com> 1534262348 +0800\ncommitter GitHub <noreply@github.com> 1534262348 +0800\n\nRollup merge of #53229 - varkor:rlimits_min, r=nikomatsakis\n\nMake sure rlimit is only ever increased\n\n`libc::setrlimit` will fail if we try to set the rlimit to a value lower than it is currently, so make sure we're never trying to do this. Fixes #52801.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fb40588ae53f3409acfda11da2f164783886f9d", "html_url": "https://github.com/rust-lang/rust/commit/4fb40588ae53f3409acfda11da2f164783886f9d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fb40588ae53f3409acfda11da2f164783886f9d/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eeab08e97a86475446164600b0f144738b2bb567", "url": "https://api.github.com/repos/rust-lang/rust/commits/eeab08e97a86475446164600b0f144738b2bb567", "html_url": "https://github.com/rust-lang/rust/commit/eeab08e97a86475446164600b0f144738b2bb567"}, {"sha": "82a704abe70c6f3ee4577254a963566639f4720c", "url": "https://api.github.com/repos/rust-lang/rust/commits/82a704abe70c6f3ee4577254a963566639f4720c", "html_url": "https://github.com/rust-lang/rust/commit/82a704abe70c6f3ee4577254a963566639f4720c"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "d25d57a004b5f64eeb6c6c25174ca2410a7ed71d", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4fb40588ae53f3409acfda11da2f164783886f9d/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fb40588ae53f3409acfda11da2f164783886f9d/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=4fb40588ae53f3409acfda11da2f164783886f9d", "patch": "@@ -1512,7 +1512,7 @@ pub fn in_named_rustc_thread<F, R>(name: String, f: F) -> Result<R, Box<dyn Any\n             true\n         } else if rlim.rlim_max < STACK_SIZE as libc::rlim_t {\n             true\n-        } else {\n+        } else if rlim.rlim_cur < STACK_SIZE as libc::rlim_t {\n             std::rt::deinit_stack_guard();\n             rlim.rlim_cur = STACK_SIZE as libc::rlim_t;\n             if libc::setrlimit(libc::RLIMIT_STACK, &mut rlim) != 0 {\n@@ -1524,6 +1524,8 @@ pub fn in_named_rustc_thread<F, R>(name: String, f: F) -> Result<R, Box<dyn Any\n                 std::rt::update_stack_guard();\n                 false\n             }\n+        } else {\n+            false\n         }\n     };\n "}, {"sha": "d1071231530d68f6929e0fb2b3814593f1f7c834", "filename": "src/tools/compiletest/src/raise_fd_limit.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4fb40588ae53f3409acfda11da2f164783886f9d/src%2Ftools%2Fcompiletest%2Fsrc%2Fraise_fd_limit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fb40588ae53f3409acfda11da2f164783886f9d/src%2Ftools%2Fcompiletest%2Fsrc%2Fraise_fd_limit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fraise_fd_limit.rs?ref=4fb40588ae53f3409acfda11da2f164783886f9d", "patch": "@@ -57,14 +57,16 @@ pub unsafe fn raise_fd_limit() {\n         panic!(\"raise_fd_limit: error calling getrlimit: {}\", err);\n     }\n \n-    // Bump the soft limit to the smaller of kern.maxfilesperproc and the hard\n-    // limit\n-    rlim.rlim_cur = cmp::min(maxfiles as libc::rlim_t, rlim.rlim_max);\n+    // Make sure we're only ever going to increase the rlimit.\n+    if rlim.rlim_cur < maxfiles as libc::rlim_t {\n+        // Bump the soft limit to the smaller of kern.maxfilesperproc and the hard limit.\n+        rlim.rlim_cur = cmp::min(maxfiles as libc::rlim_t, rlim.rlim_max);\n \n-    // Set our newly-increased resource limit\n-    if libc::setrlimit(libc::RLIMIT_NOFILE, &rlim) != 0 {\n-        let err = io::Error::last_os_error();\n-        panic!(\"raise_fd_limit: error calling setrlimit: {}\", err);\n+        // Set our newly-increased resource limit.\n+        if libc::setrlimit(libc::RLIMIT_NOFILE, &rlim) != 0 {\n+            let err = io::Error::last_os_error();\n+            panic!(\"raise_fd_limit: error calling setrlimit: {}\", err);\n+        }\n     }\n }\n "}]}