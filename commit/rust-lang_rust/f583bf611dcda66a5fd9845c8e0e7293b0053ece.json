{"sha": "f583bf611dcda66a5fd9845c8e0e7293b0053ece", "node_id": "C_kwDOAAsO6NoAKGY1ODNiZjYxMWRjZGE2NmE1ZmQ5ODQ1YzhlMGU3MjkzYjAwNTNlY2U", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-08-11T17:17:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-11T17:17:07Z"}, "message": "Rollup merge of #100403 - GuillaumeGomez:improve-messages, r=jsha\n\nImprove error messages when running rustdoc GUI tests\n\nThere was already a message on how to install `browser-ui-test`, so nothing to be done there. However, we didn't show how to update its version, so the first commit adds it.\n\nAnother pain point was how to fix the unexpected crash in `browser-ui-test` (because of a missing `--no-sandbox`, still no idea why it became mandatory a few months ago on some linux distributions...). It now looks like this:\n\n```console\nRunning 1 rustdoc-gui (8 concurrently) ...\nERROR: puppeteer failed when trying to create a new page. Please try again with `--no-sandbox`\n\n`browser-ui-test` crashed unexpectedly. Please try again with adding `--test-args --no-sandbox` at the end. For example: `x.py test src/test/rustdoc-gui --test-args --no-sandbox`\n\nBuild completed unsuccessfully in 0:00:03\n```\n\nThanks to `@jsha` for suggesting these improvements!\n\nr? `@jsha`", "tree": {"sha": "2f04efd7c69095fca1a6949ae82cc43f80adeb4c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f04efd7c69095fca1a6949ae82cc43f80adeb4c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f583bf611dcda66a5fd9845c8e0e7293b0053ece", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi9TmTCRBK7hj4Ov3rIwAAFUQIACwoXbe37AjrwteEWzZ2bw2o\nYmuOVrFmYZ4ZBMgJe13bVgsNjn1wC0qTjeUfMg82wHViLjLOgK/an/iYHEdh7CKU\nmyK38gBHysDTXV70+Os0+Y/4rUtPjAszugZZkNQX4bSn8sKEhgDQ/AosyK5cLhC+\npBeYZlGz5fDIbQ3spueeU5e1yprQ4jzjB4ezjd4KjIH9JwYpRA2aW/aIcIQVBLPJ\n8ueHVqcCgbPeP8u+rIxS2TvIoOTx+ZoXudEPkTidu5pN43Tt3huqy1RK+Rl5c8pM\nYko8mqYmFHuPzq1ka1ZQyj9GETQMUEkHhvzzavBI8CCvr+ePm2MmFru35g+sIss=\n=XiHu\n-----END PGP SIGNATURE-----\n", "payload": "tree 2f04efd7c69095fca1a6949ae82cc43f80adeb4c\nparent 7ecc8923dbebe5b47a090e406865cd381e80e220\nparent 46af79c0ab545589d1a6569fb773c544a8d51547\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1660238227 +0530\ncommitter GitHub <noreply@github.com> 1660238227 +0530\n\nRollup merge of #100403 - GuillaumeGomez:improve-messages, r=jsha\n\nImprove error messages when running rustdoc GUI tests\n\nThere was already a message on how to install `browser-ui-test`, so nothing to be done there. However, we didn't show how to update its version, so the first commit adds it.\n\nAnother pain point was how to fix the unexpected crash in `browser-ui-test` (because of a missing `--no-sandbox`, still no idea why it became mandatory a few months ago on some linux distributions...). It now looks like this:\n\n```console\nRunning 1 rustdoc-gui (8 concurrently) ...\nERROR: puppeteer failed when trying to create a new page. Please try again with `--no-sandbox`\n\n`browser-ui-test` crashed unexpectedly. Please try again with adding `--test-args --no-sandbox` at the end. For example: `x.py test src/test/rustdoc-gui --test-args --no-sandbox`\n\nBuild completed unsuccessfully in 0:00:03\n```\n\nThanks to `@jsha` for suggesting these improvements!\n\nr? `@jsha`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f583bf611dcda66a5fd9845c8e0e7293b0053ece", "html_url": "https://github.com/rust-lang/rust/commit/f583bf611dcda66a5fd9845c8e0e7293b0053ece", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f583bf611dcda66a5fd9845c8e0e7293b0053ece/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ecc8923dbebe5b47a090e406865cd381e80e220", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ecc8923dbebe5b47a090e406865cd381e80e220", "html_url": "https://github.com/rust-lang/rust/commit/7ecc8923dbebe5b47a090e406865cd381e80e220"}, {"sha": "46af79c0ab545589d1a6569fb773c544a8d51547", "url": "https://api.github.com/repos/rust-lang/rust/commits/46af79c0ab545589d1a6569fb773c544a8d51547", "html_url": "https://github.com/rust-lang/rust/commit/46af79c0ab545589d1a6569fb773c544a8d51547"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "baad0c75295a575b03ee00c06e5b4e92e9aecce2", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f583bf611dcda66a5fd9845c8e0e7293b0053ece/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f583bf611dcda66a5fd9845c8e0e7293b0053ece/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=f583bf611dcda66a5fd9845c8e0e7293b0053ece", "patch": "@@ -924,6 +924,11 @@ fn compare_browser_ui_test_version(installed_version: &str, src: &Path) {\n                      one used in the CI (`{}`)\",\n                     installed_version, v\n                 );\n+                eprintln!(\n+                    \"You can install this version using `npm update browser-ui-test` or by using \\\n+                     `npm install browser-ui-test@{}`\",\n+                    v,\n+                );\n             }\n         }\n         Err(e) => eprintln!(\"Couldn't find the CI browser-ui-test version: {:?}\", e),"}, {"sha": "70d5f94472f6b598829a7256a47e95c642a0d2c6", "filename": "src/tools/rustdoc-gui/tester.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f583bf611dcda66a5fd9845c8e0e7293b0053ece/src%2Ftools%2Frustdoc-gui%2Ftester.js", "raw_url": "https://github.com/rust-lang/rust/raw/f583bf611dcda66a5fd9845c8e0e7293b0053ece/src%2Ftools%2Frustdoc-gui%2Ftester.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustdoc-gui%2Ftester.js?ref=f583bf611dcda66a5fd9845c8e0e7293b0053ece", "patch": "@@ -201,6 +201,19 @@ async function main(argv) {\n         process.setMaxListeners(opts[\"jobs\"] + 1);\n     }\n \n+    // We catch this \"event\" to display a nicer message in case of unexpected exit (because of a\n+    // missing `--no-sandbox`).\n+    const exitHandling = (code) => {\n+        if (!opts[\"no_sandbox\"]) {\n+            console.log(\"\");\n+            console.log(\n+                \"`browser-ui-test` crashed unexpectedly. Please try again with adding `--test-args \\\n+--no-sandbox` at the end. For example: `x.py test src/test/rustdoc-gui --test-args --no-sandbox`\");\n+            console.log(\"\");\n+        }\n+    };\n+    process.on('exit', exitHandling);\n+\n     const tests_queue = [];\n     let results = {\n         successful: [],\n@@ -247,6 +260,9 @@ async function main(argv) {\n     }\n     status_bar.finish();\n \n+    // We don't need this listener anymore.\n+    process.removeListener(\"exit\", exitHandling);\n+\n     if (debug) {\n         results.successful.sort(by_filename);\n         results.successful.forEach(r => {"}]}