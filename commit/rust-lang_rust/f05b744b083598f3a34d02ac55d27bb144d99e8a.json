{"sha": "f05b744b083598f3a34d02ac55d27bb144d99e8a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwNWI3NDRiMDgzNTk4ZjNhMzRkMDJhYzU1ZDI3YmIxNDRkOTllOGE=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-09-25T21:15:32Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-09-25T21:15:32Z"}, "message": "disable proc-macro re-export inlining\n\nProc-macros don't emit their attributes or source spans across crates.\nThis means that rustdoc can't actually see the docs of a proc-macro if\nit wasn't defined in the active crate, and attempting to inline it\ncreates an empty page with no docs or source link. In lieu of attempting\nto fix that immediately, this commit forces proc-macro re-exports to\nnever inline, which at least creates usable links to complete\ndocumentation.", "tree": {"sha": "f06a930805a416da00807f251bf3ec151ce9b2dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f06a930805a416da00807f251bf3ec151ce9b2dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f05b744b083598f3a34d02ac55d27bb144d99e8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f05b744b083598f3a34d02ac55d27bb144d99e8a", "html_url": "https://github.com/rust-lang/rust/commit/f05b744b083598f3a34d02ac55d27bb144d99e8a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f05b744b083598f3a34d02ac55d27bb144d99e8a/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aea1bd0a5908430d41b6f2d38240f2652ef5651f", "url": "https://api.github.com/repos/rust-lang/rust/commits/aea1bd0a5908430d41b6f2d38240f2652ef5651f", "html_url": "https://github.com/rust-lang/rust/commit/aea1bd0a5908430d41b6f2d38240f2652ef5651f"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "4d1b6b8b1a98e1cb40e4ad2949a6b15b257f315a", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f05b744b083598f3a34d02ac55d27bb144d99e8a/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f05b744b083598f3a34d02ac55d27bb144d99e8a/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=f05b744b083598f3a34d02ac55d27bb144d99e8a", "patch": "@@ -105,14 +105,15 @@ pub fn try_inline(cx: &DocContext, def: Def, name: ast::Name, visited: &mut FxHa\n             record_extern_fqn(cx, did, clean::TypeKind::Const);\n             clean::ConstantItem(build_const(cx, did))\n         }\n-        Def::Macro(did, mac_kind) => {\n-            match mac_kind {\n-                MacroKind::Bang => record_extern_fqn(cx, did, clean::TypeKind::Macro),\n-                MacroKind::Attr => record_extern_fqn(cx, did, clean::TypeKind::Attr),\n-                MacroKind::Derive => record_extern_fqn(cx, did, clean::TypeKind::Derive),\n-                MacroKind::ProcMacroStub => return None,\n+        // FIXME: proc-macros don't propagate attributes or spans across crates, so they look empty\n+        Def::Macro(did, MacroKind::Bang) => {\n+            let mac = build_macro(cx, did, name);\n+            if let clean::MacroItem(..) = mac {\n+                record_extern_fqn(cx, did, clean::TypeKind::Macro);\n+                mac\n+            } else {\n+                return None;\n             }\n-            build_macro(cx, did, name)\n         }\n         _ => return None,\n     };"}]}