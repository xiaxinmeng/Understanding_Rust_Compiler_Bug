{"sha": "fddfd089b75379f1d25f81541572d69a93f95c4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkZGZkMDg5Yjc1Mzc5ZjFkMjVmODE1NDE1NzJkNjlhOTNmOTVjNGY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-10T14:52:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-10T14:52:48Z"}, "message": "Auto merge of #26928 - reem:cstr-is-a-cow, r=Gankro\n\nThis allows CString and CStr to be used with the Cow type,\nwhich is extremely useful when interfacing with C libraries\nthat make extensive use of C-style strings.", "tree": {"sha": "0c5bb22a9600f6b62e96e7e1ef60f1f1a846237b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c5bb22a9600f6b62e96e7e1ef60f1f1a846237b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fddfd089b75379f1d25f81541572d69a93f95c4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fddfd089b75379f1d25f81541572d69a93f95c4f", "html_url": "https://github.com/rust-lang/rust/commit/fddfd089b75379f1d25f81541572d69a93f95c4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fddfd089b75379f1d25f81541572d69a93f95c4f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdcce3ba4491436e6603833cee19533003993117", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdcce3ba4491436e6603833cee19533003993117", "html_url": "https://github.com/rust-lang/rust/commit/cdcce3ba4491436e6603833cee19533003993117"}, {"sha": "69579e4d37849fe64cbdfc7e40dc614af802704d", "url": "https://api.github.com/repos/rust-lang/rust/commits/69579e4d37849fe64cbdfc7e40dc614af802704d", "html_url": "https://github.com/rust-lang/rust/commit/69579e4d37849fe64cbdfc7e40dc614af802704d"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "f13c10156f579acd7b01801ba1f29a0d415d5584", "filename": "src/libstd/ffi/c_str.rs", "status": "modified", "additions": 39, "deletions": 1, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/fddfd089b75379f1d25f81541572d69a93f95c4f/src%2Flibstd%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fddfd089b75379f1d25f81541572d69a93f95c4f/src%2Flibstd%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fc_str.rs?ref=fddfd089b75379f1d25f81541572d69a93f95c4f", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use borrow::{Cow, ToOwned};\n+use borrow::{Cow, ToOwned, Borrow};\n use boxed::Box;\n use clone::Clone;\n use convert::{Into, From};\n@@ -272,6 +272,11 @@ impl fmt::Debug for CString {\n     }\n }\n \n+#[stable(feature = \"cstr_borrow\", since = \"1.3.0\")]\n+impl Borrow<CStr> for CString {\n+    fn borrow(&self) -> &CStr { self }\n+}\n+\n impl NulError {\n     /// Returns the position of the nul byte in the slice that was provided to\n     /// `CString::new`.\n@@ -444,6 +449,15 @@ impl Ord for CStr {\n     }\n }\n \n+#[stable(feature = \"cstr_borrow\", since = \"1.3.0\")]\n+impl ToOwned for CStr {\n+    type Owned = CString;\n+\n+    fn to_owned(&self) -> CString {\n+        unsafe { CString::from_vec_unchecked(self.to_bytes().to_vec()) }\n+    }\n+}\n+\n #[cfg(test)]\n mod tests {\n     use prelude::v1::*;\n@@ -515,4 +529,28 @@ mod tests {\n             assert_eq!(CStr::from_ptr(ptr).to_string_lossy(), Owned::<str>(format!(\"123\\u{FFFD}\")));\n         }\n     }\n+\n+    #[test]\n+    fn to_owned() {\n+        let data = b\"123\\0\";\n+        let ptr = data.as_ptr() as *const libc::c_char;\n+\n+        let owned = unsafe { CStr::from_ptr(ptr).to_owned() };\n+        assert_eq!(owned.as_bytes_with_nul(), data);\n+    }\n+\n+    #[test]\n+    fn equal_hash() {\n+        use hash;\n+\n+        let data = b\"123\\xE2\\xFA\\xA6\\0\";\n+        let ptr = data.as_ptr() as *const libc::c_char;\n+        let cstr: &'static CStr = unsafe { CStr::from_ptr(ptr) };\n+\n+        let cstr_hash = hash::hash::<_, hash::SipHasher>(&cstr);\n+        let cstring_hash =\n+            hash::hash::<_, hash::SipHasher>(&CString::new(&data[..data.len() - 1]).unwrap());\n+\n+        assert_eq!(cstr_hash, cstring_hash);\n+    }\n }"}, {"sha": "1e82a03f286302d0e951d62c3e2622f198ebd598", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fddfd089b75379f1d25f81541572d69a93f95c4f/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fddfd089b75379f1d25f81541572d69a93f95c4f/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=fddfd089b75379f1d25f81541572d69a93f95c4f", "patch": "@@ -150,7 +150,7 @@\n #![feature(wrapping)]\n #![feature(zero_one)]\n #![cfg_attr(windows, feature(str_utf16))]\n-#![cfg_attr(test, feature(float_from_str_radix, range_inclusive, float_extras))]\n+#![cfg_attr(test, feature(float_from_str_radix, range_inclusive, float_extras, hash_default))]\n #![cfg_attr(test, feature(test, rustc_private, float_consts))]\n #![cfg_attr(target_env = \"msvc\", feature(link_args))]\n "}]}