{"sha": "3bc33ae712d24f19f348828b0b18cda3d09a2360", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiYzMzYWU3MTJkMjRmMTlmMzQ4ODI4YjBiMThjZGEzZDA5YTIzNjA=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-03-06T23:53:26Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-03-07T00:06:46Z"}, "message": "Add test demonstrating logic for handling deps.", "tree": {"sha": "6a3d733ed36819d020d9280d561f048004e45020", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a3d733ed36819d020d9280d561f048004e45020"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3bc33ae712d24f19f348828b0b18cda3d09a2360", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlyAYJYACgkQAXYLT59T\n8VSt9RAAlvuaOgmdUkMIgsWM+Uko2+sZKBXHqs52A11cFvPIDxOk/PdyeQOl5A1y\n5rr8N7s4FWb25HZ7JSEF0EegpMhQGPV28BnCF3EvdCxOOpQGX7WSyuGz6Dt1dyZj\nSQgoYHc5aeJhWyKxdOLYT9X9e2WbiuqGN587533BiKE1FmEQZ0pALNmjKpTyljc+\nNU875bEAYGEABj5xVUDG17m061eTJFECrkhKN/dCCXOBFB4SamvP45gtMyiK7Zn9\npRpXLkhEpqUCoshQO28IjV5My0jJsqN9M82EBV61CfN4l+SSq6gzqcJ6PM8GzGIC\nlG7mHk9TzwpT00KLGcYavbsHJ6z8Uv87okJYdfsmXJIDkFl1KzAw+/lzvzA2sYa1\nh0GDi7eXE/oPNvv8BYon20E8EiVNrtoqit2JSBxv2zwzfRGu5u7sHWCrAyUIUT4+\nh6Fw1R0IN2GhJ/dotZx57JvRwi2hfcBOegvFN+I/5IFE2oTlLg4j2u0mPr1lEKaC\nXqA5wMzOaBk3pEeOkLX6fN8idUS9Hxluk/fAOsv+5TgI/uosTMbmdHEu1TBk+CmM\n9jNULN6ZD/a6PW9OkhaqH0Huge/gNG6cZPJybPYrhSbt1M/YXbFeDAmNwj4A0Ly/\nCnKJtyMX/AjuywP0DtfDKlilhL/yHOMl6G8eVuNt2k5qzBCBHWE=\n=LmpW\n-----END PGP SIGNATURE-----", "payload": "tree 6a3d733ed36819d020d9280d561f048004e45020\nparent 614dd3c34721a4f97e8c4f1eb89aed4362338ebb\nauthor David Wood <david@davidtw.co> 1551916406 +0100\ncommitter David Wood <david@davidtw.co> 1551917206 +0100\n\nAdd test demonstrating logic for handling deps.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3bc33ae712d24f19f348828b0b18cda3d09a2360", "html_url": "https://github.com/rust-lang/rust/commit/3bc33ae712d24f19f348828b0b18cda3d09a2360", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3bc33ae712d24f19f348828b0b18cda3d09a2360/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "url": "https://api.github.com/repos/rust-lang/rust/commits/614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "html_url": "https://github.com/rust-lang/rust/commit/614dd3c34721a4f97e8c4f1eb89aed4362338ebb"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "8e4e1fb887b8a49f725dff258a0476b00aa9f377", "filename": "crates/ra_lsp_server/tests/heavy_tests/main.rs", "status": "modified", "additions": 44, "deletions": 1, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/3bc33ae712d24f19f348828b0b18cda3d09a2360/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bc33ae712d24f19f348828b0b18cda3d09a2360/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs?ref=3bc33ae712d24f19f348828b0b18cda3d09a2360", "patch": "@@ -279,7 +279,7 @@ fn main() {}\n         PATH = tmp_dir.path().display()\n     );\n     let server = project_with_tmpdir(tmp_dir, &code);\n-    server.wait_for_feedback(\"workspace loaded\");\n+    server.wait_for_message(\"workspace loaded\");\n     let empty_context = || CodeActionContext { diagnostics: Vec::new(), only: None };\n     server.request::<CodeActionRequest>(\n         CodeActionParams {\n@@ -321,3 +321,46 @@ fn main() {}\n         json!([]),\n     );\n }\n+\n+#[test]\n+fn completes_items_from_second_crate_in_json_project() {\n+    let tmp_dir = TempDir::new().unwrap();\n+    let code = format!(\n+        r#\"\n+//- rust-project.json\n+{{ \n+    \"roots\": [ \"{PATH}\" ], \n+    \"crates\": [ \n+        {{ \n+            \"root_module\": \"{PATH}/foo/lib.rs\",\n+            \"deps\": [\n+                {{\n+                    \"name\": \"bar\",\n+                    \"crate\": 1\n+                }}\n+            ], \n+            \"edition\": \"2015\" \n+        }},\n+        {{ \"root_module\": \"{PATH}/bar/lib.rs\", \"deps\": [], \"edition\": \"2015\" }}\n+    ] \n+}}\n+\n+//- bar/lib.rs\n+pub struct Spam;\n+pub struct CannedMeat;\n+\n+//- foo/lib.rs\n+extern crate bar;\n+use bar::Spam;\n+\"#,\n+        PATH = tmp_dir.path().display()\n+    );\n+    let server = project_with_tmpdir(tmp_dir, &code);\n+    server.wait_for_message(\"workspace loaded\");\n+    let res = server.send_request::<Completion>(CompletionParams {\n+        text_document: server.doc_id(\"foo/lib.rs\"),\n+        context: None,\n+        position: Position::new(1, 10),\n+    });\n+    assert!(format!(\"{}\", res).contains(\"CannedMeat\"));\n+}"}]}