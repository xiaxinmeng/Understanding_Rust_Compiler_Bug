{"sha": "03eca713816ee00ecacde27cc655dc199c6bff40", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzZWNhNzEzODE2ZWUwMGVjYWNkZTI3Y2M2NTVkYzE5OWM2YmZmNDA=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-03-25T02:14:58Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-03-25T06:37:25Z"}, "message": "Point at last valid token on failed `expect_one_of`\n\n```rust\nerror: expected one of `.`, `;`, `?`, `}`, or an operator, found `)`\n  --> $DIR/token-error-correct-3.rs:29:9\n   |\n25 |         foo()\n   |             - expected one of `.`, `;`, `?`, `}`, or an operator after this\n...\n29 |     } else {\n   |     ^ unexpected token\n```", "tree": {"sha": "43fbd80f7275db3d76bc4118b1a97c2c4e4597cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43fbd80f7275db3d76bc4118b1a97c2c4e4597cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/03eca713816ee00ecacde27cc655dc199c6bff40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/03eca713816ee00ecacde27cc655dc199c6bff40", "html_url": "https://github.com/rust-lang/rust/commit/03eca713816ee00ecacde27cc655dc199c6bff40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/03eca713816ee00ecacde27cc655dc199c6bff40/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c62e532f3de4c0254b772c36fe629b2042efd107", "url": "https://api.github.com/repos/rust-lang/rust/commits/c62e532f3de4c0254b772c36fe629b2042efd107", "html_url": "https://github.com/rust-lang/rust/commit/c62e532f3de4c0254b772c36fe629b2042efd107"}], "stats": {"total": 57, "additions": 37, "deletions": 20}, "files": [{"sha": "6379015055b60102b7452a23c087c0bfe30649c0", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -548,20 +548,20 @@ impl<'a> Parser<'a> {\n             expected.dedup();\n             let expect = tokens_to_string(&expected[..]);\n             let actual = self.this_token_to_string();\n-            Err(self.fatal(\n-                &(if expected.len() > 1 {\n-                    (format!(\"expected one of {}, found `{}`\",\n-                             expect,\n-                             actual))\n-                } else if expected.is_empty() {\n-                    (format!(\"unexpected token: `{}`\",\n-                             actual))\n-                } else {\n-                    (format!(\"expected {}, found `{}`\",\n-                             expect,\n-                             actual))\n-                })[..]\n-            ))\n+            let (msg_exp, label_exp) = if expected.len() > 1 {\n+                (format!(\"expected one of {}, found `{}`\", expect, actual),\n+                 format!(\"expected one of {} after this\", expect))\n+            } else if expected.is_empty() {\n+                (format!(\"unexpected token: `{}`\", actual),\n+                 \"unexpected token after this\".to_string())\n+            } else {\n+                (format!(\"expected {}, found `{}`\", expect, actual),\n+                 format!(\"expected {} after this\", expect))\n+            };\n+            let mut err = self.fatal(&msg_exp);\n+            err.span_label(self.prev_span, &label_exp);\n+            err.span_label(self.span, &\"unexpected token\");\n+            Err(err)\n         }\n     }\n "}, {"sha": "93759123618fbac94701fea954325dc370335dc7", "filename": "src/test/compile-fail/issue-10636-2.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -14,5 +14,7 @@\n pub fn trace_option(option: Option<isize>) {\n     option.map(|some| 42; //~ NOTE: unclosed delimiter\n                           //~^ ERROR: expected one of\n+                          //~| NOTE: expected one of\n+                          //~| NOTE: unexpected token\n } //~ ERROR: incorrect close delimiter\n //~^ ERROR: expected expression, found `)`"}, {"sha": "682664df981098dd0f91768468c9f16e423b79b8", "filename": "src/test/compile-fail/macro-incomplete-parse.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fcompile-fail%2Fmacro-incomplete-parse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fcompile-fail%2Fmacro-incomplete-parse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmacro-incomplete-parse.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -20,6 +20,8 @@ macro_rules! ignored_item {\n \n macro_rules! ignored_expr {\n     () => ( 1,  //~ ERROR expected one of `.`, `;`, `?`, `}`, or an operator, found `,`\n+                //~^ NOTE expected one of `.`, `;`, `?`, `}`, or an operator after this\n+                //~| NOTE unexpected token\n             2 )\n }\n "}, {"sha": "02c119cf727fe473b0518fd58847eb07909cee6e", "filename": "src/test/parse-fail/bounds-obj-parens.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Fbounds-obj-parens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Fbounds-obj-parens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Fbounds-obj-parens.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -12,4 +12,6 @@\n \n type A = Box<(Fn(D::Error) -> E) + 'static + Send + Sync>; // OK (but see #39318)\n \n-FAIL //~ ERROR\n+FAIL\n+//~^ ERROR\n+//~| ERROR"}, {"sha": "7bb1c40118a4d2b9cbddaf30e9a6eaf86c082c4c", "filename": "src/test/parse-fail/match-refactor-to-expr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Fmatch-refactor-to-expr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Fmatch-refactor-to-expr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Fmatch-refactor-to-expr.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -14,7 +14,9 @@ fn main() {\n     let foo =\n         match //~ NOTE did you mean to remove this `match` keyword?\n         Some(4).unwrap_or_else(5)\n-        ; //~ ERROR expected one of `.`, `?`, `{`, or an operator, found `;`\n+        //~^ NOTE expected one of `.`, `?`, `{`, or an operator after this\n+        ; //~ NOTE unexpected token\n+        //~^ ERROR expected one of `.`, `?`, `{`, or an operator, found `;`\n \n     println!(\"{}\", foo)\n }"}, {"sha": "2bb2c97790c124fd4427acd4d6f1b1ad5947fa79", "filename": "src/test/parse-fail/trailing-plus-in-bounds.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Ftrailing-plus-in-bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fparse-fail%2Ftrailing-plus-in-bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Ftrailing-plus-in-bounds.rs?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -16,4 +16,6 @@ fn main() {\n     let x: Box<Debug+> = box 3 as Box<Debug+>; // Trailing `+` is OK\n }\n \n-FAIL //~ ERROR\n+FAIL\n+//~^ ERROR\n+//~| ERROR"}, {"sha": "2e0edf0c4b8d12153bb42591f1dbb61a6e0358c0", "filename": "src/test/ui/resolve/token-error-correct-3.stderr", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -14,13 +14,18 @@ error: expected one of `,`, `.`, `?`, or an operator, found `;`\n   --> $DIR/token-error-correct-3.rs:23:35\n    |\n 23 |             callback(path.as_ref();  //~ NOTE: unclosed delimiter\n-   |                                   ^\n+   |                                  -^ unexpected token\n+   |                                  |\n+   |                                  expected one of `,`, `.`, `?`, or an operator after this\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `)`\n   --> $DIR/token-error-correct-3.rs:29:9\n    |\n+25 |             fs::create_dir_all(path.as_ref()).map(|()| true) //~ ERROR: mismatched types\n+   |                                                            - expected one of `.`, `;`, `?`, `}`, or an operator after this\n+...\n 29 |         } else { //~ ERROR: incorrect close delimiter: `}`\n-   |         ^\n+   |         ^ unexpected token\n \n error[E0425]: cannot find function `is_directory` in this scope\n   --> $DIR/token-error-correct-3.rs:21:13"}, {"sha": "36f298a456a6097619ba11926e59bc2626a85bd9", "filename": "src/test/ui/resolve/token-error-correct.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/03eca713816ee00ecacde27cc655dc199c6bff40/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct.stderr?ref=03eca713816ee00ecacde27cc655dc199c6bff40", "patch": "@@ -32,7 +32,9 @@ error: expected one of `)`, `,`, `.`, `<`, `?`, `break`, `continue`, `false`, `f\n   --> $DIR/token-error-correct.rs:14:13\n    |\n 14 |     foo(bar(;\n-   |             ^\n+   |            -^ unexpected token\n+   |            |\n+   |            expected one of `)`, `,`, `.`, `<`, `?`, `break`, `continue`, `false`, `for`, `if`, `loop`, `match`, `move`, `return`, `true`, `unsafe`, `while`, or an operator after this\n \n error: expected expression, found `)`\n   --> $DIR/token-error-correct.rs:23:1"}]}