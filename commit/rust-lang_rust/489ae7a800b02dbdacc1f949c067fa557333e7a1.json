{"sha": "489ae7a800b02dbdacc1f949c067fa557333e7a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4OWFlN2E4MDBiMDJkYmRhY2MxZjk0OWMwNjdmYTU1NzMzM2U3YTE=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-05-24T18:29:48Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-05-24T18:29:48Z"}, "message": "Make `TokenTextRange` private", "tree": {"sha": "05fd003ccc166e52cf81e305a1073d56aed572ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05fd003ccc166e52cf81e305a1073d56aed572ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/489ae7a800b02dbdacc1f949c067fa557333e7a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/489ae7a800b02dbdacc1f949c067fa557333e7a1", "html_url": "https://github.com/rust-lang/rust/commit/489ae7a800b02dbdacc1f949c067fa557333e7a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/489ae7a800b02dbdacc1f949c067fa557333e7a1/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27bf62b70eeb6f4cb620be5630c4c4506be3539f", "url": "https://api.github.com/repos/rust-lang/rust/commits/27bf62b70eeb6f4cb620be5630c4c4506be3539f", "html_url": "https://github.com/rust-lang/rust/commit/27bf62b70eeb6f4cb620be5630c4c4506be3539f"}], "stats": {"total": 21, "additions": 10, "deletions": 11}, "files": [{"sha": "03637878bc7cf1fc9c5f1bb79f0a1811381ad928", "filename": "crates/hir_expand/src/db.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fdb.rs?ref=489ae7a800b02dbdacc1f949c067fa557333e7a1", "patch": "@@ -155,7 +155,7 @@ pub fn expand_hypothetical(\n         mbe::token_tree_to_syntax_node(&hypothetical_expansion.value, fragment_kind).ok()?;\n \n     let token_id = macro_def.map_id_down(token_id);\n-    let range = tmap_2.range_by_token(token_id)?.by_kind(token_to_map.kind())?;\n+    let range = tmap_2.range_by_token(token_id, token_to_map.kind())?;\n     let token = node.syntax_node().covering_element(range).into_token()?;\n     Some((node.syntax_node(), token))\n }"}, {"sha": "d98913907ada12f5203674ce3de3b487137fb35e", "filename": "crates/hir_expand/src/hygiene.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Fhygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Fhygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fhygiene.rs?ref=489ae7a800b02dbdacc1f949c067fa557333e7a1", "patch": "@@ -154,7 +154,7 @@ impl HygieneInfo {\n             },\n         };\n \n-        let range = token_map.range_by_token(token_id)?.by_kind(SyntaxKind::IDENT)?;\n+        let range = token_map.range_by_token(token_id, SyntaxKind::IDENT)?;\n         Some((tt.with_value(range + tt.value), origin))\n     }\n }"}, {"sha": "6be4516a327dfb57ed0b95d99eb5adf897bbaa02", "filename": "crates/hir_expand/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fhir_expand%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Flib.rs?ref=489ae7a800b02dbdacc1f949c067fa557333e7a1", "patch": "@@ -329,7 +329,7 @@ impl ExpansionInfo {\n         let token_id = self.macro_arg.1.token_by_range(range)?;\n         let token_id = self.macro_def.map_id_down(token_id);\n \n-        let range = self.exp_map.range_by_token(token_id)?.by_kind(token.value.kind())?;\n+        let range = self.exp_map.range_by_token(token_id, token.value.kind())?;\n \n         let token = self.expanded.value.covering_element(range).into_token()?;\n \n@@ -354,7 +354,7 @@ impl ExpansionInfo {\n             },\n         };\n \n-        let range = token_map.range_by_token(token_id)?.by_kind(token.value.kind())?;\n+        let range = token_map.range_by_token(token_id, token.value.kind())?;\n         let token =\n             tt.value.covering_element(range + tt.value.text_range().start()).into_token()?;\n         Some((tt.with_value(token), origin))"}, {"sha": "5f173f5134c6bd13aa658c46ab563515485b03b9", "filename": "crates/mbe/src/tests/expand.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs?ref=489ae7a800b02dbdacc1f949c067fa557333e7a1", "patch": "@@ -58,9 +58,8 @@ macro_rules! foobar {\n     let (node, token_map) = token_tree_to_syntax_node(&expanded, FragmentKind::Items).unwrap();\n     let content = node.syntax_node().to_string();\n \n-    let get_text = |id, kind| -> String {\n-        content[token_map.range_by_token(id).unwrap().by_kind(kind).unwrap()].to_string()\n-    };\n+    let get_text =\n+        |id, kind| -> String { content[token_map.range_by_token(id, kind).unwrap()].to_string() };\n \n     assert_eq!(expanded.token_trees.len(), 4);\n     // {($e:ident) => { fn $e() {} }}"}, {"sha": "0567475bea235de6e373ba579aafcd4edbdadfc7", "filename": "crates/mbe/src/token_map.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fmbe%2Fsrc%2Ftoken_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/489ae7a800b02dbdacc1f949c067fa557333e7a1/crates%2Fmbe%2Fsrc%2Ftoken_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftoken_map.rs?ref=489ae7a800b02dbdacc1f949c067fa557333e7a1", "patch": "@@ -2,13 +2,13 @@ use parser::{SyntaxKind, T};\n use syntax::{TextRange, TextSize};\n \n #[derive(Debug, PartialEq, Eq, Clone, Copy)]\n-pub enum TokenTextRange {\n+enum TokenTextRange {\n     Token(TextRange),\n     Delimiter(TextRange),\n }\n \n impl TokenTextRange {\n-    pub fn by_kind(self, kind: SyntaxKind) -> Option<TextRange> {\n+    fn by_kind(self, kind: SyntaxKind) -> Option<TextRange> {\n         match self {\n             TokenTextRange::Token(it) => Some(it),\n             TokenTextRange::Delimiter(it) => match kind {\n@@ -42,9 +42,9 @@ impl TokenMap {\n         Some(token_id)\n     }\n \n-    pub fn range_by_token(&self, token_id: tt::TokenId) -> Option<TokenTextRange> {\n+    pub fn range_by_token(&self, token_id: tt::TokenId, kind: SyntaxKind) -> Option<TextRange> {\n         let &(_, range) = self.entries.iter().find(|(tid, _)| *tid == token_id)?;\n-        Some(range)\n+        range.by_kind(kind)\n     }\n \n     pub(crate) fn shrink_to_fit(&mut self) {"}]}