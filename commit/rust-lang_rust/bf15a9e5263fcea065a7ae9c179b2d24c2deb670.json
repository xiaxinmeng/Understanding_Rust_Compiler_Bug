{"sha": "bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "node_id": "C_kwDOAAsO6NoAKGJmMTVhOWU1MjYzZmNlYTA2NWE3YWU5YzE3OWIyZDI0YzJkZWI2NzA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-14T20:15:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-14T20:15:51Z"}, "message": "Auto merge of #101030 - woppopo:const_location, r=scottmcm\n\nConstify `Location` methods\n\nTracking issue: #102911\n\nExample: https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=4789884c2f16ec4fb0e0405d86b794f5", "tree": {"sha": "00ac9c51e829917bb138972293a76ed8906fa4b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00ac9c51e829917bb138972293a76ed8906fa4b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "html_url": "https://github.com/rust-lang/rust/commit/bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5819f419a7b9fcda92b74ab2c48010a778eaec40", "url": "https://api.github.com/repos/rust-lang/rust/commits/5819f419a7b9fcda92b74ab2c48010a778eaec40", "html_url": "https://github.com/rust-lang/rust/commit/5819f419a7b9fcda92b74ab2c48010a778eaec40"}, {"sha": "a53e3acca914a1f6897c451ba35636ee1f72c0e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/a53e3acca914a1f6897c451ba35636ee1f72c0e7", "html_url": "https://github.com/rust-lang/rust/commit/a53e3acca914a1f6897c451ba35636ee1f72c0e7"}], "stats": {"total": 44, "additions": 41, "deletions": 3}, "files": [{"sha": "6dcf23dde87c75701af08d7c69994931b2590de6", "filename": "library/core/src/panic/location.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Fsrc%2Fpanic%2Flocation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Fsrc%2Fpanic%2Flocation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fpanic%2Flocation.rs?ref=bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "patch": "@@ -123,8 +123,9 @@ impl<'a> Location<'a> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"panic_hooks\", since = \"1.10.0\")]\n+    #[rustc_const_unstable(feature = \"const_location_fields\", issue = \"102911\")]\n     #[inline]\n-    pub fn file(&self) -> &str {\n+    pub const fn file(&self) -> &str {\n         self.file\n     }\n \n@@ -147,8 +148,9 @@ impl<'a> Location<'a> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"panic_hooks\", since = \"1.10.0\")]\n+    #[rustc_const_unstable(feature = \"const_location_fields\", issue = \"102911\")]\n     #[inline]\n-    pub fn line(&self) -> u32 {\n+    pub const fn line(&self) -> u32 {\n         self.line\n     }\n \n@@ -171,8 +173,9 @@ impl<'a> Location<'a> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"panic_col\", since = \"1.25.0\")]\n+    #[rustc_const_unstable(feature = \"const_location_fields\", issue = \"102911\")]\n     #[inline]\n-    pub fn column(&self) -> u32 {\n+    pub const fn column(&self) -> u32 {\n         self.col\n     }\n }"}, {"sha": "a698e6e99e10c1657117d94db02200ddd65be872", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "patch": "@@ -7,6 +7,7 @@\n #![feature(const_assume)]\n #![feature(const_black_box)]\n #![feature(const_bool_to_option)]\n+#![feature(const_caller_location)]\n #![feature(const_cell_into_inner)]\n #![feature(const_convert)]\n #![feature(const_heap)]\n@@ -20,6 +21,7 @@\n #![feature(const_ptr_write)]\n #![feature(const_trait_impl)]\n #![feature(const_likely)]\n+#![feature(const_location_fields)]\n #![feature(core_intrinsics)]\n #![feature(core_private_bignum)]\n #![feature(core_private_diy_float)]\n@@ -131,6 +133,7 @@ mod nonzero;\n mod num;\n mod ops;\n mod option;\n+mod panic;\n mod pattern;\n mod pin;\n mod pin_macro;"}, {"sha": "24b6c56b3569198adb43ef0b3c4bee23ce18f25e", "filename": "library/core/tests/panic.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Fpanic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Fpanic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fpanic.rs?ref=bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "patch": "@@ -0,0 +1 @@\n+mod location;"}, {"sha": "d20241d8380013800a07fbeddc49bfac01e8e65e", "filename": "library/core/tests/panic/location.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Fpanic%2Flocation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf15a9e5263fcea065a7ae9c179b2d24c2deb670/library%2Fcore%2Ftests%2Fpanic%2Flocation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fpanic%2Flocation.rs?ref=bf15a9e5263fcea065a7ae9c179b2d24c2deb670", "patch": "@@ -0,0 +1,31 @@\n+use core::panic::Location;\n+\n+// Note: Some of the following tests depend on the source location,\n+// so please be careful when editing this file.\n+\n+#[test]\n+fn location_const_caller() {\n+    const _CALLER_REFERENCE: &Location<'static> = Location::caller();\n+    const _CALLER: Location<'static> = *Location::caller();\n+}\n+\n+#[test]\n+fn location_const_file() {\n+    const CALLER: &Location<'static> = Location::caller();\n+    const FILE: &str = CALLER.file();\n+    assert_eq!(FILE, file!());\n+}\n+\n+#[test]\n+fn location_const_line() {\n+    const CALLER: &Location<'static> = Location::caller();\n+    const LINE: u32 = CALLER.line();\n+    assert_eq!(LINE, 21);\n+}\n+\n+#[test]\n+fn location_const_column() {\n+    const CALLER: &Location<'static> = Location::caller();\n+    const COLUMN: u32 = CALLER.column();\n+    assert_eq!(COLUMN, 40);\n+}"}]}