{"sha": "1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjZWI4MWIzNDU1MmMwZmY0NjZmNGZmYWEwMGZlMmY4N2NiNWUxNmM=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-06-03T04:20:13Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-06-06T05:36:53Z"}, "message": "Use in-core implementation of `type_name`.\n\nWe bump `rust-version` to pick up the new impl from\nhttps://github.com/rust-lang/rust/pull/61498 and add a test.", "tree": {"sha": "26e8403be31eb0db7fc2c6c9a70554a49c5ba21f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26e8403be31eb0db7fc2c6c9a70554a49c5ba21f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "html_url": "https://github.com/rust-lang/rust/commit/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1730d136a73b97ac7e1aa87ad61f0ba740cdb7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1730d136a73b97ac7e1aa87ad61f0ba740cdb7f", "html_url": "https://github.com/rust-lang/rust/commit/f1730d136a73b97ac7e1aa87ad61f0ba740cdb7f"}], "stats": {"total": 17, "additions": 7, "deletions": 10}, "files": [{"sha": "b2c0aca42bdf589970aa71fe3a69f27a9cd94240", "filename": "rust-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/rust-version", "raw_url": "https://github.com/rust-lang/rust/raw/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/rust-version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-version?ref=1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "patch": "@@ -1 +1 @@\n-021a5033098ff0e3f7126acc7ac35149d325f16d\n+7cdaffd7962c4aae0cadd82baa241901b03f9458"}, {"sha": "8d564456f4edfd6bb5d940b43b659b87512afcbc", "filename": "src/intrinsic.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/src%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/src%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fintrinsic.rs?ref=1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "patch": "@@ -5,7 +5,7 @@ use rustc::ty;\n \n use crate::{\n     PlaceTy, OpTy, ImmTy, Immediate, Scalar, ScalarMaybeUndef, Tag,\n-    OperatorEvalContextExt, MiriMemoryKind,\n+    OperatorEvalContextExt\n };\n \n impl<'a, 'mir, 'tcx> EvalContextExt<'a, 'mir, 'tcx> for crate::MiriEvalContext<'a, 'mir, 'tcx> {}\n@@ -398,14 +398,6 @@ pub trait EvalContextExt<'a, 'mir, 'tcx: 'a+'mir>: crate::MiriEvalContextExt<'a,\n                 )?;\n             }\n \n-            \"type_name\" => {\n-                let ty = substs.type_at(0);\n-                let ty_name = ty.to_string();\n-                let ptr = this.memory_mut().allocate_static_bytes(ty_name.as_bytes(), MiriMemoryKind::Static.into());\n-                let value = Immediate::new_slice(Scalar::Ptr(ptr), ty_name.len() as u64, this);\n-                this.write_immediate(value, dest)?;\n-            }\n-\n             \"unchecked_div\" => {\n                 let l = this.read_immediate(args[0])?;\n                 let r = this.read_immediate(args[1])?;"}, {"sha": "963265749d13697d5ecc9249430a85f80d9d1efd", "filename": "tests/run-pass/intrinsics.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/tests%2Frun-pass%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c/tests%2Frun-pass%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fintrinsics.rs?ref=1ceb81b34552c0ff466f4ffaa00fe2f87cb5e16c", "patch": "@@ -1,3 +1,6 @@\n+#![feature(core_intrinsics)]\n+\n+use std::intrinsics::type_name;\n use std::mem::{size_of, size_of_val};\n \n fn main() {\n@@ -7,4 +10,6 @@ fn main() {\n     assert_eq!(size_of_val(&[] as &[i32]), 0);\n     assert_eq!(size_of_val(&[1, 2, 3] as &[i32]), 12);\n     assert_eq!(size_of_val(\"foobar\"), 6);\n+\n+    assert_eq!(unsafe { type_name::<Option<i32>>() }, \"core::option::Option<i32>\");\n }"}]}