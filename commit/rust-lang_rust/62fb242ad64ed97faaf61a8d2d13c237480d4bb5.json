{"sha": "62fb242ad64ed97faaf61a8d2d13c237480d4bb5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyZmIyNDJhZDY0ZWQ5N2ZhYWY2MWE4ZDJkMTNjMjM3NDgwZDRiYjU=", "commit": {"author": {"name": "Tim Neumann", "email": "mail@timnn.me", "date": "2016-09-30T09:15:37Z"}, "committer": {"name": "Tim Neumann", "email": "mail@timnn.me", "date": "2016-09-30T16:04:41Z"}, "message": "fix out-of-tree rustbuild", "tree": {"sha": "f1177a27df97d320f6dcf9f01088a9e95be50550", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1177a27df97d320f6dcf9f01088a9e95be50550"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/62fb242ad64ed97faaf61a8d2d13c237480d4bb5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/62fb242ad64ed97faaf61a8d2d13c237480d4bb5", "html_url": "https://github.com/rust-lang/rust/commit/62fb242ad64ed97faaf61a8d2d13c237480d4bb5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/62fb242ad64ed97faaf61a8d2d13c237480d4bb5/comments", "author": {"login": "TimNN", "id": 1178249, "node_id": "MDQ6VXNlcjExNzgyNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimNN", "html_url": "https://github.com/TimNN", "followers_url": "https://api.github.com/users/TimNN/followers", "following_url": "https://api.github.com/users/TimNN/following{/other_user}", "gists_url": "https://api.github.com/users/TimNN/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimNN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimNN/subscriptions", "organizations_url": "https://api.github.com/users/TimNN/orgs", "repos_url": "https://api.github.com/users/TimNN/repos", "events_url": "https://api.github.com/users/TimNN/events{/privacy}", "received_events_url": "https://api.github.com/users/TimNN/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TimNN", "id": 1178249, "node_id": "MDQ6VXNlcjExNzgyNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimNN", "html_url": "https://github.com/TimNN", "followers_url": "https://api.github.com/users/TimNN/followers", "following_url": "https://api.github.com/users/TimNN/following{/other_user}", "gists_url": "https://api.github.com/users/TimNN/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimNN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimNN/subscriptions", "organizations_url": "https://api.github.com/users/TimNN/orgs", "repos_url": "https://api.github.com/users/TimNN/repos", "events_url": "https://api.github.com/users/TimNN/events{/privacy}", "received_events_url": "https://api.github.com/users/TimNN/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7660bdf70ae0c6a434dd12cfdeb8250ce77c69c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/7660bdf70ae0c6a434dd12cfdeb8250ce77c69c7", "html_url": "https://github.com/rust-lang/rust/commit/7660bdf70ae0c6a434dd12cfdeb8250ce77c69c7"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "0ca6e3fefaa2655321609906232e9fae7b4cc863", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/62fb242ad64ed97faaf61a8d2d13c237480d4bb5/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62fb242ad64ed97faaf61a8d2d13c237480d4bb5/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=62fb242ad64ed97faaf61a8d2d13c237480d4bb5", "patch": "@@ -557,17 +557,22 @@ impl Build {\n                 continue\n             }\n \n-            if !submodule.path.exists() {\n-                t!(fs::create_dir_all(&submodule.path));\n-            }\n+            // `submodule.path` is the relative path to a submodule (from the repository root)\n+            // `submodule_path` is the path to a submodule from the cwd\n+\n+            // use `submodule.path` when e.g. executing a submodule specific command from the\n+            // repository root\n+            // use `submodule_path` when e.g. executing a normal git command for the submodule\n+            // (set via `current_dir`)\n+            let submodule_path = self.src.join(submodule.path);\n \n             match submodule.state {\n                 State::MaybeDirty => {\n                     // drop staged changes\n-                    self.run(git().current_dir(submodule.path)\n+                    self.run(git().current_dir(&submodule_path)\n                                   .args(&[\"reset\", \"--hard\"]));\n                     // drops unstaged changes\n-                    self.run(git().current_dir(submodule.path)\n+                    self.run(git().current_dir(&submodule_path)\n                                   .args(&[\"clean\", \"-fdx\"]));\n                 },\n                 State::NotInitialized => {\n@@ -577,9 +582,9 @@ impl Build {\n                 State::OutOfSync => {\n                     // drops submodule commits that weren't reported to the (outer) git repository\n                     self.run(git_submodule().arg(\"update\").arg(submodule.path));\n-                    self.run(git().current_dir(submodule.path)\n+                    self.run(git().current_dir(&submodule_path)\n                                   .args(&[\"reset\", \"--hard\"]));\n-                    self.run(git().current_dir(submodule.path)\n+                    self.run(git().current_dir(&submodule_path)\n                                   .args(&[\"clean\", \"-fdx\"]));\n                 },\n             }"}]}