{"sha": "184da128965d8c833c02feb3f16097e3a1a64417", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4NGRhMTI4OTY1ZDhjODMzYzAyZmViM2YxNjA5N2UzYTFhNjQ0MTc=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-08-06T21:51:53Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-08-07T18:47:12Z"}, "message": "Nifty macros for receiving from a protocol.", "tree": {"sha": "62a936231f39258926e0a426242577b8f4d3d8ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/62a936231f39258926e0a426242577b8f4d3d8ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/184da128965d8c833c02feb3f16097e3a1a64417", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/184da128965d8c833c02feb3f16097e3a1a64417", "html_url": "https://github.com/rust-lang/rust/commit/184da128965d8c833c02feb3f16097e3a1a64417", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/184da128965d8c833c02feb3f16097e3a1a64417/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d594f3701a5c50e00bb496288477010e31c38a69", "url": "https://api.github.com/repos/rust-lang/rust/commits/d594f3701a5c50e00bb496288477010e31c38a69", "html_url": "https://github.com/rust-lang/rust/commit/d594f3701a5c50e00bb496288477010e31c38a69"}], "stats": {"total": 56, "additions": 14, "deletions": 42}, "files": [{"sha": "65ea01f9115101098a1ff0b9d78779975aac7478", "filename": "src/test/run-pass/pipe-bank-proto.rs", "status": "modified", "additions": 14, "deletions": 42, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/184da128965d8c833c02feb3f16097e3a1a64417/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/184da128965d8c833c02feb3f16097e3a1a64417/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fpipe-bank-proto.rs?ref=184da128965d8c833c02feb3f16097e3a1a64417", "patch": "@@ -45,65 +45,37 @@ fn move_it<T>(-x: T) -> T { x }\n \n macro_rules! follow {\n     { \n-        $($message:path($($x: ident),+) => $next:ident $e:expr)+\n+        $($message:path$(($($x: ident),+))||* -> $next:ident $e:expr)+\n     } => (\n-        |m| match move_it(m) {\n-          $(some($message($($x,)* next)) {\n+        |m| match move m {\n+          $(some($message($($($x,)+)* next)) => {\n             let $next = move_it!{next};\n             $e })+\n-          _ { fail }\n+          _ => { fail }\n         }\n     );\n-\n-    { \n-        $($message:path => $next:ident $e:expr)+\n-    } => (\n-        |m| match move_it(m) {\n-            $(some($message(next)) {\n-                let $next = move_it!{next};\n-                $e })+\n-                _ { fail }\n-        } \n-    )\n }\n \n-/*\n fn client_follow(+bank: bank::client::login) {\n     import bank::*;\n \n     let bank = client::login(bank, ~\"theincredibleholk\", ~\"1234\");\n     let bank = switch(bank, follow! {\n-        ok => connected { connected }\n-        invalid => _next { fail ~\"bank closed the connected\" }\n+        ok -> connected { connected }\n+        invalid -> _next { fail ~\"bank closed the connected\" }\n     });\n \n-    /* // potential alternate syntax\n-    let bank = recv_alt! {\n-        bank => {\n-            | ok -> connected { connected }\n-            | invalid -> _next { fail }\n-        }\n-        bank2 => {\n-            | foo -> _n { fail }\n-        }\n-    }\n-    */\n-\n     let bank = client::deposit(bank, 100.00);\n     let bank = client::withdrawal(bank, 50.00);\n-    match try_recv(bank) {\n-      some(money(m, _)) {\n-        io::println(~\"Yay! I got money!\");\n-      }\n-      some(insufficient_funds(_)) {\n-        fail ~\"someone stole my money\"\n-      }\n-      none {\n-        fail ~\"bank closed the connection\"\n-      }\n-    }    \n+    switch(bank, follow! {\n+        money(m) -> _next {\n+            io::println(~\"Yay! I got money!\");\n+        }\n+        insufficient_funds -> _next {\n+            fail ~\"someone stole my money\"\n+        }\n+    });\n }\n-*/\n \n fn bank_client(+bank: bank::client::login) {\n     import bank::*;"}]}