{"sha": "fe78bd49207ec302cdb1898cdb56bc4194aa24fb", "node_id": "C_kwDOAAsO6NoAKGZlNzhiZDQ5MjA3ZWMzMDJjZGIxODk4Y2RiNTZiYzQxOTRhYTI0ZmI", "commit": {"author": {"name": "est31", "email": "MTest31@outlook.com", "date": "2022-03-02T21:10:35Z"}, "committer": {"name": "est31", "email": "MTest31@outlook.com", "date": "2022-03-02T21:10:35Z"}, "message": "Use ? operator in one instance instead of manual match", "tree": {"sha": "c283ee3a3c6df9cd249a2320af9abfe02aa76f3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c283ee3a3c6df9cd249a2320af9abfe02aa76f3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe78bd49207ec302cdb1898cdb56bc4194aa24fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe78bd49207ec302cdb1898cdb56bc4194aa24fb", "html_url": "https://github.com/rust-lang/rust/commit/fe78bd49207ec302cdb1898cdb56bc4194aa24fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe78bd49207ec302cdb1898cdb56bc4194aa24fb/comments", "author": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "committer": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08504c64aa7c4163a51c1982ed10075bb89cec0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/08504c64aa7c4163a51c1982ed10075bb89cec0e", "html_url": "https://github.com/rust-lang/rust/commit/08504c64aa7c4163a51c1982ed10075bb89cec0e"}], "stats": {"total": 99, "additions": 48, "deletions": 51}, "files": [{"sha": "63a8e85f7c54044413df3e4c6551f6697fe6b059", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 48, "deletions": 51, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/fe78bd49207ec302cdb1898cdb56bc4194aa24fb/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe78bd49207ec302cdb1898cdb56bc4194aa24fb/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=fe78bd49207ec302cdb1898cdb56bc4194aa24fb", "patch": "@@ -111,58 +111,55 @@ crate fn run(options: RustdocOptions) -> Result<(), ErrorGuaranteed> {\n     let externs = options.externs.clone();\n     let json_unused_externs = options.json_unused_externs;\n \n-    let res = interface::run_compiler(config, |compiler| {\n-        compiler.enter(|queries| {\n-            let mut global_ctxt = queries.global_ctxt()?.take();\n-\n-            let collector = global_ctxt.enter(|tcx| {\n-                let crate_attrs = tcx.hir().attrs(CRATE_HIR_ID);\n-\n-                let opts = scrape_test_config(crate_attrs);\n-                let enable_per_target_ignores = options.enable_per_target_ignores;\n-                let mut collector = Collector::new(\n-                    tcx.crate_name(LOCAL_CRATE),\n-                    options,\n-                    false,\n-                    opts,\n-                    Some(compiler.session().parse_sess.clone_source_map()),\n-                    None,\n-                    enable_per_target_ignores,\n-                );\n-\n-                let mut hir_collector = HirCollector {\n-                    sess: compiler.session(),\n-                    collector: &mut collector,\n-                    map: tcx.hir(),\n-                    codes: ErrorCodes::from(\n-                        compiler.session().opts.unstable_features.is_nightly_build(),\n-                    ),\n-                    tcx,\n-                };\n-                hir_collector.visit_testable(\n-                    \"\".to_string(),\n-                    CRATE_HIR_ID,\n-                    tcx.hir().span(CRATE_HIR_ID),\n-                    |this| tcx.hir().walk_toplevel_module(this),\n-                );\n-\n-                collector\n-            });\n-            if compiler.session().diagnostic().has_errors_or_lint_errors() {\n-                FatalError.raise();\n-            }\n+    let (tests, unused_extern_reports, compiling_test_count) =\n+        interface::run_compiler(config, |compiler| {\n+            compiler.enter(|queries| {\n+                let mut global_ctxt = queries.global_ctxt()?.take();\n+\n+                let collector = global_ctxt.enter(|tcx| {\n+                    let crate_attrs = tcx.hir().attrs(CRATE_HIR_ID);\n+\n+                    let opts = scrape_test_config(crate_attrs);\n+                    let enable_per_target_ignores = options.enable_per_target_ignores;\n+                    let mut collector = Collector::new(\n+                        tcx.crate_name(LOCAL_CRATE),\n+                        options,\n+                        false,\n+                        opts,\n+                        Some(compiler.session().parse_sess.clone_source_map()),\n+                        None,\n+                        enable_per_target_ignores,\n+                    );\n+\n+                    let mut hir_collector = HirCollector {\n+                        sess: compiler.session(),\n+                        collector: &mut collector,\n+                        map: tcx.hir(),\n+                        codes: ErrorCodes::from(\n+                            compiler.session().opts.unstable_features.is_nightly_build(),\n+                        ),\n+                        tcx,\n+                    };\n+                    hir_collector.visit_testable(\n+                        \"\".to_string(),\n+                        CRATE_HIR_ID,\n+                        tcx.hir().span(CRATE_HIR_ID),\n+                        |this| tcx.hir().walk_toplevel_module(this),\n+                    );\n+\n+                    collector\n+                });\n+                if compiler.session().diagnostic().has_errors_or_lint_errors() {\n+                    FatalError.raise();\n+                }\n \n-            let unused_extern_reports = collector.unused_extern_reports.clone();\n-            let compiling_test_count = collector.compiling_test_count.load(Ordering::SeqCst);\n-            let ret: Result<_, ErrorGuaranteed> =\n-                Ok((collector.tests, unused_extern_reports, compiling_test_count));\n-            ret\n-        })\n-    });\n-    let (tests, unused_extern_reports, compiling_test_count) = match res {\n-        Ok(res) => res,\n-        Err(ErrorGuaranteed) => return Err(ErrorGuaranteed),\n-    };\n+                let unused_extern_reports = collector.unused_extern_reports.clone();\n+                let compiling_test_count = collector.compiling_test_count.load(Ordering::SeqCst);\n+                let ret: Result<_, ErrorGuaranteed> =\n+                    Ok((collector.tests, unused_extern_reports, compiling_test_count));\n+                ret\n+            })\n+        })?;\n \n     run_tests(test_args, nocapture, tests);\n "}]}