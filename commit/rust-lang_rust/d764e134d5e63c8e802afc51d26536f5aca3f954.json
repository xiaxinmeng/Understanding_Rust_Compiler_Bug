{"sha": "d764e134d5e63c8e802afc51d26536f5aca3f954", "node_id": "C_kwDOAAsO6NoAKGQ3NjRlMTM0ZDVlNjNjOGU4MDJhZmM1MWQyNjUzNmY1YWNhM2Y5NTQ", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-04-14T13:51:38Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-04-14T13:51:38Z"}, "message": "Fallback to primitive when path doesn't resolve", "tree": {"sha": "c2275713b476151cbb2aaaee13c7c198d5c96302", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2275713b476151cbb2aaaee13c7c198d5c96302"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d764e134d5e63c8e802afc51d26536f5aca3f954", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d764e134d5e63c8e802afc51d26536f5aca3f954", "html_url": "https://github.com/rust-lang/rust/commit/d764e134d5e63c8e802afc51d26536f5aca3f954", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d764e134d5e63c8e802afc51d26536f5aca3f954/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63573d47aaf841abb803af26dadc95e86f1fe572", "url": "https://api.github.com/repos/rust-lang/rust/commits/63573d47aaf841abb803af26dadc95e86f1fe572", "html_url": "https://github.com/rust-lang/rust/commit/63573d47aaf841abb803af26dadc95e86f1fe572"}], "stats": {"total": 39, "additions": 39, "deletions": 0}, "files": [{"sha": "25a408036ff7d70f0968e6e420d71bf1ac096cab", "filename": "crates/hir_def/src/builtin_type.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_def%2Fsrc%2Fbuiltin_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_def%2Fsrc%2Fbuiltin_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fbuiltin_type.rs?ref=d764e134d5e63c8e802afc51d26536f5aca3f954", "patch": "@@ -68,6 +68,10 @@ impl BuiltinType {\n         (name![f32], BuiltinType::Float(BuiltinFloat::F32)),\n         (name![f64], BuiltinType::Float(BuiltinFloat::F64)),\n     ];\n+\n+    pub fn by_name(name: &Name) -> Option<Self> {\n+        Self::ALL.iter().find_map(|(n, ty)| if n == name { Some(*ty) } else { None })\n+    }\n }\n \n impl AsName for BuiltinType {"}, {"sha": "2a990765eaa046eebae0980f29ef24cdbad556aa", "filename": "crates/hir_def/src/resolver.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_def%2Fsrc%2Fresolver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_def%2Fsrc%2Fresolver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fresolver.rs?ref=d764e134d5e63c8e802afc51d26536f5aca3f954", "patch": "@@ -317,6 +317,18 @@ impl Resolver {\n             }\n         }\n \n+        // If a path of the shape `u16::from_le_bytes` failed to resolve at all, then we fall back\n+        // to resolving to the primitive type, to allow this to still work in the presence of\n+        // `use core::u16;`.\n+        if path.kind == PathKind::Plain && path.segments().len() > 1 {\n+            match BuiltinType::by_name(&path.segments()[0]) {\n+                Some(builtin) => {\n+                    return Some(ResolveValueResult::Partial(TypeNs::BuiltinType(builtin), 1));\n+                }\n+                None => {}\n+            }\n+        }\n+\n         None\n     }\n "}, {"sha": "68463dc068bcf3d870ab787e380b27f337daa543", "filename": "crates/hir_ty/src/tests/method_resolution.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d764e134d5e63c8e802afc51d26536f5aca3f954/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs?ref=d764e134d5e63c8e802afc51d26536f5aca3f954", "patch": "@@ -1767,3 +1767,26 @@ fn foo() {\n \"#,\n     );\n }\n+\n+#[test]\n+fn primitive_assoc_fn_shadowed_by_use() {\n+    check_types(\n+        r#\"\n+//- /lib.rs crate:lib deps:core\n+use core::u16;\n+\n+fn f() -> u16 {\n+    let x = u16::from_le_bytes();\n+      x\n+    //^ u16\n+}\n+\n+//- /core.rs crate:core\n+pub mod u16 {}\n+\n+impl u16 {\n+    pub fn from_le_bytes() -> Self { 0 }\n+}\n+        \"#,\n+    )\n+}"}]}