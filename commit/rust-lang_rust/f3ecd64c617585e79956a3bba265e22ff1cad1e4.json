{"sha": "f3ecd64c617585e79956a3bba265e22ff1cad1e4", "node_id": "C_kwDOAAsO6NoAKGYzZWNkNjRjNjE3NTg1ZTc5OTU2YTNiYmEyNjVlMjJmZjFjYWQxZTQ", "commit": {"author": {"name": "b-naber", "email": "bn263@gmx.de", "date": "2021-12-13T21:24:08Z"}, "committer": {"name": "b-naber", "email": "bn263@gmx.de", "date": "2021-12-13T22:13:24Z"}, "message": "use try_normalize_erasing_regions in RevealAllVisitor", "tree": {"sha": "2e02b3f8353a0b8552b970eb1483f8090568578a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e02b3f8353a0b8552b970eb1483f8090568578a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3ecd64c617585e79956a3bba265e22ff1cad1e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3ecd64c617585e79956a3bba265e22ff1cad1e4", "html_url": "https://github.com/rust-lang/rust/commit/f3ecd64c617585e79956a3bba265e22ff1cad1e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3ecd64c617585e79956a3bba265e22ff1cad1e4/comments", "author": {"login": "b-naber", "id": 71934879, "node_id": "MDQ6VXNlcjcxOTM0ODc5", "avatar_url": "https://avatars.githubusercontent.com/u/71934879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/b-naber", "html_url": "https://github.com/b-naber", "followers_url": "https://api.github.com/users/b-naber/followers", "following_url": "https://api.github.com/users/b-naber/following{/other_user}", "gists_url": "https://api.github.com/users/b-naber/gists{/gist_id}", "starred_url": "https://api.github.com/users/b-naber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/b-naber/subscriptions", "organizations_url": "https://api.github.com/users/b-naber/orgs", "repos_url": "https://api.github.com/users/b-naber/repos", "events_url": "https://api.github.com/users/b-naber/events{/privacy}", "received_events_url": "https://api.github.com/users/b-naber/received_events", "type": "User", "site_admin": false}, "committer": {"login": "b-naber", "id": 71934879, "node_id": "MDQ6VXNlcjcxOTM0ODc5", "avatar_url": "https://avatars.githubusercontent.com/u/71934879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/b-naber", "html_url": "https://github.com/b-naber", "followers_url": "https://api.github.com/users/b-naber/followers", "following_url": "https://api.github.com/users/b-naber/following{/other_user}", "gists_url": "https://api.github.com/users/b-naber/gists{/gist_id}", "starred_url": "https://api.github.com/users/b-naber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/b-naber/subscriptions", "organizations_url": "https://api.github.com/users/b-naber/orgs", "repos_url": "https://api.github.com/users/b-naber/repos", "events_url": "https://api.github.com/users/b-naber/events{/privacy}", "received_events_url": "https://api.github.com/users/b-naber/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0a4c7d1e48c39a73119eb9107d402d60c83293b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0a4c7d1e48c39a73119eb9107d402d60c83293b", "html_url": "https://github.com/rust-lang/rust/commit/a0a4c7d1e48c39a73119eb9107d402d60c83293b"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "ee661793a44aae74cc7f042cd140f94ad32d1db2", "filename": "compiler/rustc_mir_transform/src/reveal_all.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f3ecd64c617585e79956a3bba265e22ff1cad1e4/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3ecd64c617585e79956a3bba265e22ff1cad1e4/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs?ref=f3ecd64c617585e79956a3bba265e22ff1cad1e4", "patch": "@@ -36,6 +36,9 @@ impl<'tcx> MutVisitor<'tcx> for RevealAllVisitor<'tcx> {\n \n     #[inline]\n     fn visit_ty(&mut self, ty: &mut Ty<'tcx>, _: TyContext) {\n-        *ty = self.tcx.normalize_erasing_regions(self.param_env, ty);\n+        // We have to use `try_normalize_erasing_regions` here, since it's\n+        // possible that we visit impossible-to-satisfy where clauses here,\n+        // see #91745\n+        *ty = self.tcx.try_normalize_erasing_regions(self.param_env, *ty).unwrap_or(ty);\n     }\n }"}, {"sha": "ca3d66b1c8eb7d9cb96551589f5a97b26da50e31", "filename": "src/test/ui/mir/issue-91745.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f3ecd64c617585e79956a3bba265e22ff1cad1e4/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3ecd64c617585e79956a3bba265e22ff1cad1e4/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs?ref=f3ecd64c617585e79956a3bba265e22ff1cad1e4", "patch": "@@ -0,0 +1,21 @@\n+// check-pass\n+\n+pub trait Foo {\n+    type Bar;\n+}\n+\n+pub trait Broken {\n+    type Assoc;\n+    fn broken(&self) where Self::Assoc: Foo;\n+}\n+\n+impl<T> Broken for T {\n+    type Assoc = ();\n+    fn broken(&self) where Self::Assoc: Foo {\n+        let _x: <Self::Assoc as Foo>::Bar;\n+    }\n+}\n+\n+fn main() {\n+    let _m: &dyn Broken<Assoc=()> = &();\n+}"}]}