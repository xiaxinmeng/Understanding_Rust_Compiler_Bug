{"sha": "83b4222d9a7b8f47e940cefad93d4ae535649210", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzYjQyMjJkOWE3YjhmNDdlOTQwY2VmYWQ5M2Q0YWU1MzU2NDkyMTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-28T13:02:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-28T13:02:41Z"}, "message": "Auto merge of #1422 - RalfJung:cargo-miri-workspace, r=oli-obk\n\nMove cargo-miri into separate package\n\nSo far, `cargo-miri` depended on the Miri library crate. That was mostly for convenience (to avoid having to deal with workspaces), but also because until recently `cargo-miri` needed access to the [\"Miri default flags\"](https://github.com/rust-lang/miri/blob/af044209b02f561adb3dad9f5f0deea7378f0ac0/src/lib.rs#L75). But with `MIRI_BE_RUSTC` that is no longer the case, so we can remove this fake dependency. :)\n\n@oli-obk what do you think? Also I expect the rustc bootstrap integration will need updates, hints would be appreciated. :D", "tree": {"sha": "036d5a9a65d95b6df4f6d7d4496f388a2655c4f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/036d5a9a65d95b6df4f6d7d4496f388a2655c4f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/83b4222d9a7b8f47e940cefad93d4ae535649210", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/83b4222d9a7b8f47e940cefad93d4ae535649210", "html_url": "https://github.com/rust-lang/rust/commit/83b4222d9a7b8f47e940cefad93d4ae535649210", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/83b4222d9a7b8f47e940cefad93d4ae535649210/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7f266577e9707d7a05a20a221695e1870a25d1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7f266577e9707d7a05a20a221695e1870a25d1d", "html_url": "https://github.com/rust-lang/rust/commit/c7f266577e9707d7a05a20a221695e1870a25d1d"}, {"sha": "ac454a248524b8b273b17337e3d59a45772f357f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac454a248524b8b273b17337e3d59a45772f357f", "html_url": "https://github.com/rust-lang/rust/commit/ac454a248524b8b273b17337e3d59a45772f357f"}], "stats": {"total": 547, "additions": 423, "deletions": 124}, "files": [{"sha": "f68a6133be57ebdc97cf349c7aec0dbd7c164f04", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 86, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -43,11 +43,6 @@ name = \"base64\"\n version = \"0.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"bitflags\"\n-version = \"1.2.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-\n [[package]]\n name = \"blake2b_simd\"\n version = \"0.5.10\"\n@@ -63,32 +58,11 @@ name = \"byteorder\"\n version = \"1.3.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"cargo_metadata\"\n-version = \"0.9.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.106 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive 1.0.106 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"cfg-if\"\n version = \"0.1.10\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"chrono\"\n-version = \"0.4.11\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"num-integer 0.1.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"time 0.1.42 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"colored\"\n version = \"1.9.3\"\n@@ -140,15 +114,6 @@ name = \"diff\"\n version = \"0.1.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"directories\"\n-version = \"2.0.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"dirs-sys 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"dirs\"\n version = \"2.0.2\"\n@@ -273,39 +238,17 @@ name = \"miri\"\n version = \"0.1.0\"\n dependencies = [\n  \"byteorder 1.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"cargo_metadata 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"colored 1.9.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"compiletest_rs 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"directories 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getrandom 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"hex 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rand 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-workspace-hack 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.106 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"shell-escape 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"vergen 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n-[[package]]\n-name = \"num-integer\"\n-version = \"0.1.42\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"autocfg 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n-[[package]]\n-name = \"num-traits\"\n-version = \"0.2.11\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"autocfg 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -456,7 +399,6 @@ version = \"0.9.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"semver-parser 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.106 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -566,16 +508,6 @@ dependencies = [\n  \"lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n-[[package]]\n-name = \"time\"\n-version = \"0.1.42\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"redox_syscall 0.1.56 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"winapi 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"unicode-width\"\n version = \"0.1.7\"\n@@ -586,15 +518,6 @@ name = \"unicode-xid\"\n version = \"0.2.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n-[[package]]\n-name = \"vergen\"\n-version = \"3.1.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"bitflags 1.2.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"chrono 0.4.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"wasi\"\n version = \"0.9.0+wasi-snapshot-preview1\"\n@@ -635,18 +558,14 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum atty 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d9b39be18770d11421cdb1b9947a45dd3f37e93092cbf377614828a319d5fee8\"\n \"checksum autocfg 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f8aac770f1885fd7e387acedd76065302551364496e46b3dd00860b2f8359b9d\"\n \"checksum base64 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b41b7ea54a0c9d92199de89e20e58d49f02f8e699814ef3fdf266f6f748d15c7\"\n-\"checksum bitflags 1.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cf1de2fe8c75bc145a2f577add951f8134889b4795d47466a54a5c846d691693\"\n \"checksum blake2b_simd 0.5.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d8fb2d74254a3a0b5cac33ac9f8ed0e44aa50378d9dbb2e5d83bd21ed1dc2c8a\"\n \"checksum byteorder 1.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"08c48aae112d48ed9f069b33538ea9e3e90aa263cfa3d1c24309612b1f7472de\"\n-\"checksum cargo_metadata 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"46e3374c604fb39d1a2f35ed5e4a4e30e60d01fab49446e08f1b3e9a90aef202\"\n \"checksum cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4785bdd1c96b2a846b2bd7cc02e86b6b3dbf14e7e53446c4f54c92a361040822\"\n-\"checksum chrono 0.4.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"80094f509cf8b5ae86a4966a39b3ff66cd7e2a3e594accec3743ff3fabeab5b2\"\n \"checksum colored 1.9.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f4ffc801dacf156c5854b9df4f425a626539c3a6ef7893cc0c5084a23f0b6c59\"\n \"checksum compiletest_rs 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9f737835bfbbe29ed1ff82d5137520338d7ed5bf1a1d4b9c1c7c58bb45b8fa29\"\n \"checksum constant_time_eq 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"245097e9a4535ee1e3e3931fcfcd55a796a44c643e8596ff6566d68f09b87bbc\"\n \"checksum crossbeam-utils 0.7.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c3c7c73a2d1e9fc0886a08b93e98eb643461230d5f1925e4036204d5f2e261a8\"\n \"checksum diff 0.1.12 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0e25ea47919b1560c4e3b7fe0aaab9becf5b84a10325ddf7db0f0ba5e1026499\"\n-\"checksum directories 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"551a778172a450d7fc12e629ca3b0428d00f6afa9a43da1b630d54604e97371c\"\n \"checksum dirs 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"13aea89a5c93364a98e9b37b2fa237effbb694d5cfe01c5b70941f7eb087d5e3\"\n \"checksum dirs-sys 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"afa0b23de8fd801745c471deffa6e12d248f962c9fd4b4c33787b055599bde7b\"\n \"checksum env_logger 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"44533bbbb3bb3c1fa17d9f2e4e38bbbaf8396ba82193c4cb1b6445d711445d36\"\n@@ -662,8 +581,6 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum log 0.4.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"14b6052be84e6b71ab17edffc2eeabf5c2c3ae1fdb464aae35ac50c67a44e1f7\"\n \"checksum memchr 2.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3728d817d99e5ac407411fa471ff9800a778d88a24685968b36824eaf4bee400\"\n \"checksum miow 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"396aa0f2003d7df8395cb93e09871561ccc3e785f0acb369170e8cc74ddf9226\"\n-\"checksum num-integer 0.1.42 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3f6ea62e9d81a77cd3ee9a2a5b9b609447857f3d358704331e4ef39eb247fcba\"\n-\"checksum num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c62be47e61d1842b9170f0fdeec8eba98e60e90e5446449a0545e5152acd7096\"\n \"checksum ppv-lite86 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"74490b50b9fbe561ac330df47c08f3f33073d2d00c150f719147d7c54522fa1b\"\n \"checksum proc-macro2 1.0.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"df246d292ff63439fea9bc8c0a270bed0e390d5ebd4db4ba15aba81111b5abe3\"\n \"checksum quick-error 1.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a1d01941d82fa2ab50be1e79e6714289dd7cde78eba4c074bc5a4374f650dfe0\"\n@@ -695,10 +612,8 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum termcolor 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb6bfa289a4d7c5766392812c0a1f4c1ba45afa1ad47803c11e1f407d846d75f\"\n \"checksum tester 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ee72ec31009a42b53de9a6b7d8f462b493ab3b1e4767bda1fcdbb52127f13b6c\"\n \"checksum thread_local 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d40c6d1b69745a6ec6fb1ca717914848da4b44ae29d9b3080cbee91d72a69b14\"\n-\"checksum time 0.1.42 (registry+https://github.com/rust-lang/crates.io-index)\" = \"db8dcfca086c1143c9270ac42a2bbd8a7ee477b78ac8e45b19abfb0cbede4b6f\"\n \"checksum unicode-width 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"caaa9d531767d1ff2150b9332433f32a24622147e5ebb1f26409d5da67afd479\"\n \"checksum unicode-xid 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"826e7639553986605ec5979c7dd957c7895e93eabed50ab2ffa7f6128a75097c\"\n-\"checksum vergen 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4ce50d8996df1f85af15f2cd8d33daae6e479575123ef4314a51a70a230739cb\"\n \"checksum wasi 0.9.0+wasi-snapshot-preview1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cccddf32554fecc6acb585f82a32a72e28b48f8c4c1883ddfeeeaa96f7d8e519\"\n \"checksum winapi 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8093091eeb260906a183e6ae1abdba2ef5ef2257a21801128899c3fc699229c6\"\n \"checksum winapi-i686-pc-windows-gnu 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6\""}, {"sha": "c33008e48a790d86cf8ba55ab0559a14b42a0bf7", "filename": "Cargo.toml", "status": "modified", "additions": 7, "deletions": 22, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -1,6 +1,6 @@\n [package]\n-authors = [\"Scott Olson <scott@solson.me>\"]\n-description = \"An experimental interpreter for Rust MIR.\"\n+authors = [\"Miri Team\"]\n+description = \"An experimental interpreter for Rust MIR (core driver).\"\n license = \"MIT/Apache-2.0\"\n name = \"miri\"\n repository = \"https://github.com/rust-lang/miri\"\n@@ -17,24 +17,13 @@ name = \"miri\"\n test = false # we have no unit tests\n doctest = false # and no doc tests\n \n-[[bin]]\n-name = \"cargo-miri\"\n-test = false # we have no unit tests\n-doctest = false # and no doc tests\n-required-features = [\"cargo_miri\"]\n-\n [[bin]]\n name = \"miri-rustc-tests\"\n test = false # we have no unit tests\n doctest = false # and no doc tests\n required-features = [\"rustc_tests\"]\n \n [dependencies]\n-cargo_metadata = { version = \"0.9.0\", optional = true }\n-directories = { version = \"2.0\", optional = true }\n-rustc_version = { version = \"0.2.3\", optional = true }\n-serde_json = { version = \"1.0.40\", optional = true }\n-\n getrandom = { version = \"0.1.8\", features = [\"std\"] }\n byteorder = \"1.3\"\n env_logger = \"0.7.1\"\n@@ -48,19 +37,15 @@ rand = \"0.7\"\n # for more information.\n rustc-workspace-hack = \"1.0.0\"\n \n-# Some extra dependency for better feature control to avoid having to rebuild\n-# between \"cargo build\" and \"cargo intall\".\n-num-traits = \"*\"\n-serde = { version = \"*\", features = [\"derive\"] }\n-\n-[build-dependencies]\n-vergen = \"3\"\n+# Enable some feature flags that dev-dependencies need but dependencies\n+# do not.  This makes `./miri install` after `./miri build` faster.\n+[target.\"cfg(unix)\".dependencies]\n+libc = \"0.2\"\n \n [dev-dependencies]\n compiletest_rs = { version = \"0.5\", features = [\"tmp\"] }\n+rustc_version = \"0.2.3\"\n colored = \"1.6\"\n \n [features]\n-default = [\"cargo_miri\"]\n-cargo_miri = [\"cargo_metadata\", \"directories\", \"rustc_version\", \"serde_json\"]\n rustc_tests = []"}, {"sha": "c6d80add078781edd8235b2f62a891f292d0045a", "filename": "cargo-miri/Cargo.lock", "status": "added", "additions": 351, "deletions": 0, "changes": 351, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2FCargo.lock?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -0,0 +1,351 @@\n+# This file is automatically @generated by Cargo.\n+# It is not intended for manual editing.\n+[[package]]\n+name = \"arrayref\"\n+version = \"0.3.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a4c527152e37cf757a3f78aae5a06fbeefdb07ccc535c980a3208ee3060dd544\"\n+\n+[[package]]\n+name = \"arrayvec\"\n+version = \"0.5.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"cff77d8686867eceff3105329d4698d96c2391c176d5d03adc90c7389162b5b8\"\n+\n+[[package]]\n+name = \"autocfg\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f8aac770f1885fd7e387acedd76065302551364496e46b3dd00860b2f8359b9d\"\n+\n+[[package]]\n+name = \"base64\"\n+version = \"0.11.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b41b7ea54a0c9d92199de89e20e58d49f02f8e699814ef3fdf266f6f748d15c7\"\n+\n+[[package]]\n+name = \"bitflags\"\n+version = \"1.2.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"cf1de2fe8c75bc145a2f577add951f8134889b4795d47466a54a5c846d691693\"\n+\n+[[package]]\n+name = \"blake2b_simd\"\n+version = \"0.5.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"d8fb2d74254a3a0b5cac33ac9f8ed0e44aa50378d9dbb2e5d83bd21ed1dc2c8a\"\n+dependencies = [\n+ \"arrayref\",\n+ \"arrayvec\",\n+ \"constant_time_eq\",\n+]\n+\n+[[package]]\n+name = \"cargo-miri\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"cargo_metadata\",\n+ \"directories\",\n+ \"rustc-workspace-hack\",\n+ \"rustc_version\",\n+ \"serde\",\n+ \"serde_json\",\n+ \"vergen\",\n+]\n+\n+[[package]]\n+name = \"cargo_metadata\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"46e3374c604fb39d1a2f35ed5e4a4e30e60d01fab49446e08f1b3e9a90aef202\"\n+dependencies = [\n+ \"semver\",\n+ \"serde\",\n+ \"serde_derive\",\n+ \"serde_json\",\n+]\n+\n+[[package]]\n+name = \"cfg-if\"\n+version = \"0.1.10\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"4785bdd1c96b2a846b2bd7cc02e86b6b3dbf14e7e53446c4f54c92a361040822\"\n+\n+[[package]]\n+name = \"chrono\"\n+version = \"0.4.11\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"80094f509cf8b5ae86a4966a39b3ff66cd7e2a3e594accec3743ff3fabeab5b2\"\n+dependencies = [\n+ \"num-integer\",\n+ \"num-traits\",\n+ \"time\",\n+]\n+\n+[[package]]\n+name = \"constant_time_eq\"\n+version = \"0.1.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"245097e9a4535ee1e3e3931fcfcd55a796a44c643e8596ff6566d68f09b87bbc\"\n+\n+[[package]]\n+name = \"crossbeam-utils\"\n+version = \"0.7.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c3c7c73a2d1e9fc0886a08b93e98eb643461230d5f1925e4036204d5f2e261a8\"\n+dependencies = [\n+ \"autocfg\",\n+ \"cfg-if\",\n+ \"lazy_static\",\n+]\n+\n+[[package]]\n+name = \"directories\"\n+version = \"2.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"551a778172a450d7fc12e629ca3b0428d00f6afa9a43da1b630d54604e97371c\"\n+dependencies = [\n+ \"cfg-if\",\n+ \"dirs-sys\",\n+]\n+\n+[[package]]\n+name = \"dirs-sys\"\n+version = \"0.3.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"afa0b23de8fd801745c471deffa6e12d248f962c9fd4b4c33787b055599bde7b\"\n+dependencies = [\n+ \"cfg-if\",\n+ \"libc\",\n+ \"redox_users\",\n+ \"winapi\",\n+]\n+\n+[[package]]\n+name = \"getrandom\"\n+version = \"0.1.14\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"7abc8dd8451921606d809ba32e95b6111925cd2906060d2dcc29c070220503eb\"\n+dependencies = [\n+ \"cfg-if\",\n+ \"libc\",\n+ \"wasi\",\n+]\n+\n+[[package]]\n+name = \"itoa\"\n+version = \"0.4.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b8b7a7c0c47db5545ed3fef7468ee7bb5b74691498139e4b3f6a20685dc6dd8e\"\n+\n+[[package]]\n+name = \"lazy_static\"\n+version = \"1.4.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e2abad23fbc42b3700f2f279844dc832adb2b2eb069b2df918f455c4e18cc646\"\n+\n+[[package]]\n+name = \"libc\"\n+version = \"0.2.70\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"3baa92041a6fec78c687fa0cc2b3fae8884f743d672cf551bed1d6dac6988d0f\"\n+\n+[[package]]\n+name = \"num-integer\"\n+version = \"0.1.42\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"3f6ea62e9d81a77cd3ee9a2a5b9b609447857f3d358704331e4ef39eb247fcba\"\n+dependencies = [\n+ \"autocfg\",\n+ \"num-traits\",\n+]\n+\n+[[package]]\n+name = \"num-traits\"\n+version = \"0.2.11\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c62be47e61d1842b9170f0fdeec8eba98e60e90e5446449a0545e5152acd7096\"\n+dependencies = [\n+ \"autocfg\",\n+]\n+\n+[[package]]\n+name = \"proc-macro2\"\n+version = \"1.0.13\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"53f5ffe53a6b28e37c9c1ce74893477864d64f74778a93a4beb43c8fa167f639\"\n+dependencies = [\n+ \"unicode-xid\",\n+]\n+\n+[[package]]\n+name = \"quote\"\n+version = \"1.0.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"54a21852a652ad6f610c9510194f398ff6f8692e334fd1145fed931f7fbe44ea\"\n+dependencies = [\n+ \"proc-macro2\",\n+]\n+\n+[[package]]\n+name = \"redox_syscall\"\n+version = \"0.1.56\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2439c63f3f6139d1b57529d16bc3b8bb855230c8efcc5d3a896c8bea7c3b1e84\"\n+\n+[[package]]\n+name = \"redox_users\"\n+version = \"0.3.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"09b23093265f8d200fa7b4c2c76297f47e681c655f6f1285a8780d6a022f7431\"\n+dependencies = [\n+ \"getrandom\",\n+ \"redox_syscall\",\n+ \"rust-argon2\",\n+]\n+\n+[[package]]\n+name = \"rust-argon2\"\n+version = \"0.7.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2bc8af4bda8e1ff4932523b94d3dd20ee30a87232323eda55903ffd71d2fb017\"\n+dependencies = [\n+ \"base64\",\n+ \"blake2b_simd\",\n+ \"constant_time_eq\",\n+ \"crossbeam-utils\",\n+]\n+\n+[[package]]\n+name = \"rustc-workspace-hack\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"fc71d2faa173b74b232dedc235e3ee1696581bb132fc116fa3626d6151a1a8fb\"\n+\n+[[package]]\n+name = \"rustc_version\"\n+version = \"0.2.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a\"\n+dependencies = [\n+ \"semver\",\n+]\n+\n+[[package]]\n+name = \"ryu\"\n+version = \"1.0.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ed3d612bc64430efeb3f7ee6ef26d590dce0c43249217bddc62112540c7941e1\"\n+\n+[[package]]\n+name = \"semver\"\n+version = \"0.9.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\"\n+dependencies = [\n+ \"semver-parser\",\n+ \"serde\",\n+]\n+\n+[[package]]\n+name = \"semver-parser\"\n+version = \"0.7.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3\"\n+\n+[[package]]\n+name = \"serde\"\n+version = \"1.0.110\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"99e7b308464d16b56eba9964e4972a3eee817760ab60d88c3f86e1fecb08204c\"\n+dependencies = [\n+ \"serde_derive\",\n+]\n+\n+[[package]]\n+name = \"serde_derive\"\n+version = \"1.0.110\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"818fbf6bfa9a42d3bfcaca148547aa00c7b915bec71d1757aa2d44ca68771984\"\n+dependencies = [\n+ \"proc-macro2\",\n+ \"quote\",\n+ \"syn\",\n+]\n+\n+[[package]]\n+name = \"serde_json\"\n+version = \"1.0.53\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"993948e75b189211a9b31a7528f950c6adc21f9720b6438ff80a7fa2f864cea2\"\n+dependencies = [\n+ \"itoa\",\n+ \"ryu\",\n+ \"serde\",\n+]\n+\n+[[package]]\n+name = \"syn\"\n+version = \"1.0.23\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"95b5f192649e48a5302a13f2feb224df883b98933222369e4b3b0fe2a5447269\"\n+dependencies = [\n+ \"proc-macro2\",\n+ \"quote\",\n+ \"unicode-xid\",\n+]\n+\n+[[package]]\n+name = \"time\"\n+version = \"0.1.43\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ca8a50ef2360fbd1eeb0ecd46795a87a19024eb4b53c5dc916ca1fd95fe62438\"\n+dependencies = [\n+ \"libc\",\n+ \"winapi\",\n+]\n+\n+[[package]]\n+name = \"unicode-xid\"\n+version = \"0.2.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"826e7639553986605ec5979c7dd957c7895e93eabed50ab2ffa7f6128a75097c\"\n+\n+[[package]]\n+name = \"vergen\"\n+version = \"3.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"4ce50d8996df1f85af15f2cd8d33daae6e479575123ef4314a51a70a230739cb\"\n+dependencies = [\n+ \"bitflags\",\n+ \"chrono\",\n+]\n+\n+[[package]]\n+name = \"wasi\"\n+version = \"0.9.0+wasi-snapshot-preview1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"cccddf32554fecc6acb585f82a32a72e28b48f8c4c1883ddfeeeaa96f7d8e519\"\n+\n+[[package]]\n+name = \"winapi\"\n+version = \"0.3.8\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"8093091eeb260906a183e6ae1abdba2ef5ef2257a21801128899c3fc699229c6\"\n+dependencies = [\n+ \"winapi-i686-pc-windows-gnu\",\n+ \"winapi-x86_64-pc-windows-gnu\",\n+]\n+\n+[[package]]\n+name = \"winapi-i686-pc-windows-gnu\"\n+version = \"0.4.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6\"\n+\n+[[package]]\n+name = \"winapi-x86_64-pc-windows-gnu\"\n+version = \"0.4.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f\""}, {"sha": "d6a98be2bbdfa21ae015afea05b438486c16d623", "filename": "cargo-miri/Cargo.toml", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2FCargo.toml?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -0,0 +1,32 @@\n+[package]\n+authors = [\"Miri Team\"]\n+description = \"An experimental interpreter for Rust MIR (cargo wrapper).\"\n+license = \"MIT/Apache-2.0\"\n+name = \"cargo-miri\"\n+repository = \"https://github.com/rust-lang/miri\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+\n+[[bin]]\n+name = \"cargo-miri\"\n+path = \"bin.rs\"\n+test = false # we have no unit tests\n+doctest = false # and no doc tests\n+\n+[dependencies]\n+cargo_metadata = \"0.9.0\"\n+directories = \"2.0\"\n+rustc_version = \"0.2.3\"\n+serde_json = \"1.0.40\"\n+\n+# A noop dependency that changes in the Rust repository, it's a bit of a hack.\n+# See the `src/tools/rustc-workspace-hack/README.md` file in `rust-lang/rust`\n+# for more information.\n+rustc-workspace-hack = \"1.0.0\"\n+\n+# Enable some feature flags that dev-dependencies need but dependencies\n+# do not.  This makes `./miri install` after `./miri build` faster.\n+serde = { version = \"*\", features = [\"derive\"] }\n+\n+[build-dependencies]\n+vergen = \"3\""}, {"sha": "197552a4b12668dd845142ddc321bb8c44dd012d", "filename": "cargo-miri/bin.rs", "status": "renamed", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -1,12 +1,12 @@\n #![feature(inner_deref)]\n \n use std::env;\n+use std::ffi::OsString;\n use std::fs::{self, File};\n use std::io::{self, BufRead, Write};\n use std::ops::Not;\n use std::path::{Path, PathBuf};\n use std::process::Command;\n-use std::ffi::OsString;\n \n use rustc_version::VersionMeta;\n \n@@ -94,6 +94,9 @@ fn get_arg_flag_value(name: &str) -> Option<String> {\n \n /// Returns the path to the `miri` binary\n fn find_miri() -> PathBuf {\n+    if let Some(path) = env::var_os(\"MIRI\") {\n+        return path.into();\n+    }\n     let mut path = std::env::current_exe().expect(\"current executable path invalid\");\n     path.set_file_name(\"miri\");\n     path\n@@ -265,7 +268,8 @@ fn setup(subcommand: MiriCommand) {\n             let sysroot = std::str::from_utf8(&sysroot).unwrap();\n             let sysroot = Path::new(sysroot.trim_end_matches('\\n'));\n             // Check for `$SYSROOT/lib/rustlib/src/rust/src`; test if that contains `libstd/lib.rs`.\n-            let rustup_src = sysroot.join(\"lib\").join(\"rustlib\").join(\"src\").join(\"rust\").join(\"src\");\n+            let rustup_src =\n+                sysroot.join(\"lib\").join(\"rustlib\").join(\"src\").join(\"rust\").join(\"src\");\n             if !rustup_src.join(\"libstd\").join(\"lib.rs\").exists() {\n                 // Ask the user to install the `rust-src` component, and use that.\n                 let mut cmd = Command::new(\"rustup\");\n@@ -363,8 +367,7 @@ path = \"lib.rs\"\n     let sysroot = if target == &host { dir.join(\"HOST\") } else { PathBuf::from(dir) };\n     std::env::set_var(\"MIRI_SYSROOT\", &sysroot); // pass the env var to the processes we spawn, which will turn it into \"--sysroot\" flags\n     // Figure out what to print.\n-    let print_sysroot = subcommand == MiriCommand::Setup\n-        && has_arg_flag(\"--print-sysroot\"); // whether we just print the sysroot path\n+    let print_sysroot = subcommand == MiriCommand::Setup && has_arg_flag(\"--print-sysroot\"); // whether we just print the sysroot path\n     if print_sysroot {\n         // Print just the sysroot and nothing else; this way we do not need any escaping.\n         println!(\"{}\", sysroot.display());\n@@ -564,6 +567,8 @@ fn main() {\n         // dependencies get dispatched to `rustc`, the final test/binary to `miri`.\n         inside_cargo_rustc();\n     } else {\n-        show_error(format!(\"`cargo-miri` must be called with either `miri` or `rustc` as first argument.\"))\n+        show_error(format!(\n+            \"`cargo-miri` must be called with either `miri` or `rustc` as first argument.\"\n+        ))\n     }\n }", "previous_filename": "src/bin/cargo-miri.rs"}, {"sha": "56956920e2e2690e9d65498b61b0a9eab280a92f", "filename": "cargo-miri/build.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/cargo-miri%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbuild.rs?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "previous_filename": "build.rs"}, {"sha": "785d7aa5520c0931bfb168040777183fdba878aa", "filename": "ci.sh", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/ci.sh", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/ci.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci.sh?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -4,7 +4,7 @@ set -euo pipefail\n # Determine configuration\n export RUST_TEST_NOCAPTURE=1\n export RUST_BACKTRACE=1\n-export RUSTC_EXTRA_FLAGS=\"-D warnings\"\n+export RUSTFLAGS=\"-D warnings\"\n export CARGO_INCREMENTAL=0\n export CARGO_EXTRA_FLAGS=\"--all-features\"\n \n@@ -48,4 +48,7 @@ elif [ \"${TRAVIS_OS_NAME:-}\" == osx ]; then\n elif [ \"${CI_WINDOWS:-}\" == True ]; then\n   MIRI_TEST_TARGET=x86_64-unknown-linux-gnu run_tests\n   MIRI_TEST_TARGET=x86_64-apple-darwin run_tests\n+else\n+  echo \"FATAL: unknown CI platform\"\n+  exit 1\n fi"}, {"sha": "237a53efb1ad173ae71fa534578a9734f1f0c0b2", "filename": "miri", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/miri", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/miri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/miri?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -45,23 +45,27 @@ if ! test -d \"$LIBDIR\"; then\n     echo \"Please report a bug at https://github.com/rust-lang/miri/issues.\"\n     exit 2\n fi\n-# We set the rpath so that Miri finds the private rustc libraries it needs.\n-# We enable debug-assertions to get tracing.\n-# We enable line-only debuginfo for backtraces.\n-export RUSTFLAGS=\"-C link-args=-Wl,-rpath,$LIBDIR -C debug-assertions -C debuginfo=1 $RUSTC_EXTRA_FLAGS\"\n if [ -z \"$CARGO_INCREMENTAL\" ]; then\n     # Default CARGO_INCREMENTAL to 1.\n     export CARGO_INCREMENTAL=1\n fi\n+if [ -z \"$CARGO_TARGET_DIR\" ]; then\n+    # Share target dir between `miri` and `cargo-miri`.\n+    export CARGO_TARGET_DIR=\"$(dirname \"$0\")\"/target\n+fi\n+# We set the rpath so that Miri finds the private rustc libraries it needs.\n+# We enable debug-assertions to get tracing.\n+# We enable line-only debuginfo for backtraces.\n+export RUSTFLAGS=\"-C link-args=-Wl,-rpath,$LIBDIR -C debug-assertions -C debuginfo=1 $RUSTFLAGS\"\n \n ## Helper functions\n \n # Build a sysroot and set MIRI_SYSROOT to use it.  Arguments are passed to `cargo miri setup`.\n build_sysroot() {\n     # Build once, for the user to see.\n-    cargo run $CARGO_BUILD_FLAGS --bin cargo-miri -- miri setup \"$@\"\n+    cargo run $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/cargo-miri/Cargo.toml -- miri setup \"$@\"\n     # Call again, to just set env var.\n-    export MIRI_SYSROOT=\"$(cargo run $CARGO_BUILD_FLAGS -q --bin cargo-miri -- miri setup --print-sysroot \"$@\")\"\n+    export MIRI_SYSROOT=\"$(cargo run $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/cargo-miri/Cargo.toml -q -- miri setup --print-sysroot \"$@\")\"\n }\n \n # Prepare and set MIRI_SYSROOT.  Respects `MIRI_TEST_TARGET` and takes into account\n@@ -104,21 +108,25 @@ case \"$COMMAND\" in\n install|install-debug)\n     # \"--locked\" to respect the Cargo.lock file if it exists,\n     # \"--offline\" to avoid querying the registry (for yanked packages).\n-    exec cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\" --force --locked --offline \"$@\"\n+    cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\" --force --locked --offline \"$@\"\n+    cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\"/cargo-miri --force --locked --offline \"$@\"\n     ;;\n check|check-debug)\n     # Check, and let caller control flags.\n-    exec cargo check $CARGO_BUILD_FLAGS \"$@\"\n+    cargo check $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/Cargo.toml \"$@\"\n+    cargo check $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/cargo-miri/Cargo.toml \"$@\"\n     ;;\n build|build-debug)\n     # Build, and let caller control flags.\n-    exec cargo build $CARGO_BUILD_FLAGS \"$@\"\n+    cargo build $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/Cargo.toml \"$@\"\n+    cargo build $CARGO_BUILD_FLAGS --manifest-path \"$(dirname \"$0\")\"/cargo-miri/Cargo.toml \"$@\"\n     ;;\n test|test-debug)\n     # First build and get a sysroot.\n     cargo build $CARGO_BUILD_FLAGS\n     find_sysroot\n     # Then test, and let caller control flags.\n+    # Only in root project as `cargo-miri` has no tests.\n     exec cargo test $CARGO_BUILD_FLAGS \"$@\"\n     ;;\n run|run-debug)"}, {"sha": "a64f0edb94645febfc3cf91aaaf96446e66438a7", "filename": "tests/compiletest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/83b4222d9a7b8f47e940cefad93d4ae535649210/tests%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b4222d9a7b8f47e940cefad93d4ae535649210/tests%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompiletest.rs?ref=83b4222d9a7b8f47e940cefad93d4ae535649210", "patch": "@@ -9,7 +9,7 @@ use colored::*;\n use compiletest_rs as compiletest;\n \n fn miri_path() -> PathBuf {\n-    PathBuf::from(option_env!(\"MIRI_PATH\").unwrap_or(env!(\"CARGO_BIN_EXE_miri\")))\n+    PathBuf::from(option_env!(\"MIRI\").unwrap_or(env!(\"CARGO_BIN_EXE_miri\")))\n }\n \n fn run_tests(mode: &str, path: &str, target: &str) {"}]}