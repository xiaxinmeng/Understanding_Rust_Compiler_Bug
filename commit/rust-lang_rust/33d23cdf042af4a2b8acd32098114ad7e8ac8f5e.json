{"sha": "33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzZDIzY2RmMDQyYWY0YTJiOGFjZDMyMDk4MTE0YWQ3ZThhYzhmNWU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2019-09-18T22:54:47Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2019-10-05T13:33:26Z"}, "message": "Extend test and fix nits", "tree": {"sha": "0edd18e01bc2cff8c761eb5d19c2388eb609d594", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0edd18e01bc2cff8c761eb5d19c2388eb609d594"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "html_url": "https://github.com/rust-lang/rust/commit/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98f02b23628d3b46e25f83634d5db2ffbe8ee725", "url": "https://api.github.com/repos/rust-lang/rust/commits/98f02b23628d3b46e25f83634d5db2ffbe8ee725", "html_url": "https://github.com/rust-lang/rust/commit/98f02b23628d3b46e25f83634d5db2ffbe8ee725"}], "stats": {"total": 80, "additions": 72, "deletions": 8}, "files": [{"sha": "403f718d7dd9fbf8350a772ebd46b8ba91faace6", "filename": "src/test/ui/specialization/specialization-default-methods-fail.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.rs?ref=33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "patch": "@@ -1,11 +1,11 @@\n-// compile-fail\n-\n-#![feature(specialization)]\n+#![feature(specialization, associated_type_defaults)]\n \n // Test that attempting to override a non-default method or one not in the\n-// parent impl causes an error\n+// parent impl causes an error.\n \n trait Foo {\n+    type Ty = ();\n+    const CONST: u8 = 123;\n     fn foo(&self) -> bool { true }\n }\n \n@@ -16,6 +16,8 @@ trait Foo {\n // Box<i32>  Box<i64>   Vec<()>  Vec<bool>\n \n impl<T> Foo for Box<T> {\n+    type Ty = bool;\n+    const CONST: u8 = 0;\n     fn foo(&self) -> bool { false }\n }\n \n@@ -24,18 +26,26 @@ impl Foo for Box<i32> {}\n \n // Can't override a non-`default` fn\n impl Foo for Box<i64> {\n+    type Ty = Vec<()>;\n+//~^ error: `Ty` specializes an item from a parent `impl`, but that item is not marked `default`\n+    const CONST: u8 = 42;\n+//~^ error: `CONST` specializes an item from a parent `impl`, but that item is not marked `default`\n     fn foo(&self) -> bool { true }\n //~^ error: `foo` specializes an item from a parent `impl`, but that item is not marked `default`\n }\n \n \n-// Doesn't mention the method = provided body is used and the method is final\n+// Doesn't mention the item = provided body/value is used and the method is final.\n impl<T> Foo for Vec<T> {}\n \n // Allowed\n impl Foo for Vec<()> {}\n \n impl Foo for Vec<bool> {\n+    type Ty = Vec<()>;\n+//~^ error: `Ty` specializes an item from a parent `impl`, but that item is not marked `default`\n+    const CONST: u8 = 42;\n+//~^ error: `CONST` specializes an item from a parent `impl`, but that item is not marked `default`\n     fn foo(&self) -> bool { true }\n //~^ error: `foo` specializes an item from a parent `impl`, but that item is not marked `default`\n }"}, {"sha": "f215191a8cecea036d894845d847aa490fd0b7f6", "filename": "src/test/ui/specialization/specialization-default-methods-fail.stderr", "status": "modified", "additions": 57, "deletions": 3, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/33d23cdf042af4a2b8acd32098114ad7e8ac8f5e/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspecialization%2Fspecialization-default-methods-fail.stderr?ref=33d23cdf042af4a2b8acd32098114ad7e8ac8f5e", "patch": "@@ -1,7 +1,39 @@\n+error[E0520]: `Ty` specializes an item from a parent `impl`, but that item is not marked `default`\n+  --> $DIR/specialization-default-methods-fail.rs:29:5\n+   |\n+LL | / impl<T> Foo for Box<T> {\n+LL | |     type Ty = bool;\n+LL | |     const CONST: u8 = 0;\n+LL | |     fn foo(&self) -> bool { false }\n+LL | | }\n+   | |_- parent `impl` is here\n+...\n+LL |       type Ty = Vec<()>;\n+   |       ^^^^^^^^^^^^^^^^^^ cannot specialize default item `Ty`\n+   |\n+   = note: to specialize, `Ty` in the parent `impl` must be marked `default`\n+\n+error[E0520]: `CONST` specializes an item from a parent `impl`, but that item is not marked `default`\n+  --> $DIR/specialization-default-methods-fail.rs:31:5\n+   |\n+LL | / impl<T> Foo for Box<T> {\n+LL | |     type Ty = bool;\n+LL | |     const CONST: u8 = 0;\n+LL | |     fn foo(&self) -> bool { false }\n+LL | | }\n+   | |_- parent `impl` is here\n+...\n+LL |       const CONST: u8 = 42;\n+   |       ^^^^^^^^^^^^^^^^^^^^^ cannot specialize default item `CONST`\n+   |\n+   = note: to specialize, `CONST` in the parent `impl` must be marked `default`\n+\n error[E0520]: `foo` specializes an item from a parent `impl`, but that item is not marked `default`\n-  --> $DIR/specialization-default-methods-fail.rs:27:5\n+  --> $DIR/specialization-default-methods-fail.rs:33:5\n    |\n LL | / impl<T> Foo for Box<T> {\n+LL | |     type Ty = bool;\n+LL | |     const CONST: u8 = 0;\n LL | |     fn foo(&self) -> bool { false }\n LL | | }\n    | |_- parent `impl` is here\n@@ -11,8 +43,30 @@ LL |       fn foo(&self) -> bool { true }\n    |\n    = note: to specialize, `foo` in the parent `impl` must be marked `default`\n \n+error[E0520]: `Ty` specializes an item from a parent `impl`, but that item is not marked `default`\n+  --> $DIR/specialization-default-methods-fail.rs:45:5\n+   |\n+LL | impl<T> Foo for Vec<T> {}\n+   | ------------------------- parent `impl` is here\n+...\n+LL |     type Ty = Vec<()>;\n+   |     ^^^^^^^^^^^^^^^^^^ cannot specialize default item `Ty`\n+   |\n+   = note: to specialize, `Ty` in the parent `impl` must be marked `default`\n+\n+error[E0520]: `CONST` specializes an item from a parent `impl`, but that item is not marked `default`\n+  --> $DIR/specialization-default-methods-fail.rs:47:5\n+   |\n+LL | impl<T> Foo for Vec<T> {}\n+   | ------------------------- parent `impl` is here\n+...\n+LL |     const CONST: u8 = 42;\n+   |     ^^^^^^^^^^^^^^^^^^^^^ cannot specialize default item `CONST`\n+   |\n+   = note: to specialize, `CONST` in the parent `impl` must be marked `default`\n+\n error[E0520]: `foo` specializes an item from a parent `impl`, but that item is not marked `default`\n-  --> $DIR/specialization-default-methods-fail.rs:39:5\n+  --> $DIR/specialization-default-methods-fail.rs:49:5\n    |\n LL | impl<T> Foo for Vec<T> {}\n    | ------------------------- parent `impl` is here\n@@ -22,6 +76,6 @@ LL |     fn foo(&self) -> bool { true }\n    |\n    = note: to specialize, `foo` in the parent `impl` must be marked `default`\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0520`."}]}