{"sha": "940b2eabad13d7781316d077ea4b64d559242f50", "node_id": "C_kwDOAAsO6NoAKDk0MGIyZWFiYWQxM2Q3NzgxMzE2ZDA3N2VhNGI2NGQ1NTkyNDJmNTA", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-08-30T00:23:33Z"}, "committer": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-12-03T22:51:46Z"}, "message": "Add initial AST and MIR support for unwinding from inline assembly", "tree": {"sha": "3e5bbda4838f6260a06e1c4e605d5c0dfce42ffc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e5bbda4838f6260a06e1c4e605d5c0dfce42ffc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/940b2eabad13d7781316d077ea4b64d559242f50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/940b2eabad13d7781316d077ea4b64d559242f50", "html_url": "https://github.com/rust-lang/rust/commit/940b2eabad13d7781316d077ea4b64d559242f50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/940b2eabad13d7781316d077ea4b64d559242f50/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "532d2b14c05f9bc20b2d27cbb5f4550d28343a36", "url": "https://api.github.com/repos/rust-lang/rust/commits/532d2b14c05f9bc20b2d27cbb5f4550d28343a36", "html_url": "https://github.com/rust-lang/rust/commit/532d2b14c05f9bc20b2d27cbb5f4550d28343a36"}], "stats": {"total": 567, "additions": 355, "deletions": 212}, "files": [{"sha": "03b957adeda9d36a748908846eac282a5d3b2f59", "filename": "compiler/rustc_ast/src/ast.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fast.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1981,7 +1981,7 @@ pub enum InlineAsmRegOrRegClass {\n \n bitflags::bitflags! {\n     #[derive(Encodable, Decodable, HashStable_Generic)]\n-    pub struct InlineAsmOptions: u8 {\n+    pub struct InlineAsmOptions: u16 {\n         const PURE = 1 << 0;\n         const NOMEM = 1 << 1;\n         const READONLY = 1 << 2;\n@@ -1990,6 +1990,7 @@ bitflags::bitflags! {\n         const NOSTACK = 1 << 5;\n         const ATT_SYNTAX = 1 << 6;\n         const RAW = 1 << 7;\n+        const MAY_UNWIND = 1 << 8;\n     }\n }\n "}, {"sha": "0dc1f093947e3b092ea8645d86f92a4c7a875c86", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -2338,6 +2338,9 @@ impl<'a> State<'a> {\n                 if opts.contains(InlineAsmOptions::RAW) {\n                     options.push(\"raw\");\n                 }\n+                if opts.contains(InlineAsmOptions::MAY_UNWIND) {\n+                    options.push(\"may_unwind\");\n+                }\n                 s.commasep(Inconsistent, &options, |s, &opt| {\n                     s.word(opt);\n                 });"}, {"sha": "15372ec1534fe164fb6d9f162a27e46c7eada66c", "filename": "compiler/rustc_borrowck/src/dataflow.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Fdataflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Fdataflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdataflow.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -5,7 +5,7 @@ use rustc_middle::ty::RegionVid;\n use rustc_middle::ty::TyCtxt;\n use rustc_mir_dataflow::impls::{EverInitializedPlaces, MaybeUninitializedPlaces};\n use rustc_mir_dataflow::ResultsVisitable;\n-use rustc_mir_dataflow::{self, fmt::DebugWithContext, GenKill};\n+use rustc_mir_dataflow::{self, fmt::DebugWithContext, CallReturnPlaces, GenKill};\n use rustc_mir_dataflow::{Analysis, Direction, Results};\n use std::fmt;\n use std::iter;\n@@ -434,9 +434,7 @@ impl<'tcx> rustc_mir_dataflow::GenKillAnalysis<'tcx> for Borrows<'_, 'tcx> {\n         &self,\n         _trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _dest_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n     }\n }"}, {"sha": "70acbc9ee2dbc4024fd77bd4504ca8ef3ea0a1b7", "filename": "compiler/rustc_borrowck/src/def_use.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Fdef_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Fdef_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdef_use.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -17,7 +17,7 @@ pub fn categorize(context: PlaceContext) -> Option<DefUse> {\n         PlaceContext::MutatingUse(MutatingUseContext::Store) |\n \n         // This is potentially both a def and a use...\n-        PlaceContext::MutatingUse(MutatingUseContext::AsmOutput) |\n+        PlaceContext::MutatingUse(MutatingUseContext::LlvmAsmOutput) |\n \n         // We let Call define the result in both the success and\n         // unwind cases. This is not really correct, however it\n@@ -26,6 +26,7 @@ pub fn categorize(context: PlaceContext) -> Option<DefUse> {\n         // the def in call only to the input from the success\n         // path and not the unwind path. -nmatsakis\n         PlaceContext::MutatingUse(MutatingUseContext::Call) |\n+        PlaceContext::MutatingUse(MutatingUseContext::AsmOutput) |\n         PlaceContext::MutatingUse(MutatingUseContext::Yield) |\n \n         // Storage live and storage dead aren't proper defines, but we can ignore"}, {"sha": "c03e4d8a448900996b3091e97993b474fc431fef", "filename": "compiler/rustc_borrowck/src/invalidation.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Finvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Finvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Finvalidation.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -199,6 +199,7 @@ impl<'cx, 'tcx> Visitor<'tcx> for InvalidationGenerator<'cx, 'tcx> {\n                 options: _,\n                 line_spans: _,\n                 destination: _,\n+                cleanup: _,\n             } => {\n                 for op in operands {\n                     match *op {"}, {"sha": "88fab269109f998973e76b89829c4155119b89bb", "filename": "compiler/rustc_borrowck/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -791,6 +791,7 @@ impl<'cx, 'tcx> rustc_mir_dataflow::ResultsVisitor<'cx, 'tcx> for MirBorrowckCtx\n                 options: _,\n                 line_spans: _,\n                 destination: _,\n+                cleanup: _,\n             } => {\n                 for op in operands {\n                     match *op {"}, {"sha": "6a263bd63ada8c63f99e7e81ec43b8cd72b1a139", "filename": "compiler/rustc_borrowck/src/type_check/mod.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Fmod.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1828,10 +1828,16 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n                     self.assert_iscleanup(body, block_data, unwind, true);\n                 }\n             }\n-            TerminatorKind::InlineAsm { destination, .. } => {\n+            TerminatorKind::InlineAsm { destination, cleanup, .. } => {\n                 if let Some(target) = destination {\n                     self.assert_iscleanup(body, block_data, target, is_cleanup);\n                 }\n+                if let Some(cleanup) = cleanup {\n+                    if is_cleanup {\n+                        span_mirbug!(self, block_data, \"cleanup on cleanup block\")\n+                    }\n+                    self.assert_iscleanup(body, block_data, cleanup, true);\n+                }\n             }\n         }\n     }"}, {"sha": "b374769cbea250baf8caf109ef3ffdb95c292d14", "filename": "compiler/rustc_builtin_macros/src/asm.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -420,6 +420,8 @@ fn parse_options<'a>(\n             try_set_option(p, args, sym::att_syntax, ast::InlineAsmOptions::ATT_SYNTAX);\n         } else if p.eat_keyword(kw::Raw) {\n             try_set_option(p, args, kw::Raw, ast::InlineAsmOptions::RAW);\n+        } else if p.eat_keyword(sym::may_unwind) {\n+            try_set_option(p, args, kw::Raw, ast::InlineAsmOptions::MAY_UNWIND);\n         } else {\n             return p.unexpected();\n         }"}, {"sha": "c486c19f9c9d89d74e9974eecc67f1e1330c178c", "filename": "compiler/rustc_codegen_ssa/src/mir/analyze.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fanalyze.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fanalyze.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fanalyze.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -211,6 +211,7 @@ impl<'mir, 'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> Visitor<'tcx>\n \n             PlaceContext::MutatingUse(\n                 MutatingUseContext::Store\n+                | MutatingUseContext::LlvmAsmOutput\n                 | MutatingUseContext::AsmOutput\n                 | MutatingUseContext::Borrow\n                 | MutatingUseContext::AddressOf"}, {"sha": "495fe13f18cd7d3de24160957e50d9a0283cee90", "filename": "compiler/rustc_codegen_ssa/src/mir/block.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1041,6 +1041,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                 options,\n                 line_spans,\n                 destination,\n+                cleanup: _, // TODO\n             } => {\n                 self.codegen_asm_terminator(\n                     helper,"}, {"sha": "249b4ea0602c19cba7cef1324a16d391953dac87", "filename": "compiler/rustc_const_eval/src/transform/check_consts/resolver.rs", "status": "modified", "additions": 15, "deletions": 16, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fresolver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fresolver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fresolver.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -7,6 +7,7 @@ use rustc_middle::mir::visit::Visitor;\n use rustc_middle::mir::{self, BasicBlock, Local, Location, Statement, StatementKind};\n use rustc_mir_dataflow::fmt::DebugWithContext;\n use rustc_mir_dataflow::JoinSemiLattice;\n+use rustc_mir_dataflow::{Analysis, AnalysisDomain, CallReturnPlaces};\n use rustc_span::DUMMY_SP;\n \n use std::fmt;\n@@ -80,18 +81,18 @@ where\n     fn apply_call_return_effect(\n         &mut self,\n         _block: BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        // We cannot reason about another function's internals, so use conservative type-based\n-        // qualification for the result of a function call.\n-        let return_ty = return_place.ty(self.ccx.body, self.ccx.tcx).ty;\n-        let qualif = Q::in_any_value_of_ty(self.ccx, return_ty);\n+        return_places.for_each(|place| {\n+            // We cannot reason about another function's internals, so use conservative type-based\n+            // qualification for the result of a function call.\n+            let return_ty = place.ty(self.ccx.body, self.ccx.tcx).ty;\n+            let qualif = Q::in_any_value_of_ty(self.ccx, return_ty);\n \n-        if !return_place.is_indirect() {\n-            self.assign_qualif_direct(&return_place, qualif);\n-        }\n+            if !place.is_indirect() {\n+                self.assign_qualif_direct(&place, qualif);\n+            }\n+        });\n     }\n \n     fn address_of_allows_mutation(&self, _mt: mir::Mutability, _place: mir::Place<'tcx>) -> bool {\n@@ -329,7 +330,7 @@ impl JoinSemiLattice for State {\n     }\n }\n \n-impl<Q> rustc_mir_dataflow::AnalysisDomain<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n+impl<Q> AnalysisDomain<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n where\n     Q: Qualif,\n {\n@@ -349,7 +350,7 @@ where\n     }\n }\n \n-impl<Q> rustc_mir_dataflow::Analysis<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n+impl<Q> Analysis<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n where\n     Q: Qualif,\n {\n@@ -375,10 +376,8 @@ where\n         &self,\n         state: &mut Self::Domain,\n         block: BasicBlock,\n-        func: &mir::Operand<'tcx>,\n-        args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        self.transfer_function(state).apply_call_return_effect(block, func, args, return_place)\n+        self.transfer_function(state).apply_call_return_effect(block, return_places)\n     }\n }"}, {"sha": "448a04f76b10ae5f3be154f1c1ccf35e44ef092a", "filename": "compiler/rustc_const_eval/src/transform/validate.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fvalidate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fvalidate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fvalidate.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -495,10 +495,13 @@ impl<'a, 'tcx> Visitor<'tcx> for TypeChecker<'a, 'tcx> {\n                     self.check_edge(location, *unwind, EdgeKind::Unwind);\n                 }\n             }\n-            TerminatorKind::InlineAsm { destination, .. } => {\n+            TerminatorKind::InlineAsm { destination, cleanup, .. } => {\n                 if let Some(destination) = destination {\n                     self.check_edge(location, *destination, EdgeKind::Normal);\n                 }\n+                if let Some(cleanup) = cleanup {\n+                    self.check_edge(location, *cleanup, EdgeKind::Unwind);\n+                }\n             }\n             // Nothing to validate for these.\n             TerminatorKind::Resume"}, {"sha": "18bc5bb64d6de781044f3547186563763863542c", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1433,6 +1433,9 @@ impl<'a> State<'a> {\n                 if opts.contains(ast::InlineAsmOptions::RAW) {\n                     options.push(\"raw\");\n                 }\n+                if opts.contains(ast::InlineAsmOptions::MAY_UNWIND) {\n+                    options.push(\"may_unwind\");\n+                }\n                 s.commasep(Inconsistent, &options, |s, &opt| {\n                     s.word(opt);\n                 });"}, {"sha": "a82f98d28e723f8dbfd19258ee1771919d105ec9", "filename": "compiler/rustc_middle/src/mir/terminator.rs", "status": "modified", "additions": 30, "deletions": 14, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fterminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fterminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fterminator.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -260,6 +260,10 @@ pub enum TerminatorKind<'tcx> {\n         /// Destination block after the inline assembly returns, unless it is\n         /// diverging (InlineAsmOptions::NORETURN).\n         destination: Option<BasicBlock>,\n+\n+        /// Cleanup to be done if the inline assembly unwinds. This is present\n+        /// if and only if InlineAsmOptions::MAY_UNWIND is set.\n+        cleanup: Option<BasicBlock>,\n     },\n }\n #[derive(Clone, Debug, TyEncodable, TyDecodable, HashStable)]\n@@ -309,7 +313,7 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | Return\n             | Unreachable\n             | Call { destination: None, cleanup: None, .. }\n-            | InlineAsm { destination: None, .. } => None.into_iter().chain(&[]),\n+            | InlineAsm { destination: None, cleanup: None, .. } => None.into_iter().chain(&[]),\n             Goto { target: ref t }\n             | Call { destination: None, cleanup: Some(ref t), .. }\n             | Call { destination: Some((_, ref t)), cleanup: None, .. }\n@@ -318,13 +322,17 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | Drop { target: ref t, unwind: None, .. }\n             | Assert { target: ref t, cleanup: None, .. }\n             | FalseUnwind { real_target: ref t, unwind: None }\n-            | InlineAsm { destination: Some(ref t), .. } => Some(t).into_iter().chain(&[]),\n+            | InlineAsm { destination: Some(ref t), cleanup: None, .. }\n+            | InlineAsm { destination: None, cleanup: Some(ref t), .. } => {\n+                Some(t).into_iter().chain(&[])\n+            }\n             Call { destination: Some((_, ref t)), cleanup: Some(ref u), .. }\n             | Yield { resume: ref t, drop: Some(ref u), .. }\n             | DropAndReplace { target: ref t, unwind: Some(ref u), .. }\n             | Drop { target: ref t, unwind: Some(ref u), .. }\n             | Assert { target: ref t, cleanup: Some(ref u), .. }\n-            | FalseUnwind { real_target: ref t, unwind: Some(ref u) } => {\n+            | FalseUnwind { real_target: ref t, unwind: Some(ref u) }\n+            | InlineAsm { destination: Some(ref t), cleanup: Some(ref u), .. } => {\n                 Some(t).into_iter().chain(slice::from_ref(u))\n             }\n             SwitchInt { ref targets, .. } => None.into_iter().chain(&targets.targets[..]),\n@@ -343,7 +351,7 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | Return\n             | Unreachable\n             | Call { destination: None, cleanup: None, .. }\n-            | InlineAsm { destination: None, .. } => None.into_iter().chain(&mut []),\n+            | InlineAsm { destination: None, cleanup: None, .. } => None.into_iter().chain(&mut []),\n             Goto { target: ref mut t }\n             | Call { destination: None, cleanup: Some(ref mut t), .. }\n             | Call { destination: Some((_, ref mut t)), cleanup: None, .. }\n@@ -352,13 +360,17 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | Drop { target: ref mut t, unwind: None, .. }\n             | Assert { target: ref mut t, cleanup: None, .. }\n             | FalseUnwind { real_target: ref mut t, unwind: None }\n-            | InlineAsm { destination: Some(ref mut t), .. } => Some(t).into_iter().chain(&mut []),\n+            | InlineAsm { destination: Some(ref mut t), cleanup: None, .. }\n+            | InlineAsm { destination: None, cleanup: Some(ref mut t), .. } => {\n+                Some(t).into_iter().chain(&mut [])\n+            }\n             Call { destination: Some((_, ref mut t)), cleanup: Some(ref mut u), .. }\n             | Yield { resume: ref mut t, drop: Some(ref mut u), .. }\n             | DropAndReplace { target: ref mut t, unwind: Some(ref mut u), .. }\n             | Drop { target: ref mut t, unwind: Some(ref mut u), .. }\n             | Assert { target: ref mut t, cleanup: Some(ref mut u), .. }\n-            | FalseUnwind { real_target: ref mut t, unwind: Some(ref mut u) } => {\n+            | FalseUnwind { real_target: ref mut t, unwind: Some(ref mut u) }\n+            | InlineAsm { destination: Some(ref mut t), cleanup: Some(ref mut u), .. } => {\n                 Some(t).into_iter().chain(slice::from_mut(u))\n             }\n             SwitchInt { ref mut targets, .. } => None.into_iter().chain(&mut targets.targets[..]),\n@@ -378,13 +390,13 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | TerminatorKind::GeneratorDrop\n             | TerminatorKind::Yield { .. }\n             | TerminatorKind::SwitchInt { .. }\n-            | TerminatorKind::FalseEdge { .. }\n-            | TerminatorKind::InlineAsm { .. } => None,\n+            | TerminatorKind::FalseEdge { .. } => None,\n             TerminatorKind::Call { cleanup: ref unwind, .. }\n             | TerminatorKind::Assert { cleanup: ref unwind, .. }\n             | TerminatorKind::DropAndReplace { ref unwind, .. }\n             | TerminatorKind::Drop { ref unwind, .. }\n-            | TerminatorKind::FalseUnwind { ref unwind, .. } => Some(unwind),\n+            | TerminatorKind::FalseUnwind { ref unwind, .. }\n+            | TerminatorKind::InlineAsm { cleanup: ref unwind, .. } => Some(unwind),\n         }\n     }\n \n@@ -398,13 +410,13 @@ impl<'tcx> TerminatorKind<'tcx> {\n             | TerminatorKind::GeneratorDrop\n             | TerminatorKind::Yield { .. }\n             | TerminatorKind::SwitchInt { .. }\n-            | TerminatorKind::FalseEdge { .. }\n-            | TerminatorKind::InlineAsm { .. } => None,\n+            | TerminatorKind::FalseEdge { .. } => None,\n             TerminatorKind::Call { cleanup: ref mut unwind, .. }\n             | TerminatorKind::Assert { cleanup: ref mut unwind, .. }\n             | TerminatorKind::DropAndReplace { ref mut unwind, .. }\n             | TerminatorKind::Drop { ref mut unwind, .. }\n-            | TerminatorKind::FalseUnwind { ref mut unwind, .. } => Some(unwind),\n+            | TerminatorKind::FalseUnwind { ref mut unwind, .. }\n+            | TerminatorKind::InlineAsm { cleanup: ref mut unwind, .. } => Some(unwind),\n         }\n     }\n \n@@ -583,8 +595,12 @@ impl<'tcx> TerminatorKind<'tcx> {\n             FalseEdge { .. } => vec![\"real\".into(), \"imaginary\".into()],\n             FalseUnwind { unwind: Some(_), .. } => vec![\"real\".into(), \"cleanup\".into()],\n             FalseUnwind { unwind: None, .. } => vec![\"real\".into()],\n-            InlineAsm { destination: Some(_), .. } => vec![\"\".into()],\n-            InlineAsm { destination: None, .. } => vec![],\n+            InlineAsm { destination: Some(_), cleanup: Some(_), .. } => {\n+                vec![\"return\".into(), \"unwind\".into()]\n+            }\n+            InlineAsm { destination: Some(_), cleanup: None, .. } => vec![\"return\".into()],\n+            InlineAsm { destination: None, cleanup: Some(_), .. } => vec![\"unwind\".into()],\n+            InlineAsm { destination: None, cleanup: None, .. } => vec![],\n         }\n     }\n }"}, {"sha": "901f3bf4f7d41b84603a6d89a04acfd670a59fee", "filename": "compiler/rustc_middle/src/mir/type_foldable.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Ftype_foldable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Ftype_foldable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Ftype_foldable.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -84,13 +84,16 @@ impl<'tcx> TypeFoldable<'tcx> for Terminator<'tcx> {\n                 FalseEdge { real_target, imaginary_target }\n             }\n             FalseUnwind { real_target, unwind } => FalseUnwind { real_target, unwind },\n-            InlineAsm { template, operands, options, line_spans, destination } => InlineAsm {\n-                template,\n-                operands: operands.try_fold_with(folder)?,\n-                options,\n-                line_spans,\n-                destination,\n-            },\n+            InlineAsm { template, operands, options, line_spans, destination, cleanup } => {\n+                InlineAsm {\n+                    template,\n+                    operands: operands.try_fold_with(folder)?,\n+                    options,\n+                    line_spans,\n+                    destination,\n+                    cleanup,\n+                }\n+            }\n         };\n         Ok(Terminator { source_info: self.source_info, kind })\n     }"}, {"sha": "d783b6330e8e5dd0ad5d75bbc8d812cd517f7897", "filename": "compiler/rustc_middle/src/mir/visit.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -412,7 +412,7 @@ macro_rules! make_mir_visitor {\n                         for output in & $($mutability)? asm.outputs[..] {\n                             self.visit_place(\n                                 output,\n-                                PlaceContext::MutatingUse(MutatingUseContext::AsmOutput),\n+                                PlaceContext::MutatingUse(MutatingUseContext::LlvmAsmOutput),\n                                 location\n                             );\n                         }\n@@ -581,6 +581,7 @@ macro_rules! make_mir_visitor {\n                         options: _,\n                         line_spans: _,\n                         destination: _,\n+                        cleanup: _,\n                     } => {\n                         for op in operands {\n                             match op {\n@@ -590,7 +591,7 @@ macro_rules! make_mir_visitor {\n                                 InlineAsmOperand::Out { place: Some(place), .. } => {\n                                     self.visit_place(\n                                         place,\n-                                        PlaceContext::MutatingUse(MutatingUseContext::Store),\n+                                        PlaceContext::MutatingUse(MutatingUseContext::AsmOutput),\n                                         location,\n                                     );\n                                 }\n@@ -599,7 +600,7 @@ macro_rules! make_mir_visitor {\n                                     if let Some(out_place) = out_place {\n                                         self.visit_place(\n                                             out_place,\n-                                            PlaceContext::MutatingUse(MutatingUseContext::Store),\n+                                            PlaceContext::MutatingUse(MutatingUseContext::AsmOutput),\n                                             location,\n                                         );\n                                     }\n@@ -1178,8 +1179,10 @@ pub enum MutatingUseContext {\n     /// Appears as LHS of an assignment.\n     Store,\n     /// Can often be treated as a `Store`, but needs to be separate because\n-    /// ASM is allowed to read outputs as well, so a `Store`-`AsmOutput` sequence\n+    /// ASM is allowed to read outputs as well, so a `Store`-`LlvmAsmOutput` sequence\n     /// cannot be simplified the way a `Store`-`Store` can be.\n+    LlvmAsmOutput,\n+    /// Output operand of an inline assembly block.\n     AsmOutput,\n     /// Destination of a call.\n     Call,\n@@ -1268,6 +1271,7 @@ impl PlaceContext {\n             PlaceContext::MutatingUse(\n                 MutatingUseContext::Store\n                     | MutatingUseContext::Call\n+                    | MutatingUseContext::LlvmAsmOutput\n                     | MutatingUseContext::AsmOutput,\n             )\n         )"}, {"sha": "abec67af08bff17a5f2ba93f45069e21b1528013", "filename": "compiler/rustc_mir_build/src/build/expr/into.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -467,8 +467,12 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                         } else {\n                             Some(destination_block)\n                         },\n+                        cleanup: None,\n                     },\n                 );\n+                if options.contains(InlineAsmOptions::MAY_UNWIND) {\n+                    this.diverge_from(block);\n+                }\n                 destination_block.unit()\n             }\n "}, {"sha": "fc46c54c2fc35033769aa4b7d577c4b123acad45", "filename": "compiler/rustc_mir_build/src/build/scope.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fscope.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1034,6 +1034,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                     | TerminatorKind::Call { .. }\n                     | TerminatorKind::DropAndReplace { .. }\n                     | TerminatorKind::FalseUnwind { .. }\n+                    | TerminatorKind::InlineAsm { .. }\n             ),\n             \"diverge_from called on block with terminator that cannot unwind.\"\n         );\n@@ -1373,7 +1374,8 @@ impl<'tcx> DropTreeBuilder<'tcx> for Unwind {\n             | TerminatorKind::DropAndReplace { unwind, .. }\n             | TerminatorKind::FalseUnwind { unwind, .. }\n             | TerminatorKind::Call { cleanup: unwind, .. }\n-            | TerminatorKind::Assert { cleanup: unwind, .. } => {\n+            | TerminatorKind::Assert { cleanup: unwind, .. }\n+            | TerminatorKind::InlineAsm { cleanup: unwind, .. } => {\n                 *unwind = Some(to);\n             }\n             TerminatorKind::Goto { .. }\n@@ -1384,8 +1386,7 @@ impl<'tcx> DropTreeBuilder<'tcx> for Unwind {\n             | TerminatorKind::Unreachable\n             | TerminatorKind::Yield { .. }\n             | TerminatorKind::GeneratorDrop\n-            | TerminatorKind::FalseEdge { .. }\n-            | TerminatorKind::InlineAsm { .. } => {\n+            | TerminatorKind::FalseEdge { .. } => {\n                 span_bug!(term.source_info.span, \"cannot unwind from {:?}\", term.kind)\n             }\n         }"}, {"sha": "6131ee7981829fdd7fceb2294eb534c0f18c0847", "filename": "compiler/rustc_mir_dataflow/src/framework/direction.rs", "status": "modified", "additions": 49, "deletions": 10, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fdirection.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fdirection.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fdirection.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -4,7 +4,9 @@ use rustc_middle::ty::TyCtxt;\n use std::ops::RangeInclusive;\n \n use super::visitor::{ResultsVisitable, ResultsVisitor};\n-use super::{Analysis, Effect, EffectIndex, GenKillAnalysis, GenKillSet, SwitchIntTarget};\n+use super::{\n+    Analysis, CallReturnPlaces, Effect, EffectIndex, GenKillAnalysis, GenKillSet, SwitchIntTarget,\n+};\n \n pub trait Direction {\n     fn is_forward() -> bool;\n@@ -235,14 +237,26 @@ impl Direction for Backward {\n                 // Apply terminator-specific edge effects.\n                 //\n                 // FIXME(ecstaticmorse): Avoid cloning the exit state unconditionally.\n-                mir::TerminatorKind::Call {\n-                    destination: Some((return_place, dest)),\n-                    ref func,\n-                    ref args,\n-                    ..\n+                mir::TerminatorKind::Call { destination: Some((return_place, dest)), .. }\n+                    if dest == bb =>\n+                {\n+                    let mut tmp = exit_state.clone();\n+                    analysis.apply_call_return_effect(\n+                        &mut tmp,\n+                        pred,\n+                        CallReturnPlaces::Call(return_place),\n+                    );\n+                    propagate(pred, &tmp);\n+                }\n+                mir::TerminatorKind::InlineAsm {\n+                    destination: Some(dest), ref operands, ..\n                 } if dest == bb => {\n                     let mut tmp = exit_state.clone();\n-                    analysis.apply_call_return_effect(&mut tmp, pred, func, args, return_place);\n+                    analysis.apply_call_return_effect(\n+                        &mut tmp,\n+                        pred,\n+                        CallReturnPlaces::InlineAsm(operands),\n+                    );\n                     propagate(pred, &tmp);\n                 }\n \n@@ -258,6 +272,7 @@ impl Direction for Backward {\n                 | mir::TerminatorKind::Drop { unwind: Some(unwind), .. }\n                 | mir::TerminatorKind::DropAndReplace { unwind: Some(unwind), .. }\n                 | mir::TerminatorKind::FalseUnwind { unwind: Some(unwind), .. }\n+                | mir::TerminatorKind::InlineAsm { cleanup: Some(unwind), .. }\n                     if unwind == bb =>\n                 {\n                     if dead_unwinds.map_or(true, |dead| !dead.contains(bb)) {\n@@ -467,7 +482,7 @@ impl Direction for Forward {\n                 propagate(target, exit_state);\n             }\n \n-            Call { cleanup, destination, ref func, ref args, from_hir_call: _, fn_span: _ } => {\n+            Call { cleanup, destination, func: _, args: _, from_hir_call: _, fn_span: _ } => {\n                 if let Some(unwind) = cleanup {\n                     if dead_unwinds.map_or(true, |dead| !dead.contains(bb)) {\n                         propagate(unwind, exit_state);\n@@ -477,13 +492,37 @@ impl Direction for Forward {\n                 if let Some((dest_place, target)) = destination {\n                     // N.B.: This must be done *last*, otherwise the unwind path will see the call\n                     // return effect.\n-                    analysis.apply_call_return_effect(exit_state, bb, func, args, dest_place);\n+                    analysis.apply_call_return_effect(\n+                        exit_state,\n+                        bb,\n+                        CallReturnPlaces::Call(dest_place),\n+                    );\n                     propagate(target, exit_state);\n                 }\n             }\n \n-            InlineAsm { template: _, operands: _, options: _, line_spans: _, destination } => {\n+            InlineAsm {\n+                template: _,\n+                ref operands,\n+                options: _,\n+                line_spans: _,\n+                destination,\n+                cleanup,\n+            } => {\n+                if let Some(unwind) = cleanup {\n+                    if dead_unwinds.map_or(true, |dead| !dead.contains(bb)) {\n+                        propagate(unwind, exit_state);\n+                    }\n+                }\n+\n                 if let Some(target) = destination {\n+                    // N.B.: This must be done *last*, otherwise the unwind path will see the call\n+                    // return effect.\n+                    analysis.apply_call_return_effect(\n+                        exit_state,\n+                        bb,\n+                        CallReturnPlaces::InlineAsm(operands),\n+                    );\n                     propagate(target, exit_state);\n                 }\n             }"}, {"sha": "517bc086ef683451b27108158b4936dfcbd24dc2", "filename": "compiler/rustc_mir_dataflow/src/framework/graphviz.rs", "status": "modified", "additions": 32, "deletions": 8, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -10,7 +10,7 @@ use rustc_middle::mir::graphviz_safe_def_name;\n use rustc_middle::mir::{self, BasicBlock, Body, Location};\n \n use super::fmt::{DebugDiffWithAdapter, DebugWithAdapter, DebugWithContext};\n-use super::{Analysis, Direction, Results, ResultsRefCursor, ResultsVisitor};\n+use super::{Analysis, CallReturnPlaces, Direction, Results, ResultsRefCursor, ResultsVisitor};\n \n #[derive(Clone, Copy, Debug, PartialEq, Eq)]\n pub enum OutputStyle {\n@@ -231,16 +231,15 @@ where\n         // for the basic block itself. That way, we could display terminator-specific effects for\n         // backward dataflow analyses as well as effects for `SwitchInt` terminators.\n         match terminator.kind {\n-            mir::TerminatorKind::Call {\n-                destination: Some((return_place, _)),\n-                ref func,\n-                ref args,\n-                ..\n-            } => {\n+            mir::TerminatorKind::Call { destination: Some((return_place, _)), .. } => {\n                 self.write_row(w, \"\", \"(on successful return)\", |this, w, fmt| {\n                     let state_on_unwind = this.results.get().clone();\n                     this.results.apply_custom_effect(|analysis, state| {\n-                        analysis.apply_call_return_effect(state, block, func, args, return_place);\n+                        analysis.apply_call_return_effect(\n+                            state,\n+                            block,\n+                            CallReturnPlaces::Call(return_place),\n+                        );\n                     });\n \n                     write!(\n@@ -278,6 +277,31 @@ where\n                 })?;\n             }\n \n+            mir::TerminatorKind::InlineAsm { destination: Some(_), ref operands, .. } => {\n+                self.write_row(w, \"\", \"(on successful return)\", |this, w, fmt| {\n+                    let state_on_unwind = this.results.get().clone();\n+                    this.results.apply_custom_effect(|analysis, state| {\n+                        analysis.apply_call_return_effect(\n+                            state,\n+                            block,\n+                            CallReturnPlaces::InlineAsm(operands),\n+                        );\n+                    });\n+\n+                    write!(\n+                        w,\n+                        r#\"<td balign=\"left\" colspan=\"{colspan}\" {fmt} align=\"left\">{diff}</td>\"#,\n+                        colspan = this.style.num_state_columns(),\n+                        fmt = fmt,\n+                        diff = diff_pretty(\n+                            this.results.get(),\n+                            &state_on_unwind,\n+                            this.results.analysis()\n+                        ),\n+                    )\n+                })?;\n+            }\n+\n             _ => {}\n         };\n "}, {"sha": "500fba8b1142cb364822428df8d2d038d6c66764", "filename": "compiler/rustc_mir_dataflow/src/framework/mod.rs", "status": "modified", "additions": 28, "deletions": 10, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fmod.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -160,9 +160,7 @@ pub trait Analysis<'tcx>: AnalysisDomain<'tcx> {\n         &self,\n         state: &mut Self::Domain,\n         block: BasicBlock,\n-        func: &mir::Operand<'tcx>,\n-        args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     );\n \n     /// Updates the current dataflow state with the effect of resuming from a `Yield` terminator.\n@@ -276,9 +274,7 @@ pub trait GenKillAnalysis<'tcx>: Analysis<'tcx> {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         block: BasicBlock,\n-        func: &mir::Operand<'tcx>,\n-        args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     );\n \n     /// See `Analysis::apply_yield_resume_effect`.\n@@ -347,11 +343,9 @@ where\n         &self,\n         state: &mut A::Domain,\n         block: BasicBlock,\n-        func: &mir::Operand<'tcx>,\n-        args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        self.call_return_effect(state, block, func, args, return_place);\n+        self.call_return_effect(state, block, return_places);\n     }\n \n     fn apply_yield_resume_effect(\n@@ -542,5 +536,29 @@ pub trait SwitchIntEdgeEffects<D> {\n     fn apply(&mut self, apply_edge_effect: impl FnMut(&mut D, SwitchIntTarget));\n }\n \n+/// List of places that are written to after a successful (non-unwind) return\n+/// from a `Call` or `InlineAsm`.\n+pub enum CallReturnPlaces<'a, 'tcx> {\n+    Call(mir::Place<'tcx>),\n+    InlineAsm(&'a [mir::InlineAsmOperand<'tcx>]),\n+}\n+\n+impl<'tcx> CallReturnPlaces<'_, 'tcx> {\n+    pub fn for_each(&self, mut f: impl FnMut(mir::Place<'tcx>)) {\n+        match *self {\n+            Self::Call(place) => f(place),\n+            Self::InlineAsm(operands) => {\n+                for op in operands {\n+                    match *op {\n+                        mir::InlineAsmOperand::Out { place: Some(place), .. }\n+                        | mir::InlineAsmOperand::InOut { out_place: Some(place), .. } => f(place),\n+                        _ => {}\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}\n+\n #[cfg(test)]\n mod tests;"}, {"sha": "01ca8ca9258fb769f3e3ae3032a75d6db780af10", "filename": "compiler/rustc_mir_dataflow/src/framework/tests.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Ftests.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -220,9 +220,7 @@ impl<D: Direction> Analysis<'tcx> for MockAnalysis<'tcx, D> {\n         &self,\n         _state: &mut Self::Domain,\n         _block: BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _return_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n     }\n }"}, {"sha": "6df2c8df3cea0840af30fda3e4dd48a53389277a", "filename": "compiler/rustc_mir_dataflow/src/impls/borrowed_locals.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fborrowed_locals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fborrowed_locals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fborrowed_locals.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1,6 +1,6 @@\n use super::*;\n \n-use crate::{AnalysisDomain, GenKill, GenKillAnalysis};\n+use crate::{AnalysisDomain, CallReturnPlaces, GenKill, GenKillAnalysis};\n use rustc_middle::mir::visit::Visitor;\n use rustc_middle::mir::*;\n \n@@ -84,9 +84,7 @@ impl GenKillAnalysis<'tcx> for MaybeBorrowedLocals {\n         &self,\n         _trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _dest_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n     }\n }"}, {"sha": "df13b5c33940a0fe4e28a3d86dcadf2b9105c8ca", "filename": "compiler/rustc_mir_dataflow/src/impls/init_locals.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Finit_locals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Finit_locals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Finit_locals.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -2,7 +2,7 @@\n //!\n //! A local will be maybe initialized if *any* projections of that local might be initialized.\n \n-use crate::GenKill;\n+use crate::{CallReturnPlaces, GenKill};\n \n use rustc_index::bit_set::BitSet;\n use rustc_middle::mir::visit::{PlaceContext, Visitor};\n@@ -53,11 +53,9 @@ impl crate::GenKillAnalysis<'tcx> for MaybeInitializedLocals {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        trans.gen(return_place.local)\n+        return_places.for_each(|place| trans.gen(place.local));\n     }\n \n     /// See `Analysis::apply_yield_resume_effect`.\n@@ -83,7 +81,11 @@ where\n         use rustc_middle::mir::visit::{MutatingUseContext, NonMutatingUseContext, NonUseContext};\n         match context {\n             // These are handled specially in `call_return_effect` and `yield_resume_effect`.\n-            PlaceContext::MutatingUse(MutatingUseContext::Call | MutatingUseContext::Yield) => {}\n+            PlaceContext::MutatingUse(\n+                MutatingUseContext::Call\n+                | MutatingUseContext::AsmOutput\n+                | MutatingUseContext::Yield,\n+            ) => {}\n \n             // Otherwise, when a place is mutated, we must consider it possibly initialized.\n             PlaceContext::MutatingUse(_) => self.trans.gen(local),"}, {"sha": "5be9df6c452a2214235ffa5e889aa1af1379c489", "filename": "compiler/rustc_mir_dataflow/src/impls/liveness.rs", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -2,7 +2,7 @@ use rustc_index::bit_set::BitSet;\n use rustc_middle::mir::visit::{MutatingUseContext, NonMutatingUseContext, PlaceContext, Visitor};\n use rustc_middle::mir::{self, Local, Location};\n \n-use crate::{AnalysisDomain, Backward, GenKill, GenKillAnalysis};\n+use crate::{AnalysisDomain, Backward, CallReturnPlaces, GenKill, GenKillAnalysis};\n \n /// A [live-variable dataflow analysis][liveness].\n ///\n@@ -94,13 +94,13 @@ impl GenKillAnalysis<'tcx> for MaybeLiveLocals {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        dest_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        if let Some(local) = dest_place.as_local() {\n-            trans.kill(local);\n-        }\n+        return_places.for_each(|place| {\n+            if let Some(local) = place.as_local() {\n+                trans.kill(local);\n+            }\n+        });\n     }\n \n     fn yield_resume_effect(\n@@ -167,12 +167,16 @@ impl DefUse {\n             // destination place for a `Call` return or `Yield` resume respectively. Since this is\n             // only a `Def` when the function returns successfully, we handle this case separately\n             // in `call_return_effect` above.\n-            PlaceContext::MutatingUse(MutatingUseContext::Call | MutatingUseContext::Yield) => None,\n+            PlaceContext::MutatingUse(\n+                MutatingUseContext::Call\n+                | MutatingUseContext::AsmOutput\n+                | MutatingUseContext::Yield,\n+            ) => None,\n \n             // All other contexts are uses...\n             PlaceContext::MutatingUse(\n                 MutatingUseContext::AddressOf\n-                | MutatingUseContext::AsmOutput\n+                | MutatingUseContext::LlvmAsmOutput\n                 | MutatingUseContext::Borrow\n                 | MutatingUseContext::Drop\n                 | MutatingUseContext::Retag,"}, {"sha": "5659fd2dc70750c62903799b906b7786fe19db10", "filename": "compiler/rustc_mir_dataflow/src/impls/mod.rs", "status": "modified", "additions": 44, "deletions": 46, "changes": 90, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fmod.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -11,7 +11,7 @@ use rustc_middle::ty::{self, TyCtxt};\n use crate::drop_flag_effects_for_function_entry;\n use crate::drop_flag_effects_for_location;\n use crate::elaborate_drops::DropFlagState;\n-use crate::framework::SwitchIntEdgeEffects;\n+use crate::framework::{CallReturnPlaces, SwitchIntEdgeEffects};\n use crate::move_paths::{HasMoveData, InitIndex, InitKind, LookupResult, MoveData, MovePathIndex};\n use crate::on_lookup_result_bits;\n use crate::MoveDataParamEnv;\n@@ -354,21 +354,21 @@ impl<'tcx> GenKillAnalysis<'tcx> for MaybeInitializedPlaces<'_, 'tcx> {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        dest_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        // when a call returns successfully, that means we need to set\n-        // the bits for that dest_place to 1 (initialized).\n-        on_lookup_result_bits(\n-            self.tcx,\n-            self.body,\n-            self.move_data(),\n-            self.move_data().rev_lookup.find(dest_place.as_ref()),\n-            |mpi| {\n-                trans.gen(mpi);\n-            },\n-        );\n+        return_places.for_each(|place| {\n+            // when a call returns successfully, that means we need to set\n+            // the bits for that dest_place to 1 (initialized).\n+            on_lookup_result_bits(\n+                self.tcx,\n+                self.body,\n+                self.move_data(),\n+                self.move_data().rev_lookup.find(place.as_ref()),\n+                |mpi| {\n+                    trans.gen(mpi);\n+                },\n+            );\n+        });\n     }\n \n     fn switch_int_edge_effects<G: GenKill<Self::Idx>>(\n@@ -472,21 +472,21 @@ impl<'tcx> GenKillAnalysis<'tcx> for MaybeUninitializedPlaces<'_, 'tcx> {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        dest_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        // when a call returns successfully, that means we need to set\n-        // the bits for that dest_place to 0 (initialized).\n-        on_lookup_result_bits(\n-            self.tcx,\n-            self.body,\n-            self.move_data(),\n-            self.move_data().rev_lookup.find(dest_place.as_ref()),\n-            |mpi| {\n-                trans.kill(mpi);\n-            },\n-        );\n+        return_places.for_each(|place| {\n+            // when a call returns successfully, that means we need to set\n+            // the bits for that dest_place to 0 (initialized).\n+            on_lookup_result_bits(\n+                self.tcx,\n+                self.body,\n+                self.move_data(),\n+                self.move_data().rev_lookup.find(place.as_ref()),\n+                |mpi| {\n+                    trans.kill(mpi);\n+                },\n+            );\n+        });\n     }\n \n     fn switch_int_edge_effects<G: GenKill<Self::Idx>>(\n@@ -591,21 +591,21 @@ impl<'tcx> GenKillAnalysis<'tcx> for DefinitelyInitializedPlaces<'_, 'tcx> {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        dest_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        // when a call returns successfully, that means we need to set\n-        // the bits for that dest_place to 1 (initialized).\n-        on_lookup_result_bits(\n-            self.tcx,\n-            self.body,\n-            self.move_data(),\n-            self.move_data().rev_lookup.find(dest_place.as_ref()),\n-            |mpi| {\n-                trans.gen(mpi);\n-            },\n-        );\n+        return_places.for_each(|place| {\n+            // when a call returns successfully, that means we need to set\n+            // the bits for that dest_place to 1 (initialized).\n+            on_lookup_result_bits(\n+                self.tcx,\n+                self.body,\n+                self.move_data(),\n+                self.move_data().rev_lookup.find(place.as_ref()),\n+                |mpi| {\n+                    trans.gen(mpi);\n+                },\n+            );\n+        });\n     }\n }\n \n@@ -679,9 +679,7 @@ impl<'tcx> GenKillAnalysis<'tcx> for EverInitializedPlaces<'_, 'tcx> {\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _dest_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n         let move_data = self.move_data();\n         let init_loc_map = &move_data.init_loc_map;"}, {"sha": "108357abc0de02886d3aba76941daf2aa006b0ea", "filename": "compiler/rustc_mir_dataflow/src/impls/storage_liveness.rs", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fstorage_liveness.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1,7 +1,7 @@\n pub use super::*;\n \n use crate::storage::AlwaysLiveLocals;\n-use crate::{GenKill, Results, ResultsRefCursor};\n+use crate::{CallReturnPlaces, GenKill, Results, ResultsRefCursor};\n use rustc_middle::mir::visit::{NonMutatingUseContext, PlaceContext, Visitor};\n use rustc_middle::mir::*;\n use std::cell::RefCell;\n@@ -68,9 +68,7 @@ impl crate::GenKillAnalysis<'tcx> for MaybeStorageLive {\n         &self,\n         _trans: &mut impl GenKill<Self::Idx>,\n         _block: BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _return_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n         // Nothing to do when a call returns successfully\n     }\n@@ -226,7 +224,7 @@ impl<'mir, 'tcx> crate::GenKillAnalysis<'tcx> for MaybeRequiresStorage<'mir, 'tc\n         terminator: &mir::Terminator<'tcx>,\n         loc: Location,\n     ) {\n-        match &terminator.kind {\n+        match terminator.kind {\n             // For call terminators the destination requires storage for the call\n             // and after the call returns successfully, but not after a panic.\n             // Since `propagate_call_unwind` doesn't exist, we have to kill the\n@@ -235,6 +233,11 @@ impl<'mir, 'tcx> crate::GenKillAnalysis<'tcx> for MaybeRequiresStorage<'mir, 'tc\n                 trans.kill(place.local);\n             }\n \n+            // The same applies to InlineAsm outputs.\n+            TerminatorKind::InlineAsm { ref operands, .. } => {\n+                CallReturnPlaces::InlineAsm(operands).for_each(|place| trans.kill(place.local));\n+            }\n+\n             // Nothing to do for these. Match exhaustively so this fails to compile when new\n             // variants are added.\n             TerminatorKind::Call { destination: None, .. }\n@@ -247,7 +250,6 @@ impl<'mir, 'tcx> crate::GenKillAnalysis<'tcx> for MaybeRequiresStorage<'mir, 'tc\n             | TerminatorKind::FalseUnwind { .. }\n             | TerminatorKind::GeneratorDrop\n             | TerminatorKind::Goto { .. }\n-            | TerminatorKind::InlineAsm { .. }\n             | TerminatorKind::Resume\n             | TerminatorKind::Return\n             | TerminatorKind::SwitchInt { .. }\n@@ -261,11 +263,9 @@ impl<'mir, 'tcx> crate::GenKillAnalysis<'tcx> for MaybeRequiresStorage<'mir, 'tc\n         &self,\n         trans: &mut impl GenKill<Self::Idx>,\n         _block: BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        return_place: mir::Place<'tcx>,\n+        return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n-        trans.gen(return_place.local);\n+        return_places.for_each(|place| trans.gen(place.local));\n     }\n \n     fn yield_resume_effect("}, {"sha": "10d2cf6eba03de5869efc52f0eebf04a61aecfe2", "filename": "compiler/rustc_mir_dataflow/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Flib.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -28,9 +28,9 @@ pub use self::drop_flag_effects::{\n     on_lookup_result_bits,\n };\n pub use self::framework::{\n-    fmt, graphviz, lattice, visit_results, Analysis, AnalysisDomain, Backward, Direction, Engine,\n-    Forward, GenKill, GenKillAnalysis, JoinSemiLattice, Results, ResultsCursor, ResultsRefCursor,\n-    ResultsVisitable, ResultsVisitor,\n+    fmt, graphviz, lattice, visit_results, Analysis, AnalysisDomain, Backward, CallReturnPlaces,\n+    Direction, Engine, Forward, GenKill, GenKillAnalysis, JoinSemiLattice, Results, ResultsCursor,\n+    ResultsRefCursor, ResultsVisitable, ResultsVisitor,\n };\n \n use self::move_paths::MoveData;"}, {"sha": "feb85d4ffdfa881126ea178fc02d136df323d56e", "filename": "compiler/rustc_mir_dataflow/src/move_paths/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fmove_paths%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_dataflow%2Fsrc%2Fmove_paths%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fmove_paths%2Fbuilder.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -419,6 +419,7 @@ impl<'b, 'a, 'tcx> Gatherer<'b, 'a, 'tcx> {\n                 options: _,\n                 line_spans: _,\n                 destination: _,\n+                cleanup: _,\n             } => {\n                 for op in operands {\n                     match *op {"}, {"sha": "cdfeb957df9b1f1c38eff3d3a1dcf35e35ae8141", "filename": "compiler/rustc_mir_transform/src/check_unsafety.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fcheck_unsafety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fcheck_unsafety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcheck_unsafety.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -208,6 +208,7 @@ impl<'a, 'tcx> Visitor<'tcx> for UnsafetyChecker<'a, 'tcx> {\n                             MutatingUseContext::Store\n                                 | MutatingUseContext::Drop\n                                 | MutatingUseContext::AsmOutput\n+                                | MutatingUseContext::LlvmAsmOutput\n                         )\n                     );\n                 // If this is just an assignment, determine if the assigned type needs dropping."}, {"sha": "4bfa1de7a3b3f33922d77e916d3d7def336c2b7a", "filename": "compiler/rustc_mir_transform/src/const_prop.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -1022,6 +1022,7 @@ impl<'tcx> Visitor<'tcx> for CanConstProp {\n             // These are just stores, where the storing is not propagatable, but there may be later\n             // mutations of the same local via `Store`\n             | MutatingUse(MutatingUseContext::Call)\n+            | MutatingUse(MutatingUseContext::AsmOutput)\n             // Actual store that can possibly even propagate a value\n             | MutatingUse(MutatingUseContext::Store) => {\n                 if !self.found_assignment.insert(local) {\n@@ -1052,7 +1053,7 @@ impl<'tcx> Visitor<'tcx> for CanConstProp {\n \n             // These could be propagated with a smarter analysis or just some careful thinking about\n             // whether they'd be fine right now.\n-            MutatingUse(MutatingUseContext::AsmOutput)\n+            MutatingUse(MutatingUseContext::LlvmAsmOutput)\n             | MutatingUse(MutatingUseContext::Yield)\n             | MutatingUse(MutatingUseContext::Drop)\n             | MutatingUse(MutatingUseContext::Retag)"}, {"sha": "f3217f0b9b68b3d697b6d9e97ac3456a117f4a5b", "filename": "compiler/rustc_mir_transform/src/dest_prop.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fdest_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Fdest_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fdest_prop.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -624,6 +624,7 @@ impl Conflicts<'a> {\n                 options: _,\n                 line_spans: _,\n                 destination: _,\n+                cleanup: _,\n             } => {\n                 // The intended semantics here aren't documented, we just assume that nothing that\n                 // could be written to by the assembly may overlap with any other operands."}, {"sha": "4dacd4c288a277326d2b413bb74b17a63b2cae8a", "filename": "compiler/rustc_mir_transform/src/inline.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -441,6 +441,13 @@ impl Inliner<'tcx> {\n                     }\n                 }\n                 TerminatorKind::Resume => cost += RESUME_PENALTY,\n+                TerminatorKind::InlineAsm { cleanup, .. } => {\n+                    cost += INSTR_COST;\n+\n+                    if cleanup.is_some() {\n+                        cost += LANDINGPAD_PENALTY;\n+                    }\n+                }\n                 _ => cost += INSTR_COST,\n             }\n \n@@ -954,9 +961,13 @@ impl<'a, 'tcx> MutVisitor<'tcx> for Integrator<'a, 'tcx> {\n             {\n                 bug!(\"False unwinds should have been removed before inlining\")\n             }\n-            TerminatorKind::InlineAsm { ref mut destination, .. } => {\n+            TerminatorKind::InlineAsm { ref mut destination, ref mut cleanup, .. } => {\n                 if let Some(ref mut tgt) = *destination {\n                     *tgt = self.map_block(*tgt);\n+                } else if !self.in_cleanup_block {\n+                    // Unless this inline asm is in a cleanup block, add an unwind edge to\n+                    // the original call's cleanup block\n+                    *cleanup = self.cleanup_block;\n                 }\n             }\n         }"}, {"sha": "5d16293c721ec20fe409e351eeee081ba70f14c3", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -817,6 +817,7 @@ symbols! {\n         maxnumf32,\n         maxnumf64,\n         may_dangle,\n+        may_unwind,\n         maybe_uninit,\n         maybe_uninit_uninit,\n         maybe_uninit_zeroed,"}, {"sha": "867e0433eae1bece783672fd52c8dcf4c2ebac31", "filename": "src/test/ui/asm/aarch64/bad-options.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fbad-options.stderr?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -36,41 +36,41 @@ LL |         asm!(\"{}\", out(reg) foo, clobber_abi(\"C\"));\n    |                    |\n    |                    generic outputs\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/bad-options.rs:28:25\n    |\n LL | global_asm!(\"\", options(nomem));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `readonly`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `readonly`\n   --> $DIR/bad-options.rs:30:25\n    |\n LL | global_asm!(\"\", options(readonly));\n-   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `noreturn`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `noreturn`\n   --> $DIR/bad-options.rs:32:25\n    |\n LL | global_asm!(\"\", options(noreturn));\n-   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `pure`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `pure`\n   --> $DIR/bad-options.rs:34:25\n    |\n LL | global_asm!(\"\", options(pure));\n-   |                         ^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nostack`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nostack`\n   --> $DIR/bad-options.rs:36:25\n    |\n LL | global_asm!(\"\", options(nostack));\n-   |                         ^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `preserves_flags`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `preserves_flags`\n   --> $DIR/bad-options.rs:38:25\n    |\n LL | global_asm!(\"\", options(preserves_flags));\n-   |                         ^^^^^^^^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: invalid ABI for `clobber_abi`\n   --> $DIR/bad-options.rs:20:18"}, {"sha": "a143c3b2b28180ea94aa8d112035957ec4cfbcc4", "filename": "src/test/ui/asm/aarch64/parse-error.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fparse-error.stderr?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -64,23 +64,23 @@ error: argument to `sym` must be a path expression\n LL |         asm!(\"{}\", sym foo + bar);\n    |                        ^^^^^^^^^\n \n-error: expected one of `)`, `att_syntax`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n   --> $DIR/parse-error.rs:31:26\n    |\n LL |         asm!(\"\", options(foo));\n-   |                          ^^^ expected one of 9 possible tokens\n+   |                          ^^^ expected one of 10 possible tokens\n \n error: expected one of `)` or `,`, found `foo`\n   --> $DIR/parse-error.rs:33:32\n    |\n LL |         asm!(\"\", options(nomem foo));\n    |                                ^^^ expected one of `)` or `,`\n \n-error: expected one of `)`, `att_syntax`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n   --> $DIR/parse-error.rs:35:33\n    |\n LL |         asm!(\"\", options(nomem, foo));\n-   |                                 ^^^ expected one of 9 possible tokens\n+   |                                 ^^^ expected one of 10 possible tokens\n \n error: arguments are not allowed after options\n   --> $DIR/parse-error.rs:37:31\n@@ -260,23 +260,23 @@ error: expected one of `,`, `.`, `?`, or an operator, found `FOO`\n LL | global_asm!(\"{}\", const(reg) FOO);\n    |                              ^^^ expected one of `,`, `.`, `?`, or an operator\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `FOO`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `FOO`\n   --> $DIR/parse-error.rs:100:25\n    |\n LL | global_asm!(\"\", options(FOO));\n-   |                         ^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/parse-error.rs:102:25\n    |\n LL | global_asm!(\"\", options(nomem FOO));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/parse-error.rs:104:25\n    |\n LL | global_asm!(\"\", options(nomem, FOO));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: arguments are not allowed after options\n   --> $DIR/parse-error.rs:106:30"}, {"sha": "a63c42aac27377d543b3385867ea922774c2036b", "filename": "src/test/ui/asm/x86_64/bad-options.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fbad-options.stderr?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -45,41 +45,41 @@ LL |         asm!(\"{}\", out(reg) foo, clobber_abi(\"C\"), clobber_abi(\"C\"));\n    |                    |             clobber_abi\n    |                    generic outputs\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/bad-options.rs:31:25\n    |\n LL | global_asm!(\"\", options(nomem));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `readonly`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `readonly`\n   --> $DIR/bad-options.rs:33:25\n    |\n LL | global_asm!(\"\", options(readonly));\n-   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `noreturn`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `noreturn`\n   --> $DIR/bad-options.rs:35:25\n    |\n LL | global_asm!(\"\", options(noreturn));\n-   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `pure`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `pure`\n   --> $DIR/bad-options.rs:37:25\n    |\n LL | global_asm!(\"\", options(pure));\n-   |                         ^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nostack`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nostack`\n   --> $DIR/bad-options.rs:39:25\n    |\n LL | global_asm!(\"\", options(nostack));\n-   |                         ^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `preserves_flags`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `preserves_flags`\n   --> $DIR/bad-options.rs:41:25\n    |\n LL | global_asm!(\"\", options(preserves_flags));\n-   |                         ^^^^^^^^^^^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^^^^^^^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: invalid ABI for `clobber_abi`\n   --> $DIR/bad-options.rs:20:18"}, {"sha": "4f16c15af381c5b8ffa789f2ee64d06045b20f53", "filename": "src/test/ui/asm/x86_64/parse-error.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fparse-error.stderr?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -64,23 +64,23 @@ error: argument to `sym` must be a path expression\n LL |         asm!(\"{}\", sym foo + bar);\n    |                        ^^^^^^^^^\n \n-error: expected one of `)`, `att_syntax`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n   --> $DIR/parse-error.rs:31:26\n    |\n LL |         asm!(\"\", options(foo));\n-   |                          ^^^ expected one of 9 possible tokens\n+   |                          ^^^ expected one of 10 possible tokens\n \n error: expected one of `)` or `,`, found `foo`\n   --> $DIR/parse-error.rs:33:32\n    |\n LL |         asm!(\"\", options(nomem foo));\n    |                                ^^^ expected one of `)` or `,`\n \n-error: expected one of `)`, `att_syntax`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, `nomem`, `noreturn`, `nostack`, `preserves_flags`, `pure`, `raw`, or `readonly`, found `foo`\n   --> $DIR/parse-error.rs:35:33\n    |\n LL |         asm!(\"\", options(nomem, foo));\n-   |                                 ^^^ expected one of 9 possible tokens\n+   |                                 ^^^ expected one of 10 possible tokens\n \n error: arguments are not allowed after options\n   --> $DIR/parse-error.rs:37:31\n@@ -266,23 +266,23 @@ error: expected one of `,`, `.`, `?`, or an operator, found `FOO`\n LL | global_asm!(\"{}\", const(reg) FOO);\n    |                              ^^^ expected one of `,`, `.`, `?`, or an operator\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `FOO`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `FOO`\n   --> $DIR/parse-error.rs:102:25\n    |\n LL | global_asm!(\"\", options(FOO));\n-   |                         ^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/parse-error.rs:104:25\n    |\n LL | global_asm!(\"\", options(nomem FOO));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n-error: expected one of `)`, `att_syntax`, or `raw`, found `nomem`\n+error: expected one of `)`, `att_syntax`, `may_unwind`, or `raw`, found `nomem`\n   --> $DIR/parse-error.rs:106:25\n    |\n LL | global_asm!(\"\", options(nomem, FOO));\n-   |                         ^^^^^ expected one of `)`, `att_syntax`, or `raw`\n+   |                         ^^^^^ expected one of `)`, `att_syntax`, `may_unwind`, or `raw`\n \n error: arguments are not allowed after options\n   --> $DIR/parse-error.rs:108:30"}, {"sha": "0eba6633ee19b36650bd3ee15b863fa43dba4661", "filename": "src/tools/clippy/clippy_lints/src/redundant_clone.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940b2eabad13d7781316d077ea4b64d559242f50/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_clone.rs?ref=940b2eabad13d7781316d077ea4b64d559242f50", "patch": "@@ -15,7 +15,7 @@ use rustc_middle::mir::{\n     Mutability,\n };\n use rustc_middle::ty::{self, fold::TypeVisitor, Ty, TyCtxt};\n-use rustc_mir_dataflow::{Analysis, AnalysisDomain, GenKill, GenKillAnalysis, ResultsCursor};\n+use rustc_mir_dataflow::{Analysis, AnalysisDomain, CallReturnPlaces, GenKill, GenKillAnalysis, ResultsCursor};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::source_map::{BytePos, Span};\n use rustc_span::sym;\n@@ -499,11 +499,9 @@ impl<'tcx> GenKillAnalysis<'tcx> for MaybeStorageLive {\n \n     fn call_return_effect(\n         &self,\n-        _in_out: &mut impl GenKill<Self::Idx>,\n+        _trans: &mut impl GenKill<Self::Idx>,\n         _block: mir::BasicBlock,\n-        _func: &mir::Operand<'tcx>,\n-        _args: &[mir::Operand<'tcx>],\n-        _return_place: mir::Place<'tcx>,\n+        _return_places: CallReturnPlaces<'_, 'tcx>,\n     ) {\n         // Nothing to do when a call returns successfully\n     }"}]}