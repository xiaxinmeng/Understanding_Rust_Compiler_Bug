{"sha": "a80a610a4c30b6f5f60862afcb4588d03439f66c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4MGE2MTBhNGMzMGI2ZjVmNjA4NjJhZmNiNDU4OGQwMzQzOWY2NmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-07-09T04:42:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-07-09T04:42:27Z"}, "message": "Auto merge of #52166 - orlp:master, r=joshtriplett\n\nPerformance improvement of Vec's swap_remove.\n\nThe old implementation *literally* swapped and then removed, which resulted in unnecessary move instructions. The new implementation does use unsafe code, but is easy to see that it is correct.\n\nFixes https://github.com/rust-lang/rust/issues/52150.", "tree": {"sha": "bf310e3e568f661dc20086c8b216b0403252cdb5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf310e3e568f661dc20086c8b216b0403252cdb5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a80a610a4c30b6f5f60862afcb4588d03439f66c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a80a610a4c30b6f5f60862afcb4588d03439f66c", "html_url": "https://github.com/rust-lang/rust/commit/a80a610a4c30b6f5f60862afcb4588d03439f66c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a80a610a4c30b6f5f60862afcb4588d03439f66c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "960f6046c6d367a48f405dd5c76cc303497edfc5", "url": "https://api.github.com/repos/rust-lang/rust/commits/960f6046c6d367a48f405dd5c76cc303497edfc5", "html_url": "https://github.com/rust-lang/rust/commit/960f6046c6d367a48f405dd5c76cc303497edfc5"}, {"sha": "e529dfd590e6c7e0c19bbf0f3c72e34f25c0cfb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/e529dfd590e6c7e0c19bbf0f3c72e34f25c0cfb8", "html_url": "https://github.com/rust-lang/rust/commit/e529dfd590e6c7e0c19bbf0f3c72e34f25c0cfb8"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "5efe1e23309a7d7a84e96796149be522763511c9", "filename": "src/liballoc/vec.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a80a610a4c30b6f5f60862afcb4588d03439f66c/src%2Fliballoc%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a80a610a4c30b6f5f60862afcb4588d03439f66c/src%2Fliballoc%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fvec.rs?ref=a80a610a4c30b6f5f60862afcb4588d03439f66c", "patch": "@@ -809,9 +809,15 @@ impl<T> Vec<T> {\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     pub fn swap_remove(&mut self, index: usize) -> T {\n-        let length = self.len();\n-        self.swap(index, length - 1);\n-        self.pop().unwrap()\n+        unsafe {\n+            // We replace self[index] with the last element. Note that if the\n+            // bounds check on hole succeeds there must be a last element (which\n+            // can be self[index] itself).\n+            let hole: *mut T = &mut self[index];\n+            let last = ptr::read(self.get_unchecked(self.len - 1));\n+            self.len -= 1;\n+            ptr::replace(hole, last)\n+        }\n     }\n \n     /// Inserts an element at position `index` within the vector, shifting all"}]}