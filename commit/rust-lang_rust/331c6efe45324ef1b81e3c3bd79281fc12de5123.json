{"sha": "331c6efe45324ef1b81e3c3bd79281fc12de5123", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMWM2ZWZlNDUzMjRlZjFiODFlM2MzYmQ3OTI4MWZjMTJkZTUxMjM=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2013-12-12T05:05:26Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2013-12-12T05:07:45Z"}, "message": "Inline Finallyalizer::drop, allowing LLVM to optimize `finally`.\n* fixes the vec::from_elem regression caused by #8780\n* added 5 benchmarks for allocating a 1KB ~[u8] and zeroing it", "tree": {"sha": "f5d0a512224d7e90961f03ebf4419d03582dea22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5d0a512224d7e90961f03ebf4419d03582dea22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/331c6efe45324ef1b81e3c3bd79281fc12de5123", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/331c6efe45324ef1b81e3c3bd79281fc12de5123", "html_url": "https://github.com/rust-lang/rust/commit/331c6efe45324ef1b81e3c3bd79281fc12de5123", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/331c6efe45324ef1b81e3c3bd79281fc12de5123/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b12dca7f97a51c6cbb4f47ea6e095d841a97c1a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b12dca7f97a51c6cbb4f47ea6e095d841a97c1a", "html_url": "https://github.com/rust-lang/rust/commit/1b12dca7f97a51c6cbb4f47ea6e095d841a97c1a"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "6faf69d2bb98f4a8d03e2926c2a46433694e6770", "filename": "src/libstd/unstable/finally.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/331c6efe45324ef1b81e3c3bd79281fc12de5123/src%2Flibstd%2Funstable%2Ffinally.rs", "raw_url": "https://github.com/rust-lang/rust/raw/331c6efe45324ef1b81e3c3bd79281fc12de5123/src%2Flibstd%2Funstable%2Ffinally.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Ffinally.rs?ref=331c6efe45324ef1b81e3c3bd79281fc12de5123", "patch": "@@ -62,6 +62,7 @@ struct Finallyalizer<'a> {\n \n #[unsafe_destructor]\n impl<'a> Drop for Finallyalizer<'a> {\n+    #[inline]\n     fn drop(&mut self) {\n         (self.dtor)();\n     }"}, {"sha": "c31e3b5644432fa4fd8de61ab68e9d3c36877a31", "filename": "src/libstd/vec.rs", "status": "modified", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/331c6efe45324ef1b81e3c3bd79281fc12de5123/src%2Flibstd%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/331c6efe45324ef1b81e3c3bd79281fc12de5123/src%2Flibstd%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fvec.rs?ref=331c6efe45324ef1b81e3c3bd79281fc12de5123", "patch": "@@ -4217,6 +4217,7 @@ mod bench {\n     use vec;\n     use vec::VectorVector;\n     use option::*;\n+    use ptr;\n \n     #[bench]\n     fn iterator(bh: &mut BenchHarness) {\n@@ -4339,4 +4340,58 @@ mod bench {\n                 vec.contains(&99u);\n         })\n     }\n+\n+    #[bench]\n+    fn zero_1kb_from_elem(bh: &mut BenchHarness) {\n+        bh.iter(|| {\n+            let _v: ~[u8] = vec::from_elem(1024, 0u8);\n+        });\n+    }\n+\n+    #[bench]\n+    fn zero_1kb_set_memory(bh: &mut BenchHarness) {\n+        bh.iter(|| {\n+            let mut v: ~[u8] = vec::with_capacity(1024);\n+            unsafe {\n+                let vp = vec::raw::to_mut_ptr(v);\n+                ptr::set_memory(vp, 0, 1024);\n+                vec::raw::set_len(&mut v, 1024);\n+            }\n+        });\n+    }\n+\n+    #[bench]\n+    fn zero_1kb_fixed_repeat(bh: &mut BenchHarness) {\n+        bh.iter(|| {\n+            let _v: ~[u8] = ~[0u8, ..1024];\n+        });\n+    }\n+\n+    #[bench]\n+    fn zero_1kb_loop_set(bh: &mut BenchHarness) {\n+        // Slower because the { len, cap, [0 x T] }* repr allows a pointer to the length\n+        // field to be aliased (in theory) and prevents LLVM from optimizing loads away.\n+        bh.iter(|| {\n+            let mut v: ~[u8] = vec::with_capacity(1024);\n+            unsafe {\n+                vec::raw::set_len(&mut v, 1024);\n+            }\n+            for i in range(0, 1024) {\n+                v[i] = 0;\n+            }\n+        });\n+    }\n+\n+    #[bench]\n+    fn zero_1kb_mut_iter(bh: &mut BenchHarness) {\n+        bh.iter(|| {\n+            let mut v: ~[u8] = vec::with_capacity(1024);\n+            unsafe {\n+                vec::raw::set_len(&mut v, 1024);\n+            }\n+            for x in v.mut_iter() {\n+                *x = 0;\n+            }\n+        });\n+    }\n }"}]}