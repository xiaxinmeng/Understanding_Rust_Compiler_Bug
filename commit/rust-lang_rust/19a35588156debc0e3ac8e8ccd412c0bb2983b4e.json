{"sha": "19a35588156debc0e3ac8e8ccd412c0bb2983b4e", "node_id": "C_kwDOAAsO6NoAKDE5YTM1NTg4MTU2ZGViYzBlM2FjOGU4Y2NkNDEyYzBiYjI5ODNiNGU", "commit": {"author": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2022-05-17T17:10:55Z"}, "committer": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2022-05-17T17:10:55Z"}, "message": "Add PID to rustc PGO profiles generated in CI", "tree": {"sha": "a7ee1de10281e1c5727ecdfa5e445a9140068545", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7ee1de10281e1c5727ecdfa5e445a9140068545"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/19a35588156debc0e3ac8e8ccd412c0bb2983b4e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEzFQynJm4WzBnfhz8kJzQ0mSDUWsFAmKD1x8ACgkQkJzQ0mSD\nUWtzEQwAyIBpq/3VRM0A49pZQmwO/8mEjrCQqkNjsxvx0b5rynRhWoBxFpXlgd1g\nRLRCZtfqDPdxo7t190tPIHk7NK03AJhxahKEf9RMRVpUXyWPFsXuwfMiMP8QjTYF\nwveYRgsUX6pdXMKNba7534mRrTHSzNX+UGA2drweNHF281n380AAVQO4BH2Pw6Ny\nSJ3ojs7RpJmnH2aN1Z6URUh3nRxewlYPISBbW21eBKsHv97c4hExrcn/n/teikpd\niYJSr0AYHpDJ2JaIrsS/WB/zcUAQYWNYPTYI6AlQf+0n+0G89RIcw7k7NDlkQvOd\nrVm3XCzdLulQBBNxW/K0lZvTVQd7AbgorDCEnFg5bRkgvbY63I/SRbnfCa5HEWoW\n66AxKNOmJugQD5ny2FX+iJQDmh9n+FGdMcWnrSq+Qi4FEaJIGRK9LbA8+g681uDS\nsiJL6Eqv1CwcSnYjDClCGG29S2ke4h+EzAk3TdT4JrZdu/7AY3aZhweKv8Rui4x4\nbxB4DNJ0\n=2y11\n-----END PGP SIGNATURE-----", "payload": "tree a7ee1de10281e1c5727ecdfa5e445a9140068545\nparent 7355d971a954ed63293e4191f6677f60c1bc07d9\nauthor Jakub Ber\u00e1nek <berykubik@gmail.com> 1652807455 +0200\ncommitter Jakub Ber\u00e1nek <berykubik@gmail.com> 1652807455 +0200\n\nAdd PID to rustc PGO profiles generated in CI\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/19a35588156debc0e3ac8e8ccd412c0bb2983b4e", "html_url": "https://github.com/rust-lang/rust/commit/19a35588156debc0e3ac8e8ccd412c0bb2983b4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/19a35588156debc0e3ac8e8ccd412c0bb2983b4e/comments", "author": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7355d971a954ed63293e4191f6677f60c1bc07d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/7355d971a954ed63293e4191f6677f60c1bc07d9", "html_url": "https://github.com/rust-lang/rust/commit/7355d971a954ed63293e4191f6677f60c1bc07d9"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "aedfe98bdea11108b56ba30addbb780a2c89c5d4", "filename": "src/ci/pgo.sh", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/19a35588156debc0e3ac8e8ccd412c0bb2983b4e/src%2Fci%2Fpgo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/19a35588156debc0e3ac8e8ccd412c0bb2983b4e/src%2Fci%2Fpgo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpgo.sh?ref=19a35588156debc0e3ac8e8ccd412c0bb2983b4e", "patch": "@@ -82,7 +82,11 @@ python3 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n \n # Here we're profiling the `rustc` frontend, so we also include `Check`.\n # The benchmark set includes various stress tests that put the frontend under pressure.\n-gather_profiles \"Check,Debug,Opt\" \"All\" \\\n+# The profile data is written into a single filepath that is being repeatedly merged when each\n+# rustc invocation ends. Empirically, this can result in some profiling data being lost.\n+# That's why we override the profile path to include the PID. This will produce many more profiling\n+# files, but the resulting profile will produce a slightly faster rustc binary.\n+LLVM_PROFILE_FILE=/tmp/rustc-pgo/default_%m_%p.profraw gather_profiles \"Check,Debug,Opt\" \"All\" \\\n   \"externs,ctfe-stress-4,cargo-0.60.0,token-stream-stress,match-stress,tuple-stress\"\n \n # Merge the profile data we gathered"}]}