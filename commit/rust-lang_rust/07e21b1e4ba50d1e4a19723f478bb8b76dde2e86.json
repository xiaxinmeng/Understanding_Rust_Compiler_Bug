{"sha": "07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3ZTIxYjFlNGJhNTBkMWU0YTE5NzIzZjQ3OGJiOGI3NmRkZTJlODY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-08-31T21:03:56Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-09-10T12:22:31Z"}, "message": "add a test for variables used twice", "tree": {"sha": "54dd681421ce0c1d84b12a63907e981d9c84dbf8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54dd681421ce0c1d84b12a63907e981d9c84dbf8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "html_url": "https://github.com/rust-lang/rust/commit/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa52e12658720f3000fbd37129e475cbde793505", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa52e12658720f3000fbd37129e475cbde793505", "html_url": "https://github.com/rust-lang/rust/commit/aa52e12658720f3000fbd37129e475cbde793505"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "02b3006c5315c49158668d0f9b49f1abeef88d73", "filename": "src/test/ui/nll/relate_tys/var-appears-twice.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.rs?ref=07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "patch": "@@ -0,0 +1,38 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that the NLL `relate_tys` code correctly deduces that a\n+// function returning always its first argument can be upcast to one\n+// that returns either first or second argument.\n+\n+#![feature(nll)]\n+#![allow(warnings)]\n+\n+use std::cell::Cell;\n+\n+type DoubleCell<A> = Cell<(A, A)>;\n+type DoublePair<A> = (A, A);\n+\n+fn make_cell<'b>(x: &'b u32) -> Cell<(&'static u32, &'b u32)> {\n+    panic!()\n+}\n+\n+fn main() {\n+    let a: &'static u32 = &22;\n+    let b = 44;\n+\n+    // Here we get an error because `DoubleCell<_>` requires the same type\n+    // on both parts of the `Cell`, and we can't have that.\n+    let x: DoubleCell<_> = make_cell(&b); //~ ERROR\n+\n+    // Here we do not get an error because `DoublePair<_>` permits\n+    // variance on the lifetimes involved.\n+    let y: DoublePair<_> = make_cell(&b).get();\n+}"}, {"sha": "15c4cc2e100b511625582520edec60fd32a419a1", "filename": "src/test/ui/nll/relate_tys/var-appears-twice.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/07e21b1e4ba50d1e4a19723f478bb8b76dde2e86/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Frelate_tys%2Fvar-appears-twice.stderr?ref=07e21b1e4ba50d1e4a19723f478bb8b76dde2e86", "patch": "@@ -0,0 +1,14 @@\n+error[E0597]: `b` does not live long enough\n+  --> $DIR/var-appears-twice.rs:33:38\n+   |\n+LL |     let x: DoubleCell<_> = make_cell(&b); //~ ERROR\n+   |                                      ^^ borrowed value does not live long enough\n+...\n+LL | }\n+   | - `b` dropped here while still borrowed\n+   |\n+   = note: borrowed value must be valid for the static lifetime...\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0597`."}]}