{"sha": "d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "node_id": "C_kwDOAAsO6NoAKGQ4OGFlNjZlZDliNWU1YTMzYmQ1MTIxYTRkYjRmYTU5OWUyNzQxNzA", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-06-01T10:17:49Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-06-01T10:18:15Z"}, "message": "Sync handlers cannot be cancelled", "tree": {"sha": "099b6e02a48840b90dcd987179fe88152a020585", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/099b6e02a48840b90dcd987179fe88152a020585"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "html_url": "https://github.com/rust-lang/rust/commit/d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2da967578872756b81d32665dc85a5d9fe54f9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2da967578872756b81d32665dc85a5d9fe54f9c", "html_url": "https://github.com/rust-lang/rust/commit/e2da967578872756b81d32665dc85a5d9fe54f9c"}], "stats": {"total": 28, "additions": 9, "deletions": 19}, "files": [{"sha": "4d94630a56475b2234593b17acc255fa9890a285", "filename": "crates/rust-analyzer/src/dispatch.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Fdispatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Fdispatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fdispatch.rs?ref=d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "patch": "@@ -51,10 +51,9 @@ impl<'a> RequestDispatcher<'a> {\n             let _pctx = stdx::panic_context::enter(panic_context);\n             f(self.global_state, params)\n         };\n-        match result_to_response::<R>(req.id.clone(), result) {\n-            Ok(response) => self.global_state.respond(response),\n-            Err(_) => self.global_state.task_pool.handle.send_retry(req),\n-        };\n+        if let Ok(response) = result_to_response::<R>(req.id.clone(), result) {\n+            self.global_state.respond(response);\n+        }\n \n         self\n     }\n@@ -80,10 +79,9 @@ impl<'a> RequestDispatcher<'a> {\n             f(global_state_snapshot, params)\n         });\n \n-        match thread_result_to_response::<R>(req.id.clone(), result) {\n-            Ok(response) => self.global_state.respond(response),\n-            Err(_) => self.global_state.task_pool.handle.send_retry(req),\n-        };\n+        if let Ok(response) = thread_result_to_response::<R>(req.id.clone(), result) {\n+            self.global_state.respond(response);\n+        }\n \n         self\n     }"}, {"sha": "0fc5fd9dfa5e1d48e8a63246448d64ba3824cf86", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "patch": "@@ -173,13 +173,13 @@ impl GlobalState {\n                 msg.ok().map(Event::Lsp),\n \n             recv(self.task_pool.receiver) -> task =>\n-                task.ok().map(Event::Task),\n+                Some(Event::Task(task.unwrap())),\n \n             recv(self.loader.receiver) -> task =>\n-                task.ok().map(Event::Vfs),\n+                Some(Event::Vfs(task.unwrap())),\n \n             recv(self.flycheck_receiver) -> task =>\n-                task.ok().map(Event::Flycheck),\n+                Some(Event::Flycheck(task.unwrap())),\n         }\n     }\n "}, {"sha": "83389373903221fae63de9f15b88336076a759a4", "filename": "crates/rust-analyzer/src/task_pool.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Ftask_pool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d88ae66ed9b5e5a33bd5121a4db4fa599e274170/crates%2Frust-analyzer%2Fsrc%2Ftask_pool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Ftask_pool.rs?ref=d88ae66ed9b5e5a33bd5121a4db4fa599e274170", "patch": "@@ -2,8 +2,6 @@\n //! properly.\n use crossbeam_channel::Sender;\n \n-use crate::main_loop::Task;\n-\n pub(crate) struct TaskPool<T> {\n     sender: Sender<T>,\n     inner: threadpool::ThreadPool,\n@@ -46,9 +44,3 @@ impl<T> Drop for TaskPool<T> {\n         self.inner.join()\n     }\n }\n-\n-impl TaskPool<Task> {\n-    pub(crate) fn send_retry(&self, req: lsp_server::Request) {\n-        let _ = self.sender.send(Task::Retry(req));\n-    }\n-}"}]}