{"sha": "ce4b61003d8eb5383c4e759d919cdc72a137bc11", "node_id": "C_kwDOAAsO6NoAKGNlNGI2MTAwM2Q4ZWI1MzgzYzRlNzU5ZDkxOWNkYzcyYTEzN2JjMTE", "commit": {"author": {"name": "Vladimir Serov", "email": "me@cab404.ru", "date": "2022-03-12T21:26:36Z"}, "committer": {"name": "Vladimir Serov", "email": "me@cab404.ru", "date": "2022-03-12T21:38:41Z"}, "message": "editors/code: fix nixos detection\n\nProblem: NixOS started using quotes around it's id field in /etc/os-release\nSolution: Parially parsing os-release, and detecting, whether `nixos` appears anywhere in \"ID=\" field\\\nSee https://github.com/rust-analyzer/rust-analyzer/issues/11695\nCloses #11695", "tree": {"sha": "4290e85d509a3f2499c477369121c85ec80a8032", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4290e85d509a3f2499c477369121c85ec80a8032"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce4b61003d8eb5383c4e759d919cdc72a137bc11", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTV9cwcBrkXFFEK+wYIqpcR+M1AzwUCYi0S5QAKCRAIqpcR+M1A\nzzVPAQDas7r98/E/0fC45EfPFw3/xcz+zb7RLuE23bP796zMugEAgyUTn24von0J\nzP42MabXA0e7sVxJdpq8ZaHe4fs0YAU=\n=FLsI\n-----END PGP SIGNATURE-----", "payload": "tree 4290e85d509a3f2499c477369121c85ec80a8032\nparent 5fcf979f8a09e6504bbe540cbff6d640b959935c\nauthor Vladimir Serov <me@cab404.ru> 1647120396 +0300\ncommitter Vladimir Serov <me@cab404.ru> 1647121121 +0300\n\neditors/code: fix nixos detection\n\nProblem: NixOS started using quotes around it's id field in /etc/os-release\nSolution: Parially parsing os-release, and detecting, whether `nixos` appears anywhere in \"ID=\" field\\\nSee https://github.com/rust-analyzer/rust-analyzer/issues/11695\nCloses #11695\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce4b61003d8eb5383c4e759d919cdc72a137bc11", "html_url": "https://github.com/rust-lang/rust/commit/ce4b61003d8eb5383c4e759d919cdc72a137bc11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce4b61003d8eb5383c4e759d919cdc72a137bc11/comments", "author": {"login": "cab404", "id": 6453661, "node_id": "MDQ6VXNlcjY0NTM2NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/6453661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cab404", "html_url": "https://github.com/cab404", "followers_url": "https://api.github.com/users/cab404/followers", "following_url": "https://api.github.com/users/cab404/following{/other_user}", "gists_url": "https://api.github.com/users/cab404/gists{/gist_id}", "starred_url": "https://api.github.com/users/cab404/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cab404/subscriptions", "organizations_url": "https://api.github.com/users/cab404/orgs", "repos_url": "https://api.github.com/users/cab404/repos", "events_url": "https://api.github.com/users/cab404/events{/privacy}", "received_events_url": "https://api.github.com/users/cab404/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cab404", "id": 6453661, "node_id": "MDQ6VXNlcjY0NTM2NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/6453661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cab404", "html_url": "https://github.com/cab404", "followers_url": "https://api.github.com/users/cab404/followers", "following_url": "https://api.github.com/users/cab404/following{/other_user}", "gists_url": "https://api.github.com/users/cab404/gists{/gist_id}", "starred_url": "https://api.github.com/users/cab404/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cab404/subscriptions", "organizations_url": "https://api.github.com/users/cab404/orgs", "repos_url": "https://api.github.com/users/cab404/repos", "events_url": "https://api.github.com/users/cab404/events{/privacy}", "received_events_url": "https://api.github.com/users/cab404/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fcf979f8a09e6504bbe540cbff6d640b959935c", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fcf979f8a09e6504bbe540cbff6d640b959935c", "html_url": "https://github.com/rust-lang/rust/commit/5fcf979f8a09e6504bbe540cbff6d640b959935c"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "4856079f68a51846bdeaa45e581e2fb868a3aeff", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ce4b61003d8eb5383c4e759d919cdc72a137bc11/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/ce4b61003d8eb5383c4e759d919cdc72a137bc11/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=ce4b61003d8eb5383c4e759d919cdc72a137bc11", "patch": "@@ -269,7 +269,8 @@ function serverPath(config: Config): string | null {\n async function isNixOs(): Promise<boolean> {\n     try {\n         const contents = (await vscode.workspace.fs.readFile(vscode.Uri.file(\"/etc/os-release\"))).toString();\n-        return contents.indexOf(\"ID=nixos\") !== -1;\n+        const idString = contents.split('\\n').find((a) => a.startsWith(\"ID=\"));\n+        return idString?.toLowerCase()?.indexOf(\"nixos\") !== -1;\n     } catch {\n         return false;\n     }"}]}