{"sha": "44b5b838d2a58fb683324e2336a6766d450b0626", "node_id": "C_kwDOAAsO6NoAKDQ0YjViODM4ZDJhNThmYjY4MzMyNGUyMzM2YTY3NjZkNDUwYjA2MjY", "commit": {"author": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2021-11-17T00:58:52Z"}, "committer": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2021-11-28T06:31:25Z"}, "message": "Add test for const `MaybeUninit`", "tree": {"sha": "1b9a4a41dd70bf5cd18ce3ba5cf3c9b38b2a8344", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b9a4a41dd70bf5cd18ce3ba5cf3c9b38b2a8344"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44b5b838d2a58fb683324e2336a6766d450b0626", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTgxeqBxcDGar1sVhy4DhnkZitapAUCYaMiPQAKCRC4DhnkZita\npK9LAQDoup+uBaVndCMkN9txL8Z1GaCazosbn/re+4xMEixZmQD/cxZCpas64Hy8\nEUyrRcaAvECX1f/Cwa3VIDRDo07dPww=\n=79V1\n-----END PGP SIGNATURE-----", "payload": "tree 1b9a4a41dd70bf5cd18ce3ba5cf3c9b38b2a8344\nparent ad8e6bf5ccc60c558dc6ccedb548013d82f6aa8d\nauthor Jacob Pratt <jacob@jhpratt.dev> 1637110732 -0500\ncommitter Jacob Pratt <jacob@jhpratt.dev> 1638081085 -0500\n\nAdd test for const `MaybeUninit`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44b5b838d2a58fb683324e2336a6766d450b0626", "html_url": "https://github.com/rust-lang/rust/commit/44b5b838d2a58fb683324e2336a6766d450b0626", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44b5b838d2a58fb683324e2336a6766d450b0626/comments", "author": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad8e6bf5ccc60c558dc6ccedb548013d82f6aa8d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad8e6bf5ccc60c558dc6ccedb548013d82f6aa8d", "html_url": "https://github.com/rust-lang/rust/commit/ad8e6bf5ccc60c558dc6ccedb548013d82f6aa8d"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "00d0259321d13da0b5158bec8f8de17600235ced", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44b5b838d2a58fb683324e2336a6766d450b0626/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44b5b838d2a58fb683324e2336a6766d450b0626/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=44b5b838d2a58fb683324e2336a6766d450b0626", "patch": "@@ -10,6 +10,7 @@\n #![feature(const_assume)]\n #![feature(const_cell_into_inner)]\n #![feature(const_convert)]\n+#![feature(const_maybe_uninit_as_mut_ptr)]\n #![feature(const_maybe_uninit_assume_init)]\n #![feature(const_ptr_read)]\n #![feature(const_ptr_write)]"}, {"sha": "3b13dc0832fa4963905bc842c8518376c4744ed6", "filename": "library/core/tests/mem.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/44b5b838d2a58fb683324e2336a6766d450b0626/library%2Fcore%2Ftests%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44b5b838d2a58fb683324e2336a6766d450b0626/library%2Fcore%2Ftests%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fmem.rs?ref=44b5b838d2a58fb683324e2336a6766d450b0626", "patch": "@@ -269,3 +269,35 @@ fn uninit_const_assume_init_read() {\n     const FOO: u32 = unsafe { MaybeUninit::new(42).assume_init_read() };\n     assert_eq!(FOO, 42);\n }\n+\n+#[test]\n+fn const_maybe_uninit() {\n+    use std::ptr;\n+\n+    #[derive(Debug, PartialEq)]\n+    struct Foo {\n+        x: u8,\n+        y: u8,\n+    }\n+\n+    const FIELD_BY_FIELD: Foo = unsafe {\n+        let mut val = MaybeUninit::uninit();\n+        init_y(&mut val); // order shouldn't matter\n+        init_x(&mut val);\n+        val.assume_init()\n+    };\n+\n+    const fn init_x(foo: &mut MaybeUninit<Foo>) {\n+        unsafe {\n+            *ptr::addr_of_mut!((*foo.as_mut_ptr()).x) = 1;\n+        }\n+    }\n+\n+    const fn init_y(foo: &mut MaybeUninit<Foo>) {\n+        unsafe {\n+            *ptr::addr_of_mut!((*foo.as_mut_ptr()).y) = 2;\n+        }\n+    }\n+\n+    assert_eq!(FIELD_BY_FIELD, Foo { x: 1, y: 2 });\n+}"}]}