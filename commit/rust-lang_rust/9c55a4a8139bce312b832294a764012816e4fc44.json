{"sha": "9c55a4a8139bce312b832294a764012816e4fc44", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNTVhNGE4MTM5YmNlMzEyYjgzMjI5NGE3NjQwMTI4MTZlNGZjNDQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-26T10:25:11Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-26T15:06:44Z"}, "message": "Rollup merge of #55346 - nnethercote:shrink-StatementKind, r=nagisa\n\nShrink `Statement`.\n\nThis commit reduces the size of `Statement` from 80 bytes to 56 bytes on\n64-bit platforms, by boxing the `AscribeUserType` variant of\n`StatementKind`.\n\nThis change reduces instruction counts on most benchmarks by 1--3%.", "tree": {"sha": "24ecf2cbee9b5b30a74bcc5c9baa7c537eddf5c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/24ecf2cbee9b5b30a74bcc5c9baa7c537eddf5c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c55a4a8139bce312b832294a764012816e4fc44", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlvTLYUACgkQ/vbIBR0O\nATwGxw//eY6MeD+FiLYvSSuis9i4XVhfbFQrjz4GdOSmogUD3AePE+elUCyzjpwE\noQ9QPaWSPumMb2fD/ahlJEBYI2clNM324wHtkBxDwHrwzYNGSRgPLuaC8ugK5RlQ\na6v+sx07HgbPUBkI9cLQq4s5nq+IDv1bF2dyMC1KnjrOIzapFDTcqlCBYPcO6cSb\nDsXb9AJDqTGlRwZdJUVXzhlX31i588Vktx6Eajn9iiVlnWi82R0qgPs/rDPcCRDO\nQ4uIG9UkmpWxLyunFiYdHmyUUEvn1Po0MRN3YrE1xu7ypP5vNuoA4BNLXc/wevTP\nU44bfbQ5Els7uLlcBZRvgvIBfrXJKzfhpiCgghNIeNuWrwGPMZdRuvni2Ckkrlf8\n0Kjos5olMsF7HSiT8YBEydIILTme1o2X8+T4ipSAvGCgWfHvlzYHtX6SvjnFn1av\n2CiS7I/lkwnaI2teCg/BS7gHsr1N93AZUQiBKfIwL1HRwzY7KnKY1b4J+8uJnFts\nAgjnTwbPY0+1JlLXS0x1LPl/1QitqU8OlO+Lz05CQueoYuPuQFx/xFoiBnqiIA/n\nLqe2TsQsq7qk7MVt2lM/8USR8OFyRkKvR1hp1wB4KF+M0/NnOJ2ZAnoGFxm8Zi9e\nsssFerHVfllQp2fWd2UAy8d9SMyFptx3wkcgwOIaMUMZUhaj5WI=\n=k95b\n-----END PGP SIGNATURE-----", "payload": "tree 24ecf2cbee9b5b30a74bcc5c9baa7c537eddf5c5\nparent 2e1e8d29130fe5db2e8beceb7981a0197aaff772\nparent 38d9277a77e982e49df07725b62b21c423b6428e\nauthor kennytm <kennytm@gmail.com> 1540549511 +0800\ncommitter kennytm <kennytm@gmail.com> 1540566404 +0800\n\nRollup merge of #55346 - nnethercote:shrink-StatementKind, r=nagisa\n\nShrink `Statement`.\n\nThis commit reduces the size of `Statement` from 80 bytes to 56 bytes on\n64-bit platforms, by boxing the `AscribeUserType` variant of\n`StatementKind`.\n\nThis change reduces instruction counts on most benchmarks by 1--3%.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c55a4a8139bce312b832294a764012816e4fc44", "html_url": "https://github.com/rust-lang/rust/commit/9c55a4a8139bce312b832294a764012816e4fc44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c55a4a8139bce312b832294a764012816e4fc44/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e1e8d29130fe5db2e8beceb7981a0197aaff772", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e1e8d29130fe5db2e8beceb7981a0197aaff772", "html_url": "https://github.com/rust-lang/rust/commit/2e1e8d29130fe5db2e8beceb7981a0197aaff772"}, {"sha": "38d9277a77e982e49df07725b62b21c423b6428e", "url": "https://api.github.com/repos/rust-lang/rust/commits/38d9277a77e982e49df07725b62b21c423b6428e", "html_url": "https://github.com/rust-lang/rust/commit/38d9277a77e982e49df07725b62b21c423b6428e"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "7c3d4713572b9c6c0358b3930d69fcc977df17d6", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=9c55a4a8139bce312b832294a764012816e4fc44", "patch": "@@ -1674,6 +1674,10 @@ impl<'tcx> Statement<'tcx> {\n     /// Changes a statement to a nop. This is both faster than deleting instructions and avoids\n     /// invalidating statement indices in `Location`s.\n     pub fn make_nop(&mut self) {\n+        // `Statement` contributes significantly to peak memory usage. Make\n+        // sure it doesn't get bigger.\n+        static_assert!(STATEMENT_IS_AT_MOST_56_BYTES: mem::size_of::<Statement<'_>>() <= 56);\n+\n         self.kind = StatementKind::Nop\n     }\n \n@@ -1737,7 +1741,7 @@ pub enum StatementKind<'tcx> {\n     /// - `Contravariant` -- requires that `T_y :> T`\n     /// - `Invariant` -- requires that `T_y == T`\n     /// - `Bivariant` -- no effect\n-    AscribeUserType(Place<'tcx>, ty::Variance, UserTypeAnnotation<'tcx>),\n+    AscribeUserType(Place<'tcx>, ty::Variance, Box<UserTypeAnnotation<'tcx>>),\n \n     /// No-op. Useful for deleting instructions without affecting statement indices.\n     Nop,"}, {"sha": "ff4651dfb45cd650e6e59a7f7f6cda0f7447f534", "filename": "src/librustc_mir/borrow_check/nll/type_check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs?ref=9c55a4a8139bce312b832294a764012816e4fc44", "patch": "@@ -1225,7 +1225,7 @@ impl<'a, 'gcx, 'tcx> TypeChecker<'a, 'gcx, 'tcx> {\n                     );\n                 };\n             }\n-            StatementKind::AscribeUserType(ref place, variance, c_ty) => {\n+            StatementKind::AscribeUserType(ref place, variance, box c_ty) => {\n                 let place_ty = place.ty(mir, tcx).to_ty(tcx);\n                 if let Err(terr) = self.relate_type_and_user_type(\n                     place_ty,"}, {"sha": "8d6b6bb5c74f133b491e94181a2e3e4fc9a6ea9b", "filename": "src/librustc_mir/build/expr/as_place.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_place.rs?ref=9c55a4a8139bce312b832294a764012816e4fc44", "patch": "@@ -147,7 +147,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                             kind: StatementKind::AscribeUserType(\n                                 place.clone(),\n                                 Variance::Invariant,\n-                                user_ty,\n+                                box user_ty,\n                             ),\n                         },\n                     );\n@@ -167,7 +167,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                             kind: StatementKind::AscribeUserType(\n                                 Place::Local(temp.clone()),\n                                 Variance::Invariant,\n-                                user_ty,\n+                                box user_ty,\n                             ),\n                         },\n                     );"}, {"sha": "caacc9311c66ba2faa4daa65074abd5ab068aac4", "filename": "src/librustc_mir/build/matches/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fbuild%2Fmatches%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c55a4a8139bce312b832294a764012816e4fc44/src%2Flibrustc_mir%2Fbuild%2Fmatches%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmatches%2Fmod.rs?ref=9c55a4a8139bce312b832294a764012816e4fc44", "patch": "@@ -316,7 +316,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                         kind: StatementKind::AscribeUserType(\n                             place.clone(),\n                             ty::Variance::Invariant,\n-                            ascription_user_ty,\n+                            box ascription_user_ty,\n                         ),\n                     },\n                 );\n@@ -1323,7 +1323,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                     kind: StatementKind::AscribeUserType(\n                         ascription.source.clone(),\n                         ty::Variance::Covariant,\n-                        ascription.user_ty,\n+                        box ascription.user_ty,\n                     ),\n                 },\n             );"}]}