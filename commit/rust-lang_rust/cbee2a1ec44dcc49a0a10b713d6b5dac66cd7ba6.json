{"sha": "cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "node_id": "C_kwDOAAsO6NoAKGNiZWUyYTFlYzQ0ZGNjNDlhMGExMGI3MTNkNmI1ZGFjNjZjZDdiYTY", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-11-07T21:16:25Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2023-05-14T14:27:20Z"}, "message": "Add ui test to reproduce non-Send panic temporary", "tree": {"sha": "16381e32e2eda3df440624ad51ad3d207b3f967b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/16381e32e2eda3df440624ad51ad3d207b3f967b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmRg78gACgkQ+boUO5X/\nbYL/ERAAg0bTos3HelONN/SKJRLwY0KPGYzsoYCaUIRBq0KAw/+ruBi4fjdf9sEc\n0zyGEyPzQIwibjPpyHjwVb+uPyQiSs2LBbkhLvfI3n4ABCU3Q/kYv6PtsS7reIa9\nuL9K+53sEIwIV8UidD/K0rpRPpwR88+8/zT1RSqSNQ7A4B75ZU6KkgPQjQ+I7KPs\nNpcvkMe/N3DgMcU807ZHRXPLcqnSLVQOffon08Kbku3Wr5vwHA7SgGcQ9rw/yPIG\nZfJKVfG/4uEE/UesHRSrmjFH01Q9kqBmeciAT9OB1bAMew0yydaK0OXyaFEy39m9\nBe3e/oApKab9v9FniaUadR6n3WyAEtEnf21Hqa1No1+le8YKmnAQRETPJfSRwBX5\nWdxotfVblltqPne6rlrXgCbR4VgPSztZpk37dQfxrF92EJUFiYa7KUXO7IbWq4HW\n4giJ3Fi3HwcwZXjnPgmrZIcqx1LgI90dDD3S2VmcbGhrNVf1jZxqIie56SoDqQta\nPdcZ210vPXa1/ukFVDpvdkAQ+5KAiqgSz8yr2el3iDvmW9uxHIjIz3niutUYH8ze\nG/izDox/gVRhWH6gj3z/s+kHoydhEcgcba3fYr3gsjV2bVRM160dmwKBv54oJZ54\n8qTzAf2Lzrd802c0Q5ryD3wPaQ+zwUFuLO6DZ4MQRDE8AbT+fY4=\n=fRD+\n-----END PGP SIGNATURE-----", "payload": "tree 16381e32e2eda3df440624ad51ad3d207b3f967b\nparent 3603a84a3d74d0b70dbbdaa47ed8f8a306f3fe7f\nauthor David Tolnay <dtolnay@gmail.com> 1667855785 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1684074440 -0700\n\nAdd ui test to reproduce non-Send panic temporary\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "html_url": "https://github.com/rust-lang/rust/commit/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3603a84a3d74d0b70dbbdaa47ed8f8a306f3fe7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3603a84a3d74d0b70dbbdaa47ed8f8a306f3fe7f", "html_url": "https://github.com/rust-lang/rust/commit/3603a84a3d74d0b70dbbdaa47ed8f8a306f3fe7f"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "5ca139daf4ebf8ea1b7fe1f589911630b20c1a24", "filename": "tests/ui/macros/panic-temporaries.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6/tests%2Fui%2Fmacros%2Fpanic-temporaries.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6/tests%2Fui%2Fmacros%2Fpanic-temporaries.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmacros%2Fpanic-temporaries.rs?ref=cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "patch": "@@ -0,0 +1,19 @@\n+// check-fail\n+// edition:2021\n+\n+#![allow(unreachable_code)]\n+\n+async fn f(_: u8) {}\n+\n+async fn g() {\n+    // Todo returns `!`, so the await is never reached, and in particular the\n+    // temporaries inside the formatting machinery are not still alive at the\n+    // await point.\n+    f(todo!(\"...\")).await;\n+}\n+\n+fn require_send(_: impl Send) {}\n+\n+fn main() {\n+    require_send(g()); //~ future cannot be sent between threads safely\n+}"}, {"sha": "425409dda69384f222d3c1b6889f638eff796b98", "filename": "tests/ui/macros/panic-temporaries.stderr", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6/tests%2Fui%2Fmacros%2Fpanic-temporaries.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6/tests%2Fui%2Fmacros%2Fpanic-temporaries.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmacros%2Fpanic-temporaries.stderr?ref=cbee2a1ec44dcc49a0a10b713d6b5dac66cd7ba6", "patch": "@@ -0,0 +1,27 @@\n+error: future cannot be sent between threads safely\n+  --> $DIR/panic-temporaries.rs:18:18\n+   |\n+LL |     require_send(g());\n+   |                  ^^^ future returned by `g` is not `Send`\n+   |\n+   = help: the trait `Sync` is not implemented for `core::fmt::Opaque`\n+note: future is not `Send` as this value is used across an await\n+  --> $DIR/panic-temporaries.rs:12:20\n+   |\n+LL |     f(todo!(\"...\")).await;\n+   |       ------------ ^^^^^^ await occurs here, with `$crate::format_args!($($arg)+)` maybe used later\n+   |       |\n+   |       has type `ArgumentV1<'_>` which is not `Send`\n+note: `$crate::format_args!($($arg)+)` is later dropped here\n+  --> $DIR/panic-temporaries.rs:12:26\n+   |\n+LL |     f(todo!(\"...\")).await;\n+   |                          ^\n+note: required by a bound in `require_send`\n+  --> $DIR/panic-temporaries.rs:15:25\n+   |\n+LL | fn require_send(_: impl Send) {}\n+   |                         ^^^^ required by this bound in `require_send`\n+\n+error: aborting due to previous error\n+"}]}