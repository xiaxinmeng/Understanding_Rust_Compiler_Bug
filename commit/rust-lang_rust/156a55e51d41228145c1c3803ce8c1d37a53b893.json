{"sha": "156a55e51d41228145c1c3803ce8c1d37a53b893", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1NmE1NWU1MWQ0MTIyODE0NWMxYzM4MDNjZThjMWQzN2E1M2I4OTM=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-10-18T20:48:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-18T20:48:29Z"}, "message": "Rollup merge of #65511 - Xanewok:sa-nest-in-impls, r=pnkfelix\n\nsave-analysis: Nest tables when processing impl block definitions\n\nSimilar to #65353 (which this PR should've been a part of), however in this case we didn't previously nest the tables when processing trait paths in impl block declarations.\n\nCloses #65411", "tree": {"sha": "48bd9b5d5b0dabbf3451c4d5ef08ee3b104a4ca3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48bd9b5d5b0dabbf3451c4d5ef08ee3b104a4ca3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/156a55e51d41228145c1c3803ce8c1d37a53b893", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdqiUeCRBK7hj4Ov3rIwAAdHIIAExEu8FZPXBJsDNTzwNnbUhc\nd09wX7JeFrmtGX4SZJ7aABsucaMKQsJNMH4P8VyaoxP+R4P61ttX7hE+lrfFnpAh\nfT2T47oqqzXlBBuYZNz+JAwTgu8wQ3E09FHv4FVpt2jMNK23D+Llm9935NVxPoEB\nj/sIWqYopTfNGlhqiYSNVLf5vhPCwDv824IMfTb9nih8TrojNJn7ekcdzkycGKDx\nOXAvSOyHqcHgZZRMMHWgqwhVCE9KkdzK2VOf4ARcMz5rgCj8bBIZeqkHo8BRHjWq\nRL5lUtzUc4QNrJkT9/IwbMTtMfuu2pgkfCj0GwApDra1z2IDV41l/xhaqYChtgA=\n=dbtL\n-----END PGP SIGNATURE-----\n", "payload": "tree 48bd9b5d5b0dabbf3451c4d5ef08ee3b104a4ca3\nparent 9fc8d8eb458ec3ca1b2ee89aac59569365382a6e\nparent ad6ce4698641f57133ea75c379a928c6017b08cf\nauthor Tyler Mandry <tmandry@gmail.com> 1571431709 -0700\ncommitter GitHub <noreply@github.com> 1571431709 -0700\n\nRollup merge of #65511 - Xanewok:sa-nest-in-impls, r=pnkfelix\n\nsave-analysis: Nest tables when processing impl block definitions\n\nSimilar to #65353 (which this PR should've been a part of), however in this case we didn't previously nest the tables when processing trait paths in impl block declarations.\n\nCloses #65411\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/156a55e51d41228145c1c3803ce8c1d37a53b893", "html_url": "https://github.com/rust-lang/rust/commit/156a55e51d41228145c1c3803ce8c1d37a53b893", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/156a55e51d41228145c1c3803ce8c1d37a53b893/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fc8d8eb458ec3ca1b2ee89aac59569365382a6e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fc8d8eb458ec3ca1b2ee89aac59569365382a6e", "html_url": "https://github.com/rust-lang/rust/commit/9fc8d8eb458ec3ca1b2ee89aac59569365382a6e"}, {"sha": "ad6ce4698641f57133ea75c379a928c6017b08cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad6ce4698641f57133ea75c379a928c6017b08cf", "html_url": "https://github.com/rust-lang/rust/commit/ad6ce4698641f57133ea75c379a928c6017b08cf"}], "stats": {"total": 36, "additions": 27, "deletions": 9}, "files": [{"sha": "e282936b5d9e7e762938fc483af2dabddc0f315b", "filename": "src/librustc_save_analysis/dump_visitor.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/156a55e51d41228145c1c3803ce8c1d37a53b893/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/156a55e51d41228145c1c3803ce8c1d37a53b893/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fdump_visitor.rs?ref=156a55e51d41228145c1c3803ce8c1d37a53b893", "patch": "@@ -669,15 +669,18 @@ impl<'l, 'tcx> DumpVisitor<'l, 'tcx> {\n                 }\n             }\n         }\n-        self.visit_ty(&typ);\n-        if let &Some(ref trait_ref) = trait_ref {\n-            self.process_path(trait_ref.ref_id, &trait_ref.path);\n-        }\n-        self.process_generic_params(generics, \"\", item.id);\n-        for impl_item in impl_items {\n-            let map = &self.tcx.hir();\n-            self.process_impl_item(impl_item, map.local_def_id_from_node_id(item.id));\n-        }\n+\n+        let map = &self.tcx.hir();\n+        self.nest_tables(item.id, |v| {\n+            v.visit_ty(&typ);\n+            if let &Some(ref trait_ref) = trait_ref {\n+                v.process_path(trait_ref.ref_id, &trait_ref.path);\n+            }\n+            v.process_generic_params(generics, \"\", item.id);\n+            for impl_item in impl_items {\n+                v.process_impl_item(impl_item, map.local_def_id_from_node_id(item.id));\n+            }\n+        });\n     }\n \n     fn process_trait("}, {"sha": "9e58b8da5d2717c84ec07f3629065cc4aab31beb", "filename": "src/test/ui/save-analysis/issue-65411.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/156a55e51d41228145c1c3803ce8c1d37a53b893/src%2Ftest%2Fui%2Fsave-analysis%2Fissue-65411.rs", "raw_url": "https://github.com/rust-lang/rust/raw/156a55e51d41228145c1c3803ce8c1d37a53b893/src%2Ftest%2Fui%2Fsave-analysis%2Fissue-65411.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsave-analysis%2Fissue-65411.rs?ref=156a55e51d41228145c1c3803ce8c1d37a53b893", "patch": "@@ -0,0 +1,15 @@\n+// check-pass\n+// compile-flags: -Zsave-analysis\n+\n+trait Trait { type Assoc; }\n+trait GenericTrait<T> {}\n+struct Wrapper<B> { b: B }\n+\n+fn func() {\n+    // Processing associated path in impl block definition inside a function\n+    // body does not ICE\n+    impl<B: Trait> GenericTrait<B::Assoc> for Wrapper<B> {}\n+}\n+\n+\n+fn main() {}"}]}