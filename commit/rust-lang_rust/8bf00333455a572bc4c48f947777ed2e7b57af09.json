{"sha": "8bf00333455a572bc4c48f947777ed2e7b57af09", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiZjAwMzMzNDU1YTU3MmJjNGM0OGY5NDc3NzdlZDJlN2I1N2FmMDk=", "commit": {"author": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2013-06-20T12:45:10Z"}, "committer": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2013-06-23T10:49:16Z"}, "message": "Remove unused shape fields from typedescs", "tree": {"sha": "748036104d7346989912923749433d0b73fcef35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/748036104d7346989912923749433d0b73fcef35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8bf00333455a572bc4c48f947777ed2e7b57af09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8bf00333455a572bc4c48f947777ed2e7b57af09", "html_url": "https://github.com/rust-lang/rust/commit/8bf00333455a572bc4c48f947777ed2e7b57af09", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8bf00333455a572bc4c48f947777ed2e7b57af09/comments", "author": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "179ce398ea9e09920ace2264144422bb7e9efc02", "url": "https://api.github.com/repos/rust-lang/rust/commits/179ce398ea9e09920ace2264144422bb7e9efc02", "html_url": "https://github.com/rust-lang/rust/commit/179ce398ea9e09920ace2264144422bb7e9efc02"}], "stats": {"total": 38, "additions": 11, "deletions": 27}, "files": [{"sha": "8f15c74ed0ec28fcc9b1cc0141a85a1e0377a62e", "filename": "src/librustc/back/abi.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fback%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fback%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Fabi.rs?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -49,9 +49,7 @@ pub static tydesc_field_take_glue: uint = 2u;\n pub static tydesc_field_drop_glue: uint = 3u;\n pub static tydesc_field_free_glue: uint = 4u;\n pub static tydesc_field_visit_glue: uint = 5u;\n-pub static tydesc_field_shape: uint = 6u;\n-pub static tydesc_field_shape_tables: uint = 7u;\n-pub static n_tydesc_fields: uint = 8u;\n+pub static n_tydesc_fields: uint = 6u;\n \n // The two halves of a closure: code and environment.\n pub static fn_field_code: uint = 0u;"}, {"sha": "f9bffb4a36ec64abc5e4381c08a6af7fb4074525", "filename": "src/librustc/middle/trans/glue.rs", "status": "modified", "additions": 6, "deletions": 12, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -765,19 +765,13 @@ pub fn emit_tydescs(ccx: &mut CrateContext) {\n               }\n             };\n \n-\n-        let shape = C_null(Type::i8p());\n-        let shape_tables = C_null(Type::i8p());\n-\n         let tydesc = C_named_struct(ccx.tydesc_type,\n-                           [ti.size, // size\n-                            ti.align, // align\n-                            take_glue, // take_glue\n-                            drop_glue, // drop_glue\n-                            free_glue, // free_glue\n-                            visit_glue, // visit_glue\n-                            shape, // shape\n-                            shape_tables]); // shape_tables\n+                                    [ti.size, // size\n+                                    ti.align, // align\n+                                    take_glue, // take_glue\n+                                    drop_glue, // drop_glue\n+                                    free_glue, // free_glue\n+                                    visit_glue]); // visit_glue\n \n         unsafe {\n             let gvar = ti.tydesc;"}, {"sha": "fda8fb4a90169839833c9fd1790c953da6d90d16", "filename": "src/librustc/middle/trans/type_.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -211,8 +211,7 @@ impl Type {\n \n         let elems = [\n             int_ty, int_ty,\n-            glue_fn_ty, glue_fn_ty, glue_fn_ty, glue_fn_ty,\n-            pvoid, pvoid\n+            glue_fn_ty, glue_fn_ty, glue_fn_ty, glue_fn_ty\n         ];\n \n         tydesc.set_struct_body(elems, false);"}, {"sha": "84bb2a952f2d1bdfa69b47d6e0eb7730337dab96", "filename": "src/libstd/unstable/intrinsics.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibstd%2Funstable%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Flibstd%2Funstable%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fintrinsics.rs?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -48,8 +48,6 @@ pub struct TyDesc {\n     drop_glue: GlueFn,\n     free_glue: GlueFn,\n     visit_glue: GlueFn,\n-    shape: *i8,\n-    shape_tables: *i8\n }\n \n #[lang=\"opaque\"]"}, {"sha": "1a84325c7a9397318b94e946c16a4b4f5fb144d7", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -732,10 +732,9 @@ rust_task_deref(rust_task *task) {\n // Must call on rust stack.\n extern \"C\" CDECL void\n rust_call_tydesc_glue(void *root, size_t *tydesc, size_t glue_index) {\n-    void (*glue_fn)(void *, void *, void *) =\n-        (void (*)(void *, void *, void *))tydesc[glue_index];\n-    if (glue_fn)\n-        glue_fn(0, 0, root);\n+    glue_fn *fn = (glue_fn*) tydesc[glue_index];\n+    if (fn)\n+        fn(0, 0, root);\n }\n \n // Don't run on the Rust stack!"}, {"sha": "70b5c1dc6bea9e9c5219867dcda45ecf057bac5b", "filename": "src/rt/rust_type.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_type.h", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_type.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_type.h?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -57,8 +57,6 @@ struct type_desc {\n     glue_fn *drop_glue;\n     glue_fn *free_glue;\n     glue_fn *visit_glue;\n-    const uint8_t *unused;\n-    const uint8_t *unused2;\n };\n \n extern \"C\" type_desc *rust_clone_type_desc(type_desc*);"}, {"sha": "4a15830e529a0fb59ce4262cb5a60cfd9248fbdb", "filename": "src/rt/rust_util.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_util.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/8bf00333455a572bc4c48f947777ed2e7b57af09/src%2Frt%2Frust_util.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_util.cpp?ref=8bf00333455a572bc4c48f947777ed2e7b57af09", "patch": "@@ -21,8 +21,6 @@ struct type_desc str_body_tydesc = {\n     NULL, // drop_glue\n     NULL, // free_glue\n     NULL, // visit_glue\n-    NULL, // shape\n-    NULL, // shape_tables\n };\n \n //"}]}