{"sha": "6cb34cf08f4d5d791801f032607a7752489bffbe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjYjM0Y2YwOGY0ZDVkNzkxODAxZjAzMjYwN2E3NzUyNDg5YmZmYmU=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-03-03T20:46:24Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-03-03T21:05:18Z"}, "message": "std: add reserve_additional and an Extendable impl to Vec.", "tree": {"sha": "b1915bf8225758fb03f1a393228c0b12a2d4d292", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1915bf8225758fb03f1a393228c0b12a2d4d292"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6cb34cf08f4d5d791801f032607a7752489bffbe", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6cb34cf08f4d5d791801f032607a7752489bffbe", "html_url": "https://github.com/rust-lang/rust/commit/6cb34cf08f4d5d791801f032607a7752489bffbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6cb34cf08f4d5d791801f032607a7752489bffbe/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e7f170fedd3c526a643c0b2d13863acd982be02", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e7f170fedd3c526a643c0b2d13863acd982be02", "html_url": "https://github.com/rust-lang/rust/commit/6e7f170fedd3c526a643c0b2d13863acd982be02"}], "stats": {"total": 68, "additions": 66, "deletions": 2}, "files": [{"sha": "225bfc25d8830fd3624ff636c4dc7ce6fcd90d3b", "filename": "src/libstd/vec_ng.rs", "status": "modified", "additions": 66, "deletions": 2, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/6cb34cf08f4d5d791801f032607a7752489bffbe/src%2Flibstd%2Fvec_ng.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6cb34cf08f4d5d791801f032607a7752489bffbe/src%2Flibstd%2Fvec_ng.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fvec_ng.rs?ref=6cb34cf08f4d5d791801f032607a7752489bffbe", "patch": "@@ -17,11 +17,11 @@ use cmp::{Eq, Ordering, TotalEq, TotalOrd};\n use container::Container;\n use default::Default;\n use fmt;\n-use iter::{DoubleEndedIterator, FromIterator, Iterator};\n+use iter::{DoubleEndedIterator, FromIterator, Extendable, Iterator};\n use libc::{free, c_void};\n use mem::{size_of, move_val_init};\n use num;\n-use num::CheckedMul;\n+use num::{CheckedMul, CheckedAdd};\n use ops::Drop;\n use option::{None, Option, Some};\n use ptr::RawPtr;\n@@ -126,6 +126,16 @@ impl<T> FromIterator<T> for Vec<T> {\n     }\n }\n \n+impl<T> Extendable<T> for Vec<T> {\n+    fn extend<I: Iterator<T>>(&mut self, iterator: &mut I) {\n+        let (lower, _) = iterator.size_hint();\n+        self.reserve_additional(lower);\n+        for element in *iterator {\n+            self.push(element)\n+        }\n+    }\n+}\n+\n impl<T:Eq> Eq for Vec<T> {\n     #[inline]\n     fn eq(&self, other: &Vec<T>) -> bool {\n@@ -160,6 +170,15 @@ impl<T> Vec<T> {\n         self.cap\n     }\n \n+    pub fn reserve_additional(&mut self, extra: uint) {\n+        if self.cap - self.len < extra {\n+            match self.len.checked_add(&extra) {\n+                None => fail!(\"Vec::reserve_additional: `uint` overflow\"),\n+                Some(new_cap) => self.reserve(new_cap)\n+            }\n+        }\n+    }\n+\n     pub fn reserve(&mut self, capacity: uint) {\n         if capacity >= self.len {\n             self.reserve_exact(num::next_power_of_two(capacity))\n@@ -453,3 +472,48 @@ impl<T> Drop for MoveItems<T> {\n         }\n     }\n }\n+\n+#[cfg(test)]\n+mod tests {\n+    use super::Vec;\n+    use iter::{Iterator, range, Extendable};\n+    use option::{Some, None};\n+\n+    #[test]\n+    fn test_reserve_additional() {\n+        let mut v = Vec::new();\n+        assert_eq!(v.capacity(), 0);\n+\n+        v.reserve_additional(2);\n+        assert!(v.capacity() >= 2);\n+\n+        for i in range(0, 16) {\n+            v.push(i);\n+        }\n+\n+        assert!(v.capacity() >= 16);\n+        v.reserve_additional(16);\n+        assert!(v.capacity() >= 32);\n+\n+        v.push(16);\n+\n+        v.reserve_additional(16);\n+        assert!(v.capacity() >= 33)\n+    }\n+\n+    #[test]\n+    fn test_extend() {\n+        let mut v = Vec::new();\n+        let mut w = Vec::new();\n+\n+        v.extend(&mut range(0, 3));\n+        for i in range(0, 3) { w.push(i) }\n+\n+        assert_eq!(v, w);\n+\n+        v.extend(&mut range(3, 10));\n+        for i in range(3, 10) { w.push(i) }\n+\n+        assert_eq!(v, w);\n+    }\n+}"}]}