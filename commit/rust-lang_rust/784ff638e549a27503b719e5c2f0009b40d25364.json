{"sha": "784ff638e549a27503b719e5c2f0009b40d25364", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4NGZmNjM4ZTU0OWEyNzUwM2I3MTllNWMyZjAwMDliNDBkMjUzNjQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-14T13:16:21Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-14T13:16:21Z"}, "message": "Merge #538\n\n538: update cargo_metadata r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "f32f55787771aef45c4a5ab40e5f707904ae1c3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f32f55787771aef45c4a5ab40e5f707904ae1c3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/784ff638e549a27503b719e5c2f0009b40d25364", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/784ff638e549a27503b719e5c2f0009b40d25364", "html_url": "https://github.com/rust-lang/rust/commit/784ff638e549a27503b719e5c2f0009b40d25364", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/784ff638e549a27503b719e5c2f0009b40d25364/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "8caff4e03475c20392f13e8c6ad469bd01a4b4ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/8caff4e03475c20392f13e8c6ad469bd01a4b4ce", "html_url": "https://github.com/rust-lang/rust/commit/8caff4e03475c20392f13e8c6ad469bd01a4b4ce"}, {"sha": "db43b44f71818df4d6cc100969d21a65d3ce2645", "url": "https://api.github.com/repos/rust-lang/rust/commits/db43b44f71818df4d6cc100969d21a65d3ce2645", "html_url": "https://github.com/rust-lang/rust/commit/db43b44f71818df4d6cc100969d21a65d3ce2645"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "04e947f62827f4893ba190ddfff7d1367d9e0fc6", "filename": "Cargo.lock", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/784ff638e549a27503b719e5c2f0009b40d25364/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/784ff638e549a27503b719e5c2f0009b40d25364/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=784ff638e549a27503b719e5c2f0009b40d25364", "patch": "@@ -111,8 +111,8 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"cargo_metadata\"\n-version = \"0.6.4\"\n-source = \"git+https://github.com/oli-obk/cargo_metadata.git?rev=f73e27b24e#f73e27b24e92cd9b520a78497cd1017b70a6c99a\"\n+version = \"0.7.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"error-chain 0.12.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -722,7 +722,7 @@ dependencies = [\n name = \"ra_lsp_server\"\n version = \"0.1.0\"\n dependencies = [\n- \"cargo_metadata 0.6.4 (git+https://github.com/oli-obk/cargo_metadata.git?rev=f73e27b24e)\",\n+ \"cargo_metadata 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"crossbeam-channel 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"drop_bomb 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1489,7 +1489,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum block-buffer 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a076c298b9ecdb530ed9d967e74a6027d6a7478924520acddcddc24c1c8ab3ab\"\n \"checksum byte-tools 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"560c32574a12a89ecd91f5e742165893f86e3ab98d21f8ea548658eb9eef5f40\"\n \"checksum byteorder 1.2.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"94f88df23a25417badc922ab0f5716cc1330e87f71ddd9203b3a3ccd9cedf75d\"\n-\"checksum cargo_metadata 0.6.4 (git+https://github.com/oli-obk/cargo_metadata.git?rev=f73e27b24e)\" = \"<none>\"\n+\"checksum cargo_metadata 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"95932a7ed5f2308fc00a46d2aa8eb1b06b402c896c2df424916ee730ba610c2e\"\n \"checksum cc 1.0.28 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb4a8b715cb4597106ea87c7c84b2f1d452c7492033765df7f32651e66fcf749\"\n \"checksum cfg-if 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"082bb9b28e00d3c9d39cc03e64ce4cea0f1bb9b3fde493f0cbc008472d22bdf4\"\n \"checksum chrono 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"45912881121cb26fad7c38c17ba7daa18764771836b34fab7d3fbd93ed633878\""}, {"sha": "59ce6b23d7892823ea6933d8f5975a75eb6adfbe", "filename": "Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/784ff638e549a27503b719e5c2f0009b40d25364/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/784ff638e549a27503b719e5c2f0009b40d25364/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=784ff638e549a27503b719e5c2f0009b40d25364", "patch": "@@ -6,5 +6,4 @@ incremental = true\n debug = true\n \n [patch.'crates-io']\n-cargo_metadata = { git = \"https://github.com/oli-obk/cargo_metadata.git\", rev=\"f73e27b24e\" }\n salsa = { git = \"https://github.com/matklad/salsa\", branch = \"panic-hooks\" }"}, {"sha": "e87d311ebb37a4b388479427f087ed0543f504aa", "filename": "crates/ra_lsp_server/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/784ff638e549a27503b719e5c2f0009b40d25364/crates%2Fra_lsp_server%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/784ff638e549a27503b719e5c2f0009b40d25364/crates%2Fra_lsp_server%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2FCargo.toml?ref=784ff638e549a27503b719e5c2f0009b40d25364", "patch": "@@ -20,7 +20,7 @@ url_serde = \"0.2.0\"\n lsp-types = \"0.54.0\"\n walkdir = \"2.2.7\"\n im = \"12.0.0\"\n-cargo_metadata = \"0.6.0\"\n+cargo_metadata = \"0.7.0\"\n rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n "}, {"sha": "75ae78bca709a856a8269abd2c0f7f0ccce3db9d", "filename": "crates/ra_lsp_server/src/project_model/cargo_workspace.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/784ff638e549a27503b719e5c2f0009b40d25364/crates%2Fra_lsp_server%2Fsrc%2Fproject_model%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/784ff638e549a27503b719e5c2f0009b40d25364/crates%2Fra_lsp_server%2Fsrc%2Fproject_model%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fproject_model%2Fcargo_workspace.rs?ref=784ff638e549a27503b719e5c2f0009b40d25364", "patch": "@@ -1,6 +1,6 @@\n use std::path::{Path, PathBuf};\n \n-use cargo_metadata::{metadata_run, CargoOpt};\n+use cargo_metadata::{MetadataCommand, CargoOpt};\n use ra_syntax::SmolStr;\n use ra_arena::{Arena, RawId, impl_arena_id};\n use rustc_hash::FxHashMap;\n@@ -117,7 +117,10 @@ impl Target {\n \n impl CargoWorkspace {\n     pub fn from_cargo_metadata(cargo_toml: &Path) -> Result<CargoWorkspace> {\n-        let meta = metadata_run(Some(cargo_toml), true, Some(CargoOpt::AllFeatures))\n+        let meta = MetadataCommand::new()\n+            .manifest_path(cargo_toml)\n+            .features(CargoOpt::AllFeatures)\n+            .exec()\n             .map_err(|e| format_err!(\"cargo metadata failed: {}\", e))?;\n         let mut pkg_by_id = FxHashMap::default();\n         let mut packages = Arena::default();"}]}