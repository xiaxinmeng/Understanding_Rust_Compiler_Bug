{"sha": "96c5df9b171730ad69e130e074584684cee35014", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2YzVkZjliMTcxNzMwYWQ2OWUxMzBlMDc0NTg0Njg0Y2VlMzUwMTQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-05-08T17:03:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-08T17:03:58Z"}, "message": "Merge #8769\n\n8769: internal: removed dead code r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "5842da856c8935e42c6a78a1d1e95864e94bf928", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5842da856c8935e42c6a78a1d1e95864e94bf928"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96c5df9b171730ad69e130e074584684cee35014", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJglsR+CRBK7hj4Ov3rIwAACSwIAHPClMzJhKMtcpghiW7uW1I0\nR9pvqGJSfIJAYA6FSMouXlP2iH/pn9nVrkxuvl0ujINHXm/Ihs29ly6VO0wqe4BC\ngAJ9yLflBwXGWEgrZ0ZK2izoY/qhFWMSFPzEK5X2KWZg169pBt7Cv7iuMFfhAkdN\nVvPSrULrd2cMsOYCHI4lPoIk918JlakIMSqIf9QR5M6AlkDVxWieElMZFZm5SKDl\nIR1UqBFR46UoSa7Dknhl2KwgBlNq6jswL4H96p/fU0l8KPtvQ7LvpIt6cErdrcos\nZFC58BiOEumuUeAe9vyaz4nYljSIi72dKNDHITO31JA4LdqQLlsE/JXLT827vlM=\n=3w+l\n-----END PGP SIGNATURE-----\n", "payload": "tree 5842da856c8935e42c6a78a1d1e95864e94bf928\nparent 18d026a2a638a8c835e321fc8c29149d13a828ec\nparent 880ddddfe6937c11059e9673050ea8c4ed40ff5b\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1620493438 +0000\ncommitter GitHub <noreply@github.com> 1620493438 +0000\n\nMerge #8769\n\n8769: internal: removed dead code r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96c5df9b171730ad69e130e074584684cee35014", "html_url": "https://github.com/rust-lang/rust/commit/96c5df9b171730ad69e130e074584684cee35014", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96c5df9b171730ad69e130e074584684cee35014/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18d026a2a638a8c835e321fc8c29149d13a828ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/18d026a2a638a8c835e321fc8c29149d13a828ec", "html_url": "https://github.com/rust-lang/rust/commit/18d026a2a638a8c835e321fc8c29149d13a828ec"}, {"sha": "880ddddfe6937c11059e9673050ea8c4ed40ff5b", "url": "https://api.github.com/repos/rust-lang/rust/commits/880ddddfe6937c11059e9673050ea8c4ed40ff5b", "html_url": "https://github.com/rust-lang/rust/commit/880ddddfe6937c11059e9673050ea8c4ed40ff5b"}], "stats": {"total": 129, "additions": 8, "deletions": 121}, "files": [{"sha": "cf3013c08050a430ddab26e7c64ff4f1d8cee0ad", "filename": "Cargo.toml", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96c5df9b171730ad69e130e074584684cee35014/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/96c5df9b171730ad69e130e074584684cee35014/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=96c5df9b171730ad69e130e074584684cee35014", "patch": "@@ -2,6 +2,10 @@\n members = [\"xtask/\", \"lib/*\", \"crates/*\"]\n \n [profile.dev]\n+# We do want incremental builds, but they are broken at the moment :(\n+# https://github.com/rust-lang/rust/issues/85003#issuecomment-833796289\n+incremental = false\n+\n # Disabling debug info speeds up builds a bunch,\n # and we don't rely on it for debugging that much.\n debug = 0\n@@ -21,6 +25,9 @@ miniz_oxide.opt-level = 3\n incremental = false\n debug = 0 # Set this to 1 or 2 to get more useful backtraces in debugger.\n \n+[profile.test]\n+incremental = false\n+\n [patch.'crates-io']\n # rowan = { path = \"../rowan\" }\n "}, {"sha": "3f9b84ab90f85f03daef85fe5f7997cc0f23c1fa", "filename": "crates/syntax/src/algo.rs", "status": "modified", "additions": 1, "deletions": 121, "changes": 122, "blob_url": "https://github.com/rust-lang/rust/blob/96c5df9b171730ad69e130e074584684cee35014/crates%2Fsyntax%2Fsrc%2Falgo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96c5df9b171730ad69e130e074584684cee35014/crates%2Fsyntax%2Fsrc%2Falgo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Falgo.rs?ref=96c5df9b171730ad69e130e074584684cee35014", "patch": "@@ -1,10 +1,6 @@\n //! FIXME: write short doc here\n \n-use std::{\n-    fmt,\n-    hash::BuildHasherDefault,\n-    ops::{self, RangeInclusive},\n-};\n+use std::{fmt, hash::BuildHasherDefault, ops::RangeInclusive};\n \n use indexmap::IndexMap;\n use itertools::Itertools;\n@@ -358,107 +354,11 @@ impl fmt::Debug for SyntaxRewriter<'_> {\n }\n \n impl SyntaxRewriter<'_> {\n-    pub fn delete<T: Clone + Into<SyntaxElement>>(&mut self, what: &T) {\n-        let what = what.clone().into();\n-        let replacement = Replacement::Delete;\n-        self.replacements.insert(what, replacement);\n-    }\n-    pub fn insert_before<T: Clone + Into<SyntaxElement>, U: Clone + Into<SyntaxElement>>(\n-        &mut self,\n-        before: &T,\n-        what: &U,\n-    ) {\n-        let before = before.clone().into();\n-        let pos = match before.prev_sibling_or_token() {\n-            Some(sibling) => InsertPos::After(sibling),\n-            None => match before.parent() {\n-                Some(parent) => InsertPos::FirstChildOf(parent),\n-                None => return,\n-            },\n-        };\n-        self.insertions.entry(pos).or_insert_with(Vec::new).push(what.clone().into());\n-    }\n-    pub fn insert_after<T: Clone + Into<SyntaxElement>, U: Clone + Into<SyntaxElement>>(\n-        &mut self,\n-        after: &T,\n-        what: &U,\n-    ) {\n-        self.insertions\n-            .entry(InsertPos::After(after.clone().into()))\n-            .or_insert_with(Vec::new)\n-            .push(what.clone().into());\n-    }\n-    pub fn insert_as_first_child<T: Clone + Into<SyntaxNode>, U: Clone + Into<SyntaxElement>>(\n-        &mut self,\n-        parent: &T,\n-        what: &U,\n-    ) {\n-        self.insertions\n-            .entry(InsertPos::FirstChildOf(parent.clone().into()))\n-            .or_insert_with(Vec::new)\n-            .push(what.clone().into());\n-    }\n-    pub fn insert_many_before<\n-        T: Clone + Into<SyntaxElement>,\n-        U: IntoIterator<Item = SyntaxElement>,\n-    >(\n-        &mut self,\n-        before: &T,\n-        what: U,\n-    ) {\n-        let before = before.clone().into();\n-        let pos = match before.prev_sibling_or_token() {\n-            Some(sibling) => InsertPos::After(sibling),\n-            None => match before.parent() {\n-                Some(parent) => InsertPos::FirstChildOf(parent),\n-                None => return,\n-            },\n-        };\n-        self.insertions.entry(pos).or_insert_with(Vec::new).extend(what);\n-    }\n-    pub fn insert_many_after<\n-        T: Clone + Into<SyntaxElement>,\n-        U: IntoIterator<Item = SyntaxElement>,\n-    >(\n-        &mut self,\n-        after: &T,\n-        what: U,\n-    ) {\n-        self.insertions\n-            .entry(InsertPos::After(after.clone().into()))\n-            .or_insert_with(Vec::new)\n-            .extend(what);\n-    }\n-    pub fn insert_many_as_first_children<\n-        T: Clone + Into<SyntaxNode>,\n-        U: IntoIterator<Item = SyntaxElement>,\n-    >(\n-        &mut self,\n-        parent: &T,\n-        what: U,\n-    ) {\n-        self.insertions\n-            .entry(InsertPos::FirstChildOf(parent.clone().into()))\n-            .or_insert_with(Vec::new)\n-            .extend(what)\n-    }\n     pub fn replace<T: Clone + Into<SyntaxElement>>(&mut self, what: &T, with: &T) {\n         let what = what.clone().into();\n         let replacement = Replacement::Single(with.clone().into());\n         self.replacements.insert(what, replacement);\n     }\n-    pub fn replace_with_many<T: Clone + Into<SyntaxElement>>(\n-        &mut self,\n-        what: &T,\n-        with: Vec<SyntaxElement>,\n-    ) {\n-        let what = what.clone().into();\n-        let replacement = Replacement::Many(with);\n-        self.replacements.insert(what, replacement);\n-    }\n-    pub fn replace_ast<T: AstNode>(&mut self, what: &T, with: &T) {\n-        self.replace(what.syntax(), with.syntax())\n-    }\n \n     pub fn rewrite(&self, node: &SyntaxNode) -> SyntaxNode {\n         let _p = profile::span(\"rewrite\");\n@@ -534,10 +434,6 @@ impl SyntaxRewriter<'_> {\n         if let Some(replacement) = self.replacement(&element) {\n             match replacement {\n                 Replacement::Single(element) => acc.push(element_to_green(element)),\n-                Replacement::Many(replacements) => {\n-                    acc.extend(replacements.into_iter().map(element_to_green))\n-                }\n-                Replacement::Delete => (),\n             };\n         } else {\n             match element {\n@@ -560,25 +456,9 @@ fn element_to_green(element: SyntaxElement) -> NodeOrToken<rowan::GreenNode, row\n     }\n }\n \n-impl ops::AddAssign for SyntaxRewriter<'_> {\n-    fn add_assign(&mut self, rhs: SyntaxRewriter) {\n-        self.replacements.extend(rhs.replacements);\n-        for (pos, insertions) in rhs.insertions.into_iter() {\n-            match self.insertions.entry(pos) {\n-                indexmap::map::Entry::Occupied(mut occupied) => {\n-                    occupied.get_mut().extend(insertions)\n-                }\n-                indexmap::map::Entry::Vacant(vacant) => drop(vacant.insert(insertions)),\n-            }\n-        }\n-    }\n-}\n-\n #[derive(Clone, Debug)]\n enum Replacement {\n-    Delete,\n     Single(SyntaxElement),\n-    Many(Vec<SyntaxElement>),\n }\n \n fn with_children("}]}