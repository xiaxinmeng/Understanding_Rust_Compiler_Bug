{"sha": "dfdea56e99e864d43206643b85190cb15127cfb9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmZGVhNTZlOTllODY0ZDQzMjA2NjQzYjg1MTkwY2IxNTEyN2NmYjk=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-01-26T14:40:53Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-12T08:34:27Z"}, "message": "Extract deployment", "tree": {"sha": "6e70bf0d481a8e8c0505f10d8715d64429058aa2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e70bf0d481a8e8c0505f10d8715d64429058aa2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dfdea56e99e864d43206643b85190cb15127cfb9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl5DuJMACgkQaTCGhp1Q\nZjepyw//eO7OhVN2I9bOo1uhbiuP+Rvqvq8G1ZzMZJr4UlOJ0vfU2lBL3/o4UhCu\nmRC+2hGKZanXVcc7FXM0520bStqg3g9Y4q01BndRaFJwIi4JzFRWnTP9TncDSDZd\neWPT9YVh3nh0gZgDWiy1IhuhSuk7Je6N5DdLCwQOdyIx/oBofBWSJrB1oQDsnFcp\nZ9F8OGC1DbjQA+zgZutG/Pw+e51bCEp7U2hdrVuHeQ9BIAqHiO3yJcAO9uT4kgvj\nmUL3DEVrqApBxL9ZoXbivM5R+hkjjvaq/iSdQkGQIc0UN4PvZQXAv03NJeH+1IOk\nVSST/9ryau11d6btY+z+RHcUV37vQNFfbCWTXH3sikCh/6DrsmTXfusxBoK4Fq9I\n5aTqQPNw1h+DSESUDjbsbkvsboAMbsyMYh8ctOFYtvOOljWdnXokZn/atBU+tcel\nF9d6YFbyntq3SXoq7NFQZKu07LplGaXpRsNIbFiGnwe6qUAG4GGrvdQ9w40YHQ0x\nXIO4t6aQgKv44NTuCVkds2wooxshZSruunATEE++02tlTNdyyRSEq7evZNNBVBho\nDLiqQxj9lBGL3Id1PzKOdggZ9pCocAsx7xnrAAiQ+K7eUdjD4WzDkFy2fYsSuTI6\ntYBx24rmU9E3RaoUEhcWDOrWMeadON9AsOYG3qOjIIVDhWHhAyw=\n=MzHB\n-----END PGP SIGNATURE-----", "payload": "tree 6e70bf0d481a8e8c0505f10d8715d64429058aa2\nparent ea780a69f3d1d47eaacd2811ab7d742c1627b3d5\nauthor flip1995 <hello@philkrones.com> 1580049653 +0100\ncommitter flip1995 <hello@philkrones.com> 1581496467 +0100\n\nExtract deployment\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dfdea56e99e864d43206643b85190cb15127cfb9", "html_url": "https://github.com/rust-lang/rust/commit/dfdea56e99e864d43206643b85190cb15127cfb9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dfdea56e99e864d43206643b85190cb15127cfb9/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea780a69f3d1d47eaacd2811ab7d742c1627b3d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea780a69f3d1d47eaacd2811ab7d742c1627b3d5", "html_url": "https://github.com/rust-lang/rust/commit/ea780a69f3d1d47eaacd2811ab7d742c1627b3d5"}], "stats": {"total": 103, "additions": 12, "deletions": 91}, "files": [{"sha": "d96c69392a1e44cbef4522fccbf6d16ad6c221b4", "filename": ".github/deploy.sh", "status": "modified", "additions": 11, "deletions": 49, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/dfdea56e99e864d43206643b85190cb15127cfb9/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/dfdea56e99e864d43206643b85190cb15127cfb9/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=dfdea56e99e864d43206643b85190cb15127cfb9", "patch": "@@ -1,20 +1,7 @@\n-#!/bin/bash\n-\n-# Automatically deploy on gh-pages\n+#! /bin/bash\n \n set -ex\n \n-SOURCE_BRANCH=\"master\"\n-TARGET_BRANCH=\"gh-pages\"\n-\n-# Save some useful information\n-REPO=$(git config remote.origin.url)\n-SSH_REPO=${REPO/https:\\/\\/github.com\\//git@github.com:}\n-SHA=$(git rev-parse --verify HEAD)\n-\n-# Clone the existing gh-pages for this repo into out/\n-git clone --quiet --single-branch --branch \"$TARGET_BRANCH\" \"$REPO\" out\n-\n echo \"Removing the current docs for master\"\n rm -rf out/master/ || exit 0\n \n@@ -23,59 +10,34 @@ mkdir out/master/\n cp util/gh-pages/index.html out/master\n python ./util/export.py out/master/lints.json\n \n-if [[ -n \"$TRAVIS_TAG\" ]]; then\n-    echo \"Save the doc for the current tag ($TRAVIS_TAG) and point current/ to it\"\n-    cp -r out/master \"out/$TRAVIS_TAG\"\n-    rm -f out/current\n-    ln -s \"$TRAVIS_TAG\" out/current\n+if [[ -n $TAG_NAME ]]; then\n+  echo \"Save the doc for the current tag ($TAG_NAME) and point current/ to it\"\n+  cp -r out/master \"out/$TAG_NAME\"\n+  rm -f out/current\n+  ln -s \"$TAG_NAME\" out/current\n fi\n \n # Generate version index that is shown as root index page\n cp util/gh-pages/versions.html out/index.html\n-pushd out\n \n+cd out\n cat <<-EOF | python - > versions.json\n import os, json\n print json.dumps([\n     dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n ])\n EOF\n-popd\n-\n-# Pull requests and commits to other branches shouldn't try to deploy, just build to verify\n-if [[ \"$TRAVIS_PULL_REQUEST\" != \"false\" ]] || [[ \"$TRAVIS_BRANCH\" != \"$SOURCE_BRANCH\" ]]; then\n-    # Tags should deploy\n-    if [[ -z \"$TRAVIS_TAG\" ]]; then\n-        echo \"Generated, won't push\"\n-        exit 0\n-    fi\n-fi\n \n # Now let's go have some fun with the cloned repo\n-cd out\n-git config user.name \"Travis CI\"\n-git config user.email \"travis@ci.invalid\"\n+git config user.name \"GHA CI\"\n+git config user.email \"gha@ci.invalid\"\n \n if git diff --exit-code --quiet; then\n-    echo \"No changes to the output on this push; exiting.\"\n-    exit 0\n+  echo \"No changes to the output on this push; exiting.\"\n+  exit 0\n fi\n-cd -\n \n-# Get the deploy key by using Travis's stored variables to decrypt deploy_key.enc\n-ENCRYPTION_LABEL=e3a2d77100be\n-ENCRYPTED_KEY_VAR=\"encrypted_${ENCRYPTION_LABEL}_key\"\n-ENCRYPTED_IV_VAR=\"encrypted_${ENCRYPTION_LABEL}_iv\"\n-ENCRYPTED_KEY=${!ENCRYPTED_KEY_VAR}\n-ENCRYPTED_IV=${!ENCRYPTED_IV_VAR}\n-openssl aes-256-cbc -K \"$ENCRYPTED_KEY\" -iv \"$ENCRYPTED_IV\" -in .github/deploy_key.enc -out .github/deploy_key -d\n-chmod 600 .github/deploy_key\n-eval \"$(ssh-agent -s)\"\n-ssh-add .github/deploy_key\n-\n-cd out\n git add .\n git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n \n-# Now that we're all set up, we can push.\n git push \"$SSH_REPO\" \"$TARGET_BRANCH\""}, {"sha": "a3c9b1784a18ca799c8d70530e3f5be51d6b3cd1", "filename": ".github/workflows/deploy.yml", "status": "modified", "additions": 1, "deletions": 42, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/dfdea56e99e864d43206643b85190cb15127cfb9/.github%2Fworkflows%2Fdeploy.yml", "raw_url": "https://github.com/rust-lang/rust/raw/dfdea56e99e864d43206643b85190cb15127cfb9/.github%2Fworkflows%2Fdeploy.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fdeploy.yml?ref=dfdea56e99e864d43206643b85190cb15127cfb9", "patch": "@@ -26,47 +26,6 @@ jobs:\n         path: 'out'\n     - name: Deploy\n       run: |\n-        set -ex\n-\n-        echo \"Removing the current docs for master\"\n-        rm -rf out/master/ || exit 0\n-\n-        echo \"Making the docs for master\"\n-        mkdir out/master/\n-        cp util/gh-pages/index.html out/master\n-        python ./util/export.py out/master/lints.json\n-\n-        if [[ -n $TAG_NAME ]]; then\n-          echo \"Save the doc for the current tag ($TAG_NAME) and point current/ to it\"\n-          cp -r out/master \"out/$TAG_NAME\"\n-          rm -f out/current\n-          ln -s \"$TAG_NAME\" out/current\n-        fi\n-\n-        # Generate version index that is shown as root index page\n-        cp util/gh-pages/versions.html out/index.html\n-\n-        cd out\n-        cat <<-EOF | python - > versions.json\n-        import os, json\n-        print json.dumps([\n-            dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n-        ])\n-        EOF\n-\n-        # Now let's go have some fun with the cloned repo\n-        git config user.name \"GHA CI\"\n-        git config user.email \"gha@ci.invalid\"\n-\n-        if git diff --exit-code --quiet; then\n-            echo \"No changes to the output on this push; exiting.\"\n-            exit 0\n-        fi\n-\n-        git add .\n-        git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n-\n         eval \"$(ssh-agent -s)\"\n         ssh-add - <<< \"${{ secrets.DEPLOY_KEY }}\"\n-\n-        git push \"$SSH_REPO\" \"$TARGET_BRANCH\"\n+        bash .github/deploy.sh"}]}