{"sha": "2d7426bb5a55fa27555de658fca529d8b205ef66", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkNzQyNmJiNWE1NWZhMjc1NTVkZTY1OGZjYTUyOWQ4YjIwNWVmNjY=", "commit": {"author": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-11-07T14:32:58Z"}, "committer": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-11-07T14:32:58Z"}, "message": "borrow_set: remove a helper function and a clone it uses", "tree": {"sha": "235d8d4dec0d28964bd1b35b3d8aa817098c251b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/235d8d4dec0d28964bd1b35b3d8aa817098c251b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d7426bb5a55fa27555de658fca529d8b205ef66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d7426bb5a55fa27555de658fca529d8b205ef66", "html_url": "https://github.com/rust-lang/rust/commit/2d7426bb5a55fa27555de658fca529d8b205ef66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d7426bb5a55fa27555de658fca529d8b205ef66/comments", "author": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ddd4b194a0c28065a277c1f964aa931cc021b5c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/ddd4b194a0c28065a277c1f964aa931cc021b5c6", "html_url": "https://github.com/rust-lang/rust/commit/ddd4b194a0c28065a277c1f964aa931cc021b5c6"}], "stats": {"total": 15, "additions": 3, "deletions": 12}, "files": [{"sha": "c432826dca865de3a8cba3850b947966b462a1b1", "filename": "src/librustc_mir/borrow_check/borrow_set.rs", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2d7426bb5a55fa27555de658fca529d8b205ef66/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d7426bb5a55fa27555de658fca529d8b205ef66/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs?ref=2d7426bb5a55fa27555de658fca529d8b205ef66", "patch": "@@ -21,7 +21,6 @@ use rustc::util::nodemap::{FxHashMap, FxHashSet};\n use rustc_data_structures::indexed_vec::IndexVec;\n use rustc_data_structures::bit_set::BitSet;\n use std::fmt;\n-use std::hash::Hash;\n use std::ops::Index;\n \n crate struct BorrowSet<'tcx> {\n@@ -233,21 +232,13 @@ impl<'a, 'gcx, 'tcx> Visitor<'tcx> for GatherBorrows<'a, 'gcx, 'tcx> {\n \n             self.insert_as_pending_if_two_phase(location, &assigned_place, region, kind, idx);\n \n-            insert(&mut self.region_map, &region, idx);\n+            self.region_map.entry(region).or_default().insert(idx);\n             if let Some(local) = borrowed_place.root_local() {\n-                insert(&mut self.local_map, &local, idx);\n+                self.local_map.entry(local).or_default().insert(idx);\n             }\n         }\n \n-        return self.super_assign(block, assigned_place, rvalue, location);\n-\n-        fn insert<'a, K, V>(map: &'a mut FxHashMap<K, FxHashSet<V>>, k: &K, v: V)\n-        where\n-            K: Clone + Eq + Hash,\n-            V: Eq + Hash,\n-        {\n-            map.entry(k.clone()).or_default().insert(v);\n-        }\n+        self.super_assign(block, assigned_place, rvalue, location)\n     }\n \n     fn visit_place("}]}