{"sha": "6e467b74cda020f89f1663deda5169f85d859c6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlNDY3Yjc0Y2RhMDIwZjg5ZjE2NjNkZWRhNTE2OWY4NWQ4NTljNmQ=", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2021-01-17T22:03:23Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2021-01-17T22:03:23Z"}, "message": "Fix test to work with remote-test-server.\n\nremote-test-server does not set the current_dir, and leaves it\nas `/`.", "tree": {"sha": "9915bdced5f51c4866c771adfd1cacc5e29b4e72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9915bdced5f51c4866c771adfd1cacc5e29b4e72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e467b74cda020f89f1663deda5169f85d859c6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e467b74cda020f89f1663deda5169f85d859c6d", "html_url": "https://github.com/rust-lang/rust/commit/6e467b74cda020f89f1663deda5169f85d859c6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e467b74cda020f89f1663deda5169f85d859c6d/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fcbcc975767b0621a43fb9c1c872e1754e30a377", "url": "https://api.github.com/repos/rust-lang/rust/commits/fcbcc975767b0621a43fb9c1c872e1754e30a377", "html_url": "https://github.com/rust-lang/rust/commit/fcbcc975767b0621a43fb9c1c872e1754e30a377"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "91d8e4f381a368af580596eacf6a6bd236212725", "filename": "src/test/ui/command/command-current-dir.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6e467b74cda020f89f1663deda5169f85d859c6d/src%2Ftest%2Fui%2Fcommand%2Fcommand-current-dir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e467b74cda020f89f1663deda5169f85d859c6d/src%2Ftest%2Fui%2Fcommand%2Fcommand-current-dir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcommand%2Fcommand-current-dir.rs?ref=6e467b74cda020f89f1663deda5169f85d859c6d", "patch": "@@ -16,8 +16,14 @@ fn main() {\n         std::process::exit(0);\n     }\n     let exe = me.file_name().unwrap();\n-    let cwd = std::env::current_dir().unwrap();\n+    let cwd = me.parent().unwrap();\n     eprintln!(\"cwd={:?}\", cwd);\n+    // Change directory to where the exectuable is located, since this test\n+    // fundamentally needs to use relative paths. In some cases (like\n+    // remote-test-server), the current_dir can be somewhere else, so make\n+    // sure it is something we can use. We assume we can write to this\n+    // directory.\n+    env::set_current_dir(&cwd).unwrap();\n     let foo = cwd.join(\"foo\");\n     let bar = cwd.join(\"bar\");\n     fs::create_dir_all(&foo).unwrap();"}]}