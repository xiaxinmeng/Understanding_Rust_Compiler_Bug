{"sha": "17f08fecfd81479e04fc5ea7590cecdb429c7ce3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3ZjA4ZmVjZmQ4MTQ3OWUwNGZjNWVhNzU5MGNlY2RiNDI5YzdjZTM=", "commit": {"author": {"name": "Tobias Bieniek", "email": "tobias.bieniek@gmail.com", "date": "2018-11-13T17:05:46Z"}, "committer": {"name": "Tobias Bieniek", "email": "tobias.bieniek@gmail.com", "date": "2018-11-13T21:02:51Z"}, "message": "core/char: Speed up `to_digit()` for `radix <= 10`\n\n### Before\n\n```\n# Run 1\ntest char::methods::bench_to_digit_radix_10                ... bench:      16,265 ns/iter (+/- 1,774)\ntest char::methods::bench_to_digit_radix_16                ... bench:      13,938 ns/iter (+/- 2,479)\ntest char::methods::bench_to_digit_radix_2                 ... bench:      13,090 ns/iter (+/- 524)\ntest char::methods::bench_to_digit_radix_36                ... bench:      14,236 ns/iter (+/- 1,949)\n\n# Run 2\ntest char::methods::bench_to_digit_radix_10                ... bench:      16,176 ns/iter (+/- 1,589)\ntest char::methods::bench_to_digit_radix_16                ... bench:      13,896 ns/iter (+/- 3,140)\ntest char::methods::bench_to_digit_radix_2                 ... bench:      13,158 ns/iter (+/- 1,112)\ntest char::methods::bench_to_digit_radix_36                ... bench:      14,206 ns/iter (+/- 1,312)\n\n# Run 3\ntest char::methods::bench_to_digit_radix_10                ... bench:      16,221 ns/iter (+/- 2,423)\ntest char::methods::bench_to_digit_radix_16                ... bench:      14,361 ns/iter (+/- 3,926)\ntest char::methods::bench_to_digit_radix_2                 ... bench:      13,097 ns/iter (+/- 671)\ntest char::methods::bench_to_digit_radix_36                ... bench:      14,388 ns/iter (+/- 1,068)\n```\n\n### After\n\n```\n# Run 1\ntest char::methods::bench_to_digit_radix_10      ... bench:      11,521 ns/iter (+/- 552)\ntest char::methods::bench_to_digit_radix_16      ... bench:      12,926 ns/iter (+/- 684)\ntest char::methods::bench_to_digit_radix_2       ... bench:      11,266 ns/iter (+/- 1,085)\ntest char::methods::bench_to_digit_radix_36      ... bench:      14,213 ns/iter (+/- 614)\n\n# Run 2\ntest char::methods::bench_to_digit_radix_10      ... bench:      11,424 ns/iter (+/- 1,042)\ntest char::methods::bench_to_digit_radix_16      ... bench:      12,854 ns/iter (+/- 1,193)\ntest char::methods::bench_to_digit_radix_2       ... bench:      11,193 ns/iter (+/- 716)\ntest char::methods::bench_to_digit_radix_36      ... bench:      14,249 ns/iter (+/- 3,514)\n\n# Run 3\ntest char::methods::bench_to_digit_radix_10      ... bench:      11,469 ns/iter (+/- 685)\ntest char::methods::bench_to_digit_radix_16      ... bench:      12,852 ns/iter (+/- 568)\ntest char::methods::bench_to_digit_radix_2       ... bench:      11,275 ns/iter (+/- 1,356)\ntest char::methods::bench_to_digit_radix_36      ... bench:      14,188 ns/iter (+/- 1,501)\n```", "tree": {"sha": "5866ba6317742bb703b5a50dbecbcd59d3d100c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5866ba6317742bb703b5a50dbecbcd59d3d100c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17f08fecfd81479e04fc5ea7590cecdb429c7ce3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17f08fecfd81479e04fc5ea7590cecdb429c7ce3", "html_url": "https://github.com/rust-lang/rust/commit/17f08fecfd81479e04fc5ea7590cecdb429c7ce3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17f08fecfd81479e04fc5ea7590cecdb429c7ce3/comments", "author": {"login": "Turbo87", "id": 141300, "node_id": "MDQ6VXNlcjE0MTMwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/141300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Turbo87", "html_url": "https://github.com/Turbo87", "followers_url": "https://api.github.com/users/Turbo87/followers", "following_url": "https://api.github.com/users/Turbo87/following{/other_user}", "gists_url": "https://api.github.com/users/Turbo87/gists{/gist_id}", "starred_url": "https://api.github.com/users/Turbo87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Turbo87/subscriptions", "organizations_url": "https://api.github.com/users/Turbo87/orgs", "repos_url": "https://api.github.com/users/Turbo87/repos", "events_url": "https://api.github.com/users/Turbo87/events{/privacy}", "received_events_url": "https://api.github.com/users/Turbo87/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Turbo87", "id": 141300, "node_id": "MDQ6VXNlcjE0MTMwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/141300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Turbo87", "html_url": "https://github.com/Turbo87", "followers_url": "https://api.github.com/users/Turbo87/followers", "following_url": "https://api.github.com/users/Turbo87/following{/other_user}", "gists_url": "https://api.github.com/users/Turbo87/gists{/gist_id}", "starred_url": "https://api.github.com/users/Turbo87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Turbo87/subscriptions", "organizations_url": "https://api.github.com/users/Turbo87/orgs", "repos_url": "https://api.github.com/users/Turbo87/repos", "events_url": "https://api.github.com/users/Turbo87/events{/privacy}", "received_events_url": "https://api.github.com/users/Turbo87/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04aade83f2785d6ca43049ff89026ed930f792f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/04aade83f2785d6ca43049ff89026ed930f792f1", "html_url": "https://github.com/rust-lang/rust/commit/04aade83f2785d6ca43049ff89026ed930f792f1"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "46b201f7bbf2c842bdb6dd0507641ede84b94506", "filename": "src/libcore/char/methods.rs", "status": "modified", "additions": 20, "deletions": 5, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/17f08fecfd81479e04fc5ea7590cecdb429c7ce3/src%2Flibcore%2Fchar%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17f08fecfd81479e04fc5ea7590cecdb429c7ce3/src%2Flibcore%2Fchar%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fchar%2Fmethods.rs?ref=17f08fecfd81479e04fc5ea7590cecdb429c7ce3", "patch": "@@ -122,12 +122,27 @@ impl char {\n     #[inline]\n     pub fn to_digit(self, radix: u32) -> Option<u32> {\n         assert!(radix <= 36, \"to_digit: radix is too high (maximum 36)\");\n-        let val = match self {\n-          '0' ..= '9' => self as u32 - '0' as u32,\n-          'a' ..= 'z' => self as u32 - 'a' as u32 + 10,\n-          'A' ..= 'Z' => self as u32 - 'A' as u32 + 10,\n-          _ => return None,\n+        if radix == 10 {\n+            return match self {\n+                '0' ..= '9' => Some(self as u32 - '0' as u32),\n+                _ => None,\n+            };\n+        }\n+\n+        let val = if radix < 10  {\n+            match self {\n+                '0' ..= '9' => self as u32 - '0' as u32,\n+                _ => return None,\n+            }\n+        } else {\n+            match self {\n+                '0'..='9' => self as u32 - '0' as u32,\n+                'a'..='z' => self as u32 - 'a' as u32 + 10,\n+                'A'..='Z' => self as u32 - 'A' as u32 + 10,\n+                _ => return None,\n+            }\n         };\n+\n         if val < radix { Some(val) }\n         else { None }\n     }"}]}