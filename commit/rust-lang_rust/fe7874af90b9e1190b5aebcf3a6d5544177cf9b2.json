{"sha": "fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "node_id": "C_kwDOAAsO6NoAKGZlNzg3NGFmOTBiOWUxMTkwYjVhZWJjZjNhNmQ1NTQ0MTc3Y2Y5YjI", "commit": {"author": {"name": "Bruno Ortiz", "email": "brunortiz11@gmail.com", "date": "2023-04-08T17:18:29Z"}, "committer": {"name": "Bruno Ortiz", "email": "brunortiz11@gmail.com", "date": "2023-05-02T13:59:31Z"}, "message": "reveal only when tree is visible", "tree": {"sha": "075ffb25f472facb924738bca06dcfba253de6c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/075ffb25f472facb924738bca06dcfba253de6c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "html_url": "https://github.com/rust-lang/rust/commit/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/comments", "author": {"login": "bruno-ortiz", "id": 5748995, "node_id": "MDQ6VXNlcjU3NDg5OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/5748995?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bruno-ortiz", "html_url": "https://github.com/bruno-ortiz", "followers_url": "https://api.github.com/users/bruno-ortiz/followers", "following_url": "https://api.github.com/users/bruno-ortiz/following{/other_user}", "gists_url": "https://api.github.com/users/bruno-ortiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/bruno-ortiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bruno-ortiz/subscriptions", "organizations_url": "https://api.github.com/users/bruno-ortiz/orgs", "repos_url": "https://api.github.com/users/bruno-ortiz/repos", "events_url": "https://api.github.com/users/bruno-ortiz/events{/privacy}", "received_events_url": "https://api.github.com/users/bruno-ortiz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bruno-ortiz", "id": 5748995, "node_id": "MDQ6VXNlcjU3NDg5OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/5748995?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bruno-ortiz", "html_url": "https://github.com/bruno-ortiz", "followers_url": "https://api.github.com/users/bruno-ortiz/followers", "following_url": "https://api.github.com/users/bruno-ortiz/following{/other_user}", "gists_url": "https://api.github.com/users/bruno-ortiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/bruno-ortiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bruno-ortiz/subscriptions", "organizations_url": "https://api.github.com/users/bruno-ortiz/orgs", "repos_url": "https://api.github.com/users/bruno-ortiz/repos", "events_url": "https://api.github.com/users/bruno-ortiz/events{/privacy}", "received_events_url": "https://api.github.com/users/bruno-ortiz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3081a67742a67680f7ddef503094e62e2e68c55", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3081a67742a67680f7ddef503094e62e2e68c55", "html_url": "https://github.com/rust-lang/rust/commit/a3081a67742a67680f7ddef503094e62e2e68c55"}], "stats": {"total": 41, "additions": 29, "deletions": 12}, "files": [{"sha": "81d3b8da7f90bcd3b894373fb5620d9df6713a3e", "filename": "editors/code/src/commands.ts", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Fcommands.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Fcommands.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands.ts?ref=fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "patch": "@@ -15,7 +15,6 @@ import {\n     isRustEditor,\n     RustEditor,\n     RustDocument,\n-    closeDocument,\n } from \"./util\";\n import { startDebugSession, makeDebugConfig } from \"./debug\";\n import { LanguageClient } from \"vscode-languageclient/node\";\n@@ -324,7 +323,6 @@ async function revealParentChain(document: RustDocument, ctx: CtxInit) {\n         if (parentChain.length >= maxDepth) {\n             // this is an odd case that can happen when we change a crate version but we'd still have\n             // a open file referencing the old version\n-            await closeDocument(document);\n             return;\n         }\n     } while (!ctx.dependencies?.contains(documentPath));"}, {"sha": "4e592823b04cd53e56e4cb41b6cf1a9dc66d90f5", "filename": "editors/code/src/ctx.ts", "status": "modified", "additions": 29, "deletions": 5, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Fctx.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Fctx.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fctx.ts?ref=fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "patch": "@@ -285,14 +285,38 @@ export class Ctx {\n         });\n \n         this.pushExtCleanup(this._treeView);\n-        vscode.window.onDidChangeActiveTextEditor((e) => {\n+        vscode.window.onDidChangeActiveTextEditor(async (e) => {\n             // we should skip documents that belong to the current workspace\n-            if (e && isRustEditor(e) && !isDocumentInWorkspace(e.document)) {\n-                execRevealDependency(e).catch((reason) => {\n-                    void vscode.window.showErrorMessage(`Dependency error: ${reason}`);\n-                });\n+            if (this.shouldRevealDependency(e)) {\n+                try {\n+                    await execRevealDependency(e);\n+                } catch (reason) {\n+                    await vscode.window.showErrorMessage(`Dependency error: ${reason}`);\n+                }\n             }\n         });\n+\n+        this.treeView?.onDidChangeVisibility(async (e) => {\n+            if (e.visible) {\n+                const activeEditor = vscode.window.activeTextEditor;\n+                if (this.shouldRevealDependency(activeEditor)) {\n+                    try {\n+                        await execRevealDependency(activeEditor);\n+                    } catch (reason) {\n+                        await vscode.window.showErrorMessage(`Dependency error: ${reason}`);\n+                    }\n+                }\n+            }\n+        });\n+    }\n+\n+    private shouldRevealDependency(e: vscode.TextEditor | undefined): e is RustEditor {\n+        return (\n+            e !== undefined &&\n+            isRustEditor(e) &&\n+            !isDocumentInWorkspace(e.document) &&\n+            (this.treeView?.visible || false)\n+        );\n     }\n \n     async restart() {"}, {"sha": "b6b779e2660132ab8cfd54ef127edef756e8c1cd", "filename": "editors/code/src/util.ts", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Futil.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fe7874af90b9e1190b5aebcf3a6d5544177cf9b2/editors%2Fcode%2Fsrc%2Futil.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Futil.ts?ref=fe7874af90b9e1190b5aebcf3a6d5544177cf9b2", "patch": "@@ -125,11 +125,6 @@ export function isDocumentInWorkspace(document: RustDocument): boolean {\n     return false;\n }\n \n-export async function closeDocument(document: RustDocument) {\n-    await vscode.window.showTextDocument(document, { preview: true, preserveFocus: false });\n-    await vscode.commands.executeCommand(\"workbench.action.closeActiveEditor\");\n-}\n-\n export function isValidExecutable(path: string): boolean {\n     log.debug(\"Checking availability of a binary at\", path);\n "}]}