{"sha": "1bab67c72b50c995c7b981fddff89e61c8a723af", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiYWI2N2M3MmI1MGM5OTVjN2I5ODFmZGRmZjg5ZTYxYzhhNzIzYWY=", "commit": {"author": {"name": "Marcin Serwin", "email": "toxyxer@gmail.com", "date": "2020-03-20T09:51:48Z"}, "committer": {"name": "Marcin Serwin", "email": "toxyxer@gmail.com", "date": "2020-04-09T06:07:18Z"}, "message": "Don't show comparison suggestion for arrays", "tree": {"sha": "3360a191b82ff09ab6864f328ab6b58eda075abc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3360a191b82ff09ab6864f328ab6b58eda075abc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1bab67c72b50c995c7b981fddff89e61c8a723af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1bab67c72b50c995c7b981fddff89e61c8a723af", "html_url": "https://github.com/rust-lang/rust/commit/1bab67c72b50c995c7b981fddff89e61c8a723af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1bab67c72b50c995c7b981fddff89e61c8a723af/comments", "author": {"login": "marcin-serwin", "id": 12128106, "node_id": "MDQ6VXNlcjEyMTI4MTA2", "avatar_url": "https://avatars.githubusercontent.com/u/12128106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcin-serwin", "html_url": "https://github.com/marcin-serwin", "followers_url": "https://api.github.com/users/marcin-serwin/followers", "following_url": "https://api.github.com/users/marcin-serwin/following{/other_user}", "gists_url": "https://api.github.com/users/marcin-serwin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcin-serwin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcin-serwin/subscriptions", "organizations_url": "https://api.github.com/users/marcin-serwin/orgs", "repos_url": "https://api.github.com/users/marcin-serwin/repos", "events_url": "https://api.github.com/users/marcin-serwin/events{/privacy}", "received_events_url": "https://api.github.com/users/marcin-serwin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcin-serwin", "id": 12128106, "node_id": "MDQ6VXNlcjEyMTI4MTA2", "avatar_url": "https://avatars.githubusercontent.com/u/12128106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcin-serwin", "html_url": "https://github.com/marcin-serwin", "followers_url": "https://api.github.com/users/marcin-serwin/followers", "following_url": "https://api.github.com/users/marcin-serwin/following{/other_user}", "gists_url": "https://api.github.com/users/marcin-serwin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcin-serwin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcin-serwin/subscriptions", "organizations_url": "https://api.github.com/users/marcin-serwin/orgs", "repos_url": "https://api.github.com/users/marcin-serwin/repos", "events_url": "https://api.github.com/users/marcin-serwin/events{/privacy}", "received_events_url": "https://api.github.com/users/marcin-serwin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bcbb9d9acb43f5b3f1ffe665f9c66d9931e1cc01", "url": "https://api.github.com/repos/rust-lang/rust/commits/bcbb9d9acb43f5b3f1ffe665f9c66d9931e1cc01", "html_url": "https://github.com/rust-lang/rust/commit/bcbb9d9acb43f5b3f1ffe665f9c66d9931e1cc01"}], "stats": {"total": 26, "additions": 16, "deletions": 10}, "files": [{"sha": "d9cef4851f532030b807e5fa54d5e53335908c89", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1bab67c72b50c995c7b981fddff89e61c8a723af/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bab67c72b50c995c7b981fddff89e61c8a723af/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=1bab67c72b50c995c7b981fddff89e61c8a723af", "patch": "@@ -378,16 +378,18 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MiscLints {\n                         let lhs = Sugg::hir(cx, left, \"..\");\n                         let rhs = Sugg::hir(cx, right, \"..\");\n \n-                        db.span_suggestion(\n-                            expr.span,\n-                            \"consider comparing them within some error\",\n-                            format!(\n-                                \"({}).abs() {} error\",\n-                                lhs - rhs,\n-                                if op == BinOpKind::Eq { '<' } else { '>' }\n-                            ),\n-                            Applicability::HasPlaceholders, // snippet\n-                        );\n+                        if !(is_array(cx, left) || is_array(cx, right)) {\n+                            db.span_suggestion(\n+                                expr.span,\n+                                \"consider comparing them within some error\",\n+                                format!(\n+                                    \"({}).abs() {} error\",\n+                                    lhs - rhs,\n+                                    if op == BinOpKind::Eq { '<' } else { '>' }\n+                                ),\n+                                Applicability::HasPlaceholders, // snippet\n+                            );\n+                        }\n                         db.span_note(expr.span, \"`f32::EPSILON` and `f64::EPSILON` are available.\");\n                     });\n                 } else if op == BinOpKind::Rem && is_integer_const(cx, right, 1) {\n@@ -513,6 +515,10 @@ fn is_float(cx: &LateContext<'_, '_>, expr: &Expr<'_>) -> bool {\n     matches!(value, ty::Float(_))\n }\n \n+fn is_array(cx: &LateContext<'_, '_>, expr: &Expr<'_>) -> bool {\n+    matches!(&walk_ptrs_ty(cx.tables.expr_ty(expr)).kind, ty::Array(_, _))\n+}\n+\n fn check_to_owned(cx: &LateContext<'_, '_>, expr: &Expr<'_>, other: &Expr<'_>) {\n     let (arg_ty, snip) = match expr.kind {\n         ExprKind::MethodCall(.., ref args) if args.len() == 1 => {"}]}