{"sha": "690bb8af510c0cf4099eac512127948180dbc792", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5MGJiOGFmNTEwYzBjZjQwOTllYWM1MTIxMjc5NDgxODBkYmM3OTI=", "commit": {"author": {"name": "Jake Goulding", "email": "jake.goulding@gmail.com", "date": "2016-05-06T13:32:10Z"}, "committer": {"name": "Dylan McKay", "email": "me@dylanmckay.io", "date": "2020-06-09T05:34:07Z"}, "message": "[AVR] Add AVR platform support", "tree": {"sha": "9c587dd0b4bb8b044ca7e603eb284071d06e8756", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c587dd0b4bb8b044ca7e603eb284071d06e8756"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/690bb8af510c0cf4099eac512127948180dbc792", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/690bb8af510c0cf4099eac512127948180dbc792", "html_url": "https://github.com/rust-lang/rust/commit/690bb8af510c0cf4099eac512127948180dbc792", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/690bb8af510c0cf4099eac512127948180dbc792/comments", "author": {"login": "shepmaster", "id": 174509, "node_id": "MDQ6VXNlcjE3NDUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shepmaster", "html_url": "https://github.com/shepmaster", "followers_url": "https://api.github.com/users/shepmaster/followers", "following_url": "https://api.github.com/users/shepmaster/following{/other_user}", "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions", "organizations_url": "https://api.github.com/users/shepmaster/orgs", "repos_url": "https://api.github.com/users/shepmaster/repos", "events_url": "https://api.github.com/users/shepmaster/events{/privacy}", "received_events_url": "https://api.github.com/users/shepmaster/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dylanmckay", "id": 7722159, "node_id": "MDQ6VXNlcjc3MjIxNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/7722159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dylanmckay", "html_url": "https://github.com/dylanmckay", "followers_url": "https://api.github.com/users/dylanmckay/followers", "following_url": "https://api.github.com/users/dylanmckay/following{/other_user}", "gists_url": "https://api.github.com/users/dylanmckay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dylanmckay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dylanmckay/subscriptions", "organizations_url": "https://api.github.com/users/dylanmckay/orgs", "repos_url": "https://api.github.com/users/dylanmckay/repos", "events_url": "https://api.github.com/users/dylanmckay/events{/privacy}", "received_events_url": "https://api.github.com/users/dylanmckay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5d39f1fa2978e2c4532d002f4ce5121bc1c9a007", "url": "https://api.github.com/repos/rust-lang/rust/commits/5d39f1fa2978e2c4532d002f4ce5121bc1c9a007", "html_url": "https://github.com/rust-lang/rust/commit/5d39f1fa2978e2c4532d002f4ce5121bc1c9a007"}], "stats": {"total": 160, "additions": 158, "deletions": 2}, "files": [{"sha": "d995554913f8429927581cba17291d5ac9c02ef1", "filename": "config.toml.example", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -69,7 +69,7 @@\n # the same format as above, but since these targets are experimental, they are\n # not built by default and the experimental Rust compilation targets that depend\n # on them will not work unless the user opts in to building them.\n-#experimental-targets = \"\"\n+#experimental-targets = \"AVR\"\n \n # Cap the number of parallel linker invocations when compiling LLVM.\n # This can be useful when building LLVM with debug info, which significantly"}, {"sha": "252a6316e574b99cdf440b6b90d7ee2b155daa58", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -144,7 +144,7 @@ impl Step for Llvm {\n \n         let llvm_exp_targets = match builder.config.llvm_experimental_targets {\n             Some(ref s) => s,\n-            None => \"\",\n+            None => \"AVR\",\n         };\n \n         let assertions = if builder.config.llvm_assertions { \"ON\" } else { \"OFF\" };"}, {"sha": "a7b0c9cf81be6706d053ed6a90d6f8a9ddf8e3d4", "filename": "src/librustc_ast_passes/feature_gate.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_ast_passes%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_ast_passes%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_passes%2Ffeature_gate.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -121,6 +121,14 @@ impl<'a> PostExpansionVisitor<'a> {\n                     \"amdgpu-kernel ABI is experimental and subject to change\"\n                 );\n             }\n+            \"avr-interrupt\" | \"avr-non-blocking-interrupt\" => {\n+                gate_feature_post!(\n+                    &self,\n+                    abi_avr_interrupt,\n+                    span,\n+                    \"avr-interrupt and avr-non-blocking-interrupt ABIs are experimental and subject to change\"\n+                );\n+            }\n             \"efiapi\" => {\n                 gate_feature_post!(\n                     &self,"}, {"sha": "099c402703d09f44260df9feab87947654dadcf5", "filename": "src/librustc_codegen_llvm/abi.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_codegen_llvm%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_codegen_llvm%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fabi.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -375,6 +375,8 @@ impl<'tcx> FnAbiLlvmExt<'tcx> for FnAbi<'tcx, Ty<'tcx>> {\n         match self.conv {\n             Conv::C | Conv::Rust => llvm::CCallConv,\n             Conv::AmdGpuKernel => llvm::AmdGpuKernel,\n+            Conv::AvrInterrupt => llvm::AvrInterrupt,\n+            Conv::AvrNonBlockingInterrupt => llvm::AvrNonBlockingInterrupt,\n             Conv::ArmAapcs => llvm::ArmAapcsCallConv,\n             Conv::Msp430Intr => llvm::Msp430Intr,\n             Conv::PtxKernel => llvm::PtxKernel,"}, {"sha": "d37cce56fc6faa6e327746e9f6ec9b690b53b242", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -45,6 +45,8 @@ pub enum CallConv {\n     X86_64_Win64 = 79,\n     X86_VectorCall = 80,\n     X86_Intr = 83,\n+    AvrNonBlockingInterrupt = 84,\n+    AvrInterrupt = 85,\n     AmdGpuKernel = 91,\n }\n "}, {"sha": "fc64727ad6272521c2e5bb567120382657bb8b5e", "filename": "src/librustc_feature/active.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_feature%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_feature%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_feature%2Factive.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -347,6 +347,9 @@ declare_features! (\n     /// Allows `extern \"msp430-interrupt\" fn()`.\n     (active, abi_msp430_interrupt, \"1.16.0\", Some(38487), None),\n \n+    /// Allows `extern \"avr-interrupt\" fn()` and `extern \"avr-non-blocking-interrupt\" fn()`.\n+    (active, abi_avr_interrupt, \"1.41.0\", None, None),\n+\n     /// Allows declarative macros 2.0 (`macro`).\n     (active, decl_macro, \"1.17.0\", Some(39412), None),\n "}, {"sha": "ada48bc147e47866750a725b1c35f57e1a0b58b9", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -78,6 +78,7 @@ fn main() {\n         \"arm\",\n         \"aarch64\",\n         \"amdgpu\",\n+        \"avr\",\n         \"mips\",\n         \"powerpc\",\n         \"systemz\","}, {"sha": "79e1a6cc5dcdb7e3cb3024948bad3541bdbb6b9d", "filename": "src/librustc_llvm/lib.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_llvm%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_llvm%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Flib.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -76,6 +76,14 @@ pub fn initialize_available_targets() {\n         LLVMInitializeAMDGPUAsmPrinter,\n         LLVMInitializeAMDGPUAsmParser\n     );\n+    init_target!(\n+        llvm_component = \"avr\",\n+        LLVMInitializeAVRTargetInfo,\n+        LLVMInitializeAVRTarget,\n+        LLVMInitializeAVRTargetMC,\n+        LLVMInitializeAVRAsmPrinter,\n+        LLVMInitializeAVRAsmParser\n+    );\n     init_target!(\n         llvm_component = \"mips\",\n         LLVMInitializeMipsTargetInfo,"}, {"sha": "f5bca90c2bd523d7075ff4eaeb0307b90480d1ca", "filename": "src/librustc_middle/ty/layout.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_middle%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_middle%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fty%2Flayout.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -2529,6 +2529,8 @@ where\n             Msp430Interrupt => Conv::Msp430Intr,\n             X86Interrupt => Conv::X86Intr,\n             AmdGpuKernel => Conv::AmdGpuKernel,\n+            AvrInterrupt => Conv::AvrInterrupt,\n+            AvrNonBlockingInterrupt => Conv::AvrNonBlockingInterrupt,\n \n             // These API constants ought to be more specific...\n             Cdecl => Conv::C,"}, {"sha": "fea5880f01ebd045dace8ff38305a0eee202b611", "filename": "src/librustc_span/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_span%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_span%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fsymbol.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -120,6 +120,7 @@ symbols! {\n         abi_unadjusted,\n         abi_vectorcall,\n         abi_x86_interrupt,\n+        abi_avr_interrupt,\n         abort,\n         aborts,\n         address,"}, {"sha": "f681302bc03198fdc8251783fb5c0899fcf02e80", "filename": "src/librustc_target/abi/call/avr.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fabi%2Fcall%2Favr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fabi%2Fcall%2Favr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fabi%2Fcall%2Favr.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -0,0 +1,33 @@\n+#![allow(non_upper_case_globals)]\n+\n+use crate::abi::call::{ArgAbi, FnAbi};\n+\n+fn classify_ret_ty<Ty>(ret: &mut ArgAbi<'_, Ty>) {\n+    if ret.layout.is_aggregate() {\n+        ret.make_indirect();\n+    } else {\n+        ret.extend_integer_width_to(8); // Is 8 correct?\n+    }\n+}\n+\n+fn classify_arg_ty<Ty>(arg: &mut ArgAbi<'_, Ty>) {\n+    if arg.layout.is_aggregate() {\n+        arg.make_indirect();\n+    } else {\n+        arg.extend_integer_width_to(8);\n+    }\n+}\n+\n+pub fn compute_abi_info<Ty>(fty: &mut FnAbi<'_, Ty>) {\n+    if !fty.ret.is_ignore() {\n+        classify_ret_ty(&mut fty.ret);\n+    }\n+\n+    for arg in &mut fty.args {\n+        if arg.is_ignore() {\n+            continue;\n+        }\n+\n+        classify_arg_ty(arg);\n+    }\n+}"}, {"sha": "8f7e2bba5aa6d785ea72f08fbd39d01ef7bfd55e", "filename": "src/librustc_target/abi/call/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fabi%2Fcall%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fabi%2Fcall%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fabi%2Fcall%2Fmod.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -5,6 +5,7 @@ use crate::spec::{self, HasTargetSpec};\n mod aarch64;\n mod amdgpu;\n mod arm;\n+mod avr;\n mod hexagon;\n mod mips;\n mod mips64;\n@@ -525,6 +526,8 @@ pub enum Conv {\n     X86_64Win64,\n \n     AmdGpuKernel,\n+    AvrInterrupt,\n+    AvrNonBlockingInterrupt,\n }\n \n /// Metadata describing how the arguments to a native function\n@@ -580,6 +583,7 @@ impl<'a, Ty> FnAbi<'a, Ty> {\n             \"aarch64\" => aarch64::compute_abi_info(cx, self),\n             \"amdgpu\" => amdgpu::compute_abi_info(cx, self),\n             \"arm\" => arm::compute_abi_info(cx, self),\n+            \"avr\" => avr::compute_abi_info(self),\n             \"mips\" => mips::compute_abi_info(cx, self),\n             \"mips64\" => mips64::compute_abi_info(cx, self),\n             \"powerpc\" => powerpc::compute_abi_info(self),"}, {"sha": "a5c874bb4ac050a2c305b4f9b95cd3137d6a0079", "filename": "src/librustc_target/spec/abi.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fabi.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -34,6 +34,8 @@ pub enum Abi {\n     X86Interrupt,\n     AmdGpuKernel,\n     EfiApi,\n+    AvrInterrupt,\n+    AvrNonBlockingInterrupt,\n \n     // Multiplatform / generic ABIs\n     System,\n@@ -73,6 +75,12 @@ const AbiDatas: &[AbiData] = &[\n     AbiData { abi: Abi::X86Interrupt, name: \"x86-interrupt\", generic: false },\n     AbiData { abi: Abi::AmdGpuKernel, name: \"amdgpu-kernel\", generic: false },\n     AbiData { abi: Abi::EfiApi, name: \"efiapi\", generic: false },\n+    AbiData { abi: Abi::AvrInterrupt, name: \"avr-interrupt\", generic: false },\n+    AbiData {\n+        abi: Abi::AvrNonBlockingInterrupt,\n+        name: \"avr-non-blocking-interrupt\",\n+        generic: false,\n+    },\n     // Cross-platform ABIs\n     AbiData { abi: Abi::System, name: \"system\", generic: true },\n     AbiData { abi: Abi::RustIntrinsic, name: \"rust-intrinsic\", generic: true },"}, {"sha": "c951c980e2a020c26b8e1258862a0a38d60ceebb", "filename": "src/librustc_target/spec/avr_unknown_unknown.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Favr_unknown_unknown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Favr_unknown_unknown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Favr_unknown_unknown.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -0,0 +1,17 @@\n+use crate::spec::{LinkerFlavor, Target, TargetResult};\n+\n+pub fn target() -> TargetResult {\n+    Ok(Target {\n+        llvm_target: \"avr-unknown-unknown\".to_string(),\n+        target_endian: \"little\".to_string(),\n+        target_pointer_width: \"16\".to_string(),\n+        data_layout: \"e-P1-p:16:8-i8:8-i16:8-i32:8-i64:8-f32:8-f64:8-n8-a:8\".to_string(),\n+        arch: \"avr\".to_string(),\n+        linker_flavor: LinkerFlavor::Gcc,\n+        target_os: \"unknown\".to_string(),\n+        target_env: \"\".to_string(),\n+        target_vendor: \"unknown\".to_string(),\n+        target_c_int_width: 16.to_string(),\n+        options: super::none_base::opts(),\n+    })\n+}"}, {"sha": "833beee3bd4f3e928dc6562419c14c0c76ff4c74", "filename": "src/librustc_target/spec/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fmod.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -65,6 +65,7 @@ mod linux_kernel_base;\n mod linux_musl_base;\n mod msvc_base;\n mod netbsd_base;\n+mod none_base;\n mod openbsd_base;\n mod redox_base;\n mod riscv_base;\n@@ -579,6 +580,8 @@ supported_targets! {\n     (\"aarch64-fuchsia\", aarch64_fuchsia),\n     (\"x86_64-fuchsia\", x86_64_fuchsia),\n \n+    (\"avr-unknown-unknown\", avr_unknown_unknown),\n+\n     (\"x86_64-unknown-l4re-uclibc\", x86_64_unknown_l4re_uclibc),\n \n     (\"aarch64-unknown-redox\", aarch64_unknown_redox),"}, {"sha": "5402ea074fae1ee891c64a17560783761408ff6e", "filename": "src/librustc_target/spec/none_base.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fnone_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibrustc_target%2Fspec%2Fnone_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fnone_base.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -0,0 +1,30 @@\n+use crate::spec::{LinkArgs, LinkerFlavor, TargetOptions};\n+use std::default::Default;\n+\n+pub fn opts() -> TargetOptions {\n+    let mut args = LinkArgs::new();\n+\n+    args.insert(\n+        LinkerFlavor::Gcc,\n+        vec![\n+            // We want to be able to strip as much executable code as possible\n+            // from the linker command line, and this flag indicates to the\n+            // linker that it can avoid linking in dynamic libraries that don't\n+            // actually satisfy any symbols up to that point (as with many other\n+            // resolutions the linker does). This option only applies to all\n+            // following libraries so we're sure to pass it as one of the first\n+            // arguments.\n+            \"-Wl,--as-needed\".to_string(),\n+        ],\n+    );\n+\n+    TargetOptions {\n+        dynamic_linking: false,\n+        executables: true,\n+        linker_is_gnu: true,\n+        has_rpath: false,\n+        pre_link_args: args,\n+        position_independent_executables: false,\n+        ..Default::default()\n+    }\n+}"}, {"sha": "0354f7850f5bfbd3545ccdfb9a348f12e29dddf9", "filename": "src/libstd/env.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibstd%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Flibstd%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fenv.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -874,6 +874,7 @@ pub mod consts {\n     /// - x86_64\n     /// - arm\n     /// - aarch64\n+    /// - avr\n     /// - mips\n     /// - mips64\n     /// - powerpc\n@@ -986,6 +987,11 @@ mod arch {\n     pub const ARCH: &str = \"aarch64\";\n }\n \n+#[cfg(target_arch = \"avr\")]\n+mod arch {\n+    pub const ARCH: &'static str = \"avr\";\n+}\n+\n #[cfg(target_arch = \"mips\")]\n mod arch {\n     pub const ARCH: &str = \"mips\";"}, {"sha": "3d252fe70afebaba44760c9c2b71da88ed09ecc2", "filename": "src/rustllvm/PassWrapper.cpp", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Frustllvm%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Frustllvm%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FPassWrapper.cpp?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -203,6 +203,12 @@ void LLVMRustAddLastExtensionPasses(\n #define SUBTARGET_AARCH64\n #endif\n \n+#ifdef LLVM_COMPONENT_AVR\n+#define SUBTARGET_AVR SUBTARGET(AVR)\n+#else\n+#define SUBTARGET_AVR\n+#endif\n+\n #ifdef LLVM_COMPONENT_MIPS\n #define SUBTARGET_MIPS SUBTARGET(Mips)\n #else\n@@ -249,6 +255,7 @@ void LLVMRustAddLastExtensionPasses(\n   SUBTARGET_X86                                                                \\\n   SUBTARGET_ARM                                                                \\\n   SUBTARGET_AARCH64                                                            \\\n+  SUBTARGET_AVR                                                                \\\n   SUBTARGET_MIPS                                                               \\\n   SUBTARGET_PPC                                                                \\\n   SUBTARGET_SYSTEMZ                                                            \\"}, {"sha": "0d7df8182c45819ab34fd211dc26cfbba2d2d022", "filename": "src/test/ui/feature-gates/feature-gate-abi-avr-interrupt.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -0,0 +1,9 @@\n+// Test that the AVR interrupt ABI cannot be used when avr_interrupt\n+// feature gate is not used.\n+\n+extern \"avr-interrupt\" fn foo() {}\n+//~^ ERROR avr-interrupt and avr-non-blocking-interrupt ABIs are experimental and subject to change\n+\n+fn main() {\n+    foo();\n+}"}, {"sha": "023b6121784f7420e57c4710d0be485c07609f16", "filename": "src/test/ui/feature-gates/feature-gate-abi-avr-interrupt.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-abi-avr-interrupt.stderr?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -0,0 +1,11 @@\n+error[E0658]: avr-interrupt and avr-non-blocking-interrupt ABIs are experimental and subject to change\n+  --> $DIR/feature-gate-abi-avr-interrupt.rs:14:1\n+   |\n+LL | extern \"avr-interrupt\" fn foo() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: add #![feature(abi_avr_interrupt)] to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "e1c3042edb80f888b9c4f989c465b97941e0ec00", "filename": "src/tools/compiletest/src/util.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/690bb8af510c0cf4099eac512127948180dbc792/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs?ref=690bb8af510c0cf4099eac512127948180dbc792", "patch": "@@ -47,6 +47,7 @@ const ARCH_TABLE: &'static [(&'static str, &'static str)] = &[\n     (\"armv7\", \"arm\"),\n     (\"armv7s\", \"arm\"),\n     (\"asmjs\", \"asmjs\"),\n+    (\"avr\", \"avr\"),\n     (\"hexagon\", \"hexagon\"),\n     (\"i386\", \"x86\"),\n     (\"i586\", \"x86\"),"}]}