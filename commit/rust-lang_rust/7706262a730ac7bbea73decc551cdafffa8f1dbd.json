{"sha": "7706262a730ac7bbea73decc551cdafffa8f1dbd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3MDYyNjJhNzMwYWM3YmJlYTczZGVjYzU1MWNkYWZmZmE4ZjFkYmQ=", "commit": {"author": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-06-26T21:27:09Z"}, "committer": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-08-24T21:01:27Z"}, "message": "rustc: Add flag for enabling GC.", "tree": {"sha": "13843fbc5db4349297b157a4986dfc667c1e32c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/13843fbc5db4349297b157a4986dfc667c1e32c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7706262a730ac7bbea73decc551cdafffa8f1dbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7706262a730ac7bbea73decc551cdafffa8f1dbd", "html_url": "https://github.com/rust-lang/rust/commit/7706262a730ac7bbea73decc551cdafffa8f1dbd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7706262a730ac7bbea73decc551cdafffa8f1dbd/comments", "author": null, "committer": null, "parents": [{"sha": "30768d3609d905439a129e7e9bf4571b38e321f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/30768d3609d905439a129e7e9bf4571b38e321f3", "html_url": "https://github.com/rust-lang/rust/commit/30768d3609d905439a129e7e9bf4571b38e321f3"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "087c6c3b833d36b002461ae7f4e3d995e77c857b", "filename": "src/rustc/driver/driver.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fdriver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fdriver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fdriver%2Fdriver.rs?ref=7706262a730ac7bbea73decc551cdafffa8f1dbd", "patch": "@@ -421,6 +421,7 @@ fn build_session_options(matches: getopts::matches,\n         session::unknown_crate\n     };\n     let static = opt_present(matches, ~\"static\");\n+    let gc = opt_present(matches, ~\"gc\");\n \n     let parse_only = opt_present(matches, ~\"parse-only\");\n     let no_trans = opt_present(matches, ~\"no-trans\");\n@@ -519,6 +520,7 @@ fn build_session_options(matches: getopts::matches,\n     let sopts: @session::options =\n         @{crate_type: crate_type,\n           static: static,\n+          gc: gc,\n           optimize: opt_level,\n           debuginfo: debuginfo,\n           extra_debuginfo: extra_debuginfo,"}, {"sha": "cd663c06ce77b8d563b2ec0d601f1538808495df", "filename": "src/rustc/driver/session.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fdriver%2Fsession.rs?ref=7706262a730ac7bbea73decc551cdafffa8f1dbd", "patch": "@@ -82,6 +82,7 @@ type options =\n     // with additional crate configurations during the compile process\n     {crate_type: crate_type,\n      static: bool,\n+     gc: bool,\n      optimize: OptLevel,\n      debuginfo: bool,\n      extra_debuginfo: bool,\n@@ -221,6 +222,7 @@ fn basic_options() -> @options {\n     @{\n         crate_type: session::lib_crate,\n         static: false,\n+        gc: false,\n         optimize: No,\n         debuginfo: false,\n         extra_debuginfo: false,"}, {"sha": "1f1e204d54eebc0e013227dcac6fbac2d8d6be48", "filename": "src/rustc/middle/trans/base.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7706262a730ac7bbea73decc551cdafffa8f1dbd/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=7706262a730ac7bbea73decc551cdafffa8f1dbd", "patch": "@@ -4792,6 +4792,13 @@ fn trans_closure(ccx: @crate_ctxt, path: path, decl: ast::fn_decl,\n                                   some(body.span));\n     create_llargs_for_fn_args(fcx, ty_self, decl.inputs);\n \n+    // Set GC for function.\n+    if ccx.sess.opts.gc {\n+        do str::as_c_str(\"generic\") |strategy| {\n+            llvm::LLVMSetGC(fcx.llfn, strategy);\n+        }\n+    }\n+\n     // Create the first basic block in the function and keep a handle on it to\n     //  pass to finish_fn later.\n     let bcx_top = top_scope_block(fcx, body.info());"}]}