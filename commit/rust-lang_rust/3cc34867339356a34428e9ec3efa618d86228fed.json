{"sha": "3cc34867339356a34428e9ec3efa618d86228fed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjYzM0ODY3MzM5MzU2YTM0NDI4ZTllYzNlZmE2MThkODYyMjhmZWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-24T05:00:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-24T05:00:10Z"}, "message": "Auto merge of #62075 - Centril:guardless-match-arms, r=petrochenkov\n\nRemove `ast::Guard`\n\nWith the introduction of `ast::ExprKind::Let` in https://github.com/rust-lang/rust/pull/60861, the `ast::Guard` structure is now redundant in terms of representing [`if let` guards](https://github.com/rust-lang/rust/issues/51114) in AST since it can be represented by `ExprKind::Let` syntactically. Therefore, we remove `ast::Guard` here.\n\nHowever, we keep `hir::Guard` because the semantic representation is a different matter and this story is more unclear right now (might involve `goto 'arm` in HIR or something...).\n\nr? @petrochenkov", "tree": {"sha": "bbfaf3093c4a894726e09107b8d385225c40795e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbfaf3093c4a894726e09107b8d385225c40795e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3cc34867339356a34428e9ec3efa618d86228fed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3cc34867339356a34428e9ec3efa618d86228fed", "html_url": "https://github.com/rust-lang/rust/commit/3cc34867339356a34428e9ec3efa618d86228fed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3cc34867339356a34428e9ec3efa618d86228fed/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "85ed21e83c9f42203cfe06d41eab3f160bd13518", "url": "https://api.github.com/repos/rust-lang/rust/commits/85ed21e83c9f42203cfe06d41eab3f160bd13518", "html_url": "https://github.com/rust-lang/rust/commit/85ed21e83c9f42203cfe06d41eab3f160bd13518"}, {"sha": "4d537141835f825892e2be868620e98585b3d4a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d537141835f825892e2be868620e98585b3d4a9", "html_url": "https://github.com/rust-lang/rust/commit/4d537141835f825892e2be868620e98585b3d4a9"}], "stats": {"total": 50, "additions": 14, "deletions": 36}, "files": [{"sha": "e1d0d5a1c7af2e21ef067ab51981faddace05aef", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -1382,7 +1382,7 @@ impl<'a> LoweringContext<'a> {\n             attrs: self.lower_attrs(&arm.attrs),\n             pats: arm.pats.iter().map(|x| self.lower_pat(x)).collect(),\n             guard: match arm.guard {\n-                Some(Guard::If(ref x)) => Some(hir::Guard::If(P(self.lower_expr(x)))),\n+                Some(ref x) => Some(hir::Guard::If(P(self.lower_expr(x)))),\n                 _ => None,\n             },\n             body: P(self.lower_expr(&arm.body)),"}, {"sha": "3b418d0dbb665457ce97c85562947072747e85fc", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -3055,7 +3055,7 @@ impl<'a> Resolver<'a> {\n \n         self.resolve_pats(&arm.pats, PatternSource::Match);\n \n-        if let Some(ast::Guard::If(ref expr)) = arm.guard {\n+        if let Some(ref expr) = arm.guard {\n             self.visit_expr(expr)\n         }\n         self.visit_expr(&arm.body);"}, {"sha": "beef9f151cf008846252f61ebddcaffdad41ecb9", "filename": "src/librustc_save_analysis/dump_visitor.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fdump_visitor.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -1609,9 +1609,8 @@ impl<'l, 'tcx, 'll, O: DumpOutput + 'll> Visitor<'l> for DumpVisitor<'l, 'tcx, '\n \n     fn visit_arm(&mut self, arm: &'l ast::Arm) {\n         self.process_var_decl_multi(&arm.pats);\n-        match arm.guard {\n-            Some(ast::Guard::If(ref expr)) => self.visit_expr(expr),\n-            _ => {}\n+        if let Some(expr) = &arm.guard {\n+            self.visit_expr(expr);\n         }\n         self.visit_expr(&arm.body);\n     }"}, {"sha": "f2fac16db01d24b3ad997e9fa254565c9b4f0f3f", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -893,16 +893,11 @@ pub struct Local {\n pub struct Arm {\n     pub attrs: Vec<Attribute>,\n     pub pats: Vec<P<Pat>>,\n-    pub guard: Option<Guard>,\n+    pub guard: Option<P<Expr>>,\n     pub body: P<Expr>,\n     pub span: Span,\n }\n \n-#[derive(Clone, RustcEncodable, RustcDecodable, Debug)]\n-pub enum Guard {\n-    If(P<Expr>),\n-}\n-\n #[derive(Clone, RustcEncodable, RustcDecodable, Debug)]\n pub struct Field {\n     pub ident: Ident,"}, {"sha": "e23bc025f6e31c82b313c9b20b597551a2f6d40f", "filename": "src/libsyntax/mut_visit.rs", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fmut_visit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fmut_visit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fmut_visit.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -131,10 +131,6 @@ pub trait MutVisitor: Sized {\n         noop_visit_arm(a, self);\n     }\n \n-    fn visit_guard(&mut self, g: &mut Guard) {\n-        noop_visit_guard(g, self);\n-    }\n-\n     fn visit_pat(&mut self, p: &mut P<Pat>) {\n         noop_visit_pat(p, self);\n     }\n@@ -389,17 +385,11 @@ pub fn noop_visit_arm<T: MutVisitor>(\n ) {\n     visit_attrs(attrs, vis);\n     visit_vec(pats, |pat| vis.visit_pat(pat));\n-    visit_opt(guard, |guard| vis.visit_guard(guard));\n+    visit_opt(guard, |guard| vis.visit_expr(guard));\n     vis.visit_expr(body);\n     vis.visit_span(span);\n }\n \n-pub fn noop_visit_guard<T: MutVisitor>(g: &mut Guard, vis: &mut T) {\n-    match g {\n-        Guard::If(e) => vis.visit_expr(e),\n-    }\n-}\n-\n pub fn noop_visit_ty_constraint<T: MutVisitor>(\n     AssocTyConstraint { id, ident, kind, span }: &mut AssocTyConstraint,\n     vis: &mut T"}, {"sha": "f3ace84162ed096bc91d929ecdc6fac0ae17e8a4", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -3,7 +3,7 @@\n use crate::ast::{AngleBracketedArgs, ParenthesizedArgs, AttrStyle, BareFnTy};\n use crate::ast::{GenericBound, TraitBoundModifier};\n use crate::ast::Unsafety;\n-use crate::ast::{Mod, AnonConst, Arg, Arm, Guard, Attribute, BindingMode, TraitItemKind};\n+use crate::ast::{Mod, AnonConst, Arg, Arm, Attribute, BindingMode, TraitItemKind};\n use crate::ast::Block;\n use crate::ast::{BlockCheckMode, CaptureBy, Movability};\n use crate::ast::{Constness, Crate};\n@@ -3396,7 +3396,7 @@ impl<'a> Parser<'a> {\n         let lo = self.token.span;\n         let pats = self.parse_pats()?;\n         let guard = if self.eat_keyword(kw::If) {\n-            Some(Guard::If(self.parse_expr()?))\n+            Some(self.parse_expr()?)\n         } else {\n             None\n         };"}, {"sha": "3f059927e57fe9429628a95958762bab3de22e33", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -2653,14 +2653,10 @@ impl<'a> State<'a> {\n         self.print_outer_attributes(&arm.attrs)?;\n         self.print_pats(&arm.pats)?;\n         self.s.space()?;\n-        if let Some(ref g) = arm.guard {\n-            match g {\n-                ast::Guard::If(ref e) => {\n-                    self.word_space(\"if\")?;\n-                    self.print_expr(e)?;\n-                    self.s.space()?;\n-                }\n-            }\n+        if let Some(ref e) = arm.guard {\n+            self.word_space(\"if\")?;\n+            self.print_expr(e)?;\n+            self.s.space()?;\n         }\n         self.word_space(\"=>\")?;\n "}, {"sha": "9ec9550f93ab93f1d42c44ade154f630c80ac6ec", "filename": "src/libsyntax/visit.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3cc34867339356a34428e9ec3efa618d86228fed/src%2Flibsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fvisit.rs?ref=3cc34867339356a34428e9ec3efa618d86228fed", "patch": "@@ -826,10 +826,8 @@ pub fn walk_expr<'a, V: Visitor<'a>>(visitor: &mut V, expression: &'a Expr) {\n \n pub fn walk_arm<'a, V: Visitor<'a>>(visitor: &mut V, arm: &'a Arm) {\n     walk_list!(visitor, visit_pat, &arm.pats);\n-    if let Some(ref g) = &arm.guard {\n-        match g {\n-            Guard::If(ref e) => visitor.visit_expr(e),\n-        }\n+    if let Some(ref e) = &arm.guard {\n+        visitor.visit_expr(e);\n     }\n     visitor.visit_expr(&arm.body);\n     walk_list!(visitor, visit_attribute, &arm.attrs);"}]}