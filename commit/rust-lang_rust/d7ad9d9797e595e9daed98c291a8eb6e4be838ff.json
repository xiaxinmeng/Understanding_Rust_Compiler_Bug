{"sha": "d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "node_id": "C_kwDOAAsO6NoAKGQ3YWQ5ZDk3OTdlNTk1ZTlkYWVkOThjMjkxYThlYjZlNGJlODM4ZmY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-06-09T12:44:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-06-09T12:44:23Z"}, "message": "Auto merge of #111530 - Urgau:uplift_undropped_manually_drops, r=compiler-errors\n\nUplift `clippy::undropped_manually_drops` lint\n\nThis PR aims at uplifting the `clippy::undropped_manually_drops` lint.\n\n## `undropped_manually_drops`\n\n(warn-by-default)\n\nThe `undropped_manually_drops` lint check for calls to `std::mem::drop` with a value of `std::mem::ManuallyDrop` which doesn't drop.\n\n### Example\n\n```rust\nstruct S;\ndrop(std::mem::ManuallyDrop::new(S));\n```\n\n### Explanation\n\n`ManuallyDrop` does not drop it's inner value so calling `std::mem::drop` will not drop the inner value of the `ManuallyDrop` either.\n\n-----\n\nMostly followed the instructions for uplifting an clippy lint described here: https://github.com/rust-lang/rust/pull/99696#pullrequestreview-1134072751\n\n`@rustbot` label: +I-lang-nominated\nr? compiler\n\n-----\n\nFor Clippy:\n\nchangelog: Moves: Uplifted `clippy::undropped_manually_drops` into rustc", "tree": {"sha": "6fe254364a22c6d35a5b45db60e8cab0d7fb78cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6fe254364a22c6d35a5b45db60e8cab0d7fb78cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "html_url": "https://github.com/rust-lang/rust/commit/d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "343ad6f0596fa3222f3168b74b3e8571066e77bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/343ad6f0596fa3222f3168b74b3e8571066e77bb", "html_url": "https://github.com/rust-lang/rust/commit/343ad6f0596fa3222f3168b74b3e8571066e77bb"}, {"sha": "d9d1c76ded359089e97b3bb30c5b26ffd5c17396", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9d1c76ded359089e97b3bb30c5b26ffd5c17396", "html_url": "https://github.com/rust-lang/rust/commit/d9d1c76ded359089e97b3bb30c5b26ffd5c17396"}], "stats": {"total": 333, "additions": 192, "deletions": 141}, "files": [{"sha": "51eb8210d46d5bb706a0b81797482ea2e70784b5", "filename": "compiler/rustc_lint/messages.ftl", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fmessages.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fmessages.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fmessages.ftl?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -492,6 +492,10 @@ lint_tykind = usage of `ty::TyKind`\n lint_tykind_kind = usage of `ty::TyKind::<kind>`\n     .suggestion = try using `ty::<kind>` directly\n \n+lint_undropped_manually_drops = calls to `std::mem::drop` with `std::mem::ManuallyDrop` instead of the inner value does nothing\n+    .label = argument has type `{$arg_ty}`\n+    .suggestion = use `std::mem::ManuallyDrop::into_inner` to get the inner value\n+\n lint_ungated_async_fn_track_caller = `#[track_caller]` on async functions is a no-op\n      .label = this function will not propagate the caller location\n "}, {"sha": "4cea6169dc3d98d6fce91dbb70dd75ef35ef395a", "filename": "compiler/rustc_lint/src/drop_forget_useless.rs", "status": "modified", "additions": 42, "deletions": 2, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fsrc%2Fdrop_forget_useless.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fsrc%2Fdrop_forget_useless.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fdrop_forget_useless.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -1,8 +1,12 @@\n use rustc_hir::{Arm, Expr, ExprKind, Node};\n+use rustc_middle::ty;\n use rustc_span::sym;\n \n use crate::{\n-    lints::{DropCopyDiag, DropRefDiag, ForgetCopyDiag, ForgetRefDiag},\n+    lints::{\n+        DropCopyDiag, DropRefDiag, ForgetCopyDiag, ForgetRefDiag, UndroppedManuallyDropsDiag,\n+        UndroppedManuallyDropsSuggestion,\n+    },\n     LateContext, LateLintPass, LintContext,\n };\n \n@@ -109,7 +113,29 @@ declare_lint! {\n     \"calls to `std::mem::forget` with a value that implements Copy\"\n }\n \n-declare_lint_pass!(DropForgetUseless => [DROPPING_REFERENCES, FORGETTING_REFERENCES, DROPPING_COPY_TYPES, FORGETTING_COPY_TYPES]);\n+declare_lint! {\n+    /// The `undropped_manually_drops` lint check for calls to `std::mem::drop` with\n+    /// a value of `std::mem::ManuallyDrop` which doesn't drop.\n+    ///\n+    /// ### Example\n+    ///\n+    /// ```rust,compile_fail\n+    /// struct S;\n+    /// drop(std::mem::ManuallyDrop::new(S));\n+    /// ```\n+    ///\n+    /// {{produces}}\n+    ///\n+    /// ### Explanation\n+    ///\n+    /// `ManuallyDrop` does not drop it's inner value so calling `std::mem::drop` will\n+    /// not drop the inner value of the `ManuallyDrop` either.\n+    pub UNDROPPED_MANUALLY_DROPS,\n+    Deny,\n+    \"calls to `std::mem::drop` with `std::mem::ManuallyDrop` instead of it's inner value\"\n+}\n+\n+declare_lint_pass!(DropForgetUseless => [DROPPING_REFERENCES, FORGETTING_REFERENCES, DROPPING_COPY_TYPES, FORGETTING_COPY_TYPES, UNDROPPED_MANUALLY_DROPS]);\n \n impl<'tcx> LateLintPass<'tcx> for DropForgetUseless {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'tcx>) {\n@@ -134,6 +160,20 @@ impl<'tcx> LateLintPass<'tcx> for DropForgetUseless {\n                 sym::mem_forget if is_copy => {\n                     cx.emit_spanned_lint(FORGETTING_COPY_TYPES, expr.span, ForgetCopyDiag { arg_ty, label: arg.span });\n                 }\n+                sym::mem_drop if let ty::Adt(adt, _) = arg_ty.kind() && adt.is_manually_drop() => {\n+                    cx.emit_spanned_lint(\n+                        UNDROPPED_MANUALLY_DROPS,\n+                        expr.span,\n+                        UndroppedManuallyDropsDiag {\n+                            arg_ty,\n+                            label: arg.span,\n+                            suggestion: UndroppedManuallyDropsSuggestion {\n+                                start_span: arg.span.shrink_to_lo(),\n+                                end_span: arg.span.shrink_to_hi()\n+                            }\n+                        }\n+                    );\n+                }\n                 _ => return,\n             };\n         }"}, {"sha": "03dbffcc2c435dc8f5e376bcdc919d8e3b2c8106", "filename": "compiler/rustc_lint/src/lints.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flints.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -699,6 +699,25 @@ pub struct ForgetCopyDiag<'a> {\n     pub label: Span,\n }\n \n+#[derive(LintDiagnostic)]\n+#[diag(lint_undropped_manually_drops)]\n+pub struct UndroppedManuallyDropsDiag<'a> {\n+    pub arg_ty: Ty<'a>,\n+    #[label]\n+    pub label: Span,\n+    #[subdiagnostic]\n+    pub suggestion: UndroppedManuallyDropsSuggestion,\n+}\n+\n+#[derive(Subdiagnostic)]\n+#[multipart_suggestion(lint_suggestion, applicability = \"machine-applicable\")]\n+pub struct UndroppedManuallyDropsSuggestion {\n+    #[suggestion_part(code = \"std::mem::ManuallyDrop::into_inner(\")]\n+    pub start_span: Span,\n+    #[suggestion_part(code = \")\")]\n+    pub end_span: Span,\n+}\n+\n // invalid_from_utf8.rs\n #[derive(LintDiagnostic)]\n pub enum InvalidFromUtf8Diag {"}, {"sha": "22d72d219a7584a52399d165d7f9a0b5ae5f18fc", "filename": "library/core/tests/manually_drop.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/library%2Fcore%2Ftests%2Fmanually_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/library%2Fcore%2Ftests%2Fmanually_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fmanually_drop.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -1,3 +1,5 @@\n+#![cfg_attr(not(bootstrap), allow(undropped_manually_drops))]\n+\n use core::mem::ManuallyDrop;\n \n #[test]"}, {"sha": "6270d2613132399f1bc06d95d3c1c37391da2b5e", "filename": "src/tools/clippy/clippy_lints/src/declared_lints.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdeclared_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdeclared_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdeclared_lints.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -136,7 +136,6 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::double_parens::DOUBLE_PARENS_INFO,\n     crate::drop_forget_ref::DROP_NON_DROP_INFO,\n     crate::drop_forget_ref::FORGET_NON_DROP_INFO,\n-    crate::drop_forget_ref::UNDROPPED_MANUALLY_DROPS_INFO,\n     crate::duplicate_mod::DUPLICATE_MOD_INFO,\n     crate::else_if_without_else::ELSE_IF_WITHOUT_ELSE_INFO,\n     crate::empty_drop::EMPTY_DROP_INFO,"}, {"sha": "7a4b9a87aeb47c008bba42d122e71a6ff8d35428", "filename": "src/tools/clippy/clippy_lints/src/drop_forget_ref.rs", "status": "modified", "additions": 2, "deletions": 42, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdrop_forget_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdrop_forget_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdrop_forget_ref.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -1,4 +1,4 @@\n-use clippy_utils::diagnostics::{span_lint_and_help, span_lint_and_note};\n+use clippy_utils::diagnostics::span_lint_and_note;\n use clippy_utils::get_parent_node;\n use clippy_utils::is_must_use_func_call;\n use clippy_utils::ty::{is_copy, is_must_use_ty, is_type_lang_item};\n@@ -47,35 +47,6 @@ declare_clippy_lint! {\n     \"call to `std::mem::forget` with a value which does not implement `Drop`\"\n }\n \n-declare_clippy_lint! {\n-    /// ### What it does\n-    /// Prevents the safe `std::mem::drop` function from being called on `std::mem::ManuallyDrop`.\n-    ///\n-    /// ### Why is this bad?\n-    /// The safe `drop` function does not drop the inner value of a `ManuallyDrop`.\n-    ///\n-    /// ### Known problems\n-    /// Does not catch cases if the user binds `std::mem::drop`\n-    /// to a different name and calls it that way.\n-    ///\n-    /// ### Example\n-    /// ```rust\n-    /// struct S;\n-    /// drop(std::mem::ManuallyDrop::new(S));\n-    /// ```\n-    /// Use instead:\n-    /// ```rust\n-    /// struct S;\n-    /// unsafe {\n-    ///     std::mem::ManuallyDrop::drop(&mut std::mem::ManuallyDrop::new(S));\n-    /// }\n-    /// ```\n-    #[clippy::version = \"1.49.0\"]\n-    pub UNDROPPED_MANUALLY_DROPS,\n-    correctness,\n-    \"use of safe `std::mem::drop` function to drop a std::mem::ManuallyDrop, which will not drop the inner value\"\n-}\n-\n const DROP_NON_DROP_SUMMARY: &str = \"call to `std::mem::drop` with a value that does not implement `Drop`. \\\n                                  Dropping such a type only extends its contained lifetimes\";\n const FORGET_NON_DROP_SUMMARY: &str = \"call to `std::mem::forget` with a value that does not implement `Drop`. \\\n@@ -84,7 +55,6 @@ const FORGET_NON_DROP_SUMMARY: &str = \"call to `std::mem::forget` with a value t\n declare_lint_pass!(DropForgetRef => [\n     DROP_NON_DROP,\n     FORGET_NON_DROP,\n-    UNDROPPED_MANUALLY_DROPS\n ]);\n \n impl<'tcx> LateLintPass<'tcx> for DropForgetRef {\n@@ -103,17 +73,7 @@ impl<'tcx> LateLintPass<'tcx> for DropForgetRef {\n                 sym::mem_forget if arg_ty.is_ref() => return,\n                 sym::mem_drop if is_copy && !drop_is_single_call_in_arm => return,\n                 sym::mem_forget if is_copy => return,\n-                sym::mem_drop if is_type_lang_item(cx, arg_ty, LangItem::ManuallyDrop) => {\n-                    span_lint_and_help(\n-                        cx,\n-                        UNDROPPED_MANUALLY_DROPS,\n-                        expr.span,\n-                        \"the inner value of this ManuallyDrop will not be dropped\",\n-                        None,\n-                        \"to drop a `ManuallyDrop<T>`, use std::mem::ManuallyDrop::drop\",\n-                    );\n-                    return;\n-                }\n+                sym::mem_drop if is_type_lang_item(cx, arg_ty, LangItem::ManuallyDrop) => return,\n                 sym::mem_drop\n                     if !(arg_ty.needs_drop(cx.tcx, cx.param_env)\n                         || is_must_use_func_call(cx, arg)"}, {"sha": "f76fa76f0764e71715d0ee1eb55891c767967011", "filename": "src/tools/clippy/clippy_lints/src/renamed_lints.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Frenamed_lints.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -50,6 +50,7 @@ pub static RENAMED_LINTS: &[(&str, &str)] = &[\n     (\"clippy::panic_params\", \"non_fmt_panics\"),\n     (\"clippy::positional_named_format_parameters\", \"named_arguments_used_positionally\"),\n     (\"clippy::temporary_cstring_as_ptr\", \"temporary_cstring_as_ptr\"),\n+    (\"clippy::undropped_manually_drops\", \"undropped_manually_drops\"),\n     (\"clippy::unknown_clippy_lints\", \"unknown_lints\"),\n     (\"clippy::unused_label\", \"unused_labels\"),\n ];"}, {"sha": "954145fc4e64bf42c6a2e3a48c71fd98e5978606", "filename": "src/tools/clippy/tests/ui/rename.fixed", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.fixed?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -47,6 +47,7 @@\n #![allow(named_arguments_used_positionally)]\n #![allow(suspicious_double_ref_op)]\n #![allow(temporary_cstring_as_ptr)]\n+#![allow(undropped_manually_drops)]\n #![allow(unknown_lints)]\n #![allow(unused_labels)]\n #![warn(clippy::almost_complete_range)]\n@@ -97,6 +98,7 @@\n #![warn(non_fmt_panics)]\n #![warn(named_arguments_used_positionally)]\n #![warn(temporary_cstring_as_ptr)]\n+#![warn(undropped_manually_drops)]\n #![warn(unknown_lints)]\n #![warn(unused_labels)]\n "}, {"sha": "067a3109afb97785c93b08f3d208da6e6839b4a4", "filename": "src/tools/clippy/tests/ui/rename.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -47,6 +47,7 @@\n #![allow(named_arguments_used_positionally)]\n #![allow(suspicious_double_ref_op)]\n #![allow(temporary_cstring_as_ptr)]\n+#![allow(undropped_manually_drops)]\n #![allow(unknown_lints)]\n #![allow(unused_labels)]\n #![warn(clippy::almost_complete_letter_range)]\n@@ -97,6 +98,7 @@\n #![warn(clippy::panic_params)]\n #![warn(clippy::positional_named_format_parameters)]\n #![warn(clippy::temporary_cstring_as_ptr)]\n+#![warn(clippy::undropped_manually_drops)]\n #![warn(clippy::unknown_clippy_lints)]\n #![warn(clippy::unused_label)]\n "}, {"sha": "1819d108c574010165e9b9780f3d5dc01d74905c", "filename": "src/tools/clippy/tests/ui/rename.stderr", "status": "modified", "additions": 57, "deletions": 51, "changes": 108, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Frename.stderr?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -1,304 +1,310 @@\n error: lint `clippy::almost_complete_letter_range` has been renamed to `clippy::almost_complete_range`\n-  --> $DIR/rename.rs:52:9\n+  --> $DIR/rename.rs:53:9\n    |\n LL | #![warn(clippy::almost_complete_letter_range)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::almost_complete_range`\n    |\n    = note: `-D renamed-and-removed-lints` implied by `-D warnings`\n \n error: lint `clippy::blacklisted_name` has been renamed to `clippy::disallowed_names`\n-  --> $DIR/rename.rs:53:9\n+  --> $DIR/rename.rs:54:9\n    |\n LL | #![warn(clippy::blacklisted_name)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_names`\n \n error: lint `clippy::block_in_if_condition_expr` has been renamed to `clippy::blocks_in_if_conditions`\n-  --> $DIR/rename.rs:54:9\n+  --> $DIR/rename.rs:55:9\n    |\n LL | #![warn(clippy::block_in_if_condition_expr)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::blocks_in_if_conditions`\n \n error: lint `clippy::block_in_if_condition_stmt` has been renamed to `clippy::blocks_in_if_conditions`\n-  --> $DIR/rename.rs:55:9\n+  --> $DIR/rename.rs:56:9\n    |\n LL | #![warn(clippy::block_in_if_condition_stmt)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::blocks_in_if_conditions`\n \n error: lint `clippy::box_vec` has been renamed to `clippy::box_collection`\n-  --> $DIR/rename.rs:56:9\n+  --> $DIR/rename.rs:57:9\n    |\n LL | #![warn(clippy::box_vec)]\n    |         ^^^^^^^^^^^^^^^ help: use the new name: `clippy::box_collection`\n \n error: lint `clippy::const_static_lifetime` has been renamed to `clippy::redundant_static_lifetimes`\n-  --> $DIR/rename.rs:57:9\n+  --> $DIR/rename.rs:58:9\n    |\n LL | #![warn(clippy::const_static_lifetime)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::redundant_static_lifetimes`\n \n error: lint `clippy::cyclomatic_complexity` has been renamed to `clippy::cognitive_complexity`\n-  --> $DIR/rename.rs:58:9\n+  --> $DIR/rename.rs:59:9\n    |\n LL | #![warn(clippy::cyclomatic_complexity)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::cognitive_complexity`\n \n error: lint `clippy::derive_hash_xor_eq` has been renamed to `clippy::derived_hash_with_manual_eq`\n-  --> $DIR/rename.rs:59:9\n+  --> $DIR/rename.rs:60:9\n    |\n LL | #![warn(clippy::derive_hash_xor_eq)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::derived_hash_with_manual_eq`\n \n error: lint `clippy::disallowed_method` has been renamed to `clippy::disallowed_methods`\n-  --> $DIR/rename.rs:60:9\n+  --> $DIR/rename.rs:61:9\n    |\n LL | #![warn(clippy::disallowed_method)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_methods`\n \n error: lint `clippy::disallowed_type` has been renamed to `clippy::disallowed_types`\n-  --> $DIR/rename.rs:61:9\n+  --> $DIR/rename.rs:62:9\n    |\n LL | #![warn(clippy::disallowed_type)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::disallowed_types`\n \n error: lint `clippy::eval_order_dependence` has been renamed to `clippy::mixed_read_write_in_expression`\n-  --> $DIR/rename.rs:62:9\n+  --> $DIR/rename.rs:63:9\n    |\n LL | #![warn(clippy::eval_order_dependence)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::mixed_read_write_in_expression`\n \n error: lint `clippy::identity_conversion` has been renamed to `clippy::useless_conversion`\n-  --> $DIR/rename.rs:63:9\n+  --> $DIR/rename.rs:64:9\n    |\n LL | #![warn(clippy::identity_conversion)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::useless_conversion`\n \n error: lint `clippy::if_let_some_result` has been renamed to `clippy::match_result_ok`\n-  --> $DIR/rename.rs:64:9\n+  --> $DIR/rename.rs:65:9\n    |\n LL | #![warn(clippy::if_let_some_result)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::match_result_ok`\n \n error: lint `clippy::integer_arithmetic` has been renamed to `clippy::arithmetic_side_effects`\n-  --> $DIR/rename.rs:65:9\n+  --> $DIR/rename.rs:66:9\n    |\n LL | #![warn(clippy::integer_arithmetic)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::arithmetic_side_effects`\n \n error: lint `clippy::logic_bug` has been renamed to `clippy::overly_complex_bool_expr`\n-  --> $DIR/rename.rs:66:9\n+  --> $DIR/rename.rs:67:9\n    |\n LL | #![warn(clippy::logic_bug)]\n    |         ^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::overly_complex_bool_expr`\n \n error: lint `clippy::new_without_default_derive` has been renamed to `clippy::new_without_default`\n-  --> $DIR/rename.rs:67:9\n+  --> $DIR/rename.rs:68:9\n    |\n LL | #![warn(clippy::new_without_default_derive)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::new_without_default`\n \n error: lint `clippy::option_and_then_some` has been renamed to `clippy::bind_instead_of_map`\n-  --> $DIR/rename.rs:68:9\n+  --> $DIR/rename.rs:69:9\n    |\n LL | #![warn(clippy::option_and_then_some)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::bind_instead_of_map`\n \n error: lint `clippy::option_expect_used` has been renamed to `clippy::expect_used`\n-  --> $DIR/rename.rs:69:9\n+  --> $DIR/rename.rs:70:9\n    |\n LL | #![warn(clippy::option_expect_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::expect_used`\n \n error: lint `clippy::option_map_unwrap_or` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:70:9\n+  --> $DIR/rename.rs:71:9\n    |\n LL | #![warn(clippy::option_map_unwrap_or)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::option_map_unwrap_or_else` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:71:9\n+  --> $DIR/rename.rs:72:9\n    |\n LL | #![warn(clippy::option_map_unwrap_or_else)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::option_unwrap_used` has been renamed to `clippy::unwrap_used`\n-  --> $DIR/rename.rs:72:9\n+  --> $DIR/rename.rs:73:9\n    |\n LL | #![warn(clippy::option_unwrap_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::unwrap_used`\n \n error: lint `clippy::ref_in_deref` has been renamed to `clippy::needless_borrow`\n-  --> $DIR/rename.rs:73:9\n+  --> $DIR/rename.rs:74:9\n    |\n LL | #![warn(clippy::ref_in_deref)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::needless_borrow`\n \n error: lint `clippy::result_expect_used` has been renamed to `clippy::expect_used`\n-  --> $DIR/rename.rs:74:9\n+  --> $DIR/rename.rs:75:9\n    |\n LL | #![warn(clippy::result_expect_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::expect_used`\n \n error: lint `clippy::result_map_unwrap_or_else` has been renamed to `clippy::map_unwrap_or`\n-  --> $DIR/rename.rs:75:9\n+  --> $DIR/rename.rs:76:9\n    |\n LL | #![warn(clippy::result_map_unwrap_or_else)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::map_unwrap_or`\n \n error: lint `clippy::result_unwrap_used` has been renamed to `clippy::unwrap_used`\n-  --> $DIR/rename.rs:76:9\n+  --> $DIR/rename.rs:77:9\n    |\n LL | #![warn(clippy::result_unwrap_used)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::unwrap_used`\n \n error: lint `clippy::single_char_push_str` has been renamed to `clippy::single_char_add_str`\n-  --> $DIR/rename.rs:77:9\n+  --> $DIR/rename.rs:78:9\n    |\n LL | #![warn(clippy::single_char_push_str)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::single_char_add_str`\n \n error: lint `clippy::stutter` has been renamed to `clippy::module_name_repetitions`\n-  --> $DIR/rename.rs:78:9\n+  --> $DIR/rename.rs:79:9\n    |\n LL | #![warn(clippy::stutter)]\n    |         ^^^^^^^^^^^^^^^ help: use the new name: `clippy::module_name_repetitions`\n \n error: lint `clippy::to_string_in_display` has been renamed to `clippy::recursive_format_impl`\n-  --> $DIR/rename.rs:79:9\n+  --> $DIR/rename.rs:80:9\n    |\n LL | #![warn(clippy::to_string_in_display)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::recursive_format_impl`\n \n error: lint `clippy::zero_width_space` has been renamed to `clippy::invisible_characters`\n-  --> $DIR/rename.rs:80:9\n+  --> $DIR/rename.rs:81:9\n    |\n LL | #![warn(clippy::zero_width_space)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `clippy::invisible_characters`\n \n error: lint `clippy::cast_ref_to_mut` has been renamed to `cast_ref_to_mut`\n-  --> $DIR/rename.rs:81:9\n+  --> $DIR/rename.rs:82:9\n    |\n LL | #![warn(clippy::cast_ref_to_mut)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `cast_ref_to_mut`\n \n error: lint `clippy::clone_double_ref` has been renamed to `suspicious_double_ref_op`\n-  --> $DIR/rename.rs:82:9\n+  --> $DIR/rename.rs:83:9\n    |\n LL | #![warn(clippy::clone_double_ref)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `suspicious_double_ref_op`\n \n error: lint `clippy::drop_bounds` has been renamed to `drop_bounds`\n-  --> $DIR/rename.rs:83:9\n+  --> $DIR/rename.rs:84:9\n    |\n LL | #![warn(clippy::drop_bounds)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `drop_bounds`\n \n error: lint `clippy::drop_copy` has been renamed to `dropping_copy_types`\n-  --> $DIR/rename.rs:84:9\n+  --> $DIR/rename.rs:85:9\n    |\n LL | #![warn(clippy::drop_copy)]\n    |         ^^^^^^^^^^^^^^^^^ help: use the new name: `dropping_copy_types`\n \n error: lint `clippy::drop_ref` has been renamed to `dropping_references`\n-  --> $DIR/rename.rs:85:9\n+  --> $DIR/rename.rs:86:9\n    |\n LL | #![warn(clippy::drop_ref)]\n    |         ^^^^^^^^^^^^^^^^ help: use the new name: `dropping_references`\n \n error: lint `clippy::for_loop_over_option` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:86:9\n+  --> $DIR/rename.rs:87:9\n    |\n LL | #![warn(clippy::for_loop_over_option)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::for_loop_over_result` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:87:9\n+  --> $DIR/rename.rs:88:9\n    |\n LL | #![warn(clippy::for_loop_over_result)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::for_loops_over_fallibles` has been renamed to `for_loops_over_fallibles`\n-  --> $DIR/rename.rs:88:9\n+  --> $DIR/rename.rs:89:9\n    |\n LL | #![warn(clippy::for_loops_over_fallibles)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `for_loops_over_fallibles`\n \n error: lint `clippy::forget_copy` has been renamed to `forgetting_copy_types`\n-  --> $DIR/rename.rs:89:9\n+  --> $DIR/rename.rs:90:9\n    |\n LL | #![warn(clippy::forget_copy)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `forgetting_copy_types`\n \n error: lint `clippy::forget_ref` has been renamed to `forgetting_references`\n-  --> $DIR/rename.rs:90:9\n+  --> $DIR/rename.rs:91:9\n    |\n LL | #![warn(clippy::forget_ref)]\n    |         ^^^^^^^^^^^^^^^^^^ help: use the new name: `forgetting_references`\n \n error: lint `clippy::into_iter_on_array` has been renamed to `array_into_iter`\n-  --> $DIR/rename.rs:91:9\n+  --> $DIR/rename.rs:92:9\n    |\n LL | #![warn(clippy::into_iter_on_array)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `array_into_iter`\n \n error: lint `clippy::invalid_atomic_ordering` has been renamed to `invalid_atomic_ordering`\n-  --> $DIR/rename.rs:92:9\n+  --> $DIR/rename.rs:93:9\n    |\n LL | #![warn(clippy::invalid_atomic_ordering)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_atomic_ordering`\n \n error: lint `clippy::invalid_ref` has been renamed to `invalid_value`\n-  --> $DIR/rename.rs:93:9\n+  --> $DIR/rename.rs:94:9\n    |\n LL | #![warn(clippy::invalid_ref)]\n    |         ^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_value`\n \n error: lint `clippy::invalid_utf8_in_unchecked` has been renamed to `invalid_from_utf8_unchecked`\n-  --> $DIR/rename.rs:94:9\n+  --> $DIR/rename.rs:95:9\n    |\n LL | #![warn(clippy::invalid_utf8_in_unchecked)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `invalid_from_utf8_unchecked`\n \n error: lint `clippy::let_underscore_drop` has been renamed to `let_underscore_drop`\n-  --> $DIR/rename.rs:95:9\n+  --> $DIR/rename.rs:96:9\n    |\n LL | #![warn(clippy::let_underscore_drop)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `let_underscore_drop`\n \n error: lint `clippy::mem_discriminant_non_enum` has been renamed to `enum_intrinsics_non_enums`\n-  --> $DIR/rename.rs:96:9\n+  --> $DIR/rename.rs:97:9\n    |\n LL | #![warn(clippy::mem_discriminant_non_enum)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `enum_intrinsics_non_enums`\n \n error: lint `clippy::panic_params` has been renamed to `non_fmt_panics`\n-  --> $DIR/rename.rs:97:9\n+  --> $DIR/rename.rs:98:9\n    |\n LL | #![warn(clippy::panic_params)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `non_fmt_panics`\n \n error: lint `clippy::positional_named_format_parameters` has been renamed to `named_arguments_used_positionally`\n-  --> $DIR/rename.rs:98:9\n+  --> $DIR/rename.rs:99:9\n    |\n LL | #![warn(clippy::positional_named_format_parameters)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `named_arguments_used_positionally`\n \n error: lint `clippy::temporary_cstring_as_ptr` has been renamed to `temporary_cstring_as_ptr`\n-  --> $DIR/rename.rs:99:9\n+  --> $DIR/rename.rs:100:9\n    |\n LL | #![warn(clippy::temporary_cstring_as_ptr)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `temporary_cstring_as_ptr`\n \n+error: lint `clippy::undropped_manually_drops` has been renamed to `undropped_manually_drops`\n+  --> $DIR/rename.rs:101:9\n+   |\n+LL | #![warn(clippy::undropped_manually_drops)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `undropped_manually_drops`\n+\n error: lint `clippy::unknown_clippy_lints` has been renamed to `unknown_lints`\n-  --> $DIR/rename.rs:100:9\n+  --> $DIR/rename.rs:102:9\n    |\n LL | #![warn(clippy::unknown_clippy_lints)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unknown_lints`\n \n error: lint `clippy::unused_label` has been renamed to `unused_labels`\n-  --> $DIR/rename.rs:101:9\n+  --> $DIR/rename.rs:103:9\n    |\n LL | #![warn(clippy::unused_label)]\n    |         ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `unused_labels`\n \n-error: aborting due to 50 previous errors\n+error: aborting due to 51 previous errors\n "}, {"sha": "f4cfc92e1cd0259eddc426dce698b54ee4c7b61d", "filename": "src/tools/clippy/tests/ui/undropped_manually_drops.rs", "status": "removed", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/343ad6f0596fa3222f3168b74b3e8571066e77bb/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/343ad6f0596fa3222f3168b74b3e8571066e77bb/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.rs?ref=343ad6f0596fa3222f3168b74b3e8571066e77bb", "patch": "@@ -1,26 +0,0 @@\n-#![warn(clippy::undropped_manually_drops)]\n-\n-struct S;\n-\n-fn main() {\n-    let f = std::mem::drop;\n-    let g = std::mem::ManuallyDrop::drop;\n-    let mut manual1 = std::mem::ManuallyDrop::new(S);\n-    let mut manual2 = std::mem::ManuallyDrop::new(S);\n-    let mut manual3 = std::mem::ManuallyDrop::new(S);\n-    let mut manual4 = std::mem::ManuallyDrop::new(S);\n-\n-    // These lines will not drop `S` and should be linted\n-    drop(std::mem::ManuallyDrop::new(S));\n-    drop(manual1);\n-\n-    // FIXME: this line is not linted, though it should be\n-    f(manual2);\n-\n-    // These lines will drop `S` and should be okay.\n-    unsafe {\n-        std::mem::ManuallyDrop::drop(&mut std::mem::ManuallyDrop::new(S));\n-        std::mem::ManuallyDrop::drop(&mut manual3);\n-        g(&mut manual4);\n-    }\n-}"}, {"sha": "92611a9b7df4aec66d975aeb644807c07c5d5e5c", "filename": "src/tools/clippy/tests/ui/undropped_manually_drops.stderr", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/343ad6f0596fa3222f3168b74b3e8571066e77bb/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/343ad6f0596fa3222f3168b74b3e8571066e77bb/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fundropped_manually_drops.stderr?ref=343ad6f0596fa3222f3168b74b3e8571066e77bb", "patch": "@@ -1,19 +0,0 @@\n-error: the inner value of this ManuallyDrop will not be dropped\n-  --> $DIR/undropped_manually_drops.rs:14:5\n-   |\n-LL |     drop(std::mem::ManuallyDrop::new(S));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: to drop a `ManuallyDrop<T>`, use std::mem::ManuallyDrop::drop\n-   = note: `-D clippy::undropped-manually-drops` implied by `-D warnings`\n-\n-error: the inner value of this ManuallyDrop will not be dropped\n-  --> $DIR/undropped_manually_drops.rs:15:5\n-   |\n-LL |     drop(manual1);\n-   |     ^^^^^^^^^^^^^\n-   |\n-   = help: to drop a `ManuallyDrop<T>`, use std::mem::ManuallyDrop::drop\n-\n-error: aborting due to 2 previous errors\n-"}, {"sha": "7286121a4048323ccf31d356e5cd12fe09737529", "filename": "tests/ui/lint/undropped_manually_drops.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/tests%2Fui%2Flint%2Fundropped_manually_drops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/tests%2Fui%2Flint%2Fundropped_manually_drops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fundropped_manually_drops.rs?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -0,0 +1,19 @@\n+// check-fail\n+\n+struct S;\n+\n+fn main() {\n+    let mut manual1 = std::mem::ManuallyDrop::new(S);\n+    let mut manual2 = std::mem::ManuallyDrop::new(S);\n+    let mut manual3 = std::mem::ManuallyDrop::new(S);\n+\n+    drop(std::mem::ManuallyDrop::new(S)); //~ ERROR calls to `std::mem::drop`\n+    drop(manual1); //~ ERROR calls to `std::mem::drop`\n+    drop({ manual3 }); //~ ERROR calls to `std::mem::drop`\n+\n+    // These lines will drop `S` and should be okay.\n+    unsafe {\n+        std::mem::ManuallyDrop::drop(&mut std::mem::ManuallyDrop::new(S));\n+        std::mem::ManuallyDrop::drop(&mut manual2);\n+    }\n+}"}, {"sha": "156b647ebd3a77756ce05047e2a3fb2407bbc551", "filename": "tests/ui/lint/undropped_manually_drops.stderr", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/tests%2Fui%2Flint%2Fundropped_manually_drops.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7ad9d9797e595e9daed98c291a8eb6e4be838ff/tests%2Fui%2Flint%2Fundropped_manually_drops.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fundropped_manually_drops.stderr?ref=d7ad9d9797e595e9daed98c291a8eb6e4be838ff", "patch": "@@ -0,0 +1,42 @@\n+error: calls to `std::mem::drop` with `std::mem::ManuallyDrop` instead of the inner value does nothing\n+  --> $DIR/undropped_manually_drops.rs:10:5\n+   |\n+LL |     drop(std::mem::ManuallyDrop::new(S));\n+   |     ^^^^^------------------------------^\n+   |          |\n+   |          argument has type `ManuallyDrop<S>`\n+   |\n+   = note: `#[deny(undropped_manually_drops)]` on by default\n+help: use `std::mem::ManuallyDrop::into_inner` to get the inner value\n+   |\n+LL |     drop(std::mem::ManuallyDrop::into_inner(std::mem::ManuallyDrop::new(S)));\n+   |          +++++++++++++++++++++++++++++++++++                              +\n+\n+error: calls to `std::mem::drop` with `std::mem::ManuallyDrop` instead of the inner value does nothing\n+  --> $DIR/undropped_manually_drops.rs:11:5\n+   |\n+LL |     drop(manual1);\n+   |     ^^^^^-------^\n+   |          |\n+   |          argument has type `ManuallyDrop<S>`\n+   |\n+help: use `std::mem::ManuallyDrop::into_inner` to get the inner value\n+   |\n+LL |     drop(std::mem::ManuallyDrop::into_inner(manual1));\n+   |          +++++++++++++++++++++++++++++++++++       +\n+\n+error: calls to `std::mem::drop` with `std::mem::ManuallyDrop` instead of the inner value does nothing\n+  --> $DIR/undropped_manually_drops.rs:12:5\n+   |\n+LL |     drop({ manual3 });\n+   |     ^^^^^-----------^\n+   |          |\n+   |          argument has type `ManuallyDrop<S>`\n+   |\n+help: use `std::mem::ManuallyDrop::into_inner` to get the inner value\n+   |\n+LL |     drop(std::mem::ManuallyDrop::into_inner({ manual3 }));\n+   |          +++++++++++++++++++++++++++++++++++           +\n+\n+error: aborting due to 3 previous errors\n+"}]}