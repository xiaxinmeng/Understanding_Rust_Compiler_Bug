{"sha": "e9215bb7a97d61b5368f58fa299474a8606655d4", "node_id": "C_kwDOAAsO6NoAKGU5MjE1YmI3YTk3ZDYxYjUzNjhmNThmYTI5OTQ3NGE4NjA2NjU1ZDQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-05-23T04:42:01Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-05-23T04:42:01Z"}, "message": "Do writeback of child expressions before parent expression", "tree": {"sha": "1e638f85fbf1dfce217f2541c8f0ce19a3d4de73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e638f85fbf1dfce217f2541c8f0ce19a3d4de73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e9215bb7a97d61b5368f58fa299474a8606655d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e9215bb7a97d61b5368f58fa299474a8606655d4", "html_url": "https://github.com/rust-lang/rust/commit/e9215bb7a97d61b5368f58fa299474a8606655d4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e9215bb7a97d61b5368f58fa299474a8606655d4/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07e7b4346c48fe6d5c3026207e2d04c9a9f00fb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/07e7b4346c48fe6d5c3026207e2d04c9a9f00fb8", "html_url": "https://github.com/rust-lang/rust/commit/07e7b4346c48fe6d5c3026207e2d04c9a9f00fb8"}], "stats": {"total": 50, "additions": 43, "deletions": 7}, "files": [{"sha": "4fe5b26dc05a56d816c3216f3d913e780c1e1819", "filename": "compiler/rustc_typeck/src/check/writeback.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e9215bb7a97d61b5368f58fa299474a8606655d4/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwriteback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9215bb7a97d61b5368f58fa299474a8606655d4/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwriteback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwriteback.rs?ref=e9215bb7a97d61b5368f58fa299474a8606655d4", "patch": "@@ -263,8 +263,6 @@ impl<'cx, 'tcx> Visitor<'tcx> for WritebackCx<'cx, 'tcx> {\n         self.fix_scalar_builtin_expr(e);\n         self.fix_index_builtin_expr(e);\n \n-        self.visit_node_id(e.span, e.hir_id);\n-\n         match e.kind {\n             hir::ExprKind::Closure(_, _, body, _, _) => {\n                 let body = self.fcx.tcx.hir().body(body);\n@@ -291,6 +289,7 @@ impl<'cx, 'tcx> Visitor<'tcx> for WritebackCx<'cx, 'tcx> {\n             _ => {}\n         }\n \n+        self.visit_node_id(e.span, e.hir_id);\n         intravisit::walk_expr(self, e);\n     }\n "}, {"sha": "0089d86e340f141d055b977655452c0706f6f59b", "filename": "src/test/ui/type/type-check/unknown_type_for_closure.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e9215bb7a97d61b5368f58fa299474a8606655d4/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9215bb7a97d61b5368f58fa299474a8606655d4/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.rs?ref=e9215bb7a97d61b5368f58fa299474a8606655d4", "patch": "@@ -1,3 +1,17 @@\n-fn main() {\n-    let x = |_| {    }; //~ ERROR type annotations needed\n+fn infer_in_arg() {\n+    let x = |b: Vec<_>| {}; //~ ERROR E0282\n }\n+\n+fn empty_pattern() {\n+    let x = |_| {}; //~ ERROR type annotations needed\n+}\n+\n+fn infer_ty() {\n+    let x = |k: _| {}; //~ ERROR type annotations needed\n+}\n+\n+fn ambig_return() {\n+    let x = || -> Vec<_> { Vec::new() }; //~ ERROR type annotations needed for the closure `fn() -> Vec<_>`\n+}\n+\n+fn main() {}"}, {"sha": "c3accad5f25d9273de7bb8230a39bff568a8d619", "filename": "src/test/ui/type/type-check/unknown_type_for_closure.stderr", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/e9215bb7a97d61b5368f58fa299474a8606655d4/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e9215bb7a97d61b5368f58fa299474a8606655d4/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype%2Ftype-check%2Funknown_type_for_closure.stderr?ref=e9215bb7a97d61b5368f58fa299474a8606655d4", "patch": "@@ -1,9 +1,32 @@\n-error[E0282]: type annotations needed\n+error[E0282]: type annotations needed for `Vec<_>`\n   --> $DIR/unknown_type_for_closure.rs:2:14\n    |\n-LL |     let x = |_| {    };\n+LL |     let x = |b: Vec<_>| {};\n    |              ^ consider giving this closure parameter a type\n \n-error: aborting due to previous error\n+error[E0282]: type annotations needed\n+  --> $DIR/unknown_type_for_closure.rs:6:14\n+   |\n+LL |     let x = |_| {};\n+   |              ^ consider giving this closure parameter a type\n+\n+error[E0282]: type annotations needed\n+  --> $DIR/unknown_type_for_closure.rs:10:14\n+   |\n+LL |     let x = |k: _| {};\n+   |              ^ consider giving this closure parameter a type\n+\n+error[E0282]: type annotations needed for the closure `fn() -> Vec<_>`\n+  --> $DIR/unknown_type_for_closure.rs:14:28\n+   |\n+LL |     let x = || -> Vec<_> { Vec::new() };\n+   |                            ^^^^^^^^ cannot infer type for type parameter `T`\n+   |\n+help: give this closure an explicit return type without `_` placeholders\n+   |\n+LL |     let x = || -> Vec<_> { Vec::new() };\n+   |                   ~~~~~~\n+\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0282`."}]}