{"sha": "d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "node_id": "C_kwDOAAsO6NoAKGQzYTFhYTBiNDM4MGI3YWIyMTdhMWUyODg5YTQyMTdlNzAyMzdmNjE", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-07-14T13:54:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-14T13:54:05Z"}, "message": "Rollup merge of #99192 - Amanieu:fix-asm-srcloc, r=petrochenkov\n\nFix spans for asm diagnostics\n\nLine spans were incorrect if the first line of an asm statement was an\nempty string.", "tree": {"sha": "3efaccb42689732981456540889443ec385bc1aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3efaccb42689732981456540889443ec385bc1aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi0B/+CRBK7hj4Ov3rIwAApW0IAIxA23+zKBxTc30nkpft5/kf\nWAcHnlC1SbU0LxRS8cg0IGfXIE9JrEbb7afts1YxQ/tg9CfjVf7nCZ3Yq6+csfz8\nmN4gUdf4Z0WofX+GD+QlKTqsosV51jcKvbshujJOjKtvL0MEkfG6sewN7cBD1X91\nHsuamt2zfJkHW/zTy8Qj5pDM4nPjGrt10gMUr0MF+BeAaVTGvAgu0jSmJ6wucIHi\nMTqOb5YUWer1iaGHfPIHy1e1bIGIPDiQKwfultpsAy8GGYEZujmdhrkWEeoETSsg\n1HQvCX6lhB2ahYjVUx68NfDIWi0xwiFGR1Dil5gx2YUxlEz8PZFI0ovGf7owcJw=\n=bRS9\n-----END PGP SIGNATURE-----\n", "payload": "tree 3efaccb42689732981456540889443ec385bc1aa\nparent ecae3d74e26b8f10322060954fbc2a6c4ba92402\nparent f4e78131218efac2c17b9a150ebd3ac7868d0dbe\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1657806845 +0530\ncommitter GitHub <noreply@github.com> 1657806845 +0530\n\nRollup merge of #99192 - Amanieu:fix-asm-srcloc, r=petrochenkov\n\nFix spans for asm diagnostics\n\nLine spans were incorrect if the first line of an asm statement was an\nempty string.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "html_url": "https://github.com/rust-lang/rust/commit/d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ecae3d74e26b8f10322060954fbc2a6c4ba92402", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecae3d74e26b8f10322060954fbc2a6c4ba92402", "html_url": "https://github.com/rust-lang/rust/commit/ecae3d74e26b8f10322060954fbc2a6c4ba92402"}, {"sha": "f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "html_url": "https://github.com/rust-lang/rust/commit/f4e78131218efac2c17b9a150ebd3ac7868d0dbe"}], "stats": {"total": 46, "additions": 42, "deletions": 4}, "files": [{"sha": "829eaa305e8c02bd063d4f71d61ebc9229d69fe3", "filename": "compiler/rustc_builtin_macros/src/asm.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs?ref=d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "patch": "@@ -534,8 +534,8 @@ fn expand_preparsed_asm(ecx: &mut ExtCtxt<'_>, args: AsmArgs) -> Option<ast::Inl\n \n     let mut template_strs = Vec::with_capacity(args.templates.len());\n \n-    for template_expr in args.templates.into_iter() {\n-        if !template.is_empty() {\n+    for (i, template_expr) in args.templates.into_iter().enumerate() {\n+        if i != 0 {\n             template.push(ast::InlineAsmTemplatePiece::String(\"\\n\".to_string()));\n         }\n "}, {"sha": "dbb6cbb9437b573e99348794bb1f96354fbe2343", "filename": "src/test/ui/asm/aarch64/srcloc.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs?ref=d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "patch": "@@ -118,5 +118,12 @@ fn main() {\n         //~^^^^^^^^^^ ERROR: unrecognized instruction mnemonic\n         //~^^^^^^^ ERROR: unrecognized instruction mnemonic\n         //~^^^^^^^^ ERROR: unrecognized instruction mnemonic\n+\n+        asm!(\n+            \"\",\n+            \"\\n\",\n+            \"invalid_instruction\"\n+        );\n+        //~^^ ERROR: unrecognized instruction mnemonic\n     }\n }"}, {"sha": "2e17b60b912430b2f0b32f12e29a042a01a193d2", "filename": "src/test/ui/asm/aarch64/srcloc.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr?ref=d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "patch": "@@ -274,5 +274,17 @@ note: instantiated into assembly here\n LL | invalid_instruction4\n    | ^\n \n-error: aborting due to 23 previous errors\n+error: unrecognized instruction mnemonic\n+  --> $DIR/srcloc.rs:125:14\n+   |\n+LL |             \"invalid_instruction\"\n+   |              ^\n+   |\n+note: instantiated into assembly here\n+  --> <inline asm>:4:1\n+   |\n+LL | invalid_instruction\n+   | ^\n+\n+error: aborting due to 24 previous errors\n "}, {"sha": "1135ad2e1c643b643fe7c695f8f095e7e9b7d7fe", "filename": "src/test/ui/asm/x86_64/srcloc.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs?ref=d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "patch": "@@ -120,5 +120,12 @@ fn main() {\n         //~^^^^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction2'\n         //~^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction3'\n         //~^^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction4'\n+\n+        asm!(\n+            \"\",\n+            \"\\n\",\n+            \"invalid_instruction\"\n+        );\n+        //~^^ ERROR: invalid instruction mnemonic 'invalid_instruction'\n     }\n }"}, {"sha": "8899c1b916bd02ecae61146b0ea3de6a972e7a07", "filename": "src/test/ui/asm/x86_64/srcloc.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d3a1aa0b4380b7ab217a1e2889a4217e70237f61/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr?ref=d3a1aa0b4380b7ab217a1e2889a4217e70237f61", "patch": "@@ -286,5 +286,17 @@ note: instantiated into assembly here\n LL | invalid_instruction4\n    | ^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 23 previous errors; 1 warning emitted\n+error: invalid instruction mnemonic 'invalid_instruction'\n+  --> $DIR/srcloc.rs:127:14\n+   |\n+LL |             \"invalid_instruction\"\n+   |              ^\n+   |\n+note: instantiated into assembly here\n+  --> <inline asm>:5:1\n+   |\n+LL | invalid_instruction\n+   | ^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 24 previous errors; 1 warning emitted\n "}]}