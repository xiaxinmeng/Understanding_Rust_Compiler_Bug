{"sha": "8447f101ac2170abd30d030b2a5e9a9fdb282d76", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0NDdmMTAxYWMyMTcwYWJkMzBkMDMwYjJhNWU5YTlmZGIyODJkNzY=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-03-12T22:54:29Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-03-12T22:54:29Z"}, "message": "Remove `ItemTree::source`\n\n`HasSource` should be used instead", "tree": {"sha": "59b4da5ee127a337cf516151127f900b8920001d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59b4da5ee127a337cf516151127f900b8920001d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8447f101ac2170abd30d030b2a5e9a9fdb282d76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8447f101ac2170abd30d030b2a5e9a9fdb282d76", "html_url": "https://github.com/rust-lang/rust/commit/8447f101ac2170abd30d030b2a5e9a9fdb282d76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8447f101ac2170abd30d030b2a5e9a9fdb282d76/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "437527b22612a17024751c78f69715e625bf6a96", "url": "https://api.github.com/repos/rust-lang/rust/commits/437527b22612a17024751c78f69715e625bf6a96", "html_url": "https://github.com/rust-lang/rust/commit/437527b22612a17024751c78f69715e625bf6a96"}], "stats": {"total": 22, "additions": 4, "deletions": 18}, "files": [{"sha": "09bcb10dc0c53eee2fb3e992461150bdceb22ec2", "filename": "crates/hir_def/src/item_tree.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8447f101ac2170abd30d030b2a5e9a9fdb282d76/crates%2Fhir_def%2Fsrc%2Fitem_tree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8447f101ac2170abd30d030b2a5e9a9fdb282d76/crates%2Fhir_def%2Fsrc%2Fitem_tree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fitem_tree.rs?ref=8447f101ac2170abd30d030b2a5e9a9fdb282d76", "patch": "@@ -209,18 +209,6 @@ impl ItemTree {\n         }\n     }\n \n-    pub fn source<S: ItemTreeNode>(&self, db: &dyn DefDatabase, of: ItemTreeId<S>) -> S::Source {\n-        // This unwrap cannot fail, since it has either succeeded above, or resulted in an empty\n-        // ItemTree (in which case there is no valid `FileItemTreeId` to call this method with).\n-        let root =\n-            db.parse_or_expand(of.file_id).expect(\"parse_or_expand failed on constructed ItemTree\");\n-\n-        let id = self[of.value].ast_id();\n-        let map = db.ast_id_map(of.file_id);\n-        let ptr = map.get(id);\n-        ptr.to_node(&root)\n-    }\n-\n     fn data(&self) -> &ItemTreeData {\n         self.data.as_ref().expect(\"attempted to access data of empty ItemTree\")\n     }"}, {"sha": "0a4141e698b44b66be923180755f01913d6e8904", "filename": "crates/hir_ty/src/tests.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8447f101ac2170abd30d030b2a5e9a9fdb282d76/crates%2Fhir_ty%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8447f101ac2170abd30d030b2a5e9a9fdb282d76/crates%2Fhir_ty%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests.rs?ref=8447f101ac2170abd30d030b2a5e9a9fdb282d76", "patch": "@@ -19,6 +19,7 @@ use hir_def::{\n     item_scope::ItemScope,\n     keys,\n     nameres::DefMap,\n+    src::HasSource,\n     AssocItemId, DefWithBodyId, LocalModuleId, Lookup, ModuleDefId,\n };\n use hir_expand::{db::AstDatabase, InFile};\n@@ -195,18 +196,15 @@ fn infer_with_mismatches(content: &str, include_mismatches: bool) -> String {\n     defs.sort_by_key(|def| match def {\n         DefWithBodyId::FunctionId(it) => {\n             let loc = it.lookup(&db);\n-            let tree = db.item_tree(loc.id.file_id);\n-            tree.source(&db, loc.id).syntax().text_range().start()\n+            loc.source(&db).value.syntax().text_range().start()\n         }\n         DefWithBodyId::ConstId(it) => {\n             let loc = it.lookup(&db);\n-            let tree = db.item_tree(loc.id.file_id);\n-            tree.source(&db, loc.id).syntax().text_range().start()\n+            loc.source(&db).value.syntax().text_range().start()\n         }\n         DefWithBodyId::StaticId(it) => {\n             let loc = it.lookup(&db);\n-            let tree = db.item_tree(loc.id.file_id);\n-            tree.source(&db, loc.id).syntax().text_range().start()\n+            loc.source(&db).value.syntax().text_range().start()\n         }\n     });\n     for def in defs {"}]}