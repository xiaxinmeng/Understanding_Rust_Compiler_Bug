{"sha": "be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlMzg2MDZjNzc5MGM0YWU5MmU0ZjlhMzY4ZWRlOGRmY2IyZmVlYzU=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-08-07T08:29:55Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-08-09T07:37:21Z"}, "message": "Add leave_last field to ListItems", "tree": {"sha": "9a72b765bde10468b7565422750bce9048b5bbfd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a72b765bde10468b7565422750bce9048b5bbfd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "html_url": "https://github.com/rust-lang/rust/commit/be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9239dd630bb10fcff07cc834f18d4330dcf75c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9239dd630bb10fcff07cc834f18d4330dcf75c8", "html_url": "https://github.com/rust-lang/rust/commit/f9239dd630bb10fcff07cc834f18d4330dcf75c8"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "1287b89ed636adc1c48d5579c98217fdda4207be", "filename": "src/expr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -466,6 +466,7 @@ where\n         |item| item.rewrite(context, nested_shape),\n         span.lo,\n         span.hi,\n+        false,\n     ).collect::<Vec<_>>();\n \n     if items.is_empty() {\n@@ -587,6 +588,7 @@ fn rewrite_closure_fn_decl(\n         |arg| arg.rewrite(context, arg_shape),\n         context.codemap.span_after(span, \"|\"),\n         body.span.lo,\n+        false,\n     );\n     let item_vec = arg_items.collect::<Vec<_>>();\n     // 1 = space between arguments and return type.\n@@ -2190,6 +2192,7 @@ where\n         |item| item.rewrite(context, shape),\n         span.lo,\n         span.hi,\n+        true,\n     );\n     let mut item_vec: Vec<_> = items.collect();\n \n@@ -2651,6 +2654,7 @@ fn rewrite_struct_lit<'a>(\n             rewrite,\n             body_lo,\n             span.hi,\n+            false,\n         );\n         let item_vec = items.collect::<Vec<_>>();\n \n@@ -2803,6 +2807,7 @@ where\n         |item| item.rewrite(context, nested_shape),\n         list_lo,\n         span.hi - BytePos(1),\n+        false,\n     );\n     let item_vec: Vec<_> = items.collect();\n     let tactic = definitive_tactic("}, {"sha": "80780b661f277bd872631c465dffc6d6008bb8dc", "filename": "src/imports.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fimports.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -442,6 +442,7 @@ fn rewrite_use_list(\n             rewrite_path_item,\n             context.codemap.span_after(span, \"{\"),\n             span.hi,\n+            false,\n         );\n         items.extend(iter);\n         items"}, {"sha": "09b5f7d9d306187d0bfd4bc373fa65d97c4c365d", "filename": "src/items.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -469,6 +469,7 @@ impl<'a> FmtVisitor<'a> {\n             |f| self.format_variant(f),\n             body_lo,\n             body_hi,\n+            false,\n         );\n \n         let shape = Shape::indented(self.block_indent, self.config)\n@@ -2207,6 +2208,7 @@ fn rewrite_args(\n             },\n             comment_span_start,\n             span.hi,\n+            false,\n         );\n \n         arg_items.extend(more_items);\n@@ -2411,6 +2413,7 @@ fn rewrite_generics_inner(\n         |&(_, ref str)| str.clone(),\n         context.codemap.span_after(span, \"<\"),\n         span.hi,\n+        false,\n     );\n     format_generics_item_list(context, items, shape, one_line_width)\n }\n@@ -2554,6 +2557,7 @@ fn rewrite_where_clause_rfc_style(\n         |pred| pred.rewrite(context, block_shape),\n         span_start,\n         span_end,\n+        false,\n     );\n     let comma_tactic = if where_clause_option.suppress_comma {\n         SeparatorTactic::Never\n@@ -2654,6 +2658,7 @@ fn rewrite_where_clause(\n         |pred| pred.rewrite(context, Shape::legacy(budget, offset)),\n         span_start,\n         span_end,\n+        false,\n     );\n     let item_vec = items.collect::<Vec<_>>();\n     // FIXME: we don't need to collect here if the where_layout isn't"}, {"sha": "e6ee8a7df44bda77fdb133a8c958afec7c0db847", "filename": "src/lists.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flists.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -454,6 +454,7 @@ where\n     prev_span_end: BytePos,\n     next_span_start: BytePos,\n     terminator: &'a str,\n+    leave_last: bool,\n }\n \n impl<'a, T, I, F1, F2, F3> Iterator for ListItems<'a, I, F1, F2, F3>\n@@ -592,7 +593,11 @@ where\n             ListItem {\n                 pre_comment: pre_comment,\n                 pre_comment_style: pre_comment_style,\n-                item: (self.get_item_string)(&item),\n+                item: if self.inner.peek().is_none() && self.leave_last {\n+                    None\n+                } else {\n+                    (self.get_item_string)(&item)\n+                },\n                 post_comment: post_comment,\n                 new_lines: new_lines,\n             }\n@@ -610,6 +615,7 @@ pub fn itemize_list<'a, T, I, F1, F2, F3>(\n     get_item_string: F3,\n     prev_span_end: BytePos,\n     next_span_start: BytePos,\n+    leave_last: bool,\n ) -> ListItems<'a, I, F1, F2, F3>\n where\n     I: Iterator<Item = T>,\n@@ -626,6 +632,7 @@ where\n         prev_span_end: prev_span_end,\n         next_span_start: next_span_start,\n         terminator: terminator,\n+        leave_last: leave_last,\n     }\n }\n "}, {"sha": "628c207d75087be959ef381a39b656fd7272dd2b", "filename": "src/patterns.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fpatterns.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -162,6 +162,7 @@ fn rewrite_struct_pat(\n         |f| f.node.rewrite(context, v_shape),\n         context.codemap.span_after(span, \"{\"),\n         span.hi,\n+        false,\n     );\n     let item_vec = items.collect::<Vec<_>>();\n \n@@ -342,6 +343,7 @@ fn count_wildcard_suffix_len(\n         |item| item.rewrite(context, shape),\n         context.codemap.span_after(span, \"(\"),\n         span.hi - BytePos(1),\n+        false,\n     ).collect();\n \n     for item in items.iter().rev().take_while(|i| match i.item {"}, {"sha": "f7cb3c5365686bf20dbd5506481a30c8e7d26aed", "filename": "src/types.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -241,6 +241,7 @@ fn rewrite_segment(\n                     |seg| seg.rewrite(context, generics_shape),\n                     list_lo,\n                     span_hi,\n+                    false,\n                 );\n                 let generics_str = try_opt!(format_generics_item_list(\n                     context,\n@@ -344,6 +345,7 @@ where\n         },\n         list_lo,\n         span.hi,\n+        false,\n     );\n \n     let item_vec: Vec<_> = items.collect();"}, {"sha": "fbb4ddd3bc87c487e5ddd129968c2d8e13bd4b30", "filename": "src/vertical.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fvertical.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fvertical.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvertical.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -219,6 +219,7 @@ fn rewrite_aligned_items_inner<T: AlignedItem>(\n         |field| field.rewrite_aligned_item(context, item_shape, field_prefix_max_width),\n         span.lo,\n         span.hi,\n+        false,\n     ).collect::<Vec<_>>();\n \n     let tactic = definitive_tactic("}, {"sha": "bcc219107f462a418bfb26104b13d8d1e9589fea", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be38606c7790c4ae92e4f9a368ede8dfcb2feec5/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=be38606c7790c4ae92e4f9a368ede8dfcb2feec5", "patch": "@@ -818,6 +818,7 @@ impl Rewrite for ast::MetaItem {\n                     |nested_meta_item| nested_meta_item.rewrite(context, item_shape),\n                     self.span.lo,\n                     hi,\n+                    false,\n                 );\n                 let item_vec = items.collect::<Vec<_>>();\n                 let fmt = ListFormatting {"}]}