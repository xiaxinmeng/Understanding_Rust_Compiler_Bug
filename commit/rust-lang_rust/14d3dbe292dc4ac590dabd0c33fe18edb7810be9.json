{"sha": "14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE0ZDNkYmUyOTJkYzRhYzU5MGRhYmQwYzMzZmUxOGVkYjc4MTBiZTk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-17T05:40:38Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-18T05:10:39Z"}, "message": "core: Document FormatWriter and allow `write!`\n\nThis commit fills in the documentation holes for the FormatWriter trait which\nwere previously accidentally left blank. Additionally, this adds the `write_fmt`\nmethod to the trait to allow usage of the `write!` macro with implementors of\nthe `FormatWriter` trait. This is not useful for consumers of the standard\nlibrary who should generally avoid the `FormatWriter` trait, but it is useful\nfor consumers of the core library who are not using the standard library.", "tree": {"sha": "0f8f0e7a2c2d58068ca58ee15257f5ab2f1bf72e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f8f0e7a2c2d58068ca58ee15257f5ab2f1bf72e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "html_url": "https://github.com/rust-lang/rust/commit/14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/14d3dbe292dc4ac590dabd0c33fe18edb7810be9/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2216eceea51b344560f4791336b3ea2c897eec39", "url": "https://api.github.com/repos/rust-lang/rust/commits/2216eceea51b344560f4791336b3ea2c897eec39", "html_url": "https://github.com/rust-lang/rust/commit/2216eceea51b344560f4791336b3ea2c897eec39"}], "stats": {"total": 49, "additions": 45, "deletions": 4}, "files": [{"sha": "4e5affe0149f75e5e599981b83ff623ddf688825", "filename": "src/libcore/fmt/mod.rs", "status": "modified", "additions": 32, "deletions": 4, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/14d3dbe292dc4ac590dabd0c33fe18edb7810be9/src%2Flibcore%2Ffmt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14d3dbe292dc4ac590dabd0c33fe18edb7810be9/src%2Flibcore%2Ffmt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ffmt%2Fmod.rs?ref=14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "patch": "@@ -43,16 +43,44 @@ pub mod rt;\n \n pub type Result = result::Result<(), FormatError>;\n \n-/// dox\n+/// The error type which is returned from formatting a message into a stream.\n+///\n+/// This type does not support transmission of an error other than that an error\n+/// occurred. Any extra information must be arranged to be transmitted through\n+/// some other means.\n pub enum FormatError {\n-    /// dox\n+    /// A generic write error occurred during formatting, no other information\n+    /// is transmitted via this variant.\n     WriteError,\n }\n \n-/// dox\n+/// A collection of methods that are required to format a message into a stream.\n+///\n+/// This trait is the type which this modules requires when formatting\n+/// information. This is similar to the standard library's `io::Writer` trait,\n+/// but it is only intended for use in libcore.\n+///\n+/// This trait should generally not be implemented by consumers of the standard\n+/// library. The `write!` macro accepts an instance of `io::Writer`, and the\n+/// `io::Writer` trait is favored over implementing this trait.\n pub trait FormatWriter {\n-    /// dox\n+    /// Writes a slice of bytes into this writer, returning whether the write\n+    /// succeeded.\n+    ///\n+    /// This method can only succeed if the entire byte slice was successfully\n+    /// written, and this method will not return until all data has been\n+    /// written or an error occurs.\n+    ///\n+    /// # Errors\n+    ///\n+    /// This function will return an instance of `FormatError` on error.\n     fn write(&mut self, bytes: &[u8]) -> Result;\n+\n+    /// Glue for usage of the `write!` macro with implementors of this trait.\n+    ///\n+    /// This method should generally not be invoked manually, but rather through\n+    /// the `write!` macro itself.\n+    fn write_fmt(&mut self, args: &Arguments) -> Result { write(self, args) }\n }\n \n /// A struct to represent both where to emit formatting strings to and how they"}, {"sha": "724e57bdef23d5752f2859c44463951a0465c77e", "filename": "src/test/run-pass/colorful-write-macros.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/14d3dbe292dc4ac590dabd0c33fe18edb7810be9/src%2Ftest%2Frun-pass%2Fcolorful-write-macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14d3dbe292dc4ac590dabd0c33fe18edb7810be9/src%2Ftest%2Frun-pass%2Fcolorful-write-macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcolorful-write-macros.rs?ref=14d3dbe292dc4ac590dabd0c33fe18edb7810be9", "patch": "@@ -14,12 +14,22 @@\n #![feature(macro_rules)]\n \n use std::io::MemWriter;\n+use std::fmt;\n+use std::fmt::FormatWriter;\n \n struct Foo<'a> {\n     writer: &'a mut Writer,\n     other: &'a str,\n }\n \n+struct Bar;\n+\n+impl fmt::FormatWriter for Bar {\n+    fn write(&mut self, _: &[u8]) -> fmt::Result {\n+        Ok(())\n+    }\n+}\n+\n fn borrowing_writer_from_struct_and_formatting_struct_field(foo: Foo) {\n     write!(foo.writer, \"{}\", foo.other);\n }\n@@ -29,4 +39,7 @@ fn main() {\n     write!(&mut w as &mut Writer, \"\");\n     write!(&mut w, \"\"); // should coerce\n     println!(\"ok\");\n+\n+    let mut s = Bar;\n+    write!(&mut s, \"test\");\n }"}]}