{"sha": "4176cf47dfe8f43dd8cfe402146291757c034ea3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxNzZjZjQ3ZGZlOGY0M2RkOGNmZTQwMjE0NjI5MTc1N2MwMzRlYTM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-21T18:40:31Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-24T21:29:15Z"}, "message": "mk: Cleanup", "tree": {"sha": "1fd0603e514a9416eebd28a866ef4a5ad8c2b532", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1fd0603e514a9416eebd28a866ef4a5ad8c2b532"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4176cf47dfe8f43dd8cfe402146291757c034ea3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4176cf47dfe8f43dd8cfe402146291757c034ea3", "html_url": "https://github.com/rust-lang/rust/commit/4176cf47dfe8f43dd8cfe402146291757c034ea3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4176cf47dfe8f43dd8cfe402146291757c034ea3/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df141e624da6d4c2976a4cecd9cb6779e23fedda", "url": "https://api.github.com/repos/rust-lang/rust/commits/df141e624da6d4c2976a4cecd9cb6779e23fedda", "html_url": "https://github.com/rust-lang/rust/commit/df141e624da6d4c2976a4cecd9cb6779e23fedda"}], "stats": {"total": 47, "additions": 30, "deletions": 17}, "files": [{"sha": "a7c8cd5b33fd1af7a59ee3b0dcafe75d74790a2e", "filename": "mk/dist.mk", "status": "modified", "additions": 30, "deletions": 17, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/4176cf47dfe8f43dd8cfe402146291757c034ea3/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/4176cf47dfe8f43dd8cfe402146291757c034ea3/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=4176cf47dfe8f43dd8cfe402146291757c034ea3", "patch": "@@ -1,17 +1,30 @@\n+# Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n ######################################################################\n # Distribution\n ######################################################################\n \n+# Primary targets:\n+#\n+# * dist - make all distribution artifacts\n+# * distcheck - sanity check dist artifacts\n+# * dist-tar-src - source tarballs\n+# * dist-win - Windows exe installers\n+# * dist-osx - OS X .pkg installers\n+# * dist-tar-bins - Ad-hoc Unix binary installers\n+\n PKG_NAME := rust\n PKG_DIR = $(PKG_NAME)-$(CFG_RELEASE)\n PKG_TAR = dist/$(PKG_DIR).tar.gz\n \n-ifdef CFG_ISCC\n-PKG_ISS = $(wildcard $(S)src/etc/pkg/*.iss)\n-PKG_ICO = $(S)src/etc/pkg/rust-logo.ico\n-PKG_EXE = dist/$(PKG_DIR)-install.exe\n-endif\n-\n ifeq ($(CFG_OSTYPE), apple-darwin)\n PKG_OSX = dist/$(PKG_DIR).pkg\n endif\n@@ -71,12 +84,16 @@ $(PKG_TAR): $(PKG_FILES)\n \t$(Q)tar -czf $(PKG_TAR) -C tmp/dist $(PKG_DIR)\n \t$(Q)rm -Rf tmp/dist/$(PKG_DIR)\n \n+dist-tar-src: $(PKG_TAR)\n \n ######################################################################\n # Windows .exe installer\n ######################################################################\n \n ifdef CFG_ISCC\n+\n+PKG_EXE = dist/$(PKG_DIR)-install.exe\n+\n %.iss: $(S)src/etc/pkg/%.iss\n \tcp $< $@\n \n@@ -102,6 +119,8 @@ dist-prepare-win: prepare-base\n \n endif\n \n+dist-win: $(PKG_EXE)\n+\n \n ######################################################################\n # OS X .pkg installer\n@@ -126,20 +145,14 @@ $(PKG_OSX): Distribution.xml LICENSE.txt dist-prepare-osx\n \n dist-osx: $(PKG_OSX)\n \n-distcheck-osx: $(PKG_OSX)\n-\t@echo\n-\t@echo -----------------------------------------------\n-\t@echo $(PKG_OSX) ready for distribution\n-\t@echo -----------------------------------------------\n-\n endif\n \n \n ######################################################################\n # Unix binary installer tarballs\n ######################################################################\n \n-dist-install-dir: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n+dist-install-dirs: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n \n dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_DIR)-$(host).tar.gz)\n \n@@ -177,17 +190,17 @@ $(foreach host,$(CFG_HOST),\\\n \n ifdef CFG_WINDOWSY_$(CFG_BUILD)\n \n-dist: $(PKG_EXE)\n+dist: dist-win\n \n distcheck: dist\n \t@echo\n \t@echo -----------------------------------------------\n-\t@echo $(PKG_EXE) ready for distribution\n+\t@echo Rust ready for distribution (see ./dist)\n \t@echo -----------------------------------------------\n \n else\n \n-dist: $(PKG_TAR)\n+dist: dist-tar-src\n \n distcheck: $(PKG_TAR)\n \t$(Q)rm -Rf dist\n@@ -204,7 +217,7 @@ distcheck: $(PKG_TAR)\n \t$(Q)rm -Rf dist\n \t@echo\n \t@echo -----------------------------------------------\n-\t@echo $(PKG_TAR) ready for distribution\n+\t@echo Rust ready for distribution (see ./dist)\n \t@echo -----------------------------------------------\n \n endif"}]}