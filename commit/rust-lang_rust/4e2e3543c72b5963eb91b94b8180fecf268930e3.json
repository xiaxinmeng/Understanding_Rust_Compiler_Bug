{"sha": "4e2e3543c72b5963eb91b94b8180fecf268930e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlMmUzNTQzYzcyYjU5NjNlYjkxYjk0YjgxODBmZWNmMjY4OTMwZTM=", "commit": {"author": {"name": "Paul Daniel Faria", "email": "Nashenas88@users.noreply.github.com", "date": "2020-08-04T13:28:40Z"}, "committer": {"name": "Paul Daniel Faria", "email": "Nashenas88@users.noreply.github.com", "date": "2020-08-04T13:28:40Z"}, "message": "When resolving a rename, fallback to the name higher in the use tree if the path segment is `self`", "tree": {"sha": "079a0decdc5e37716f415488583881765a79dc39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/079a0decdc5e37716f415488583881765a79dc39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e2e3543c72b5963eb91b94b8180fecf268930e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e2e3543c72b5963eb91b94b8180fecf268930e3", "html_url": "https://github.com/rust-lang/rust/commit/4e2e3543c72b5963eb91b94b8180fecf268930e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e2e3543c72b5963eb91b94b8180fecf268930e3/comments", "author": {"login": "Nashenas88", "id": 1673130, "node_id": "MDQ6VXNlcjE2NzMxMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1673130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nashenas88", "html_url": "https://github.com/Nashenas88", "followers_url": "https://api.github.com/users/Nashenas88/followers", "following_url": "https://api.github.com/users/Nashenas88/following{/other_user}", "gists_url": "https://api.github.com/users/Nashenas88/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nashenas88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nashenas88/subscriptions", "organizations_url": "https://api.github.com/users/Nashenas88/orgs", "repos_url": "https://api.github.com/users/Nashenas88/repos", "events_url": "https://api.github.com/users/Nashenas88/events{/privacy}", "received_events_url": "https://api.github.com/users/Nashenas88/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Nashenas88", "id": 1673130, "node_id": "MDQ6VXNlcjE2NzMxMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1673130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nashenas88", "html_url": "https://github.com/Nashenas88", "followers_url": "https://api.github.com/users/Nashenas88/followers", "following_url": "https://api.github.com/users/Nashenas88/following{/other_user}", "gists_url": "https://api.github.com/users/Nashenas88/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nashenas88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nashenas88/subscriptions", "organizations_url": "https://api.github.com/users/Nashenas88/orgs", "repos_url": "https://api.github.com/users/Nashenas88/repos", "events_url": "https://api.github.com/users/Nashenas88/events{/privacy}", "received_events_url": "https://api.github.com/users/Nashenas88/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc3eb8531177940ad34ff505f0426151b985daf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc3eb8531177940ad34ff505f0426151b985daf3", "html_url": "https://github.com/rust-lang/rust/commit/cc3eb8531177940ad34ff505f0426151b985daf3"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "23c25ad8cee616bd5f5e2a46fb7d309dcc456c85", "filename": "crates/ra_ide/test_data/highlighting.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4e2e3543c72b5963eb91b94b8180fecf268930e3/crates%2Fra_ide%2Ftest_data%2Fhighlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/4e2e3543c72b5963eb91b94b8180fecf268930e3/crates%2Fra_ide%2Ftest_data%2Fhighlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Ftest_data%2Fhighlighting.html?ref=4e2e3543c72b5963eb91b94b8180fecf268930e3", "patch": "@@ -35,7 +35,7 @@\n \n .unresolved_reference { color: #FC5555; text-decoration: wavy underline; }\n </style>\n-<pre><code><span class=\"keyword\">use</span> <span class=\"module\">inner</span><span class=\"operator\">::</span><span class=\"punctuation\">{</span><span class=\"self_keyword\">self</span> <span class=\"keyword\">as</span> <span class=\"unresolved_reference declaration\">inner_mod</span><span class=\"punctuation\">}</span><span class=\"punctuation\">;</span>\n+<pre><code><span class=\"keyword\">use</span> <span class=\"module\">inner</span><span class=\"operator\">::</span><span class=\"punctuation\">{</span><span class=\"self_keyword\">self</span> <span class=\"keyword\">as</span> <span class=\"module declaration\">inner_mod</span><span class=\"punctuation\">}</span><span class=\"punctuation\">;</span>\n <span class=\"keyword\">mod</span> <span class=\"module declaration\">inner</span> <span class=\"punctuation\">{</span><span class=\"punctuation\">}</span>\n \n <span class=\"attribute\">#</span><span class=\"attribute\">[</span><span class=\"function attribute\">derive</span><span class=\"punctuation\">(</span><span class=\"attribute\">Clone</span><span class=\"punctuation\">,</span><span class=\"attribute\"> Debug</span><span class=\"punctuation\">)</span><span class=\"attribute\">]</span>"}, {"sha": "b51000b03fb9e16ae1ff103571c709463d88a4d7", "filename": "crates/ra_ide_db/src/defs.rs", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/4e2e3543c72b5963eb91b94b8180fecf268930e3/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e2e3543c72b5963eb91b94b8180fecf268930e3/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs?ref=4e2e3543c72b5963eb91b94b8180fecf268930e3", "patch": "@@ -12,7 +12,7 @@ use hir::{\n use ra_prof::profile;\n use ra_syntax::{\n     ast::{self, AstNode},\n-    match_ast,\n+    match_ast, SyntaxNode,\n };\n \n use crate::RootDatabase;\n@@ -123,8 +123,27 @@ pub fn classify_name(sema: &Semantics<RootDatabase>, name: &ast::Name) -> Option\n                 let use_tree = it.syntax().parent().and_then(ast::UseTree::cast)?;\n                 let path = use_tree.path()?;\n                 let path_segment = path.segment()?;\n-                let name_ref = path_segment.name_ref()?;\n-                let name_ref_class = classify_name_ref(sema, &name_ref)?;\n+                let name_ref_class = path_segment\n+                    .name_ref()\n+                    // The rename might be from a `self` token, so fallback to the name higher\n+                    // in the use tree.\n+                    .or_else(||{\n+                        if path_segment.self_token().is_none() {\n+                            return None;\n+                        }\n+\n+                        let use_tree = use_tree\n+                            .syntax()\n+                            .parent()\n+                            .as_ref()\n+                            // Skip over UseTreeList\n+                            .and_then(SyntaxNode::parent)\n+                            .and_then(ast::UseTree::cast)?;\n+                        let path = use_tree.path()?;\n+                        let path_segment = path.segment()?;\n+                        path_segment.name_ref()\n+                    })\n+                    .and_then(|name_ref| classify_name_ref(sema, &name_ref))?;\n \n                 Some(NameClass::Definition(name_ref_class.definition()))\n             },"}]}