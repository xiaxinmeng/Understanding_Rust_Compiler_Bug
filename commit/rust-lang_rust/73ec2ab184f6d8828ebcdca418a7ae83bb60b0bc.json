{"sha": "73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczZWMyYWIxODRmNmQ4ODI4ZWJjZGNhNDE4YTdhZTgzYmI2MGIwYmM=", "commit": {"author": {"name": "Emil Lauridsen", "email": "mine809@gmail.com", "date": "2020-02-07T12:51:51Z"}, "committer": {"name": "Emil Lauridsen", "email": "mine809@gmail.com", "date": "2020-02-07T12:51:51Z"}, "message": "Update async unsafe fn ordering.\n\nAs of rust-lang/rust#61319 the correct order for functions that are both\nunsafe and async is: `async unsafe fn` and not `unsafe async fn`.\n\nThis commit updates the parser tests to reflect this, and corrects\nparsing behavior to accept the correct ordering.\n\nFixes #3025", "tree": {"sha": "71dbd689e3bdbf4884d78265f4371e7668bce74c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71dbd689e3bdbf4884d78265f4371e7668bce74c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "html_url": "https://github.com/rust-lang/rust/commit/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/comments", "author": {"login": "kiljacken", "id": 209321, "node_id": "MDQ6VXNlcjIwOTMyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/209321?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kiljacken", "html_url": "https://github.com/kiljacken", "followers_url": "https://api.github.com/users/kiljacken/followers", "following_url": "https://api.github.com/users/kiljacken/following{/other_user}", "gists_url": "https://api.github.com/users/kiljacken/gists{/gist_id}", "starred_url": "https://api.github.com/users/kiljacken/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kiljacken/subscriptions", "organizations_url": "https://api.github.com/users/kiljacken/orgs", "repos_url": "https://api.github.com/users/kiljacken/repos", "events_url": "https://api.github.com/users/kiljacken/events{/privacy}", "received_events_url": "https://api.github.com/users/kiljacken/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kiljacken", "id": 209321, "node_id": "MDQ6VXNlcjIwOTMyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/209321?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kiljacken", "html_url": "https://github.com/kiljacken", "followers_url": "https://api.github.com/users/kiljacken/followers", "following_url": "https://api.github.com/users/kiljacken/following{/other_user}", "gists_url": "https://api.github.com/users/kiljacken/gists{/gist_id}", "starred_url": "https://api.github.com/users/kiljacken/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kiljacken/subscriptions", "organizations_url": "https://api.github.com/users/kiljacken/orgs", "repos_url": "https://api.github.com/users/kiljacken/repos", "events_url": "https://api.github.com/users/kiljacken/events{/privacy}", "received_events_url": "https://api.github.com/users/kiljacken/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5aba5a756a19a54d5c4edd51d8055db36182688b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5aba5a756a19a54d5c4edd51d8055db36182688b", "html_url": "https://github.com/rust-lang/rust/commit/5aba5a756a19a54d5c4edd51d8055db36182688b"}], "stats": {"total": 40, "additions": 20, "deletions": 20}, "files": [{"sha": "a88206fa8fa3e5372e99bd2bde0f3f2a29339802", "filename": "crates/ra_parser/src/grammar/items.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs?ref=73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "patch": "@@ -91,20 +91,20 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker, flavor: ItemFlavor) -> Resul\n     // modifiers\n     has_mods |= p.eat(T![const]);\n \n-    // test_err unsafe_block_in_mod\n-    // fn foo(){} unsafe { } fn bar(){}\n-    if p.at(T![unsafe]) && p.nth(1) != T!['{'] {\n-        p.eat(T![unsafe]);\n-        has_mods = true;\n-    }\n-\n     // test_err async_without_semicolon\n     // fn foo() { let _ = async {} }\n     if p.at(T![async]) && p.nth(1) != T!['{'] && p.nth(1) != T![move] && p.nth(1) != T![|] {\n         p.eat(T![async]);\n         has_mods = true;\n     }\n \n+    // test_err unsafe_block_in_mod\n+    // fn foo(){} unsafe { } fn bar(){}\n+    if p.at(T![unsafe]) && p.nth(1) != T!['{'] {\n+        p.eat(T![unsafe]);\n+        has_mods = true;\n+    }\n+\n     if p.at(T![extern]) {\n         has_mods = true;\n         abi(p);\n@@ -157,11 +157,11 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker, flavor: ItemFlavor) -> Resul\n         // unsafe fn foo() {}\n \n         // test combined_fns\n-        // unsafe async fn foo() {}\n+        // async unsafe fn foo() {}\n         // const unsafe fn bar() {}\n \n         // test_err wrong_order_fns\n-        // async unsafe fn foo() {}\n+        // unsafe async fn foo() {}\n         // unsafe const fn bar() {}\n         T![fn] => {\n             fn_def(p, flavor);"}, {"sha": "731e58013bd87ce4eb651d49acb1c7900d9fde79", "filename": "crates/ra_syntax/test_data/parser/inline/err/0010_wrong_order_fns.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rs?ref=73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "patch": "@@ -1,2 +1,2 @@\n-async unsafe fn foo() {}\n+unsafe async fn foo() {}\n unsafe const fn bar() {}"}, {"sha": "289193b9e7fdd2f89257bfe4e99abc93466644b9", "filename": "crates/ra_syntax/test_data/parser/inline/err/0010_wrong_order_fns.txt", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.txt", "raw_url": "https://github.com/rust-lang/rust/raw/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.txt?ref=73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "patch": "@@ -1,9 +1,9 @@\n SOURCE_FILE@[0; 50)\n-  ERROR@[0; 5)\n-    ASYNC_KW@[0; 5) \"async\"\n-  WHITESPACE@[5; 6) \" \"\n-  FN_DEF@[6; 24)\n-    UNSAFE_KW@[6; 12) \"unsafe\"\n+  ERROR@[0; 6)\n+    UNSAFE_KW@[0; 6) \"unsafe\"\n+  WHITESPACE@[6; 7) \" \"\n+  FN_DEF@[7; 24)\n+    ASYNC_KW@[7; 12) \"async\"\n     WHITESPACE@[12; 13) \" \"\n     FN_KW@[13; 15) \"fn\"\n     WHITESPACE@[15; 16) \" \"\n@@ -37,5 +37,5 @@ SOURCE_FILE@[0; 50)\n         L_CURLY@[47; 48) \"{\"\n         R_CURLY@[48; 49) \"}\"\n   WHITESPACE@[49; 50) \"\\n\"\n-error 5: expected existential, fn, trait or impl\n+error 6: expected existential, fn, trait or impl\n error 31: expected existential, fn, trait or impl"}, {"sha": "12628714532d41149bfad1228747d9c8727d4576", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0128_combined_fns.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.rs?ref=73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "patch": "@@ -1,2 +1,2 @@\n-unsafe async fn foo() {}\n+async unsafe fn foo() {}\n const unsafe fn bar() {}"}, {"sha": "8a972cdb25fd0c4cbaa5c0e13cceaba6cab41202", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0128_combined_fns.txt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.txt", "raw_url": "https://github.com/rust-lang/rust/raw/73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0128_combined_fns.txt?ref=73ec2ab184f6d8828ebcdca418a7ae83bb60b0bc", "patch": "@@ -1,8 +1,8 @@\n SOURCE_FILE@[0; 50)\n   FN_DEF@[0; 24)\n-    UNSAFE_KW@[0; 6) \"unsafe\"\n-    WHITESPACE@[6; 7) \" \"\n-    ASYNC_KW@[7; 12) \"async\"\n+    ASYNC_KW@[0; 5) \"async\"\n+    WHITESPACE@[5; 6) \" \"\n+    UNSAFE_KW@[6; 12) \"unsafe\"\n     WHITESPACE@[12; 13) \" \"\n     FN_KW@[13; 15) \"fn\"\n     WHITESPACE@[15; 16) \" \""}]}