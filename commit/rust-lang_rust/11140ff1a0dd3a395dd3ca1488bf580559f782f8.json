{"sha": "11140ff1a0dd3a395dd3ca1488bf580559f782f8", "node_id": "C_kwDOAAsO6NoAKDExMTQwZmYxYTBkZDNhMzk1ZGQzY2ExNDg4YmY1ODA1NTlmNzgyZjg", "commit": {"author": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2021-10-04T05:04:17Z"}, "committer": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2021-10-04T05:04:17Z"}, "message": "Stabilize `unreachable_unchecked` as `const fn`", "tree": {"sha": "c34d70739b014c1b33b71e0a59ceddaafdfc64ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c34d70739b014c1b33b71e0a59ceddaafdfc64ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11140ff1a0dd3a395dd3ca1488bf580559f782f8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQTgxeqBxcDGar1sVhy4DhnkZitapAUCYVqLXwAKCRC4DhnkZita\npA8UAP48wHOWARiAcy66z/sKi2LX+vRQ/xLq9tX+AOOksNJLEAD/SXz+FJSASa8y\nAUcd7s8JqreIr4ViyFRAHdDrVrnTtQs=\n=DBtQ\n-----END PGP SIGNATURE-----", "payload": "tree c34d70739b014c1b33b71e0a59ceddaafdfc64ce\nparent e737694a4d66b01308b73d4559a35b43e414faf9\nauthor Jacob Pratt <jacob@jhpratt.dev> 1633323857 -0400\ncommitter Jacob Pratt <jacob@jhpratt.dev> 1633323857 -0400\n\nStabilize `unreachable_unchecked` as `const fn`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11140ff1a0dd3a395dd3ca1488bf580559f782f8", "html_url": "https://github.com/rust-lang/rust/commit/11140ff1a0dd3a395dd3ca1488bf580559f782f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11140ff1a0dd3a395dd3ca1488bf580559f782f8/comments", "author": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e737694a4d66b01308b73d4559a35b43e414faf9", "url": "https://api.github.com/repos/rust-lang/rust/commits/e737694a4d66b01308b73d4559a35b43e414faf9", "html_url": "https://github.com/rust-lang/rust/commit/e737694a4d66b01308b73d4559a35b43e414faf9"}], "stats": {"total": 18, "additions": 7, "deletions": 11}, "files": [{"sha": "95798879155c55cf30d497f1c5d155c81bcf543b", "filename": "library/core/src/hint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Fhint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Fhint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fhint.rs?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -44,7 +44,7 @@ use crate::intrinsics;\n /// ```\n #[inline]\n #[stable(feature = \"unreachable\", since = \"1.27.0\")]\n-#[rustc_const_unstable(feature = \"const_unreachable_unchecked\", issue = \"53188\")]\n+#[rustc_const_stable(feature = \"const_unreachable_unchecked\", since = \"1.57.0\")]\n pub const unsafe fn unreachable_unchecked() -> ! {\n     // SAFETY: the safety contract for `intrinsics::unreachable` must\n     // be upheld by the caller."}, {"sha": "067a27fed4142004c02dd1a5b2c356d921f0f7d2", "filename": "library/core/src/intrinsics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fintrinsics.rs?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -735,7 +735,7 @@ extern \"rust-intrinsic\" {\n     /// reach code marked with this function.\n     ///\n     /// The stabilized version of this intrinsic is [`core::hint::unreachable_unchecked`].\n-    #[rustc_const_unstable(feature = \"const_unreachable_unchecked\", issue = \"53188\")]\n+    #[rustc_const_stable(feature = \"const_unreachable_unchecked\", since = \"1.57.0\")]\n     pub fn unreachable() -> !;\n \n     /// Informs the optimizer that a condition is always true."}, {"sha": "9a966cc51280a658dcd6a5169a80c212d5efd040", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -103,7 +103,6 @@\n #![feature(const_trait_impl)]\n #![feature(const_type_id)]\n #![feature(const_type_name)]\n-#![feature(const_unreachable_unchecked)]\n #![feature(const_default_impls)]\n #![feature(duration_consts_2)]\n #![feature(ptr_metadata)]"}, {"sha": "1c3baec5d8638cbd7dd016494a0db5e94199da38", "filename": "src/test/ui/consts/const_unsafe_unreachable.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable.rs?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -1,7 +1,5 @@\n // run-pass\n \n-#![feature(const_unreachable_unchecked)]\n-\n const unsafe fn foo(x: bool) -> bool {\n     match x {\n         true => true,\n@@ -12,5 +10,5 @@ const unsafe fn foo(x: bool) -> bool {\n const BAR: bool = unsafe { foo(true) };\n \n fn main() {\n-  assert_eq!(BAR, true);\n+    assert_eq!(BAR, true);\n }"}, {"sha": "b418fea617ceaec29dd407105371ffa2233a4a4b", "filename": "src/test/ui/consts/const_unsafe_unreachable_ub.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.rs?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -1,5 +1,4 @@\n // error-pattern: evaluation of constant value failed\n-#![feature(const_unreachable_unchecked)]\n \n const unsafe fn foo(x: bool) -> bool {\n     match x {\n@@ -11,5 +10,5 @@ const unsafe fn foo(x: bool) -> bool {\n const BAR: bool = unsafe { foo(false) };\n \n fn main() {\n-  assert_eq!(BAR, true);\n+    assert_eq!(BAR, true);\n }"}, {"sha": "ec6ce1f5d7c0864bea7caf1b7169376a4fe4eb12", "filename": "src/test/ui/consts/const_unsafe_unreachable_ub.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11140ff1a0dd3a395dd3ca1488bf580559f782f8/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_unsafe_unreachable_ub.stderr?ref=11140ff1a0dd3a395dd3ca1488bf580559f782f8", "patch": "@@ -7,13 +7,13 @@ LL |     unsafe { intrinsics::unreachable() }\n    |              entering unreachable code\n    |              inside `unreachable_unchecked` at $SRC_DIR/core/src/hint.rs:LL:COL\n    |\n-  ::: $DIR/const_unsafe_unreachable_ub.rs:7:18\n+  ::: $DIR/const_unsafe_unreachable_ub.rs:6:18\n    |\n LL |         false => std::hint::unreachable_unchecked(),\n-   |                  ---------------------------------- inside `foo` at $DIR/const_unsafe_unreachable_ub.rs:7:18\n+   |                  ---------------------------------- inside `foo` at $DIR/const_unsafe_unreachable_ub.rs:6:18\n ...\n LL | const BAR: bool = unsafe { foo(false) };\n-   |                            ---------- inside `BAR` at $DIR/const_unsafe_unreachable_ub.rs:11:28\n+   |                            ---------- inside `BAR` at $DIR/const_unsafe_unreachable_ub.rs:10:28\n \n error: aborting due to previous error\n "}]}