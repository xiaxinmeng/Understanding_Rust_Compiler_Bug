{"sha": "e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ZDY2NzU4Y2ZjZTRkYzJjODdlMzIyNGI2ZWQ0N2FlZTFmZWUyNTc=", "commit": {"author": {"name": "Wim Looman", "email": "wim@nemo157.com", "date": "2018-11-07T09:33:35Z"}, "committer": {"name": "Wim Looman", "email": "wim@nemo157.com", "date": "2019-01-27T21:58:59Z"}, "message": "Update generator upvar debug info", "tree": {"sha": "5dace82fecd4589422e4c555a1d4b066abd99d6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5dace82fecd4589422e4c555a1d4b066abd99d6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "html_url": "https://github.com/rust-lang/rust/commit/e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7d66758cfce4dc2c87e3224b6ed47aee1fee257/comments", "author": {"login": "Nemo157", "id": 81079, "node_id": "MDQ6VXNlcjgxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/81079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nemo157", "html_url": "https://github.com/Nemo157", "followers_url": "https://api.github.com/users/Nemo157/followers", "following_url": "https://api.github.com/users/Nemo157/following{/other_user}", "gists_url": "https://api.github.com/users/Nemo157/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nemo157/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nemo157/subscriptions", "organizations_url": "https://api.github.com/users/Nemo157/orgs", "repos_url": "https://api.github.com/users/Nemo157/repos", "events_url": "https://api.github.com/users/Nemo157/events{/privacy}", "received_events_url": "https://api.github.com/users/Nemo157/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Nemo157", "id": 81079, "node_id": "MDQ6VXNlcjgxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/81079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nemo157", "html_url": "https://github.com/Nemo157", "followers_url": "https://api.github.com/users/Nemo157/followers", "following_url": "https://api.github.com/users/Nemo157/following{/other_user}", "gists_url": "https://api.github.com/users/Nemo157/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nemo157/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nemo157/subscriptions", "organizations_url": "https://api.github.com/users/Nemo157/orgs", "repos_url": "https://api.github.com/users/Nemo157/repos", "events_url": "https://api.github.com/users/Nemo157/events{/privacy}", "received_events_url": "https://api.github.com/users/Nemo157/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be3989301aea41777bdbc65d5c3537b7036ec407", "url": "https://api.github.com/repos/rust-lang/rust/commits/be3989301aea41777bdbc65d5c3537b7036ec407", "html_url": "https://github.com/rust-lang/rust/commit/be3989301aea41777bdbc65d5c3537b7036ec407"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "c7e2131eed5dad3f7eee63c9930152d6c53fc623", "filename": "src/librustc_codegen_ssa/mir/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e7d66758cfce4dc2c87e3224b6ed47aee1fee257/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7d66758cfce4dc2c87e3224b6ed47aee1fee257/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs?ref=e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "patch": "@@ -586,10 +586,17 @@ fn arg_local_refs<'a, 'tcx: 'a, Bx: BuilderMethods<'a, 'tcx>>(\n                 return;\n             }\n \n+            let pin_did = tcx.lang_items().pin_type();\n             // Or is it the closure environment?\n             let (closure_layout, env_ref) = match arg.layout.ty.sty {\n                 ty::RawPtr(ty::TypeAndMut { ty, .. }) |\n                 ty::Ref(_, ty, _)  => (bx.layout_of(ty), true),\n+                ty::Adt(def, substs) if Some(def.did) == pin_did => {\n+                    match substs.type_at(0).sty {\n+                        ty::Ref(_, ty, _)  => (bx.layout_of(ty), true),\n+                        _ => (arg.layout, false),\n+                    }\n+                }\n                 _ => (arg.layout, false)\n             };\n "}, {"sha": "b56d222e0e01e5baea0b5ea6f42dbcfd5cb0720b", "filename": "src/test/debuginfo/generators.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/e7d66758cfce4dc2c87e3224b6ed47aee1fee257/src%2Ftest%2Fdebuginfo%2Fgenerators.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7d66758cfce4dc2c87e3224b6ed47aee1fee257/src%2Ftest%2Fdebuginfo%2Fgenerators.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fgenerators.rs?ref=e7d66758cfce4dc2c87e3224b6ed47aee1fee257", "patch": "@@ -0,0 +1,36 @@\n+// min-lldb-version: 310\n+\n+// compile-flags:-g\n+\n+// === GDB TESTS ===================================================================================\n+\n+// gdb-command:run\n+// gdb-command:print a\n+// gdb-check:$1 = 5\n+\n+// === LLDB TESTS ==================================================================================\n+\n+// lldb-command:run\n+// lldb-command:print a\n+// lldbg-check:(int) $0 = 5\n+// lldbr-check:(int) a = 5\n+\n+#![feature(omit_gdb_pretty_printer_section, generators, generator_trait, pin)]\n+#![omit_gdb_pretty_printer_section]\n+\n+use std::ops::Generator;\n+use std::pin::Pin;\n+\n+fn main() {\n+    let mut a = 5;\n+    let mut b = || {\n+        yield;\n+        _zzz(); // #break\n+        a = 6;\n+    };\n+    Pin::new(&mut b).resume();\n+    Pin::new(&mut b).resume();\n+    _zzz(); // #break\n+}\n+\n+fn _zzz() {()}"}]}