{"sha": "8ee9322c1041bcbaee408961727c4418bd792979", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlZTkzMjJjMTA0MWJjYmFlZTQwODk2MTcyN2M0NDE4YmQ3OTI5Nzk=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-23T12:19:42Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-30T16:10:08Z"}, "message": "Also profile finishing the encoding.", "tree": {"sha": "2b40b5a6bf782287594872b78a703e3fe6663659", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b40b5a6bf782287594872b78a703e3fe6663659"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ee9322c1041bcbaee408961727c4418bd792979", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ee9322c1041bcbaee408961727c4418bd792979", "html_url": "https://github.com/rust-lang/rust/commit/8ee9322c1041bcbaee408961727c4418bd792979", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ee9322c1041bcbaee408961727c4418bd792979/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df24315ddf0103a5f9ecd8d3cd15e069e3571a53", "url": "https://api.github.com/repos/rust-lang/rust/commits/df24315ddf0103a5f9ecd8d3cd15e069e3571a53", "html_url": "https://github.com/rust-lang/rust/commit/df24315ddf0103a5f9ecd8d3cd15e069e3571a53"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "d558af3c1d558cffffeb7451b0dcee9f483b063f", "filename": "compiler/rustc_incremental/src/persist/save.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fsave.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fsave.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fsave.rs?ref=8ee9322c1041bcbaee408961727c4418bd792979", "patch": "@@ -49,7 +49,7 @@ pub fn save_dep_graph(tcx: TyCtxt<'_>) {\n             },\n             move || {\n                 sess.time(\"incr_comp_persist_dep_graph\", || {\n-                    if let Err(err) = tcx.dep_graph.encode() {\n+                    if let Err(err) = tcx.dep_graph.encode(&tcx.sess.prof) {\n                         sess.err(&format!(\n                             \"failed to write dependency graph to `{}`: {}\",\n                             staging_dep_graph_path.display(),"}, {"sha": "7a0fc320663f764d1aedd0cfb48f19dd3b72effe", "filename": "compiler/rustc_query_system/src/dep_graph/graph.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fgraph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fgraph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fgraph.rs?ref=8ee9322c1041bcbaee408961727c4418bd792979", "patch": "@@ -789,8 +789,12 @@ impl<K: DepKind> DepGraph<K> {\n         }\n     }\n \n-    pub fn encode(&self) -> FileEncodeResult {\n-        if let Some(data) = &self.data { data.current.encoder.steal().finish() } else { Ok(()) }\n+    pub fn encode(&self, profiler: &SelfProfilerRef) -> FileEncodeResult {\n+        if let Some(data) = &self.data {\n+            data.current.encoder.steal().finish(profiler)\n+        } else {\n+            Ok(())\n+        }\n     }\n \n     fn next_virtual_depnode_index(&self) -> DepNodeIndex {"}, {"sha": "1e34b14d9060f237321ad13b061d7f9c64364eaa", "filename": "compiler/rustc_query_system/src/dep_graph/serialized.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fserialized.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee9322c1041bcbaee408961727c4418bd792979/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fserialized.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fdep_graph%2Fserialized.rs?ref=8ee9322c1041bcbaee408961727c4418bd792979", "patch": "@@ -304,7 +304,8 @@ impl<K: DepKind + Encodable<FileEncoder>> GraphEncoder<K> {\n         self.status.lock().encode_node(&node, &self.record_graph)\n     }\n \n-    pub fn finish(self) -> FileEncodeResult {\n+    pub fn finish(self, profiler: &SelfProfilerRef) -> FileEncodeResult {\n+        let _prof_timer = profiler.generic_activity(\"incr_comp_encode_dep_graph\");\n         self.status.into_inner().finish()\n     }\n }"}]}