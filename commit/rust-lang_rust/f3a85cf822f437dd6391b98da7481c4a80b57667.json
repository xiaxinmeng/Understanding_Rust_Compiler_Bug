{"sha": "f3a85cf822f437dd6391b98da7481c4a80b57667", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzYTg1Y2Y4MjJmNDM3ZGQ2MzkxYjk4ZGE3NDgxYzRhODBiNTc2Njc=", "commit": {"author": {"name": "Corey Richardson", "email": "corey@octayn.net", "date": "2014-12-05T18:07:42Z"}, "committer": {"name": "Corey Richardson", "email": "corey@octayn.net", "date": "2014-12-05T18:07:42Z"}, "message": "rollup merge of #19513: lifthrasiir/rustdoc-fat-redirect\n\nWe heavily rely on queries and fragments in the URL structure, so it is desired to preserve them even in the redirects. The generated redirect pages try to preserve them with scripts, which take precedence over the original `Refresh` metadata. Non-scripting browsers would continue to work (with no queries and fragments).\n\n(This in turn solves a number of semi-broken links to the source code, which are actually linked to redirect pages.)", "tree": {"sha": "29b3fe5ceb607f4e5268273a2effa3f882a5f92a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29b3fe5ceb607f4e5268273a2effa3f882a5f92a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3a85cf822f437dd6391b98da7481c4a80b57667", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3a85cf822f437dd6391b98da7481c4a80b57667", "html_url": "https://github.com/rust-lang/rust/commit/f3a85cf822f437dd6391b98da7481c4a80b57667", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3a85cf822f437dd6391b98da7481c4a80b57667/comments", "author": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "committer": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33e96be29919be817d78eb932b58c237ac507ea6", "url": "https://api.github.com/repos/rust-lang/rust/commits/33e96be29919be817d78eb932b58c237ac507ea6", "html_url": "https://github.com/rust-lang/rust/commit/33e96be29919be817d78eb932b58c237ac507ea6"}, {"sha": "4b271f3f64ce334767b8ff10d19abc402a1838b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b271f3f64ce334767b8ff10d19abc402a1838b3", "html_url": "https://github.com/rust-lang/rust/commit/4b271f3f64ce334767b8ff10d19abc402a1838b3"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "23f31580619ee8b77cad695ecdb37f46a9699fc3", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f3a85cf822f437dd6391b98da7481c4a80b57667/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3a85cf822f437dd6391b98da7481c4a80b57667/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=f3a85cf822f437dd6391b98da7481c4a80b57667", "patch": "@@ -160,13 +160,16 @@ r##\"<!DOCTYPE html>\n }\n \n pub fn redirect(dst: &mut io::Writer, url: &str) -> io::IoResult<()> {\n+    // <script> triggers a redirect before refresh, so this is fine.\n     write!(dst,\n r##\"<!DOCTYPE html>\n <html lang=\"en\">\n <head>\n     <meta http-equiv=\"refresh\" content=\"0;URL={url}\">\n </head>\n <body>\n+    <p>Redirecting to <a href=\"{url}\">{url}</a>...</p>\n+    <script>location.replace(\"{url}\" + location.search + location.hash);</script>\n </body>\n </html>\"##,\n     url = url,"}]}