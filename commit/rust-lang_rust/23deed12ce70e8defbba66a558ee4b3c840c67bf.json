{"sha": "23deed12ce70e8defbba66a558ee4b3c840c67bf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzZGVlZDEyY2U3MGU4ZGVmYmJhNjZhNTU4ZWU0YjNjODQwYzY3YmY=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@pobox.com", "date": "2012-08-24T23:08:38Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@pobox.com", "date": "2012-08-24T23:08:38Z"}, "message": "Merge pull request #3269 from killerswan/modes3\n\nRemove deprecated modes from libstd/time.rs", "tree": {"sha": "d6a958b13afd0f7cb468918c8e9f0b9ce83369d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6a958b13afd0f7cb468918c8e9f0b9ce83369d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23deed12ce70e8defbba66a558ee4b3c840c67bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23deed12ce70e8defbba66a558ee4b3c840c67bf", "html_url": "https://github.com/rust-lang/rust/commit/23deed12ce70e8defbba66a558ee4b3c840c67bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23deed12ce70e8defbba66a558ee4b3c840c67bf/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c284b8b1dc348ab8b9c82350dd1b4e53fac1225c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c284b8b1dc348ab8b9c82350dd1b4e53fac1225c", "html_url": "https://github.com/rust-lang/rust/commit/c284b8b1dc348ab8b9c82350dd1b4e53fac1225c"}, {"sha": "2dc9be7a142e68550a71086104f7dc5104c1dbf9", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dc9be7a142e68550a71086104f7dc5104c1dbf9", "html_url": "https://github.com/rust-lang/rust/commit/2dc9be7a142e68550a71086104f7dc5104c1dbf9"}], "stats": {"total": 37, "additions": 20, "deletions": 17}, "files": [{"sha": "5ce9853fcdbb3b2126dda173a65577aa6d08ce4b", "filename": "src/libstd/time.rs", "status": "modified", "additions": 20, "deletions": 17, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/23deed12ce70e8defbba66a558ee4b3c840c67bf/src%2Flibstd%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23deed12ce70e8defbba66a558ee4b3c840c67bf/src%2Flibstd%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftime.rs?ref=23deed12ce70e8defbba66a558ee4b3c840c67bf", "patch": "@@ -1,3 +1,6 @@\n+#[forbid(deprecated_mode)];\n+#[forbid(deprecated_pattern)];\n+\n import libc::{c_char, c_int, c_long, size_t, time_t};\n import io::Reader;\n import result::{result, ok, err};\n@@ -128,7 +131,7 @@ fn now() -> tm {\n }\n \n /// Parses the time from the string according to the format string.\n-fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n+fn strptime(s: &str, format: &str) -> result<tm, ~str> {\n     type tm_mut = {\n        mut tm_sec: i32,\n        mut tm_min: i32,\n@@ -144,7 +147,7 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n        mut tm_nsec: i32,\n     };\n \n-    fn match_str(s: ~str, pos: uint, needle: ~str) -> bool {\n+    fn match_str(s: &str, pos: uint, needle: &str) -> bool {\n         let mut i = pos;\n         for str::each(needle) |ch| {\n             if s[i] != ch {\n@@ -155,14 +158,14 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n         return true;\n     }\n \n-    fn match_strs(s: ~str, pos: uint, strs: ~[(~str, i32)])\n+    fn match_strs(ss: &str, pos: uint, strs: &[(~str, i32)])\n       -> option<(i32, uint)> {\n         let mut i = 0u;\n         let len = vec::len(strs);\n         while i < len {\n             let (needle, value) = strs[i];\n \n-            if match_str(s, pos, needle) {\n+            if match_str(ss, pos, needle) {\n                 return some((value, pos + str::len(needle)));\n             }\n             i += 1u;\n@@ -171,14 +174,14 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n         none\n     }\n \n-    fn match_digits(s: ~str, pos: uint, digits: uint, ws: bool)\n+    fn match_digits(ss: &str, pos: uint, digits: uint, ws: bool)\n       -> option<(i32, uint)> {\n         let mut pos = pos;\n         let mut value = 0_i32;\n \n         let mut i = 0u;\n         while i < digits {\n-            let {ch, next} = str::char_range_at(s, pos);\n+            let {ch, next} = str::char_range_at(str::from_slice(ss), pos);\n             pos = next;\n \n             match ch {\n@@ -194,7 +197,7 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n         some((value, pos))\n     }\n \n-    fn parse_char(s: ~str, pos: uint, c: char) -> result<uint, ~str> {\n+    fn parse_char(s: &str, pos: uint, c: char) -> result<uint, ~str> {\n         let {ch, next} = str::char_range_at(s, pos);\n \n         if c == ch {\n@@ -206,7 +209,7 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n         }\n     }\n \n-    fn parse_type(s: ~str, pos: uint, ch: char, tm: tm_mut)\n+    fn parse_type(s: &str, pos: uint, ch: char, tm: &tm_mut)\n       -> result<uint, ~str> {\n         match ch {\n           'A' => match match_strs(s, pos, ~[\n@@ -516,7 +519,7 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n         }\n     }\n \n-    do io::with_str_reader(format) |rdr| {\n+    do io::with_str_reader(str::from_slice(format)) |rdr| {\n         let tm = {\n             mut tm_sec: 0_i32,\n             mut tm_min: 0_i32,\n@@ -539,7 +542,7 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n             let {ch, next} = str::char_range_at(s, pos);\n \n             match rdr.read_char() {\n-              '%' => match parse_type(s, pos, rdr.read_char(), tm) {\n+              '%' => match parse_type(s, pos, rdr.read_char(), &tm) {\n                 ok(next) => pos = next,\n                   err(e) => { result = err(e); break; }\n               },\n@@ -569,8 +572,8 @@ fn strptime(s: ~str, format: ~str) -> result<tm, ~str> {\n     }\n }\n \n-fn strftime(format: ~str, tm: tm) -> ~str {\n-    fn parse_type(ch: char, tm: tm) -> ~str {\n+fn strftime(format: &str, +tm: tm) -> ~str {\n+    fn parse_type(ch: char, tm: &tm) -> ~str {\n         //FIXME (#2350): Implement missing types.\n       let die = || #fmt(\"strftime: can't understand this format %c \",\n                              ch);\n@@ -725,10 +728,10 @@ fn strftime(format: ~str, tm: tm) -> ~str {\n \n     let mut buf = ~\"\";\n \n-    do io::with_str_reader(format) |rdr| {\n+    do io::with_str_reader(str::from_slice(format)) |rdr| {\n         while !rdr.eof() {\n             match rdr.read_char() {\n-                '%' => buf += parse_type(rdr.read_char(), tm),\n+                '%' => buf += parse_type(rdr.read_char(), &tm),\n                 ch => str::push_char(buf, ch)\n             }\n         }\n@@ -766,7 +769,7 @@ impl tm {\n     fn ctime() -> ~str { self.strftime(~\"%c\") }\n \n     /// Formats the time according to the format string.\n-    fn strftime(format: ~str) -> ~str { strftime(format, self) }\n+    fn strftime(format: &str) -> ~str { strftime(format, self) }\n \n     /**\n      * Returns a time string formatted according to RFC 822.\n@@ -983,9 +986,9 @@ mod tests {\n           }\n         }\n \n-        fn test(s: ~str, format: ~str) -> bool {\n+        fn test(s: &str, format: &str) -> bool {\n             match strptime(s, format) {\n-              ok(tm) => tm.strftime(format) == s,\n+              ok(tm) => tm.strftime(format) == str::from_slice(s),\n               err(e) => fail e\n             }\n         }"}]}