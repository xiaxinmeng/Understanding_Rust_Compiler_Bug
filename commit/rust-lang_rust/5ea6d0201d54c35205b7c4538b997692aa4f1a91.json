{"sha": "5ea6d0201d54c35205b7c4538b997692aa4f1a91", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlYTZkMDIwMWQ1NGMzNTIwNWI3YzQ1MzhiOTk3NjkyYWE0ZjFhOTE=", "commit": {"author": {"name": "SiegeLord", "email": "slabode@aim.com", "date": "2014-01-11T18:53:06Z"}, "committer": {"name": "SiegeLord", "email": "slabode@aim.com", "date": "2014-01-11T19:21:59Z"}, "message": "Tighten up float literal lexing.\n\nSpecifically, dissallow setting the number base for every type of float\nliteral, not only those that contain the decimal point. This is in line with\nthe description in the manual.", "tree": {"sha": "8638f991e17bb3a570fa1a2d7bc3f74a2fd98495", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8638f991e17bb3a570fa1a2d7bc3f74a2fd98495"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ea6d0201d54c35205b7c4538b997692aa4f1a91", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ea6d0201d54c35205b7c4538b997692aa4f1a91", "html_url": "https://github.com/rust-lang/rust/commit/5ea6d0201d54c35205b7c4538b997692aa4f1a91", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ea6d0201d54c35205b7c4538b997692aa4f1a91/comments", "author": {"login": "SiegeLord", "id": 480550, "node_id": "MDQ6VXNlcjQ4MDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/480550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SiegeLord", "html_url": "https://github.com/SiegeLord", "followers_url": "https://api.github.com/users/SiegeLord/followers", "following_url": "https://api.github.com/users/SiegeLord/following{/other_user}", "gists_url": "https://api.github.com/users/SiegeLord/gists{/gist_id}", "starred_url": "https://api.github.com/users/SiegeLord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SiegeLord/subscriptions", "organizations_url": "https://api.github.com/users/SiegeLord/orgs", "repos_url": "https://api.github.com/users/SiegeLord/repos", "events_url": "https://api.github.com/users/SiegeLord/events{/privacy}", "received_events_url": "https://api.github.com/users/SiegeLord/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SiegeLord", "id": 480550, "node_id": "MDQ6VXNlcjQ4MDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/480550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SiegeLord", "html_url": "https://github.com/SiegeLord", "followers_url": "https://api.github.com/users/SiegeLord/followers", "following_url": "https://api.github.com/users/SiegeLord/following{/other_user}", "gists_url": "https://api.github.com/users/SiegeLord/gists{/gist_id}", "starred_url": "https://api.github.com/users/SiegeLord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SiegeLord/subscriptions", "organizations_url": "https://api.github.com/users/SiegeLord/orgs", "repos_url": "https://api.github.com/users/SiegeLord/repos", "events_url": "https://api.github.com/users/SiegeLord/events{/privacy}", "received_events_url": "https://api.github.com/users/SiegeLord/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bdda359c3cf41e36ba01ca6aef826aca7cc81c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bdda359c3cf41e36ba01ca6aef826aca7cc81c0", "html_url": "https://github.com/rust-lang/rust/commit/4bdda359c3cf41e36ba01ca6aef826aca7cc81c0"}], "stats": {"total": 144, "additions": 133, "deletions": 11}, "files": [{"sha": "885cfbcbdbef5506fe1098a0186fdaedd609f4d5", "filename": "src/libsyntax/parse/lexer.rs", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Flibsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Flibsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -463,6 +463,19 @@ fn scan_digits(rdr: @StringReader, radix: uint) -> ~str {\n     };\n }\n \n+fn check_float_base(rdr: @StringReader, start_bpos: BytePos, last_bpos: BytePos,\n+                    base: uint) {\n+    match base {\n+      16u => fatal_span(rdr, start_bpos, last_bpos,\n+                      ~\"hexadecimal float literal is not supported\"),\n+      8u => fatal_span(rdr, start_bpos, last_bpos,\n+                     ~\"octal float literal is not supported\"),\n+      2u => fatal_span(rdr, start_bpos, last_bpos,\n+                     ~\"binary float literal is not supported\"),\n+      _ => ()\n+    }\n+}\n+\n fn scan_number(c: char, rdr: @StringReader) -> token::Token {\n     let mut num_str;\n     let mut base = 10u;\n@@ -540,17 +553,6 @@ fn scan_number(c: char, rdr: @StringReader) -> token::Token {\n         num_str.push_char('.');\n         num_str.push_str(dec_part);\n     }\n-    if is_float {\n-        match base {\n-          16u => fatal_span(rdr, start_bpos, rdr.last_pos.get(),\n-                            ~\"hexadecimal float literal is not supported\"),\n-          8u => fatal_span(rdr, start_bpos, rdr.last_pos.get(),\n-                           ~\"octal float literal is not supported\"),\n-          2u => fatal_span(rdr, start_bpos, rdr.last_pos.get(),\n-                           ~\"binary float literal is not supported\"),\n-          _ => ()\n-        }\n-    }\n     match scan_exponent(rdr, start_bpos) {\n       Some(ref s) => {\n         is_float = true;\n@@ -566,10 +568,12 @@ fn scan_number(c: char, rdr: @StringReader) -> token::Token {\n         if c == '3' && n == '2' {\n             bump(rdr);\n             bump(rdr);\n+            check_float_base(rdr, start_bpos, rdr.last_pos.get(), base);\n             return token::LIT_FLOAT(str_to_ident(num_str), ast::TyF32);\n         } else if c == '6' && n == '4' {\n             bump(rdr);\n             bump(rdr);\n+            check_float_base(rdr, start_bpos, rdr.last_pos.get(), base);\n             return token::LIT_FLOAT(str_to_ident(num_str), ast::TyF64);\n             /* FIXME (#2252): if this is out of range for either a\n             32-bit or 64-bit float, it won't be noticed till the\n@@ -580,6 +584,7 @@ fn scan_number(c: char, rdr: @StringReader) -> token::Token {\n         }\n     }\n     if is_float {\n+        check_float_base(rdr, start_bpos, rdr.last_pos.get(), base);\n         return token::LIT_FLOAT_UNSUFFIXED(str_to_ident(num_str));\n     } else {\n         if num_str.len() == 0u {"}, {"sha": "659cb5c8379557086570de8dd4ad61896b19c7b5", "filename": "src/test/compile-fail/lex-bad-fp-base-1.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-1.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let a = 0o1.0; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "b1d45f78e4a5bda24f1ade6ac80778820ea4054d", "filename": "src/test/compile-fail/lex-bad-fp-base-2.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-2.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let b = 0o2f32; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "79c42360adb2f81c7a495e10627e092972618d06", "filename": "src/test/compile-fail/lex-bad-fp-base-3.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-3.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let c = 0o3.0f32; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "eaea61b0089afa6fdbc9f42a31c12be560546679", "filename": "src/test/compile-fail/lex-bad-fp-base-4.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-4.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let d = 0o4e4; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "ee25ed95639e265b7ec4b0a4f59951e4b33ea64e", "filename": "src/test/compile-fail/lex-bad-fp-base-5.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-5.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-5.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-5.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let e = 0o5.0e5; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "bf08ec1eae5fe85f656958574ec665c6c03a277f", "filename": "src/test/compile-fail/lex-bad-fp-base-6.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-6.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-6.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-6.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let f = 0o6e6f32; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "921ed8f1b69e8893a5bead316419f02d8ad74112", "filename": "src/test/compile-fail/lex-bad-fp-base-7.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-7.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-7.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-7.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let g = 0o7.0e7f64; //~ ERROR: octal float literal is not supported\n+}"}, {"sha": "10e334ede01c2326b2f4a06aa650fa786163c9d0", "filename": "src/test/compile-fail/lex-bad-fp-base-8.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-8.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-8.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-8.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let h = 0x8.0e+9; //~ ERROR: hexadecimal float literal is not supported\n+}"}, {"sha": "3ea151cb9826a2b6258b25dee09cd7298885a801", "filename": "src/test/compile-fail/lex-bad-fp-base-9.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-9.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ea6d0201d54c35205b7c4538b997692aa4f1a91/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-9.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flex-bad-fp-base-9.rs?ref=5ea6d0201d54c35205b7c4538b997692aa4f1a91", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let i = 0x9.0e-9; //~ ERROR: hexadecimal float literal is not supported\n+}"}]}