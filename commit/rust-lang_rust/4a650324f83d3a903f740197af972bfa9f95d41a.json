{"sha": "4a650324f83d3a903f740197af972bfa9f95d41a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhNjUwMzI0ZjgzZDNhOTAzZjc0MDE5N2FmOTcyYmZhOWY5NWQ0MWE=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-01-19T17:53:25Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-01-27T04:05:36Z"}, "message": "Ensure that we error when calling \"const extern fn\" with wrong convention\n\nSee #64926", "tree": {"sha": "df306cd53348b568ea0b91197a332ee703dd4c02", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df306cd53348b568ea0b91197a332ee703dd4c02"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a650324f83d3a903f740197af972bfa9f95d41a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl4uYZIACgkQtAh+UQ6Y\nsWQAOQ//ROBJwB1L6MSTjAv1LxHj0et9EDGCegoQaOCxoeK5t+aOzORC+K9r1T0s\npA9VtzG/LyXG6LlzxNFzNmUsaIj3HavbEsbNG8s10XW+7e0Dm7Cz9oNGFVmBdS3T\nE4aNI1egnT6lm3Nu5yJM+Ab4tV6Jo6BAlJFn53RTQ2lxjmZjwrUAXAJdgvg2jCK/\nJ6sgLgpiVcwicI98gahdfUcy6s/WUntFrZzOlVtEIq5b6Cvlwq2mMnTcoVmtbNSf\nt7ReW7KFk18GCgiGh5rbGtlUeiq4hVxv1+IG0RGDQK0WVBHWboI2a7vtppC4bF8I\nBJeRimEo2RoaFfwzj7YpfP6GQYVnud20PoGb6VOGKIcR7ep1z9LVXundvj954gNH\nzRgcBIkkPlPjCt4wlEkWheC/vq/Qszbzf5CUO2FDKbOdfEkKZ65pGmi4vh2dwJkp\nB3vOQNfoEEfwX0LkP76v5Wg2nz1SuEZKZtm3Ks35VBxQCFA7iP0MheCgOhczzdpO\naQJsoLccDpmEEaQcHz+fIB8A57eZaG0u2MzTOTdkRpTMJs6BTo/e7yxcns0TNq4P\nrzjSQfA2UaR5P5AfNsLvMmoyKegtUIOmOeNQCRDwF7ptXJm/KgMt/fJQY6a3xQkG\nq12qsGe3Uf4+4d1GOjbt2qmAnme7yPiceDYJWWDpyHHqO7GwShM=\n=Ox6G\n-----END PGP SIGNATURE-----", "payload": "tree df306cd53348b568ea0b91197a332ee703dd4c02\nparent 6250d56355d72264ece721e8d0dc95b16a6824b1\nauthor Aaron Hill <aa1ronham@gmail.com> 1579456405 -0500\ncommitter Aaron Hill <aa1ronham@gmail.com> 1580097936 -0500\n\nEnsure that we error when calling \"const extern fn\" with wrong convention\n\nSee #64926\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a650324f83d3a903f740197af972bfa9f95d41a", "html_url": "https://github.com/rust-lang/rust/commit/4a650324f83d3a903f740197af972bfa9f95d41a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a650324f83d3a903f740197af972bfa9f95d41a/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6250d56355d72264ece721e8d0dc95b16a6824b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/6250d56355d72264ece721e8d0dc95b16a6824b1", "html_url": "https://github.com/rust-lang/rust/commit/6250d56355d72264ece721e8d0dc95b16a6824b1"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "d8e63b0bfb24ecff8db55724dbc8e285777d202c", "filename": "src/test/ui/consts/miri_unleashed/abi-mismatch.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4a650324f83d3a903f740197af972bfa9f95d41a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a650324f83d3a903f740197af972bfa9f95d41a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs?ref=4a650324f83d3a903f740197af972bfa9f95d41a", "patch": "@@ -0,0 +1,16 @@\n+// Checks that we report ABI mismatches for \"const extern fn\"\n+// compile-flags: -Z unleash-the-miri-inside-of-you\n+\n+#![feature(const_extern_fn)]\n+\n+const extern \"C\" fn c_fn() {}\n+\n+const fn call_rust_fn(my_fn: extern \"Rust\" fn()) {\n+    my_fn(); //~ ERROR any use of this value will cause an error\n+    //~^ WARN skipping const checks\n+}\n+\n+const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+//~^ WARN skipping const checks\n+\n+fn main() {}"}, {"sha": "da00c49963eec2778231a36c93a9491e2f403df4", "filename": "src/test/ui/consts/miri_unleashed/abi-mismatch.stderr", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/4a650324f83d3a903f740197af972bfa9f95d41a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4a650324f83d3a903f740197af972bfa9f95d41a/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr?ref=4a650324f83d3a903f740197af972bfa9f95d41a", "patch": "@@ -0,0 +1,28 @@\n+warning: skipping const checks\n+  --> $DIR/abi-mismatch.rs:9:5\n+   |\n+LL |     my_fn();\n+   |     ^^^^^^^\n+\n+warning: skipping const checks\n+  --> $DIR/abi-mismatch.rs:13:39\n+   |\n+LL | const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: any use of this value will cause an error\n+  --> $DIR/abi-mismatch.rs:9:5\n+   |\n+LL |     my_fn();\n+   |     ^^^^^^^\n+   |     |\n+   |     tried to call a function with ABI C using caller ABI Rust\n+   |     inside call to `call_rust_fn` at $DIR/abi-mismatch.rs:13:17\n+...\n+LL | const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+   | --------------------------------------------------------------------------------------\n+   |\n+   = note: `#[deny(const_err)]` on by default\n+\n+error: aborting due to previous error\n+"}]}