{"sha": "15eccf29e8eb4ee458c1c57474e2735a33cef55e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1ZWNjZjI5ZThlYjRlZTQ1OGMxYzU3NDc0ZTI3MzVhMzNjZWY1NWU=", "commit": {"author": {"name": "oxalica", "email": "oxalicc@pm.me", "date": "2021-08-26T08:42:45Z"}, "committer": {"name": "oxalica", "email": "oxalicc@pm.me", "date": "2021-08-26T09:21:23Z"}, "message": "Fix missing unsafe block for the nightly change\n\nFix #10022", "tree": {"sha": "ed070eb6124a2a9e639e623baec8a6bffed2e1e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed070eb6124a2a9e639e623baec8a6bffed2e1e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/15eccf29e8eb4ee458c1c57474e2735a33cef55e", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEXLDp5dXVcfV/VA/qztOS3gxIPQAFAmEnXRYACgkQztOS3gxI\nPQAwmhAAucqkxoTm+3nieqDSFGGpMS4rSQ8x8gp6oa8oVWrCvdogiTKhm43cRkc+\n/WOBDrdacLCb6ozOYUIrWNmjoEI46OKSz3ujm2/5zm901usOy1SL0PRcPbE8j0rK\nF4inM9iqseIP1El3kRhUScWrziAZ/A3NWozFKOp/Ll2prkhMxb3Thk+SQSIDyX05\n5p2eN4y4ai/xa/bu59Y4EvBVoDFcV/z1/tSUqVSiWKi1QkurG8fp/F+7CiurSWnv\n5qJz6XyvFHeEqL/mGwMsT4J/q/qPF9l9hTcJ6zuaBtLysP+SB4ANzWweEEJiKIR2\niKZE2mCwx3SOKUPCBHF1VEv+8VUzSRt/FE8CnqjnH6VDCm2HKjB93QTGEHvhPN09\nfXeNOk7qeIE7bRe0qCmW851eiwOk6R/UlnO8gJ9MCCfyJz1OcX1uJjtWPr0HwGHl\nkZAJun3kCj7ujpMnDhmf+u7fyweGSFM10VKHnZ+XtHIC0BtZOQ30ZGosMKVJ8eMM\n8xEricnPRhJpej4hhdhR9+3ICYKQWInULcKym6l3SyOAzIHTpHcSVn6guqUnlucj\nlgLEyfr05B7P+qojZqwny4u1b/yYL02KK60zW3GCwkkn5+4WDs9czwg1NAD63Zr7\nsaPYf6QyVagNJC2nFCmiifLrCI8KHJdB4Hhsgb4NPEYhJxomd9s=\n=/4QG\n-----END PGP SIGNATURE-----", "payload": "tree ed070eb6124a2a9e639e623baec8a6bffed2e1e0\nparent 793389b61afe9336e40a4cf8f75286ec3ea74582\nauthor oxalica <oxalicc@pm.me> 1629967365 +0800\ncommitter oxalica <oxalicc@pm.me> 1629969683 +0800\n\nFix missing unsafe block for the nightly change\n\nFix #10022\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/15eccf29e8eb4ee458c1c57474e2735a33cef55e", "html_url": "https://github.com/rust-lang/rust/commit/15eccf29e8eb4ee458c1c57474e2735a33cef55e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/15eccf29e8eb4ee458c1c57474e2735a33cef55e/comments", "author": {"login": "oxalica", "id": 14816024, "node_id": "MDQ6VXNlcjE0ODE2MDI0", "avatar_url": "https://avatars.githubusercontent.com/u/14816024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oxalica", "html_url": "https://github.com/oxalica", "followers_url": "https://api.github.com/users/oxalica/followers", "following_url": "https://api.github.com/users/oxalica/following{/other_user}", "gists_url": "https://api.github.com/users/oxalica/gists{/gist_id}", "starred_url": "https://api.github.com/users/oxalica/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oxalica/subscriptions", "organizations_url": "https://api.github.com/users/oxalica/orgs", "repos_url": "https://api.github.com/users/oxalica/repos", "events_url": "https://api.github.com/users/oxalica/events{/privacy}", "received_events_url": "https://api.github.com/users/oxalica/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oxalica", "id": 14816024, "node_id": "MDQ6VXNlcjE0ODE2MDI0", "avatar_url": "https://avatars.githubusercontent.com/u/14816024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oxalica", "html_url": "https://github.com/oxalica", "followers_url": "https://api.github.com/users/oxalica/followers", "following_url": "https://api.github.com/users/oxalica/following{/other_user}", "gists_url": "https://api.github.com/users/oxalica/gists{/gist_id}", "starred_url": "https://api.github.com/users/oxalica/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oxalica/subscriptions", "organizations_url": "https://api.github.com/users/oxalica/orgs", "repos_url": "https://api.github.com/users/oxalica/repos", "events_url": "https://api.github.com/users/oxalica/events{/privacy}", "received_events_url": "https://api.github.com/users/oxalica/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "793389b61afe9336e40a4cf8f75286ec3ea74582", "url": "https://api.github.com/repos/rust-lang/rust/commits/793389b61afe9336e40a4cf8f75286ec3ea74582", "html_url": "https://github.com/rust-lang/rust/commit/793389b61afe9336e40a4cf8f75286ec3ea74582"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "f3bfd659875ff8d236c32d82bf1808607cecbdf4", "filename": "crates/hir_expand/src/builtin_macro.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/15eccf29e8eb4ee458c1c57474e2735a33cef55e/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15eccf29e8eb4ee458c1c57474e2735a33cef55e/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs?ref=15eccf29e8eb4ee458c1c57474e2735a33cef55e", "patch": "@@ -256,7 +256,13 @@ fn format_args_expand(\n         quote! { std::fmt::ArgumentV1::new(&(#arg), std::fmt::Display::fmt), }\n     }.token_trees);\n     let expanded = quote! {\n-        std::fmt::Arguments::new_v1(&[], &[##arg_tts])\n+        // It's unsafe since https://github.com/rust-lang/rust/pull/83302\n+        // Wrap an unsafe block to avoid false-positive `missing-unsafe` lint.\n+        // FIXME: Currently we don't have `unused_unsafe` lint so an extra unsafe block won't cause issues on early\n+        // stable rust-src.\n+        unsafe {\n+            std::fmt::Arguments::new_v1(&[], &[##arg_tts])\n+        }\n     };\n     ExpandResult::ok(expanded)\n }\n@@ -762,7 +768,7 @@ mod tests {\n             format_args!(\"{} {:?}\", arg1(a, b, c), arg2);\n             \"#,\n             expect![[\n-                r#\"std::fmt::Arguments::new_v1(&[], &[std::fmt::ArgumentV1::new(&(arg1(a,b,c)),std::fmt::Display::fmt),std::fmt::ArgumentV1::new(&(arg2),std::fmt::Display::fmt),])\"#\n+                r#\"unsafe{std::fmt::Arguments::new_v1(&[], &[std::fmt::ArgumentV1::new(&(arg1(a,b,c)),std::fmt::Display::fmt),std::fmt::ArgumentV1::new(&(arg2),std::fmt::Display::fmt),])}\"#\n             ]],\n         );\n     }\n@@ -779,7 +785,7 @@ mod tests {\n             format_args!(\"{} {:?}\", a::<A,B>(), b);\n             \"#,\n             expect![[\n-                r#\"std::fmt::Arguments::new_v1(&[], &[std::fmt::ArgumentV1::new(&(a::<A,B>()),std::fmt::Display::fmt),std::fmt::ArgumentV1::new(&(b),std::fmt::Display::fmt),])\"#\n+                r#\"unsafe{std::fmt::Arguments::new_v1(&[], &[std::fmt::ArgumentV1::new(&(a::<A,B>()),std::fmt::Display::fmt),std::fmt::ArgumentV1::new(&(b),std::fmt::Display::fmt),])}\"#\n             ]],\n         );\n     }"}]}