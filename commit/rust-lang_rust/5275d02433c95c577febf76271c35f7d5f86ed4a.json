{"sha": "5275d02433c95c577febf76271c35f7d5f86ed4a", "node_id": "C_kwDOAAsO6NoAKDUyNzVkMDI0MzNjOTVjNTc3ZmViZjc2MjcxYzM1ZjdkNWY4NmVkNGE", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-03-02T17:10:07Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-03-02T17:10:07Z"}, "message": "Use Vec for expectations to have a constant order (RFC-2383)", "tree": {"sha": "b251924430b462c70555d074f43f613dae937c24", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b251924430b462c70555d074f43f613dae937c24"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5275d02433c95c577febf76271c35f7d5f86ed4a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEsfZNmu/fmIv8KDcv/Ny/Ka9k1gEFAmIfpO8ACgkQ/Ny/Ka9k\n1gGxAhAAksEcT0CbhzEcKUP/9/QHDOSYRmT+0sEQm8gZ4w/hdxyvk5ErQ/tRJUSJ\nKFvfcjM10dco8n+zK8yWWbfO28NNRsoxEZspVa7baNNB0SDVUq5QVBHwNAAY2x+L\nwo8MsNS9VsaBxBYpxkhYUuh7CNU1ZghY5ayeAMPDqcsmrQx1ahPc1TBgcnpKs2Kh\n6Dqrm8gF+QwtP8fivOyCu/acLCZHTVe3M/vaFpqjsDpitf+ZzogNdzwH5VIUr9MX\naLg51dW5E1jjkvEwMqTRqG3s24Pp6s++mV1jryU+rEq7l8d8cvkqOnIs/emlKgsz\nRot/7UKoKsWPCVeB36AHci0bSkuUtwOfSNriYKyzOagNe1ygWFIUtHqdmheGVYdc\nIUyIWfugvELkMZxpSCP+yumxufaTRdTNf3quZuTjHiKGQyMZ6ZrKOHs1ZR1Nujoz\nNooqxlthwT8fe5c+pavwuAArLRYfxJX0ytxFzU4JsacBcXFILJ43jqnXQ3cHKCWX\nurbwJlKa3lL3im7gTTONa+ccKtp8gOo+ltLED6dZ+7/E8UcKWZfNQTDW2zCsrKHd\nAAA6Zr3NdcSRUKruu5YBZzI4LQlRxqm9eEafatGdXxZYgr9j9cAxLL1RiqYUcVw7\nV9ufl1Zy2dF27cB/BCUFpqJ6fZDDX12c3XwLVfCFZFXcy39ENfI=\n=Zjat\n-----END PGP SIGNATURE-----", "payload": "tree b251924430b462c70555d074f43f613dae937c24\nparent defc056ccc8d0a64048b65915c9d9b29fd5d4ba2\nauthor xFrednet <xFrednet@gmail.com> 1646241007 +0100\ncommitter xFrednet <xFrednet@gmail.com> 1646241007 +0100\n\nUse Vec for expectations to have a constant order (RFC-2383)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5275d02433c95c577febf76271c35f7d5f86ed4a", "html_url": "https://github.com/rust-lang/rust/commit/5275d02433c95c577febf76271c35f7d5f86ed4a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5275d02433c95c577febf76271c35f7d5f86ed4a/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "defc056ccc8d0a64048b65915c9d9b29fd5d4ba2", "url": "https://api.github.com/repos/rust-lang/rust/commits/defc056ccc8d0a64048b65915c9d9b29fd5d4ba2", "html_url": "https://github.com/rust-lang/rust/commit/defc056ccc8d0a64048b65915c9d9b29fd5d4ba2"}], "stats": {"total": 54, "additions": 26, "deletions": 28}, "files": [{"sha": "e6c9d0b0ab000790cbd7bab015df5e5e0febe80e", "filename": "compiler/rustc_lint/src/expect.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_lint%2Fsrc%2Fexpect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_lint%2Fsrc%2Fexpect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fexpect.rs?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -1,5 +1,4 @@\n use crate::builtin;\n-use rustc_data_structures::fx::FxHashMap;\n use rustc_hir::HirId;\n use rustc_middle::{lint::LintExpectation, ty::TyCtxt};\n use rustc_session::lint::LintExpectationId;\n@@ -11,8 +10,7 @@ pub fn check_expectations(tcx: TyCtxt<'_>) {\n     }\n \n     let fulfilled_expectations = tcx.sess.diagnostic().steal_fulfilled_expectation_ids();\n-    let lint_expectations: &FxHashMap<LintExpectationId, LintExpectation> =\n-        &tcx.lint_levels(()).lint_expectations;\n+    let lint_expectations = &tcx.lint_levels(()).lint_expectations;\n \n     for (id, expectation) in lint_expectations {\n         if !fulfilled_expectations.contains(id) {"}, {"sha": "f46f74fa45fb044c7775d7e0ae37dfc490c9f104", "filename": "compiler/rustc_lint/src/levels.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flevels.rs?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -45,7 +45,7 @@ fn lint_levels(tcx: TyCtxt<'_>, (): ()) -> LintLevelMap {\n \n pub struct LintLevelsBuilder<'s> {\n     sess: &'s Session,\n-    lint_expectations: FxHashMap<LintExpectationId, LintExpectation>,\n+    lint_expectations: Vec<(LintExpectationId, LintExpectation)>,\n     /// Each expectation has a stable and an unstable identifier. This map\n     /// is used to map from unstable to stable [`LintExpectationId`]s.\n     expectation_id_map: FxHashMap<LintExpectationId, LintExpectationId>,\n@@ -355,7 +355,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                         }\n                         if let Level::Expect(expect_id) = level {\n                             self.lint_expectations\n-                                .insert(expect_id, LintExpectation::new(reason, sp));\n+                                .push((expect_id, LintExpectation::new(reason, sp)));\n                         }\n                     }\n \n@@ -374,7 +374,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                                 }\n                                 if let Level::Expect(expect_id) = level {\n                                     self.lint_expectations\n-                                        .insert(expect_id, LintExpectation::new(reason, sp));\n+                                        .push((expect_id, LintExpectation::new(reason, sp)));\n                                 }\n                             }\n                             Err((Some(ids), ref new_lint_name)) => {\n@@ -414,7 +414,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                                 }\n                                 if let Level::Expect(expect_id) = level {\n                                     self.lint_expectations\n-                                        .insert(expect_id, LintExpectation::new(reason, sp));\n+                                        .push((expect_id, LintExpectation::new(reason, sp)));\n                                 }\n                             }\n                             Err((None, _)) => {\n@@ -511,7 +511,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                         }\n                         if let Level::Expect(expect_id) = level {\n                             self.lint_expectations\n-                                .insert(expect_id, LintExpectation::new(reason, sp));\n+                                .push((expect_id, LintExpectation::new(reason, sp)));\n                         }\n                     } else {\n                         panic!(\"renamed lint does not exist: {}\", new_name);"}, {"sha": "894947fa70d969506628d27370b25b6fbdcb0745", "filename": "compiler/rustc_middle/src/lint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flint.rs?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -159,7 +159,7 @@ pub struct LintLevelMap {\n     ///\n     /// The [`LintExpectationId`] is stored as a part of the [`Expect`](Level::Expect)\n     /// lint level.\n-    pub lint_expectations: FxHashMap<LintExpectationId, LintExpectation>,\n+    pub lint_expectations: Vec<(LintExpectationId, LintExpectation)>,\n     pub sets: LintLevelSets,\n     pub id_to_set: FxHashMap<HirId, LintStackIndex>,\n }"}, {"sha": "90ee744b26b01799416da2bfd8af3e8c10134220", "filename": "src/test/ui/lint/rfc-2383-lint-reason/expect_multiple_lints.stderr", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_multiple_lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_multiple_lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_multiple_lints.stderr?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -7,10 +7,10 @@ LL | #[expect(unused_variables, unused_mut, while_true)]\n    = note: `#[warn(unfulfilled_lint_expectations)]` on by default\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:28:10\n+  --> $DIR/expect_multiple_lints.rs:10:40\n    |\n LL | #[expect(unused_variables, unused_mut, while_true)]\n-   |          ^^^^^^^^^^^^^^^^\n+   |                                        ^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n   --> $DIR/expect_multiple_lints.rs:19:10\n@@ -19,34 +19,34 @@ LL | #[expect(unused_variables, unused_mut, while_true)]\n    |          ^^^^^^^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:28:28\n+  --> $DIR/expect_multiple_lints.rs:19:40\n    |\n LL | #[expect(unused_variables, unused_mut, while_true)]\n-   |                            ^^^^^^^^^^\n+   |                                        ^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:36:18\n+  --> $DIR/expect_multiple_lints.rs:28:10\n    |\n-LL | #[expect(unused, while_true)]\n-   |                  ^^^^^^^^^^\n+LL | #[expect(unused_variables, unused_mut, while_true)]\n+   |          ^^^^^^^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:19:40\n+  --> $DIR/expect_multiple_lints.rs:28:28\n    |\n LL | #[expect(unused_variables, unused_mut, while_true)]\n-   |                                        ^^^^^^^^^^\n+   |                            ^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:45:10\n+  --> $DIR/expect_multiple_lints.rs:36:18\n    |\n LL | #[expect(unused, while_true)]\n-   |          ^^^^^^\n+   |                  ^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_multiple_lints.rs:10:40\n+  --> $DIR/expect_multiple_lints.rs:45:10\n    |\n-LL | #[expect(unused_variables, unused_mut, while_true)]\n-   |                                        ^^^^^^^^^^\n+LL | #[expect(unused, while_true)]\n+   |          ^^^^^^\n \n warning: 8 warnings emitted\n "}, {"sha": "8f94bd6ec6cb81e6d1adda56e820150df9add2e1", "filename": "src/test/ui/lint/rfc-2383-lint-reason/expect_nested_lint_levels.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.rs?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -6,6 +6,7 @@\n #[expect(\n     unused_mut,\n     //~^ WARNING this lint expectation is unfulfilled [unfulfilled_lint_expectations]\n+    //~| NOTE `#[warn(unfulfilled_lint_expectations)]` on by default\n     //~| NOTE this `expect` is overridden by a `allow` attribute before the `unused_mut` lint is triggered\n     reason = \"this `expect` is overridden by a `allow` attribute before the `unused_mut` lint is triggered\"\n )]\n@@ -22,7 +23,6 @@ mod foo {\n #[expect(\n     unused_mut,\n     //~^ WARNING this lint expectation is unfulfilled [unfulfilled_lint_expectations]\n-    //~| NOTE `#[warn(unfulfilled_lint_expectations)]` on by default\n     //~| NOTE this `expect` is overridden by a `warn` attribute before the `unused_mut` lint is triggered\n     reason = \"this `expect` is overridden by a `warn` attribute before the `unused_mut` lint is triggered\"\n )]"}, {"sha": "370e51bf70a7a203ddfc92cea79dbcd5e27d2539", "filename": "src/test/ui/lint/rfc-2383-lint-reason/expect_nested_lint_levels.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5275d02433c95c577febf76271c35f7d5f86ed4a/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frfc-2383-lint-reason%2Fexpect_nested_lint_levels.stderr?ref=5275d02433c95c577febf76271c35f7d5f86ed4a", "patch": "@@ -26,21 +26,21 @@ LL |         unused_mut,\n    |         ^^^^^^^^^^\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_nested_lint_levels.rs:23:5\n+  --> $DIR/expect_nested_lint_levels.rs:7:5\n    |\n LL |     unused_mut,\n    |     ^^^^^^^^^^\n    |\n    = note: `#[warn(unfulfilled_lint_expectations)]` on by default\n-   = note: this `expect` is overridden by a `warn` attribute before the `unused_mut` lint is triggered\n+   = note: this `expect` is overridden by a `allow` attribute before the `unused_mut` lint is triggered\n \n warning: this lint expectation is unfulfilled\n-  --> $DIR/expect_nested_lint_levels.rs:7:5\n+  --> $DIR/expect_nested_lint_levels.rs:24:5\n    |\n LL |     unused_mut,\n    |     ^^^^^^^^^^\n    |\n-   = note: this `expect` is overridden by a `allow` attribute before the `unused_mut` lint is triggered\n+   = note: this `expect` is overridden by a `warn` attribute before the `unused_mut` lint is triggered\n \n warning: this lint expectation is unfulfilled\n   --> $DIR/expect_nested_lint_levels.rs:43:10"}]}