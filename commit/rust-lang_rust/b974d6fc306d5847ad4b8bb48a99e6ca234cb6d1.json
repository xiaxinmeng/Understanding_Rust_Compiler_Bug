{"sha": "b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NzRkNmZjMzA2ZDU4NDdhZDRiOGJiNDhhOTllNmNhMjM0Y2I2ZDE=", "commit": {"author": {"name": "Matthew Kuo", "email": "matthew.kuo@dialexa.com", "date": "2020-03-08T04:01:11Z"}, "committer": {"name": "Matthew Kuo", "email": "matthew.kuo@dialexa.com", "date": "2020-03-09T13:27:45Z"}, "message": "test(patterns): add borrowck tests for combination of pattern features\n\nAdds borrowck tests for the following features:\n- bindings_after_at\n- or_patterns\n- slice_patterns\n- box_patterns", "tree": {"sha": "ee0a179e753693cb73904cd2eb333ee39bede838", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee0a179e753693cb73904cd2eb333ee39bede838"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "html_url": "https://github.com/rust-lang/rust/commit/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1/comments", "author": {"login": "thekuom", "id": 15683724, "node_id": "MDQ6VXNlcjE1NjgzNzI0", "avatar_url": "https://avatars.githubusercontent.com/u/15683724?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thekuom", "html_url": "https://github.com/thekuom", "followers_url": "https://api.github.com/users/thekuom/followers", "following_url": "https://api.github.com/users/thekuom/following{/other_user}", "gists_url": "https://api.github.com/users/thekuom/gists{/gist_id}", "starred_url": "https://api.github.com/users/thekuom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thekuom/subscriptions", "organizations_url": "https://api.github.com/users/thekuom/orgs", "repos_url": "https://api.github.com/users/thekuom/repos", "events_url": "https://api.github.com/users/thekuom/events{/privacy}", "received_events_url": "https://api.github.com/users/thekuom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thekuom", "id": 15683724, "node_id": "MDQ6VXNlcjE1NjgzNzI0", "avatar_url": "https://avatars.githubusercontent.com/u/15683724?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thekuom", "html_url": "https://github.com/thekuom", "followers_url": "https://api.github.com/users/thekuom/followers", "following_url": "https://api.github.com/users/thekuom/following{/other_user}", "gists_url": "https://api.github.com/users/thekuom/gists{/gist_id}", "starred_url": "https://api.github.com/users/thekuom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thekuom/subscriptions", "organizations_url": "https://api.github.com/users/thekuom/orgs", "repos_url": "https://api.github.com/users/thekuom/repos", "events_url": "https://api.github.com/users/thekuom/events{/privacy}", "received_events_url": "https://api.github.com/users/thekuom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "823ff8cf1397a5772b1f6954b60576202bf91836", "url": "https://api.github.com/repos/rust-lang/rust/commits/823ff8cf1397a5772b1f6954b60576202bf91836", "html_url": "https://github.com/rust-lang/rust/commit/823ff8cf1397a5772b1f6954b60576202bf91836"}], "stats": {"total": 432, "additions": 432, "deletions": 0}, "files": [{"sha": "b67d494866b85d7f181e30a8b6dea1e124b2c2bb", "filename": "src/test/ui/borrowck/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs", "status": "added", "additions": 224, "deletions": 0, "changes": 224, "blob_url": "https://github.com/rust-lang/rust/blob/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.rs?ref=b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "patch": "@@ -0,0 +1,224 @@\n+// Tests using a combination of pattern features has the expected borrow checking behavior\n+#![feature(bindings_after_at)]\n+#![feature(or_patterns)]\n+#![feature(box_patterns)]\n+\n+#![feature(move_ref_pattern)]\n+\n+enum Test {\n+    Foo,\n+    Bar,\n+    _Baz,\n+}\n+\n+// bindings_after_at + slice_patterns\n+\n+fn bindings_after_at_slice_patterns_move_binding(x: [String; 4]) {\n+    match x {\n+        a @ [.., _] => (),\n+        _ => (),\n+    };\n+\n+    &x;\n+    //~^ ERROR borrow of moved value\n+}\n+\n+fn bindings_after_at_slice_patterns_borrows_binding_mut(mut x: [String; 4]) {\n+    let r = match x {\n+        ref mut foo @ [.., _] => Some(foo),\n+        _ => None,\n+    };\n+\n+    &x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_borrows_slice_mut1(mut x: [String; 4]) {\n+    let r = match x {\n+        ref foo @ [.., ref mut bar] => (),\n+        //~^ ERROR cannot borrow\n+        _ => (),\n+    };\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_borrows_slice_mut2(mut x: [String; 4]) {\n+    let r = match x {\n+        [ref foo @ .., ref bar] => Some(foo),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_borrows_both(mut x: [String; 4]) {\n+    let r = match x {\n+        ref foo @ [.., ref bar] => Some(foo),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+// bindings_after_at + or_patterns\n+\n+fn bindings_after_at_or_patterns_move(x: Option<Test>) {\n+    match x {\n+        foo @ Some(Test::Foo | Test::Bar) => (),\n+        _ => (),\n+    }\n+\n+    &x;\n+    //~^ ERROR borrow of moved value\n+}\n+\n+fn bindings_after_at_or_patterns_borrows(mut x: Option<Test>) {\n+    let r = match x {\n+        ref foo @ Some(Test::Foo | Test::Bar) => Some(foo),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_or_patterns_borrows_mut(mut x: Option<Test>) {\n+    let r = match x {\n+        ref mut foo @ Some(Test::Foo | Test::Bar) => Some(foo),\n+        _ => None,\n+    };\n+\n+    &x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+// bindings_after_at + box_patterns\n+\n+fn bindings_after_at_box_patterns_borrows_both(mut x: Option<Box<String>>) {\n+    let r = match x {\n+        ref foo @ Some(box ref s) => Some(foo),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_box_patterns_borrows_mut(mut x: Option<Box<String>>) {\n+    match x {\n+        ref foo @ Some(box ref mut s) => (),\n+        //~^ ERROR cannot borrow\n+        _ => (),\n+    };\n+}\n+\n+// bindings_after_at + slice_patterns + or_patterns\n+\n+fn bindings_after_at_slice_patterns_or_patterns_moves(x: [Option<Test>; 4]) {\n+    match x {\n+        a @ [.., Some(Test::Foo | Test::Bar)] => (),\n+        _ => (),\n+    };\n+\n+    &x;\n+    //~^ ERROR borrow of moved value\n+}\n+\n+fn bindings_after_at_slice_patterns_or_patterns_borrows_binding(mut x: [Option<Test>; 4]) {\n+    let r = match x {\n+        ref a @ [ref b @ .., Some(Test::Foo | Test::Bar)] => Some(a),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_or_patterns_borrows_slice(mut x: [Option<Test>; 4]) {\n+    let r = match x {\n+        ref a @ [ref b @ .., Some(Test::Foo | Test::Bar)] => Some(b),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+// bindings_after_at + slice_patterns + box_patterns\n+\n+fn bindings_after_at_slice_patterns_box_patterns_borrows(mut x: [Option<Box<String>>; 4]) {\n+    let r = match x {\n+        [_, ref a @ Some(box ref b), ..] => Some(a),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+// bindings_after_at + slice_patterns + or_patterns + box_patterns\n+\n+fn bindings_after_at_slice_patterns_or_patterns_box_patterns_borrows(\n+    mut x: [Option<Box<Test>>; 4]\n+) {\n+    let r = match x {\n+        [_, ref a @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_or_patterns_box_patterns_borrows_mut(\n+    mut x: [Option<Box<Test>>; 4]\n+) {\n+    let r = match x {\n+        [_, ref mut a @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+        _ => None,\n+    };\n+\n+    &x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn bindings_after_at_slice_patterns_or_patterns_box_patterns_borrows_binding(\n+    mut x: [Option<Box<Test>>; 4]\n+) {\n+    let r = match x {\n+        ref a @ [_, ref b @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+        _ => None,\n+    };\n+\n+    &mut x;\n+    //~^ ERROR cannot borrow\n+\n+    drop(r);\n+}\n+\n+fn main() {}"}, {"sha": "35ed2763c2b08635a6f56c802efcad2ad5130e9d", "filename": "src/test/ui/borrowck/bindings-after-at-or-patterns-slice-patterns-box-patterns.stderr", "status": "added", "additions": 208, "deletions": 0, "changes": 208, "blob_url": "https://github.com/rust-lang/rust/blob/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fbindings-after-at-or-patterns-slice-patterns-box-patterns.stderr?ref=b974d6fc306d5847ad4b8bb48a99e6ca234cb6d1", "patch": "@@ -0,0 +1,208 @@\n+error: cannot borrow value as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:40:9\n+   |\n+LL |         ref foo @ [.., ref mut bar] => (),\n+   |         -------^^^^^^^^-----------^\n+   |         |              |\n+   |         |              mutable borrow, by `bar`, occurs here\n+   |         immutable borrow, by `foo`, occurs here\n+\n+error: cannot borrow value as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:124:9\n+   |\n+LL |         ref foo @ Some(box ref mut s) => (),\n+   |         -------^^^^^^^^^^^^---------^\n+   |         |                  |\n+   |         |                  mutable borrow, by `s`, occurs here\n+   |         immutable borrow, by `foo`, occurs here\n+\n+error[E0382]: borrow of moved value: `x`\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:22:5\n+   |\n+LL | fn bindings_after_at_slice_patterns_move_binding(x: [String; 4]) {\n+   |                                                  - move occurs because `x` has type `[std::string::String; 4]`, which does not implement the `Copy` trait\n+LL |     match x {\n+LL |         a @ [.., _] => (),\n+   |         ----------- value moved here\n+...\n+LL |     &x;\n+   |     ^^ value borrowed here after move\n+\n+error[E0502]: cannot borrow `x` as immutable because it is also borrowed as mutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:32:5\n+   |\n+LL |         ref mut foo @ [.., _] => Some(foo),\n+   |         --------------------- mutable borrow occurs here\n+...\n+LL |     &x;\n+   |     ^^ immutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - mutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:54:5\n+   |\n+LL |         [ref foo @ .., ref bar] => Some(foo),\n+   |          ------------ immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:66:5\n+   |\n+LL |         ref foo @ [.., ref bar] => Some(foo),\n+   |         ----------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0382]: borrow of moved value: `x`\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:80:5\n+   |\n+LL | fn bindings_after_at_or_patterns_move(x: Option<Test>) {\n+   |                                       - move occurs because `x` has type `std::option::Option<Test>`, which does not implement the `Copy` trait\n+LL |     match x {\n+LL |         foo @ Some(Test::Foo | Test::Bar) => (),\n+   |         ---------------------------------\n+   |         |\n+   |         value moved here\n+   |         value moved here\n+...\n+LL |     &x;\n+   |     ^^ value borrowed here after move\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:90:5\n+   |\n+LL |         ref foo @ Some(Test::Foo | Test::Bar) => Some(foo),\n+   |         ------------------------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as immutable because it is also borrowed as mutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:102:5\n+   |\n+LL |         ref mut foo @ Some(Test::Foo | Test::Bar) => Some(foo),\n+   |         ----------------------------------------- mutable borrow occurs here\n+...\n+LL |     &x;\n+   |     ^^ immutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - mutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:116:5\n+   |\n+LL |         ref foo @ Some(box ref s) => Some(foo),\n+   |         ------------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0382]: borrow of moved value: `x`\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:138:5\n+   |\n+LL | fn bindings_after_at_slice_patterns_or_patterns_moves(x: [Option<Test>; 4]) {\n+   |                                                       - move occurs because `x` has type `[std::option::Option<Test>; 4]`, which does not implement the `Copy` trait\n+LL |     match x {\n+LL |         a @ [.., Some(Test::Foo | Test::Bar)] => (),\n+   |         -------------------------------------\n+   |         |\n+   |         value moved here\n+   |         value moved here\n+...\n+LL |     &x;\n+   |     ^^ value borrowed here after move\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:148:5\n+   |\n+LL |         ref a @ [ref b @ .., Some(Test::Foo | Test::Bar)] => Some(a),\n+   |         ------------------------------------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:160:5\n+   |\n+LL |         ref a @ [ref b @ .., Some(Test::Foo | Test::Bar)] => Some(b),\n+   |                  ---------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:174:5\n+   |\n+LL |         [_, ref a @ Some(box ref b), ..] => Some(a),\n+   |             ----------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:190:5\n+   |\n+LL |         [_, ref a @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+   |             ------------------------------------------- immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as immutable because it is also borrowed as mutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:204:5\n+   |\n+LL |         [_, ref mut a @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+   |             ----------------------------------------------- mutable borrow occurs here\n+...\n+LL |     &x;\n+   |     ^^ immutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - mutable borrow later used here\n+\n+error[E0502]: cannot borrow `x` as mutable because it is also borrowed as immutable\n+  --> $DIR/bindings-after-at-or-patterns-slice-patterns-box-patterns.rs:218:5\n+   |\n+LL |         ref a @ [_, ref b @ Some(box Test::Foo | box Test::Bar), ..] => Some(a),\n+   |         ------------------------------------------------------------ immutable borrow occurs here\n+...\n+LL |     &mut x;\n+   |     ^^^^^^ mutable borrow occurs here\n+...\n+LL |     drop(r);\n+   |          - immutable borrow later used here\n+\n+error: aborting due to 17 previous errors\n+\n+Some errors have detailed explanations: E0382, E0502.\n+For more information about an error, try `rustc --explain E0382`."}]}