{"sha": "4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "node_id": "C_kwDOAAsO6NoAKDRjNzdmZDMwZmViZDVlZjVjOWFiMzBlNTM2YTFiZDZiNTAxNDQwYzU", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-05-30T22:57:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-30T22:57:30Z"}, "message": "Rollup merge of #97555 - GuillaumeGomez:line-number-click, r=notriddle\n\nSource code page: line number click adds `NaN`\n\nWhen you click on the parent element of the line numbers in the source code pages, it'll add `NaN` (like in https://doc.rust-lang.org/nightly/src/alloc/lib.rs.html#NaN). This PR fixes this bug.\n\ncc ``@jsha``\nr? ``@notriddle``", "tree": {"sha": "6e30199f163969f8a6509a507260b6a0971677cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e30199f163969f8a6509a507260b6a0971677cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJilUvaCRBK7hj4Ov3rIwAAOsgIACTOPMIjwV63GhMUanuaoSOV\n4h7b1y1qijtgK/IOkL71p6MTLc0GL+XCIeQttwJhstJuzRfegcbLY33kteDgB5p3\ncxlFhhmFVn8eGWk4rQ9WLWCKMYughLfpC1CSiIJ7CH8QCO/9ffDIeqfIaT6zlMsd\nY7n9owJ32RFL2Uvzqc8gwqT3i8iIkFzxdt9Z5b6kysVhQLNWRnM/oythnAJHvGGH\nrOoI3kZ1VgrUKmj7OKBSQZsCIfHVs2/D1+1OB7g1s9TxdLLMeLzAxm3nUaN7sgPa\nw+3qP6eQmCPMcnUKaZ9MvXSEydLJENEgQ32oyua7EZdIQRw5gd65tglHAFjGC1s=\n=V+Ou\n-----END PGP SIGNATURE-----\n", "payload": "tree 6e30199f163969f8a6509a507260b6a0971677cd\nparent 6718723c96e7ad21e0232af9be941e5a5b9a542d\nparent d286df1402f0e3a96e9ec11748e80c8be4bca92f\nauthor Michael Goulet <michael@errs.io> 1653951450 -0700\ncommitter GitHub <noreply@github.com> 1653951450 -0700\n\nRollup merge of #97555 - GuillaumeGomez:line-number-click, r=notriddle\n\nSource code page: line number click adds `NaN`\n\nWhen you click on the parent element of the line numbers in the source code pages, it'll add `NaN` (like in https://doc.rust-lang.org/nightly/src/alloc/lib.rs.html#NaN). This PR fixes this bug.\n\ncc ``@jsha``\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "html_url": "https://github.com/rust-lang/rust/commit/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6718723c96e7ad21e0232af9be941e5a5b9a542d", "url": "https://api.github.com/repos/rust-lang/rust/commits/6718723c96e7ad21e0232af9be941e5a5b9a542d", "html_url": "https://github.com/rust-lang/rust/commit/6718723c96e7ad21e0232af9be941e5a5b9a542d"}, {"sha": "d286df1402f0e3a96e9ec11748e80c8be4bca92f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d286df1402f0e3a96e9ec11748e80c8be4bca92f", "html_url": "https://github.com/rust-lang/rust/commit/d286df1402f0e3a96e9ec11748e80c8be4bca92f"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "58c036e0b3ca3b53a6b1d48a74ed52125b3abd59", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "patch": "@@ -205,6 +205,10 @@ const handleSourceHighlight = (function() {\n \n     return ev => {\n         let cur_line_id = parseInt(ev.target.id, 10);\n+        // It can happen when clicking not on a line number span.\n+        if (isNaN(cur_line_id)) {\n+            return;\n+        }\n         ev.preventDefault();\n \n         if (ev.shiftKey && prev_line_id) {"}, {"sha": "509739c9f295165bb579ef9729a244f302b8a6bd", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/4c77fd30febd5ef5c9ab30e536a1bd6b501440c5/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=4c77fd30febd5ef5c9ab30e536a1bd6b501440c5", "patch": "@@ -2,9 +2,9 @@\n goto: file://|DOC_PATH|/src/test_docs/lib.rs.html\n // Check that we can click on the line number.\n click: \".line-numbers > span:nth-child(4)\" // This is the span for line 4.\n-// Unfortunately, \"#4\" isn't a valid query selector, so we have to go around that limitation\n-// by instead getting the nth span.\n-assert-attribute: (\".line-numbers > span:nth-child(4)\", {\"class\": \"line-highlighted\"})\n+// Ensure that the page URL was updated.\n+assert-document-property: ({\"URL\": \"lib.rs.html#4\"}, ENDS_WITH)\n+assert-attribute: (\"//*[@id='4']\", {\"class\": \"line-highlighted\"})\n // We now check that the good spans are highlighted\n goto: file://|DOC_PATH|/src/test_docs/lib.rs.html#4-6\n assert-attribute-false: (\".line-numbers > span:nth-child(3)\", {\"class\": \"line-highlighted\"})\n@@ -17,3 +17,13 @@ compare-elements-position: (\"//*[@id='1']\", \".rust > code > span\", (\"y\"))\n \n // Assert that the line numbers text is aligned to the right.\n assert-css: (\".line-numbers\", {\"text-align\": \"right\"})\n+\n+// Now let's check that clicking on something else than the line number doesn't\n+// do anything (and certainly not add a `#NaN` to the URL!).\n+show-text: true\n+goto: file://|DOC_PATH|/src/test_docs/lib.rs.html\n+// We use this assert-position to know where we will click.\n+assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 103})\n+// We click on the left of the \"1\" span but still in the \"line-number\" `<pre>`.\n+click: (103, 103)\n+assert-document-property: ({\"URL\": \"/lib.rs.html\"}, ENDS_WITH)"}]}