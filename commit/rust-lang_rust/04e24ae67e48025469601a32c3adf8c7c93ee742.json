{"sha": "04e24ae67e48025469601a32c3adf8c7c93ee742", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZTI0YWU2N2U0ODAyNTQ2OTYwMWEzMmMzYWRmOGM3YzkzZWU3NDI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-13T00:44:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-13T00:44:44Z"}, "message": "Rollup merge of #83020 - hi-rustin:rustin-patch-enum, r=lcnr\n\nEmit the enum range assumption if the range only contains one element\n\nclose https://github.com/rust-lang/rust/issues/82871", "tree": {"sha": "bb89ce62aed1af993a07144c200ae4df1184e38c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb89ce62aed1af993a07144c200ae4df1184e38c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04e24ae67e48025469601a32c3adf8c7c93ee742", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgTAr8CRBK7hj4Ov3rIwAAdHIIAIkjS/xmoscsJo1vDw6cfgZS\n+0XBD5eAF78y/ZVz242//SsyIFwBAa9c58laqs4tkKhuQsLONunF8dRx+ebHWhJz\nYMb60QoX0ORUW9PwLXVaJQcm75XJngMPYmQ2gA80ItyDX2ha7+d7XLhP+wNSMKql\noA/2UHWdt5upc8h7TJzwneX99RGghAJszHW7EpG1mygI2zVUrI51AR6imaaWq1Nj\nIOSWT52yCIRrMPpHbGFL4KtbkjDkgttr8fXCEhjYU+9erDpBx2a0Hka/vycQo4jq\n8or0zP2MoZWClzV1sBsxILZvMmHRRj6vWzWU+2u41NgJ6/6CFJAbwaou9VCUPcc=\n=eT0x\n-----END PGP SIGNATURE-----\n", "payload": "tree bb89ce62aed1af993a07144c200ae4df1184e38c\nparent 7f319c74783b9e0684f1a2e29b977e0518257277\nparent d180f918240d2f8bd3d6f7292b63194f45901759\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1615596284 +0900\ncommitter GitHub <noreply@github.com> 1615596284 +0900\n\nRollup merge of #83020 - hi-rustin:rustin-patch-enum, r=lcnr\n\nEmit the enum range assumption if the range only contains one element\n\nclose https://github.com/rust-lang/rust/issues/82871\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04e24ae67e48025469601a32c3adf8c7c93ee742", "html_url": "https://github.com/rust-lang/rust/commit/04e24ae67e48025469601a32c3adf8c7c93ee742", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04e24ae67e48025469601a32c3adf8c7c93ee742/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f319c74783b9e0684f1a2e29b977e0518257277", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f319c74783b9e0684f1a2e29b977e0518257277", "html_url": "https://github.com/rust-lang/rust/commit/7f319c74783b9e0684f1a2e29b977e0518257277"}, {"sha": "d180f918240d2f8bd3d6f7292b63194f45901759", "url": "https://api.github.com/repos/rust-lang/rust/commits/d180f918240d2f8bd3d6f7292b63194f45901759", "html_url": "https://github.com/rust-lang/rust/commit/d180f918240d2f8bd3d6f7292b63194f45901759"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "629cb64d43ee1c55f01a5a9bce4421df09464120", "filename": "compiler/rustc_codegen_ssa/src/mir/rvalue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04e24ae67e48025469601a32c3adf8c7c93ee742/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Frvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04e24ae67e48025469601a32c3adf8c7c93ee742/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Frvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Frvalue.rs?ref=04e24ae67e48025469601a32c3adf8c7c93ee742", "patch": "@@ -325,7 +325,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n \n                                 let er = scalar.valid_range_exclusive(bx.cx());\n                                 if er.end != er.start\n-                                    && scalar.valid_range.end() > scalar.valid_range.start()\n+                                    && scalar.valid_range.end() >= scalar.valid_range.start()\n                                 {\n                                     // We want `table[e as usize \u00b1 k]` to not\n                                     // have bound checks, and this is the most"}, {"sha": "e779e2ef27439008ab39cc6011d293ea81d4566e", "filename": "src/test/codegen/enum-bounds-check-issue-82871.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/04e24ae67e48025469601a32c3adf8c7c93ee742/src%2Ftest%2Fcodegen%2Fenum-bounds-check-issue-82871.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04e24ae67e48025469601a32c3adf8c7c93ee742/src%2Ftest%2Fcodegen%2Fenum-bounds-check-issue-82871.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fenum-bounds-check-issue-82871.rs?ref=04e24ae67e48025469601a32c3adf8c7c93ee742", "patch": "@@ -0,0 +1,16 @@\n+// compile-flags: -O\n+// min-llvm-version: 11.0\n+\n+#![crate_type = \"lib\"]\n+\n+#[repr(C)]\n+pub enum E {\n+    A,\n+}\n+\n+// CHECK-LABEL: @index\n+#[no_mangle]\n+pub fn index(x: &[u32; 3], ind: E) -> u32{\n+    // CHECK-NOT: panic_bounds_check\n+    x[ind as usize]\n+}"}]}