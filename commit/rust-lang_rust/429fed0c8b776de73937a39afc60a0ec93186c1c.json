{"sha": "429fed0c8b776de73937a39afc60a0ec93186c1c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyOWZlZDBjOGI3NzZkZTczOTM3YTM5YWZjNjBhMGVjOTMxODZjMWM=", "commit": {"author": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2013-03-16T03:33:41Z"}, "committer": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2013-03-19T20:00:51Z"}, "message": "librustc: adjust logic for cfg attribute and add not predicate.", "tree": {"sha": "f308472461855556af9a31d61f1613505ffe3e50", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f308472461855556af9a31d61f1613505ffe3e50"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/429fed0c8b776de73937a39afc60a0ec93186c1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/429fed0c8b776de73937a39afc60a0ec93186c1c", "html_url": "https://github.com/rust-lang/rust/commit/429fed0c8b776de73937a39afc60a0ec93186c1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/429fed0c8b776de73937a39afc60a0ec93186c1c/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a14ec73cd2d15a2454113011835557ccf447f14d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a14ec73cd2d15a2454113011835557ccf447f14d", "html_url": "https://github.com/rust-lang/rust/commit/a14ec73cd2d15a2454113011835557ccf447f14d"}], "stats": {"total": 25, "additions": 13, "deletions": 12}, "files": [{"sha": "39a1fda2c92962c8a8289cfb9a0de94d2b18a44b", "filename": "src/librustc/front/config.rs", "status": "modified", "additions": 13, "deletions": 12, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/429fed0c8b776de73937a39afc60a0ec93186c1c/src%2Flibrustc%2Ffront%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/429fed0c8b776de73937a39afc60a0ec93186c1c/src%2Flibrustc%2Ffront%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Fconfig.rs?ref=429fed0c8b776de73937a39afc60a0ec93186c1c", "patch": "@@ -185,18 +185,19 @@ pub fn metas_in_cfg(cfg: ast::crate_cfg,\n     // Pull the inner meta_items from the #[cfg(meta_item, ...)]  attributes,\n     // so we can match against them. This is the list of configurations for\n     // which the item is valid\n-    let cfg_metas =\n-        vec::concat(\n-            vec::filter_map(cfg_metas, |i| attr::get_meta_item_list(i)));\n-\n-    let has_cfg_metas = vec::len(cfg_metas) > 0u;\n-    if !has_cfg_metas { return true; }\n-\n-    for cfg_metas.each |cfg_mi| {\n-        if attr::contains(cfg, *cfg_mi) { return true; }\n-    }\n-\n-    return false;\n+    let cfg_metas = vec::filter_map(cfg_metas, |i| attr::get_meta_item_list(i));\n+\n+    if cfg_metas.all(|c| c.is_empty()) { return true; }\n+\n+    cfg_metas.any(|cfg_meta| {\n+        cfg_meta.all(|cfg_mi| {\n+            match cfg_mi.node {\n+                ast::meta_list(s, ref it) if *s == ~\"not\"\n+                    => it.all(|mi| !attr::contains(cfg, *mi)),\n+                _ => attr::contains(cfg, *cfg_mi)\n+            }\n+        })\n+    })\n }\n \n "}]}