{"sha": "7c5a4cdd669c9816df938a878147fe5b4645e951", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjNWE0Y2RkNjY5Yzk4MTZkZjkzOGE4NzgxNDdmZTViNDY0NWU5NTE=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-04-05T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-04-07T13:03:24Z"}, "message": "Make LLVM version suffix independent of rustc version on dev channel\n\nRemove rustc version from LLVM version suffix on dev channel, avoiding\nthe need for full rebuilds when moving between commits with different\nLLVM submodule & rustc version.", "tree": {"sha": "65def36082da9569482decd0c32eadc8b1750f7c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/65def36082da9569482decd0c32eadc8b1750f7c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7c5a4cdd669c9816df938a878147fe5b4645e951", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7c5a4cdd669c9816df938a878147fe5b4645e951", "html_url": "https://github.com/rust-lang/rust/commit/7c5a4cdd669c9816df938a878147fe5b4645e951", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7c5a4cdd669c9816df938a878147fe5b4645e951/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39b62533c7f9d0581a6ea9b9fc2cc51f21c3b5b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/39b62533c7f9d0581a6ea9b9fc2cc51f21c3b5b0", "html_url": "https://github.com/rust-lang/rust/commit/39b62533c7f9d0581a6ea9b9fc2cc51f21c3b5b0"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "c01112f4e6096e7bec7ba7c2b864c7ac7962e220", "filename": "config.toml.example", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7c5a4cdd669c9816df938a878147fe5b4645e951/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/7c5a4cdd669c9816df938a878147fe5b4645e951/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=7c5a4cdd669c9816df938a878147fe5b4645e951", "patch": "@@ -84,8 +84,9 @@\n #link-shared = false\n \n # When building llvm, this configures what is being appended to the version.\n-# If absent, we let the version as-is.\n-#version-suffix = \"-rust\"\n+# The default is \"-rust-$version-$channel\", except for dev channel where rustc\n+# version number is omitted. To use LLVM version as is, provide an empty string.\n+#version-suffix = \"-rust-dev\"\n \n # On MSVC you can compile LLVM with clang-cl, but the test suite doesn't pass\n # with clang-cl, so this is special in that it only compiles LLVM with clang-cl"}, {"sha": "1e380a20629da7efa29357b5039441a39cae4d5c", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7c5a4cdd669c9816df938a878147fe5b4645e951/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c5a4cdd669c9816df938a878147fe5b4645e951/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=7c5a4cdd669c9816df938a878147fe5b4645e951", "patch": "@@ -235,10 +235,14 @@ impl Step for Llvm {\n             if !suffix.is_empty() {\n                 cfg.define(\"LLVM_VERSION_SUFFIX\", suffix);\n             }\n+        } else if builder.config.channel == \"dev\" {\n+            // Changes to a version suffix require a complete rebuild of the LLVM.\n+            // To avoid rebuilds during a time of version bump, don't include rustc\n+            // release number on the dev channel.\n+            cfg.define(\"LLVM_VERSION_SUFFIX\", \"-rust-dev\");\n         } else {\n-            let default_suffix =\n-                format!(\"-rust-{}-{}\", channel::CFG_RELEASE_NUM, builder.config.channel);\n-            cfg.define(\"LLVM_VERSION_SUFFIX\", default_suffix);\n+            let suffix = format!(\"-rust-{}-{}\", channel::CFG_RELEASE_NUM, builder.config.channel);\n+            cfg.define(\"LLVM_VERSION_SUFFIX\", suffix);\n         }\n \n         if let Some(ref linker) = builder.config.llvm_use_linker {"}]}