{"sha": "d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzMzRiNWExZGI5ZWM2YTU3ZjU0MDc3ZDQyMmEzZjRiM2M4YzExNzg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-21T10:27:45Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-21T10:27:45Z"}, "message": "move parser to a separate crate", "tree": {"sha": "9d930fe43452e8188594c612de433a77524e4754", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9d930fe43452e8188594c612de433a77524e4754"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "html_url": "https://github.com/rust-lang/rust/commit/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18b0c509f77a8e06141fee6668532cced1ebf5d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/18b0c509f77a8e06141fee6668532cced1ebf5d8", "html_url": "https://github.com/rust-lang/rust/commit/18b0c509f77a8e06141fee6668532cced1ebf5d8"}], "stats": {"total": 109, "additions": 91, "deletions": 18}, "files": [{"sha": "677a9db1c8d45307a6f285ec9984c536bb6df8b3", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -1071,6 +1071,13 @@ dependencies = [\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"ra_parser\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"drop_bomb 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"ra_project_model\"\n version = \"0.1.0\""}, {"sha": "b110e2bc6d3b7914c79499574d479273c8b849bc", "filename": "crates/ra_parser/Cargo.toml", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2FCargo.toml?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -0,0 +1,9 @@\n+[package]\n+edition = \"2018\"\n+name = \"ra_parser\"\n+version = \"0.1.0\"\n+authors = [\"rust-analyzer developers\"]\n+publish = false\n+\n+[dependencies]\n+drop_bomb = \"0.1.4\""}, {"sha": "d6e8454d43daa22f24ee778702410db78e953003", "filename": "crates/ra_parser/src/event.rs", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fevent.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fevent.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fevent.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -10,8 +10,8 @@\n use std::mem;\n \n use crate::{\n+    ParseError, TreeSink,\n     SyntaxKind::{self, *},\n-    parsing::{ParseError, TreeSink},\n };\n \n /// `Parser` produces a flat list of `Event`s.\n@@ -84,7 +84,7 @@ impl Event {\n }\n \n /// Generate the syntax tree with the control of events.\n-pub(super) fn process(sink: &mut impl TreeSink, mut events: Vec<Event>) {\n+pub(super) fn process(sink: &mut dyn TreeSink, mut events: Vec<Event>) {\n     let mut forward_parents = Vec::new();\n \n     for i in 0..events.len() {", "previous_filename": "crates/ra_syntax/src/parsing/event.rs"}, {"sha": "15aab6c6fcd544294d37301a751dde8c4517c543", "filename": "crates/ra_parser/src/grammar.rs", "status": "renamed", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -38,20 +38,18 @@ mod types;\n \n use crate::{\n     SyntaxKind::{self, *},\n-    parsing::{\n-        token_set::TokenSet,\n-        parser::{CompletedMarker, Marker, Parser}\n-    },\n+    TokenSet,\n+    parser::{CompletedMarker, Marker, Parser},\n };\n \n-pub(super) fn root(p: &mut Parser) {\n+pub(crate) fn root(p: &mut Parser) {\n     let m = p.start();\n     p.eat(SHEBANG);\n     items::mod_contents(p, false);\n     m.complete(p, SOURCE_FILE);\n }\n \n-pub(super) fn reparser(\n+pub(crate) fn reparser(\n     node: SyntaxKind,\n     first_child: Option<SyntaxKind>,\n     parent: Option<SyntaxKind>,", "previous_filename": "crates/ra_syntax/src/parsing/grammar.rs"}, {"sha": "cd30e8a450c6192c9a9ef5ba3fec3a211db84646", "filename": "crates/ra_parser/src/grammar/attributes.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fattributes.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/attributes.rs"}, {"sha": "d5a4f4d7b94bab8abaee0c485aab46dcad7817c9", "filename": "crates/ra_parser/src/grammar/expressions.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/expressions.rs"}, {"sha": "e74305b6a94c222dd0c6e47ef816f295b04f33e4", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/expressions/atom.rs"}, {"sha": "4b962c1f37f989d42942ed7d7b5ed896bd5a79ef", "filename": "crates/ra_parser/src/grammar/items.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/items.rs"}, {"sha": "5a5852f83ad4658a1cae37ffe48c68af3b412b25", "filename": "crates/ra_parser/src/grammar/items/consts.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fconsts.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/items/consts.rs"}, {"sha": "ff9b38f9c25d8dd28968a18c12049b69820b0354", "filename": "crates/ra_parser/src/grammar/items/nominal.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fnominal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fnominal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fnominal.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/items/nominal.rs"}, {"sha": "d5a8ccd98e2b636da839e898cafd27586054d5eb", "filename": "crates/ra_parser/src/grammar/items/traits.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Ftraits.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/items/traits.rs"}, {"sha": "5111d37ebda00819e9fbf57c7325d1d4a0b8aff2", "filename": "crates/ra_parser/src/grammar/items/use_item.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fuse_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fuse_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems%2Fuse_item.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/items/use_item.rs"}, {"sha": "185386569aa01014c70627823de2fa9cddfb965e", "filename": "crates/ra_parser/src/grammar/params.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fparams.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fparams.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fparams.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/params.rs"}, {"sha": "33a11886cb3085c50c0f5fb7dffcc5052bdb37a5", "filename": "crates/ra_parser/src/grammar/paths.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/paths.rs"}, {"sha": "9d7da639d5e812828fd18428bc48c3b4d78ca11c", "filename": "crates/ra_parser/src/grammar/patterns.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/patterns.rs"}, {"sha": "f889419c51d22281271fc0838c397856cbe92251", "filename": "crates/ra_parser/src/grammar/type_args.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_args.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/type_args.rs"}, {"sha": "40f99868206e84bb6b6f5d982aabb71b2e4b4ccf", "filename": "crates/ra_parser/src/grammar/type_params.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_params.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_params.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftype_params.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/type_params.rs"}, {"sha": "adc189a292d5d319c32734a771d6c4010435724f", "filename": "crates/ra_parser/src/grammar/types.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Ftypes.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/grammar/types.rs"}, {"sha": "fbbac4c69b45e61ac65c481b66e9ed888ea1ca19", "filename": "crates/ra_parser/src/lib.rs", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Flib.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -0,0 +1,64 @@\n+#[macro_use]\n+mod token_set;\n+mod syntax_kind;\n+mod event;\n+mod parser;\n+mod grammar;\n+\n+pub(crate) use token_set::TokenSet;\n+\n+pub use syntax_kind::SyntaxKind;\n+\n+#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+pub struct ParseError(pub String);\n+\n+/// `TreeSink` abstracts details of a particular syntax tree implementation.\n+pub trait TreeSink {\n+    /// Adds new leaf to the current branch.\n+    fn leaf(&mut self, kind: SyntaxKind, n_tokens: u8);\n+\n+    /// Start new branch and make it current.\n+    fn start_branch(&mut self, kind: SyntaxKind, root: bool);\n+\n+    /// Finish current branch and restore previous\n+    /// branch as current.\n+    fn finish_branch(&mut self, root: bool);\n+\n+    fn error(&mut self, error: ParseError);\n+}\n+\n+/// `TokenSource` abstracts the source of the tokens parser operates one.\n+///\n+/// Hopefully this will allow us to treat text and token trees in the same way!\n+pub trait TokenSource {\n+    fn token_kind(&self, pos: usize) -> SyntaxKind;\n+    fn is_token_joint_to_next(&self, pos: usize) -> bool;\n+    fn is_keyword(&self, pos: usize, kw: &str) -> bool;\n+}\n+\n+pub fn parse(token_source: &dyn TokenSource, tree_sink: &mut dyn TreeSink) {\n+    let mut p = parser::Parser::new(token_source);\n+    grammar::root(&mut p);\n+    let events = p.finish();\n+    event::process(tree_sink, events);\n+}\n+\n+pub struct Reparser(fn(&mut parser::Parser));\n+\n+impl Reparser {\n+    pub fn for_node(\n+        node: SyntaxKind,\n+        first_child: Option<SyntaxKind>,\n+        parent: Option<SyntaxKind>,\n+    ) -> Option<Reparser> {\n+        grammar::reparser(node, first_child, parent).map(Reparser)\n+    }\n+}\n+\n+pub fn reparse(token_source: &dyn TokenSource, tree_sink: &mut dyn TreeSink, reparser: Reparser) {\n+    let Reparser(r) = reparser;\n+    let mut p = parser::Parser::new(token_source);\n+    r(&mut p);\n+    let events = p.finish();\n+    event::process(tree_sink, events);\n+}"}, {"sha": "a18458148a98fd656b3159233f87254a3cfa8526", "filename": "crates/ra_parser/src/parser.rs", "status": "renamed", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fparser.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -4,11 +4,8 @@ use drop_bomb::DropBomb;\n \n use crate::{\n     SyntaxKind::{self, ERROR, EOF, TOMBSTONE},\n-    parsing::{\n-        TokenSource, ParseError,\n-        token_set::TokenSet,\n-        event::Event,\n-    },\n+    TokenSource, ParseError, TokenSet,\n+    event::Event,\n };\n \n /// `Parser` struct provides the low-level API for", "previous_filename": "crates/ra_syntax/src/parsing/parser.rs"}, {"sha": "a2353317f8715b7f954005049e8e93a886597a32", "filename": "crates/ra_parser/src/syntax_kind.rs", "status": "renamed", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fsyntax_kind.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -2,8 +2,6 @@ mod generated;\n \n use std::fmt;\n \n-use crate::SyntaxKind::*;\n-\n pub use self::generated::SyntaxKind;\n \n impl fmt::Debug for SyntaxKind {\n@@ -20,7 +18,7 @@ pub(crate) struct SyntaxInfo {\n impl SyntaxKind {\n     pub fn is_trivia(self) -> bool {\n         match self {\n-            WHITESPACE | COMMENT => true,\n+            SyntaxKind::WHITESPACE | SyntaxKind::COMMENT => true,\n             _ => false,\n         }\n     }", "previous_filename": "crates/ra_syntax/src/syntax_kinds.rs"}, {"sha": "1d8f988aed0b24d6d3970f5dd20529e33e3e37f3", "filename": "crates/ra_parser/src/syntax_kind/generated.rs", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "patch": "@@ -568,7 +568,7 @@ impl SyntaxKind {\n             EOF => &SyntaxInfo { name: \"EOF\" },\n         }\n     }\n-    pub(crate) fn from_keyword(ident: &str) -> Option<SyntaxKind> {\n+    pub fn from_keyword(ident: &str) -> Option<SyntaxKind> {\n         let kw = match ident {\n             \"use\" => USE_KW,\n             \"fn\" => FN_KW,\n@@ -610,7 +610,7 @@ impl SyntaxKind {\n         Some(kw)\n     }\n \n-    pub(crate) fn from_char(c: char) -> Option<SyntaxKind> {\n+    pub fn from_char(c: char) -> Option<SyntaxKind> {\n         let tok = match c {\n             ';' => SEMI,\n             ',' => COMMA,", "previous_filename": "crates/ra_syntax/src/syntax_kinds/generated.rs"}, {"sha": "837437136d81184a9b4bdf82d89bcb0c2c819595", "filename": "crates/ra_parser/src/syntax_kind/generated.rs.tera", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs.tera", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs.tera", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fsyntax_kind%2Fgenerated.rs.tera?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/syntax_kinds/generated.rs.tera"}, {"sha": "24152a38ad5c9e52bb6987cee3bbb6a1518b901a", "filename": "crates/ra_parser/src/token_set.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Ftoken_set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d334b5a1db9ec6a57f54077d422a3f4b3c8c1178/crates%2Fra_parser%2Fsrc%2Ftoken_set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Ftoken_set.rs?ref=d334b5a1db9ec6a57f54077d422a3f4b3c8c1178", "previous_filename": "crates/ra_syntax/src/parsing/token_set.rs"}]}