{"sha": "7864243380254fdd93435ef076f78d960f403a82", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4NjQyNDMzODAyNTRmZGQ5MzQzNWVmMDc2Zjc4ZDk2MGY0MDNhODI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-09T22:47:47Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-10T01:07:53Z"}, "message": "Prefer lualatex, xelatex, pdflatex, in that order. #12804", "tree": {"sha": "f8049f7ab79d84eeffcf30898e60933871e6bcb6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8049f7ab79d84eeffcf30898e60933871e6bcb6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7864243380254fdd93435ef076f78d960f403a82", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7864243380254fdd93435ef076f78d960f403a82", "html_url": "https://github.com/rust-lang/rust/commit/7864243380254fdd93435ef076f78d960f403a82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7864243380254fdd93435ef076f78d960f403a82/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c73e5fc5f212d30bb46b96cb45b51251217a199", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c73e5fc5f212d30bb46b96cb45b51251217a199", "html_url": "https://github.com/rust-lang/rust/commit/0c73e5fc5f212d30bb46b96cb45b51251217a199"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "db0de4bde5b8a20df66618aaa4c3ca3435cf2dfb", "filename": "mk/docs.mk", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7864243380254fdd93435ef076f78d960f403a82/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7864243380254fdd93435ef076f78d960f403a82/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=7864243380254fdd93435ef076f78d960f403a82", "patch": "@@ -76,21 +76,22 @@ endif\n \n # Check for the various external utilities for the EPUB/PDF docs:\n \n-ifeq ($(CFG_PDFLATEX),)\n-  $(info cfg: no pdflatex found, deferring to xelatex)\n+ifeq ($(CFG_LUALATEX),)\n+  $(info cfg: no lualatex found, deferring to xelatex)\n   ifeq ($(CFG_XELATEX),)\n-    $(info cfg: no xelatex found, deferring to lualatex)\n-    ifeq ($(CFG_LUALATEX),)\n-      $(info cfg: no lualatex found, disabling LaTeX docs)\n+    $(info cfg: no xelatex found, deferring to pdflatex)\n+    ifeq ($(CFG_PDFLATEX),)\n+      $(info cfg: no pdflatex found, disabling LaTeX docs)\n       NO_PDF_DOCS = 1\n \telse\n-      CFG_LATEX := $(CFG_LUALATEX)\n+      CFG_LATEX := $(CFG_PDFLATEX)\n     endif\n   else\n     CFG_LATEX := $(CFG_XELATEX)\n+    XELATEX = 1\n   endif\n else\n-  CFG_LATEX := $(CFG_PDFLATEX)\n+  CFG_LATEX := $(CFG_LUALATEX)\n endif\n \n \n@@ -187,12 +188,25 @@ doc/$(1).tex: $$(D)/$(1).md doc/footer.tex doc/version.tex | doc/\n ifneq ($(NO_PDF_DOCS),1)\n ifeq ($$(SHOULD_BUILD_PDF_DOC_$(1)),1)\n DOC_TARGETS += doc/$(1).pdf\n+ifneq ($(XELATEX),1)\n doc/$(1).pdf: doc/$(1).tex\n \t@$$(call E, latex compiler: $$@)\n \t$$(Q)$$(CFG_LATEX) \\\n \t-interaction=batchmode \\\n \t-output-directory=doc \\\n \t$$<\n+else\n+# The version of xelatex on the snap bots seemingly ingores -output-directory\n+# So we'll output to . and move to the doc directory manually.\n+# This will leave some intermediate files in the build directory.\n+doc/$(1).pdf: doc/$(1).tex\n+\t@$$(call E, latex compiler: $$@)\n+\t$$(Q)$$(CFG_LATEX) \\\n+\t-interaction=batchmode \\\n+\t-output-directory=. \\\n+\t$$<\n+\t$$(Q)mv ./$(1).pdf $$@\n+endif # XELATEX\n endif # SHOULD_BUILD_PDF_DOCS_$(1)\n endif # NO_PDF_DOCS\n "}]}