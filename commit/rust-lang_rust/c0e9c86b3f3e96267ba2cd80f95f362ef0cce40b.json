{"sha": "c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "node_id": "C_kwDOAAsO6NoAKGMwZTljODZiM2YzZTk2MjY3YmEyY2Q4MGY5NWYzNjJlZjBjY2U0MGI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-26T21:47:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-26T21:47:17Z"}, "message": "Auto merge of #104950 - jyn514:revert-preview, r=Mark-Simulacrum\n\nRevert \"Don't set `is_preview` for clippy and rustfmt\"\n\nThis reverts commit fb3e724d7602675f147a9b80e70fb6bd6512738c, which broke `rustup update` for anyone with clippy or rustfmt installed.\n\nFixes https://github.com/rust-lang/rust/issues/104930.\n\nr? `@Mark-Simulacrum`\n\n`@bors` p=50 fixes nightly", "tree": {"sha": "6aad4d8c3d7041f9ece68338e8c4621b61c781d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6aad4d8c3d7041f9ece68338e8c4621b61c781d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "html_url": "https://github.com/rust-lang/rust/commit/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80a96467ec5675e9f69683b5c075a8b15950c341", "url": "https://api.github.com/repos/rust-lang/rust/commits/80a96467ec5675e9f69683b5c075a8b15950c341", "html_url": "https://github.com/rust-lang/rust/commit/80a96467ec5675e9f69683b5c075a8b15950c341"}, {"sha": "c80b484eff512f15c5c154ae50060901b856cd0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c80b484eff512f15c5c154ae50060901b856cd0d", "html_url": "https://github.com/rust-lang/rust/commit/c80b484eff512f15c5c154ae50060901b856cd0d"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "2fef7f65827dd65c90e43c4b2141b964a4943fef", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "patch": "@@ -1191,6 +1191,7 @@ impl Step for Clippy {\n \n         let mut tarball = Tarball::new(builder, \"clippy\", &target.triple);\n         tarball.set_overlay(OverlayKind::Clippy);\n+        tarball.is_preview(true);\n         tarball.add_file(clippy, \"bin\", 0o755);\n         tarball.add_file(cargoclippy, \"bin\", 0o755);\n         tarball.add_legal_and_readme_to(\"share/doc/clippy\");\n@@ -1288,6 +1289,7 @@ impl Step for Rustfmt {\n             .expect(\"cargo fmt expected to build - essential tool\");\n         let mut tarball = Tarball::new(builder, \"rustfmt\", &target.triple);\n         tarball.set_overlay(OverlayKind::Rustfmt);\n+        tarball.is_preview(true);\n         tarball.add_file(rustfmt, \"bin\", 0o755);\n         tarball.add_file(cargofmt, \"bin\", 0o755);\n         tarball.add_legal_and_readme_to(\"share/doc/rustfmt\");\n@@ -1548,6 +1550,8 @@ impl Step for Extended {\n                     format!(\"{}-{}\", name, target.triple)\n                 } else if name == \"rust-analyzer\" {\n                     \"rust-analyzer-preview\".to_string()\n+                } else if name == \"clippy\" {\n+                    \"clippy-preview\".to_string()\n                 } else if name == \"rust-demangler\" {\n                     \"rust-demangler-preview\".to_string()\n                 } else if name == \"miri\" {"}, {"sha": "d0f389df973443346b452ddaa4415605c3efd011", "filename": "src/bootstrap/download.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Fbootstrap%2Fdownload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Fbootstrap%2Fdownload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdownload.rs?ref=c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "patch": "@@ -326,8 +326,6 @@ impl Config {\n         }\n \n         let filename = format!(\"rustfmt-{version}-{build}.tar.xz\", build = host.triple);\n-        // cfg(bootstrap): will need to be changed from `rustfmt-preview` to `rustfmt` the next time you run `bump-stage0`.\n-        // See <https://github.com/rust-lang/rust/pull/103648>\n         self.download_component(DownloadSource::Dist, filename, \"rustfmt-preview\", &date, \"stage0\");\n \n         self.fix_bin_or_dylib(&bin_root.join(\"bin\").join(\"rustfmt\"));"}, {"sha": "dde9745afb78564b9319c62894459ea0d40ec0fe", "filename": "src/tools/build-manifest/src/versions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs?ref=c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "patch": "@@ -49,10 +49,10 @@ pkg_type! {\n     Cargo = \"cargo\",\n     HtmlDocs = \"rust-docs\",\n     RustAnalysis = \"rust-analysis\",\n-    Clippy = \"clippy\",\n-    Rustfmt = \"rustfmt\",\n     Rls = \"rls\"; preview = true,\n     RustAnalyzer = \"rust-analyzer\"; preview = true,\n+    Clippy = \"clippy\"; preview = true,\n+    Rustfmt = \"rustfmt\"; preview = true,\n     LlvmTools = \"llvm-tools\"; preview = true,\n     Miri = \"miri\"; preview = true,\n     JsonDocs = \"rust-docs-json\"; preview = true,"}, {"sha": "aa346daf7e5f3a4b99d45b8440aab47507b095e4", "filename": "src/tools/bump-stage0/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Ftools%2Fbump-stage0%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b/src%2Ftools%2Fbump-stage0%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbump-stage0%2Fsrc%2Fmain.rs?ref=c0e9c86b3f3e96267ba2cd80f95f362ef0cce40b", "patch": "@@ -6,7 +6,7 @@ use std::convert::TryInto;\n \n const PATH: &str = \"src/stage0.json\";\n const COMPILER_COMPONENTS: &[&str] = &[\"rustc\", \"rust-std\", \"cargo\"];\n-const RUSTFMT_COMPONENTS: &[&str] = &[\"rustfmt\"];\n+const RUSTFMT_COMPONENTS: &[&str] = &[\"rustfmt-preview\"];\n \n struct Tool {\n     config: Config,"}]}