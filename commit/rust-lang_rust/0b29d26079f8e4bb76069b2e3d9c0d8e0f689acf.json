{"sha": "0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiMjlkMjYwNzlmOGU0YmI3NjA2OWIyZTNkOWMwZDhlMGY2ODlhY2Y=", "commit": {"author": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2017-05-07T03:26:45Z"}, "committer": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2017-06-19T18:29:12Z"}, "message": "Add compile_error!\n\nRelated to #40872", "tree": {"sha": "53e524cca7de63e864eee13fda137a3b6ffb285d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53e524cca7de63e864eee13fda137a3b6ffb285d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "html_url": "https://github.com/rust-lang/rust/commit/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04145943a25c3b8c7e7d7fe8c2efb04f259c25fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/04145943a25c3b8c7e7d7fe8c2efb04f259c25fb", "html_url": "https://github.com/rust-lang/rust/commit/04145943a25c3b8c7e7d7fe8c2efb04f259c25fb"}], "stats": {"total": 96, "additions": 96, "deletions": 0}, "files": [{"sha": "1da91a3b708502b405626a833f327fce0a513f41", "filename": "src/libcore/macros.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibcore%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibcore%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmacros.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -562,6 +562,17 @@ macro_rules! unimplemented {\n ///\n /// For more information, see documentation for `std`'s macros.\n mod builtin {\n+\n+    /// Unconditionally causes compilation to fail with the given error message when encountered.\n+    ///\n+    /// For more information, see the [RFC].\n+    ///\n+    /// [RFC]: https://github.com/rust-lang/rfcs/blob/master/text/1695-add-error-macro.md\n+    #[unstable(feature = \"compile_error_macro\", issue = \"40872\")]\n+    #[macro_export]\n+    #[cfg(dox)]\n+    macro_rules! compile_error { ($msg:expr) => ({ /* compiler built-in */ }) }\n+\n     /// The core macro for formatted string creation & output.\n     ///\n     /// For more information, see the documentation for [`std::format_args!`]."}, {"sha": "82c4f0830a626e351ff9bf0982488d5b7d082e40", "filename": "src/libstd/macros.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibstd%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibstd%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacros.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -238,6 +238,16 @@ macro_rules! assert_approx_eq {\n /// into libsyntax itself.\n #[cfg(dox)]\n pub mod builtin {\n+\n+    /// Unconditionally causes compilation to fail with the given error message when encountered.\n+    ///\n+    /// For more information, see the [RFC].\n+    ///\n+    /// [RFC]: https://github.com/rust-lang/rfcs/blob/master/text/1695-add-error-macro.md\n+    #[unstable(feature = \"compile_error_macro\", issue = \"40872\")]\n+    #[macro_export]\n+    macro_rules! compile_error { ($msg:expr) => ({ /* compiler built-in */ }) }\n+\n     /// The core macro for formatted string creation & output.\n     ///\n     /// This macro produces a value of type [`fmt::Arguments`]. This value can be"}, {"sha": "f8a26287bd47bf2051a7c716470b6f4f9feea30e", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -1065,6 +1065,7 @@ impl<'feat> ExpansionConfig<'feat> {\n         fn enable_allow_internal_unstable = allow_internal_unstable,\n         fn enable_custom_derive = custom_derive,\n         fn proc_macro_enabled = proc_macro,\n+        fn enable_compile_error = compile_error,\n     }\n }\n "}, {"sha": "d7d3a70f3c7c5d2ab5f941bd8f867e2f8f90ae4c", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -111,6 +111,7 @@ macro_rules! declare_features {\n \n declare_features! (\n     (active, asm, \"1.0.0\", Some(29722)),\n+    (active, compile_error, \"1.20.0\", Some(40872)),\n     (active, concat_idents, \"1.0.0\", Some(29599)),\n     (active, link_args, \"1.0.0\", Some(29596)),\n     (active, log_syntax, \"1.0.0\", Some(29598)),\n@@ -1008,6 +1009,9 @@ pub const EXPLAIN_LOG_SYNTAX: &'static str =\n pub const EXPLAIN_CONCAT_IDENTS: &'static str =\n     \"`concat_idents` is not stable enough for use and is subject to change\";\n \n+pub const EXPLAIN_COMPILE_ERROR: &'static str =\n+    \"`compile_error` is not stable enough for use and is subject to change\";\n+\n pub const EXPLAIN_TRACE_MACROS: &'static str =\n     \"`trace_macros` is not stable enough for use and is subject to change\";\n pub const EXPLAIN_ALLOW_INTERNAL_UNSTABLE: &'static str ="}, {"sha": "bb496716d8c4647eae12785e129d2b16494f78f9", "filename": "src/libsyntax_ext/compile_error.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax_ext%2Fcompile_error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax_ext%2Fcompile_error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fcompile_error.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -0,0 +1,40 @@\n+// Copyright 2012-2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// The compiler code necessary to support the compile_error! extension.\n+\n+use syntax::ext::base::*;\n+use syntax::ext::base;\n+use syntax::feature_gate;\n+use syntax_pos::Span;\n+use syntax::tokenstream;\n+\n+pub fn expand_compile_error<'cx>(cx: &'cx mut ExtCtxt,\n+                              sp: Span,\n+                              tts: &[tokenstream::TokenTree])\n+                              -> Box<base::MacResult + 'cx> {\n+    if !cx.ecfg.enable_compile_error() {\n+        feature_gate::emit_feature_err(&cx.parse_sess,\n+                                       \"compile_error\",\n+                                       sp,\n+                                       feature_gate::GateIssue::Language,\n+                                       feature_gate::EXPLAIN_COMPILE_ERROR);\n+        return DummyResult::expr(sp);\n+    }\n+\n+    let var = match get_single_str_from_tts(cx, sp, tts, \"compile_error!\") {\n+        None => return DummyResult::expr(sp),\n+        Some(v) => v,\n+    };\n+\n+    cx.span_err(sp, &var);\n+\n+    DummyResult::any(sp)\n+}"}, {"sha": "d28b00edc5f48de18fa712935d7ee7a42f52d5bd", "filename": "src/libsyntax_ext/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax_ext%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Flibsyntax_ext%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Flib.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -34,6 +34,7 @@ extern crate rustc_errors as errors;\n \n mod asm;\n mod cfg;\n+mod compile_error;\n mod concat;\n mod concat_idents;\n mod env;\n@@ -109,6 +110,7 @@ pub fn register_builtins(resolver: &mut syntax::ext::base::Resolver,\n         option_env: env::expand_option_env,\n         log_syntax: log_syntax::expand_syntax_ext,\n         trace_macros: trace_macros::expand_trace_macros,\n+        compile_error: compile_error::expand_compile_error,\n     }\n \n     // format_args uses `unstable` things internally."}, {"sha": "2a2c3fd8092326a0b7b8a60e4ea90ccefedea614", "filename": "src/test/compile-fail/compile_error_macro.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Ftest%2Fcompile-fail%2Fcompile_error_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Ftest%2Fcompile-fail%2Fcompile_error_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcompile_error_macro.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(compile_error)]\n+\n+fn main() {\n+    compile_error!(\"a very descriptive error message\"); //~ ERROR: a very descriptive error message\n+}"}, {"sha": "545c6852961c7d6e4447dc667b808ee53c0d6f57", "filename": "src/test/compile-fail/feature-gate-compile_error.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Ftest%2Fcompile-fail%2Ffeature-gate-compile_error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf/src%2Ftest%2Fcompile-fail%2Ffeature-gate-compile_error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-compile_error.rs?ref=0b29d26079f8e4bb76069b2e3d9c0d8e0f689acf", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    compile_error!(\"test\"); //~ ERROR: `compile_error` is not stable enough\n+}"}]}