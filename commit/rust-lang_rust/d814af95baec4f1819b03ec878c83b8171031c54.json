{"sha": "d814af95baec4f1819b03ec878c83b8171031c54", "node_id": "C_kwDOAAsO6NoAKGQ4MTRhZjk1YmFlYzRmMTgxOWIwM2VjODc4YzgzYjgxNzEwMzFjNTQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-10-24T13:48:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-24T13:48:43Z"}, "message": "Rollup merge of #90100 - Mark-Simulacrum:speed-macos-ci, r=pietroalbini\n\nSkip documentation for tier 2 targets on dist-x86_64-apple-darwin\n\nI don't have an easy way to test this locally, but I believe it should work. Based on one log result should shave ~14 minutes off the dist-x86_64-apple builder (doesn't help with aarch64 dist or x86_64 test builder, so not actually decreasing total CI time most likely).\n\nr? ```@pietroalbini```", "tree": {"sha": "41cf85bc326ebcbb09cadc2b5ae893098a418cd5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41cf85bc326ebcbb09cadc2b5ae893098a418cd5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d814af95baec4f1819b03ec878c83b8171031c54", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhdWQ7CRBK7hj4Ov3rIwAAkNwIAJzx9on/OF+Hr/aLSytoqK39\nQ07agtw1wVjODBGi8x6XWWQXOBq+BWAn+nP+i8nOutA3IthkgZafiVr1xn/gTAz3\nsPpz6TdCxY+dmDR81MLxaiiusNYCyC85BHRGVmEzVvT5QoYS5V4MUq2Bx0Lovud0\nFIN+JQrZptjESr7hxSXFzWV5A1ujclGu6xtijDF54cjWTAu+kflfveTOsB92sx4m\n8AhvTs5l/DPrja4oElkolIQt+MMzV5sZGrrahImVHDEGQKlxWRqLwsn0Mtk/qP2N\n8HHYhy1hetfiIfqHnMg2xM9WhD872X9t28spTmv+Lgmlj7Aebgyu0oIZRyZbiG8=\n=/5Yx\n-----END PGP SIGNATURE-----\n", "payload": "tree 41cf85bc326ebcbb09cadc2b5ae893098a418cd5\nparent 87822b27ee496dd0f5832a437f1e51da66bfc09a\nparent 9296efe3ef5544ec0eadb594d1fcbb5d7cc47276\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1635083323 +0200\ncommitter GitHub <noreply@github.com> 1635083323 +0200\n\nRollup merge of #90100 - Mark-Simulacrum:speed-macos-ci, r=pietroalbini\n\nSkip documentation for tier 2 targets on dist-x86_64-apple-darwin\n\nI don't have an easy way to test this locally, but I believe it should work. Based on one log result should shave ~14 minutes off the dist-x86_64-apple builder (doesn't help with aarch64 dist or x86_64 test builder, so not actually decreasing total CI time most likely).\n\nr? ```@pietroalbini```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d814af95baec4f1819b03ec878c83b8171031c54", "html_url": "https://github.com/rust-lang/rust/commit/d814af95baec4f1819b03ec878c83b8171031c54", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d814af95baec4f1819b03ec878c83b8171031c54/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87822b27ee496dd0f5832a437f1e51da66bfc09a", "url": "https://api.github.com/repos/rust-lang/rust/commits/87822b27ee496dd0f5832a437f1e51da66bfc09a", "html_url": "https://github.com/rust-lang/rust/commit/87822b27ee496dd0f5832a437f1e51da66bfc09a"}, {"sha": "9296efe3ef5544ec0eadb594d1fcbb5d7cc47276", "url": "https://api.github.com/repos/rust-lang/rust/commits/9296efe3ef5544ec0eadb594d1fcbb5d7cc47276", "html_url": "https://github.com/rust-lang/rust/commit/9296efe3ef5544ec0eadb594d1fcbb5d7cc47276"}], "stats": {"total": 33, "additions": 26, "deletions": 7}, "files": [{"sha": "580120b25a251584df6bc22ebbb2075dddcc8c9a", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d814af95baec4f1819b03ec878c83b8171031c54/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d814af95baec4f1819b03ec878c83b8171031c54/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=d814af95baec4f1819b03ec878c83b8171031c54", "patch": "@@ -287,7 +287,7 @@ jobs:\n             os: ubuntu-latest-xl\n           - name: dist-x86_64-apple\n             env:\n-              SCRIPT: \"./x.py dist\"\n+              SCRIPT: \"./x.py dist --exclude src/doc --exclude extended && ./x.py dist --target=x86_64-apple-darwin src/doc && ./x.py dist extended\"\n               RUST_CONFIGURE_ARGS: \"--host=x86_64-apple-darwin --target=x86_64-apple-darwin,aarch64-apple-ios,x86_64-apple-ios,aarch64-apple-ios-sim --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n               RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n               MACOSX_DEPLOYMENT_TARGET: 10.7\n@@ -532,9 +532,16 @@ jobs:\n     strategy:\n       matrix:\n         include:\n-          - name: dist-x86_64-linux\n-            os: ubuntu-latest-xl\n-            env: {}\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: \"./x.py dist --exclude src/doc --exclude extended && ./x.py dist --target=x86_64-apple-darwin src/doc && ./x.py dist extended\"\n+              RUST_CONFIGURE_ARGS: \"--host=x86_64-apple-darwin --target=x86_64-apple-darwin,aarch64-apple-ios,x86_64-apple-ios,aarch64-apple-ios-sim --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\"\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            os: macos-latest\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n     steps:"}, {"sha": "76ee324302e094551f3c6d95f5528f0e5a12e174", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d814af95baec4f1819b03ec878c83b8171031c54/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d814af95baec4f1819b03ec878c83b8171031c54/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=d814af95baec4f1819b03ec878c83b8171031c54", "patch": "@@ -448,9 +448,11 @@ jobs:\n           #  macOS Builders  #\n           ####################\n \n+          # Only generate documentation for x86_64-apple-darwin, not other\n+          # tier 2 targets produced by this builder.\n           - name: dist-x86_64-apple\n             env:\n-              SCRIPT: ./x.py dist\n+              SCRIPT: ./x.py dist --exclude src/doc --exclude extended && ./x.py dist --target=x86_64-apple-darwin src/doc && ./x.py dist extended\n               RUST_CONFIGURE_ARGS: --host=x86_64-apple-darwin --target=x86_64-apple-darwin,aarch64-apple-ios,x86_64-apple-ios,aarch64-apple-ios-sim --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n               RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n               MACOSX_DEPLOYMENT_TARGET: 10.7\n@@ -670,7 +672,17 @@ jobs:\n     strategy:\n       matrix:\n         include:\n-          - *dist-x86_64-linux\n+          - name: dist-x86_64-apple\n+            env:\n+              SCRIPT: ./x.py dist --exclude src/doc --exclude extended && ./x.py dist --target=x86_64-apple-darwin src/doc && ./x.py dist extended\n+              RUST_CONFIGURE_ARGS: --host=x86_64-apple-darwin --target=x86_64-apple-darwin,aarch64-apple-ios,x86_64-apple-ios,aarch64-apple-ios-sim --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc --set llvm.ninja=false\n+              RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+              MACOSX_DEPLOYMENT_TARGET: 10.7\n+              NO_LLVM_ASSERTIONS: 1\n+              NO_DEBUG_ASSERTIONS: 1\n+              DIST_REQUIRE_ALL_TOOLS: 1\n+            <<: *job-macos-xl\n+\n \n   master:\n     name: master"}, {"sha": "a21b40cfb779f35465e00e3b1f48517c09cf7318", "filename": "src/ci/run.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d814af95baec4f1819b03ec878c83b8171031c54/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d814af95baec4f1819b03ec878c83b8171031c54/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=d814af95baec4f1819b03ec878c83b8171031c54", "patch": "@@ -43,7 +43,7 @@ else\n     PYTHON=\"python2\"\n fi\n \n-if ! isCI || isCiBranch auto || isCiBranch beta; then\n+if ! isCI || isCiBranch auto || isCiBranch beta || isCiBranch try; then\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --set build.print-step-timings --enable-verbose-tests\"\n fi\n "}]}