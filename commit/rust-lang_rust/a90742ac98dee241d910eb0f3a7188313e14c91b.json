{"sha": "a90742ac98dee241d910eb0f3a7188313e14c91b", "node_id": "C_kwDOAAsO6NoAKGE5MDc0MmFjOThkZWUyNDFkOTEwZWIwZjNhNzE4ODMxM2UxNGM5MWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-12T05:52:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-12T05:52:38Z"}, "message": "Rollup merge of #106732 - durin42:dmitrig-arrayref-ctor, r=nikic\n\nrustc_llvm: replace llvm::makeArrayRef with ArrayRef constructors.\n\nLLVM upstream has deprecated llvm::makeArrayRef and will remove it.", "tree": {"sha": "358722e3d2479d8b10c45fce15d4695093355080", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/358722e3d2479d8b10c45fce15d4695093355080"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a90742ac98dee241d910eb0f3a7188313e14c91b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjv6AmCRBK7hj4Ov3rIwAA+rcIAKwqL0/AXbRFVplBt202FIZP\nmU8LVzKBe/4y2dXpXy5H8+v0RmTYaaW3Yu7ZFzuCOK5Vv1nDwmAIPy1rQqaYIgri\nxuJhu3AmwyQWnHhg4rbWFLWLgkIcdfbjI1GQKK9Ejxt1XEEOCfw89qFEMx+RQHiB\nEMhp9h2KXUw09jIjdwbjKA7l4FVh0EVnWxAs5O+R62P/5voPWHeayOZT392fDKfy\nNjCMpw+ypNoL6HlxVDk/aGJF/GAYTx8mxPxcrDMEXi2TYUfRzBnyqbtjFNsc0yPV\n+EmX0SnwsOrkRgUGojfU6vNIri7/0TKhl9k6LG9IACTyvAx1oDWxOg1wsLWOcYE=\n=jJNH\n-----END PGP SIGNATURE-----\n", "payload": "tree 358722e3d2479d8b10c45fce15d4695093355080\nparent 8a13157c16f279dfa46d0ef92ceb39bcbbcfe729\nparent 4f0c88f8bda92e16db9b59e5c585ae882dd4a086\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1673502758 +0100\ncommitter GitHub <noreply@github.com> 1673502758 +0100\n\nRollup merge of #106732 - durin42:dmitrig-arrayref-ctor, r=nikic\n\nrustc_llvm: replace llvm::makeArrayRef with ArrayRef constructors.\n\nLLVM upstream has deprecated llvm::makeArrayRef and will remove it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a90742ac98dee241d910eb0f3a7188313e14c91b", "html_url": "https://github.com/rust-lang/rust/commit/a90742ac98dee241d910eb0f3a7188313e14c91b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a90742ac98dee241d910eb0f3a7188313e14c91b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a13157c16f279dfa46d0ef92ceb39bcbbcfe729", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a13157c16f279dfa46d0ef92ceb39bcbbcfe729", "html_url": "https://github.com/rust-lang/rust/commit/8a13157c16f279dfa46d0ef92ceb39bcbbcfe729"}, {"sha": "4f0c88f8bda92e16db9b59e5c585ae882dd4a086", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f0c88f8bda92e16db9b59e5c585ae882dd4a086", "html_url": "https://github.com/rust-lang/rust/commit/4f0c88f8bda92e16db9b59e5c585ae882dd4a086"}], "stats": {"total": 25, "additions": 13, "deletions": 12}, "files": [{"sha": "03e6d2149e96984846c0c90e83b0a67323e38b49", "filename": "compiler/rustc_llvm/llvm-wrapper/CoverageMappingWrapper.cpp", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a90742ac98dee241d910eb0f3a7188313e14c91b/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/a90742ac98dee241d910eb0f3a7188313e14c91b/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp?ref=a90742ac98dee241d910eb0f3a7188313e14c91b", "patch": "@@ -28,8 +28,8 @@ extern \"C\" void LLVMRustCoverageWriteFilenamesSectionToBuffer(\n   for (size_t i = 0; i < FilenamesLen; i++) {\n     FilenameRefs.push_back(std::string(Filenames[i]));\n   }\n-  auto FilenamesWriter = coverage::CoverageFilenamesSectionWriter(\n-    makeArrayRef(FilenameRefs));\n+  auto FilenamesWriter =\n+      coverage::CoverageFilenamesSectionWriter(ArrayRef<std::string>(FilenameRefs));\n   RawRustStringOstream OS(BufferOut);\n   FilenamesWriter.write(OS);\n }\n@@ -45,15 +45,16 @@ extern \"C\" void LLVMRustCoverageWriteMappingToBuffer(\n   // Convert from FFI representation to LLVM representation.\n   SmallVector<coverage::CounterMappingRegion, 0> MappingRegions;\n   MappingRegions.reserve(NumMappingRegions);\n-  for (const auto &Region : makeArrayRef(RustMappingRegions, NumMappingRegions)) {\n+  for (const auto &Region : ArrayRef<LLVMRustCounterMappingRegion>(\n+           RustMappingRegions, NumMappingRegions)) {\n     MappingRegions.emplace_back(\n         Region.Count, Region.FalseCount, Region.FileID, Region.ExpandedFileID,\n         Region.LineStart, Region.ColumnStart, Region.LineEnd, Region.ColumnEnd,\n         Region.Kind);\n   }\n   auto CoverageMappingWriter = coverage::CoverageMappingWriter(\n-      makeArrayRef(VirtualFileMappingIDs, NumVirtualFileMappingIDs),\n-      makeArrayRef(Expressions, NumExpressions),\n+      ArrayRef<unsigned>(VirtualFileMappingIDs, NumVirtualFileMappingIDs),\n+      ArrayRef<coverage::CounterExpression>(Expressions, NumExpressions),\n       MappingRegions);\n   RawRustStringOstream OS(BufferOut);\n   CoverageMappingWriter.write(OS);"}, {"sha": "8f94e8a4ab2e1d2422d009ec6665eeb7e209ab88", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a90742ac98dee241d910eb0f3a7188313e14c91b/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/a90742ac98dee241d910eb0f3a7188313e14c91b/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=a90742ac98dee241d910eb0f3a7188313e14c91b", "patch": "@@ -257,7 +257,7 @@ template<typename T> static inline void AddAttributes(T *t, unsigned Index,\n   PALNew = PAL.addAttributes(t->getContext(), Index, B);\n #else\n   AttrBuilder B(t->getContext());\n-  for (LLVMAttributeRef Attr : makeArrayRef(Attrs, AttrsLen))\n+  for (LLVMAttributeRef Attr : ArrayRef<LLVMAttributeRef>(Attrs, AttrsLen))\n     B.addAttribute(unwrap(Attr));\n   PALNew = PAL.addAttributesAtIndex(t->getContext(), Index, B);\n #endif\n@@ -1064,7 +1064,7 @@ extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateEnumerator(\n     LLVMRustDIBuilderRef Builder, const char *Name, size_t NameLen,\n     const uint64_t Value[2], unsigned SizeInBits, bool IsUnsigned) {\n   return wrap(Builder->createEnumerator(StringRef(Name, NameLen),\n-      APSInt(APInt(SizeInBits, makeArrayRef(Value, 2)), IsUnsigned)));\n+      APSInt(APInt(SizeInBits, ArrayRef<uint64_t>(Value, 2)), IsUnsigned)));\n }\n \n extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateEnumerationType(\n@@ -1477,7 +1477,7 @@ extern \"C\" void LLVMRustAddHandler(LLVMValueRef CatchSwitchRef,\n extern \"C\" OperandBundleDef *LLVMRustBuildOperandBundleDef(const char *Name,\n                                                            LLVMValueRef *Inputs,\n                                                            unsigned NumInputs) {\n-  return new OperandBundleDef(Name, makeArrayRef(unwrap(Inputs), NumInputs));\n+  return new OperandBundleDef(Name, ArrayRef<Value*>(unwrap(Inputs), NumInputs));\n }\n \n extern \"C\" void LLVMRustFreeOperandBundleDef(OperandBundleDef *Bundle) {\n@@ -1491,8 +1491,8 @@ extern \"C\" LLVMValueRef LLVMRustBuildCall(LLVMBuilderRef B, LLVMTypeRef Ty, LLVM\n   Value *Callee = unwrap(Fn);\n   FunctionType *FTy = unwrap<FunctionType>(Ty);\n   return wrap(unwrap(B)->CreateCall(\n-      FTy, Callee, makeArrayRef(unwrap(Args), NumArgs),\n-      makeArrayRef(*OpBundles, NumOpBundles)));\n+      FTy, Callee, ArrayRef<Value*>(unwrap(Args), NumArgs),\n+      ArrayRef<OperandBundleDef>(*OpBundles, NumOpBundles)));\n }\n \n extern \"C\" LLVMValueRef LLVMRustGetInstrProfIncrementIntrinsic(LLVMModuleRef M) {\n@@ -1537,8 +1537,8 @@ LLVMRustBuildInvoke(LLVMBuilderRef B, LLVMTypeRef Ty, LLVMValueRef Fn,\n   Value *Callee = unwrap(Fn);\n   FunctionType *FTy = unwrap<FunctionType>(Ty);\n   return wrap(unwrap(B)->CreateInvoke(FTy, Callee, unwrap(Then), unwrap(Catch),\n-                                      makeArrayRef(unwrap(Args), NumArgs),\n-                                      makeArrayRef(*OpBundles, NumOpBundles),\n+                                      ArrayRef<Value*>(unwrap(Args), NumArgs),\n+                                      ArrayRef<OperandBundleDef>(*OpBundles, NumOpBundles),\n                                       Name));\n }\n "}]}