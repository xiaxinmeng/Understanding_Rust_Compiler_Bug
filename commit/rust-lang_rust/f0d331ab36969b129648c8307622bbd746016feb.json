{"sha": "f0d331ab36969b129648c8307622bbd746016feb", "node_id": "C_kwDOAAsO6NoAKGYwZDMzMWFiMzY5NjliMTI5NjQ4YzgzMDc2MjJiYmQ3NDYwMTZmZWI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-22T10:40:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-22T10:40:33Z"}, "message": "Auto merge of #10109 - Niki4tap:yeet_not_return, r=flip1995\n\nFix FP in needless_return when using yeet\n\nFixes #9947\n\nchangelog: Fix: [`needless_return`]: don't lint when using `do yeet`\n#10109", "tree": {"sha": "276899ec10c6062f2573a9c8307aa8dbbbec6294", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/276899ec10c6062f2573a9c8307aa8dbbbec6294"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0d331ab36969b129648c8307622bbd746016feb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0d331ab36969b129648c8307622bbd746016feb", "html_url": "https://github.com/rust-lang/rust/commit/f0d331ab36969b129648c8307622bbd746016feb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0d331ab36969b129648c8307622bbd746016feb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "065c6f78e7b4089ad93eafb0c0c478bbfaa00db8", "url": "https://api.github.com/repos/rust-lang/rust/commits/065c6f78e7b4089ad93eafb0c0c478bbfaa00db8", "html_url": "https://github.com/rust-lang/rust/commit/065c6f78e7b4089ad93eafb0c0c478bbfaa00db8"}, {"sha": "b6882f6107193696e14ab21fb0ee9921a4e0b842", "url": "https://api.github.com/repos/rust-lang/rust/commits/b6882f6107193696e14ab21fb0ee9921a4e0b842", "html_url": "https://github.com/rust-lang/rust/commit/b6882f6107193696e14ab21fb0ee9921a4e0b842"}], "stats": {"total": 110, "additions": 63, "deletions": 47}, "files": [{"sha": "d4d506605206b7734b6e2c0685d57f1bea663d29", "filename": "clippy_lints/src/returns.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f0d331ab36969b129648c8307622bbd746016feb/clippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0d331ab36969b129648c8307622bbd746016feb/clippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freturns.rs?ref=f0d331ab36969b129648c8307622bbd746016feb", "patch": "@@ -6,7 +6,7 @@ use core::ops::ControlFlow;\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir::intravisit::FnKind;\n-use rustc_hir::{Block, Body, Expr, ExprKind, FnDecl, HirId, MatchSource, PatKind, StmtKind};\n+use rustc_hir::{Block, Body, Expr, ExprKind, FnDecl, HirId, LangItem, MatchSource, PatKind, QPath, StmtKind};\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::lint::in_external_macro;\n use rustc_middle::ty::subst::GenericArgKind;\n@@ -207,6 +207,12 @@ fn check_final_expr<'tcx>(\n     match &peeled_drop_expr.kind {\n         // simple return is always \"bad\"\n         ExprKind::Ret(ref inner) => {\n+            // if desugar of `do yeet`, don't lint\n+            if let Some(inner_expr) = inner\n+                && let ExprKind::Call(path_expr, _) = inner_expr.kind\n+                && let ExprKind::Path(QPath::LangItem(LangItem::TryTraitFromYeet, _, _)) = path_expr.kind {\n+                    return;\n+            }\n             if cx.tcx.hir().attrs(expr.hir_id).is_empty() {\n                 let borrows = inner.map_or(false, |inner| last_statement_borrows(cx, inner));\n                 if !borrows {"}, {"sha": "d451be1f389a7b50a2b3c0201e8ace18d4f0668b", "filename": "tests/ui/needless_return.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.fixed?ref=f0d331ab36969b129648c8307622bbd746016feb", "patch": "@@ -1,6 +1,7 @@\n // run-rustfix\n \n #![feature(lint_reasons)]\n+#![feature(yeet_expr)]\n #![allow(unused)]\n #![allow(\n     clippy::if_same_then_else,\n@@ -272,4 +273,8 @@ mod issue9416 {\n     }\n }\n \n+fn issue9947() -> Result<(), String> {\n+    do yeet \"hello\";\n+}\n+\n fn main() {}"}, {"sha": "e1a1bea2c0b85f19f769a4c4ea0b904d348f4cf9", "filename": "tests/ui/needless_return.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.rs?ref=f0d331ab36969b129648c8307622bbd746016feb", "patch": "@@ -1,6 +1,7 @@\n // run-rustfix\n \n #![feature(lint_reasons)]\n+#![feature(yeet_expr)]\n #![allow(unused)]\n #![allow(\n     clippy::if_same_then_else,\n@@ -282,4 +283,8 @@ mod issue9416 {\n     }\n }\n \n+fn issue9947() -> Result<(), String> {\n+    do yeet \"hello\";\n+}\n+\n fn main() {}"}, {"sha": "ca2253e6586379ecb543929782956299a6a08da8", "filename": "tests/ui/needless_return.stderr", "status": "modified", "additions": 46, "deletions": 46, "changes": 92, "blob_url": "https://github.com/rust-lang/rust/blob/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f0d331ab36969b129648c8307622bbd746016feb/tests%2Fui%2Fneedless_return.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_return.stderr?ref=f0d331ab36969b129648c8307622bbd746016feb", "patch": "@@ -1,5 +1,5 @@\n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:26:5\n+  --> $DIR/needless_return.rs:27:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n@@ -8,71 +8,71 @@ LL |     return true;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:30:5\n+  --> $DIR/needless_return.rs:31:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:35:9\n+  --> $DIR/needless_return.rs:36:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:37:9\n+  --> $DIR/needless_return.rs:38:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:43:17\n+  --> $DIR/needless_return.rs:44:17\n    |\n LL |         true => return false,\n    |                 ^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:45:13\n+  --> $DIR/needless_return.rs:46:13\n    |\n LL |             return true;\n    |             ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:52:9\n+  --> $DIR/needless_return.rs:53:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:54:16\n+  --> $DIR/needless_return.rs:55:16\n    |\n LL |     let _ = || return true;\n    |                ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:58:5\n+  --> $DIR/needless_return.rs:59:5\n    |\n LL |     return the_answer!();\n    |     ^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:61:21\n+  --> $DIR/needless_return.rs:62:21\n    |\n LL |   fn test_void_fun() {\n    |  _____________________^\n@@ -82,7 +82,7 @@ LL | |     return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:66:11\n+  --> $DIR/needless_return.rs:67:11\n    |\n LL |       if b {\n    |  ___________^\n@@ -92,7 +92,7 @@ LL | |         return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:68:13\n+  --> $DIR/needless_return.rs:69:13\n    |\n LL |       } else {\n    |  _____________^\n@@ -102,15 +102,15 @@ LL | |         return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:76:14\n+  --> $DIR/needless_return.rs:77:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n    = help: replace `return` with a unit value\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:84:24\n+  --> $DIR/needless_return.rs:85:24\n    |\n LL |               let _ = 42;\n    |  ________________________^\n@@ -120,39 +120,39 @@ LL | |             return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:87:14\n+  --> $DIR/needless_return.rs:88:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n    = help: replace `return` with a unit value\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:100:9\n+  --> $DIR/needless_return.rs:101:9\n    |\n LL |         return String::from(\"test\");\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:102:9\n+  --> $DIR/needless_return.rs:103:9\n    |\n LL |         return String::new();\n    |         ^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:124:32\n+  --> $DIR/needless_return.rs:125:32\n    |\n LL |         bar.unwrap_or_else(|_| return)\n    |                                ^^^^^^\n    |\n    = help: replace `return` with an empty block\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:128:21\n+  --> $DIR/needless_return.rs:129:21\n    |\n LL |           let _ = || {\n    |  _____________________^\n@@ -162,95 +162,95 @@ LL | |             return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:131:20\n+  --> $DIR/needless_return.rs:132:20\n    |\n LL |         let _ = || return;\n    |                    ^^^^^^\n    |\n    = help: replace `return` with an empty block\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:137:32\n+  --> $DIR/needless_return.rs:138:32\n    |\n LL |         res.unwrap_or_else(|_| return Foo)\n    |                                ^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:146:5\n+  --> $DIR/needless_return.rs:147:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:150:5\n+  --> $DIR/needless_return.rs:151:5\n    |\n LL |     return true;\n    |     ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:155:9\n+  --> $DIR/needless_return.rs:156:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:157:9\n+  --> $DIR/needless_return.rs:158:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:163:17\n+  --> $DIR/needless_return.rs:164:17\n    |\n LL |         true => return false,\n    |                 ^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:165:13\n+  --> $DIR/needless_return.rs:166:13\n    |\n LL |             return true;\n    |             ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:172:9\n+  --> $DIR/needless_return.rs:173:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:174:16\n+  --> $DIR/needless_return.rs:175:16\n    |\n LL |     let _ = || return true;\n    |                ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:178:5\n+  --> $DIR/needless_return.rs:179:5\n    |\n LL |     return the_answer!();\n    |     ^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:181:33\n+  --> $DIR/needless_return.rs:182:33\n    |\n LL |   async fn async_test_void_fun() {\n    |  _________________________________^\n@@ -260,7 +260,7 @@ LL | |     return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:186:11\n+  --> $DIR/needless_return.rs:187:11\n    |\n LL |       if b {\n    |  ___________^\n@@ -270,7 +270,7 @@ LL | |         return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:188:13\n+  --> $DIR/needless_return.rs:189:13\n    |\n LL |       } else {\n    |  _____________^\n@@ -280,95 +280,95 @@ LL | |         return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:196:14\n+  --> $DIR/needless_return.rs:197:14\n    |\n LL |         _ => return,\n    |              ^^^^^^\n    |\n    = help: replace `return` with a unit value\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:209:9\n+  --> $DIR/needless_return.rs:210:9\n    |\n LL |         return String::from(\"test\");\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:211:9\n+  --> $DIR/needless_return.rs:212:9\n    |\n LL |         return String::new();\n    |         ^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:227:5\n+  --> $DIR/needless_return.rs:228:5\n    |\n LL |     return format!(\"Hello {}\", \"world!\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:238:9\n+  --> $DIR/needless_return.rs:239:9\n    |\n LL |         return true;\n    |         ^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:240:9\n+  --> $DIR/needless_return.rs:241:9\n    |\n LL |         return false;\n    |         ^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:247:13\n+  --> $DIR/needless_return.rs:248:13\n    |\n LL |             return 10;\n    |             ^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:250:13\n+  --> $DIR/needless_return.rs:251:13\n    |\n LL |             return 100;\n    |             ^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:258:9\n+  --> $DIR/needless_return.rs:259:9\n    |\n LL |         return 0;\n    |         ^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:265:13\n+  --> $DIR/needless_return.rs:266:13\n    |\n LL |             return *(x as *const isize);\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:267:13\n+  --> $DIR/needless_return.rs:268:13\n    |\n LL |             return !*(x as *const isize);\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:274:20\n+  --> $DIR/needless_return.rs:275:20\n    |\n LL |           let _ = 42;\n    |  ____________________^\n@@ -379,7 +379,7 @@ LL | |         return;\n    = help: remove `return`\n \n error: unneeded `return` statement\n-  --> $DIR/needless_return.rs:281:20\n+  --> $DIR/needless_return.rs:282:20\n    |\n LL |         let _ = 42; return;\n    |                    ^^^^^^^"}]}