{"sha": "c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1NGI1MWZkZWRkMjFiMDM2N2FmN2NiM2ZhYzNiYzE2ZDIxYjhjYzE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-20T18:12:15Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-20T18:12:15Z"}, "message": "add DefId", "tree": {"sha": "c94c79064646c5c757a387fcafcb87e8360673e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c94c79064646c5c757a387fcafcb87e8360673e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "html_url": "https://github.com/rust-lang/rust/commit/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8086107b6ac8555a226ceb294e2c633dfe36c6e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/8086107b6ac8555a226ceb294e2c633dfe36c6e1", "html_url": "https://github.com/rust-lang/rust/commit/8086107b6ac8555a226ceb294e2c633dfe36c6e1"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "8002656d63e149cc7e58c01e28d10ca033f9135c", "filename": "crates/ra_analysis/src/descriptors/module/nameres.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1/crates%2Fra_analysis%2Fsrc%2Fdescriptors%2Fmodule%2Fnameres.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1/crates%2Fra_analysis%2Fsrc%2Fdescriptors%2Fmodule%2Fnameres.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fdescriptors%2Fmodule%2Fnameres.rs?ref=c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "patch": "@@ -7,6 +7,7 @@ use ra_syntax::{\n };\n \n use crate::{\n+    loc2id::DefId,\n     descriptors::module::ModuleId,\n     syntax_ptr::LocalSyntaxPtr,\n };\n@@ -45,7 +46,8 @@ struct ItemMap {\n \n #[derive(Debug)]\n struct ModuleItems {\n-    items: FxHashMap<SmolStr, PerNs<ModuleItem>>,\n+    items: FxHashMap<SmolStr, PerNs<DefId>>,\n+    import_resolutions: FxHashMap<LocalSyntaxPtr, DefId>,\n }\n \n #[derive(Clone, Copy, Debug, PartialEq, Eq, PartialOrd, Ord, Hash)]\n@@ -197,3 +199,14 @@ impl ModuleItem {\n         Some(res)\n     }\n }\n+\n+struct Resolver {\n+    input: FxHashMap<ModuleId, InputModuleItems>,\n+    result: ModuleItems,\n+}\n+\n+impl Resolver {\n+    fn resolve(&mut self){\n+\n+    }\n+}"}, {"sha": "87417df94bbd24d8293ea1bb8802c66c5ed01b76", "filename": "crates/ra_analysis/src/loc2id.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Floc2id.rs?ref=c54b51fdedd21b0367af7cb3fac3bc16d21b8cc1", "patch": "@@ -8,7 +8,9 @@ use std::{\n use rustc_hash::FxHashMap;\n \n use crate::{\n+    descriptors::module::ModuleId,\n     syntax_ptr::SyntaxPtr,\n+    input::SourceRootId,\n };\n \n /// There are two principle ways to refer to things:\n@@ -89,6 +91,21 @@ macro_rules! impl_numeric_id {\n pub(crate) struct FnId(u32);\n impl_numeric_id!(FnId);\n \n+#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n+pub(crate) struct DefId(u32);\n+impl_numeric_id!(DefId);\n+\n+#[derive(Clone, Debug, PartialEq, Eq, Hash)]\n+enum DefLoc {\n+    Module {\n+        id: ModuleId,\n+        source_root: SourceRootId,\n+    },\n+    Item {\n+        ptr: SyntaxPtr,\n+    }\n+}\n+\n pub(crate) trait IdDatabase: salsa::Database {\n     fn id_maps(&self) -> &IdMaps;\n }\n@@ -110,4 +127,5 @@ impl IdMaps {\n #[derive(Debug, Default)]\n struct IdMapsInner {\n     fns: Mutex<Loc2IdMap<SyntaxPtr, FnId>>,\n+    defs: Mutex<Loc2IdMap<DefLoc, DefId>>,\n }"}]}