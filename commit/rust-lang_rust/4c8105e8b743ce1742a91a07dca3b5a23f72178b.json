{"sha": "4c8105e8b743ce1742a91a07dca3b5a23f72178b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjODEwNWU4Yjc0M2NlMTc0MmE5MWEwN2RjYTNiNWEyM2Y3MjE3OGI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-11-23T22:25:22Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-11-28T17:59:56Z"}, "message": "rustc_metadata: Privatize some fields and methods of `CStore`\n\nAfter it's moved to `creader.rs`", "tree": {"sha": "a0860783fea6e9cc2122fcb1e9c7c1671c218b7e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0860783fea6e9cc2122fcb1e9c7c1671c218b7e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c8105e8b743ce1742a91a07dca3b5a23f72178b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c8105e8b743ce1742a91a07dca3b5a23f72178b", "html_url": "https://github.com/rust-lang/rust/commit/4c8105e8b743ce1742a91a07dca3b5a23f72178b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c8105e8b743ce1742a91a07dca3b5a23f72178b/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "753ce4518e9178be819b898be83c6aef970d428c", "url": "https://api.github.com/repos/rust-lang/rust/commits/753ce4518e9178be819b898be83c6aef970d428c", "html_url": "https://github.com/rust-lang/rust/commit/753ce4518e9178be819b898be83c6aef970d428c"}], "stats": {"total": 22, "additions": 15, "deletions": 7}, "files": [{"sha": "5753afc5fcbe72a19da5d9cc0ff9c2ab24221283", "filename": "src/librustc_metadata/creader.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4c8105e8b743ce1742a91a07dca3b5a23f72178b/src%2Flibrustc_metadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c8105e8b743ce1742a91a07dca3b5a23f72178b/src%2Flibrustc_metadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcreader.rs?ref=4c8105e8b743ce1742a91a07dca3b5a23f72178b", "patch": "@@ -36,8 +36,8 @@ use rustc_error_codes::*;\n #[derive(Clone)]\n pub struct CStore {\n     metas: IndexVec<CrateNum, Option<Lrc<CrateMetadata>>>,\n-    crate injected_panic_runtime: Option<CrateNum>,\n-    crate allocator_kind: Option<AllocatorKind>,\n+    injected_panic_runtime: Option<CrateNum>,\n+    allocator_kind: Option<AllocatorKind>,\n }\n \n pub struct CrateLoader<'a> {\n@@ -91,7 +91,7 @@ fn dump_crates(cstore: &CStore) {\n }\n \n impl CStore {\n-    crate fn alloc_new_crate_num(&mut self) -> CrateNum {\n+    fn alloc_new_crate_num(&mut self) -> CrateNum {\n         self.metas.push(None);\n         CrateNum::new(self.metas.len() - 1)\n     }\n@@ -101,7 +101,7 @@ impl CStore {\n             .unwrap_or_else(|| panic!(\"Failed to get crate data for {:?}\", cnum))\n     }\n \n-    crate fn set_crate_data(&mut self, cnum: CrateNum, data: CrateMetadata) {\n+    fn set_crate_data(&mut self, cnum: CrateNum, data: CrateMetadata) {\n         assert!(self.metas[cnum].is_none(), \"Overwriting crate metadata entry\");\n         self.metas[cnum] = Some(Lrc::new(data));\n     }\n@@ -137,11 +137,19 @@ impl CStore {\n         deps\n     }\n \n-    crate fn crate_dependencies_in_reverse_postorder(&self, cnum: CrateNum) -> Vec<CrateNum> {\n+    fn crate_dependencies_in_reverse_postorder(&self, cnum: CrateNum) -> Vec<CrateNum> {\n         let mut deps = self.crate_dependencies_in_postorder(cnum);\n         deps.reverse();\n         deps\n     }\n+\n+    crate fn injected_panic_runtime(&self) -> Option<CrateNum> {\n+        self.injected_panic_runtime\n+    }\n+\n+    crate fn allocator_kind(&self) -> Option<AllocatorKind> {\n+        self.allocator_kind\n+    }\n }\n \n impl<'a> CrateLoader<'a> {"}, {"sha": "2271802b812899bc37f21d6cd6a1076edbed87f0", "filename": "src/librustc_metadata/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4c8105e8b743ce1742a91a07dca3b5a23f72178b/src%2Flibrustc_metadata%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c8105e8b743ce1742a91a07dca3b5a23f72178b/src%2Flibrustc_metadata%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=4c8105e8b743ce1742a91a07dca3b5a23f72178b", "patch": "@@ -530,10 +530,10 @@ impl CrateStore for CStore {\n     }\n \n     fn injected_panic_runtime(&self) -> Option<CrateNum> {\n-        self.injected_panic_runtime\n+        self.injected_panic_runtime()\n     }\n \n     fn allocator_kind(&self) -> Option<AllocatorKind> {\n-        self.allocator_kind\n+        self.allocator_kind()\n     }\n }"}]}