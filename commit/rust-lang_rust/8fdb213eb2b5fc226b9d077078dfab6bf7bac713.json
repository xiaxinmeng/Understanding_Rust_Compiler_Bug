{"sha": "8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmZGIyMTNlYjJiNWZjMjI2YjlkMDc3MDc4ZGZhYjZiZjdiYWM3MTM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-27T07:47:27Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-27T07:49:37Z"}, "message": "rustdoc: Optimize some closures to avoid copying", "tree": {"sha": "88d7038203d9ff9388d68714afccebca28fdd574", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88d7038203d9ff9388d68714afccebca28fdd574"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "html_url": "https://github.com/rust-lang/rust/commit/8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bfa4570393977ea01a216bd97350fdf1cbf2fdf", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bfa4570393977ea01a216bd97350fdf1cbf2fdf", "html_url": "https://github.com/rust-lang/rust/commit/3bfa4570393977ea01a216bd97350fdf1cbf2fdf"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "6f25ae4fbab3396c415296d8c7119e35c5cefb48", "filename": "src/rustdoc/attr_pass.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fattr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fattr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_pass.rs?ref=8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "patch": "@@ -154,7 +154,7 @@ fn merge_arg_attrs(\n     docs: [doc::argdoc],\n     attrs: [attr_parser::arg_attrs]\n ) -> [doc::argdoc] {\n-    par::anymap(docs) {|doc|\n+    par::seqmap(docs) {|doc|\n         alt vec::find(attrs) {|attr|\n             attr.name == doc.name\n         } {\n@@ -235,13 +235,15 @@ fn fold_enum(\n     fold: fold::fold<astsrv::srv>,\n     doc: doc::enumdoc\n ) -> doc::enumdoc {\n+\n     let srv = fold.ctxt;\n+    let doc_id = doc.id();\n     let doc = fold::default_seq_fold_enum(fold, doc);\n \n     {\n         variants: par::anymap(doc.variants) {|variant|\n             let attrs = astsrv::exec(srv) {|ctxt|\n-                alt check ctxt.ast_map.get(doc.id()) {\n+                alt check ctxt.ast_map.get(doc_id) {\n                   ast_map::node_item(@{\n                     node: ast::item_enum(ast_variants, _), _\n                   }, _) {\n@@ -288,7 +290,7 @@ fn fold_res(\n     let attrs = parse_item_attrs(srv, doc.id(), attr_parser::parse_res);\n \n     {\n-        args: par::anymap(doc.args) {|doc|\n+        args: par::seqmap(doc.args) {|doc|\n             alt vec::find(attrs.args) {|attr|\n                 attr.name == doc.name\n             } {"}, {"sha": "8295f9270507438bfbb26d200ac6098b735c97e2", "filename": "src/rustdoc/desc_pass.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fdesc_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fdesc_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fdesc_pass.rs?ref=8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "patch": "@@ -42,12 +42,13 @@ fn fold_item(fold: fold::fold<op>, doc: doc::itemdoc) -> doc::itemdoc {\n }\n \n fn fold_fn(fold: fold::fold<op>, doc: doc::fndoc) -> doc::fndoc {\n+    let fold_ctxt = fold.ctxt;\n     let doc = fold::default_seq_fold_fn(fold, doc);\n \n     {\n         args: par::anymap(doc.args) {|doc|\n             {\n-                desc: maybe_apply_op(fold.ctxt, doc.desc)\n+                desc: maybe_apply_op(fold_ctxt, doc.desc)\n                 with doc\n             }\n         },\n@@ -61,12 +62,13 @@ fn fold_fn(fold: fold::fold<op>, doc: doc::fndoc) -> doc::fndoc {\n }\n \n fn fold_enum(fold: fold::fold<op>, doc: doc::enumdoc) -> doc::enumdoc {\n+    let fold_ctxt = fold.ctxt;\n     let doc = fold::default_seq_fold_enum(fold, doc);\n \n     {\n         variants: par::anymap(doc.variants) {|variant|\n             {\n-                desc: maybe_apply_op(fold.ctxt, variant.desc)\n+                desc: maybe_apply_op(fold_ctxt, variant.desc)\n                 with variant\n             }\n         }\n@@ -75,12 +77,13 @@ fn fold_enum(fold: fold::fold<op>, doc: doc::enumdoc) -> doc::enumdoc {\n }\n \n fn fold_res(fold: fold::fold<op>, doc: doc::resdoc) -> doc::resdoc {\n+    let fold_ctxt = fold.ctxt;\n     let doc = fold::default_seq_fold_res(fold, doc);\n \n     {\n         args: par::anymap(doc.args) {|arg|\n             {\n-                desc: maybe_apply_op(fold.ctxt, arg.desc)\n+                desc: maybe_apply_op(fold_ctxt, arg.desc)\n                 with arg\n             }\n         }"}, {"sha": "95e1b670060f38bb94aab3d81ad9566c44dc1add", "filename": "src/rustdoc/markdown_pass.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fmarkdown_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fmarkdown_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fmarkdown_pass.rs?ref=8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "patch": "@@ -228,7 +228,7 @@ fn write_sig(ctxt: ctxt, sig: option<str>) {\n \n fn code_block_indent(s: str) -> str {\n     let lines = str::lines_any(s);\n-    let indented = par::anymap(lines, { |line| #fmt(\"    %s\", line) });\n+    let indented = par::seqmap(lines, { |line| #fmt(\"    %s\", line) });\n     str::connect(indented, \"\\n\")\n }\n "}, {"sha": "d15caffd46fd4008ba1b12e1232dccaae73e7440", "filename": "src/rustdoc/par.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fpar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Fpar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fpar.rs?ref=8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "patch": "@@ -1,6 +1,6 @@\n export anymap, seqmap, parmap;\n \n-fn anymap<T:send, U:send>(v: [T], f: fn(T) -> U) -> [U] {\n+fn anymap<T:send, U:send>(v: [T], f: fn~(T) -> U) -> [U] {\n     seqmap(v, f)\n }\n "}, {"sha": "5f3c1496bff92b29071ab14aadfa1c2eb902687b", "filename": "src/rustdoc/tystr_pass.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Ftystr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fdb213eb2b5fc226b9d077078dfab6bf7bac713/src%2Frustdoc%2Ftystr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Ftystr_pass.rs?ref=8fdb213eb2b5fc226b9d077078dfab6bf7bac713", "patch": "@@ -214,12 +214,13 @@ fn fold_enum(\n     fold: fold::fold<astsrv::srv>,\n     doc: doc::enumdoc\n ) -> doc::enumdoc {\n+    let doc_id = doc.id();\n     let srv = fold.ctxt;\n \n     {\n         variants: par::anymap(doc.variants) {|variant|\n             let sig = astsrv::exec(srv) {|ctxt|\n-                alt check ctxt.ast_map.get(doc.id()) {\n+                alt check ctxt.ast_map.get(doc_id) {\n                   ast_map::node_item(@{\n                     node: ast::item_enum(ast_variants, _), _\n                   }, _) {"}]}