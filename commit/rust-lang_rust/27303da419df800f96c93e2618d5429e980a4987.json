{"sha": "27303da419df800f96c93e2618d5429e980a4987", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3MzAzZGE0MTlkZjgwMGY5NmM5M2UyNjE4ZDU0MjllOTgwYTQ5ODc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-08-06T07:29:06Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-08-06T07:50:00Z"}, "message": "use Conv for severity", "tree": {"sha": "649df7464bd58f08466eda216512e964212799c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/649df7464bd58f08466eda216512e964212799c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27303da419df800f96c93e2618d5429e980a4987", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27303da419df800f96c93e2618d5429e980a4987", "html_url": "https://github.com/rust-lang/rust/commit/27303da419df800f96c93e2618d5429e980a4987", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27303da419df800f96c93e2618d5429e980a4987/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12a7329cb3141e8b6e719cc08f1eea1bdb3fae3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/12a7329cb3141e8b6e719cc08f1eea1bdb3fae3a", "html_url": "https://github.com/rust-lang/rust/commit/12a7329cb3141e8b6e719cc08f1eea1bdb3fae3a"}], "stats": {"total": 41, "additions": 21, "deletions": 20}, "files": [{"sha": "df8ea6e0d1abcacad08cb54e563827a5db674559", "filename": "crates/ra_lsp_server/src/conv.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/27303da419df800f96c93e2618d5429e980a4987/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27303da419df800f96c93e2618d5429e980a4987/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs?ref=27303da419df800f96c93e2618d5429e980a4987", "patch": "@@ -1,13 +1,13 @@\n use lsp_types::{\n-    self, CreateFile, DocumentChangeOperation, DocumentChanges, Documentation, Location,\n-    LocationLink, MarkupContent, MarkupKind, Position, Range, RenameFile, ResourceOp, SymbolKind,\n-    TextDocumentEdit, TextDocumentIdentifier, TextDocumentItem, TextDocumentPositionParams, Url,\n-    VersionedTextDocumentIdentifier, WorkspaceEdit,\n+    self, CreateFile, DiagnosticSeverity, DocumentChangeOperation, DocumentChanges, Documentation,\n+    Location, LocationLink, MarkupContent, MarkupKind, Position, Range, RenameFile, ResourceOp,\n+    SymbolKind, TextDocumentEdit, TextDocumentIdentifier, TextDocumentItem,\n+    TextDocumentPositionParams, Url, VersionedTextDocumentIdentifier, WorkspaceEdit,\n };\n use ra_ide_api::{\n     translate_offset_with_edit, CompletionItem, CompletionItemKind, FileId, FilePosition,\n     FileRange, FileSystemEdit, InsertTextFormat, LineCol, LineIndex, NavigationTarget, RangeInfo,\n-    SourceChange, SourceFileEdit,\n+    Severity, SourceChange, SourceFileEdit,\n };\n use ra_syntax::{SyntaxKind, TextRange, TextUnit};\n use ra_text_edit::{AtomTextEdit, TextEdit};\n@@ -79,6 +79,16 @@ impl Conv for CompletionItemKind {\n     }\n }\n \n+impl Conv for Severity {\n+    type Output = DiagnosticSeverity;\n+    fn conv(self) -> DiagnosticSeverity {\n+        match self {\n+            Severity::Error => DiagnosticSeverity::Error,\n+            Severity::WeakWarning => DiagnosticSeverity::Hint,\n+        }\n+    }\n+}\n+\n impl ConvWith for CompletionItem {\n     type Ctx = LineIndex;\n     type Output = ::lsp_types::CompletionItem;"}, {"sha": "005ce08b32601aa15585156628c8ae427dd6702c", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 6, "deletions": 15, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/27303da419df800f96c93e2618d5429e980a4987/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27303da419df800f96c93e2618d5429e980a4987/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=27303da419df800f96c93e2618d5429e980a4987", "patch": "@@ -3,13 +3,13 @@ use std::{fmt::Write as _, io::Write as _};\n use gen_lsp_server::ErrorCode;\n use lsp_types::{\n     CodeAction, CodeActionResponse, CodeLens, Command, CompletionItem, Diagnostic,\n-    DiagnosticSeverity, DocumentFormattingParams, DocumentHighlight, DocumentSymbol, FoldingRange,\n-    FoldingRangeKind, FoldingRangeParams, Hover, HoverContents, Location, MarkupContent,\n-    MarkupKind, Position, PrepareRenameResponse, Range, RenameParams, SymbolInformation,\n-    TextDocumentIdentifier, TextEdit, WorkspaceEdit,\n+    DocumentFormattingParams, DocumentHighlight, DocumentSymbol, FoldingRange, FoldingRangeKind,\n+    FoldingRangeParams, Hover, HoverContents, Location, MarkupContent, MarkupKind, Position,\n+    PrepareRenameResponse, Range, RenameParams, SymbolInformation, TextDocumentIdentifier,\n+    TextEdit, WorkspaceEdit,\n };\n use ra_ide_api::{\n-    AssistId, Cancelable, FileId, FilePosition, FileRange, FoldKind, Query, RunnableKind, Severity,\n+    AssistId, Cancelable, FileId, FilePosition, FileRange, FoldKind, Query, RunnableKind,\n };\n use ra_prof::profile;\n use ra_syntax::{AstNode, SyntaxKind, TextRange, TextUnit};\n@@ -838,7 +838,7 @@ pub fn publish_diagnostics(\n         .into_iter()\n         .map(|d| Diagnostic {\n             range: d.range.conv_with(&line_index),\n-            severity: Some(to_diagnostic_severity(d.severity)),\n+            severity: Some(d.severity.conv()),\n             code: None,\n             source: Some(\"rust-analyzer\".to_string()),\n             message: d.message,\n@@ -871,15 +871,6 @@ fn highlight(world: &WorldSnapshot, file_id: FileId) -> Result<Vec<Decoration>>\n     Ok(res)\n }\n \n-fn to_diagnostic_severity(severity: Severity) -> DiagnosticSeverity {\n-    use ra_ide_api::Severity::*;\n-\n-    match severity {\n-        Error => DiagnosticSeverity::Error,\n-        WeakWarning => DiagnosticSeverity::Hint,\n-    }\n-}\n-\n pub fn handle_inlay_hints(\n     world: WorldSnapshot,\n     params: InlayHintsParams,"}]}