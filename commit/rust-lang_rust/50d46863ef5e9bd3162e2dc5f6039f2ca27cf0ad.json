{"sha": "50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwZDQ2ODYzZWY1ZTliZDMxNjJlMmRjNWY2MDM5ZjJjYTI3Y2YwYWQ=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-08-07T19:56:42Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-08-07T20:30:13Z"}, "message": "Look for enum variants and trait assoc functions when looking for lang items", "tree": {"sha": "3e84af88f8c41c58d239a542c318320eeebadf42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e84af88f8c41c58d239a542c318320eeebadf42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "html_url": "https://github.com/rust-lang/rust/commit/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80f522091a44234bd7ccdbe2ef759252d496227d", "url": "https://api.github.com/repos/rust-lang/rust/commits/80f522091a44234bd7ccdbe2ef759252d496227d", "html_url": "https://github.com/rust-lang/rust/commit/80f522091a44234bd7ccdbe2ef759252d496227d"}], "stats": {"total": 36, "additions": 28, "deletions": 8}, "files": [{"sha": "6797a77de58d5626811727d5a9bfdadc8a8679a7", "filename": "crates/hir_def/src/lang_item.rs", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad/crates%2Fhir_def%2Fsrc%2Flang_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad/crates%2Fhir_def%2Fsrc%2Flang_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Flang_item.rs?ref=50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "patch": "@@ -8,8 +8,8 @@ use rustc_hash::FxHashMap;\n use syntax::SmolStr;\n \n use crate::{\n-    db::DefDatabase, AdtId, AttrDefId, CrateId, EnumId, FunctionId, ImplId, ModuleDefId, StaticId,\n-    StructId, TraitId,\n+    db::DefDatabase, AdtId, AttrDefId, CrateId, EnumId, EnumVariantId, FunctionId, ImplId,\n+    ModuleDefId, StaticId, StructId, TraitId,\n };\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -20,6 +20,7 @@ pub enum LangItemTarget {\n     StaticId(StaticId),\n     StructId(StructId),\n     TraitId(TraitId),\n+    EnumVariantId(EnumVariantId),\n }\n \n impl LangItemTarget {\n@@ -64,6 +65,13 @@ impl LangItemTarget {\n             _ => None,\n         }\n     }\n+\n+    pub fn as_enum_variant(self) -> Option<EnumVariantId> {\n+        match self {\n+            LangItemTarget::EnumVariantId(id) => Some(id),\n+            _ => None,\n+        }\n+    }\n }\n \n #[derive(Default, Debug, Clone, PartialEq, Eq)]\n@@ -92,19 +100,31 @@ impl LangItems {\n             for def in module_data.scope.declarations() {\n                 match def {\n                     ModuleDefId::TraitId(trait_) => {\n-                        lang_items.collect_lang_item(db, trait_, LangItemTarget::TraitId)\n+                        lang_items.collect_lang_item(db, trait_, LangItemTarget::TraitId);\n+                        db.trait_data(trait_).items.iter().for_each(|&(_, assoc_id)| {\n+                            if let crate::AssocItemId::FunctionId(f) = assoc_id {\n+                                lang_items.collect_lang_item(db, f, LangItemTarget::FunctionId);\n+                            }\n+                        });\n                     }\n                     ModuleDefId::AdtId(AdtId::EnumId(e)) => {\n-                        lang_items.collect_lang_item(db, e, LangItemTarget::EnumId)\n+                        lang_items.collect_lang_item(db, e, LangItemTarget::EnumId);\n+                        db.enum_data(e).variants.iter().for_each(|(local_id, _)| {\n+                            lang_items.collect_lang_item(\n+                                db,\n+                                EnumVariantId { parent: e, local_id },\n+                                LangItemTarget::EnumVariantId,\n+                            );\n+                        });\n                     }\n                     ModuleDefId::AdtId(AdtId::StructId(s)) => {\n-                        lang_items.collect_lang_item(db, s, LangItemTarget::StructId)\n+                        lang_items.collect_lang_item(db, s, LangItemTarget::StructId);\n                     }\n                     ModuleDefId::FunctionId(f) => {\n-                        lang_items.collect_lang_item(db, f, LangItemTarget::FunctionId)\n+                        lang_items.collect_lang_item(db, f, LangItemTarget::FunctionId);\n                     }\n                     ModuleDefId::StaticId(s) => {\n-                        lang_items.collect_lang_item(db, s, LangItemTarget::StaticId)\n+                        lang_items.collect_lang_item(db, s, LangItemTarget::StaticId);\n                     }\n                     _ => {}\n                 }"}, {"sha": "cbfe89b911c66b0053f2bededba8d38eafb29f0f", "filename": "crates/ide_completion/src/completions/flyimport.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fflyimport.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fflyimport.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fflyimport.rs?ref=50d46863ef5e9bd3162e2dc5f6039f2ca27cf0ad", "patch": "@@ -696,8 +696,8 @@ fn main() {\n }\n \"#,\n             expect![[r#\"\n-                ct SPECIAL_CONST (use dep::test_mod::TestTrait) DEPRECATED\n                 fn weird_function() (use dep::test_mod::TestTrait) fn() DEPRECATED\n+                ct SPECIAL_CONST (use dep::test_mod::TestTrait) DEPRECATED\n             \"#]],\n         );\n     }"}]}