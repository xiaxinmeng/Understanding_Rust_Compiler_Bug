{"sha": "b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "node_id": "C_kwDOAAsO6NoAKGIzZGEwNGFhNTJkNmUzNmQ3ZGI4NjY2ZGI5YWVlYWVjMzE2ZjFjYzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-15T22:26:28Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-18T18:23:48Z"}, "message": "Check both align and size in PointerSized", "tree": {"sha": "1df8059392d817dba2b0b9526d96f93dcaf7da64", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1df8059392d817dba2b0b9526d96f93dcaf7da64"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "html_url": "https://github.com/rust-lang/rust/commit/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da3c5397a614f790f0daaf61bfdc692b36719e01", "url": "https://api.github.com/repos/rust-lang/rust/commits/da3c5397a614f790f0daaf61bfdc692b36719e01", "html_url": "https://github.com/rust-lang/rust/commit/da3c5397a614f790f0daaf61bfdc692b36719e01"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "4c6bb39d17b30ba34c50e97fe16b055a8a3155bf", "filename": "compiler/rustc_trait_selection/src/traits/select/candidate_assembly.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs?ref=b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "patch": "@@ -1069,7 +1069,8 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         let usize_layout =\n             self.tcx().layout_of(ty::ParamEnv::empty().and(self.tcx().types.usize)).unwrap().layout;\n         if let Ok(layout) = self.tcx().layout_of(obligation.param_env.and(self_ty))\n-            && layout.layout.size().bytes() == usize_layout.size().bytes()\n+            && layout.layout.size() == usize_layout.size()\n+            && layout.layout.align() == usize_layout.align()\n         {\n             candidates.vec.push(BuiltinCandidate { has_nested: false });\n         }"}, {"sha": "983d7bf6e7e9cdc7e3d7053534651ca41b95180b", "filename": "src/test/ui/dyn-star/align.normal.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr?ref=b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "patch": "@@ -0,0 +1,11 @@\n+warning: the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/align.rs:4:12\n+   |\n+LL | #![feature(dyn_star)]\n+   |            ^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+warning: 1 warning emitted\n+"}, {"sha": "6b6fc55d8053eb71861505f62c24082816a29b02", "filename": "src/test/ui/dyn-star/align.over_aligned.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr?ref=b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "patch": "@@ -0,0 +1,20 @@\n+warning: the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/align.rs:4:12\n+   |\n+LL | #![feature(dyn_star)]\n+   |            ^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error[E0277]: `AlignedUsize` needs to be a pointer-sized type\n+  --> $DIR/align.rs:15:13\n+   |\n+LL |     let x = AlignedUsize(12) as dyn* Debug;\n+   |             ^^^^^^^^^^^^^^^^ `AlignedUsize` needs to be a pointer-sized type\n+   |\n+   = help: the trait `PointerSized` is not implemented for `AlignedUsize`\n+\n+error: aborting due to previous error; 1 warning emitted\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "fb41a05a0660ba19e45dc5f652b43fdf0f856111", "filename": "src/test/ui/dyn-star/align.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3da04aa52d6e36d7db8666db9aeeaec316f1cc9/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs?ref=b3da04aa52d6e36d7db8666db9aeeaec316f1cc9", "patch": "@@ -0,0 +1,17 @@\n+// revisions: normal over_aligned\n+//[normal] check-pass\n+\n+#![feature(dyn_star)]\n+//~^ WARN the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+\n+use std::fmt::Debug;\n+\n+#[cfg_attr(over_aligned,      repr(C, align(1024)))]\n+#[cfg_attr(not(over_aligned), repr(C))]\n+#[derive(Debug)]\n+struct AlignedUsize(usize);\n+\n+fn main() {\n+    let x = AlignedUsize(12) as dyn* Debug;\n+    //[over_aligned]~^ ERROR `AlignedUsize` needs to be a pointer-sized type\n+}"}]}