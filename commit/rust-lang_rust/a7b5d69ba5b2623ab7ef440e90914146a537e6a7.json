{"sha": "a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3YjVkNjliYTViMjYyM2FiN2VmNDQwZTkwOTE0MTQ2YTUzN2U2YTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-15T09:01:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-15T09:01:05Z"}, "message": "Auto merge of #32851 - apasel422:spec-extend, r=alexcrichton\n\nSpecialize `Extend` to `append` for `{LinkedList, Vec}`", "tree": {"sha": "7d4ae6b84068abaea511e7fe47df8a34c1f2ba78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d4ae6b84068abaea511e7fe47df8a34c1f2ba78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "html_url": "https://github.com/rust-lang/rust/commit/a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4091cd0c5d0aa6e915867ce996f5b547dee2ff31", "url": "https://api.github.com/repos/rust-lang/rust/commits/4091cd0c5d0aa6e915867ce996f5b547dee2ff31", "html_url": "https://github.com/rust-lang/rust/commit/4091cd0c5d0aa6e915867ce996f5b547dee2ff31"}, {"sha": "cf37af162721f897e6b3565ab368906621955d90", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf37af162721f897e6b3565ab368906621955d90", "html_url": "https://github.com/rust-lang/rust/commit/cf37af162721f897e6b3565ab368906621955d90"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "34e4a426d3c0d6baba695c8c9d3bffbff07104cc", "filename": "src/libcollections/lib.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Flib.rs?ref=a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "patch": "@@ -132,3 +132,10 @@ pub enum Bound<T> {\n     /// An infinite endpoint. Indicates that there is no bound in this direction.\n     Unbounded,\n }\n+\n+/// An intermediate trait for specialization of `Extend`.\n+#[doc(hidden)]\n+trait SpecExtend<I: IntoIterator> {\n+    /// Extends `self` with the contents of the given iterator.\n+    fn spec_extend(&mut self, iter: I);\n+}"}, {"sha": "c974be54bd07d422a1e44507020ddb188683aa63", "filename": "src/libcollections/linked_list.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Flinked_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Flinked_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Flinked_list.rs?ref=a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "patch": "@@ -30,6 +30,8 @@ use core::mem;\n use core::ops::{BoxPlace, InPlace, Place, Placer};\n use core::ptr::{self, Shared};\n \n+use super::SpecExtend;\n+\n /// A doubly-linked list.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub struct LinkedList<T> {\n@@ -969,12 +971,24 @@ impl<'a, T> IntoIterator for &'a mut LinkedList<T> {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<A> Extend<A> for LinkedList<A> {\n     fn extend<T: IntoIterator<Item = A>>(&mut self, iter: T) {\n+        <Self as SpecExtend<T>>::spec_extend(self, iter);\n+    }\n+}\n+\n+impl<I: IntoIterator> SpecExtend<I> for LinkedList<I::Item> {\n+    default fn spec_extend(&mut self, iter: I) {\n         for elt in iter {\n             self.push_back(elt);\n         }\n     }\n }\n \n+impl<T> SpecExtend<LinkedList<T>> for LinkedList<T> {\n+    fn spec_extend(&mut self, ref mut other: LinkedList<T>) {\n+        self.append(other);\n+    }\n+}\n+\n #[stable(feature = \"extend_ref\", since = \"1.2.0\")]\n impl<'a, T: 'a + Copy> Extend<&'a T> for LinkedList<T> {\n     fn extend<I: IntoIterator<Item = &'a T>>(&mut self, iter: I) {"}, {"sha": "58d4a4ed4eb084c04e0f47279d2b96c891280a47", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "patch": "@@ -75,6 +75,7 @@ use core::ops;\n use core::ptr;\n use core::slice;\n \n+use super::SpecExtend;\n use super::range::RangeArgument;\n \n /// A contiguous growable array type, written `Vec<T>` but pronounced 'vector.'\n@@ -1390,10 +1391,22 @@ impl<'a, T> IntoIterator for &'a mut Vec<T> {\n impl<T> Extend<T> for Vec<T> {\n     #[inline]\n     fn extend<I: IntoIterator<Item = T>>(&mut self, iter: I) {\n+        <Self as SpecExtend<I>>::spec_extend(self, iter);\n+    }\n+}\n+\n+impl<I: IntoIterator> SpecExtend<I> for Vec<I::Item> {\n+    default fn spec_extend(&mut self, iter: I) {\n         self.extend_desugared(iter.into_iter())\n     }\n }\n \n+impl<T> SpecExtend<Vec<T>> for Vec<T> {\n+    fn spec_extend(&mut self, ref mut other: Vec<T>) {\n+        self.append(other);\n+    }\n+}\n+\n impl<T> Vec<T> {\n     fn extend_desugared<I: Iterator<Item = T>>(&mut self, mut iterator: I) {\n         // This function should be the moral equivalent of:"}, {"sha": "3ad4790d36a675722819266bb8a822644dbb24e5", "filename": "src/libcollectionstest/linked_list.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollectionstest%2Flinked_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollectionstest%2Flinked_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollectionstest%2Flinked_list.rs?ref=a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "patch": "@@ -339,6 +339,22 @@ fn test_extend_ref() {\n     assert_eq!(a, list_from(&[1, 2, 3, 4, 5, 6]));\n }\n \n+#[test]\n+fn test_extend() {\n+    let mut a = LinkedList::new();\n+    a.push_back(1);\n+    a.extend(vec![2, 3, 4]); // uses iterator\n+\n+    assert_eq!(a.len(), 4);\n+    assert!(a.iter().eq(&[1, 2, 3, 4]));\n+\n+    let b: LinkedList<_> = vec![5, 6, 7].into_iter().collect();\n+    a.extend(b); // specializes to `append`\n+\n+    assert_eq!(a.len(), 7);\n+    assert!(a.iter().eq(&[1, 2, 3, 4, 5, 6, 7]));\n+}\n+\n #[bench]\n fn bench_collect_into(b: &mut test::Bencher) {\n     let v = &[0; 64];"}, {"sha": "0fb00543ddd9731e43d5ff7590b1902c217cf20a", "filename": "src/libcollectionstest/vec.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollectionstest%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b5d69ba5b2623ab7ef440e90914146a537e6a7/src%2Flibcollectionstest%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollectionstest%2Fvec.rs?ref=a7b5d69ba5b2623ab7ef440e90914146a537e6a7", "patch": "@@ -93,6 +93,9 @@ fn test_extend() {\n     for i in 3..10 { w.push(i) }\n \n     assert_eq!(v, w);\n+\n+    v.extend(w.clone()); // specializes to `append`\n+    assert!(v.iter().eq(w.iter().chain(w.iter())));\n }\n \n #[test]"}]}