{"sha": "29a449aae38d7b291a0038ba23d1e0a607244dae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5YTQ0OWFhZTM4ZDdiMjkxYTAwMzhiYTIzZDFlMGE2MDcyNDRkYWU=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-08-02T01:09:20Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-08-19T22:09:20Z"}, "message": "Add tests for cross-crate condition handling. Close #5446.", "tree": {"sha": "88ad7a336da4195521e14c4b10bf09b96202d3c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88ad7a336da4195521e14c4b10bf09b96202d3c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29a449aae38d7b291a0038ba23d1e0a607244dae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29a449aae38d7b291a0038ba23d1e0a607244dae", "html_url": "https://github.com/rust-lang/rust/commit/29a449aae38d7b291a0038ba23d1e0a607244dae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29a449aae38d7b291a0038ba23d1e0a607244dae/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eaa378033c63595ee22cc6ccaf6e737f2193c78b", "url": "https://api.github.com/repos/rust-lang/rust/commits/eaa378033c63595ee22cc6ccaf6e737f2193c78b", "html_url": "https://github.com/rust-lang/rust/commit/eaa378033c63595ee22cc6ccaf6e737f2193c78b"}], "stats": {"total": 215, "additions": 215, "deletions": 0}, "files": [{"sha": "927602de1698903f429ef2330b07a15b96ab1f54", "filename": "src/test/auxiliary/xc_conditions.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fxc_conditions.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_type=\"lib\"];\n+\n+condition! {\n+    pub oops: int -> int;\n+}\n+\n+pub fn trouble() -> int {\n+    oops::cond.raise(1)\n+}"}, {"sha": "16a5bb563434196c1ff4fdc8ba6f95930a5c6c77", "filename": "src/test/auxiliary/xc_conditions_2.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fxc_conditions_2.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_type=\"lib\"];\n+\n+condition! {\n+    pub oops: int -> int;\n+}"}, {"sha": "d5ce63e7e9bc0939bdf20bfecfbd3d5f5f3d7914", "filename": "src/test/auxiliary/xc_conditions_3.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fxc_conditions_3.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_type=\"lib\"];\n+\n+condition! {\n+    pub oops: int -> int;\n+}\n+\n+pub fn guard(k: extern fn() -> int, x: int) -> int {\n+    do oops::cond.trap(|i| i*x).inside {\n+        k()\n+    }\n+}"}, {"sha": "c9b5a1dc2b82076e69b1d905b9961b2ed0ef22e9", "filename": "src/test/auxiliary/xc_conditions_4.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Fauxiliary%2Fxc_conditions_4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fxc_conditions_4.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_type=\"lib\"];\n+\n+#[deriving(Eq)]\n+pub enum Color {\n+    Red, Green, Blue\n+}\n+\n+condition! {\n+    pub oops: (int,float,~str) -> ::Color;\n+}\n+\n+pub trait Thunk<T> {\n+    fn call(self) -> T;\n+}\n+\n+pub fn callback<T,TH:Thunk<T>>(t:TH) -> T {\n+    t.call()\n+}\n+"}, {"sha": "ffef5369f237e6c8c505df3d062870ffd7ce0e58", "filename": "src/test/run-pass/xc_conditions_client.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fxc_conditions_client.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,40 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast\n+// aux-build:xc_conditions.rs\n+\n+extern mod xc_conditions;\n+use xc_conditions::oops;\n+use xc_conditions::trouble;\n+\n+// Tests of cross-crate conditions; the condition is\n+// defined in lib, and we test various combinations\n+// of `trap` and `raise` in the client or the lib where\n+// the condition was defined. Also in test #4 we use\n+// more complex features (generics, traits) in\n+// combination with the condition.\n+//\n+//                    trap   raise\n+//                    ------------\n+// xc_conditions  :   client   lib\n+// xc_conditions_2:   client   client\n+// xc_conditions_3:   lib      client\n+// xc_conditions_4:   client   client  (with traits)\n+//\n+// the trap=lib, raise=lib case isn't tested since\n+// there's no cross-crate-ness to test in that case.\n+\n+pub fn main() {\n+    do oops::cond.trap(|_i| 12345).inside {\n+        let x = trouble();\n+        assert_eq!(x,12345);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "9666c037449f1a4a049a2a0ff79232af7a65b799", "filename": "src/test/run-pass/xc_conditions_client_2.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fxc_conditions_client_2.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast\n+// aux-build:xc_conditions_2.rs\n+\n+extern mod xc_conditions_2;\n+use xcc = xc_conditions_2;\n+\n+pub fn main() {\n+    do xcc::oops::cond.trap(|_| 1).inside {\n+        xcc::oops::cond.raise(1);\n+    }\n+}"}, {"sha": "7d16572c139ce61725a77d268a0f7f28f52f727e", "filename": "src/test/run-pass/xc_conditions_client_3.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fxc_conditions_client_3.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,38 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast\n+// aux-build:xc_conditions_3.rs\n+\n+extern mod xc_conditions_3;\n+use xcc = xc_conditions_3;\n+\n+pub fn main() {\n+    assert_eq!(xcc::guard(a, 1), 40);\n+}\n+\n+pub fn a() -> int {\n+    assert_eq!(xcc::oops::cond.raise(7), 7);\n+    xcc::guard(b, 2)\n+}\n+\n+pub fn b() -> int {\n+    assert_eq!(xcc::oops::cond.raise(8), 16);\n+    xcc::guard(c, 3)\n+}\n+\n+pub fn c() -> int {\n+    assert_eq!(xcc::oops::cond.raise(9), 27);\n+    xcc::guard(d, 4)\n+}\n+\n+pub fn d() -> int {\n+    xcc::oops::cond.raise(10)\n+}"}, {"sha": "9a4a868374235fa3768f9bee4f8c27a3ba90c08b", "filename": "src/test/run-pass/xc_conditions_client_4.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29a449aae38d7b291a0038ba23d1e0a607244dae/src%2Ftest%2Frun-pass%2Fxc_conditions_client_4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fxc_conditions_client_4.rs?ref=29a449aae38d7b291a0038ba23d1e0a607244dae", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast\n+// aux-build:xc_conditions_4.rs\n+\n+extern mod xc_conditions_4;\n+use xcc = xc_conditions_4;\n+\n+struct SThunk {\n+    x: int\n+}\n+\n+impl xcc::Thunk<xcc::Color> for SThunk {\n+    fn call(self) -> xcc::Color {\n+        xcc::oops::cond.raise((self.x, 1.23, ~\"oh no\"))\n+    }\n+}\n+\n+pub fn main() {\n+    do xcc::oops::cond.trap(|_| xcc::Red).inside {\n+        let t = SThunk { x : 10 };\n+        assert_eq!(xcc::callback(t), xcc::Red)\n+    }\n+}\n\\ No newline at end of file"}]}