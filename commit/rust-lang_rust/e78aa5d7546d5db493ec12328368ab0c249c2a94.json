{"sha": "e78aa5d7546d5db493ec12328368ab0c249c2a94", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3OGFhNWQ3NTQ2ZDVkYjQ5M2VjMTIzMjgzNjhhYjBjMjQ5YzJhOTQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-25T05:50:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-25T05:50:08Z"}, "message": "Auto merge of #40060 - alexcrichton:retry-downloads, r=aturon\n\nrustbuild: Retry downloads by default\n\nDon't rely on curl's --retry, it appears to not work for some errors like SSL\nerrors.", "tree": {"sha": "8fb5c3e5ce5bf519d3a507c99651e4395fa75389", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8fb5c3e5ce5bf519d3a507c99651e4395fa75389"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e78aa5d7546d5db493ec12328368ab0c249c2a94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e78aa5d7546d5db493ec12328368ab0c249c2a94", "html_url": "https://github.com/rust-lang/rust/commit/e78aa5d7546d5db493ec12328368ab0c249c2a94", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e78aa5d7546d5db493ec12328368ab0c249c2a94/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19e5a82f8950ae15fb2a082791cb82c048e58006", "url": "https://api.github.com/repos/rust-lang/rust/commits/19e5a82f8950ae15fb2a082791cb82c048e58006", "html_url": "https://github.com/rust-lang/rust/commit/19e5a82f8950ae15fb2a082791cb82c048e58006"}, {"sha": "30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "url": "https://api.github.com/repos/rust-lang/rust/commits/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "html_url": "https://github.com/rust-lang/rust/commit/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "6b1b8ddf56f2a55f4cfcd22114d60398fd9a36de", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e78aa5d7546d5db493ec12328368ab0c249c2a94/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/e78aa5d7546d5db493ec12328368ab0c249c2a94/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=e78aa5d7546d5db493ec12328368ab0c249c2a94", "patch": "@@ -59,20 +59,33 @@ def delete_if_present(path, verbose):\n \n \n def download(path, url, probably_big, verbose):\n+    for x in range(0, 4):\n+        try:\n+            _download(path, url, probably_big, verbose, True)\n+            return\n+        except RuntimeError:\n+            print(\"\\nspurious failure, trying again\")\n+    _download(path, url, probably_big, verbose, False)\n+\n+\n+def _download(path, url, probably_big, verbose, exception):\n     if probably_big or verbose:\n         print(\"downloading {}\".format(url))\n     # see http://serverfault.com/questions/301128/how-to-download\n     if sys.platform == 'win32':\n         run([\"PowerShell.exe\", \"/nologo\", \"-Command\",\n              \"(New-Object System.Net.WebClient)\"\n              \".DownloadFile('{}', '{}')\".format(url, path)],\n-            verbose=verbose)\n+            verbose=verbose,\n+            exception=exception)\n     else:\n         if probably_big or verbose:\n             option = \"-#\"\n         else:\n             option = \"-s\"\n-        run([\"curl\", option, \"--retry\", \"3\", \"-Sf\", \"-o\", path, url], verbose=verbose)\n+        run([\"curl\", option, \"--retry\", \"3\", \"-Sf\", \"-o\", path, url],\n+            verbose=verbose,\n+            exception=exception)\n \n \n def verify(path, sha_path, verbose):\n@@ -112,7 +125,7 @@ def unpack(tarball, dst, verbose=False, match=None):\n             shutil.move(tp, fp)\n     shutil.rmtree(os.path.join(dst, fname))\n \n-def run(args, verbose=False):\n+def run(args, verbose=False, exception=False):\n     if verbose:\n         print(\"running: \" + ' '.join(args))\n     sys.stdout.flush()\n@@ -122,7 +135,7 @@ def run(args, verbose=False):\n     code = ret.wait()\n     if code != 0:\n         err = \"failed to run: \" + ' '.join(args)\n-        if verbose:\n+        if verbose or exception:\n             raise RuntimeError(err)\n         sys.exit(err)\n "}]}