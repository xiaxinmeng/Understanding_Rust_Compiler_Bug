{"sha": "1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "node_id": "C_kwDOAAsO6NoAKDFjM2NjOGJiYTVkMTJlZjNkMjFmZWU0NmMwYjAyZTczOTBiMzgxYTQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-01T00:21:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-01T00:21:56Z"}, "message": "Rollup merge of #108496 - nx2k3:issue-108495-dec, r=WaffleLapkin\n\nfix #108495, postfix decrement and prefix decrement has no warning\n\nFixes #108495", "tree": {"sha": "95d9d6fb1d488d5ade07ddc4eeb20ab25d2f4fb0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/95d9d6fb1d488d5ade07ddc4eeb20ab25d2f4fb0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj/pqkCRBK7hj4Ov3rIwAAIt8IAKsmFdU/vEJKdj8ufzfJB0CN\n703d9bgtnGBUtDfng7VcjvtPrcdsUjuf49cc7qtLVe50VoBgKPaVUNU1MKFMek+N\nXjoNAVCbM/RmtssbJ21HDJtTN2ng3dzetWszpo3DSLNsTc90oMZWr4tBgjh7TdSP\nrP67c4ff0pK9K9MIT8/RvuntgpWSJ99T430XUEYU0SzkH28f0VdtYtWB4OZTTjBx\naz7R37eUKKK09kxfi3uNbvI6suF79C5PbFJ/27maIoWD9eB2tNe8wCGwzE89hwoA\nsNSng7ZkekNQGSPDVU6Pvnjt63arv4igCTm7T9p5YYOST7vb69IT2k/nrZ6sQsY=\n=ft+U\n-----END PGP SIGNATURE-----\n", "payload": "tree 95d9d6fb1d488d5ade07ddc4eeb20ab25d2f4fb0\nparent 32d70241003247d77c3d48541fb5331873c6f931\nparent 031206bc1d16edcc963a1d0987ad37448a4cc019\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1677630116 +0100\ncommitter GitHub <noreply@github.com> 1677630116 +0100\n\nRollup merge of #108496 - nx2k3:issue-108495-dec, r=WaffleLapkin\n\nfix #108495, postfix decrement and prefix decrement has no warning\n\nFixes #108495\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "html_url": "https://github.com/rust-lang/rust/commit/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32d70241003247d77c3d48541fb5331873c6f931", "url": "https://api.github.com/repos/rust-lang/rust/commits/32d70241003247d77c3d48541fb5331873c6f931", "html_url": "https://github.com/rust-lang/rust/commit/32d70241003247d77c3d48541fb5331873c6f931"}, {"sha": "031206bc1d16edcc963a1d0987ad37448a4cc019", "url": "https://api.github.com/repos/rust-lang/rust/commits/031206bc1d16edcc963a1d0987ad37448a4cc019", "html_url": "https://github.com/rust-lang/rust/commit/031206bc1d16edcc963a1d0987ad37448a4cc019"}], "stats": {"total": 136, "additions": 134, "deletions": 2}, "files": [{"sha": "33218d3397a1c5650d18af8f5d71d5cba2e3c4da", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "patch": "@@ -165,8 +165,6 @@ enum IsStandalone {\n #[derive(Debug, Copy, Clone, PartialEq, Eq)]\n enum IncOrDec {\n     Inc,\n-    // FIXME: `i--` recovery isn't implemented yet\n-    #[allow(dead_code)]\n     Dec,\n }\n \n@@ -1357,6 +1355,20 @@ impl<'a> Parser<'a> {\n         self.recover_from_inc_dec(operand_expr, kind, op_span)\n     }\n \n+    pub(super) fn recover_from_postfix_decrement(\n+        &mut self,\n+        operand_expr: P<Expr>,\n+        op_span: Span,\n+        start_stmt: bool,\n+    ) -> PResult<'a, P<Expr>> {\n+        let kind = IncDecRecovery {\n+            standalone: if start_stmt { IsStandalone::Standalone } else { IsStandalone::Subexpr },\n+            op: IncOrDec::Dec,\n+            fixity: UnaryFixity::Post,\n+        };\n+        self.recover_from_inc_dec(operand_expr, kind, op_span)\n+    }\n+\n     fn recover_from_inc_dec(\n         &mut self,\n         base: P<Expr>,"}, {"sha": "24d4c17f5d8ab42a52fd1c42d20e627c83f8b2ce", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "patch": "@@ -282,6 +282,18 @@ impl<'a> Parser<'a> {\n                 continue;\n             }\n \n+            if self.prev_token == token::BinOp(token::Minus)\n+                && self.token == token::BinOp(token::Minus)\n+                && self.prev_token.span.between(self.token.span).is_empty()\n+                && !self.look_ahead(1, |tok| tok.can_begin_expr())\n+            {\n+                let op_span = self.prev_token.span.to(self.token.span);\n+                // Eat the second `-`\n+                self.bump();\n+                lhs = self.recover_from_postfix_decrement(lhs, op_span, starts_stmt)?;\n+                continue;\n+            }\n+\n             let op = op.node;\n             // Special cases:\n             if op == AssocOp::As {"}, {"sha": "e0816f84e5c1523924602cf02997898018ded0e5", "filename": "tests/ui/parser/issue-108495-dec.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/tests%2Fui%2Fparser%2Fissue-108495-dec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/tests%2Fui%2Fparser%2Fissue-108495-dec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-108495-dec.rs?ref=1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "patch": "@@ -0,0 +1,39 @@\n+fn test0() {\n+    let mut i = 0;\n+    let _ = i + i--; //~ ERROR Rust has no postfix decrement operator\n+    // won't suggest since we can not handle the precedences\n+}\n+\n+fn test1() {\n+    let mut i = 0;\n+    let _ = i-- + i--; //~ ERROR Rust has no postfix decrement operator\n+}\n+\n+fn test2() {\n+    let mut i = 0;\n+    let _ = --i + i--; //~ ERROR Rust has no postfix decrement operator\n+}\n+\n+fn test3() {\n+    let mut i = 0;\n+    let _ = i-- + --i; //~ ERROR Rust has no postfix decrement operator\n+}\n+\n+fn test4() {\n+    let mut i = 0;\n+    let _ = (1 + 2 + i)--; //~ ERROR Rust has no postfix decrement operator\n+}\n+\n+fn test5() {\n+    let mut i = 0;\n+    let _ = (i-- + 1) + 2; //~ ERROR Rust has no postfix decrement operator\n+}\n+\n+fn test6(){\n+    let i=10;\n+    while i != 0 {\n+        i--; //~ ERROR Rust has no postfix decrement operator\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "85b29038f7c78d47c2caf19663cfba5dc1652260", "filename": "tests/ui/parser/issue-108495-dec.stderr", "status": "added", "additions": 69, "deletions": 0, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissue-108495-dec.stderr?ref=1c3cc8bba5d12ef3d21fee46c0b02e7390b381a4", "patch": "@@ -0,0 +1,69 @@\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:3:18\n+   |\n+LL |     let _ = i + i--;\n+   |                  ^^ not a valid postfix operator\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:9:14\n+   |\n+LL |     let _ = i-- + i--;\n+   |              ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |     let _ = { let tmp = i; i -= 1; tmp } + i--;\n+   |             +++++++++++  ~~~~~~~~~~~~~~~\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:14:20\n+   |\n+LL |     let _ = --i + i--;\n+   |                    ^^ not a valid postfix operator\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:19:14\n+   |\n+LL |     let _ = i-- + --i;\n+   |              ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |     let _ = { let tmp = i; i -= 1; tmp } + --i;\n+   |             +++++++++++  ~~~~~~~~~~~~~~~\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:24:24\n+   |\n+LL |     let _ = (1 + 2 + i)--;\n+   |                        ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |     let _ = { let tmp = (1 + 2 + i); (1 + 2 + i) -= 1; tmp };\n+   |             +++++++++++            ~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:29:15\n+   |\n+LL |     let _ = (i-- + 1) + 2;\n+   |               ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |     let _ = ({ let tmp = i; i -= 1; tmp } + 1) + 2;\n+   |              +++++++++++  ~~~~~~~~~~~~~~~\n+\n+error: Rust has no postfix decrement operator\n+  --> $DIR/issue-108495-dec.rs:35:10\n+   |\n+LL |         i--;\n+   |          ^^ not a valid postfix operator\n+   |\n+help: use `-= 1` instead\n+   |\n+LL |         i -= 1;\n+   |           ~~~~\n+\n+error: aborting due to 7 previous errors\n+"}]}