{"sha": "3585321d1ed7665cf2c0d828ff0073844d27d831", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1ODUzMjFkMWVkNzY2NWNmMmMwZDgyOGZmMDA3Mzg0NGQyN2Q4MzE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-10T10:06:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-10T10:06:05Z"}, "message": "Auto merge of #33337 - birkenfeld:issue-27842, r=jseyfried\n\ntypeck: show a note about tuple indexing for erroneous tup[i]\n\nFixes: #27842", "tree": {"sha": "7007455bb3af0c71b8d979750125fddc6662d4f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7007455bb3af0c71b8d979750125fddc6662d4f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3585321d1ed7665cf2c0d828ff0073844d27d831", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3585321d1ed7665cf2c0d828ff0073844d27d831", "html_url": "https://github.com/rust-lang/rust/commit/3585321d1ed7665cf2c0d828ff0073844d27d831", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3585321d1ed7665cf2c0d828ff0073844d27d831/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1939b76903eb8a4aa02dadc52353541637e3b98c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1939b76903eb8a4aa02dadc52353541637e3b98c", "html_url": "https://github.com/rust-lang/rust/commit/1939b76903eb8a4aa02dadc52353541637e3b98c"}, {"sha": "b48b509d89318bdbe85c6ffb37db63b1eca95c78", "url": "https://api.github.com/repos/rust-lang/rust/commits/b48b509d89318bdbe85c6ffb37db63b1eca95c78", "html_url": "https://github.com/rust-lang/rust/commit/b48b509d89318bdbe85c6ffb37db63b1eca95c78"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "253003ee5551c5777040b8a8c852e4f4aaffd49d", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/3585321d1ed7665cf2c0d828ff0073844d27d831/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3585321d1ed7665cf2c0d828ff0073844d27d831/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=3585321d1ed7665cf2c0d828ff0073844d27d831", "patch": "@@ -3691,14 +3691,37 @@ fn check_expr_with_expectation_and_lvalue_pref<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n                   }\n                   None => {\n                       check_expr_has_type(fcx, &idx, fcx.tcx().types.err);\n-                      fcx.type_error_message(\n+                      let mut err = fcx.type_error_struct(\n                           expr.span,\n                           |actual| {\n                               format!(\"cannot index a value of type `{}`\",\n                                       actual)\n                           },\n                           base_t,\n                           None);\n+                      // Try to give some advice about indexing tuples.\n+                      if let ty::TyTuple(_) = base_t.sty {\n+                          let mut needs_note = true;\n+                          // If the index is an integer, we can show the actual\n+                          // fixed expression:\n+                          if let hir::ExprLit(ref lit) = idx.node {\n+                              if let ast::LitKind::Int(i, ast::LitIntType::Unsuffixed) = lit.node {\n+                                  let snip = fcx.tcx().sess.codemap().span_to_snippet(base.span);\n+                                  if let Ok(snip) = snip {\n+                                      err.span_suggestion(expr.span,\n+                                                          \"to access tuple elements, use tuple \\\n+                                                           indexing syntax as shown\",\n+                                                          format!(\"{}.{}\", snip, i));\n+                                      needs_note = false;\n+                                  }\n+                              }\n+                          }\n+                          if needs_note {\n+                              err.help(\"to access tuple elements, use tuple indexing \\\n+                                        syntax (e.g. `tuple.0`)\");\n+                          }\n+                      }\n+                      err.emit();\n                       fcx.write_ty(id, fcx.tcx().types.err);\n                   }\n               }"}, {"sha": "28050a2ee9083c9f53dd77ceff59ffb8fd46a69f", "filename": "src/test/compile-fail/issue-27842.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3585321d1ed7665cf2c0d828ff0073844d27d831/src%2Ftest%2Fcompile-fail%2Fissue-27842.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3585321d1ed7665cf2c0d828ff0073844d27d831/src%2Ftest%2Fcompile-fail%2Fissue-27842.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-27842.rs?ref=3585321d1ed7665cf2c0d828ff0073844d27d831", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let tup = (0, 1, 2);\n+    // the case where we show a suggestion\n+    let _ = tup[0];\n+    //~^ ERROR cannot index a value of type\n+    //~| HELP to access tuple elements, use tuple indexing syntax as shown\n+    //~| SUGGESTION let _ = tup.0\n+\n+    // the case where we show just a general hint\n+    let i = 0_usize;\n+    let _ = tup[i];\n+    //~^ ERROR cannot index a value of type\n+    //~| HELP to access tuple elements, use tuple indexing syntax (e.g. `tuple.0`)\n+}"}]}