{"sha": "aa40487a8402b627fd11b6d503bafc33f9e97da5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhNDA0ODdhODQwMmI2MjdmZDExYjZkNTAzYmFmYzMzZjllOTdkYTU=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-06-26T01:41:56Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-06-29T01:46:57Z"}, "message": "Stabilize `cargo clippy --fix`\n\nThis has been unstable since it was first introduced in\nhttps://github.com/rust-lang/rust-clippy/pull/5363. In that time, I have\nbeen using it successfully in nightly without issues. I don't think\nthere are any blocking issues now that RUSTC_WORKSPACE_WRAPPER is\nstabilized, so this can be stabilized.", "tree": {"sha": "79315310a9c56136ffa657461ed78765764eea54", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79315310a9c56136ffa657461ed78765764eea54"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa40487a8402b627fd11b6d503bafc33f9e97da5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa40487a8402b627fd11b6d503bafc33f9e97da5", "html_url": "https://github.com/rust-lang/rust/commit/aa40487a8402b627fd11b6d503bafc33f9e97da5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa40487a8402b627fd11b6d503bafc33f9e97da5/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d427b624f15a5c782c97021c3717451d86b8576", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d427b624f15a5c782c97021c3717451d86b8576", "html_url": "https://github.com/rust-lang/rust/commit/8d427b624f15a5c782c97021c3717451d86b8576"}], "stats": {"total": 46, "additions": 10, "deletions": 36}, "files": [{"sha": "d856c55a41a4b8768b246009e43785a0b21ef6ca", "filename": ".github/workflows/clippy.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/.github%2Fworkflows%2Fclippy.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/.github%2Fworkflows%2Fclippy.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fclippy.yml?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -71,7 +71,7 @@ jobs:\n       working-directory: clippy_workspace_tests\n \n     - name: Test cargo-clippy --fix\n-      run: ../target/debug/cargo-clippy clippy --fix -Zunstable-options\n+      run: ../target/debug/cargo-clippy clippy --fix\n       working-directory: clippy_workspace_tests\n \n     - name: Test clippy-driver"}, {"sha": "146b6fccd0c76e94962ca9260732ce849a535ee0", "filename": ".github/workflows/clippy_bors.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/.github%2Fworkflows%2Fclippy_bors.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/.github%2Fworkflows%2Fclippy_bors.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fclippy_bors.yml?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -134,7 +134,7 @@ jobs:\n       working-directory: clippy_workspace_tests\n \n     - name: Test cargo-clippy --fix\n-      run: ../target/debug/cargo-clippy clippy --fix -Zunstable-options\n+      run: ../target/debug/cargo-clippy clippy --fix\n       working-directory: clippy_workspace_tests\n \n     - name: Test clippy-driver"}, {"sha": "53056081325e91b3c9abc3c17a6c72f2a505de0e", "filename": "README.md", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -75,11 +75,10 @@ cargo clippy\n \n #### Automatically applying Clippy suggestions\n \n-Clippy can automatically apply some lint suggestions.\n-Note that this is still experimental and only supported on the nightly channel:\n+Clippy can automatically apply some lint suggestions, just like the compiler.\n \n ```terminal\n-cargo clippy --fix -Z unstable-options\n+cargo clippy --fix\n ```\n \n #### Workspaces"}, {"sha": "07c3ec04506733feac493779fb47a91852d4178f", "filename": "lintcheck/README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/lintcheck%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/lintcheck%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/lintcheck%2FREADME.md?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -69,7 +69,7 @@ is checked.\n is explicitly specified in the options.\n \n ### Fix mode\n-You can run `./lintcheck/target/debug/lintcheck --fix` which will run Clippy with `-Zunstable-options --fix` and\n+You can run `./lintcheck/target/debug/lintcheck --fix` which will run Clippy with `--fix` and\n print a warning if Clippys suggestions fail to apply (if the resulting code does not build).  \n This lets us spot bad suggestions or false positives automatically in some cases.  \n "}, {"sha": "7d2f3173fb0e7cd4d5d475decac18787b14f60b0", "filename": "lintcheck/src/main.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/lintcheck%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/lintcheck%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/lintcheck%2Fsrc%2Fmain.rs?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -260,14 +260,7 @@ impl Crate {\n         let shared_target_dir = clippy_project_root().join(\"target/lintcheck/shared_target_dir\");\n \n         let mut args = if fix {\n-            vec![\n-                \"-Zunstable-options\",\n-                \"--fix\",\n-                \"-Zunstable-options\",\n-                \"--allow-no-vcs\",\n-                \"--\",\n-                \"--cap-lints=warn\",\n-            ]\n+            vec![\"--fix\", \"--allow-no-vcs\", \"--\", \"--cap-lints=warn\"]\n         } else {\n             vec![\"--\", \"--message-format=json\", \"--\", \"--cap-lints=warn\"]\n         };"}, {"sha": "6bd4123ddeb45d92917f1dd043fa9d09ecf208de", "filename": "src/main.rs", "status": "modified", "additions": 4, "deletions": 22, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/aa40487a8402b627fd11b6d503bafc33f9e97da5/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa40487a8402b627fd11b6d503bafc33f9e97da5/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=aa40487a8402b627fd11b6d503bafc33f9e97da5", "patch": "@@ -70,7 +70,6 @@ impl ClippyCmd {\n         I: Iterator<Item = String>,\n     {\n         let mut cargo_subcommand = \"check\";\n-        let mut unstable_options = false;\n         let mut args = vec![];\n \n         for arg in old_args.by_ref() {\n@@ -80,18 +79,12 @@ impl ClippyCmd {\n                     continue;\n                 },\n                 \"--\" => break,\n-                // Cover -Zunstable-options and -Z unstable-options\n-                s if s.ends_with(\"unstable-options\") => unstable_options = true,\n                 _ => {},\n             }\n \n             args.push(arg);\n         }\n \n-        if cargo_subcommand == \"fix\" && !unstable_options {\n-            panic!(\"Usage of `--fix` requires `-Z unstable-options`\");\n-        }\n-\n         let mut clippy_args: Vec<String> = old_args.collect();\n         if cargo_subcommand == \"fix\" && !clippy_args.iter().any(|arg| arg == \"--no-deps\") {\n             clippy_args.push(\"--no-deps\".into());\n@@ -176,34 +169,23 @@ mod tests {\n     use super::ClippyCmd;\n \n     #[test]\n-    #[should_panic]\n-    fn fix_without_unstable() {\n+    fn fix() {\n         let args = \"cargo clippy --fix\".split_whitespace().map(ToString::to_string);\n-        ClippyCmd::new(args);\n-    }\n-\n-    #[test]\n-    fn fix_unstable() {\n-        let args = \"cargo clippy --fix -Zunstable-options\"\n-            .split_whitespace()\n-            .map(ToString::to_string);\n         let cmd = ClippyCmd::new(args);\n         assert_eq!(\"fix\", cmd.cargo_subcommand);\n-        assert!(cmd.args.iter().any(|arg| arg.ends_with(\"unstable-options\")));\n+        assert!(!cmd.args.iter().any(|arg| arg.ends_with(\"unstable-options\")));\n     }\n \n     #[test]\n     fn fix_implies_no_deps() {\n-        let args = \"cargo clippy --fix -Zunstable-options\"\n-            .split_whitespace()\n-            .map(ToString::to_string);\n+        let args = \"cargo clippy --fix\".split_whitespace().map(ToString::to_string);\n         let cmd = ClippyCmd::new(args);\n         assert!(cmd.clippy_args.iter().any(|arg| arg == \"--no-deps\"));\n     }\n \n     #[test]\n     fn no_deps_not_duplicated_with_fix() {\n-        let args = \"cargo clippy --fix -Zunstable-options -- --no-deps\"\n+        let args = \"cargo clippy --fix -- --no-deps\"\n             .split_whitespace()\n             .map(ToString::to_string);\n         let cmd = ClippyCmd::new(args);"}]}