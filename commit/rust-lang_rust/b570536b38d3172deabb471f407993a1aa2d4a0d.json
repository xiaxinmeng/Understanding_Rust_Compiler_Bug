{"sha": "b570536b38d3172deabb471f407993a1aa2d4a0d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1NzA1MzZiMzhkMzE3MmRlYWJiNDcxZjQwNzk5M2ExYWEyZDRhMGQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-01T02:34:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-01T02:34:41Z"}, "message": "auto merge of #6729 : bstrie/rust/ascstr, r=Aatch\n\nFormerly this was a free function rather than a method. I've left it in place for now, although redefined it so that it just calls the method.", "tree": {"sha": "a10b233cc6690c0c7f9331b2d7fd2d8175da876f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a10b233cc6690c0c7f9331b2d7fd2d8175da876f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b570536b38d3172deabb471f407993a1aa2d4a0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b570536b38d3172deabb471f407993a1aa2d4a0d", "html_url": "https://github.com/rust-lang/rust/commit/b570536b38d3172deabb471f407993a1aa2d4a0d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b570536b38d3172deabb471f407993a1aa2d4a0d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e516d2333fa38ce29f1e6e119beb4d5711cf8fd5", "url": "https://api.github.com/repos/rust-lang/rust/commits/e516d2333fa38ce29f1e6e119beb4d5711cf8fd5", "html_url": "https://github.com/rust-lang/rust/commit/e516d2333fa38ce29f1e6e119beb4d5711cf8fd5"}, {"sha": "c77d58fad8b484abdc0140d5adb27c738d46f261", "url": "https://api.github.com/repos/rust-lang/rust/commits/c77d58fad8b484abdc0140d5adb27c738d46f261", "html_url": "https://github.com/rust-lang/rust/commit/c77d58fad8b484abdc0140d5adb27c738d46f261"}], "stats": {"total": 63, "additions": 40, "deletions": 23}, "files": [{"sha": "5a5efa0781ae9abf7e858e850513ee3c6e732988", "filename": "src/libstd/prelude.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b570536b38d3172deabb471f407993a1aa2d4a0d/src%2Flibstd%2Fprelude.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b570536b38d3172deabb471f407993a1aa2d4a0d/src%2Flibstd%2Fprelude.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprelude.rs?ref=b570536b38d3172deabb471f407993a1aa2d4a0d", "patch": "@@ -45,7 +45,7 @@ pub use path::PosixPath;\n pub use path::WindowsPath;\n pub use ptr::Ptr;\n pub use ascii::{Ascii, AsciiCast, OwnedAsciiCast, AsciiStr};\n-pub use str::{StrSlice, OwnedStr};\n+pub use str::{StrSlice, OwnedStr, StrUtil};\n pub use from_str::{FromStr};\n pub use to_bytes::IterBytes;\n pub use to_str::{ToStr, ToStrConsume};"}, {"sha": "c9452ed543364418a41fe3b4dd65dca48fd48cc8", "filename": "src/libstd/str.rs", "status": "modified", "additions": 39, "deletions": 22, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/b570536b38d3172deabb471f407993a1aa2d4a0d/src%2Flibstd%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b570536b38d3172deabb471f407993a1aa2d4a0d/src%2Flibstd%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstr.rs?ref=b570536b38d3172deabb471f407993a1aa2d4a0d", "patch": "@@ -2165,33 +2165,50 @@ pub fn as_bytes_slice<'a>(s: &'a str) -> &'a [u8] {\n }\n \n /**\n- * Work with the byte buffer of a string as a null-terminated C string.\n- *\n- * Allows for unsafe manipulation of strings, which is useful for foreign\n- * interop. This is similar to `str::as_buf`, but guarantees null-termination.\n- * If the given slice is not already null-terminated, this function will\n- * allocate a temporary, copy the slice, null terminate it, and pass\n- * that instead.\n- *\n- * # Example\n- *\n- * ~~~ {.rust}\n- * let s = str::as_c_str(\"PATH\", { |path| libc::getenv(path) });\n- * ~~~\n+ * A dummy trait to hold all the utility methods that we implement on strings.\n  */\n-#[inline]\n-pub fn as_c_str<T>(s: &str, f: &fn(*libc::c_char) -> T) -> T {\n-    do as_buf(s) |buf, len| {\n-        // NB: len includes the trailing null.\n-        assert!(len > 0);\n-        if unsafe { *(ptr::offset(buf,len-1)) != 0 } {\n-            as_c_str(to_owned(s), f)\n-        } else {\n-            f(buf as *libc::c_char)\n+pub trait StrUtil {\n+    /**\n+     * Work with the byte buffer of a string as a null-terminated C string.\n+     *\n+     * Allows for unsafe manipulation of strings, which is useful for foreign\n+     * interop. This is similar to `str::as_buf`, but guarantees null-termination.\n+     * If the given slice is not already null-terminated, this function will\n+     * allocate a temporary, copy the slice, null terminate it, and pass\n+     * that instead.\n+     *\n+     * # Example\n+     *\n+     * ~~~ {.rust}\n+     * let s = \"PATH\".as_c_str(|path| libc::getenv(path));\n+     * ~~~\n+     */\n+    fn as_c_str<T>(self, f: &fn(*libc::c_char) -> T) -> T;\n+}\n+\n+impl<'self> StrUtil for &'self str {\n+    #[inline]\n+    fn as_c_str<T>(self, f: &fn(*libc::c_char) -> T) -> T {\n+        do as_buf(self) |buf, len| {\n+            // NB: len includes the trailing null.\n+            assert!(len > 0);\n+            if unsafe { *(ptr::offset(buf,len-1)) != 0 } {\n+                to_owned(self).as_c_str(f)\n+            } else {\n+                f(buf as *libc::c_char)\n+            }\n         }\n     }\n }\n \n+/**\n+ * Deprecated. Use the `as_c_str` method on strings instead.\n+ */\n+#[inline(always)]\n+pub fn as_c_str<T>(s: &str, f: &fn(*libc::c_char) -> T) -> T {\n+    s.as_c_str(f)\n+}\n+\n /**\n  * Work with the byte buffer and length of a slice.\n  *"}]}