{"sha": "b626202087dff72216c14e08e11d936136dc2126", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2MjYyMDIwODdkZmY3MjIxNmMxNGUwOGUxMWQ5MzYxMzZkYzIxMjY=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-01-25T02:03:09Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-01-25T02:03:09Z"}, "message": "Do not ICE on multipart suggestions touching multiple files\n\nWhen encountering a multipart suggestion with spans belonging to\ndifferent contexts, skip that suggestion.", "tree": {"sha": "87ee0f5c50d07ee72ced10adf58c5652c79f0857", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87ee0f5c50d07ee72ced10adf58c5652c79f0857"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b626202087dff72216c14e08e11d936136dc2126", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b626202087dff72216c14e08e11d936136dc2126", "html_url": "https://github.com/rust-lang/rust/commit/b626202087dff72216c14e08e11d936136dc2126", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b626202087dff72216c14e08e11d936136dc2126/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2d141df59703393c0c683abc259f9a8c3be041a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c2d141df59703393c0c683abc259f9a8c3be041a", "html_url": "https://github.com/rust-lang/rust/commit/c2d141df59703393c0c683abc259f9a8c3be041a"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "17b293401f89ef1e60813c7f1fff74dc457f93e0", "filename": "src/librustc_errors/lib.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b626202087dff72216c14e08e11d936136dc2126/src%2Flibrustc_errors%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b626202087dff72216c14e08e11d936136dc2126/src%2Flibrustc_errors%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Flib.rs?ref=b626202087dff72216c14e08e11d936136dc2126", "patch": "@@ -185,16 +185,17 @@ impl CodeSuggestion {\n                 !invalid\n             })\n             .cloned()\n-            .map(|mut substitution| {\n+            .filter_map(|mut substitution| {\n                 // Assumption: all spans are in the same file, and all spans\n                 // are disjoint. Sort in ascending order.\n                 substitution.parts.sort_by_key(|part| part.span.lo());\n \n                 // Find the bounding span.\n-                let lo = substitution.parts.iter().map(|part| part.span.lo()).min().unwrap();\n-                let hi = substitution.parts.iter().map(|part| part.span.hi()).max().unwrap();\n+                let lo = substitution.parts.iter().map(|part| part.span.lo()).min()?;\n+                let hi = substitution.parts.iter().map(|part| part.span.hi()).max()?;\n                 let bounding_span = Span::with_root_ctxt(lo, hi);\n-                let lines = cm.span_to_lines(bounding_span).unwrap();\n+                // The different spans might belong to different contexts, if so ignore suggestion.\n+                let lines = cm.span_to_lines(bounding_span).ok()?;\n                 assert!(!lines.lines.is_empty());\n \n                 // To build up the result, we do this for each span:\n@@ -244,7 +245,7 @@ impl CodeSuggestion {\n                 while buf.ends_with('\\n') {\n                     buf.pop();\n                 }\n-                (buf, substitution.parts, only_capitalization)\n+                Some((buf, substitution.parts, only_capitalization))\n             })\n             .collect()\n     }"}, {"sha": "a316d8f1698ac4d151e4f5904412ac0077270435", "filename": "src/test/ui/consts/miri_unleashed/mutable_const2.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b626202087dff72216c14e08e11d936136dc2126/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b626202087dff72216c14e08e11d936136dc2126/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const2.stderr?ref=b626202087dff72216c14e08e11d936136dc2126", "patch": "@@ -10,7 +10,7 @@ error: internal compiler error: mutable allocation in constant\n LL | const MUTABLE_BEHIND_RAW: *mut i32 = &UnsafeCell::new(42) as *const _ as *mut _;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-thread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:356:17\n+thread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:357:17\n note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n \n error: internal compiler error: unexpected panic"}]}