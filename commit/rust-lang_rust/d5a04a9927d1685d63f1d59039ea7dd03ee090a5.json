{"sha": "d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ1YTA0YTk5MjdkMTY4NWQ2M2YxZDU5MDM5ZWE3ZGQwM2VlMDkwYTU=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-08-21T22:28:47Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-09-10T21:33:06Z"}, "message": "Collect tokens when handling `:literal` matcher\n\nAn `NtLiteral` just wraps an `Expr`, so we don't need to add a new `tokens`\nfield to an AST struct.", "tree": {"sha": "da8065d7902f5574fdb42636439ce4101ff87ea1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da8065d7902f5574fdb42636439ce4101ff87ea1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl9am5IACgkQtAh+UQ6Y\nsWQIlg//fK6bsm9zOsFX07KapPESYdvKvy9MinP4e/U0pnfcHVzLJbycUE87lxkh\nP750iH1YONdLSw7UoCG7yItGRX6MSpSC1zKI7moE6zsM0j/kXCeXn9ny8QSjxUd3\noBOVROFykisIABxu6qNR7jezgYRyTL1uNO4FzW+EeKSjKltAuT29uwdn/5OfthCJ\nYbLb9lvyn0YgmLql/3IX+aMrGFUJpzWgVLD3IATutk4LvFETdtj+eVAtceJPoclQ\nGwxmIAP0KXd1l3rxjehosUwInpDa7eT6zWpyA1LUWMzIRJ3dbYwiI5XfDUG/C4qH\nTYIs2geZgmRfNegHElOahBarOngQ9Bra0oM47Rfkauk3Lv6WwF/OHVFrhGgUb240\nEbr2ZKnbtTMPa/l5eVlcmuwAp20UYu0h7NBl30JLq+YoJX84JpE9Huugz6gWp65D\n+d6IgjKByaOsOPUu2l5AWo353GmxwdrvKzqTACN3nVuJZ25otAIEwCQ4sKa3aU1K\nxHlg7jOyg3Up7M+FoiBO1w8ot14Z/nwqFb+XEm/rPpaKmfkPiIgsnf8LgxK/GiqM\nIv7UClRxRrmtHxLVec4FEdzdU5ni88kuJMEkxrupoe2l4dz4oRxTU+k6N9XbIo8S\nquwuw2uKnkcKJrjLoUd3uvb2sMlosPyfEmUgDqnLHXH6KZBkaD4=\n=xRpx\n-----END PGP SIGNATURE-----", "payload": "tree da8065d7902f5574fdb42636439ce4101ff87ea1\nparent 1823dea7df9e125022dfda8126b6713f142f0e73\nauthor Aaron Hill <aa1ronham@gmail.com> 1598048927 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1599773586 -0400\n\nCollect tokens when handling `:literal` matcher\n\nAn `NtLiteral` just wraps an `Expr`, so we don't need to add a new `tokens`\nfield to an AST struct.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "html_url": "https://github.com/rust-lang/rust/commit/d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d5a04a9927d1685d63f1d59039ea7dd03ee090a5/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1823dea7df9e125022dfda8126b6713f142f0e73", "url": "https://api.github.com/repos/rust-lang/rust/commits/1823dea7df9e125022dfda8126b6713f142f0e73", "html_url": "https://github.com/rust-lang/rust/commit/1823dea7df9e125022dfda8126b6713f142f0e73"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "df9b87fe7d13e9c58728ad33eacc7d0cbc365427", "filename": "compiler/rustc_parse/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d5a04a9927d1685d63f1d59039ea7dd03ee090a5/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5a04a9927d1685d63f1d59039ea7dd03ee090a5/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flib.rs?ref=d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "patch": "@@ -278,7 +278,7 @@ pub fn nt_to_tokenstream(nt: &Nonterminal, sess: &ParseSess, span: Span) -> Toke\n             Some(tokenstream::TokenTree::token(token::Lifetime(ident.name), ident.span).into())\n         }\n         Nonterminal::NtTT(ref tt) => Some(tt.clone().into()),\n-        Nonterminal::NtExpr(ref expr) => {\n+        Nonterminal::NtExpr(ref expr) | Nonterminal::NtLiteral(ref expr) => {\n             if expr.tokens.is_none() {\n                 debug!(\"missing tokens for expr {:?}\", expr);\n             }"}, {"sha": "516c2c7721375d950182cee465773349e6541586", "filename": "compiler/rustc_parse/src/parser/nonterminal.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d5a04a9927d1685d63f1d59039ea7dd03ee090a5/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5a04a9927d1685d63f1d59039ea7dd03ee090a5/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs?ref=d5a04a9927d1685d63f1d59039ea7dd03ee090a5", "patch": "@@ -140,7 +140,15 @@ impl<'a> Parser<'a> {\n                 }\n                 token::NtExpr(expr)\n             }\n-            NonterminalKind::Literal => token::NtLiteral(self.parse_literal_maybe_minus()?),\n+            NonterminalKind::Literal => {\n+                let (mut lit, tokens) =\n+                    self.collect_tokens(|this| this.parse_literal_maybe_minus())?;\n+                // We have have eaten a nonterminal, which  could already have tokens\n+                if lit.tokens.is_none() {\n+                    lit.tokens = Some(tokens);\n+                }\n+                token::NtLiteral(lit)\n+            }\n             NonterminalKind::Ty => {\n                 let (mut ty, tokens) = self.collect_tokens(|this| this.parse_ty())?;\n                 // We have an eaten an NtTy, which could already have tokens"}]}