{"sha": "51c50dd5acd34fac006406a6fc24f51a624e208e", "node_id": "C_kwDOAAsO6NoAKDUxYzUwZGQ1YWNkMzRmYWMwMDY0MDZhNmZjMjRmNTFhNjI0ZTIwOGU", "commit": {"author": {"name": "Jeroen Vannevel", "email": "jer_vannevel@outlook.com", "date": "2022-02-01T00:36:50Z"}, "committer": {"name": "Jeroen Vannevel", "email": "jer_vannevel@outlook.com", "date": "2022-02-01T00:36:50Z"}, "message": "don't tear body", "tree": {"sha": "d27cfe4badb3f07750b96092f0ac8751b378d369", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d27cfe4badb3f07750b96092f0ac8751b378d369"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51c50dd5acd34fac006406a6fc24f51a624e208e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEEzoFOOQgvfPzrDpfeO9fUvOMSb0FAmH4gKIACgkQeO9fUvOM\nSb0WrgwAhJuFttNd5uT80R1aGSUQoynZw4k1fZjJbAAf+mMH88JSUXFikbF4nVLE\nkdWRfTGdIsGKKCX9qLXrCqU4aSlABowGvJ12ju3EorOQe6ycp5GCS+bhYb1+p6EI\nxLLfmuM/pgZ6FjrRaJtP8VfPsvSqru2K7XpWT04aiwvyA7oZLdkzOIYfT4zHb8Yx\ncQtelFtoEoscQz/Gp4Hc3mqrNCT6bGplASEjdlmBBYAwhE4jwC4LlK6lhWIXkB4C\n1jHwBcxe6qRnJiQdMdLw7dgFWUpsXVO5AxQnMuT+EhfRkxv9skjHHKSsTc/mROf4\nTQ7W4dsNIb0f2NrZpaJSBvdkd48D/AZBDlR0u+zs8sgglECNWtWa1b0p2S+SKBah\nXA/f+X8DSKwq0TLhJk2sxTmG3AaFYyAhb7mglY2vX+7WRA76Ipsarweg303H1yMU\nGeSOedVNtb81XdU/3PRSt9C5kV3A5g9zPz1PzEaew9TXxthS3wGP3V2l4wOSNNqr\nX4pbs/SK\n=LiCu\n-----END PGP SIGNATURE-----", "payload": "tree d27cfe4badb3f07750b96092f0ac8751b378d369\nparent e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e\nauthor Jeroen Vannevel <jer_vannevel@outlook.com> 1643675810 +0000\ncommitter Jeroen Vannevel <jer_vannevel@outlook.com> 1643675810 +0000\n\ndon't tear body\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51c50dd5acd34fac006406a6fc24f51a624e208e", "html_url": "https://github.com/rust-lang/rust/commit/51c50dd5acd34fac006406a6fc24f51a624e208e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51c50dd5acd34fac006406a6fc24f51a624e208e/comments", "author": {"login": "Vannevelj", "id": 2777107, "node_id": "MDQ6VXNlcjI3NzcxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2777107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vannevelj", "html_url": "https://github.com/Vannevelj", "followers_url": "https://api.github.com/users/Vannevelj/followers", "following_url": "https://api.github.com/users/Vannevelj/following{/other_user}", "gists_url": "https://api.github.com/users/Vannevelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vannevelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vannevelj/subscriptions", "organizations_url": "https://api.github.com/users/Vannevelj/orgs", "repos_url": "https://api.github.com/users/Vannevelj/repos", "events_url": "https://api.github.com/users/Vannevelj/events{/privacy}", "received_events_url": "https://api.github.com/users/Vannevelj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Vannevelj", "id": 2777107, "node_id": "MDQ6VXNlcjI3NzcxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2777107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vannevelj", "html_url": "https://github.com/Vannevelj", "followers_url": "https://api.github.com/users/Vannevelj/followers", "following_url": "https://api.github.com/users/Vannevelj/following{/other_user}", "gists_url": "https://api.github.com/users/Vannevelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vannevelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vannevelj/subscriptions", "organizations_url": "https://api.github.com/users/Vannevelj/orgs", "repos_url": "https://api.github.com/users/Vannevelj/repos", "events_url": "https://api.github.com/users/Vannevelj/events{/privacy}", "received_events_url": "https://api.github.com/users/Vannevelj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "html_url": "https://github.com/rust-lang/rust/commit/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "afe0b221e50b1a111da997eb40fcfb22578bdeab", "filename": "crates/ide_assists/src/handlers/extract_function.rs", "status": "modified", "additions": 26, "deletions": 2, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/51c50dd5acd34fac006406a6fc24f51a624e208e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51c50dd5acd34fac006406a6fc24f51a624e208e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs?ref=51c50dd5acd34fac006406a6fc24f51a624e208e", "patch": "@@ -482,8 +482,11 @@ impl FunctionBody {\n         let full_body = parent.syntax().children_with_tokens();\n \n         let mut text_range = full_body\n-            .map(|stmt| stmt.text_range())\n-            .filter(|&stmt| selected.intersect(stmt).filter(|it| !it.is_empty()).is_some())\n+            .filter(|it| {\n+                matches!(it.kind().is_punct() || it.kind() == SyntaxKind::WHITESPACE, false)\n+            })\n+            .map(|element| element.text_range())\n+            .filter(|&range| selected.intersect(range).filter(|it| !it.is_empty()).is_some())\n             .reduce(|acc, stmt| acc.cover(stmt));\n \n         if let Some(tail_range) = parent\n@@ -4126,6 +4129,27 @@ fn $0fun_name() {\n         );\n     }\n \n+    #[test]\n+    fn extract_does_not_tear_body_apart() {\n+        check_assist(\n+            extract_function,\n+            r#\"\n+fn foo() {\n+    $0foo();\n+}$0\n+\"#,\n+            r#\"\n+fn foo() {\n+    fun_name();\n+}\n+\n+fn $0fun_name() {\n+    foo();\n+}\n+\"#,\n+        );\n+    }\n+\n     #[test]\n     fn extract_does_not_wrap_res_in_res() {\n         check_assist("}]}