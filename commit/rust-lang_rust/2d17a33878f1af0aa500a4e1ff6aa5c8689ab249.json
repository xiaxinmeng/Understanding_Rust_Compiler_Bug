{"sha": "2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkMTdhMzM4NzhmMWFmMGFhNTAwYTRlMWZmNmFhNWM4Njg5YWIyNDk=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2015-01-13T09:39:05Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2015-01-21T18:05:16Z"}, "message": "Deny imports after non-item statements.", "tree": {"sha": "bd8803292d45850145bbc28c8bd6b8f6ac403d5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd8803292d45850145bbc28c8bd6b8f6ac403d5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "html_url": "https://github.com/rust-lang/rust/commit/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e07f5a792329674f6849c1da688e36499983532", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e07f5a792329674f6849c1da688e36499983532", "html_url": "https://github.com/rust-lang/rust/commit/5e07f5a792329674f6849c1da688e36499983532"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "2602f38b3add31c2108b3f6dc08886c54aba156c", "filename": "src/librustc/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Flibrustc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Flibrustc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdiagnostics.rs?ref=2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "patch": "@@ -52,6 +52,7 @@ register_diagnostics! {\n     E0140,\n     E0152,\n     E0153,\n+    E0154,\n     E0157,\n     E0158,\n     E0161,"}, {"sha": "b70980cf1ec0c839c12d372af2861173725b5c76", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "patch": "@@ -3509,6 +3509,26 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             }\n         }\n \n+        // Check for imports appearing after non-item statements.\n+        let mut found_non_item = false;\n+        for statement in block.stmts.iter() {\n+            if let ast::StmtDecl(ref declaration, _) = statement.node {\n+                if let ast::DeclItem(ref i) = declaration.node {\n+                    match i.node {\n+                        ItemExternCrate(_) | ItemUse(_) if found_non_item => {\n+                            span_err!(self.session, i.span, E0154,\n+                                \"imports are not allowed after non-item statements\");\n+                        }\n+                        _ => {}\n+                    }\n+                } else {\n+                    found_non_item = true\n+                }\n+            } else {\n+                found_non_item = true;\n+            }\n+        }\n+\n         // Descend into the block.\n         visit::walk_block(self, block);\n "}, {"sha": "fbb0730f014617085816387c49f7e8b206eff558", "filename": "src/test/compile-fail/blind-item-block-middle.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Ftest%2Fcompile-fail%2Fblind-item-block-middle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Ftest%2Fcompile-fail%2Fblind-item-block-middle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fblind-item-block-middle.rs?ref=2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "patch": "@@ -14,4 +14,5 @@ fn main() {\n     let bar = 5;\n     //~^ ERROR declaration of `bar` shadows an enum variant or unit-like struct in scope\n     use foo::bar;\n+    //~^ ERROR imports are not allowed after non-item statements\n }"}, {"sha": "a28f5f6e557150b53d02d50c032fd00d4fe24ebc", "filename": "src/test/compile-fail/blind-item-local-shadow.rs", "status": "renamed", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Ftest%2Fcompile-fail%2Fblind-item-local-shadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d17a33878f1af0aa500a4e1ff6aa5c8689ab249/src%2Ftest%2Fcompile-fail%2Fblind-item-local-shadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fblind-item-local-shadow.rs?ref=2d17a33878f1af0aa500a4e1ff6aa5c8689ab249", "patch": "@@ -9,11 +9,12 @@\n // except according to those terms.\n \n mod bar {\n-    pub fn foo() -> uint { 42 }\n+    pub fn foo() -> bool { true }\n }\n \n fn main() {\n-    let foo = |&:| 5u;\n+    let foo = |&:| false;\n     use bar::foo;\n-    assert_eq!(foo(), 5u);\n+    //~^ ERROR imports are not allowed after non-item statements\n+    assert_eq!(foo(), false);\n }", "previous_filename": "src/test/run-pass/blind-item-local-shadow.rs"}]}