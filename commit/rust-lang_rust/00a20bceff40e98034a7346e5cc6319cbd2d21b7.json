{"sha": "00a20bceff40e98034a7346e5cc6319cbd2d21b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwYTIwYmNlZmY0MGU5ODAzNGE3MzQ2ZTVjYzYzMTljYmQyZDIxYjc=", "commit": {"author": {"name": "Ivan Komarov", "email": "Ivan.Komarov@dfyz.info", "date": "2018-10-27T01:01:37Z"}, "committer": {"name": "Ivan Komarov", "email": "Ivan.Komarov@dfyz.info", "date": "2018-10-27T23:37:55Z"}, "message": "Fix formatting failures on Windows\n\nWhen newline_style is set to Windows, an empty line inside of a macro\nresults in `\\r` being passed to the `fold()` in `MacroBranch::rewrite()`.\n\n`\\r` is technically not an empty string, so we try to indent it, leaving\ntrailing whitespaces behind, even though that was not intended\n(as far as I can see).\n\nThis commit replaces the `!l.is_empty()` check with calling\n`is_empty_line()`, since trying to indent any whitespace-only string\nwill probably result in problematic trailing whitespaces.\n\nFixes: #2810", "tree": {"sha": "45fedd13dfb41b1187ca3754aca8877c587ca44f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45fedd13dfb41b1187ca3754aca8877c587ca44f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00a20bceff40e98034a7346e5cc6319cbd2d21b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00a20bceff40e98034a7346e5cc6319cbd2d21b7", "html_url": "https://github.com/rust-lang/rust/commit/00a20bceff40e98034a7346e5cc6319cbd2d21b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00a20bceff40e98034a7346e5cc6319cbd2d21b7/comments", "author": {"login": "dfyz", "id": 42850, "node_id": "MDQ6VXNlcjQyODUw", "avatar_url": "https://avatars.githubusercontent.com/u/42850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfyz", "html_url": "https://github.com/dfyz", "followers_url": "https://api.github.com/users/dfyz/followers", "following_url": "https://api.github.com/users/dfyz/following{/other_user}", "gists_url": "https://api.github.com/users/dfyz/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfyz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfyz/subscriptions", "organizations_url": "https://api.github.com/users/dfyz/orgs", "repos_url": "https://api.github.com/users/dfyz/repos", "events_url": "https://api.github.com/users/dfyz/events{/privacy}", "received_events_url": "https://api.github.com/users/dfyz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dfyz", "id": 42850, "node_id": "MDQ6VXNlcjQyODUw", "avatar_url": "https://avatars.githubusercontent.com/u/42850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfyz", "html_url": "https://github.com/dfyz", "followers_url": "https://api.github.com/users/dfyz/followers", "following_url": "https://api.github.com/users/dfyz/following{/other_user}", "gists_url": "https://api.github.com/users/dfyz/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfyz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfyz/subscriptions", "organizations_url": "https://api.github.com/users/dfyz/orgs", "repos_url": "https://api.github.com/users/dfyz/repos", "events_url": "https://api.github.com/users/dfyz/events{/privacy}", "received_events_url": "https://api.github.com/users/dfyz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fb1b179bf26e15f8552e24a7600bf605f06c3a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fb1b179bf26e15f8552e24a7600bf605f06c3a5", "html_url": "https://github.com/rust-lang/rust/commit/8fb1b179bf26e15f8552e24a7600bf605f06c3a5"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "43f3071b70a696bb2c80cfd6af65bc08757b4b76", "filename": "src/macros.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/00a20bceff40e98034a7346e5cc6319cbd2d21b7/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00a20bceff40e98034a7346e5cc6319cbd2d21b7/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=00a20bceff40e98034a7346e5cc6319cbd2d21b7", "patch": "@@ -1347,7 +1347,7 @@ impl MacroBranch {\n             .fold(\n                 (String::new(), true),\n                 |(mut s, need_indent), (i, (kind, ref l))| {\n-                    if !l.is_empty()\n+                    if !is_empty_line(l)\n                         && need_indent\n                         && !new_body_snippet.is_line_non_formatted(i + 1)\n                     {"}, {"sha": "34140c7a1fc651164dc1c0289f0a51bfebcbdcf5", "filename": "tests/target/issue-2810.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/00a20bceff40e98034a7346e5cc6319cbd2d21b7/tests%2Ftarget%2Fissue-2810.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00a20bceff40e98034a7346e5cc6319cbd2d21b7/tests%2Ftarget%2Fissue-2810.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2810.rs?ref=00a20bceff40e98034a7346e5cc6319cbd2d21b7", "patch": "@@ -0,0 +1,14 @@\n+// rustfmt-newline_style: Windows\n+\n+#[macro_export]\n+macro_rules! hmmm___ffi_error {\n+    ($result:ident) => {\n+        pub struct $result {\n+            success: bool,\n+        }\n+\n+        impl $result {\n+            pub fn foo(self) {}\n+        }\n+    };\n+}"}]}