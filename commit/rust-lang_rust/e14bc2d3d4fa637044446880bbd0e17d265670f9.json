{"sha": "e14bc2d3d4fa637044446880bbd0e17d265670f9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxNGJjMmQzZDRmYTYzNzA0NDQ0Njg4MGJiZDBlMTdkMjY1NjcwZjk=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-24T08:02:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-24T08:02:41Z"}, "message": "Rollup merge of #50972 - nikic:no-parallel, r=michaelwoerister\n\nAdd -Z no-parallel-llvm flag\n\nCodegen issues commonly only manifest under specific circumstances,\ne.g. if multiple codegen units are used and ThinLTO is enabled.\nHowever, these configuration are threaded, making the use of LLVM\ndebugging facilities hard, as output is interleaved.\n\nThis patch adds a -Z no-parallel-llvm flag, which allows disabling\nparallelization of codegen and linking, while otherwise preserving\nbehavior with regard to codegen units and LTO.", "tree": {"sha": "286853a230674cf7aa8b80098f06223412a72774", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/286853a230674cf7aa8b80098f06223412a72774"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e14bc2d3d4fa637044446880bbd0e17d265670f9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbBnGhCRBK7hj4Ov3rIwAAdHIIAEohsw6cgqf6ROldtW74MJyW\ndU9guZYtLUkpkn1dI2kgurFh5E87I3nwrZUEGdeQuXITZSGJZ0en2xkf2LT1PjEY\nsXLBKe2+hbD4avoQIFZFoLnnIAh658aZxpK5clEZMER1Ik8vrzQp373YSkl4Caoj\n6jDGSu595B0yXvkZbmw5TiD026jOlW/QC3y98GzeJnf1a9qJuEiUU+vnMTz1+ZNi\nJyjSlsdQ4HrkTK933HEcrHSaDokf0nBXlHJ6dbuRnPvWAmCHJ6XDV1/KOBCf8aFp\nfxy/ah3gOoNf5UonKMEYP+kDT6M4c5uJ/NgKY6HfIwiPHG8pmz8NnwI7p5JbDk0=\n=86JV\n-----END PGP SIGNATURE-----\n", "payload": "tree 286853a230674cf7aa8b80098f06223412a72774\nparent eb26c9b390306592458de3731c46e9c1643d4ccf\nparent 54f0668a1084b8e64355de5b194fc2fd02fe3854\nauthor kennytm <kennytm@gmail.com> 1527148961 +0800\ncommitter GitHub <noreply@github.com> 1527148961 +0800\n\nRollup merge of #50972 - nikic:no-parallel, r=michaelwoerister\n\nAdd -Z no-parallel-llvm flag\n\nCodegen issues commonly only manifest under specific circumstances,\ne.g. if multiple codegen units are used and ThinLTO is enabled.\nHowever, these configuration are threaded, making the use of LLVM\ndebugging facilities hard, as output is interleaved.\n\nThis patch adds a -Z no-parallel-llvm flag, which allows disabling\nparallelization of codegen and linking, while otherwise preserving\nbehavior with regard to codegen units and LTO.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e14bc2d3d4fa637044446880bbd0e17d265670f9", "html_url": "https://github.com/rust-lang/rust/commit/e14bc2d3d4fa637044446880bbd0e17d265670f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e14bc2d3d4fa637044446880bbd0e17d265670f9/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb26c9b390306592458de3731c46e9c1643d4ccf", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb26c9b390306592458de3731c46e9c1643d4ccf", "html_url": "https://github.com/rust-lang/rust/commit/eb26c9b390306592458de3731c46e9c1643d4ccf"}, {"sha": "54f0668a1084b8e64355de5b194fc2fd02fe3854", "url": "https://api.github.com/repos/rust-lang/rust/commits/54f0668a1084b8e64355de5b194fc2fd02fe3854", "html_url": "https://github.com/rust-lang/rust/commit/54f0668a1084b8e64355de5b194fc2fd02fe3854"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "b3f1b9c8e627c7e25f777980d7cb5c4df31825aa", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e14bc2d3d4fa637044446880bbd0e17d265670f9/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e14bc2d3d4fa637044446880bbd0e17d265670f9/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=e14bc2d3d4fa637044446880bbd0e17d265670f9", "patch": "@@ -1337,6 +1337,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n           \"enable the experimental Chalk-based trait solving engine\"),\n     cross_lang_lto: CrossLangLto = (CrossLangLto::Disabled, parse_cross_lang_lto, [TRACKED],\n           \"generate build artifacts that are compatible with linker-based LTO.\"),\n+    no_parallel_llvm: bool = (false, parse_bool, [UNTRACKED],\n+          \"don't run LLVM in parallel (while keeping codegen-units and ThinLTO)\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "baab3c618be58e84a5c6e3820c907976be1d5301", "filename": "src/librustc_codegen_llvm/back/write.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e14bc2d3d4fa637044446880bbd0e17d265670f9/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e14bc2d3d4fa637044446880bbd0e17d265670f9/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs?ref=e14bc2d3d4fa637044446880bbd0e17d265670f9", "patch": "@@ -1738,7 +1738,9 @@ fn start_executing_work(tcx: TyCtxt,\n                             .binary_search_by_key(&cost, |&(_, cost)| cost)\n                             .unwrap_or_else(|e| e);\n                         work_items.insert(insertion_index, (work, cost));\n-                        helper.request_token();\n+                        if !cgcx.opts.debugging_opts.no_parallel_llvm {\n+                            helper.request_token();\n+                        }\n                     }\n                 }\n \n@@ -1842,7 +1844,9 @@ fn start_executing_work(tcx: TyCtxt,\n                     };\n                     work_items.insert(insertion_index, (llvm_work_item, cost));\n \n-                    helper.request_token();\n+                    if !cgcx.opts.debugging_opts.no_parallel_llvm {\n+                        helper.request_token();\n+                    }\n                     assert_eq!(main_thread_worker_state,\n                                MainThreadWorkerState::Codegenning);\n                     main_thread_worker_state = MainThreadWorkerState::Idle;"}]}