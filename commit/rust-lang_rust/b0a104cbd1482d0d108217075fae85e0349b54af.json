{"sha": "b0a104cbd1482d0d108217075fae85e0349b54af", "node_id": "C_kwDOAAsO6NoAKGIwYTEwNGNiZDE0ODJkMGQxMDgyMTcwNzVmYWU4NWUwMzQ5YjU0YWY", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T08:22:12Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T08:22:12Z"}, "message": "test formatting", "tree": {"sha": "99fe94d573f6b271e845421ae4d953049361625f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99fe94d573f6b271e845421ae4d953049361625f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0a104cbd1482d0d108217075fae85e0349b54af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0a104cbd1482d0d108217075fae85e0349b54af", "html_url": "https://github.com/rust-lang/rust/commit/b0a104cbd1482d0d108217075fae85e0349b54af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0a104cbd1482d0d108217075fae85e0349b54af/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2510eaa9b2acc65d0395ae81296197a9e4c9bdfd", "url": "https://api.github.com/repos/rust-lang/rust/commits/2510eaa9b2acc65d0395ae81296197a9e4c9bdfd", "html_url": "https://github.com/rust-lang/rust/commit/2510eaa9b2acc65d0395ae81296197a9e4c9bdfd"}], "stats": {"total": 20, "additions": 11, "deletions": 9}, "files": [{"sha": "c3fb6fc647e9b7691ca87e442bbdd0ce3b1c0cbd", "filename": "crates/hir_def/src/macro_expansion_tests.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs?ref=b0a104cbd1482d0d108217075fae85e0349b54af", "patch": "@@ -20,7 +20,7 @@ use stdx::format_to;\n use syntax::{\n     ast::{self, edit::IndentLevel},\n     AstNode,\n-    SyntaxKind::{self, IDENT, LIFETIME_IDENT},\n+    SyntaxKind::{EOF, IDENT, LIFETIME_IDENT},\n     SyntaxNode, T,\n };\n \n@@ -109,7 +109,7 @@ fn reindent(indent: IndentLevel, pp: String) -> String {\n \n fn pretty_print_macro_expansion(expn: SyntaxNode) -> String {\n     let mut res = String::new();\n-    let mut prev_kind = SyntaxKind::EOF;\n+    let mut prev_kind = EOF;\n     let mut indent_level = 0;\n     for token in iter::successors(expn.first_token(), |t| t.next_token()) {\n         let curr_kind = token.kind();\n@@ -129,6 +129,8 @@ fn pretty_print_macro_expansion(expn: SyntaxNode) -> String {\n             (T![->], _) | (_, T![->]) => \" \",\n             (T![&&], _) | (_, T![&&]) => \" \",\n             (T![,], _) => \" \",\n+            (T![fn], T!['(']) => \"\",\n+            _ if prev_kind.is_keyword() => \" \",\n             _ => \"\",\n         };\n "}, {"sha": "9954544e91b77b5e5f093eef4618f1653345c0e9", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=b0a104cbd1482d0d108217075fae85e0349b54af", "patch": "@@ -816,7 +816,7 @@ macro_rules! m {\n \n fn bar() -> & 'a Baz<u8> {}\n \n-fn bar() -> extern\"Rust\"fn() -> Ret {}\n+fn bar() -> extern \"Rust\"fn() -> Ret {}\n \"#]],\n     );\n }\n@@ -835,7 +835,7 @@ macro_rules! m {\n     ($p:pat) => { fn foo() { let $p; } }\n }\n fn foo() {\n-    let(a, b);\n+    let (a, b);\n }\n \"#]],\n     );"}, {"sha": "291f99330f1e8842ebed49957a7389c192f73f76", "filename": "crates/hir_def/src/macro_expansion_tests/mbe/tt_conversion.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0a104cbd1482d0d108217075fae85e0349b54af/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs?ref=b0a104cbd1482d0d108217075fae85e0349b54af", "patch": "@@ -53,11 +53,11 @@ macro_rules! m {\n     }\n }\n fn f() {\n-    let_ = 'c';\n-    let_ = 1000;\n-    let_ = 12E+99_f64;\n-    let_ = \"rust1\";\n-    let_ = -92;\n+    let _ = 'c';\n+    let _ = 1000;\n+    let _ = 12E+99_f64;\n+    let _ = \"rust1\";\n+    let _ = -92;\n }\n \"#]],\n     );"}]}