{"sha": "bdd4046f01ead4a1581f5cb1c3c634db6567772d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkZDQwNDZmMDFlYWQ0YTE1ODFmNWNiMWMzYzYzNGRiNjU2Nzc3MmQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-14T13:05:29Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-14T13:05:29Z"}, "message": "Auto merge of #5171 - flip1995:deploy, r=Manishearth\n\nImprove deployment and documentation\n\n**This should be merged shortly after** #5172\n\nThis extracts the python code that generated the `versions.json` file and now sorts the versions. in addition to that it improves the order on the website, respecting the new `rust-*` directories.\n\nThe new appearance of the documentation site can be previewed here: https://flip1995.github.io/rust-clippy/\n\nchangelog: Add documentation for Clippy stable releases at https://rust-lang.github.io/rust-clippy/", "tree": {"sha": "23a1b8a5be698acfe0e3f0bccf49a1987873a02e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23a1b8a5be698acfe0e3f0bccf49a1987873a02e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdd4046f01ead4a1581f5cb1c3c634db6567772d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdd4046f01ead4a1581f5cb1c3c634db6567772d", "html_url": "https://github.com/rust-lang/rust/commit/bdd4046f01ead4a1581f5cb1c3c634db6567772d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdd4046f01ead4a1581f5cb1c3c634db6567772d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41d90d3b8e633ab53005b8f7459dd10e4526bd41", "url": "https://api.github.com/repos/rust-lang/rust/commits/41d90d3b8e633ab53005b8f7459dd10e4526bd41", "html_url": "https://github.com/rust-lang/rust/commit/41d90d3b8e633ab53005b8f7459dd10e4526bd41"}, {"sha": "0f7918266fa4f4a50237c8bdac79cb1e3001d86c", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f7918266fa4f4a50237c8bdac79cb1e3001d86c", "html_url": "https://github.com/rust-lang/rust/commit/0f7918266fa4f4a50237c8bdac79cb1e3001d86c"}], "stats": {"total": 70, "additions": 56, "deletions": 14}, "files": [{"sha": "b1f572d2b455f0148f8bef5c40267bcfd64ce422", "filename": ".github/deploy.sh", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/bdd4046f01ead4a1581f5cb1c3c634db6567772d/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/bdd4046f01ead4a1581f5cb1c3c634db6567772d/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=bdd4046f01ead4a1581f5cb1c3c634db6567772d", "patch": "@@ -8,26 +8,22 @@ rm -rf out/master/ || exit 0\n echo \"Making the docs for master\"\n mkdir out/master/\n cp util/gh-pages/index.html out/master\n-python ./util/export.py out/master/lints.json\n+python3 ./util/export.py out/master/lints.json\n \n if [[ -n $TAG_NAME ]]; then\n-  echo \"Save the doc for the current tag ($TAG_NAME) and point current/ to it\"\n+  echo \"Save the doc for the current tag ($TAG_NAME) and point stable/ to it\"\n   cp -r out/master \"out/$TAG_NAME\"\n-  rm -f out/current\n-  ln -s \"$TAG_NAME\" out/current\n+  rm -f out/stable\n+  ln -s \"$TAG_NAME\" out/stable\n fi\n \n # Generate version index that is shown as root index page\n cp util/gh-pages/versions.html out/index.html\n \n-cd out\n-cat <<-EOF | python - > versions.json\n-import os, json\n-print json.dumps([\n-    dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n-])\n-EOF\n+echo \"Making the versions.json file\"\n+python3 ./util/versions.py out\n \n+cd out\n # Now let's go have some fun with the cloned repo\n git config user.name \"GHA CI\"\n git config user.email \"gha@ci.invalid\""}, {"sha": "cd3611db3005a4374ffcd2f15d2af948cd6f5c2f", "filename": "util/gh-pages/versions.html", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bdd4046f01ead4a1581f5cb1c3c634db6567772d/util%2Fgh-pages%2Fversions.html", "raw_url": "https://github.com/rust-lang/rust/raw/bdd4046f01ead4a1581f5cb1c3c634db6567772d/util%2Fgh-pages%2Fversions.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Fversions.html?ref=bdd4046f01ead4a1581f5cb1c3c634db6567772d", "patch": "@@ -36,7 +36,7 @@ <h3 class=\"panel-title\">\n                 <ul class=\"list-group\">\n                     <a class=\"list-group-item\" ng-repeat=\"version in data | orderBy:versionOrder:true\"\n                        href=\"./{{version}}/index.html\">\n-                        {{normalizeVersion(version)}}\n+                        {{normalizeVersionDisplay(version)}}\n                     </a>\n                 </ul>\n             </article>\n@@ -54,13 +54,17 @@ <h3 class=\"panel-title\">\n         .controller('docVersions', function ($scope, $http) {\n             $scope.loading = true;\n \n-            $scope.normalizeVersion = function(v) {\n+            $scope.normalizeVersionDisplay = function(v) {\n                 return v.replace(/^v/, '');\n             };\n \n+            $scope.normalizeVersion = function(v) {\n+                return v.replace(/^v/, '').replace(/^rust-/, '');\n+            };\n+\n             $scope.versionOrder = function(v) {\n                 if (v === 'master') { return Infinity; }\n-                if (v === 'current') { return Number.MAX_VALUE; }\n+                if (v === 'stable') { return Number.MAX_VALUE; }\n \n                 return $scope.normalizeVersion(v)\n                     .split('.')"}, {"sha": "5798761ad75bd54f3393aacdee7b73da3593b09f", "filename": "util/versions.py", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/bdd4046f01ead4a1581f5cb1c3c634db6567772d/util%2Fversions.py", "raw_url": "https://github.com/rust-lang/rust/raw/bdd4046f01ead4a1581f5cb1c3c634db6567772d/util%2Fversions.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fversions.py?ref=bdd4046f01ead4a1581f5cb1c3c634db6567772d", "patch": "@@ -0,0 +1,42 @@\n+#!/usr/bin/env python\n+\n+import json\n+import os\n+import sys\n+\n+from lintlib import log\n+\n+\n+def key(v):\n+    if v == 'master':\n+        return float('inf')\n+    if v == 'stable':\n+        return sys.maxsize\n+\n+    v = v.replace('v', '').replace('rust-', '')\n+\n+    s = 0\n+    for i, val in enumerate(v.split('.')[::-1]):\n+        s += int(val) * 100**i\n+\n+    return s\n+\n+\n+def main():\n+    if len(sys.argv) < 2:\n+        print(\"Error: specify output directory\")\n+        return\n+\n+    outdir = sys.argv[1]\n+    versions = [\n+        dir for dir in os.listdir(outdir) if not dir.startswith(\".\") and os.path.isdir(os.path.join(outdir, dir))\n+    ]\n+    versions.sort(key=key)\n+\n+    with open(os.path.join(outdir, \"versions.json\"), \"w\") as fp:\n+        json.dump(versions, fp, indent=2)\n+        log.info(\"wrote JSON for great justice\")\n+\n+\n+if __name__ == \"__main__\":\n+    main()"}]}