{"sha": "e982971ff22fa190369b5f536403c37c52b10a26", "node_id": "C_kwDOAAsO6NoAKGU5ODI5NzFmZjIyZmExOTAzNjliNWY1MzY0MDNjMzdjNTJiMTBhMjY", "commit": {"author": {"name": "Kyle Matsuda", "email": "kyle.yoshio.matsuda@gmail.com", "date": "2023-01-18T22:43:20Z"}, "committer": {"name": "Kyle Matsuda", "email": "kyle.yoshio.matsuda@gmail.com", "date": "2023-01-27T03:15:36Z"}, "message": "replace usages of fn_sig query with bound_fn_sig", "tree": {"sha": "3b5002c6057b31c2c2d300a7ebf1bf48d22de281", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b5002c6057b31c2c2d300a7ebf1bf48d22de281"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e982971ff22fa190369b5f536403c37c52b10a26", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e982971ff22fa190369b5f536403c37c52b10a26", "html_url": "https://github.com/rust-lang/rust/commit/e982971ff22fa190369b5f536403c37c52b10a26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e982971ff22fa190369b5f536403c37c52b10a26/comments", "author": {"login": "kylematsuda", "id": 17287790, "node_id": "MDQ6VXNlcjE3Mjg3Nzkw", "avatar_url": "https://avatars.githubusercontent.com/u/17287790?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kylematsuda", "html_url": "https://github.com/kylematsuda", "followers_url": "https://api.github.com/users/kylematsuda/followers", "following_url": "https://api.github.com/users/kylematsuda/following{/other_user}", "gists_url": "https://api.github.com/users/kylematsuda/gists{/gist_id}", "starred_url": "https://api.github.com/users/kylematsuda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kylematsuda/subscriptions", "organizations_url": "https://api.github.com/users/kylematsuda/orgs", "repos_url": "https://api.github.com/users/kylematsuda/repos", "events_url": "https://api.github.com/users/kylematsuda/events{/privacy}", "received_events_url": "https://api.github.com/users/kylematsuda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kylematsuda", "id": 17287790, "node_id": "MDQ6VXNlcjE3Mjg3Nzkw", "avatar_url": "https://avatars.githubusercontent.com/u/17287790?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kylematsuda", "html_url": "https://github.com/kylematsuda", "followers_url": "https://api.github.com/users/kylematsuda/followers", "following_url": "https://api.github.com/users/kylematsuda/following{/other_user}", "gists_url": "https://api.github.com/users/kylematsuda/gists{/gist_id}", "starred_url": "https://api.github.com/users/kylematsuda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kylematsuda/subscriptions", "organizations_url": "https://api.github.com/users/kylematsuda/orgs", "repos_url": "https://api.github.com/users/kylematsuda/repos", "events_url": "https://api.github.com/users/kylematsuda/events{/privacy}", "received_events_url": "https://api.github.com/users/kylematsuda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7948c843de94245c794e8c63dd4301a78bb5ba3", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7948c843de94245c794e8c63dd4301a78bb5ba3", "html_url": "https://github.com/rust-lang/rust/commit/d7948c843de94245c794e8c63dd4301a78bb5ba3"}], "stats": {"total": 260, "additions": 147, "deletions": 113}, "files": [{"sha": "8e910dea9f3e41c330f5a25a5f1b090daaf1fe35", "filename": "compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -2599,7 +2599,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                 match ty.kind() {\n                     ty::FnDef(_, _) | ty::FnPtr(_) => self.annotate_fn_sig(\n                         self.mir_def_id(),\n-                        self.infcx.tcx.fn_sig(self.mir_def_id()),\n+                        self.infcx.tcx.bound_fn_sig(self.mir_def_id().into()).subst_identity(),\n                     ),\n                     _ => None,\n                 }"}, {"sha": "409b18a579d6d08adf61568fed092370a48f305f", "filename": "compiler/rustc_borrowck/src/diagnostics/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1136,7 +1136,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                             && let self_ty = infcx.replace_bound_vars_with_fresh_vars(\n                                 fn_call_span,\n                                 LateBoundRegionConversionTime::FnCall,\n-                                tcx.fn_sig(method_did).input(0),\n+                                tcx.bound_fn_sig(method_did).subst_identity().input(0),\n                             )\n                             && infcx.can_eq(self.param_env, ty, self_ty).is_ok()\n                         {"}, {"sha": "4b62e5cce47bf84271a2c674228c402d8e4d8a43", "filename": "compiler/rustc_borrowck/src/universal_regions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Funiversal_regions.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -472,7 +472,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n         // C-variadic fns also have a `VaList` input that's not listed in the signature\n         // (as it's created inside the body itself, not passed in from outside).\n         if let DefiningTy::FnDef(def_id, _) = defining_ty {\n-            if self.infcx.tcx.fn_sig(def_id).c_variadic() {\n+            if self.infcx.tcx.bound_fn_sig(def_id).skip_binder().c_variadic() {\n                 let va_list_did = self.infcx.tcx.require_lang_item(\n                     LangItem::VaList,\n                     Some(self.infcx.tcx.def_span(self.mir_def.did)),\n@@ -665,7 +665,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n             }\n \n             DefiningTy::FnDef(def_id, _) => {\n-                let sig = tcx.fn_sig(def_id);\n+                let sig = tcx.bound_fn_sig(def_id).subst_identity();\n                 let sig = indices.fold_to_region_vids(tcx, sig);\n                 sig.inputs_and_output()\n             }"}, {"sha": "f46e6b6528c88a8b267ca65bab43ac853e371c26", "filename": "compiler/rustc_codegen_cranelift/src/main_shim.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmain_shim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmain_shim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmain_shim.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -46,7 +46,7 @@ pub(crate) fn maybe_create_entry_wrapper(\n         is_main_fn: bool,\n         sigpipe: u8,\n     ) {\n-        let main_ret_ty = tcx.fn_sig(rust_main_def_id).output();\n+        let main_ret_ty = tcx.bound_fn_sig(rust_main_def_id).subst_identity().output();\n         // Given that `main()` has no arguments,\n         // then its return type cannot have\n         // late-bound regions, since late-bound"}, {"sha": "4d802206f23657e02443a4c150572150ffc6d64a", "filename": "compiler/rustc_codegen_llvm/src/attributes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fattributes.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -441,7 +441,7 @@ pub fn from_fn_attrs<'ll, 'tcx>(\n         // the WebAssembly specification, which has this feature. This won't be\n         // needed when LLVM enables this `multivalue` feature by default.\n         if !cx.tcx.is_closure(instance.def_id()) {\n-            let abi = cx.tcx.fn_sig(instance.def_id()).abi();\n+            let abi = cx.tcx.bound_fn_sig(instance.def_id()).skip_binder().abi();\n             if abi == Abi::Wasm {\n                 function_features.push(\"+multivalue\".to_string());\n             }"}, {"sha": "61cea048a5e265600d83ed34d78785e51678e7b8", "filename": "compiler/rustc_codegen_ssa/src/codegen_attrs.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_ssa%2Fsrc%2Fcodegen_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_codegen_ssa%2Fsrc%2Fcodegen_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fcodegen_attrs.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -214,7 +214,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, did: DefId) -> CodegenFnAttrs {\n             }\n         } else if attr.has_name(sym::cmse_nonsecure_entry) {\n             if validate_fn_only_attr(attr.span)\n-                && !matches!(tcx.fn_sig(did).abi(), abi::Abi::C { .. })\n+                && !matches!(tcx.bound_fn_sig(did.into()).skip_binder().abi(), abi::Abi::C { .. })\n             {\n                 struct_span_err!(\n                     tcx.sess,\n@@ -234,7 +234,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, did: DefId) -> CodegenFnAttrs {\n         } else if attr.has_name(sym::track_caller) {\n             if !tcx.is_closure(did.to_def_id())\n                 && validate_fn_only_attr(attr.span)\n-                && tcx.fn_sig(did).abi() != abi::Abi::Rust\n+                && tcx.bound_fn_sig(did.into()).skip_binder().abi() != abi::Abi::Rust\n             {\n                 struct_span_err!(tcx.sess, attr.span, E0737, \"`#[track_caller]` requires Rust ABI\")\n                     .emit();\n@@ -266,7 +266,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, did: DefId) -> CodegenFnAttrs {\n             }\n         } else if attr.has_name(sym::target_feature) {\n             if !tcx.is_closure(did.to_def_id())\n-                && tcx.fn_sig(did).unsafety() == hir::Unsafety::Normal\n+                && tcx.bound_fn_sig(did.into()).skip_binder().unsafety() == hir::Unsafety::Normal\n             {\n                 if tcx.sess.target.is_like_wasm || tcx.sess.opts.actually_rustdoc {\n                     // The `#[target_feature]` attribute is allowed on"}, {"sha": "f91912104e5ab0b3c5a27215de60281bae37f30d", "filename": "compiler/rustc_const_eval/src/const_eval/fn_queries.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Ffn_queries.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Ffn_queries.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Ffn_queries.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -64,9 +64,9 @@ fn is_promotable_const_fn(tcx: TyCtxt<'_>, def_id: DefId) -> bool {\n         && match tcx.lookup_const_stability(def_id) {\n             Some(stab) => {\n                 if cfg!(debug_assertions) && stab.promotable {\n-                    let sig = tcx.fn_sig(def_id);\n+                    let sig = tcx.bound_fn_sig(def_id);\n                     assert_eq!(\n-                        sig.unsafety(),\n+                        sig.skip_binder().unsafety(),\n                         hir::Unsafety::Normal,\n                         \"don't mark const unsafe fns as promotable\",\n                         // https://github.com/rust-lang/rust/pull/53851#issuecomment-418760682"}, {"sha": "64155b2594b000f7ac94a1a040c3210657e458a8", "filename": "compiler/rustc_const_eval/src/transform/check_consts/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -72,7 +72,7 @@ impl<'mir, 'tcx> ConstCx<'mir, 'tcx> {\n             let ty::Closure(_, substs) = ty.kind() else { bug!(\"type_of closure not ty::Closure\") };\n             substs.as_closure().sig()\n         } else {\n-            self.tcx.fn_sig(did)\n+            self.tcx.bound_fn_sig(did).subst_identity()\n         }\n     }\n }"}, {"sha": "475be4fde7aa1f73fec2c54d6b5bd3fdc3fc05b4", "filename": "compiler/rustc_hir_analysis/src/check/compare_impl_item.rs", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -249,7 +249,7 @@ fn compare_method_predicate_entailment<'tcx>(\n     let unnormalized_impl_sig = infcx.replace_bound_vars_with_fresh_vars(\n         impl_m_span,\n         infer::HigherRankedType,\n-        tcx.fn_sig(impl_m.def_id),\n+        tcx.bound_fn_sig(impl_m.def_id).subst_identity(),\n     );\n     let unnormalized_impl_fty = tcx.mk_fn_ptr(ty::Binder::dummy(unnormalized_impl_sig));\n \n@@ -422,8 +422,8 @@ fn extract_bad_args_for_implies_lint<'tcx>(\n \n     // Map late-bound regions from trait to impl, so the names are right.\n     let mapping = std::iter::zip(\n-        tcx.fn_sig(trait_m.def_id).bound_vars(),\n-        tcx.fn_sig(impl_m.def_id).bound_vars(),\n+        tcx.bound_fn_sig(trait_m.def_id).subst_identity().bound_vars(),\n+        tcx.bound_fn_sig(impl_m.def_id).subst_identity().bound_vars(),\n     )\n     .filter_map(|(impl_bv, trait_bv)| {\n         if let ty::BoundVariableKind::Region(impl_bv) = impl_bv\n@@ -540,7 +540,7 @@ fn compare_asyncness<'tcx>(\n     trait_item_span: Option<Span>,\n ) -> Result<(), ErrorGuaranteed> {\n     if tcx.asyncness(trait_m.def_id) == hir::IsAsync::Async {\n-        match tcx.fn_sig(impl_m.def_id).skip_binder().output().kind() {\n+        match tcx.bound_fn_sig(impl_m.def_id).subst_identity().skip_binder().output().kind() {\n             ty::Alias(ty::Opaque, ..) => {\n                 // allow both `async fn foo()` and `fn foo() -> impl Future`\n             }\n@@ -643,7 +643,7 @@ pub(super) fn collect_return_position_impl_trait_in_trait_tys<'tcx>(\n         infcx.replace_bound_vars_with_fresh_vars(\n             return_span,\n             infer::HigherRankedType,\n-            tcx.fn_sig(impl_m.def_id),\n+            tcx.bound_fn_sig(impl_m.def_id).subst_identity(),\n         ),\n     );\n     impl_sig.error_reported()?;\n@@ -1117,7 +1117,7 @@ fn compare_self_type<'tcx>(\n             ty::ImplContainer => impl_trait_ref.self_ty(),\n             ty::TraitContainer => tcx.types.self_param,\n         };\n-        let self_arg_ty = tcx.fn_sig(method.def_id).input(0);\n+        let self_arg_ty = tcx.bound_fn_sig(method.def_id).subst_identity().input(0);\n         let param_env = ty::ParamEnv::reveal_all();\n \n         let infcx = tcx.infer_ctxt().build();\n@@ -1348,10 +1348,10 @@ fn compare_number_of_method_arguments<'tcx>(\n     trait_m: &ty::AssocItem,\n     trait_item_span: Option<Span>,\n ) -> Result<(), ErrorGuaranteed> {\n-    let impl_m_fty = tcx.fn_sig(impl_m.def_id);\n-    let trait_m_fty = tcx.fn_sig(trait_m.def_id);\n-    let trait_number_args = trait_m_fty.inputs().skip_binder().len();\n-    let impl_number_args = impl_m_fty.inputs().skip_binder().len();\n+    let impl_m_fty = tcx.bound_fn_sig(impl_m.def_id);\n+    let trait_m_fty = tcx.bound_fn_sig(trait_m.def_id);\n+    let trait_number_args = trait_m_fty.skip_binder().inputs().skip_binder().len();\n+    let impl_number_args = impl_m_fty.skip_binder().inputs().skip_binder().len();\n \n     if trait_number_args != impl_number_args {\n         let trait_span = trait_m"}, {"sha": "fe2720fa1afc9d881b024ce85f28a2c5307fb2ec", "filename": "compiler/rustc_hir_analysis/src/check/intrinsic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fintrinsic.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -58,7 +58,7 @@ fn equate_intrinsic_type<'tcx>(\n         let fty = tcx.mk_fn_ptr(sig);\n         let it_def_id = it.owner_id.def_id;\n         let cause = ObligationCause::new(it.span, it_def_id, ObligationCauseCode::IntrinsicType);\n-        require_same_types(tcx, &cause, tcx.mk_fn_ptr(tcx.fn_sig(it.owner_id)), fty);\n+        require_same_types(tcx, &cause, tcx.mk_fn_ptr(tcx.bound_fn_sig(it.owner_id.to_def_id()).subst_identity()), fty);\n     }\n }\n "}, {"sha": "3b0ddad25fc825fc3205581bd4d9fb9d4649d627", "filename": "compiler/rustc_hir_analysis/src/check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -445,7 +445,7 @@ fn suggestion_signature(assoc: &ty::AssocItem, tcx: TyCtxt<'_>) -> String {\n             // regions just fine, showing `fn(&MyType)`.\n             fn_sig_suggestion(\n                 tcx,\n-                tcx.fn_sig(assoc.def_id).skip_binder(),\n+                tcx.bound_fn_sig(assoc.def_id).subst_identity().skip_binder(),\n                 assoc.ident(tcx),\n                 tcx.predicates_of(assoc.def_id),\n                 assoc,"}, {"sha": "a0a0c72ded96b7d275d98d56809a75224d0d5d11", "filename": "compiler/rustc_hir_analysis/src/check/wfcheck.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -386,7 +386,7 @@ fn check_gat_where_clauses(tcx: TyCtxt<'_>, associated_items: &[hir::TraitItemRe\n                         // `Self::Iter<'a>` is a GAT we want to gather any potential missing bounds from.\n                         let sig: ty::FnSig<'_> = tcx.liberate_late_bound_regions(\n                             item_def_id.to_def_id(),\n-                            tcx.fn_sig(item_def_id),\n+                            tcx.bound_fn_sig(item_def_id.to_def_id()).subst_identity(),\n                         );\n                         gather_gat_bounds(\n                             tcx,\n@@ -1018,7 +1018,7 @@ fn check_associated_item(\n                 wfcx.register_wf_obligation(span, loc, ty.into());\n             }\n             ty::AssocKind::Fn => {\n-                let sig = tcx.fn_sig(item.def_id);\n+                let sig = tcx.bound_fn_sig(item.def_id).subst_identity();\n                 let hir_sig = sig_if_method.expect(\"bad signature for method\");\n                 check_fn_or_method(\n                     wfcx,\n@@ -1203,7 +1203,7 @@ fn check_item_fn(\n     decl: &hir::FnDecl<'_>,\n ) {\n     enter_wf_checking_ctxt(tcx, span, def_id, |wfcx| {\n-        let sig = tcx.fn_sig(def_id);\n+        let sig = tcx.bound_fn_sig(def_id.into()).subst_identity();\n         check_fn_or_method(wfcx, ident.span, sig, decl, def_id);\n     })\n }\n@@ -1638,7 +1638,7 @@ fn check_method_receiver<'tcx>(\n \n     let span = fn_sig.decl.inputs[0].span;\n \n-    let sig = tcx.fn_sig(method.def_id);\n+    let sig = tcx.bound_fn_sig(method.def_id).subst_identity();\n     let sig = tcx.liberate_late_bound_regions(method.def_id, sig);\n     let sig = wfcx.normalize(span, None, sig);\n "}, {"sha": "82c4aaba0891a7072b9fc6a659134b5b68b88273", "filename": "compiler/rustc_hir_analysis/src/collect/type_of.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Ftype_of.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -867,7 +867,9 @@ fn infer_placeholder_type<'a>(\n             }\n \n             match ty.kind() {\n-                ty::FnDef(def_id, _) => self.tcx.mk_fn_ptr(self.tcx.fn_sig(*def_id)),\n+                ty::FnDef(def_id, _) => {\n+                    self.tcx.mk_fn_ptr(self.tcx.bound_fn_sig(*def_id).subst_identity())\n+                }\n                 // FIXME: non-capturing closures should also suggest a function pointer\n                 ty::Closure(..) | ty::Generator(..) => {\n                     self.success = false;"}, {"sha": "7a359ab22feacdb0a65c43a2b7ee31b06e5971e6", "filename": "compiler/rustc_hir_analysis/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Flib.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -182,7 +182,7 @@ fn require_same_types<'tcx>(\n }\n \n fn check_main_fn_ty(tcx: TyCtxt<'_>, main_def_id: DefId) {\n-    let main_fnsig = tcx.fn_sig(main_def_id);\n+    let main_fnsig = tcx.bound_fn_sig(main_def_id).subst_identity();\n     let main_span = tcx.def_span(main_def_id);\n \n     fn main_fn_diagnostics_def_id(tcx: TyCtxt<'_>, def_id: DefId, sp: Span) -> LocalDefId {\n@@ -449,7 +449,7 @@ fn check_start_fn_ty(tcx: TyCtxt<'_>, start_def_id: DefId) {\n                     ObligationCauseCode::StartFunctionType,\n                 ),\n                 se_ty,\n-                tcx.mk_fn_ptr(tcx.fn_sig(start_def_id)),\n+                tcx.mk_fn_ptr(tcx.bound_fn_sig(start_def_id.into()).subst_identity()),\n             );\n         }\n         _ => {"}, {"sha": "b662dfca71a30493d2fdbdc92fdf27ee8781ae62", "filename": "compiler/rustc_hir_analysis/src/variance/constraints.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fvariance%2Fconstraints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_analysis%2Fsrc%2Fvariance%2Fconstraints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fvariance%2Fconstraints.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -119,7 +119,11 @@ impl<'a, 'tcx> ConstraintContext<'a, 'tcx> {\n             }\n \n             ty::FnDef(..) => {\n-                self.add_constraints_from_sig(current_item, tcx.fn_sig(def_id), self.covariant);\n+                self.add_constraints_from_sig(\n+                    current_item,\n+                    tcx.bound_fn_sig(def_id.into()).subst_identity(),\n+                    self.covariant,\n+                );\n             }\n \n             ty::Error(_) => {}"}, {"sha": "c01def290353b7e810bdd35294976a5a33300aad", "filename": "compiler/rustc_hir_typeck/src/demand.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -299,7 +299,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             {\n                 // We special case methods, because they can influence inference through the\n                 // call's arguments and we can provide a more explicit span.\n-                let sig = self.tcx.fn_sig(def_id);\n+                let sig = self.tcx.bound_fn_sig(def_id).subst_identity();\n                 let def_self_ty = sig.input(0).skip_binder();\n                 let rcvr_ty = self.node_ty(rcvr.hir_id);\n                 // Get the evaluated type *after* calling the method call, so that the influence\n@@ -611,7 +611,14 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             with_no_trimmed_paths!(\n                                 self.tcx.def_path_str_with_substs(m.def_id, substs,)\n                             ),\n-                            match self.tcx.fn_sig(m.def_id).input(0).skip_binder().kind() {\n+                            match self\n+                                .tcx\n+                                .bound_fn_sig(m.def_id)\n+                                .subst_identity()\n+                                .input(0)\n+                                .skip_binder()\n+                                .kind()\n+                            {\n                                 ty::Ref(_, _, hir::Mutability::Mut) => \"&mut \",\n                                 ty::Ref(_, _, _) => \"&\",\n                                 _ => \"\",\n@@ -1036,7 +1043,14 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         match method.kind {\n             ty::AssocKind::Fn => {\n                 method.fn_has_self_parameter\n-                    && self.tcx.fn_sig(method.def_id).inputs().skip_binder().len() == 1\n+                    && self\n+                        .tcx\n+                        .bound_fn_sig(method.def_id)\n+                        .skip_binder()\n+                        .inputs()\n+                        .skip_binder()\n+                        .len()\n+                        == 1\n             }\n             _ => false,\n         }"}, {"sha": "1313230efac0bb5608f7cdce4b9bed3c42be83f0", "filename": "compiler/rustc_hir_typeck/src/expr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -542,7 +542,9 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         if let ty::FnDef(did, ..) = *ty.kind() {\n             let fn_sig = ty.fn_sig(tcx);\n-            if tcx.fn_sig(did).abi() == RustIntrinsic && tcx.item_name(did) == sym::transmute {\n+            if tcx.bound_fn_sig(did).skip_binder().abi() == RustIntrinsic\n+                && tcx.item_name(did) == sym::transmute\n+            {\n                 let from = fn_sig.inputs().skip_binder()[0];\n                 let to = fn_sig.output().skip_binder();\n                 // We defer the transmute to the end of typeck, once all inference vars have"}, {"sha": "3fa1469811a2f185cf3afa1ee3c9015d84f96054", "filename": "compiler/rustc_hir_typeck/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Flib.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -207,7 +207,7 @@ fn typeck_with_fallback<'tcx>(\n             let fn_sig = if rustc_hir_analysis::collect::get_infer_ret_ty(&decl.output).is_some() {\n                 fcx.astconv().ty_of_fn(id, header.unsafety, header.abi, decl, None, None)\n             } else {\n-                tcx.fn_sig(def_id)\n+                tcx.bound_fn_sig(def_id.into()).subst_identity()\n             };\n \n             check_abi(tcx, id, span, fn_sig.abi());"}, {"sha": "b56abfad761f872b07074919dc156b28ebc49a04", "filename": "compiler/rustc_hir_typeck/src/method/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -144,8 +144,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 None,\n             )\n             .map(|pick| {\n-                let sig = self.tcx.fn_sig(pick.item.def_id);\n-                sig.inputs().skip_binder().len().saturating_sub(1)\n+                let sig = self.tcx.bound_fn_sig(pick.item.def_id);\n+                sig.skip_binder().inputs().skip_binder().len().saturating_sub(1)\n             })\n             .unwrap_or(0);\n "}, {"sha": "37e712db3a0988e5f1b6981d5b7bdcb5e6d9e8f3", "filename": "compiler/rustc_hir_typeck/src/method/suggest.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1127,7 +1127,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             ty::AssocKind::Const | ty::AssocKind::Type => rcvr_ty,\n                             ty::AssocKind::Fn => self\n                                 .tcx\n-                                .fn_sig(item.def_id)\n+                                .bound_fn_sig(item.def_id)\n+                                .subst_identity()\n                                 .inputs()\n                                 .skip_binder()\n                                 .get(0)\n@@ -1264,7 +1265,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 && let Some(assoc) = self.associated_value(*impl_did, item_name)\n                 && assoc.kind == ty::AssocKind::Fn\n             {\n-                let sig = self.tcx.fn_sig(assoc.def_id);\n+                let sig = self.tcx.bound_fn_sig(assoc.def_id).subst_identity();\n                 sig.inputs().skip_binder().get(0).and_then(|first| if first.peel_refs() == rcvr_ty.peel_refs() {\n                     None\n                 } else {\n@@ -2098,7 +2099,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     // just changing the path.\n                     && pick.item.fn_has_self_parameter\n                     && let Some(self_ty) =\n-                        self.tcx.fn_sig(pick.item.def_id).inputs().skip_binder().get(0)\n+                        self.tcx.bound_fn_sig(pick.item.def_id).subst_identity().inputs().skip_binder().get(0)\n                     && self_ty.is_ref()\n                 {\n                     let suggested_path = match deref_ty.kind() {\n@@ -2351,7 +2352,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         // implement the `AsRef` trait.\n                         let skip = skippable.contains(&did)\n                             || ((\"Pin::new\" == *pre) && (sym::as_ref == item_name.name))\n-                            || inputs_len.map_or(false, |inputs_len| pick.item.kind == ty::AssocKind::Fn && self.tcx.fn_sig(pick.item.def_id).skip_binder().inputs().len() != inputs_len);\n+                            || inputs_len.map_or(false, |inputs_len| pick.item.kind == ty::AssocKind::Fn && self.tcx.bound_fn_sig(pick.item.def_id).skip_binder().skip_binder().inputs().len() != inputs_len);\n                         // Make sure the method is defined for the *actual* receiver: we don't\n                         // want to treat `Box<Self>` as a receiver if it only works because of\n                         // an autoderef to `&self`\n@@ -2730,8 +2731,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n             // check the method arguments number\n             if let Ok(pick) = probe &&\n-                let fn_sig = self.tcx.fn_sig(pick.item.def_id) &&\n-                let fn_args = fn_sig.skip_binder().inputs() &&\n+                let fn_sig = self.tcx.bound_fn_sig(pick.item.def_id) &&\n+                let fn_args = fn_sig.skip_binder().skip_binder().inputs() &&\n                 fn_args.len() == args.len() + 1 {\n                 err.span_suggestion_verbose(\n                     method_name.span.shrink_to_hi(),"}, {"sha": "e607791d3049bab9a175fa0a8e7212e161e95faa", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/util.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Futil.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -65,7 +65,7 @@ pub fn find_param_with_region<'tcx>(\n \n     let owner_id = hir.body_owner(body_id);\n     let fn_decl = hir.fn_decl_by_hir_id(owner_id).unwrap();\n-    let poly_fn_sig = tcx.fn_sig(id);\n+    let poly_fn_sig = tcx.bound_fn_sig(id).subst_identity();\n \n     let fn_sig = tcx.liberate_late_bound_regions(id, poly_fn_sig);\n     let body = hir.body(body_id);"}, {"sha": "b4fd6682df6ddeee7ac799dab3c7bdf74bf5c5eb", "filename": "compiler/rustc_lint/src/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1225,7 +1225,7 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n \n     fn check_foreign_fn(&mut self, id: hir::HirId, decl: &hir::FnDecl<'_>) {\n         let def_id = self.cx.tcx.hir().local_def_id(id);\n-        let sig = self.cx.tcx.fn_sig(def_id);\n+        let sig = self.cx.tcx.bound_fn_sig(def_id.into()).subst_identity();\n         let sig = self.cx.tcx.erase_late_bound_regions(sig);\n \n         for (input_ty, input_hir) in iter::zip(sig.inputs(), decl.inputs) {"}, {"sha": "cba4b10e4c8a6c0f28549c665b0832eaf327ea78", "filename": "compiler/rustc_metadata/src/rmeta/encoder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1093,7 +1093,7 @@ fn should_encode_trait_impl_trait_tys(tcx: TyCtxt<'_>, def_id: DefId) -> bool {\n     // of the trait fn to look for any RPITITs, but that's kinda doing a lot\n     // of work. We can probably remove this when we refactor RPITITs to be\n     // associated types.\n-    tcx.fn_sig(trait_item_def_id).skip_binder().output().walk().any(|arg| {\n+    tcx.bound_fn_sig(trait_item_def_id).subst_identity().skip_binder().output().walk().any(|arg| {\n         if let ty::GenericArgKind::Type(ty) = arg.unpack()\n             && let ty::Alias(ty::Projection, data) = ty.kind()\n             && tcx.def_kind(data.def_id) == DefKind::ImplTraitPlaceholder"}, {"sha": "bab084f6192242e92f28f6bb60248ab3bfba9644", "filename": "compiler/rustc_middle/src/ty/assoc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -79,7 +79,7 @@ impl AssocItem {\n                 // late-bound regions, and we don't want method signatures to show up\n                 // `as for<'r> fn(&'r MyType)`. Pretty-printing handles late-bound\n                 // regions just fine, showing `fn(&MyType)`.\n-                tcx.fn_sig(self.def_id).skip_binder().to_string()\n+                tcx.bound_fn_sig(self.def_id).subst_identity().skip_binder().to_string()\n             }\n             ty::AssocKind::Type => format!(\"type {};\", self.name),\n             ty::AssocKind::Const => {"}, {"sha": "073791fef7a50cd6e44bb34d89d0674c386402f3", "filename": "compiler/rustc_middle/src/ty/instance.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Finstance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Finstance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Finstance.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -459,7 +459,7 @@ impl<'tcx> Instance<'tcx> {\n         substs: SubstsRef<'tcx>,\n     ) -> Option<Instance<'tcx>> {\n         debug!(\"resolve_for_vtable(def_id={:?}, substs={:?})\", def_id, substs);\n-        let fn_sig = tcx.fn_sig(def_id);\n+        let fn_sig = tcx.bound_fn_sig(def_id).subst_identity();\n         let is_vtable_shim = !fn_sig.inputs().skip_binder().is_empty()\n             && fn_sig.input(0).skip_binder().is_param(0)\n             && tcx.generics_of(def_id).has_self;"}, {"sha": "488903867653f4987bb05e3e27b73accf805c602", "filename": "compiler/rustc_middle/src/ty/util.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Futil.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1315,7 +1315,10 @@ pub fn is_doc_notable_trait(tcx: TyCtxt<'_>, def_id: DefId) -> bool {\n \n /// Determines whether an item is an intrinsic by Abi.\n pub fn is_intrinsic(tcx: TyCtxt<'_>, def_id: DefId) -> bool {\n-    matches!(tcx.fn_sig(def_id).abi(), Abi::RustIntrinsic | Abi::PlatformIntrinsic)\n+    matches!(\n+        tcx.bound_fn_sig(def_id).skip_binder().abi(),\n+        Abi::RustIntrinsic | Abi::PlatformIntrinsic\n+    )\n }\n \n pub fn provide(providers: &mut ty::query::Providers) {"}, {"sha": "769f7769530e3e7d860be46f02235b19118d40d0", "filename": "compiler/rustc_mir_build/src/build/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -637,7 +637,9 @@ fn construct_error(\n \n     let ty = tcx.ty_error();\n     let num_params = match body_owner_kind {\n-        hir::BodyOwnerKind::Fn => tcx.fn_sig(def).inputs().skip_binder().len(),\n+        hir::BodyOwnerKind::Fn => {\n+            tcx.bound_fn_sig(def.into()).skip_binder().inputs().skip_binder().len()\n+        }\n         hir::BodyOwnerKind::Closure => {\n             let ty = tcx.type_of(def);\n             match ty.kind() {"}, {"sha": "178cc66144865367c283a448a18406006af4796c", "filename": "compiler/rustc_mir_transform/src/function_item_references.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_transform%2Fsrc%2Ffunction_item_references.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_transform%2Fsrc%2Ffunction_item_references.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Ffunction_item_references.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -79,7 +79,8 @@ impl<'tcx> FunctionItemRefChecker<'_, 'tcx> {\n         for bound in bounds {\n             if let Some(bound_ty) = self.is_pointer_trait(&bound.kind().skip_binder()) {\n                 // Get the argument types as they appear in the function signature.\n-                let arg_defs = self.tcx.fn_sig(def_id).skip_binder().inputs();\n+                let arg_defs =\n+                    self.tcx.bound_fn_sig(def_id).subst_identity().skip_binder().inputs();\n                 for (arg_num, arg_def) in arg_defs.iter().enumerate() {\n                     // For all types reachable from the argument type in the fn sig\n                     for generic_inner_ty in arg_def.walk() {\n@@ -161,7 +162,7 @@ impl<'tcx> FunctionItemRefChecker<'_, 'tcx> {\n             .as_ref()\n             .assert_crate_local()\n             .lint_root;\n-        let fn_sig = self.tcx.fn_sig(fn_id);\n+        let fn_sig = self.tcx.bound_fn_sig(fn_id).skip_binder();\n         let unsafety = fn_sig.unsafety().prefix_str();\n         let abi = match fn_sig.abi() {\n             Abi::Rust => String::from(\"\"),"}, {"sha": "5deeb109dd14da2943cdb11c7099c13753acb408", "filename": "compiler/rustc_mir_transform/src/shim.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -798,7 +798,11 @@ pub fn build_adt_ctor(tcx: TyCtxt<'_>, ctor_id: DefId) -> Body<'_> {\n     let param_env = tcx.param_env(ctor_id);\n \n     // Normalize the sig.\n-    let sig = tcx.fn_sig(ctor_id).no_bound_vars().expect(\"LBR in ADT constructor signature\");\n+    let sig = tcx\n+        .bound_fn_sig(ctor_id)\n+        .subst_identity()\n+        .no_bound_vars()\n+        .expect(\"LBR in ADT constructor signature\");\n     let sig = tcx.normalize_erasing_regions(param_env, sig);\n \n     let ty::Adt(adt_def, substs) = sig.output().kind() else {"}, {"sha": "9311d96bc7e003a3c1b120365edb683836ff9edb", "filename": "compiler/rustc_monomorphize/src/collector.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1296,7 +1296,7 @@ impl<'v> RootCollector<'_, 'v> {\n         };\n \n         let start_def_id = self.tcx.require_lang_item(LangItem::Start, None);\n-        let main_ret_ty = self.tcx.fn_sig(main_def_id).output();\n+        let main_ret_ty = self.tcx.bound_fn_sig(main_def_id).subst_identity().output();\n \n         // Given that `main()` has no arguments,\n         // then its return type cannot have"}, {"sha": "682985c6c07f76763db3ea91d5461e8f47e73224", "filename": "compiler/rustc_privacy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_privacy%2Fsrc%2Flib.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -198,7 +198,7 @@ where\n                 // Something like `fn() -> Priv {my_func}` is considered a private type even if\n                 // `my_func` is public, so we need to visit signatures.\n                 if let ty::FnDef(..) = ty.kind() {\n-                    tcx.fn_sig(def_id).visit_with(self)?;\n+                    tcx.bound_fn_sig(def_id).subst_identity().visit_with(self)?;\n                 }\n                 // Inherent static methods don't have self type in substs.\n                 // Something like `fn() {my_method}` type of the method"}, {"sha": "f0a6bbf76d454d60ded81e13a1cd79c0fa7e14ee", "filename": "compiler/rustc_trait_selection/src/traits/object_safety.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fobject_safety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fobject_safety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fobject_safety.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -395,7 +395,7 @@ fn virtual_call_violation_for_method<'tcx>(\n     trait_def_id: DefId,\n     method: &ty::AssocItem,\n ) -> Option<MethodViolationCode> {\n-    let sig = tcx.fn_sig(method.def_id);\n+    let sig = tcx.bound_fn_sig(method.def_id).subst_identity();\n \n     // The method's first parameter must be named `self`\n     if !method.fn_has_self_parameter {"}, {"sha": "81297464eab36768555ae2f54146c9f1d6b260ee", "filename": "compiler/rustc_ty_utils/src/implied_bounds.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_ty_utils%2Fsrc%2Fimplied_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_ty_utils%2Fsrc%2Fimplied_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fimplied_bounds.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -9,12 +9,12 @@ pub fn provide(providers: &mut ty::query::Providers) {\n fn assumed_wf_types(tcx: TyCtxt<'_>, def_id: DefId) -> &ty::List<Ty<'_>> {\n     match tcx.def_kind(def_id) {\n         DefKind::Fn => {\n-            let sig = tcx.fn_sig(def_id);\n+            let sig = tcx.bound_fn_sig(def_id).skip_binder();\n             let liberated_sig = tcx.liberate_late_bound_regions(def_id, sig);\n             liberated_sig.inputs_and_output\n         }\n         DefKind::AssocFn => {\n-            let sig = tcx.fn_sig(def_id);\n+            let sig = tcx.bound_fn_sig(def_id).skip_binder();\n             let liberated_sig = tcx.liberate_late_bound_regions(def_id, sig);\n             let mut assumed_wf_types: Vec<_> =\n                 tcx.assumed_wf_types(tcx.parent(def_id)).as_slice().into();"}, {"sha": "f1a927520b492cce42395330c1da395b1f42dd05", "filename": "compiler/rustc_ty_utils/src/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -299,7 +299,7 @@ fn well_formed_types_in_env(tcx: TyCtxt<'_>, def_id: DefId) -> &ty::List<Predica\n         // In an fn, we assume that the arguments and all their constituents are\n         // well-formed.\n         NodeKind::Fn => {\n-            let fn_sig = tcx.fn_sig(def_id);\n+            let fn_sig = tcx.bound_fn_sig(def_id).subst_identity();\n             let fn_sig = tcx.liberate_late_bound_regions(def_id, fn_sig);\n \n             inputs.extend(fn_sig.inputs().iter().flat_map(|ty| ty.walk()));"}, {"sha": "a41ff4d66594a1632b72777f0de8d7307e5ded29", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -251,7 +251,7 @@ pub(crate) fn build_external_trait(cx: &mut DocContext<'_>, did: DefId) -> clean\n }\n \n fn build_external_function<'tcx>(cx: &mut DocContext<'tcx>, did: DefId) -> Box<clean::Function> {\n-    let sig = cx.tcx.fn_sig(did);\n+    let sig = cx.tcx.bound_fn_sig(did).subst_identity();\n \n     let late_bound_regions = sig.bound_vars().into_iter().filter_map(|var| match var {\n         ty::BoundVariableKind::Region(ty::BrNamed(_, name)) if name != kw::UnderscoreLifetime => {"}, {"sha": "0b37d5ecbd4c8d489fe54bed666e07f8cc7ddab9", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1230,7 +1230,7 @@ pub(crate) fn clean_middle_assoc_item<'tcx>(\n             }\n         }\n         ty::AssocKind::Fn => {\n-            let sig = tcx.fn_sig(assoc_item.def_id);\n+            let sig = tcx.bound_fn_sig(assoc_item.def_id).subst_identity();\n \n             let late_bound_regions = sig.bound_vars().into_iter().filter_map(|var| match var {\n                 ty::BoundVariableKind::Region(ty::BrNamed(_, name))"}, {"sha": "4f3f738f7b81eefa03c7a1ecde14bb91a3923ecc", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -665,7 +665,7 @@ impl Item {\n             tcx: TyCtxt<'_>,\n             asyncness: hir::IsAsync,\n         ) -> hir::FnHeader {\n-            let sig = tcx.fn_sig(def_id);\n+            let sig = tcx.bound_fn_sig(def_id).skip_binder();\n             let constness =\n                 if tcx.is_const_fn(def_id) && is_unstable_const_fn(tcx, def_id).is_none() {\n                     hir::Constness::Const\n@@ -677,7 +677,7 @@ impl Item {\n         let header = match *self.kind {\n             ItemKind::ForeignFunctionItem(_) => {\n                 let def_id = self.item_id.as_def_id().unwrap();\n-                let abi = tcx.fn_sig(def_id).abi();\n+                let abi = tcx.bound_fn_sig(def_id).skip_binder().abi();\n                 hir::FnHeader {\n                     unsafety: if abi == Abi::RustIntrinsic {\n                         intrinsic_operation_unsafety(tcx, self.item_id.as_def_id().unwrap())"}, {"sha": "2a0e0857c56100419ceb3aa9dd7e789ac3057027", "filename": "src/tools/clippy/clippy_lints/src/casts/as_ptr_cast_mut.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcasts%2Fas_ptr_cast_mut.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcasts%2Fas_ptr_cast_mut.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcasts%2Fas_ptr_cast_mut.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -17,7 +17,7 @@ pub(super) fn check(cx: &LateContext<'_>, expr: &Expr<'_>, cast_expr: &Expr<'_>,\n         && let ExprKind::MethodCall(method_name, receiver, [], _) = cast_expr.peel_blocks().kind\n         && method_name.ident.name == rustc_span::sym::as_ptr\n         && let Some(as_ptr_did) = cx.typeck_results().type_dependent_def_id(cast_expr.peel_blocks().hir_id)\n-        && let as_ptr_sig = cx.tcx.fn_sig(as_ptr_did)\n+        && let as_ptr_sig = cx.tcx.bound_fn_sig(as_ptr_did).subst_identity()\n         && let Some(first_param_ty) = as_ptr_sig.skip_binder().inputs().iter().next()\n         && let ty::Ref(_, _, Mutability::Not) = first_param_ty.kind()\n         && let Some(recv) = snippet_opt(cx, receiver.span)"}, {"sha": "9c5a9f583743fa9e6bb0d6bc13a823a5af3888a6", "filename": "src/tools/clippy/clippy_lints/src/default_numeric_fallback.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -141,7 +141,7 @@ impl<'a, 'tcx> Visitor<'tcx> for NumericFallbackVisitor<'a, 'tcx> {\n \n             ExprKind::MethodCall(_, receiver, args, _) => {\n                 if let Some(def_id) = self.cx.typeck_results().type_dependent_def_id(expr.hir_id) {\n-                    let fn_sig = self.cx.tcx.fn_sig(def_id).skip_binder();\n+                    let fn_sig = self.cx.tcx.bound_fn_sig(def_id).subst_identity().skip_binder();\n                     for (expr, bound) in iter::zip(std::iter::once(*receiver).chain(args.iter()), fn_sig.inputs()) {\n                         self.ty_bounds.push((*bound).into());\n                         self.visit_expr(expr);\n@@ -215,7 +215,7 @@ fn fn_sig_opt<'tcx>(cx: &LateContext<'tcx>, hir_id: HirId) -> Option<PolyFnSig<'\n     let node_ty = cx.typeck_results().node_type_opt(hir_id)?;\n     // We can't use `Ty::fn_sig` because it automatically performs substs, this may result in FNs.\n     match node_ty.kind() {\n-        ty::FnDef(def_id, _) => Some(cx.tcx.fn_sig(*def_id)),\n+        ty::FnDef(def_id, _) => Some(cx.tcx.bound_fn_sig(*def_id).subst_identity()),\n         ty::FnPtr(fn_sig) => Some(*fn_sig),\n         _ => None,\n     }"}, {"sha": "25620f45b8a986997043441b8046ff91cbae360c", "filename": "src/tools/clippy/clippy_lints/src/dereference.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdereference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdereference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdereference.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -759,7 +759,7 @@ fn walk_parents<'tcx>(\n             }) if span.ctxt() == ctxt => {\n                 let output = cx\n                     .tcx\n-                    .erase_late_bound_regions(cx.tcx.fn_sig(owner_id.to_def_id()).output());\n+                    .erase_late_bound_regions(cx.tcx.bound_fn_sig(owner_id.to_def_id()).subst_identity().output());\n                 Some(ty_auto_deref_stability(cx, output, precedence).position_for_result(cx))\n             },\n \n@@ -791,7 +791,7 @@ fn walk_parents<'tcx>(\n                         } else {\n                             let output = cx\n                                 .tcx\n-                                .erase_late_bound_regions(cx.tcx.fn_sig(cx.tcx.hir().local_def_id(owner_id)).output());\n+                                .erase_late_bound_regions(cx.tcx.bound_fn_sig(cx.tcx.hir().local_def_id(owner_id).into()).subst_identity().output());\n                             ty_auto_deref_stability(cx, output, precedence).position_for_result(cx)\n                         },\n                     )\n@@ -858,7 +858,7 @@ fn walk_parents<'tcx>(\n                             && let subs = cx\n                                 .typeck_results()\n                                 .node_substs_opt(parent.hir_id).map(|subs| &subs[1..]).unwrap_or_default()\n-                            && let impl_ty = if cx.tcx.fn_sig(id).skip_binder().inputs()[0].is_ref() {\n+                            && let impl_ty = if cx.tcx.bound_fn_sig(id).subst_identity().skip_binder().inputs()[0].is_ref() {\n                                 // Trait methods taking `&self`\n                                 sub_ty\n                             } else {\n@@ -879,7 +879,7 @@ fn walk_parents<'tcx>(\n                         return Some(Position::MethodReceiver);\n                     }\n                     args.iter().position(|arg| arg.hir_id == child_id).map(|i| {\n-                        let ty = cx.tcx.fn_sig(id).skip_binder().inputs()[i + 1];\n+                        let ty = cx.tcx.bound_fn_sig(id).subst_identity().skip_binder().inputs()[i + 1];\n                         // `e.hir_id == child_id` for https://github.com/rust-lang/rust-clippy/issues/9739\n                         // `method.args.is_none()` for https://github.com/rust-lang/rust-clippy/issues/9782\n                         if e.hir_id == child_id && method.args.is_none() && let ty::Param(param_ty) = ty.kind() {\n@@ -896,7 +896,7 @@ fn walk_parents<'tcx>(\n                         } else {\n                             ty_auto_deref_stability(\n                                 cx,\n-                                cx.tcx.erase_late_bound_regions(cx.tcx.fn_sig(id).input(i + 1)),\n+                                cx.tcx.erase_late_bound_regions(cx.tcx.bound_fn_sig(id).subst_identity().input(i + 1)),\n                                 precedence,\n                             )\n                             .position_for_arg()\n@@ -1093,7 +1093,7 @@ fn needless_borrow_impl_arg_position<'tcx>(\n     let sized_trait_def_id = cx.tcx.lang_items().sized_trait();\n \n     let Some(callee_def_id) = fn_def_id(cx, parent) else { return Position::Other(precedence) };\n-    let fn_sig = cx.tcx.fn_sig(callee_def_id).skip_binder();\n+    let fn_sig = cx.tcx.bound_fn_sig(callee_def_id).subst_identity().skip_binder();\n     let substs_with_expr_ty = cx\n         .typeck_results()\n         .node_substs(if let ExprKind::Call(callee, _) = parent.kind {\n@@ -1221,7 +1221,7 @@ fn has_ref_mut_self_method(cx: &LateContext<'_>, trait_def_id: DefId) -> bool {\n         .in_definition_order()\n         .any(|assoc_item| {\n             if assoc_item.fn_has_self_parameter {\n-                let self_ty = cx.tcx.fn_sig(assoc_item.def_id).skip_binder().inputs()[0];\n+                let self_ty = cx.tcx.bound_fn_sig(assoc_item.def_id).subst_identity().skip_binder().inputs()[0];\n                 matches!(self_ty.kind(), ty::Ref(_, _, Mutability::Mut))\n             } else {\n                 false"}, {"sha": "4f0371c027c25ee44e22c2db4448e88058417b17", "filename": "src/tools/clippy/clippy_lints/src/functions/not_unsafe_ptr_arg_deref.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fnot_unsafe_ptr_arg_deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fnot_unsafe_ptr_arg_deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fnot_unsafe_ptr_arg_deref.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -58,7 +58,7 @@ fn check_raw_ptr<'tcx>(\n                     },\n                     hir::ExprKind::MethodCall(_, recv, args, _) => {\n                         let def_id = typeck.type_dependent_def_id(e.hir_id).unwrap();\n-                        if cx.tcx.fn_sig(def_id).skip_binder().unsafety == hir::Unsafety::Unsafe {\n+                        if cx.tcx.bound_fn_sig(def_id).skip_binder().skip_binder().unsafety == hir::Unsafety::Unsafe {\n                             check_arg(cx, &raw_ptrs, recv);\n                             for arg in args {\n                                 check_arg(cx, &raw_ptrs, arg);"}, {"sha": "21de62581f1c39688b6305887ef9b8d66f9577e0", "filename": "src/tools/clippy/clippy_lints/src/functions/result.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fresult.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fresult.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffunctions%2Fresult.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -21,7 +21,7 @@ fn result_err_ty<'tcx>(\n ) -> Option<(&'tcx hir::Ty<'tcx>, Ty<'tcx>)> {\n     if !in_external_macro(cx.sess(), item_span)\n         && let hir::FnRetTy::Return(hir_ty) = decl.output\n-        && let ty = cx.tcx.erase_late_bound_regions(cx.tcx.fn_sig(id).output())\n+        && let ty = cx.tcx.erase_late_bound_regions(cx.tcx.bound_fn_sig(id.into()).subst_identity().output())\n         && is_type_diagnostic_item(cx, ty, sym::Result)\n         && let ty::Adt(_, substs) = ty.kind()\n     {"}, {"sha": "d971684a3aa9cb7567e74b0ef9b734c005664b15", "filename": "src/tools/clippy/clippy_lints/src/inherent_to_string.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Finherent_to_string.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Finherent_to_string.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Finherent_to_string.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -124,7 +124,7 @@ fn show_lint(cx: &LateContext<'_>, item: &ImplItem<'_>) {\n         .expect(\"Failed to get trait ID of `Display`!\");\n \n     // Get the real type of 'self'\n-    let self_type = cx.tcx.fn_sig(item.owner_id).input(0);\n+    let self_type = cx.tcx.bound_fn_sig(item.owner_id.to_def_id()).skip_binder().input(0);\n     let self_type = self_type.skip_binder().peel_refs();\n \n     // Emit either a warning or an error"}, {"sha": "131af2fd9c381c62277443641c9353a1fa7d9b2c", "filename": "src/tools/clippy/clippy_lints/src/iter_not_returning_iterator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -66,7 +66,7 @@ impl<'tcx> LateLintPass<'tcx> for IterNotReturningIterator {\n \n fn check_sig(cx: &LateContext<'_>, name: &str, sig: &FnSig<'_>, fn_id: LocalDefId) {\n     if sig.decl.implicit_self.has_implicit_self() {\n-        let ret_ty = cx.tcx.erase_late_bound_regions(cx.tcx.fn_sig(fn_id).output());\n+        let ret_ty = cx.tcx.erase_late_bound_regions(cx.tcx.bound_fn_sig(fn_id.into()).subst_identity().output());\n         let ret_ty = cx\n             .tcx\n             .try_normalize_erasing_regions(cx.param_env, ret_ty)"}, {"sha": "121d6b9f0fe7e405e8b3ab64934641aef05ed2ee", "filename": "src/tools/clippy/clippy_lints/src/len_zero.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flen_zero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flen_zero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flen_zero.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -144,7 +144,7 @@ impl<'tcx> LateLintPass<'tcx> for LenZero {\n             if let Some(local_id) = ty_id.as_local();\n             let ty_hir_id = cx.tcx.hir().local_def_id_to_hir_id(local_id);\n             if !is_lint_allowed(cx, LEN_WITHOUT_IS_EMPTY, ty_hir_id);\n-            if let Some(output) = parse_len_output(cx, cx.tcx.fn_sig(item.owner_id).skip_binder());\n+            if let Some(output) = parse_len_output(cx, cx.tcx.bound_fn_sig(item.owner_id.to_def_id()).subst_identity().skip_binder());\n             then {\n                 let (name, kind) = match cx.tcx.hir().find(ty_hir_id) {\n                     Some(Node::ForeignItem(x)) => (x.ident.name, \"extern type\"),\n@@ -196,7 +196,7 @@ fn check_trait_items(cx: &LateContext<'_>, visited_trait: &Item<'_>, trait_items\n     fn is_named_self(cx: &LateContext<'_>, item: &TraitItemRef, name: Symbol) -> bool {\n         item.ident.name == name\n             && if let AssocItemKind::Fn { has_self } = item.kind {\n-                has_self && { cx.tcx.fn_sig(item.id.owner_id).inputs().skip_binder().len() == 1 }\n+                has_self && { cx.tcx.bound_fn_sig(item.id.owner_id.to_def_id()).skip_binder().inputs().skip_binder().len() == 1 }\n             } else {\n                 false\n             }\n@@ -224,7 +224,7 @@ fn check_trait_items(cx: &LateContext<'_>, visited_trait: &Item<'_>, trait_items\n             .any(|i| {\n                 i.kind == ty::AssocKind::Fn\n                     && i.fn_has_self_parameter\n-                    && cx.tcx.fn_sig(i.def_id).inputs().skip_binder().len() == 1\n+                    && cx.tcx.bound_fn_sig(i.def_id).skip_binder().inputs().skip_binder().len() == 1\n             });\n \n         if !is_empty_method_found {\n@@ -342,7 +342,7 @@ fn check_for_is_empty<'tcx>(\n         ),\n         Some(is_empty)\n             if !(is_empty.fn_has_self_parameter\n-                && check_is_empty_sig(cx.tcx.fn_sig(is_empty.def_id).skip_binder(), self_kind, output)) =>\n+                && check_is_empty_sig(cx.tcx.bound_fn_sig(is_empty.def_id).subst_identity().skip_binder(), self_kind, output)) =>\n         {\n             (\n                 format!(\n@@ -473,7 +473,7 @@ fn has_is_empty(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n     /// Gets an `AssocItem` and return true if it matches `is_empty(self)`.\n     fn is_is_empty(cx: &LateContext<'_>, item: &ty::AssocItem) -> bool {\n         if item.kind == ty::AssocKind::Fn {\n-            let sig = cx.tcx.fn_sig(item.def_id);\n+            let sig = cx.tcx.bound_fn_sig(item.def_id).skip_binder();\n             let ty = sig.skip_binder();\n             ty.inputs().len() == 1\n         } else {"}, {"sha": "3e025bc0e71607d1f9010190988045cae7a26a59", "filename": "src/tools/clippy/clippy_lints/src/loops/needless_range_loop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -370,7 +370,7 @@ impl<'a, 'tcx> Visitor<'tcx> for VarVisitor<'a, 'tcx> {\n             ExprKind::MethodCall(_, receiver, args, _) => {\n                 let def_id = self.cx.typeck_results().type_dependent_def_id(expr.hir_id).unwrap();\n                 for (ty, expr) in iter::zip(\n-                    self.cx.tcx.fn_sig(def_id).inputs().skip_binder(),\n+                    self.cx.tcx.bound_fn_sig(def_id).subst_identity().inputs().skip_binder(),\n                     std::iter::once(receiver).chain(args.iter()),\n                 ) {\n                     self.prefer_mutable = false;"}, {"sha": "a179dd091e42126634056e3d0a30432339cd393a", "filename": "src/tools/clippy/clippy_lints/src/map_unit_fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmap_unit_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmap_unit_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmap_unit_fn.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -104,7 +104,7 @@ fn is_unit_function(cx: &LateContext<'_>, expr: &hir::Expr<'_>) -> bool {\n     let ty = cx.typeck_results().expr_ty(expr);\n \n     if let ty::FnDef(id, _) = *ty.kind() {\n-        if let Some(fn_type) = cx.tcx.fn_sig(id).no_bound_vars() {\n+        if let Some(fn_type) = cx.tcx.bound_fn_sig(id).subst_identity().no_bound_vars() {\n             return is_unit_type(fn_type.output());\n         }\n     }"}, {"sha": "3f670ebc9178b6a3526b5d8cdd23372a044ad09a", "filename": "src/tools/clippy/clippy_lints/src/methods/expect_fun_call.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -70,7 +70,7 @@ pub(super) fn check<'tcx>(\n                 if let hir::ExprKind::Path(ref p) = fun.kind {\n                     match cx.qpath_res(p, fun.hir_id) {\n                         hir::def::Res::Def(hir::def::DefKind::Fn | hir::def::DefKind::AssocFn, def_id) => matches!(\n-                            cx.tcx.fn_sig(def_id).output().skip_binder().kind(),\n+                            cx.tcx.bound_fn_sig(def_id).subst_identity().output().skip_binder().kind(),\n                             ty::Ref(re, ..) if re.is_static(),\n                         ),\n                         _ => false,\n@@ -84,7 +84,7 @@ pub(super) fn check<'tcx>(\n                     .type_dependent_def_id(arg.hir_id)\n                     .map_or(false, |method_id| {\n                         matches!(\n-                            cx.tcx.fn_sig(method_id).output().skip_binder().kind(),\n+                            cx.tcx.bound_fn_sig(method_id).subst_identity().output().skip_binder().kind(),\n                             ty::Ref(re, ..) if re.is_static()\n                         )\n                     })"}, {"sha": "6002ef1340bea23e59939a53da1bf3800ac40754", "filename": "src/tools/clippy/clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -3352,7 +3352,7 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n \n         let implements_trait = matches!(item.kind, hir::ItemKind::Impl(hir::Impl { of_trait: Some(_), .. }));\n         if let hir::ImplItemKind::Fn(ref sig, id) = impl_item.kind {\n-            let method_sig = cx.tcx.fn_sig(impl_item.owner_id);\n+            let method_sig = cx.tcx.bound_fn_sig(impl_item.owner_id.to_def_id()).subst_identity();\n             let method_sig = cx.tcx.erase_late_bound_regions(method_sig);\n             let first_arg_ty_opt = method_sig.inputs().iter().next().copied();\n             // if this impl block implements a trait, lint in trait definition instead"}, {"sha": "1a1715d03a7cb3d741cb7361b13cdce3cad64822", "filename": "src/tools/clippy/clippy_lints/src/methods/needless_collect.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -137,7 +137,7 @@ pub(super) fn check<'tcx>(\n /// Checks if the given method call matches the expected signature of `([&[mut]] self) -> bool`\n fn is_is_empty_sig(cx: &LateContext<'_>, call_id: HirId) -> bool {\n     cx.typeck_results().type_dependent_def_id(call_id).map_or(false, |id| {\n-        let sig = cx.tcx.fn_sig(id).skip_binder();\n+        let sig = cx.tcx.bound_fn_sig(id).subst_identity().skip_binder();\n         sig.inputs().len() == 1 && sig.output().is_bool()\n     })\n }\n@@ -165,7 +165,7 @@ fn iterates_same_ty<'tcx>(cx: &LateContext<'tcx>, iter_ty: Ty<'tcx>, collect_ty:\n fn is_contains_sig(cx: &LateContext<'_>, call_id: HirId, iter_expr: &Expr<'_>) -> bool {\n     let typeck = cx.typeck_results();\n     if let Some(id) = typeck.type_dependent_def_id(call_id)\n-        && let sig = cx.tcx.fn_sig(id)\n+        && let sig = cx.tcx.bound_fn_sig(id).subst_identity()\n         && sig.skip_binder().output().is_bool()\n         && let [_, search_ty] = *sig.skip_binder().inputs()\n         && let ty::Ref(_, search_ty, Mutability::Not) = *cx.tcx.erase_late_bound_regions(sig.rebind(search_ty)).kind()"}, {"sha": "8036e787aaecc6ecba24cf298232036f91fe1810", "filename": "src/tools/clippy/clippy_lints/src/methods/unnecessary_to_owned.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_to_owned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_to_owned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_to_owned.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -246,7 +246,7 @@ fn check_other_call_arg<'tcx>(\n     if_chain! {\n         if let Some((maybe_call, maybe_arg)) = skip_addr_of_ancestors(cx, expr);\n         if let Some((callee_def_id, _, recv, call_args)) = get_callee_substs_and_args(cx, maybe_call);\n-        let fn_sig = cx.tcx.fn_sig(callee_def_id).skip_binder();\n+        let fn_sig = cx.tcx.bound_fn_sig(callee_def_id).subst_identity().skip_binder();\n         if let Some(i) = recv.into_iter().chain(call_args).position(|arg| arg.hir_id == maybe_arg.hir_id);\n         if let Some(input) = fn_sig.inputs().get(i);\n         let (input, n_refs) = peel_mid_ty_refs(*input);\n@@ -386,7 +386,7 @@ fn can_change_type<'a>(cx: &LateContext<'a>, mut expr: &'a Expr<'a>, mut ty: Ty<\n             Node::Expr(parent_expr) => {\n                 if let Some((callee_def_id, call_substs, recv, call_args)) = get_callee_substs_and_args(cx, parent_expr)\n                 {\n-                    let fn_sig = cx.tcx.fn_sig(callee_def_id).skip_binder();\n+                    let fn_sig = cx.tcx.bound_fn_sig(callee_def_id).subst_identity().skip_binder();\n                     if let Some(arg_index) = recv.into_iter().chain(call_args).position(|arg| arg.hir_id == expr.hir_id)\n                         && let Some(param_ty) = fn_sig.inputs().get(arg_index)\n                         && let ty::Param(ParamTy { index: param_index , ..}) = param_ty.kind()"}, {"sha": "a2868883673f5979889e8cfba6c92c8f73d8d019", "filename": "src/tools/clippy/clippy_lints/src/mut_key.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmut_key.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmut_key.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmut_key.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -138,7 +138,7 @@ impl MutableKeyType {\n \n     fn check_sig(&self, cx: &LateContext<'_>, item_hir_id: hir::HirId, decl: &hir::FnDecl<'_>) {\n         let fn_def_id = cx.tcx.hir().local_def_id(item_hir_id);\n-        let fn_sig = cx.tcx.fn_sig(fn_def_id);\n+        let fn_sig = cx.tcx.bound_fn_sig(fn_def_id.into()).subst_identity();\n         for (hir_ty, ty) in iter::zip(decl.inputs, fn_sig.inputs().skip_binder()) {\n             self.check_ty_(cx, hir_ty.span, *ty);\n         }"}, {"sha": "e3d25603a7157bda8882e00eb25bae4b099d314c", "filename": "src/tools/clippy/clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -147,7 +147,7 @@ impl<'tcx> LateLintPass<'tcx> for NeedlessPassByValue {\n             ctx\n         };\n \n-        let fn_sig = cx.tcx.fn_sig(fn_def_id);\n+        let fn_sig = cx.tcx.bound_fn_sig(fn_def_id.into()).subst_identity();\n         let fn_sig = cx.tcx.erase_late_bound_regions(fn_sig);\n \n         for (idx, ((input, &ty), arg)) in decl.inputs.iter().zip(fn_sig.inputs()).zip(body.params).enumerate() {"}, {"sha": "5512109c6cbb1255f71c5fdd8e5e13c87665a051", "filename": "src/tools/clippy/clippy_lints/src/pass_by_ref_or_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fpass_by_ref_or_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fpass_by_ref_or_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fpass_by_ref_or_value.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -143,7 +143,7 @@ impl<'tcx> PassByRefOrValue {\n             return;\n         }\n \n-        let fn_sig = cx.tcx.fn_sig(def_id);\n+        let fn_sig = cx.tcx.bound_fn_sig(def_id.into()).subst_identity();\n         let fn_body = cx.enclosing_body.map(|id| cx.tcx.hir().body(id));\n \n         // Gather all the lifetimes found in the output type which may affect whether"}, {"sha": "0a2d35015f57318d5b862dc35c61f3affa929dd3", "filename": "src/tools/clippy/clippy_lints/src/ptr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -164,7 +164,7 @@ impl<'tcx> LateLintPass<'tcx> for Ptr {\n             check_mut_from_ref(cx, sig, None);\n             for arg in check_fn_args(\n                 cx,\n-                cx.tcx.fn_sig(item.owner_id).skip_binder().inputs(),\n+                cx.tcx.bound_fn_sig(item.owner_id.to_def_id()).subst_identity().skip_binder().inputs(),\n                 sig.decl.inputs,\n                 &[],\n             )\n@@ -217,7 +217,7 @@ impl<'tcx> LateLintPass<'tcx> for Ptr {\n \n         check_mut_from_ref(cx, sig, Some(body));\n         let decl = sig.decl;\n-        let sig = cx.tcx.fn_sig(item_id).skip_binder();\n+        let sig = cx.tcx.bound_fn_sig(item_id.to_def_id()).subst_identity().skip_binder();\n         let lint_args: Vec<_> = check_fn_args(cx, sig.inputs(), decl.inputs, body.params)\n             .filter(|arg| !is_trait_item || arg.mutability() == Mutability::Not)\n             .collect();\n@@ -624,7 +624,7 @@ fn check_ptr_arg_usage<'tcx>(cx: &LateContext<'tcx>, body: &'tcx Body<'_>, args:\n                             return;\n                         };\n \n-                        match *self.cx.tcx.fn_sig(id).skip_binder().inputs()[i].peel_refs().kind() {\n+                        match *self.cx.tcx.bound_fn_sig(id).subst_identity().skip_binder().inputs()[i].peel_refs().kind() {\n                             ty::Dynamic(preds, _, _) if !matches_preds(self.cx, args.deref_ty.ty(self.cx), preds) => {\n                                 set_skip_flag();\n                             },"}, {"sha": "f3c5033060433a7d77f1ad97d79bc4744ac3ceb3", "filename": "src/tools/clippy/clippy_lints/src/returns.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -287,7 +287,8 @@ fn last_statement_borrows<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'tcx>)\n         if let Some(def_id) = fn_def_id(cx, e)\n             && cx\n                 .tcx\n-                .fn_sig(def_id)\n+                .bound_fn_sig(def_id)\n+                .subst_identity()\n                 .skip_binder()\n                 .output()\n                 .walk()"}, {"sha": "5df26d8b0a38ce9d7b8d80bc3fb96cf533c6ea21", "filename": "src/tools/clippy/clippy_lints/src/unit_return_expecting_ord.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_return_expecting_ord.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_return_expecting_ord.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_return_expecting_ord.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -76,7 +76,7 @@ fn get_projection_pred<'tcx>(\n fn get_args_to_check<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'tcx>) -> Vec<(usize, String)> {\n     let mut args_to_check = Vec::new();\n     if let Some(def_id) = cx.typeck_results().type_dependent_def_id(expr.hir_id) {\n-        let fn_sig = cx.tcx.fn_sig(def_id);\n+        let fn_sig = cx.tcx.bound_fn_sig(def_id).subst_identity();\n         let generics = cx.tcx.predicates_of(def_id);\n         let fn_mut_preds = get_trait_predicates_for_trait_id(cx, generics, cx.tcx.lang_items().fn_mut_trait());\n         let ord_preds = get_trait_predicates_for_trait_id(cx, generics, cx.tcx.get_diagnostic_item(sym::Ord));"}, {"sha": "681e59a1575d4c2115dc4245e76a3d8aad6da28d", "filename": "src/tools/clippy/clippy_lints/src/unit_types/let_unit_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -156,7 +156,7 @@ fn needs_inferred_result_ty(\n         },\n         _ => return false,\n     };\n-    let sig = cx.tcx.fn_sig(id).skip_binder();\n+    let sig = cx.tcx.bound_fn_sig(id).subst_identity().skip_binder();\n     if let ty::Param(output_ty) = *sig.output().kind() {\n         let args: Vec<&Expr<'_>> = if let Some(receiver) = receiver {\n             std::iter::once(receiver).chain(args.iter()).collect()"}, {"sha": "09324fd92943cae08c2bc964d8ffa9438a5f537d", "filename": "src/tools/clippy/clippy_lints/src/use_self.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fuse_self.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -146,7 +146,7 @@ impl<'tcx> LateLintPass<'tcx> for UseSelf {\n                     .associated_item(impl_item.owner_id)\n                     .trait_item_def_id\n                     .expect(\"impl method matches a trait method\");\n-                let trait_method_sig = cx.tcx.fn_sig(trait_method);\n+                let trait_method_sig = cx.tcx.bound_fn_sig(trait_method).subst_identity();\n                 let trait_method_sig = cx.tcx.erase_late_bound_regions(trait_method_sig);\n \n                 // `impl_inputs_outputs` is an iterator over the types (`hir::Ty`) declared in the"}, {"sha": "38588e32dbfe9cfac23c3a6d818876ff1767ff88", "filename": "src/tools/clippy/clippy_utils/src/eager_or_lazy.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Feager_or_lazy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Feager_or_lazy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Feager_or_lazy.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -79,7 +79,7 @@ fn fn_eagerness(cx: &LateContext<'_>, fn_id: DefId, name: Symbol, have_one_arg:\n             && subs.types().all(|x| matches!(x.peel_refs().kind(), ty::Param(_)))\n         {\n             // Limit the function to either `(self) -> bool` or `(&self) -> bool`\n-            match &**cx.tcx.fn_sig(fn_id).skip_binder().inputs_and_output {\n+            match &**cx.tcx.bound_fn_sig(fn_id).subst_identity().skip_binder().inputs_and_output {\n                 [arg, res] if !arg.is_mutable_ptr() && arg.peel_refs() == ty && res.is_bool() => NoChange,\n                 _ => Lazy,\n             }"}, {"sha": "ccc5f3503d2f58c9b063947680153b3e7157772c", "filename": "src/tools/clippy/clippy_utils/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Flib.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -1379,7 +1379,7 @@ pub fn get_enclosing_loop_or_multi_call_closure<'tcx>(\n                                     .chain(args.iter())\n                                     .position(|arg| arg.hir_id == id)?;\n                                 let id = cx.typeck_results().type_dependent_def_id(e.hir_id)?;\n-                                let ty = cx.tcx.fn_sig(id).skip_binder().inputs()[i];\n+                                let ty = cx.tcx.bound_fn_sig(id).subst_identity().skip_binder().inputs()[i];\n                                 ty_is_fn_once_param(cx.tcx, ty, cx.tcx.param_env(id).caller_bounds()).then_some(())\n                             },\n                             _ => None,\n@@ -1580,14 +1580,14 @@ pub fn is_direct_expn_of(span: Span, name: &str) -> Option<Span> {\n /// Convenience function to get the return type of a function.\n pub fn return_ty<'tcx>(cx: &LateContext<'tcx>, fn_item: hir::HirId) -> Ty<'tcx> {\n     let fn_def_id = cx.tcx.hir().local_def_id(fn_item);\n-    let ret_ty = cx.tcx.fn_sig(fn_def_id).output();\n+    let ret_ty = cx.tcx.bound_fn_sig(fn_def_id.into()).subst_identity().output();\n     cx.tcx.erase_late_bound_regions(ret_ty)\n }\n \n /// Convenience function to get the nth argument type of a function.\n pub fn nth_arg<'tcx>(cx: &LateContext<'tcx>, fn_item: hir::HirId, nth: usize) -> Ty<'tcx> {\n     let fn_def_id = cx.tcx.hir().local_def_id(fn_item);\n-    let arg = cx.tcx.fn_sig(fn_def_id).input(nth);\n+    let arg = cx.tcx.bound_fn_sig(fn_def_id.into()).subst_identity().input(nth);\n     cx.tcx.erase_late_bound_regions(arg)\n }\n "}, {"sha": "1552e343582ee2b03a8dd62562b184df676c77f1", "filename": "src/tools/clippy/clippy_utils/src/qualify_min_const_fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fqualify_min_const_fn.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -55,7 +55,7 @@ pub fn is_min_const_fn<'tcx>(tcx: TyCtxt<'tcx>, body: &Body<'tcx>, msrv: &Msrv)\n     // impl trait is gone in MIR, so check the return type manually\n     check_ty(\n         tcx,\n-        tcx.fn_sig(def_id).output().skip_binder(),\n+        tcx.bound_fn_sig(def_id).subst_identity().output().skip_binder(),\n         body.local_decls.iter().next().unwrap().source_info.span,\n     )?;\n "}, {"sha": "d6a698bbeaa8ab9f322d77a27c7463f9b29d241e", "filename": "src/tools/clippy/clippy_utils/src/sugg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fsugg.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -885,7 +885,7 @@ impl<'tcx> DerefDelegate<'_, 'tcx> {\n                     .cx\n                     .typeck_results()\n                     .type_dependent_def_id(parent_expr.hir_id)\n-                    .map(|did| self.cx.tcx.fn_sig(did).skip_binder())\n+                    .map(|did| self.cx.tcx.bound_fn_sig(did).subst_identity().skip_binder())\n                 {\n                     std::iter::once(receiver)\n                         .chain(call_args.iter())"}, {"sha": "14fc2c1001704f4059833a01e333355d8b24d99b", "filename": "src/tools/clippy/clippy_utils/src/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fty.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -628,7 +628,7 @@ impl<'tcx> ExprFnSig<'tcx> {\n /// If the expression is function like, get the signature for it.\n pub fn expr_sig<'tcx>(cx: &LateContext<'tcx>, expr: &Expr<'_>) -> Option<ExprFnSig<'tcx>> {\n     if let Res::Def(DefKind::Fn | DefKind::Ctor(_, CtorKind::Fn) | DefKind::AssocFn, id) = path_res(cx, expr) {\n-        Some(ExprFnSig::Sig(cx.tcx.fn_sig(id), Some(id)))\n+        Some(ExprFnSig::Sig(cx.tcx.bound_fn_sig(id).subst_identity(), Some(id)))\n     } else {\n         ty_sig(cx, cx.typeck_results().expr_ty_adjusted(expr).peel_refs())\n     }"}, {"sha": "1680a40206a3a854e8ace00de2b2d3bd8a52ab6f", "filename": "src/tools/clippy/clippy_utils/src/visitors.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fvisitors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fvisitors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fvisitors.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -392,12 +392,12 @@ pub fn is_expr_unsafe<'tcx>(cx: &LateContext<'tcx>, e: &'tcx Expr<'_>) -> bool {\n                         .cx\n                         .typeck_results()\n                         .type_dependent_def_id(e.hir_id)\n-                        .map_or(false, |id| self.cx.tcx.fn_sig(id).unsafety() == Unsafety::Unsafe) =>\n+                        .map_or(false, |id| self.cx.tcx.bound_fn_sig(id).skip_binder().unsafety() == Unsafety::Unsafe) =>\n                 {\n                     self.is_unsafe = true;\n                 },\n                 ExprKind::Call(func, _) => match *self.cx.typeck_results().expr_ty(func).peel_refs().kind() {\n-                    ty::FnDef(id, _) if self.cx.tcx.fn_sig(id).unsafety() == Unsafety::Unsafe => self.is_unsafe = true,\n+                    ty::FnDef(id, _) if self.cx.tcx.bound_fn_sig(id).skip_binder().unsafety() == Unsafety::Unsafe => self.is_unsafe = true,\n                     ty::FnPtr(sig) if sig.unsafety() == Unsafety::Unsafe => self.is_unsafe = true,\n                     _ => walk_expr(self, e),\n                 },"}, {"sha": "e333a66a0b3aefe558bd3290d9d6aefd2d80eaf9", "filename": "src/tools/miri/src/eval.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fmiri%2Fsrc%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e982971ff22fa190369b5f536403c37c52b10a26/src%2Ftools%2Fmiri%2Fsrc%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Feval.rs?ref=e982971ff22fa190369b5f536403c37c52b10a26", "patch": "@@ -357,7 +357,7 @@ pub fn create_ecx<'mir, 'tcx: 'mir>(\n     match entry_type {\n         EntryFnType::Main { .. } => {\n             let start_id = tcx.lang_items().start_fn().unwrap();\n-            let main_ret_ty = tcx.fn_sig(entry_id).output();\n+            let main_ret_ty = tcx.bound_fn_sig(entry_id).subst_identity().output();\n             let main_ret_ty = main_ret_ty.no_bound_vars().unwrap();\n             let start_instance = ty::Instance::resolve(\n                 tcx,"}]}