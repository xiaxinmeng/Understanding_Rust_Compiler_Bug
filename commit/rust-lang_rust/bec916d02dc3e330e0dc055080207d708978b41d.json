{"sha": "bec916d02dc3e330e0dc055080207d708978b41d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlYzkxNmQwMmRjM2UzMzBlMGRjMDU1MDgwMjA3ZDcwODk3OGI0MWQ=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-12-18T12:21:13Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-01-23T01:18:11Z"}, "message": "cargo dev crater: lay out the base plan", "tree": {"sha": "6f6132301286a2acadc6a94ebf340fbb7c923b6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f6132301286a2acadc6a94ebf340fbb7c923b6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bec916d02dc3e330e0dc055080207d708978b41d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bec916d02dc3e330e0dc055080207d708978b41d", "html_url": "https://github.com/rust-lang/rust/commit/bec916d02dc3e330e0dc055080207d708978b41d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bec916d02dc3e330e0dc055080207d708978b41d/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70386ff352cd08b29e1810c098a8e73ee20b7770", "url": "https://api.github.com/repos/rust-lang/rust/commits/70386ff352cd08b29e1810c098a8e73ee20b7770", "html_url": "https://github.com/rust-lang/rust/commit/70386ff352cd08b29e1810c098a8e73ee20b7770"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "fe0fc440316cacdc33f554ab45371e5c2f5ea1a3", "filename": "clippy_dev/src/crater.rs", "status": "added", "additions": 69, "deletions": 0, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/bec916d02dc3e330e0dc055080207d708978b41d/clippy_dev%2Fsrc%2Fcrater.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bec916d02dc3e330e0dc055080207d708978b41d/clippy_dev%2Fsrc%2Fcrater.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fcrater.rs?ref=bec916d02dc3e330e0dc055080207d708978b41d", "patch": "@@ -0,0 +1,69 @@\n+use std::path::PathBuf;\n+use std::process::Command;\n+\n+// represents an archive we download from crates.io\n+struct KrateSource {\n+    version: String,\n+    name: String,\n+}\n+\n+// represents the extracted sourcecode of a crate\n+struct Krate {\n+    version: String,\n+    name: String,\n+}\n+\n+impl KrateSource {\n+    fn new(version: &str, name: &str) -> Self {\n+        KrateSource {\n+            version: version.into(),\n+            name: name.into(),\n+        }\n+    }\n+    fn download_and_extract(self) -> Krate {\n+        // download\n+        // extract\n+\n+        Krate {\n+            version: self.version,\n+            name: self.name,\n+        }\n+    }\n+}\n+\n+impl Krate {\n+    fn run_clippy_lints(&self) -> String {\n+        todo!();\n+    }\n+\n+\n+}\n+\n+fn build_clippy() {\n+    Command::new(\"cargo\")\n+        .arg(\"build\")\n+        .output()\n+        .expect(\"Failed to build clippy!\");\n+}\n+\n+// the main fn\n+pub(crate) fn run() {\n+    let cargo_clippy_path: PathBuf = PathBuf::from(\"target/debug/cargo-clippy\");\n+    let clippy_driver_path: PathBuf = PathBuf::from(\"target/debug/cargo-driver\");\n+\n+    // crates we want to check:\n+    let krates: Vec<KrateSource> = vec![KrateSource::new(\"cargo\", \"0.49.0\"), KrateSource::new(\"regex\", \"1.4.2\")];\n+\n+    build_clippy();\n+    // assert that clippy is found\n+    assert!(\n+        cargo_clippy_path.is_file(),\n+        \"target/debug/cargo-clippy binary not found!\"\n+    );\n+    assert!(\n+        clippy_driver_path.is_file(),\n+        \"target/debug/clippy-driver binary not found!\"\n+    );\n+\n+  let clippy_lint_results: Vec<String> = krates.into_iter().map(|krate|  krate.download_and_extract()).map(|krate| krate.run_clippy_lints()).collect::<Vec<String>>();\n+}"}, {"sha": "4873769b367e9cbccde6dc8fd9c2a193057ad1f2", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bec916d02dc3e330e0dc055080207d708978b41d/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bec916d02dc3e330e0dc055080207d708978b41d/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=bec916d02dc3e330e0dc055080207d708978b41d", "patch": "@@ -11,6 +11,7 @@ use std::path::{Path, PathBuf};\n use walkdir::WalkDir;\n \n pub mod bless;\n+pub mod crater;\n pub mod fmt;\n pub mod new_lint;\n pub mod ra_setup;"}]}