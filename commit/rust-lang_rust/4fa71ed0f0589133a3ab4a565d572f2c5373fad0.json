{"sha": "4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "node_id": "C_kwDOAAsO6NoAKDRmYTcxZWQwZjA1ODkxMzNhM2FiNGE1NjVkNTcyZjJjNTM3M2ZhZDA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-19T05:45:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-19T05:45:28Z"}, "message": "Rollup merge of #92902 - ssomers:docter_drain, r=yaahc\n\nImprove the documentation of drain members\n\nhopefully fixes #92765", "tree": {"sha": "986c08474703099b4e882fd2bd322bcb2a03c623", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/986c08474703099b4e882fd2bd322bcb2a03c623"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiEIP4CRBK7hj4Ov3rIwAA/64IAK8Gk+wfpDZGBCEg1QTw7k8t\nv5AaQlnruFZGgr8NY3pzODtg05fLbFTTl/WS4V/i6VDj7LRr5jrgk//e/hpluUou\nZ8Q0B+Jhm/R3XVzPQ44+P8kQthuoxV0x44QrZJfESQFa7nvZHIn4mzuQjjYve/4q\nANDPQJGcfwHpNbhUBaobO5WWGyzcduYs+BCRfOEop6ZNfExtGG+hxtGkQs3jNxz9\nRtJzTLU1sfQrC3+6SHCaiKSgWkLECyeary2jLuH5etxySqLnBghRpoUSwQ/lLen2\nlBKV/lz9OJfAOjAG75iumKWHbWrCDrvL0ReodsdUekjRMj2efExYmJDGV621UvE=\n=9k6l\n-----END PGP SIGNATURE-----\n", "payload": "tree 986c08474703099b4e882fd2bd322bcb2a03c623\nparent 1882597991277f9467d2a187f180f76eecf45c9c\nparent a677e6084049ff4cb2e338d7e33dc034846cdb29\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1645249528 +0100\ncommitter GitHub <noreply@github.com> 1645249528 +0100\n\nRollup merge of #92902 - ssomers:docter_drain, r=yaahc\n\nImprove the documentation of drain members\n\nhopefully fixes #92765\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "html_url": "https://github.com/rust-lang/rust/commit/4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1882597991277f9467d2a187f180f76eecf45c9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1882597991277f9467d2a187f180f76eecf45c9c", "html_url": "https://github.com/rust-lang/rust/commit/1882597991277f9467d2a187f180f76eecf45c9c"}, {"sha": "a677e6084049ff4cb2e338d7e33dc034846cdb29", "url": "https://api.github.com/repos/rust-lang/rust/commits/a677e6084049ff4cb2e338d7e33dc034846cdb29", "html_url": "https://github.com/rust-lang/rust/commit/a677e6084049ff4cb2e338d7e33dc034846cdb29"}], "stats": {"total": 83, "additions": 57, "deletions": 26}, "files": [{"sha": "e18cd8cd46427ac7c70d9b9500e86751a9c4cace", "filename": "library/alloc/src/collections/binary_heap.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -746,9 +746,12 @@ impl<T: Ord> BinaryHeap<T> {\n         self.rebuild_tail(start);\n     }\n \n-    /// Returns an iterator which retrieves elements in heap order.\n-    /// The retrieved elements are removed from the original heap.\n-    /// The remaining elements will be removed on drop in heap order.\n+    /// Clears the binary heap, returning an iterator over the removed elements\n+    /// in heap order. If the iterator is dropped before being fully consumed,\n+    /// it drops the remaining elements in heap order.\n+    ///\n+    /// The returned iterator keeps a mutable borrow on the heap to optimize\n+    /// its implementation.\n     ///\n     /// Note:\n     /// * `.drain_sorted()` is *O*(*n* \\* log(*n*)); much slower than `.drain()`.\n@@ -1158,9 +1161,12 @@ impl<T> BinaryHeap<T> {\n         self.len() == 0\n     }\n \n-    /// Clears the binary heap, returning an iterator over the removed elements.\n+    /// Clears the binary heap, returning an iterator over the removed elements\n+    /// in arbitrary order. If the iterator is dropped before being fully\n+    /// consumed, it drops the remaining elements in arbitrary order.\n     ///\n-    /// The elements are removed in arbitrary order.\n+    /// The returned iterator keeps a mutable borrow on the heap to optimize\n+    /// its implementation.\n     ///\n     /// # Examples\n     ///"}, {"sha": "7139a0fb94d76752372e8af27767274028bf30f4", "filename": "library/alloc/src/collections/vec_deque/mod.rs", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -1215,21 +1215,25 @@ impl<T, A: Allocator> VecDeque<T, A> {\n         unsafe { IterMut::new(ring, tail, head, PhantomData) }\n     }\n \n-    /// Creates a draining iterator that removes the specified range in the\n-    /// deque and yields the removed items.\n+    /// Removes the specified range from the deque in bulk, returning all\n+    /// removed elements as an iterator. If the iterator is dropped before\n+    /// being fully consumed, it drops the remaining removed elements.\n     ///\n-    /// Note 1: The element range is removed even if the iterator is not\n-    /// consumed until the end.\n+    /// The returned iterator keeps a mutable borrow on the queue to optimize\n+    /// its implementation.\n     ///\n-    /// Note 2: It is unspecified how many elements are removed from the deque,\n-    /// if the `Drain` value is not dropped, but the borrow it holds expires\n-    /// (e.g., due to `mem::forget`).\n     ///\n     /// # Panics\n     ///\n     /// Panics if the starting point is greater than the end point or if\n     /// the end point is greater than the length of the deque.\n     ///\n+    /// # Leaking\n+    ///\n+    /// If the returned iterator goes out of scope without being dropped (due to\n+    /// [`mem::forget`], for example), the deque may have lost and leaked\n+    /// elements arbitrarily, including elements outside the range.\n+    ///\n     /// # Examples\n     ///\n     /// ```\n@@ -1240,7 +1244,7 @@ impl<T, A: Allocator> VecDeque<T, A> {\n     /// assert_eq!(drained, [3]);\n     /// assert_eq!(deque, [1, 2]);\n     ///\n-    /// // A full range clears all contents\n+    /// // A full range clears all contents, like `clear()` does\n     /// deque.drain(..);\n     /// assert!(deque.is_empty());\n     /// ```"}, {"sha": "716bb4983a651f2cb581862d21ad92f4e62e69c6", "filename": "library/alloc/src/string.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fstring.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -1628,17 +1628,24 @@ impl String {\n         self.vec.clear()\n     }\n \n-    /// Creates a draining iterator that removes the specified range in the `String`\n-    /// and yields the removed `chars`.\n+    /// Removes the specified range from the string in bulk, returning all\n+    /// removed characters as an iterator.\n     ///\n-    /// Note: The element range is removed even if the iterator is not\n-    /// consumed until the end.\n+    /// The returned iterator keeps a mutable borrow on the string to optimize\n+    /// its implementation.\n     ///\n     /// # Panics\n     ///\n     /// Panics if the starting point or end point do not lie on a [`char`]\n     /// boundary, or if they're out of bounds.\n     ///\n+    /// # Leaking\n+    ///\n+    /// If the returned iterator goes out of scope without being dropped (due to\n+    /// [`core::mem::forget`], for example), the string may still contain a copy\n+    /// of any drained characters, or may have lost characters arbitrarily,\n+    /// including characters outside the range.\n+    ///\n     /// # Examples\n     ///\n     /// Basic usage:\n@@ -1652,7 +1659,7 @@ impl String {\n     /// assert_eq!(t, \"\u03b1 is alpha, \");\n     /// assert_eq!(s, \"\u03b2 is beta\");\n     ///\n-    /// // A full range clears the string\n+    /// // A full range clears the string, like `clear()` does\n     /// s.drain(..);\n     /// assert_eq!(s, \"\");\n     /// ```"}, {"sha": "c29aa0fec5b87faf7e74488a1352d5e83c9b2bf7", "filename": "library/alloc/src/vec/mod.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -1799,19 +1799,24 @@ impl<T, A: Allocator> Vec<T, A> {\n         self.len += count;\n     }\n \n-    /// Creates a draining iterator that removes the specified range in the vector\n-    /// and yields the removed items.\n+    /// Removes the specified range from the vector in bulk, returning all\n+    /// removed elements as an iterator. If the iterator is dropped before\n+    /// being fully consumed, it drops the remaining removed elements.\n     ///\n-    /// When the iterator **is** dropped, all elements in the range are removed\n-    /// from the vector, even if the iterator was not fully consumed. If the\n-    /// iterator **is not** dropped (with [`mem::forget`] for example), it is\n-    /// unspecified how many elements are removed.\n+    /// The returned iterator keeps a mutable borrow on the vector to optimize\n+    /// its implementation.\n     ///\n     /// # Panics\n     ///\n     /// Panics if the starting point is greater than the end point or if\n     /// the end point is greater than the length of the vector.\n     ///\n+    /// # Leaking\n+    ///\n+    /// If the returned iterator goes out of scope without being dropped (due to\n+    /// [`mem::forget`], for example), the vector may have lost and leaked\n+    /// elements arbitrarily, including elements outside the range.\n+    ///\n     /// # Examples\n     ///\n     /// ```\n@@ -1820,7 +1825,7 @@ impl<T, A: Allocator> Vec<T, A> {\n     /// assert_eq!(v, &[1]);\n     /// assert_eq!(u, &[2, 3]);\n     ///\n-    /// // A full range clears the vector\n+    /// // A full range clears the vector, like `clear()` does\n     /// v.drain(..);\n     /// assert_eq!(v, &[]);\n     /// ```"}, {"sha": "c9d91d2c03bf5790409ab0d64e5755154d5a71d4", "filename": "library/std/src/collections/hash/map.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fmap.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -547,6 +547,10 @@ impl<K, V, S> HashMap<K, V, S> {\n     /// Clears the map, returning all key-value pairs as an iterator. Keeps the\n     /// allocated memory for reuse.\n     ///\n+    /// If the returned iterator is dropped before being fully consumed, it\n+    /// drops the remaining key-value pairs. The returned iterator keeps a\n+    /// mutable borrow on the vector to optimize its implementation.\n+    ///\n     /// # Examples\n     ///\n     /// ```"}, {"sha": "200667ae390697c390bc9f466c5933035eb4baff", "filename": "library/std/src/collections/hash/set.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fa71ed0f0589133a3ab4a565d572f2c5373fad0/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fcollections%2Fhash%2Fset.rs?ref=4fa71ed0f0589133a3ab4a565d572f2c5373fad0", "patch": "@@ -227,7 +227,12 @@ impl<T, S> HashSet<T, S> {\n         self.base.is_empty()\n     }\n \n-    /// Clears the set, returning all elements in an iterator.\n+    /// Clears the set, returning all elements as an iterator. Keeps the\n+    /// allocated memory for reuse.\n+    ///\n+    /// If the returned iterator is dropped before being fully consumed, it\n+    /// drops the remaining elements. The returned iterator keeps a mutable\n+    /// borrow on the vector to optimize its implementation.\n     ///\n     /// # Examples\n     ///"}]}