{"sha": "399fe5d0cd93f7b78e6464111546788c43ba1f61", "node_id": "C_kwDOAAsO6NoAKDM5OWZlNWQwY2Q5M2Y3Yjc4ZTY0NjQxMTE1NDY3ODhjNDNiYTFmNjE", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-12-31T18:23:30Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-01-02T02:52:30Z"}, "message": "rustdoc: add test case for dir entry summary position", "tree": {"sha": "bf5a47cf8d3effb71bded099dbcae547da506023", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf5a47cf8d3effb71bded099dbcae547da506023"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/399fe5d0cd93f7b78e6464111546788c43ba1f61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/399fe5d0cd93f7b78e6464111546788c43ba1f61", "html_url": "https://github.com/rust-lang/rust/commit/399fe5d0cd93f7b78e6464111546788c43ba1f61", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/399fe5d0cd93f7b78e6464111546788c43ba1f61/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd0f5882d969fd17ab0152b9bc7b957bc78e6004", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd0f5882d969fd17ab0152b9bc7b957bc78e6004", "html_url": "https://github.com/rust-lang/rust/commit/dd0f5882d969fd17ab0152b9bc7b957bc78e6004"}], "stats": {"total": 89, "additions": 85, "deletions": 4}, "files": [{"sha": "aa79219696020726ead0c3ed38077cf6ebc3aa6e", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 85, "deletions": 4, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/399fe5d0cd93f7b78e6464111546788c43ba1f61/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/399fe5d0cd93f7b78e6464111546788c43ba1f61/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=399fe5d0cd93f7b78e6464111546788c43ba1f61", "patch": "@@ -111,8 +111,57 @@ assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"true\"})\n click: \"#source-sidebar details:first-of-type > summary\"\n assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"false\"})\n \n-// Check the spacing.\n-assert-css: (\"#source-sidebar > details.dir-entry\", {\"padding-left\": \"4px\"})\n+// And open it again, since it'll be the reference we use to check positions.\n+click: \"#source-sidebar details:first-of-type > summary\"\n+assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"true\"})\n+\n+// Check the sidebar directory entries have a marker and spacing (desktop).\n+store-property: (\n+    link_height,\n+    \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+    \"offsetHeight\"\n+)\n+define-function: (\n+    \"check-sidebar-dir-entry\",\n+    (x, y),\n+    [\n+        (\"assert\", \"details:first-of-type.dir-entry[open] > summary::marker\"),\n+        (\"assert-css\", (\"#source-sidebar > details:first-of-type.dir-entry\", {\"padding-left\": \"4px\"})),\n+        // This check ensures that the summary is only one line.\n+       (\"assert-property\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > summary\",\n+            {\"offsetHeight\": |link_height|}\n+        )),\n+        (\"assert-position\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > summary\",\n+            {\"x\": |x|, \"y\": |y|}\n+        )),\n+        (\"assert-property\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+            {\"offsetHeight\": |link_height|}\n+        )),\n+        (\"assert-position\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+            // left margin\n+            {\"x\": |x| + 27, \"y\": |y| + |link_height|}\n+        )),\n+    ]\n+)\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    // border + margin = 6\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})\n \n // Check the search form\n assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n@@ -125,13 +174,45 @@ assert-property: (\"nav.sub form\", {\"offsetTop\": 28, \"offsetHeight\": 34})\n assert-property: (\"#main-content\", {\"offsetTop\": 90})\n // 28 = 90 - 34 - 28\n \n-// Now do the same check on moderately-sized mobile.\n+// Now do the same check on moderately-sized, tablet mobile.\n size: (700, 700)\n assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n assert-property: (\"nav.sub form\", {\"offsetTop\": 21, \"offsetHeight\": 34})\n assert-property: (\"#main-content\", {\"offsetTop\": 76})\n // 21 = 76 - 34 - 21\n \n-// Tiny mobile gets a different display where the logo is stacked on top.\n+// Check the sidebar directory entries have a marker and spacing (tablet).\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})\n+\n+// Tiny, phone mobile gets a different display where the logo is stacked on top.\n size: (450, 700)\n assert-css: (\"nav.sub\", {\"flex-direction\": \"column\"})\n+\n+// Check the sidebar directory entries have a marker and spacing (phone).\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})"}]}