{"sha": "a3bdfc40352443be01d30b2d1147d28467286882", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzYmRmYzQwMzUyNDQzYmUwMWQzMGIyZDExNDdkMjg0NjcyODY4ODI=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-03-21T21:56:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-21T21:56:22Z"}, "message": "Rollup merge of #70197 - pnkfelix:issue-53957-revise-test-of-23076, r=LukasKalbertodt\n\nFor issue 53957: revise unit test to focus on underlying bug of 23076.\n\nFix #53957 by revising unit test to focus on underlying bug of #23076.\n\nNamely, this version focuses on the end-to-end behavior that the attempt to create the UDP binding will fail, regardless of the semantics of how particular DNS servers handle junk inputs.\n\n(I spent some time trying to create a second more-focused test that would sidestep the DNS resolution, but this is not possible without more invasive changes to the internal infrastructure of `ToSocketAddrs` and what not. It is not worth it.)", "tree": {"sha": "78651d209dbf54cc040a53e0a2db116ffc1ead2d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/78651d209dbf54cc040a53e0a2db116ffc1ead2d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3bdfc40352443be01d30b2d1147d28467286882", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJedo2GCRBK7hj4Ov3rIwAAdHIIAIHrIcwGWI0nbh7gPKKls+8m\nMTnKgOqTKKCy0nn9uSc1EOvhQMB+DNRsstYagpeQqP5LpFfSinWX2bSotg3dB2Fg\n3zXYSo0AdxcEwm/a77py35uXv3LLXt3Ei6ZfXydclb/1T3ILxcs1MAc3Q7G298tc\nEn9h7kNvIG/CVrVMpuOeylB3yStA5ICmzhCiLeufXvgjWwogkzdY8+ptav82Kvv4\nIN6fqZn08EWuzIq9JWyFTbKgZL/2hcCE6ZvkfNDz/W+gCWiV3sHnZBe1bBENXKPm\nUYuyqNU7OgXJwUVwPaZnPbakLLbuEf+PnePNdNRNh5pB/AW6E3H+OJzHRKcPYN0=\n=2dso\n-----END PGP SIGNATURE-----\n", "payload": "tree 78651d209dbf54cc040a53e0a2db116ffc1ead2d\nparent ecf3ef52a6f986863cce5eb749b73e182db3f36e\nparent 3db6d1cc168d6a2be8048c34012526af1ec24213\nauthor Dylan DPC <dylan.dpc@gmail.com> 1584827782 +0100\ncommitter GitHub <noreply@github.com> 1584827782 +0100\n\nRollup merge of #70197 - pnkfelix:issue-53957-revise-test-of-23076, r=LukasKalbertodt\n\nFor issue 53957: revise unit test to focus on underlying bug of 23076.\n\nFix #53957 by revising unit test to focus on underlying bug of #23076.\n\nNamely, this version focuses on the end-to-end behavior that the attempt to create the UDP binding will fail, regardless of the semantics of how particular DNS servers handle junk inputs.\n\n(I spent some time trying to create a second more-focused test that would sidestep the DNS resolution, but this is not possible without more invasive changes to the internal infrastructure of `ToSocketAddrs` and what not. It is not worth it.)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3bdfc40352443be01d30b2d1147d28467286882", "html_url": "https://github.com/rust-lang/rust/commit/a3bdfc40352443be01d30b2d1147d28467286882", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3bdfc40352443be01d30b2d1147d28467286882/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ecf3ef52a6f986863cce5eb749b73e182db3f36e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecf3ef52a6f986863cce5eb749b73e182db3f36e", "html_url": "https://github.com/rust-lang/rust/commit/ecf3ef52a6f986863cce5eb749b73e182db3f36e"}, {"sha": "3db6d1cc168d6a2be8048c34012526af1ec24213", "url": "https://api.github.com/repos/rust-lang/rust/commits/3db6d1cc168d6a2be8048c34012526af1ec24213", "html_url": "https://github.com/rust-lang/rust/commit/3db6d1cc168d6a2be8048c34012526af1ec24213"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "de6360cf020f5740cd3a31a5ff80a5d6748be1da", "filename": "src/libstd/net/addr.rs", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/a3bdfc40352443be01d30b2d1147d28467286882/src%2Flibstd%2Fnet%2Faddr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3bdfc40352443be01d30b2d1147d28467286882/src%2Flibstd%2Fnet%2Faddr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnet%2Faddr.rs?ref=a3bdfc40352443be01d30b2d1147d28467286882", "patch": "@@ -989,11 +989,26 @@ mod tests {\n         // s has been moved into the tsa call\n     }\n \n-    // FIXME: figure out why this fails on openbsd and fix it\n     #[test]\n-    #[cfg(not(any(windows, target_os = \"openbsd\")))]\n-    fn to_socket_addr_str_bad() {\n-        assert!(tsa(\"1200::AB00:1234::2552:7777:1313:34300\").is_err());\n+    fn bind_udp_socket_bad() {\n+        // rust-lang/rust#53957: This is a regression test for a parsing problem\n+        // discovered as part of issue rust-lang/rust#23076, where we were\n+        // incorrectly parsing invalid input and then that would result in a\n+        // successful `UdpSocket` binding when we would expect failure.\n+        //\n+        // At one time, this test was written as a call to `tsa` with\n+        // INPUT_23076. However, that structure yields an unreliable test,\n+        // because it ends up passing junk input to the DNS server, and some DNS\n+        // servers will respond with `Ok` to such input, with the ip address of\n+        // the DNS server itself.\n+        //\n+        // This form of the test is more robust: even when the DNS server\n+        // returns its own address, it is still an error to bind a UDP socket to\n+        // a non-local address, and so we still get an error here in that case.\n+\n+        const INPUT_23076: &'static str = \"1200::AB00:1234::2552:7777:1313:34300\";\n+\n+        assert!(crate::net::UdpSocket::bind(INPUT_23076).is_err())\n     }\n \n     #[test]"}]}