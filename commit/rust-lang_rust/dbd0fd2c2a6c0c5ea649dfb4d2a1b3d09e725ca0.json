{"sha": "dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiZDBmZDJjMmE2YzBjNWVhNjQ5ZGZiNGQyYTFiM2QwOWU3MjVjYTA=", "commit": {"author": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-07-27T20:24:43Z"}, "committer": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-07-27T23:41:52Z"}, "message": "Fix ICE in `diagnostic_hir_wf_check`", "tree": {"sha": "94d4d48ddbd3ee9929868c7017eed7e6136ed3ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94d4d48ddbd3ee9929868c7017eed7e6136ed3ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "html_url": "https://github.com/rust-lang/rust/commit/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/comments", "author": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70f74719a92ef52bc28610ba04b7e98ada035ec9", "url": "https://api.github.com/repos/rust-lang/rust/commits/70f74719a92ef52bc28610ba04b7e98ada035ec9", "html_url": "https://github.com/rust-lang/rust/commit/70f74719a92ef52bc28610ba04b7e98ada035ec9"}], "stats": {"total": 42, "additions": 35, "deletions": 7}, "files": [{"sha": "c134af44992de8e96a6655e633f26c9168f77235", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "patch": "@@ -240,8 +240,8 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n \n         let mut err = match *error {\n             SelectionError::Unimplemented => {\n-                // If this obligation was generated as a result of well-formed checking, see if we\n-                // can get a better error message by performing HIR-based well formed checking.\n+                // If this obligation was generated as a result of well-formedness checking, see if we\n+                // can get a better error message by performing HIR-based well-formedness checking.\n                 if let ObligationCauseCode::WellFormed(Some(wf_loc)) =\n                     root_obligation.cause.code.peel_derives()\n                 {"}, {"sha": "b7ede0e4bf25175ea966b2816a29da71401bd5b8", "filename": "compiler/rustc_typeck/src/hir_wf_check.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs?ref=dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "patch": "@@ -38,20 +38,20 @@ fn diagnostic_hir_wf_check<'tcx>(\n     // given the type `Option<MyStruct<u8>>`, we will check\n     // `Option<MyStruct<u8>>`, `MyStruct<u8>`, and `u8`.\n     // For each type, we perform a well-formed check, and see if we get\n-    // an erorr that matches our expected predicate. We keep save\n+    // an error that matches our expected predicate. We save\n     // the `ObligationCause` corresponding to the *innermost* type,\n     // which is the most specific type that we can point to.\n     // In general, the different components of an `hir::Ty` may have\n-    // completely differentr spans due to macro invocations. Pointing\n+    // completely different spans due to macro invocations. Pointing\n     // to the most accurate part of the type can be the difference\n     // between a useless span (e.g. the macro invocation site)\n-    // and a useful span (e.g. a user-provided type passed in to the macro).\n+    // and a useful span (e.g. a user-provided type passed into the macro).\n     //\n     // This approach is quite inefficient - we redo a lot of work done\n     // by the normal WF checker. However, this code is run at most once\n     // per reported error - it will have no impact when compilation succeeds,\n-    // and should only have an impact if a very large number of errors are\n-    // displaydd to the user.\n+    // and should only have an impact if a very large number of errors is\n+    // displayed to the user.\n     struct HirWfCheck<'tcx> {\n         tcx: TyCtxt<'tcx>,\n         predicate: ty::Predicate<'tcx>,\n@@ -126,10 +126,12 @@ fn diagnostic_hir_wf_check<'tcx>(\n         WellFormedLoc::Ty(_) => match hir.get(hir_id) {\n             hir::Node::ImplItem(item) => match item.kind {\n                 hir::ImplItemKind::TyAlias(ty) => Some(ty),\n+                hir::ImplItemKind::Const(ty, _) => Some(ty),\n                 ref item => bug!(\"Unexpected ImplItem {:?}\", item),\n             },\n             hir::Node::TraitItem(item) => match item.kind {\n                 hir::TraitItemKind::Type(_, ty) => ty,\n+                hir::TraitItemKind::Const(ty, _) => Some(ty),\n                 ref item => bug!(\"Unexpected TraitItem {:?}\", item),\n             },\n             hir::Node::Item(item) => match item.kind {"}, {"sha": "5aab7431134bab94564098761cc928e5215e1495", "filename": "src/test/ui/wf/issue-87495.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/src%2Ftest%2Fui%2Fwf%2Fissue-87495.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/src%2Ftest%2Fui%2Fwf%2Fissue-87495.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fissue-87495.rs?ref=dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "patch": "@@ -0,0 +1,8 @@\n+// Regression test for the ICE described in #87495.\n+\n+trait T {\n+    const CONST: (bool, dyn T);\n+    //~^ ERROR: the trait `T` cannot be made into an object [E0038]\n+}\n+\n+fn main() {}"}, {"sha": "010200b5ded1f40faf3355bf3b6e09b834c152f9", "filename": "src/test/ui/wf/issue-87495.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/src%2Ftest%2Fui%2Fwf%2Fissue-87495.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0/src%2Ftest%2Fui%2Fwf%2Fissue-87495.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fissue-87495.stderr?ref=dbd0fd2c2a6c0c5ea649dfb4d2a1b3d09e725ca0", "patch": "@@ -0,0 +1,18 @@\n+error[E0038]: the trait `T` cannot be made into an object\n+  --> $DIR/issue-87495.rs:4:25\n+   |\n+LL |     const CONST: (bool, dyn T);\n+   |                         ^^^^^ `T` cannot be made into an object\n+   |\n+   = help: consider moving `CONST` to another trait\n+note: for a trait to be \"object safe\" it needs to allow building a vtable to allow the call to be resolvable dynamically; for more information visit <https://doc.rust-lang.org/reference/items/traits.html#object-safety>\n+  --> $DIR/issue-87495.rs:4:11\n+   |\n+LL | trait T {\n+   |       - this trait cannot be made into an object...\n+LL |     const CONST: (bool, dyn T);\n+   |           ^^^^^ ...because it contains this associated `const`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0038`."}]}