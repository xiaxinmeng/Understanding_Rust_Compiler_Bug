{"sha": "a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1NWFjMWZlYThmZTRjYThkOTZkMzU5YThmNWI5NTM4ZTVlOWMzNTE=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-15T10:55:04Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-15T10:55:04Z"}, "message": "pass arguments to `start`", "tree": {"sha": "cf40af8aa878a71379e25922a99d66abd4f19c39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf40af8aa878a71379e25922a99d66abd4f19c39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXYTQIAAoJEFbW7qD8Z6xGPQAQAKbiptz9SLkjnyr0PgLd//Gd\n5xg016eDqp+dbe8onF6JYW7zPSPGwaKEgOZr2Y00S8oqMXXyxIGayVYk8yCaFzdM\nEpXmSEKyORD7rrisHLLnrz2h2jlOcPGnhVCMwirs5afKeJzYw8f1URYol3d0n0iS\np5DZ6nyQZVioNbHf92vP3qNdWpej0jh2DpxhokL+j+FtTNttCNkse0RvXxZija78\n8IKp9BFAkcRy2Ee7jX4XeE5A5LYvn3imEpYybw8/uxPDvFX1NvoaogzkSGe+55U/\n5HIh6CAnn5dZjgg0cgmsFaW+RGm0KFI4inFlEEHtfOXiSUUTxgXJjLp6HRHg/cFG\nfHtkEJMjg5iGwHfDIzu6BSpLBYO8qDigGQEMx4LtsnW23uGJnQ+oHuLFgfmNhfx6\nzW8VKgU6G4zYRIxRhHPkoPscghKnIxvmsWqXT5utzNjn5zaZrmaco++gy9NipnYQ\nTWu6tHqhruWZ8z9/ZUczLFNZBy37Lh9XbbVHKQLCgbKFEroA92/HQ8Qw+kjp+i1H\nD+PYNPK3AOdYJKAc3EpDxSsM+29VlJJ2ziduiW7TubNt137S/XLzcWYr+1XJNZQx\nqN+0uzeGjc+sw9z3PtgcJCC0E+hIZxWZfu3QhjatDxshdy5pyksxjVT7O75DJIJV\n70Eu5CWCGmpengd7CTUo\n=Pw+y\n-----END PGP SIGNATURE-----", "payload": "tree cf40af8aa878a71379e25922a99d66abd4f19c39\nparent 8abd2931196beb4bea3133d32643c6634a13fa07\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1465988104 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1465988104 +0200\n\npass arguments to `start`"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "html_url": "https://github.com/rust-lang/rust/commit/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8abd2931196beb4bea3133d32643c6634a13fa07", "url": "https://api.github.com/repos/rust-lang/rust/commits/8abd2931196beb4bea3133d32643c6634a13fa07", "html_url": "https://github.com/rust-lang/rust/commit/8abd2931196beb4bea3133d32643c6634a13fa07"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "8cc52e39ca69e5b9bf45c198cead9cb87bb923bf", "filename": "src/bin/miri.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/src%2Fbin%2Fmiri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/src%2Fbin%2Fmiri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmiri.rs?ref=a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "patch": "@@ -48,6 +48,17 @@ impl<'a> CompilerCalls<'a> for MiriCompilerCalls {\n \n             ecx.push_stack_frame(def_id, mir.span, CachedMir::Ref(mir), substs, Some(return_ptr));\n \n+            if mir.arg_decls.len() == 2 {\n+                // start function\n+                let ptr_size = ecx.memory().pointer_size;\n+                let nargs = ecx.memory_mut().allocate(ptr_size);\n+                ecx.memory_mut().write_usize(nargs, 0).unwrap();\n+                let args = ecx.memory_mut().allocate(ptr_size);\n+                ecx.memory_mut().write_usize(args, 0).unwrap();\n+                ecx.frame_mut().locals[0] = nargs;\n+                ecx.frame_mut().locals[1] = args;\n+            }\n+\n             loop {\n                 match step(&mut ecx) {\n                     Ok(true) => {}"}, {"sha": "89a3b2f593eda2b1b009d6f8d65d5ed606f7fb57", "filename": "src/interpreter/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/src%2Finterpreter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/src%2Finterpreter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Finterpreter%2Fmod.rs?ref=a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "patch": "@@ -154,6 +154,10 @@ impl<'a, 'tcx> EvalContext<'a, 'tcx> {\n         &self.memory\n     }\n \n+    pub fn memory_mut(&mut self) -> &mut Memory<'tcx> {\n+        &mut self.memory\n+    }\n+\n     pub fn stack(&self) -> &[Frame] {\n         &self.stack\n     }\n@@ -1373,7 +1377,7 @@ impl<'a, 'tcx> EvalContext<'a, 'tcx> {\n         self.stack.last().expect(\"no call frames exist\")\n     }\n \n-    fn frame_mut(&mut self) -> &mut Frame<'a, 'tcx> {\n+    pub fn frame_mut(&mut self) -> &mut Frame<'a, 'tcx> {\n         self.stack.last_mut().expect(\"no call frames exist\")\n     }\n "}, {"sha": "7ce9636fc05f07037bf28cb353dcc19fd3621136", "filename": "tests/compiletest.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/tests%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/tests%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompiletest.rs?ref=a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "patch": "@@ -21,6 +21,9 @@ fn run_mode(mode: &'static str) {\n     let targets = &[\"x86_64-unknown-linux-gnu\", \"i686-unknown-linux-gnu\"];\n \n     for &target in targets {\n+        use std::io::Write;\n+        let stderr = std::io::stderr();\n+        write!(stderr.lock(), \"running tests for target {}\", target).unwrap();\n         let mut config = compiletest::default_config();\n         config.host_rustcflags = Some(flags.clone());\n         config.mode = mode.parse().expect(\"Invalid mode\");"}, {"sha": "8b884e22fedf7a72fe0b5dd23591eeb2fb670351", "filename": "tests/run-pass/start_fn.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/tests%2Frun-pass%2Fstart_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351/tests%2Frun-pass%2Fstart_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fstart_fn.rs?ref=a55ac1fea8fe4ca8d96d359a8f5b9538e5e9c351", "patch": "@@ -1,6 +1,9 @@\n #![feature(start)]\n \n #[start]\n-fn foo(_nargs: isize, _args: *const *const u8) -> isize {\n-    return 0;\n+fn foo(nargs: isize, args: *const *const u8) -> isize {\n+    if nargs > 0 {\n+        assert!(unsafe{*args} as usize != 0);\n+    }\n+    0\n }"}]}