{"sha": "e1478d650d0fdecfb72a341f319efb07bb03265d", "node_id": "C_kwDOAAsO6NoAKGUxNDc4ZDY1MGQwZmRlY2ZiNzJhMzQxZjMxOWVmYjA3YmIwMzI2NWQ", "commit": {"author": {"name": "Jubilee", "email": "46493976+workingjubilee@users.noreply.github.com", "date": "2021-10-04T20:58:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-04T20:58:11Z"}, "message": "Rollup merge of #89443 - cuviper:btree-hash-len, r=dtolnay\n\nInclude the length in BTree hashes\n\nThis change makes it consistent with `Hash` for all other collections.", "tree": {"sha": "2054259ceef36500553d6a5d0b7a5192c7711901", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2054259ceef36500553d6a5d0b7a5192c7711901"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1478d650d0fdecfb72a341f319efb07bb03265d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhW2rkCRBK7hj4Ov3rIwAA7ykIAJnrcfwFiaEd+hDuTAKvsTd+\nIdFbBFrizQzwNv5Phgyk/7SNlXYsTNmnRKTPTasxFx6IVAhk7hVoUOcznL14XkqE\nNultq/PY2gCOyoi0JfEElNbbo+s6ThRa8OAxuyGXib3QEqGxzDLmjwLOa1PAFUdD\n7LXASZlT6z7D86enFpuv1imrP5vchFYSFtFZ8P2MbovtjN0+R+VPRRAP5QDCG7bh\nuTtNUV0y1SQ7moITh+o/p9IWkrdhR+5b/5TMCF+KMMQM+6GshKQoYO0uVkKMOJHj\nckRIu70v00jww01qnYJXZbs4K08vdV+WKorn5nPHmT7ULEMtZKixkNRch+1bjus=\n=UPBi\n-----END PGP SIGNATURE-----\n", "payload": "tree 2054259ceef36500553d6a5d0b7a5192c7711901\nparent 9381d7a898553d34c883c004c798030ce7fd3bd6\nparent d6fde80cb4a769af72a5e50c8742c676627f24df\nauthor Jubilee <46493976+workingjubilee@users.noreply.github.com> 1633381091 -0700\ncommitter GitHub <noreply@github.com> 1633381091 -0700\n\nRollup merge of #89443 - cuviper:btree-hash-len, r=dtolnay\n\nInclude the length in BTree hashes\n\nThis change makes it consistent with `Hash` for all other collections.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1478d650d0fdecfb72a341f319efb07bb03265d", "html_url": "https://github.com/rust-lang/rust/commit/e1478d650d0fdecfb72a341f319efb07bb03265d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1478d650d0fdecfb72a341f319efb07bb03265d/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9381d7a898553d34c883c004c798030ce7fd3bd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/9381d7a898553d34c883c004c798030ce7fd3bd6", "html_url": "https://github.com/rust-lang/rust/commit/9381d7a898553d34c883c004c798030ce7fd3bd6"}, {"sha": "d6fde80cb4a769af72a5e50c8742c676627f24df", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6fde80cb4a769af72a5e50c8742c676627f24df", "html_url": "https://github.com/rust-lang/rust/commit/d6fde80cb4a769af72a5e50c8742c676627f24df"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "d6032372168f15c342cb55cf435860080aaea1ee", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e1478d650d0fdecfb72a341f319efb07bb03265d/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1478d650d0fdecfb72a341f319efb07bb03265d/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=e1478d650d0fdecfb72a341f319efb07bb03265d", "patch": "@@ -1968,6 +1968,7 @@ impl<'a, K: Ord + Copy, V: Copy> Extend<(&'a K, &'a V)> for BTreeMap<K, V> {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<K: Hash, V: Hash> Hash for BTreeMap<K, V> {\n     fn hash<H: Hasher>(&self, state: &mut H) {\n+        self.len().hash(state);\n         for elt in self {\n             elt.hash(state);\n         }"}, {"sha": "ab275ac4353acc0989b1972d49110c3d3aeb565f", "filename": "library/alloc/tests/btree_set_hash.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e1478d650d0fdecfb72a341f319efb07bb03265d/library%2Falloc%2Ftests%2Fbtree_set_hash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1478d650d0fdecfb72a341f319efb07bb03265d/library%2Falloc%2Ftests%2Fbtree_set_hash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fbtree_set_hash.rs?ref=e1478d650d0fdecfb72a341f319efb07bb03265d", "patch": "@@ -1,9 +1,8 @@\n+use crate::hash;\n use std::collections::BTreeSet;\n \n #[test]\n fn test_hash() {\n-    use crate::hash;\n-\n     let mut x = BTreeSet::new();\n     let mut y = BTreeSet::new();\n \n@@ -17,3 +16,14 @@ fn test_hash() {\n \n     assert_eq!(hash(&x), hash(&y));\n }\n+\n+#[test]\n+fn test_prefix_free() {\n+    let x = BTreeSet::from([1, 2, 3]);\n+    let y = BTreeSet::<i32>::new();\n+\n+    // If hashed by iteration alone, `(x, y)` and `(y, x)` would visit the same\n+    // order of elements, resulting in the same hash. But now that we also hash\n+    // the length, they get distinct sequences of hashed data.\n+    assert_ne!(hash(&(&x, &y)), hash(&(&y, &x)));\n+}"}]}