{"sha": "b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxYTJhYjg2ZGJkNzNiM2JhZTk3OWQ0NDcyYjA0YWUzNjU1ZjZiMjE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-13T06:29:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-13T06:29:25Z"}, "message": "Auto merge of #38179 - michael-zapata:rf/harmonise_rustdoc_errors, r=GuillaumeGomez\n\nfeat(rustdoc): harmonise error messages\n\nBased on unix tools wording, it follows a standard format: `program_name: context: error message`, potentially prompting the user to use the `--help` option.\n\nThis is clearly meant to trigger some discussion on #38084, as messages still use `stdout` and `stderr` somewhat arbitrarily, and there are a few `error!()` calls as well.", "tree": {"sha": "29ac85414930ba5457d4654a2bfa8f880e4e6a58", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29ac85414930ba5457d4654a2bfa8f880e4e6a58"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "html_url": "https://github.com/rust-lang/rust/commit/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5a2b50b33df6015e5bae97c5224e3180885dcc66", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a2b50b33df6015e5bae97c5224e3180885dcc66", "html_url": "https://github.com/rust-lang/rust/commit/5a2b50b33df6015e5bae97c5224e3180885dcc66"}, {"sha": "430d39da9dc858dcd4c1065e016259b4dd02c6b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/430d39da9dc858dcd4c1065e016259b4dd02c6b5", "html_url": "https://github.com/rust-lang/rust/commit/430d39da9dc858dcd4c1065e016259b4dd02c6b5"}], "stats": {"total": 42, "additions": 29, "deletions": 13}, "files": [{"sha": "174118db93e0b1ff55c6b38f0406a9871eaa9de0", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "patch": "@@ -54,6 +54,9 @@ extern crate serialize as rustc_serialize; // used by deriving\n use std::collections::{BTreeMap, BTreeSet};\n use std::default::Default;\n use std::env;\n+use std::fmt::Display;\n+use std::io;\n+use std::io::Write;\n use std::path::PathBuf;\n use std::process;\n use std::sync::mpsc::channel;\n@@ -183,7 +186,7 @@ pub fn main_args(args: &[String]) -> isize {\n     let matches = match getopts::getopts(&args[1..], &all_groups) {\n         Ok(m) => m,\n         Err(err) => {\n-            println!(\"{}\", err);\n+            print_error(err);\n             return 1;\n         }\n     };\n@@ -211,11 +214,11 @@ pub fn main_args(args: &[String]) -> isize {\n     }\n \n     if matches.free.is_empty() {\n-        println!(\"expected an input file to act on\");\n+        print_error(\"missing file operand\");\n         return 1;\n     }\n     if matches.free.len() > 1 {\n-        println!(\"only one input file may be specified\");\n+        print_error(\"too many file operands\");\n         return 1;\n     }\n     let input = &matches.free[0];\n@@ -227,7 +230,7 @@ pub fn main_args(args: &[String]) -> isize {\n     let externs = match parse_externs(&matches) {\n         Ok(ex) => ex,\n         Err(err) => {\n-            println!(\"{}\", err);\n+            print_error(err);\n             return 1;\n         }\n     };\n@@ -247,14 +250,16 @@ pub fn main_args(args: &[String]) -> isize {\n \n     if let Some(ref p) = css_file_extension {\n         if !p.is_file() {\n-            println!(\"{}\", \"--extend-css option must take a css file as input\");\n+            writeln!(\n+                &mut io::stderr(),\n+                \"rustdoc: option --extend-css argument must be a file.\"\n+            ).unwrap();\n             return 1;\n         }\n     }\n \n     let external_html = match ExternalHtml::load(\n-            &matches.opt_strs(\"html-in-header\"),\n-            &matches.opt_strs(\"html-before-content\"),\n+            &matches.opt_strs(\"html-in-header\"), &matches.opt_strs(\"html-before-content\"),\n             &matches.opt_strs(\"html-after-content\")) {\n         Some(eh) => eh,\n         None => return 3\n@@ -291,17 +296,26 @@ pub fn main_args(args: &[String]) -> isize {\n                 0\n             }\n             Some(s) => {\n-                println!(\"unknown output format: {}\", s);\n+                print_error(format!(\"unknown output format: {}\", s));\n                 1\n             }\n         }\n     });\n     res.unwrap_or_else(|s| {\n-        println!(\"input error: {}\", s);\n+        print_error(format!(\"input error: {}\", s));\n         1\n     })\n }\n \n+/// Prints an uniformised error message on the standard error output\n+fn print_error<T>(error_message: T) where T: Display {\n+    writeln!(\n+        &mut io::stderr(),\n+        \"rustdoc: {}\\nTry 'rustdoc --help' for more information.\",\n+        error_message\n+    ).unwrap();\n+}\n+\n /// Looks inside the command line arguments to extract the relevant input format\n /// and files and then generates the necessary rustdoc output for formatting.\n fn acquire_input<R, F>(input: &str,"}, {"sha": "9dbc9d30e606b48851c59384b1d3ff93b5fc2bb9", "filename": "src/librustdoc/markdown.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21/src%2Flibrustdoc%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1a2ab86dbd73b3bae979d4472b04ae3655f6b21/src%2Flibrustdoc%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fmarkdown.rs?ref=b1a2ab86dbd73b3bae979d4472b04ae3655f6b21", "patch": "@@ -71,7 +71,7 @@ pub fn render(input: &str, mut output: PathBuf, matches: &getopts::Matches,\n     let mut out = match File::create(&output) {\n         Err(e) => {\n             let _ = writeln!(&mut io::stderr(),\n-                             \"error opening `{}` for writing: {}\",\n+                             \"rustdoc: {}: {}\",\n                              output.display(), e);\n             return 4;\n         }\n@@ -80,8 +80,10 @@ pub fn render(input: &str, mut output: PathBuf, matches: &getopts::Matches,\n \n     let (metadata, text) = extract_leading_metadata(&input_str);\n     if metadata.is_empty() {\n-        let _ = writeln!(&mut io::stderr(),\n-                         \"invalid markdown file: expecting initial line with `% ...TITLE...`\");\n+        let _ = writeln!(\n+            &mut io::stderr(),\n+            \"rustdoc: invalid markdown file: expecting initial line with `% ...TITLE...`\"\n+        );\n         return 5;\n     }\n     let title = metadata[0];\n@@ -132,7 +134,7 @@ pub fn render(input: &str, mut output: PathBuf, matches: &getopts::Matches,\n     match err {\n         Err(e) => {\n             let _ = writeln!(&mut io::stderr(),\n-                             \"error writing to `{}`: {}\",\n+                             \"rustdoc: cannot write to `{}`: {}\",\n                              output.display(), e);\n             6\n         }"}]}