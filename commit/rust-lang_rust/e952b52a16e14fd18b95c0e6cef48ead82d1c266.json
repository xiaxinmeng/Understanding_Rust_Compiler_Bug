{"sha": "e952b52a16e14fd18b95c0e6cef48ead82d1c266", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5NTJiNTJhMTZlMTRmZDE4Yjk1YzBlNmNlZjQ4ZWFkODJkMWMyNjY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-13T19:36:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-13T19:36:52Z"}, "message": "Rollup merge of #60562 - iliekturtles:proc-macro-missing-docs, r=alexcrichton\n\nAdd #[doc(hidden)] attribute on compiler generated module.\n\nResolves unavoidable `missing_docs` warning/error on proc-macro crates.\nResolves #42008.\n\nChanges not yet tested locally, however I wanted to submit first since `rustc` takes forever to compile.", "tree": {"sha": "41bc42155771fa9dc160bfd79e391e35bd075e39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41bc42155771fa9dc160bfd79e391e35bd075e39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e952b52a16e14fd18b95c0e6cef48ead82d1c266", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJc2cdVCRBK7hj4Ov3rIwAAdHIIABiyfph1xDViKNODwDW5VOjB\nHDxBcfEepZ1AtcVCV16QuJwIYEf70v+cOBNjPfHrDbULEV2y9i8/V0PxZFawyJcV\n3KrF2/FynslOPcd4Fnx+FU0td77gFd3Vdk0S5wZSYCj0naHFyBznofZf84F1VwJW\nxZEmalnjBIPyZ7rYtR6wXlKQm8Xsj8vkH2zkDK2ZYsjtrS92MWhV8W6d+V9QWxYQ\n5nMlgHY1Mnlc54+Jt1t+5F1EqPsJ84lCZf3W59O70f1e3JPxofEU6YZqwj7f4iS1\nxPUyYAU4vHuJRU23uZ0VKp1OCiCQvtX6GmPkmLOtvh4NFebNZ7GKSynpLkdjyuw=\n=wHam\n-----END PGP SIGNATURE-----\n", "payload": "tree 41bc42155771fa9dc160bfd79e391e35bd075e39\nparent c8ef512480296b1398640088fe16759ac9614d81\nparent 5ccf2fb985b5581fdc3f1a3a647b0d613da996d3\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1557776212 +0200\ncommitter GitHub <noreply@github.com> 1557776212 +0200\n\nRollup merge of #60562 - iliekturtles:proc-macro-missing-docs, r=alexcrichton\n\nAdd #[doc(hidden)] attribute on compiler generated module.\n\nResolves unavoidable `missing_docs` warning/error on proc-macro crates.\nResolves #42008.\n\nChanges not yet tested locally, however I wanted to submit first since `rustc` takes forever to compile.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e952b52a16e14fd18b95c0e6cef48ead82d1c266", "html_url": "https://github.com/rust-lang/rust/commit/e952b52a16e14fd18b95c0e6cef48ead82d1c266", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e952b52a16e14fd18b95c0e6cef48ead82d1c266/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8ef512480296b1398640088fe16759ac9614d81", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8ef512480296b1398640088fe16759ac9614d81", "html_url": "https://github.com/rust-lang/rust/commit/c8ef512480296b1398640088fe16759ac9614d81"}, {"sha": "5ccf2fb985b5581fdc3f1a3a647b0d613da996d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ccf2fb985b5581fdc3f1a3a647b0d613da996d3", "html_url": "https://github.com/rust-lang/rust/commit/5ccf2fb985b5581fdc3f1a3a647b0d613da996d3"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "1eab739cf647064b292a83dc55de61bdbb1b61f4", "filename": "src/libsyntax_ext/proc_macro_decls.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e952b52a16e14fd18b95c0e6cef48ead82d1c266/src%2Flibsyntax_ext%2Fproc_macro_decls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e952b52a16e14fd18b95c0e6cef48ead82d1c266/src%2Flibsyntax_ext%2Fproc_macro_decls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fproc_macro_decls.rs?ref=e952b52a16e14fd18b95c0e6cef48ead82d1c266", "patch": "@@ -328,6 +328,7 @@ impl<'a> Visitor<'a> for CollectProcMacros<'a> {\n \n // Creates a new module which looks like:\n //\n+//      #[doc(hidden)]\n //      mod $gensym {\n //          extern crate proc_macro;\n //\n@@ -361,6 +362,10 @@ fn mk_decls(\n     });\n     let span = DUMMY_SP.apply_mark(mark);\n \n+    let hidden = cx.meta_list_item_word(span, Symbol::intern(\"hidden\"));\n+    let doc = cx.meta_list(span, Symbol::intern(\"doc\"), vec![hidden]);\n+    let doc_hidden = cx.attribute(span, doc);\n+\n     let proc_macro = Ident::from_str(\"proc_macro\");\n     let krate = cx.item(span,\n                         proc_macro,\n@@ -425,7 +430,7 @@ fn mk_decls(\n         span,\n         span,\n         ast::Ident::with_empty_ctxt(Symbol::gensym(\"decls\")),\n-        vec![],\n+        vec![doc_hidden],\n         vec![krate, decls_static],\n     ).map(|mut i| {\n         i.vis = respan(span, ast::VisibilityKind::Public);"}, {"sha": "e5a5f8beb45857f111f5673c361cdf53a162bfc7", "filename": "src/test/ui/proc-macro/no-missing-docs.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e952b52a16e14fd18b95c0e6cef48ead82d1c266/src%2Ftest%2Fui%2Fproc-macro%2Fno-missing-docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e952b52a16e14fd18b95c0e6cef48ead82d1c266/src%2Ftest%2Fui%2Fproc-macro%2Fno-missing-docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fno-missing-docs.rs?ref=e952b52a16e14fd18b95c0e6cef48ead82d1c266", "patch": "@@ -0,0 +1,16 @@\n+//! Verify that the `decls` module implicitly added by the compiler does not cause `missing_docs`\n+//! warnings.\n+\n+// compile-pass\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+#![deny(missing_docs)]\n+\n+extern crate proc_macro;\n+use proc_macro::*;\n+\n+/// Foo1.\n+#[proc_macro]\n+pub fn foo1(input: TokenStream) -> TokenStream { input }"}]}