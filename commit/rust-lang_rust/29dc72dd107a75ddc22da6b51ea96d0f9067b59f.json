{"sha": "29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "node_id": "C_kwDOAAsO6NoAKDI5ZGM3MmRkMTA3YTc1ZGRjMjJkYTZiNTFlYTk2ZDBmOTA2N2I1OWY", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-08T01:16:28Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-08T01:16:28Z"}, "message": "add `#[test]` to functions in test modules", "tree": {"sha": "c09d1cca217181aaad039ed9e9c911dc8cd1be4d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c09d1cca217181aaad039ed9e9c911dc8cd1be4d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "html_url": "https://github.com/rust-lang/rust/commit/29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fac8fa56726f7a5b2d4880a4719c5f99beec8328", "url": "https://api.github.com/repos/rust-lang/rust/commits/fac8fa56726f7a5b2d4880a4719c5f99beec8328", "html_url": "https://github.com/rust-lang/rust/commit/fac8fa56726f7a5b2d4880a4719c5f99beec8328"}], "stats": {"total": 283, "additions": 97, "deletions": 186}, "files": [{"sha": "039f59a8838a1ef83b0a0f8132ca78711c0329e5", "filename": "src/test/ui/imports/unused-imports-in-test-mode.rs", "status": "modified", "additions": 36, "deletions": 18, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.rs?ref=29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "patch": "@@ -8,76 +8,94 @@ fn a() {}\n fn b() {}\n \n mod test {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod tests {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod test_a {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod a_test {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod tests_a {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod a_tests {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod fastest_search {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n #[cfg(test)]\n mod test_has_attr {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n \n mod test_has_no_attr {\n     #[cfg(test)]\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a;\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b; //~ ERROR unused import: `crate::b`\n     }\n }\n "}, {"sha": "c5faaa11450cbbe2c6e4dff72946556f4e0ab6c9", "filename": "src/test/ui/imports/unused-imports-in-test-mode.stderr", "status": "modified", "additions": 10, "deletions": 64, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-mode.stderr?ref=29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "patch": "@@ -10,113 +10,59 @@ note: the lint level is defined here\n LL | #![deny(unused_imports)]\n    |         ^^^^^^^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:11:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:14:13\n+  --> $DIR/unused-imports-in-test-mode.rs:16:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:19:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:22:13\n+  --> $DIR/unused-imports-in-test-mode.rs:26:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:27:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:30:13\n+  --> $DIR/unused-imports-in-test-mode.rs:36:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:35:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:38:13\n+  --> $DIR/unused-imports-in-test-mode.rs:46:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:43:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:46:13\n+  --> $DIR/unused-imports-in-test-mode.rs:56:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:51:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:54:13\n+  --> $DIR/unused-imports-in-test-mode.rs:66:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:59:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:62:13\n+  --> $DIR/unused-imports-in-test-mode.rs:76:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:68:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:71:13\n+  --> $DIR/unused-imports-in-test-mode.rs:87:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-mode.rs:77:9\n-   |\n-LL |     use super::a;\n-   |         ^^^^^^^^\n-\n error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-mode.rs:80:13\n+  --> $DIR/unused-imports-in-test-mode.rs:98:13\n    |\n LL |         use crate::b;\n    |             ^^^^^^^^\n \n-error: aborting due to 19 previous errors\n+error: aborting due to 10 previous errors\n "}, {"sha": "7849c3fcd4835dd1b1745749439045744f24f83b", "filename": "src/test/ui/imports/unused-imports-in-test-module.rs", "status": "modified", "additions": 39, "deletions": 14, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.rs?ref=29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "patch": "@@ -6,58 +6,83 @@ fn a() {}\n fn b() {}\n \n mod test {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod tests {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod test_a {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod a_test {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod tests_a {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod a_tests {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n     }\n }\n \n mod fastest_search {\n-    use super::a;  //~ ERROR unused import: `super::a`\n+    use super::a; //~ ERROR unused import: `super::a`\n \n+    #[test]\n     fn foo() {\n-        use crate::b;  //~ ERROR unused import: `crate::b`\n+        a();\n+        use crate::b;\n+    }\n+}\n+\n+#[cfg(test)]\n+mod test_has_attr {\n+    use super::a;\n+\n+    #[test]\n+    fn foo() {\n+        a();\n+        use crate::b;\n     }\n }\n "}, {"sha": "1598368eb32cc42daedd9ab840db76704de77c2c", "filename": "src/test/ui/imports/unused-imports-in-test-module.stderr", "status": "modified", "additions": 12, "deletions": 90, "changes": 102, "blob_url": "https://github.com/rust-lang/rust/blob/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/29dc72dd107a75ddc22da6b51ea96d0f9067b59f/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Funused-imports-in-test-module.stderr?ref=29dc72dd107a75ddc22da6b51ea96d0f9067b59f", "patch": "@@ -22,149 +22,71 @@ help: consider adding a `#[cfg(test)]` to the containing module\n LL | mod test {\n    | ^^^^^^^^\n \n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:12:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:8:1\n-   |\n-LL | mod test {\n-   | ^^^^^^^^\n-\n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:17:9\n+  --> $DIR/unused-imports-in-test-module.rs:19:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n    |\n help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:16:1\n-   |\n-LL | mod tests {\n-   | ^^^^^^^^^\n-\n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:20:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:16:1\n+  --> $DIR/unused-imports-in-test-module.rs:18:1\n    |\n LL | mod tests {\n    | ^^^^^^^^^\n \n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:25:9\n+  --> $DIR/unused-imports-in-test-module.rs:29:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n    |\n help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:24:1\n-   |\n-LL | mod test_a {\n-   | ^^^^^^^^^^\n-\n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:28:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:24:1\n+  --> $DIR/unused-imports-in-test-module.rs:28:1\n    |\n LL | mod test_a {\n    | ^^^^^^^^^^\n \n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:33:9\n+  --> $DIR/unused-imports-in-test-module.rs:39:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n    |\n help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:32:1\n-   |\n-LL | mod a_test {\n-   | ^^^^^^^^^^\n-\n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:36:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:32:1\n+  --> $DIR/unused-imports-in-test-module.rs:38:1\n    |\n LL | mod a_test {\n    | ^^^^^^^^^^\n \n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:41:9\n+  --> $DIR/unused-imports-in-test-module.rs:49:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n    |\n help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:40:1\n-   |\n-LL | mod tests_a {\n-   | ^^^^^^^^^^^\n-\n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:44:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:40:1\n+  --> $DIR/unused-imports-in-test-module.rs:48:1\n    |\n LL | mod tests_a {\n    | ^^^^^^^^^^^\n \n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:49:9\n+  --> $DIR/unused-imports-in-test-module.rs:59:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n    |\n help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:48:1\n-   |\n-LL | mod a_tests {\n-   | ^^^^^^^^^^^\n-\n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:52:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-   |\n-help: consider adding a `#[cfg(test)]` to the containing module\n-  --> $DIR/unused-imports-in-test-module.rs:48:1\n+  --> $DIR/unused-imports-in-test-module.rs:58:1\n    |\n LL | mod a_tests {\n    | ^^^^^^^^^^^\n \n error: unused import: `super::a`\n-  --> $DIR/unused-imports-in-test-module.rs:57:9\n+  --> $DIR/unused-imports-in-test-module.rs:69:9\n    |\n LL |     use super::a;\n    |         ^^^^^^^^\n \n-error: unused import: `crate::b`\n-  --> $DIR/unused-imports-in-test-module.rs:60:13\n-   |\n-LL |         use crate::b;\n-   |             ^^^^^^^^\n-\n-error: aborting due to 15 previous errors\n+error: aborting due to 8 previous errors\n "}]}