{"sha": "c7d60ee05307eab7f7def3d6855ca471253e7810", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZDYwZWUwNTMwN2VhYjdmN2RlZjNkNjg1NWNhNDcxMjUzZTc4MTA=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-08T18:52:23Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-08T18:53:08Z"}, "message": "Don't add struct names to the value name space if there's no constructor\n\nCloses #3149", "tree": {"sha": "7b95d39cfad5da8069c84efcbe96f56c3d00174c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b95d39cfad5da8069c84efcbe96f56c3d00174c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7d60ee05307eab7f7def3d6855ca471253e7810", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7d60ee05307eab7f7def3d6855ca471253e7810", "html_url": "https://github.com/rust-lang/rust/commit/c7d60ee05307eab7f7def3d6855ca471253e7810", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7d60ee05307eab7f7def3d6855ca471253e7810/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5fbff01ce2b3e2d3020182891d4a22b8958f7f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5fbff01ce2b3e2d3020182891d4a22b8958f7f3", "html_url": "https://github.com/rust-lang/rust/commit/c5fbff01ce2b3e2d3020182891d4a22b8958f7f3"}], "stats": {"total": 48, "additions": 40, "deletions": 8}, "files": [{"sha": "3bd47b8d5f200c6285fafccd1e6394a9507fc4e0", "filename": "src/rustc/middle/resolve3.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c7d60ee05307eab7f7def3d6855ca471253e7810/src%2Frustc%2Fmiddle%2Fresolve3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7d60ee05307eab7f7def3d6855ca471253e7810/src%2Frustc%2Fmiddle%2Fresolve3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Fresolve3.rs?ref=c7d60ee05307eab7f7def3d6855ca471253e7810", "patch": "@@ -987,22 +987,30 @@ class Resolver {\n                 }\n             }\n             item_class(struct_definition, _) => {\n-              let (name_bindings, new_parent) = self.add_child(atom, parent,\n-                                              ~[ValueNS, TypeNS], sp);\n-\n-                (*name_bindings).define_type(def_ty(local_def(item.id)), sp);\n-\n-                match struct_definition.ctor {\n+                let (name_bindings, new_parent) =\n+                    match struct_definition.ctor {\n                     none => {\n-                        // Nothing to do.\n+                        let (name_bindings, new_parent) = self.add_child(atom,\n+                              parent, ~[TypeNS], sp);\n+\n+                        (*name_bindings).define_type(def_ty(\n+                            local_def(item.id)), sp);\n+                        (name_bindings, new_parent)\n                     }\n                     some(ctor) => {\n+                        let (name_bindings, new_parent) = self.add_child(atom,\n+                                 parent, ~[ValueNS, TypeNS], sp);\n+\n+                        (*name_bindings).define_type(def_ty(\n+                            local_def(item.id)), sp);\n+\n                         let purity = ctor.node.dec.purity;\n                         let ctor_def = def_fn(local_def(ctor.node.id),\n                                               purity);\n                         (*name_bindings).define_value(ctor_def, sp);\n+                        (name_bindings, new_parent)\n                     }\n-                }\n+                };\n \n                 // Create the set of implementation information that the\n                 // implementation scopes (ImplScopes) need and write it into"}, {"sha": "5d663b553f44fa119dacf5d5467e355f6ade6c94", "filename": "src/test/run-pass/issue-3149.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c7d60ee05307eab7f7def3d6855ca471253e7810/src%2Ftest%2Frun-pass%2Fissue-3149.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7d60ee05307eab7f7def3d6855ca471253e7810/src%2Ftest%2Frun-pass%2Fissue-3149.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-3149.rs?ref=c7d60ee05307eab7f7def3d6855ca471253e7810", "patch": "@@ -0,0 +1,24 @@\n+import Num = num::num;\n+\n+pure fn Matrix4<T:copy Num>(m11: T, m12: T, m13: T, m14: T,\n+                                     m21: T, m22: T, m23: T, m24: T,\n+                                     m31: T, m32: T, m33: T, m34: T,\n+                                     m41: T, m42: T, m43: T, m44: T)\n+                                  -> Matrix4<T> {\n+\n+    Matrix4 {\n+        m11: m11, m12: m12, m13: m13, m14: m14,\n+        m21: m21, m22: m22, m23: m23, m24: m24,\n+        m31: m31, m32: m32, m33: m33, m34: m34,\n+        m41: m41, m42: m42, m43: m43, m44: m44\n+    }\n+}\n+\n+struct Matrix4<T:copy Num> {\n+    let m11: T; let m12: T; let m13: T; let m14: T;\n+    let m21: T; let m22: T; let m23: T; let m24: T;\n+    let m31: T; let m32: T; let m33: T; let m34: T;\n+    let m41: T; let m42: T; let m43: T; let m44: T;\n+}\n+\n+fn main() {}"}]}