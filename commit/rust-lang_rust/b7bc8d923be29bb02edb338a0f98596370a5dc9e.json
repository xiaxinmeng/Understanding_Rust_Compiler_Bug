{"sha": "b7bc8d923be29bb02edb338a0f98596370a5dc9e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3YmM4ZDkyM2JlMjliYjAyZWRiMzM4YTBmOTg1OTYzNzBhNWRjOWU=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2017-03-21T07:50:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-03-21T07:50:52Z"}, "message": "Merge pull request #1634 from ensch/master\n\nFix for rustc 1.17.0-nightly (6eb9960d3 2017-03-19)", "tree": {"sha": "e9ff1087785e68db4d08a77b2c77ad050a9ab0fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9ff1087785e68db4d08a77b2c77ad050a9ab0fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7bc8d923be29bb02edb338a0f98596370a5dc9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7bc8d923be29bb02edb338a0f98596370a5dc9e", "html_url": "https://github.com/rust-lang/rust/commit/b7bc8d923be29bb02edb338a0f98596370a5dc9e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7bc8d923be29bb02edb338a0f98596370a5dc9e/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a04fe9652d3cd803c5e609479afca5665820bbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a04fe9652d3cd803c5e609479afca5665820bbb", "html_url": "https://github.com/rust-lang/rust/commit/2a04fe9652d3cd803c5e609479afca5665820bbb"}, {"sha": "b409356a04d1cb89ac47e4aa6353441750dacdd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/b409356a04d1cb89ac47e4aa6353441750dacdd9", "html_url": "https://github.com/rust-lang/rust/commit/b409356a04d1cb89ac47e4aa6353441750dacdd9"}], "stats": {"total": 85, "additions": 38, "deletions": 47}, "files": [{"sha": "c17b12a33b3814775f9e103ffd628e2629d5b911", "filename": "appveyor.yml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -12,6 +12,7 @@ environment:\n           MSYS2_BITS: 64\n \n install:\n+    - set PATH=C:\\Program Files\\Git\\mingw64\\bin;%PATH%\n     - curl -sSf -o rustup-init.exe https://win.rustup.rs/\n     - rustup-init.exe -y --default-host %TARGET% --default-toolchain nightly\n     - set PATH=%PATH%;C:\\Users\\appveyor\\.cargo\\bin;C:\\Users\\appveyor\\.rustup\\toolchains\\nightly-%TARGET%\\bin"}, {"sha": "8945e4f6c26f855d5cb173790fb998b58a09d996", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 28, "deletions": 26, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -86,8 +86,8 @@ impl LintPass for AttrPass {\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for AttrPass {\n     fn check_attribute(&mut self, cx: &LateContext<'a, 'tcx>, attr: &'tcx Attribute) {\n-        if let MetaItemKind::List(ref items) = attr.value.node {\n-            if items.is_empty() || attr.name() != \"deprecated\" {\n+        if let Some(ref items) = attr.meta_item_list() {\n+            if items.is_empty() || attr.name().map_or(true, |n| n != \"deprecated\") {\n                 return;\n             }\n             for item in items {\n@@ -110,31 +110,33 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for AttrPass {\n             ItemExternCrate(_) |\n             ItemUse(_, _) => {\n                 for attr in &item.attrs {\n-                    if let MetaItemKind::List(ref lint_list) = attr.value.node {\n-                        match &*attr.name().as_str() {\n-                            \"allow\" | \"warn\" | \"deny\" | \"forbid\" => {\n-                                // whitelist `unused_imports` and `deprecated`\n-                                for lint in lint_list {\n-                                    if is_word(lint, \"unused_imports\") || is_word(lint, \"deprecated\") {\n-                                        if let ItemUse(_, _) = item.node {\n-                                            return;\n+                    if let Some(ref lint_list) = attr.meta_item_list() {\n+                        if let Some(name) = attr.name() {\n+                            match &*name.as_str() {\n+                                \"allow\" | \"warn\" | \"deny\" | \"forbid\" => {\n+                                    // whitelist `unused_imports` and `deprecated`\n+                                    for lint in lint_list {\n+                                        if is_word(lint, \"unused_imports\") || is_word(lint, \"deprecated\") {\n+                                            if let ItemUse(_, _) = item.node {\n+                                                return;\n+                                            }\n                                         }\n                                     }\n-                                }\n-                                if let Some(mut sugg) = snippet_opt(cx, attr.span) {\n-                                    if sugg.len() > 1 {\n-                                        span_lint_and_then(cx,\n-                                                           USELESS_ATTRIBUTE,\n-                                                           attr.span,\n-                                                           \"useless lint attribute\",\n-                                                           |db| {\n-                                            sugg.insert(1, '!');\n-                                            db.span_suggestion(attr.span, \"if you just forgot a `!`, use\", sugg);\n-                                        });\n+                                    if let Some(mut sugg) = snippet_opt(cx, attr.span) {\n+                                        if sugg.len() > 1 {\n+                                            span_lint_and_then(cx,\n+                                                               USELESS_ATTRIBUTE,\n+                                                               attr.span,\n+                                                               \"useless lint attribute\",\n+                                                               |db| {\n+                                                sugg.insert(1, '!');\n+                                                db.span_suggestion(attr.span, \"if you just forgot a `!`, use\", sugg);\n+                                            });\n+                                        }\n                                     }\n-                                }\n-                            },\n-                            _ => {},\n+                                },\n+                                _ => {},\n+                            }\n                         }\n                     }\n                 }\n@@ -218,8 +220,8 @@ fn check_attrs(cx: &LateContext, span: Span, name: &Name, attrs: &[Attribute]) {\n     }\n \n     for attr in attrs {\n-        if let MetaItemKind::List(ref values) = attr.value.node {\n-            if values.len() != 1 || attr.name() != \"inline\" {\n+        if let Some(ref values) = attr.meta_item_list() {\n+            if values.len() != 1 || attr.name().map_or(true, |n| n != \"inline\") {\n                 continue;\n             }\n             if is_word(&values[0], \"always\") {"}, {"sha": "816ec8b6b172291d6c3bcb12879c5e5bba268eb4", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -89,11 +89,9 @@ pub fn check_attrs<'a>(cx: &EarlyContext, valid_idents: &[String], attrs: &'a [a\n \n     for attr in attrs {\n         if attr.is_sugared_doc {\n-            if let ast::MetaItemKind::NameValue(ref doc) = attr.value.node {\n-                if let ast::LitKind::Str(ref doc, _) = doc.node {\n+            if let Some(ref doc) = attr.value_str() {\n                     let doc = (*doc.as_str()).to_owned();\n                     docs.extend_from_slice(&strip_doc_comment_decoration((doc, attr.span)));\n-                }\n             }\n         }\n     }"}, {"sha": "c78804240eeb2e23d224430d3de8d18f0e160abd", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -9,7 +9,6 @@\n #![feature(slice_patterns)]\n #![feature(stmt_expr_attributes)]\n #![feature(conservative_impl_trait)]\n-#![feature(collections_bound)]\n \n #![allow(indexing_slicing, shadow_reuse, unknown_lints, missing_docs_in_private_items)]\n #![allow(needless_lifetimes)]"}, {"sha": "75cc588119f50eccfa1ae4f87399a5baf20e57f7", "filename": "clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_doc.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -77,7 +77,7 @@ impl MissingDoc {\n             return;\n         }\n \n-        let has_doc = attrs.iter().any(|a| a.is_value_str() && a.name() == \"doc\");\n+        let has_doc = attrs.iter().any(|a| a.is_value_str() && a.name().map_or(false, |n| n == \"doc\"));\n         if !has_doc {\n             cx.span_lint(MISSING_DOCS_IN_PRIVATE_ITEMS,\n                          sp,"}, {"sha": "031e3f8cf2ca2d0a4580140b6323d7968a1c3ec4", "filename": "clippy_lints/src/returns.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freturns.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -150,9 +150,5 @@ impl EarlyLintPass for ReturnPass {\n }\n \n fn attr_is_cfg(attr: &ast::Attribute) -> bool {\n-    if let ast::MetaItemKind::List(_) = attr.value.node {\n-        attr.name() == \"cfg\"\n-    } else {\n-        false\n-    }\n+    attr.meta_item_list().is_some() && attr.name().map_or(false, |n| n == \"cfg\")\n }"}, {"sha": "992fdab80b0ba5e23c616c2fa12cc067d93ccc7b", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -678,17 +678,13 @@ fn parse_attrs<F: FnMut(u64)>(sess: &Session, attrs: &[ast::Attribute], name: &'\n         if attr.is_sugared_doc {\n             continue;\n         }\n-        if let ast::MetaItemKind::NameValue(ref value) = attr.value.node {\n-            if attr.name() == name {\n-                if let LitKind::Str(ref s, _) = value.node {\n-                    if let Ok(value) = FromStr::from_str(&*s.as_str()) {\n-                        attr::mark_used(attr);\n-                        f(value)\n-                    } else {\n-                        sess.span_err(value.span, \"not a number\");\n-                    }\n+        if let Some(ref value) = attr.value_str() {\n+            if attr.name().map_or(false, |n| n == name) {\n+                if let Ok(value) = FromStr::from_str(&*value.as_str()) {\n+                    attr::mark_used(attr);\n+                    f(value)\n                 } else {\n-                    unreachable!()\n+                    sess.span_err(attr.span, \"not a number\");\n                 }\n             }\n         }"}, {"sha": "506926501a2721c9f10180634b736d869732c123", "filename": "tests/matches.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7bc8d923be29bb02edb338a0f98596370a5dc9e/tests%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7bc8d923be29bb02edb338a0f98596370a5dc9e/tests%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fmatches.rs?ref=b7bc8d923be29bb02edb338a0f98596370a5dc9e", "patch": "@@ -1,5 +1,4 @@\n #![feature(rustc_private)]\n-#![feature(collections_bound)]\n \n extern crate clippy_lints;\n extern crate syntax;"}]}