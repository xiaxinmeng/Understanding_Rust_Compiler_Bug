{"sha": "7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkMmY4MzYwNjViNTFkNmY3ZmE1MGNjYzE3YjA3ZmY5MDdiYTJkNDY=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-05-24T02:15:31Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-05-24T02:29:30Z"}, "message": "add memcpy intrinsic to mirror memmove", "tree": {"sha": "13250ae51af6a3ac5cf260d2f24d24769896aa3f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/13250ae51af6a3ac5cf260d2f24d24769896aa3f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "html_url": "https://github.com/rust-lang/rust/commit/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ba5865e856818c236066aa65592691f1c21b7ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ba5865e856818c236066aa65592691f1c21b7ac", "html_url": "https://github.com/rust-lang/rust/commit/5ba5865e856818c236066aa65592691f1c21b7ac"}], "stats": {"total": 59, "additions": 58, "deletions": 1}, "files": [{"sha": "58c77f037ded3b0b1f7b67c98d6f2d629d9bf761", "filename": "src/librustc/middle/trans/foreign.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "patch": "@@ -845,6 +845,26 @@ pub fn trans_intrinsic(ccx: @CrateContext,\n                                              T_ptr(T_nil()));\n             Store(bcx, morestack_addr, fcx.llretptr.get());\n         }\n+        ~\"memcpy32\" => {\n+            let dst_ptr = get_param(decl, first_real_arg);\n+            let src_ptr = get_param(decl, first_real_arg + 1);\n+            let size = get_param(decl, first_real_arg + 2);\n+            let align = C_i32(1);\n+            let volatile = C_i1(false);\n+            let llfn = *bcx.ccx().intrinsics.get(\n+                &~\"llvm.memcpy.p0i8.p0i8.i32\");\n+            Call(bcx, llfn, [dst_ptr, src_ptr, size, align, volatile]);\n+        }\n+        ~\"memcpy64\" => {\n+            let dst_ptr = get_param(decl, first_real_arg);\n+            let src_ptr = get_param(decl, first_real_arg + 1);\n+            let size = get_param(decl, first_real_arg + 2);\n+            let align = C_i32(1);\n+            let volatile = C_i1(false);\n+            let llfn = *bcx.ccx().intrinsics.get(\n+                &~\"llvm.memcpy.p0i8.p0i8.i64\");\n+            Call(bcx, llfn, [dst_ptr, src_ptr, size, align, volatile]);\n+        }\n         ~\"memmove32\" => {\n             let dst_ptr = get_param(decl, first_real_arg);\n             let src_ptr = get_param(decl, first_real_arg + 1);"}, {"sha": "d4c34a3ace53ba67919cfa70f109da2372d9a4ed", "filename": "src/librustc/middle/trans/type_use.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs?ref=7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "patch": "@@ -135,7 +135,7 @@ pub fn type_uses_for(ccx: @CrateContext, fn_id: def_id, n_tps: uint)\n                 ~\"visit_tydesc\"  | ~\"forget\" | ~\"frame_address\" |\n                 ~\"morestack_addr\" => 0,\n \n-                ~\"memmove32\" | ~\"memmove64\" => 0,\n+                ~\"memcpy32\" | ~\"memcpy64\" | ~\"memmove32\" | ~\"memmove64\" => 0,\n \n                 ~\"sqrtf32\" | ~\"sqrtf64\" | ~\"powif32\" | ~\"powif64\" |\n                 ~\"sinf32\"  | ~\"sinf64\"  | ~\"cosf32\"  | ~\"cosf64\"  |"}, {"sha": "c8b372a37cea78fffb38eb1fd8460f14bf91a93e", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "patch": "@@ -3537,6 +3537,36 @@ pub fn check_intrinsic_type(ccx: @mut CrateCtxt, it: @ast::foreign_item) {\n       ~\"morestack_addr\" => {\n         (0u, ~[], ty::mk_nil_ptr(ccx.tcx))\n       }\n+      ~\"memcpy32\" => {\n+        (0,\n+         ~[\n+            ty::mk_ptr(tcx, ty::mt {\n+                ty: ty::mk_u8(),\n+                mutbl: ast::m_mutbl\n+            }),\n+            ty::mk_ptr(tcx, ty::mt {\n+                ty: ty::mk_u8(),\n+                mutbl: ast::m_imm\n+            }),\n+            ty::mk_u32()\n+         ],\n+         ty::mk_nil())\n+      }\n+      ~\"memcpy64\" => {\n+        (0,\n+         ~[\n+            ty::mk_ptr(tcx, ty::mt {\n+                ty: ty::mk_u8(),\n+                mutbl: ast::m_mutbl\n+            }),\n+            ty::mk_ptr(tcx, ty::mt {\n+                ty: ty::mk_u8(),\n+                mutbl: ast::m_imm\n+            }),\n+            ty::mk_u64()\n+         ],\n+         ty::mk_nil())\n+      }\n       ~\"memmove32\" => {\n         (0,\n          ~["}, {"sha": "033d9fb9954d954ab26169a8760a092bb1f4a6dd", "filename": "src/libstd/unstable/intrinsics.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibstd%2Funstable%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2f836065b51d6f7fa50ccc17b07ff907ba2d46/src%2Flibstd%2Funstable%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fintrinsics.rs?ref=7d2f836065b51d6f7fa50ccc17b07ff907ba2d46", "patch": "@@ -128,6 +128,13 @@ pub extern \"rust-intrinsic\" {\n     /// Get the address of the `__morestack` stack growth function.\n     pub fn morestack_addr() -> *();\n \n+    /// Equivalent to the `llvm.memcpy.p0i8.0i8.i32` intrinsic.\n+    #[cfg(not(stage0))]\n+    pub fn memcpy32(dst: *mut u8, src: *u8, size: u32);\n+    /// Equivalent to the `llvm.memcpy.p0i8.0i8.i64` intrinsic.\n+    #[cfg(not(stage0))]\n+    pub fn memcpy64(dst: *mut u8, src: *u8, size: u64);\n+\n     /// Equivalent to the `llvm.memmove.p0i8.0i8.i32` intrinsic.\n     pub fn memmove32(dst: *mut u8, src: *u8, size: u32);\n     /// Equivalent to the `llvm.memmove.p0i8.0i8.i64` intrinsic."}]}