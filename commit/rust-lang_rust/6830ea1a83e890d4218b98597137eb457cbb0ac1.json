{"sha": "6830ea1a83e890d4218b98597137eb457cbb0ac1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MzBlYTFhODNlODkwZDQyMThiOTg1OTcxMzdlYjQ1N2NiYjBhYzE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-02-12T10:32:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-12T10:32:20Z"}, "message": "Rollup merge of #82011 - jyn514:warn-private-assoc-item, r=max-heller\n\nFix private intra-doc warnings on associated items\n\nThe issue was that the `kind, id` override was previously only being\nconsidered for the disambiguator check, not the privacy check. This uses\nthe same ID for both.\n\nFixes https://github.com/rust-lang/rust/issues/81981.\n\nr? ``@max-heller``", "tree": {"sha": "2d4c40fd936c26b875b3224aa4b73c9828c55217", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d4c40fd936c26b875b3224aa4b73c9828c55217"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6830ea1a83e890d4218b98597137eb457cbb0ac1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgJlk0CRBK7hj4Ov3rIwAAdHIIADdn99WuQ0QNp55bXaAZhnX0\n7f4L2O+rbKrqrl8Z5Zc82xx2aasulYt7jsEOcIHkcCFzMM4zKEZE9HNXrFrU2Cxu\nNDjRXfoPfiaSDutqGtVkvqfyoh7ahPHw16BZl8ZjdAK5FdwuOoMN/gqrOx6Nf3xW\n23kMX1Ti1yMm3MrnywV69KVHWutomUSYwvmpKWQp5E4a7uPif+r10xp+b+IyfL8d\nQsxOWnNZ6qL9g0VyIHzejcl9KVfYp0wlcxk1s/AQ54raGbN8vrHJkc0AblbchJO2\nNGex5lTbaQQN9tCU2s3wbYuUITbOeC/SZ9L2xCheHUGbWaXz2EtLzHQgVJme1XQ=\n=qYIC\n-----END PGP SIGNATURE-----\n", "payload": "tree 2d4c40fd936c26b875b3224aa4b73c9828c55217\nparent 1a9d20b4305bf17c76e1c1b1b16781ddefe44222\nparent 67fb96c537993673a47ee91f073523e6778809b3\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1613125940 +0900\ncommitter GitHub <noreply@github.com> 1613125940 +0900\n\nRollup merge of #82011 - jyn514:warn-private-assoc-item, r=max-heller\n\nFix private intra-doc warnings on associated items\n\nThe issue was that the `kind, id` override was previously only being\nconsidered for the disambiguator check, not the privacy check. This uses\nthe same ID for both.\n\nFixes https://github.com/rust-lang/rust/issues/81981.\n\nr? ``@max-heller``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6830ea1a83e890d4218b98597137eb457cbb0ac1", "html_url": "https://github.com/rust-lang/rust/commit/6830ea1a83e890d4218b98597137eb457cbb0ac1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6830ea1a83e890d4218b98597137eb457cbb0ac1/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a9d20b4305bf17c76e1c1b1b16781ddefe44222", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a9d20b4305bf17c76e1c1b1b16781ddefe44222", "html_url": "https://github.com/rust-lang/rust/commit/1a9d20b4305bf17c76e1c1b1b16781ddefe44222"}, {"sha": "67fb96c537993673a47ee91f073523e6778809b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/67fb96c537993673a47ee91f073523e6778809b3", "html_url": "https://github.com/rust-lang/rust/commit/67fb96c537993673a47ee91f073523e6778809b3"}], "stats": {"total": 40, "additions": 31, "deletions": 9}, "files": [{"sha": "a54b4adc13295c605f7139803cd3ea7ae3229e40", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=6830ea1a83e890d4218b98597137eb457cbb0ac1", "patch": "@@ -1151,11 +1151,12 @@ impl LinkCollector<'_, '_> {\n         };\n \n         let verify = |kind: DefKind, id: DefId| {\n-            debug!(\"intra-doc link to {} resolved to {:?}\", path_str, res);\n+            let (kind, id) = self.kind_side_channel.take().unwrap_or((kind, id));\n+            debug!(\"intra-doc link to {} resolved to {:?} (id: {:?})\", path_str, res, id);\n \n             // Disallow e.g. linking to enums with `struct@`\n             debug!(\"saw kind {:?} with disambiguator {:?}\", kind, disambiguator);\n-            match (self.kind_side_channel.take().map(|(kind, _)| kind).unwrap_or(kind), disambiguator) {\n+            match (kind, disambiguator) {\n                 | (DefKind::Const | DefKind::ConstParam | DefKind::AssocConst | DefKind::AnonConst, Some(Disambiguator::Kind(DefKind::Const)))\n                 // NOTE: this allows 'method' to mean both normal functions and associated functions\n                 // This can't cause ambiguity because both are in the same namespace.\n@@ -1190,7 +1191,7 @@ impl LinkCollector<'_, '_> {\n                 }\n             }\n \n-            Some((kind, id))\n+            Some(())\n         };\n \n         match res {\n@@ -1241,7 +1242,7 @@ impl LinkCollector<'_, '_> {\n                 Some(ItemLink { link: ori_link.link, link_text, did: None, fragment })\n             }\n             Res::Def(kind, id) => {\n-                let (kind, id) = verify(kind, id)?;\n+                verify(kind, id)?;\n                 let id = clean::register_res(cx, rustc_hir::def::Res::Def(kind, id));\n                 Some(ItemLink { link: ori_link.link, link_text, did: Some(id), fragment })\n             }"}, {"sha": "94a833fcc1a15518894c8c7a738d17005f5ac6ad", "filename": "src/test/rustdoc-ui/intra-doc/private.private.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.private.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.private.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.private.stderr?ref=6830ea1a83e890d4218b98597137eb457cbb0ac1", "patch": "@@ -1,11 +1,19 @@\n warning: public documentation for `DocMe` links to private item `DontDocMe`\n   --> $DIR/private.rs:5:11\n    |\n-LL | /// docs [DontDocMe]\n+LL | /// docs [DontDocMe] [DontDocMe::f]\n    |           ^^^^^^^^^ this item is private\n    |\n    = note: `#[warn(private_intra_doc_links)]` on by default\n    = note: this link resolves only because you passed `--document-private-items`, but will break without\n \n-warning: 1 warning emitted\n+warning: public documentation for `DocMe` links to private item `DontDocMe::f`\n+  --> $DIR/private.rs:5:23\n+   |\n+LL | /// docs [DontDocMe] [DontDocMe::f]\n+   |                       ^^^^^^^^^^^^ this item is private\n+   |\n+   = note: this link resolves only because you passed `--document-private-items`, but will break without\n+\n+warning: 2 warnings emitted\n "}, {"sha": "21a60638d5efc8248b59734e1e16af4de832b355", "filename": "src/test/rustdoc-ui/intra-doc/private.public.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.public.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.public.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.public.stderr?ref=6830ea1a83e890d4218b98597137eb457cbb0ac1", "patch": "@@ -1,11 +1,19 @@\n warning: public documentation for `DocMe` links to private item `DontDocMe`\n   --> $DIR/private.rs:5:11\n    |\n-LL | /// docs [DontDocMe]\n+LL | /// docs [DontDocMe] [DontDocMe::f]\n    |           ^^^^^^^^^ this item is private\n    |\n    = note: `#[warn(private_intra_doc_links)]` on by default\n    = note: this link will resolve properly if you pass `--document-private-items`\n \n-warning: 1 warning emitted\n+warning: public documentation for `DocMe` links to private item `DontDocMe::f`\n+  --> $DIR/private.rs:5:23\n+   |\n+LL | /// docs [DontDocMe] [DontDocMe::f]\n+   |                       ^^^^^^^^^^^^ this item is private\n+   |\n+   = note: this link will resolve properly if you pass `--document-private-items`\n+\n+warning: 2 warnings emitted\n "}, {"sha": "3782864305f1f482a0a187f513918710bb0cd1b7", "filename": "src/test/rustdoc-ui/intra-doc/private.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6830ea1a83e890d4218b98597137eb457cbb0ac1/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fprivate.rs?ref=6830ea1a83e890d4218b98597137eb457cbb0ac1", "patch": "@@ -2,8 +2,13 @@\n // revisions: public private\n // [private]compile-flags: --document-private-items\n \n-/// docs [DontDocMe]\n+/// docs [DontDocMe] [DontDocMe::f]\n //~^ WARNING public documentation for `DocMe` links to private item `DontDocMe`\n+//~| WARNING public documentation for `DocMe` links to private item `DontDocMe::f`\n // FIXME: for [private] we should also make sure the link was actually generated\n pub struct DocMe;\n struct DontDocMe;\n+\n+impl DontDocMe {\n+    fn f() {}\n+}"}]}