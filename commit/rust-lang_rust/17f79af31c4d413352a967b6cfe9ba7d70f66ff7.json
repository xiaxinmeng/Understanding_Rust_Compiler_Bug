{"sha": "17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3Zjc5YWYzMWM0ZDQxMzM1MmE5NjdiNmNmZTliYTdkNzBmNjZmZjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-24T18:46:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-24T18:46:01Z"}, "message": "auto merge of #16728 : bluss/rust/zip-next-back, r=alexcrichton\n\nUse ExactSize::len() and defer to its decisions about overly defensive\r\nassertions. Remove the length double-check and simply put a failure\r\ncase if the Zip finds an uneven end in .next_back().\r\n\r\nFixing this up since I think I wrote this, and it's been known to\r\nconfuse rusties (PR #15886).", "tree": {"sha": "3b1283db70a8493654edcd721a94f34c6d3931ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b1283db70a8493654edcd721a94f34c6d3931ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "html_url": "https://github.com/rust-lang/rust/commit/17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17f79af31c4d413352a967b6cfe9ba7d70f66ff7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d3390e12f2ea087bde0b705e2fd167cd96b84a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d3390e12f2ea087bde0b705e2fd167cd96b84a8", "html_url": "https://github.com/rust-lang/rust/commit/8d3390e12f2ea087bde0b705e2fd167cd96b84a8"}, {"sha": "d363770851650d9e137d628de2efeb90b3154bb0", "url": "https://api.github.com/repos/rust-lang/rust/commits/d363770851650d9e137d628de2efeb90b3154bb0", "html_url": "https://github.com/rust-lang/rust/commit/d363770851650d9e137d628de2efeb90b3154bb0"}], "stats": {"total": 34, "additions": 18, "deletions": 16}, "files": [{"sha": "b2bd8d46fb597aa333d531aa455a67e3aadcb638", "filename": "src/libcore/iter.rs", "status": "modified", "additions": 18, "deletions": 16, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/17f79af31c4d413352a967b6cfe9ba7d70f66ff7/src%2Flibcore%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17f79af31c4d413352a967b6cfe9ba7d70f66ff7/src%2Flibcore%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter.rs?ref=17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "patch": "@@ -728,6 +728,10 @@ pub trait ExactSize<A> : DoubleEndedIterator<A> {\n     /// Return the exact length of the iterator.\n     fn len(&self) -> uint {\n         let (lower, upper) = self.size_hint();\n+        // Note: This assertion is overly defensive, but it checks the invariant\n+        // guaranteed by the trait. If this trait were rust-internal,\n+        // we could use debug_assert!; assert_eq! will check all Rust user\n+        // implementations too.\n         assert_eq!(upper, Some(lower));\n         lower\n     }\n@@ -1195,21 +1199,20 @@ impl<A, B, T: ExactSize<A>, U: ExactSize<B>> DoubleEndedIterator<(A, B)>\n for Zip<T, U> {\n     #[inline]\n     fn next_back(&mut self) -> Option<(A, B)> {\n-        let (a_sz, a_upper) = self.a.size_hint();\n-        let (b_sz, b_upper) = self.b.size_hint();\n-        assert!(a_upper == Some(a_sz));\n-        assert!(b_upper == Some(b_sz));\n-        if a_sz < b_sz {\n-            for _ in range(0, b_sz - a_sz) { self.b.next_back(); }\n-        } else if a_sz > b_sz {\n-            for _ in range(0, a_sz - b_sz) { self.a.next_back(); }\n-        }\n-        let (a_sz, _) = self.a.size_hint();\n-        let (b_sz, _) = self.b.size_hint();\n-        assert!(a_sz == b_sz);\n+        let a_sz = self.a.len();\n+        let b_sz = self.b.len();\n+        if a_sz != b_sz {\n+            // Adjust a, b to equal length\n+            if a_sz > b_sz {\n+                for _ in range(0, a_sz - b_sz) { self.a.next_back(); }\n+            } else {\n+                for _ in range(0, b_sz - a_sz) { self.b.next_back(); }\n+            }\n+        }\n         match (self.a.next_back(), self.b.next_back()) {\n             (Some(x), Some(y)) => Some((x, y)),\n-            _ => None\n+            (None, None) => None,\n+            _ => unreachable!(),\n         }\n     }\n }\n@@ -1395,9 +1398,8 @@ impl<A, T: ExactSize<A>> DoubleEndedIterator<(uint, A)> for Enumerate<T> {\n     fn next_back(&mut self) -> Option<(uint, A)> {\n         match self.iter.next_back() {\n             Some(a) => {\n-                let (lower, upper) = self.iter.size_hint();\n-                assert!(upper == Some(lower));\n-                Some((self.count + lower, a))\n+                let len = self.iter.len();\n+                Some((self.count + len, a))\n             }\n             _ => None\n         }"}]}