{"sha": "0f42a71806ad62cd042dd40ab42501180fb72999", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmNDJhNzE4MDZhZDYyY2QwNDJkZDQwYWI0MjUwMTE4MGZiNzI5OTk=", "commit": {"author": {"name": "Jesse Bakker", "email": "github@jessebakker.com", "date": "2020-12-15T15:25:57Z"}, "committer": {"name": "Jesse Bakker", "email": "github@jessebakker.com", "date": "2020-12-15T15:25:57Z"}, "message": "Parenthesize composite if condition before inverting in invert-if assist", "tree": {"sha": "b6224de2218c9a13477f05f23c5e63e6184b5957", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6224de2218c9a13477f05f23c5e63e6184b5957"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f42a71806ad62cd042dd40ab42501180fb72999", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f42a71806ad62cd042dd40ab42501180fb72999", "html_url": "https://github.com/rust-lang/rust/commit/0f42a71806ad62cd042dd40ab42501180fb72999", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f42a71806ad62cd042dd40ab42501180fb72999/comments", "author": {"login": "Jesse-Bakker", "id": 22473248, "node_id": "MDQ6VXNlcjIyNDczMjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/22473248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jesse-Bakker", "html_url": "https://github.com/Jesse-Bakker", "followers_url": "https://api.github.com/users/Jesse-Bakker/followers", "following_url": "https://api.github.com/users/Jesse-Bakker/following{/other_user}", "gists_url": "https://api.github.com/users/Jesse-Bakker/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jesse-Bakker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jesse-Bakker/subscriptions", "organizations_url": "https://api.github.com/users/Jesse-Bakker/orgs", "repos_url": "https://api.github.com/users/Jesse-Bakker/repos", "events_url": "https://api.github.com/users/Jesse-Bakker/events{/privacy}", "received_events_url": "https://api.github.com/users/Jesse-Bakker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jesse-Bakker", "id": 22473248, "node_id": "MDQ6VXNlcjIyNDczMjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/22473248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jesse-Bakker", "html_url": "https://github.com/Jesse-Bakker", "followers_url": "https://api.github.com/users/Jesse-Bakker/followers", "following_url": "https://api.github.com/users/Jesse-Bakker/following{/other_user}", "gists_url": "https://api.github.com/users/Jesse-Bakker/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jesse-Bakker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jesse-Bakker/subscriptions", "organizations_url": "https://api.github.com/users/Jesse-Bakker/orgs", "repos_url": "https://api.github.com/users/Jesse-Bakker/repos", "events_url": "https://api.github.com/users/Jesse-Bakker/events{/privacy}", "received_events_url": "https://api.github.com/users/Jesse-Bakker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cba4231092b0d9ca44ea1f545856239e2fb6eed", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cba4231092b0d9ca44ea1f545856239e2fb6eed", "html_url": "https://github.com/rust-lang/rust/commit/8cba4231092b0d9ca44ea1f545856239e2fb6eed"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "91e2f5c8cb33f93fe1088d48a0364214c18eb211", "filename": "crates/assists/src/handlers/invert_if.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs?ref=0f42a71806ad62cd042dd40ab42501180fb72999", "patch": "@@ -68,6 +68,15 @@ mod tests {\n \n     use crate::tests::{check_assist, check_assist_not_applicable};\n \n+    #[test]\n+    fn invert_if_composite_condition() {\n+        check_assist(\n+            invert_if,\n+            \"fn f() { i<|>f x == 3 || x == 4 || x == 5 { 1 } else { 3 * 2 } }\",\n+            \"fn f() { if !(x == 3 || x == 4 || x == 5) { 3 * 2 } else { 1 } }\",\n+        )\n+    }\n+\n     #[test]\n     fn invert_if_remove_inequality() {\n         check_assist("}, {"sha": "f2cacf7c80a4fe83e0b8ab2fbef07e32ffa54c24", "filename": "crates/assists/src/utils.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fassists%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fassists%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Futils.rs?ref=0f42a71806ad62cd042dd40ab42501180fb72999", "patch": "@@ -212,6 +212,10 @@ fn invert_special_case(expr: &ast::Expr) -> Option<ast::Expr> {\n         ast::Expr::BinExpr(bin) => match bin.op_kind()? {\n             ast::BinOp::NegatedEqualityTest => bin.replace_op(T![==]).map(|it| it.into()),\n             ast::BinOp::EqualityTest => bin.replace_op(T![!=]).map(|it| it.into()),\n+            // Parenthesize composite boolean expressions before prefixing `!`\n+            ast::BinOp::BooleanAnd | ast::BinOp::BooleanOr => {\n+                Some(make::expr_prefix(T![!], make::expr_paren(expr.clone())))\n+            }\n             _ => None,\n         },\n         ast::Expr::MethodCallExpr(mce) => {"}, {"sha": "16b079c42acf04a71d82a2c6fc02fbe6f6605c07", "filename": "crates/syntax/src/ast/make.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f42a71806ad62cd042dd40ab42501180fb72999/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs?ref=0f42a71806ad62cd042dd40ab42501180fb72999", "patch": "@@ -196,6 +196,9 @@ pub fn expr_method_call(receiver: ast::Expr, method: &str, arg_list: ast::ArgLis\n pub fn expr_ref(expr: ast::Expr, exclusive: bool) -> ast::Expr {\n     expr_from_text(&if exclusive { format!(\"&mut {}\", expr) } else { format!(\"&{}\", expr) })\n }\n+pub fn expr_paren(expr: ast::Expr) -> ast::Expr {\n+    expr_from_text(&format!(\"({})\", expr))\n+}\n fn expr_from_text(text: &str) -> ast::Expr {\n     ast_from_text(&format!(\"const C: () = {};\", text))\n }"}]}