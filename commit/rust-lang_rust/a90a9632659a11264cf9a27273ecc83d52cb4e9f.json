{"sha": "a90a9632659a11264cf9a27273ecc83d52cb4e9f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5MGE5NjMyNjU5YTExMjY0Y2Y5YTI3MjczZWNjODNkNTJjYjRlOWY=", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2018-05-15T23:39:21Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2018-05-15T23:39:21Z"}, "message": "Fix run-make wasm tests\n\nFixes #50711", "tree": {"sha": "d91eea1a08b7069fc1f1e4929e5e826ae6a6908a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d91eea1a08b7069fc1f1e4929e5e826ae6a6908a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a90a9632659a11264cf9a27273ecc83d52cb4e9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a90a9632659a11264cf9a27273ecc83d52cb4e9f", "html_url": "https://github.com/rust-lang/rust/commit/a90a9632659a11264cf9a27273ecc83d52cb4e9f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a90a9632659a11264cf9a27273ecc83d52cb4e9f/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27acb9b3c033e1dd74cc72310a5a346527d3e704", "url": "https://api.github.com/repos/rust-lang/rust/commits/27acb9b3c033e1dd74cc72310a5a346527d3e704", "html_url": "https://github.com/rust-lang/rust/commit/27acb9b3c033e1dd74cc72310a5a346527d3e704"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "1f81a617237cc0b82bd3cc1383b3accec1abd077", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=a90a9632659a11264cf9a27273ecc83d52cb4e9f", "patch": "@@ -838,7 +838,7 @@ test!(RunFailFullDepsPretty {\n     host: true\n });\n \n-host_test!(RunMake {\n+default_test!(RunMake {\n     path: \"src/test/run-make\",\n     mode: \"run-make\",\n     suite: \"run-make\"\n@@ -1041,7 +1041,7 @@ impl Step for Compiletest {\n \n             // Only pass correct values for these flags for the `run-make` suite as it\n             // requires that a C++ compiler was configured which isn't always the case.\n-            if !builder.config.dry_run && mode == \"run-make\" {\n+            if !builder.config.dry_run && suite == \"run-make-fulldeps\" {\n                 let llvm_components = output(Command::new(&llvm_config).arg(\"--components\"));\n                 let llvm_cxxflags = output(Command::new(&llvm_config).arg(\"--cxxflags\"));\n                 cmd.arg(\"--cc\").arg(builder.cc(target))\n@@ -1054,13 +1054,13 @@ impl Step for Compiletest {\n                 }\n             }\n         }\n-        if mode == \"run-make\" && !builder.config.llvm_enabled {\n+        if suite == \"run-make-fulldeps\" && !builder.config.llvm_enabled {\n             builder.info(\n                 &format!(\"Ignoring run-make test suite as they generally don't work without LLVM\"));\n             return;\n         }\n \n-        if mode != \"run-make\" {\n+        if suite != \"run-make-fulldeps\" {\n             cmd.arg(\"--cc\").arg(\"\")\n                .arg(\"--cxx\").arg(\"\")\n                .arg(\"--cflags\").arg(\"\")"}, {"sha": "f5480178db0d14aff54b2ed1898a11fcf705b9b0", "filename": "src/test/run-make-fulldeps/cross-lang-lto/Makefile", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile?ref=a90a9632659a11264cf9a27273ecc83d52cb4e9f", "patch": "@@ -2,7 +2,7 @@\n # min-llvm-version 4.0\n # ignore-mingw\n \n--include ../../run-make-fulldeps/tools.mk\n+-include ../tools.mk\n \n # This test makes sure that the expected .llvmbc sections for use by\n # linker-based LTO are available in object files when compiling with", "previous_filename": "src/test/run-make/cross-lang-lto/Makefile"}, {"sha": "b2a5b946160f03edb827750e416e9f5576e2dffd", "filename": "src/test/run-make-fulldeps/cross-lang-lto/lib.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs?ref=a90a9632659a11264cf9a27273ecc83d52cb4e9f", "previous_filename": "src/test/run-make/cross-lang-lto/lib.rs"}, {"sha": "ccd34c9e4dbedc109152a91bc9bd0349c1b8a107", "filename": "src/test/run-make-fulldeps/cross-lang-lto/main.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs?ref=a90a9632659a11264cf9a27273ecc83d52cb4e9f", "previous_filename": "src/test/run-make/cross-lang-lto/main.rs"}, {"sha": "0899ebd5d80f732a40436ed3d06711e142ac27e7", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90a9632659a11264cf9a27273ecc83d52cb4e9f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=a90a9632659a11264cf9a27273ecc83d52cb4e9f", "patch": "@@ -614,8 +614,8 @@ pub fn is_test(file_name: &OsString) -> bool {\n }\n \n pub fn make_test(config: &Config, testpaths: &TestPaths) -> test::TestDescAndFn {\n-\n     let early_props = if config.mode == Mode::RunMake {\n+        // Allow `ignore` directives to be in the Makefile.\n         EarlyProps::from_file(config, &testpaths.file.join(\"Makefile\"))\n     } else {\n         EarlyProps::from_file(config, &testpaths.file)"}]}