{"sha": "30768d3609d905439a129e7e9bf4571b38e321f3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwNzY4ZDM2MDlkOTA1NDM5YTEyOWU3ZTliZjQ1NzFiMzhlMzIxZjM=", "commit": {"author": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-08-24T19:27:39Z"}, "committer": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-08-24T21:01:27Z"}, "message": "rustc: Don't emit metadata for default and GC box addrspaces.", "tree": {"sha": "e99e0183682b4f2b08c79454091ca059e468d947", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e99e0183682b4f2b08c79454091ca059e468d947"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30768d3609d905439a129e7e9bf4571b38e321f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30768d3609d905439a129e7e9bf4571b38e321f3", "html_url": "https://github.com/rust-lang/rust/commit/30768d3609d905439a129e7e9bf4571b38e321f3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30768d3609d905439a129e7e9bf4571b38e321f3/comments", "author": null, "committer": null, "parents": [{"sha": "2189f21d308d16c74507dd7babdb88f5df37eeed", "url": "https://api.github.com/repos/rust-lang/rust/commits/2189f21d308d16c74507dd7babdb88f5df37eeed", "html_url": "https://github.com/rust-lang/rust/commit/2189f21d308d16c74507dd7babdb88f5df37eeed"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "74eab331f46fecf205796a71eadbb6e56799bcda", "filename": "src/rustc/middle/trans/base.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/30768d3609d905439a129e7e9bf4571b38e321f3/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30768d3609d905439a129e7e9bf4571b38e321f3/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=30768d3609d905439a129e7e9bf4571b38e321f3", "patch": "@@ -659,14 +659,16 @@ fn emit_tydescs(ccx: @crate_ctxt) {\n         lib::llvm::SetLinkage(gvar, lib::llvm::InternalLinkage);\n \n         // Index tydesc by addrspace.\n-        let llty = T_ptr(ccx.tydesc_type);\n-        let addrspace_name = #fmt(\"_gc_addrspace_metadata_%u\",\n-                                  ti.addrspace as uint);\n-        let addrspace_gvar = str::as_c_str(addrspace_name, |buf| {\n-            llvm::LLVMAddGlobal(ccx.llmod, llty, buf)\n-        });\n-        lib::llvm::SetLinkage(addrspace_gvar, lib::llvm::InternalLinkage);\n-        llvm::LLVMSetInitializer(addrspace_gvar, gvar);\n+        if ti.addrspace > gc_box_addrspace {\n+            let llty = T_ptr(ccx.tydesc_type);\n+            let addrspace_name = #fmt(\"_gc_addrspace_metadata_%u\",\n+                                      ti.addrspace as uint);\n+            let addrspace_gvar = str::as_c_str(addrspace_name, |buf| {\n+                llvm::LLVMAddGlobal(ccx.llmod, llty, buf)\n+            });\n+            lib::llvm::SetLinkage(addrspace_gvar, lib::llvm::InternalLinkage);\n+            llvm::LLVMSetInitializer(addrspace_gvar, gvar);\n+        }\n     };\n }\n "}]}