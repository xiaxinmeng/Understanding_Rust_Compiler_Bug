{"sha": "f2a234e63c6f5db70a363507bf940dbc51d4efda", "node_id": "C_kwDOAAsO6NoAKGYyYTIzNGU2M2M2ZjVkYjcwYTM2MzUwN2JmOTQwZGJjNTFkNGVmZGE", "commit": {"author": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-10-18T21:59:00Z"}, "committer": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-10-19T00:19:13Z"}, "message": "config: add the option to enable LLVM tests\n\nI'm working on some LLVM patches in concert with a Rust patch, and it's\nhelping me quite a bit to have this as an option. It doesn't seem that\nhard, so I figured I'd formalize it in x.py and send it upstream.", "tree": {"sha": "d00e9594c078cdd430aa6f09dfb847f1c1b8e94c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d00e9594c078cdd430aa6f09dfb847f1c1b8e94c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2a234e63c6f5db70a363507bf940dbc51d4efda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2a234e63c6f5db70a363507bf940dbc51d4efda", "html_url": "https://github.com/rust-lang/rust/commit/f2a234e63c6f5db70a363507bf940dbc51d4efda", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2a234e63c6f5db70a363507bf940dbc51d4efda/comments", "author": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "committer": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5dab47dcd8267b8769421b46532414ec36d625e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5dab47dcd8267b8769421b46532414ec36d625e3", "html_url": "https://github.com/rust-lang/rust/commit/5dab47dcd8267b8769421b46532414ec36d625e3"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "2128fdea2eb460e3144b4ba7265119f8434238b9", "filename": "config.toml.example", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f2a234e63c6f5db70a363507bf940dbc51d4efda/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/f2a234e63c6f5db70a363507bf940dbc51d4efda/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=f2a234e63c6f5db70a363507bf940dbc51d4efda", "patch": "@@ -68,6 +68,12 @@ changelog-seen = 2\n # Indicates whether the LLVM assertions are enabled or not\n #assertions = false\n \n+# Indicates whether the LLVM testsuite is enabled in the build or not. Does\n+# not execute the tests as part of the build as part of x.py build et al,\n+# just makes it possible to do `ninja check-llvm` in the staged LLVM build\n+# directory when doing LLVM development as part of Rust development.\n+#tests = false\n+\n # Indicates whether the LLVM plugin is enabled or not\n #plugins = false\n "}, {"sha": "8d03aade3413a42a0e59d717d853114f9ed3e8db", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f2a234e63c6f5db70a363507bf940dbc51d4efda/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2a234e63c6f5db70a363507bf940dbc51d4efda/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=f2a234e63c6f5db70a363507bf940dbc51d4efda", "patch": "@@ -90,6 +90,7 @@ pub struct Config {\n     // llvm codegen options\n     pub llvm_skip_rebuild: bool,\n     pub llvm_assertions: bool,\n+    pub llvm_tests: bool,\n     pub llvm_plugins: bool,\n     pub llvm_optimize: bool,\n     pub llvm_thin_lto: bool,\n@@ -422,6 +423,7 @@ struct Llvm {\n     thin_lto: Option<bool>,\n     release_debuginfo: Option<bool>,\n     assertions: Option<bool>,\n+    tests: Option<bool>,\n     plugins: Option<bool>,\n     ccache: Option<StringOrBool>,\n     version_check: Option<bool>,\n@@ -715,6 +717,7 @@ impl Config {\n         // Store off these values as options because if they're not provided\n         // we'll infer default values for them later\n         let mut llvm_assertions = None;\n+        let mut llvm_tests = None;\n         let mut llvm_plugins = None;\n         let mut debug = None;\n         let mut debug_assertions = None;\n@@ -740,6 +743,7 @@ impl Config {\n             }\n             set(&mut config.ninja_in_file, llvm.ninja);\n             llvm_assertions = llvm.assertions;\n+            llvm_tests = llvm.tests;\n             llvm_plugins = llvm.plugins;\n             llvm_skip_rebuild = llvm_skip_rebuild.or(llvm.skip_rebuild);\n             set(&mut config.llvm_optimize, llvm.optimize);\n@@ -991,6 +995,7 @@ impl Config {\n \n         config.llvm_skip_rebuild = llvm_skip_rebuild.unwrap_or(false);\n         config.llvm_assertions = llvm_assertions.unwrap_or(false);\n+        config.llvm_tests = llvm_tests.unwrap_or(false);\n         config.llvm_plugins = llvm_plugins.unwrap_or(false);\n         config.rust_optimize = optimize.unwrap_or(true);\n "}, {"sha": "6bfaeffa80705e65419d562a42ed2c9abcd8bb64", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f2a234e63c6f5db70a363507bf940dbc51d4efda/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2a234e63c6f5db70a363507bf940dbc51d4efda/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=f2a234e63c6f5db70a363507bf940dbc51d4efda", "patch": "@@ -170,6 +170,7 @@ impl Step for Llvm {\n \n         let assertions = if builder.config.llvm_assertions { \"ON\" } else { \"OFF\" };\n         let plugins = if builder.config.llvm_plugins { \"ON\" } else { \"OFF\" };\n+        let enable_tests = if builder.config.llvm_tests { \"ON\" } else { \"OFF\" };\n \n         cfg.out_dir(&out_dir)\n             .profile(profile)\n@@ -180,7 +181,7 @@ impl Step for Llvm {\n             .define(\"LLVM_INCLUDE_EXAMPLES\", \"OFF\")\n             .define(\"LLVM_INCLUDE_DOCS\", \"OFF\")\n             .define(\"LLVM_INCLUDE_BENCHMARKS\", \"OFF\")\n-            .define(\"LLVM_INCLUDE_TESTS\", \"OFF\")\n+            .define(\"LLVM_INCLUDE_TESTS\", enable_tests)\n             .define(\"LLVM_ENABLE_TERMINFO\", \"OFF\")\n             .define(\"LLVM_ENABLE_LIBEDIT\", \"OFF\")\n             .define(\"LLVM_ENABLE_BINDINGS\", \"OFF\")"}]}