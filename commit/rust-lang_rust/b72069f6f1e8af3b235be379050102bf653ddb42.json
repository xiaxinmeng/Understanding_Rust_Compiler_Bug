{"sha": "b72069f6f1e8af3b235be379050102bf653ddb42", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3MjA2OWY2ZjFlOGFmM2IyMzViZTM3OTA1MDEwMmJmNjUzZGRiNDI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-02-06T04:05:00Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-02-06T19:54:37Z"}, "message": "mk: Add output files to tests so they don't rerun unnecessarily", "tree": {"sha": "d5eabdc404efff6959f7f31e3768a7d3197eea24", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d5eabdc404efff6959f7f31e3768a7d3197eea24"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b72069f6f1e8af3b235be379050102bf653ddb42", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b72069f6f1e8af3b235be379050102bf653ddb42", "html_url": "https://github.com/rust-lang/rust/commit/b72069f6f1e8af3b235be379050102bf653ddb42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b72069f6f1e8af3b235be379050102bf653ddb42/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1970c9c4d2925930dbc858c49d7f92d096f5ffcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/1970c9c4d2925930dbc858c49d7f92d096f5ffcf", "html_url": "https://github.com/rust-lang/rust/commit/1970c9c4d2925930dbc858c49d7f92d096f5ffcf"}], "stats": {"total": 44, "additions": 29, "deletions": 15}, "files": [{"sha": "57c14b0afc8a2e3a8525d197f5e3a224e321aeae", "filename": "mk/clean.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b72069f6f1e8af3b235be379050102bf653ddb42/mk%2Fclean.mk", "raw_url": "https://github.com/rust-lang/rust/raw/b72069f6f1e8af3b235be379050102bf653ddb42/mk%2Fclean.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fclean.mk?ref=b72069f6f1e8af3b235be379050102bf653ddb42", "patch": "@@ -48,7 +48,7 @@ clean-misc:\n \t$(Q)rm -f $(RUSTLLVM_LIB_OBJS) $(RUSTLLVM_OBJS_OBJS) $(RUSTLLVM_DEF)\n \t$(Q)rm -Rf $(DOCS)\n \t$(Q)rm -Rf $(GENERATED)\n-\t$(Q)rm -f tmp/*.log tmp/*.rc tmp/*.rs\n+\t$(Q)rm -f tmp/*.log tmp/*.rc tmp/*.rs tmp/*.ok\n \t$(Q)rm -Rf rust-stage0-*.tar.bz2 $(PKG_NAME)-*.tar.gz dist\n \t$(Q)rm -Rf $(foreach ext, \\\n                  html aux cp fn ky log pdf pg toc tp vr cps, \\"}, {"sha": "2c1b19486af4b4a316bc7faf671314648a608b2b", "filename": "mk/tests.mk", "status": "modified", "additions": 28, "deletions": 14, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/b72069f6f1e8af3b235be379050102bf653ddb42/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/b72069f6f1e8af3b235be379050102bf653ddb42/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=b72069f6f1e8af3b235be379050102bf653ddb42", "patch": "@@ -62,6 +62,8 @@ ifeq ($(MAKECMDGOALS),perf)\n   export RUST_BENCH\n endif\n \n+TEST_LOG_FILE=tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n+TEST_OK_FILE=tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).ok\n \n ######################################################################\n # Main test targets\n@@ -251,11 +253,14 @@ $(foreach host,$(CFG_TARGET_TRIPLES), \\\n    $(eval $(call TEST_RUNNER,$(stage),$(target),$(host))))))))\n \n define DEF_TEST_CRATE_RULES\n-check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec:\t\t\t\\\n+check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n+\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$(3)/test/$(4)test.stage$(1)-$(2)$$(X)\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_TEST,$$<,$(2),$(3)) $$(TESTARGS)\t\\\n-\t--logfile tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n+\t--logfile $$(call TEST_LOG_FILE,$(1),$(2),$(3),$(4)) \\\n+\t&& touch $$@\n endef\n \n $(foreach host,$(CFG_TARGET_TRIPLES), \\\n@@ -347,12 +352,12 @@ CTEST_COMMON_ARGS$(1)-T-$(2)-H-$(3) :=\t\t\t\t\t\t\\\n         --rustcflags \"$$(CFG_RUSTC_FLAGS) --target=$(2)\"\t\\\n         $$(CTEST_TESTARGS)\n \n-CTEST_DEPS_rpass_$(1)-T-$(2)-H-$(3) = $((RPASS_TESTS))\n-CTEST_DEPS_rpass_full_$(1)-T-$(2)-H-$(3) = $((RPASS_FULL_TESTS)) $$(TLIBRUSTC_DEFAULT$(1)_T_$(2)_H_$(3))\n-CTEST_DEPS_rfail_$(1)-T-$(2)-H-$(3) = $((RFAIL_TESTS))\n-CTEST_DEPS_cfail_$(1)-T-$(2)-H-$(3) = $((CFAIL_TESTS))\n-CTEST_DEPS_bench_$(1)-T-$(2)-H-$(3) = $((BENCH_TESTS))\n-CTEST_DEPS_perf_$(1)-T-$(2)-H-$(3) = $((PERF_TESTS))\n+CTEST_DEPS_rpass_$(1)-T-$(2)-H-$(3) = $$(RPASS_TESTS)\n+CTEST_DEPS_rpass_full_$(1)-T-$(2)-H-$(3) = $$(RPASS_FULL_TESTS) $$(TLIBRUSTC_DEFAULT$(1)_T_$(2)_H_$(3))\n+CTEST_DEPS_rfail_$(1)-T-$(2)-H-$(3) = $$(RFAIL_TESTS)\n+CTEST_DEPS_cfail_$(1)-T-$(2)-H-$(3) = $$(CFAIL_TESTS)\n+CTEST_DEPS_bench_$(1)-T-$(2)-H-$(3) = $$(BENCH_TESTS)\n+CTEST_DEPS_perf_$(1)-T-$(2)-H-$(3) = $$(PERF_TESTS)\n \n endef\n \n@@ -370,13 +375,16 @@ CTEST_ARGS$(1)-T-$(2)-H-$(3)-$(4) := \\\n         --mode $$(CTEST_MODE_$(4)) \\\n \t$$(CTEST_RUNTOOL_$(4))\n \n-check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: \\\n+check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n+\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n                 $$(CTEST_DEPS_$(4)_$(1)-T-$(2)-H-$(3))\n \t@$$(call E, run $(4): $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(1),$$<,$(3)) \\\n \t\t$$(CTEST_ARGS$(1)-T-$(2)-H-$(3)-$(4)) \\\n-\t\t--logfile tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n+\t\t--logfile $$(call TEST_LOG_FILE,$(1),$(2),$(3),$(4)) \\\n+                && touch $$@\n \n endef\n \n@@ -408,13 +416,16 @@ PRETTY_ARGS$(1)-T-$(2)-H-$(3)-$(4) :=\t\t\t\\\n         --build-base $(3)/test/$$(PRETTY_DIRNAME_$(4))/ \\\n         --mode pretty\n \n-check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec:\t\\\n+check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n+\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t        $$(TEST_SREQ$(1)_T_$(2)_H_$(3))\t\t\\\n \t        $$(PRETTY_DEPS_$(4))\n \t@$$(call E, run pretty-rpass: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(1),$$<,$(3)) \\\n \t\t$$(PRETTY_ARGS$(1)-T-$(2)-H-$(3)-$(4)) \\\n-\t\t--logfile tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n+\t\t--logfile $$(call TEST_LOG_FILE,$(1),$(2),$(3),$(4)) \\\n+                && touch $$@\n \n endef\n \n@@ -432,13 +443,16 @@ DOC_TEST_ARGS$(1)-T-$(2)-H-$(3)-$(4) := \\\n         --build-base $(3)/test/doc-$(4)/\t\\\n         --mode run-pass\n \n-check-stage$(1)-T-$(2)-H-$(3)-doc-$(4)-exec:       \\\n+check-stage$(1)-T-$(2)-H-$(3)-doc-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n+\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t        $$(TEST_SREQ$(1)_T_$(2)_H_$(3))\t\t\\\n                 doc-$(4)-extract$(3)\n \t@$$(call E, run doc-$(4): $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST,$(1),$$<,$(3)) \\\n                 $$(DOC_TEST_ARGS$(1)-T-$(2)-H-$(3)-$(4)) \\\n-\t\t--logfile tmp/check-stage$(1)-T-$(2)-H-$(3)-doc-$(4).log\n+\t\t--logfile $$(call TEST_LOG_FILE,$(1),$(2),$(3),doc-$(4)) \\\n+                && touch $$@\n \n endef\n "}]}