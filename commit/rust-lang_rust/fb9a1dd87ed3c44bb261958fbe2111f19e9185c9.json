{"sha": "fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "node_id": "C_kwDOAAsO6NoAKGZiOWExZGQ4N2VkM2M0NGJiMjYxOTU4ZmJlMjExMWYxOWU5MTg1Yzk", "commit": {"author": {"name": "Rungsikorn Rungsikavarnich", "email": "rungsikorn.rungsikavarnich@woven-planet.global", "date": "2023-03-30T06:22:20Z"}, "committer": {"name": "Rungsikorn Rungsikavarnich", "email": "rungsikorn.rungsikavarnich@woven-planet.global", "date": "2023-03-30T06:39:49Z"}, "message": "Missing runnable env on debug target\n\nFix bug in Rust Analyzer where runnable debugging did not pass\nenvironment variable from configuration to child process of Cargo\non binary build stage", "tree": {"sha": "8ee80f92cd6f1ee9399923c3182b848d79a527e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ee80f92cd6f1ee9399923c3182b848d79a527e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "html_url": "https://github.com/rust-lang/rust/commit/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9/comments", "author": {"login": "zapkub", "id": 4373581, "node_id": "MDQ6VXNlcjQzNzM1ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/4373581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zapkub", "html_url": "https://github.com/zapkub", "followers_url": "https://api.github.com/users/zapkub/followers", "following_url": "https://api.github.com/users/zapkub/following{/other_user}", "gists_url": "https://api.github.com/users/zapkub/gists{/gist_id}", "starred_url": "https://api.github.com/users/zapkub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zapkub/subscriptions", "organizations_url": "https://api.github.com/users/zapkub/orgs", "repos_url": "https://api.github.com/users/zapkub/repos", "events_url": "https://api.github.com/users/zapkub/events{/privacy}", "received_events_url": "https://api.github.com/users/zapkub/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zapkub", "id": 4373581, "node_id": "MDQ6VXNlcjQzNzM1ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/4373581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zapkub", "html_url": "https://github.com/zapkub", "followers_url": "https://api.github.com/users/zapkub/followers", "following_url": "https://api.github.com/users/zapkub/following{/other_user}", "gists_url": "https://api.github.com/users/zapkub/gists{/gist_id}", "starred_url": "https://api.github.com/users/zapkub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zapkub/subscriptions", "organizations_url": "https://api.github.com/users/zapkub/orgs", "repos_url": "https://api.github.com/users/zapkub/repos", "events_url": "https://api.github.com/users/zapkub/events{/privacy}", "received_events_url": "https://api.github.com/users/zapkub/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17e31b7d3b1dd6f42a5a4c99c2e07d5d035345ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/17e31b7d3b1dd6f42a5a4c99c2e07d5d035345ac", "html_url": "https://github.com/rust-lang/rust/commit/17e31b7d3b1dd6f42a5a4c99c2e07d5d035345ac"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "cffee1de6af7b22fba32c481b954a5c132eaa044", "filename": "editors/code/src/debug.ts", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9/editors%2Fcode%2Fsrc%2Fdebug.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9/editors%2Fcode%2Fsrc%2Fdebug.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fdebug.ts?ref=fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "patch": "@@ -118,8 +118,8 @@ async function getDebugConfiguration(\n         return path.normalize(p).replace(wsFolder, \"${workspaceFolder\" + workspaceQualifier + \"}\");\n     }\n \n-    const executable = await getDebugExecutable(runnable);\n     const env = prepareEnv(runnable, ctx.config.runnableEnv);\n+    const executable = await getDebugExecutable(runnable, env);\n     let sourceFileMap = debugOptions.sourceFileMap;\n     if (sourceFileMap === \"auto\") {\n         // let's try to use the default toolchain\n@@ -156,8 +156,11 @@ async function getDebugConfiguration(\n     return debugConfig;\n }\n \n-async function getDebugExecutable(runnable: ra.Runnable): Promise<string> {\n-    const cargo = new Cargo(runnable.args.workspaceRoot || \".\", debugOutput);\n+async function getDebugExecutable(\n+    runnable: ra.Runnable,\n+    env: Record<string, string>\n+): Promise<string> {\n+    const cargo = new Cargo(runnable.args.workspaceRoot || \".\", debugOutput, env);\n     const executable = await cargo.executableFromArgs(runnable.args.cargoArgs);\n \n     // if we are here, there were no compilation errors."}, {"sha": "917a1d6b0997b2df743ba788c8eec2d685453a51", "filename": "editors/code/src/toolchain.ts", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9/editors%2Fcode%2Fsrc%2Ftoolchain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/fb9a1dd87ed3c44bb261958fbe2111f19e9185c9/editors%2Fcode%2Fsrc%2Ftoolchain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Ftoolchain.ts?ref=fb9a1dd87ed3c44bb261958fbe2111f19e9185c9", "patch": "@@ -18,7 +18,11 @@ export interface ArtifactSpec {\n }\n \n export class Cargo {\n-    constructor(readonly rootFolder: string, readonly output: vscode.OutputChannel) {}\n+    constructor(\n+        readonly rootFolder: string,\n+        readonly output: vscode.OutputChannel,\n+        readonly env: Record<string, string>\n+    ) {}\n \n     // Made public for testing purposes\n     static artifactSpec(args: readonly string[]): ArtifactSpec {\n@@ -102,6 +106,7 @@ export class Cargo {\n             const cargo = cp.spawn(path, cargoArgs, {\n                 stdio: [\"ignore\", \"pipe\", \"pipe\"],\n                 cwd: this.rootFolder,\n+                env: this.env,\n             });\n \n             cargo.on(\"error\", (err) => reject(new Error(`could not launch cargo: ${err}`)));"}]}