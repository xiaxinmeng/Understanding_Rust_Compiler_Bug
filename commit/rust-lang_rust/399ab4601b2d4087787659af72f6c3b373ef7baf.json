{"sha": "399ab4601b2d4087787659af72f6c3b373ef7baf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5OWFiNDYwMWIyZDQwODc3ODc2NTlhZjcyZjZjM2IzNzNlZjdiYWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-07T18:21:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-07T18:21:04Z"}, "message": "Auto merge of #87851 - JohnTitor:rollup-odvmr47, r=JohnTitor\n\nRollup of 6 pull requests\n\nSuccessful merges:\n\n - #87744 (Add x.py option to --force-rerun compiletest tests)\n - #87789 (Make vec-shrink-panic test compatible with v0 mangling)\n - #87833 (Fix typo -- \"The\" -> \"They\")\n - #87834 (Fix small typo)\n - #87838 (Document that fs::read_dir skips . and ..)\n - #87842 (Fix intra doc link in hidden doc of Iterator::__iterator_get_unchecked)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "7eb029949995f5b3eecc3a33fceb000b253a98a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7eb029949995f5b3eecc3a33fceb000b253a98a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/399ab4601b2d4087787659af72f6c3b373ef7baf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/399ab4601b2d4087787659af72f6c3b373ef7baf", "html_url": "https://github.com/rust-lang/rust/commit/399ab4601b2d4087787659af72f6c3b373ef7baf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/399ab4601b2d4087787659af72f6c3b373ef7baf/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57d8747cca741de84918800dca13da0c821e33e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/57d8747cca741de84918800dca13da0c821e33e0", "html_url": "https://github.com/rust-lang/rust/commit/57d8747cca741de84918800dca13da0c821e33e0"}, {"sha": "c159806cf0b2004614f3b43556072a650eb6029a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c159806cf0b2004614f3b43556072a650eb6029a", "html_url": "https://github.com/rust-lang/rust/commit/c159806cf0b2004614f3b43556072a650eb6029a"}], "stats": {"total": 47, "additions": 37, "deletions": 10}, "files": [{"sha": "6b24d33bebca39239d618a74f3cd0d23615eadbd", "filename": "library/core/src/iter/traits/iterator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fiterator.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -3452,7 +3452,7 @@ pub trait Iterator {\n         self.map(f).is_sorted()\n     }\n \n-    /// See [TrustedRandomAccess]\n+    /// See [TrustedRandomAccess][super::super::TrustedRandomAccess]\n     // The unusual name is to avoid name collisions in method resolution\n     // see #76479.\n     #[inline]"}, {"sha": "2c04481c04ec0dd04763b180093fa2cbfe527d62", "filename": "library/std/src/fs.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/library%2Fstd%2Fsrc%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/library%2Fstd%2Fsrc%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Ffs.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -2039,6 +2039,8 @@ pub fn remove_dir_all<P: AsRef<Path>>(path: P) -> io::Result<()> {\n ///\n /// The iterator will yield instances of [`io::Result`]`<`[`DirEntry`]`>`.\n /// New errors may be encountered after an iterator is initially constructed.\n+/// Entries for the current and parent directories (typically `.` and `..`) are\n+/// skipped.\n ///\n /// # Platform-specific behavior\n ///"}, {"sha": "bb3ea04d4ace9ff28a44ee8b62efbc4a020f78fb", "filename": "src/bootstrap/builder/tests.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Fbuilder%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Fbuilder%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder%2Ftests.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -486,6 +486,7 @@ mod dist {\n             fail_fast: true,\n             doc_tests: DocTests::No,\n             bless: false,\n+            force_rerun: false,\n             compare_mode: None,\n             rustfix_coverage: false,\n             pass: None,\n@@ -527,6 +528,7 @@ mod dist {\n             fail_fast: true,\n             doc_tests: DocTests::No,\n             bless: false,\n+            force_rerun: false,\n             compare_mode: None,\n             rustfix_coverage: false,\n             pass: None,\n@@ -583,6 +585,7 @@ mod dist {\n             fail_fast: true,\n             doc_tests: DocTests::Yes,\n             bless: false,\n+            force_rerun: false,\n             compare_mode: None,\n             rustfix_coverage: false,\n             pass: None,"}, {"sha": "7b74a909c286e6b2a320d1702af7ac18c9b09aab", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -102,6 +102,7 @@ pub enum Subcommand {\n         paths: Vec<PathBuf>,\n         /// Whether to automatically update stderr/stdout files\n         bless: bool,\n+        force_rerun: bool,\n         compare_mode: Option<String>,\n         pass: Option<String>,\n         run: Option<String>,\n@@ -284,6 +285,7 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\",\n                 opts.optflag(\"\", \"no-doc\", \"do not run doc tests\");\n                 opts.optflag(\"\", \"doc\", \"only run doc tests\");\n                 opts.optflag(\"\", \"bless\", \"update all stderr/stdout files of failing ui tests\");\n+                opts.optflag(\"\", \"force-rerun\", \"rerun tests even if the inputs are unchanged\");\n                 opts.optopt(\n                     \"\",\n                     \"compare-mode\",\n@@ -558,6 +560,7 @@ Arguments:\n             \"test\" | \"t\" => Subcommand::Test {\n                 paths,\n                 bless: matches.opt_present(\"bless\"),\n+                force_rerun: matches.opt_present(\"force-rerun\"),\n                 compare_mode: matches.opt_str(\"compare-mode\"),\n                 pass: matches.opt_str(\"pass\"),\n                 run: matches.opt_str(\"run\"),\n@@ -726,6 +729,13 @@ impl Subcommand {\n         }\n     }\n \n+    pub fn force_rerun(&self) -> bool {\n+        match *self {\n+            Subcommand::Test { force_rerun, .. } => force_rerun,\n+            _ => false,\n+        }\n+    }\n+\n     pub fn rustfix_coverage(&self) -> bool {\n         match *self {\n             Subcommand::Test { rustfix_coverage, .. } => rustfix_coverage,"}, {"sha": "9effdb2c959d0840423ed738dcdbc2f911f95134", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -1315,6 +1315,10 @@ note: if you're sure you want to do this, please open an issue as to why. In the\n             cmd.arg(\"--bless\");\n         }\n \n+        if builder.config.cmd.force_rerun() {\n+            cmd.arg(\"--force-rerun\");\n+        }\n+\n         let compare_mode =\n             builder.config.cmd.compare_mode().or_else(|| {\n                 if builder.config.test_compare_mode { self.compare_mode } else { None }"}, {"sha": "af42a4cd06d585e5d6ce91c8e54f003707c47d63", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -1937,7 +1937,7 @@ crate enum Variant {\n     Struct(VariantStruct),\n }\n \n-/// Small wrapper around [`rustc_span::Span]` that adds helper methods\n+/// Small wrapper around [`rustc_span::Span`] that adds helper methods\n /// and enforces calling [`rustc_span::Span::source_callsite()`].\n #[derive(Copy, Clone, Debug)]\n crate struct Span(rustc_span::Span);"}, {"sha": "6b0ac78857a0ebcb42349f1340434b3ce1fe3fd9", "filename": "src/test/codegen/vec-shrink-panik.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftest%2Fcodegen%2Fvec-shrink-panik.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftest%2Fcodegen%2Fvec-shrink-panik.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fvec-shrink-panik.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "previous_filename": "src/test/codegen/vec-shrink-panic.rs"}, {"sha": "99b0a3454e89ccaed91b758a80c9155d3ed18828", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -362,6 +362,9 @@ pub struct Config {\n     pub nodejs: Option<String>,\n     /// Path to a npm executable. Used for rustdoc GUI tests\n     pub npm: Option<String>,\n+\n+    /// Whether to rerun tests even if the inputs are unchanged.\n+    pub force_rerun: bool,\n }\n \n impl Config {"}, {"sha": "9e655557fd271829dbee42ccd09ba7693b3f2640", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -144,6 +144,7 @@ pub fn parse_config(args: Vec<String>) -> Config {\n             \"enable this to generate a Rustfix coverage file, which is saved in \\\n                 `./<build_base>/rustfix_missing_coverage.txt`\",\n         )\n+        .optflag(\"\", \"force-rerun\", \"rerun tests even if the inputs are unchanged\")\n         .optflag(\"h\", \"help\", \"show this message\")\n         .reqopt(\"\", \"channel\", \"current Rust channel\", \"CHANNEL\");\n \n@@ -289,6 +290,8 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         llvm_components: matches.opt_str(\"llvm-components\").unwrap(),\n         nodejs: matches.opt_str(\"nodejs\"),\n         npm: matches.opt_str(\"npm\"),\n+\n+        force_rerun: matches.opt_present(\"force-rerun\"),\n     }\n }\n \n@@ -644,13 +647,15 @@ fn make_test(config: &Config, testpaths: &TestPaths, inputs: &Stamp) -> Vec<test\n             let test_name = crate::make_test_name(config, testpaths, revision);\n             let mut desc = make_test_description(config, test_name, &test_path, src_file, cfg);\n             // Ignore tests that already run and are up to date with respect to inputs.\n-            desc.ignore |= is_up_to_date(\n-                config,\n-                testpaths,\n-                &early_props,\n-                revision.map(|s| s.as_str()),\n-                inputs,\n-            );\n+            if !config.force_rerun {\n+                desc.ignore |= is_up_to_date(\n+                    config,\n+                    testpaths,\n+                    &early_props,\n+                    revision.map(|s| s.as_str()),\n+                    inputs,\n+                );\n+            }\n             test::TestDescAndFn { desc, testfn: make_test_closure(config, testpaths, revision) }\n         })\n         .collect()"}, {"sha": "8cbe0a0c2e8e1736329b4033775ede5a4b8e0f01", "filename": "src/tools/linkchecker/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Flinkchecker%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/399ab4601b2d4087787659af72f6c3b373ef7baf/src%2Ftools%2Flinkchecker%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flinkchecker%2Fmain.rs?ref=399ab4601b2d4087787659af72f6c3b373ef7baf", "patch": "@@ -129,7 +129,7 @@ enum FileEntry {\n     /// An HTML file.\n     ///\n     /// This includes the contents of the HTML file, and an optional set of\n-    /// HTML IDs. The IDs are used for checking fragments. The are computed\n+    /// HTML IDs. The IDs are used for checking fragments. They are computed\n     /// as-needed. The source is discarded (replaced with an empty string)\n     /// after the file has been checked, to conserve on memory.\n     HtmlFile { source: Rc<String>, ids: RefCell<HashSet<String>> },"}]}