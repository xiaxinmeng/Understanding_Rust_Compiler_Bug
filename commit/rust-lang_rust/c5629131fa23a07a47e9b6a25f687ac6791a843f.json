{"sha": "c5629131fa23a07a47e9b6a25f687ac6791a843f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1NjI5MTMxZmEyM2EwN2E0N2U5YjZhMjVmNjg3YWM2NzkxYTg0M2Y=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-02-25T13:33:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-25T13:33:53Z"}, "message": "Rollup merge of #81713 - estebank:unstable-assoc-item-lint, r=oli-obk\n\nAccount for associated consts in the \"unstable assoc item name colission\" lint\n\nFix #81663.", "tree": {"sha": "9c0e2b1e0b29e6b551b74941f8a848c1295e92dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c0e2b1e0b29e6b551b74941f8a848c1295e92dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5629131fa23a07a47e9b6a25f687ac6791a843f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgN6dCCRBK7hj4Ov3rIwAAdHIIABl5nSO3GQTR6FnexpCgKLsN\nf/YveFCaizhiWEokdO/D34f3SaM/KhUlC+uoNIxniENfS6EW7VtgBEf/cT4aofQf\nk9K5U1V3RRRUoZnKiNj2w2qHHTWWo0xB8Fa15yLVUA7IM2rTOd5jFMX30lj1zK9e\nXLsLw+WoqdpzM5sDXoKCgNUbuJFl+Wnp0uk3XMgq2h2SRc+tpRWclSbWN39Gnuwj\nJEYiQhB5n+1WPd3PHNwEUfhBP2FvvIfFCq7oQ+rClLZfsJ+WGzkRXoLykdeNYJXm\nrapEIus7cZADSwSAa84JZ2Yc9Uz6xrp6qL8GQazjB9uJ7LWv2eCQcV7AR2MZyNE=\n=Qxvi\n-----END PGP SIGNATURE-----\n", "payload": "tree 9c0e2b1e0b29e6b551b74941f8a848c1295e92dd\nparent 749d70ae69031051da6e33657a2b82cde5b15240\nparent e65594124197bd75716d372bec1d662b2ded03e7\nauthor Dylan DPC <dylan.dpc@gmail.com> 1614260033 +0100\ncommitter GitHub <noreply@github.com> 1614260033 +0100\n\nRollup merge of #81713 - estebank:unstable-assoc-item-lint, r=oli-obk\n\nAccount for associated consts in the \"unstable assoc item name colission\" lint\n\nFix #81663.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5629131fa23a07a47e9b6a25f687ac6791a843f", "html_url": "https://github.com/rust-lang/rust/commit/c5629131fa23a07a47e9b6a25f687ac6791a843f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5629131fa23a07a47e9b6a25f687ac6791a843f/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "749d70ae69031051da6e33657a2b82cde5b15240", "url": "https://api.github.com/repos/rust-lang/rust/commits/749d70ae69031051da6e33657a2b82cde5b15240", "html_url": "https://github.com/rust-lang/rust/commit/749d70ae69031051da6e33657a2b82cde5b15240"}, {"sha": "e65594124197bd75716d372bec1d662b2ded03e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e65594124197bd75716d372bec1d662b2ded03e7", "html_url": "https://github.com/rust-lang/rust/commit/e65594124197bd75716d372bec1d662b2ded03e7"}], "stats": {"total": 90, "additions": 67, "deletions": 23}, "files": [{"sha": "26e61ec8cf8666483ba5ebb14715069a00bee1f0", "filename": "compiler/rustc_middle/src/lint.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flint.rs?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -353,12 +353,12 @@ pub fn struct_lint_level<'s, 'd>(\n                  it will become a hard error\";\n \n             let explanation = if lint_id == LintId::of(builtin::UNSTABLE_NAME_COLLISIONS) {\n-                \"once this method is added to the standard library, \\\n-                 the ambiguity may cause an error or change in behavior!\"\n+                \"once this associated item is added to the standard library, the ambiguity may \\\n+                 cause an error or change in behavior!\"\n                     .to_owned()\n             } else if lint_id == LintId::of(builtin::MUTABLE_BORROW_RESERVATION_CONFLICT) {\n-                \"this borrowing pattern was not meant to be accepted, \\\n-                 and may become a hard error in the future\"\n+                \"this borrowing pattern was not meant to be accepted, and may become a hard error \\\n+                 in the future\"\n                     .to_owned()\n             } else if let Some(edition) = future_incompatible.edition {\n                 format!(\"{} in the {} edition!\", STANDARD_MESSAGE, edition)"}, {"sha": "2bfd697e4cdca9111afea42465512275fcdf029a", "filename": "compiler/rustc_typeck/src/check/method/probe.rs", "status": "modified", "additions": 35, "deletions": 12, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprobe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprobe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprobe.rs?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -10,6 +10,7 @@ use crate::hir::def_id::DefId;\n \n use rustc_data_structures::fx::FxHashSet;\n use rustc_data_structures::sync::Lrc;\n+use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_hir::def::Namespace;\n use rustc_infer::infer::canonical::OriginalQueryValues;\n@@ -1167,7 +1168,7 @@ impl<'a, 'tcx> ProbeContext<'a, 'tcx> {\n                         //\n                         // We suppress warning if we're picking the method only because it is a\n                         // suggestion.\n-                        self.emit_unstable_name_collision_hint(p, &unstable_candidates);\n+                        self.emit_unstable_name_collision_hint(p, &unstable_candidates, self_ty);\n                     }\n                 }\n                 return Some(pick);\n@@ -1246,24 +1247,46 @@ impl<'a, 'tcx> ProbeContext<'a, 'tcx> {\n         &self,\n         stable_pick: &Pick<'_>,\n         unstable_candidates: &[(&Candidate<'tcx>, Symbol)],\n+        self_ty: Ty<'tcx>,\n     ) {\n         self.tcx.struct_span_lint_hir(\n             lint::builtin::UNSTABLE_NAME_COLLISIONS,\n             self.fcx.body_id,\n             self.span,\n             |lint| {\n-                let mut diag = lint.build(\n-                    \"a method with this name may be added to the standard library in the future\",\n-                );\n-                // FIXME: This should be a `span_suggestion` instead of `help`\n-                // However `self.span` only\n-                // highlights the method name, so we can't use it. Also consider reusing the code from\n-                // `report_method_error()`.\n-                diag.help(&format!(\n-                    \"call with fully qualified syntax `{}(...)` to keep using the current method\",\n-                    self.tcx.def_path_str(stable_pick.item.def_id),\n+                let def_kind = stable_pick.item.kind.as_def_kind();\n+                let mut diag = lint.build(&format!(\n+                    \"{} {} with this name may be added to the standard library in the future\",\n+                    def_kind.article(),\n+                    def_kind.descr(stable_pick.item.def_id),\n                 ));\n-\n+                match (stable_pick.item.kind, stable_pick.item.container) {\n+                    (ty::AssocKind::Fn, _) => {\n+                        // FIXME: This should be a `span_suggestion` instead of `help`\n+                        // However `self.span` only\n+                        // highlights the method name, so we can't use it. Also consider reusing\n+                        // the code from `report_method_error()`.\n+                        diag.help(&format!(\n+                            \"call with fully qualified syntax `{}(...)` to keep using the current \\\n+                             method\",\n+                            self.tcx.def_path_str(stable_pick.item.def_id),\n+                        ));\n+                    }\n+                    (ty::AssocKind::Const, ty::AssocItemContainer::TraitContainer(def_id)) => {\n+                        diag.span_suggestion(\n+                            self.span,\n+                            \"use the fully qualified path to the associated const\",\n+                            format!(\n+                                \"<{} as {}>::{}\",\n+                                self_ty,\n+                                self.tcx.def_path_str(def_id),\n+                                stable_pick.item.ident\n+                            ),\n+                            Applicability::MachineApplicable,\n+                        );\n+                    }\n+                    _ => {}\n+                }\n                 if self.tcx.sess.is_nightly_build() {\n                     for (candidate, feature) in unstable_candidates {\n                         diag.help(&format!("}, {"sha": "91fc398f7418396ea23c9f65f07cb039cba696d5", "filename": "src/test/ui/inference/auxiliary/inference_unstable_iterator.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_iterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_iterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_iterator.rs?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -8,7 +8,11 @@ pub trait IpuIterator {\n     fn ipu_flatten(&self) -> u32 {\n         0\n     }\n+    #[unstable(feature = \"assoc_const_ipu_iter\", issue = \"99999\")]\n+    const C: i32;\n }\n \n #[stable(feature = \"ipu_iterator\", since = \"1.0.0\")]\n-impl IpuIterator for char {}\n+impl IpuIterator for char {\n+    const C: i32 = 42;\n+}"}, {"sha": "e00adda5c33820bbafd817097bc95c9610ad6343", "filename": "src/test/ui/inference/auxiliary/inference_unstable_itertools.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_itertools.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_itertools.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finference%2Fauxiliary%2Finference_unstable_itertools.rs?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -2,6 +2,10 @@ pub trait IpuItertools {\n     fn ipu_flatten(&self) -> u32 {\n         1\n     }\n+\n+    const C: i32;\n }\n \n-impl IpuItertools for char {}\n+impl IpuItertools for char {\n+    const C: i32 = 1;\n+}"}, {"sha": "86bb62b8a5f64ad3b449b02349763bb2303bfb80", "filename": "src/test/ui/inference/inference_unstable.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Finference_unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Finference_unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finference%2Finference_unstable.rs?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -14,6 +14,9 @@ use inference_unstable_itertools::IpuItertools;\n \n fn main() {\n     assert_eq!('x'.ipu_flatten(), 1);\n-    //~^ WARN a method with this name may be added to the standard library in the future\n-    //~^^ WARN once this method is added to the standard library, the ambiguity may cause an error\n+//~^ WARN an associated function with this name may be added to the standard library in the future\n+//~| WARN once this associated item is added to the standard library, the ambiguity may cause an\n+    assert_eq!(char::C, 1);\n+//~^ WARN an associated constant with this name may be added to the standard library in the future\n+//~| WARN once this associated item is added to the standard library, the ambiguity may cause an\n }"}, {"sha": "2c282e610b29c6d426e5ca5644521aa47ec97cbb", "filename": "src/test/ui/inference/inference_unstable.stderr", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Finference_unstable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5629131fa23a07a47e9b6a25f687ac6791a843f/src%2Ftest%2Fui%2Finference%2Finference_unstable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finference%2Finference_unstable.stderr?ref=c5629131fa23a07a47e9b6a25f687ac6791a843f", "patch": "@@ -1,14 +1,24 @@\n-warning: a method with this name may be added to the standard library in the future\n+warning: an associated function with this name may be added to the standard library in the future\n   --> $DIR/inference_unstable.rs:16:20\n    |\n LL |     assert_eq!('x'.ipu_flatten(), 1);\n    |                    ^^^^^^^^^^^\n    |\n    = note: `#[warn(unstable_name_collisions)]` on by default\n-   = warning: once this method is added to the standard library, the ambiguity may cause an error or change in behavior!\n+   = warning: once this associated item is added to the standard library, the ambiguity may cause an error or change in behavior!\n    = note: for more information, see issue #48919 <https://github.com/rust-lang/rust/issues/48919>\n    = help: call with fully qualified syntax `inference_unstable_itertools::IpuItertools::ipu_flatten(...)` to keep using the current method\n    = help: add `#![feature(ipu_flatten)]` to the crate attributes to enable `inference_unstable_iterator::IpuIterator::ipu_flatten`\n \n-warning: 1 warning emitted\n+warning: an associated constant with this name may be added to the standard library in the future\n+  --> $DIR/inference_unstable.rs:19:16\n+   |\n+LL |     assert_eq!(char::C, 1);\n+   |                ^^^^^^^ help: use the fully qualified path to the associated const: `<char as IpuItertools>::C`\n+   |\n+   = warning: once this associated item is added to the standard library, the ambiguity may cause an error or change in behavior!\n+   = note: for more information, see issue #48919 <https://github.com/rust-lang/rust/issues/48919>\n+   = help: add `#![feature(assoc_const_ipu_iter)]` to the crate attributes to enable `inference_unstable_iterator::IpuIterator::C`\n+\n+warning: 2 warnings emitted\n "}]}