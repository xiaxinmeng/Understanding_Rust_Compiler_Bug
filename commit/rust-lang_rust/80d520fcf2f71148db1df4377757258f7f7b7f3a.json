{"sha": "80d520fcf2f71148db1df4377757258f7f7b7f3a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwZDUyMGZjZjJmNzExNDhkYjFkZjQzNzc3NTcyNThmN2Y3YjdmM2E=", "commit": {"author": {"name": "Richard Diamond", "email": "wichard@vitalitystudios.com", "date": "2014-11-25T23:28:49Z"}, "committer": {"name": "Richard Diamond", "email": "wichard@vitalitystudios.com", "date": "2014-11-25T23:28:49Z"}, "message": "Don't use the same llvmdeps.rs for every host.", "tree": {"sha": "d7191fc9830908fdfa421ace8eec3a80c4c7c5d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7191fc9830908fdfa421ace8eec3a80c4c7c5d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/80d520fcf2f71148db1df4377757258f7f7b7f3a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/80d520fcf2f71148db1df4377757258f7f7b7f3a", "html_url": "https://github.com/rust-lang/rust/commit/80d520fcf2f71148db1df4377757258f7f7b7f3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/80d520fcf2f71148db1df4377757258f7f7b7f3a/comments", "author": {"login": "DiamondLovesYou", "id": 650357, "node_id": "MDQ6VXNlcjY1MDM1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/650357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DiamondLovesYou", "html_url": "https://github.com/DiamondLovesYou", "followers_url": "https://api.github.com/users/DiamondLovesYou/followers", "following_url": "https://api.github.com/users/DiamondLovesYou/following{/other_user}", "gists_url": "https://api.github.com/users/DiamondLovesYou/gists{/gist_id}", "starred_url": "https://api.github.com/users/DiamondLovesYou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DiamondLovesYou/subscriptions", "organizations_url": "https://api.github.com/users/DiamondLovesYou/orgs", "repos_url": "https://api.github.com/users/DiamondLovesYou/repos", "events_url": "https://api.github.com/users/DiamondLovesYou/events{/privacy}", "received_events_url": "https://api.github.com/users/DiamondLovesYou/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DiamondLovesYou", "id": 650357, "node_id": "MDQ6VXNlcjY1MDM1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/650357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DiamondLovesYou", "html_url": "https://github.com/DiamondLovesYou", "followers_url": "https://api.github.com/users/DiamondLovesYou/followers", "following_url": "https://api.github.com/users/DiamondLovesYou/following{/other_user}", "gists_url": "https://api.github.com/users/DiamondLovesYou/gists{/gist_id}", "starred_url": "https://api.github.com/users/DiamondLovesYou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DiamondLovesYou/subscriptions", "organizations_url": "https://api.github.com/users/DiamondLovesYou/orgs", "repos_url": "https://api.github.com/users/DiamondLovesYou/repos", "events_url": "https://api.github.com/users/DiamondLovesYou/events{/privacy}", "received_events_url": "https://api.github.com/users/DiamondLovesYou/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2264049577e1d64a2a863a9b9f2b7d94f6b90e15", "url": "https://api.github.com/repos/rust-lang/rust/commits/2264049577e1d64a2a863a9b9f2b7d94f6b90e15", "html_url": "https://github.com/rust-lang/rust/commit/2264049577e1d64a2a863a9b9f2b7d94f6b90e15"}], "stats": {"total": 36, "additions": 24, "deletions": 12}, "files": [{"sha": "0b5240d51d52166afcd3370703ffe015803493cb", "filename": "mk/docs.mk", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=80d520fcf2f71148db1df4377757258f7f7b7f3a", "patch": "@@ -299,7 +299,8 @@ $(2) += doc/$(1)/index.html\n doc/$(1)/index.html: CFG_COMPILER_HOST_TRIPLE = $(CFG_TARGET)\n doc/$(1)/index.html: $$(LIB_DOC_DEP_$(1)) doc/$(1)/\n \t@$$(call E, rustdoc: $$@)\n-\t$$(Q)$$(RUSTDOC) --cfg dox --cfg stage2 $$<\n+\t$$(Q)CFG_LLVM_LINKAGE_FILE=$$(LLVM_LINKAGE_PATH_$(CFG_BUILD)) \\\n+\t\t$$(RUSTDOC) --cfg dox --cfg stage2 $$<\n endef\n \n $(foreach crate,$(DOC_CRATES),$(eval $(call DEF_LIB_DOC,$(crate),DOC_TARGETS)))"}, {"sha": "ba2e073803935b89632a9e476a40a4293fd45cfb", "filename": "mk/llvm.mk", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Fllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Fllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fllvm.mk?ref=80d520fcf2f71148db1df4377757258f7f7b7f3a", "patch": "@@ -49,6 +49,12 @@ else\n LLVM_STDCPP_LOCATION_$(1) =\n endif\n \n+\n+# LLVM linkage:\n+LLVM_LINKAGE_PATH_$(1):=$$(abspath $$(RT_OUTPUT_DIR_$(1))/llvmdeps.rs)\n+$$(LLVM_LINKAGE_PATH_$(1)): $(S)src/etc/mklldeps.py $$(LLVM_CONFIG_$(1))\n+\t$(Q)$(CFG_PYTHON) \"$$<\" \"$$@\" \"$$(LLVM_COMPONENTS)\" \"$$(CFG_ENABLE_LLVM_STATIC_STDCPP)\" \\\n+\t\t$$(LLVM_CONFIG_$(1))\n endef\n \n $(foreach host,$(CFG_HOST), \\\n@@ -57,10 +63,14 @@ $(foreach host,$(CFG_HOST), \\\n $(foreach host,$(CFG_HOST), \\\n  $(eval LLVM_CONFIGS := $(LLVM_CONFIGS) $(LLVM_CONFIG_$(host))))\n \n-$(S)src/librustc_llvm/llvmdeps.rs: \\\n-\t\t    $(LLVM_CONFIGS) \\\n-\t\t    $(S)src/etc/mklldeps.py \\\n-\t\t    $(MKFILE_DEPS)\n-\t$(Q)$(CFG_PYTHON) $(S)src/etc/mklldeps.py \\\n-\t\t\"$@\" \"$(LLVM_COMPONENTS)\" \"$(CFG_ENABLE_LLVM_STATIC_STDCPP)\" \\\n-\t\t$(LLVM_CONFIGS)\n+# This can't be done in target.mk because it's included before this file.\n+define LLVM_LINKAGE_DEPS\n+$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.rustc_llvm: $$(LLVM_LINKAGE_PATH_$(3))\n+endef\n+\n+$(foreach source,$(CFG_HOST), \\\n+ $(foreach target,$(CFG_TARGET), \\\n+  $(eval $(call LLVM_LINKAGE_DEPS,0,$(target),$(source))) \\\n+  $(eval $(call LLVM_LINKAGE_DEPS,1,$(target),$(source))) \\\n+  $(eval $(call LLVM_LINKAGE_DEPS,2,$(target),$(source))) \\\n+  $(eval $(call LLVM_LINKAGE_DEPS,3,$(target),$(source)))))"}, {"sha": "5b0de64574cd3338c4fd915c01fdb256c3b844be", "filename": "mk/target.mk", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/80d520fcf2f71148db1df4377757258f7f7b7f3a/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=80d520fcf2f71148db1df4377757258f7f7b7f3a", "patch": "@@ -79,7 +79,8 @@ $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): \\\n \t    $$(dir $$@)$$(call CFG_LIB_GLOB_$(2),$(4)))\n \t$$(call REMOVE_ALL_OLD_GLOB_MATCHES, \\\n \t    $$(dir $$@)$$(call CFG_RLIB_GLOB,$(4)))\n-\t$$(STAGE$(1)_T_$(2)_H_$(3)) \\\n+\t$(Q)CFG_LLVM_LINKAGE_FILE=$$(LLVM_LINKAGE_PATH_$(2)) \\\n+\t    $$(subst @,,$$(STAGE$(1)_T_$(2)_H_$(3))) \\\n \t\t$$(RUST_LIB_FLAGS_ST$(1)) \\\n \t\t-L \"$$(RT_OUTPUT_DIR_$(2))\" \\\n \t\t-L \"$$(LLVM_LIBDIR_$(2))\" \\\n@@ -134,8 +135,6 @@ SNAPSHOT_RUSTC_POST_CLEANUP=$(HBIN0_H_$(CFG_BUILD))/rustc$(X_$(CFG_BUILD))\n \n define TARGET_HOST_RULES\n \n-$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.rustc_llvm: $(S)src/librustc_llvm/llvmdeps.rs\n-\n $$(TBIN$(1)_T_$(2)_H_$(3))/:\n \tmkdir -p $$@\n "}, {"sha": "8c12ccb9c8bd6e02b6324aa8418375603db7a074", "filename": "src/librustc_llvm/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/80d520fcf2f71148db1df4377757258f7f7b7f3a/src%2Flibrustc_llvm%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/80d520fcf2f71148db1df4377757258f7f7b7f3a/src%2Flibrustc_llvm%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Flib.rs?ref=80d520fcf2f71148db1df4377757258f7f7b7f3a", "patch": "@@ -2214,4 +2214,6 @@ pub unsafe fn static_link_hack_this_sucks() {\n // parts of LLVM that rustllvm depends on aren't thrown away by the linker.\n // Works to the above fix for #15460 to ensure LLVM dependencies that\n // are only used by rustllvm don't get stripped by the linker.\n-mod llvmdeps;\n+mod llvmdeps {\n+    include!(env!(\"CFG_LLVM_LINKAGE_FILE\"))\n+}"}]}