{"sha": "30402beeb200fe85bd7595a6a8e6efdb81ede2b5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwNDAyYmVlYjIwMGZlODViZDc1OTVhNmE4ZTZlZmRiODFlZGUyYjU=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-02-28T12:46:24Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-02-28T12:46:24Z"}, "message": "Fix assert split exprs on comma", "tree": {"sha": "ebab3c1b38b9d1c8ff31ebc2c39fbe41431e4f65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ebab3c1b38b9d1c8ff31ebc2c39fbe41431e4f65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30402beeb200fe85bd7595a6a8e6efdb81ede2b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30402beeb200fe85bd7595a6a8e6efdb81ede2b5", "html_url": "https://github.com/rust-lang/rust/commit/30402beeb200fe85bd7595a6a8e6efdb81ede2b5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30402beeb200fe85bd7595a6a8e6efdb81ede2b5/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c412d5f8d13cd55dc1873fb55e742a317c7846a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/c412d5f8d13cd55dc1873fb55e742a317c7846a8", "html_url": "https://github.com/rust-lang/rust/commit/c412d5f8d13cd55dc1873fb55e742a317c7846a8"}], "stats": {"total": 19, "additions": 2, "deletions": 17}, "files": [{"sha": "eb57ea7d61d677333537d1bdd8b446065c538bb3", "filename": "crates/hir_expand/src/builtin_macro.rs", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/30402beeb200fe85bd7595a6a8e6efdb81ede2b5/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30402beeb200fe85bd7595a6a8e6efdb81ede2b5/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs?ref=30402beeb200fe85bd7595a6a8e6efdb81ede2b5", "patch": "@@ -182,25 +182,10 @@ fn assert_expand(\n     // ```,\n     // which is wrong but useful.\n \n-    let mut args = Vec::new();\n-    let mut current = Vec::new();\n-    for tt in tt.token_trees.iter().cloned() {\n-        match tt {\n-            tt::TokenTree::Leaf(tt::Leaf::Punct(p)) if p.char == ',' => {\n-                args.push(current);\n-                current = Vec::new();\n-            }\n-            _ => {\n-                current.push(tt);\n-            }\n-        }\n-    }\n-    if !current.is_empty() {\n-        args.push(current);\n-    }\n+    let args = parse_exprs_with_sep(tt, ',');\n \n     let arg_tts = args.into_iter().flat_map(|arg| {\n-        quote! { &(##arg), }\n+        quote! { &(#arg), }\n     }.token_trees).collect::<Vec<_>>();\n \n     let expanded = quote! {"}]}