{"sha": "aa23f862dc020a568278dc4ad92c455a0a3ced46", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhMjNmODYyZGMwMjBhNTY4Mjc4ZGM0YWQ5MmM0NTVhMGEzY2VkNDY=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-27T09:32:56Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-27T09:32:56Z"}, "message": "Remove vararg support check\n\nThis check wasn't very useful and removing it simplifies the code.", "tree": {"sha": "adef1c2b28fe63b3d30e929916196c507341a4b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/adef1c2b28fe63b3d30e929916196c507341a4b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa23f862dc020a568278dc4ad92c455a0a3ced46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa23f862dc020a568278dc4ad92c455a0a3ced46", "html_url": "https://github.com/rust-lang/rust/commit/aa23f862dc020a568278dc4ad92c455a0a3ced46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa23f862dc020a568278dc4ad92c455a0a3ced46/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2634478781be741c872f33c7793797c081dc16f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2634478781be741c872f33c7793797c081dc16f", "html_url": "https://github.com/rust-lang/rust/commit/d2634478781be741c872f33c7793797c081dc16f"}], "stats": {"total": 27, "additions": 6, "deletions": 21}, "files": [{"sha": "a27d5b8ab02a251f08b15e427d5a787f992cd76f", "filename": "src/abi/mod.rs", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fabi%2Fmod.rs?ref=aa23f862dc020a568278dc4ad92c455a0a3ced46", "patch": "@@ -140,18 +140,8 @@ pub(crate) fn get_function_sig<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     triple: &target_lexicon::Triple,\n     inst: Instance<'tcx>,\n-    support_vararg: bool,\n ) -> Signature {\n     assert!(!inst.substs.needs_infer());\n-    let fn_sig = tcx\n-        .normalize_erasing_late_bound_regions(ParamEnv::reveal_all(), fn_sig_for_fn_abi(tcx, inst));\n-    if fn_sig.c_variadic && !support_vararg {\n-        tcx.sess.span_fatal(\n-            tcx.def_span(inst.def_id()),\n-            \"Variadic function definitions are not yet supported\",\n-        );\n-    }\n-\n     clif_sig_from_fn_abi(\n         tcx,\n         triple,\n@@ -166,7 +156,7 @@ pub(crate) fn import_function<'tcx>(\n     inst: Instance<'tcx>,\n ) -> FuncId {\n     let name = tcx.symbol_name(inst).name.to_string();\n-    let sig = get_function_sig(tcx, module.isa().triple(), inst, true);\n+    let sig = get_function_sig(tcx, module.isa().triple(), inst);\n     module\n         .declare_function(&name, Linkage::Import, &sig)\n         .unwrap()"}, {"sha": "e81aa52780b3bad68bfd255063da9d5d48b7a718", "filename": "src/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=aa23f862dc020a568278dc4ad92c455a0a3ced46", "patch": "@@ -22,7 +22,7 @@ pub(crate) fn codegen_fn<'tcx>(\n \n     // Declare function\n     let name = tcx.symbol_name(instance).name.to_string();\n-    let sig = get_function_sig(tcx, cx.module.isa().triple(), instance, false);\n+    let sig = get_function_sig(tcx, cx.module.isa().triple(), instance);\n     let func_id = cx.module.declare_function(&name, linkage, &sig).unwrap();\n \n     cx.cached_context.clear();"}, {"sha": "2d14ff2c0221d19c868dea6be771dd18106ff136", "filename": "src/driver/jit.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fdriver%2Fjit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fdriver%2Fjit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Fjit.rs?ref=aa23f862dc020a568278dc4ad92c455a0a3ced46", "patch": "@@ -157,7 +157,7 @@ extern \"C\" fn __clif_jit_fn(instance_ptr: *const Instance<'static>) -> *const u8\n             let mut cx = crate::CodegenCx::new(tcx, jit_module, false, false);\n \n             let name = tcx.symbol_name(instance).name.to_string();\n-            let sig = crate::abi::get_function_sig(tcx, cx.module.isa().triple(), instance, true);\n+            let sig = crate::abi::get_function_sig(tcx, cx.module.isa().triple(), instance);\n             let func_id = cx\n                 .module\n                 .declare_function(&name, Linkage::Export, &sig)\n@@ -243,7 +243,7 @@ pub(super) fn codegen_shim<'tcx>(cx: &mut CodegenCx<'tcx, impl Module>, inst: In\n     let pointer_type = cx.module.target_config().pointer_type();\n \n     let name = tcx.symbol_name(inst).name.to_string();\n-    let sig = crate::abi::get_function_sig(tcx, cx.module.isa().triple(), inst, true);\n+    let sig = crate::abi::get_function_sig(tcx, cx.module.isa().triple(), inst);\n     let func_id = cx\n         .module\n         .declare_function(&name, Linkage::Export, &sig)"}, {"sha": "752c3f747d5f766bc99c6c6ed40ee43192b1dabf", "filename": "src/driver/mod.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fdriver%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fdriver%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Fmod.rs?ref=aa23f862dc020a568278dc4ad92c455a0a3ced46", "patch": "@@ -51,12 +51,7 @@ fn predefine_mono_items<'tcx>(\n             match mono_item {\n                 MonoItem::Fn(instance) => {\n                     let name = cx.tcx.symbol_name(instance).name.to_string();\n-                    let sig= get_function_sig(\n-                        cx.tcx,\n-                        cx.module.isa().triple(),\n-                        instance,\n-                        false,\n-                    );\n+                    let sig = get_function_sig(cx.tcx, cx.module.isa().triple(), instance);\n                     let linkage = crate::linkage::get_clif_linkage(mono_item, linkage, visibility);\n                     cx.module.declare_function(&name, linkage, &sig).unwrap();\n                 }"}, {"sha": "b193cea877dad493996c9bbee8cf1a1011345bc3", "filename": "src/main_shim.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fmain_shim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa23f862dc020a568278dc4ad92c455a0a3ced46/src%2Fmain_shim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain_shim.rs?ref=aa23f862dc020a568278dc4ad92c455a0a3ced46", "patch": "@@ -70,7 +70,7 @@ pub(crate) fn maybe_create_entry_wrapper(\n         let instance = Instance::mono(tcx, rust_main_def_id).polymorphize(tcx);\n \n         let main_name = tcx.symbol_name(instance).name.to_string();\n-        let main_sig = get_function_sig(tcx, m.isa().triple(), instance, false);\n+        let main_sig = get_function_sig(tcx, m.isa().triple(), instance);\n         let main_func_id = m\n             .declare_function(&main_name, Linkage::Import, &main_sig)\n             .unwrap();"}]}