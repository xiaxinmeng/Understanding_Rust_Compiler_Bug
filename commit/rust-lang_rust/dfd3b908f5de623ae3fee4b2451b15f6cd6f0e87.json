{"sha": "dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmZDNiOTA4ZjVkZTYyM2FlM2ZlZTRiMjQ1MWIxNWY2Y2Q2ZjBlODc=", "commit": {"author": {"name": "Michael Neumann", "email": "mneumann@ntecs.de", "date": "2016-12-06T18:31:48Z"}, "committer": {"name": "Michael Neumann", "email": "mneumann@ntecs.de", "date": "2016-12-06T18:31:48Z"}, "message": "Fix current_exe() on DragonFly (again)\n\nThis is a follow up on [this pull request][1].\n\nSince DragonFly 4.6.1 ([this commit][2]), the \"kern.proc.pathname\"\nsysctl works correctly, i.e. it does not return paths including a \":\"\n(see [here][3]). Use it and don't try to fix old versions of DragonFly!\nThere are not many DragonFly installations out there that we can't\ncontrol and no one is compiling Rust from source. If someone wants to\nrun Rust on a pre-4.6.1 DragonFly system, the ports system should\nprovide a patch.\n\n[1]: https://github.com/rust-lang/rust/pull/35494\n[2]: https://gitweb.dragonflybsd.org/dragonfly.git/commit/726f7ca07e193db73635e9c4e24e40c96087d6d9\n[3]: https://gist.github.com/mneumann/a2f6b6a0a03935b561d6185872a4b222", "tree": {"sha": "4fdb09aa2fced13c2c138ce4f839e21fcb99ff6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4fdb09aa2fced13c2c138ce4f839e21fcb99ff6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87", "html_url": "https://github.com/rust-lang/rust/commit/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87/comments", "author": {"login": "mneumann", "id": 34112, "node_id": "MDQ6VXNlcjM0MTEy", "avatar_url": "https://avatars.githubusercontent.com/u/34112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mneumann", "html_url": "https://github.com/mneumann", "followers_url": "https://api.github.com/users/mneumann/followers", "following_url": "https://api.github.com/users/mneumann/following{/other_user}", "gists_url": "https://api.github.com/users/mneumann/gists{/gist_id}", "starred_url": "https://api.github.com/users/mneumann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mneumann/subscriptions", "organizations_url": "https://api.github.com/users/mneumann/orgs", "repos_url": "https://api.github.com/users/mneumann/repos", "events_url": "https://api.github.com/users/mneumann/events{/privacy}", "received_events_url": "https://api.github.com/users/mneumann/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mneumann", "id": 34112, "node_id": "MDQ6VXNlcjM0MTEy", "avatar_url": "https://avatars.githubusercontent.com/u/34112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mneumann", "html_url": "https://github.com/mneumann", "followers_url": "https://api.github.com/users/mneumann/followers", "following_url": "https://api.github.com/users/mneumann/following{/other_user}", "gists_url": "https://api.github.com/users/mneumann/gists{/gist_id}", "starred_url": "https://api.github.com/users/mneumann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mneumann/subscriptions", "organizations_url": "https://api.github.com/users/mneumann/orgs", "repos_url": "https://api.github.com/users/mneumann/repos", "events_url": "https://api.github.com/users/mneumann/events{/privacy}", "received_events_url": "https://api.github.com/users/mneumann/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d14d74d5f7d39d1e2583bca231c26bbc0d4ee9a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/d14d74d5f7d39d1e2583bca231c26bbc0d4ee9a0", "html_url": "https://github.com/rust-lang/rust/commit/d14d74d5f7d39d1e2583bca231c26bbc0d4ee9a0"}], "stats": {"total": 9, "additions": 2, "deletions": 7}, "files": [{"sha": "6992a17832e413690eae495c362f2e2bbee825f5", "filename": "src/libstd/sys/unix/os.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87/src%2Flibstd%2Fsys%2Funix%2Fos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87/src%2Flibstd%2Fsys%2Funix%2Fos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fos.rs?ref=dfd3b908f5de623ae3fee4b2451b15f6cd6f0e87", "patch": "@@ -78,7 +78,7 @@ pub fn errno() -> i32 {\n         static errno: c_int;\n     }\n \n-    errno as i32\n+    unsafe { errno as i32 }\n }\n \n /// Gets a detailed string description for the given error number.\n@@ -193,7 +193,7 @@ impl StdError for JoinPathsError {\n     fn description(&self) -> &str { \"failed to join paths\" }\n }\n \n-#[cfg(target_os = \"freebsd\")]\n+#[cfg(any(target_os = \"freebsd\", target_os = \"dragonfly\"))]\n pub fn current_exe() -> io::Result<PathBuf> {\n     unsafe {\n         let mut mib = [libc::CTL_KERN as c_int,\n@@ -218,11 +218,6 @@ pub fn current_exe() -> io::Result<PathBuf> {\n     }\n }\n \n-#[cfg(target_os = \"dragonfly\")]\n-pub fn current_exe() -> io::Result<PathBuf> {\n-    ::fs::read_link(\"/proc/curproc/file\")\n-}\n-\n #[cfg(target_os = \"netbsd\")]\n pub fn current_exe() -> io::Result<PathBuf> {\n     ::fs::read_link(\"/proc/curproc/exe\")"}]}