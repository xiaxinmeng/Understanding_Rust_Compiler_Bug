{"sha": "e00993a1abacc2bf211892af1e8012b55ad1ed9b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwMDk5M2ExYWJhY2MyYmYyMTE4OTJhZjFlODAxMmI1NWFkMWVkOWI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-08-30T01:56:55Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-09-08T11:15:11Z"}, "message": "Add test cases for possible restricted shadowing configurations\n\nWhitelist `#[rustc_transparent_macro]` so it's not interpreted as a potential attribute macro", "tree": {"sha": "d365288b790a213aee160612667480157bf1cc9a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d365288b790a213aee160612667480157bf1cc9a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e00993a1abacc2bf211892af1e8012b55ad1ed9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e00993a1abacc2bf211892af1e8012b55ad1ed9b", "html_url": "https://github.com/rust-lang/rust/commit/e00993a1abacc2bf211892af1e8012b55ad1ed9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e00993a1abacc2bf211892af1e8012b55ad1ed9b/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d26ae20507b1ebdb51c48d4799edaa45c290bfe5", "url": "https://api.github.com/repos/rust-lang/rust/commits/d26ae20507b1ebdb51c48d4799edaa45c290bfe5", "html_url": "https://github.com/rust-lang/rust/commit/d26ae20507b1ebdb51c48d4799edaa45c290bfe5"}], "stats": {"total": 880, "additions": 880, "deletions": 0}, "files": [{"sha": "cee6f3e261c4f0aa4ddac3e8887d1d84754a7643", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=e00993a1abacc2bf211892af1e8012b55ad1ed9b", "patch": "@@ -966,6 +966,10 @@ pub const BUILTIN_ATTRIBUTES: &'static [(&'static str, AttributeType, AttributeG\n                                      \"the `#[rustc_test_marker]` attribute \\\n                                       is used internally to track tests\",\n                                      cfg_fn!(rustc_attrs))),\n+    (\"rustc_transparent_macro\", Whitelisted, Gated(Stability::Unstable,\n+                                                   \"rustc_attrs\",\n+                                                   \"used internally for testing macro hygiene\",\n+                                                    cfg_fn!(rustc_attrs))),\n \n     // RFC #2094\n     (\"nll\", Whitelisted, Gated(Stability::Unstable,"}, {"sha": "7950dce25a67e66d4b240a10d622293ffaa6f75a", "filename": "src/test/ui/macros/restricted-shadowing-legacy.rs", "status": "added", "additions": 281, "deletions": 0, "changes": 281, "blob_url": "https://github.com/rust-lang/rust/blob/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.rs?ref=e00993a1abacc2bf211892af1e8012b55ad1ed9b", "patch": "@@ -0,0 +1,281 @@\n+// Legend:\n+// `+` - possible configuration\n+// `-` - configuration impossible due to properties of partial ordering\n+// `-?` - configuration impossible due to block/scope syntax\n+// `+?` - configuration possible only with legacy scoping\n+\n+//  N | Outer ~ Invoc | Invoc ~ Inner | Outer ~ Inner | Possible |\n+//  1 |       <       |       <       |       <       |    +     |\n+//  2 |       <       |       <       |       =       |    -     |\n+//  3 |       <       |       <       |       >       |    -     |\n+//  4 |       <       |       <       |   Unordered   |    -     |\n+//  5 |       <       |       =       |       <       |    +     |\n+//  6 |       <       |       =       |       =       |    -     |\n+//  7 |       <       |       =       |       >       |    -     |\n+//  8 |       <       |       =       |   Unordered   |    -     |\n+//  9 |       <       |       >       |       <       |    +     |\n+// 10 |       <       |       >       |       =       |    +     |\n+// 11 |       <       |       >       |       >       |    -?    |\n+// 12 |       <       |       >       |   Unordered   |    -?    |\n+// 13 |       <       |   Unordered   |       <       |    +     |\n+// 14 |       <       |   Unordered   |       =       |    -     |\n+// 15 |       <       |   Unordered   |       >       |    -     |\n+// 16 |       <       |   Unordered   |   Unordered   |    -?    |\n+// 17 |       =       |       <       |       <       |    +     |\n+// 18 |       =       |       <       |       =       |    -     |\n+// 19 |       =       |       <       |       >       |    -     |\n+// 20 |       =       |       <       |   Unordered   |    -     |\n+// 21 |       =       |       =       |       <       |    -     |\n+// 22 |       =       |       =       |       =       |    +     |\n+// 23 |       =       |       =       |       >       |    -     |\n+// 24 |       =       |       =       |   Unordered   |    -     |\n+// 25 |       =       |       >       |       <       |    -     |\n+// 26 |       =       |       >       |       =       |    -     |\n+// 27 |       =       |       >       |       >       |    -?    |\n+// 28 |       =       |       >       |   Unordered   |    -     |\n+// 29 |       =       |   Unordered   |       <       |    -     |\n+// 30 |       =       |   Unordered   |       =       |    -     |\n+// 31 |       =       |   Unordered   |       >       |    -     |\n+// 32 |       =       |   Unordered   |   Unordered   |    -?    |\n+// 33 |       >       |       <       |       <       |    +?    |\n+// 34 |       >       |       <       |       =       |    +?    |\n+// 35 |       >       |       <       |       >       |    +?    |\n+// 36 |       >       |       <       |   Unordered   |    +     |\n+// 37 |       >       |       =       |       <       |    -     |\n+// 38 |       >       |       =       |       =       |    -     |\n+// 39 |       >       |       =       |       >       |    +     |\n+// 40 |       >       |       =       |   Unordered   |    -     |\n+// 41 |       >       |       >       |       <       |    -     |\n+// 42 |       >       |       >       |       =       |    -     |\n+// 43 |       >       |       >       |       >       |    -?    |\n+// 44 |       >       |       >       |   Unordered   |    -     |\n+// 45 |       >       |   Unordered   |       <       |    -     |\n+// 46 |       >       |   Unordered   |       =       |    -     |\n+// 47 |       >       |   Unordered   |       >       |    -?    |\n+// 48 |       >       |   Unordered   |   Unordered   |    -?    |\n+// 49 |   Unordered   |       <       |       <       |    -?    |\n+// 50 |   Unordered   |       <       |       =       |    -     |\n+// 51 |   Unordered   |       <       |       >       |    -     |\n+// 52 |   Unordered   |       <       |   Unordered   |    +     |\n+// 53 |   Unordered   |       =       |       <       |    -     |\n+// 54 |   Unordered   |       =       |       =       |    -     |\n+// 55 |   Unordered   |       =       |       >       |    -     |\n+// 56 |   Unordered   |       =       |   Unordered   |    +     |\n+// 57 |   Unordered   |       >       |       <       |    -     |\n+// 58 |   Unordered   |       >       |       =       |    -     |\n+// 59 |   Unordered   |       >       |       >       |    +     |\n+// 60 |   Unordered   |       >       |   Unordered   |    +     |\n+// 61 |   Unordered   |   Unordered   |       <       |    +?    |\n+// 62 |   Unordered   |   Unordered   |       =       |    +?    |\n+// 63 |   Unordered   |   Unordered   |       >       |    +?    |\n+// 64 |   Unordered   |   Unordered   |   Unordered   |    +     |\n+\n+#![feature(decl_macro, rustc_attrs)]\n+\n+macro_rules! include { () => {\n+    macro_rules! gen_outer { () => {\n+        macro_rules! m { () => {} }\n+    }}\n+    macro_rules! gen_inner { () => {\n+        macro_rules! m { () => {} }\n+    }}\n+    macro_rules! gen_invoc { () => {\n+        m!()\n+    }}\n+\n+    // -----------------------------------------------------------\n+\n+    fn check1() {\n+        macro_rules! m { () => {} }\n+\n+        macro_rules! gen_gen_inner_invoc { () => {\n+            gen_inner!();\n+            m!(); //~ ERROR `m` is ambiguous\n+        }}\n+        gen_gen_inner_invoc!();\n+    }\n+\n+    fn check5() {\n+        macro_rules! m { () => {} }\n+\n+        macro_rules! gen_inner_invoc { () => {\n+            macro_rules! m { () => {} }\n+            m!(); // OK\n+        }}\n+        gen_inner_invoc!();\n+    }\n+\n+    fn check9() {\n+        macro_rules! m { () => {} }\n+\n+        macro_rules! gen_inner_gen_invoc { () => {\n+            macro_rules! m { () => {} }\n+            gen_invoc!(); // OK\n+        }}\n+        gen_inner_gen_invoc!();\n+    }\n+\n+    fn check10() {\n+        macro_rules! m { () => {} }\n+\n+        macro_rules! m { () => {} }\n+\n+        gen_invoc!(); // OK\n+    }\n+\n+    fn check13() {\n+        macro_rules! m { () => {} }\n+\n+        gen_inner!();\n+\n+        macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+        gen_invoc!();\n+    }\n+\n+    fn check17() {\n+        macro_rules! m { () => {} }\n+\n+        gen_inner!();\n+\n+        m!(); //~ ERROR `m` is ambiguous\n+    }\n+\n+    fn check22() {\n+        macro_rules! m { () => {} }\n+\n+        macro_rules! m { () => {} }\n+\n+        m!(); // OK\n+    }\n+\n+    fn check36() {\n+        gen_outer!();\n+\n+        gen_inner!();\n+\n+        m!(); //~ ERROR `m` is ambiguous\n+    }\n+\n+    fn check39() {\n+        gen_outer!();\n+\n+        macro_rules! m { () => {} }\n+\n+        m!(); // OK\n+    }\n+\n+    fn check52() {\n+        gen_outer!();\n+\n+        macro_rules! gen_gen_inner_invoc { () => {\n+            gen_inner!();\n+            m!(); //~ ERROR `m` is ambiguous\n+        }}\n+        gen_gen_inner_invoc!();\n+    }\n+\n+    fn check56() {\n+        gen_outer!();\n+\n+        macro_rules! gen_inner_invoc { () => {\n+            macro_rules! m { () => {} }\n+            m!(); // OK\n+        }}\n+        gen_inner_invoc!();\n+    }\n+\n+    fn check59() {\n+        gen_outer!();\n+\n+        macro_rules! m { () => {} }\n+\n+        gen_invoc!(); // OK\n+    }\n+\n+    fn check60() {\n+        gen_outer!();\n+\n+        macro_rules! gen_inner_gen_invoc { () => {\n+            macro_rules! m { () => {} }\n+            gen_invoc!(); // OK\n+        }}\n+        gen_inner_gen_invoc!();\n+    }\n+\n+    fn check64() {\n+        gen_outer!();\n+\n+        gen_inner!();\n+\n+        macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+        gen_invoc!();\n+    }\n+\n+    // -----------------------------------------------------------\n+    // These configurations are only possible with legacy macro scoping\n+\n+    fn check33() {\n+        macro_rules! gen_outer_gen_inner { () => {\n+            macro_rules! m { () => {} }\n+            gen_inner!();\n+        }}\n+        gen_outer_gen_inner!();\n+\n+        m!(); //~ ERROR `m` is ambiguous\n+    }\n+\n+    fn check34() {\n+        macro_rules! gen_outer_inner { () => {\n+            macro_rules! m { () => {} }\n+            macro_rules! m { () => {} }\n+        }}\n+        gen_outer_inner!();\n+\n+        m!(); // OK\n+    }\n+\n+    fn check35() {\n+        macro_rules! gen_gen_outer_inner { () => {\n+            gen_outer!();\n+            macro_rules! m { () => {} }\n+        }}\n+        gen_gen_outer_inner!();\n+\n+        m!(); // OK\n+    }\n+\n+    fn check61() {\n+        macro_rules! gen_outer_gen_inner { () => {\n+            macro_rules! m { () => {} }\n+            gen_inner!();\n+        }}\n+        gen_outer_gen_inner!();\n+\n+        macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+        gen_invoc!();\n+    }\n+\n+    fn check62() {\n+        macro_rules! gen_outer_inner { () => {\n+            macro_rules! m { () => {} }\n+            macro_rules! m { () => {} }\n+        }}\n+        gen_outer_inner!();\n+\n+        gen_invoc!(); // OK\n+    }\n+\n+    fn check63() {\n+        macro_rules! gen_gen_outer_inner { () => {\n+            gen_outer!();\n+            macro_rules! m { () => {} }\n+        }}\n+        gen_gen_outer_inner!();\n+\n+        gen_invoc!(); // OK\n+    }\n+}}\n+\n+include!();\n+\n+fn main() {}"}, {"sha": "cd069343c0b6863af416df36183b9c8f431fa0b9", "filename": "src/test/ui/macros/restricted-shadowing-legacy.stderr", "status": "added", "additions": 195, "deletions": 0, "changes": 195, "blob_url": "https://github.com/rust-lang/rust/blob/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-legacy.stderr?ref=e00993a1abacc2bf211892af1e8012b55ad1ed9b", "patch": "@@ -0,0 +1,195 @@\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:93:13\n+   |\n+LL |             m!(); //~ ERROR `m` is ambiguous\n+   |             ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:89:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:131:42\n+   |\n+LL |         macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+   |                                          ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:127:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:140:9\n+   |\n+LL |         m!(); //~ ERROR `m` is ambiguous\n+   |         ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:136:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:156:9\n+   |\n+LL |         m!(); //~ ERROR `m` is ambiguous\n+   |         ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:77:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:172:13\n+   |\n+LL |             m!(); //~ ERROR `m` is ambiguous\n+   |             ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:77:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:210:42\n+   |\n+LL |         macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+   |                                          ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:77:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:224:9\n+   |\n+LL |         m!(); //~ ERROR `m` is ambiguous\n+   |         ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:219:13\n+   |\n+LL |             macro_rules! m { () => {} }\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-legacy.rs:254:42\n+   |\n+LL |         macro_rules! gen_invoc { () => { m!() } } //~ ERROR `m` is ambiguous\n+   |                                          ^\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:80:9\n+   |\n+LL |         macro_rules! m { () => {} }\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-legacy.rs:249:13\n+   |\n+LL |             macro_rules! m { () => {} }\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error: aborting due to 8 previous errors\n+\n+For more information about this error, try `rustc --explain E0659`."}, {"sha": "20528101614996730485735dead197298dcc5b07", "filename": "src/test/ui/macros/restricted-shadowing-modern.rs", "status": "added", "additions": 235, "deletions": 0, "changes": 235, "blob_url": "https://github.com/rust-lang/rust/blob/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.rs?ref=e00993a1abacc2bf211892af1e8012b55ad1ed9b", "patch": "@@ -0,0 +1,235 @@\n+// Legend:\n+// `+` - possible configuration\n+// `-` - configuration impossible due to properties of partial ordering\n+// `-?` - configuration impossible due to block/scope syntax\n+// `+?` - configuration possible only with legacy scoping\n+\n+//  N | Outer ~ Invoc | Invoc ~ Inner | Outer ~ Inner | Possible |\n+//  1 |       <       |       <       |       <       |    +     |\n+//  2 |       <       |       <       |       =       |    -     |\n+//  3 |       <       |       <       |       >       |    -     |\n+//  4 |       <       |       <       |   Unordered   |    -     |\n+//  5 |       <       |       =       |       <       |    +     |\n+//  6 |       <       |       =       |       =       |    -     |\n+//  7 |       <       |       =       |       >       |    -     |\n+//  8 |       <       |       =       |   Unordered   |    -     |\n+//  9 |       <       |       >       |       <       |    +     |\n+// 10 |       <       |       >       |       =       |    +     |\n+// 11 |       <       |       >       |       >       |    -?    |\n+// 12 |       <       |       >       |   Unordered   |    -?    |\n+// 13 |       <       |   Unordered   |       <       |    +     |\n+// 14 |       <       |   Unordered   |       =       |    -     |\n+// 15 |       <       |   Unordered   |       >       |    -     |\n+// 16 |       <       |   Unordered   |   Unordered   |    -?    |\n+// 17 |       =       |       <       |       <       |    +     |\n+// 18 |       =       |       <       |       =       |    -     |\n+// 19 |       =       |       <       |       >       |    -     |\n+// 20 |       =       |       <       |   Unordered   |    -     |\n+// 21 |       =       |       =       |       <       |    -     |\n+// 22 |       =       |       =       |       =       |    +     |\n+// 23 |       =       |       =       |       >       |    -     |\n+// 24 |       =       |       =       |   Unordered   |    -     |\n+// 25 |       =       |       >       |       <       |    -     |\n+// 26 |       =       |       >       |       =       |    -     |\n+// 27 |       =       |       >       |       >       |    -?    |\n+// 28 |       =       |       >       |   Unordered   |    -     |\n+// 29 |       =       |   Unordered   |       <       |    -     |\n+// 30 |       =       |   Unordered   |       =       |    -     |\n+// 31 |       =       |   Unordered   |       >       |    -     |\n+// 32 |       =       |   Unordered   |   Unordered   |    -?    |\n+// 33 |       >       |       <       |       <       |    -?    |\n+// 34 |       >       |       <       |       =       |    -?    |\n+// 35 |       >       |       <       |       >       |    -?    |\n+// 36 |       >       |       <       |   Unordered   |    +     |\n+// 37 |       >       |       =       |       <       |    -     |\n+// 38 |       >       |       =       |       =       |    -     |\n+// 39 |       >       |       =       |       >       |    +     |\n+// 40 |       >       |       =       |   Unordered   |    -     |\n+// 41 |       >       |       >       |       <       |    -     |\n+// 42 |       >       |       >       |       =       |    -     |\n+// 43 |       >       |       >       |       >       |    -?    |\n+// 44 |       >       |       >       |   Unordered   |    -     |\n+// 45 |       >       |   Unordered   |       <       |    -     |\n+// 46 |       >       |   Unordered   |       =       |    -     |\n+// 47 |       >       |   Unordered   |       >       |    -?    |\n+// 48 |       >       |   Unordered   |   Unordered   |    -?    |\n+// 49 |   Unordered   |       <       |       <       |    -?    |\n+// 50 |   Unordered   |       <       |       =       |    -     |\n+// 51 |   Unordered   |       <       |       >       |    -     |\n+// 52 |   Unordered   |       <       |   Unordered   |    +     |\n+// 53 |   Unordered   |       =       |       <       |    -     |\n+// 54 |   Unordered   |       =       |       =       |    -     |\n+// 55 |   Unordered   |       =       |       >       |    -     |\n+// 56 |   Unordered   |       =       |   Unordered   |    +     |\n+// 57 |   Unordered   |       >       |       <       |    -     |\n+// 58 |   Unordered   |       >       |       =       |    -     |\n+// 59 |   Unordered   |       >       |       >       |    +     |\n+// 60 |   Unordered   |       >       |   Unordered   |    +     |\n+// 61 |   Unordered   |   Unordered   |       <       |    -?    |\n+// 62 |   Unordered   |   Unordered   |       =       |    -?    |\n+// 63 |   Unordered   |   Unordered   |       >       |    -?    |\n+// 64 |   Unordered   |   Unordered   |   Unordered   |    +     |\n+\n+#![feature(decl_macro, rustc_attrs)]\n+\n+#[rustc_transparent_macro]\n+macro include() {\n+    #[rustc_transparent_macro]\n+    macro gen_outer() {\n+        macro m() {}\n+    }\n+    #[rustc_transparent_macro]\n+    macro gen_inner() {\n+        macro m() {}\n+    }\n+    #[rustc_transparent_macro]\n+    macro gen_invoc() {\n+        m!()\n+    }\n+\n+    // -----------------------------------------------------------\n+\n+    fn check1() {\n+        macro m() {}\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_gen_inner_invoc() {\n+                gen_inner!();\n+                m!(); //~ ERROR `m` is ambiguous\n+            }\n+            gen_gen_inner_invoc!();\n+        }\n+    }\n+\n+    fn check5() {\n+        macro m() {}\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_inner_invoc() {\n+                macro m() {}\n+                m!(); // OK\n+            }\n+            gen_inner_invoc!();\n+        }\n+    }\n+\n+    fn check9() {\n+        macro m() {}\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_inner_gen_invoc() {\n+                macro m() {}\n+                gen_invoc!(); // OK\n+            }\n+            gen_inner_gen_invoc!();\n+        }\n+    }\n+\n+    fn check10() {\n+        macro m() {}\n+        {\n+            macro m() {}\n+            gen_invoc!(); // OK\n+        }\n+    }\n+\n+    fn check13() {\n+        macro m() {}\n+        {\n+            gen_inner!();\n+            #[rustc_transparent_macro]\n+            macro gen_invoc() { m!() } //~ ERROR `m` is ambiguous\n+            gen_invoc!();\n+        }\n+    }\n+\n+    fn check17() {\n+        macro m() {}\n+        {\n+            gen_inner!();\n+            m!(); //~ ERROR `m` is ambiguous\n+        }\n+    }\n+\n+    fn check22() {\n+        macro m() {}\n+        {\n+            macro m() {}\n+            m!(); // OK\n+        }\n+    }\n+\n+    fn check36() {\n+        gen_outer!();\n+        {\n+            gen_inner!();\n+            m!(); //~ ERROR `m` is ambiguous\n+        }\n+    }\n+\n+    fn check39() {\n+        gen_outer!();\n+        {\n+            macro m() {}\n+            m!(); // OK\n+        }\n+    }\n+\n+    fn check52() {\n+        gen_outer!();\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_gen_inner_invoc() {\n+                gen_inner!();\n+                m!(); //~ ERROR `m` is ambiguous\n+            }\n+            gen_gen_inner_invoc!();\n+        }\n+    }\n+\n+    fn check56() {\n+        gen_outer!();\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_inner_invoc() {\n+                macro m() {}\n+                m!(); // OK\n+            }\n+            gen_inner_invoc!();\n+        }\n+    }\n+\n+    fn check59() {\n+        gen_outer!();\n+        {\n+            macro m() {}\n+            gen_invoc!(); // OK\n+        }\n+    }\n+\n+    fn check60() {\n+        gen_outer!();\n+        {\n+            #[rustc_transparent_macro]\n+            macro gen_inner_gen_invoc() {\n+                macro m() {}\n+                gen_invoc!(); // OK\n+            }\n+            gen_inner_gen_invoc!();\n+        }\n+    }\n+\n+    fn check64() {\n+        gen_outer!();\n+        {\n+            gen_inner!();\n+            #[rustc_transparent_macro]\n+            macro gen_invoc() { m!() } //~ ERROR `m` is ambiguous\n+            gen_invoc!();\n+        }\n+    }\n+}\n+\n+include!();\n+\n+fn main() {}"}, {"sha": "8d64c6c47699f5fb4b0e1872db1ba3d7f0469656", "filename": "src/test/ui/macros/restricted-shadowing-modern.stderr", "status": "added", "additions": 165, "deletions": 0, "changes": 165, "blob_url": "https://github.com/rust-lang/rust/blob/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e00993a1abacc2bf211892af1e8012b55ad1ed9b/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Frestricted-shadowing-modern.stderr?ref=e00993a1abacc2bf211892af1e8012b55ad1ed9b", "patch": "@@ -0,0 +1,165 @@\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:98:17\n+   |\n+LL |                 m!(); //~ ERROR `m` is ambiguous\n+   |                 ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:93:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:141:33\n+   |\n+LL |             macro gen_invoc() { m!() } //~ ERROR `m` is ambiguous\n+   |                                 ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:137:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:150:13\n+   |\n+LL |             m!(); //~ ERROR `m` is ambiguous\n+   |             ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:147:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:166:13\n+   |\n+LL |             m!(); //~ ERROR `m` is ambiguous\n+   |             ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:79:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:184:17\n+   |\n+LL |                 m!(); //~ ERROR `m` is ambiguous\n+   |                 ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:79:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error[E0659]: `m` is ambiguous\n+  --> $DIR/restricted-shadowing-modern.rs:227:33\n+   |\n+LL |             macro gen_invoc() { m!() } //~ ERROR `m` is ambiguous\n+   |                                 ^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   |\n+note: `m` could refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:83:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+note: `m` could also refer to the name defined here\n+  --> $DIR/restricted-shadowing-modern.rs:79:9\n+   |\n+LL |         macro m() {}\n+   |         ^^^^^^^^^^^^\n+...\n+LL | include!();\n+   | ----------- in this macro invocation\n+   = note: macro-expanded macros do not shadow\n+\n+error: aborting due to 6 previous errors\n+\n+For more information about this error, try `rustc --explain E0659`."}]}