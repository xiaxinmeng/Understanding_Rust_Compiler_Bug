{"sha": "b65277496c8848cd6f08b55e8b413096c74b92af", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2NTI3NzQ5NmM4ODQ4Y2Q2ZjA4YjU1ZThiNDEzMDk2Yzc0YjkyYWY=", "commit": {"author": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2015-12-30T04:55:38Z"}, "committer": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2015-12-30T04:55:38Z"}, "message": "Fix argument indices in MIR for closures.\n\nPreviously, all references to closure arguments went to the argument before the\none they should (e.g. to arg1 when it was supposed to be arg2). This was because\nthe MIR builder did not account for the implicit arguments that come before the\nexplicit arguments, and closures have one implicit argument - the struct\ncontaining the captures.", "tree": {"sha": "f8dbcc24bf2caca334e25a621eea87dc037ca6cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8dbcc24bf2caca334e25a621eea87dc037ca6cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b65277496c8848cd6f08b55e8b413096c74b92af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b65277496c8848cd6f08b55e8b413096c74b92af", "html_url": "https://github.com/rust-lang/rust/commit/b65277496c8848cd6f08b55e8b413096c74b92af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b65277496c8848cd6f08b55e8b413096c74b92af/comments", "author": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e2a64b57a74f35bef215972adf1b803cff288bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e2a64b57a74f35bef215972adf1b803cff288bd", "html_url": "https://github.com/rust-lang/rust/commit/6e2a64b57a74f35bef215972adf1b803cff288bd"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "7ea9301664f99139a0186de5a92b2643676b2169", "filename": "src/librustc_mir/build/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b65277496c8848cd6f08b55e8b413096c74b92af/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b65277496c8848cd6f08b55e8b413096c74b92af/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmod.rs?ref=b65277496c8848cd6f08b55e8b413096c74b92af", "patch": "@@ -139,6 +139,7 @@ impl<'a,'tcx> Builder<'a,'tcx> {\n     {\n         self.in_scope(argument_extent, block, |this| {\n             let arg_decls = {\n+                let num_implicit_args = implicit_arguments.len();\n                 let implicit_arg_decls = implicit_arguments.into_iter()\n                                                            .map(|ty| ArgDecl { ty: ty });\n \n@@ -149,7 +150,7 @@ impl<'a,'tcx> Builder<'a,'tcx> {\n                     .into_iter()\n                     .enumerate()\n                     .map(|(index, (ty, pattern))| {\n-                        let lvalue = Lvalue::Arg(index as u32);\n+                        let lvalue = Lvalue::Arg((num_implicit_args + index) as u32);\n                         let pattern = this.hir.irrefutable_pat(pattern);\n                         unpack!(block = this.lvalue_into_pattern(block,\n                                                                  argument_extent,"}]}