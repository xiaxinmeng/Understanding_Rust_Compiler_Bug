{"sha": "11adac350b63ab3371a50b10184238ebc3a2be7f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExYWRhYzM1MGI2M2FiMzM3MWE1MGIxMDE4NDIzOGViYzNhMmJlN2Y=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2017-03-03T02:27:07Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2017-03-04T18:38:26Z"}, "message": "bootstrap.py: Report build status\n\nMove some code from x.py to bootstrap.py", "tree": {"sha": "87e871ec683de27076f38a832b8f04dc8b671860", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87e871ec683de27076f38a832b8f04dc8b671860"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11adac350b63ab3371a50b10184238ebc3a2be7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11adac350b63ab3371a50b10184238ebc3a2be7f", "html_url": "https://github.com/rust-lang/rust/commit/11adac350b63ab3371a50b10184238ebc3a2be7f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11adac350b63ab3371a50b10184238ebc3a2be7f/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b454665ea360619ceb45aac5b9eae6d5994dc64", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b454665ea360619ceb45aac5b9eae6d5994dc64", "html_url": "https://github.com/rust-lang/rust/commit/3b454665ea360619ceb45aac5b9eae6d5994dc64"}], "stats": {"total": 35, "additions": 21, "deletions": 14}, "files": [{"sha": "7dd53f41a214adb838a281bdef446e56590931be", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/11adac350b63ab3371a50b10184238ebc3a2be7f/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/11adac350b63ab3371a50b10184238ebc3a2be7f/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=11adac350b63ab3371a50b10184238ebc3a2be7f", "patch": "@@ -8,6 +8,7 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n+from __future__ import print_function\n import argparse\n import contextlib\n import datetime\n@@ -501,7 +502,7 @@ def build_triple(self):\n \n         return \"{}-{}\".format(cputype, ostype)\n \n-def main():\n+def bootstrap():\n     parser = argparse.ArgumentParser(description='Build rust')\n     parser.add_argument('--config')\n     parser.add_argument('--clean', action='store_true')\n@@ -564,8 +565,6 @@ def main():\n     rb._rustc_channel, rb._rustc_date = data['rustc'].split('-', 1)\n     rb._cargo_rev = data['cargo']\n \n-    start_time = time()\n-\n     # Fetch/build the bootstrap\n     rb.build = rb.build_triple()\n     rb.download_stage0()\n@@ -582,9 +581,19 @@ def main():\n     env[\"BOOTSTRAP_PARENT_ID\"] = str(os.getpid())\n     rb.run(args, env)\n \n-    end_time = time()\n-\n-    print(\"Build completed in %s\" % format_build_time(end_time - start_time))\n+def main():\n+    start_time = time()\n+    try:\n+        bootstrap()\n+        print(\"Build completed successfully in %s\" % format_build_time(time() - start_time))\n+    except (SystemExit, KeyboardInterrupt) as e:\n+        if hasattr(e, 'code') and isinstance(e.code, int):\n+            exit_code = e.code\n+        else:\n+            exit_code = 1\n+            print(e)\n+        print(\"Build completed unsuccessfully in %s\" % format_build_time(time() - start_time))\n+        sys.exit(exit_code)\n \n if __name__ == '__main__':\n     main()"}, {"sha": "8f528889d6020282c569c02b5e92059282214596", "filename": "x.py", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/11adac350b63ab3371a50b10184238ebc3a2be7f/x.py", "raw_url": "https://github.com/rust-lang/rust/raw/11adac350b63ab3371a50b10184238ebc3a2be7f/x.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x.py?ref=11adac350b63ab3371a50b10184238ebc3a2be7f", "patch": "@@ -9,14 +9,12 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n-import sys\n+# This file is only a \"symlink\" to boostrap.py, all logic should go there.\n+\n import os\n-dir = os.path.dirname(__file__)\n-sys.path.append(os.path.abspath(os.path.join(dir, \"src\", \"bootstrap\")))\n+import sys\n+rust_dir = os.path.dirname(os.path.abspath(__file__))\n+sys.path.append(os.path.join(rust_dir, \"src\", \"bootstrap\"))\n \n import bootstrap\n-\n-try:\n-    bootstrap.main()\n-except KeyboardInterrupt:\n-    sys.exit()\n+bootstrap.main()"}]}