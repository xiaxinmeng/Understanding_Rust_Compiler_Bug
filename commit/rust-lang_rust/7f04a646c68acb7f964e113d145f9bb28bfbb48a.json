{"sha": "7f04a646c68acb7f964e113d145f9bb28bfbb48a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmMDRhNjQ2YzY4YWNiN2Y5NjRlMTEzZDE0NWY5YmIyOGJmYmI0OGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-15T06:42:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-15T06:42:27Z"}, "message": "Auto merge of #56005 - GuillaumeGomez:speedup-doc-render, r=QuietMisdreavus\n\nGreatly improve rustdoc rendering speed issues\n\nFixes #55900.\n\nSo a few improvements here:\n\n* we're switching to `DOMTokenList` API when available providing a replacement if it isn't (should only happen on safari and IE I think...)\n* hide doc sections by default to allow the whole HTML generation to happen in the background to avoid triggering DOM redraw all the times (which killed the performances)\n\nr? @QuietMisdreavus", "tree": {"sha": "ed67ebe577135427dc2d74f893770806682fa2e2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed67ebe577135427dc2d74f893770806682fa2e2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f04a646c68acb7f964e113d145f9bb28bfbb48a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f04a646c68acb7f964e113d145f9bb28bfbb48a", "html_url": "https://github.com/rust-lang/rust/commit/7f04a646c68acb7f964e113d145f9bb28bfbb48a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f04a646c68acb7f964e113d145f9bb28bfbb48a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "91857a3c82362c9572d280397001f02d86c416be", "url": "https://api.github.com/repos/rust-lang/rust/commits/91857a3c82362c9572d280397001f02d86c416be", "html_url": "https://github.com/rust-lang/rust/commit/91857a3c82362c9572d280397001f02d86c416be"}, {"sha": "b8c1726f267ce24b773f04c7d161c62f6fbc05fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8c1726f267ce24b773f04c7d161c62f6fbc05fb", "html_url": "https://github.com/rust-lang/rust/commit/b8c1726f267ce24b773f04c7d161c62f6fbc05fb"}], "stats": {"total": 1300, "additions": 688, "deletions": 612}, "files": [{"sha": "37ff693bdf16794e4d16c71cd49a98171f848b5d", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -54,6 +54,7 @@ pub fn render<T: fmt::Display, S: fmt::Display>(\n     <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"{root_path}light{suffix}.css\\\" \\\n           id=\\\"themeStyle\\\">\\\n     <script src=\\\"{root_path}storage{suffix}.js\\\"></script>\\\n+    <noscript><link rel=\\\"stylesheet\\\" href=\\\"{root_path}noscript{suffix}.css\\\"></noscript>\\\n     {css_extension}\\\n     {favicon}\\\n     {in_header}\\"}, {"sha": "c9f3aa011a1d4987dec7b0602b0c7310f6dbf246", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 47, "deletions": 57, "changes": 104, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -772,6 +772,9 @@ fn write_shared(\n     write_minify(cx.dst.join(&format!(\"settings{}.css\", cx.shared.resource_suffix)),\n                  static_files::SETTINGS_CSS,\n                  options.enable_minification)?;\n+    write_minify(cx.dst.join(&format!(\"noscript{}.css\", cx.shared.resource_suffix)),\n+                 static_files::NOSCRIPT_CSS,\n+                 options.enable_minification)?;\n \n     // To avoid \"light.css\" to be overwritten, we'll first run over the received themes and only\n     // then we'll run over the \"official\" styles.\n@@ -865,9 +868,8 @@ themePicker.onblur = handleThemeButtonsBlur;\n     }\n \n     {\n-        let mut data = format!(\"var resourcesSuffix = \\\"{}\\\";\\n\",\n-                               cx.shared.resource_suffix);\n-        data.push_str(static_files::STORAGE_JS);\n+        let mut data = static_files::STORAGE_JS.to_owned();\n+        data.push_str(&format!(\"var resourcesSuffix = \\\"{}\\\";\", cx.shared.resource_suffix));\n         write_minify(cx.dst.join(&format!(\"storage{}.js\", cx.shared.resource_suffix)),\n                      &data,\n                      options.enable_minification)?;\n@@ -3013,6 +3015,22 @@ fn item_trait(\n     // Trait documentation\n     document(w, cx, it)?;\n \n+    fn write_small_section_header(\n+        w: &mut fmt::Formatter,\n+        id: &str,\n+        title: &str,\n+        extra_content: &str,\n+    ) -> fmt::Result {\n+        write!(w, \"\n+            <h2 id='{0}' class='small-section-header'>\\\n+              {1}<a href='#{0}' class='anchor'></a>\\\n+            </h2>{2}\", id, title, extra_content)\n+    }\n+\n+    fn write_loading_content(w: &mut fmt::Formatter, extra_content: &str) -> fmt::Result {\n+        write!(w, \"{}<span class='loading-content'>Loading content...</span>\", extra_content)\n+    }\n+\n     fn trait_item(w: &mut fmt::Formatter, cx: &Context, m: &clean::Item, t: &clean::Item)\n                   -> fmt::Result {\n         let name = m.name.as_ref().unwrap();\n@@ -3033,74 +3051,45 @@ fn item_trait(\n     }\n \n     if !types.is_empty() {\n-        write!(w, \"\n-            <h2 id='associated-types' class='small-section-header'>\n-              Associated Types<a href='#associated-types' class='anchor'></a>\n-            </h2>\n-            <div class='methods'>\n-        \")?;\n+        write_small_section_header(w, \"associated-types\", \"Associated Types\",\n+                                   \"<div class='methods'>\")?;\n         for t in &types {\n             trait_item(w, cx, *t, it)?;\n         }\n-        write!(w, \"</div>\")?;\n+        write_loading_content(w, \"</div>\")?;\n     }\n \n     if !consts.is_empty() {\n-        write!(w, \"\n-            <h2 id='associated-const' class='small-section-header'>\n-              Associated Constants<a href='#associated-const' class='anchor'></a>\n-            </h2>\n-            <div class='methods'>\n-        \")?;\n+        write_small_section_header(w, \"associated-const\", \"Associated Constants\",\n+                                   \"<div class='methods'>\")?;\n         for t in &consts {\n             trait_item(w, cx, *t, it)?;\n         }\n-        write!(w, \"</div>\")?;\n+        write_loading_content(w, \"</div>\")?;\n     }\n \n     // Output the documentation for each function individually\n     if !required.is_empty() {\n-        write!(w, \"\n-            <h2 id='required-methods' class='small-section-header'>\n-              Required Methods<a href='#required-methods' class='anchor'></a>\n-            </h2>\n-            <div class='methods'>\n-        \")?;\n+        write_small_section_header(w, \"required-methods\", \"Required methods\",\n+                                   \"<div class='methods'>\")?;\n         for m in &required {\n             trait_item(w, cx, *m, it)?;\n         }\n-        write!(w, \"</div>\")?;\n+        write_loading_content(w, \"</div>\")?;\n     }\n     if !provided.is_empty() {\n-        write!(w, \"\n-            <h2 id='provided-methods' class='small-section-header'>\n-              Provided Methods<a href='#provided-methods' class='anchor'></a>\n-            </h2>\n-            <div class='methods'>\n-        \")?;\n+        write_small_section_header(w, \"provided-methods\", \"Provided methods\",\n+                                   \"<div class='methods'>\")?;\n         for m in &provided {\n             trait_item(w, cx, *m, it)?;\n         }\n-        write!(w, \"</div>\")?;\n+        write_loading_content(w, \"</div>\")?;\n     }\n \n     // If there are methods directly on this trait object, render them here.\n     render_assoc_items(w, cx, it, it.def_id, AssocItemRender::All)?;\n \n     let cache = cache();\n-    let impl_header = \"\\\n-        <h2 id='implementors' class='small-section-header'>\\\n-          Implementors<a href='#implementors' class='anchor'></a>\\\n-        </h2>\\\n-        <div class='item-list' id='implementors-list'>\\\n-    \";\n-\n-    let synthetic_impl_header = \"\\\n-        <h2 id='synthetic-implementors' class='small-section-header'>\\\n-          Auto implementors<a href='#synthetic-implementors' class='anchor'></a>\\\n-        </h2>\\\n-        <div class='item-list' id='synthetic-implementors-list'>\\\n-    \";\n \n     let mut synthetic_types = Vec::new();\n \n@@ -3137,11 +3126,7 @@ fn item_trait(\n         concrete.sort_by(compare_impl);\n \n         if !foreign.is_empty() {\n-            write!(w, \"\n-                <h2 id='foreign-impls' class='small-section-header'>\n-                  Implementations on Foreign Types<a href='#foreign-impls' class='anchor'></a>\n-                </h2>\n-            \")?;\n+            write_small_section_header(w, \"foreign-impls\", \"Implementations on Foreign Types\", \"\")?;\n \n             for implementor in foreign {\n                 let assoc_link = AssocItemLink::GotoSource(\n@@ -3152,33 +3137,38 @@ fn item_trait(\n                             RenderMode::Normal, implementor.impl_item.stable_since(), false,\n                             None)?;\n             }\n+            write_loading_content(w, \"\")?;\n         }\n \n-        write!(w, \"{}\", impl_header)?;\n+        write_small_section_header(w, \"implementors\", \"Implementors\",\n+                                   \"<div class='item-list' id='implementors-list'>\")?;\n         for implementor in concrete {\n             render_implementor(cx, implementor, w, &implementor_dups)?;\n         }\n-        write!(w, \"</div>\")?;\n+        write_loading_content(w, \"</div>\")?;\n \n         if t.auto {\n-            write!(w, \"{}\", synthetic_impl_header)?;\n+            write_small_section_header(w, \"synthetic-implementors\", \"Auto implementors\",\n+                                       \"<div class='item-list' id='synthetic-implementors-list'>\")?;\n             for implementor in synthetic {\n                 synthetic_types.extend(\n                     collect_paths_for_type(implementor.inner_impl().for_.clone())\n                 );\n                 render_implementor(cx, implementor, w, &implementor_dups)?;\n             }\n-            write!(w, \"</div>\")?;\n+            write_loading_content(w, \"</div>\")?;\n         }\n     } else {\n         // even without any implementations to write in, we still want the heading and list, so the\n         // implementors javascript file pulled in below has somewhere to write the impls into\n-        write!(w, \"{}\", impl_header)?;\n-        write!(w, \"</div>\")?;\n+        write_small_section_header(w, \"implementors\", \"Implementors\",\n+                                   \"<div class='item-list' id='implementors-list'>\")?;\n+        write_loading_content(w, \"</div>\")?;\n \n         if t.auto {\n-            write!(w, \"{}\", synthetic_impl_header)?;\n-            write!(w, \"</div>\")?;\n+            write_small_section_header(w, \"synthetic-implementors\", \"Auto implementors\",\n+                                       \"<div class='item-list' id='synthetic-implementors-list'>\")?;\n+            write_loading_content(w, \"</div>\")?;\n         }\n     }\n     write!(w, r#\"<script type=\"text/javascript\">window.inlined_types=new Set({});</script>\"#,"}, {"sha": "51714c35d6faa2dddb3e0266a23dbe4a846213c7", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 594, "deletions": 525, "changes": 1119, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -30,6 +30,27 @@ if (!String.prototype.endsWith) {\n     };\n }\n \n+if (!DOMTokenList.prototype.add) {\n+    DOMTokenList.prototype.add = function(className) {\n+        if (className && !hasClass(this, className)) {\n+            if (this.className && this.className.length > 0) {\n+                this.className += \" \" + className;\n+            } else {\n+                this.className = className;\n+            }\n+        }\n+    };\n+}\n+\n+if (!DOMTokenList.prototype.remove) {\n+    DOMTokenList.prototype.remove = function(className) {\n+        if (className && this.className) {\n+            this.className = (\" \" + this.className + \" \").replace(\" \" + className + \" \", \" \")\n+                                                         .trim();\n+        }\n+    };\n+}\n+\n (function() {\n     \"use strict\";\n \n@@ -61,7 +82,7 @@ if (!String.prototype.endsWith) {\n                      \"attr\",\n                      \"derive\"];\n \n-    var search_input = document.getElementsByClassName('search-input')[0];\n+    var search_input = document.getElementsByClassName(\"search-input\")[0];\n \n     // On the search screen, so you remain on the last tab you opened.\n     //\n@@ -75,9 +96,9 @@ if (!String.prototype.endsWith) {\n     var titleBeforeSearch = document.title;\n \n     function getPageId() {\n-        var id = document.location.href.split('#')[1];\n+        var id = document.location.href.split(\"#\")[1];\n         if (id) {\n-            return id.split('?')[0].split('&')[0];\n+            return id.split(\"?\")[0].split(\"&\")[0];\n         }\n         return null;\n     }\n@@ -87,9 +108,9 @@ if (!String.prototype.endsWith) {\n         if (elems) {\n             addClass(elems, \"show-it\");\n         }\n-        var sidebar = document.getElementsByClassName('sidebar')[0];\n+        var sidebar = document.getElementsByClassName(\"sidebar\")[0];\n         if (sidebar) {\n-            addClass(sidebar, 'mobile');\n+            addClass(sidebar, \"mobile\");\n             var filler = document.getElementById(\"sidebar-filler\");\n             if (!filler) {\n                 var div = document.createElement(\"div\");\n@@ -108,13 +129,13 @@ if (!String.prototype.endsWith) {\n         if (elems) {\n             removeClass(elems, \"show-it\");\n         }\n-        var sidebar = document.getElementsByClassName('sidebar')[0];\n-        removeClass(sidebar, 'mobile');\n+        var sidebar = document.getElementsByClassName(\"sidebar\")[0];\n+        removeClass(sidebar, \"mobile\");\n         var filler = document.getElementById(\"sidebar-filler\");\n         if (filler) {\n             filler.remove();\n         }\n-        document.getElementsByTagName(\"body\")[0].style.marginTop = '';\n+        document.getElementsByTagName(\"body\")[0].style.marginTop = \"\";\n         var themePicker = document.getElementsByClassName(\"theme-picker\");\n         if (themePicker && themePicker.length > 0) {\n             themePicker[0].style.display = null;\n@@ -125,8 +146,8 @@ if (!String.prototype.endsWith) {\n     var TY_PRIMITIVE = itemTypes.indexOf(\"primitive\");\n     var TY_KEYWORD = itemTypes.indexOf(\"keyword\");\n \n-    onEach(document.getElementsByClassName('js-only'), function(e) {\n-        removeClass(e, 'js-only');\n+    onEachLazy(document.getElementsByClassName(\"js-only\"), function(e) {\n+        removeClass(e, \"js-only\");\n     });\n \n     function getQueryStringParams() {\n@@ -145,16 +166,19 @@ if (!String.prototype.endsWith) {\n           window.history && typeof window.history.pushState === \"function\";\n     }\n \n+    var main = document.getElementById(\"main\");\n+\n     function highlightSourceLines(ev) {\n         // If we're in mobile mode, we should add the sidebar in any case.\n         hideSidebar();\n+        var elem;\n         var search = document.getElementById(\"search\");\n         var i, from, to, match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n         if (match) {\n             from = parseInt(match[1], 10);\n             to = Math.min(50000, parseInt(match[2] || match[1], 10));\n             from = Math.min(from, to);\n-            var elem = document.getElementById(from);\n+            elem = document.getElementById(from);\n             if (!elem) {\n                 return;\n             }\n@@ -164,22 +188,22 @@ if (!String.prototype.endsWith) {\n                     x.scrollIntoView();\n                 }\n             }\n-            onEach(document.getElementsByClassName('line-numbers'), function(e) {\n-                onEach(e.getElementsByTagName('span'), function(i_e) {\n-                    removeClass(i_e, 'line-highlighted');\n+            onEachLazy(document.getElementsByClassName(\"line-numbers\"), function(e) {\n+                onEachLazy(e.getElementsByTagName(\"span\"), function(i_e) {\n+                    removeClass(i_e, \"line-highlighted\");\n                 });\n             });\n             for (i = from; i <= to; ++i) {\n-                addClass(document.getElementById(i), 'line-highlighted');\n+                addClass(document.getElementById(i), \"line-highlighted\");\n             }\n         } else if (ev !== null && search && !hasClass(search, \"hidden\") && ev.newURL) {\n             addClass(search, \"hidden\");\n-            removeClass(document.getElementById(\"main\"), \"hidden\");\n-            var hash = ev.newURL.slice(ev.newURL.indexOf('#') + 1);\n+            removeClass(main, \"hidden\");\n+            var hash = ev.newURL.slice(ev.newURL.indexOf(\"#\") + 1);\n             if (browserSupportsHistoryApi()) {\n                 history.replaceState(hash, \"\", \"?search=#\" + hash);\n             }\n-            var elem = document.getElementById(hash);\n+            elem = document.getElementById(hash);\n             if (elem) {\n                 elem.scrollIntoView();\n             }\n@@ -190,7 +214,7 @@ if (!String.prototype.endsWith) {\n         var elem = document.getElementById(id);\n         if (elem && isHidden(elem)) {\n             var h3 = elem.parentNode.previousSibling;\n-            if (h3 && h3.tagName !== 'H3') {\n+            if (h3 && h3.tagName !== \"H3\") {\n                 h3 = h3.previousSibling; // skip div.docblock\n             }\n \n@@ -236,7 +260,7 @@ if (!String.prototype.endsWith) {\n                 removeClass(help, \"hidden\");\n                 addClass(document.body, \"blur\");\n             }\n-        } else if (!hasClass(help, \"hidden\")) {\n+        } else if (hasClass(help, \"hidden\") === false) {\n             ev.preventDefault();\n             addClass(help, \"hidden\");\n             removeClass(document.body, \"blur\");\n@@ -246,12 +270,12 @@ if (!String.prototype.endsWith) {\n     function handleEscape(ev, help) {\n         hideModal();\n         var search = document.getElementById(\"search\");\n-        if (!hasClass(help, \"hidden\")) {\n+        if (hasClass(help, \"hidden\") === false) {\n             displayHelp(false, ev);\n-        } else if (!hasClass(search, \"hidden\")) {\n+        } else if (hasClass(search, \"hidden\") === false) {\n             ev.preventDefault();\n             addClass(search, \"hidden\");\n-            removeClass(document.getElementById(\"main\"), \"hidden\");\n+            removeClass(main, \"hidden\");\n             document.title = titleBeforeSearch;\n         }\n         defocusSearchBar();\n@@ -305,26 +329,27 @@ if (!String.prototype.endsWith) {\n             if (elem && elem.tagName === tagName) {\n                 return elem;\n             }\n-        } while (elem = elem.parentNode);\n+            elem = elem.parentNode;\n+        } while (elem);\n         return null;\n     }\n \n     document.onkeypress = handleShortcut;\n     document.onkeydown = handleShortcut;\n     document.onclick = function(ev) {\n-        if (hasClass(ev.target, 'collapse-toggle')) {\n+        if (hasClass(ev.target, \"collapse-toggle\")) {\n             collapseDocs(ev.target, \"toggle\");\n-        } else if (hasClass(ev.target.parentNode, 'collapse-toggle')) {\n+        } else if (hasClass(ev.target.parentNode, \"collapse-toggle\")) {\n             collapseDocs(ev.target.parentNode, \"toggle\");\n-        } else if (ev.target.tagName === 'SPAN' && hasClass(ev.target.parentNode, 'line-numbers')) {\n+        } else if (ev.target.tagName === \"SPAN\" && hasClass(ev.target.parentNode, \"line-numbers\")) {\n             var prev_id = 0;\n \n             var set_fragment = function(name) {\n                 if (browserSupportsHistoryApi()) {\n-                    history.replaceState(null, null, '#' + name);\n+                    history.replaceState(null, null, \"#\" + name);\n                     window.hashchange();\n                 } else {\n-                    location.replace('#' + name);\n+                    location.replace(\"#\" + name);\n                 }\n             };\n \n@@ -337,31 +362,31 @@ if (!String.prototype.endsWith) {\n                     cur_id = tmp;\n                 }\n \n-                set_fragment(prev_id + '-' + cur_id);\n+                set_fragment(prev_id + \"-\" + cur_id);\n             } else {\n                 prev_id = cur_id;\n \n                 set_fragment(cur_id);\n             }\n-        } else if (!hasClass(document.getElementById(\"help\"), \"hidden\")) {\n+        } else if (hasClass(document.getElementById(\"help\"), \"hidden\") === false) {\n             addClass(document.getElementById(\"help\"), \"hidden\");\n             removeClass(document.body, \"blur\");\n         } else {\n             // Making a collapsed element visible on onhashchange seems\n             // too late\n-            var a = findParentElement(ev.target, 'A');\n+            var a = findParentElement(ev.target, \"A\");\n             if (a && a.hash) {\n-                expandSection(a.hash.replace(/^#/, ''));\n+                expandSection(a.hash.replace(/^#/, \"\"));\n             }\n         }\n     };\n \n-    var x = document.getElementsByClassName('version-selector');\n+    var x = document.getElementsByClassName(\"version-selector\");\n     if (x.length > 0) {\n         x[0].onchange = function() {\n             var i, match,\n                 url = document.location.href,\n-                stripped = '',\n+                stripped = \"\",\n                 len = rootPath.match(/\\.\\.\\//g).length + 1;\n \n             for (i = 0; i < len; ++i) {\n@@ -372,7 +397,7 @@ if (!String.prototype.endsWith) {\n                 url = url.substring(0, url.length - match[0].length);\n             }\n \n-            url += '/' + document.getElementsByClassName('version-selector')[0].value + stripped;\n+            url += \"/\" + document.getElementsByClassName(\"version-selector\")[0].value + stripped;\n \n             document.location.href = url;\n         };\n@@ -428,7 +453,7 @@ if (!String.prototype.endsWith) {\n         // where you start trying to do a search, and the index loads, and\n         // suddenly your search is gone!\n         if (search_input.value === \"\") {\n-            search_input.value = params.search || '';\n+            search_input.value = params.search || \"\";\n         }\n \n         /**\n@@ -441,7 +466,8 @@ if (!String.prototype.endsWith) {\n          */\n         function execQuery(query, searchWords, filterCrates) {\n             function itemTypeFromName(typename) {\n-                for (var i = 0; i < itemTypes.length; ++i) {\n+                var length = itemTypes.length;\n+                for (var i = 0; i < length; ++i) {\n                     if (itemTypes[i] === typename) {\n                         return i;\n                     }\n@@ -455,7 +481,8 @@ if (!String.prototype.endsWith) {\n                 results = {}, results_in_args = {}, results_returned = {},\n                 split = valLower.split(\"::\");\n \n-            for (var z = 0; z < split.length; ++z) {\n+            var length = split.length;\n+            for (var z = 0; z < length; ++z) {\n                 if (split[z] === \"\") {\n                     split.splice(z, 1);\n                     z -= 1;\n@@ -464,7 +491,8 @@ if (!String.prototype.endsWith) {\n \n             function transformResults(results, isType) {\n                 var out = [];\n-                for (i = 0; i < results.length; ++i) {\n+                var length = results.length;\n+                for (var i = 0; i < length; ++i) {\n                     if (results[i].id > -1) {\n                         var obj = searchIndex[results[i].id];\n                         obj.lev = results[i].lev;\n@@ -473,7 +501,7 @@ if (!String.prototype.endsWith) {\n                             obj.displayPath = pathSplitter(res[0]);\n                             obj.fullPath = obj.displayPath + obj.name;\n                             // To be sure than it some items aren't considered as duplicate.\n-                            obj.fullPath += '|' + obj.ty;\n+                            obj.fullPath += \"|\" + obj.ty;\n                             obj.href = res[1];\n                             out.push(obj);\n                             if (out.length >= MAX_RESULTS) {\n@@ -493,8 +521,9 @@ if (!String.prototype.endsWith) {\n                     }\n                 }\n                 results = ar;\n+                var i;\n                 var nresults = results.length;\n-                for (var i = 0; i < nresults; ++i) {\n+                for (i = 0; i < nresults; ++i) {\n                     results[i].word = searchWords[results[i].id];\n                     results[i].item = searchIndex[results[i].id] || {};\n                 }\n@@ -552,8 +581,8 @@ if (!String.prototype.endsWith) {\n                     }\n \n                     // sort by description (no description goes later)\n-                    a = (aaa.item.desc === '');\n-                    b = (bbb.item.desc === '');\n+                    a = (aaa.item.desc === \"\");\n+                    b = (bbb.item.desc === \"\");\n                     if (a !== b) { return a - b; }\n \n                     // sort by type (later occurrence in `itemTypes` goes later)\n@@ -570,7 +599,8 @@ if (!String.prototype.endsWith) {\n                     return 0;\n                 });\n \n-                for (var i = 0; i < results.length; ++i) {\n+                var length = results.length;\n+                for (i = 0; i < length; ++i) {\n                     var result = results[i];\n \n                     // this validation does not make sense when searching by types\n@@ -592,10 +622,10 @@ if (!String.prototype.endsWith) {\n \n             function extractGenerics(val) {\n                 val = val.toLowerCase();\n-                if (val.indexOf('<') !== -1) {\n-                    var values = val.substring(val.indexOf('<') + 1, val.lastIndexOf('>'));\n+                if (val.indexOf(\"<\") !== -1) {\n+                    var values = val.substring(val.indexOf(\"<\") + 1, val.lastIndexOf(\">\"));\n                     return {\n-                        name: val.substring(0, val.indexOf('<')),\n+                        name: val.substring(0, val.indexOf(\"<\")),\n                         generics: values.split(/\\s*,\\s*/),\n                     };\n                 }\n@@ -617,9 +647,11 @@ if (!String.prototype.endsWith) {\n                         var done = 0;\n                         // We need to find the type that matches the most to remove it in order\n                         // to move forward.\n-                        for (var y = 0; y < val.generics.length; ++y) {\n+                        var vlength = val.generics.length;\n+                        for (var y = 0; y < vlength; ++y) {\n                             var lev = { pos: -1, lev: MAX_LEV_DISTANCE + 1};\n-                            for (var x = 0; x < elems.length; ++x) {\n+                            var elength = elems.length;\n+                            for (var x = 0; x < elength; ++x) {\n                                 var tmp_lev = levenshtein(elems[x], val.generics[y]);\n                                 if (tmp_lev < lev.lev) {\n                                     lev.lev = tmp_lev;\n@@ -644,14 +676,14 @@ if (!String.prototype.endsWith) {\n             // Check for type name and type generics (if any).\n             function checkType(obj, val, literalSearch) {\n                 var lev_distance = MAX_LEV_DISTANCE + 1;\n+                var x;\n                 if (obj[NAME] === val.name) {\n                     if (literalSearch === true) {\n                         if (val.generics && val.generics.length !== 0) {\n                             if (obj.length > GENERICS_DATA &&\n                                   obj[GENERICS_DATA].length >= val.generics.length) {\n                                 var elems = obj[GENERICS_DATA].slice(0);\n                                 var allFound = true;\n-                                var x;\n \n                                 for (var y = 0; allFound === true && y < val.generics.length; ++y) {\n                                     allFound = false;\n@@ -685,21 +717,22 @@ if (!String.prototype.endsWith) {\n                 // Names didn't match so let's check if one of the generic types could.\n                 if (literalSearch === true) {\n                      if (obj.length > GENERICS_DATA && obj[GENERICS_DATA].length > 0) {\n-                        for (var x = 0; x < obj[GENERICS_DATA].length; ++x) {\n+                        var length = obj[GENERICS_DATA].length;\n+                        for (x = 0; x < length; ++x) {\n                             if (obj[GENERICS_DATA][x] === val.name) {\n                                 return true;\n                             }\n                         }\n                     }\n                     return false;\n                 }\n-                var lev_distance = Math.min(levenshtein(obj[NAME], val.name),\n-                                            lev_distance);\n+                lev_distance = Math.min(levenshtein(obj[NAME], val.name), lev_distance);\n                 if (lev_distance <= MAX_LEV_DISTANCE) {\n                     lev_distance = Math.min(checkGenerics(obj, val), lev_distance);\n                 } else if (obj.length > GENERICS_DATA && obj[GENERICS_DATA].length > 0) {\n                     // We can check if the type we're looking for is inside the generics!\n-                    for (var x = 0; x < obj[GENERICS_DATA].length; ++x) {\n+                    var olength = obj[GENERICS_DATA].length;\n+                    for (x = 0; x < olength; ++x) {\n                         lev_distance = Math.min(levenshtein(obj[GENERICS_DATA][x], val.name),\n                                                 lev_distance);\n                     }\n@@ -714,7 +747,8 @@ if (!String.prototype.endsWith) {\n \n                 if (obj && obj.type && obj.type[INPUTS_DATA] &&\n                       obj.type[INPUTS_DATA].length > 0) {\n-                    for (var i = 0; i < obj.type[INPUTS_DATA].length; i++) {\n+                    var length = obj.type[INPUTS_DATA].length;\n+                    for (var i = 0; i < length; i++) {\n                         var tmp = checkType(obj.type[INPUTS_DATA][i], val, literalSearch);\n                         if (literalSearch === true && tmp === true) {\n                             return true;\n@@ -755,16 +789,18 @@ if (!String.prototype.endsWith) {\n                     path.push(ty.parent.name.toLowerCase());\n                 }\n \n-                if (contains.length > path.length) {\n+                var length = path.length;\n+                var clength = contains.length;\n+                if (clength > length) {\n                     return MAX_LEV_DISTANCE + 1;\n                 }\n-                for (var i = 0; i < path.length; ++i) {\n-                    if (i + contains.length > path.length) {\n+                for (var i = 0; i < length; ++i) {\n+                    if (i + clength > length) {\n                         break;\n                     }\n                     var lev_total = 0;\n                     var aborted = false;\n-                    for (var x = 0; x < contains.length; ++x) {\n+                    for (var x = 0; x < clength; ++x) {\n                         var lev = levenshtein(path[i + x], contains[x]);\n                         if (lev > MAX_LEV_DISTANCE) {\n                             aborted = true;\n@@ -773,7 +809,7 @@ if (!String.prototype.endsWith) {\n                         lev_total += lev;\n                     }\n                     if (aborted === false) {\n-                        ret_lev = Math.min(ret_lev, Math.round(lev_total / contains.length));\n+                        ret_lev = Math.min(ret_lev, Math.round(lev_total / clength));\n                     }\n                 }\n                 return ret_lev;\n@@ -810,18 +846,23 @@ if (!String.prototype.endsWith) {\n \n             // quoted values mean literal search\n             var nSearchWords = searchWords.length;\n+            var i;\n+            var ty;\n+            var fullId;\n+            var returned;\n+            var in_args;\n             if ((val.charAt(0) === \"\\\"\" || val.charAt(0) === \"'\") &&\n                 val.charAt(val.length - 1) === val.charAt(0))\n             {\n                 val = extractGenerics(val.substr(1, val.length - 2));\n-                for (var i = 0; i < nSearchWords; ++i) {\n+                for (i = 0; i < nSearchWords; ++i) {\n                     if (filterCrates !== undefined && searchIndex[i].crate !== filterCrates) {\n                         continue;\n                     }\n-                    var in_args = findArg(searchIndex[i], val, true);\n-                    var returned = checkReturned(searchIndex[i], val, true);\n-                    var ty = searchIndex[i];\n-                    var fullId = generateId(ty);\n+                    in_args = findArg(searchIndex[i], val, true);\n+                    returned = checkReturned(searchIndex[i], val, true);\n+                    ty = searchIndex[i];\n+                    fullId = generateId(ty);\n \n                     if (searchWords[i] === val.name) {\n                         // filter type: ... queries\n@@ -866,27 +907,27 @@ if (!String.prototype.endsWith) {\n                 var input = parts[0];\n                 // sort inputs so that order does not matter\n                 var inputs = input.split(\",\").map(trimmer).sort();\n-                for (var i = 0; i < inputs.length; ++i) {\n+                for (i = 0; i < inputs.length; ++i) {\n                     inputs[i] = extractGenerics(inputs[i]);\n                 }\n                 var output = extractGenerics(parts[1]);\n \n-                for (var i = 0; i < nSearchWords; ++i) {\n+                for (i = 0; i < nSearchWords; ++i) {\n                     if (filterCrates !== undefined && searchIndex[i].crate !== filterCrates) {\n                         continue;\n                     }\n                     var type = searchIndex[i].type;\n-                    var ty = searchIndex[i];\n+                    ty = searchIndex[i];\n                     if (!type) {\n                         continue;\n                     }\n-                    var fullId = generateId(ty);\n+                    fullId = generateId(ty);\n \n                     // allow searching for void (no output) functions as well\n                     var typeOutput = type.length > OUTPUT_DATA ? type[OUTPUT_DATA].name : \"\";\n-                    var returned = checkReturned(ty, output, true);\n+                    returned = checkReturned(ty, output, true);\n                     if (output.name === \"*\" || returned === true) {\n-                        var in_args = false;\n+                        in_args = false;\n                         var module = false;\n \n                         if (input === \"*\") {\n@@ -946,27 +987,29 @@ if (!String.prototype.endsWith) {\n                 var contains = paths.slice(0, paths.length > 1 ? paths.length - 1 : 1);\n \n                 for (j = 0; j < nSearchWords; ++j) {\n-                    var ty = searchIndex[j];\n+                    var lev;\n+                    var lev_distance;\n+                    ty = searchIndex[j];\n                     if (!ty || (filterCrates !== undefined && ty.crate !== filterCrates)) {\n                         continue;\n                     }\n                     var lev_distance;\n                     var lev_add = 0;\n                     if (paths.length > 1) {\n-                        var lev = checkPath(contains, paths[paths.length - 1], ty);\n+                        lev = checkPath(contains, paths[paths.length - 1], ty);\n                         if (lev > MAX_LEV_DISTANCE) {\n                             continue;\n                         } else if (lev > 0) {\n                             lev_add = 1;\n                         }\n                     }\n \n-                    var returned = MAX_LEV_DISTANCE + 1;\n-                    var in_args = MAX_LEV_DISTANCE + 1;\n+                    returned = MAX_LEV_DISTANCE + 1;\n+                    in_args = MAX_LEV_DISTANCE + 1;\n                     var index = -1;\n                     // we want lev results to go lower than others\n-                    var lev = MAX_LEV_DISTANCE + 1;\n-                    var fullId = generateId(ty);\n+                    lev = MAX_LEV_DISTANCE + 1;\n+                    fullId = generateId(ty);\n \n                     if (searchWords[j].indexOf(split[i]) > -1 ||\n                         searchWords[j].indexOf(val) > -1 ||\n@@ -1042,24 +1085,24 @@ if (!String.prototype.endsWith) {\n             }\n \n             var ret = {\n-                'in_args': sortResults(results_in_args, true),\n-                'returned': sortResults(results_returned, true),\n-                'others': sortResults(results),\n+                \"in_args\": sortResults(results_in_args, true),\n+                \"returned\": sortResults(results_returned, true),\n+                \"others\": sortResults(results),\n             };\n             if (ALIASES && ALIASES[window.currentCrate] &&\n                     ALIASES[window.currentCrate][query.raw]) {\n                 var aliases = ALIASES[window.currentCrate][query.raw];\n-                for (var i = 0; i < aliases.length; ++i) {\n+                for (i = 0; i < aliases.length; ++i) {\n                     aliases[i].is_alias = true;\n                     aliases[i].alias = query.raw;\n                     aliases[i].path = aliases[i].p;\n                     var res = buildHrefAndPath(aliases[i]);\n                     aliases[i].displayPath = pathSplitter(res[0]);\n                     aliases[i].fullPath = aliases[i].displayPath + aliases[i].name;\n                     aliases[i].href = res[1];\n-                    ret['others'].unshift(aliases[i]);\n-                    if (ret['others'].length > MAX_RESULTS) {\n-                        ret['others'].pop();\n+                    ret.others.unshift(aliases[i]);\n+                    if (ret.others.length > MAX_RESULTS) {\n+                        ret.others.pop();\n                     }\n                 }\n             }\n@@ -1106,7 +1149,7 @@ if (!String.prototype.endsWith) {\n \n             matches = query.match(/^(fn|mod|struct|enum|trait|type|const|macro)\\s*:\\s*/i);\n             if (matches) {\n-                type = matches[1].replace(/^const$/, 'constant');\n+                type = matches[1].replace(/^const$/, \"constant\");\n                 query = query.substring(matches[0].length);\n             }\n \n@@ -1124,38 +1167,38 @@ if (!String.prototype.endsWith) {\n             var click_func = function(e) {\n                 var el = e.target;\n                 // to retrieve the real \"owner\" of the event.\n-                while (el.tagName !== 'TR') {\n+                while (el.tagName !== \"TR\") {\n                     el = el.parentNode;\n                 }\n-                var dst = e.target.getElementsByTagName('a');\n+                var dst = e.target.getElementsByTagName(\"a\");\n                 if (dst.length < 1) {\n                     return;\n                 }\n                 dst = dst[0];\n                 if (window.location.pathname === dst.pathname) {\n-                    addClass(document.getElementById('search'), 'hidden');\n-                    removeClass(document.getElementById('main'), 'hidden');\n+                    addClass(document.getElementById(\"search\"), \"hidden\");\n+                    removeClass(main, \"hidden\");\n                     document.location.href = dst.href;\n                 }\n             };\n             var mouseover_func = function(e) {\n                 var el = e.target;\n                 // to retrieve the real \"owner\" of the event.\n-                while (el.tagName !== 'TR') {\n+                while (el.tagName !== \"TR\") {\n                     el = el.parentNode;\n                 }\n                 clearTimeout(hoverTimeout);\n                 hoverTimeout = setTimeout(function() {\n-                    onEach(document.getElementsByClassName('search-results'), function(e) {\n-                        onEach(e.getElementsByClassName('result'), function(i_e) {\n-                            removeClass(i_e, 'highlighted');\n+                    onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                        onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n+                            removeClass(i_e, \"highlighted\");\n                         });\n                     });\n-                    addClass(el, 'highlighted');\n+                    addClass(el, \"highlighted\");\n                 }, 20);\n             };\n-            onEach(document.getElementsByClassName('search-results'), function(e) {\n-                onEach(e.getElementsByClassName('result'), function(i_e) {\n+            onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n                     i_e.onclick = click_func;\n                     i_e.onmouseover = mouseover_func;\n                 });\n@@ -1167,8 +1210,8 @@ if (!String.prototype.endsWith) {\n                 var actives = [[], [], []];\n                 // \"current\" is used to know which tab we're looking into.\n                 var current = 0;\n-                onEach(document.getElementsByClassName('search-results'), function(e) {\n-                    onEach(e.getElementsByClassName('highlighted'), function(e) {\n+                onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                    onEachLazy(e.getElementsByClassName(\"highlighted\"), function(e) {\n                         actives[current].push(e);\n                     });\n                     current += 1;\n@@ -1180,25 +1223,25 @@ if (!String.prototype.endsWith) {\n                         return;\n                     }\n \n-                    addClass(actives[currentTab][0].previousElementSibling, 'highlighted');\n-                    removeClass(actives[currentTab][0], 'highlighted');\n+                    addClass(actives[currentTab][0].previousElementSibling, \"highlighted\");\n+                    removeClass(actives[currentTab][0], \"highlighted\");\n                 } else if (e.which === 40) { // down\n                     if (!actives[currentTab].length) {\n-                        var results = document.getElementsByClassName('search-results');\n+                        var results = document.getElementsByClassName(\"search-results\");\n                         if (results.length > 0) {\n-                            var res = results[currentTab].getElementsByClassName('result');\n+                            var res = results[currentTab].getElementsByClassName(\"result\");\n                             if (res.length > 0) {\n-                                addClass(res[0], 'highlighted');\n+                                addClass(res[0], \"highlighted\");\n                             }\n                         }\n                     } else if (actives[currentTab][0].nextElementSibling) {\n-                        addClass(actives[currentTab][0].nextElementSibling, 'highlighted');\n-                        removeClass(actives[currentTab][0], 'highlighted');\n+                        addClass(actives[currentTab][0].nextElementSibling, \"highlighted\");\n+                        removeClass(actives[currentTab][0], \"highlighted\");\n                     }\n                 } else if (e.which === 13) { // return\n                     if (actives[currentTab].length) {\n                         document.location.href =\n-                            actives[currentTab][0].getElementsByTagName('a')[0].href;\n+                            actives[currentTab][0].getElementsByTagName(\"a\")[0].href;\n                     }\n                 } else if (e.which === 9) { // tab\n                     if (e.shiftKey) {\n@@ -1210,11 +1253,11 @@ if (!String.prototype.endsWith) {\n                 } else if (e.which === 16) { // shift\n                     // Does nothing, it's just to avoid losing \"focus\" on the highlighted element.\n                 } else if (e.which === 27) { // escape\n-                    removeClass(actives[currentTab][0], 'highlighted');\n-                    search_input.value = '';\n+                    removeClass(actives[currentTab][0], \"highlighted\");\n+                    search_input.value = \"\";\n                     defocusSearchBar();\n                 } else if (actives[currentTab].length > 0) {\n-                    removeClass(actives[currentTab][0], 'highlighted');\n+                    removeClass(actives[currentTab][0], \"highlighted\");\n                 }\n             };\n         }\n@@ -1225,63 +1268,63 @@ if (!String.prototype.endsWith) {\n             var type = itemTypes[item.ty];\n             var name = item.name;\n \n-            if (type === 'mod') {\n-                displayPath = item.path + '::';\n-                href = rootPath + item.path.replace(/::/g, '/') + '/' +\n-                       name + '/index.html';\n+            if (type === \"mod\") {\n+                displayPath = item.path + \"::\";\n+                href = rootPath + item.path.replace(/::/g, \"/\") + \"/\" +\n+                       name + \"/index.html\";\n             } else if (type === \"primitive\" || type === \"keyword\") {\n                 displayPath = \"\";\n-                href = rootPath + item.path.replace(/::/g, '/') +\n-                       '/' + type + '.' + name + '.html';\n+                href = rootPath + item.path.replace(/::/g, \"/\") +\n+                       \"/\" + type + \".\" + name + \".html\";\n             } else if (type === \"externcrate\") {\n                 displayPath = \"\";\n-                href = rootPath + name + '/index.html';\n+                href = rootPath + name + \"/index.html\";\n             } else if (item.parent !== undefined) {\n                 var myparent = item.parent;\n-                var anchor = '#' + type + '.' + name;\n+                var anchor = \"#\" + type + \".\" + name;\n                 var parentType = itemTypes[myparent.ty];\n                 if (parentType === \"primitive\") {\n-                    displayPath = myparent.name + '::';\n+                    displayPath = myparent.name + \"::\";\n                 } else {\n-                    displayPath = item.path + '::' + myparent.name + '::';\n+                    displayPath = item.path + \"::\" + myparent.name + \"::\";\n                 }\n-                href = rootPath + item.path.replace(/::/g, '/') +\n-                       '/' + parentType +\n-                       '.' + myparent.name +\n-                       '.html' + anchor;\n+                href = rootPath + item.path.replace(/::/g, \"/\") +\n+                       \"/\" + parentType +\n+                       \".\" + myparent.name +\n+                       \".html\" + anchor;\n             } else {\n-                displayPath = item.path + '::';\n-                href = rootPath + item.path.replace(/::/g, '/') +\n-                       '/' + type + '.' + name + '.html';\n+                displayPath = item.path + \"::\";\n+                href = rootPath + item.path.replace(/::/g, \"/\") +\n+                       \"/\" + type + \".\" + name + \".html\";\n             }\n             return [displayPath, href];\n         }\n \n         function escape(content) {\n-            var h1 = document.createElement('h1');\n+            var h1 = document.createElement(\"h1\");\n             h1.textContent = content;\n             return h1.innerHTML;\n         }\n \n         function pathSplitter(path) {\n-            var tmp = '<span>' + path.replace(/::/g, '::</span><span>');\n+            var tmp = \"<span>\" + path.replace(/::/g, \"::</span><span>\");\n             if (tmp.endsWith(\"<span>\")) {\n                 return tmp.slice(0, tmp.length - 6);\n             }\n             return tmp;\n         }\n \n         function addTab(array, query, display) {\n-            var extraStyle = '';\n+            var extraStyle = \"\";\n             if (display === false) {\n-                extraStyle = ' style=\"display: none;\"';\n+                extraStyle = \" style=\\\"display: none;\\\"\";\n             }\n \n-            var output = '';\n+            var output = \"\";\n             var duplicates = {};\n             var length = 0;\n             if (array.length > 0) {\n-                output = '<table class=\"search-results\"' + extraStyle + '>';\n+                output = \"<table class=\\\"search-results\\\"\" + extraStyle + \">\";\n \n                 array.forEach(function(item) {\n                     var name, type;\n@@ -1297,50 +1340,50 @@ if (!String.prototype.endsWith) {\n                     }\n                     length += 1;\n \n-                    output += '<tr class=\"' + type + ' result\"><td>' +\n-                              '<a href=\"' + item.href + '\">' +\n+                    output += \"<tr class=\\\"\" + type + \" result\\\"><td>\" +\n+                              \"<a href=\\\"\" + item.href + \"\\\">\" +\n                               (item.is_alias === true ?\n-                               ('<span class=\"alias\"><b>' + item.alias + ' </b></span><span ' +\n-                                  'class=\"grey\"><i>&nbsp;- see&nbsp;</i></span>') : '') +\n-                              item.displayPath + '<span class=\"' + type + '\">' +\n-                              name + '</span></a></td><td>' +\n-                              '<a href=\"' + item.href + '\">' +\n-                              '<span class=\"desc\">' + escape(item.desc) +\n-                              '&nbsp;</span></a></td></tr>';\n+                               (\"<span class=\\\"alias\\\"><b>\" + item.alias + \" </b></span><span \" +\n+                                  \"class=\\\"grey\\\"><i>&nbsp;- see&nbsp;</i></span>\") : \"\") +\n+                              item.displayPath + \"<span class=\\\"\" + type + \"\\\">\" +\n+                              name + \"</span></a></td><td>\" +\n+                              \"<a href=\\\"\" + item.href + \"\\\">\" +\n+                              \"<span class=\\\"desc\\\">\" + escape(item.desc) +\n+                              \"&nbsp;</span></a></td></tr>\";\n                 });\n-                output += '</table>';\n+                output += \"</table>\";\n             } else {\n-                output = '<div class=\"search-failed\"' + extraStyle + '>No results :(<br/>' +\n-                    'Try on <a href=\"https://duckduckgo.com/?q=' +\n-                    encodeURIComponent('rust ' + query.query) +\n-                    '\">DuckDuckGo</a>?<br/><br/>' +\n-                    'Or try looking in one of these:<ul><li>The <a ' +\n-                    'href=\"https://doc.rust-lang.org/reference/index.html\">Rust Reference</a> for' +\n-                    ' technical details about the language.</li><li><a ' +\n-                    'href=\"https://doc.rust-lang.org/rust-by-example/index.html\">Rust By Example' +\n-                    '</a> for expository code examples.</a></li><li>The <a ' +\n-                    'href=\"https://doc.rust-lang.org/book/index.html\">Rust Book</a> for ' +\n-                    'introductions to language features and the language itself.</li><li><a ' +\n-                    'href=\"https://docs.rs\">Docs.rs</a> for documentation of crates released on ' +\n-                    '<a href=\"https://crates.io/\">crates.io</a>.</li></ul></div>';\n+                output = \"<div class=\\\"search-failed\\\"\" + extraStyle + \">No results :(<br/>\" +\n+                    \"Try on <a href=\\\"https://duckduckgo.com/?q=\" +\n+                    encodeURIComponent(\"rust \" + query.query) +\n+                    \"\\\">DuckDuckGo</a>?<br/><br/>\" +\n+                    \"Or try looking in one of these:<ul><li>The <a \" +\n+                    \"href=\\\"https://doc.rust-lang.org/reference/index.html\\\">Rust Reference</a> \" +\n+                    \" for technical details about the language.</li><li><a \" +\n+                    \"href=\\\"https://doc.rust-lang.org/rust-by-example/index.html\\\">Rust By \" +\n+                    \"Example</a> for expository code examples.</a></li><li>The <a \" +\n+                    \"href=\\\"https://doc.rust-lang.org/book/index.html\\\">Rust Book</a> for \" +\n+                    \"introductions to language features and the language itself.</li><li><a \" +\n+                    \"href=\\\"https://docs.rs\\\">Docs.rs</a> for documentation of crates released on\" +\n+                    \" <a href=\\\"https://crates.io/\\\">crates.io</a>.</li></ul></div>\";\n             }\n             return [output, length];\n         }\n \n         function makeTabHeader(tabNb, text, nbElems) {\n             if (currentTab === tabNb) {\n-                return '<div class=\"selected\">' + text +\n-                       ' <div class=\"count\">(' + nbElems + ')</div></div>';\n+                return \"<div class=\\\"selected\\\">\" + text +\n+                       \" <div class=\\\"count\\\">(\" + nbElems + \")</div></div>\";\n             }\n-            return '<div>' + text + ' <div class=\"count\">(' + nbElems + ')</div></div>';\n+            return \"<div>\" + text + \" <div class=\\\"count\\\">(\" + nbElems + \")</div></div>\";\n         }\n \n-        function showResults(results, filterCrates) {\n-            if (results['others'].length === 1 &&\n-                getCurrentValue('rustdoc-go-to-only-result') === \"true\") {\n-                var elem = document.createElement('a');\n-                elem.href = results['others'][0].href;\n-                elem.style.display = 'none';\n+        function showResults(results) {\n+            if (results.others.length === 1 &&\n+                getCurrentValue(\"rustdoc-go-to-only-result\") === \"true\") {\n+                var elem = document.createElement(\"a\");\n+                elem.href = results.others[0].href;\n+                elem.style.display = \"none\";\n                 // For firefox, we need the element to be in the DOM so it can be clicked.\n                 document.body.appendChild(elem);\n                 elem.click();\n@@ -1349,114 +1392,109 @@ if (!String.prototype.endsWith) {\n \n             currentResults = query.id;\n \n-            var ret_others = addTab(results['others'], query);\n-            var ret_in_args = addTab(results['in_args'], query, false);\n-            var ret_returned = addTab(results['returned'], query, false);\n+            var ret_others = addTab(results.others, query);\n+            var ret_in_args = addTab(results.in_args, query, false);\n+            var ret_returned = addTab(results.returned, query, false);\n \n-            var filter = \"\";\n-            if (filterCrates !== undefined) {\n-                filter = \" (in <b>\" + filterCrates + \"</b> crate)\";\n-            }\n-\n-            var output = '<h1>Results for ' + escape(query.query) +\n-                (query.type ? ' (type: ' + escape(query.type) + ')' : '') + filter + '</h1>' +\n-                '<div id=\"titles\">' +\n+            var output = \"<h1>Results for \" + escape(query.query) +\n+                (query.type ? \" (type: \" + escape(query.type) + \")\" : \"\") + \"</h1>\" +\n+                \"<div id=\\\"titles\\\">\" +\n                 makeTabHeader(0, \"In Names\", ret_others[1]) +\n                 makeTabHeader(1, \"In Parameters\", ret_in_args[1]) +\n                 makeTabHeader(2, \"In Return Types\", ret_returned[1]) +\n-                '</div><div id=\"results\">' +\n-                ret_others[0] + ret_in_args[0] + ret_returned[0] + '</div>';\n+                \"</div><div id=\\\"results\\\">\" +\n+                ret_others[0] + ret_in_args[0] + ret_returned[0] + \"</div>\";\n \n-            addClass(document.getElementById('main'), 'hidden');\n-            var search = document.getElementById('search');\n-            removeClass(search, 'hidden');\n+            addClass(main, \"hidden\");\n+            var search = document.getElementById(\"search\");\n+            removeClass(search, \"hidden\");\n             search.innerHTML = output;\n-            var tds = search.getElementsByTagName('td');\n+            var tds = search.getElementsByTagName(\"td\");\n             var td_width = 0;\n             if (tds.length > 0) {\n                 td_width = tds[0].offsetWidth;\n             }\n             var width = search.offsetWidth - 40 - td_width;\n-            onEach(search.getElementsByClassName('desc'), function(e) {\n-                e.style.width = width + 'px';\n+            onEachLazy(search.getElementsByClassName(\"desc\"), function(e) {\n+                e.style.width = width + \"px\";\n             });\n             initSearchNav();\n-            var elems = document.getElementById('titles').childNodes;\n+            var elems = document.getElementById(\"titles\").childNodes;\n             elems[0].onclick = function() { printTab(0); };\n             elems[1].onclick = function() { printTab(1); };\n             elems[2].onclick = function() { printTab(2); };\n             printTab(currentTab);\n         }\n \n         function execSearch(query, searchWords, filterCrates) {\n+            function getSmallest(arrays, positions, notDuplicates) {\n+                var start = null;\n+\n+                for (var it = 0; it < positions.length; ++it) {\n+                    if (arrays[it].length > positions[it] &&\n+                        (start === null || start > arrays[it][positions[it]].lev) &&\n+                        !notDuplicates[arrays[it][positions[it]].fullPath]) {\n+                        start = arrays[it][positions[it]].lev;\n+                    }\n+                }\n+                return start;\n+            }\n+\n+            function mergeArrays(arrays) {\n+                var ret = [];\n+                var positions = [];\n+                var notDuplicates = {};\n+\n+                for (var x = 0; x < arrays.length; ++x) {\n+                    positions.push(0);\n+                }\n+                while (ret.length < MAX_RESULTS) {\n+                    var smallest = getSmallest(arrays, positions, notDuplicates);\n+\n+                    if (smallest === null) {\n+                        break;\n+                    }\n+                    for (x = 0; x < arrays.length && ret.length < MAX_RESULTS; ++x) {\n+                        if (arrays[x].length > positions[x] &&\n+                                arrays[x][positions[x]].lev === smallest &&\n+                                !notDuplicates[arrays[x][positions[x]].fullPath]) {\n+                            ret.push(arrays[x][positions[x]]);\n+                            notDuplicates[arrays[x][positions[x]].fullPath] = true;\n+                            positions[x] += 1;\n+                        }\n+                    }\n+                }\n+                return ret;\n+            }\n+\n             var queries = query.raw.split(\",\");\n             var results = {\n-                'in_args': [],\n-                'returned': [],\n-                'others': [],\n+                \"in_args\": [],\n+                \"returned\": [],\n+                \"others\": [],\n             };\n \n             for (var i = 0; i < queries.length; ++i) {\n-                var query = queries[i].trim();\n+                query = queries[i].trim();\n                 if (query.length !== 0) {\n                     var tmp = execQuery(getQuery(query), searchWords, filterCrates);\n \n-                    results['in_args'].push(tmp['in_args']);\n-                    results['returned'].push(tmp['returned']);\n-                    results['others'].push(tmp['others']);\n+                    results.in_args.push(tmp.in_args);\n+                    results.returned.push(tmp.returned);\n+                    results.others.push(tmp.others);\n                 }\n             }\n             if (queries.length > 1) {\n-                function getSmallest(arrays, positions, notDuplicates) {\n-                    var start = null;\n-\n-                    for (var it = 0; it < positions.length; ++it) {\n-                        if (arrays[it].length > positions[it] &&\n-                            (start === null || start > arrays[it][positions[it]].lev) &&\n-                            !notDuplicates[arrays[it][positions[it]].fullPath]) {\n-                            start = arrays[it][positions[it]].lev;\n-                        }\n-                    }\n-                    return start;\n-                }\n-\n-                function mergeArrays(arrays) {\n-                    var ret = [];\n-                    var positions = [];\n-                    var notDuplicates = {};\n-\n-                    for (var x = 0; x < arrays.length; ++x) {\n-                        positions.push(0);\n-                    }\n-                    while (ret.length < MAX_RESULTS) {\n-                        var smallest = getSmallest(arrays, positions, notDuplicates);\n-\n-                        if (smallest === null) {\n-                            break;\n-                        }\n-                        for (x = 0; x < arrays.length && ret.length < MAX_RESULTS; ++x) {\n-                            if (arrays[x].length > positions[x] &&\n-                                    arrays[x][positions[x]].lev === smallest &&\n-                                    !notDuplicates[arrays[x][positions[x]].fullPath]) {\n-                                ret.push(arrays[x][positions[x]]);\n-                                notDuplicates[arrays[x][positions[x]].fullPath] = true;\n-                                positions[x] += 1;\n-                            }\n-                        }\n-                    }\n-                    return ret;\n-                }\n-\n                 return {\n-                    'in_args': mergeArrays(results['in_args']),\n-                    'returned': mergeArrays(results['returned']),\n-                    'others': mergeArrays(results['others']),\n+                    \"in_args\": mergeArrays(results.in_args),\n+                    \"returned\": mergeArrays(results.returned),\n+                    \"others\": mergeArrays(results.others),\n                 };\n             } else {\n                 return {\n-                    'in_args': results['in_args'][0],\n-                    'returned': results['returned'][0],\n-                    'others': results['others'][0],\n+                    \"in_args\": results.in_args[0],\n+                    \"returned\": results.returned[0],\n+                    \"others\": results.others[0],\n                 };\n             }\n         }\n@@ -1508,6 +1546,8 @@ if (!String.prototype.endsWith) {\n         function buildIndex(rawSearchIndex) {\n             searchIndex = [];\n             var searchWords = [];\n+            var i;\n+\n             for (var crate in rawSearchIndex) {\n                 if (!rawSearchIndex.hasOwnProperty(crate)) { continue; }\n \n@@ -1534,7 +1574,7 @@ if (!String.prototype.endsWith) {\n \n                 // convert `paths` into an object form\n                 var len = paths.length;\n-                for (var i = 0; i < len; ++i) {\n+                for (i = 0; i < len; ++i) {\n                     paths[i] = {ty: paths[i][0], name: paths[i][1]};\n                 }\n \n@@ -1545,9 +1585,9 @@ if (!String.prototype.endsWith) {\n                 // operation that is cached for the life of the page state so that\n                 // all other search operations have access to this cached data for\n                 // faster analysis operations\n-                var len = items.length;\n+                len = items.length;\n                 var lastPath = \"\";\n-                for (var i = 0; i < len; ++i) {\n+                for (i = 0; i < len; ++i) {\n                     var rawRow = items[i];\n                     var row = {crate: crate, ty: rawRow[0], name: rawRow[1],\n                                path: rawRow[2] || lastPath, desc: rawRow[3],\n@@ -1573,13 +1613,12 @@ if (!String.prototype.endsWith) {\n                     if (browserSupportsHistoryApi()) {\n                         history.replaceState(\"\", \"std - Rust\", \"?search=\");\n                     }\n-                    var main = document.getElementById('main');\n-                    if (hasClass(main, 'content')) {\n-                        removeClass(main, 'hidden');\n+                    if (hasClass(main, \"content\")) {\n+                        removeClass(main, \"hidden\");\n                     }\n-                    var search_c = document.getElementById('search');\n-                    if (hasClass(search_c, 'content')) {\n-                        addClass(search_c, 'hidden');\n+                    var search_c = document.getElementById(\"search\");\n+                    if (hasClass(search_c, \"content\")) {\n+                        addClass(search_c, \"hidden\");\n                     }\n                 } else {\n                     searchTimeout = setTimeout(search, 500);\n@@ -1620,13 +1659,12 @@ if (!String.prototype.endsWith) {\n                     // When browsing back from search results the main page\n                     // visibility must be reset.\n                     if (!params.search) {\n-                        var main = document.getElementById('main');\n-                        if (hasClass(main, 'content')) {\n-                            removeClass(main, 'hidden');\n+                        if (hasClass(main, \"content\")) {\n+                            removeClass(main, \"hidden\");\n                         }\n-                        var search_c = document.getElementById('search');\n-                        if (hasClass(search_c, 'content')) {\n-                            addClass(search_c, 'hidden');\n+                        var search_c = document.getElementById(\"search\");\n+                        if (hasClass(search_c, \"content\")) {\n+                            addClass(search_c, \"hidden\");\n                         }\n                     }\n                     // Revert to the previous title manually since the History\n@@ -1643,9 +1681,9 @@ if (!String.prototype.endsWith) {\n                     if (params.search) {\n                         search_input.value = params.search;\n                     } else {\n-                        search_input.value = '';\n+                        search_input.value = \"\";\n                     }\n-                    // Some browsers fire 'onpopstate' for every page load\n+                    // Some browsers fire \"onpopstate\" for every page load\n                     // (Chrome), while others fire the event only when actually\n                     // popping a state (Firefox), which is why search() is\n                     // called both here and at the end of the startSearch()\n@@ -1660,13 +1698,13 @@ if (!String.prototype.endsWith) {\n         startSearch();\n \n         // Draw a convenient sidebar of known crates if we have a listing\n-        if (rootPath === '../' || rootPath === \"./\") {\n-            var sidebar = document.getElementsByClassName('sidebar-elems')[0];\n+        if (rootPath === \"../\" || rootPath === \"./\") {\n+            var sidebar = document.getElementsByClassName(\"sidebar-elems\")[0];\n             if (sidebar) {\n-                var div = document.createElement('div');\n-                div.className = 'block crate';\n-                div.innerHTML = '<h3>Crates</h3>';\n-                var ul = document.createElement('ul');\n+                var div = document.createElement(\"div\");\n+                div.className = \"block crate\";\n+                div.innerHTML = \"<h3>Crates</h3>\";\n+                var ul = document.createElement(\"ul\");\n                 div.appendChild(ul);\n \n                 var crates = [];\n@@ -1678,17 +1716,17 @@ if (!String.prototype.endsWith) {\n                 }\n                 crates.sort();\n                 for (var i = 0; i < crates.length; ++i) {\n-                    var klass = 'crate';\n+                    var klass = \"crate\";\n                     if (rootPath !== \"./\" && crates[i] === window.currentCrate) {\n-                        klass += ' current';\n+                        klass += \" current\";\n                     }\n-                    var link = document.createElement('a');\n-                    link.href = rootPath + crates[i] + '/index.html';\n+                    var link = document.createElement(\"a\");\n+                    link.href = rootPath + crates[i] + \"/index.html\";\n                     link.title = rawSearchIndex[crates[i]].doc;\n                     link.className = klass;\n                     link.textContent = crates[i];\n \n-                    var li = document.createElement('li');\n+                    var li = document.createElement(\"li\");\n                     li.appendChild(link);\n                     ul.appendChild(li);\n                 }\n@@ -1701,41 +1739,44 @@ if (!String.prototype.endsWith) {\n \n     // delayed sidebar rendering.\n     function initSidebarItems(items) {\n-        var sidebar = document.getElementsByClassName('sidebar-elems')[0];\n+        var sidebar = document.getElementsByClassName(\"sidebar-elems\")[0];\n         var current = window.sidebarCurrent;\n \n         function block(shortty, longty) {\n             var filtered = items[shortty];\n-            if (!filtered) { return; }\n+            if (!filtered) {\n+                return;\n+            }\n \n-            var div = document.createElement('div');\n-            div.className = 'block ' + shortty;\n-            var h3 = document.createElement('h3');\n+            var div = document.createElement(\"div\");\n+            div.className = \"block \" + shortty;\n+            var h3 = document.createElement(\"h3\");\n             h3.textContent = longty;\n             div.appendChild(h3);\n-            var ul = document.createElement('ul');\n+            var ul = document.createElement(\"ul\");\n \n-            for (var i = 0; i < filtered.length; ++i) {\n+            var length = filtered.length;\n+            for (var i = 0; i < length; ++i) {\n                 var item = filtered[i];\n                 var name = item[0];\n                 var desc = item[1]; // can be null\n \n                 var klass = shortty;\n                 if (name === current.name && shortty === current.ty) {\n-                    klass += ' current';\n+                    klass += \" current\";\n                 }\n                 var path;\n-                if (shortty === 'mod') {\n-                    path = name + '/index.html';\n+                if (shortty === \"mod\") {\n+                    path = name + \"/index.html\";\n                 } else {\n-                    path = shortty + '.' + name + '.html';\n+                    path = shortty + \".\" + name + \".html\";\n                 }\n-                var link = document.createElement('a');\n+                var link = document.createElement(\"a\");\n                 link.href = current.relpath + path;\n                 link.title = desc;\n                 link.className = klass;\n                 link.textContent = name;\n-                var li = document.createElement('li');\n+                var li = document.createElement(\"li\");\n                 li.appendChild(link);\n                 ul.appendChild(li);\n             }\n@@ -1763,44 +1804,48 @@ if (!String.prototype.endsWith) {\n     window.initSidebarItems = initSidebarItems;\n \n     window.register_implementors = function(imp) {\n-        var implementors = document.getElementById('implementors-list');\n-        var synthetic_implementors = document.getElementById('synthetic-implementors-list');\n+        var implementors = document.getElementById(\"implementors-list\");\n+        var synthetic_implementors = document.getElementById(\"synthetic-implementors-list\");\n \n         var libs = Object.getOwnPropertyNames(imp);\n-        for (var i = 0; i < libs.length; ++i) {\n+        var llength = libs.length;\n+        for (var i = 0; i < llength; ++i) {\n             if (libs[i] === currentCrate) { continue; }\n             var structs = imp[libs[i]];\n \n+            var slength = structs.length;\n             struct_loop:\n-            for (var j = 0; j < structs.length; ++j) {\n+            for (var j = 0; j < slength; ++j) {\n                 var struct = structs[j];\n \n                 var list = struct.synthetic ? synthetic_implementors : implementors;\n \n                 if (struct.synthetic) {\n-                    for (var k = 0; k < struct.types.length; k++) {\n+                    var stlength = struct.types.length;\n+                    for (var k = 0; k < stlength; k++) {\n                         if (window.inlined_types.has(struct.types[k])) {\n                             continue struct_loop;\n                         }\n                         window.inlined_types.add(struct.types[k]);\n                     }\n                 }\n \n-                var code = document.createElement('code');\n+                var code = document.createElement(\"code\");\n                 code.innerHTML = struct.text;\n \n-                var x = code.getElementsByTagName('a');\n-                for (var k = 0; k < x.length; k++) {\n-                    var href = x[k].getAttribute('href');\n-                    if (href && href.indexOf('http') !== 0) {\n-                        x[k].setAttribute('href', rootPath + href);\n+                var x = code.getElementsByTagName(\"a\");\n+                var xlength = x.length;\n+                for (var it = 0; it < xlength; it++) {\n+                    var href = x[it].getAttribute(\"href\");\n+                    if (href && href.indexOf(\"http\") !== 0) {\n+                        x[it].setAttribute(\"href\", rootPath + href);\n                     }\n                 }\n-                var display = document.createElement('h3');\n+                var display = document.createElement(\"h3\");\n                 addClass(display, \"impl\");\n-                display.innerHTML = '<span class=\"in-band\"><table class=\"table-display\"><tbody>\\\n-                    <tr><td><code>' + code.outerHTML + '</code></td><td></td></tr></tbody></table>\\\n-                    </span>';\n+                display.innerHTML = \"<span class=\\\"in-band\\\"><table class=\\\"table-display\\\">\" +\n+                    \"<tbody><tr><td><code>\" + code.outerHTML + \"</code></td><td></td></tr>\" +\n+                    \"</tbody></table></span>\";\n                 list.appendChild(display);\n             }\n         }\n@@ -1816,47 +1861,49 @@ if (!String.prototype.endsWith) {\n         }\n         // button will collapse the section\n         // note that this text is also set in the HTML template in render.rs\n-        return \"\\u2212\"; // \"\\u2212\" is '\u2212' minus sign\n+        return \"\\u2212\"; // \"\\u2212\" is \"\u2212\" minus sign\n     }\n \n     function onEveryMatchingChild(elem, className, func) {\n         if (elem && className && func) {\n-            for (var i = 0; i < elem.childNodes.length; i++) {\n-                if (hasClass(elem.childNodes[i], className)) {\n-                    func(elem.childNodes[i]);\n+            var length = elem.childNodes.length;\n+            var nodes = elem.childNodes;\n+            for (var i = 0; i < length; ++i) {\n+                if (hasClass(nodes[i], className)) {\n+                    func(nodes[i]);\n                 } else {\n-                    onEveryMatchingChild(elem.childNodes[i], className, func);\n+                    onEveryMatchingChild(nodes[i], className, func);\n                 }\n             }\n         }\n     }\n \n     function toggleAllDocs(pageId, fromAutoCollapse) {\n-        var toggle = document.getElementById(\"toggle-all-docs\");\n-        if (!toggle) {\n+        var innerToggle = document.getElementById(\"toggle-all-docs\");\n+        if (!innerToggle) {\n             return;\n         }\n-        if (hasClass(toggle, \"will-expand\")) {\n+        if (hasClass(innerToggle, \"will-expand\")) {\n             updateLocalStorage(\"rustdoc-collapse\", \"false\");\n-            removeClass(toggle, \"will-expand\");\n-            onEveryMatchingChild(toggle, \"inner\", function(e) {\n+            removeClass(innerToggle, \"will-expand\");\n+            onEveryMatchingChild(innerToggle, \"inner\", function(e) {\n                 e.innerHTML = labelForToggleButton(false);\n             });\n-            toggle.title = \"collapse all docs\";\n+            innerToggle.title = \"collapse all docs\";\n             if (fromAutoCollapse !== true) {\n-                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                onEachLazy(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n                     collapseDocs(e, \"show\");\n                 });\n             }\n         } else {\n             updateLocalStorage(\"rustdoc-collapse\", \"true\");\n-            addClass(toggle, \"will-expand\");\n-            onEveryMatchingChild(toggle, \"inner\", function(e) {\n+            addClass(innerToggle, \"will-expand\");\n+            onEveryMatchingChild(innerToggle, \"inner\", function(e) {\n                 e.innerHTML = labelForToggleButton(true);\n             });\n-            toggle.title = \"expand all docs\";\n+            innerToggle.title = \"expand all docs\";\n             if (fromAutoCollapse !== true) {\n-                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                onEachLazy(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n                     collapseDocs(e, \"hide\", pageId);\n                 });\n             }\n@@ -1870,27 +1917,58 @@ if (!String.prototype.endsWith) {\n \n         function adjustToggle(arg) {\n             return function(e) {\n-                if (hasClass(e, 'toggle-label')) {\n+                if (hasClass(e, \"toggle-label\")) {\n                     if (arg) {\n-                        e.style.display = 'inline-block';\n+                        e.style.display = \"inline-block\";\n                     } else {\n-                        e.style.display = 'none';\n+                        e.style.display = \"none\";\n                     }\n                 }\n-                if (hasClass(e, 'inner')) {\n+                if (hasClass(e, \"inner\")) {\n                     e.innerHTML = labelForToggleButton(arg);\n                 }\n             };\n-        };\n+        }\n \n-        if (!hasClass(toggle.parentNode, \"impl\")) {\n-            var relatedDoc = toggle.parentNode.nextElementSibling;\n+        function implHider(addOrRemove) {\n+            return function(n) {\n+                var is_method = hasClass(n, \"method\");\n+                if (is_method || hasClass(n, \"type\")) {\n+                    if (is_method === true) {\n+                        if (addOrRemove) {\n+                            addClass(n, \"hidden-by-impl-hider\");\n+                        } else {\n+                            removeClass(n, \"hidden-by-impl-hider\");\n+                        }\n+                    }\n+                    var ns = n.nextElementSibling;\n+                    while (true) {\n+                        if (ns && (\n+                                hasClass(ns, \"docblock\") ||\n+                                hasClass(ns, \"stability\"))) {\n+                            if (addOrRemove) {\n+                                addClass(ns, \"hidden-by-impl-hider\");\n+                            } else {\n+                                removeClass(ns, \"hidden-by-impl-hider\");\n+                            }\n+                            ns = ns.nextElementSibling;\n+                            continue;\n+                        }\n+                        break;\n+                    }\n+                }\n+            };\n+        }\n+\n+        var relatedDoc;\n+        var action = mode;\n+        if (hasClass(toggle.parentNode, \"impl\") === false) {\n+            relatedDoc = toggle.parentNode.nextElementSibling;\n             if (hasClass(relatedDoc, \"stability\")) {\n                 relatedDoc = relatedDoc.nextElementSibling;\n             }\n             if (hasClass(relatedDoc, \"docblock\") || hasClass(relatedDoc, \"sub-variant\")) {\n-                var action = mode;\n-                if (action === \"toggle\") {\n+                if (mode === \"toggle\") {\n                     if (hasClass(relatedDoc, \"hidden-by-usual-hider\")) {\n                         action = \"show\";\n                     } else {\n@@ -1899,67 +1977,35 @@ if (!String.prototype.endsWith) {\n                 }\n                 if (action === \"hide\") {\n                     addClass(relatedDoc, \"hidden-by-usual-hider\");\n-                    onEach(toggle.childNodes, adjustToggle(true));\n-                    addClass(toggle.parentNode, 'collapsed');\n+                    onEachLazy(toggle.childNodes, adjustToggle(true));\n+                    addClass(toggle.parentNode, \"collapsed\");\n                 } else if (action === \"show\") {\n                     removeClass(relatedDoc, \"hidden-by-usual-hider\");\n-                    removeClass(toggle.parentNode, 'collapsed');\n-                    onEach(toggle.childNodes, adjustToggle(false));\n+                    removeClass(toggle.parentNode, \"collapsed\");\n+                    onEachLazy(toggle.childNodes, adjustToggle(false));\n                 }\n             }\n         } else {\n             // we are collapsing the impl block\n-            function implHider(addOrRemove) {\n-                return function(n) {\n-                    var is_method = hasClass(n, \"method\");\n-                    if (is_method || hasClass(n, \"type\")) {\n-                        if (is_method === true) {\n-                            if (addOrRemove) {\n-                                addClass(n, \"hidden-by-impl-hider\");\n-                            } else {\n-                                removeClass(n, \"hidden-by-impl-hider\");\n-                            }\n-                        }\n-                        var ns = n.nextElementSibling;\n-                        while (true) {\n-                            if (ns && (\n-                                    hasClass(ns, \"docblock\") ||\n-                                    hasClass(ns, \"stability\"))) {\n-                                if (addOrRemove) {\n-                                    addClass(ns, \"hidden-by-impl-hider\");\n-                                } else {\n-                                    removeClass(ns, \"hidden-by-impl-hider\");\n-                                }\n-                                ns = ns.nextElementSibling;\n-                                continue;\n-                            }\n-                            break;\n-                        }\n-                    }\n-                }\n-            }\n \n             var parentElem = toggle.parentNode;\n-            var relatedDoc = parentElem;\n+            relatedDoc = parentElem;\n             var docblock = relatedDoc.nextElementSibling;\n \n-            while (!hasClass(relatedDoc, \"impl-items\")) {\n+            while (hasClass(relatedDoc, \"impl-items\") === false) {\n                 relatedDoc = relatedDoc.nextElementSibling;\n             }\n \n-            if ((!relatedDoc && !hasClass(docblock, \"docblock\")) ||\n-                (pageId && onEach(relatedDoc.childNodes, function(e) {\n-                    return e.id === pageId;\n-                }) === true)) {\n+            if ((!relatedDoc && hasClass(docblock, \"docblock\") === false) ||\n+                (pageId && document.getElementById(pageId))) {\n                 return;\n             }\n \n             // Hide all functions, but not associated types/consts\n \n-            var action = mode;\n-            if (action === \"toggle\") {\n+            if (mode === \"toggle\") {\n                 if (hasClass(relatedDoc, \"fns-now-collapsed\") ||\n-                    hasClass(docblock,  \"hidden-by-impl-hider\")) {\n+                    hasClass(docblock, \"hidden-by-impl-hider\")) {\n                     action = \"show\";\n                 } else {\n                     action = \"hide\";\n@@ -1969,149 +2015,160 @@ if (!String.prototype.endsWith) {\n             if (action === \"show\") {\n                 removeClass(relatedDoc, \"fns-now-collapsed\");\n                 removeClass(docblock, \"hidden-by-usual-hider\");\n-                onEach(toggle.childNodes, adjustToggle(false));\n-                onEach(relatedDoc.childNodes, implHider(false));\n+                onEachLazy(toggle.childNodes, adjustToggle(false));\n+                onEachLazy(relatedDoc.childNodes, implHider(false));\n             } else if (action === \"hide\") {\n                 addClass(relatedDoc, \"fns-now-collapsed\");\n                 addClass(docblock, \"hidden-by-usual-hider\");\n-                onEach(toggle.childNodes, adjustToggle(true));\n-                onEach(relatedDoc.childNodes, implHider(true));\n+                onEachLazy(toggle.childNodes, adjustToggle(true));\n+                onEachLazy(relatedDoc.childNodes, implHider(true));\n+            }\n+        }\n+    }\n+\n+    function collapser(e, collapse) {\n+        // inherent impl ids are like \"impl\" or impl-<number>'.\n+        // they will never be hidden by default.\n+        var n = e.parentElement;\n+        if (n.id.match(/^impl(?:-\\d+)?$/) === null) {\n+            // Automatically minimize all non-inherent impls\n+            if (collapse || hasClass(n, \"impl\")) {\n+                collapseDocs(e, \"hide\", pageId);\n             }\n         }\n     }\n \n     function autoCollapse(pageId, collapse) {\n         if (collapse) {\n             toggleAllDocs(pageId, true);\n-        }\n-        var collapser = function(e) {\n-                // inherent impl ids are like 'impl' or impl-<number>'.\n-                // they will never be hidden by default.\n-                var n = e.parentElement;\n-                if (n.id.match(/^impl(?:-\\d+)?$/) === null) {\n-                    // Automatically minimize all non-inherent impls\n-                    if (collapse || hasClass(n, 'impl')) {\n-                        collapseDocs(e, \"hide\", pageId);\n-                    }\n-                }\n-        };\n-        if (getCurrentValue('rustdoc-trait-implementations') !== \"false\") {\n-            var impl_list = document.getElementById('implementations-list');\n+        } else if (getCurrentValue(\"rustdoc-trait-implementations\") !== \"false\") {\n+            var impl_list = document.getElementById(\"implementations-list\");\n \n             if (impl_list !== null) {\n-                onEach(impl_list.getElementsByClassName(\"collapse-toggle\"), collapser);\n-            }\n-        }\n-        if (getCurrentValue('rustdoc-method-docs') !== \"false\") {\n-            var implItems = document.getElementsByClassName('impl-items');\n-\n-            if (implItems && implItems.length > 0) {\n-                onEach(implItems, function(elem) {\n-                    onEach(elem.getElementsByClassName(\"collapse-toggle\"), collapser);\n+                onEachLazy(impl_list.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                    collapser(e, collapse);\n                 });\n             }\n         }\n     }\n \n-    var x = document.getElementById('toggle-all-docs');\n-    if (x) {\n-        x.onclick = toggleAllDocs;\n+    var toggles = document.getElementById(\"toggle-all-docs\");\n+    if (toggles) {\n+        toggles.onclick = toggleAllDocs;\n     }\n \n     function insertAfter(newNode, referenceNode) {\n         referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n     }\n \n-    function checkIfThereAreMethods(elems) {\n-        var areThereMethods = false;\n-\n-        onEach(elems, function(e) {\n-            if (hasClass(e, \"method\")) {\n-                areThereMethods = true;\n-                return true;\n-            }\n-        });\n-        return areThereMethods;\n+    function createSimpleToggle(sectionIsCollapsed) {\n+        var toggle = document.createElement(\"a\");\n+        toggle.href = \"javascript:void(0)\";\n+        toggle.className = \"collapse-toggle\";\n+        toggle.innerHTML = \"[<span class=\\\"inner\\\">\" + labelForToggleButton(sectionIsCollapsed) +\n+                           \"</span>]\";\n+        return toggle;\n     }\n \n-    var toggle = document.createElement('a');\n-    toggle.href = 'javascript:void(0)';\n-    toggle.className = 'collapse-toggle';\n-    toggle.innerHTML = \"[<span class='inner'>\" + labelForToggleButton(false) + \"</span>]\";\n+    var toggle = createSimpleToggle(false);\n \n     var func = function(e) {\n         var next = e.nextElementSibling;\n-        if (hasClass(e, 'impl') && next && hasClass(next, 'docblock')) {\n+        if (!next) {\n+            return;\n+        }\n+        if (hasClass(next, \"docblock\") ||\n+            (hasClass(next, \"stability\") &&\n+             hasClass(next.nextElementSibling, \"docblock\"))) {\n+            insertAfter(toggle.cloneNode(true), e.childNodes[e.childNodes.length - 1]);\n+        }\n+    };\n+\n+    var funcImpl = function(e) {\n+        var next = e.nextElementSibling;\n+        if (next && hasClass(next, \"docblock\")) {\n             next = next.nextElementSibling;\n         }\n         if (!next) {\n             return;\n         }\n-        if ((hasClass(e, 'method') || hasClass(e, 'associatedconstant') ||\n-             checkIfThereAreMethods(next.childNodes)) &&\n-            (hasClass(next, 'docblock') ||\n-             hasClass(e, 'impl') ||\n-             (hasClass(next, 'stability') &&\n-              hasClass(next.nextElementSibling, 'docblock')))) {\n+        if (next.getElementsByClassName(\"method\").length > 0 && hasClass(e, \"impl\")) {\n             insertAfter(toggle.cloneNode(true), e.childNodes[e.childNodes.length - 1]);\n         }\n     };\n-    onEach(document.getElementsByClassName('method'), func);\n-    onEach(document.getElementsByClassName('associatedconstant'), func);\n-    onEach(document.getElementsByClassName('impl'), func);\n-    onEach(document.getElementsByClassName('impl-items'), function(e) {\n-        onEach(e.getElementsByClassName('associatedconstant'), func);\n-        var hiddenElems = e.getElementsByClassName('hidden');\n+\n+    onEachLazy(document.getElementsByClassName(\"method\"), func);\n+    onEachLazy(document.getElementsByClassName(\"associatedconstant\"), func);\n+    onEachLazy(document.getElementsByClassName(\"impl\"), funcImpl);\n+    var impl_call = function() {};\n+    if (getCurrentValue(\"rustdoc-method-docs\") !== \"false\") {\n+        impl_call = function(e, newToggle, pageId) {\n+            if (e.id.match(/^impl(?:-\\d+)?$/) === null) {\n+                // Automatically minimize all non-inherent impls\n+                if (hasClass(e, \"impl\")) {\n+                    collapseDocs(newToggle, \"hide\", pageId);\n+                }\n+            }\n+        };\n+    }\n+    var pageId = getPageId();\n+    var newToggle = document.createElement(\"a\");\n+    newToggle.href = \"javascript:void(0)\";\n+    newToggle.className = \"collapse-toggle hidden-default collapsed\";\n+    newToggle.innerHTML = \"[<span class=\\\"inner\\\">\" + labelForToggleButton(true) +\n+                          \"</span>] Show hidden undocumented items\";\n+    function toggleClicked() {\n+        if (hasClass(this, \"collapsed\")) {\n+            removeClass(this, \"collapsed\");\n+            onEachLazy(this.parentNode.getElementsByClassName(\"hidden\"), function(x) {\n+                if (hasClass(x, \"content\") === false) {\n+                    removeClass(x, \"hidden\");\n+                    addClass(x, \"x\");\n+                }\n+            }, true);\n+            this.innerHTML = \"[<span class=\\\"inner\\\">\" + labelForToggleButton(false) +\n+                             \"</span>] Hide undocumented items\";\n+        } else {\n+            addClass(this, \"collapsed\");\n+            onEachLazy(this.parentNode.getElementsByClassName(\"x\"), function(x) {\n+                if (hasClass(x, \"content\") === false) {\n+                    addClass(x, \"hidden\");\n+                    removeClass(x, \"x\");\n+                }\n+            }, true);\n+            this.innerHTML = \"[<span class=\\\"inner\\\">\" + labelForToggleButton(true) +\n+                             \"</span>] Show hidden undocumented items\";\n+        }\n+    }\n+    onEachLazy(document.getElementsByClassName(\"impl-items\"), function(e) {\n+        onEachLazy(e.getElementsByClassName(\"associatedconstant\"), func);\n+        var hiddenElems = e.getElementsByClassName(\"hidden\");\n         var needToggle = false;\n \n-        for (var i = 0; i < hiddenElems.length; ++i) {\n+        var hlength = hiddenElems.length;\n+        for (var i = 0; i < hlength; ++i) {\n             if (hasClass(hiddenElems[i], \"content\") === false &&\n                 hasClass(hiddenElems[i], \"docblock\") === false) {\n                 needToggle = true;\n                 break;\n             }\n         }\n         if (needToggle === true) {\n-            var newToggle = document.createElement('a');\n-            newToggle.href = 'javascript:void(0)';\n-            newToggle.className = 'collapse-toggle hidden-default collapsed';\n-            newToggle.innerHTML = \"[<span class='inner'>\" + labelForToggleButton(true) + \"</span>\" +\n-                                  \"] Show hidden undocumented items\";\n-            newToggle.onclick = function() {\n-                if (hasClass(this, \"collapsed\")) {\n-                    removeClass(this, \"collapsed\");\n-                    onEach(this.parentNode.getElementsByClassName(\"hidden\"), function(x) {\n-                        if (hasClass(x, \"content\") === false) {\n-                            removeClass(x, \"hidden\");\n-                            addClass(x, \"x\");\n-                        }\n-                    }, true);\n-                    this.innerHTML = \"[<span class='inner'>\" + labelForToggleButton(false) +\n-                                     \"</span>] Hide undocumented items\"\n-                } else {\n-                    addClass(this, \"collapsed\");\n-                    onEach(this.parentNode.getElementsByClassName(\"x\"), function(x) {\n-                        if (hasClass(x, \"content\") === false) {\n-                            addClass(x, \"hidden\");\n-                            removeClass(x, \"x\");\n-                        }\n-                    }, true);\n-                    this.innerHTML = \"[<span class='inner'>\" + labelForToggleButton(true) +\n-                                     \"</span>] Show hidden undocumented items\";\n-                }\n-            };\n-            e.insertBefore(newToggle, e.firstChild);\n+            var inner_toggle = newToggle.cloneNode(true);\n+            inner_toggle.onclick = toggleClicked;\n+            e.insertBefore(inner_toggle, e.firstChild);\n+            impl_call(e, inner_toggle, pageId);\n         }\n     });\n \n     function createToggle(otherMessage, fontSize, extraClass, show) {\n-        var span = document.createElement('span');\n-        span.className = 'toggle-label';\n+        var span = document.createElement(\"span\");\n+        span.className = \"toggle-label\";\n         if (show) {\n-            span.style.display = 'none';\n+            span.style.display = \"none\";\n         }\n         if (!otherMessage) {\n-            span.innerHTML = '&nbsp;Expand&nbsp;description';\n+            span.innerHTML = \"&nbsp;Expand&nbsp;description\";\n         } else {\n             span.innerHTML = otherMessage;\n         }\n@@ -2123,13 +2180,13 @@ if (!String.prototype.endsWith) {\n         var mainToggle = toggle.cloneNode(true);\n         mainToggle.appendChild(span);\n \n-        var wrapper = document.createElement('div');\n-        wrapper.className = 'toggle-wrapper';\n+        var wrapper = document.createElement(\"div\");\n+        wrapper.className = \"toggle-wrapper\";\n         if (!show) {\n-            addClass(wrapper, 'collapsed');\n-            var inner = mainToggle.getElementsByClassName('inner');\n+            addClass(wrapper, \"collapsed\");\n+            var inner = mainToggle.getElementsByClassName(\"inner\");\n             if (inner && inner.length > 0) {\n-                inner[0].innerHTML = '+';\n+                inner[0].innerHTML = \"+\";\n             }\n         }\n         if (extraClass) {\n@@ -2139,50 +2196,50 @@ if (!String.prototype.endsWith) {\n         return wrapper;\n     }\n \n-    var showItemDeclarations = getCurrentValue('rustdoc-item-declarations') === \"false\";\n+    var showItemDeclarations = getCurrentValue(\"rustdoc-item-declarations\") === \"false\";\n     function buildToggleWrapper(e) {\n-        if (hasClass(e, 'autohide')) {\n+        if (hasClass(e, \"autohide\")) {\n             var wrap = e.previousElementSibling;\n-            if (wrap && hasClass(wrap, 'toggle-wrapper')) {\n-                var toggle = wrap.childNodes[0];\n-                var extra = e.childNodes[0].tagName === 'H3';\n+            if (wrap && hasClass(wrap, \"toggle-wrapper\")) {\n+                var inner_toggle = wrap.childNodes[0];\n+                var extra = e.childNodes[0].tagName === \"H3\";\n \n-                e.style.display = 'none';\n-                addClass(wrap, 'collapsed');\n-                onEach(toggle.getElementsByClassName('inner'), function(e) {\n+                e.style.display = \"none\";\n+                addClass(wrap, \"collapsed\");\n+                onEachLazy(inner_toggle.getElementsByClassName(\"inner\"), function(e) {\n                     e.innerHTML = labelForToggleButton(true);\n                 });\n-                onEach(toggle.getElementsByClassName('toggle-label'), function(e) {\n-                    e.style.display = 'inline-block';\n+                onEachLazy(inner_toggle.getElementsByClassName(\"toggle-label\"), function(e) {\n+                    e.style.display = \"inline-block\";\n                     if (extra === true) {\n                         i_e.innerHTML = \" Show \" + e.childNodes[0].innerHTML;\n                     }\n                 });\n             }\n         }\n         if (e.parentNode.id === \"main\") {\n-            var otherMessage = '';\n+            var otherMessage = \"\";\n             var fontSize;\n             var extraClass;\n \n             if (hasClass(e, \"type-decl\")) {\n                 fontSize = \"20px\";\n-                otherMessage = '&nbsp;Show&nbsp;declaration';\n+                otherMessage = \"&nbsp;Show&nbsp;declaration\";\n                 if (showItemDeclarations === false) {\n-                    extraClass = 'collapsed';\n+                    extraClass = \"collapsed\";\n                 }\n             } else if (hasClass(e, \"sub-variant\")) {\n-                otherMessage = '&nbsp;Show&nbsp;fields';\n+                otherMessage = \"&nbsp;Show&nbsp;fields\";\n             } else if (hasClass(e, \"non-exhaustive\")) {\n-                otherMessage = '&nbsp;This&nbsp;';\n+                otherMessage = \"&nbsp;This&nbsp;\";\n                 if (hasClass(e, \"non-exhaustive-struct\")) {\n-                    otherMessage += 'struct';\n+                    otherMessage += \"struct\";\n                 } else if (hasClass(e, \"non-exhaustive-enum\")) {\n-                    otherMessage += 'enum';\n+                    otherMessage += \"enum\";\n                 } else if (hasClass(e, \"non-exhaustive-type\")) {\n-                    otherMessage += 'type';\n+                    otherMessage += \"type\";\n                 }\n-                otherMessage += '&nbsp;is&nbsp;marked&nbsp;as&nbsp;non-exhaustive';\n+                otherMessage += \"&nbsp;is&nbsp;marked&nbsp;as&nbsp;non-exhaustive\";\n             } else if (hasClass(e.childNodes[0], \"impl-items\")) {\n                 extraClass = \"marg-left\";\n             }\n@@ -2199,101 +2256,102 @@ if (!String.prototype.endsWith) {\n         }\n     }\n \n-    onEach(document.getElementsByClassName('docblock'), buildToggleWrapper);\n-    onEach(document.getElementsByClassName('sub-variant'), buildToggleWrapper);\n-\n-    function createToggleWrapper(tog) {\n-        var span = document.createElement('span');\n-        span.className = 'toggle-label';\n-        span.style.display = 'none';\n-        span.innerHTML = '&nbsp;Expand&nbsp;attributes';\n-        tog.appendChild(span);\n-\n-        var wrapper = document.createElement('div');\n-        wrapper.className = 'toggle-wrapper toggle-attributes';\n-        wrapper.appendChild(tog);\n-        return wrapper;\n-    }\n+    onEachLazy(document.getElementsByClassName(\"docblock\"), buildToggleWrapper);\n+    onEachLazy(document.getElementsByClassName(\"sub-variant\"), buildToggleWrapper);\n \n     // In the search display, allows to switch between tabs.\n     function printTab(nb) {\n         if (nb === 0 || nb === 1 || nb === 2) {\n             currentTab = nb;\n         }\n         var nb_copy = nb;\n-        onEach(document.getElementById('titles').childNodes, function(elem) {\n+        onEachLazy(document.getElementById(\"titles\").childNodes, function(elem) {\n             if (nb_copy === 0) {\n-                addClass(elem, 'selected');\n+                addClass(elem, \"selected\");\n             } else {\n-                removeClass(elem, 'selected');\n+                removeClass(elem, \"selected\");\n             }\n             nb_copy -= 1;\n         });\n-        onEach(document.getElementById('results').childNodes, function(elem) {\n+        onEachLazy(document.getElementById(\"results\").childNodes, function(elem) {\n             if (nb === 0) {\n-                elem.style.display = '';\n+                elem.style.display = \"\";\n             } else {\n-                elem.style.display = 'none';\n+                elem.style.display = \"none\";\n             }\n             nb -= 1;\n         });\n     }\n \n+    function createToggleWrapper(tog) {\n+        var span = document.createElement(\"span\");\n+        span.className = \"toggle-label\";\n+        span.style.display = \"none\";\n+        span.innerHTML = \"&nbsp;Expand&nbsp;attributes\";\n+        tog.appendChild(span);\n+\n+        var wrapper = document.createElement(\"div\");\n+        wrapper.className = \"toggle-wrapper toggle-attributes\";\n+        wrapper.appendChild(tog);\n+        return wrapper;\n+    }\n+\n     // To avoid checking on \"rustdoc-item-attributes\" value on every loop...\n     var itemAttributesFunc = function() {};\n     if (getCurrentValue(\"rustdoc-item-attributes\") !== \"false\") {\n         itemAttributesFunc = function(x) {\n             collapseDocs(x.previousSibling.childNodes[0], \"toggle\");\n         };\n     }\n-    onEach(document.getElementById('main').getElementsByClassName('attributes'), function(i_e) {\n-        i_e.parentNode.insertBefore(createToggleWrapper(toggle.cloneNode(true)), i_e);\n+    var attributesToggle = createToggleWrapper(createSimpleToggle(false));\n+    onEachLazy(main.getElementsByClassName(\"attributes\"), function(i_e) {\n+        i_e.parentNode.insertBefore(attributesToggle.cloneNode(true), i_e);\n         itemAttributesFunc(i_e);\n     });\n \n     // To avoid checking on \"rustdoc-line-numbers\" value on every loop...\n     var lineNumbersFunc = function() {};\n     if (getCurrentValue(\"rustdoc-line-numbers\") === \"true\") {\n         lineNumbersFunc = function(x) {\n-            var count = x.textContent.split('\\n').length;\n+            var count = x.textContent.split(\"\\n\").length;\n             var elems = [];\n             for (var i = 0; i < count; ++i) {\n                 elems.push(i + 1);\n             }\n-            var node = document.createElement('pre');\n-            addClass(node, 'line-number');\n-            node.innerHTML = elems.join('\\n');\n+            var node = document.createElement(\"pre\");\n+            addClass(node, \"line-number\");\n+            node.innerHTML = elems.join(\"\\n\");\n             x.parentNode.insertBefore(node, x);\n         };\n     }\n-    onEach(document.getElementsByClassName('rust-example-rendered'), function(e) {\n-        if (hasClass(e, 'compile_fail')) {\n+    onEachLazy(document.getElementsByClassName(\"rust-example-rendered\"), function(e) {\n+        if (hasClass(e, \"compile_fail\")) {\n             e.addEventListener(\"mouseover\", function(event) {\n-                this.parentElement.previousElementSibling.childNodes[0].style.color = '#f00';\n+                this.parentElement.previousElementSibling.childNodes[0].style.color = \"#f00\";\n             });\n             e.addEventListener(\"mouseout\", function(event) {\n-                this.parentElement.previousElementSibling.childNodes[0].style.color = '';\n+                this.parentElement.previousElementSibling.childNodes[0].style.color = \"\";\n             });\n-        } else if (hasClass(e, 'ignore')) {\n+        } else if (hasClass(e, \"ignore\")) {\n             e.addEventListener(\"mouseover\", function(event) {\n-                this.parentElement.previousElementSibling.childNodes[0].style.color = '#ff9200';\n+                this.parentElement.previousElementSibling.childNodes[0].style.color = \"#ff9200\";\n             });\n             e.addEventListener(\"mouseout\", function(event) {\n-                this.parentElement.previousElementSibling.childNodes[0].style.color = '';\n+                this.parentElement.previousElementSibling.childNodes[0].style.color = \"\";\n             });\n         }\n         lineNumbersFunc(e);\n     });\n \n     function showModal(content) {\n-        var modal = document.createElement('div');\n+        var modal = document.createElement(\"div\");\n         modal.id = \"important\";\n-        addClass(modal, 'modal');\n-        modal.innerHTML = '<div class=\"modal-content\"><div class=\"close\" id=\"modal-close\">\u2715</div>' +\n-                          '<div class=\"whiter\"></div><span class=\"docblock\">' + content +\n-                          '</span></div>';\n-        document.getElementsByTagName('body')[0].appendChild(modal);\n-        document.getElementById('modal-close').onclick = hideModal;\n+        addClass(modal, \"modal\");\n+        modal.innerHTML = \"<div class=\\\"modal-content\\\"><div class=\\\"close\\\" id=\\\"modal-close\\\">\u2715\" +\n+                          \"</div><div class=\\\"whiter\\\"></div><span class=\\\"docblock\\\">\" + content +\n+                          \"</span></div>\";\n+        document.getElementsByTagName(\"body\")[0].appendChild(modal);\n+        document.getElementById(\"modal-close\").onclick = hideModal;\n         modal.onclick = hideModal;\n     }\n \n@@ -2304,15 +2362,15 @@ if (!String.prototype.endsWith) {\n         }\n     }\n \n-    onEach(document.getElementsByClassName('important-traits'), function(e) {\n+    onEachLazy(document.getElementsByClassName(\"important-traits\"), function(e) {\n         e.onclick = function() {\n             showModal(e.lastElementChild.innerHTML);\n         };\n     });\n \n     function putBackSearch(search_input) {\n         if (search_input.value !== \"\") {\n-            addClass(document.getElementById(\"main\"), \"hidden\");\n+            addClass(main, \"hidden\");\n             removeClass(document.getElementById(\"search\"), \"hidden\");\n             if (browserSupportsHistoryApi()) {\n                 history.replaceState(search_input.value,\n@@ -2330,16 +2388,16 @@ if (!String.prototype.endsWith) {\n \n     var params = getQueryStringParams();\n     if (params && params.search) {\n-        addClass(document.getElementById(\"main\"), \"hidden\");\n+        addClass(main, \"hidden\");\n         var search = document.getElementById(\"search\");\n         removeClass(search, \"hidden\");\n-        search.innerHTML = '<h3 style=\"text-align: center;\">Loading search results...</h3>';\n+        search.innerHTML = \"<h3 style=\\\"text-align: center;\\\">Loading search results...</h3>\";\n     }\n \n     var sidebar_menu = document.getElementsByClassName(\"sidebar-menu\")[0];\n     if (sidebar_menu) {\n         sidebar_menu.onclick = function() {\n-            var sidebar = document.getElementsByClassName('sidebar')[0];\n+            var sidebar = document.getElementsByClassName(\"sidebar\")[0];\n             if (hasClass(sidebar, \"mobile\") === true) {\n                 hideSidebar();\n             } else {\n@@ -2355,7 +2413,18 @@ if (!String.prototype.endsWith) {\n     autoCollapse(getPageId(), getCurrentValue(\"rustdoc-collapse\") === \"true\");\n \n     if (window.location.hash && window.location.hash.length > 0) {\n-        expandSection(window.location.hash.replace(/^#/, ''));\n+        expandSection(window.location.hash.replace(/^#/, \"\"));\n+    }\n+\n+    if (main) {\n+        onEachLazy(main.getElementsByClassName(\"loading-content\"), function(e) {\n+            e.remove();\n+        });\n+        onEachLazy(main.childNodes, function(e) {\n+            if (e.tagName === \"H2\" || e.tagName === \"H3\") {\n+                e.nextElementSibling.style.display = \"block\";\n+            }\n+        });\n     }\n \n     function addSearchOptions(crates) {\n@@ -2394,10 +2463,10 @@ if (!String.prototype.endsWith) {\n \n // Sets the focus on the search bar at the top of the page\n function focusSearchBar() {\n-    document.getElementsByClassName('search-input')[0].focus();\n+    document.getElementsByClassName(\"search-input\")[0].focus();\n }\n \n // Removes the focus from the search bar\n function defocusSearchBar() {\n-    document.getElementsByClassName('search-input')[0].blur();\n+    document.getElementsByClassName(\"search-input\")[0].blur();\n }"}, {"sha": "f4de75f2140bdff8be84942aa8944229c9921611", "filename": "src/librustdoc/html/static/noscript.css", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fnoscript.css", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fnoscript.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fnoscript.css?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -0,0 +1,19 @@\n+/**\n+ * Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+ * file at the top-level directory of this distribution and at\n+ * http://rust-lang.org/COPYRIGHT.\n+ *\n+ * Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+ * http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+ * <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+ * option. This file may not be copied, modified, or distributed\n+ * except according to those terms.\n+ */\n+\n+#main > h2 + div, #main > h2 + h3, #main > h3 + div {\n+\tdisplay: block;\n+}\n+\n+.loading-content {\n+\tdisplay: none;\n+}"}, {"sha": "d1336b1e8eb0b7aa510bd30df42795ef893dcd1d", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -368,6 +368,10 @@ body:not(.source) .example-wrap > pre {\n #main > .docblock h2 { font-size: 1.15em; }\n #main > .docblock h3, #main > .docblock h4, #main > .docblock h5 { font-size: 1em; }\n \n+#main > h2 + div, #main > h2 + h3, #main > h3 + div {\n+\tdisplay: none;\n+}\n+\n .docblock h1 { font-size: 1em; }\n .docblock h2 { font-size: 0.95em; }\n .docblock h3, .docblock h4, .docblock h5 { font-size: 0.9em; }"}, {"sha": "d1c377bf95ac87e29c6cd117849992d7c7029cdb", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 20, "deletions": 30, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -19,55 +19,38 @@ var mainTheme = document.getElementById(\"mainThemeStyle\");\n var savedHref = [];\n \n function hasClass(elem, className) {\n-    if (elem && className && elem.className) {\n-        var elemClass = elem.className;\n-        var start = elemClass.indexOf(className);\n-        if (start === -1) {\n-            return false;\n-        } else if (elemClass.length === className.length) {\n-            return true;\n-        } else {\n-            if (start > 0 && elemClass[start - 1] !== ' ') {\n-                return false;\n-            }\n-            var end = start + className.length;\n-            return !(end < elemClass.length && elemClass[end] !== ' ');\n-        }\n-    }\n-    return false;\n+    return elem && elem.classList && elem.classList.contains(className);\n }\n \n function addClass(elem, className) {\n-    if (elem && className && !hasClass(elem, className)) {\n-        if (elem.className && elem.className.length > 0) {\n-            elem.className += ' ' + className;\n-        } else {\n-            elem.className = className;\n-        }\n+    if (!elem || !elem.classList) {\n+        return;\n     }\n+    elem.classList.add(className);\n }\n \n function removeClass(elem, className) {\n-    if (elem && className && elem.className) {\n-        elem.className = (\" \" + elem.className + \" \").replace(\" \" + className + \" \", \" \")\n-                                                     .trim();\n+    if (!elem || !elem.classList) {\n+        return;\n     }\n+    elem.classList.remove(className);\n }\n \n function isHidden(elem) {\n-    return (elem.offsetParent === null)\n+    return elem.offsetParent === null;\n }\n \n function onEach(arr, func, reversed) {\n     if (arr && arr.length > 0 && func) {\n+        var length = arr.length;\n         if (reversed !== true) {\n-            for (var i = 0; i < arr.length; ++i) {\n+            for (var i = 0; i < length; ++i) {\n                 if (func(arr[i]) === true) {\n                     return true;\n                 }\n             }\n         } else {\n-            for (var i = arr.length - 1; i >= 0; --i) {\n+            for (var i = length - 1; i >= 0; --i) {\n                 if (func(arr[i]) === true) {\n                     return true;\n                 }\n@@ -77,6 +60,13 @@ function onEach(arr, func, reversed) {\n     return false;\n }\n \n+function onEachLazy(lazyArray, func, reversed) {\n+    return onEach(\n+        Array.prototype.slice.call(lazyArray),\n+        func,\n+        reversed);\n+}\n+\n function usableLocalStorage() {\n     // Check if the browser supports localStorage at all:\n     if (typeof(Storage) === \"undefined\") {\n@@ -133,8 +123,8 @@ function switchTheme(styleElem, mainStyleElem, newTheme) {\n     });\n     if (found === true) {\n         styleElem.href = newHref;\n-        updateLocalStorage('rustdoc-theme', newTheme);\n+        updateLocalStorage(\"rustdoc-theme\", newTheme);\n     }\n }\n \n-switchTheme(currentTheme, mainTheme, getCurrentValue('rustdoc-theme') || 'light');\n+switchTheme(currentTheme, mainTheme, getCurrentValue(\"rustdoc-theme\") || \"light\");"}, {"sha": "f71b2a8728422f4e323962512860f3729ec55a9c", "filename": "src/librustdoc/html/static_files.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f04a646c68acb7f964e113d145f9bb28bfbb48a/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs?ref=7f04a646c68acb7f964e113d145f9bb28bfbb48a", "patch": "@@ -23,6 +23,9 @@ pub static RUSTDOC_CSS: &'static str = include_str!(\"static/rustdoc.css\");\n /// The file contents of `settings.css`, responsible for the items on the settings page.\n pub static SETTINGS_CSS: &'static str = include_str!(\"static/settings.css\");\n \n+/// The file contents of the `noscript.css` file, used in case JS isn't supported or is disabled.\n+pub static NOSCRIPT_CSS: &'static str = include_str!(\"static/noscript.css\");\n+\n /// The file contents of `normalize.css`, included to even out standard elements between browser\n /// implementations.\n pub static NORMALIZE_CSS: &'static str = include_str!(\"static/normalize.css\");"}]}