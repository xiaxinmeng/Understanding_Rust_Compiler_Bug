{"sha": "e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "node_id": "C_kwDOAAsO6NoAKGU1OGJiMmFjYmQzYTJjNjFkNGM0OTJjMzIyZTljNTNlZDMwNjg0ODk", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-02-06T16:58:05Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-02-17T18:20:34Z"}, "message": "Use new abi for 128bit int to float cast intrinsics on Windows", "tree": {"sha": "9eaf4c7414a0b7da8065a9f3641abcaebd1d62e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9eaf4c7414a0b7da8065a9f3641abcaebd1d62e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "html_url": "https://github.com/rust-lang/rust/commit/e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e58bb2acbd3a2c61d4c492c322e9c53ed3068489/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdf4f4287a7727b72a2f7f47a88ca1d450fdafd0", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdf4f4287a7727b72a2f7f47a88ca1d450fdafd0", "html_url": "https://github.com/rust-lang/rust/commit/cdf4f4287a7727b72a2f7f47a88ca1d450fdafd0"}], "stats": {"total": 30, "additions": 23, "deletions": 7}, "files": [{"sha": "0ab29f335a0fbe391128404d8767b035c45baaae", "filename": "src/cast.rs", "status": "modified", "additions": 22, "deletions": 6, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/e58bb2acbd3a2c61d4c492c322e9c53ed3068489/src%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e58bb2acbd3a2c61d4c492c322e9c53ed3068489/src%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcast.rs?ref=e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "patch": "@@ -64,12 +64,28 @@ pub(crate) fn clif_int_or_float_cast(\n                 },\n             );\n \n-            return fx.lib_call(\n-                &name,\n-                vec![AbiParam::new(types::I128)],\n-                vec![AbiParam::new(to_ty)],\n-                &[from],\n-            )[0];\n+            if fx.tcx.sess.target.is_like_windows {\n+                let arg_place = CPlace::new_stack_slot(\n+                    fx,\n+                    fx.layout_of(if from_signed { fx.tcx.types.i128 } else { fx.tcx.types.u128 }),\n+                );\n+                let arg_ptr = arg_place.to_ptr();\n+                arg_ptr.store(fx, from, MemFlags::trusted());\n+                let args = [arg_ptr.get_addr(fx)];\n+                return fx.lib_call(\n+                    &name,\n+                    vec![AbiParam::new(fx.pointer_type)],\n+                    vec![AbiParam::new(to_ty)],\n+                    &args,\n+                )[0];\n+            } else {\n+                return fx.lib_call(\n+                    &name,\n+                    vec![AbiParam::new(types::I128)],\n+                    vec![AbiParam::new(to_ty)],\n+                    &[from],\n+                )[0];\n+            }\n         }\n \n         // int-like -> float"}, {"sha": "5b69bc7cc9b3df609b6f9f259b7d503a54189999", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e58bb2acbd3a2c61d4c492c322e9c53ed3068489/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e58bb2acbd3a2c61d4c492c322e9c53ed3068489/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=e58bb2acbd3a2c61d4c492c322e9c53ed3068489", "patch": "@@ -188,7 +188,7 @@ impl CodegenBackend for CraneliftCodegenBackend {\n     }\n \n     fn target_features(&self, _sess: &Session, _allow_unstable: bool) -> Vec<rustc_span::Symbol> {\n-        vec![]\n+        vec![Symbol::intern(\"llvm14-builtins-abi\")]\n     }\n \n     fn print_version(&self) {"}]}