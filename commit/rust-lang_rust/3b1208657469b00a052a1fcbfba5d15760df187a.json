{"sha": "3b1208657469b00a052a1fcbfba5d15760df187a", "node_id": "C_kwDOAAsO6NoAKDNiMTIwODY1NzQ2OWIwMGEwNTJhMWZjYmZiYTVkMTU3NjBkZjE4N2E", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-10-29T22:09:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-29T22:09:24Z"}, "message": "Rollup merge of #103124 - ldm0:nohard_tests, r=Mark-Simulacrum\n\nAdd tests for autoderef on block tail\n\nref: https://github.com/rust-lang/rust/pull/83850#issuecomment-1270598506", "tree": {"sha": "17da97f64a917c983bfda5910a5d2176e20970f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/17da97f64a917c983bfda5910a5d2176e20970f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b1208657469b00a052a1fcbfba5d15760df187a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjXaSUCRBK7hj4Ov3rIwAA0pUIAFTzt1a4SFhqsJcVp9HkhUJL\ngfrOFxEMVTYZJ0oM4bwbR5X6z51rWuTjmKpR11bpOV1kGkGNmfAjP39oSpdjWB0l\nKrNCFTRQ4az5VuskD8XbpBZZLJgaNCEzVKxx7uOHwYJurwhytrnKT1UgF6Osz/fy\n5iTc57EYIBYuemmmL6bnORlDaUybqTWXaFC3OQGNUYtLaO7MwWeXfhwwcdWygPm7\n5erPU74Ok9/P9etbRG3HyxgKJl7xEubWnSSMed/tiGt0ly2GNhRADNzg8GJsXqcm\nBtpy6ATtKWDv8AOVFChth7KrweTz765hYFWgrka5x5rb4P2NbhfuQ7u9lv0qo88=\n=FS20\n-----END PGP SIGNATURE-----\n", "payload": "tree 17da97f64a917c983bfda5910a5d2176e20970f6\nparent 23ff93ce8d893d471ad6f0cfc07077e6030df9f0\nparent 3e904197950d273b7d87fe05bf7e3ec23db9794a\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1667081364 +0200\ncommitter GitHub <noreply@github.com> 1667081364 +0200\n\nRollup merge of #103124 - ldm0:nohard_tests, r=Mark-Simulacrum\n\nAdd tests for autoderef on block tail\n\nref: https://github.com/rust-lang/rust/pull/83850#issuecomment-1270598506\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b1208657469b00a052a1fcbfba5d15760df187a", "html_url": "https://github.com/rust-lang/rust/commit/3b1208657469b00a052a1fcbfba5d15760df187a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b1208657469b00a052a1fcbfba5d15760df187a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23ff93ce8d893d471ad6f0cfc07077e6030df9f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/23ff93ce8d893d471ad6f0cfc07077e6030df9f0", "html_url": "https://github.com/rust-lang/rust/commit/23ff93ce8d893d471ad6f0cfc07077e6030df9f0"}, {"sha": "3e904197950d273b7d87fe05bf7e3ec23db9794a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e904197950d273b7d87fe05bf7e3ec23db9794a", "html_url": "https://github.com/rust-lang/rust/commit/3e904197950d273b7d87fe05bf7e3ec23db9794a"}], "stats": {"total": 149, "additions": 149, "deletions": 0}, "files": [{"sha": "01c8ab5a839fa70eac51a72fc89654287a9cec84", "filename": "src/test/ui/coercion/coerce-block-tail-26978.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.rs?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,11 @@\n+// check-fail\n+fn f(_: &i32) {}\n+\n+fn main() {\n+    let x = Box::new(1i32);\n+\n+    f(&x);\n+    f(&(x));\n+    f(&{x});\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "384debd487c5156bcf9b3255d40878105e3940ca", "filename": "src/test/ui/coercion/coerce-block-tail-26978.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-26978.stderr?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,16 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-26978.rs:9:9\n+   |\n+LL |     f(&{x});\n+   |         ^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+help: consider unboxing the value\n+   |\n+LL |     f(&{*x});\n+   |         +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "79b5b33233b314b063548c9b1eee7b5ce91c9dc2", "filename": "src/test/ui/coercion/coerce-block-tail-57749.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.rs?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,35 @@\n+// check-fail\n+use std::ops::Deref;\n+\n+fn main() {\n+    fn save(who: &str) {\n+        println!(\"I'll save you, {}!\", who);\n+    }\n+\n+    struct Madoka;\n+\n+    impl Deref for Madoka {\n+        type Target = str;\n+        fn deref(&self) -> &Self::Target {\n+            \"Madoka\"\n+        }\n+    }\n+\n+    save(&{ Madoka });\n+\n+    fn reset(how: &u32) {\n+        println!(\"Reset {} times\", how);\n+    }\n+\n+    struct Homura;\n+\n+    impl Deref for Homura {\n+        type Target = u32;\n+        fn deref(&self) -> &Self::Target {\n+            &42\n+        }\n+    }\n+\n+    reset(&{ Homura });\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "d5660c81dbd3e67256825cf826ecde848fb254ef", "filename": "src/test/ui/coercion/coerce-block-tail-57749.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-57749.stderr?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,14 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-57749.rs:33:14\n+   |\n+LL |     reset(&{ Homura });\n+   |              ^^^^^^ expected `u32`, found struct `Homura`\n+   |\n+help: consider dereferencing the type\n+   |\n+LL |     reset(&{ *Homura });\n+   |              +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "18c8ae3bbbad472895cdd80ddb394249b9338d8e", "filename": "src/test/ui/coercion/coerce-block-tail-83783.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.rs?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,13 @@\n+// check-fail\n+// edition:2018\n+fn _consume_reference<T: ?Sized>(_: &T) {}\n+\n+async fn _foo() {\n+    _consume_reference::<i32>(&Box::new(7_i32));\n+    _consume_reference::<i32>(&async { Box::new(7_i32) }.await);\n+    //~^ ERROR mismatched types\n+    _consume_reference::<[i32]>(&vec![7_i32]);\n+    _consume_reference::<[i32]>(&async { vec![7_i32] }.await);\n+}\n+\n+fn main() { }"}, {"sha": "5f53606ce2225d42330518a1ac5e6f305a8841bb", "filename": "src/test/ui/coercion/coerce-block-tail-83783.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83783.stderr?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-83783.rs:7:32\n+   |\n+LL |     _consume_reference::<i32>(&async { Box::new(7_i32) }.await);\n+   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "77fdf99983332eaa00261ed5512d238f0ff6c567", "filename": "src/test/ui/coercion/coerce-block-tail-83850.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.rs?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,7 @@\n+// check-fail\n+fn f(_: &[i32]) {}\n+\n+fn main() {\n+    f(&Box::new([1, 2]));\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "bbf6075437043532384ae1ccb7c9b542bf7159bc", "filename": "src/test/ui/coercion/coerce-block-tail-83850.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail-83850.stderr?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,19 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail-83850.rs:5:7\n+   |\n+LL |     f(&Box::new([1, 2]));\n+   |     - ^^^^^^^^^^^^^^^^^ expected slice `[i32]`, found struct `Box`\n+   |     |\n+   |     arguments to this function are incorrect\n+   |\n+   = note: expected reference `&[i32]`\n+              found reference `&Box<[{integer}; 2]>`\n+note: function defined here\n+  --> $DIR/coerce-block-tail-83850.rs:2:4\n+   |\n+LL | fn f(_: &[i32]) {}\n+   |    ^ ---------\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "dcbcd3762862f75349bd1f75e61812ce54fe4498", "filename": "src/test/ui/coercion/coerce-block-tail.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.rs?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,6 @@\n+// check-fail\n+fn main() {\n+    let _: &str = & { String::from(\"hahah\")};\n+    let _: &i32 = & { Box::new(1i32) };\n+    //~^ ERROR mismatched types\n+}"}, {"sha": "318cf75867b4b47d7a8dd4d5c517db5a1b6b12f5", "filename": "src/test/ui/coercion/coerce-block-tail.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3b1208657469b00a052a1fcbfba5d15760df187a/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoercion%2Fcoerce-block-tail.stderr?ref=3b1208657469b00a052a1fcbfba5d15760df187a", "patch": "@@ -0,0 +1,16 @@\n+error[E0308]: mismatched types\n+  --> $DIR/coerce-block-tail.rs:4:23\n+   |\n+LL |     let _: &i32 = & { Box::new(1i32) };\n+   |                       ^^^^^^^^^^^^^^ expected `i32`, found struct `Box`\n+   |\n+   = note: expected type `i32`\n+            found struct `Box<i32>`\n+help: consider unboxing the value\n+   |\n+LL |     let _: &i32 = & { *Box::new(1i32) };\n+   |                       +\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}