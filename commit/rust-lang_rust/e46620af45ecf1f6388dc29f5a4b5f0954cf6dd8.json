{"sha": "e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0NjYyMGFmNDVlY2YxZjYzODhkYzI5ZjVhNGI1ZjA5NTRjZjZkZDg=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-01-13T08:27:28Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-01-13T08:59:30Z"}, "message": "std: Deprecate `finally` module\n\nNo in-tree users. Ugly interface. Closes #14332.", "tree": {"sha": "748738c0fc151ef35c3528ee05ed6420357688e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/748738c0fc151ef35c3528ee05ed6420357688e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "html_url": "https://github.com/rust-lang/rust/commit/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a44a19af29585c02e81e22ea7665f829ae0590a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a44a19af29585c02e81e22ea7665f829ae0590a", "html_url": "https://github.com/rust-lang/rust/commit/3a44a19af29585c02e81e22ea7665f829ae0590a"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "65d2a9e7b7eb192acad2b8106e21d9a958cfbf6f", "filename": "src/libcore/finally.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8/src%2Flibcore%2Ffinally.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8/src%2Flibcore%2Ffinally.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ffinally.rs?ref=e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "patch": "@@ -32,7 +32,7 @@\n //! # }\n //! ```\n \n-#![unstable]\n+#![deprecated = \"this was an unsightly interface. just implement Drop\"]\n \n use ops::{Drop, FnMut, FnOnce};\n "}, {"sha": "5050b7c466ed51e576e9a1ba9a6457a5672a6d7f", "filename": "src/test/run-pass/backtrace.rs", "status": "modified", "additions": 37, "deletions": 1, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8/src%2Ftest%2Frun-pass%2Fbacktrace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8/src%2Ftest%2Frun-pass%2Fbacktrace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fbacktrace.rs?ref=e46620af45ecf1f6388dc29f5a4b5f0954cf6dd8", "patch": "@@ -12,11 +12,47 @@\n // ignore-windows FIXME #13259\n \n #![feature(unboxed_closures)]\n+#![feature(unsafe_destructor)]\n \n use std::os;\n use std::io::process::Command;\n-use std::finally::Finally;\n use std::str;\n+use std::ops::{Drop, FnMut, FnOnce};\n+\n+pub trait Finally<T> {\n+    fn finally<F>(&mut self, dtor: F) -> T where F: FnMut();\n+}\n+\n+impl<T, F> Finally<T> for F where F: FnMut() -> T {\n+    fn finally<G>(&mut self, mut dtor: G) -> T where G: FnMut() {\n+        try_finally(&mut (), self, |_, f| (*f)(), |_| dtor())\n+    }\n+}\n+\n+pub fn try_finally<T, U, R, F, G>(mutate: &mut T, drop: U, try_fn: F, finally_fn: G) -> R where\n+    F: FnOnce(&mut T, U) -> R,\n+    G: FnMut(&mut T),\n+{\n+    let f = Finallyalizer {\n+        mutate: mutate,\n+        dtor: finally_fn,\n+    };\n+    try_fn(&mut *f.mutate, drop)\n+}\n+\n+struct Finallyalizer<'a, A:'a, F> where F: FnMut(&mut A) {\n+    mutate: &'a mut A,\n+    dtor: F,\n+}\n+\n+#[unsafe_destructor]\n+impl<'a, A, F> Drop for Finallyalizer<'a, A, F> where F: FnMut(&mut A) {\n+    #[inline]\n+    fn drop(&mut self) {\n+        (self.dtor)(self.mutate);\n+    }\n+}\n+\n \n #[inline(never)]\n fn foo() {"}]}