{"sha": "4738d284f2c1c6d448b3a375f547b61da2c86adc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3MzhkMjg0ZjJjMWM2ZDQ0OGIzYTM3NWY1NDdiNjFkYTJjODZhZGM=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-12T21:20:37Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-09-12T21:20:37Z"}, "message": "Merge pull request #309 from marcusklaas/array-literals\n\nFormat array literals", "tree": {"sha": "d4553aaaf8280422cd64498423e25d6796611f2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4553aaaf8280422cd64498423e25d6796611f2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4738d284f2c1c6d448b3a375f547b61da2c86adc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4738d284f2c1c6d448b3a375f547b61da2c86adc", "html_url": "https://github.com/rust-lang/rust/commit/4738d284f2c1c6d448b3a375f547b61da2c86adc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4738d284f2c1c6d448b3a375f547b61da2c86adc/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4debd4d302bd455d7feba2f1386992fe67bbbef5", "url": "https://api.github.com/repos/rust-lang/rust/commits/4debd4d302bd455d7feba2f1386992fe67bbbef5", "html_url": "https://github.com/rust-lang/rust/commit/4debd4d302bd455d7feba2f1386992fe67bbbef5"}, {"sha": "7deee6daf58cdd9487680d964871436c146656a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/7deee6daf58cdd9487680d964871436c146656a3", "html_url": "https://github.com/rust-lang/rust/commit/7deee6daf58cdd9487680d964871436c146656a3"}], "stats": {"total": 118, "additions": 117, "deletions": 1}, "files": [{"sha": "e738976b5c5e7e0a1022def2f83f1f45a5e83e1f", "filename": "src/expr.rs", "status": "modified", "additions": 56, "deletions": 1, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/4738d284f2c1c6d448b3a375f547b61da2c86adc/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4738d284f2c1c6d448b3a375f547b61da2c86adc/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=4738d284f2c1c6d448b3a375f547b61da2c86adc", "patch": "@@ -31,12 +31,20 @@ use syntax::visit::Visitor;\n impl Rewrite for ast::Expr {\n     fn rewrite(&self, context: &RewriteContext, width: usize, offset: usize) -> Option<String> {\n         match self.node {\n+            ast::Expr_::ExprVec(ref expr_vec) => {\n+                rewrite_array(expr_vec.iter().map(|e| &**e), self.span, context, width, offset)\n+            }\n             ast::Expr_::ExprLit(ref l) => {\n                 match l.node {\n                     ast::Lit_::LitStr(_, ast::StrStyle::CookedStr) => {\n                         rewrite_string_lit(context, l.span, width, offset)\n                     }\n-                    _ => Some(context.snippet(self.span)),\n+                    _ => {\n+                        wrap_str(context.snippet(self.span),\n+                                 context.config.max_width,\n+                                 width,\n+                                 offset)\n+                    }\n                 }\n             }\n             ast::Expr_::ExprCall(ref callee, ref args) => {\n@@ -152,6 +160,53 @@ impl Rewrite for ast::Expr {\n     }\n }\n \n+fn rewrite_array<'a, I>(expr_iter: I,\n+                        span: Span,\n+                        context: &RewriteContext,\n+                        width: usize,\n+                        offset: usize)\n+                        -> Option<String>\n+    where I: Iterator<Item = &'a ast::Expr> + ExactSizeIterator\n+{\n+    // 2 for brackets;\n+    let max_item_width = try_opt!(width.checked_sub(2));\n+    let items = itemize_list(context.codemap,\n+                             expr_iter,\n+                             \"]\",\n+                             |item| item.span.lo,\n+                             |item| item.span.hi,\n+                             // 1 = [\n+                             // FIXME(#133): itemize_list doesn't support\n+                             // rewrite failure. This may not be its\n+                             // responsibility, but that of write_list.\n+                             |item| {\n+                                 item.rewrite(context, max_item_width, offset + 1)\n+                                     .unwrap_or_else(|| context.snippet(item.span))\n+                             },\n+                             span_after(span, \"[\", context.codemap),\n+                             span.hi)\n+                    .collect::<Vec<_>>();\n+\n+    let tactic = if items.iter().any(|li| li.item.len() > 10 || li.is_multiline()) {\n+        ListTactic::HorizontalVertical\n+    } else {\n+        ListTactic::Mixed\n+    };\n+\n+    let fmt = ListFormatting {\n+        tactic: tactic,\n+        separator: \",\",\n+        trailing_separator: SeparatorTactic::Never,\n+        indent: offset + 1,\n+        h_width: max_item_width,\n+        v_width: max_item_width,\n+        ends_with_newline: false,\n+    };\n+    let list_str = try_opt!(write_list(&items, &fmt));\n+\n+    Some(format!(\"[{}]\", list_str))\n+}\n+\n // This functions is pretty messy because of the wrapping and unwrapping of\n // expressions into and from blocks. See rust issue #27872.\n fn rewrite_closure(capture: ast::CaptureClause,"}, {"sha": "faa0d3775c7197a3eef4a91708bdf5ce3335963a", "filename": "tests/source/expr.rs", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/4738d284f2c1c6d448b3a375f547b61da2c86adc/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4738d284f2c1c6d448b3a375f547b61da2c86adc/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=4738d284f2c1c6d448b3a375f547b61da2c86adc", "patch": "@@ -129,3 +129,47 @@ fn issue184(source: &str) {\n         }\n     }\n }\n+\n+fn arrays() {\n+    let x = [0,\n+         1,\n+         2,\n+         3,\n+         4,\n+         5,\n+         6,\n+         7,\n+         8,\n+         9,\n+         0,\n+         1,\n+         2,\n+         3,\n+         4,\n+         5,\n+         6,\n+         7,\n+         8,\n+         9,\n+         0,\n+         7,\n+         8,\n+         9,\n+         0,\n+         1,\n+         2,\n+         3,\n+         4,\n+         5,\n+         6,\n+         7,\n+         8,\n+         9,\n+         0];\n+\n+    let y = [/* comment */ 1, 2 /* post comment */, 3];\n+\n+    let z = [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, yyyyyyyyyyyyyyyyyyyyyyyyyyy, zzzzzzzzzzzzzzzzzz, q];\n+\n+    [ 1 +   3, 4 ,  5, 6, 7, 7, fncall::<Vec<_>>(3-1)]\n+}"}, {"sha": "bb629f12126664aab9f72b1039b420005c3f13b5", "filename": "tests/target/expr.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4738d284f2c1c6d448b3a375f547b61da2c86adc/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4738d284f2c1c6d448b3a375f547b61da2c86adc/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=4738d284f2c1c6d448b3a375f547b61da2c86adc", "patch": "@@ -166,3 +166,20 @@ fn issue184(source: &str) {\n         }\n     }\n }\n+\n+fn arrays() {\n+    let x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 7, 8, 9, 0, 1, 2, 3, 4,\n+             5, 6, 7, 8, 9, 0];\n+\n+    let y = [// comment\n+             1,\n+             2, // post comment\n+             3];\n+\n+    let z = [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx,\n+             yyyyyyyyyyyyyyyyyyyyyyyyyyy,\n+             zzzzzzzzzzzzzzzzzz,\n+             q];\n+\n+    [1 + 3, 4, 5, 6, 7, 7, fncall::<Vec<_>>(3 - 1)]\n+}"}]}