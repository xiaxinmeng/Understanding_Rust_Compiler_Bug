{"sha": "2b124a81409a00e9e00a4fdb02c16ff4e1f9b534", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiMTI0YTgxNDA5YTAwZTllMDBhNGZkYjAyYzE2ZmY0ZTFmOWI1MzQ=", "commit": {"author": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-05-18T00:24:55Z"}, "committer": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-05-20T23:51:08Z"}, "message": "Started working on translating spawn. It correctly generates the task name in the case that it is not provided.", "tree": {"sha": "a575de7ffc0dee526384f714cb5be374e7fe6b9d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a575de7ffc0dee526384f714cb5be374e7fe6b9d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534", "html_url": "https://github.com/rust-lang/rust/commit/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534/comments", "author": null, "committer": null, "parents": [{"sha": "51e1ce292d0a64630df1764bb3f71b885aff7116", "url": "https://api.github.com/repos/rust-lang/rust/commits/51e1ce292d0a64630df1764bb3f71b885aff7116", "html_url": "https://github.com/rust-lang/rust/commit/51e1ce292d0a64630df1764bb3f71b885aff7116"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "cc8ec47829e342fb724679326b4e57bd50e97f68", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 41, "deletions": 1, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b124a81409a00e9e00a4fdb02c16ff4e1f9b534/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=2b124a81409a00e9e00a4fdb02c16ff4e1f9b534", "patch": "@@ -5543,6 +5543,10 @@ fn trans_expr(&@block_ctxt cx, &@ast::expr e) -> result {\n             ret trans_recv(cx, lhs, rhs, ann);\n         }\n \n+        case (ast::expr_spawn(?dom, ?name, ?func, ?args, ?ann)) {\n+            ret trans_spawn(dom, name, func, args, ann);\n+        }\n+\n         case (_) {\n             // The expression is an lvalue. Fall through.\n         }\n@@ -5879,9 +5883,45 @@ fn trans_chan(&@block_ctxt cx, &@ast::expr e, &ast::ann ann) -> result {\n     ret res(bcx, chan_val);\n }\n \n+fn trans_spawn(&ast::spawn_dom dom, &option::t[str] name,\n+               &@ast::expr func, &vec[@ast::expr] args, \n+               &ast::ann ann) -> result {\n+    // Make the task name\n+    auto tname = alt(name) {\n+        case(none) {\n+            auto argss = vec::map(common::expr_to_str, args);\n+            #fmt(\"%s(%s)\",\n+                 common::expr_to_str(func),\n+                 str::connect(argss, \", \"))\n+        }\n+        case(some[str](?n)) {\n+            n\n+        }\n+    };\n+\n+    // dump a bunch of information\n+    log_err \"Spawn\";\n+    //log_err dom; \n+    log_err #fmt(\"task name: %s\", tname);\n+\n+    // Generate code\n+    alt(dom) {\n+        case(ast::dom_implicit) {\n+            // TODO\n+            log_err \"Spawning implicit domain tasks is not implemented.\";\n+            fail;\n+        }\n+\n+        case(ast::dom_thread) {\n+            // TODO\n+            log_err \"Spawining new thread tasks is not implemented.\";\n+            fail;\n+        }\n+    }\n+}\n+\n fn trans_send(&@block_ctxt cx, &@ast::expr lhs, &@ast::expr rhs,\n               &ast::ann ann) -> result {\n-\n     auto bcx = cx;\n     auto chn = trans_expr(bcx, lhs);\n     bcx = chn.bcx;"}]}