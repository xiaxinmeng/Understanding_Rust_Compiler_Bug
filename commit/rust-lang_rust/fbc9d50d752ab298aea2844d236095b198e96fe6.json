{"sha": "fbc9d50d752ab298aea2844d236095b198e96fe6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiYzlkNTBkNzUyYWIyOThhZWEyODQ0ZDIzNjA5NWIxOThlOTZmZTY=", "commit": {"author": {"name": "Yuxuan Shui", "email": "yshuiv7@gmail.com", "date": "2020-12-20T17:16:02Z"}, "committer": {"name": "Yuxuan Shui", "email": "yshuiv7@gmail.com", "date": "2020-12-20T17:16:02Z"}, "message": "make sure installer only creates directories in DESTDIR\n\nFixes #80238\n\nSigned-off-by: Yuxuan Shui <yshuiv7@gmail.com>", "tree": {"sha": "239c4e714a71e747c20c294832bd2d2ac6358609", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/239c4e714a71e747c20c294832bd2d2ac6358609"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbc9d50d752ab298aea2844d236095b198e96fe6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEL6EJkr0WlitWahBy06RAW+bMF/QFAl/fhtsACgkQ06RAW+bM\nF/S/YQ/9FBaMZO5LQp2aRkZ0Xkk4nFZXwSOy0aNkcQmRmH+VYgoODEU0bQGxfzGJ\nOJANrgqguNKVieaCFtm5uobqL0HhlN7uk5TiMOxaToGG8PljSEQzJ7dO94sAEyEd\nZxXIz3ENRsKp+03mimP4b4oLlbhXVJ6Y1uG+tl7hnoimSb+yLa5oQwrKiZKKmFLd\n9Yx8ijxnJgv6x5WufQ0Ze6yCRxAaHpKpEZ8TGnQPMOG9YYD9oC5lgp8mx/ZZZBip\n6EPKiB2uyjl3CoIxsm710A1Kr6EDp2A1AMQK2n3CIBrEI7MR7q6nykqc65uvYJtZ\nh3okJ6S6mXyb2NWCGlN5AXOTTW6HfZd8VK62y4XlVpsz9LWzFltY80zXLA25IIVb\npF0vheUU2MWcr2G38W4XCXUymkNW50P+u66/e410k6ZAjv49FP24iJ+sfj7U2iDU\nzPGZGqNUA5TX99ZMdVopz4YfC5Gojxwm8ev1selZn7gQQwMP61gLGkulq5kFjPrM\ne0+vSb8DIOqzm2ZhE+xUGsLCkHypRez/qth39H9RRzz+bT+89KWyVq83VSANmk7L\nXmGBkFXAL8QCtnzXdVsmLQ0OnEcrC80CvWSsVdXmYyPcjBpkUhWpRoRD57SngeOt\nLPx4IOXHez+T3MSXH/DJvBPZWVjcjDaksDI2jOz5ePzLQneV+uk=\n=5sSw\n-----END PGP SIGNATURE-----", "payload": "tree 239c4e714a71e747c20c294832bd2d2ac6358609\nparent 2ad5292aea6328113b55968b4322528d48261316\nauthor Yuxuan Shui <yshuiv7@gmail.com> 1608484562 +0000\ncommitter Yuxuan Shui <yshuiv7@gmail.com> 1608484562 +0000\n\nmake sure installer only creates directories in DESTDIR\n\nFixes #80238\n\nSigned-off-by: Yuxuan Shui <yshuiv7@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbc9d50d752ab298aea2844d236095b198e96fe6", "html_url": "https://github.com/rust-lang/rust/commit/fbc9d50d752ab298aea2844d236095b198e96fe6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbc9d50d752ab298aea2844d236095b198e96fe6/comments", "author": {"login": "yshui", "id": 366851, "node_id": "MDQ6VXNlcjM2Njg1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/366851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yshui", "html_url": "https://github.com/yshui", "followers_url": "https://api.github.com/users/yshui/followers", "following_url": "https://api.github.com/users/yshui/following{/other_user}", "gists_url": "https://api.github.com/users/yshui/gists{/gist_id}", "starred_url": "https://api.github.com/users/yshui/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yshui/subscriptions", "organizations_url": "https://api.github.com/users/yshui/orgs", "repos_url": "https://api.github.com/users/yshui/repos", "events_url": "https://api.github.com/users/yshui/events{/privacy}", "received_events_url": "https://api.github.com/users/yshui/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yshui", "id": 366851, "node_id": "MDQ6VXNlcjM2Njg1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/366851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yshui", "html_url": "https://github.com/yshui", "followers_url": "https://api.github.com/users/yshui/followers", "following_url": "https://api.github.com/users/yshui/following{/other_user}", "gists_url": "https://api.github.com/users/yshui/gists{/gist_id}", "starred_url": "https://api.github.com/users/yshui/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yshui/subscriptions", "organizations_url": "https://api.github.com/users/yshui/orgs", "repos_url": "https://api.github.com/users/yshui/repos", "events_url": "https://api.github.com/users/yshui/events{/privacy}", "received_events_url": "https://api.github.com/users/yshui/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ad5292aea6328113b55968b4322528d48261316", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ad5292aea6328113b55968b4322528d48261316", "html_url": "https://github.com/rust-lang/rust/commit/2ad5292aea6328113b55968b4322528d48261316"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8f2b128b3688e745ceddbd54785797a19bf669fd", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fbc9d50d752ab298aea2844d236095b198e96fe6/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbc9d50d752ab298aea2844d236095b198e96fe6/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=fbc9d50d752ab298aea2844d236095b198e96fe6", "patch": "@@ -73,12 +73,7 @@ fn install_sh(\n     let docdir_default = datadir_default.join(\"doc/rust\");\n     let libdir_default = PathBuf::from(\"lib\");\n     let mandir_default = datadir_default.join(\"man\");\n-    let prefix = builder.config.prefix.as_ref().map_or(prefix_default, |p| {\n-        fs::create_dir_all(p)\n-            .unwrap_or_else(|err| panic!(\"could not create {}: {}\", p.display(), err));\n-        fs::canonicalize(p)\n-            .unwrap_or_else(|err| panic!(\"could not canonicalize {}: {}\", p.display(), err))\n-    });\n+    let prefix = builder.config.prefix.as_ref().unwrap_or(&prefix_default);\n     let sysconfdir = builder.config.sysconfdir.as_ref().unwrap_or(&sysconfdir_default);\n     let datadir = builder.config.datadir.as_ref().unwrap_or(&datadir_default);\n     let docdir = builder.config.docdir.as_ref().unwrap_or(&docdir_default);\n@@ -103,6 +98,13 @@ fn install_sh(\n     let libdir = add_destdir(&libdir, &destdir);\n     let mandir = add_destdir(&mandir, &destdir);\n \n+    let prefix = {\n+        fs::create_dir_all(&prefix)\n+            .unwrap_or_else(|err| panic!(\"could not create {}: {}\", prefix.display(), err));\n+        fs::canonicalize(&prefix)\n+            .unwrap_or_else(|err| panic!(\"could not canonicalize {}: {}\", prefix.display(), err))\n+    };\n+\n     let empty_dir = builder.out.join(\"tmp/empty_dir\");\n \n     t!(fs::create_dir_all(&empty_dir));"}]}