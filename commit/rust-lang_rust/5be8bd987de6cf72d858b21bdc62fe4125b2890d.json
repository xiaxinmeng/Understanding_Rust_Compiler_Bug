{"sha": "5be8bd987de6cf72d858b21bdc62fe4125b2890d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViZThiZDk4N2RlNmNmNzJkODU4YjIxYmRjNjJmZTQxMjViMjg5MGQ=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-07-15T19:25:03Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-07-15T19:25:20Z"}, "message": "Test some new capabilities we gained from a rustc update", "tree": {"sha": "c0e292b0682b8a86cede9107b5b898a24640543d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0e292b0682b8a86cede9107b5b898a24640543d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5be8bd987de6cf72d858b21bdc62fe4125b2890d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5be8bd987de6cf72d858b21bdc62fe4125b2890d", "html_url": "https://github.com/rust-lang/rust/commit/5be8bd987de6cf72d858b21bdc62fe4125b2890d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5be8bd987de6cf72d858b21bdc62fe4125b2890d/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fd6dad78f4b6d0babf0ae227221349388e80c405", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd6dad78f4b6d0babf0ae227221349388e80c405", "html_url": "https://github.com/rust-lang/rust/commit/fd6dad78f4b6d0babf0ae227221349388e80c405"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "207324cfcb00c323fc098fc6c15b0004a18eb75d", "filename": "src/operator.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5be8bd987de6cf72d858b21bdc62fe4125b2890d/src%2Foperator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5be8bd987de6cf72d858b21bdc62fe4125b2890d/src%2Foperator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Foperator.rs?ref=5be8bd987de6cf72d858b21bdc62fe4125b2890d", "patch": "@@ -34,6 +34,8 @@ impl<'a, 'mir, 'tcx> EvalContextExt<'tcx> for EvalContext<'a, 'mir, 'tcx, super:\n         right: Scalar,\n         right_ty: ty::Ty<'tcx>,\n     ) -> EvalResult<'tcx, Option<(Scalar, bool)>> {\n+        trace!(\"ptr_op: {:?} {:?} {:?}\", left, bin_op, right);\n+\n         use rustc::mir::BinOp::*;\n         use rustc::ty::layout::Integer::*;\n         let usize = Primitive::Int(match self.memory.pointer_size().bytes() {\n@@ -81,7 +83,9 @@ impl<'a, 'mir, 'tcx> EvalContextExt<'tcx> for EvalContext<'a, 'mir, 'tcx, super:\n                     (Scalar::Bits { .. }, Scalar::Bits { .. }) => {\n                         left.to_bits(left_layout.size)? == right.to_bits(right_layout.size)?\n                     },\n+                    // FIXME: Test if both allocations are still live *or* if they are in the same allocation? (same for Ne below)\n                     (Scalar::Ptr(left), Scalar::Ptr(right)) => left == right,\n+                    // FIXME: We should probably error out when comparing anything but NULL with a pointer (same for Ne below)\n                     _ => false,\n                 };\n                 Ok(Some((Scalar::from_bool(result), false)))"}, {"sha": "936ec73bcb8c0b23b3d5ffd39778851996755e79", "filename": "tests/run-pass/pointers.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5be8bd987de6cf72d858b21bdc62fe4125b2890d/tests%2Frun-pass%2Fpointers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5be8bd987de6cf72d858b21bdc62fe4125b2890d/tests%2Frun-pass%2Fpointers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fpointers.rs?ref=5be8bd987de6cf72d858b21bdc62fe4125b2890d", "patch": "@@ -57,4 +57,5 @@ fn main() {\n     assert_eq!(match_ref_mut(), 42);\n     // FIXME: improve this test... how?\n     assert!(dangling_pointer() != std::ptr::null());\n+    assert!(match dangling_pointer() as usize { 0 => false, _ => true });\n }"}]}