{"sha": "77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3ZjIzODFlZWEyY2E0ZGE2YzZkN2RjODEzMjJiZTU0MmUzZGJiODc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-03-04T11:24:02Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-03-04T12:31:18Z"}, "message": "improve error recovery\n\nparse the contents of error block as an expression", "tree": {"sha": "a6d825136ef86cef49f57d1cf358911d24735b21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6d825136ef86cef49f57d1cf358911d24735b21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "html_url": "https://github.com/rust-lang/rust/commit/77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3000b13df21fc8e9bbcaf91310d3eaaf21bc413e", "url": "https://api.github.com/repos/rust-lang/rust/commits/3000b13df21fc8e9bbcaf91310d3eaaf21bc413e", "html_url": "https://github.com/rust-lang/rust/commit/3000b13df21fc8e9bbcaf91310d3eaaf21bc413e"}], "stats": {"total": 136, "additions": 77, "deletions": 59}, "files": [{"sha": "f94702e9742a39e52d74a50b5aa4f30d14dcd16b", "filename": "crates/ra_parser/src/grammar.rs", "status": "modified", "additions": 7, "deletions": 17, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar.rs?ref=77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "patch": "@@ -182,21 +182,11 @@ fn name_ref(p: &mut Parser) {\n }\n \n fn error_block(p: &mut Parser, message: &str) {\n-    go(p, Some(message));\n-    fn go(p: &mut Parser, message: Option<&str>) {\n-        assert!(p.at(L_CURLY));\n-        let m = p.start();\n-        if let Some(message) = message {\n-            p.error(message);\n-        }\n-        p.bump();\n-        while !p.at(EOF) && !p.at(R_CURLY) {\n-            match p.current() {\n-                L_CURLY => go(p, None),\n-                _ => p.bump(),\n-            }\n-        }\n-        p.eat(R_CURLY);\n-        m.complete(p, ERROR);\n-    }\n+    assert!(p.at(L_CURLY));\n+    let m = p.start();\n+    p.error(message);\n+    p.bump();\n+    expressions::expr_block_contents(p);\n+    p.eat(R_CURLY);\n+    m.complete(p, ERROR);\n }"}, {"sha": "870c818ae671a588acaa681ee2b91c65d1149067", "filename": "crates/ra_syntax/tests/data/parser/err/0008_item_block_recovery.txt", "status": "modified", "additions": 30, "deletions": 23, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0008_item_block_recovery.txt", "raw_url": "https://github.com/rust-lang/rust/raw/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0008_item_block_recovery.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0008_item_block_recovery.txt?ref=77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "patch": "@@ -28,29 +28,36 @@ SOURCE_FILE@[0; 95)\n   ERROR@[20; 80)\n     L_CURLY@[20; 21)\n     WHITESPACE@[21; 26)\n-    IF_KW@[26; 28)\n-    WHITESPACE@[28; 29)\n-    TRUE_KW@[29; 33)\n-    WHITESPACE@[33; 34)\n-    ERROR@[34; 51)\n-      L_CURLY@[34; 35)\n-      WHITESPACE@[35; 44)\n-      INT_NUMBER@[44; 45) \"1\"\n-      WHITESPACE@[45; 50)\n-      R_CURLY@[50; 51)\n-    WHITESPACE@[51; 52)\n-    ELSE_KW@[52; 56)\n-    WHITESPACE@[56; 57)\n-    ERROR@[57; 78)\n-      L_CURLY@[57; 58)\n-      WHITESPACE@[58; 67)\n-      INT_NUMBER@[67; 68) \"2\"\n-      WHITESPACE@[68; 69)\n-      PLUS@[69; 70)\n-      WHITESPACE@[70; 71)\n-      INT_NUMBER@[71; 72) \"3\"\n-      WHITESPACE@[72; 77)\n-      R_CURLY@[77; 78)\n+    IF_EXPR@[26; 78)\n+      IF_KW@[26; 28)\n+      WHITESPACE@[28; 29)\n+      CONDITION@[29; 33)\n+        LITERAL@[29; 33)\n+          TRUE_KW@[29; 33)\n+      WHITESPACE@[33; 34)\n+      BLOCK@[34; 51)\n+        L_CURLY@[34; 35)\n+        WHITESPACE@[35; 44)\n+        LITERAL@[44; 45)\n+          INT_NUMBER@[44; 45) \"1\"\n+        WHITESPACE@[45; 50)\n+        R_CURLY@[50; 51)\n+      WHITESPACE@[51; 52)\n+      ELSE_KW@[52; 56)\n+      WHITESPACE@[56; 57)\n+      BLOCK@[57; 78)\n+        L_CURLY@[57; 58)\n+        WHITESPACE@[58; 67)\n+        BIN_EXPR@[67; 72)\n+          LITERAL@[67; 68)\n+            INT_NUMBER@[67; 68) \"2\"\n+          WHITESPACE@[68; 69)\n+          PLUS@[69; 70)\n+          WHITESPACE@[70; 71)\n+          LITERAL@[71; 72)\n+            INT_NUMBER@[71; 72) \"3\"\n+        WHITESPACE@[72; 77)\n+        R_CURLY@[77; 78)\n     WHITESPACE@[78; 79)\n     R_CURLY@[79; 80)\n   WHITESPACE@[80; 82)"}, {"sha": "26c5d395c26265093b7d7fcc6b019ca0ddcaf52e", "filename": "crates/ra_syntax/tests/data/parser/err/0009_broken_struct_type_parameter.txt", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0009_broken_struct_type_parameter.txt", "raw_url": "https://github.com/rust-lang/rust/raw/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0009_broken_struct_type_parameter.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0009_broken_struct_type_parameter.txt?ref=77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "patch": "@@ -28,10 +28,24 @@ SOURCE_FILE@[0; 43)\n   ERROR@[17; 31)\n     L_CURLY@[17; 18)\n     WHITESPACE@[18; 23)\n-    IDENT@[23; 24) \"f\"\n-    COLON@[24; 25)\n+    EXPR_STMT@[23; 24)\n+      PATH_EXPR@[23; 24)\n+        PATH@[23; 24)\n+          PATH_SEGMENT@[23; 24)\n+            NAME_REF@[23; 24)\n+              IDENT@[23; 24) \"f\"\n+              err: `expected SEMI`\n+              err: `expected expression`\n+    EXPR_STMT@[24; 25)\n+      ERROR@[24; 25)\n+        COLON@[24; 25)\n+        err: `expected SEMI`\n     WHITESPACE@[25; 26)\n-    IDENT@[26; 29) \"u32\"\n+    PATH_EXPR@[26; 29)\n+      PATH@[26; 29)\n+        PATH_SEGMENT@[26; 29)\n+          NAME_REF@[26; 29)\n+            IDENT@[26; 29) \"u32\"\n     WHITESPACE@[29; 30)\n     R_CURLY@[30; 31)\n   WHITESPACE@[31; 33)"}, {"sha": "181ccfa25edf7b9a541c59b3077c09be15583a47", "filename": "crates/ra_syntax/tests/data/parser/err/0028_macro_2.0.txt", "status": "modified", "additions": 23, "deletions": 16, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0028_macro_2.0.txt", "raw_url": "https://github.com/rust-lang/rust/raw/77f2381eea2ca4da6c6d7dc81322be542e3dbb87/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0028_macro_2.0.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Ferr%2F0028_macro_2.0.txt?ref=77f2381eea2ca4da6c6d7dc81322be542e3dbb87", "patch": "@@ -34,22 +34,29 @@ SOURCE_FILE@[0; 349)\n   ERROR@[42; 93)\n     L_CURLY@[42; 43)\n     WHITESPACE@[43; 48)\n-    IDENT@[48; 51) \"vec\"\n-    EXCL@[51; 52)\n-    L_BRACK@[52; 53)\n-    WHITESPACE@[53; 62)\n-    DOLLAR@[62; 63)\n-    L_PAREN@[63; 64)\n-    IDENT@[64; 78) \"parse_use_tree\"\n-    L_PAREN@[78; 79)\n-    DOLLAR@[79; 80)\n-    IDENT@[80; 81) \"s\"\n-    R_PAREN@[81; 82)\n-    COMMA@[82; 83)\n-    R_PAREN@[83; 84)\n-    STAR@[84; 85)\n-    WHITESPACE@[85; 90)\n-    R_BRACK@[90; 91)\n+    MACRO_CALL@[48; 91)\n+      PATH@[48; 51)\n+        PATH_SEGMENT@[48; 51)\n+          NAME_REF@[48; 51)\n+            IDENT@[48; 51) \"vec\"\n+      EXCL@[51; 52)\n+      TOKEN_TREE@[52; 91)\n+        L_BRACK@[52; 53)\n+        WHITESPACE@[53; 62)\n+        DOLLAR@[62; 63)\n+        TOKEN_TREE@[63; 84)\n+          L_PAREN@[63; 64)\n+          IDENT@[64; 78) \"parse_use_tree\"\n+          TOKEN_TREE@[78; 82)\n+            L_PAREN@[78; 79)\n+            DOLLAR@[79; 80)\n+            IDENT@[80; 81) \"s\"\n+            R_PAREN@[81; 82)\n+          COMMA@[82; 83)\n+          R_PAREN@[83; 84)\n+        STAR@[84; 85)\n+        WHITESPACE@[85; 90)\n+        R_BRACK@[90; 91)\n     WHITESPACE@[91; 92)\n     R_CURLY@[92; 93)\n   WHITESPACE@[93; 95)"}]}