{"sha": "40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "node_id": "C_kwDOAAsO6NoAKDQwZGNmODlhMjZiZGU0MTczNGY2YzNlYjcxZDllYjY0MjBlNDVlZjg", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-08-15T07:10:31Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-08-15T07:10:31Z"}, "message": "suggest adding a missing semicolon before an item", "tree": {"sha": "f86f103a9e63e36a013d6f8c5c2b7b90b7b417fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f86f103a9e63e36a013d6f8c5c2b7b90b7b417fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "html_url": "https://github.com/rust-lang/rust/commit/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0068b8bf4b150b506ef0871be4e8652fd4308f84", "url": "https://api.github.com/repos/rust-lang/rust/commits/0068b8bf4b150b506ef0871be4e8652fd4308f84", "html_url": "https://github.com/rust-lang/rust/commit/0068b8bf4b150b506ef0871be4e8652fd4308f84"}], "stats": {"total": 235, "additions": 233, "deletions": 2}, "files": [{"sha": "dd98946b4cc5e8833b77f64645702d26cde6f5a1", "filename": "compiler/rustc_ast/src/token.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/compiler%2Frustc_ast%2Fsrc%2Ftoken.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/compiler%2Frustc_ast%2Fsrc%2Ftoken.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Ftoken.rs?ref=40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "patch": "@@ -436,6 +436,30 @@ impl Token {\n             || self == &OpenDelim(Delimiter::Parenthesis)\n     }\n \n+    /// Returns `true` if the token can appear at the start of an item.\n+    pub fn can_begin_item(&self) -> bool {\n+        match self.kind {\n+            Ident(name, _) => [\n+                kw::Fn,\n+                kw::Use,\n+                kw::Struct,\n+                kw::Enum,\n+                kw::Pub,\n+                kw::Trait,\n+                kw::Extern,\n+                kw::Impl,\n+                kw::Unsafe,\n+                kw::Static,\n+                kw::Union,\n+                kw::Macro,\n+                kw::Mod,\n+                kw::Type,\n+            ]\n+            .contains(&name),\n+            _ => false,\n+        }\n+    }\n+\n     /// Returns `true` if the token is any literal.\n     pub fn is_lit(&self) -> bool {\n         matches!(self.kind, Literal(..))"}, {"sha": "d0fb768caa6872b477672c8a97b52bb7d5c91584", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "patch": "@@ -555,10 +555,12 @@ impl<'a> Parser<'a> {\n                 return Ok(true);\n             } else if self.look_ahead(0, |t| {\n                 t == &token::CloseDelim(Delimiter::Brace)\n-                    || (t.can_begin_expr() && t != &token::Semi && t != &token::Pound)\n+                    || ((t.can_begin_expr() || t.can_begin_item())\n+                        && t != &token::Semi\n+                        && t != &token::Pound)\n                     // Avoid triggering with too many trailing `#` in raw string.\n                     || (sm.is_multiline(\n-                        self.prev_token.span.shrink_to_hi().until(self.token.span.shrink_to_lo())\n+                        self.prev_token.span.shrink_to_hi().until(self.token.span.shrink_to_lo()),\n                     ) && t == &token::Pound)\n             }) && !expected.contains(&TokenType::Token(token::Comma))\n             {"}, {"sha": "0be17e69e8ff72fe0add93c5476b1cb0ed90e3a8", "filename": "src/test/ui/parser/recover-missing-semi-before-item.fixed", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.fixed?ref=40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "patch": "@@ -0,0 +1,61 @@\n+// run-rustfix\n+\n+#![allow(unused_variables, dead_code)]\n+\n+fn for_struct() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `struct`\n+    struct Foo;\n+}\n+\n+fn for_union() {\n+    let foo = 3; //~ ERROR expected `;`, found `union`\n+    union Foo {\n+        foo: usize,\n+    }\n+}\n+\n+fn for_enum() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `enum`\n+    enum Foo {\n+        Bar,\n+    }\n+}\n+\n+fn for_fn() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `fn`\n+    fn foo() {}\n+}\n+\n+fn for_extern() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `extern`\n+    extern fn foo() {}\n+}\n+\n+fn for_impl() {\n+    struct Foo;\n+    let foo = 3; //~ ERROR expected `;`, found keyword `impl`\n+    impl Foo {}\n+}\n+\n+fn for_use() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `pub`\n+    pub use bar::Bar;\n+}\n+\n+fn for_mod() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `mod`\n+    mod foo {}\n+}\n+\n+fn for_type() {\n+    let foo = 3; //~ ERROR expected `;`, found keyword `type`\n+    type Foo = usize;\n+}\n+\n+mod bar {\n+    pub struct Bar;\n+}\n+\n+const X: i32 = 123; //~ ERROR expected `;`, found keyword `fn`\n+\n+fn main() {}"}, {"sha": "867b7b749bb1f318a99cdeeb5b4df3f314dcc569", "filename": "src/test/ui/parser/recover-missing-semi-before-item.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.rs?ref=40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "patch": "@@ -0,0 +1,61 @@\n+// run-rustfix\n+\n+#![allow(unused_variables, dead_code)]\n+\n+fn for_struct() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `struct`\n+    struct Foo;\n+}\n+\n+fn for_union() {\n+    let foo = 3 //~ ERROR expected `;`, found `union`\n+    union Foo {\n+        foo: usize,\n+    }\n+}\n+\n+fn for_enum() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `enum`\n+    enum Foo {\n+        Bar,\n+    }\n+}\n+\n+fn for_fn() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `fn`\n+    fn foo() {}\n+}\n+\n+fn for_extern() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `extern`\n+    extern fn foo() {}\n+}\n+\n+fn for_impl() {\n+    struct Foo;\n+    let foo = 3 //~ ERROR expected `;`, found keyword `impl`\n+    impl Foo {}\n+}\n+\n+fn for_use() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `pub`\n+    pub use bar::Bar;\n+}\n+\n+fn for_mod() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `mod`\n+    mod foo {}\n+}\n+\n+fn for_type() {\n+    let foo = 3 //~ ERROR expected `;`, found keyword `type`\n+    type Foo = usize;\n+}\n+\n+mod bar {\n+    pub struct Bar;\n+}\n+\n+const X: i32 = 123 //~ ERROR expected `;`, found keyword `fn`\n+\n+fn main() {}"}, {"sha": "61c43f2f189989a2bf9a3ca99d32832da7fb0916", "filename": "src/test/ui/parser/recover-missing-semi-before-item.stderr", "status": "added", "additions": 83, "deletions": 0, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/40dcf89a26bde41734f6c3eb71d9eb6420e45ef8/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-missing-semi-before-item.stderr?ref=40dcf89a26bde41734f6c3eb71d9eb6420e45ef8", "patch": "@@ -0,0 +1,83 @@\n+error: expected `;`, found keyword `struct`\n+  --> $DIR/recover-missing-semi-before-item.rs:6:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     struct Foo;\n+   |     ------ unexpected token\n+\n+error: expected `;`, found `union`\n+  --> $DIR/recover-missing-semi-before-item.rs:11:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     union Foo {\n+   |     ----- unexpected token\n+\n+error: expected `;`, found keyword `enum`\n+  --> $DIR/recover-missing-semi-before-item.rs:18:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     enum Foo {\n+   |     ---- unexpected token\n+\n+error: expected `;`, found keyword `fn`\n+  --> $DIR/recover-missing-semi-before-item.rs:25:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     fn foo() {}\n+   |     -- unexpected token\n+\n+error: expected `;`, found keyword `extern`\n+  --> $DIR/recover-missing-semi-before-item.rs:30:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     extern fn foo() {}\n+   |     ------ unexpected token\n+\n+error: expected `;`, found keyword `impl`\n+  --> $DIR/recover-missing-semi-before-item.rs:36:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     impl Foo {}\n+   |     ---- unexpected token\n+\n+error: expected `;`, found keyword `pub`\n+  --> $DIR/recover-missing-semi-before-item.rs:41:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     pub use bar::Bar;\n+   |     --- unexpected token\n+\n+error: expected `;`, found keyword `mod`\n+  --> $DIR/recover-missing-semi-before-item.rs:46:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     mod foo {}\n+   |     --- unexpected token\n+\n+error: expected `;`, found keyword `type`\n+  --> $DIR/recover-missing-semi-before-item.rs:51:16\n+   |\n+LL |     let foo = 3\n+   |                ^ help: add `;` here\n+LL |     type Foo = usize;\n+   |     ---- unexpected token\n+\n+error: expected `;`, found keyword `fn`\n+  --> $DIR/recover-missing-semi-before-item.rs:59:19\n+   |\n+LL | const X: i32 = 123\n+   |                   ^ help: add `;` here\n+LL |\n+LL | fn main() {}\n+   | -- unexpected token\n+\n+error: aborting due to 10 previous errors\n+"}]}