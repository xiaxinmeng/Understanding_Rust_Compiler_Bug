{"sha": "d9daedd433c7e58e21f9edb693142af6d605d040", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5ZGFlZGQ0MzNjN2U1OGUyMWY5ZWRiNjkzMTQyYWY2ZDYwNWQwNDA=", "commit": {"author": {"name": "Stein Somers", "email": "git@steinsomers.be", "date": "2021-01-20T15:54:58Z"}, "committer": {"name": "Stein Somers", "email": "git@steinsomers.be", "date": "2021-02-21T18:06:46Z"}, "message": "BTreeMap: correct tests for alternative choices of B", "tree": {"sha": "0d914719cfa91965aa26ef1e094f1f98e360de57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d914719cfa91965aa26ef1e094f1f98e360de57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d9daedd433c7e58e21f9edb693142af6d605d040", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d9daedd433c7e58e21f9edb693142af6d605d040", "html_url": "https://github.com/rust-lang/rust/commit/d9daedd433c7e58e21f9edb693142af6d605d040", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d9daedd433c7e58e21f9edb693142af6d605d040/comments", "author": {"login": "ssomers", "id": 10174877, "node_id": "MDQ6VXNlcjEwMTc0ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/10174877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssomers", "html_url": "https://github.com/ssomers", "followers_url": "https://api.github.com/users/ssomers/followers", "following_url": "https://api.github.com/users/ssomers/following{/other_user}", "gists_url": "https://api.github.com/users/ssomers/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssomers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssomers/subscriptions", "organizations_url": "https://api.github.com/users/ssomers/orgs", "repos_url": "https://api.github.com/users/ssomers/repos", "events_url": "https://api.github.com/users/ssomers/events{/privacy}", "received_events_url": "https://api.github.com/users/ssomers/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ssomers", "id": 10174877, "node_id": "MDQ6VXNlcjEwMTc0ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/10174877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssomers", "html_url": "https://github.com/ssomers", "followers_url": "https://api.github.com/users/ssomers/followers", "following_url": "https://api.github.com/users/ssomers/following{/other_user}", "gists_url": "https://api.github.com/users/ssomers/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssomers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssomers/subscriptions", "organizations_url": "https://api.github.com/users/ssomers/orgs", "repos_url": "https://api.github.com/users/ssomers/repos", "events_url": "https://api.github.com/users/ssomers/events{/privacy}", "received_events_url": "https://api.github.com/users/ssomers/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e826bb11228508fbe749e594038d6727208aa94", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e826bb11228508fbe749e594038d6727208aa94", "html_url": "https://github.com/rust-lang/rust/commit/3e826bb11228508fbe749e594038d6727208aa94"}], "stats": {"total": 87, "additions": 6, "deletions": 81}, "files": [{"sha": "21a0fb844e8c4ebff14a42ccc8351d28487b99dc", "filename": "library/alloc/benches/btree/map.rs", "status": "modified", "additions": 0, "deletions": 76, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fbenches%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fbenches%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fbenches%2Fbtree%2Fmap.rs?ref=d9daedd433c7e58e21f9edb693142af6d605d040", "patch": "@@ -296,11 +296,6 @@ fn fat_val_map(n: usize) -> BTreeMap<usize, [usize; FAT]> {\n     (0..n).map(|i| (i, [i; FAT])).collect::<BTreeMap<_, _>>()\n }\n \n-// The returned map has large keys and values.\n-fn fat_map(n: usize) -> BTreeMap<[usize; FAT], [usize; FAT]> {\n-    (0..n).map(|i| ([i; FAT], [i; FAT])).collect::<BTreeMap<_, _>>()\n-}\n-\n #[bench]\n pub fn clone_slim_100(b: &mut Bencher) {\n     let src = slim_map(100);\n@@ -513,74 +508,3 @@ pub fn clone_fat_val_100_and_remove_half(b: &mut Bencher) {\n         map\n     })\n }\n-\n-#[bench]\n-pub fn clone_fat_100(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| src.clone())\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_clear(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| src.clone().clear())\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_drain_all(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| src.clone().drain_filter(|_, _| true).count())\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_drain_half(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| {\n-        let mut map = src.clone();\n-        assert_eq!(map.drain_filter(|i, _| i[0] % 2 == 0).count(), 100 / 2);\n-        assert_eq!(map.len(), 100 / 2);\n-    })\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_into_iter(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| src.clone().into_iter().count())\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_pop_all(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| {\n-        let mut map = src.clone();\n-        while map.pop_first().is_some() {}\n-        map\n-    });\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_remove_all(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| {\n-        let mut map = src.clone();\n-        while let Some(elt) = map.iter().map(|(&i, _)| i).next() {\n-            let v = map.remove(&elt);\n-            debug_assert!(v.is_some());\n-        }\n-        map\n-    });\n-}\n-\n-#[bench]\n-pub fn clone_fat_100_and_remove_half(b: &mut Bencher) {\n-    let src = fat_map(100);\n-    b.iter(|| {\n-        let mut map = src.clone();\n-        for i in (0..100).step_by(2) {\n-            let v = map.remove(&[i; FAT]);\n-            debug_assert!(v.is_some());\n-        }\n-        assert_eq!(map.len(), 100 / 2);\n-        map\n-    })\n-}"}, {"sha": "4e48db7f49305edba67cdd34d7823fa05ea5601a", "filename": "library/alloc/src/collections/btree/map/tests.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs?ref=d9daedd433c7e58e21f9edb693142af6d605d040", "patch": "@@ -136,8 +136,9 @@ impl<'a, K: 'a, V: 'a> NodeRef<marker::Immut<'a>, K, V, marker::LeafOrInternal>\n     }\n }\n \n-// Tests our value of MIN_INSERTS_HEIGHT_2. It may change according to the\n-// implementation of insertion, but it's best to be aware of when it does.\n+// Tests our value of MIN_INSERTS_HEIGHT_2. Failure may mean you just need to\n+// adapt that value to match a change in node::CAPACITY or the choices made\n+// during insertion, otherwise other test cases may fail or be less useful.\n #[test]\n fn test_levels() {\n     let mut map = BTreeMap::new();"}, {"sha": "6da93b19a8d8018199af0518b3a78f56880a2976", "filename": "library/alloc/src/collections/btree/node/tests.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fnode%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9daedd433c7e58e21f9edb693142af6d605d040/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fnode%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fnode%2Ftests.rs?ref=d9daedd433c7e58e21f9edb693142af6d605d040", "patch": "@@ -103,7 +103,7 @@ fn test_partial_cmp_eq() {\n #[cfg(target_arch = \"x86_64\")]\n fn test_sizes() {\n     assert_eq!(core::mem::size_of::<LeafNode<(), ()>>(), 16);\n-    assert_eq!(core::mem::size_of::<LeafNode<i64, i64>>(), 16 + CAPACITY * 8 * 2);\n-    assert_eq!(core::mem::size_of::<InternalNode<(), ()>>(), 112);\n-    assert_eq!(core::mem::size_of::<InternalNode<i64, i64>>(), 112 + CAPACITY * 8 * 2);\n+    assert_eq!(core::mem::size_of::<LeafNode<i64, i64>>(), 16 + CAPACITY * 2 * 8);\n+    assert_eq!(core::mem::size_of::<InternalNode<(), ()>>(), 16 + (CAPACITY + 1) * 8);\n+    assert_eq!(core::mem::size_of::<InternalNode<i64, i64>>(), 16 + (CAPACITY * 3 + 1) * 8);\n }"}]}