{"sha": "7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "node_id": "C_kwDOAAsO6NoAKDdjNzU0OGNkMzdhYWU4MjI5Y2RlMTVlOWEzMzQzOWFkNmZiYWI2ZTA", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2022-09-06T15:00:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-06T15:00:27Z"}, "message": "Rollup merge of #101445 - TaKO8Ki:suggest-introducing-explicit-lifetime, r=oli-obk\n\nSuggest introducing an explicit lifetime if it does not exist\n\nFixes #101027", "tree": {"sha": "29cc9daea6444e3e1956b40ecd0fc7fb0622c13c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29cc9daea6444e3e1956b40ecd0fc7fb0622c13c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjF2CLCRBK7hj4Ov3rIwAAR5YIAG1wi/6lEN66jpjgqk2z2McR\nwDEZKrP6NODg2PXjGmjGDlRyvLXX+bziZf99qSuBxup0zOa9MAlDil5MSpb8Wn9s\nVn4nouVfLjHhC9DyZ/0KffUgXRcBIQORZ0CxC0fs2r2acmh+qV57bAyqbq2lwNh1\nS7YbFA34lB46Q8jdsAReG956iibbX8gWAjeTH8FxvHMGaXWbr0fz7EtrTedIbOle\naLVLdSU8BtC8QGedDD5tZsMVqgal4RZkKdaie2JCPUCMm/GH1oCr8uTb0gByIoHT\nA8QYnj4CsVXG2oAfiSspj6YHRQUM/r6kUum5H7EHUjR5jrWNveWwD9Y1mbLleOE=\n=/ycZ\n-----END PGP SIGNATURE-----\n", "payload": "tree 29cc9daea6444e3e1956b40ecd0fc7fb0622c13c\nparent 4d830b777536ac41adc3d48b6d78ec267078f197\nparent 016626ab129f1ef25be66f12b0b66fcd1f093d60\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1662476427 +0200\ncommitter GitHub <noreply@github.com> 1662476427 +0200\n\nRollup merge of #101445 - TaKO8Ki:suggest-introducing-explicit-lifetime, r=oli-obk\n\nSuggest introducing an explicit lifetime if it does not exist\n\nFixes #101027\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "html_url": "https://github.com/rust-lang/rust/commit/7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d830b777536ac41adc3d48b6d78ec267078f197", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d830b777536ac41adc3d48b6d78ec267078f197", "html_url": "https://github.com/rust-lang/rust/commit/4d830b777536ac41adc3d48b6d78ec267078f197"}, {"sha": "016626ab129f1ef25be66f12b0b66fcd1f093d60", "url": "https://api.github.com/repos/rust-lang/rust/commits/016626ab129f1ef25be66f12b0b66fcd1f093d60", "html_url": "https://github.com/rust-lang/rust/commit/016626ab129f1ef25be66f12b0b66fcd1f093d60"}], "stats": {"total": 82, "additions": 63, "deletions": 19}, "files": [{"sha": "d9252d426d82b8ed0aebc06353f08c6eb60f3c04", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 19, "deletions": 9, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "patch": "@@ -2395,19 +2395,23 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n             type_param_span: Option<(Span, bool)>,\n             bound_kind: GenericKind<'tcx>,\n             sub: S,\n+            add_lt_sugg: Option<(Span, String)>,\n         ) {\n             let msg = \"consider adding an explicit lifetime bound\";\n             if let Some((sp, has_lifetimes)) = type_param_span {\n                 let suggestion =\n                     if has_lifetimes { format!(\" + {}\", sub) } else { format!(\": {}\", sub) };\n-                err.span_suggestion_verbose(\n-                    sp,\n-                    &format!(\"{}...\", msg),\n-                    suggestion,\n+                let mut suggestions = vec![(sp, suggestion)];\n+                if let Some(add_lt_sugg) = add_lt_sugg {\n+                    suggestions.push(add_lt_sugg);\n+                }\n+                err.multipart_suggestion_verbose(\n+                    format!(\"{msg}...\"),\n+                    suggestions,\n                     Applicability::MaybeIncorrect, // Issue #41966\n                 );\n             } else {\n-                let consider = format!(\"{} `{}: {}`...\", msg, bound_kind, sub,);\n+                let consider = format!(\"{} `{}: {}`...\", msg, bound_kind, sub);\n                 err.help(&consider);\n             }\n         }\n@@ -2423,7 +2427,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                     };\n                     let mut sugg =\n                         vec![(sp, suggestion), (span.shrink_to_hi(), format!(\" + {}\", new_lt))];\n-                    if let Some(lt) = add_lt_sugg {\n+                    if let Some(lt) = add_lt_sugg.clone() {\n                         sugg.push(lt);\n                         sugg.rotate_right(1);\n                     }\n@@ -2529,7 +2533,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                 // for the bound is not suitable for suggestions when `-Zverbose` is set because it\n                 // uses `Debug` output, so we handle it specially here so that suggestions are\n                 // always correct.\n-                binding_suggestion(&mut err, type_param_span, bound_kind, name);\n+                binding_suggestion(&mut err, type_param_span, bound_kind, name, None);\n                 err\n             }\n \n@@ -2542,7 +2546,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                     \"{} may not live long enough\",\n                     labeled_user_string\n                 );\n-                binding_suggestion(&mut err, type_param_span, bound_kind, \"'static\");\n+                binding_suggestion(&mut err, type_param_span, bound_kind, \"'static\", None);\n                 err\n             }\n \n@@ -2576,7 +2580,13 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                             new_binding_suggestion(&mut err, type_param_span);\n                         }\n                         _ => {\n-                            binding_suggestion(&mut err, type_param_span, bound_kind, new_lt);\n+                            binding_suggestion(\n+                                &mut err,\n+                                type_param_span,\n+                                bound_kind,\n+                                new_lt,\n+                                add_lt_sugg,\n+                            );\n                         }\n                     }\n                 }"}, {"sha": "645bc7db0ddac4644442f98b9d82e18e707a75e5", "filename": "src/test/ui/lifetimes/suggest-introducing-and-adding-missing-lifetime.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.rs?ref=7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "patch": "@@ -0,0 +1,9 @@\n+fn no_restriction<T>(x: &()) -> &() {\n+    with_restriction::<T>(x) //~ ERROR the parameter type `T` may not live long enough\n+}\n+\n+fn with_restriction<'b, T: 'b>(x: &'b ()) -> &'b () {\n+    x\n+}\n+\n+fn main() {}"}, {"sha": "a8b0996d8b0c71ad404e19ca4b5ff8dc64cd6e69", "filename": "src/test/ui/lifetimes/suggest-introducing-and-adding-missing-lifetime.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fsuggest-introducing-and-adding-missing-lifetime.stderr?ref=7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "patch": "@@ -0,0 +1,23 @@\n+error[E0311]: the parameter type `T` may not live long enough\n+  --> $DIR/suggest-introducing-and-adding-missing-lifetime.rs:2:5\n+   |\n+LL |     with_restriction::<T>(x)\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: the parameter type `T` must be valid for the anonymous lifetime defined here...\n+  --> $DIR/suggest-introducing-and-adding-missing-lifetime.rs:1:25\n+   |\n+LL | fn no_restriction<T>(x: &()) -> &() {\n+   |                         ^^^\n+note: ...so that the type `T` will meet its required lifetime bounds\n+  --> $DIR/suggest-introducing-and-adding-missing-lifetime.rs:2:5\n+   |\n+LL |     with_restriction::<T>(x)\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+help: consider adding an explicit lifetime bound...\n+   |\n+LL | fn no_restriction<'a, T: 'a>(x: &()) -> &() {\n+   |                   +++  ++++\n+\n+error: aborting due to previous error\n+"}, {"sha": "e5d2ead6ad67cd61d3d8614b923f9dfe8929409d", "filename": "src/test/ui/suggestions/lifetimes/missing-lifetimes-in-signature-2.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature-2.stderr?ref=7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "patch": "@@ -22,8 +22,8 @@ LL | |     });\n    | |______^\n help: consider adding an explicit lifetime bound...\n    |\n-LL | fn func<T: Test + 'a>(foo: &Foo, t: T) {\n-   |                 ++++\n+LL | fn func<'a, T: Test + 'a>(foo: &Foo, t: T) {\n+   |         +++         ++++\n \n error: aborting due to previous error\n "}, {"sha": "ed1b91676a2145ab7923a72c6e25a9956e0cf12b", "filename": "src/test/ui/suggestions/lifetimes/missing-lifetimes-in-signature.stderr", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7c7548cd37aae8229cde15e9a33439ad6fbab6e0/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Flifetimes%2Fmissing-lifetimes-in-signature.stderr?ref=7c7548cd37aae8229cde15e9a33439ad6fbab6e0", "patch": "@@ -47,8 +47,10 @@ LL | |     }\n    | |_____^\n help: consider adding an explicit lifetime bound...\n    |\n-LL |     G: Get<T> + 'a,\n-   |               ++++\n+LL ~ fn bar<'a, G, T>(g: G, dest: &mut T) -> impl FnOnce() + '_\n+LL | where\n+LL ~     G: Get<T> + 'a,\n+   |\n \n error[E0311]: the parameter type `G` may not live long enough\n   --> $DIR/missing-lifetimes-in-signature.rs:52:5\n@@ -74,8 +76,8 @@ LL | |     }\n    | |_____^\n help: consider adding an explicit lifetime bound...\n    |\n-LL | fn qux<'a, G: 'a + 'b, T>(g: G, dest: &mut T) -> impl FnOnce() + '_\n-   |                  ++++\n+LL | fn qux<'b, 'a, G: 'a + 'b, T>(g: G, dest: &mut T) -> impl FnOnce() + '_\n+   |        +++           ++++\n \n error[E0311]: the parameter type `G` may not live long enough\n   --> $DIR/missing-lifetimes-in-signature.rs:61:9\n@@ -101,8 +103,8 @@ LL | |         }\n    | |_________^\n help: consider adding an explicit lifetime bound...\n    |\n-LL |     fn qux<'b, G: Get<T> + 'b + 'c, T>(g: G, dest: &mut T) -> impl FnOnce() + '_ {\n-   |                               ++++\n+LL |     fn qux<'c, 'b, G: Get<T> + 'b + 'c, T>(g: G, dest: &mut T) -> impl FnOnce() + '_ {\n+   |            +++                    ++++\n \n error[E0311]: the parameter type `G` may not live long enough\n   --> $DIR/missing-lifetimes-in-signature.rs:73:5\n@@ -130,8 +132,8 @@ LL | |     }\n    | |_____^\n help: consider adding an explicit lifetime bound...\n    |\n-LL | fn bat<'a, G: 'a + 'b, T>(g: G, dest: &mut T) -> impl FnOnce() + '_ + 'a\n-   |                  ++++\n+LL | fn bat<'b, 'a, G: 'a + 'b, T>(g: G, dest: &mut T) -> impl FnOnce() + '_ + 'a\n+   |        +++           ++++\n \n error[E0621]: explicit lifetime required in the type of `dest`\n   --> $DIR/missing-lifetimes-in-signature.rs:73:5"}]}