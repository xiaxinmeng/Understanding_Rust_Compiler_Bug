{"sha": "af4631ad6e16679243a36487431afde477f7d552", "node_id": "C_kwDOAAsO6NoAKGFmNDYzMWFkNmUxNjY3OTI0M2EzNjQ4NzQzMWFmZGU0NzdmN2Q1NTI", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-06-13T12:40:12Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-06-13T15:16:48Z"}, "message": "Add a test for `-Zprint-vtable-sizes`", "tree": {"sha": "281dc4c467e481c2c829822c63c6ccd621a5641a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/281dc4c467e481c2c829822c63c6ccd621a5641a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af4631ad6e16679243a36487431afde477f7d552", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af4631ad6e16679243a36487431afde477f7d552", "html_url": "https://github.com/rust-lang/rust/commit/af4631ad6e16679243a36487431afde477f7d552", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af4631ad6e16679243a36487431afde477f7d552/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc0fba02383c6248b8a9dfc780c6448eac706a8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc0fba02383c6248b8a9dfc780c6448eac706a8f", "html_url": "https://github.com/rust-lang/rust/commit/dc0fba02383c6248b8a9dfc780c6448eac706a8f"}], "stats": {"total": 72, "additions": 72, "deletions": 0}, "files": [{"sha": "5656094990be6e06efc04d077cd1b37dd2d516c2", "filename": "tests/ui/traits/object/print_vtable_sizes.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/af4631ad6e16679243a36487431afde477f7d552/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af4631ad6e16679243a36487431afde477f7d552/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs?ref=af4631ad6e16679243a36487431afde477f7d552", "patch": "@@ -0,0 +1,61 @@\n+// check-pass\n+// compile-flags: -Z print-vtable-sizes\n+#![crate_type = \"lib\"]\n+\n+trait A<T: help::V>: AsRef<[T::V]> + AsMut<[T::V]> {}\n+\n+trait B<T>: AsRef<T> + AsRef<T> + AsRef<T> + AsRef<T> {}\n+\n+trait C {\n+    fn x() {} // not object safe, shouldn't be reported\n+}\n+\n+// This ideally should not have any upcasting cost,\n+// but currently does due to a bug\n+trait D: Send + Sync + help::MarkerWithSuper {}\n+\n+// This can't have no cost without reordering,\n+// because `Super::f`.\n+trait E: help::MarkerWithSuper + Send + Sync {}\n+\n+trait F {\n+    fn a(&self);\n+    fn b(&self);\n+    fn c(&self);\n+\n+    fn d() -> Self\n+    where\n+        Self: Sized;\n+}\n+\n+trait G: AsRef<u8> + AsRef<u16> + help::MarkerWithSuper {\n+    fn a(&self);\n+    fn b(&self);\n+    fn c(&self);\n+    fn d(&self);\n+    fn e(&self);\n+\n+    fn f() -> Self\n+    where\n+        Self: Sized;\n+}\n+\n+// Traits with the same name\n+const _: () = {\n+    trait S {}\n+};\n+const _: () = {\n+    trait S {}\n+};\n+\n+mod help {\n+    pub trait V {\n+        type V;\n+    }\n+\n+    pub trait MarkerWithSuper: Super {}\n+\n+    pub trait Super {\n+        fn f(&self);\n+    }\n+}"}, {"sha": "3ba650bc36045621d2ffc81a23c6cf80be784f33", "filename": "tests/ui/traits/object/print_vtable_sizes.stdout", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/af4631ad6e16679243a36487431afde477f7d552/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/af4631ad6e16679243a36487431afde477f7d552/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout?ref=af4631ad6e16679243a36487431afde477f7d552", "patch": "@@ -0,0 +1,11 @@\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"D\", \"entries\": \"7\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"3\", \"upcasting_cost_percent\": \"75\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"E\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"2\", \"upcasting_cost_percent\": \"50\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"G\", \"entries\": \"14\", \"entries_ignoring_upcasting\": \"11\", \"entries_for_upcasting\": \"3\", \"upcasting_cost_percent\": \"27.27272727272727\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"A\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"5\", \"entries_for_upcasting\": \"1\", \"upcasting_cost_percent\": \"20\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"B\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"F\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"6\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"_::S\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"_::S\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::MarkerWithSuper\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::Super\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::V\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }"}]}