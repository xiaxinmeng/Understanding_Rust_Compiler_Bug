{"sha": "5ba7852cf153688d5b5035a9a2a2145aa7334d79", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViYTc4NTJjZjE1MzY4OGQ1YjUwMzVhOWEyYTIxNDVhYTczMzRkNzk=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-03-14T19:46:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-14T19:46:49Z"}, "message": "Merge #8017\n\n8017: Don't drop type params in doc-test paths r=Veykril a=Veykril\n\nCloses #7995\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "c833cdbd534570e4d0a3d6a7532afcfbc3ab5d73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c833cdbd534570e4d0a3d6a7532afcfbc3ab5d73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ba7852cf153688d5b5035a9a2a2145aa7334d79", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgTmgpCRBK7hj4Ov3rIwAAdHIIAIhghn3xXS6J4El3+F0dcMXA\nCe7oFkGIhfitNR1K6MZCoIjE0NHpeXT6Lb26OirCzgaEUTr0ZiSoQWS4r1/mi9V0\nljCus8SgAToComoYeIx829wYkxEf8P3LUoI2IgN1357eZNO4VREeAE/6H762NIxN\nlntBZEJRdlS0unsr81ndNPEpUza5cKF3LFvO6aX15Ahl47y9F/XI638E9P+mHncb\n2KfbEQ8k4K5MBIEEgdvcHyjyyCROPdRA2FHkk3ttTx4oo7lPLwgtgqPkfj8P/6E1\nnhZQX4nmBhg4rZZl+LC0iSoGI/nVmuRdWz+rTFKw6a9bqLiFbmEiAHJ+dgaGDTw=\n=FD5i\n-----END PGP SIGNATURE-----\n", "payload": "tree c833cdbd534570e4d0a3d6a7532afcfbc3ab5d73\nparent af8440b84851febd805b6b774bfb326cbdb7175e\nparent f2610cbd7e4bfa4834d70cd92c5c4331c99a8ce0\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1615751209 +0000\ncommitter GitHub <noreply@github.com> 1615751209 +0000\n\nMerge #8017\n\n8017: Don't drop type params in doc-test paths r=Veykril a=Veykril\n\nCloses #7995\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ba7852cf153688d5b5035a9a2a2145aa7334d79", "html_url": "https://github.com/rust-lang/rust/commit/5ba7852cf153688d5b5035a9a2a2145aa7334d79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ba7852cf153688d5b5035a9a2a2145aa7334d79/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af8440b84851febd805b6b774bfb326cbdb7175e", "url": "https://api.github.com/repos/rust-lang/rust/commits/af8440b84851febd805b6b774bfb326cbdb7175e", "html_url": "https://github.com/rust-lang/rust/commit/af8440b84851febd805b6b774bfb326cbdb7175e"}, {"sha": "f2610cbd7e4bfa4834d70cd92c5c4331c99a8ce0", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2610cbd7e4bfa4834d70cd92c5c4331c99a8ce0", "html_url": "https://github.com/rust-lang/rust/commit/f2610cbd7e4bfa4834d70cd92c5c4331c99a8ce0"}], "stats": {"total": 55, "additions": 51, "deletions": 4}, "files": [{"sha": "27d35de5b6ec7e55dbf90a660920aafb36361cfe", "filename": "crates/ide/src/runnables.rs", "status": "modified", "additions": 51, "deletions": 4, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/5ba7852cf153688d5b5035a9a2a2145aa7334d79/crates%2Fide%2Fsrc%2Frunnables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ba7852cf153688d5b5035a9a2a2145aa7334d79/crates%2Fide%2Fsrc%2Frunnables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frunnables.rs?ref=5ba7852cf153688d5b5035a9a2a2145aa7334d79", "patch": "@@ -2,7 +2,7 @@ use std::fmt;\n \n use ast::NameOwner;\n use cfg::CfgExpr;\n-use hir::{AsAssocItem, HasAttrs, HasSource, Semantics};\n+use hir::{AsAssocItem, HasAttrs, HasSource, HirDisplay, Semantics};\n use ide_assists::utils::test_related_attribute;\n use ide_db::{\n     base_db::{FilePosition, FileRange},\n@@ -340,11 +340,21 @@ fn module_def_doctest(sema: &Semantics<RootDatabase>, def: hir::ModuleDef) -> Op\n             // FIXME: this also looks very wrong\n             if let Some(assoc_def) = assoc_def {\n                 if let hir::AssocItemContainer::Impl(imp) = assoc_def.container(sema.db) {\n-                    if let Some(adt) = imp.target_ty(sema.db).as_adt() {\n-                        let name = adt.name(sema.db).to_string();\n+                    let ty = imp.target_ty(sema.db);\n+                    if let Some(adt) = ty.as_adt() {\n+                        let name = adt.name(sema.db);\n                         let idx = path.rfind(':').map_or(0, |idx| idx + 1);\n                         let (prefix, suffix) = path.split_at(idx);\n-                        return format!(\"{}{}::{}\", prefix, name, suffix);\n+                        let mut ty_params = ty.type_parameters().peekable();\n+                        let params = if ty_params.peek().is_some() {\n+                            format!(\n+                                \"<{}>\",\n+                                ty_params.format_with(\", \", |ty, cb| cb(&ty.display(sema.db)))\n+                            )\n+                        } else {\n+                            String::new()\n+                        };\n+                        return format!(\"{}{}{}::{}\", prefix, name, params, suffix);\n                     }\n                 }\n             }\n@@ -1406,4 +1416,41 @@ mod tests {\n             \"#]],\n         );\n     }\n+\n+    #[test]\n+    fn doc_test_type_params() {\n+        check(\n+            r#\"\n+//- /lib.rs\n+$0\n+struct Foo<T, U>;\n+\n+impl<T, U> Foo<T, U> {\n+    /// ```rust\n+    /// ````\n+    fn t() {}\n+}\n+\"#,\n+            &[&DOCTEST],\n+            expect![[r#\"\n+                [\n+                    Runnable {\n+                        nav: NavigationTarget {\n+                            file_id: FileId(\n+                                0,\n+                            ),\n+                            full_range: 47..85,\n+                            name: \"t\",\n+                        },\n+                        kind: DocTest {\n+                            test_id: Path(\n+                                \"Foo<T, U>::t\",\n+                            ),\n+                        },\n+                        cfg: None,\n+                    },\n+                ]\n+            \"#]],\n+        );\n+    }\n }"}]}