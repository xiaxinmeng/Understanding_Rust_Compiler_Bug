{"sha": "811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxMWEyYjkxZGU4ZmUwYzZiYmQ4ZDQ5MTg2ZDBkNWJlMTkyZjY0NGU=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-10-22T00:33:36Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-10-26T17:55:16Z"}, "message": "Prohibit patterns in trait methods without bodies", "tree": {"sha": "8a61d61dca4b85375f6423bc0e67823dc1a8b650", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a61d61dca4b85375f6423bc0e67823dc1a8b650"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "html_url": "https://github.com/rust-lang/rust/commit/811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6b3b01b5f7f5a9d7d340dacf7dbf72be29e2c07", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6b3b01b5f7f5a9d7d340dacf7dbf72be29e2c07", "html_url": "https://github.com/rust-lang/rust/commit/a6b3b01b5f7f5a9d7d340dacf7dbf72be29e2c07"}], "stats": {"total": 64, "additions": 53, "deletions": 11}, "files": [{"sha": "94b455709856679a46bfe6f1bd1e4c07ce98b47b", "filename": "src/doc/reference.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Fdoc%2Freference.md", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Fdoc%2Freference.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Freference.md?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -4023,9 +4023,9 @@ Methods that take either `self` or `Box<Self>` can optionally place them in a\n mutable variable by prefixing them with `mut` (similar to regular arguments):\n \n ```\n-trait Changer {\n-    fn change(mut self) -> Self;\n-    fn modify(mut self: Box<Self>) -> Box<Self>;\n+trait Changer: Sized {\n+    fn change(mut self) {}\n+    fn modify(mut self: Box<Self>) {}\n }\n ```\n "}, {"sha": "d7ec544c95461aa20178ee11abf8b378a35258ad", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -192,6 +192,12 @@ declare_lint! {\n     \"safe access to extern statics was erroneously allowed\"\n }\n \n+declare_lint! {\n+    pub PATTERNS_IN_FNS_WITHOUT_BODY,\n+    Warn,\n+    \"patterns in functions without body were erroneously allowed\"\n+}\n+\n /// Does nothing as a lint pass, but registers some `Lint`s\n /// which are used by other parts of the compiler.\n #[derive(Copy, Clone)]\n@@ -228,7 +234,8 @@ impl LintPass for HardwiredLints {\n             SUPER_OR_SELF_IN_GLOBAL_PATH,\n             HR_LIFETIME_IN_ASSOC_TYPE,\n             LIFETIME_UNDERSCORE,\n-            SAFE_EXTERN_STATICS\n+            SAFE_EXTERN_STATICS,\n+            PATTERNS_IN_FNS_WITHOUT_BODY\n         )\n     }\n }"}, {"sha": "ef7bab8de8c233b4f7e680eb0854d3162d45135b", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -212,6 +212,10 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n             id: LintId::of(SAFE_EXTERN_STATICS),\n             reference: \"issue 36247 <https://github.com/rust-lang/rust/issues/35112>\",\n         },\n+        FutureIncompatibleInfo {\n+            id: LintId::of(PATTERNS_IN_FNS_WITHOUT_BODY),\n+            reference: \"issue #35203 <https://github.com/rust-lang/rust/issues/35203>\",\n+        },\n         ]);\n \n     // Register renamed and removed lints"}, {"sha": "828efbf373131d9e005e91177b88dce0c94ca075", "filename": "src/librustc_passes/ast_validation.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Flibrustc_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Fast_validation.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -190,8 +190,16 @@ impl<'a> Visitor for AstValidator<'a> {\n             }\n             ItemKind::Trait(.., ref trait_items) => {\n                 for trait_item in trait_items {\n-                    if let TraitItemKind::Method(ref sig, _) = trait_item.node {\n+                    if let TraitItemKind::Method(ref sig, ref block) = trait_item.node {\n                         self.check_trait_fn_not_const(sig.constness);\n+                        if block.is_none() {\n+                            self.check_decl_no_pat(&sig.decl, |span, _| {\n+                                self.session.add_lint(lint::builtin::PATTERNS_IN_FNS_WITHOUT_BODY,\n+                                                      trait_item.id, span,\n+                                                      \"patterns aren't allowed in methods \\\n+                                                       without bodies\".to_string());\n+                            });\n+                        }\n                     }\n                 }\n             }"}, {"sha": "385d012cadee65f58396390849972b540f9c79c3", "filename": "src/test/compile-fail/no-patterns-in-args-2.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Fcompile-fail%2Fno-patterns-in-args-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Fcompile-fail%2Fno-patterns-in-args-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fno-patterns-in-args-2.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![deny(patterns_in_fns_without_body)]\n+\n+trait Tr {\n+    fn f1(mut arg: u8); //~ ERROR patterns aren't allowed in methods without bodies\n+                        //~^ WARN was previously accepted\n+    fn f2(&arg: u8); //~ ERROR patterns aren't allowed in methods without bodies\n+                     //~^ WARN was previously accepted\n+    fn g1(arg: u8); // OK\n+    fn g2(_: u8); // OK\n+    fn g3(u8); // OK\n+}\n+\n+fn main() {}"}, {"sha": "391c2e75ba4d5770dbd81840130fe2708043ab5e", "filename": "src/test/incremental/hashes/trait_defs.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_defs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_defs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_defs.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -264,17 +264,17 @@ trait TraitChangeModeSelfRefToMut {\n \n \n #[cfg(cfail1)]\n-trait TraitChangeModeSelfOwnToMut {\n-    fn method(self);\n+trait TraitChangeModeSelfOwnToMut: Sized {\n+    fn method(self) {}\n }\n \n #[cfg(not(cfail1))]\n #[rustc_dirty(label=\"Hir\", cfg=\"cfail2\")]\n #[rustc_clean(label=\"Hir\", cfg=\"cfail3\")]\n #[rustc_metadata_dirty(cfg=\"cfail2\")]\n #[rustc_metadata_clean(cfg=\"cfail3\")]\n-trait TraitChangeModeSelfOwnToMut {\n-    fn method(mut self);\n+trait TraitChangeModeSelfOwnToMut: Sized {\n+    fn method(mut self) {}\n }\n \n "}, {"sha": "846b695c35b3d771ee9781cf5129f4b1e4a0996e", "filename": "src/test/run-pass/by-value-self-in-mut-slot.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Frun-pass%2Fby-value-self-in-mut-slot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Frun-pass%2Fby-value-self-in-mut-slot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fby-value-self-in-mut-slot.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -14,7 +14,7 @@ struct X {\n }\n \n trait Changer {\n-    fn change(mut self) -> Self;\n+    fn change(self) -> Self;\n }\n \n impl Changer for X {"}, {"sha": "7910380abeef0db7c0204893a694239c960067e3", "filename": "src/test/run-pass/uniq-self-in-mut-slot.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Frun-pass%2Funiq-self-in-mut-slot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/811a2b91de8fe0c6bbd8d49186d0d5be192f644e/src%2Ftest%2Frun-pass%2Funiq-self-in-mut-slot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Funiq-self-in-mut-slot.rs?ref=811a2b91de8fe0c6bbd8d49186d0d5be192f644e", "patch": "@@ -17,7 +17,7 @@ struct X {\n }\n \n trait Changer {\n-    fn change(mut self: Box<Self>) -> Box<Self>;\n+    fn change(self: Box<Self>) -> Box<Self>;\n }\n \n impl Changer for X {"}]}