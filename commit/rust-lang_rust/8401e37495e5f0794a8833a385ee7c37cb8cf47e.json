{"sha": "8401e37495e5f0794a8833a385ee7c37cb8cf47e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0MDFlMzc0OTVlNWYwNzk0YTg4MzNhMzg1ZWU3YzM3Y2I4Y2Y0N2U=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-09-15T19:42:26Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-09-30T21:02:53Z"}, "message": "Update bootstrap and compiletest to use the detected nodejs", "tree": {"sha": "32396cedb2c96d5557a1706fd49c9a5ef8f43909", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32396cedb2c96d5557a1706fd49c9a5ef8f43909"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8401e37495e5f0794a8833a385ee7c37cb8cf47e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8401e37495e5f0794a8833a385ee7c37cb8cf47e", "html_url": "https://github.com/rust-lang/rust/commit/8401e37495e5f0794a8833a385ee7c37cb8cf47e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8401e37495e5f0794a8833a385ee7c37cb8cf47e/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a4c328812997540c82f5039d346d0b30bc1feac4", "url": "https://api.github.com/repos/rust-lang/rust/commits/a4c328812997540c82f5039d346d0b30bc1feac4", "html_url": "https://github.com/rust-lang/rust/commit/a4c328812997540c82f5039d346d0b30bc1feac4"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "95c909aef773c111a729a29a8afcce2e0afd7b4f", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=8401e37495e5f0794a8833a385ee7c37cb8cf47e", "patch": "@@ -108,6 +108,10 @@ pub fn compiletest(build: &Build,\n     cmd.arg(\"--host\").arg(compiler.host);\n     cmd.arg(\"--llvm-filecheck\").arg(build.llvm_filecheck(&build.config.build));\n \n+    if let Some(nodejs) = build.config.nodejs.as_ref() {\n+        cmd.arg(\"--nodejs\").arg(nodejs);\n+    }\n+\n     let mut flags = vec![\"-Crpath\".to_string()];\n     if build.config.rust_optimize_tests {\n         flags.push(\"-O\".to_string());\n@@ -386,7 +390,8 @@ fn krate_emscripten(build: &Build,\n      for test in tests {\n          let test_file_name = test.to_string_lossy().into_owned();\n          println!(\"running {}\", test_file_name);\n-         let output = Command::new(\"node\")\n+         let nodejs = build.config.nodejs.as_ref().expect(\"nodejs not configured\");\n+         let output = Command::new(nodejs)\n              .arg(&test_file_name)\n              .stderr(::std::process::Stdio::inherit())\n              .output();"}, {"sha": "81cb927f26b0210d33ff07695a281f424ba70142", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=8401e37495e5f0794a8833a385ee7c37cb8cf47e", "patch": "@@ -183,4 +183,5 @@ pub struct Config {\n     pub cflags: String,\n     pub llvm_components: String,\n     pub llvm_cxxflags: String,\n+    pub nodejs: Option<String>,\n }"}, {"sha": "ff91ab7c70b3ee97a05f96c7e93e3033c3554b51", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=8401e37495e5f0794a8833a385ee7c37cb8cf47e", "patch": "@@ -109,6 +109,7 @@ pub fn parse_config(args: Vec<String> ) -> Config {\n           reqopt(\"\", \"cflags\", \"flags for the C compiler\", \"FLAGS\"),\n           reqopt(\"\", \"llvm-components\", \"list of LLVM components built in\", \"LIST\"),\n           reqopt(\"\", \"llvm-cxxflags\", \"C++ flags for LLVM\", \"FLAGS\"),\n+          optopt(\"\", \"nodejs\", \"the name of nodejs\", \"PATH\"),\n           optflag(\"h\", \"help\", \"show this message\"));\n \n     let (argv0, args_) = args.split_first().unwrap();\n@@ -190,6 +191,7 @@ pub fn parse_config(args: Vec<String> ) -> Config {\n         cflags: matches.opt_str(\"cflags\").unwrap(),\n         llvm_components: matches.opt_str(\"llvm-components\").unwrap(),\n         llvm_cxxflags: matches.opt_str(\"llvm-cxxflags\").unwrap(),\n+        nodejs: matches.opt_str(\"nodejs\"),\n     }\n }\n "}, {"sha": "35b93392baf2c4c96110e961a7a871f714394a01", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8401e37495e5f0794a8833a385ee7c37cb8cf47e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=8401e37495e5f0794a8833a385ee7c37cb8cf47e", "patch": "@@ -1439,7 +1439,8 @@ actual:\\n\\\n \n         // If this is emscripten, then run tests under nodejs\n         if self.config.target.contains(\"emscripten\") {\n-            args.push(\"node\".to_owned());\n+            let nodejs = self.config.nodejs.clone().unwrap_or(\"nodejs\".to_string());\n+            args.push(nodejs);\n         }\n \n         let exe_file = self.make_exe_name();"}]}