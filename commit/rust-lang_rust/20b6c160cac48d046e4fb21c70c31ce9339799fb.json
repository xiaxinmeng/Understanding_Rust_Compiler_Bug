{"sha": "20b6c160cac48d046e4fb21c70c31ce9339799fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwYjZjMTYwY2FjNDhkMDQ2ZTRmYjIxYzcwYzMxY2U5MzM5Nzk5ZmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-25T18:13:54Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-25T18:13:54Z"}, "message": "Auto merge of #38539 - jseyfried:fix_resolve_hang, r=eddyb\n\nresolve: fix non-termination\n\nFixes #34324.\nr? @eddyb", "tree": {"sha": "4fe5ae53401836742b5eb4fa614e663a1e126db0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4fe5ae53401836742b5eb4fa614e663a1e126db0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20b6c160cac48d046e4fb21c70c31ce9339799fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20b6c160cac48d046e4fb21c70c31ce9339799fb", "html_url": "https://github.com/rust-lang/rust/commit/20b6c160cac48d046e4fb21c70c31ce9339799fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20b6c160cac48d046e4fb21c70c31ce9339799fb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c74ac6cb97ae77429258c3bff2938714f6a329ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/c74ac6cb97ae77429258c3bff2938714f6a329ca", "html_url": "https://github.com/rust-lang/rust/commit/c74ac6cb97ae77429258c3bff2938714f6a329ca"}, {"sha": "098c9b69e113c1894fad39acbadd63a3aaca458c", "url": "https://api.github.com/repos/rust-lang/rust/commits/098c9b69e113c1894fad39acbadd63a3aaca458c", "html_url": "https://github.com/rust-lang/rust/commit/098c9b69e113c1894fad39acbadd63a3aaca458c"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "8575b04b5314a0a250f7acf10fff7206d737f28e", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/20b6c160cac48d046e4fb21c70c31ce9339799fb/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20b6c160cac48d046e4fb21c70c31ce9339799fb/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=20b6c160cac48d046e4fb21c70c31ce9339799fb", "patch": "@@ -2931,6 +2931,7 @@ impl<'a> Resolver<'a> {\n \n         let mut lookup_results = Vec::new();\n         let mut worklist = Vec::new();\n+        let mut seen_modules = FxHashSet();\n         worklist.push((self.graph_root, Vec::new(), false));\n \n         while let Some((in_module,\n@@ -2976,7 +2977,7 @@ impl<'a> Resolver<'a> {\n                     if !in_module_is_extern || name_binding.vis == ty::Visibility::Public {\n                         // add the module to the lookup\n                         let is_extern = in_module_is_extern || name_binding.is_extern_crate();\n-                        if !worklist.iter().any(|&(m, ..)| m.def() == module.def()) {\n+                        if seen_modules.insert(module.def_id().unwrap()) {\n                             worklist.push((module, path_segments, is_extern));\n                         }\n                     }"}, {"sha": "aa444d45eeb7a1dbb56eb8ef38371cad49abfef2", "filename": "src/test/compile-fail/recursive-reexports.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/20b6c160cac48d046e4fb21c70c31ce9339799fb/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20b6c160cac48d046e4fb21c70c31ce9339799fb/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs?ref=20b6c160cac48d046e4fb21c70c31ce9339799fb", "patch": "@@ -10,6 +10,8 @@\n \n // aux-build:recursive_reexports.rs\n \n-fn f() -> recursive_reexports::S {} //~ ERROR undeclared\n+extern crate recursive_reexports;\n+\n+fn f() -> recursive_reexports::S {} //~ ERROR type name `recursive_reexports::S` is undefined\n \n fn main() {}"}]}