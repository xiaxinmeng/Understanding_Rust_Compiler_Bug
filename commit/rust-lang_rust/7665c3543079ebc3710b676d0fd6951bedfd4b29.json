{"sha": "7665c3543079ebc3710b676d0fd6951bedfd4b29", "node_id": "C_kwDOAAsO6NoAKDc2NjVjMzU0MzA3OWViYzM3MTBiNjc2ZDBmZDY5NTFiZWRmZDRiMjk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-06T20:09:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-06T20:09:41Z"}, "message": "Auto merge of #98987 - GuillaumeGomez:rollup-bcy32bp, r=GuillaumeGomez\n\nRollup of 7 pull requests\n\nSuccessful merges:\n\n - #96935 (Allow arithmetic and certain bitwise ops on AtomicPtr)\n - #98519 (Replace some `guess_head_span` with `def_span`)\n - #98911 (rustdoc: filter '_ lifetimes from ty::Generics)\n - #98939 (rustdoc: Add more semantic information to impl IDs)\n - #98971 (Fix typo in file descriptor docs)\n - #98983 (docs: Add overview of `rustc_middle::mir::TerminatorKind`)\n - #98984 (Remove erroneous doc comment)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "8b2d7045da77ded78485d03d8e09078e9f2e43f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b2d7045da77ded78485d03d8e09078e9f2e43f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7665c3543079ebc3710b676d0fd6951bedfd4b29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7665c3543079ebc3710b676d0fd6951bedfd4b29", "html_url": "https://github.com/rust-lang/rust/commit/7665c3543079ebc3710b676d0fd6951bedfd4b29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7665c3543079ebc3710b676d0fd6951bedfd4b29/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3dcb616888aac50d55160b025266d555dad937d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dcb616888aac50d55160b025266d555dad937d9", "html_url": "https://github.com/rust-lang/rust/commit/3dcb616888aac50d55160b025266d555dad937d9"}, {"sha": "4b88cba353708c5437a711e932d5de617d9af272", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b88cba353708c5437a711e932d5de617d9af272", "html_url": "https://github.com/rust-lang/rust/commit/4b88cba353708c5437a711e932d5de617d9af272"}], "stats": {"total": 1042, "additions": 701, "deletions": 341}, "files": [{"sha": "6fea6941085ce1daa457cdc9ed8e976338855b64", "filename": "compiler/rustc_borrowck/src/diagnostics/mod.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -812,12 +812,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n             return FnSelfUse {\n                 var_span: stmt.source_info.span,\n                 fn_call_span: *fn_span,\n-                fn_span: self\n-                    .infcx\n-                    .tcx\n-                    .sess\n-                    .source_map()\n-                    .guess_head_span(self.infcx.tcx.def_span(method_did)),\n+                fn_span: self.infcx.tcx.def_span(method_did),\n                 kind,\n             };\n         }"}, {"sha": "645afae30d88729b518c338f656330a0670f84bd", "filename": "compiler/rustc_codegen_ssa/src/mir/intrinsic.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fintrinsic.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -513,9 +513,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                         };\n \n                         let ty = substs.type_at(0);\n-                        if int_type_width_signed(ty, bx.tcx()).is_some()\n-                            || (ty.is_unsafe_ptr() && op == \"xchg\")\n-                        {\n+                        if int_type_width_signed(ty, bx.tcx()).is_some() || ty.is_unsafe_ptr() {\n                             let mut ptr = args[0].immediate();\n                             let mut val = args[1].immediate();\n                             if ty.is_unsafe_ptr() {"}, {"sha": "9574661282ba1b2bb5a9f57dd4ff351ab416559a", "filename": "compiler/rustc_const_eval/src/transform/check_consts/ops.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -155,8 +155,7 @@ impl<'tcx> NonConstOp<'tcx> for FnCallNonConst<'tcx> {\n                     });\n \n                     if let Ok(Some(ImplSource::UserDefined(data))) = implsrc {\n-                        let span =\n-                            tcx.sess.source_map().guess_head_span(tcx.def_span(data.impl_def_id));\n+                        let span = tcx.def_span(data.impl_def_id);\n                         err.span_note(span, \"impl defined here, but it is not `const`\");\n                     }\n                 }\n@@ -205,7 +204,7 @@ impl<'tcx> NonConstOp<'tcx> for FnCallNonConst<'tcx> {\n \n                 match self_ty.kind() {\n                     FnDef(def_id, ..) => {\n-                        let span = tcx.sess.source_map().guess_head_span(tcx.def_span(*def_id));\n+                        let span = tcx.def_span(*def_id);\n                         if ccx.tcx.is_const_fn_raw(*def_id) {\n                             span_bug!(span, \"calling const FnDef errored when it shouldn't\");\n                         }"}, {"sha": "05556f7d0f9564740dd498a3ff1bc014e2623e11", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -148,12 +148,10 @@ fn msg_span_from_early_bound_and_free_regions<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     region: ty::Region<'tcx>,\n ) -> (String, Span) {\n-    let sm = tcx.sess.source_map();\n-\n     let scope = region.free_region_binding_scope(tcx).expect_local();\n     match *region {\n         ty::ReEarlyBound(ref br) => {\n-            let mut sp = sm.guess_head_span(tcx.def_span(scope));\n+            let mut sp = tcx.def_span(scope);\n             if let Some(param) =\n                 tcx.hir().get_generics(scope).and_then(|generics| generics.get_named(br.name))\n             {\n@@ -174,7 +172,7 @@ fn msg_span_from_early_bound_and_free_regions<'tcx>(\n             } else {\n                 match fr.bound_region {\n                     ty::BoundRegionKind::BrNamed(_, name) => {\n-                        let mut sp = sm.guess_head_span(tcx.def_span(scope));\n+                        let mut sp = tcx.def_span(scope);\n                         if let Some(param) =\n                             tcx.hir().get_generics(scope).and_then(|generics| generics.get_named(name))\n                         {\n@@ -193,7 +191,7 @@ fn msg_span_from_early_bound_and_free_regions<'tcx>(\n                     ),\n                     _ => (\n                         format!(\"the lifetime `{}` as defined here\", region),\n-                        sm.guess_head_span(tcx.def_span(scope)),\n+                        tcx.def_span(scope),\n                     ),\n                 }\n             }"}, {"sha": "7e42458fda3d00f79fd23bf4e6b9e598e99aaf29", "filename": "compiler/rustc_infer/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -23,10 +23,12 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n \n         let mut err = struct_span_err!(self.tcx.sess, sp, E0276, \"{}\", msg);\n \n-        if let Some(trait_item_span) = self.tcx.hir().span_if_local(trait_item_def_id) {\n-            let span = self.tcx.sess.source_map().guess_head_span(trait_item_span);\n+        if trait_item_def_id.is_local() {\n             let item_name = self.tcx.item_name(impl_item_def_id.to_def_id());\n-            err.span_label(span, format!(\"definition of `{}` from trait\", item_name));\n+            err.span_label(\n+                self.tcx.def_span(trait_item_def_id),\n+                format!(\"definition of `{}` from trait\", item_name),\n+            );\n         }\n \n         err.span_label(sp, format!(\"impl has extra requirement {}\", requirement));"}, {"sha": "a0472f98d7204e1dab2d618c2c9c45418dfd32e9", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 13, "deletions": 24, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -552,7 +552,6 @@ impl MissingDoc {\n         &self,\n         cx: &LateContext<'_>,\n         def_id: LocalDefId,\n-        sp: Span,\n         article: &'static str,\n         desc: &'static str,\n     ) {\n@@ -579,16 +578,12 @@ impl MissingDoc {\n         let attrs = cx.tcx.hir().attrs(cx.tcx.hir().local_def_id_to_hir_id(def_id));\n         let has_doc = attrs.iter().any(has_doc);\n         if !has_doc {\n-            cx.struct_span_lint(\n-                MISSING_DOCS,\n-                cx.tcx.sess.source_map().guess_head_span(sp),\n-                |lint| {\n-                    lint.build(fluent::lint::builtin_missing_doc)\n-                        .set_arg(\"article\", article)\n-                        .set_arg(\"desc\", desc)\n-                        .emit();\n-                },\n-            );\n+            cx.struct_span_lint(MISSING_DOCS, cx.tcx.def_span(def_id), |lint| {\n+                lint.build(fluent::lint::builtin_missing_doc)\n+                    .set_arg(\"article\", article)\n+                    .set_arg(\"desc\", desc)\n+                    .emit();\n+            });\n         }\n     }\n }\n@@ -611,13 +606,7 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n     }\n \n     fn check_crate(&mut self, cx: &LateContext<'_>) {\n-        self.check_missing_docs_attrs(\n-            cx,\n-            CRATE_DEF_ID,\n-            cx.tcx.def_span(CRATE_DEF_ID),\n-            \"the\",\n-            \"crate\",\n-        );\n+        self.check_missing_docs_attrs(cx, CRATE_DEF_ID, \"the\", \"crate\");\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'_>, it: &hir::Item<'_>) {\n@@ -647,13 +636,13 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n \n         let (article, desc) = cx.tcx.article_and_description(it.def_id.to_def_id());\n \n-        self.check_missing_docs_attrs(cx, it.def_id, it.span, article, desc);\n+        self.check_missing_docs_attrs(cx, it.def_id, article, desc);\n     }\n \n     fn check_trait_item(&mut self, cx: &LateContext<'_>, trait_item: &hir::TraitItem<'_>) {\n         let (article, desc) = cx.tcx.article_and_description(trait_item.def_id.to_def_id());\n \n-        self.check_missing_docs_attrs(cx, trait_item.def_id, trait_item.span, article, desc);\n+        self.check_missing_docs_attrs(cx, trait_item.def_id, article, desc);\n     }\n \n     fn check_impl_item(&mut self, cx: &LateContext<'_>, impl_item: &hir::ImplItem<'_>) {\n@@ -681,23 +670,23 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n         }\n \n         let (article, desc) = cx.tcx.article_and_description(impl_item.def_id.to_def_id());\n-        self.check_missing_docs_attrs(cx, impl_item.def_id, impl_item.span, article, desc);\n+        self.check_missing_docs_attrs(cx, impl_item.def_id, article, desc);\n     }\n \n     fn check_foreign_item(&mut self, cx: &LateContext<'_>, foreign_item: &hir::ForeignItem<'_>) {\n         let (article, desc) = cx.tcx.article_and_description(foreign_item.def_id.to_def_id());\n-        self.check_missing_docs_attrs(cx, foreign_item.def_id, foreign_item.span, article, desc);\n+        self.check_missing_docs_attrs(cx, foreign_item.def_id, article, desc);\n     }\n \n     fn check_field_def(&mut self, cx: &LateContext<'_>, sf: &hir::FieldDef<'_>) {\n         if !sf.is_positional() {\n             let def_id = cx.tcx.hir().local_def_id(sf.hir_id);\n-            self.check_missing_docs_attrs(cx, def_id, sf.span, \"a\", \"struct field\")\n+            self.check_missing_docs_attrs(cx, def_id, \"a\", \"struct field\")\n         }\n     }\n \n     fn check_variant(&mut self, cx: &LateContext<'_>, v: &hir::Variant<'_>) {\n-        self.check_missing_docs_attrs(cx, cx.tcx.hir().local_def_id(v.id), v.span, \"a\", \"variant\");\n+        self.check_missing_docs_attrs(cx, cx.tcx.hir().local_def_id(v.id), \"a\", \"variant\");\n     }\n }\n "}, {"sha": "cda0a60fa4e1c0c5ea82f22ceabe3b12a7882465", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1013,12 +1013,13 @@ impl<'hir> Map<'hir> {\n                 ItemKind::Use(path, _) => path.span,\n                 _ => named_span(item.span, item.ident, item.kind.generics()),\n             },\n+            Node::Variant(variant) => named_span(variant.span, variant.ident, None),\n             Node::ImplItem(item) => named_span(item.span, item.ident, Some(item.generics)),\n             Node::ForeignItem(item) => match item.kind {\n                 ForeignItemKind::Fn(decl, _, _) => until_within(item.span, decl.output.span()),\n                 _ => named_span(item.span, item.ident, None),\n             },\n-            Node::Ctor(..) => return self.opt_span(self.get_parent_node(hir_id)),\n+            Node::Ctor(_) => return self.opt_span(self.get_parent_node(hir_id)),\n             _ => self.span_with_body(hir_id),\n         };\n         Some(span)"}, {"sha": "dcc37c565c9b6f8d04a9b080625ee525e811eccc", "filename": "compiler/rustc_middle/src/mir/syntax.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -396,6 +396,8 @@ pub struct CopyNonOverlapping<'tcx> {\n ///////////////////////////////////////////////////////////////////////////\n // Terminators\n \n+/// The various kinds of terminators, representing ways of exiting from a basic block.\n+///\n /// A note on unwinding: Panics may occur during the execution of some terminators. Depending on the\n /// `-C panic` flag, this may either cause the program to abort or the call stack to unwind. Such\n /// terminators have a `cleanup: Option<BasicBlock>` field on them. If stack unwinding occurs, then\n@@ -911,7 +913,7 @@ pub enum Operand<'tcx> {\n static_assert_size!(Operand<'_>, 24);\n \n ///////////////////////////////////////////////////////////////////////////\n-/// Rvalues\n+// Rvalues\n \n /// The various kinds of rvalues that can appear in MIR.\n ///"}, {"sha": "49a518b101dd156415c9a559624c41d15b767d25", "filename": "compiler/rustc_middle/src/ty/error.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -795,7 +795,7 @@ fn foo(&self) -> Self::T { String::new() }\n                         if item_def_id == proj_ty_item_def_id =>\n                     {\n                         Some((\n-                            self.sess.source_map().guess_head_span(self.def_span(item.def_id)),\n+                            self.def_span(item.def_id),\n                             format!(\"consider calling `{}`\", self.def_path_str(item.def_id)),\n                         ))\n                     }"}, {"sha": "8efefd476abc9b661a622533514e5f18b4663309", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 6, "deletions": 14, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1112,18 +1112,12 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     })\n                     .collect::<Option<Vec<ArgKind>>>()?,\n             ),\n-            Node::Item(&hir::Item { span, kind: hir::ItemKind::Fn(ref sig, ..), .. })\n-            | Node::ImplItem(&hir::ImplItem {\n-                span,\n-                kind: hir::ImplItemKind::Fn(ref sig, _),\n-                ..\n-            })\n+            Node::Item(&hir::Item { kind: hir::ItemKind::Fn(ref sig, ..), .. })\n+            | Node::ImplItem(&hir::ImplItem { kind: hir::ImplItemKind::Fn(ref sig, _), .. })\n             | Node::TraitItem(&hir::TraitItem {\n-                span,\n-                kind: hir::TraitItemKind::Fn(ref sig, _),\n-                ..\n+                kind: hir::TraitItemKind::Fn(ref sig, _), ..\n             }) => (\n-                sm.guess_head_span(span),\n+                sig.span,\n                 sig.decl\n                     .inputs\n                     .iter()\n@@ -1138,7 +1132,6 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n             ),\n             Node::Ctor(ref variant_data) => {\n                 let span = variant_data.ctor_hir_id().map_or(DUMMY_SP, |id| hir.span(id));\n-                let span = sm.guess_head_span(span);\n                 (span, vec![ArgKind::empty(); variant_data.fields().len()])\n             }\n             _ => panic!(\"non-FnLike node found: {:?}\", node),\n@@ -2185,7 +2178,7 @@ impl<'a, 'tcx> InferCtxtPrivExt<'a, 'tcx> for InferCtxt<'a, 'tcx> {\n         let mut post = vec![];\n         for def_id in impls {\n             match self.tcx.span_of_impl(*def_id) {\n-                Ok(span) => spans.push(self.tcx.sess.source_map().guess_head_span(span)),\n+                Ok(span) => spans.push(span),\n                 Err(name) => {\n                     crates.push(name);\n                     if let Some(header) = to_pretty_impl_header(self.tcx, *def_id) {\n@@ -2532,8 +2525,7 @@ pub fn recursive_type_with_infinite_size_error<'tcx>(\n     spans: Vec<(Span, Option<hir::HirId>)>,\n ) {\n     assert!(type_def_id.is_local());\n-    let span = tcx.hir().span_if_local(type_def_id).unwrap();\n-    let span = tcx.sess.source_map().guess_head_span(span);\n+    let span = tcx.def_span(type_def_id);\n     let path = tcx.def_path_str(type_def_id);\n     let mut err =\n         struct_span_err!(tcx.sess, span, E0072, \"recursive type `{}` has infinite size\", path);"}, {"sha": "a80354897d6182a7b942a8d862af9c25fe79f767", "filename": "compiler/rustc_trait_selection/src/traits/specialize/mod.rs", "status": "modified", "additions": 5, "deletions": 18, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -340,10 +340,7 @@ fn report_negative_positive_conflict(\n     positive_impl_def_id: DefId,\n     sg: &mut specialization_graph::Graph,\n ) {\n-    let impl_span = tcx\n-        .sess\n-        .source_map()\n-        .guess_head_span(tcx.span_of_impl(local_impl_def_id.to_def_id()).unwrap());\n+    let impl_span = tcx.def_span(local_impl_def_id);\n \n     let mut err = struct_span_err!(\n         tcx.sess,\n@@ -356,10 +353,7 @@ fn report_negative_positive_conflict(\n \n     match tcx.span_of_impl(negative_impl_def_id) {\n         Ok(span) => {\n-            err.span_label(\n-                tcx.sess.source_map().guess_head_span(span),\n-                \"negative implementation here\".to_string(),\n-            );\n+            err.span_label(span, \"negative implementation here\");\n         }\n         Err(cname) => {\n             err.note(&format!(\"negative implementation in crate `{}`\", cname));\n@@ -368,10 +362,7 @@ fn report_negative_positive_conflict(\n \n     match tcx.span_of_impl(positive_impl_def_id) {\n         Ok(span) => {\n-            err.span_label(\n-                tcx.sess.source_map().guess_head_span(span),\n-                \"positive implementation here\".to_string(),\n-            );\n+            err.span_label(span, \"positive implementation here\");\n         }\n         Err(cname) => {\n             err.note(&format!(\"positive implementation in crate `{}`\", cname));\n@@ -388,8 +379,7 @@ fn report_conflicting_impls(\n     used_to_be_allowed: Option<FutureCompatOverlapErrorKind>,\n     sg: &mut specialization_graph::Graph,\n ) {\n-    let impl_span =\n-        tcx.sess.source_map().guess_head_span(tcx.span_of_impl(impl_def_id.to_def_id()).unwrap());\n+    let impl_span = tcx.def_span(impl_def_id);\n \n     // Work to be done after we've built the DiagnosticBuilder. We have to define it\n     // now because the struct_lint methods don't return back the DiagnosticBuilder\n@@ -416,10 +406,7 @@ fn report_conflicting_impls(\n         let mut err = err.build(&msg);\n         match tcx.span_of_impl(overlap.with_impl) {\n             Ok(span) => {\n-                err.span_label(\n-                    tcx.sess.source_map().guess_head_span(span),\n-                    \"first implementation here\".to_string(),\n-                );\n+                err.span_label(span, \"first implementation here\".to_string());\n \n                 err.span_label(\n                     impl_span,"}, {"sha": "0a2b54eec47cd00c705972b2352230146d06994c", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1958,9 +1958,11 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                         );\n                     }\n \n-                    if let Some(sp) = tcx.hir().span_if_local(adt_def.did()) {\n-                        let sp = tcx.sess.source_map().guess_head_span(sp);\n-                        err.span_label(sp, format!(\"variant `{}` not found here\", assoc_ident));\n+                    if adt_def.did().is_local() {\n+                        err.span_label(\n+                            tcx.def_span(adt_def.did()),\n+                            format!(\"variant `{assoc_ident}` not found for this enum\"),\n+                        );\n                     }\n \n                     err.emit()\n@@ -2450,7 +2452,6 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n \n                     let msg = format!(\"`Self` is of type `{ty}`\");\n                     if let (Ok(i_sp), Some(t_sp)) = (span_of_impl, span_of_ty) {\n-                        let i_sp = tcx.sess.source_map().guess_head_span(i_sp);\n                         let mut span: MultiSpan = vec![t_sp].into();\n                         span.push_span_label(\n                             i_sp,"}, {"sha": "e9709b64d930e15d0d488764f5ee98fd8de50fdb", "filename": "compiler/rustc_typeck/src/check/check.rs", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -288,11 +288,9 @@ fn check_panic_info_fn(\n         tcx.sess.span_err(decl.output.span(), \"return type should be `!`\");\n     }\n \n-    let span = tcx.def_span(fn_id);\n     let inputs = fn_sig.inputs();\n     if inputs.len() != 1 {\n-        let span = tcx.sess.source_map().guess_head_span(span);\n-        tcx.sess.span_err(span, \"function should have one argument\");\n+        tcx.sess.span_err(tcx.def_span(fn_id), \"function should have one argument\");\n         return;\n     }\n \n@@ -345,9 +343,7 @@ fn check_alloc_error_fn(\n \n     let inputs = fn_sig.inputs();\n     if inputs.len() != 1 {\n-        let span = tcx.def_span(fn_id);\n-        let span = tcx.sess.source_map().guess_head_span(span);\n-        tcx.sess.span_err(span, \"function should have one argument\");\n+        tcx.sess.span_err(tcx.def_span(fn_id), \"function should have one argument\");\n         return;\n     }\n \n@@ -1034,7 +1030,6 @@ fn check_impl_items_against_trait<'tcx>(\n                 compare_impl_method(\n                     tcx,\n                     &ty_impl_item,\n-                    impl_item.span,\n                     &ty_trait_item,\n                     impl_trait_ref,\n                     opt_trait_span,\n@@ -1094,17 +1089,20 @@ fn check_impl_items_against_trait<'tcx>(\n         }\n \n         if !missing_items.is_empty() {\n-            let impl_span = tcx.sess.source_map().guess_head_span(full_impl_span);\n-            missing_items_err(tcx, impl_span, &missing_items, full_impl_span);\n+            missing_items_err(tcx, tcx.def_span(impl_id), &missing_items, full_impl_span);\n         }\n \n         if let Some(missing_items) = must_implement_one_of {\n-            let impl_span = tcx.sess.source_map().guess_head_span(full_impl_span);\n             let attr_span = tcx\n                 .get_attr(impl_trait_ref.def_id, sym::rustc_must_implement_one_of)\n                 .map(|attr| attr.span);\n \n-            missing_items_must_implement_one_of_err(tcx, impl_span, missing_items, attr_span);\n+            missing_items_must_implement_one_of_err(\n+                tcx,\n+                tcx.def_span(impl_id),\n+                missing_items,\n+                attr_span,\n+            );\n         }\n     }\n }"}, {"sha": "2bfb9343877a45fc4ee50736bea213c5eaf19d16", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -33,14 +33,13 @@ use super::{potentially_plural_count, FnCtxt, Inherited};\n pub(crate) fn compare_impl_method<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     impl_m: &ty::AssocItem,\n-    impl_m_span: Span,\n     trait_m: &ty::AssocItem,\n     impl_trait_ref: ty::TraitRef<'tcx>,\n     trait_item_span: Option<Span>,\n ) {\n     debug!(\"compare_impl_method(impl_trait_ref={:?})\", impl_trait_ref);\n \n-    let impl_m_span = tcx.sess.source_map().guess_head_span(impl_m_span);\n+    let impl_m_span = tcx.def_span(impl_m.def_id);\n \n     if let Err(_) = compare_self_type(tcx, impl_m, impl_m_span, trait_m, impl_trait_ref) {\n         return;\n@@ -444,13 +443,9 @@ fn check_region_bounds_on_impl_item<'tcx>(\n             .as_local()\n             .and_then(|did| tcx.hir().get_generics(did))\n             .map_or(def_span, |g| g.span);\n-        let generics_span = tcx.hir().span_if_local(trait_m.def_id).map(|sp| {\n-            let def_sp = tcx.sess.source_map().guess_head_span(sp);\n-            trait_m\n-                .def_id\n-                .as_local()\n-                .and_then(|did| tcx.hir().get_generics(did))\n-                .map_or(def_sp, |g| g.span)\n+        let generics_span = trait_m.def_id.as_local().map(|did| {\n+            let def_sp = tcx.def_span(did);\n+            tcx.hir().get_generics(did).map_or(def_sp, |g| g.span)\n         });\n \n         let reported = tcx.sess.emit_err(LifetimesOrBoundsMismatchOnTrait {\n@@ -1044,8 +1039,7 @@ fn compare_generic_param_kinds<'tcx>(\n             err.span_label(trait_header_span, \"\");\n             err.span_label(param_trait_span, make_param_message(\"expected\", param_trait));\n \n-            let impl_header_span =\n-                tcx.sess.source_map().guess_head_span(tcx.def_span(tcx.parent(impl_item.def_id)));\n+            let impl_header_span = tcx.def_span(tcx.parent(impl_item.def_id));\n             err.span_label(impl_header_span, \"\");\n             err.span_label(param_impl_span, make_param_message(\"found\", param_impl));\n "}, {"sha": "edb0ec027a0facb45bfbd91a38ba826ca76f6340", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/suggestions.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -184,9 +184,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         } else if let (ty::FnDef(def_id, ..), true) =\n             (&found.kind(), self.suggest_fn_call(err, expr, expected, found))\n         {\n-            if let Some(sp) = self.tcx.hir().span_if_local(*def_id) {\n-                let sp = self.sess().source_map().guess_head_span(sp);\n-                err.span_label(sp, &format!(\"{} defined here\", found));\n+            if def_id.is_local() {\n+                err.span_label(self.tcx.def_span(def_id), &format!(\"{} defined here\", found));\n             }\n         } else if !self.check_for_cast(err, expr, found, expected, expected_ty_expr) {\n             let is_struct_pat_shorthand_field ="}, {"sha": "4e1a105fc71cc0a308e91f07f3e84eac146e2532", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 23, "deletions": 29, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -121,11 +121,14 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         }) else {\n                             continue;\n                         };\n-                        let note_span = self\n-                            .tcx\n-                            .hir()\n-                            .span_if_local(item.def_id)\n-                            .or_else(|| self.tcx.hir().span_if_local(impl_did));\n+\n+                        let note_span = if item.def_id.is_local() {\n+                            Some(self.tcx.def_span(item.def_id))\n+                        } else if impl_did.is_local() {\n+                            Some(self.tcx.def_span(impl_did))\n+                        } else {\n+                            None\n+                        };\n \n                         let impl_ty = self.tcx.at(span).type_of(impl_did);\n \n@@ -158,10 +161,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         };\n                         if let Some(note_span) = note_span {\n                             // We have a span pointing to the method. Show note with snippet.\n-                            err.span_note(\n-                                self.tcx.sess.source_map().guess_head_span(note_span),\n-                                &note_str,\n-                            );\n+                            err.span_note(note_span, &note_str);\n                         } else {\n                             err.note(&note_str);\n                         }\n@@ -197,11 +197,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     }\n                     CandidateSource::Trait(trait_did) => {\n                         let Some(item) = self.associated_value(trait_did, item_name) else { continue };\n-                        let item_span = self\n-                            .tcx\n-                            .sess\n-                            .source_map()\n-                            .guess_head_span(self.tcx.def_span(item.def_id));\n+                        let item_span = self.tcx.def_span(item.def_id);\n                         let idx = if sources.len() > 1 {\n                             let msg = &format!(\n                                 \"candidate #{} is defined in the trait `{}`\",\n@@ -471,9 +467,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         err.note(&format!(\"`count` is defined on `{iterator_trait}`, which `{actual}` does not implement\"));\n                     }\n                 } else if !unsatisfied_predicates.is_empty() {\n-                    let def_span = |def_id| {\n-                        self.tcx.sess.source_map().guess_head_span(self.tcx.def_span(def_id))\n-                    };\n                     let mut type_params = FxHashMap::default();\n \n                     // Pick out the list of unimplemented traits on the receiver.\n@@ -564,22 +557,25 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         );\n                         match &self_ty.kind() {\n                             // Point at the type that couldn't satisfy the bound.\n-                            ty::Adt(def, _) => bound_spans.push((def_span(def.did()), msg)),\n+                            ty::Adt(def, _) => {\n+                                bound_spans.push((self.tcx.def_span(def.did()), msg))\n+                            }\n                             // Point at the trait object that couldn't satisfy the bound.\n                             ty::Dynamic(preds, _) => {\n                                 for pred in preds.iter() {\n                                     match pred.skip_binder() {\n-                                        ty::ExistentialPredicate::Trait(tr) => {\n-                                            bound_spans.push((def_span(tr.def_id), msg.clone()))\n-                                        }\n+                                        ty::ExistentialPredicate::Trait(tr) => bound_spans\n+                                            .push((self.tcx.def_span(tr.def_id), msg.clone())),\n                                         ty::ExistentialPredicate::Projection(_)\n                                         | ty::ExistentialPredicate::AutoTrait(_) => {}\n                                     }\n                                 }\n                             }\n                             // Point at the closure that couldn't satisfy the bound.\n-                            ty::Closure(def_id, _) => bound_spans\n-                                .push((def_span(*def_id), format!(\"doesn't satisfy `{}`\", quiet))),\n+                            ty::Closure(def_id, _) => bound_spans.push((\n+                                tcx.def_span(*def_id),\n+                                format!(\"doesn't satisfy `{}`\", quiet),\n+                            )),\n                             _ => {}\n                         }\n                     };\n@@ -1469,21 +1465,20 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 _ => None,\n             })\n             .collect::<FxHashSet<_>>();\n-        let sm = self.tcx.sess.source_map();\n         let mut spans: MultiSpan = def_ids\n             .iter()\n             .filter_map(|def_id| {\n                 let span = self.tcx.def_span(*def_id);\n-                if span.is_dummy() { None } else { Some(sm.guess_head_span(span)) }\n+                if span.is_dummy() { None } else { Some(span) }\n             })\n             .collect::<Vec<_>>()\n             .into();\n \n         for pred in &preds {\n             match pred.self_ty().kind() {\n-                ty::Adt(def, _) => {\n+                ty::Adt(def, _) if def.did().is_local() => {\n                     spans.push_span_label(\n-                        sm.guess_head_span(self.tcx.def_span(def.did())),\n+                        self.tcx.def_span(def.did()),\n                         format!(\"must implement `{}`\", pred.trait_ref.print_only_trait_path()),\n                     );\n                 }\n@@ -2090,9 +2085,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             match &potential_candidates[..] {\n                 [] => {}\n                 [trait_info] if trait_info.def_id.is_local() => {\n-                    let span = self.tcx.hir().span_if_local(trait_info.def_id).unwrap();\n                     err.span_note(\n-                        self.tcx.sess.source_map().guess_head_span(span),\n+                        self.tcx.def_span(trait_info.def_id),\n                         &format!(\n                             \"`{}` defines an item `{}`, perhaps you need to {} it\",\n                             self.tcx.def_path_str(trait_info.def_id),"}, {"sha": "ae9ebe590914455b372b8326b43aaa4b3f414153", "filename": "compiler/rustc_typeck/src/coherence/mod.rs", "status": "modified", "additions": 18, "deletions": 23, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -9,7 +9,6 @@ use rustc_errors::struct_span_err;\n use rustc_hir::def_id::{DefId, LocalDefId};\n use rustc_middle::ty::query::Providers;\n use rustc_middle::ty::{self, TyCtxt, TypeVisitable};\n-use rustc_span::Span;\n use rustc_trait_selection::traits;\n \n mod builtin;\n@@ -18,11 +17,6 @@ mod inherent_impls_overlap;\n mod orphan;\n mod unsafety;\n \n-/// Obtains the span of just the impl header of `impl_def_id`.\n-fn impl_header_span(tcx: TyCtxt<'_>, impl_def_id: LocalDefId) -> Span {\n-    tcx.sess.source_map().guess_head_span(tcx.span_of_impl(impl_def_id.to_def_id()).unwrap())\n-}\n-\n fn check_impl(tcx: TyCtxt<'_>, impl_def_id: LocalDefId, trait_ref: ty::TraitRef<'_>) {\n     debug!(\n         \"(checking implementation) adding impl for trait '{:?}', item '{}'\",\n@@ -47,56 +41,53 @@ fn enforce_trait_manually_implementable(\n ) {\n     let did = Some(trait_def_id);\n     let li = tcx.lang_items();\n+    let impl_header_span = tcx.def_span(impl_def_id);\n \n     // Disallow *all* explicit impls of `Pointee`, `DiscriminantKind`, `Sized` and `Unsize` for now.\n     if did == li.pointee_trait() {\n-        let span = impl_header_span(tcx, impl_def_id);\n         struct_span_err!(\n             tcx.sess,\n-            span,\n+            impl_header_span,\n             E0322,\n             \"explicit impls for the `Pointee` trait are not permitted\"\n         )\n-        .span_label(span, \"impl of `Pointee` not allowed\")\n+        .span_label(impl_header_span, \"impl of `Pointee` not allowed\")\n         .emit();\n         return;\n     }\n \n     if did == li.discriminant_kind_trait() {\n-        let span = impl_header_span(tcx, impl_def_id);\n         struct_span_err!(\n             tcx.sess,\n-            span,\n+            impl_header_span,\n             E0322,\n             \"explicit impls for the `DiscriminantKind` trait are not permitted\"\n         )\n-        .span_label(span, \"impl of `DiscriminantKind` not allowed\")\n+        .span_label(impl_header_span, \"impl of `DiscriminantKind` not allowed\")\n         .emit();\n         return;\n     }\n \n     if did == li.sized_trait() {\n-        let span = impl_header_span(tcx, impl_def_id);\n         struct_span_err!(\n             tcx.sess,\n-            span,\n+            impl_header_span,\n             E0322,\n             \"explicit impls for the `Sized` trait are not permitted\"\n         )\n-        .span_label(span, \"impl of `Sized` not allowed\")\n+        .span_label(impl_header_span, \"impl of `Sized` not allowed\")\n         .emit();\n         return;\n     }\n \n     if did == li.unsize_trait() {\n-        let span = impl_header_span(tcx, impl_def_id);\n         struct_span_err!(\n             tcx.sess,\n-            span,\n+            impl_header_span,\n             E0328,\n             \"explicit impls for the `Unsize` trait are not permitted\"\n         )\n-        .span_label(span, \"impl of `Unsize` not allowed\")\n+        .span_label(impl_header_span, \"impl of `Unsize` not allowed\")\n         .emit();\n         return;\n     }\n@@ -110,10 +101,9 @@ fn enforce_trait_manually_implementable(\n         tcx.trait_def(trait_def_id).specialization_kind\n     {\n         if !tcx.features().specialization && !tcx.features().min_specialization {\n-            let span = impl_header_span(tcx, impl_def_id);\n             tcx.sess\n                 .struct_span_err(\n-                    span,\n+                    impl_header_span,\n                     \"implementing `rustc_specialization_trait` traits is unstable\",\n                 )\n                 .help(\"add `#![feature(min_specialization)]` to the crate attributes to enable\")\n@@ -138,8 +128,13 @@ fn enforce_empty_impls_for_marker_traits(\n         return;\n     }\n \n-    let span = impl_header_span(tcx, impl_def_id);\n-    struct_span_err!(tcx.sess, span, E0715, \"impls for marker traits cannot contain items\").emit();\n+    struct_span_err!(\n+        tcx.sess,\n+        tcx.def_span(impl_def_id),\n+        E0715,\n+        \"impls for marker traits cannot contain items\"\n+    )\n+    .emit();\n }\n \n pub fn provide(providers: &mut Providers) {\n@@ -217,7 +212,7 @@ fn check_object_overlap<'tcx>(\n             } else {\n                 let mut supertrait_def_ids = traits::supertrait_def_ids(tcx, component_def_id);\n                 if supertrait_def_ids.any(|d| d == trait_def_id) {\n-                    let span = impl_header_span(tcx, impl_def_id);\n+                    let span = tcx.def_span(impl_def_id);\n                     struct_span_err!(\n                         tcx.sess,\n                         span,"}, {"sha": "697ef7bc022370bec4590c4172af3bd971d797d5", "filename": "compiler/rustc_typeck/src/coherence/orphan.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -47,7 +47,7 @@ fn do_orphan_check_impl<'tcx>(\n     let hir::ItemKind::Impl(ref impl_) = item.kind else {\n         bug!(\"{:?} is not an impl: {:?}\", def_id, item);\n     };\n-    let sp = tcx.sess.source_map().guess_head_span(item.span);\n+    let sp = tcx.def_span(def_id);\n     let tr = impl_.of_trait.as_ref().unwrap();\n \n     // Ensure no opaque types are present in this impl header. See issues #76202 and #86411 for examples,"}, {"sha": "08c194ec0b605f1a8e24933474f1300d49e573c0", "filename": "compiler/rustc_typeck/src/lib.rs", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/compiler%2Frustc_typeck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Flib.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -223,15 +223,7 @@ fn check_main_fn_ty(tcx: TyCtxt<'_>, main_def_id: DefId) {\n         if !def_id.is_local() {\n             return None;\n         }\n-        let hir_id = tcx.hir().local_def_id_to_hir_id(def_id.expect_local());\n-        match tcx.hir().find(hir_id) {\n-            Some(Node::Item(hir::Item { span: item_span, .. })) => {\n-                Some(tcx.sess.source_map().guess_head_span(*item_span))\n-            }\n-            _ => {\n-                span_bug!(tcx.def_span(def_id), \"main has a non-function type\");\n-            }\n-        }\n+        Some(tcx.def_span(def_id))\n     }\n \n     fn main_fn_return_type_span(tcx: TyCtxt<'_>, def_id: DefId) -> Option<Span> {\n@@ -416,7 +408,7 @@ fn check_start_fn_ty(tcx: TyCtxt<'_>, start_def_id: DefId) {\n                         error = true;\n                     }\n                     if let hir::IsAsync::Async = sig.header.asyncness {\n-                        let span = tcx.sess.source_map().guess_head_span(it.span);\n+                        let span = tcx.def_span(it.def_id);\n                         struct_span_err!(\n                             tcx.sess,\n                             span,"}, {"sha": "7c5f82f5ea49df6c1ddba8fbb2c9cc4542e29500", "filename": "library/core/src/char/convert.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fchar%2Fconvert.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fchar%2Fconvert.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fchar%2Fconvert.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -93,7 +93,7 @@ impl const From<char> for u128 {\n /// Map `char` with code point in U+0000..=U+00FF to byte in 0x00..=0xFF with same value, failing\n /// if the code point is greater than U+00FF.\n ///\n-/// See [`impl From<u8> for char`](char#impl-From<u8>) for details on the encoding.\n+/// See [`impl From<u8> for char`](char#impl-From<u8>-for-char) for details on the encoding.\n #[stable(feature = \"u8_from_char\", since = \"1.59.0\")]\n impl TryFrom<char> for u8 {\n     type Error = TryFromCharError;\n@@ -229,7 +229,7 @@ impl TryFrom<u32> for char {\n \n /// The error type returned when a conversion from [`prim@u32`] to [`prim@char`] fails.\n ///\n-/// This `struct` is created by the [`char::try_from<u32>`](char#impl-TryFrom<u32>) method.\n+/// This `struct` is created by the [`char::try_from<u32>`](char#impl-TryFrom<u32>-for-char) method.\n /// See its documentation for more.\n #[stable(feature = \"try_from\", since = \"1.34.0\")]\n #[derive(Copy, Clone, Debug, PartialEq, Eq)]"}, {"sha": "cf428e0b1cf1d729e5d8b4a1f3d10b3ce23a465a", "filename": "library/core/src/hash/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fhash%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fhash%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fhash%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -180,7 +180,7 @@ mod sip;\n /// [`HashMap`]: ../../std/collections/struct.HashMap.html\n /// [`HashSet`]: ../../std/collections/struct.HashSet.html\n /// [`hash`]: Hash::hash\n-/// [impl]: ../../std/primitive.str.html#impl-Hash\n+/// [impl]: ../../std/primitive.str.html#impl-Hash-for-str\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[rustc_diagnostic_item = \"Hash\"]\n pub trait Hash {"}, {"sha": "bca73cb770fbb3bab29968d931af0918124d79ef", "filename": "library/core/src/option.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Foption.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Foption.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Foption.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -389,7 +389,7 @@\n //! [`Option`] of a collection of each contained value of the original\n //! [`Option`] values, or [`None`] if any of the elements was [`None`].\n //!\n-//! [impl-FromIterator]: Option#impl-FromIterator%3COption%3CA%3E%3E\n+//! [impl-FromIterator]: Option#impl-FromIterator%3COption%3CA%3E%3E-for-Option%3CV%3E\n //!\n //! ```\n //! let v = [Some(2), Some(4), None, Some(8)];\n@@ -405,8 +405,8 @@\n //! to provide the [`product`][Iterator::product] and\n //! [`sum`][Iterator::sum] methods.\n //!\n-//! [impl-Product]: Option#impl-Product%3COption%3CU%3E%3E\n-//! [impl-Sum]: Option#impl-Sum%3COption%3CU%3E%3E\n+//! [impl-Product]: Option#impl-Product%3COption%3CU%3E%3E-for-Option%3CT%3E\n+//! [impl-Sum]: Option#impl-Sum%3COption%3CU%3E%3E-for-Option%3CT%3E\n //!\n //! ```\n //! let v = [None, Some(1), Some(2), Some(3)];"}, {"sha": "8a68cdf7d651bb430109f2261673be6d84402d66", "filename": "library/core/src/result.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fresult.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fresult.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fresult.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -459,7 +459,7 @@\n //! [`Result`] of a collection of each contained value of the original\n //! [`Result`] values, or [`Err`] if any of the elements was [`Err`].\n //!\n-//! [impl-FromIterator]: Result#impl-FromIterator%3CResult%3CA%2C%20E%3E%3E\n+//! [impl-FromIterator]: Result#impl-FromIterator%3CResult%3CA%2C%20E%3E%3E-for-Result%3CV%2C%20E%3E\n //!\n //! ```\n //! let v = [Ok(2), Ok(4), Err(\"err!\"), Ok(8)];\n@@ -475,8 +475,8 @@\n //! to provide the [`product`][Iterator::product] and\n //! [`sum`][Iterator::sum] methods.\n //!\n-//! [impl-Product]: Result#impl-Product%3CResult%3CU%2C%20E%3E%3E\n-//! [impl-Sum]: Result#impl-Sum%3CResult%3CU%2C%20E%3E%3E\n+//! [impl-Product]: Result#impl-Product%3CResult%3CU%2C%20E%3E%3E-for-Result%3CT%2C%20E%3E\n+//! [impl-Sum]: Result#impl-Sum%3CResult%3CU%2C%20E%3E%3E-for-Result%3CT%2C%20E%3E\n //!\n //! ```\n //! let v = [Err(\"error!\"), Ok(1), Ok(2), Ok(3), Err(\"foo\")];"}, {"sha": "bf8ce6971b87e12bc1477cf3bb6251b0834ae5ad", "filename": "library/core/src/sync/atomic.rs", "status": "modified", "additions": 341, "deletions": 0, "changes": 341, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1451,6 +1451,347 @@ impl<T> AtomicPtr<T> {\n         }\n         Err(prev)\n     }\n+\n+    /// Offsets the pointer's address by adding `val` (in units of `T`),\n+    /// returning the previous pointer.\n+    ///\n+    /// This is equivalent to using [`wrapping_add`] to atomically perform the\n+    /// equivalent of `ptr = ptr.wrapping_add(val);`.\n+    ///\n+    /// This method operates in units of `T`, which means that it cannot be used\n+    /// to offset the pointer by an amount which is not a multiple of\n+    /// `size_of::<T>()`. This can sometimes be inconvenient, as you may want to\n+    /// work with a deliberately misaligned pointer. In such cases, you may use\n+    /// the [`fetch_byte_add`](Self::fetch_byte_add) method instead.\n+    ///\n+    /// `fetch_ptr_add` takes an [`Ordering`] argument which describes the\n+    /// memory ordering of this operation. All ordering modes are possible. Note\n+    /// that using [`Acquire`] makes the store part of this operation\n+    /// [`Relaxed`], and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// [`wrapping_add`]: pointer::wrapping_add\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let atom = AtomicPtr::<i64>::new(core::ptr::null_mut());\n+    /// assert_eq!(atom.fetch_ptr_add(1, Ordering::Relaxed).addr(), 0);\n+    /// // Note: units of `size_of::<i64>()`.\n+    /// assert_eq!(atom.load(Ordering::Relaxed).addr(), 8);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_ptr_add(&self, val: usize, order: Ordering) -> *mut T {\n+        self.fetch_byte_add(val.wrapping_mul(core::mem::size_of::<T>()), order)\n+    }\n+\n+    /// Offsets the pointer's address by subtracting `val` (in units of `T`),\n+    /// returning the previous pointer.\n+    ///\n+    /// This is equivalent to using [`wrapping_sub`] to atomically perform the\n+    /// equivalent of `ptr = ptr.wrapping_sub(val);`.\n+    ///\n+    /// This method operates in units of `T`, which means that it cannot be used\n+    /// to offset the pointer by an amount which is not a multiple of\n+    /// `size_of::<T>()`. This can sometimes be inconvenient, as you may want to\n+    /// work with a deliberately misaligned pointer. In such cases, you may use\n+    /// the [`fetch_byte_sub`](Self::fetch_byte_sub) method instead.\n+    ///\n+    /// `fetch_ptr_sub` takes an [`Ordering`] argument which describes the memory\n+    /// ordering of this operation. All ordering modes are possible. Note that\n+    /// using [`Acquire`] makes the store part of this operation [`Relaxed`],\n+    /// and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// [`wrapping_sub`]: pointer::wrapping_sub\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let array = [1i32, 2i32];\n+    /// let atom = AtomicPtr::new(array.as_ptr().wrapping_add(1) as *mut _);\n+    ///\n+    /// assert!(core::ptr::eq(\n+    ///     atom.fetch_ptr_sub(1, Ordering::Relaxed),\n+    ///     &array[1],\n+    /// ));\n+    /// assert!(core::ptr::eq(atom.load(Ordering::Relaxed), &array[0]));\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_ptr_sub(&self, val: usize, order: Ordering) -> *mut T {\n+        self.fetch_byte_sub(val.wrapping_mul(core::mem::size_of::<T>()), order)\n+    }\n+\n+    /// Offsets the pointer's address by adding `val` *bytes*, returning the\n+    /// previous pointer.\n+    ///\n+    /// This is equivalent to using [`wrapping_add`] and [`cast`] to atomically\n+    /// perform `ptr = ptr.cast::<u8>().wrapping_add(val).cast::<T>()`.\n+    ///\n+    /// `fetch_byte_add` takes an [`Ordering`] argument which describes the\n+    /// memory ordering of this operation. All ordering modes are possible. Note\n+    /// that using [`Acquire`] makes the store part of this operation\n+    /// [`Relaxed`], and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// [`wrapping_add`]: pointer::wrapping_add\n+    /// [`cast`]: pointer::cast\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let atom = AtomicPtr::<i64>::new(core::ptr::null_mut());\n+    /// assert_eq!(atom.fetch_byte_add(1, Ordering::Relaxed).addr(), 0);\n+    /// // Note: in units of bytes, not `size_of::<i64>()`.\n+    /// assert_eq!(atom.load(Ordering::Relaxed).addr(), 1);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_byte_add(&self, val: usize, order: Ordering) -> *mut T {\n+        #[cfg(not(bootstrap))]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_add(self.p.get(), core::ptr::invalid_mut(val), order).cast()\n+        }\n+        #[cfg(bootstrap)]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_add(self.p.get().cast::<usize>(), val, order) as *mut T\n+        }\n+    }\n+\n+    /// Offsets the pointer's address by subtracting `val` *bytes*, returning the\n+    /// previous pointer.\n+    ///\n+    /// This is equivalent to using [`wrapping_sub`] and [`cast`] to atomically\n+    /// perform `ptr = ptr.cast::<u8>().wrapping_sub(val).cast::<T>()`.\n+    ///\n+    /// `fetch_byte_sub` takes an [`Ordering`] argument which describes the\n+    /// memory ordering of this operation. All ordering modes are possible. Note\n+    /// that using [`Acquire`] makes the store part of this operation\n+    /// [`Relaxed`], and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// [`wrapping_sub`]: pointer::wrapping_sub\n+    /// [`cast`]: pointer::cast\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let atom = AtomicPtr::<i64>::new(core::ptr::invalid_mut(1));\n+    /// assert_eq!(atom.fetch_byte_sub(1, Ordering::Relaxed).addr(), 1);\n+    /// assert_eq!(atom.load(Ordering::Relaxed).addr(), 0);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_byte_sub(&self, val: usize, order: Ordering) -> *mut T {\n+        #[cfg(not(bootstrap))]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_sub(self.p.get(), core::ptr::invalid_mut(val), order).cast()\n+        }\n+        #[cfg(bootstrap)]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_sub(self.p.get().cast::<usize>(), val, order) as *mut T\n+        }\n+    }\n+\n+    /// Performs a bitwise \"or\" operation on the address of the current pointer,\n+    /// and the argument `val`, and stores a pointer with provenance of the\n+    /// current pointer and the resulting address.\n+    ///\n+    /// This is equivalent equivalent to using [`map_addr`] to atomically\n+    /// perform `ptr = ptr.map_addr(|a| a | val)`. This can be used in tagged\n+    /// pointer schemes to atomically set tag bits.\n+    ///\n+    /// **Caveat**: This operation returns the previous value. To compute the\n+    /// stored value without losing provenance, you may use [`map_addr`]. For\n+    /// example: `a.fetch_or(val).map_addr(|a| a | val)`.\n+    ///\n+    /// `fetch_or` takes an [`Ordering`] argument which describes the memory\n+    /// ordering of this operation. All ordering modes are possible. Note that\n+    /// using [`Acquire`] makes the store part of this operation [`Relaxed`],\n+    /// and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// This API and its claimed semantics are part of the Strict Provenance\n+    /// experiment, see the [module documentation for `ptr`][crate::ptr] for\n+    /// details.\n+    ///\n+    /// [`map_addr`]: pointer::map_addr\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let pointer = &mut 3i64 as *mut i64;\n+    ///\n+    /// let atom = AtomicPtr::<i64>::new(pointer);\n+    /// // Tag the bottom bit of the pointer.\n+    /// assert_eq!(atom.fetch_or(1, Ordering::Relaxed).addr() & 1, 0);\n+    /// // Extract and untag.\n+    /// let tagged = atom.load(Ordering::Relaxed);\n+    /// assert_eq!(tagged.addr() & 1, 1);\n+    /// assert_eq!(tagged.map_addr(|p| p & !1), pointer);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_or(&self, val: usize, order: Ordering) -> *mut T {\n+        #[cfg(not(bootstrap))]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_or(self.p.get(), core::ptr::invalid_mut(val), order).cast()\n+        }\n+        #[cfg(bootstrap)]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_or(self.p.get().cast::<usize>(), val, order) as *mut T\n+        }\n+    }\n+\n+    /// Performs a bitwise \"and\" operation on the address of the current\n+    /// pointer, and the argument `val`, and stores a pointer with provenance of\n+    /// the current pointer and the resulting address.\n+    ///\n+    /// This is equivalent equivalent to using [`map_addr`] to atomically\n+    /// perform `ptr = ptr.map_addr(|a| a & val)`. This can be used in tagged\n+    /// pointer schemes to atomically unset tag bits.\n+    ///\n+    /// **Caveat**: This operation returns the previous value. To compute the\n+    /// stored value without losing provenance, you may use [`map_addr`]. For\n+    /// example: `a.fetch_and(val).map_addr(|a| a & val)`.\n+    ///\n+    /// `fetch_and` takes an [`Ordering`] argument which describes the memory\n+    /// ordering of this operation. All ordering modes are possible. Note that\n+    /// using [`Acquire`] makes the store part of this operation [`Relaxed`],\n+    /// and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// This API and its claimed semantics are part of the Strict Provenance\n+    /// experiment, see the [module documentation for `ptr`][crate::ptr] for\n+    /// details.\n+    ///\n+    /// [`map_addr`]: pointer::map_addr\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let pointer = &mut 3i64 as *mut i64;\n+    /// // A tagged pointer\n+    /// let atom = AtomicPtr::<i64>::new(pointer.map_addr(|a| a | 1));\n+    /// assert_eq!(atom.fetch_or(1, Ordering::Relaxed).addr() & 1, 1);\n+    /// // Untag, and extract the previously tagged pointer.\n+    /// let untagged = atom.fetch_and(!1, Ordering::Relaxed)\n+    ///     .map_addr(|a| a & !1);\n+    /// assert_eq!(untagged, pointer);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_and(&self, val: usize, order: Ordering) -> *mut T {\n+        #[cfg(not(bootstrap))]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_and(self.p.get(), core::ptr::invalid_mut(val), order).cast()\n+        }\n+        #[cfg(bootstrap)]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_and(self.p.get().cast::<usize>(), val, order) as *mut T\n+        }\n+    }\n+\n+    /// Performs a bitwise \"xor\" operation on the address of the current\n+    /// pointer, and the argument `val`, and stores a pointer with provenance of\n+    /// the current pointer and the resulting address.\n+    ///\n+    /// This is equivalent equivalent to using [`map_addr`] to atomically\n+    /// perform `ptr = ptr.map_addr(|a| a ^ val)`. This can be used in tagged\n+    /// pointer schemes to atomically toggle tag bits.\n+    ///\n+    /// **Caveat**: This operation returns the previous value. To compute the\n+    /// stored value without losing provenance, you may use [`map_addr`]. For\n+    /// example: `a.fetch_xor(val).map_addr(|a| a ^ val)`.\n+    ///\n+    /// `fetch_xor` takes an [`Ordering`] argument which describes the memory\n+    /// ordering of this operation. All ordering modes are possible. Note that\n+    /// using [`Acquire`] makes the store part of this operation [`Relaxed`],\n+    /// and using [`Release`] makes the load part [`Relaxed`].\n+    ///\n+    /// **Note**: This method is only available on platforms that support atomic\n+    /// operations on [`AtomicPtr`].\n+    ///\n+    /// This API and its claimed semantics are part of the Strict Provenance\n+    /// experiment, see the [module documentation for `ptr`][crate::ptr] for\n+    /// details.\n+    ///\n+    /// [`map_addr`]: pointer::map_addr\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(strict_provenance_atomic_ptr, strict_provenance)]\n+    /// use core::sync::atomic::{AtomicPtr, Ordering};\n+    ///\n+    /// let pointer = &mut 3i64 as *mut i64;\n+    /// let atom = AtomicPtr::<i64>::new(pointer);\n+    ///\n+    /// // Toggle a tag bit on the pointer.\n+    /// atom.fetch_xor(1, Ordering::Relaxed);\n+    /// assert_eq!(atom.load(Ordering::Relaxed).addr() & 1, 1);\n+    /// ```\n+    #[inline]\n+    #[cfg(target_has_atomic = \"ptr\")]\n+    #[unstable(feature = \"strict_provenance_atomic_ptr\", issue = \"95228\")]\n+    pub fn fetch_xor(&self, val: usize, order: Ordering) -> *mut T {\n+        #[cfg(not(bootstrap))]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_xor(self.p.get(), core::ptr::invalid_mut(val), order).cast()\n+        }\n+        #[cfg(bootstrap)]\n+        // SAFETY: data races are prevented by atomic intrinsics.\n+        unsafe {\n+            atomic_xor(self.p.get().cast::<usize>(), val, order) as *mut T\n+        }\n+    }\n }\n \n #[cfg(target_has_atomic_load_store = \"8\")]"}, {"sha": "13b12db209a76ea59415aafb61195d4b9543e376", "filename": "library/core/tests/atomic.rs", "status": "modified", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Ftests%2Fatomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Ftests%2Fatomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fatomic.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -127,6 +127,91 @@ fn int_max() {\n     assert_eq!(x.load(SeqCst), 0xf731);\n }\n \n+#[test]\n+#[cfg(any(not(target_arch = \"arm\"), target_os = \"linux\"))] // Missing intrinsic in compiler-builtins\n+fn ptr_add_null() {\n+    let atom = AtomicPtr::<i64>::new(core::ptr::null_mut());\n+    assert_eq!(atom.fetch_ptr_add(1, SeqCst).addr(), 0);\n+    assert_eq!(atom.load(SeqCst).addr(), 8);\n+\n+    assert_eq!(atom.fetch_byte_add(1, SeqCst).addr(), 8);\n+    assert_eq!(atom.load(SeqCst).addr(), 9);\n+\n+    assert_eq!(atom.fetch_ptr_sub(1, SeqCst).addr(), 9);\n+    assert_eq!(atom.load(SeqCst).addr(), 1);\n+\n+    assert_eq!(atom.fetch_byte_sub(1, SeqCst).addr(), 1);\n+    assert_eq!(atom.load(SeqCst).addr(), 0);\n+}\n+\n+#[test]\n+#[cfg(any(not(target_arch = \"arm\"), target_os = \"linux\"))] // Missing intrinsic in compiler-builtins\n+fn ptr_add_data() {\n+    let num = 0i64;\n+    let n = &num as *const i64 as *mut _;\n+    let atom = AtomicPtr::<i64>::new(n);\n+    assert_eq!(atom.fetch_ptr_add(1, SeqCst), n);\n+    assert_eq!(atom.load(SeqCst), n.wrapping_add(1));\n+\n+    assert_eq!(atom.fetch_ptr_sub(1, SeqCst), n.wrapping_add(1));\n+    assert_eq!(atom.load(SeqCst), n);\n+    let bytes_from_n = |b| n.cast::<u8>().wrapping_add(b).cast::<i64>();\n+\n+    assert_eq!(atom.fetch_byte_add(1, SeqCst), n);\n+    assert_eq!(atom.load(SeqCst), bytes_from_n(1));\n+\n+    assert_eq!(atom.fetch_byte_add(5, SeqCst), bytes_from_n(1));\n+    assert_eq!(atom.load(SeqCst), bytes_from_n(6));\n+\n+    assert_eq!(atom.fetch_byte_sub(1, SeqCst), bytes_from_n(6));\n+    assert_eq!(atom.load(SeqCst), bytes_from_n(5));\n+\n+    assert_eq!(atom.fetch_byte_sub(5, SeqCst), bytes_from_n(5));\n+    assert_eq!(atom.load(SeqCst), n);\n+}\n+\n+#[test]\n+#[cfg(any(not(target_arch = \"arm\"), target_os = \"linux\"))] // Missing intrinsic in compiler-builtins\n+fn ptr_bitops() {\n+    let atom = AtomicPtr::<i64>::new(core::ptr::null_mut());\n+    assert_eq!(atom.fetch_or(0b0111, SeqCst).addr(), 0);\n+    assert_eq!(atom.load(SeqCst).addr(), 0b0111);\n+\n+    assert_eq!(atom.fetch_and(0b1101, SeqCst).addr(), 0b0111);\n+    assert_eq!(atom.load(SeqCst).addr(), 0b0101);\n+\n+    assert_eq!(atom.fetch_xor(0b1111, SeqCst).addr(), 0b0101);\n+    assert_eq!(atom.load(SeqCst).addr(), 0b1010);\n+}\n+\n+#[test]\n+#[cfg(any(not(target_arch = \"arm\"), target_os = \"linux\"))] // Missing intrinsic in compiler-builtins\n+fn ptr_bitops_tagging() {\n+    #[repr(align(16))]\n+    struct Tagme(u128);\n+\n+    let tagme = Tagme(1000);\n+    let ptr = &tagme as *const Tagme as *mut Tagme;\n+    let atom: AtomicPtr<Tagme> = AtomicPtr::new(ptr);\n+\n+    const MASK_TAG: usize = 0b1111;\n+    const MASK_PTR: usize = !MASK_TAG;\n+\n+    assert_eq!(ptr.addr() & MASK_TAG, 0);\n+\n+    assert_eq!(atom.fetch_or(0b0111, SeqCst), ptr);\n+    assert_eq!(atom.load(SeqCst), ptr.map_addr(|a| a | 0b111));\n+\n+    assert_eq!(atom.fetch_and(MASK_PTR | 0b0010, SeqCst), ptr.map_addr(|a| a | 0b111));\n+    assert_eq!(atom.load(SeqCst), ptr.map_addr(|a| a | 0b0010));\n+\n+    assert_eq!(atom.fetch_xor(0b1011, SeqCst), ptr.map_addr(|a| a | 0b0010));\n+    assert_eq!(atom.load(SeqCst), ptr.map_addr(|a| a | 0b1001));\n+\n+    assert_eq!(atom.fetch_and(MASK_PTR, SeqCst), ptr.map_addr(|a| a | 0b1001));\n+    assert_eq!(atom.load(SeqCst), ptr);\n+}\n+\n static S_FALSE: AtomicBool = AtomicBool::new(false);\n static S_TRUE: AtomicBool = AtomicBool::new(true);\n static S_INT: AtomicIsize = AtomicIsize::new(0);"}, {"sha": "fe89dd8c88d97614085f27468000ec72feabf503", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -90,6 +90,7 @@\n #![feature(slice_group_by)]\n #![feature(split_array)]\n #![feature(strict_provenance)]\n+#![feature(strict_provenance_atomic_ptr)]\n #![feature(trusted_random_access)]\n #![feature(unsize)]\n #![feature(unzip_option)]"}, {"sha": "ff4e25b792ad03529825bb1186ff319b833e97f0", "filename": "library/std/src/os/fd/raw.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -73,7 +73,7 @@ pub trait FromRawFd {\n     ///\n     /// # Safety\n     ///\n-    /// The `fd` passed in must be a valid an open file descriptor.\n+    /// The `fd` passed in must be a valid and open file descriptor.\n     ///\n     /// # Example\n     ///"}, {"sha": "4d33b7a376a2310f57d82d018b6cab756957060b", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -629,6 +629,7 @@ fn clean_ty_generics<'tcx>(\n         .params\n         .iter()\n         .filter_map(|param| match param.kind {\n+            ty::GenericParamDefKind::Lifetime if param.name == kw::UnderscoreLifetime => None,\n             ty::GenericParamDefKind::Lifetime => Some(param.clean(cx)),\n             ty::GenericParamDefKind::Type { synthetic, .. } => {\n                 if param.name == kw::SelfUpper {"}, {"sha": "e62a8bcfba6670e0b2b4a7d837d4bac361630394", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 20, "deletions": 40, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -634,7 +634,6 @@ fn render_impls(\n                 &[],\n                 ImplRenderingParameters {\n                     show_def_docs: true,\n-                    is_on_foreign_type: false,\n                     show_default_items: true,\n                     show_non_assoc_items: true,\n                     toggle_open_by_default,\n@@ -1071,7 +1070,6 @@ fn render_assoc_items_inner(\n                 &[],\n                 ImplRenderingParameters {\n                     show_def_docs: true,\n-                    is_on_foreign_type: false,\n                     show_default_items: true,\n                     show_non_assoc_items: true,\n                     toggle_open_by_default: true,\n@@ -1287,7 +1285,6 @@ fn notable_traits_decl(decl: &clean::FnDecl, cx: &Context<'_>) -> String {\n #[derive(Clone, Copy, Debug)]\n struct ImplRenderingParameters {\n     show_def_docs: bool,\n-    is_on_foreign_type: bool,\n     show_default_items: bool,\n     /// Whether or not to show methods.\n     show_non_assoc_items: bool,\n@@ -1603,7 +1600,6 @@ fn render_impl(\n             parent,\n             rendering_params.show_def_docs,\n             use_absolute,\n-            rendering_params.is_on_foreign_type,\n             aliases,\n         );\n         if toggled {\n@@ -1688,21 +1684,12 @@ pub(crate) fn render_impl_summary(\n     containing_item: &clean::Item,\n     show_def_docs: bool,\n     use_absolute: Option<bool>,\n-    is_on_foreign_type: bool,\n     // This argument is used to reference same type with different paths to avoid duplication\n     // in documentation pages for trait with automatic implementations like \"Send\" and \"Sync\".\n     aliases: &[String],\n ) {\n-    let id = cx.derive_id(match i.inner_impl().trait_ {\n-        Some(ref t) => {\n-            if is_on_foreign_type {\n-                get_id_for_impl_on_foreign_type(&i.inner_impl().for_, t, cx)\n-            } else {\n-                format!(\"impl-{}\", small_url_encode(format!(\"{:#}\", t.print(cx))))\n-            }\n-        }\n-        None => \"impl\".to_string(),\n-    });\n+    let id =\n+        cx.derive_id(get_id_for_impl(&i.inner_impl().for_, i.inner_impl().trait_.as_ref(), cx));\n     let aliases = if aliases.is_empty() {\n         String::new()\n     } else {\n@@ -1986,21 +1973,18 @@ fn sidebar_assoc_items(cx: &Context<'_>, out: &mut Buffer, it: &clean::Item) {\n                 let mut ret = impls\n                     .iter()\n                     .filter_map(|it| {\n-                        if let Some(ref i) = it.inner_impl().trait_ {\n-                            let i_display = format!(\"{:#}\", i.print(cx));\n-                            let out = Escape(&i_display);\n-                            let encoded =\n-                                id_map.derive(small_url_encode(format!(\"impl-{:#}\", i.print(cx))));\n-                            let prefix = match it.inner_impl().polarity {\n-                                ty::ImplPolarity::Positive | ty::ImplPolarity::Reservation => \"\",\n-                                ty::ImplPolarity::Negative => \"!\",\n-                            };\n-                            let generated =\n-                                format!(\"<a href=\\\"#{}\\\">{}{}</a>\", encoded, prefix, out);\n-                            if links.insert(generated.clone()) { Some(generated) } else { None }\n-                        } else {\n-                            None\n-                        }\n+                        let trait_ = it.inner_impl().trait_.as_ref()?;\n+                        let encoded =\n+                            id_map.derive(get_id_for_impl(&it.inner_impl().for_, Some(trait_), cx));\n+\n+                        let i_display = format!(\"{:#}\", trait_.print(cx));\n+                        let out = Escape(&i_display);\n+                        let prefix = match it.inner_impl().polarity {\n+                            ty::ImplPolarity::Positive | ty::ImplPolarity::Reservation => \"\",\n+                            ty::ImplPolarity::Negative => \"!\",\n+                        };\n+                        let generated = format!(\"<a href=\\\"#{}\\\">{}{}</a>\", encoded, prefix, out);\n+                        if links.insert(generated.clone()) { Some(generated) } else { None }\n                     })\n                     .collect::<Vec<String>>();\n                 ret.sort();\n@@ -2147,12 +2131,11 @@ fn sidebar_struct(cx: &Context<'_>, buf: &mut Buffer, it: &clean::Item, s: &clea\n     }\n }\n \n-fn get_id_for_impl_on_foreign_type(\n-    for_: &clean::Type,\n-    trait_: &clean::Path,\n-    cx: &Context<'_>,\n-) -> String {\n-    small_url_encode(format!(\"impl-{:#}-for-{:#}\", trait_.print(cx), for_.print(cx)))\n+fn get_id_for_impl(for_: &clean::Type, trait_: Option<&clean::Path>, cx: &Context<'_>) -> String {\n+    match trait_ {\n+        Some(t) => small_url_encode(format!(\"impl-{:#}-for-{:#}\", t.print(cx), for_.print(cx))),\n+        None => small_url_encode(format!(\"impl-{:#}\", for_.print(cx))),\n+    }\n }\n \n fn extract_for_impl_name(item: &clean::Item, cx: &Context<'_>) -> Option<(String, String)> {\n@@ -2161,10 +2144,7 @@ fn extract_for_impl_name(item: &clean::Item, cx: &Context<'_>) -> Option<(String\n             i.trait_.as_ref().map(|trait_| {\n                 // Alternative format produces no URLs,\n                 // so this parameter does nothing.\n-                (\n-                    format!(\"{:#}\", i.for_.print(cx)),\n-                    get_id_for_impl_on_foreign_type(&i.for_, trait_, cx),\n-                )\n+                (format!(\"{:#}\", i.for_.print(cx)), get_id_for_impl(&i.for_, Some(trait_), cx))\n             })\n         }\n         _ => None,"}, {"sha": "86ee8e7acf6381476592964eef11dd88ccf1af72", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -864,7 +864,6 @@ fn item_trait(w: &mut Buffer, cx: &mut Context<'_>, it: &clean::Item, t: &clean:\n                     &[],\n                     ImplRenderingParameters {\n                         show_def_docs: false,\n-                        is_on_foreign_type: true,\n                         show_default_items: false,\n                         show_non_assoc_items: true,\n                         toggle_open_by_default: false,\n@@ -1642,7 +1641,6 @@ fn render_implementor(\n         aliases,\n         ImplRenderingParameters {\n             show_def_docs: false,\n-            is_on_foreign_type: false,\n             show_default_items: false,\n             show_non_assoc_items: false,\n             toggle_open_by_default: false,"}, {"sha": "028281ba4501c3b1d1ec03192a6afa6a98b442da", "filename": "src/test/mir-opt/unusual_item_types.Test-X-{constructor#0}.mir_map.0.32bit.mir", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.32bit.mir", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.32bit.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.32bit.mir?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,12 +1,12 @@\n // MIR for `Test::X` 0 mir_map\n \n fn Test::X(_1: usize) -> Test {\n-    let mut _0: Test;                    // return place in scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n+    let mut _0: Test;                    // return place in scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n \n     bb0: {\n-        Deinit(_0);                      // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        ((_0 as X).0: usize) = move _1;  // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        discriminant(_0) = 0;            // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        return;                          // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n+        Deinit(_0);                      // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        ((_0 as X).0: usize) = move _1;  // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        discriminant(_0) = 0;            // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        return;                          // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n     }\n }"}, {"sha": "028281ba4501c3b1d1ec03192a6afa6a98b442da", "filename": "src/test/mir-opt/unusual_item_types.Test-X-{constructor#0}.mir_map.0.64bit.mir", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.64bit.mir", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.64bit.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funusual_item_types.Test-X-%7Bconstructor%230%7D.mir_map.0.64bit.mir?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,12 +1,12 @@\n // MIR for `Test::X` 0 mir_map\n \n fn Test::X(_1: usize) -> Test {\n-    let mut _0: Test;                    // return place in scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n+    let mut _0: Test;                    // return place in scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n \n     bb0: {\n-        Deinit(_0);                      // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        ((_0 as X).0: usize) = move _1;  // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        discriminant(_0) = 0;            // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n-        return;                          // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:13\n+        Deinit(_0);                      // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        ((_0 as X).0: usize) = move _1;  // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        discriminant(_0) = 0;            // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n+        return;                          // scope 0 at $DIR/unusual-item-types.rs:16:5: 16:6\n     }\n }"}, {"sha": "84b8bbd1b327f1c8431fd104e70ce04727814a5b", "filename": "src/test/rustdoc-gui/anchors.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fanchors.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -28,7 +28,7 @@ move-cursor-to: \"h2#implementations\"\n assert-css: (\"h2#implementations a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n \n // Same thing with the impl block title.\n-move-cursor-to: \"#impl\"\n-assert-css: (\"#impl a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n+move-cursor-to: \"#impl-HeavilyDocumentedStruct\"\n+assert-css: (\"#impl-HeavilyDocumentedStruct a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n \n assert-css: (\"#title-for-struct-impl-item-doc\", {\"margin-left\": \"0px\"})"}, {"sha": "a47a9c8a14c1f07e4505729564490ebe7ea7c14e", "filename": "src/test/rustdoc-gui/headers-color.goml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -23,9 +23,9 @@ assert-css: (\n     ALL,\n )\n \n-goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl-Foo\n assert-css: (\n-    \"#impl\",\n+    \"#impl-Foo\",\n     {\"color\": \"rgb(197, 197, 197)\", \"background-color\": \"rgba(255, 236, 164, 0.06)\"},\n )\n \n@@ -62,9 +62,9 @@ assert-css: (\n     ALL,\n )\n \n-goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl-Foo\n assert-css: (\n-    \"#impl\",\n+    \"#impl-Foo\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgb(73, 74, 61)\"},\n )\n \n@@ -99,8 +99,8 @@ assert-css: (\n     ALL,\n )\n \n-goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl\n-assert-css: (\"#impl\", {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(253, 255, 211)\"})\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html#impl-Foo\n+assert-css: (\"#impl-Foo\", {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(253, 255, 211)\"})\n \n goto: file://|DOC_PATH|/test_docs/struct.Foo.html#method.must_use\n assert-css: ("}, {"sha": "cc3dd61e99a7a1169809bd22b89e768085429d2a", "filename": "src/test/rustdoc-gui/headings.goml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheadings.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -32,8 +32,8 @@ assert-css: (\"h4#sub-heading-for-field\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"h2#implementations\", {\"font-size\": \"22px\"})\n assert-css: (\"h2#implementations\", {\"border-bottom-width\": \"1px\"})\n \n-assert-css: (\"#impl > h3.code-header\", {\"font-size\": \"18px\"})\n-assert-css: (\"#impl > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"#impl-HeavilyDocumentedStruct > h3.code-header\", {\"font-size\": \"18px\"})\n+assert-css: (\"#impl-HeavilyDocumentedStruct > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"#method\\.do_nothing > h4.code-header\", {\"font-size\": \"16px\"})\n assert-css: (\"#method\\.do_nothing > h4.code-header\", {\"border-bottom-width\": \"0px\"})\n \n@@ -87,8 +87,8 @@ assert-css: (\"h6#structy-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"h2#implementations\", {\"font-size\": \"22px\"})\n assert-css: (\"h2#implementations\", {\"border-bottom-width\": \"1px\"})\n \n-assert-css: (\"#impl > h3.code-header\", {\"font-size\": \"18px\"})\n-assert-css: (\"#impl > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"#impl-HeavilyDocumentedEnum > h3.code-header\", {\"font-size\": \"18px\"})\n+assert-css: (\"#impl-HeavilyDocumentedEnum > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"#method\\.do_nothing > h4.code-header\", {\"font-size\": \"16px\"})\n assert-css: (\"#method\\.do_nothing > h4.code-header\", {\"border-bottom-width\": \"0px\"})\n \n@@ -129,8 +129,8 @@ assert-css: (\"h4#sub-heading-for-union-variant\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"h2#implementations\", {\"font-size\": \"22px\"})\n assert-css: (\"h2#implementations\", {\"border-bottom-width\": \"1px\"})\n \n-assert-css: (\"#impl > h3.code-header\", {\"font-size\": \"18px\"})\n-assert-css: (\"#impl > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"#impl-HeavilyDocumentedUnion > h3.code-header\", {\"font-size\": \"18px\"})\n+assert-css: (\"#impl-HeavilyDocumentedUnion > h3.code-header\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"h4#title-for-union-impl-doc\", {\"font-size\": \"16px\"})\n assert-css: (\"h4#title-for-union-impl-doc\", {\"border-bottom-width\": \"0px\"})\n assert-css: (\"h5#sub-heading-for-union-impl-doc\", {\"font-size\": \"16px\"})"}, {"sha": "666a6e1253d9dbd64cf6d28ba17972f922d638ef", "filename": "src/test/rustdoc-gui/implementors.goml", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fimplementors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fimplementors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fimplementors.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -6,8 +6,8 @@ assert: \"#implementors-list\"\n assert-count: (\"#implementors-list .impl\", 2)\n // Now we check that both implementors have an anchor, an ID and a similar DOM.\n assert: (\"#implementors-list .impl:nth-child(1) > a.anchor\")\n-assert-attribute: (\"#implementors-list .impl:nth-child(1)\", {\"id\": \"impl-Whatever\"})\n-assert-attribute: (\"#implementors-list .impl:nth-child(1) > a.anchor\", {\"href\": \"#impl-Whatever\"})\n+assert-attribute: (\"#implementors-list .impl:nth-child(1)\", {\"id\": \"impl-Whatever-for-Struct\"})\n+assert-attribute: (\"#implementors-list .impl:nth-child(1) > a.anchor\", {\"href\": \"#impl-Whatever-for-Struct\"})\n assert: \"#implementors-list .impl:nth-child(1) > .code-header.in-band\"\n \n assert: (\"#implementors-list .impl:nth-child(2) > a.anchor\")\n@@ -16,8 +16,16 @@ assert-attribute: (\"#implementors-list .impl:nth-child(2) > a.anchor\", {\"href\":\n assert: \"#implementors-list .impl:nth-child(2) > .code-header.in-band\"\n \n goto: file://|DOC_PATH|/test_docs/struct.HasEmptyTraits.html\n-compare-elements-position-near-false: (\"#impl-EmptyTrait1\", \"#impl-EmptyTrait2\", {\"y\": 30})\n-compare-elements-position-near: (\"#impl-EmptyTrait3 h3\", \"#impl-EmptyTrait3 .item-info\", {\"y\": 30})\n+compare-elements-position-near-false: (\n+    \"#impl-EmptyTrait1-for-HasEmptyTraits\",\n+    \"#impl-EmptyTrait2-for-HasEmptyTraits\",\n+    {\"y\": 30},\n+)\n+compare-elements-position-near: (\n+    \"#impl-EmptyTrait3-for-HasEmptyTraits h3\",\n+    \"#impl-EmptyTrait3-for-HasEmptyTraits .item-info\",\n+    {\"y\": 30},\n+)\n \n // Now check that re-exports work correctly.\n // There should be exactly one impl shown on both of these pages."}, {"sha": "b7095a3c5324d5715998dadd4d466626f46047ee", "filename": "src/test/rustdoc-gui/item-info-overflow.goml", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fitem-info-overflow.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Fitem-info-overflow.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fitem-info-overflow.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -15,14 +15,17 @@ assert-text: (\n // Checking the \"item-info\" on an impl block as well:\n goto: file://|DOC_PATH|/lib2/struct.LongItemInfo2.html\n compare-elements-property: (\n-    \"#impl-SimpleTrait .item-info\",\n-    \"#impl-SimpleTrait + .docblock\",\n+    \"#impl-SimpleTrait-for-LongItemInfo2 .item-info\",\n+    \"#impl-SimpleTrait-for-LongItemInfo2 + .docblock\",\n     [\"scrollWidth\"],\n )\n-assert-property: (\"#impl-SimpleTrait .item-info\", {\"scrollWidth\": \"866\"})\n+assert-property: (\n+    \"#impl-SimpleTrait-for-LongItemInfo2 .item-info\",\n+    {\"scrollWidth\": \"866\"},\n+)\n // Just to be sure we're comparing the correct \"item-info\":\n assert-text: (\n-    \"#impl-SimpleTrait .item-info\",\n+    \"#impl-SimpleTrait-for-LongItemInfo2 .item-info\",\n     \"Available on Android or Linux or Emscripten or DragonFly BSD\",\n     STARTS_WITH,\n )"}, {"sha": "4a328c9f9e06e09904b49fefa204466de507b4ab", "filename": "src/test/rustdoc-gui/toggle-click-deadspace.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-click-deadspace.goml?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -8,5 +8,5 @@ click: \".impl-items .rustdoc-toggle summary::before\" // This is the position of\n assert-attribute-false: (\".impl-items .rustdoc-toggle\", {\"open\": \"\"})\n \n // Click the \"Trait\" part of \"impl Trait\" and verify it navigates.\n-click: \"#impl-Trait h3 a:first-of-type\"\n+click: \"#impl-Trait-for-Foo h3 a:first-of-type\"\n assert-text: (\".fqn .in-band\", \"Trait lib2::Trait\")"}, {"sha": "5025b0b0ca82562f9f9f55b534722eb0590a44a0", "filename": "src/test/rustdoc-ui/deny-missing-docs-crate.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -16,7 +16,7 @@ error: missing documentation for a struct\n   --> $DIR/deny-missing-docs-crate.rs:3:1\n    |\n LL | pub struct Foo;\n-   | ^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^\n \n error: aborting due to 2 previous errors\n "}, {"sha": "661d905ab639cb81143eca5ea523524193307b0e", "filename": "src/test/rustdoc/auto-trait-not-send.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fauto-trait-not-send.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fauto-trait-not-send.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauto-trait-not-send.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,8 +1,8 @@\n #![crate_name = \"foo\"]\n \n // @has 'foo/struct.Foo.html'\n-// @has - '//*[@id=\"impl-Send\"]' 'impl !Send for Foo'\n-// @has - '//*[@id=\"impl-Sync\"]' 'impl !Sync for Foo'\n+// @has - '//*[@id=\"impl-Send-for-Foo\"]' 'impl !Send for Foo'\n+// @has - '//*[@id=\"impl-Sync-for-Foo\"]' 'impl !Sync for Foo'\n pub struct Foo(*const i8);\n pub trait Whatever: Send {}\n impl<T: Send + ?Sized> Whatever for T {}"}, {"sha": "4e55e7ed576302c31bb28948d43d36d7be17cba6", "filename": "src/test/rustdoc/auxiliary/issue-98697-reexport-with-anonymous-lifetime.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fauxiliary%2Fissue-98697-reexport-with-anonymous-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fauxiliary%2Fissue-98697-reexport-with-anonymous-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauxiliary%2Fissue-98697-reexport-with-anonymous-lifetime.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -7,3 +7,11 @@ where\n {\n     unimplemented!()\n }\n+\n+pub struct Extra;\n+\n+pub trait MyTrait<T> {\n+    fn run() {}\n+}\n+\n+impl MyTrait<&Extra> for Extra {}"}, {"sha": "676d656dabf471f172b7d2dca79087a696c4bf42", "filename": "src/test/rustdoc/blanket-reexport-item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fblanket-reexport-item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fblanket-reexport-item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fblanket-reexport-item.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,6 +1,6 @@\n #![crate_name = \"foo\"]\n \n-// @has foo/struct.S.html '//*[@id=\"impl-Into%3CU%3E\"]//h3[@class=\"code-header in-band\"]' 'impl<T, U> Into<U> for T'\n+// @has foo/struct.S.html '//*[@id=\"impl-Into%3CU%3E-for-S\"]//h3[@class=\"code-header in-band\"]' 'impl<T, U> Into<U> for T'\n pub struct S2 {}\n mod m {\n     pub struct S {}"}, {"sha": "61af7de4794a6e7fc8801575ddc21af286897743", "filename": "src/test/rustdoc/const-generics/const-generics-docs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-generics-docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-generics-docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-generics-docs.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -36,7 +36,7 @@ pub struct Foo<const N: usize> where u8: Trait<N>;\n // @has foo/struct.Bar.html '//pre[@class=\"rust struct\"]' 'pub struct Bar<T, const N: usize>(_)'\n pub struct Bar<T, const N: usize>([T; N]);\n \n-// @has foo/struct.Foo.html '//*[@id=\"impl\"]/h3[@class=\"code-header in-band\"]' 'impl<const M: usize> Foo<M> where u8: Trait<M>'\n+// @has foo/struct.Foo.html '//*[@id=\"impl-Foo%3CM%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<const M: usize> Foo<M> where u8: Trait<M>'\n impl<const M: usize> Foo<M> where u8: Trait<M> {\n     // @has - '//*[@id=\"associatedconstant.FOO_ASSOC\"]' 'pub const FOO_ASSOC: usize'\n     pub const FOO_ASSOC: usize = M + 13;\n@@ -47,7 +47,7 @@ impl<const M: usize> Foo<M> where u8: Trait<M> {\n     }\n }\n \n-// @has foo/struct.Bar.html '//*[@id=\"impl\"]/h3[@class=\"code-header in-band\"]' 'impl<const M: usize> Bar<u8, M>'\n+// @has foo/struct.Bar.html '//*[@id=\"impl-Bar%3Cu8%2C%20M%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<const M: usize> Bar<u8, M>'\n impl<const M: usize> Bar<u8, M> {\n     // @has - '//*[@id=\"method.hey\"]' \\\n     //      'pub fn hey<const N: usize>(&self) -> Foo<N> where u8: Trait<N>'"}, {"sha": "f1181d54ac87fa7a6a0c5ea3c9c3c3ffeda0e6bc", "filename": "src/test/rustdoc/const-generics/const-impl.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fconst-generics%2Fconst-impl.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -9,20 +9,20 @@ pub enum Order {\n }\n \n // @has foo/struct.VSet.html '//pre[@class=\"rust struct\"]' 'pub struct VSet<T, const ORDER: Order>'\n-// @has foo/struct.VSet.html '//*[@id=\"impl-Send\"]/h3[@class=\"code-header in-band\"]' 'impl<T, const ORDER: Order> Send for VSet<T, ORDER>'\n-// @has foo/struct.VSet.html '//*[@id=\"impl-Sync\"]/h3[@class=\"code-header in-band\"]' 'impl<T, const ORDER: Order> Sync for VSet<T, ORDER>'\n+// @has foo/struct.VSet.html '//*[@id=\"impl-Send-for-VSet%3CT%2C%20ORDER%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<T, const ORDER: Order> Send for VSet<T, ORDER>'\n+// @has foo/struct.VSet.html '//*[@id=\"impl-Sync-for-VSet%3CT%2C%20ORDER%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<T, const ORDER: Order> Sync for VSet<T, ORDER>'\n pub struct VSet<T, const ORDER: Order> {\n     inner: Vec<T>,\n }\n \n-// @has foo/struct.VSet.html '//*[@id=\"impl\"]/h3[@class=\"code-header in-band\"]' 'impl<T> VSet<T, { Order::Sorted }>'\n+// @has foo/struct.VSet.html '//*[@id=\"impl-VSet%3CT%2C%20{%20Order%3A%3ASorted%20}%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<T> VSet<T, { Order::Sorted }>'\n impl<T> VSet<T, { Order::Sorted }> {\n     pub fn new() -> Self {\n         Self { inner: Vec::new() }\n     }\n }\n \n-// @has foo/struct.VSet.html '//*[@id=\"impl-1\"]/h3[@class=\"code-header in-band\"]' 'impl<T> VSet<T, { Order::Unsorted }>'\n+// @has foo/struct.VSet.html '//*[@id=\"impl-VSet%3CT%2C%20{%20Order%3A%3AUnsorted%20}%3E\"]/h3[@class=\"code-header in-band\"]' 'impl<T> VSet<T, { Order::Unsorted }>'\n impl<T> VSet<T, { Order::Unsorted }> {\n     pub fn new() -> Self {\n         Self { inner: Vec::new() }\n@@ -31,7 +31,7 @@ impl<T> VSet<T, { Order::Unsorted }> {\n \n pub struct Escape<const S: &'static str>;\n \n-// @has foo/struct.Escape.html '//*[@id=\"impl\"]/h3[@class=\"code-header in-band\"]' 'impl Escape<r#\"<script>alert(\"Escape\");</script>\"#>'\n+// @has foo/struct.Escape.html '//*[@id=\"impl-Escape%3Cr#%22%3Cscript%3Ealert(%22Escape%22)%3B%3C/script%3E%22#%3E\"]/h3[@class=\"code-header in-band\"]' 'impl Escape<r#\"<script>alert(\"Escape\");</script>\"#>'\n impl Escape<r#\"<script>alert(\"Escape\");</script>\"#> {\n     pub fn f() {}\n }"}, {"sha": "350c897417d1f5f9583a52deb6e42594811c5c5a", "filename": "src/test/rustdoc/double-quote-escape.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fdouble-quote-escape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fdouble-quote-escape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fdouble-quote-escape.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,12 +1,11 @@\n #![crate_name = \"foo\"]\n \n-\n pub trait Foo<T> {\n     fn foo() {}\n }\n \n pub struct Bar;\n \n // @has foo/struct.Bar.html\n-// @has - '//*[@class=\"sidebar-elems\"]//section//a[@href=\"#impl-Foo%3Cunsafe%20extern%20%22C%22%20fn()%3E\"]' 'Foo<unsafe extern \"C\" fn()>'\n+// @has - '//*[@class=\"sidebar-elems\"]//section//a[@href=\"#impl-Foo%3Cunsafe%20extern%20%22C%22%20fn()%3E-for-Bar\"]' 'Foo<unsafe extern \"C\" fn()>'\n impl Foo<unsafe extern \"C\" fn()> for Bar {}"}, {"sha": "83902d6f7ab137a1af92ff61543ecf5f9896975f", "filename": "src/test/rustdoc/empty-impls.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fempty-impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fempty-impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fempty-impls.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,19 +1,19 @@\n #![crate_name = \"foo\"]\n \n // @has foo/struct.Foo.html\n-// @has - '//div[@id=\"synthetic-implementations-list\"]/*[@id=\"impl-Send\"]' 'impl Send for Foo'\n+// @has - '//div[@id=\"synthetic-implementations-list\"]/*[@id=\"impl-Send-for-Foo\"]' 'impl Send for Foo'\n pub struct Foo;\n \n pub trait EmptyTrait {}\n \n-// @has - '//div[@id=\"trait-implementations-list\"]/*[@id=\"impl-EmptyTrait\"]' 'impl EmptyTrait for Foo'\n+// @has - '//div[@id=\"trait-implementations-list\"]/*[@id=\"impl-EmptyTrait-for-Foo\"]' 'impl EmptyTrait for Foo'\n impl EmptyTrait for Foo {}\n \n pub trait NotEmpty {\n     fn foo(&self);\n }\n \n-// @has - '//div[@id=\"trait-implementations-list\"]/details/summary/*[@id=\"impl-NotEmpty\"]' 'impl NotEmpty for Foo'\n+// @has - '//div[@id=\"trait-implementations-list\"]/details/summary/*[@id=\"impl-NotEmpty-for-Foo\"]' 'impl NotEmpty for Foo'\n impl NotEmpty for Foo {\n     fn foo(&self) {}\n }"}, {"sha": "c6beed70abeb168e158e0e7e3bcda6ec96ece152", "filename": "src/test/rustdoc/generic-impl.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fgeneric-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fgeneric-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fgeneric-impl.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -2,12 +2,12 @@\n \n use std::fmt;\n \n-// @!has foo/struct.Bar.html '//*[@id=\"impl-ToString\"]//h3[@class=\"code-header in-band\"]' 'impl<T> ToString for T'\n+// @!has foo/struct.Bar.html '//*[@id=\"impl-ToString-for-Bar\"]' ''\n pub struct Bar;\n \n-// @has foo/struct.Foo.html '//*[@id=\"impl-ToString\"]//h3[@class=\"code-header in-band\"]' 'impl<T> ToString for T'\n+// @has foo/struct.Foo.html '//*[@id=\"impl-ToString-for-Foo\"]//h3[@class=\"code-header in-band\"]' 'impl<T> ToString for T'\n pub struct Foo;\n-// @has foo/struct.Foo.html '//*[@class=\"sidebar-elems\"]//section//a[@href=\"#impl-ToString\"]' 'ToString'\n+// @has foo/struct.Foo.html '//*[@class=\"sidebar-elems\"]//section//a[@href=\"#impl-ToString-for-Foo\"]' 'ToString'\n \n impl fmt::Display for Foo {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {"}, {"sha": "cc3f6337719c3155de676ee716b7c82717264aeb", "filename": "src/test/rustdoc/hidden-trait-struct-impls.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fhidden-trait-struct-impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fhidden-trait-struct-impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fhidden-trait-struct-impls.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -11,11 +11,11 @@ pub struct Bar;\n \n struct Hidden;\n \n-// @!has foo/struct.Bar.html '//*[@id=\"impl-Foo\"]' 'impl Foo for Bar'\n+// @!has foo/struct.Bar.html '//*[@id=\"impl-Foo-for-Bar\"]' 'impl Foo for Bar'\n impl Foo for Bar {}\n-// @!has foo/struct.Bar.html '//*[@id=\"impl-Dark\"]' 'impl Dark for Bar'\n+// @!has foo/struct.Bar.html '//*[@id=\"impl-Dark-for-Bar\"]' 'impl Dark for Bar'\n impl Dark for Bar {}\n-// @has foo/struct.Bar.html '//*[@id=\"impl-Bam\"]' 'impl Bam for Bar'\n+// @has foo/struct.Bar.html '//*[@id=\"impl-Bam-for-Bar\"]' 'impl Bam for Bar'\n // @has foo/trait.Bam.html '//*[@id=\"implementors-list\"]' 'impl Bam for Bar'\n impl Bam for Bar {}\n // @!has foo/trait.Bam.html '//*[@id=\"implementors-list\"]' 'impl Bam for Hidden'"}, {"sha": "592b6c98587addbcf983000de22d154f890e2199", "filename": "src/test/rustdoc/impl-box.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fimpl-box.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fimpl-box.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fimpl-box.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -5,7 +5,7 @@\n pub struct MyType;\n \n // @has 'impl_box/struct.MyType.html'\n-// @has '-' '//*[@id=\"impl-Iterator\"]' 'impl Iterator for Box<MyType>'\n+// @has '-' '//*[@id=\"impl-Iterator-for-Box%3CMyType%3E\"]' 'impl Iterator for Box<MyType>'\n \n impl Iterator for Box<MyType> {\n     type Item = ();"}, {"sha": "635c3175f8138a39e40bc83d04f2bc1a6c0386be", "filename": "src/test/rustdoc/issue-29503.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-29503.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-29503.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-29503.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -5,7 +5,7 @@ pub trait MyTrait {\n     fn my_string(&self) -> String;\n }\n \n-// @has - \"//div[@id='implementors-list']//*[@id='impl-MyTrait']//h3[@class='code-header in-band']\" \"impl<T> MyTrait for T where T: Debug\"\n+// @has - \"//div[@id='implementors-list']//*[@id='impl-MyTrait-for-T']//h3[@class='code-header in-band']\" \"impl<T> MyTrait for T where T: Debug\"\n impl<T> MyTrait for T\n where\n     T: fmt::Debug,"}, {"sha": "ac97b94fb351b558258671d7529e8c5825373591", "filename": "src/test/rustdoc/issue-75588.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-75588.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-75588.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-75588.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -13,5 +13,5 @@ extern crate real_gimli;\n // @!has foo/trait.Deref.html '//*[@id=\"impl-Deref-for-EndianSlice\"]//h3[@class=\"code-header in-band\"]' 'impl Deref for EndianSlice'\n pub use realcore::Deref;\n \n-// @has foo/trait.Join.html '//*[@id=\"impl-Join\"]//h3[@class=\"code-header in-band\"]' 'impl Join for Foo'\n+// @has foo/trait.Join.html '//*[@id=\"impl-Join-for-Foo\"]//h3[@class=\"code-header in-band\"]' 'impl Join for Foo'\n pub use realcore::Join;"}, {"sha": "e3e46468f38407e2fe231c9e628266dde0343c0a", "filename": "src/test/rustdoc/issue-78701.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-78701.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-78701.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-78701.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -5,8 +5,8 @@\n // the ID is correctly derived.\n \n // @has 'foo/struct.AnotherStruct.html'\n-// @count - '//*[@class=\"sidebar\"]//a[@href=\"#impl-AnAmazingTrait\"]' 1\n-// @count - '//*[@class=\"sidebar\"]//a[@href=\"#impl-AnAmazingTrait-1\"]' 1\n+// @count - '//*[@class=\"sidebar\"]//a[@href=\"#impl-AnAmazingTrait-for-AnotherStruct%3C()%3E\"]' 1\n+// @count - '//*[@class=\"sidebar\"]//a[@href=\"#impl-AnAmazingTrait-for-AnotherStruct%3CT%3E\"]' 1\n \n pub trait Something {}\n "}, {"sha": "83e08094c09534abf9da016c5c95fd7c42c8e9e9", "filename": "src/test/rustdoc/issue-98697.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-98697.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fissue-98697.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-98697.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -11,3 +11,7 @@ extern crate issue_98697_reexport_with_anonymous_lifetime;\n // @has issue_98697/fn.repro.html '//pre[@class=\"rust fn\"]/code' 'fn repro<F>() where F: Fn(&str)'\n // @!has issue_98697/fn.repro.html '//pre[@class=\"rust fn\"]/code' 'for<'\n pub use issue_98697_reexport_with_anonymous_lifetime::repro;\n+\n+// @has issue_98697/struct.Extra.html '//div[@id=\"trait-implementations-list\"]//h3[@class=\"code-header in-band\"]' 'impl MyTrait<&Extra> for Extra'\n+// @!has issue_98697/struct.Extra.html '//div[@id=\"trait-implementations-list\"]//h3[@class=\"code-header in-band\"]' 'impl<'\n+pub use issue_98697_reexport_with_anonymous_lifetime::Extra;"}, {"sha": "eebb2cf5a355d5037d7bde41f66460175a785127", "filename": "src/test/rustdoc/primitive/primitive-generic-impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fprimitive%2Fprimitive-generic-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fprimitive%2Fprimitive-generic-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fprimitive%2Fprimitive-generic-impl.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,7 +1,7 @@\n #![feature(rustdoc_internals)]\n #![crate_name = \"foo\"]\n \n-// @has foo/primitive.i32.html '//*[@id=\"impl-ToString\"]//h3[@class=\"code-header in-band\"]' 'impl<T> ToString for T'\n+// @has foo/primitive.i32.html '//*[@id=\"impl-ToString-for-i32\"]//h3[@class=\"code-header in-band\"]' 'impl<T> ToString for T'\n \n #[doc(primitive = \"i32\")]\n /// Some useless docs, wouhou!"}, {"sha": "f3e211e301742c5609468299a15afd4fc4105b0d", "filename": "src/test/rustdoc/rfc-2632-const-trait-impl.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Frfc-2632-const-trait-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Frfc-2632-const-trait-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Frfc-2632-const-trait-impl.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -29,10 +29,11 @@ pub trait Tr<T> {\n     }\n }\n \n-// @!has - '//section[@id=\"impl-Tr%3CT%3E\"]/h3[@class=\"code-header in-band\"]' '~const'\n-// @has - '//section[@id=\"impl-Tr%3CT%3E\"]/h3[@class=\"code-header in-band\"]/a[@class=\"trait\"]' 'Clone'\n-// @!has - '//section[@id=\"impl-Tr%3CT%3E\"]/h3[@class=\"code-header in-band\"]/span[@class=\"where\"]' '~const'\n-// @has - '//section[@id=\"impl-Tr%3CT%3E\"]/h3[@class=\"code-header in-band\"]/span[@class=\"where fmt-newline\"]' ': Clone'\n+// @has - '//section[@id=\"impl-Tr%3CT%3E-for-T\"]' ''\n+// @!has - '//section[@id=\"impl-Tr%3CT%3E-for-T\"]/h3[@class=\"code-header in-band\"]' '~const'\n+// @has - '//section[@id=\"impl-Tr%3CT%3E-for-T\"]/h3[@class=\"code-header in-band\"]/a[@class=\"trait\"]' 'Clone'\n+// @!has - '//section[@id=\"impl-Tr%3CT%3E-for-T\"]/h3[@class=\"code-header in-band\"]/span[@class=\"where\"]' '~const'\n+// @has - '//section[@id=\"impl-Tr%3CT%3E-for-T\"]/h3[@class=\"code-header in-band\"]/span[@class=\"where fmt-newline\"]' ': Clone'\n impl<T: ~const Clone + ~const Destruct> const Tr<T> for T\n where\n     Option<T>: ~const Clone + ~const Destruct,"}, {"sha": "9d2c1967757f103df4ef07dbb47c0fb40ff02b86", "filename": "src/test/rustdoc/sized_trait.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fsized_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fsized_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fsized_trait.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -11,7 +11,7 @@ pub struct Bar {\n pub struct Foo<T: ?Sized>(T);\n \n // @has foo/struct.Unsized.html\n-// @has - '//*[@id=\"impl-Sized\"]//h3[@class=\"code-header in-band\"]' 'impl !Sized for Unsized'\n+// @has - '//*[@id=\"impl-Sized-for-Unsized\"]//h3[@class=\"code-header in-band\"]' 'impl !Sized for Unsized'\n pub struct Unsized {\n     data: [u8],\n }"}, {"sha": "69be9aa8d5f1011213f24589337f844b86647f2b", "filename": "src/test/rustdoc/src-links-auto-impls.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fsrc-links-auto-impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Fsrc-links-auto-impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fsrc-links-auto-impls.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,12 +1,12 @@\n #![crate_name = \"foo\"]\n \n // @has foo/struct.Unsized.html\n-// @has - '//*[@id=\"impl-Sized\"]/h3[@class=\"code-header in-band\"]' 'impl !Sized for Unsized'\n-// @!has - '//*[@id=\"impl-Sized\"]//a[@class=\"srclink\"]' 'source'\n-// @has - '//*[@id=\"impl-Sync\"]/h3[@class=\"code-header in-band\"]' 'impl Sync for Unsized'\n-// @!has - '//*[@id=\"impl-Sync\"]//a[@class=\"srclink\"]' 'source'\n-// @has - '//*[@id=\"impl-Any\"]/h3[@class=\"code-header in-band\"]' 'impl<T> Any for T'\n-// @has - '//*[@id=\"impl-Any\"]//a[@class=\"srclink\"]' 'source'\n+// @has - '//*[@id=\"impl-Sized-for-Unsized\"]/h3[@class=\"code-header in-band\"]' 'impl !Sized for Unsized'\n+// @!has - '//*[@id=\"impl-Sized-for-Unsized\"]//a[@class=\"srclink\"]' 'source'\n+// @has - '//*[@id=\"impl-Sync-for-Unsized\"]/h3[@class=\"code-header in-band\"]' 'impl Sync for Unsized'\n+// @!has - '//*[@id=\"impl-Sync-for-Unsized\"]//a[@class=\"srclink\"]' 'source'\n+// @has - '//*[@id=\"impl-Any-for-Unsized\"]/h3[@class=\"code-header in-band\"]' 'impl<T> Any for T'\n+// @has - '//*[@id=\"impl-Any-for-Unsized\"]//a[@class=\"srclink\"]' 'source'\n pub struct Unsized {\n     data: [u8],\n }"}, {"sha": "4f7e2dfe3b9a53310e1d63b20394649461869462", "filename": "src/test/rustdoc/trait-impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftrait-impl.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -43,5 +43,5 @@ impl Trait for Struct {\n     // @!has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/p/em'\n     fn d() {}\n \n-    // @has - '//*[@id=\"impl-Trait\"]/h3//a/@href' 'trait.Trait.html'\n+    // @has - '//*[@id=\"impl-Trait-for-Struct\"]/h3//a/@href' 'trait.Trait.html'\n }"}, {"sha": "615e7fb4aae2982252922221b983f3468272cd65", "filename": "src/test/ui/empty/empty-struct-braces-pat-3.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-braces-pat-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-braces-pat-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty%2Fempty-struct-braces-pat-3.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -19,7 +19,7 @@ LL |     XEmpty3 {},\n    |     ------- `XE::XEmpty3` defined here\n LL |     XEmpty4,\n LL |     XEmpty5(),\n-   |     --------- similarly named tuple variant `XEmpty5` defined here\n+   |     ------- similarly named tuple variant `XEmpty5` defined here\n    |\n help: use struct pattern syntax instead\n    |\n@@ -51,7 +51,7 @@ LL |     XEmpty3 {},\n    |     ------- `XE::XEmpty3` defined here\n LL |     XEmpty4,\n LL |     XEmpty5(),\n-   |     --------- similarly named tuple variant `XEmpty5` defined here\n+   |     ------- similarly named tuple variant `XEmpty5` defined here\n    |\n help: use struct pattern syntax instead\n    |"}, {"sha": "9f44747381a9a4fc71464bca93493f96160cc39b", "filename": "src/test/ui/empty/empty-struct-tuple-pat.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-tuple-pat.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-tuple-pat.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty%2Fempty-struct-tuple-pat.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -36,7 +36,7 @@ LL |         XE::XEmpty5 => (),\n LL |     XEmpty4,\n    |     ------- similarly named unit variant `XEmpty4` defined here\n LL |     XEmpty5(),\n-   |     --------- `XE::XEmpty5` defined here\n+   |     ------- `XE::XEmpty5` defined here\n    |\n help: use the tuple variant pattern syntax instead\n    |"}, {"sha": "5c0b4cffa9469787ffbb9f58e8c899ac8bbb6d69", "filename": "src/test/ui/empty/empty-struct-unit-pat.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-pat.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-pat.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-pat.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -108,7 +108,7 @@ LL |         XE::XEmpty4() => (),\n LL |     XEmpty4,\n    |     ------- `XE::XEmpty4` defined here\n LL |     XEmpty5(),\n-   |     --------- similarly named tuple variant `XEmpty5` defined here\n+   |     ------- similarly named tuple variant `XEmpty5` defined here\n    |\n help: use this syntax instead\n    |\n@@ -139,7 +139,7 @@ LL |         XE::XEmpty4(..) => (),\n LL |     XEmpty4,\n    |     ------- `XE::XEmpty4` defined here\n LL |     XEmpty5(),\n-   |     --------- similarly named tuple variant `XEmpty5` defined here\n+   |     ------- similarly named tuple variant `XEmpty5` defined here\n    |\n help: use this syntax instead\n    |"}, {"sha": "8de0edef076c62f939cb238fb116b6a0c21f58b0", "filename": "src/test/ui/issues/issue-34209.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -2,7 +2,7 @@ error[E0599]: no variant named `B` found for enum `S`\n   --> $DIR/issue-34209.rs:7:12\n    |\n LL | enum S {\n-   | ------ variant `B` not found here\n+   | ------ variant `B` not found for this enum\n ...\n LL |         S::B {} => {},\n    |            ^ help: there is a variant with a similar name: `A`"}, {"sha": "e83590a8f59749e6f4853938f242ffb78a8158e9", "filename": "src/test/ui/issues/issue-37884.stderr", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-37884.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-37884.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-37884.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -1,13 +1,8 @@\n error[E0308]: method not compatible with trait\n   --> $DIR/issue-37884.rs:6:5\n    |\n-LL | /     fn next(&'a mut self) -> Option<Self::Item>\n-LL | |\n-LL | |\n-LL | |     {\n-LL | |         Some(&mut self.0)\n-LL | |     }\n-   | |_____^ lifetime mismatch\n+LL |     fn next(&'a mut self) -> Option<Self::Item>\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ lifetime mismatch\n    |\n    = note: expected fn pointer `fn(&mut RepeatMut<'a, T>) -> Option<_>`\n               found fn pointer `fn(&'a mut RepeatMut<'a, T>) -> Option<_>`"}, {"sha": "b4c877a2d74a45d32f9a7471596d981b5d0da2c8", "filename": "src/test/ui/issues/issue-77919.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -24,7 +24,7 @@ LL |     const VAL: T;\n    |     ------------ `VAL` from trait\n ...\n LL | impl<N, M> TypeVal<usize> for Multiply<N, M> where N: TypeVal<VAL> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `VAL` in implementation\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `VAL` in implementation\n \n error: constant expression depends on a generic parameter\n   --> $DIR/issue-77919.rs:2:9"}, {"sha": "d68472d4b660254987d03a7cd535b0280af9e0e2", "filename": "src/test/ui/lint/lint-missing-doc.stderr", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Flint%2Flint-missing-doc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Flint%2Flint-missing-doc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-missing-doc.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -2,7 +2,7 @@ error: missing documentation for a type alias\n   --> $DIR/lint-missing-doc.rs:11:1\n    |\n LL | pub type PubTypedef = String;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^\n    |\n note: the lint level is defined here\n   --> $DIR/lint-missing-doc.rs:3:9\n@@ -56,13 +56,13 @@ error: missing documentation for an associated type\n   --> $DIR/lint-missing-doc.rs:64:5\n    |\n LL |     type AssociatedType;\n-   |     ^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated type\n   --> $DIR/lint-missing-doc.rs:65:5\n    |\n LL |     type AssociatedTypeDef = Self;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated function\n   --> $DIR/lint-missing-doc.rs:81:5\n@@ -92,13 +92,13 @@ error: missing documentation for a constant\n   --> $DIR/lint-missing-doc.rs:151:1\n    |\n LL | pub const FOO4: u32 = 0;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n   --> $DIR/lint-missing-doc.rs:161:1\n    |\n LL | pub static BAR4: u32 = 0;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n   --> $DIR/lint-missing-doc.rs:167:5\n@@ -122,19 +122,19 @@ error: missing documentation for a function\n   --> $DIR/lint-missing-doc.rs:189:5\n    |\n LL |     pub fn extern_fn_undocumented(f: f32) -> f32;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n   --> $DIR/lint-missing-doc.rs:194:5\n    |\n LL |     pub static EXTERN_STATIC_UNDOCUMENTED: u8;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a foreign type\n   --> $DIR/lint-missing-doc.rs:199:5\n    |\n LL |     pub type ExternTyUndocumented;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: aborting due to 22 previous errors\n "}, {"sha": "8b8563684014dbf633909ab7825dcf7c52cffac8", "filename": "src/test/ui/mismatched_types/issue-47706.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-47706.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-47706.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-47706.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -19,7 +19,7 @@ error[E0593]: function is expected to take 0 arguments, but it takes 1 argument\n   --> $DIR/issue-47706.rs:27:9\n    |\n LL |     Bar(i32),\n-   |     -------- takes 1 argument\n+   |     --- takes 1 argument\n ...\n LL |     foo(Qux::Bar);\n    |     --- ^^^^^^^^ expected function that takes 0 arguments"}, {"sha": "b04ea14d1a58095238293d750d6b9d93936ccaa7", "filename": "src/test/ui/namespace/namespace-mix.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -94,7 +94,7 @@ LL |     check(xm7::V);\n LL |         V {},\n    |         - `xm7::V` defined here\n LL |         TV(),\n-   |         ---- similarly named tuple variant `TV` defined here\n+   |         -- similarly named tuple variant `TV` defined here\n    |\n help: use struct literal syntax instead\n    |"}, {"sha": "c0cc56aa86e2651127d3a3ca3f338a3be3d4053a", "filename": "src/test/ui/pattern/pat-tuple-field-count-cross.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-field-count-cross.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-field-count-cross.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-field-count-cross.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -60,7 +60,7 @@ LL |         E1::Z0() => {}\n   ::: $DIR/auxiliary/declarations-for-tuple-field-count-errors.rs:11:15\n    |\n LL | pub enum E1 { Z0, Z1(), S(u8, u8, u8) }\n-   |               --  ---- similarly named tuple variant `Z1` defined here\n+   |               --  -- similarly named tuple variant `Z1` defined here\n    |               |\n    |               `E1::Z0` defined here\n    |\n@@ -82,7 +82,7 @@ LL |         E1::Z0(x) => {}\n   ::: $DIR/auxiliary/declarations-for-tuple-field-count-errors.rs:11:15\n    |\n LL | pub enum E1 { Z0, Z1(), S(u8, u8, u8) }\n-   |               --  ---- similarly named tuple variant `Z1` defined here\n+   |               --  -- similarly named tuple variant `Z1` defined here\n    |               |\n    |               `E1::Z0` defined here\n    |\n@@ -104,7 +104,7 @@ LL |         E1::Z1 => {}\n   ::: $DIR/auxiliary/declarations-for-tuple-field-count-errors.rs:11:19\n    |\n LL | pub enum E1 { Z0, Z1(), S(u8, u8, u8) }\n-   |               --  ---- `E1::Z1` defined here\n+   |               --  -- `E1::Z1` defined here\n    |               |\n    |               similarly named unit variant `Z0` defined here\n    |\n@@ -295,7 +295,7 @@ LL |         E1::Z1(x) => {}\n   ::: $DIR/auxiliary/declarations-for-tuple-field-count-errors.rs:11:19\n    |\n LL | pub enum E1 { Z0, Z1(), S(u8, u8, u8) }\n-   |                   ---- tuple variant has 0 fields\n+   |                   -- tuple variant has 0 fields\n \n error[E0023]: this pattern has 0 fields, but the corresponding tuple variant has 3 fields\n   --> $DIR/pat-tuple-field-count-cross.rs:39:9"}, {"sha": "856e7918cb75c4c2bf3c7942804321715f3bede7", "filename": "src/test/ui/pattern/pat-tuple-overfield.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-overfield.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-overfield.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fpat-tuple-overfield.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -289,7 +289,7 @@ error[E0023]: this pattern has 1 field, but the corresponding tuple variant has\n   --> $DIR/pat-tuple-overfield.rs:71:16\n    |\n LL |     Z1(),\n-   |     ---- tuple variant has 0 fields\n+   |     -- tuple variant has 0 fields\n ...\n LL |         E1::Z1(_) => {}\n    |                ^ expected 0 fields, found 1\n@@ -298,7 +298,7 @@ error[E0023]: this pattern has 2 fields, but the corresponding tuple variant has\n   --> $DIR/pat-tuple-overfield.rs:72:16\n    |\n LL |     Z1(),\n-   |     ---- tuple variant has 0 fields\n+   |     -- tuple variant has 0 fields\n ...\n LL |         E1::Z1(_, _) => {}\n    |                ^  ^ expected 0 fields, found 2"}, {"sha": "3c46b95cbc6858da3d759895a379f90ea43441af", "filename": "src/test/ui/proc-macro/parent-source-spans.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fproc-macro%2Fparent-source-spans.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fproc-macro%2Fparent-source-spans.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fparent-source-spans.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -148,7 +148,7 @@ LL |     one!(\"hello\", \"world\");\n   ::: $SRC_DIR/core/src/result.rs:LL:COL\n    |\n LL |     Ok(#[stable(feature = \"rust1\", since = \"1.0.0\")] T),\n-   |     --------------------------------------------------- similarly named tuple variant `Ok` defined here\n+   |     -- similarly named tuple variant `Ok` defined here\n    |\n    = note: this error originates in the macro `parent_source_spans` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n@@ -164,7 +164,7 @@ LL |     two!(\"yay\", \"rust\");\n   ::: $SRC_DIR/core/src/result.rs:LL:COL\n    |\n LL |     Ok(#[stable(feature = \"rust1\", since = \"1.0.0\")] T),\n-   |     --------------------------------------------------- similarly named tuple variant `Ok` defined here\n+   |     -- similarly named tuple variant `Ok` defined here\n    |\n    = note: this error originates in the macro `parent_source_spans` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n@@ -180,7 +180,7 @@ LL |     three!(\"hip\", \"hop\");\n   ::: $SRC_DIR/core/src/result.rs:LL:COL\n    |\n LL |     Ok(#[stable(feature = \"rust1\", since = \"1.0.0\")] T),\n-   |     --------------------------------------------------- similarly named tuple variant `Ok` defined here\n+   |     -- similarly named tuple variant `Ok` defined here\n    |\n    = note: this error originates in the macro `parent_source_spans` (in Nightly builds, run with -Z macro-backtrace for more info)\n "}, {"sha": "d85661f6faa847c46b5db19b5e0886de59c1ab04", "filename": "src/test/ui/repr/repr-transparent.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -58,7 +58,7 @@ error[E0731]: transparent enum needs exactly one variant, but has 2\n LL | enum MultipleVariants {\n    | ^^^^^^^^^^^^^^^^^^^^^ needs exactly one variant, but has 2\n LL |     Foo(String),\n-   |     -----------\n+   |     ---\n LL |     Bar,\n    |     --- too many variants in `MultipleVariants`\n "}, {"sha": "e546d9f64ecad27d2b0a46f92e8643fc9639d37d", "filename": "src/test/ui/resolve/privacy-enum-ctor.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -318,7 +318,7 @@ error[E0308]: mismatched types\n   --> $DIR/privacy-enum-ctor.rs:27:20\n    |\n LL |             Fn(u8),\n-   |             ------ fn(u8) -> Z {Z::Fn} defined here\n+   |             -- fn(u8) -> Z {Z::Fn} defined here\n ...\n LL |         let _: Z = Z::Fn;\n    |                -   ^^^^^ expected enum `Z`, found fn item\n@@ -353,7 +353,7 @@ error[E0308]: mismatched types\n   --> $DIR/privacy-enum-ctor.rs:43:16\n    |\n LL |         Fn(u8),\n-   |         ------ fn(u8) -> E {E::Fn} defined here\n+   |         -- fn(u8) -> E {E::Fn} defined here\n ...\n LL |     let _: E = m::E::Fn;\n    |            -   ^^^^^^^^ expected enum `E`, found fn item\n@@ -388,7 +388,7 @@ error[E0308]: mismatched types\n   --> $DIR/privacy-enum-ctor.rs:51:16\n    |\n LL |         Fn(u8),\n-   |         ------ fn(u8) -> E {E::Fn} defined here\n+   |         -- fn(u8) -> E {E::Fn} defined here\n ...\n LL |     let _: E = E::Fn;\n    |            -   ^^^^^ expected enum `E`, found fn item"}, {"sha": "720b7b119cec96e861d1d69ddb6d2a0085109a4e", "filename": "src/test/ui/rfc-2008-non-exhaustive/variant.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Frfc-2008-non-exhaustive%2Fvariant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Frfc-2008-non-exhaustive%2Fvariant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2008-non-exhaustive%2Fvariant.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -8,7 +8,7 @@ note: the tuple variant `Tuple` is defined here\n   --> $DIR/auxiliary/variants.rs:5:23\n    |\n LL |     #[non_exhaustive] Tuple(u32),\n-   |                       ^^^^^^^^^^\n+   |                       ^^^^^\n \n error[E0603]: unit variant `Unit` is private\n   --> $DIR/variant.rs:14:47\n@@ -44,7 +44,7 @@ note: the tuple variant `Tuple` is defined here\n   --> $DIR/auxiliary/variants.rs:5:23\n    |\n LL |     #[non_exhaustive] Tuple(u32),\n-   |                       ^^^^^^^^^^\n+   |                       ^^^^^\n \n error[E0603]: tuple variant `Tuple` is private\n   --> $DIR/variant.rs:26:35\n@@ -56,7 +56,7 @@ note: the tuple variant `Tuple` is defined here\n   --> $DIR/auxiliary/variants.rs:5:23\n    |\n LL |     #[non_exhaustive] Tuple(u32),\n-   |                       ^^^^^^^^^^\n+   |                       ^^^^^\n \n error[E0639]: cannot create non-exhaustive variant using struct expression\n   --> $DIR/variant.rs:8:26"}, {"sha": "9aeb99ee2fa8f28f47e547d49f12ba7f1c628d70", "filename": "src/test/ui/suggestions/fn-or-tuple-struct-without-args.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Ffn-or-tuple-struct-without-args.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Ffn-or-tuple-struct-without-args.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ffn-or-tuple-struct-without-args.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -130,7 +130,7 @@ error[E0308]: mismatched types\n   --> $DIR/fn-or-tuple-struct-without-args.rs:35:16\n    |\n LL |     A(usize),\n-   |     -------- fn(usize) -> E {E::A} defined here\n+   |     - fn(usize) -> E {E::A} defined here\n ...\n LL |     let _: E = E::A;\n    |            -   ^^^^ expected enum `E`, found fn item"}, {"sha": "0b4ccdd5a56d4939ce553c2bc25bd6f717558479", "filename": "src/test/ui/suggestions/parenthesized-deref-suggestion.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.rs?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "previous_filename": "src/test/ui/parenthesized-deref-suggestion.rs"}, {"sha": "cafddbe2624240dbd9276df2e181b4f7f55da156", "filename": "src/test/ui/suggestions/parenthesized-deref-suggestion.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fparenthesized-deref-suggestion.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "previous_filename": "src/test/ui/parenthesized-deref-suggestion.stderr"}, {"sha": "1a5833f6429ccbf0defe9bb8616c65686a714eac", "filename": "src/test/ui/suggestions/suggest-variants.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -2,7 +2,7 @@ error[E0599]: no variant named `Squareee` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:12:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Squareee` not found here\n+   | ---------- variant `Squareee` not found for this enum\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Squareee { size: 5});\n    |                                         ^^^^^^^^ help: there is a variant with a similar name: `Square`\n@@ -11,7 +11,7 @@ error[E0599]: no variant named `Circl` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:13:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Circl` not found here\n+   | ---------- variant `Circl` not found for this enum\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Circl { size: 5});\n    |                                         ^^^^^ help: there is a variant with a similar name: `Circle`\n@@ -20,7 +20,7 @@ error[E0599]: no variant named `Rombus` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:14:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Rombus` not found here\n+   | ---------- variant `Rombus` not found for this enum\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Rombus{ size: 5});\n    |                                         ^^^^^^ variant not found in `Shape`"}, {"sha": "a1e37e7317b2e4b3b4a1578bc7e69dd71923cae2", "filename": "src/tools/clippy/tests/ui/crashes/ice-6252.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-6252.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7665c3543079ebc3710b676d0fd6951bedfd4b29/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-6252.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-6252.stderr?ref=7665c3543079ebc3710b676d0fd6951bedfd4b29", "patch": "@@ -28,7 +28,7 @@ LL |     const VAL: T;\n    |     ------------ `VAL` from trait\n ...\n LL | impl<N, M> TypeVal<usize> for Multiply<N, M> where N: TypeVal<VAL> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `VAL` in implementation\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `VAL` in implementation\n \n error: constant expression depends on a generic parameter\n   --> $DIR/ice-6252.rs:13:9"}]}