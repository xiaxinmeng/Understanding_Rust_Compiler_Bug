{"sha": "2188b464b0c5e22661bc488815f8b46b0b31cc26", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxODhiNDY0YjBjNWUyMjY2MWJjNDg4ODE1ZjhiNDZiMGIzMWNjMjY=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2018-03-09T08:17:55Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2018-03-09T08:17:55Z"}, "message": "Format macro call with item arguments", "tree": {"sha": "ebbd7d87e8a780ee59a7cb9efd63278d2e7b83d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ebbd7d87e8a780ee59a7cb9efd63278d2e7b83d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2188b464b0c5e22661bc488815f8b46b0b31cc26", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2188b464b0c5e22661bc488815f8b46b0b31cc26", "html_url": "https://github.com/rust-lang/rust/commit/2188b464b0c5e22661bc488815f8b46b0b31cc26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2188b464b0c5e22661bc488815f8b46b0b31cc26/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eaab592cb80c8b32b5f047955ca2cec073e6ace2", "url": "https://api.github.com/repos/rust-lang/rust/commits/eaab592cb80c8b32b5f047955ca2cec073e6ace2", "html_url": "https://github.com/rust-lang/rust/commit/eaab592cb80c8b32b5f047955ca2cec073e6ace2"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "b4968d12a0aec8917252294cf5345d905ed3ac5c", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=2188b464b0c5e22661bc488815f8b46b0b31cc26", "patch": "@@ -3051,6 +3051,7 @@ impl<'a> ToExpr for MacroArg {\n             MacroArg::Expr(ref expr) => can_be_overflowed_expr(context, expr, len),\n             MacroArg::Ty(ref ty) => can_be_overflowed_type(context, ty, len),\n             MacroArg::Pat(..) => false,\n+            MacroArg::Item(..) => len == 1,\n         }\n     }\n }"}, {"sha": "ac4b0db7266f247c7101c5ea90e3df6c38916028", "filename": "src/macros.rs", "status": "modified", "additions": 20, "deletions": 5, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=2188b464b0c5e22661bc488815f8b46b0b31cc26", "patch": "@@ -22,7 +22,7 @@\n use std::collections::HashMap;\n \n use config::lists::*;\n-use syntax::ast;\n+use syntax::{ast, ptr};\n use syntax::codemap::{BytePos, Span};\n use syntax::parse::new_parser_from_tts;\n use syntax::parse::parser::Parser;\n@@ -38,6 +38,7 @@ use expr::{rewrite_array, rewrite_call_inner};\n use lists::{itemize_list, write_list, ListFormatting};\n use rewrite::{Rewrite, RewriteContext};\n use shape::{Indent, Shape};\n+use spanned::Spanned;\n use utils::{format_visibility, mk_sp, wrap_str};\n \n const FORCED_BRACKET_MACROS: &[&str] = &[\"vec!\"];\n@@ -70,9 +71,21 @@ impl MacroStyle {\n \n #[derive(Debug)]\n pub enum MacroArg {\n-    Expr(ast::Expr),\n-    Ty(ast::Ty),\n-    Pat(ast::Pat),\n+    Expr(ptr::P<ast::Expr>),\n+    Ty(ptr::P<ast::Ty>),\n+    Pat(ptr::P<ast::Pat>),\n+    // `parse_item` returns `Option<ptr::P<ast::Item>>`.\n+    Item(Option<ptr::P<ast::Item>>),\n+}\n+\n+impl Rewrite for ast::Item {\n+    fn rewrite(&self, context: &RewriteContext, shape: Shape) -> Option<String> {\n+        let mut visitor = ::visitor::FmtVisitor::from_context(context);\n+        visitor.block_indent = shape.indent;\n+        visitor.last_pos = self.span().lo();\n+        visitor.visit_item(self);\n+        Some(visitor.buffer)\n+    }\n }\n \n impl Rewrite for MacroArg {\n@@ -81,6 +94,7 @@ impl Rewrite for MacroArg {\n             MacroArg::Expr(ref expr) => expr.rewrite(context, shape),\n             MacroArg::Ty(ref ty) => ty.rewrite(context, shape),\n             MacroArg::Pat(ref pat) => pat.rewrite(context, shape),\n+            MacroArg::Item(ref item) => item.as_ref().and_then(|item| item.rewrite(context, shape)),\n         }\n     }\n }\n@@ -96,7 +110,7 @@ fn parse_macro_arg(parser: &mut Parser) -> Option<MacroArg> {\n                     } else {\n                         // Parsing succeeded.\n                         *parser = cloned_parser;\n-                        return Some(MacroArg::$macro_arg((*x).clone()));\n+                        return Some(MacroArg::$macro_arg(x.clone()));\n                     }\n                 }\n                 Err(mut e) => {\n@@ -110,6 +124,7 @@ fn parse_macro_arg(parser: &mut Parser) -> Option<MacroArg> {\n     parse_macro_arg!(Expr, parse_expr);\n     parse_macro_arg!(Ty, parse_ty);\n     parse_macro_arg!(Pat, parse_pat);\n+    parse_macro_arg!(Item, parse_item);\n \n     None\n }"}, {"sha": "6f5a4b1721f9d6ff5ce48b91f612701f7306871a", "filename": "src/spanned.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fspanned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2188b464b0c5e22661bc488815f8b46b0b31cc26/src%2Fspanned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fspanned.rs?ref=2188b464b0c5e22661bc488815f8b46b0b31cc26", "patch": "@@ -187,6 +187,7 @@ impl Spanned for MacroArg {\n             MacroArg::Expr(ref expr) => expr.span(),\n             MacroArg::Ty(ref ty) => ty.span(),\n             MacroArg::Pat(ref pat) => pat.span(),\n+            MacroArg::Item(ref item) => item.as_ref().unwrap().span(),\n         }\n     }\n }"}]}