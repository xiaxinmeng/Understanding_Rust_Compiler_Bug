{"sha": "4cefecb495c7a425935563a6f15e6b2b9e86e316", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjZWZlY2I0OTVjN2E0MjU5MzU1NjNhNmYxNWU2YjJiOWU4NmUzMTY=", "commit": {"author": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2016-01-12T20:53:19Z"}, "committer": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2016-01-12T20:53:19Z"}, "message": "Merge pull request #768 from DarkDrek/amend-to-fix-#447\n\nfixes parsing issue #767", "tree": {"sha": "ad1e9af3f684345ff891e25b10fabddad72e9812", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad1e9af3f684345ff891e25b10fabddad72e9812"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cefecb495c7a425935563a6f15e6b2b9e86e316", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cefecb495c7a425935563a6f15e6b2b9e86e316", "html_url": "https://github.com/rust-lang/rust/commit/4cefecb495c7a425935563a6f15e6b2b9e86e316", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cefecb495c7a425935563a6f15e6b2b9e86e316/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b99e8eda2996874c28f6543fb417bca1e3aed69f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b99e8eda2996874c28f6543fb417bca1e3aed69f", "html_url": "https://github.com/rust-lang/rust/commit/b99e8eda2996874c28f6543fb417bca1e3aed69f"}, {"sha": "937e26d4e1b28a2b4609ccc76b14a7c873333c02", "url": "https://api.github.com/repos/rust-lang/rust/commits/937e26d4e1b28a2b4609ccc76b14a7c873333c02", "html_url": "https://github.com/rust-lang/rust/commit/937e26d4e1b28a2b4609ccc76b14a7c873333c02"}], "stats": {"total": 35, "additions": 29, "deletions": 6}, "files": [{"sha": "25c863639214e8a49465072cfab57a39712d6dee", "filename": "src/expr.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4cefecb495c7a425935563a6f15e6b2b9e86e316/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cefecb495c7a425935563a6f15e6b2b9e86e316/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=4cefecb495c7a425935563a6f15e6b2b9e86e316", "patch": "@@ -663,6 +663,7 @@ fn rewrite_if_else(context: &RewriteContext,\n     let between_if_cond = mk_sp(span_after(span, \"if\", context.codemap),\n                                 pat.map_or(cond.span.lo,\n                                            |_| span_before(span, \"let\", context.codemap)));\n+\n     let between_if_cond_comment = extract_comment(between_if_cond, &context, offset, width);\n \n     let after_cond_comment = extract_comment(mk_sp(cond.span.hi, if_block.span.lo),\n@@ -680,23 +681,23 @@ fn rewrite_if_else(context: &RewriteContext,\n         let rewrite = match else_block.node {\n             // If the else expression is another if-else expression, prevent it\n             // from being formatted on a single line.\n-            ast::Expr_::ExprIfLet(ref pat, ref cond, ref if_block, ref else_block) => {\n+            ast::Expr_::ExprIfLet(ref pat, ref cond, ref if_block, ref next_else_block) => {\n                 rewrite_if_else(context,\n                                 cond,\n                                 if_block,\n-                                else_block.as_ref().map(|e| &**e),\n-                                mk_sp(span_after(span, \"else\", context.codemap), span.hi),\n+                                next_else_block.as_ref().map(|e| &**e),\n+                                mk_sp(else_block.span.lo, span.hi),\n                                 Some(pat),\n                                 width,\n                                 offset,\n                                 false)\n             }\n-            ast::Expr_::ExprIf(ref cond, ref if_block, ref else_block) => {\n+            ast::Expr_::ExprIf(ref cond, ref if_block, ref next_else_block) => {\n                 rewrite_if_else(context,\n                                 cond,\n                                 if_block,\n-                                else_block.as_ref().map(|e| &**e),\n-                                mk_sp(span_after(span, \"else\", context.codemap), span.hi),\n+                                next_else_block.as_ref().map(|e| &**e),\n+                                mk_sp(else_block.span.lo, span.hi),\n                                 None,\n                                 width,\n                                 offset,"}, {"sha": "c5002f5ec15fd015ff23a5759250791cbd71017c", "filename": "tests/source/expr.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4cefecb495c7a425935563a6f15e6b2b9e86e316/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cefecb495c7a425935563a6f15e6b2b9e86e316/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=4cefecb495c7a425935563a6f15e6b2b9e86e316", "patch": "@@ -233,3 +233,14 @@ fn blocks() {\n         println!(\"yay arithmetix!\");\n     };\n }\n+\n+fn issue767() {\n+    if false {\n+        if false {\n+        } else {\n+            // A let binding here seems necessary to trigger it.\n+            let _ = ();\n+        }\n+    } else if let false = false {\n+    }\n+}"}, {"sha": "9c9c65a690cdc0505521f5136e0906e8c57c3742", "filename": "tests/target/expr.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4cefecb495c7a425935563a6f15e6b2b9e86e316/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cefecb495c7a425935563a6f15e6b2b9e86e316/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=4cefecb495c7a425935563a6f15e6b2b9e86e316", "patch": "@@ -256,3 +256,14 @@ fn blocks() {\n         println!(\"yay arithmetix!\");\n     };\n }\n+\n+fn issue767() {\n+    if false {\n+        if false {\n+        } else {\n+            // A let binding here seems necessary to trigger it.\n+            let _ = ();\n+        }\n+    } else if let false = false {\n+    }\n+}"}]}