{"sha": "1ba762a193f8db56f4229c6dd3b2a1f0df62170a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiYTc2MmExOTNmOGRiNTZmNDIyOWM2ZGQzYjJhMWYwZGY2MjE3MGE=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-03-20T16:02:10Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-03-24T14:36:10Z"}, "message": "ci: fix out of disk space errors on linux GHA\n\nThe /mnt mount point has 53GB of free disk space at the time of writing\nthis commit, so this moves the build there to avoid running out of disk\nspace during builds.", "tree": {"sha": "3bce797761dc96fc99665ec1f3d2667329e27614", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bce797761dc96fc99665ec1f3d2667329e27614"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ba762a193f8db56f4229c6dd3b2a1f0df62170a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl56GtoACgkQPgar6Auq\n8ZxwvQ//ajgi/1T7lpADCQI/yjOXf1wq9RGZNvyw2VMjtj8qMM1U469IfPJCOgGS\ntIp3gHdHzOyOvwV1zVQ6kH8/bhZp2lTgdP7VpC44WBo+oN61zaHsaf9IIcL1CGV5\n1EiQCio3E/FrMnJFHxfeiiE2yXKik1gODRNF7t0uigDzl2iw1OCwKIecF2C4vhNV\nckHsYbQwYRNQh08f36VBaMWkcaQi8wWhGl5HF/qYEGrtwaxRkBfDkdL9t9ubcYNM\nivO5dqUWLCkd3QWcrG+tF4hJ2tyGKAdA80oNvfpGgZItDtpY2Q4aXRsMWO3X2XjY\nD9UoXeR3ehYhPhOQ9Wr9lMaWEvBZqKNHGwNCgWV9his0r46FekMCmU4CABN6zUet\nlg+nsZApjHJXLRLx7aheoE7PxMAvmudSqgUvvOSn1NSDBExUl65V2Y3uUeOF1JkU\n1BvfkuISO4J1/Lo5d8eaLBBu07ng2uo6B915dkRXjzURFO4TUbd9tte9+Ij5wXZZ\ncYzSgFE/uX70UsgCe+nv9WmwAuL/vl5tQo/CZWnuOtfsvKVN5y0Xiof6rXhDnR5f\n0oPOJ/BnAEv3U8+XsyXKfZ1aRU7ye3t3Jfyo756b+yjybkRlv2f0Xrqxg0SW9kU5\nWLSAxXU6HKWSRmxgSN/bgE7WQa1DmsWwxZcUbmWVpS3SigduQ9I=\n=r2wS\n-----END PGP SIGNATURE-----", "payload": "tree 3bce797761dc96fc99665ec1f3d2667329e27614\nparent b9c3633847cd74f514ebb3197876e8181a003f10\nauthor Pietro Albini <pietro@pietroalbini.org> 1584720130 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1585060570 +0100\n\nci: fix out of disk space errors on linux GHA\n\nThe /mnt mount point has 53GB of free disk space at the time of writing\nthis commit, so this moves the build there to avoid running out of disk\nspace during builds.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ba762a193f8db56f4229c6dd3b2a1f0df62170a", "html_url": "https://github.com/rust-lang/rust/commit/1ba762a193f8db56f4229c6dd3b2a1f0df62170a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ba762a193f8db56f4229c6dd3b2a1f0df62170a/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9c3633847cd74f514ebb3197876e8181a003f10", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9c3633847cd74f514ebb3197876e8181a003f10", "html_url": "https://github.com/rust-lang/rust/commit/b9c3633847cd74f514ebb3197876e8181a003f10"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "737a30206af328205a01771a04f622ad69c5c063", "filename": "src/ci/scripts/symlink-build-dir.sh", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1ba762a193f8db56f4229c6dd3b2a1f0df62170a/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1ba762a193f8db56f4229c6dd3b2a1f0df62170a/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh?ref=1ba762a193f8db56f4229c6dd3b2a1f0df62170a", "patch": "@@ -1,8 +1,8 @@\n #!/bin/bash\n-# We've had issues with the default drive in use running out of space during a\n-# build, and it looks like the `C:` drive has more space than the default `D:`\n-# drive. We should probably confirm this with the azure pipelines team at some\n-# point, but this seems to fix our \"disk space full\" problems.\n+# We've had multiple issues with the default disk running out of disk space\n+# during builds, and it looks like other disks mounted in the VMs have more\n+# space available. This script synlinks the build directory to those other\n+# disks, in the CI providers and OSes affected by this.\n \n set -euo pipefail\n IFS=$'\\n\\t'\n@@ -12,4 +12,8 @@ source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n if isWindows && isAzurePipelines; then\n     cmd //c \"mkdir c:\\\\MORE_SPACE\"\n     cmd //c \"mklink /J build c:\\\\MORE_SPACE\"\n+elif isLinux && isGitHubActions; then\n+    sudo mkdir -p /mnt/more-space\n+    sudo chown -R \"$(whoami):\" /mnt/more-space\n+    ln -s /mnt/more-space obj\n fi"}]}