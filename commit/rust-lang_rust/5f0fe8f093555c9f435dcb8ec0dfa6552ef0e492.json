{"sha": "5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmMGZlOGYwOTM1NTVjOWY0MzVkY2I4ZWMwZGZhNjU1MmVmMGU0OTI=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-10-15T21:20:10Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2019-01-02T22:35:04Z"}, "message": "remove `commit_if_ok` wrapper", "tree": {"sha": "04f02e27a57d88195df5eb28af961a4fff6a93aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04f02e27a57d88195df5eb28af961a4fff6a93aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492", "html_url": "https://github.com/rust-lang/rust/commit/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec194646fef1a467073ad74b8b68f6f202cfce97", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec194646fef1a467073ad74b8b68f6f202cfce97", "html_url": "https://github.com/rust-lang/rust/commit/ec194646fef1a467073ad74b8b68f6f202cfce97"}], "stats": {"total": 11, "additions": 1, "deletions": 10}, "files": [{"sha": "1832d35e3ae459078b0f687847fb691bcf9b0174", "filename": "src/librustc/traits/select.rs", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492/src%2Flibrustc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492/src%2Flibrustc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fselect.rs?ref=5f0fe8f093555c9f435dcb8ec0dfa6552ef0e492", "patch": "@@ -549,15 +549,6 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n         self.infcx.probe(|snapshot| f(self, snapshot))\n     }\n \n-    /// Wraps a commit_if_ok s.t. obligations collected during it are not returned in selection if\n-    /// the transaction fails and s.t. old obligations are retained.\n-    fn commit_if_ok<T, E, F>(&mut self, f: F) -> Result<T, E>\n-    where\n-        F: FnOnce(&mut Self, &infer::CombinedSnapshot<'cx, 'tcx>) -> Result<T, E>,\n-    {\n-        self.infcx.commit_if_ok(|snapshot| f(self, snapshot))\n-    }\n-\n     ///////////////////////////////////////////////////////////////////////////\n     // Selection\n     //\n@@ -3041,7 +3032,7 @@ impl<'cx, 'gcx, 'tcx> SelectionContext<'cx, 'gcx, 'tcx> {\n             // reported an ambiguity. (When we do find a match, also\n             // record it for later.)\n             let nonmatching = util::supertraits(tcx, poly_trait_ref).take_while(\n-                |&t| match self.commit_if_ok(|this, _| this.match_poly_trait_ref(obligation, t)) {\n+                |&t| match self.infcx.commit_if_ok(|_| self.match_poly_trait_ref(obligation, t)) {\n                     Ok(obligations) => {\n                         upcast_trait_ref = Some(t);\n                         nested.extend(obligations);"}]}