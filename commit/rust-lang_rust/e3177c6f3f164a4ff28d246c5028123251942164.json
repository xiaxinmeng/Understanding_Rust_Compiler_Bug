{"sha": "e3177c6f3f164a4ff28d246c5028123251942164", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMTc3YzZmM2YxNjRhNGZmMjhkMjQ2YzUwMjgxMjMyNTE5NDIxNjQ=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-08-03T21:31:03Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-08-09T16:00:25Z"}, "message": "Move rustc::util::fs into separate (new) crate", "tree": {"sha": "66e112db90dd6e7d3497a9153a9fd50c9271c534", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/66e112db90dd6e7d3497a9153a9fd50c9271c534"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3177c6f3f164a4ff28d246c5028123251942164", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3177c6f3f164a4ff28d246c5028123251942164", "html_url": "https://github.com/rust-lang/rust/commit/e3177c6f3f164a4ff28d246c5028123251942164", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3177c6f3f164a4ff28d246c5028123251942164/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf103700c6e2aa51e0531ab807b554c17ce9ba7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf103700c6e2aa51e0531ab807b554c17ce9ba7d", "html_url": "https://github.com/rust-lang/rust/commit/bf103700c6e2aa51e0531ab807b554c17ce9ba7d"}], "stats": {"total": 57, "additions": 41, "deletions": 16}, "files": [{"sha": "1ef6b2a571e9ca18453ee37ecb1f64d96fa1bf43", "filename": "src/Cargo.lock", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -1887,6 +1887,7 @@ dependencies = [\n  \"rustc_apfloat 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n  \"rustc_errors 0.0.0\",\n+ \"rustc_fs_util 0.0.0\",\n  \"rustc_target 0.0.0\",\n  \"scoped-tls 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serialize 0.0.0\",\n@@ -2185,6 +2186,10 @@ dependencies = [\n  \"unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"rustc_fs_util\"\n+version = \"0.0.0\"\n+\n [[package]]\n name = \"rustc_incremental\"\n version = \"0.0.0\"\n@@ -2194,6 +2199,7 @@ dependencies = [\n  \"rand 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n+ \"rustc_fs_util 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n  \"syntax_pos 0.0.0\","}, {"sha": "088b9436d0fc9c74b70fd09c741637451498b6a1", "filename": "src/librustc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2FCargo.toml?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -32,6 +32,7 @@ backtrace = \"0.3.3\"\n parking_lot = \"0.5.5\"\n byteorder = { version = \"1.1\", features = [\"i128\"]}\n chalk-engine = { version = \"0.6.0\", default-features=false }\n+rustc_fs_util = { path = \"../librustc_fs_util\" }\n \n # Note that these dependencies are a lie, they're just here to get linkage to\n # work."}, {"sha": "62f244acc9a944c4a21d365f458f9c1809845b2e", "filename": "src/librustc/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -99,6 +99,7 @@ extern crate syntax_pos;\n extern crate jobserver;\n extern crate proc_macro;\n extern crate chalk_engine;\n+extern crate rustc_fs_util;\n \n extern crate serialize as rustc_serialize; // used by deriving\n \n@@ -162,7 +163,6 @@ pub mod util {\n     pub mod common;\n     pub mod ppaux;\n     pub mod nodemap;\n-    pub mod fs;\n     pub mod time_graph;\n     pub mod profiling;\n }"}, {"sha": "32044fdf2a8cb2fa9df336d949ca3b9fc24d5dce", "filename": "src/librustc/session/filesearch.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2Fsession%2Ffilesearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc%2Fsession%2Ffilesearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Ffilesearch.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -19,7 +19,7 @@ use std::fs;\n use std::path::{Path, PathBuf};\n \n use session::search_paths::{SearchPaths, PathKind};\n-use util::fs as rustcfs;\n+use rustc_fs_util::fix_windows_verbatim_for_gcc;\n \n #[derive(Copy, Clone)]\n pub enum FileMatch {\n@@ -151,7 +151,7 @@ pub fn get_or_default_sysroot() -> PathBuf {\n                 // See comments on this target function, but the gist is that\n                 // gcc chokes on verbatim paths which fs::canonicalize generates\n                 // so we try to avoid those kinds of paths.\n-                Ok(canon) => Some(rustcfs::fix_windows_verbatim_for_gcc(&canon)),\n+                Ok(canon) => Some(fix_windows_verbatim_for_gcc(&canon)),\n                 Err(e) => bug!(\"failed to get realpath: {}\", e),\n             }\n         })"}, {"sha": "bbe1ccf3696f4219ab0a56707bfb9e2bb381efbc", "filename": "src/librustc_codegen_llvm/back/link.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -26,7 +26,7 @@ use rustc::middle::cstore::{NativeLibrary, LibSource, NativeLibraryKind};\n use rustc::middle::dependency_format::Linkage;\n use {CodegenResults, CrateInfo};\n use rustc::util::common::time;\n-use rustc::util::fs::fix_windows_verbatim_for_gcc;\n+use rustc_fs_util::fix_windows_verbatim_for_gcc;\n use rustc::hir::def_id::CrateNum;\n use tempfile::{Builder as TempFileBuilder, TempDir};\n use rustc_target::spec::{PanicStrategy, RelroLevel, LinkerFlavor};"}, {"sha": "7630849d67546b037e52352299cf228c263e2692", "filename": "src/librustc_codegen_llvm/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -31,7 +31,7 @@ use rustc::hir::def_id::{CrateNum, LOCAL_CRATE};\n use rustc::ty::TyCtxt;\n use rustc::util::common::{time_ext, time_depth, set_time_depth, print_time_passes_entry};\n use rustc::util::common::path2cstr;\n-use rustc::util::fs::{link_or_copy};\n+use rustc_fs_util::link_or_copy;\n use errors::{self, Handler, Level, DiagnosticBuilder, FatalError, DiagnosticId};\n use errors::emitter::{Emitter};\n use syntax::attr;"}, {"sha": "4572f5891a420a20c1e77acd1542fffd04c2e114", "filename": "src/librustc_codegen_llvm/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_codegen_llvm%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Flib.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -55,6 +55,7 @@ extern crate rustc_incremental;\n extern crate rustc_llvm;\n extern crate rustc_platform_intrinsics as intrinsics;\n extern crate rustc_codegen_utils;\n+extern crate rustc_fs_util;\n \n #[macro_use] extern crate log;\n #[macro_use] extern crate syntax;"}, {"sha": "e40b44204b349c03020656918d1a8eb6c23470a0", "filename": "src/librustc_fs_util/Cargo.toml", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_fs_util%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_fs_util%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_fs_util%2FCargo.toml?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -0,0 +1,11 @@\n+[package]\n+authors = [\"The Rust Project Developers\"]\n+name = \"rustc_fs_util\"\n+version = \"0.0.0\"\n+\n+[lib]\n+name = \"rustc_fs_util\"\n+path = \"lib.rs\"\n+crate-type = [\"dylib\"]\n+\n+[dependencies]"}, {"sha": "d25e187186ee0e2e77e72002da04d32e80f9626c", "filename": "src/librustc_fs_util/lib.rs", "status": "renamed", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_fs_util%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_fs_util%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_fs_util%2Flib.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -8,8 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use std::path::{self, Path, PathBuf};\n-use std::ffi::OsString;\n+use std::path::{Path, PathBuf};\n use std::fs;\n use std::io;\n \n@@ -29,10 +28,10 @@ use std::io;\n //\n // For some more information, see this comment:\n //   https://github.com/rust-lang/rust/issues/25505#issuecomment-102876737\n+#[cfg(windows)]\n pub fn fix_windows_verbatim_for_gcc(p: &Path) -> PathBuf {\n-    if !cfg!(windows) {\n-        return p.to_path_buf();\n-    }\n+    use std::path;\n+    use std::ffi::OsString;\n     let mut components = p.components();\n     let prefix = match components.next() {\n         Some(path::Component::Prefix(p)) => p,\n@@ -56,6 +55,11 @@ pub fn fix_windows_verbatim_for_gcc(p: &Path) -> PathBuf {\n     }\n }\n \n+#[cfg(not(windows))]\n+pub fn fix_windows_verbatim_for_gcc(p: &Path) -> PathBuf {\n+    p.to_path_buf()\n+}\n+\n pub enum LinkOrCopy {\n     Link,\n     Copy,", "previous_filename": "src/librustc/util/fs.rs"}, {"sha": "c3f6062e799d96b6b3628363820df819922c5f7e", "filename": "src/librustc_incremental/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2FCargo.toml?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -17,3 +17,4 @@ rustc_data_structures = { path = \"../librustc_data_structures\" }\n serialize = { path = \"../libserialize\" }\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n+rustc_fs_util = { path = \"../librustc_fs_util\" }"}, {"sha": "c17af24b4d5bbe40b87499fe6cf00e5fb667f0bd", "filename": "src/librustc_incremental/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Flib.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -23,6 +23,7 @@ extern crate graphviz;\n extern crate rustc_data_structures;\n extern crate serialize as rustc_serialize;\n extern crate rand;\n+extern crate rustc_fs_util;\n \n #[macro_use] extern crate log;\n extern crate syntax;"}, {"sha": "28d53dc7fb3c47a1fe5d2fa5406c1bb60a8b6622", "filename": "src/librustc_incremental/persist/fs.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Fpersist%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Fpersist%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Ffs.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -115,7 +115,7 @@\n //! implemented.\n \n use rustc::session::{Session, CrateDisambiguator};\n-use rustc::util::fs as fs_util;\n+use rustc_fs_util::{link_or_copy, LinkOrCopy};\n use rustc_data_structures::{flock, base_n};\n use rustc_data_structures::fx::{FxHashSet, FxHashMap};\n use rustc_data_structures::svh::Svh;\n@@ -429,11 +429,11 @@ fn copy_files(sess: &Session,\n                 let source_path = entry.path();\n \n                 debug!(\"copying into session dir: {}\", source_path.display());\n-                match fs_util::link_or_copy(source_path, target_file_path) {\n-                    Ok(fs_util::LinkOrCopy::Link) => {\n+                match link_or_copy(source_path, target_file_path) {\n+                    Ok(LinkOrCopy::Link) => {\n                         files_linked += 1\n                     }\n-                    Ok(fs_util::LinkOrCopy::Copy) => {\n+                    Ok(LinkOrCopy::Copy) => {\n                         files_copied += 1\n                     }\n                     Err(_) => return Err(())"}, {"sha": "cfe59b1f672623d59a884283d87f8c075cca9939", "filename": "src/librustc_incremental/persist/work_product.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3177c6f3f164a4ff28d246c5028123251942164/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fwork_product.rs?ref=e3177c6f3f164a4ff28d246c5028123251942164", "patch": "@@ -13,7 +13,7 @@\n use persist::fs::*;\n use rustc::dep_graph::{WorkProduct, WorkProductId, WorkProductFileKind};\n use rustc::session::Session;\n-use rustc::util::fs::link_or_copy;\n+use rustc_fs_util::link_or_copy;\n use std::path::PathBuf;\n use std::fs as std_fs;\n "}]}