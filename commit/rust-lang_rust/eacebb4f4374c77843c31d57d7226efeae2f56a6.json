{"sha": "eacebb4f4374c77843c31d57d7226efeae2f56a6", "node_id": "C_kwDOAAsO6NoAKGVhY2ViYjRmNDM3NGM3Nzg0M2MzMWQ1N2Q3MjI2ZWZlYWUyZjU2YTY", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-05-02T01:41:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-02T01:41:56Z"}, "message": "Rollup merge of #96499 - jyn514:bootstrap-doctests, r=Mark-Simulacrum\n\nMake it possible to write doctests for bootstrap\n\nThis probably isn't super useful in practice, but it was easy to fix\nand avoids confusing errors about mismatched versions between beta and the default toolchain.", "tree": {"sha": "ab2c9aa15ab7887505e13e6a8d5b2086a0cb5b20", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab2c9aa15ab7887505e13e6a8d5b2086a0cb5b20"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eacebb4f4374c77843c31d57d7226efeae2f56a6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJibzbkCRBK7hj4Ov3rIwAAkx0IAJUUCvw+1t1DxBt9CRAP4v40\nNK7G+8wPYo+8tCtEfIrnhylwdpNC8wZusdJntSB9jfApeswVzlcg2J2DSX6y67La\nC1E0QVKY3PPUlI3qLEJ2GLQQkWTWtCWiYmPuZcCmH+oaHfFdzIx4AK3THVqW4imc\nqPPJoTfc5gHcYwXAy9n7HCFPfl8mQf36ihzMHY/TG+9B8F4S16dIpbHvI+6U7gCi\nVzd4q8tnT/b3Nz6vmQt6jyaMG+I7P3kfk7i8ZFZFd+l/NnUOeAIicatIAYIH7ddN\nucVPqz8Kkm/X51MjrDOiTGqGZxC0L1pi5d2h2AMJm1rO0LE6I1AkiWTUHwr+yCg=\n=dnby\n-----END PGP SIGNATURE-----\n", "payload": "tree ab2c9aa15ab7887505e13e6a8d5b2086a0cb5b20\nparent 1785f1549cec9eb7947e204d6146c20b2410c40d\nparent 2f287d6a3e200197919e5372ac74abb66ce038ad\nauthor Yuki Okushi <jtitor@2k36.org> 1651455716 +0900\ncommitter GitHub <noreply@github.com> 1651455716 +0900\n\nRollup merge of #96499 - jyn514:bootstrap-doctests, r=Mark-Simulacrum\n\nMake it possible to write doctests for bootstrap\n\nThis probably isn't super useful in practice, but it was easy to fix\nand avoids confusing errors about mismatched versions between beta and the default toolchain.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eacebb4f4374c77843c31d57d7226efeae2f56a6", "html_url": "https://github.com/rust-lang/rust/commit/eacebb4f4374c77843c31d57d7226efeae2f56a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eacebb4f4374c77843c31d57d7226efeae2f56a6/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1785f1549cec9eb7947e204d6146c20b2410c40d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1785f1549cec9eb7947e204d6146c20b2410c40d", "html_url": "https://github.com/rust-lang/rust/commit/1785f1549cec9eb7947e204d6146c20b2410c40d"}, {"sha": "2f287d6a3e200197919e5372ac74abb66ce038ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f287d6a3e200197919e5372ac74abb66ce038ad", "html_url": "https://github.com/rust-lang/rust/commit/2f287d6a3e200197919e5372ac74abb66ce038ad"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "4dfc02dea460572b8a724338f2f95319fd36b1f0", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/eacebb4f4374c77843c31d57d7226efeae2f56a6/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eacebb4f4374c77843c31d57d7226efeae2f56a6/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=eacebb4f4374c77843c31d57d7226efeae2f56a6", "patch": "@@ -2359,6 +2359,7 @@ impl Step for Bootstrap {\n             .env(\"RUSTFLAGS\", \"-Cdebuginfo=2\")\n             .env(\"CARGO_TARGET_DIR\", builder.out.join(\"bootstrap\"))\n             .env(\"RUSTC_BOOTSTRAP\", \"1\")\n+            .env(\"RUSTDOC\", builder.rustdoc(builder.compiler(0, builder.build.build)))\n             .env(\"RUSTC\", &builder.initial_rustc);\n         if let Some(flags) = option_env!(\"RUSTFLAGS\") {\n             // Use the same rustc flags for testing as for \"normal\" compilation,\n@@ -2369,6 +2370,16 @@ impl Step for Bootstrap {\n         if !builder.fail_fast {\n             cmd.arg(\"--no-fail-fast\");\n         }\n+        match builder.doc_tests {\n+            DocTests::Only => {\n+                cmd.arg(\"--doc\");\n+            }\n+            DocTests::No => {\n+                cmd.args(&[\"--lib\", \"--bins\", \"--examples\", \"--tests\", \"--benches\"]);\n+            }\n+            DocTests::Yes => {}\n+        }\n+\n         cmd.arg(\"--\").args(&builder.config.cmd.test_args());\n         // rustbuild tests are racy on directory creation so just run them one at a time.\n         // Since there's not many this shouldn't be a problem."}]}