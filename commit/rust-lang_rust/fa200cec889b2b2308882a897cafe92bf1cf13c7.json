{"sha": "fa200cec889b2b2308882a897cafe92bf1cf13c7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhMjAwY2VjODg5YjJiMjMwODg4MmE4OTdjYWZlOTJiZjFjZjEzYzc=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-04T13:45:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-04T13:45:50Z"}, "message": "Rollup merge of #77525 - tmiasko:nrvo-2, r=jonas-schievink\n\nEnable RenameReturnPlace MIR optimization on mir-opt-level >= 2\n\nThe destination propagation as currently implemented does not supersede the NRVO, e.g., the destination propagation never applies if either local has an address taken, while NRVO might.\n\nAdditionally, the issue with failing assertions had been already resolved.\n\nContinue running both optimizations at mir-opt-level >= 2.", "tree": {"sha": "686f88df57cab7207ece45e3678c0b262a292f4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/686f88df57cab7207ece45e3678c0b262a292f4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa200cec889b2b2308882a897cafe92bf1cf13c7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfedIOCRBK7hj4Ov3rIwAAdHIIACRmz1NTuw3HzwrZ57A4+pHY\ndpLIkoRlJG5Nb3tSMk1Aopw3aA6+6JxY0aDK6hPRRJFqUkqC6UnnTR5isVd0x19N\nCG9JeDEvkwcPcz16TZMNpMnKNtork42H3G7JR5iV3emmRwu4BKQrYBpTxfdSTjc4\nZkBwz2RRhiX/bolPLQrsmQQ6Nkzs7UcIboyaL/jtGnQM5ARVPw9rWz6/UJLlOKnd\nteHllSRjsXlXrJ0hMorJdd+X11hbFdjSPLcMEg2Z19jKiyKTnjIxjlhf+hzBQG1Y\nrB78qfHEICubaLr+Yl5tFtiJVJp0oZ7SwQpjr5ReO6wX66LHeCDo0F/xCpDjO3c=\n=ubGF\n-----END PGP SIGNATURE-----\n", "payload": "tree 686f88df57cab7207ece45e3678c0b262a292f4f\nparent 5889cf314655a0d62f7e776c15ecd33cc20915bb\nparent 59c243331d60e74290102d5450587adf58597dd5\nauthor Jonas Schievink <jonasschievink@gmail.com> 1601819150 +0200\ncommitter GitHub <noreply@github.com> 1601819150 +0200\n\nRollup merge of #77525 - tmiasko:nrvo-2, r=jonas-schievink\n\nEnable RenameReturnPlace MIR optimization on mir-opt-level >= 2\n\nThe destination propagation as currently implemented does not supersede the NRVO, e.g., the destination propagation never applies if either local has an address taken, while NRVO might.\n\nAdditionally, the issue with failing assertions had been already resolved.\n\nContinue running both optimizations at mir-opt-level >= 2.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa200cec889b2b2308882a897cafe92bf1cf13c7", "html_url": "https://github.com/rust-lang/rust/commit/fa200cec889b2b2308882a897cafe92bf1cf13c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa200cec889b2b2308882a897cafe92bf1cf13c7/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5889cf314655a0d62f7e776c15ecd33cc20915bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/5889cf314655a0d62f7e776c15ecd33cc20915bb", "html_url": "https://github.com/rust-lang/rust/commit/5889cf314655a0d62f7e776c15ecd33cc20915bb"}, {"sha": "59c243331d60e74290102d5450587adf58597dd5", "url": "https://api.github.com/repos/rust-lang/rust/commits/59c243331d60e74290102d5450587adf58597dd5", "html_url": "https://github.com/rust-lang/rust/commit/59c243331d60e74290102d5450587adf58597dd5"}], "stats": {"total": 6, "additions": 0, "deletions": 6}, "files": [{"sha": "3673b6a4aa223c2e5e9c0b9dd139c3133aed904e", "filename": "compiler/rustc_mir/src/transform/nrvo.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fa200cec889b2b2308882a897cafe92bf1cf13c7/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fnrvo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa200cec889b2b2308882a897cafe92bf1cf13c7/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fnrvo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fnrvo.rs?ref=fa200cec889b2b2308882a897cafe92bf1cf13c7", "patch": "@@ -36,12 +36,6 @@ impl<'tcx> MirPass<'tcx> for RenameReturnPlace {\n             return;\n         }\n \n-        if tcx.sess.opts.debugging_opts.mir_opt_level >= 2 {\n-            // The `DestinationPropagation` pass runs at level 2, so this pass is redundant (and\n-            // fails some asserts).\n-            return;\n-        }\n-\n         let returned_local = match local_eligible_for_nrvo(body) {\n             Some(l) => l,\n             None => {"}]}