{"sha": "5c88a1cd54f709823431cd5eac67fc24d3d59b30", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjODhhMWNkNTRmNzA5ODIzNDMxY2Q1ZWFjNjdmYzI0ZDNkNTliMzA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-11-20T00:07:09Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-11-20T01:01:07Z"}, "message": "Add -C inline-threshold\n\nCorresponds directly to llvm's inline-threshold", "tree": {"sha": "85154eb2e1a8e8cf4c7aec1798e2d523a4112b4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85154eb2e1a8e8cf4c7aec1798e2d523a4112b4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c88a1cd54f709823431cd5eac67fc24d3d59b30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c88a1cd54f709823431cd5eac67fc24d3d59b30", "html_url": "https://github.com/rust-lang/rust/commit/5c88a1cd54f709823431cd5eac67fc24d3d59b30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c88a1cd54f709823431cd5eac67fc24d3d59b30/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6861c51453963317849b4488ddc6a110e4f3470a", "url": "https://api.github.com/repos/rust-lang/rust/commits/6861c51453963317849b4488ddc6a110e4f3470a", "html_url": "https://github.com/rust-lang/rust/commit/6861c51453963317849b4488ddc6a110e4f3470a"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "4781992b9875d76a215ad67b5af1636ceb9da87f", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5c88a1cd54f709823431cd5eac67fc24d3d59b30/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c88a1cd54f709823431cd5eac67fc24d3d59b30/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=5c88a1cd54f709823431cd5eac67fc24d3d59b30", "patch": "@@ -513,6 +513,8 @@ options! {CodegenOptions, CodegenSetter, basic_codegen_options,\n         \"optimize with possible levels 0-3\"),\n     debug_assertions: Option<bool> = (None, parse_opt_bool,\n         \"explicitly enable the cfg(debug_assertions) directive\"),\n+    inline_threshold: Option<usize> = (None, parse_opt_uint,\n+        \"set the inlining threshold for\"),\n }\n \n "}, {"sha": "f2047814f27b19195bc6a12d8ca8ed8a4d53779f", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5c88a1cd54f709823431cd5eac67fc24d3d59b30/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c88a1cd54f709823431cd5eac67fc24d3d59b30/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=5c88a1cd54f709823431cd5eac67fc24d3d59b30", "patch": "@@ -264,6 +264,7 @@ pub struct ModuleConfig {\n     vectorize_loop: bool,\n     vectorize_slp: bool,\n     merge_functions: bool,\n+    inline_threshold: Option<usize>\n }\n \n unsafe impl Send for ModuleConfig { }\n@@ -289,6 +290,7 @@ impl ModuleConfig {\n             vectorize_loop: false,\n             vectorize_slp: false,\n             merge_functions: false,\n+            inline_threshold: None\n         }\n     }\n \n@@ -297,6 +299,7 @@ impl ModuleConfig {\n         self.no_prepopulate_passes = sess.opts.cg.no_prepopulate_passes;\n         self.no_builtins = trans.no_builtins;\n         self.time_passes = sess.time_passes();\n+        self.inline_threshold = sess.opts.cg.inline_threshold;\n \n         // Copy what clang does by turning on loop vectorization at O2 and\n         // slp vectorization at O3. Otherwise configure other optimization aspects\n@@ -1005,6 +1008,7 @@ pub unsafe fn with_llvm_pmb(llmod: ModuleRef,\n     // manager.\n     let builder = llvm::LLVMPassManagerBuilderCreate();\n     let opt = config.opt_level.unwrap_or(llvm::CodeGenLevelNone);\n+    let inline_threshold = config.inline_threshold;\n \n     llvm::LLVMRustConfigurePassManagerBuilder(builder, opt,\n                                               config.merge_functions,\n@@ -1017,17 +1021,20 @@ pub unsafe fn with_llvm_pmb(llmod: ModuleRef,\n     // always-inline functions (but don't add lifetime intrinsics), at O1 we\n     // inline with lifetime intrinsics, and O2+ we add an inliner with a\n     // thresholds copied from clang.\n-    match opt {\n-        llvm::CodeGenLevelNone => {\n+    match (opt, inline_threshold) {\n+        (_, Some(t)) => {\n+            llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, t as u32);\n+        }\n+        (llvm::CodeGenLevelNone, _) => {\n             llvm::LLVMRustAddAlwaysInlinePass(builder, false);\n         }\n-        llvm::CodeGenLevelLess => {\n+        (llvm::CodeGenLevelLess, _) => {\n             llvm::LLVMRustAddAlwaysInlinePass(builder, true);\n         }\n-        llvm::CodeGenLevelDefault => {\n+        (llvm::CodeGenLevelDefault, _) => {\n             llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, 225);\n         }\n-        llvm::CodeGenLevelAggressive => {\n+        (llvm::CodeGenLevelAggressive, _) => {\n             llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, 275);\n         }\n     }"}]}