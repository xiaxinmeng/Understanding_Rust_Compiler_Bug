{"sha": "7f20198632bc2079d4deb4c213ec4876c47ec5d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmMjAxOTg2MzJiYzIwNzlkNGRlYjRjMjEzZWM0ODc2YzQ3ZWM1ZDI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-30T09:16:19Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-30T09:16:19Z"}, "message": "pass Queries to compiler callbacks", "tree": {"sha": "c000bfcd05ceaf59708ba13a85c30155095ba905", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c000bfcd05ceaf59708ba13a85c30155095ba905"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f20198632bc2079d4deb4c213ec4876c47ec5d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f20198632bc2079d4deb4c213ec4876c47ec5d2", "html_url": "https://github.com/rust-lang/rust/commit/7f20198632bc2079d4deb4c213ec4876c47ec5d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f20198632bc2079d4deb4c213ec4876c47ec5d2/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f1bbd69e13c9e04a4c2b75612bc0c31af972439", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f1bbd69e13c9e04a4c2b75612bc0c31af972439", "html_url": "https://github.com/rust-lang/rust/commit/8f1bbd69e13c9e04a4c2b75612bc0c31af972439"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "37fc8d0a55498e6b0a4b56e3bce203f4e71953d3", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/7f20198632bc2079d4deb4c213ec4876c47ec5d2/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f20198632bc2079d4deb4c213ec4876c47ec5d2/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=7f20198632bc2079d4deb4c213ec4876c47ec5d2", "patch": "@@ -41,7 +41,7 @@ use rustc::util::common::{set_time_depth, time, print_time_passes_entry, ErrorRe\n use rustc_metadata::locator;\n use rustc_codegen_utils::codegen_backend::CodegenBackend;\n use errors::{PResult, registry::Registry};\n-use rustc_interface::interface;\n+use rustc_interface::{interface, Queries};\n use rustc_interface::util::get_codegen_sysroot;\n use rustc_data_structures::sync::SeqCst;\n \n@@ -99,17 +99,29 @@ pub trait Callbacks {\n     fn config(&mut self, _config: &mut interface::Config) {}\n     /// Called after parsing. Return value instructs the compiler whether to\n     /// continue the compilation afterwards (defaults to `Compilation::Continue`)\n-    fn after_parsing(&mut self, _compiler: &interface::Compiler) -> Compilation {\n+    fn after_parsing<'tcx>(\n+        &mut self,\n+        _compiler: &interface::Compiler,\n+        _queries: &'tcx Queries<'tcx>,\n+    ) -> Compilation {\n         Compilation::Continue\n     }\n     /// Called after expansion. Return value instructs the compiler whether to\n     /// continue the compilation afterwards (defaults to `Compilation::Continue`)\n-    fn after_expansion(&mut self, _compiler: &interface::Compiler) -> Compilation {\n+    fn after_expansion<'tcx>(\n+        &mut self,\n+        _compiler: &interface::Compiler,\n+        _queries: &'tcx Queries<'tcx>,\n+    ) -> Compilation {\n         Compilation::Continue\n     }\n     /// Called after analysis. Return value instructs the compiler whether to\n     /// continue the compilation afterwards (defaults to `Compilation::Continue`)\n-    fn after_analysis(&mut self, _compiler: &interface::Compiler) -> Compilation {\n+    fn after_analysis<'tcx>(\n+        &mut self,\n+        _compiler: &interface::Compiler,\n+        _queries: &'tcx Queries<'tcx>,\n+    ) -> Compilation {\n         Compilation::Continue\n     }\n }\n@@ -313,7 +325,7 @@ pub fn run_compiler(\n                 return early_exit();\n             }\n \n-            if callbacks.after_parsing(compiler) == Compilation::Stop {\n+            if callbacks.after_parsing(compiler, queries) == Compilation::Stop {\n                 return early_exit();\n             }\n \n@@ -334,7 +346,7 @@ pub fn run_compiler(\n             }\n \n             queries.expansion()?;\n-            if callbacks.after_expansion(compiler) == Compilation::Stop {\n+            if callbacks.after_expansion(compiler, queries) == Compilation::Stop {\n                 return early_exit();\n             }\n \n@@ -383,7 +395,7 @@ pub fn run_compiler(\n \n             queries.global_ctxt()?.peek_mut().enter(|tcx| tcx.analysis(LOCAL_CRATE))?;\n \n-            if callbacks.after_analysis(compiler) == Compilation::Stop {\n+            if callbacks.after_analysis(compiler, queries) == Compilation::Stop {\n                 return early_exit();\n             }\n "}, {"sha": "76af4342f5c9ef0c59877cdb020394bd6287b98f", "filename": "src/librustc_interface/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7f20198632bc2079d4deb4c213ec4876c47ec5d2/src%2Flibrustc_interface%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f20198632bc2079d4deb4c213ec4876c47ec5d2/src%2Flibrustc_interface%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Flib.rs?ref=7f20198632bc2079d4deb4c213ec4876c47ec5d2", "patch": "@@ -18,6 +18,7 @@ pub mod util;\n mod proc_macro_decls;\n \n pub use interface::{run_compiler, Config};\n+pub use queries::Queries;\n \n #[cfg(test)]\n mod tests;"}]}