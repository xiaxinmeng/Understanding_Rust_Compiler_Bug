{"sha": "20f2958b8af32dd08173272a7ede09aaa255c980", "node_id": "C_kwDOAAsO6NoAKDIwZjI5NThiOGFmMzJkZDA4MTczMjcyYTdlZGUwOWFhYTI1NWM5ODA", "commit": {"author": {"name": "Xiretza", "email": "xiretza@xiretza.xyz", "date": "2022-10-20T19:17:14Z"}, "committer": {"name": "Xiretza", "email": "xiretza@xiretza.xyz", "date": "2022-10-26T13:04:09Z"}, "message": "Add \"tool-only\" suggestion style", "tree": {"sha": "b5b1a6ccb04f195519a69912baad8ec6e2609e2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5b1a6ccb04f195519a69912baad8ec6e2609e2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20f2958b8af32dd08173272a7ede09aaa255c980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20f2958b8af32dd08173272a7ede09aaa255c980", "html_url": "https://github.com/rust-lang/rust/commit/20f2958b8af32dd08173272a7ede09aaa255c980", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20f2958b8af32dd08173272a7ede09aaa255c980/comments", "author": {"login": "Xiretza", "id": 3107142, "node_id": "MDQ6VXNlcjMxMDcxNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3107142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Xiretza", "html_url": "https://github.com/Xiretza", "followers_url": "https://api.github.com/users/Xiretza/followers", "following_url": "https://api.github.com/users/Xiretza/following{/other_user}", "gists_url": "https://api.github.com/users/Xiretza/gists{/gist_id}", "starred_url": "https://api.github.com/users/Xiretza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Xiretza/subscriptions", "organizations_url": "https://api.github.com/users/Xiretza/orgs", "repos_url": "https://api.github.com/users/Xiretza/repos", "events_url": "https://api.github.com/users/Xiretza/events{/privacy}", "received_events_url": "https://api.github.com/users/Xiretza/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Xiretza", "id": 3107142, "node_id": "MDQ6VXNlcjMxMDcxNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3107142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Xiretza", "html_url": "https://github.com/Xiretza", "followers_url": "https://api.github.com/users/Xiretza/followers", "following_url": "https://api.github.com/users/Xiretza/following{/other_user}", "gists_url": "https://api.github.com/users/Xiretza/gists{/gist_id}", "starred_url": "https://api.github.com/users/Xiretza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Xiretza/subscriptions", "organizations_url": "https://api.github.com/users/Xiretza/orgs", "repos_url": "https://api.github.com/users/Xiretza/repos", "events_url": "https://api.github.com/users/Xiretza/events{/privacy}", "received_events_url": "https://api.github.com/users/Xiretza/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29334b951a6ab997d63d72a496454a0455ce5ee2", "url": "https://api.github.com/repos/rust-lang/rust/commits/29334b951a6ab997d63d72a496454a0455ce5ee2", "html_url": "https://github.com/rust-lang/rust/commit/29334b951a6ab997d63d72a496454a0455ce5ee2"}], "stats": {"total": 38, "additions": 24, "deletions": 14}, "files": [{"sha": "99ecaaae0e8c8d91ac7e28c9b9649fb7bf044d64", "filename": "compiler/rustc_macros/src/diagnostics/utils.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/20f2958b8af32dd08173272a7ede09aaa255c980/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20f2958b8af32dd08173272a7ede09aaa255c980/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fdiagnostics%2Futils.rs?ref=20f2958b8af32dd08173272a7ede09aaa255c980", "patch": "@@ -474,14 +474,11 @@ pub(super) fn build_suggestion_code(\n /// Possible styles for suggestion subdiagnostics.\n #[derive(Clone, Copy, PartialEq)]\n pub(super) enum SuggestionKind {\n-    /// `#[suggestion]`\n     Normal,\n-    /// `#[suggestion_short]`\n     Short,\n-    /// `#[suggestion_hidden]`\n     Hidden,\n-    /// `#[suggestion_verbose]`\n     Verbose,\n+    ToolOnly,\n }\n \n impl FromStr for SuggestionKind {\n@@ -493,6 +490,7 @@ impl FromStr for SuggestionKind {\n             \"short\" => Ok(SuggestionKind::Short),\n             \"hidden\" => Ok(SuggestionKind::Hidden),\n             \"verbose\" => Ok(SuggestionKind::Verbose),\n+            \"tool-only\" => Ok(SuggestionKind::ToolOnly),\n             _ => Err(()),\n         }\n     }\n@@ -513,6 +511,9 @@ impl SuggestionKind {\n             SuggestionKind::Verbose => {\n                 quote! { rustc_errors::SuggestionStyle::ShowAlways }\n             }\n+            SuggestionKind::ToolOnly => {\n+                quote! { rustc_errors::SuggestionStyle::CompletelyHidden }\n+            }\n         }\n     }\n \n@@ -583,6 +584,8 @@ impl SubdiagnosticKind {\n             \"help\" => SubdiagnosticKind::Help,\n             \"warning\" => SubdiagnosticKind::Warn,\n             _ => {\n+                // FIXME(#100717): remove #[suggestion_{short,verbose,hidden}] attributes, use\n+                // #[suggestion(style = \"...\")] instead\n                 if let Some(suggestion_kind) =\n                     name.strip_prefix(\"suggestion\").and_then(SuggestionKind::from_suffix)\n                 {\n@@ -719,7 +722,7 @@ impl SubdiagnosticKind {\n \n                     let value = value.value().parse().unwrap_or_else(|()| {\n                         span_err(value.span().unwrap(), \"invalid suggestion style\")\n-                            .help(\"valid styles are `normal`, `short`, `hidden` and `verbose`\")\n+                            .help(\"valid styles are `normal`, `short`, `hidden`, `verbose` and `tool-only`\")\n                             .emit();\n                         SuggestionKind::Normal\n                     });"}, {"sha": "7d9e2576cae3cb5ef8a93cccf35bbeb2148c239c", "filename": "src/test/ui-fulldeps/session-diagnostic/subdiagnostic-derive.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/20f2958b8af32dd08173272a7ede09aaa255c980/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20f2958b8af32dd08173272a7ede09aaa255c980/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.rs?ref=20f2958b8af32dd08173272a7ede09aaa255c980", "patch": "@@ -735,6 +735,13 @@ struct SuggestionStyleVerbose {\n     sub: Span,\n }\n \n+#[derive(Subdiagnostic)]\n+#[suggestion(parser_add_paren, code = \"\", style = \"tool-only\")]\n+struct SuggestionStyleToolOnly {\n+    #[primary_span]\n+    sub: Span,\n+}\n+\n #[derive(Subdiagnostic)]\n #[suggestion(parser_add_paren, code = \"\", style = \"hidden\", style = \"normal\")]\n //~^ ERROR specified multiple times"}, {"sha": "b76b7fdfceac9336ffc4f1ac132b968a10d15111", "filename": "src/test/ui-fulldeps/session-diagnostic/subdiagnostic-derive.stderr", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/20f2958b8af32dd08173272a7ede09aaa255c980/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/20f2958b8af32dd08173272a7ede09aaa255c980/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fsession-diagnostic%2Fsubdiagnostic-derive.stderr?ref=20f2958b8af32dd08173272a7ede09aaa255c980", "patch": "@@ -446,53 +446,53 @@ LL |     #[suggestion_part(code = 3)]\n    |                       ^^^^^^^^\n \n error: specified multiple times\n-  --> $DIR/subdiagnostic-derive.rs:739:61\n+  --> $DIR/subdiagnostic-derive.rs:746:61\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style = \"hidden\", style = \"normal\")]\n    |                                                             ^^^^^^^^^^^^^^^^\n    |\n note: previously specified here\n-  --> $DIR/subdiagnostic-derive.rs:739:43\n+  --> $DIR/subdiagnostic-derive.rs:746:43\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style = \"hidden\", style = \"normal\")]\n    |                                           ^^^^^^^^^^^^^^^^\n \n error: specified multiple times\n-  --> $DIR/subdiagnostic-derive.rs:748:50\n+  --> $DIR/subdiagnostic-derive.rs:755:50\n    |\n LL | #[suggestion_hidden(parser_add_paren, code = \"\", style = \"normal\")]\n    |                                                  ^^^^^^^^^^^^^^^^\n    |\n note: previously specified here\n-  --> $DIR/subdiagnostic-derive.rs:748:3\n+  --> $DIR/subdiagnostic-derive.rs:755:3\n    |\n LL | #[suggestion_hidden(parser_add_paren, code = \"\", style = \"normal\")]\n    |   ^^^^^^^^^^^^^^^^^\n \n error: invalid suggestion style\n-  --> $DIR/subdiagnostic-derive.rs:757:51\n+  --> $DIR/subdiagnostic-derive.rs:764:51\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style = \"foo\")]\n    |                                                   ^^^^^\n    |\n-   = help: valid styles are `normal`, `short`, `hidden` and `verbose`\n+   = help: valid styles are `normal`, `short`, `hidden`, `verbose` and `tool-only`\n \n error: `#[suggestion(style = ...)]` is not a valid attribute\n-  --> $DIR/subdiagnostic-derive.rs:765:43\n+  --> $DIR/subdiagnostic-derive.rs:772:43\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style = 42)]\n    |                                           ^^^^^^^^^^\n \n error: `#[suggestion(style)]` is not a valid attribute\n-  --> $DIR/subdiagnostic-derive.rs:773:43\n+  --> $DIR/subdiagnostic-derive.rs:780:43\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style)]\n    |                                           ^^^^^\n    |\n    = help: a diagnostic slug must be the first argument to the attribute\n \n error: `#[suggestion(style(...))]` is not a valid attribute\n-  --> $DIR/subdiagnostic-derive.rs:781:43\n+  --> $DIR/subdiagnostic-derive.rs:788:43\n    |\n LL | #[suggestion(parser_add_paren, code = \"\", style(\"foo\"))]\n    |                                           ^^^^^^^^^^^^"}]}