{"sha": "1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFmN2JmYWM5ZDI4MzQwYjNlZGEwMjkxZGQwMWI3OTE0Yzc3YTg4YWU=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-11-06T03:16:19Z"}, "committer": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-11-26T04:13:17Z"}, "message": "rustc: Add lint for obsolete attributes\n\nThis also moves `#[auto_{en,de}code]` checker from syntax to lint.", "tree": {"sha": "3172ab5e859df955ed453f8a6b7603dec054eeab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3172ab5e859df955ed453f8a6b7603dec054eeab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "html_url": "https://github.com/rust-lang/rust/commit/1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ff697d3933754bf9ec5ee5875f487f02a7d087d", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ff697d3933754bf9ec5ee5875f487f02a7d087d", "html_url": "https://github.com/rust-lang/rust/commit/6ff697d3933754bf9ec5ee5875f487f02a7d087d"}], "stats": {"total": 72, "additions": 13, "deletions": 59}, "files": [{"sha": "bbb835c2032ece29f4d0f5307e07fc8e6992aae6", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "patch": "@@ -803,6 +803,11 @@ fn check_heap_item(cx: &Context, it: &ast::item) {\n // also make error on obsolete attributes for less confusion.\n fn check_item_attribute_usage(cx: &Context, it: &ast::item) {\n     let crate_attrs = [\"crate_type\", \"link\", \"feature\", \"no_uv\", \"no_main\", \"no_std\"];\n+    let obsolete_attrs = [\n+        (\"abi\", \"extern \\\"abi\\\" fn\"),\n+        (\"auto_encode\", \"#[deriving(Encodable)]\"),\n+        (\"auto_decode\", \"#[deriving(Decodable)]\"),\n+    ];\n \n     for attr in it.attrs.iter() {\n         let name = attr.node.value.name();\n@@ -816,6 +821,13 @@ fn check_item_attribute_usage(cx: &Context, it: &ast::item) {\n                 cx.span_lint(attribute_usage, attr.span, msg);\n             }\n         }\n+\n+        for &(obs_attr, obs_alter) in obsolete_attrs.iter() {\n+            if name.equiv(&obs_attr) {\n+                cx.span_lint(attribute_usage, attr.span,\n+                             format!(\"obsolete attribute: use `{:s}` instead\", obs_alter));\n+            }\n+        }\n     }\n }\n "}, {"sha": "292b0a2e78f2be2ca5bcf3dd2770631597f9ca6d", "filename": "src/libstd/io/native/process.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibstd%2Fio%2Fnative%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibstd%2Fio%2Fnative%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fnative%2Fprocess.rs?ref=1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "patch": "@@ -365,7 +365,6 @@ fn spawn_process_os(prog: &str, args: &[~str],\n     use libc::funcs::bsd44::getdtablesize;\n \n     mod rustrt {\n-        #[abi = \"cdecl\"]\n         extern {\n             pub fn rust_unset_sigprocmask();\n         }"}, {"sha": "c1e7ba60fade4e1d55ccae928583cc3835e49621", "filename": "src/libsyntax/ext/auto_encode.rs", "status": "removed", "additions": 0, "deletions": 35, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/6ff697d3933754bf9ec5ee5875f487f02a7d087d/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ff697d3933754bf9ec5ee5875f487f02a7d087d/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fauto_encode.rs?ref=6ff697d3933754bf9ec5ee5875f487f02a7d087d", "patch": "@@ -1,35 +0,0 @@\n-// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-/// Deprecated #[auto_encode] and #[auto_decode] syntax extensions\n-\n-use ast;\n-use codemap::Span;\n-use ext::base::*;\n-\n-pub fn expand_auto_encode(\n-    cx: @ExtCtxt,\n-    span: Span,\n-    _mitem: @ast::MetaItem,\n-    in_items: ~[@ast::item]\n-) -> ~[@ast::item] {\n-    cx.span_err(span, \"`#[auto_encode]` is deprecated, use `#[deriving(Encodable)]` instead\");\n-    in_items\n-}\n-\n-pub fn expand_auto_decode(\n-    cx: @ExtCtxt,\n-    span: Span,\n-    _mitem: @ast::MetaItem,\n-    in_items: ~[@ast::item]\n-) -> ~[@ast::item] {\n-    cx.span_err(span, \"`#[auto_decode]` is deprecated, use `#[deriving(Decodable)]` instead\");\n-    in_items\n-}"}, {"sha": "ccb88e0c9c0195462aebba52f7e3581dcaf80243", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "patch": "@@ -143,7 +143,7 @@ pub enum MacResult {\n }\n \n pub enum SyntaxExtension {\n-    // #[auto_encode] and such\n+    // #[deriving] and such\n     ItemDecorator(ItemDecorator),\n \n     // Token-tree expanders\n@@ -229,12 +229,6 @@ pub fn syntax_expander_table() -> SyntaxEnv {\n     syntax_expanders.insert(intern(&\"format_args\"),\n                             builtin_normal_tt_no_ctxt(\n                                 ext::format::expand_args));\n-    syntax_expanders.insert(\n-        intern(&\"auto_encode\"),\n-        @SE(ItemDecorator(ext::auto_encode::expand_auto_encode)));\n-    syntax_expanders.insert(\n-        intern(&\"auto_decode\"),\n-        @SE(ItemDecorator(ext::auto_encode::expand_auto_decode)));\n     syntax_expanders.insert(intern(&\"env\"),\n                             builtin_normal_tt_no_ctxt(\n                                     ext::env::expand_env));"}, {"sha": "29ed87f2202838768bdd48868f540a6a5645438c", "filename": "src/libsyntax/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibsyntax%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f7bfac9d28340b3eda0291dd01b7914c77a88ae/src%2Flibsyntax%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Flib.rs?ref=1f7bfac9d28340b3eda0291dd01b7914c77a88ae", "patch": "@@ -83,7 +83,6 @@ pub mod ext {\n     pub mod concat;\n     pub mod concat_idents;\n     pub mod log_syntax;\n-    pub mod auto_encode;\n     pub mod source_util;\n \n     pub mod trace_macros;"}, {"sha": "e4576e0f57c54122c5c7e87cf4bd0b864a6a36ff", "filename": "src/test/compile-fail/deprecated-auto-code.rs", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6ff697d3933754bf9ec5ee5875f487f02a7d087d/src%2Ftest%2Fcompile-fail%2Fdeprecated-auto-code.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ff697d3933754bf9ec5ee5875f487f02a7d087d/src%2Ftest%2Fcompile-fail%2Fdeprecated-auto-code.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fdeprecated-auto-code.rs?ref=6ff697d3933754bf9ec5ee5875f487f02a7d087d", "patch": "@@ -1,15 +0,0 @@\n-// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#[auto_encode] //~ ERROR: `#[auto_encode]` is deprecated\n-#[auto_decode] //~ ERROR: `#[auto_decode]` is deprecated\n-struct A;\n-\n-fn main() {}"}]}