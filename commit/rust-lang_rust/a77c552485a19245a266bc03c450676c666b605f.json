{"sha": "a77c552485a19245a266bc03c450676c666b605f", "node_id": "C_kwDOAAsO6NoAKGE3N2M1NTI0ODVhMTkyNDVhMjY2YmMwM2M0NTA2NzZjNjY2YjYwNWY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-06T21:15:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-06T21:15:25Z"}, "message": "Auto merge of #110972 - ehuss:remove-awscli, r=pietroalbini\n\nRemove aws cli install.\n\nAll runner images have the AWS CLI 2 installed, so there isn't a really strong reason to install our own version anymore.\n\nThe version we were installing was 1.27.122. The runner images currently have 2.11.x (the exact version varies by image).\n\nI do not have the means to really test if the new version has any issues. I looked at all the `aws` commands, and none of them seem to be doing anything unusual. The page at https://docs.aws.amazon.com/cli/latest/userguide/cliv2-migration-changes.html contains a list of all the breaking changes, and I didn't see anything that looked important.", "tree": {"sha": "0ae9f2d7b474638a418f912c61e2274a09d0866f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ae9f2d7b474638a418f912c61e2274a09d0866f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a77c552485a19245a266bc03c450676c666b605f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a77c552485a19245a266bc03c450676c666b605f", "html_url": "https://github.com/rust-lang/rust/commit/a77c552485a19245a266bc03c450676c666b605f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a77c552485a19245a266bc03c450676c666b605f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1", "html_url": "https://github.com/rust-lang/rust/commit/31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1"}, {"sha": "291b61e94fedd12de67c17c3fbae104a81d7115a", "url": "https://api.github.com/repos/rust-lang/rust/commits/291b61e94fedd12de67c17c3fbae104a81d7115a", "html_url": "https://github.com/rust-lang/rust/commit/291b61e94fedd12de67c17c3fbae104a81d7115a"}], "stats": {"total": 57, "additions": 6, "deletions": 51}, "files": [{"sha": "eb37fe9c801aea04cde8c7585e96dc0c3d9aa6cf", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a77c552485a19245a266bc03c450676c666b605f/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a77c552485a19245a266bc03c450676c666b605f/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=a77c552485a19245a266bc03c450676c666b605f", "patch": "@@ -98,9 +98,6 @@ jobs:\n       - name: show the current environment\n         run: src/ci/scripts/dump-environment.sh\n         if: success() && !env.SKIP_JOB\n-      - name: install awscli\n-        run: src/ci/scripts/install-awscli.sh\n-        if: success() && !env.SKIP_JOB\n       - name: install sccache\n         run: src/ci/scripts/install-sccache.sh\n         if: success() && !env.SKIP_JOB\n@@ -170,6 +167,7 @@ jobs:\n       TOOLSTATE_PUBLISH: 1\n       CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n       ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      AWS_REGION: us-west-1\n       CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && github.ref == 'refs/heads/auto' && github.repository == 'rust-lang-ci/rust'\"\n     strategy:\n@@ -521,9 +519,6 @@ jobs:\n       - name: show the current environment\n         run: src/ci/scripts/dump-environment.sh\n         if: success() && !env.SKIP_JOB\n-      - name: install awscli\n-        run: src/ci/scripts/install-awscli.sh\n-        if: success() && !env.SKIP_JOB\n       - name: install sccache\n         run: src/ci/scripts/install-sccache.sh\n         if: success() && !env.SKIP_JOB\n@@ -593,6 +588,7 @@ jobs:\n       TOOLSTATE_PUBLISH: 1\n       CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n       ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      AWS_REGION: us-west-1\n       CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && (github.ref == 'refs/heads/try' || github.ref == 'refs/heads/try-perf') && github.repository == 'rust-lang-ci/rust'\"\n     strategy:\n@@ -637,9 +633,6 @@ jobs:\n       - name: show the current environment\n         run: src/ci/scripts/dump-environment.sh\n         if: success() && !env.SKIP_JOB\n-      - name: install awscli\n-        run: src/ci/scripts/install-awscli.sh\n-        if: success() && !env.SKIP_JOB\n       - name: install sccache\n         run: src/ci/scripts/install-sccache.sh\n         if: success() && !env.SKIP_JOB\n@@ -706,6 +699,7 @@ jobs:\n       TOOLSTATE_PUBLISH: 1\n       CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n       ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      AWS_REGION: us-west-1\n       CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && github.ref == 'refs/heads/master' && github.repository == 'rust-lang-ci/rust'\"\n     steps:"}, {"sha": "8bea8cd4c878c17fb8afb66e9e131b570df3b629", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a77c552485a19245a266bc03c450676c666b605f/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a77c552485a19245a266bc03c450676c666b605f/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=a77c552485a19245a266bc03c450676c666b605f", "patch": "@@ -169,6 +169,7 @@ if [ \"$SCCACHE_BUCKET\" != \"\" ]; then\n     args=\"$args --env SCCACHE_REGION\"\n     args=\"$args --env AWS_ACCESS_KEY_ID\"\n     args=\"$args --env AWS_SECRET_ACCESS_KEY\"\n+    args=\"$args --env AWS_REGION\"\n else\n     mkdir -p $HOME/.cache/sccache\n     args=\"$args --env SCCACHE_DIR=/sccache --volume $HOME/.cache/sccache:/sccache\""}, {"sha": "7f2d34f8098eb8235c394387988b22c21cd09573", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a77c552485a19245a266bc03c450676c666b605f/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a77c552485a19245a266bc03c450676c666b605f/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=a77c552485a19245a266bc03c450676c666b605f", "patch": "@@ -53,6 +53,7 @@ x--expand-yaml-anchors--remove:\n     # (caches, artifacts...).\n     CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n     ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+    AWS_REGION: us-west-1\n     CACHE_DOMAIN: ci-caches.rust-lang.org\n \n   - &dummy-variables\n@@ -68,6 +69,7 @@ x--expand-yaml-anchors--remove:\n     # (caches, artifacts...).\n     CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZOMUQATD5\n     ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZH5AYXDVF\n+    AWS_REGION: us-west-1\n     CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n \n   - &base-job\n@@ -158,10 +160,6 @@ x--expand-yaml-anchors--remove:\n         run: src/ci/scripts/dump-environment.sh\n         <<: *step\n \n-      - name: install awscli\n-        run: src/ci/scripts/install-awscli.sh\n-        <<: *step\n-\n       - name: install sccache\n         run: src/ci/scripts/install-sccache.sh\n         <<: *step"}, {"sha": "aa62407eaea7df5f0ad3dd051d51f721c41a10fd", "filename": "src/ci/scripts/install-awscli.sh", "status": "removed", "additions": 0, "deletions": 38, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1/src%2Fci%2Fscripts%2Finstall-awscli.sh", "raw_url": "https://github.com/rust-lang/rust/raw/31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1/src%2Fci%2Fscripts%2Finstall-awscli.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-awscli.sh?ref=31a4f2da575f5e335bdbbe7f12a694f9e74ad0a1", "patch": "@@ -1,38 +0,0 @@\n-#!/bin/bash\n-# This script downloads and installs awscli from the packages mirrored in our\n-# own S3 bucket. This follows the recommendations at:\n-#\n-#    https://packaging.python.org/guides/index-mirrors-and-caches/#caching-with-pip\n-#\n-# To create a new mirrored copy you can run the command:\n-#\n-#    pip wheel awscli\n-#\n-# Before compressing please make sure all the wheels end with `-none-any.whl`.\n-# If that's not the case you'll need to remove the non-cross-platform ones and\n-# replace them with the .tar.gz downloaded from https://pypi.org.\n-\n-set -euo pipefail\n-IFS=$'\\n\\t'\n-\n-source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n-\n-MIRROR=\"${MIRRORS_BASE}/2023-04-28-awscli.tar\"\n-DEPS_DIR=\"/tmp/awscli-deps\"\n-\n-pip=\"pip\"\n-pipflags=\"\"\n-if isLinux; then\n-    pip=\"pip3\"\n-    pipflags=\"--user\"\n-\n-    sudo apt-get install -y python3-setuptools python3-wheel\n-    ciCommandAddPath \"${HOME}/.local/bin\"\n-elif isMacOS; then\n-    pip=\"pip3\"\n-fi\n-\n-mkdir -p \"${DEPS_DIR}\"\n-curl \"${MIRROR}\" | tar xf - -C \"${DEPS_DIR}\"\n-\"${pip}\" install ${pipflags} --no-index \"--find-links=${DEPS_DIR}\" awscli\n-rm -rf \"${DEPS_DIR}\""}]}