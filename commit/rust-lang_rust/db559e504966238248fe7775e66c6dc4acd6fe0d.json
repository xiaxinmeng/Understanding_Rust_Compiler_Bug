{"sha": "db559e504966238248fe7775e66c6dc4acd6fe0d", "node_id": "C_kwDOAAsO6NoAKGRiNTU5ZTUwNDk2NjIzODI0OGZlNzc3NWU2NmM2ZGM0YWNkNmZlMGQ", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-12-03T16:07:06Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-12-03T16:07:06Z"}, "message": "Simplify", "tree": {"sha": "4e7aee3bcde7c704fba8beff8ec8180176cdd977", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e7aee3bcde7c704fba8beff8ec8180176cdd977"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db559e504966238248fe7775e66c6dc4acd6fe0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db559e504966238248fe7775e66c6dc4acd6fe0d", "html_url": "https://github.com/rust-lang/rust/commit/db559e504966238248fe7775e66c6dc4acd6fe0d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db559e504966238248fe7775e66c6dc4acd6fe0d/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1677f3286d57009361eee85fb19d523c64b937c", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1677f3286d57009361eee85fb19d523c64b937c", "html_url": "https://github.com/rust-lang/rust/commit/d1677f3286d57009361eee85fb19d523c64b937c"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "e14cd43ede85640c86f2585733cef6d7e5c5a77c", "filename": "crates/hir/src/source_analyzer.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs?ref=db559e504966238248fe7775e66c6dc4acd6fe0d", "patch": "@@ -252,7 +252,9 @@ impl SourceAnalyzer {\n         db: &dyn HirDatabase,\n         path: &ast::Path,\n     ) -> Option<PathResolution> {\n-        let parent = || path.syntax().parent();\n+        let parent = path.syntax().parent();\n+        let parent = || parent.clone();\n+\n         let mut prefer_value_ns = false;\n         if let Some(path_expr) = parent().and_then(ast::PathExpr::cast) {\n             let expr_id = self.expr_id(db, &path_expr.into())?;\n@@ -337,10 +339,10 @@ impl SourceAnalyzer {\n             return match res {\n                 Some(_) => res.map(PathResolution::Macro),\n                 None => path.as_single_name_ref().and_then(|name_ref| {\n-                    if let Some(builtin) = BuiltinAttr::by_name(&name_ref.text()) {\n-                        Some(PathResolution::BuiltinAttr(builtin))\n-                    } else if let Some(tool) = Tool::by_name(&name_ref.text()) {\n-                        Some(PathResolution::Tool(tool))\n+                    if let builtin @ Some(_) = BuiltinAttr::by_name(&name_ref.text()) {\n+                        builtin.map(PathResolution::BuiltinAttr)\n+                    } else if let tool @ Some(_) = Tool::by_name(&name_ref.text()) {\n+                        tool.map(PathResolution::Tool)\n                     } else {\n                         None\n                     }\n@@ -355,6 +357,8 @@ impl SourceAnalyzer {\n         };\n         match res {\n             Some(_) => res,\n+            // this labels any path that starts with a tool module as the tool itself, this is technically wrong\n+            // but there is no benefit in differentiating these two cases for the time being\n             None if is_path_of_attr => path\n                 .first_segment()\n                 .and_then(|seg| seg.name_ref())"}, {"sha": "370f58080e6bb4379df5b15992961b023f571a13", "filename": "crates/ide/src/syntax_highlighting/test_data/highlighting.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html?ref=db559e504966238248fe7775e66c6dc4acd6fe0d", "patch": "@@ -43,6 +43,7 @@\n <pre><code><span class=\"keyword\">use</span> <span class=\"module\">inner</span><span class=\"operator\">::</span><span class=\"brace\">{</span><span class=\"self_keyword\">self</span> <span class=\"keyword\">as</span> <span class=\"module declaration\">inner_mod</span><span class=\"brace\">}</span><span class=\"semicolon\">;</span>\n <span class=\"keyword\">mod</span> <span class=\"module declaration\">inner</span> <span class=\"brace\">{</span><span class=\"brace\">}</span>\n \n+<span class=\"attribute attribute\">#</span><span class=\"attribute attribute\">[</span><span class=\"builtin_attr attribute library\">allow</span><span class=\"parenthesis attribute\">(</span><span class=\"parenthesis attribute\">)</span><span class=\"attribute attribute\">]</span>\n <span class=\"attribute attribute\">#</span><span class=\"attribute attribute\">[</span><span class=\"module attribute crate_root library\">proc_macros</span><span class=\"operator attribute\">::</span><span class=\"macro attribute library\">identity</span><span class=\"attribute attribute\">]</span>\n <span class=\"keyword\">pub</span> <span class=\"keyword\">mod</span> <span class=\"module declaration public\">ops</span> <span class=\"brace\">{</span>\n     <span class=\"attribute attribute\">#</span><span class=\"attribute attribute\">[</span><span class=\"builtin_attr attribute library\">lang</span> <span class=\"operator attribute\">=</span> <span class=\"string_literal attribute\">\"fn_once\"</span><span class=\"attribute attribute\">]</span>"}, {"sha": "63a1417c6aaa14f169c984ceebd21d4a36eeec24", "filename": "crates/ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db559e504966238248fe7775e66c6dc4acd6fe0d/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=db559e504966238248fe7775e66c6dc4acd6fe0d", "patch": "@@ -16,6 +16,7 @@ fn test_highlighting() {\n use inner::{self as inner_mod};\n mod inner {}\n \n+#[allow()]\n #[proc_macros::identity]\n pub mod ops {\n     #[lang = \"fn_once\"]"}]}