{"sha": "0065929599d276ce756a55948e8316615be1e7ec", "node_id": "C_kwDOAAsO6NoAKDAwNjU5Mjk1OTlkMjc2Y2U3NTZhNTU5NDhlODMxNjYxNWJlMWU3ZWM", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-07-18T18:41:27Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-07-19T17:36:45Z"}, "message": "Erase regions before comparing signatures of foreign fns.", "tree": {"sha": "79ea0ca2afddaa86ceed624868e35a5a209e704e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79ea0ca2afddaa86ceed624868e35a5a209e704e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0065929599d276ce756a55948e8316615be1e7ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0065929599d276ce756a55948e8316615be1e7ec", "html_url": "https://github.com/rust-lang/rust/commit/0065929599d276ce756a55948e8316615be1e7ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0065929599d276ce756a55948e8316615be1e7ec/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "144227dae949fb98896a2ba077d8fe7f36c3238e", "url": "https://api.github.com/repos/rust-lang/rust/commits/144227dae949fb98896a2ba077d8fe7f36c3238e", "html_url": "https://github.com/rust-lang/rust/commit/144227dae949fb98896a2ba077d8fe7f36c3238e"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "9e4dc702f0737bec6c37c2ead5936972c20f6a7a", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0065929599d276ce756a55948e8316615be1e7ec/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0065929599d276ce756a55948e8316615be1e7ec/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=0065929599d276ce756a55948e8316615be1e7ec", "patch": "@@ -2858,9 +2858,10 @@ impl ClashingExternDeclarations {\n                             let a_poly_sig = a.fn_sig(tcx);\n                             let b_poly_sig = b.fn_sig(tcx);\n \n-                            // As we don't compare regions, skip_binder is fine.\n-                            let a_sig = a_poly_sig.skip_binder();\n-                            let b_sig = b_poly_sig.skip_binder();\n+                            // We don't compare regions, but leaving bound regions around ICEs, so\n+                            // we erase them.\n+                            let a_sig = tcx.erase_late_bound_regions(a_poly_sig);\n+                            let b_sig = tcx.erase_late_bound_regions(b_poly_sig);\n \n                             (a_sig.abi, a_sig.unsafety, a_sig.c_variadic)\n                                 == (b_sig.abi, b_sig.unsafety, b_sig.c_variadic)"}, {"sha": "fce603c801f2488ccac02ed12b0c50616b9f22f4", "filename": "src/test/ui/foreign/issue-99276-same-type-lifetimes.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/0065929599d276ce756a55948e8316615be1e7ec/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0065929599d276ce756a55948e8316615be1e7ec/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs?ref=0065929599d276ce756a55948e8316615be1e7ec", "patch": "@@ -0,0 +1,24 @@\n+// Check that we do not ICE when structurally comparing types with lifetimes present.\n+// check-pass\n+\n+pub struct Record<'a> {\n+    pub args: &'a [(usize, &'a str)],\n+}\n+\n+mod a {\n+    extern \"Rust\" {\n+        fn foo<'a, 'b>(record: &'a super::Record<'b>);\n+\n+        fn bar<'a, 'b>(record: &'a super::Record<'b>);\n+    }\n+}\n+\n+mod b {\n+    extern \"Rust\" {\n+        fn foo<'a, 'b>(record: &'a super::Record<'b>);\n+\n+        fn bar<'a, 'b>(record: &'a super::Record<'b>);\n+    }\n+}\n+\n+fn main() {}"}]}