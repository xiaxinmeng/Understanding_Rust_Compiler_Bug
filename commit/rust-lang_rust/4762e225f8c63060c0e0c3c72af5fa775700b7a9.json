{"sha": "4762e225f8c63060c0e0c3c72af5fa775700b7a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3NjJlMjI1ZjhjNjMwNjBjMGUwYzNjNzJhZjVmYTc3NTcwMGI3YTk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-25T09:25:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-25T09:25:51Z"}, "message": "Rollup merge of #71517 - flip1995:unused_braces_hack, r=oli-obk\n\n Quick and dirty fix of the unused_braces lint\n\ncc @lcnr\n\nAdresses #70814\n\nThis at least prevents lint output, if no span is available. Even though this also prevents the `unused_parens` lint from emitting, when the `DUMMY_SP` is used there, but I think that should be ok, since error messages without a span are quite useless anyway.\n\nClippy CI is currently blocked on this bug. If this quick and dirty fix should be rejected, I could try to work around this in Clippy.\n\nr? @shepmaster", "tree": {"sha": "8e4e239009d2020650226758acc486207e78eea6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e4e239009d2020650226758acc486207e78eea6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4762e225f8c63060c0e0c3c72af5fa775700b7a9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJepAIgCRBK7hj4Ov3rIwAAdHIIAH2q3T5uN5j1uMhZxbMQAG2f\nExJorxRB5AcNiPqAhiW1i3HXLTWZfNeMphmd7f3xbtu/RVytg2hHSm9f6cDq8D4Y\n0Fbw9Tfg1/JqokdXLpDEEW+IQYTAc99QpYiD63GXvUuamnGB4tCtnC6046U/T5u9\nvYlPQMFgcnir3m9Drw13xsXXjeOYf5vU/C6P9++BfLOpvAsUUa2qZELxV1DpwsKW\nmjUICpODmJqwLOvWwOdBjNFG1jOLKXaA2ofrhYUeWl/gh3rM9YGHVkyGVqJbfR8p\nbZSdPBlwrzgwl0T8mHuDEp4Y1UxCQiMAXuqCTqTpjIHZwQ/zLl1f9erbIjmmLx8=\n=KHjL\n-----END PGP SIGNATURE-----\n", "payload": "tree 8e4e239009d2020650226758acc486207e78eea6\nparent 6ded356d9c73648206bcb2c34744b76d6384c02e\nparent 485f1999f59a9895b94534de91e8bbd870e7bd49\nauthor Dylan DPC <dylan.dpc@gmail.com> 1587806751 +0200\ncommitter GitHub <noreply@github.com> 1587806751 +0200\n\nRollup merge of #71517 - flip1995:unused_braces_hack, r=oli-obk\n\n Quick and dirty fix of the unused_braces lint\n\ncc @lcnr\n\nAdresses #70814\n\nThis at least prevents lint output, if no span is available. Even though this also prevents the `unused_parens` lint from emitting, when the `DUMMY_SP` is used there, but I think that should be ok, since error messages without a span are quite useless anyway.\n\nClippy CI is currently blocked on this bug. If this quick and dirty fix should be rejected, I could try to work around this in Clippy.\n\nr? @shepmaster\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4762e225f8c63060c0e0c3c72af5fa775700b7a9", "html_url": "https://github.com/rust-lang/rust/commit/4762e225f8c63060c0e0c3c72af5fa775700b7a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4762e225f8c63060c0e0c3c72af5fa775700b7a9/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ded356d9c73648206bcb2c34744b76d6384c02e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ded356d9c73648206bcb2c34744b76d6384c02e", "html_url": "https://github.com/rust-lang/rust/commit/6ded356d9c73648206bcb2c34744b76d6384c02e"}, {"sha": "485f1999f59a9895b94534de91e8bbd870e7bd49", "url": "https://api.github.com/repos/rust-lang/rust/commits/485f1999f59a9895b94534de91e8bbd870e7bd49", "html_url": "https://github.com/rust-lang/rust/commit/485f1999f59a9895b94534de91e8bbd870e7bd49"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "ddd252cb290e4d9022cec11a4ae5a565152b1c93", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4762e225f8c63060c0e0c3c72af5fa775700b7a9/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4762e225f8c63060c0e0c3c72af5fa775700b7a9/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=4762e225f8c63060c0e0c3c72af5fa775700b7a9", "patch": "@@ -16,7 +16,7 @@ use rustc_middle::ty::{self, Ty};\n use rustc_session::lint::builtin::UNUSED_ATTRIBUTES;\n use rustc_span::symbol::Symbol;\n use rustc_span::symbol::{kw, sym};\n-use rustc_span::{BytePos, Span};\n+use rustc_span::{BytePos, Span, DUMMY_SP};\n \n use log::debug;\n \n@@ -415,6 +415,12 @@ trait UnusedDelimLint {\n         msg: &str,\n         keep_space: (bool, bool),\n     ) {\n+        // FIXME(flip1995): Quick and dirty fix for #70814. This should be fixed in rustdoc\n+        // properly.\n+        if span == DUMMY_SP {\n+            return;\n+        }\n+\n         cx.struct_span_lint(self.lint(), span, |lint| {\n             let span_msg = format!(\"unnecessary {} around {}\", Self::DELIM_STR, msg);\n             let mut err = lint.build(&span_msg);"}, {"sha": "be0e31e4be2ff9d3c985393712f231291c13dd1b", "filename": "src/test/rustdoc-ui/unused-braces-lint.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4762e225f8c63060c0e0c3c72af5fa775700b7a9/src%2Ftest%2Frustdoc-ui%2Funused-braces-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4762e225f8c63060c0e0c3c72af5fa775700b7a9/src%2Ftest%2Frustdoc-ui%2Funused-braces-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funused-braces-lint.rs?ref=4762e225f8c63060c0e0c3c72af5fa775700b7a9", "patch": "@@ -0,0 +1,14 @@\n+// check-pass\n+\n+// This tests the bug in #70814, where the unused_braces lint triggered on the following code\n+// without providing a span.\n+\n+#![deny(unused_braces)]\n+\n+fn main() {\n+    {\n+        {\n+            use std;\n+        }\n+    }\n+}"}]}