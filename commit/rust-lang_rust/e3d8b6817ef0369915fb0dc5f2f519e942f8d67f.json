{"sha": "e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzZDhiNjgxN2VmMDM2OTkxNWZiMGRjNWYyZjUxOWU5NDJmOGQ2N2Y=", "commit": {"author": {"name": "Martin Finkel", "email": "finkel2804@gmail.com", "date": "2019-08-05T14:24:20Z"}, "committer": {"name": "Martin Finkel", "email": "finkel2804@gmail.com", "date": "2019-08-05T14:24:20Z"}, "message": "review feedback: find lib root path from registry", "tree": {"sha": "f5d9a70e15dfcd4acda4e0fed4c11e237a4f866a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5d9a70e15dfcd4acda4e0fed4c11e237a4f866a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "html_url": "https://github.com/rust-lang/rust/commit/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/comments", "author": {"login": "mfkl", "id": 3928834, "node_id": "MDQ6VXNlcjM5Mjg4MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3928834?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mfkl", "html_url": "https://github.com/mfkl", "followers_url": "https://api.github.com/users/mfkl/followers", "following_url": "https://api.github.com/users/mfkl/following{/other_user}", "gists_url": "https://api.github.com/users/mfkl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mfkl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mfkl/subscriptions", "organizations_url": "https://api.github.com/users/mfkl/orgs", "repos_url": "https://api.github.com/users/mfkl/repos", "events_url": "https://api.github.com/users/mfkl/events{/privacy}", "received_events_url": "https://api.github.com/users/mfkl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mfkl", "id": 3928834, "node_id": "MDQ6VXNlcjM5Mjg4MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3928834?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mfkl", "html_url": "https://github.com/mfkl", "followers_url": "https://api.github.com/users/mfkl/followers", "following_url": "https://api.github.com/users/mfkl/following{/other_user}", "gists_url": "https://api.github.com/users/mfkl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mfkl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mfkl/subscriptions", "organizations_url": "https://api.github.com/users/mfkl/orgs", "repos_url": "https://api.github.com/users/mfkl/repos", "events_url": "https://api.github.com/users/mfkl/events{/privacy}", "received_events_url": "https://api.github.com/users/mfkl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c6f6f031600dce97d2fd61a51afb17ff7f453ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c6f6f031600dce97d2fd61a51afb17ff7f453ec", "html_url": "https://github.com/rust-lang/rust/commit/3c6f6f031600dce97d2fd61a51afb17ff7f453ec"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "f2356a2615248785be7231cf20eb4e3b9cec7e66", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "patch": "@@ -3126,6 +3126,7 @@ name = \"rustc_target\"\n version = \"0.0.0\"\n dependencies = [\n  \"bitflags 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_data_structures 0.0.0\",\n  \"serialize 0.0.0\","}, {"sha": "940acf232ad132a2d1155968bfa762fa4c2fc804", "filename": "src/librustc_target/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2FCargo.toml?ref=e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "patch": "@@ -11,6 +11,7 @@ path = \"lib.rs\"\n [dependencies]\n bitflags = \"1.0\"\n log = \"0.4\"\n+cc = \"1.0.1\"\n rustc_data_structures = { path = \"../librustc_data_structures\" }\n rustc_serialize = { path = \"../libserialize\", package = \"serialize\" }\n syntax_pos = { path = \"../libsyntax_pos\" }"}, {"sha": "ab1b6705a1da1fe8cd8d0f42b36b162eef4eb828", "filename": "src/librustc_target/spec/aarch64_uwp_windows_msvc.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Faarch64_uwp_windows_msvc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Faarch64_uwp_windows_msvc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Faarch64_uwp_windows_msvc.rs?ref=e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "patch": "@@ -1,5 +1,5 @@\n use crate::spec::{LinkerFlavor, Target, TargetResult, PanicStrategy};\n-use std::env;\n+use cc::windows_registry;\n \n pub fn target() -> TargetResult {\n     let mut base = super::windows_uwp_msvc_base::opts();\n@@ -9,8 +9,11 @@ pub fn target() -> TargetResult {\n     // FIXME: this shouldn't be panic=abort, it should be panic=unwind\n     base.panic_strategy = PanicStrategy::Abort;\n \n-    let lib_root_path = env::var(\"VCToolsInstallDir\")\n-        .expect(\"VCToolsInstallDir not found in env\");\n+    let link_tool = windows_registry::find_tool(\"x86_64-pc-windows-msvc\", \"link.exe\")\n+        .expect(\"no path found for link.exe\");\n+\n+    let original_path = link_tool.path();\n+    let lib_root_path = original_path.ancestors().skip(4).next().unwrap().display();\n \n     base.pre_link_args.get_mut(&LinkerFlavor::Msvc).unwrap()\n         .push(format!(\"{}{}{}\","}, {"sha": "bc5631439d19ea228f67c9f46041b29db6691e96", "filename": "src/librustc_target/spec/i686_uwp_windows_msvc.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Fi686_uwp_windows_msvc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Fi686_uwp_windows_msvc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fi686_uwp_windows_msvc.rs?ref=e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "patch": "@@ -1,14 +1,17 @@\n use crate::spec::{LinkerFlavor, Target, TargetResult};\n-use std::env;\n+use cc::windows_registry;\n \n pub fn target() -> TargetResult {\n     let mut base = super::windows_uwp_msvc_base::opts();\n     base.cpu = \"pentium4\".to_string();\n     base.max_atomic_width = Some(64);\n     base.has_elf_tls = true;\n \n-    let lib_root_path = env::var(\"VCToolsInstallDir\")\n-        .expect(\"VCToolsInstallDir not found in env\");\n+    let link_tool = windows_registry::find_tool(\"x86_64-pc-windows-msvc\", \"link.exe\")\n+        .expect(\"no path found for link.exe\");\n+\n+    let original_path = link_tool.path();\n+    let lib_root_path = original_path.ancestors().skip(4).next().unwrap().display();\n \n     base.pre_link_args.get_mut(&LinkerFlavor::Msvc).unwrap()\n             .push(format!(\"{}{}{}\","}, {"sha": "8c15c7c22fcff98019fb011fea47321537433dc3", "filename": "src/librustc_target/spec/x86_64_uwp_windows_msvc.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Fx86_64_uwp_windows_msvc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d8b6817ef0369915fb0dc5f2f519e942f8d67f/src%2Flibrustc_target%2Fspec%2Fx86_64_uwp_windows_msvc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fx86_64_uwp_windows_msvc.rs?ref=e3d8b6817ef0369915fb0dc5f2f519e942f8d67f", "patch": "@@ -1,14 +1,17 @@\n use crate::spec::{LinkerFlavor, Target, TargetResult};\n-use std::env;\n+use cc::windows_registry;\n \n pub fn target() -> TargetResult {\n     let mut base = super::windows_uwp_msvc_base::opts();\n     base.cpu = \"x86-64\".to_string();\n     base.max_atomic_width = Some(64);\n     base.has_elf_tls = true;\n \n-    let lib_root_path = env::var(\"VCToolsInstallDir\")\n-        .expect(\"VCToolsInstallDir not found in env\");\n+    let link_tool = windows_registry::find_tool(\"x86_64-pc-windows-msvc\", \"link.exe\")\n+        .expect(\"no path found for link.exe\");\n+\n+    let original_path = link_tool.path();\n+    let lib_root_path = original_path.ancestors().skip(4).next().unwrap().display();\n \n     base.pre_link_args.get_mut(&LinkerFlavor::Msvc).unwrap()\n             .push(format!(\"{}{}{}\","}]}