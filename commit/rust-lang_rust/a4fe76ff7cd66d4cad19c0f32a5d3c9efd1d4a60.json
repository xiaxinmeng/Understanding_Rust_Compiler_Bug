{"sha": "a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "node_id": "C_kwDOAAsO6NoAKGE0ZmU3NmZmN2NkNjZkNGNhZDE5YzBmMzJhNWQzYzllZmQxZDRhNjA", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-10-27T01:50:07Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-10-31T19:41:06Z"}, "message": "Hide search bar in noscript.css\n\nAlso, remove the highlighting of the search bar in disabled state. This\nreduces flicker when loading a page.", "tree": {"sha": "abd85926c8bc94a93309b740abadbd58d7b1a6e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abd85926c8bc94a93309b740abadbd58d7b1a6e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "html_url": "https://github.com/rust-lang/rust/commit/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "html_url": "https://github.com/rust-lang/rust/commit/c7e4740ec18996e082fe6e29ebf7efdc7dda418f"}], "stats": {"total": 32, "additions": 18, "deletions": 14}, "files": [{"sha": "37ea7b000339f0de6d57ed9b62afc5298eaa6f5d", "filename": "src/librustdoc/html/static/css/noscript.css", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -13,3 +13,12 @@ rules.\n \t/* It requires JS to work so no need to display it in this case. */\n \tdisplay: none;\n }\n+\n+.sub {\n+\t/* The search bar and related controls don't work without JS */\n+\tdisplay: none;\n+}\n+\n+#theme-picker {\n+\tdisplay: none;\n+}"}, {"sha": "ba7fb3b5456a55425d76939bab0e56775f9da13e", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -255,10 +255,6 @@ details.undocumented > summary::before {\n \tbox-shadow: 0 0 0 1px #148099,0 0 0 2px transparent;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #3e3e3e;\n-}\n-\n .module-item .stab,\n .import-item .stab {\n \tcolor: #000;"}, {"sha": "77ac217e6f41dd9f76efc9b9c298ab4bc38d2889", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -219,10 +219,6 @@ details.undocumented > summary::before {\n \tborder-color: #008dfd;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #c5c4c4;\n-}\n-\n #crate-search + .search-input:focus {\n \tbox-shadow: 0 0 8px 4px #078dd8;\n }"}, {"sha": "6df137e39141508a88674a94a53c516efc79d9f1", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -209,10 +209,6 @@ details.undocumented > summary::before {\n \tborder-color: #66afe9;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #e6e6e6;\n-}\n-\n #crate-search + .search-input:focus {\n \tbox-shadow: 0 0 8px #078dd8;\n }"}, {"sha": "c421c6e9dc16ea733be039e9ac71832635790830", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -263,7 +263,9 @@ function hideThemeButtonState() {\n                 search_input.placeholder = searchState.input.origPlaceholder;\n             });\n \n-            search_input.removeAttribute('disabled');\n+            if (search_input.value != '') {\n+                loadSearch();\n+            }\n \n             // `crates{version}.js` should always be loaded before this script, so we can use it\n             // safely."}, {"sha": "cead54412bbbd2f43ae1ced3649a27cf7b570f80", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -85,7 +85,6 @@\n                     <input {# -#}\n                         class=\"search-input\" {# -#}\n                         name=\"search\" {# -#}\n-                        disabled {# -#}\n                         autocomplete=\"off\" {# -#}\n                         spellcheck=\"false\" {# -#}\n                         placeholder=\"Click or press \u2018S\u2019 to search, \u2018?\u2019 for more options\u2026\" {# -#}"}, {"sha": "1693f7b645f1baec352f0f809f55bf278f907a88", "filename": "src/test/rustdoc-gui/javascript-disabled.goml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml?ref=a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "patch": "@@ -0,0 +1,6 @@\n+// When JavaScript is disabled, we hide the search bar, because it\n+// can't be used without JS.\n+javascript: false\n+\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n+assert-css: (\".sub\", {\"display\": \"none\"})"}]}