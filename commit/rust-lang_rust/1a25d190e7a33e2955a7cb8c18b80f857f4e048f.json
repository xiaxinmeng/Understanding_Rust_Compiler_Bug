{"sha": "1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "node_id": "C_kwDOAAsO6NoAKDFhMjVkMTkwZTdhMzNlMjk1NWE3Y2I4YzE4YjgwZjg1N2Y0ZTA0OGY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-02T09:26:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-02T09:26:11Z"}, "message": "Auto merge of #8491 - matthiaskrgr:no_num_cpus, r=flip1995\n\ntests: use std::thread::available_parallelism() instead of num_cpus to get thread count\n\nremoves the dependency added in https://github.com/rust-lang/rust-clippy/pull/8451\n---\n\n*Please write a short comment explaining your change (or \"none\" for internal only changes)*\n\nchangelog: tests: use std::thread::available_parallelism() instead of num_cpus to get thread count", "tree": {"sha": "1826e29b972e7d396f9986ec35daefbf629fb06b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1826e29b972e7d396f9986ec35daefbf629fb06b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "html_url": "https://github.com/rust-lang/rust/commit/1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a25d190e7a33e2955a7cb8c18b80f857f4e048f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8a205aeb8588c144aa24074f6946ca61df4bab9", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8a205aeb8588c144aa24074f6946ca61df4bab9", "html_url": "https://github.com/rust-lang/rust/commit/b8a205aeb8588c144aa24074f6946ca61df4bab9"}, {"sha": "7a15061fbcff6f21aca7fc2b948de484bf21a69a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a15061fbcff6f21aca7fc2b948de484bf21a69a", "html_url": "https://github.com/rust-lang/rust/commit/7a15061fbcff6f21aca7fc2b948de484bf21a69a"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "6cf24a0c6d037d1d76cb47dea7e65bd658acbe92", "filename": "Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1a25d190e7a33e2955a7cb8c18b80f857f4e048f/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/1a25d190e7a33e2955a7cb8c18b80f857f4e048f/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "patch": "@@ -51,7 +51,6 @@ futures = \"0.3\"\n parking_lot = \"0.11.2\"\n tokio = { version = \"1\", features = [\"io-util\"] }\n rustc-semver = \"1.1\"\n-num_cpus = \"1.13\"\n \n [build-dependencies]\n rustc_tools_util = { version = \"0.2\", path = \"rustc_tools_util\" }"}, {"sha": "c9710e3db8e8d264e956dc8cb8e2eb04f07911dd", "filename": "tests/compile-test.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1a25d190e7a33e2955a7cb8c18b80f857f4e048f/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a25d190e7a33e2955a7cb8c18b80f857f4e048f/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=1a25d190e7a33e2955a7cb8c18b80f857f4e048f", "patch": "@@ -168,7 +168,11 @@ fn run_ui() {\n     let _threads = VarGuard::set(\n         \"RUST_TEST_THREADS\",\n         // if RUST_TEST_THREADS is set, adhere to it, otherwise override it\n-        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| num_cpus::get().to_string()),\n+        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| {\n+            std::thread::available_parallelism()\n+                .map_or(1, std::num::NonZeroUsize::get)\n+                .to_string()\n+        }),\n     );\n     compiletest::run_tests(&config);\n }"}]}