{"sha": "b0f17668f736278c535f58189112a1539545e7cb", "node_id": "C_kwDOAAsO6NoAKGIwZjE3NjY4ZjczNjI3OGM1MzVmNTgxODkxMTJhMTUzOTU0NWU3Y2I", "commit": {"author": {"name": "hkalbasi", "email": "hamidrezakalbasi@protonmail.com", "date": "2023-05-25T15:16:34Z"}, "committer": {"name": "hkalbasi", "email": "hamidrezakalbasi@protonmail.com", "date": "2023-05-25T15:16:34Z"}, "message": "use `::core` instead of `$crate` in `option_env!`", "tree": {"sha": "9a072f0e2d59febbfd7e9f90198dfb3670d5c15b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a072f0e2d59febbfd7e9f90198dfb3670d5c15b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0f17668f736278c535f58189112a1539545e7cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0f17668f736278c535f58189112a1539545e7cb", "html_url": "https://github.com/rust-lang/rust/commit/b0f17668f736278c535f58189112a1539545e7cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0f17668f736278c535f58189112a1539545e7cb/comments", "author": {"login": "HKalbasi", "id": 45197576, "node_id": "MDQ6VXNlcjQ1MTk3NTc2", "avatar_url": "https://avatars.githubusercontent.com/u/45197576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HKalbasi", "html_url": "https://github.com/HKalbasi", "followers_url": "https://api.github.com/users/HKalbasi/followers", "following_url": "https://api.github.com/users/HKalbasi/following{/other_user}", "gists_url": "https://api.github.com/users/HKalbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/HKalbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HKalbasi/subscriptions", "organizations_url": "https://api.github.com/users/HKalbasi/orgs", "repos_url": "https://api.github.com/users/HKalbasi/repos", "events_url": "https://api.github.com/users/HKalbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/HKalbasi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "HKalbasi", "id": 45197576, "node_id": "MDQ6VXNlcjQ1MTk3NTc2", "avatar_url": "https://avatars.githubusercontent.com/u/45197576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HKalbasi", "html_url": "https://github.com/HKalbasi", "followers_url": "https://api.github.com/users/HKalbasi/followers", "following_url": "https://api.github.com/users/HKalbasi/following{/other_user}", "gists_url": "https://api.github.com/users/HKalbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/HKalbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HKalbasi/subscriptions", "organizations_url": "https://api.github.com/users/HKalbasi/orgs", "repos_url": "https://api.github.com/users/HKalbasi/repos", "events_url": "https://api.github.com/users/HKalbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/HKalbasi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "21e5dc2af986d2eccb9d7caa74455a48b26c7ae6", "url": "https://api.github.com/repos/rust-lang/rust/commits/21e5dc2af986d2eccb9d7caa74455a48b26c7ae6", "html_url": "https://github.com/rust-lang/rust/commit/21e5dc2af986d2eccb9d7caa74455a48b26c7ae6"}], "stats": {"total": 33, "additions": 23, "deletions": 10}, "files": [{"sha": "006d29299217974ba362ee2f93d6085fc9667752", "filename": "crates/hir-def/src/macro_expansion_tests/builtin_fn_macro.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs?ref=b0f17668f736278c535f58189112a1539545e7cb", "patch": "@@ -97,7 +97,7 @@ fn main() { option_env!(\"TEST_ENV_VAR\"); }\n #[rustc_builtin_macro]\n macro_rules! option_env {() => {}}\n \n-fn main() { $crate::option::Option::None:: < &str>; }\n+fn main() { ::core::option::Option::None:: < &str>; }\n \"#]],\n     );\n }"}, {"sha": "7ce5b02314ee1f9e093a4528f875eeb686c14648", "filename": "crates/hir-expand/src/builtin_fn_macro.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs?ref=b0f17668f736278c535f58189112a1539545e7cb", "patch": "@@ -820,10 +820,10 @@ fn option_env_expand(\n             )\n         }\n     };\n-\n+    // FIXME: Use `DOLLAR_CRATE` when that works in eager macros.\n     let expanded = match get_env_inner(db, arg_id, &key) {\n-        None => quote! { #DOLLAR_CRATE::option::Option::None::<&str> },\n-        Some(s) => quote! { #DOLLAR_CRATE::option::Option::Some(#s) },\n+        None => quote! { ::core::option::Option::None::<&str> },\n+        Some(s) => quote! { ::core::option::Option::Some(#s) },\n     };\n \n     ExpandResult::ok(ExpandedEager::new(expanded))"}, {"sha": "772bd3e536ece18e4efa933d25dc4415d39bd55a", "filename": "crates/hir-ty/src/tests/macros.rs", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-ty%2Fsrc%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0f17668f736278c535f58189112a1539545e7cb/crates%2Fhir-ty%2Fsrc%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Ftests%2Fmacros.rs?ref=b0f17668f736278c535f58189112a1539545e7cb", "patch": "@@ -947,21 +947,34 @@ fn infer_builtin_macros_concat_with_lazy() {\n \n #[test]\n fn infer_builtin_macros_env() {\n-    check_infer(\n+    check_types(\n         r#\"\n         //- /main.rs env:foo=bar\n         #[rustc_builtin_macro]\n         macro_rules! env {() => {}}\n \n         fn main() {\n             let x = env!(\"foo\");\n+              //^ &str\n+        }\n+        \"#,\n+    );\n+}\n+\n+#[test]\n+fn infer_builtin_macros_option_env() {\n+    check_types(\n+        r#\"\n+        //- minicore: option\n+        //- /main.rs env:foo=bar\n+        #[rustc_builtin_macro]\n+        macro_rules! option_env {() => {}}\n+\n+        fn main() {\n+            let x = option_env!(\"foo\");\n+              //^ Option<&str>\n         }\n         \"#,\n-        expect![[r#\"\n-            !0..22 '\"__RA_...TED__\"': &str\n-            62..90 '{     ...o\"); }': ()\n-            72..73 'x': &str\n-        \"#]],\n     );\n }\n "}]}