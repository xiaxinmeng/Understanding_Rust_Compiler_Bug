{"sha": "325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "node_id": "C_kwDOAAsO6NoAKDMyNWU5MjAzYmFlMjU0YWU4ODFkOGZiMzkxZjBmNDFlOGFiNWZkMWM", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-10-21T12:00:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-21T12:00:00Z"}, "message": "Rollup merge of #103321 - notriddle:notriddle/source-page-top-bar-layout, r=GuillaumeGomez\n\nrustdoc: improve appearance of source page navigation bar\n\nThis commit changes things so that the search bar is exactly centered between the top of the page and the top of the source code content area.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/source-page-header/src/std/lib.rs.html\n\n## Before\n\n![image](https://user-images.githubusercontent.com/1593513/197053420-02a64627-48ed-4bb6-9363-a1863d47b092.png)\n\n## After\n\n![image](https://user-images.githubusercontent.com/1593513/197053355-bd6149f9-0f5c-47da-aeb7-590b5eecb5da.png)", "tree": {"sha": "f47db7761a43df2bdd5d05295677d0269326a586", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f47db7761a43df2bdd5d05295677d0269326a586"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjUonACRBK7hj4Ov3rIwAAA/IIACqeAUX8txnDEUtFo2iC7Ntf\nw1qBx4OxL9kLPtNtV+es5bzynd3y0gAaWrYKiBuOeICxCNkfgxqlXPtyISro3Bn+\n56nfftGNeqUg9dMWJH7SnZ1y6O/biHItm4fVrmfdYjt6KE953xKtmTL/bauSD3rL\nIlN8qcrZMeuDx0usNtRzFAonW1fr+9zZAiTLaZYZEYuYpRIh2gKddl9j2mPI/p4X\nzDgROr6qgk6Qm8Dqt8MtIhOa18eZu19lWRUEvAo2sUxfYOxG4aHMcmOlgb7TVoiL\ndRU7cYKrz4PjQaP0YqZ0tA7txDANV0wQ8gszcaKqRrkkZXIVbBW78b8xfGZlr38=\n=YJe3\n-----END PGP SIGNATURE-----\n", "payload": "tree f47db7761a43df2bdd5d05295677d0269326a586\nparent 3055eb9b2600cbe04bacf6e5254a492451de8a05\nparent f6dd4708cf37689863c867889ab6f9c512825f4d\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1666353600 +0530\ncommitter GitHub <noreply@github.com> 1666353600 +0530\n\nRollup merge of #103321 - notriddle:notriddle/source-page-top-bar-layout, r=GuillaumeGomez\n\nrustdoc: improve appearance of source page navigation bar\n\nThis commit changes things so that the search bar is exactly centered between the top of the page and the top of the source code content area.\n\nPreview: https://notriddle.com/notriddle-rustdoc-demos/source-page-header/src/std/lib.rs.html\n\n## Before\n\n![image](https://user-images.githubusercontent.com/1593513/197053420-02a64627-48ed-4bb6-9363-a1863d47b092.png)\n\n## After\n\n![image](https://user-images.githubusercontent.com/1593513/197053355-bd6149f9-0f5c-47da-aeb7-590b5eecb5da.png)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "html_url": "https://github.com/rust-lang/rust/commit/325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3055eb9b2600cbe04bacf6e5254a492451de8a05", "url": "https://api.github.com/repos/rust-lang/rust/commits/3055eb9b2600cbe04bacf6e5254a492451de8a05", "html_url": "https://github.com/rust-lang/rust/commit/3055eb9b2600cbe04bacf6e5254a492451de8a05"}, {"sha": "f6dd4708cf37689863c867889ab6f9c512825f4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6dd4708cf37689863c867889ab6f9c512825f4d", "html_url": "https://github.com/rust-lang/rust/commit/f6dd4708cf37689863c867889ab6f9c512825f4d"}], "stats": {"total": 124, "additions": 72, "deletions": 52}, "files": [{"sha": "63b35f5d0df0d2abfd996a8bb927c041db4f0a41", "filename": "src/librustdoc/html/static/css/noscript.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -14,7 +14,7 @@ rules.\n \tdisplay: none;\n }\n \n-.sub {\n+nav.sub {\n \t/* The search bar and related controls don't work without JS */\n \tdisplay: none;\n }"}, {"sha": "afe1ca5d7e520ea13c6955b210ece8033b126af2", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 19, "deletions": 19, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -365,15 +365,8 @@ img {\n \toverflow: visible;\n }\n \n-.sub-container {\n-\tdisplay: flex;\n-\tflex-direction: row;\n-\tflex-wrap: nowrap;\n-}\n-\n .sub-logo-container {\n-\tdisplay: block;\n-\tmargin-right: 20px;\n+\tline-height: 0;\n }\n \n .sub-logo-container > img {\n@@ -696,14 +689,21 @@ pre, .rustdoc.source .example-wrap {\n }\n \n nav.sub {\n-\tposition: relative;\n \tflex-grow: 1;\n-\tmargin-bottom: 25px;\n+\tflex-flow: row nowrap;\n+\tmargin: 4px 0 25px 0;\n+\tdisplay: flex;\n+\talign-items: center;\n+}\n+nav.sub form {\n+\tflex-grow: 1;\n }\n .source nav.sub {\n+\tmargin: 0 0 15px 0;\n+}\n+.source nav.sub form {\n \tmargin-left: 32px;\n }\n-nav.sub form { display: inline; }\n \n a {\n \ttext-decoration: none;\n@@ -796,7 +796,6 @@ table,\n \tposition: relative;\n \tdisplay: flex;\n \theight: 34px;\n-\tmargin-top: 4px;\n }\n .search-results-title {\n \tmargin-top: 0;\n@@ -1822,10 +1821,6 @@ in storage.js\n \t\tmargin-left: 0px;\n \t}\n \n-\t.source .content {\n-\t\tmargin-top: 10px;\n-\t}\n-\n \t.anchor {\n \t\tdisplay: none !important;\n \t}\n@@ -1934,6 +1929,11 @@ in storage.js\n \t.impl-items > .item-info {\n \t\tmargin-left: 34px;\n \t}\n+\n+\t.source nav.sub {\n+\t\tmargin: 0;\n+\t\tpadding: 8px;\n+\t}\n }\n \n @media print {\n@@ -1962,12 +1962,12 @@ in storage.js\n \t\toverflow-wrap: anywhere;\n \t}\n \n-\t.sub-container {\n+\tnav.sub {\n \t\tflex-direction: column;\n \t}\n \n-\t.sub-logo-container {\n-\t\talign-self: center;\n+\tnav.sub form {\n+\t\talign-self: stretch;\n \t}\n \n \t.sub-logo-container > img {"}, {"sha": "2a111f94e50780eaf1965a71c2131def1ab5245c", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 22, "deletions": 24, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -102,7 +102,7 @@ <h2></h2> {#- -#}\n     </nav> {#- -#}\n     <main> {#- -#}\n         <div class=\"width-limiter\"> {#- -#}\n-            <div class=\"sub-container\"> {#- -#}\n+            <nav class=\"sub\"> {#- -#}\n                 {%- if page.css_class == \"source\" -%}\n                 <a class=\"sub-logo-container\" href=\"{{page.root_path|safe}}{{krate_with_trailing_slash|safe}}index.html\"> {#- -#}\n                     {%- if !layout.logo.is_empty()  %}\n@@ -112,30 +112,28 @@ <h2></h2> {#- -#}\n                     {%- endif -%}\n                 </a> {#- -#}\n                 {%- endif -%}\n-                <nav class=\"sub\"> {#- -#}\n-                    <form class=\"search-form\"> {#- -#}\n-                        <div class=\"search-container\"> {#- -#}\n-                            <span></span> {#- This empty span is a hacky fix for Safari - See #93184 -#}\n-                            <input {# -#}\n-                                class=\"search-input\" {# -#}\n-                                name=\"search\" {# -#}\n-                                autocomplete=\"off\" {# -#}\n-                                spellcheck=\"false\" {# -#}\n-                                placeholder=\"Click or press \u2018S\u2019 to search, \u2018?\u2019 for more options\u2026\" {# -#}\n-                                type=\"search\"> {#- -#}\n-                            <div id=\"help-button\" title=\"help\" tabindex=\"-1\"> {#- -#}\n-                                <a href=\"{{page.root_path|safe}}help.html\">?</a> {#- -#}\n-                            </div> {#- -#}\n-                            <div id=\"settings-menu\" tabindex=\"-1\"> {#- -#}\n-                                <a href=\"{{page.root_path|safe}}settings.html\" title=\"settings\"> {#- -#}\n-                                    <img width=\"22\" height=\"22\" alt=\"Change settings\" {# -#}\n-                                     src=\"{{static_root_path|safe}}wheel{{page.resource_suffix}}.svg\"> {#- -#}\n-                                </a> {#- -#}\n-                            </div> {#- -#}\n+                <form class=\"search-form\"> {#- -#}\n+                    <div class=\"search-container\"> {#- -#}\n+                        <span></span> {#- This empty span is a hacky fix for Safari - See #93184 -#}\n+                        <input {# -#}\n+                            class=\"search-input\" {# -#}\n+                            name=\"search\" {# -#}\n+                            autocomplete=\"off\" {# -#}\n+                            spellcheck=\"false\" {# -#}\n+                            placeholder=\"Click or press \u2018S\u2019 to search, \u2018?\u2019 for more options\u2026\" {# -#}\n+                            type=\"search\"> {#- -#}\n+                        <div id=\"help-button\" title=\"help\" tabindex=\"-1\"> {#- -#}\n+                            <a href=\"{{page.root_path|safe}}help.html\">?</a> {#- -#}\n                         </div> {#- -#}\n-                    </form> {#- -#}\n-                </nav> {#- -#}\n-            </div> {#- -#}\n+                        <div id=\"settings-menu\" tabindex=\"-1\"> {#- -#}\n+                            <a href=\"{{page.root_path|safe}}settings.html\" title=\"settings\"> {#- -#}\n+                                <img width=\"22\" height=\"22\" alt=\"Change settings\" {# -#}\n+                                 src=\"{{static_root_path|safe}}wheel{{page.resource_suffix}}.svg\"> {#- -#}\n+                            </a> {#- -#}\n+                        </div> {#- -#}\n+                    </div> {#- -#}\n+                </form> {#- -#}\n+            </nav> {#- -#}\n             <section id=\"main-content\" class=\"content\">{{- content|safe -}}</section> {#- -#}\n         </div> {#- -#}\n     </main> {#- -#}"}, {"sha": "521e14748af12bd431ed5de839657a3a9e5bca99", "filename": "src/test/rustdoc-gui/help-page.goml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fhelp-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fhelp-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fhelp-page.goml?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -5,12 +5,12 @@ wait-for: \"#help\"\n assert-css: (\"#help\", {\"display\": \"block\"})\n click: \"#help-button > a\"\n assert-css: (\"#help\", {\"display\": \"block\"})\n-compare-elements-property: (\".sub-container\", \"#help\", [\"offsetWidth\"])\n-compare-elements-position: (\".sub-container\", \"#help\", (\"x\"))\n+compare-elements-property: (\".sub\", \"#help\", [\"offsetWidth\"])\n+compare-elements-position: (\".sub\", \"#help\", (\"x\"))\n size: (500, 1000) // Try mobile next.\n assert-css: (\"#help\", {\"display\": \"block\"})\n-compare-elements-property: (\".sub-container\", \"#help\", [\"offsetWidth\"])\n-compare-elements-position: (\".sub-container\", \"#help\", (\"x\"))\n+compare-elements-property: (\".sub\", \"#help\", [\"offsetWidth\"])\n+compare-elements-position: (\".sub\", \"#help\", (\"x\"))\n \n // This test ensures that opening the help popover without switching pages works.\n goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n@@ -20,5 +20,5 @@ click: \"#help-button > a\"\n assert-css: (\"#help\", {\"display\": \"block\"})\n click: \"#help-button > a\"\n assert-css: (\"#help\", {\"display\": \"none\"})\n-compare-elements-property-false: (\".sub-container\", \"#help\", [\"offsetWidth\"])\n-compare-elements-position-false: (\".sub-container\", \"#help\", (\"x\"))\n+compare-elements-property-false: (\".sub\", \"#help\", [\"offsetWidth\"])\n+compare-elements-position-false: (\".sub\", \"#help\", (\"x\"))"}, {"sha": "f258f4d2a838e12fd7588256f3d662c04f46fdf7", "filename": "src/test/rustdoc-gui/settings.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsettings.goml?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -147,7 +147,7 @@ assert-css: (\n )\n \n assert-attribute-false: (\"#settings\", {\"class\": \"popover\"}, CONTAINS)\n-compare-elements-position: (\".sub-container\", \"#settings\", (\"x\"))\n+compare-elements-position: (\".sub form\", \"#settings\", (\"x\"))\n \n // We now check the display with JS disabled.\n assert-false: \"noscript section\""}, {"sha": "29d65fc7ebc7a6f1aa373ee186956fe380f1b70b", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/325e9203bae254ae881d8fb391f0f41e8ab5fd1c/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=325e9203bae254ae881d8fb391f0f41e8ab5fd1c", "patch": "@@ -23,7 +23,7 @@ assert-css: (\".src-line-numbers\", {\"text-align\": \"right\"})\n show-text: true\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n // We use this assert-position to know where we will click.\n-assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 103})\n+assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 112})\n // We click on the left of the \"1\" span but still in the \"src-line-number\" `<pre>`.\n click: (103, 103)\n assert-document-property: ({\"URL\": \"/lib.rs.html\"}, ENDS_WITH)\n@@ -47,3 +47,25 @@ assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"false\"})\n \n // Check the spacing.\n assert-css: (\"#source-sidebar > details.dir-entry\", {\"padding-left\": \"4px\"})\n+\n+// Check the search form\n+assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n+// The goal of this test is to ensure the search input is perfectly centered\n+// between the top of the page and the top of the gray code block.\n+// To check this, we maintain the invariant:\n+//\n+// offsetTop[nav.sub form] = offsetTop[#main-content] - offsetHeight[nav.sub form] - offsetTop[nav.sub form]\n+assert-property: (\"nav.sub form\", {\"offsetTop\": 28, \"offsetHeight\": 34})\n+assert-property: (\"#main-content\", {\"offsetTop\": 90})\n+// 28 = 90 - 34 - 28\n+\n+// Now do the same check on moderately-sized mobile.\n+size: (700, 700)\n+assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n+assert-property: (\"nav.sub form\", {\"offsetTop\": 21, \"offsetHeight\": 34})\n+assert-property: (\"#main-content\", {\"offsetTop\": 76})\n+// 21 = 76 - 34 - 21\n+\n+// Tiny mobile gets a different display where the logo is stacked on top.\n+size: (450, 700)\n+assert-css: (\"nav.sub\", {\"flex-direction\": \"column\"})"}]}