{"sha": "ba86a99d247d318b5bbb2b8f81f1d71f05978847", "node_id": "C_kwDOAAsO6NoAKGJhODZhOTlkMjQ3ZDMxOGI1YmJiMmI4ZjgxZjFkNzFmMDU5Nzg4NDc", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-28T16:30:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-28T16:30:49Z"}, "message": "Auto merge of #10324 - andrewbanchich:fix-missing-private-docs, r=dswij\n\nScope `missing_docs_in_private_items` to only private items\n\n`missing_docs_in_private_items` currently detects missing docs for public items as well as private. Since `missing_docs`already covers public items, this PR updates `missing_docs_in_private_items` to only cover private items.\n\nFixes #1895\n\nchangelog: [`missing_docs_in_private_items`]: Apply lint only to private items (used to be public and private)", "tree": {"sha": "0d8fc4a30f1e1ca5cbe1b1dda1508cd23305aa27", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d8fc4a30f1e1ca5cbe1b1dda1508cd23305aa27"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba86a99d247d318b5bbb2b8f81f1d71f05978847", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba86a99d247d318b5bbb2b8f81f1d71f05978847", "html_url": "https://github.com/rust-lang/rust/commit/ba86a99d247d318b5bbb2b8f81f1d71f05978847", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba86a99d247d318b5bbb2b8f81f1d71f05978847/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "html_url": "https://github.com/rust-lang/rust/commit/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9"}, {"sha": "49a06ed66f106b332b0e488bf970957e83cb03b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/49a06ed66f106b332b0e488bf970957e83cb03b0", "html_url": "https://github.com/rust-lang/rust/commit/49a06ed66f106b332b0e488bf970957e83cb03b0"}], "stats": {"total": 136, "additions": 8, "deletions": 128}, "files": [{"sha": "f9681deab5bada6e9b1c250f326ee49789a35d6d", "filename": "clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ba86a99d247d318b5bbb2b8f81f1d71f05978847/clippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba86a99d247d318b5bbb2b8f81f1d71f05978847/clippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_doc.rs?ref=ba86a99d247d318b5bbb2b8f81f1d71f05978847", "patch": "@@ -8,10 +8,10 @@\n use clippy_utils::attrs::is_doc_hidden;\n use clippy_utils::diagnostics::span_lint;\n use clippy_utils::is_from_proc_macro;\n-use hir::def_id::LocalDefId;\n use if_chain::if_chain;\n use rustc_ast::ast::{self, MetaItem, MetaItemKind};\n use rustc_hir as hir;\n+use rustc_hir::def_id::LocalDefId;\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::ty::{DefIdTree, Visibility};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n@@ -21,8 +21,7 @@ use rustc_span::sym;\n \n declare_clippy_lint! {\n     /// ### What it does\n-    /// Warns if there is missing doc for any documentable item\n-    /// (public or private).\n+    /// Warns if there is missing doc for any private documentable item\n     ///\n     /// ### Why is this bad?\n     /// Doc is good. *rustc* has a `MISSING_DOCS`\n@@ -32,7 +31,7 @@ declare_clippy_lint! {\n     #[clippy::version = \"pre 1.29.0\"]\n     pub MISSING_DOCS_IN_PRIVATE_ITEMS,\n     restriction,\n-    \"detects missing documentation for public and private members\"\n+    \"detects missing documentation for private members\"\n }\n \n pub struct MissingDoc {\n@@ -107,11 +106,14 @@ impl MissingDoc {\n             if vis == Visibility::Public || vis != Visibility::Restricted(CRATE_DEF_ID.into()) {\n                 return;\n             }\n+        } else if def_id != CRATE_DEF_ID && cx.effective_visibilities.is_exported(def_id) {\n+            return;\n         }\n \n         let has_doc = attrs\n             .iter()\n             .any(|a| a.doc_str().is_some() || Self::has_include(a.meta()));\n+\n         if !has_doc {\n             span_lint(\n                 cx,"}, {"sha": "4e8a49bf1cd7120e8177e1d0d751b0f00299e13f", "filename": "tests/ui/missing_doc.stderr", "status": "modified", "additions": 1, "deletions": 69, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/ba86a99d247d318b5bbb2b8f81f1d71f05978847/tests%2Fui%2Fmissing_doc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ba86a99d247d318b5bbb2b8f81f1d71f05978847/tests%2Fui%2Fmissing_doc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing_doc.stderr?ref=ba86a99d247d318b5bbb2b8f81f1d71f05978847", "patch": "@@ -6,30 +6,12 @@ LL | type Typedef = String;\n    |\n    = note: `-D clippy::missing-docs-in-private-items` implied by `-D warnings`\n \n-error: missing documentation for a type alias\n-  --> $DIR/missing_doc.rs:17:1\n-   |\n-LL | pub type PubTypedef = String;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a module\n   --> $DIR/missing_doc.rs:19:1\n    |\n LL | mod module_no_dox {}\n    | ^^^^^^^^^^^^^^^^^^^^\n \n-error: missing documentation for a module\n-  --> $DIR/missing_doc.rs:20:1\n-   |\n-LL | pub mod pub_module_no_dox {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: missing documentation for a function\n-  --> $DIR/missing_doc.rs:24:1\n-   |\n-LL | pub fn foo2() {}\n-   | ^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a function\n   --> $DIR/missing_doc.rs:25:1\n    |\n@@ -69,50 +51,18 @@ error: missing documentation for a variant\n LL |     BarB,\n    |     ^^^^\n \n-error: missing documentation for an enum\n-  --> $DIR/missing_doc.rs:44:1\n-   |\n-LL | / pub enum PubBaz {\n-LL | |     PubBazA { a: isize },\n-LL | | }\n-   | |_^\n-\n-error: missing documentation for a variant\n-  --> $DIR/missing_doc.rs:45:5\n-   |\n-LL |     PubBazA { a: isize },\n-   |     ^^^^^^^^^^^^^^^^^^^^\n-\n-error: missing documentation for a struct field\n-  --> $DIR/missing_doc.rs:45:15\n-   |\n-LL |     PubBazA { a: isize },\n-   |               ^^^^^^^^\n-\n error: missing documentation for a constant\n   --> $DIR/missing_doc.rs:65:1\n    |\n LL | const FOO: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^\n \n-error: missing documentation for a constant\n-  --> $DIR/missing_doc.rs:72:1\n-   |\n-LL | pub const FOO4: u32 = 0;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a static\n   --> $DIR/missing_doc.rs:74:1\n    |\n LL | static BAR: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n-error: missing documentation for a static\n-  --> $DIR/missing_doc.rs:81:1\n-   |\n-LL | pub static BAR4: u32 = 0;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a module\n   --> $DIR/missing_doc.rs:83:1\n    |\n@@ -125,35 +75,17 @@ LL | |     }\n LL | | }\n    | |_^\n \n-error: missing documentation for a function\n-  --> $DIR/missing_doc.rs:86:5\n-   |\n-LL |     pub fn undocumented1() {}\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: missing documentation for a function\n-  --> $DIR/missing_doc.rs:87:5\n-   |\n-LL |     pub fn undocumented2() {}\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a function\n   --> $DIR/missing_doc.rs:88:5\n    |\n LL |     fn undocumented3() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^\n \n-error: missing documentation for a function\n-  --> $DIR/missing_doc.rs:93:9\n-   |\n-LL |         pub fn also_undocumented1() {}\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for a function\n   --> $DIR/missing_doc.rs:94:9\n    |\n LL |         fn also_undocumented2() {}\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 24 previous errors\n+error: aborting due to 13 previous errors\n "}, {"sha": "111d65469660b540bfa9f90d28d88fc94fa04f21", "filename": "tests/ui/missing_doc_impl.stderr", "status": "modified", "additions": 1, "deletions": 55, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/ba86a99d247d318b5bbb2b8f81f1d71f05978847/tests%2Fui%2Fmissing_doc_impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ba86a99d247d318b5bbb2b8f81f1d71f05978847/tests%2Fui%2Fmissing_doc_impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing_doc_impl.stderr?ref=ba86a99d247d318b5bbb2b8f81f1d71f05978847", "patch": "@@ -21,60 +21,12 @@ error: missing documentation for a struct field\n LL |     b: isize,\n    |     ^^^^^^^^\n \n-error: missing documentation for a struct\n-  --> $DIR/missing_doc_impl.rs:18:1\n-   |\n-LL | / pub struct PubFoo {\n-LL | |     pub a: isize,\n-LL | |     b: isize,\n-LL | | }\n-   | |_^\n-\n-error: missing documentation for a struct field\n-  --> $DIR/missing_doc_impl.rs:19:5\n-   |\n-LL |     pub a: isize,\n-   |     ^^^^^^^^^^^^\n-\n error: missing documentation for a struct field\n   --> $DIR/missing_doc_impl.rs:20:5\n    |\n LL |     b: isize,\n    |     ^^^^^^^^\n \n-error: missing documentation for a trait\n-  --> $DIR/missing_doc_impl.rs:43:1\n-   |\n-LL | / pub trait C {\n-LL | |     fn foo(&self);\n-LL | |     fn foo_with_impl(&self) {}\n-LL | | }\n-   | |_^\n-\n-error: missing documentation for a method\n-  --> $DIR/missing_doc_impl.rs:44:5\n-   |\n-LL |     fn foo(&self);\n-   |     ^^^^^^^^^^^^^^\n-\n-error: missing documentation for a method\n-  --> $DIR/missing_doc_impl.rs:45:5\n-   |\n-LL |     fn foo_with_impl(&self) {}\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: missing documentation for an associated type\n-  --> $DIR/missing_doc_impl.rs:55:5\n-   |\n-LL |     type AssociatedType;\n-   |     ^^^^^^^^^^^^^^^^^^^^\n-\n-error: missing documentation for an associated type\n-  --> $DIR/missing_doc_impl.rs:56:5\n-   |\n-LL |     type AssociatedTypeDef = Self;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: missing documentation for an associated function\n   --> $DIR/missing_doc_impl.rs:67:5\n    |\n@@ -89,12 +41,6 @@ error: missing documentation for an associated function\n LL |     fn bar() {}\n    |     ^^^^^^^^^^^\n \n-error: missing documentation for an associated function\n-  --> $DIR/missing_doc_impl.rs:74:5\n-   |\n-LL |     pub fn foo() {}\n-   |     ^^^^^^^^^^^^^^^\n-\n error: missing documentation for an associated function\n   --> $DIR/missing_doc_impl.rs:78:5\n    |\n@@ -103,5 +49,5 @@ LL | |         1\n LL | |     }\n    | |_____^\n \n-error: aborting due to 15 previous errors\n+error: aborting due to 7 previous errors\n "}]}