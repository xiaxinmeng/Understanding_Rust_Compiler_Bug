{"sha": "26e17ae8892d0232e8f519e0c79cde44d5fd046b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2ZTE3YWU4ODkyZDAyMzJlOGY1MTllMGM3OWNkZTQ0ZDVmZDA0NmI=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-14T21:01:32Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-14T21:46:15Z"}, "message": "Remove `Adjustment::DerefMove`\n\nIt does the same thing as `Deref` now", "tree": {"sha": "d65b617f57092ae4099722421cbb58467c3c0b8f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d65b617f57092ae4099722421cbb58467c3c0b8f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26e17ae8892d0232e8f519e0c79cde44d5fd046b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26e17ae8892d0232e8f519e0c79cde44d5fd046b", "html_url": "https://github.com/rust-lang/rust/commit/26e17ae8892d0232e8f519e0c79cde44d5fd046b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26e17ae8892d0232e8f519e0c79cde44d5fd046b/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9014df55c65fdb3d89d6273cf0ecdfbec2444cdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/9014df55c65fdb3d89d6273cf0ecdfbec2444cdb", "html_url": "https://github.com/rust-lang/rust/commit/9014df55c65fdb3d89d6273cf0ecdfbec2444cdb"}], "stats": {"total": 14, "additions": 4, "deletions": 10}, "files": [{"sha": "5ee1fc684f021aee435422f75704e7f6edefe616", "filename": "src/librustc_mir/shim.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/26e17ae8892d0232e8f519e0c79cde44d5fd046b/src%2Flibrustc_mir%2Fshim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26e17ae8892d0232e8f519e0c79cde44d5fd046b/src%2Flibrustc_mir%2Fshim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fshim.rs?ref=26e17ae8892d0232e8f519e0c79cde44d5fd046b", "patch": "@@ -32,13 +32,9 @@ fn make_shim<'tcx>(tcx: TyCtxt<'tcx>, instance: ty::InstanceDef<'tcx>) -> Body<'\n \n     let mut result = match instance {\n         ty::InstanceDef::Item(..) => bug!(\"item {:?} passed to make_shim\", instance),\n-        ty::InstanceDef::VtableShim(def_id) => build_call_shim(\n-            tcx,\n-            instance,\n-            Some(Adjustment::DerefMove),\n-            CallKind::Direct(def_id),\n-            None,\n-        ),\n+        ty::InstanceDef::VtableShim(def_id) => {\n+            build_call_shim(tcx, instance, Some(Adjustment::Deref), CallKind::Direct(def_id), None)\n+        }\n         ty::InstanceDef::FnPtrShim(def_id, ty) => {\n             // FIXME(eddyb) support generating shims for a \"shallow type\",\n             // e.g. `Foo<_>` or `[_]` instead of requiring a fully monomorphic\n@@ -136,7 +132,6 @@ fn make_shim<'tcx>(tcx: TyCtxt<'tcx>, instance: ty::InstanceDef<'tcx>) -> Body<'\n enum Adjustment {\n     Identity,\n     Deref,\n-    DerefMove,\n     RefMut,\n }\n \n@@ -701,8 +696,7 @@ fn build_call_shim<'tcx>(\n \n     let rcvr = rcvr_adjustment.map(|rcvr_adjustment| match rcvr_adjustment {\n         Adjustment::Identity => Operand::Move(rcvr_place()),\n-        Adjustment::Deref => Operand::Move(tcx.mk_place_deref(rcvr_place())), // Can't copy `&mut`\n-        Adjustment::DerefMove => Operand::Move(tcx.mk_place_deref(rcvr_place())),\n+        Adjustment::Deref => Operand::Move(tcx.mk_place_deref(rcvr_place())),\n         Adjustment::RefMut => {\n             // let rcvr = &mut rcvr;\n             let ref_rcvr = local_decls.push("}]}