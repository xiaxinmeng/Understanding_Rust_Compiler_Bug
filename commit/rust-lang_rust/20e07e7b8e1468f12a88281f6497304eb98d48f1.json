{"sha": "20e07e7b8e1468f12a88281f6497304eb98d48f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwZTA3ZTdiOGUxNDY4ZjEyYTg4MjgxZjY0OTczMDRlYjk4ZDQ4ZjE=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-09-30T02:20:05Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-09-30T02:20:33Z"}, "message": "Forbid generator-specific MIR in all const-contexts", "tree": {"sha": "9c7243a9a35b98527eb4c04e62bb7fb52403a5c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c7243a9a35b98527eb4c04e62bb7fb52403a5c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20e07e7b8e1468f12a88281f6497304eb98d48f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20e07e7b8e1468f12a88281f6497304eb98d48f1", "html_url": "https://github.com/rust-lang/rust/commit/20e07e7b8e1468f12a88281f6497304eb98d48f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20e07e7b8e1468f12a88281f6497304eb98d48f1/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c38aca0502316ae610ab93deda7efa7ef8ef8473", "url": "https://api.github.com/repos/rust-lang/rust/commits/c38aca0502316ae610ab93deda7efa7ef8ef8473", "html_url": "https://github.com/rust-lang/rust/commit/c38aca0502316ae610ab93deda7efa7ef8ef8473"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "280f3e02058c6ec235f6000e620678fe676b6c3d", "filename": "compiler/rustc_mir/src/transform/check_consts/ops.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/20e07e7b8e1468f12a88281f6497304eb98d48f1/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20e07e7b8e1468f12a88281f6497304eb98d48f1/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=20e07e7b8e1468f12a88281f6497304eb98d48f1", "patch": "@@ -216,14 +216,12 @@ impl NonConstOp for FnPtrCast {\n #[derive(Debug)]\n pub struct Generator;\n impl NonConstOp for Generator {\n-    fn status_in_item(&self, ccx: &ConstCx<'_, '_>) -> Status {\n-        // FIXME: This means generator-only MIR is only forbidden in const fn. This is for\n-        // compatibility with the old code. Such MIR should be forbidden everywhere.\n-        mcf_status_in_item(ccx)\n+    fn status_in_item(&self, _: &ConstCx<'_, '_>) -> Status {\n+        Status::Forbidden\n     }\n \n     fn emit_error(&self, ccx: &ConstCx<'_, '_>, span: Span) {\n-        mcf_emit_error(ccx, span, \"const fn generators are unstable\");\n+        ccx.tcx.sess.struct_span_err(span, \"Generators and `async` functions cannot be `const`\").emit();\n     }\n }\n "}]}