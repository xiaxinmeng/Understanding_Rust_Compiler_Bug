{"sha": "a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "node_id": "C_kwDOAAsO6NoAKGE4OWM3OTU4ZjVkZjRkNDViZmNmMDg0Y2YzNzE2NjFiYjJlYWE5NmQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-20T12:45:37Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-20T13:07:41Z"}, "message": "tests: default to more threads for ui-tests\n\nBenchmarks (tested on i5-7200U, 2 core 4 threads)\n\n```\nmaster branch:\n\ncargo test // prime caches\ncargo --color=always test  70,39s user 21,91s system 180% cpu 51,035 total\ncargo --color=always test  70,77s user 22,13s system 180% cpu 51,579 total\ncargo --color=always test  70,97s user 22,12s system 180% cpu 51,673 total\n\ncargo --color=always nextest run  78,74s user 22,27s system 220% cpu 45,829 total\ncargo --color=always nextest run  78,46s user 21,92s system 224% cpu 44,674 total\ncargo --color=always nextest run  78,31s user 22,21s system 228% cpu 43,909 total\n\nPatched (ui_speedup branch)\n\ncargo test // prime cache\ncargo --color=always test  97,51s user 32,02s system 288% cpu 44,905 total\ncargo --color=always test  99,19s user 31,91s system 276% cpu 47,436 total\ncargo --color=always test  98,47s user 31,84s system 284% cpu 45,744 total\n\ncargo --color=always nextest run  102,18s user 30,80s system 350% cpu 37,902 total\ncargo --color=always nextest run  99,75s user 29,86s system 350% cpu 36,935 total\ncargo --color=always nextest run  100,36s user 29,93s system 351% cpu 37,061 total\n```", "tree": {"sha": "559c320908ae0f33a1d67e933e8c633bfd3ed94c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/559c320908ae0f33a1d67e933e8c633bfd3ed94c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "html_url": "https://github.com/rust-lang/rust/commit/a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a89c7958f5df4d45bfcf084cf371661bb2eaa96d/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29ee5e25d1096f142729ea44c1286e50823762e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/29ee5e25d1096f142729ea44c1286e50823762e8", "html_url": "https://github.com/rust-lang/rust/commit/29ee5e25d1096f142729ea44c1286e50823762e8"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "ef5b0a0cd7830f579af767382aee825158195f27", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a89c7958f5df4d45bfcf084cf371661bb2eaa96d/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a89c7958f5df4d45bfcf084cf371661bb2eaa96d/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "patch": "@@ -50,6 +50,7 @@ syn = { version = \"1.0\", features = [\"full\"] }\n futures = \"0.3\"\n parking_lot = \"0.11.2\"\n tokio = { version = \"1\", features = [\"io-util\"] }\n+num_cpus = \"1.13\"\n \n [build-dependencies]\n rustc_tools_util = { version = \"0.2\", path = \"rustc_tools_util\" }"}, {"sha": "6bc74bc1e9aada60c2755bc51415ee8edb986854", "filename": "tests/compile-test.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a89c7958f5df4d45bfcf084cf371661bb2eaa96d/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a89c7958f5df4d45bfcf084cf371661bb2eaa96d/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "patch": "@@ -162,6 +162,11 @@ fn run_ui() {\n     let config = base_config(\"ui\");\n     // use tests/clippy.toml\n     let _g = VarGuard::set(\"CARGO_MANIFEST_DIR\", fs::canonicalize(\"tests\").unwrap());\n+    let _threads = VarGuard::set(\n+        \"RUST_TEST_THREADS\",\n+        // if RUST_TEST_THREADS is set, adhere to it, otherwise override it\n+        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| num_cpus::get().to_string()),\n+    );\n     compiletest::run_tests(&config);\n }\n "}]}