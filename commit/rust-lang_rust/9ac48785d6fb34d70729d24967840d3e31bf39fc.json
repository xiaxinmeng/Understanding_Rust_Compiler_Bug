{"sha": "9ac48785d6fb34d70729d24967840d3e31bf39fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhYzQ4Nzg1ZDZmYjM0ZDcwNzI5ZDI0OTY3ODQwZDNlMzFiZjM5ZmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-12-01T19:26:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-12-01T19:26:57Z"}, "message": "auto merge of #10749 : Blei/rust/fix-linker-args, r=alexcrichton\n\nThis is inspired by a mystifying linker failure when using `pkg-config` to\r\ngenerate the linker args: `pkg-config` produces output that ends in a\r\nspace, thus resulting in an empty linker argument.\r\n\r\nAlso added some updates to the concerning error messages that helped\r\nspotting this bug.", "tree": {"sha": "9ed6749dd294717ace0ed9bdf5b0a4579c4150d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9ed6749dd294717ace0ed9bdf5b0a4579c4150d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ac48785d6fb34d70729d24967840d3e31bf39fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ac48785d6fb34d70729d24967840d3e31bf39fc", "html_url": "https://github.com/rust-lang/rust/commit/9ac48785d6fb34d70729d24967840d3e31bf39fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ac48785d6fb34d70729d24967840d3e31bf39fc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df41115213e851b9f23dfea3d6782dea5243a5d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/df41115213e851b9f23dfea3d6782dea5243a5d4", "html_url": "https://github.com/rust-lang/rust/commit/df41115213e851b9f23dfea3d6782dea5243a5d4"}, {"sha": "32688f8f7448b131434bbd340e7163ecd6d0e8ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/32688f8f7448b131434bbd340e7163ecd6d0e8ac", "html_url": "https://github.com/rust-lang/rust/commit/32688f8f7448b131434bbd340e7163ecd6d0e8ac"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "0890915b20e3defb683b13792e30530529f99cfe", "filename": "src/librustc/back/link.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Flibrustc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Flibrustc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Flink.rs?ref=9ac48785d6fb34d70729d24967840d3e31bf39fc", "patch": "@@ -362,12 +362,12 @@ pub mod write {\n             ~\"-o\", object.as_str().unwrap().to_owned(),\n             assembly.as_str().unwrap().to_owned()];\n \n-        debug!(\"{} {}\", cc, args.connect(\" \"));\n+        debug!(\"{} '{}'\", cc, args.connect(\"' '\"));\n         let prog = run::process_output(cc, args);\n \n         if !prog.status.success() {\n             sess.err(format!(\"linking with `{}` failed: {}\", cc, prog.status));\n-            sess.note(format!(\"{} arguments: {}\", cc, args.connect(\" \")));\n+            sess.note(format!(\"{} arguments: '{}'\", cc, args.connect(\"' '\")));\n             sess.note(str::from_utf8(prog.error + prog.output));\n             sess.abort_if_errors();\n         }\n@@ -1061,7 +1061,7 @@ fn link_natively(sess: Session, dylib: bool, obj_filename: &Path,\n     let mut cc_args = sess.targ_cfg.target_strs.cc_args.clone();\n     cc_args.push_all_move(link_args(sess, dylib, obj_filename, out_filename));\n     if (sess.opts.debugging_opts & session::print_link_args) != 0 {\n-        println!(\"{} link args: {}\", cc_prog, cc_args.connect(\" \"));\n+        println!(\"{} link args: '{}'\", cc_prog, cc_args.connect(\"' '\"));\n     }\n \n     // May have not found libraries in the right formats.\n@@ -1073,7 +1073,7 @@ fn link_natively(sess: Session, dylib: bool, obj_filename: &Path,\n \n     if !prog.status.success() {\n         sess.err(format!(\"linking with `{}` failed: {}\", cc_prog, prog.status));\n-        sess.note(format!(\"{} arguments: {}\", cc_prog, cc_args.connect(\" \")));\n+        sess.note(format!(\"{} arguments: '{}'\", cc_prog, cc_args.connect(\"' '\")));\n         sess.note(str::from_utf8(prog.error + prog.output));\n         sess.abort_if_errors();\n     }"}, {"sha": "5d991d300517388023dc953ebdf6eefabb6e32f3", "filename": "src/librustc/driver/driver.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Flibrustc%2Fdriver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Flibrustc%2Fdriver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fdriver.rs?ref=9ac48785d6fb34d70729d24967840d3e31bf39fc", "patch": "@@ -762,7 +762,13 @@ pub fn build_session_options(binary: @str,\n     let ar = matches.opt_str(\"ar\");\n     let linker = matches.opt_str(\"linker\");\n     let linker_args = matches.opt_strs(\"link-args\").flat_map( |a| {\n-        a.split(' ').map(|arg| arg.to_owned()).collect()\n+        a.split(' ').filter_map(|arg| {\n+            if arg.is_empty() {\n+                None\n+            } else {\n+                Some(arg.to_owned())\n+            }\n+        }).collect()\n     });\n \n     let cfg = parse_cfgspecs(matches.opt_strs(\"cfg\"), demitter);"}, {"sha": "53699e0dd984a7b7d5b58823f8dd15cb1b6e649e", "filename": "src/test/run-make/prune-link-args/Makefile", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile?ref=9ac48785d6fb34d70729d24967840d3e31bf39fc", "patch": "@@ -0,0 +1,6 @@\n+-include ../tools.mk\n+# Notice the space in the end, this emulates the output of pkg-config\n+RUSTC_FLAGS = --link-args \"-lc \"\n+\n+all:\n+\t$(RUSTC) $(RUSTC_FLAGS) empty.rs"}, {"sha": "45590d86ba6c51f0babffb0b43e3e2f44d2f9e07", "filename": "src/test/run-make/prune-link-args/empty.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Ftest%2Frun-make%2Fprune-link-args%2Fempty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ac48785d6fb34d70729d24967840d3e31bf39fc/src%2Ftest%2Frun-make%2Fprune-link-args%2Fempty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprune-link-args%2Fempty.rs?ref=9ac48785d6fb34d70729d24967840d3e31bf39fc", "patch": "@@ -0,0 +1 @@\n+fn main() { }"}]}