{"sha": "0790f75ae4892772583ef637b2fcde31039d8999", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3OTBmNzVhZTQ4OTI3NzI1ODNlZjYzN2IyZmNkZTMxMDM5ZDg5OTk=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-05-21T09:00:06Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-05-28T06:53:44Z"}, "message": "make cargo-miri a separate crate in a workspace", "tree": {"sha": "6bbd02a664d0f66588899df12112056c9b5fcdac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6bbd02a664d0f66588899df12112056c9b5fcdac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0790f75ae4892772583ef637b2fcde31039d8999", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0790f75ae4892772583ef637b2fcde31039d8999", "html_url": "https://github.com/rust-lang/rust/commit/0790f75ae4892772583ef637b2fcde31039d8999", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0790f75ae4892772583ef637b2fcde31039d8999/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b334004607f1cfb5754d9b0a007114748f272444", "url": "https://api.github.com/repos/rust-lang/rust/commits/b334004607f1cfb5754d9b0a007114748f272444", "html_url": "https://github.com/rust-lang/rust/commit/b334004607f1cfb5754d9b0a007114748f272444"}], "stats": {"total": 87, "additions": 53, "deletions": 34}, "files": [{"sha": "23eafaaa6e4ad2d52c8235a258826e7daf783086", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=0790f75ae4892772583ef637b2fcde31039d8999", "patch": "@@ -63,6 +63,18 @@ name = \"byteorder\"\n version = \"1.3.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"cargo-miri\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"cargo_metadata 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"directories 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rustc-workspace-hack 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"vergen 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"cargo_metadata\"\n version = \"0.9.1\"\n@@ -273,22 +285,16 @@ name = \"miri\"\n version = \"0.1.0\"\n dependencies = [\n  \"byteorder 1.3.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"cargo_metadata 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"colored 1.9.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"compiletest_rs 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"directories 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getrandom 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"hex 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rand 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-workspace-hack 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde 1.0.106 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_json 1.0.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"shell-escape 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"vergen 3.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]"}, {"sha": "6eede5ef464bc9bb6970a2de443b8f448f730d13", "filename": "Cargo.toml", "status": "modified", "additions": 6, "deletions": 23, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=0790f75ae4892772583ef637b2fcde31039d8999", "patch": "@@ -1,13 +1,16 @@\n [package]\n-authors = [\"Scott Olson <scott@solson.me>\"]\n-description = \"An experimental interpreter for Rust MIR.\"\n+authors = [\"Miri Team\"]\n+description = \"An experimental interpreter for Rust MIR (core driver).\"\n license = \"MIT/Apache-2.0\"\n name = \"miri\"\n repository = \"https://github.com/rust-lang/miri\"\n version = \"0.1.0\"\n default-run = \"miri\"\n edition = \"2018\"\n \n+[workspace]\n+members = [\"cargo-miri\"]\n+\n [lib]\n test = true # we have unit tests\n doctest = false # but no doc tests\n@@ -17,24 +20,13 @@ name = \"miri\"\n test = false # we have no unit tests\n doctest = false # and no doc tests\n \n-[[bin]]\n-name = \"cargo-miri\"\n-test = false # we have no unit tests\n-doctest = false # and no doc tests\n-required-features = [\"cargo_miri\"]\n-\n [[bin]]\n name = \"miri-rustc-tests\"\n test = false # we have no unit tests\n doctest = false # and no doc tests\n required-features = [\"rustc_tests\"]\n \n [dependencies]\n-cargo_metadata = { version = \"0.9.0\", optional = true }\n-directories = { version = \"2.0\", optional = true }\n-rustc_version = { version = \"0.2.3\", optional = true }\n-serde_json = { version = \"1.0.40\", optional = true }\n-\n getrandom = { version = \"0.1.8\", features = [\"std\"] }\n byteorder = \"1.3\"\n env_logger = \"0.7.1\"\n@@ -48,19 +40,10 @@ rand = \"0.7\"\n # for more information.\n rustc-workspace-hack = \"1.0.0\"\n \n-# Some extra dependency for better feature control to avoid having to rebuild\n-# between \"cargo build\" and \"cargo intall\".\n-num-traits = \"*\"\n-serde = { version = \"*\", features = [\"derive\"] }\n-\n-[build-dependencies]\n-vergen = \"3\"\n-\n [dev-dependencies]\n compiletest_rs = { version = \"0.5\", features = [\"tmp\"] }\n+rustc_version = \"0.2.3\"\n colored = \"1.6\"\n \n [features]\n-default = [\"cargo_miri\"]\n-cargo_miri = [\"cargo_metadata\", \"directories\", \"rustc_version\", \"serde_json\"]\n rustc_tests = []"}, {"sha": "86b2576273d2284e633ee5d8fac897359ccd8bf1", "filename": "cargo-miri/Cargo.toml", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2FCargo.toml?ref=0790f75ae4892772583ef637b2fcde31039d8999", "patch": "@@ -0,0 +1,28 @@\n+[package]\n+authors = [\"Miri Team\"]\n+description = \"An experimental interpreter for Rust MIR (cargo wrapper).\"\n+license = \"MIT/Apache-2.0\"\n+name = \"cargo-miri\"\n+repository = \"https://github.com/rust-lang/miri\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+\n+[[bin]]\n+name = \"cargo-miri\"\n+path = \"bin.rs\"\n+test = false # we have no unit tests\n+doctest = false # and no doc tests\n+\n+[dependencies]\n+cargo_metadata = \"0.9.0\"\n+directories = \"2.0\"\n+rustc_version = \"0.2.3\"\n+serde_json = \"1.0.40\"\n+\n+# A noop dependency that changes in the Rust repository, it's a bit of a hack.\n+# See the `src/tools/rustc-workspace-hack/README.md` file in `rust-lang/rust`\n+# for more information.\n+rustc-workspace-hack = \"1.0.0\"\n+\n+[build-dependencies]\n+vergen = \"3\""}, {"sha": "2e2d4ce956b13dd218be871d1aadcc7092c97b13", "filename": "cargo-miri/bin.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=0790f75ae4892772583ef637b2fcde31039d8999", "previous_filename": "src/bin/cargo-miri.rs"}, {"sha": "56956920e2e2690e9d65498b61b0a9eab280a92f", "filename": "cargo-miri/build.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/cargo-miri%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbuild.rs?ref=0790f75ae4892772583ef637b2fcde31039d8999", "previous_filename": "build.rs"}, {"sha": "948a839ef7271f8e1638c0fb5eb3b758dcdaa6ab", "filename": "miri", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0790f75ae4892772583ef637b2fcde31039d8999/miri", "raw_url": "https://github.com/rust-lang/rust/raw/0790f75ae4892772583ef637b2fcde31039d8999/miri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/miri?ref=0790f75ae4892772583ef637b2fcde31039d8999", "patch": "@@ -59,9 +59,9 @@ fi\n # Build a sysroot and set MIRI_SYSROOT to use it.  Arguments are passed to `cargo miri setup`.\n build_sysroot() {\n     # Build once, for the user to see.\n-    cargo run $CARGO_BUILD_FLAGS --bin cargo-miri -- miri setup \"$@\"\n+    cargo run $CARGO_BUILD_FLAGS -p cargo-miri -- miri setup \"$@\"\n     # Call again, to just set env var.\n-    export MIRI_SYSROOT=\"$(cargo run $CARGO_BUILD_FLAGS -q --bin cargo-miri -- miri setup --print-sysroot \"$@\")\"\n+    export MIRI_SYSROOT=\"$(cargo run $CARGO_BUILD_FLAGS -q -p cargo-miri -- miri setup --print-sysroot \"$@\")\"\n }\n \n # Prepare and set MIRI_SYSROOT.  Respects `MIRI_TEST_TARGET` and takes into account\n@@ -104,21 +104,23 @@ case \"$COMMAND\" in\n install|install-debug)\n     # \"--locked\" to respect the Cargo.lock file if it exists,\n     # \"--offline\" to avoid querying the registry (for yanked packages).\n-    exec cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\" --force --locked --offline \"$@\"\n+    cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\" --force --locked --offline \"$@\"\n+    cargo install $CARGO_INSTALL_FLAGS --path \"$(dirname \"$0\")\"/cargo-miri --force --locked --offline \"$@\"\n     ;;\n check|check-debug)\n     # Check, and let caller control flags.\n-    exec cargo check $CARGO_BUILD_FLAGS \"$@\"\n+    exec cargo check $CARGO_BUILD_FLAGS --all \"$@\"\n     ;;\n build|build-debug)\n     # Build, and let caller control flags.\n-    exec cargo build $CARGO_BUILD_FLAGS \"$@\"\n+    exec cargo build $CARGO_BUILD_FLAGS --all \"$@\"\n     ;;\n test|test-debug)\n     # First build and get a sysroot.\n     cargo build $CARGO_BUILD_FLAGS\n     find_sysroot\n     # Then test, and let caller control flags.\n+    # No `--all` as `cargo-miri` has no tests.\n     exec cargo test $CARGO_BUILD_FLAGS \"$@\"\n     ;;\n run|run-debug)"}]}