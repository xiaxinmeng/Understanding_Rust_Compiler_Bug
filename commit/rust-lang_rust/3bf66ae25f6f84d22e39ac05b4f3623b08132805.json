{"sha": "3bf66ae25f6f84d22e39ac05b4f3623b08132805", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiZjY2YWUyNWY2Zjg0ZDIyZTM5YWMwNWI0ZjM2MjNiMDgxMzI4MDU=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2020-09-16T19:24:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-09-16T19:24:30Z"}, "message": "Rollup merge of #76794 - richkadel:graphviz-font, r=ecstatic-morse\n\nMake graphviz font configurable\n\nAlternative to PR #76776.\n\nTo change the graphviz output to use an alternative `fontname` value,\nadd a command line option like: `rustc --graphviz-font=monospace`.\n\nr? @ecstatic-morse", "tree": {"sha": "1047826207d4e05121ee93637bba49f107adbfe9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1047826207d4e05121ee93637bba49f107adbfe9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3bf66ae25f6f84d22e39ac05b4f3623b08132805", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfYmZvCRBK7hj4Ov3rIwAAdHIIABTPH0u8TX6hqCwmEHMGsC6V\nOd4ix3eOKBDEpowZjfNpWTaLR4Q+Bx0dSx6GK5Zi8JtfDUy+7rEVO859kXu/W358\nUqtlfpgUIfQLWUC6gZjbLFwmQG/8ViffGgxq2eMjltpuzOmYW788cYyxxhN6TouC\nCAnsj8r4Uwh4z+jM7ZvX6fBJd1EoCHrElJ7Auj2JFp55pPxruOg/VrBU1x8BRREg\nlaM8elFzR6gd62YM+kLv4YNBPDONGo/D/0M1Mvz6tJKxfgWrK+MOxAHyrrhllXXv\nyPp8mQEy7meNm+lolOOBNI5hqpCVQqS1a9xUlGciYaynVpuPSufdIwFo62IxayA=\n=B01y\n-----END PGP SIGNATURE-----\n", "payload": "tree 1047826207d4e05121ee93637bba49f107adbfe9\nparent d3c63213a045712fc653427a261b2441e931f3c0\nparent 3875abe32f6b98449bf2ec99ed210b7b77953703\nauthor Tyler Mandry <tmandry@gmail.com> 1600284270 -0700\ncommitter GitHub <noreply@github.com> 1600284270 -0700\n\nRollup merge of #76794 - richkadel:graphviz-font, r=ecstatic-morse\n\nMake graphviz font configurable\n\nAlternative to PR #76776.\n\nTo change the graphviz output to use an alternative `fontname` value,\nadd a command line option like: `rustc --graphviz-font=monospace`.\n\nr? @ecstatic-morse\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3bf66ae25f6f84d22e39ac05b4f3623b08132805", "html_url": "https://github.com/rust-lang/rust/commit/3bf66ae25f6f84d22e39ac05b4f3623b08132805", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3bf66ae25f6f84d22e39ac05b4f3623b08132805/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3c63213a045712fc653427a261b2441e931f3c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3c63213a045712fc653427a261b2441e931f3c0", "html_url": "https://github.com/rust-lang/rust/commit/d3c63213a045712fc653427a261b2441e931f3c0"}, {"sha": "3875abe32f6b98449bf2ec99ed210b7b77953703", "url": "https://api.github.com/repos/rust-lang/rust/commits/3875abe32f6b98449bf2ec99ed210b7b77953703", "html_url": "https://github.com/rust-lang/rust/commit/3875abe32f6b98449bf2ec99ed210b7b77953703"}], "stats": {"total": 33, "additions": 22, "deletions": 11}, "files": [{"sha": "58db81bc1dc619c35d5d6c2ef984f95d928a23b9", "filename": "compiler/rustc_graphviz/src/lib.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs?ref=3bf66ae25f6f84d22e39ac05b4f3623b08132805", "patch": "@@ -591,14 +591,14 @@ pub trait GraphWalk<'a> {\n     fn target(&'a self, edge: &Self::Edge) -> Self::Node;\n }\n \n-#[derive(Copy, Clone, PartialEq, Eq, Debug)]\n+#[derive(Clone, PartialEq, Eq, Debug)]\n pub enum RenderOption {\n     NoEdgeLabels,\n     NoNodeLabels,\n     NoEdgeStyles,\n     NoNodeStyles,\n \n-    Monospace,\n+    Fontname(String),\n     DarkTheme,\n }\n \n@@ -633,11 +633,14 @@ where\n     // Global graph properties\n     let mut graph_attrs = Vec::new();\n     let mut content_attrs = Vec::new();\n-    if options.contains(&RenderOption::Monospace) {\n-        let font = r#\"fontname=\"Courier, monospace\"\"#;\n-        graph_attrs.push(font);\n-        content_attrs.push(font);\n-    };\n+    let font;\n+    if let Some(fontname) = options.iter().find_map(|option| {\n+        if let RenderOption::Fontname(fontname) = option { Some(fontname) } else { None }\n+    }) {\n+        font = format!(r#\"fontname=\"{}\"\"#, fontname);\n+        graph_attrs.push(&font[..]);\n+        content_attrs.push(&font[..]);\n+    }\n     if options.contains(&RenderOption::DarkTheme) {\n         graph_attrs.push(r#\"bgcolor=\"black\"\"#);\n         content_attrs.push(r#\"color=\"white\"\"#);"}, {"sha": "4084083bd9956a4a493aee952e254243e2812937", "filename": "compiler/rustc_mir/src/dataflow/framework/engine.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs?ref=3bf66ae25f6f84d22e39ac05b4f3623b08132805", "patch": "@@ -306,7 +306,8 @@ where\n     let mut buf = Vec::new();\n \n     let graphviz = graphviz::Formatter::new(body, def_id, results, style);\n-    let mut render_opts = vec![dot::RenderOption::Monospace];\n+    let mut render_opts =\n+        vec![dot::RenderOption::Fontname(tcx.sess.opts.debugging_opts.graphviz_font.clone())];\n     if tcx.sess.opts.debugging_opts.graphviz_dark_mode {\n         render_opts.push(dot::RenderOption::DarkTheme);\n     }"}, {"sha": "4511962d68f032dcfccfc933aa943c8f2f3fd383", "filename": "compiler/rustc_mir/src/util/graphviz.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs?ref=3bf66ae25f6f84d22e39ac05b4f3623b08132805", "patch": "@@ -55,9 +55,9 @@ where\n     writeln!(w, \"{} {}Mir_{} {{\", kind, cluster, def_name)?;\n \n     // Global graph properties\n-    let font = r#\"fontname=\"Courier, monospace\"\"#;\n-    let mut graph_attrs = vec![font];\n-    let mut content_attrs = vec![font];\n+    let font = format!(r#\"fontname=\"{}\"\"#, tcx.sess.opts.debugging_opts.graphviz_font);\n+    let mut graph_attrs = vec![&font[..]];\n+    let mut content_attrs = vec![&font[..]];\n \n     let dark_mode = tcx.sess.opts.debugging_opts.graphviz_dark_mode;\n     if dark_mode {"}, {"sha": "3f12596a236abe228b6e8fb2ddf77fa5ad11e22c", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=3bf66ae25f6f84d22e39ac05b4f3623b08132805", "patch": "@@ -1762,6 +1762,10 @@ pub fn build_session_options(matches: &getopts::Matches) -> Options {\n         debugging_opts.symbol_mangling_version = SymbolManglingVersion::V0;\n     }\n \n+    if let Ok(graphviz_font) = std::env::var(\"RUSTC_GRAPHVIZ_FONT\") {\n+        debugging_opts.graphviz_font = graphviz_font;\n+    }\n+\n     if !cg.embed_bitcode {\n         match cg.lto {\n             LtoCli::No | LtoCli::Unspecified => {}"}, {"sha": "8cc55f4ebe895245ba6bd31c56ea327eb4db7cc8", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bf66ae25f6f84d22e39ac05b4f3623b08132805/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=3bf66ae25f6f84d22e39ac05b4f3623b08132805", "patch": "@@ -911,6 +911,9 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"set the optimization fuel quota for a crate\"),\n     graphviz_dark_mode: bool = (false, parse_bool, [UNTRACKED],\n         \"use dark-themed colors in graphviz output (default: no)\"),\n+    graphviz_font: String = (\"Courier, monospace\".to_string(), parse_string, [UNTRACKED],\n+        \"use the given `fontname` in graphviz output; can be overridden by setting \\\n+        environment variable `RUSTC_GRAPHVIZ_FONT` (default: `Courier, monospace`)\"),\n     hir_stats: bool = (false, parse_bool, [UNTRACKED],\n         \"print some statistics about AST and HIR (default: no)\"),\n     human_readable_cgu_names: bool = (false, parse_bool, [TRACKED],"}]}