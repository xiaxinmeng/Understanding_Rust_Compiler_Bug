{"sha": "8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5NTZhN2Y1ODE5NGI1YTNhOGRlOTQ0ZWExZGMxYjNiNDRhMDcwYWM=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-06-15T19:15:35Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-06-15T19:15:35Z"}, "message": "Only display other method receiver candidates if they actually apply\n\nPreviously, we would suggest `Box<Self>` as a valid receiver, even if\nmethod resolution only succeeded due to an autoderef (e.g. to `&self`)", "tree": {"sha": "293fd67ec60f187aa97c4856e513e399e0045575", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/293fd67ec60f187aa97c4856e513e399e0045575"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl7nyR0ACgkQtAh+UQ6Y\nsWR1cw//Xot4M8eWClGTk/V2RmaH3ovCyM9Wu3tqc75qI9QvlcD2gfcIsMj9Junj\nV1alzraJB20lodGv1aBSQZWaOkO+dT8er1vp5EFMqSxIlTZ6KzPKyr156CDHHduP\nv6fwJuMSU+s8LlNjPWm5aivx6CJniyupXXAUiP82KCHNVAbI5PMyFwyIJID/d+5O\nj6n3hCVUTulumva+dnze1TRNx4t1Uy0fs/lrm32UZpklYgyIzYFBgifwN6vbbK1Y\n6hq7/GB2zU/iGyBJu2ms2ehRC4HJSKfcE7CVww+s3Pc/b2l5704ypeNJadrLWzTR\nIrxXGuPIQ9f9fu0guRCmT5hvkGgEEw0mBgXdPh3yefLrePGX+tH2LE+upgSpnWjh\n3FEqpD460cxATIHVK6ZVn4XtNKY99mNvHz9mwrBio/ZP7FjhdthxHPKBxYp+fhRc\nmVte7b63kwdf5eCpTyB4mqTbmx2tIYmMvkVWRVbB+j1FL1/48ZSMVbrt4g0s+wKF\nNhV9kpRSXytTD1fHL70naqwBdbgiwA24WeLOe/FTMdS4mkhxJx4sgPqdn/0h+vLW\nFhuA+/AppPSGpTxXw2IWw/VIaob36q/2tn+w7XwhLiDpdDUK7SMbbOtoo92WRePJ\nohqYwQE7hmInWKlXQUv2ErjLzrD1g39w9tC5cHbakwNgMsEM62E=\n=MFJB\n-----END PGP SIGNATURE-----", "payload": "tree 293fd67ec60f187aa97c4856e513e399e0045575\nparent ff4a2533a0720f9cdd86e02eafa3725f07aa7752\nauthor Aaron Hill <aa1ronham@gmail.com> 1592248535 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1592248535 -0400\n\nOnly display other method receiver candidates if they actually apply\n\nPreviously, we would suggest `Box<Self>` as a valid receiver, even if\nmethod resolution only succeeded due to an autoderef (e.g. to `&self`)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "html_url": "https://github.com/rust-lang/rust/commit/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff4a2533a0720f9cdd86e02eafa3725f07aa7752", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff4a2533a0720f9cdd86e02eafa3725f07aa7752", "html_url": "https://github.com/rust-lang/rust/commit/ff4a2533a0720f9cdd86e02eafa3725f07aa7752"}], "stats": {"total": 39, "additions": 10, "deletions": 29}, "files": [{"sha": "e16abed644c7bb0334b7e90f35386a863f04d63c", "filename": "src/librustc_typeck/check/expr.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs?ref=8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "patch": "@@ -913,10 +913,16 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     rcvr,\n                     probe::ProbeScope::AllTraits,\n                 ) {\n-                    err.span_label(\n-                        pick.item.ident.span,\n-                        &format!(\"the method is available for `{}` here\", new_rcvr_t),\n-                    );\n+                    debug!(\"try_alt_rcvr: pick candidate {:?}\", pick);\n+                    // Make sure the method is defined for the *actual* receiver:\n+                    // we don't want to treat `Box<Self>` as a receiver if\n+                    // it only works because of an autoderef to `&self`\n+                    if pick.autoderefs == 0 {\n+                        err.span_label(\n+                            pick.item.ident.span,\n+                            &format!(\"the method is available for `{}` here\", new_rcvr_t),\n+                        );\n+                    }\n                 }\n             }\n         };"}, {"sha": "3cd4d0dd391af41490eebebb5b97cb4274cc60cc", "filename": "src/test/ui/impl-trait/no-method-suggested-traits.stderr", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fno-method-suggested-traits.stderr?ref=8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "patch": "@@ -49,14 +49,6 @@ LL | use foo::Bar;\n error[E0599]: no method named `method` found for struct `std::rc::Rc<&mut std::boxed::Box<&char>>` in the current scope\n   --> $DIR/no-method-suggested-traits.rs:32:43\n    |\n-LL |         fn method(&self) {}\n-   |            ------\n-   |            |\n-   |            the method is available for `std::boxed::Box<std::rc::Rc<&mut std::boxed::Box<&char>>>` here\n-   |            the method is available for `std::pin::Pin<std::rc::Rc<&mut std::boxed::Box<&char>>>` here\n-   |            the method is available for `std::sync::Arc<std::rc::Rc<&mut std::boxed::Box<&char>>>` here\n-   |            the method is available for `std::rc::Rc<std::rc::Rc<&mut std::boxed::Box<&char>>>` here\n-...\n LL |     std::rc::Rc::new(&mut Box::new(&'a')).method();\n    |                                           ^^^^^^ method not found in `std::rc::Rc<&mut std::boxed::Box<&char>>`\n    |\n@@ -83,16 +75,6 @@ error[E0599]: no method named `method` found for struct `std::rc::Rc<&mut std::b\n    |\n LL |     std::rc::Rc::new(&mut Box::new(&1i32)).method();\n    |                                            ^^^^^^ method not found in `std::rc::Rc<&mut std::boxed::Box<&i32>>`\n-   | \n-  ::: $DIR/auxiliary/no_method_suggested_traits.rs:8:12\n-   |\n-LL |         fn method(&self) {}\n-   |            ------\n-   |            |\n-   |            the method is available for `std::boxed::Box<std::rc::Rc<&mut std::boxed::Box<&i32>>>` here\n-   |            the method is available for `std::pin::Pin<std::rc::Rc<&mut std::boxed::Box<&i32>>>` here\n-   |            the method is available for `std::sync::Arc<std::rc::Rc<&mut std::boxed::Box<&i32>>>` here\n-   |            the method is available for `std::rc::Rc<std::rc::Rc<&mut std::boxed::Box<&i32>>>` here\n    |\n    = help: items from traits can only be used if the trait is in scope\n help: the following trait is implemented but not in scope; perhaps add a `use` for it:"}, {"sha": "3be4f1109731176d132b4bd27ae86e38932082ee", "filename": "src/test/ui/traits/trait-item-privacy.stderr", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Ftest%2Fui%2Ftraits%2Ftrait-item-privacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8956a7f58194b5a3a8de944ea1dc1b3b44a070ac/src%2Ftest%2Fui%2Ftraits%2Ftrait-item-privacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Ftrait-item-privacy.stderr?ref=8956a7f58194b5a3a8de944ea1dc1b3b44a070ac", "patch": "@@ -20,13 +20,6 @@ error[E0599]: no method named `b` found for struct `S` in the current scope\n LL | struct S;\n    | --------- method `b` not found for this\n ...\n-LL |         fn b(&self) { }\n-   |            -\n-   |            |\n-   |            the method is available for `std::boxed::Box<S>` here\n-   |            the method is available for `std::sync::Arc<S>` here\n-   |            the method is available for `std::rc::Rc<S>` here\n-...\n LL |     S.b();\n    |       ^ method not found in `S`\n    |"}]}