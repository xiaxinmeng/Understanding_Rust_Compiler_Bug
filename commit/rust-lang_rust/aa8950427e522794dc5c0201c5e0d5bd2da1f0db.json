{"sha": "aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhODk1MDQyN2U1MjI3OTRkYzVjMDIwMWM1ZTBkNWJkMmRhMWYwZGI=", "commit": {"author": {"name": "diaphore", "email": "diaphore@gmail.com", "date": "2015-07-26T17:32:13Z"}, "committer": {"name": "diaphore", "email": "diaphore@gmail.com", "date": "2015-07-27T17:57:28Z"}, "message": "Fix escaping of characters in Debug for OsStr\n\nFixes #27211\n\nFix Debug for {char, str} in core::fmt", "tree": {"sha": "f44de6ca4dbd10c738844ada745bb771892d1918", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f44de6ca4dbd10c738844ada745bb771892d1918"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "html_url": "https://github.com/rust-lang/rust/commit/aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa8950427e522794dc5c0201c5e0d5bd2da1f0db/comments", "author": {"login": "diaphore", "id": 10867111, "node_id": "MDQ6VXNlcjEwODY3MTEx", "avatar_url": "https://avatars.githubusercontent.com/u/10867111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diaphore", "html_url": "https://github.com/diaphore", "followers_url": "https://api.github.com/users/diaphore/followers", "following_url": "https://api.github.com/users/diaphore/following{/other_user}", "gists_url": "https://api.github.com/users/diaphore/gists{/gist_id}", "starred_url": "https://api.github.com/users/diaphore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diaphore/subscriptions", "organizations_url": "https://api.github.com/users/diaphore/orgs", "repos_url": "https://api.github.com/users/diaphore/repos", "events_url": "https://api.github.com/users/diaphore/events{/privacy}", "received_events_url": "https://api.github.com/users/diaphore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "diaphore", "id": 10867111, "node_id": "MDQ6VXNlcjEwODY3MTEx", "avatar_url": "https://avatars.githubusercontent.com/u/10867111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diaphore", "html_url": "https://github.com/diaphore", "followers_url": "https://api.github.com/users/diaphore/followers", "following_url": "https://api.github.com/users/diaphore/following{/other_user}", "gists_url": "https://api.github.com/users/diaphore/gists{/gist_id}", "starred_url": "https://api.github.com/users/diaphore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diaphore/subscriptions", "organizations_url": "https://api.github.com/users/diaphore/orgs", "repos_url": "https://api.github.com/users/diaphore/repos", "events_url": "https://api.github.com/users/diaphore/events{/privacy}", "received_events_url": "https://api.github.com/users/diaphore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0469be1eb70404a57dcc558aa8f53ab529aede47", "url": "https://api.github.com/repos/rust-lang/rust/commits/0469be1eb70404a57dcc558aa8f53ab529aede47", "html_url": "https://github.com/rust-lang/rust/commit/0469be1eb70404a57dcc558aa8f53ab529aede47"}], "stats": {"total": 44, "additions": 27, "deletions": 17}, "files": [{"sha": "02b23c6c7e74980a896290608a8ca1b12d9d39b2", "filename": "src/libcore/fmt/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa8950427e522794dc5c0201c5e0d5bd2da1f0db/src%2Flibcore%2Ffmt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa8950427e522794dc5c0201c5e0d5bd2da1f0db/src%2Flibcore%2Ffmt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ffmt%2Fmod.rs?ref=aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "patch": "@@ -1287,7 +1287,7 @@ impl Debug for str {\n     fn fmt(&self, f: &mut Formatter) -> Result {\n         try!(write!(f, \"\\\"\"));\n         for c in self.chars().flat_map(|c| c.escape_default()) {\n-            try!(write!(f, \"{}\", c));\n+            try!(f.write_char(c))\n         }\n         write!(f, \"\\\"\")\n     }\n@@ -1306,7 +1306,7 @@ impl Debug for char {\n         use char::CharExt;\n         try!(write!(f, \"'\"));\n         for c in self.escape_default() {\n-            try!(write!(f, \"{}\", c));\n+            try!(f.write_char(c))\n         }\n         write!(f, \"'\")\n     }"}, {"sha": "3d5d1f5e0ebd1205a99acf8e309462529ab51e8f", "filename": "src/libstd/sys/common/wtf8.rs", "status": "modified", "additions": 25, "deletions": 15, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/aa8950427e522794dc5c0201c5e0d5bd2da1f0db/src%2Flibstd%2Fsys%2Fcommon%2Fwtf8.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa8950427e522794dc5c0201c5e0d5bd2da1f0db/src%2Flibstd%2Fsys%2Fcommon%2Fwtf8.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fcommon%2Fwtf8.rs?ref=aa8950427e522794dc5c0201c5e0d5bd2da1f0db", "patch": "@@ -426,26 +426,36 @@ impl Ord for Wtf8 {\n /// and surrogates as `\\u` followed by four hexadecimal digits.\n /// Example: `\"a\\u{D800}\"` for a slice with code points [U+0061, U+D800]\n impl fmt::Debug for Wtf8 {\n-    fn fmt(&self, formatter: &mut fmt::Formatter) -> Result<(), fmt::Error> {\n+    fn fmt(&self, formatter: &mut fmt::Formatter) -> fmt::Result {\n+        fn write_str_escaped(f: &mut fmt::Formatter, s: &str) -> fmt::Result {\n+            use fmt::Write;\n+            for c in s.chars().flat_map(|c| c.escape_default()) {\n+                try!(f.write_char(c))\n+            }\n+            Ok(())\n+        }\n+\n         try!(formatter.write_str(\"\\\"\"));\n         let mut pos = 0;\n         loop {\n             match self.next_surrogate(pos) {\n                 None => break,\n                 Some((surrogate_pos, surrogate)) => {\n-                    try!(formatter.write_str(unsafe {\n-                        // the data in this slice is valid UTF-8, transmute to &str\n-                        mem::transmute(&self.bytes[pos .. surrogate_pos])\n-                    }));\n+                    try!(write_str_escaped(\n+                        formatter,\n+                        unsafe { str::from_utf8_unchecked(\n+                            &self.bytes[pos .. surrogate_pos]\n+                        )},\n+                    ));\n                     try!(write!(formatter, \"\\\\u{{{:X}}}\", surrogate));\n                     pos = surrogate_pos + 3;\n                 }\n             }\n         }\n-        try!(formatter.write_str(unsafe {\n-            // the data in this slice is valid UTF-8, transmute to &str\n-            mem::transmute(&self.bytes[pos..])\n-        }));\n+        try!(write_str_escaped(\n+            formatter,\n+            unsafe { str::from_utf8_unchecked(&self.bytes[pos..]) },\n+        ));\n         formatter.write_str(\"\\\"\")\n     }\n }\n@@ -1083,9 +1093,9 @@ mod tests {\n \n     #[test]\n     fn wtf8buf_show() {\n-        let mut string = Wtf8Buf::from_str(\"a\u00e9 \ud83d\udca9\");\n+        let mut string = Wtf8Buf::from_str(\"a\\t\u00e9 \ud83d\udca9\\r\");\n         string.push(CodePoint::from_u32(0xD800).unwrap());\n-        assert_eq!(format!(\"{:?}\", string), r#\"\"a\u00e9 \ud83d\udca9\\u{D800}\"\"#);\n+        assert_eq!(format!(\"{:?}\", string), r#\"\"a\\t\\u{e9} \\u{1f4a9}\\r\\u{D800}\"\"#);\n     }\n \n     #[test]\n@@ -1094,10 +1104,10 @@ mod tests {\n     }\n \n     #[test]\n-    fn wtf8_show() {\n-        let mut string = Wtf8Buf::from_str(\"a\u00e9 \ud83d\udca9\");\n-        string.push(CodePoint::from_u32(0xD800).unwrap());\n-        assert_eq!(format!(\"{:?}\", string), r#\"\"a\u00e9 \ud83d\udca9\\u{D800}\"\"#);\n+    fn wtf8buf_show_str() {\n+        let text = \"a\\t\u00e9 \ud83d\udca9\\r\";\n+        let mut string = Wtf8Buf::from_str(text);\n+        assert_eq!(format!(\"{:?}\", text), format!(\"{:?}\", string));\n     }\n \n     #[test]"}]}