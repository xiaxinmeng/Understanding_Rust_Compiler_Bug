{"sha": "0411edfbbda82407c956b69db5bf687f8749766e", "node_id": "C_kwDOAAsO6NoAKDA0MTFlZGZiYmRhODI0MDdjOTU2YjY5ZGI1YmY2ODdmODc0OTc2NmU", "commit": {"author": {"name": "Sosth\u00e8ne Gu\u00e9don", "email": "sosthene@guedon.gdn", "date": "2022-11-20T14:34:56Z"}, "committer": {"name": "Sosth\u00e8ne Gu\u00e9don", "email": "sosthene@guedon.gdn", "date": "2022-11-20T14:49:09Z"}, "message": "Improve diagnostic for cases where autoderef is used", "tree": {"sha": "e3ddd8595b5fcae4d31e60b20d8ddc96e0d20590", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3ddd8595b5fcae4d31e60b20d8ddc96e0d20590"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0411edfbbda82407c956b69db5bf687f8749766e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0411edfbbda82407c956b69db5bf687f8749766e", "html_url": "https://github.com/rust-lang/rust/commit/0411edfbbda82407c956b69db5bf687f8749766e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0411edfbbda82407c956b69db5bf687f8749766e/comments", "author": {"login": "sgued", "id": 51865119, "node_id": "MDQ6VXNlcjUxODY1MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/51865119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgued", "html_url": "https://github.com/sgued", "followers_url": "https://api.github.com/users/sgued/followers", "following_url": "https://api.github.com/users/sgued/following{/other_user}", "gists_url": "https://api.github.com/users/sgued/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgued/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgued/subscriptions", "organizations_url": "https://api.github.com/users/sgued/orgs", "repos_url": "https://api.github.com/users/sgued/repos", "events_url": "https://api.github.com/users/sgued/events{/privacy}", "received_events_url": "https://api.github.com/users/sgued/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sgued", "id": 51865119, "node_id": "MDQ6VXNlcjUxODY1MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/51865119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgued", "html_url": "https://github.com/sgued", "followers_url": "https://api.github.com/users/sgued/followers", "following_url": "https://api.github.com/users/sgued/following{/other_user}", "gists_url": "https://api.github.com/users/sgued/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgued/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgued/subscriptions", "organizations_url": "https://api.github.com/users/sgued/orgs", "repos_url": "https://api.github.com/users/sgued/repos", "events_url": "https://api.github.com/users/sgued/events{/privacy}", "received_events_url": "https://api.github.com/users/sgued/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6178ddaded7f73ba413475ea27ac98336069cb11", "url": "https://api.github.com/repos/rust-lang/rust/commits/6178ddaded7f73ba413475ea27ac98336069cb11", "html_url": "https://github.com/rust-lang/rust/commit/6178ddaded7f73ba413475ea27ac98336069cb11"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "5424c0eecfed54cca32525ce9bea41a4c7e3e050", "filename": "clippy_lints/src/functions/misnamed_getters.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0411edfbbda82407c956b69db5bf687f8749766e/clippy_lints%2Fsrc%2Ffunctions%2Fmisnamed_getters.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0411edfbbda82407c956b69db5bf687f8749766e/clippy_lints%2Fsrc%2Ffunctions%2Fmisnamed_getters.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ffunctions%2Fmisnamed_getters.rs?ref=0411edfbbda82407c956b69db5bf687f8749766e", "patch": "@@ -75,7 +75,7 @@ pub fn check_fn(\n         }\n     };\n \n-    let ty = cx.typeck_results().expr_ty(self_data);\n+    let ty = cx.typeck_results().expr_ty_adjusted(self_data);\n \n     let def = {\n         let mut kind = ty.kind();\n@@ -102,7 +102,7 @@ pub fn check_fn(\n \n     let Some(used_field) = used_field else {\n         // FIXME: This can be reached if the field access uses autoderef.\n-        // `dec.all_fields()` should be replaced by something that uses autoderef.\n+        // `dec.all_fields()` should be replaced by something that uses autoderef on the unajusted type of `self_data`\n         return;\n     };\n "}, {"sha": "5210295893e8e29f6d6e42366f78d5ad6633df35", "filename": "tests/ui/misnamed_getters.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0411edfbbda82407c956b69db5bf687f8749766e/tests%2Fui%2Fmisnamed_getters.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0411edfbbda82407c956b69db5bf687f8749766e/tests%2Fui%2Fmisnamed_getters.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmisnamed_getters.stderr?ref=0411edfbbda82407c956b69db5bf687f8749766e", "patch": "@@ -126,5 +126,23 @@ LL | |         &mut self.a\n LL | |     }\n    | |_____^\n \n-error: aborting due to 14 previous errors\n+error: getter function appears to return the wrong field\n+  --> $DIR/misnamed_getters.rs:92:5\n+   |\n+LL | /     unsafe fn a(&self) -> &u8 {\n+LL | |         &self.inner.b\n+   | |         ------------- help: consider using: `&self.inner.a`\n+LL | |     }\n+   | |_____^\n+\n+error: getter function appears to return the wrong field\n+  --> $DIR/misnamed_getters.rs:95:5\n+   |\n+LL | /     unsafe fn a_mut(&mut self) -> &mut u8 {\n+LL | |         &mut self.inner.b\n+   | |         ----------------- help: consider using: `&mut self.inner.a`\n+LL | |     }\n+   | |_____^\n+\n+error: aborting due to 16 previous errors\n "}]}