{"sha": "086c8d3db71c7d448b55536d6862f177ad7f60dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4NmM4ZDNkYjcxYzdkNDQ4YjU1NTM2ZDY4NjJmMTc3YWQ3ZjYwZGQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-09-06T08:51:52Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-11-21T14:37:36Z"}, "message": "Stabilize cfg rustdoc", "tree": {"sha": "a80a5067fe39d49c7b96c999ad97dc27d9338cec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a80a5067fe39d49c7b96c999ad97dc27d9338cec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/086c8d3db71c7d448b55536d6862f177ad7f60dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/086c8d3db71c7d448b55536d6862f177ad7f60dd", "html_url": "https://github.com/rust-lang/rust/commit/086c8d3db71c7d448b55536d6862f177ad7f60dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/086c8d3db71c7d448b55536d6862f177ad7f60dd/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1b882b55805c342e46ee4ca3beeef1d1fa2044b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1b882b55805c342e46ee4ca3beeef1d1fa2044b", "html_url": "https://github.com/rust-lang/rust/commit/f1b882b55805c342e46ee4ca3beeef1d1fa2044b"}], "stats": {"total": 63, "additions": 46, "deletions": 17}, "files": [{"sha": "3aaac9268ffcf38cc76fcb0fcf73c8726bd0350d", "filename": "src/doc/rustdoc/src/the-doc-attribute.md", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md", "raw_url": "https://github.com/rust-lang/rust/raw/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fthe-doc-attribute.md?ref=086c8d3db71c7d448b55536d6862f177ad7f60dd", "patch": "@@ -214,3 +214,34 @@ the `strip-hidden` pass is removed.\n Since primitive types are defined in the compiler, there's no place to attach documentation\n attributes. This attribute is used by the standard library to provide a way to generate\n documentation for primitive types.\n+\n+## `#[cfg(rustdoc)]`: Documenting platform-/feature-specific information\n+\n+For conditional compilation, Rustdoc treats your crate the same way the compiler does: Only things\n+from the host target are available (or from the given `--target` if present), and everything else is\n+\"filtered out\" from the crate. This can cause problems if your crate is providing different things\n+on different targets and you want your documentation to reflect all the available items you\n+provide.\n+\n+If you want to make sure an item is seen by Rustdoc regardless of what platform it's targeting,\n+you can apply `#[cfg(rustdoc)]` to it. Rustdoc sets this whenever it's building documentation, so\n+anything that uses that flag will make it into documentation it generates. To apply this to an item\n+with other `#[cfg]` filters on it, you can write something like `#[cfg(any(windows, rustdoc))]`.\n+This will preserve the item either when built normally on Windows, or when being documented\n+anywhere.\n+\n+Please note that this feature won't be passed when building doctests.\n+\n+Example:\n+\n+```rust\n+/// Token struct that can only be used on Windows.\n+#[cfg(any(windows, rustdoc))]\n+pub struct WindowsToken;\n+/// Token struct that can only be used on Unix.\n+#[cfg(any(unix, rustdoc))]\n+pub struct UnixToken;\n+```\n+\n+Here, the respective tokens can only be used by dependent crates on their respective platforms, but\n+they will both appear in documentation."}, {"sha": "a9f41633f30fd11f2b5af6cc09be33efdc1912ac", "filename": "src/libsyntax/feature_gate/builtin_attrs.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs?ref=086c8d3db71c7d448b55536d6862f177ad7f60dd", "patch": "@@ -30,7 +30,6 @@ const GATED_CFGS: &[(Symbol, Symbol, GateFn)] = &[\n     (sym::target_thread_local, sym::cfg_target_thread_local, cfg_fn!(cfg_target_thread_local)),\n     (sym::target_has_atomic, sym::cfg_target_has_atomic, cfg_fn!(cfg_target_has_atomic)),\n     (sym::target_has_atomic_load_store, sym::cfg_target_has_atomic, cfg_fn!(cfg_target_has_atomic)),\n-    (sym::doc, sym::doc_cfg, cfg_fn!(doc_cfg)),\n ];\n \n #[derive(Debug)]"}, {"sha": "a8e0c87eff8512f84bcf332a49d035793d668e6e", "filename": "src/test/ui/cfg-rustdoc.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Ftest%2Fui%2Fcfg-rustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Ftest%2Fui%2Fcfg-rustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg-rustdoc.rs?ref=086c8d3db71c7d448b55536d6862f177ad7f60dd", "patch": "@@ -0,0 +1,6 @@\n+#[cfg(rustdoc)]\n+pub struct Foo;\n+\n+fn main() {\n+    let f = Foo; //~ ERROR\n+}"}, {"sha": "c687d186989c0c5622d9a9d222e1a9d0ba6a7a83", "filename": "src/test/ui/cfg-rustdoc.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Ftest%2Fui%2Fcfg-rustdoc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/086c8d3db71c7d448b55536d6862f177ad7f60dd/src%2Ftest%2Fui%2Fcfg-rustdoc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg-rustdoc.stderr?ref=086c8d3db71c7d448b55536d6862f177ad7f60dd", "patch": "@@ -0,0 +1,9 @@\n+error[E0425]: cannot find value `Foo` in this scope\n+  --> $DIR/cfg-rustdoc.rs:5:13\n+   |\n+LL |     let f = Foo;\n+   |             ^^^ not found in this scope\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0425`."}, {"sha": "9830503a8cac6ab7d05da1a3019a105b32247870", "filename": "src/test/ui/feature-gates/feature-gate-doc_cfg-cfg-rustdoc.rs", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f1b882b55805c342e46ee4ca3beeef1d1fa2044b/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1b882b55805c342e46ee4ca3beeef1d1fa2044b/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.rs?ref=f1b882b55805c342e46ee4ca3beeef1d1fa2044b", "patch": "@@ -1,4 +0,0 @@\n-#[cfg(doc)] //~ ERROR: `cfg(doc)` is experimental and subject to change\n-pub struct SomeStruct;\n-\n-fn main() {}"}, {"sha": "26a1f4decf4cfaaaf55e174d3f0dff2f1fecb332", "filename": "src/test/ui/feature-gates/feature-gate-doc_cfg-cfg-rustdoc.stderr", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f1b882b55805c342e46ee4ca3beeef1d1fa2044b/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f1b882b55805c342e46ee4ca3beeef1d1fa2044b/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-doc_cfg-cfg-rustdoc.stderr?ref=f1b882b55805c342e46ee4ca3beeef1d1fa2044b", "patch": "@@ -1,12 +0,0 @@\n-error[E0658]: `cfg(doc)` is experimental and subject to change\n-  --> $DIR/feature-gate-doc_cfg-cfg-rustdoc.rs:1:7\n-   |\n-LL | #[cfg(doc)]\n-   |       ^^^\n-   |\n-   = note: for more information, see https://github.com/rust-lang/rust/issues/43781\n-   = help: add `#![feature(doc_cfg)]` to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}]}