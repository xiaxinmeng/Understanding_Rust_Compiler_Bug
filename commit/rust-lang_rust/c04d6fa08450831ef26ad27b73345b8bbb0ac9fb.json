{"sha": "c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwNGQ2ZmEwODQ1MDgzMWVmMjZhZDI3YjczMzQ1YjhiYmIwYWM5ZmI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-13T04:26:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-13T04:26:59Z"}, "message": "Rollup merge of #57557 - petrochenkov:ecused, r=varkor\n\nresolve: Mark extern crate items as used in more cases\n\nFixes https://github.com/rust-lang/rust/issues/57421", "tree": {"sha": "3bfaaa74a14b6933a220efb75ca71659350c3ab0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bfaaa74a14b6933a220efb75ca71659350c3ab0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcOr4TCRBK7hj4Ov3rIwAAdHIIAHkR7x+PAEl/2TBG+0Cfp2pb\niw53ELGk3a9+d/litWzckRGvmvvldK/7qV7Au8O+tJy93VLKRuVCH4mcAk8hbQwa\nTjSxkjNEZxsxXvsz5eAK7Oc3VFKmVBsT1LfWm0WV/i3gjMp1E2tmzbgxSdTZQomv\nf/P4oAZbGy83Sa+7JUFoNAp1viX0EHO7hry6JE+oQzsJrHnbE7TqKlWTj7uTVhqu\n/Vih4TEia79cdtCK4Jj+C7NHkqTRRi02PaimSIk2jYs4gDhM4O68V3yUnymoFtJf\nu5RcQ7CzmwwJLUBrRl44ploEPbWAZzfY1lAmch2r4r/K+V5TbFJlHKqNWd0shFQ=\n=5D/X\n-----END PGP SIGNATURE-----\n", "payload": "tree 3bfaaa74a14b6933a220efb75ca71659350c3ab0\nparent 8c1813d3e12e61f4d53e0d997bb0747f557062ff\nparent 6aa78563697245ff7835a57c7e7eb331e9ecec08\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1547353619 +0100\ncommitter GitHub <noreply@github.com> 1547353619 +0100\n\nRollup merge of #57557 - petrochenkov:ecused, r=varkor\n\nresolve: Mark extern crate items as used in more cases\n\nFixes https://github.com/rust-lang/rust/issues/57421\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "html_url": "https://github.com/rust-lang/rust/commit/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c1813d3e12e61f4d53e0d997bb0747f557062ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c1813d3e12e61f4d53e0d997bb0747f557062ff", "html_url": "https://github.com/rust-lang/rust/commit/8c1813d3e12e61f4d53e0d997bb0747f557062ff"}, {"sha": "6aa78563697245ff7835a57c7e7eb331e9ecec08", "url": "https://api.github.com/repos/rust-lang/rust/commits/6aa78563697245ff7835a57c7e7eb331e9ecec08", "html_url": "https://github.com/rust-lang/rust/commit/6aa78563697245ff7835a57c7e7eb331e9ecec08"}], "stats": {"total": 69, "additions": 69, "deletions": 0}, "files": [{"sha": "f7a82c7bf4a1cffbdbeaf7124382ca82150ba8c8", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "patch": "@@ -5112,6 +5112,9 @@ impl<'a> Resolver<'a> {\n         }\n         self.extern_prelude.get(&ident.modern()).cloned().and_then(|entry| {\n             if let Some(binding) = entry.extern_crate_item {\n+                if !speculative && entry.introduced_by_item {\n+                    self.record_use(ident, TypeNS, binding, false);\n+                }\n                 Some(binding)\n             } else {\n                 let crate_id = if !speculative {"}, {"sha": "2d91cbc00f27d492bb11387582a0bd4b829c35c4", "filename": "src/test/ui/imports/extern-crate-used.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs?ref=c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "patch": "@@ -0,0 +1,28 @@\n+// Extern crate items are marked as used if they are used\n+// through extern prelude entries introduced by them.\n+\n+// edition:2018\n+\n+#![deny(unused_extern_crates)]\n+\n+extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+\n+// Doesn't introduce its extern prelude entry, so it's still considered unused.\n+extern crate core; //~ ERROR unused extern crate\n+\n+mod m {\n+    use iso1::any as are_you_okay1;\n+    use ::iso2::any as are_you_okay2;\n+    type AreYouOkay1 = iso3::any::Any;\n+    type AreYouOkay2 = ::iso4::any::Any;\n+\n+    use core::any as are_you_okay3;\n+    use ::core::any as are_you_okay4;\n+    type AreYouOkay3 = core::any::Any;\n+    type AreYouOkay4 = ::core::any::Any;\n+}\n+\n+fn main() {}"}, {"sha": "3f9aab9dc79cb44bf7ae4a37b585d0bcc806c6c7", "filename": "src/test/ui/imports/extern-crate-used.stderr", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c04d6fa08450831ef26ad27b73345b8bbb0ac9fb/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr?ref=c04d6fa08450831ef26ad27b73345b8bbb0ac9fb", "patch": "@@ -0,0 +1,38 @@\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:8:1\n+   |\n+LL | extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+   |\n+note: lint level defined here\n+  --> $DIR/extern-crate-used.rs:6:9\n+   |\n+LL | #![deny(unused_extern_crates)]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:9:1\n+   |\n+LL | extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:10:1\n+   |\n+LL | extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:11:1\n+   |\n+LL | extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: unused extern crate\n+  --> $DIR/extern-crate-used.rs:14:1\n+   |\n+LL | extern crate core; //~ ERROR unused extern crate\n+   | ^^^^^^^^^^^^^^^^^^ help: remove it\n+\n+error: aborting due to 5 previous errors\n+"}]}