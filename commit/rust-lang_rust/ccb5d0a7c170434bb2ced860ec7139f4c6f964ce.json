{"sha": "ccb5d0a7c170434bb2ced860ec7139f4c6f964ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjYjVkMGE3YzE3MDQzNGJiMmNlZDg2MGVjNzEzOWY0YzZmOTY0Y2U=", "commit": {"author": {"name": "Scott Wolchok", "email": "swolchok@fb.com", "date": "2019-07-16T20:29:40Z"}, "committer": {"name": "Scott Wolchok", "email": "swolchok@fb.com", "date": "2019-07-16T20:29:40Z"}, "message": "Support SDKROOT env var on iOS\n\nFollowing what clang does (https://github.com/llvm/llvm-project/blob/296a80102a9b72c3eda80558fb78a3ed8849b341/clang/lib/Driver/ToolChains/Darwin.cpp#L1661-L1678), allow allow SDKROOT to tell us where the Apple SDK lives so we don't have to invoke xcrun.", "tree": {"sha": "ecea740a970a62cafd7ee7cd2b7c85f30e0ffbf5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecea740a970a62cafd7ee7cd2b7c85f30e0ffbf5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce", "html_url": "https://github.com/rust-lang/rust/commit/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce/comments", "author": {"login": "swolchok", "id": 34168, "node_id": "MDQ6VXNlcjM0MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/34168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swolchok", "html_url": "https://github.com/swolchok", "followers_url": "https://api.github.com/users/swolchok/followers", "following_url": "https://api.github.com/users/swolchok/following{/other_user}", "gists_url": "https://api.github.com/users/swolchok/gists{/gist_id}", "starred_url": "https://api.github.com/users/swolchok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swolchok/subscriptions", "organizations_url": "https://api.github.com/users/swolchok/orgs", "repos_url": "https://api.github.com/users/swolchok/repos", "events_url": "https://api.github.com/users/swolchok/events{/privacy}", "received_events_url": "https://api.github.com/users/swolchok/received_events", "type": "User", "site_admin": false}, "committer": {"login": "swolchok", "id": 34168, "node_id": "MDQ6VXNlcjM0MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/34168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swolchok", "html_url": "https://github.com/swolchok", "followers_url": "https://api.github.com/users/swolchok/followers", "following_url": "https://api.github.com/users/swolchok/following{/other_user}", "gists_url": "https://api.github.com/users/swolchok/gists{/gist_id}", "starred_url": "https://api.github.com/users/swolchok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swolchok/subscriptions", "organizations_url": "https://api.github.com/users/swolchok/orgs", "repos_url": "https://api.github.com/users/swolchok/repos", "events_url": "https://api.github.com/users/swolchok/events{/privacy}", "received_events_url": "https://api.github.com/users/swolchok/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b65a86ebace8600c8e269e8bfe3365cdc460e68", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b65a86ebace8600c8e269e8bfe3365cdc460e68", "html_url": "https://github.com/rust-lang/rust/commit/4b65a86ebace8600c8e269e8bfe3365cdc460e68"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "40cc7f420106b06ff3f40f0b5f18003bd4ad5918", "filename": "src/librustc_target/spec/apple_ios_base.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce/src%2Flibrustc_target%2Fspec%2Fapple_ios_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccb5d0a7c170434bb2ced860ec7139f4c6f964ce/src%2Flibrustc_target%2Fspec%2Fapple_ios_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fapple_ios_base.rs?ref=ccb5d0a7c170434bb2ced860ec7139f4c6f964ce", "patch": "@@ -1,3 +1,4 @@\n+use std::env;\n use std::io;\n use std::process::Command;\n use crate::spec::{LinkArgs, LinkerFlavor, TargetOptions};\n@@ -27,6 +28,12 @@ impl Arch {\n }\n \n pub fn get_sdk_root(sdk_name: &str) -> Result<String, String> {\n+    if let Some(sdkroot) = env::var(\"SDKROOT\").ok() {\n+        let sdkroot_path = Path::new(sdkroot);\n+        if sdkroot_path.is_absolute() && sdkroot_path != Path::new(\"/\") && sdkroot_path.exists() {\n+            return Ok(sdkroot);\n+        }\n+    }\n     let res = Command::new(\"xcrun\")\n                       .arg(\"--show-sdk-path\")\n                       .arg(\"-sdk\")"}]}