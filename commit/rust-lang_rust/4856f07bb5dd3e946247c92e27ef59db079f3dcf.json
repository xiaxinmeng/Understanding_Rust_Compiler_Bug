{"sha": "4856f07bb5dd3e946247c92e27ef59db079f3dcf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4NTZmMDdiYjVkZDNlOTQ2MjQ3YzkyZTI3ZWY1OWRiMDc5ZjNkY2Y=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-01-25T18:48:54Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-01-25T21:49:46Z"}, "message": "Rollup merge of #47618 - mrhota:dw_at_noreturn, r=michaelwoerister\n\nTeach rustc about DW_AT_noreturn and a few more DIFlags\n\nWe achieve two small things with this PR:\n1. We provide definitions for a few additional llvm debuginfo flags\n1. We _use_ one of these new flags, `FlagNoReturn`, and add it to debuginfo for functions with the never return type (`!`).", "tree": {"sha": "2cf15937e0ca1f16657534af2f2f11df11988dbe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2cf15937e0ca1f16657534af2f2f11df11988dbe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4856f07bb5dd3e946247c92e27ef59db079f3dcf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4856f07bb5dd3e946247c92e27ef59db079f3dcf", "html_url": "https://github.com/rust-lang/rust/commit/4856f07bb5dd3e946247c92e27ef59db079f3dcf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4856f07bb5dd3e946247c92e27ef59db079f3dcf/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9852b23657dcc186eb7ed021d2728e13ea79b442", "url": "https://api.github.com/repos/rust-lang/rust/commits/9852b23657dcc186eb7ed021d2728e13ea79b442", "html_url": "https://github.com/rust-lang/rust/commit/9852b23657dcc186eb7ed021d2728e13ea79b442"}, {"sha": "e0f9b26899ea16bb2b6b966266e46698ebad9c4a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0f9b26899ea16bb2b6b966266e46698ebad9c4a", "html_url": "https://github.com/rust-lang/rust/commit/e0f9b26899ea16bb2b6b966266e46698ebad9c4a"}], "stats": {"total": 51, "additions": 49, "deletions": 2}, "files": [{"sha": "0c2b6351cfea3f01b27aeaf2af326d888ec0fceb", "filename": "src/librustc_llvm/ffi.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Flibrustc_llvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Flibrustc_llvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fffi.rs?ref=4856f07bb5dd3e946247c92e27ef59db079f3dcf", "patch": "@@ -498,6 +498,10 @@ pub mod debuginfo {\n             const FlagStaticMember        = (1 << 12);\n             const FlagLValueReference     = (1 << 13);\n             const FlagRValueReference     = (1 << 14);\n+            const FlagExternalTypeRef     = (1 << 15);\n+            const FlagIntroducedVirtual   = (1 << 18);\n+            const FlagBitField            = (1 << 19);\n+            const FlagNoReturn            = (1 << 20);\n             const FlagMainSubprogram      = (1 << 21);\n         }\n     }"}, {"sha": "9071eb776d5295dc25231789591d74dae9ad5251", "filename": "src/librustc_trans/debuginfo/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs?ref=4856f07bb5dd3e946247c92e27ef59db079f3dcf", "patch": "@@ -270,6 +270,9 @@ pub fn create_function_debug_context<'a, 'tcx>(cx: &CodegenCx<'a, 'tcx>,\n         }\n         None => {}\n     };\n+    if sig.output().is_never() {\n+        flags = flags | DIFlags::FlagNoReturn;\n+    }\n \n     let fn_metadata = unsafe {\n         llvm::LLVMRustDIBuilderCreateFunction("}, {"sha": "82aafb7c355a3d5634bc5ee65385ef7d1774fd62", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=4856f07bb5dd3e946247c92e27ef59db079f3dcf", "patch": "@@ -457,9 +457,13 @@ enum class LLVMRustDIFlags : uint32_t {\n   FlagStaticMember = (1 << 12),\n   FlagLValueReference = (1 << 13),\n   FlagRValueReference = (1 << 14),\n-  FlagMainSubprogram      = (1 << 21),\n+  FlagExternalTypeRef = (1 << 15),\n+  FlagIntroducedVirtual = (1 << 18),\n+  FlagBitField = (1 << 19),\n+  FlagNoReturn = (1 << 20),\n+  FlagMainSubprogram = (1 << 21),\n   // Do not add values that are not supported by the minimum LLVM\n-  // version we support!\n+  // version we support! see llvm/include/llvm/IR/DebugInfoFlags.def\n };\n \n inline LLVMRustDIFlags operator&(LLVMRustDIFlags A, LLVMRustDIFlags B) {\n@@ -544,7 +548,19 @@ static unsigned fromRust(LLVMRustDIFlags Flags) {\n   if (isSet(Flags & LLVMRustDIFlags::FlagRValueReference)) {\n     Result |= DINode::DIFlags::FlagRValueReference;\n   }\n+  if (isSet(Flags & LLVMRustDIFlags::FlagExternalTypeRef)) {\n+    Result |= DINode::DIFlags::FlagExternalTypeRef;\n+  }\n+  if (isSet(Flags & LLVMRustDIFlags::FlagIntroducedVirtual)) {\n+    Result |= DINode::DIFlags::FlagIntroducedVirtual;\n+  }\n+  if (isSet(Flags & LLVMRustDIFlags::FlagBitField)) {\n+    Result |= DINode::DIFlags::FlagBitField;\n+  }\n #if LLVM_RUSTLLVM || LLVM_VERSION_GE(4, 0)\n+  if (isSet(Flags & LLVMRustDIFlags::FlagNoReturn)) {\n+    Result |= DINode::DIFlags::FlagNoReturn;\n+  }\n   if (isSet(Flags & LLVMRustDIFlags::FlagMainSubprogram)) {\n     Result |= DINode::DIFlags::FlagMainSubprogram;\n   }"}, {"sha": "24a5a4e44cb297a6463b06310c50703e41da9e79", "filename": "src/test/codegen/noreturnflag.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Ftest%2Fcodegen%2Fnoreturnflag.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4856f07bb5dd3e946247c92e27ef59db079f3dcf/src%2Ftest%2Fcodegen%2Fnoreturnflag.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fnoreturnflag.rs?ref=4856f07bb5dd3e946247c92e27ef59db079f3dcf", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-tidy-linelength\n+// min-llvm-version 4.0\n+\n+// compile-flags: -g -C no-prepopulate-passes\n+\n+// CHECK: {{.*}}DISubprogram{{.*}}name: \"foo\"{{.*}}DIFlagNoReturn\n+\n+fn foo() -> ! {\n+    loop {}\n+}\n+\n+pub fn main() {\n+    foo();\n+}"}]}