{"sha": "d545220fd9f88cc0089eddd2999153683c5af397", "node_id": "C_kwDOAAsO6NoAKGQ1NDUyMjBmZDlmODhjYzAwODllZGRkMjk5OTE1MzY4M2M1YWYzOTc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-06-04T11:21:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-06-04T11:21:26Z"}, "message": "Rollup merge of #111982 - jyn514:disable-incremental, r=Mark-Simulacrum\n\nRevert \"Enable incremental independent of stage\"\n\nThis reverts commit 827f656ebb1230f31af6d968c4bfe69a79914ffc.\n\nIncremental is not sound to use across stages. Arbitrary changes to the compiler can invalidate the incremental cache - even changes to normal queries, not incremental itself! - and we do not currently enable `incremental-verify-ich` in bootstrap. Since 2018, we highly recommend and nudge users towards stage 1 builds instead of stage 2, and using `keep-stage` for anything other than libstd is very rare.\n\nI don't think the risk of unsoundness is worth the very minor speedup when building libstd. Disable incremental to avoid spurious panics and miscompilations when building with the stage 1 and 2 sysroot.\n\nCombined with https://github.com/rust-lang/rust/pull/111329, this should fix https://github.com/rust-lang/rust/issues/76720.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "7e25265eef3f94ce6632f2b3072a9db8a89668c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e25265eef3f94ce6632f2b3072a9db8a89668c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d545220fd9f88cc0089eddd2999153683c5af397", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkfHO2CRBK7hj4Ov3rIwAAC08IAAD29hLYwAsvDQgSo0jJCHgG\n1bOoVToNjnIy01neUGn6BcB0cqhOwDojIW68u8dNdR9oW8Gwq2Z2V96IacWbYSig\nRWbtyK8+jOfnGghf5JZu7jwu1jh3TnS0xg9tKdNjF+W2r0El15jg9O/ibWsUOc02\nwrlYf9vkn6JQK6hRB7ZV5n+0jjiub2IuzF8r8xZYx5CI75g6glhq5MzjelMlzuhu\nRolOTSwCzW0VGxKTKg1BZirGeyGmoOrC0u3qsq7oposlBmuf9YXfXvEKWvrHMtvX\n2AVkLRTpZn2eFEkqO42TZgtrgdAm1OmDZ6PmX5iLufiYZIqc9fFurQIIxMXmX98=\n=ATmD\n-----END PGP SIGNATURE-----\n", "payload": "tree 7e25265eef3f94ce6632f2b3072a9db8a89668c4\nparent f2f0e6cc81227fe60b1c164144b763f222c92820\nparent b42ff20c560fb53982b3f77d3fed5c459a01b545\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1685877686 +0200\ncommitter GitHub <noreply@github.com> 1685877686 +0200\n\nRollup merge of #111982 - jyn514:disable-incremental, r=Mark-Simulacrum\n\nRevert \"Enable incremental independent of stage\"\n\nThis reverts commit 827f656ebb1230f31af6d968c4bfe69a79914ffc.\n\nIncremental is not sound to use across stages. Arbitrary changes to the compiler can invalidate the incremental cache - even changes to normal queries, not incremental itself! - and we do not currently enable `incremental-verify-ich` in bootstrap. Since 2018, we highly recommend and nudge users towards stage 1 builds instead of stage 2, and using `keep-stage` for anything other than libstd is very rare.\n\nI don't think the risk of unsoundness is worth the very minor speedup when building libstd. Disable incremental to avoid spurious panics and miscompilations when building with the stage 1 and 2 sysroot.\n\nCombined with https://github.com/rust-lang/rust/pull/111329, this should fix https://github.com/rust-lang/rust/issues/76720.\n\nr? `@Mark-Simulacrum`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d545220fd9f88cc0089eddd2999153683c5af397", "html_url": "https://github.com/rust-lang/rust/commit/d545220fd9f88cc0089eddd2999153683c5af397", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d545220fd9f88cc0089eddd2999153683c5af397/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2f0e6cc81227fe60b1c164144b763f222c92820", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2f0e6cc81227fe60b1c164144b763f222c92820", "html_url": "https://github.com/rust-lang/rust/commit/f2f0e6cc81227fe60b1c164144b763f222c92820"}, {"sha": "b42ff20c560fb53982b3f77d3fed5c459a01b545", "url": "https://api.github.com/repos/rust-lang/rust/commits/b42ff20c560fb53982b3f77d3fed5c459a01b545", "html_url": "https://github.com/rust-lang/rust/commit/b42ff20c560fb53982b3f77d3fed5c459a01b545"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "8764444aa61a90d07768e83d4c8556c519f4ae0b", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d545220fd9f88cc0089eddd2999153683c5af397/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d545220fd9f88cc0089eddd2999153683c5af397/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=d545220fd9f88cc0089eddd2999153683c5af397", "patch": "@@ -1786,7 +1786,10 @@ impl<'a> Builder<'a> {\n             cargo.env(\"RUSTC_TLS_MODEL_INITIAL_EXEC\", \"1\");\n         }\n \n-        if self.config.incremental {\n+        // Ignore incremental modes except for stage0, since we're\n+        // not guaranteeing correctness across builds if the compiler\n+        // is changing under your feet.\n+        if self.config.incremental && compiler.stage == 0 {\n             cargo.env(\"CARGO_INCREMENTAL\", \"1\");\n         } else {\n             // Don't rely on any default setting for incr. comp. in Cargo"}]}