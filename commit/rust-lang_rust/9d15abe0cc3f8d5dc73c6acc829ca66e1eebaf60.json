{"sha": "9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkMTVhYmUwY2MzZjhkNWRjNzNjNmFjYzgyOWNhNjZlMWVlYmFmNjA=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-05-11T10:22:11Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-05-12T11:58:43Z"}, "message": "Use () for lint_levels.", "tree": {"sha": "e4f93280c79697f7c0e262ea853e0a3ac2a1fc11", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4f93280c79697f7c0e262ea853e0a3ac2a1fc11"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "html_url": "https://github.com/rust-lang/rust/commit/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7bf467fa3c92fdb520460abbe2568da5cd7afb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7bf467fa3c92fdb520460abbe2568da5cd7afb2", "html_url": "https://github.com/rust-lang/rust/commit/b7bf467fa3c92fdb520460abbe2568da5cd7afb2"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "91cdef9b089fa7544b31c255378049d140a467ff", "filename": "compiler/rustc_lint/src/levels.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flevels.rs?ref=9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "patch": "@@ -6,8 +6,7 @@ use rustc_ast_pretty::pprust;\n use rustc_data_structures::fx::FxHashMap;\n use rustc_errors::{struct_span_err, Applicability, DiagnosticBuilder};\n use rustc_hir as hir;\n-use rustc_hir::def_id::{CrateNum, DefId, CRATE_DEF_INDEX, LOCAL_CRATE};\n-use rustc_hir::{intravisit, HirId};\n+use rustc_hir::{intravisit, HirId, CRATE_HIR_ID};\n use rustc_middle::hir::map::Map;\n use rustc_middle::lint::LevelAndSource;\n use rustc_middle::lint::LintDiagnosticBuilder;\n@@ -28,10 +27,9 @@ use tracing::debug;\n \n use std::cmp;\n \n-fn lint_levels(tcx: TyCtxt<'_>, cnum: CrateNum) -> LintLevelMap {\n-    assert_eq!(cnum, LOCAL_CRATE);\n+fn lint_levels(tcx: TyCtxt<'_>, (): ()) -> LintLevelMap {\n     let store = unerased_lint_store(tcx);\n-    let crate_attrs = tcx.get_attrs(DefId { krate: cnum, index: CRATE_DEF_INDEX });\n+    let crate_attrs = tcx.hir().attrs(CRATE_HIR_ID);\n     let levels = LintLevelsBuilder::new(tcx.sess, false, &store, crate_attrs);\n     let mut builder = LintLevelMapBuilder { levels, tcx, store };\n     let krate = tcx.hir().krate();"}, {"sha": "a9f53c6e2be331ad71b7dd650ef0d81f45734861", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "patch": "@@ -199,7 +199,7 @@ rustc_queries! {\n         desc { \"looking up the native libraries of a linked crate\" }\n     }\n \n-    query lint_levels(_: CrateNum) -> LintLevelMap {\n+    query lint_levels(_: ()) -> LintLevelMap {\n         storage(ArenaCacheSelector<'tcx>)\n         eval_always\n         desc { \"computing the lint levels for items in this crate\" }"}, {"sha": "f16a666503a040690155deab6b49f8b053179077", "filename": "compiler/rustc_middle/src/ty/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs?ref=9d15abe0cc3f8d5dc73c6acc829ca66e1eebaf60", "patch": "@@ -2623,7 +2623,7 @@ impl<'tcx> TyCtxt<'tcx> {\n         lint: &'static Lint,\n         mut id: hir::HirId,\n     ) -> (Level, LintLevelSource) {\n-        let sets = self.lint_levels(LOCAL_CRATE);\n+        let sets = self.lint_levels(());\n         loop {\n             if let Some(pair) = sets.level_and_source(lint, id, self.sess) {\n                 return pair;"}]}