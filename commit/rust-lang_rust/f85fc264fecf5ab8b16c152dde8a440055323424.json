{"sha": "f85fc264fecf5ab8b16c152dde8a440055323424", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NWZjMjY0ZmVjZjVhYjhiMTZjMTUyZGRlOGE0NDAwNTUzMjM0MjQ=", "commit": {"author": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2021-01-01T18:38:11Z"}, "committer": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2021-01-07T21:54:12Z"}, "message": "Reintroduce hir::ExprKind::If", "tree": {"sha": "835f4f3a86c2019c5ac18f65c4cfa5de7fd297a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/835f4f3a86c2019c5ac18f65c4cfa5de7fd297a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f85fc264fecf5ab8b16c152dde8a440055323424", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f85fc264fecf5ab8b16c152dde8a440055323424", "html_url": "https://github.com/rust-lang/rust/commit/f85fc264fecf5ab8b16c152dde8a440055323424", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f85fc264fecf5ab8b16c152dde8a440055323424/comments", "author": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "committer": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9", "html_url": "https://github.com/rust-lang/rust/commit/c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9"}], "stats": {"total": 1763, "additions": 1011, "deletions": 752}, "files": [{"sha": "1b9ccbd850beee7586ecdfa6888e4724e4cc74d8", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 31, "deletions": 25, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -87,9 +87,12 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 ExprKind::Let(ref pat, ref scrutinee) => {\n                     self.lower_expr_let(e.span, pat, scrutinee)\n                 }\n-                ExprKind::If(ref cond, ref then, ref else_opt) => {\n-                    self.lower_expr_if(e.span, cond, then, else_opt.as_deref())\n-                }\n+                ExprKind::If(ref cond, ref then, ref else_opt) => match cond.kind {\n+                    ExprKind::Let(ref pat, ref scrutinee) => {\n+                        self.lower_expr_if_let(e.span, pat, scrutinee, then, else_opt.as_deref())\n+                    }\n+                    _ => self.lower_expr_if(cond, then, else_opt.as_deref()),\n+                },\n                 ExprKind::While(ref cond, ref body, opt_label) => self\n                     .with_loop_scope(e.id, |this| {\n                         this.lower_expr_while_in_loop_scope(e.span, cond, body, opt_label)\n@@ -337,10 +340,30 @@ impl<'hir> LoweringContext<'_, 'hir> {\n \n     fn lower_expr_if(\n         &mut self,\n-        span: Span,\n         cond: &Expr,\n         then: &Block,\n         else_opt: Option<&Expr>,\n+    ) -> hir::ExprKind<'hir> {\n+        macro_rules! make_if {\n+            ($opt:expr) => {{\n+                let then_expr = self.lower_block_expr(then);\n+                hir::ExprKind::If(self.lower_expr(cond), self.arena.alloc(then_expr), $opt)\n+            }};\n+        }\n+        if let Some(rslt) = else_opt {\n+            make_if!(Some(self.lower_expr(rslt)))\n+        } else {\n+            make_if!(None)\n+        }\n+    }\n+\n+    fn lower_expr_if_let(\n+        &mut self,\n+        span: Span,\n+        pat: &Pat,\n+        scrutinee: &Expr,\n+        then: &Block,\n+        else_opt: Option<&Expr>,\n     ) -> hir::ExprKind<'hir> {\n         // FIXME(#53667): handle lowering of && and parens.\n \n@@ -353,30 +376,13 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let else_arm = self.arm(else_pat, else_expr);\n \n         // Handle then + scrutinee:\n-        let (then_pat, scrutinee, desugar) = match cond.kind {\n-            // `<pat> => <then>`:\n-            ExprKind::Let(ref pat, ref scrutinee) => {\n-                let scrutinee = self.lower_expr(scrutinee);\n-                let pat = self.lower_pat(pat);\n-                (pat, scrutinee, hir::MatchSource::IfLetDesugar { contains_else_clause })\n-            }\n-            // `true => <then>`:\n-            _ => {\n-                // Lower condition:\n-                let cond = self.lower_expr(cond);\n-                let span_block =\n-                    self.mark_span_with_reason(DesugaringKind::CondTemporary, cond.span, None);\n-                // Wrap in a construct equivalent to `{ let _t = $cond; _t }`\n-                // to preserve drop semantics since `if cond { ... }` does not\n-                // let temporaries live outside of `cond`.\n-                let cond = self.expr_drop_temps(span_block, cond, ThinVec::new());\n-                let pat = self.pat_bool(span, true);\n-                (pat, cond, hir::MatchSource::IfDesugar { contains_else_clause })\n-            }\n-        };\n+        let scrutinee = self.lower_expr(scrutinee);\n+        let then_pat = self.lower_pat(pat);\n+\n         let then_expr = self.lower_block_expr(then);\n         let then_arm = self.arm(then_pat, self.arena.alloc(then_expr));\n \n+        let desugar = hir::MatchSource::IfLetDesugar { contains_else_clause };\n         hir::ExprKind::Match(scrutinee, arena_vec![self; then_arm, else_arm], desugar)\n     }\n "}, {"sha": "92b717adfe65b4873f2fc9d16c79635b0799a049", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1398,6 +1398,7 @@ impl Expr<'_> {\n             ExprKind::Lit(_) => ExprPrecedence::Lit,\n             ExprKind::Type(..) | ExprKind::Cast(..) => ExprPrecedence::Cast,\n             ExprKind::DropTemps(ref expr, ..) => expr.precedence(),\n+            ExprKind::If(..) => ExprPrecedence::If,\n             ExprKind::Loop(..) => ExprPrecedence::Loop,\n             ExprKind::Match(..) => ExprPrecedence::Match,\n             ExprKind::Closure(..) => ExprPrecedence::Closure,\n@@ -1459,6 +1460,7 @@ impl Expr<'_> {\n             | ExprKind::MethodCall(..)\n             | ExprKind::Struct(..)\n             | ExprKind::Tup(..)\n+            | ExprKind::If(..)\n             | ExprKind::Match(..)\n             | ExprKind::Closure(..)\n             | ExprKind::Block(..)\n@@ -1575,6 +1577,10 @@ pub enum ExprKind<'hir> {\n     /// This construct only exists to tweak the drop order in HIR lowering.\n     /// An example of that is the desugaring of `for` loops.\n     DropTemps(&'hir Expr<'hir>),\n+    /// An `if` block, with an optional else block.\n+    ///\n+    /// I.e., `if <expr> { <expr> } else { <expr> }`.\n+    If(&'hir Expr<'hir>, &'hir Expr<'hir>, Option<&'hir Expr<'hir>>),\n     /// A conditionless loop (can be exited with `break`, `continue`, or `return`).\n     ///\n     /// I.e., `'label: loop { <block> }`.\n@@ -1728,8 +1734,6 @@ pub enum LocalSource {\n pub enum MatchSource {\n     /// A `match _ { .. }`.\n     Normal,\n-    /// An `if _ { .. }` (optionally with `else { .. }`).\n-    IfDesugar { contains_else_clause: bool },\n     /// An `if let _ = _ { .. }` (optionally with `else { .. }`).\n     IfLetDesugar { contains_else_clause: bool },\n     /// An `if let _ = _ => { .. }` match guard.\n@@ -1752,7 +1756,7 @@ impl MatchSource {\n         use MatchSource::*;\n         match self {\n             Normal => \"match\",\n-            IfDesugar { .. } | IfLetDesugar { .. } | IfLetGuardDesugar => \"if\",\n+            IfLetDesugar { .. } | IfLetGuardDesugar => \"if\",\n             WhileDesugar | WhileLetDesugar => \"while\",\n             ForLoopDesugar => \"for\",\n             TryDesugar => \"?\","}, {"sha": "648937c5808bebc963ed4001acab11c4d9c4c246", "filename": "compiler/rustc_hir/src/intravisit.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1146,6 +1146,11 @@ pub fn walk_expr<'v, V: Visitor<'v>>(visitor: &mut V, expression: &'v Expr<'v>)\n         ExprKind::DropTemps(ref subexpression) => {\n             visitor.visit_expr(subexpression);\n         }\n+        ExprKind::If(ref cond, ref then, ref else_opt) => {\n+            visitor.visit_expr(cond);\n+            visitor.visit_expr(then);\n+            walk_list!(visitor, visit_expr, else_opt);\n+        }\n         ExprKind::Loop(ref block, ref opt_label, _) => {\n             walk_list!(visitor, visit_label, opt_label);\n             visitor.visit_block(block);"}, {"sha": "0a749ff511292b03ab45a64d79d88d002254db90", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 54, "deletions": 1, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1083,6 +1083,50 @@ impl<'a> State<'a> {\n         self.ann.post(self, AnnNode::Block(blk))\n     }\n \n+    fn print_else(&mut self, els: Option<&hir::Expr<'_>>) {\n+        match els {\n+            Some(_else) => {\n+                match _else.kind {\n+                    // \"another else-if\"\n+                    hir::ExprKind::If(ref i, ref then, ref e) => {\n+                        self.cbox(INDENT_UNIT - 1);\n+                        self.ibox(0);\n+                        self.s.word(\" else if \");\n+                        self.print_expr_as_cond(&i);\n+                        self.s.space();\n+                        self.print_expr(&then);\n+                        self.print_else(e.as_ref().map(|e| &**e))\n+                    }\n+                    // \"final else\"\n+                    hir::ExprKind::Block(ref b, _) => {\n+                        self.cbox(INDENT_UNIT - 1);\n+                        self.ibox(0);\n+                        self.s.word(\" else \");\n+                        self.print_block(&b)\n+                    }\n+                    // BLEAH, constraints would be great here\n+                    _ => {\n+                        panic!(\"print_if saw if with weird alternative\");\n+                    }\n+                }\n+            }\n+            _ => {}\n+        }\n+    }\n+\n+    pub fn print_if(\n+        &mut self,\n+        test: &hir::Expr<'_>,\n+        blk: &hir::Expr<'_>,\n+        elseopt: Option<&hir::Expr<'_>>,\n+    ) {\n+        self.head(\"if\");\n+        self.print_expr_as_cond(test);\n+        self.s.space();\n+        self.print_expr(blk);\n+        self.print_else(elseopt)\n+    }\n+\n     pub fn print_anon_const(&mut self, constant: &hir::AnonConst) {\n         self.ann.nested(self, Nested::Body(constant.body))\n     }\n@@ -1352,6 +1396,9 @@ impl<'a> State<'a> {\n                 // Print `}`:\n                 self.bclose_maybe_open(expr.span, true);\n             }\n+            hir::ExprKind::If(ref test, ref blk, ref elseopt) => {\n+                self.print_if(&test, &blk, elseopt.as_ref().map(|e| &**e));\n+            }\n             hir::ExprKind::Loop(ref blk, opt_label, _) => {\n                 if let Some(label) = opt_label {\n                     self.print_ident(label.ident);\n@@ -2436,7 +2483,13 @@ impl<'a> State<'a> {\n //\n // Duplicated from `parse::classify`, but adapted for the HIR.\n fn expr_requires_semi_to_be_stmt(e: &hir::Expr<'_>) -> bool {\n-    !matches!(e.kind, hir::ExprKind::Match(..) | hir::ExprKind::Block(..) | hir::ExprKind::Loop(..))\n+    !matches!(\n+        e.kind,\n+        hir::ExprKind::If(..)\n+            | hir::ExprKind::Match(..)\n+            | hir::ExprKind::Block(..)\n+            | hir::ExprKind::Loop(..)\n+    )\n }\n \n /// This statement requires a semicolon after it."}, {"sha": "18f83d6ddf75b602105341706141f2f9efde88f7", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -658,20 +658,22 @@ impl<'hir> Map<'hir> {\n         CRATE_HIR_ID\n     }\n \n-    /// When on a match arm tail expression or on a match arm, give back the enclosing `match`\n-    /// expression.\n+    /// When on an if expression, a match arm tail expression or a match arm, give back\n+    /// the enclosing `if` or `match` expression.\n     ///\n-    /// Used by error reporting when there's a type error in a match arm caused by the `match`\n+    /// Used by error reporting when there's a type error in an if or match arm caused by the\n     /// expression needing to be unit.\n-    pub fn get_match_if_cause(&self, hir_id: HirId) -> Option<&'hir Expr<'hir>> {\n+    pub fn get_if_cause(&self, hir_id: HirId) -> Option<&'hir Expr<'hir>> {\n         for (_, node) in self.parent_iter(hir_id) {\n             match node {\n                 Node::Item(_)\n                 | Node::ForeignItem(_)\n                 | Node::TraitItem(_)\n                 | Node::ImplItem(_)\n                 | Node::Stmt(Stmt { kind: StmtKind::Local(_), .. }) => break,\n-                Node::Expr(expr @ Expr { kind: ExprKind::Match(..), .. }) => return Some(expr),\n+                Node::Expr(expr @ Expr { kind: ExprKind::If(..) | ExprKind::Match(..), .. }) => {\n+                    return Some(expr);\n+                }\n                 _ => {}\n             }\n         }"}, {"sha": "c11b8f74593898b9673a800b072cdaed56242d05", "filename": "compiler/rustc_mir_build/src/build/expr/as_place.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_place.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -531,6 +531,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n             | ExprKind::Borrow { .. }\n             | ExprKind::AddressOf { .. }\n             | ExprKind::Match { .. }\n+            | ExprKind::If { .. }\n             | ExprKind::Loop { .. }\n             | ExprKind::Block { .. }\n             | ExprKind::Assign { .. }"}, {"sha": "55bdbcfc5b916c7e54587804579ead0e1c4a8604", "filename": "compiler/rustc_mir_build/src/build/expr/as_rvalue.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fas_rvalue.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -251,6 +251,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n             | ExprKind::StaticRef { .. }\n             | ExprKind::Block { .. }\n             | ExprKind::Match { .. }\n+            | ExprKind::If { .. }\n             | ExprKind::NeverToAny { .. }\n             | ExprKind::Use { .. }\n             | ExprKind::Borrow { .. }"}, {"sha": "9320b5810e3964fa193ea88d37efd2a3105cdc9d", "filename": "compiler/rustc_mir_build/src/build/expr/category.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fcategory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fcategory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Fcategory.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -45,6 +45,7 @@ impl Category {\n \n             ExprKind::LogicalOp { .. }\n             | ExprKind::Match { .. }\n+            | ExprKind::If { .. }\n             | ExprKind::NeverToAny { .. }\n             | ExprKind::Use { .. }\n             | ExprKind::Adt { .. }"}, {"sha": "9777a97b57ee0e378f98392f5955cf2d3d94c18e", "filename": "compiler/rustc_mir_build/src/build/expr/into.rs", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -69,6 +69,40 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n             ExprKind::Match { scrutinee, arms } => {\n                 this.match_expr(destination, scope, expr_span, block, scrutinee, arms)\n             }\n+            ExprKind::If { cond, then, else_opt } => {\n+                let place = unpack!(block = this.as_temp(block, Some(this.local_scope()), cond, Mutability::Mut));\n+                let operand = Operand::Move(Place::from(place));\n+\n+                let mut then_block = this.cfg.start_new_block();\n+                let mut else_block = this.cfg.start_new_block();\n+                let term = TerminatorKind::if_(this.hir.tcx(), operand, then_block, else_block);\n+                this.cfg.terminate(block, source_info, term);\n+\n+                unpack!(then_block = this.into(destination, scope, then_block, then));\n+                else_block = if let Some(else_opt) = else_opt {\n+                    unpack!(this.into(destination, None, else_block, else_opt))\n+                } else {\n+                    // Body of the `if` expression without an `else` clause must return `()`, thus\n+                    // we implicitly generate a `else {}` if it is not specified.\n+                    let correct_si = this.source_info(expr_span.shrink_to_hi());\n+                    this.cfg.push_assign_unit(else_block, correct_si, destination, this.hir.tcx());\n+                    else_block\n+                };\n+\n+                let join_block = this.cfg.start_new_block();\n+                this.cfg.terminate(\n+                    then_block,\n+                    source_info,\n+                    TerminatorKind::Goto { target: join_block },\n+                );\n+                this.cfg.terminate(\n+                    else_block,\n+                    source_info,\n+                    TerminatorKind::Goto { target: join_block },\n+                );\n+\n+                join_block.unit()\n+            },\n             ExprKind::NeverToAny { source } => {\n                 let source = this.hir.mirror(source);\n                 let is_call = matches!(source.kind, ExprKind::Call { .. } | ExprKind::InlineAsm { .. });"}, {"sha": "d66c309cfb1fcdcb6c2c5f3c7f18f46c242b3f2d", "filename": "compiler/rustc_mir_build/src/thir/cx/expr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -537,6 +537,11 @@ fn make_mirror_unadjusted<'a, 'tcx>(\n             },\n             Err(err) => bug!(\"invalid loop id for continue: {}\", err),\n         },\n+        hir::ExprKind::If(cond, then, else_opt) => ExprKind::If {\n+            cond: cond.to_ref(),\n+            then: then.to_ref(),\n+            else_opt: else_opt.map(|el| el.to_ref()),\n+        },\n         hir::ExprKind::Match(ref discr, ref arms, _) => ExprKind::Match {\n             scrutinee: discr.to_ref(),\n             arms: arms.iter().map(|a| convert_arm(cx, a)).collect(),"}, {"sha": "ed3d3927825af23312621346113ae63672d3910c", "filename": "compiler/rustc_mir_build/src/thir/mod.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -139,6 +139,11 @@ crate enum ExprKind<'tcx> {\n     Box {\n         value: ExprRef<'tcx>,\n     },\n+    If {\n+        cond: ExprRef<'tcx>,\n+        then: ExprRef<'tcx>,\n+        else_opt: Option<ExprRef<'tcx>>,\n+    },\n     Call {\n         ty: Ty<'tcx>,\n         fun: ExprRef<'tcx>,"}, {"sha": "397706851cb7970d9f95321a6f0d39aaf8ec2e62", "filename": "compiler/rustc_mir_build/src/thir/pattern/check_match.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fcheck_match.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -403,7 +403,7 @@ fn report_arm_reachability<'p, 'tcx>(\n         match is_useful {\n             NotUseful => {\n                 match source {\n-                    hir::MatchSource::IfDesugar { .. } | hir::MatchSource::WhileDesugar => bug!(),\n+                    hir::MatchSource::WhileDesugar => bug!(),\n \n                     hir::MatchSource::IfLetDesugar { .. } | hir::MatchSource::WhileLetDesugar => {\n                         // Check which arm we're on."}, {"sha": "c887a860303b58c974f2a5bc30ebd888644e8043", "filename": "compiler/rustc_passes/src/check_const.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_const.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -49,9 +49,7 @@ impl NonConstExpr {\n \n             // All other expressions are allowed.\n             Self::Loop(Loop | While | WhileLet)\n-            | Self::Match(\n-                WhileDesugar | WhileLetDesugar | Normal | IfDesugar { .. } | IfLetDesugar { .. },\n-            ) => &[],\n+            | Self::Match(WhileDesugar | WhileLetDesugar | Normal | IfLetDesugar { .. }) => &[],\n         };\n \n         Some(gates)"}, {"sha": "6202cc312fc0ea7b9e956a68e4870ef53b822f0f", "filename": "compiler/rustc_passes/src/liveness.rs", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fliveness.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -419,7 +419,7 @@ impl<'tcx> Visitor<'tcx> for IrMaps<'tcx> {\n             }\n \n             // live nodes required for interesting control flow:\n-            hir::ExprKind::Match(..) | hir::ExprKind::Loop(..) => {\n+            hir::ExprKind::If(..) | hir::ExprKind::Match(..) | hir::ExprKind::Loop(..) => {\n                 self.add_live_node_for_node(expr.hir_id, ExprNode(expr.span));\n                 intravisit::walk_expr(self, expr);\n             }\n@@ -846,6 +846,29 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n             // at the label ident\n             hir::ExprKind::Loop(ref blk, _, _) => self.propagate_through_loop(expr, &blk, succ),\n \n+            hir::ExprKind::If(ref cond, ref then, ref else_opt) => {\n+                //\n+                //     (cond)\n+                //       |\n+                //       v\n+                //     (expr)\n+                //     /   \\\n+                //    |     |\n+                //    v     v\n+                //  (then)(els)\n+                //    |     |\n+                //    v     v\n+                //   (  succ  )\n+                //\n+                let else_ln =\n+                    self.propagate_through_opt_expr(else_opt.as_ref().map(|e| &**e), succ);\n+                let then_ln = self.propagate_through_expr(&then, succ);\n+                let ln = self.live_node(expr.hir_id, expr.span);\n+                self.init_from_succ(ln, else_ln);\n+                self.merge_from_succ(ln, then_ln);\n+                self.propagate_through_expr(&cond, ln)\n+            }\n+\n             hir::ExprKind::Match(ref e, arms, _) => {\n                 //\n                 //      (e)\n@@ -1336,6 +1359,7 @@ fn check_expr<'tcx>(this: &mut Liveness<'_, 'tcx>, expr: &'tcx Expr<'tcx>) {\n         | hir::ExprKind::Tup(..)\n         | hir::ExprKind::Binary(..)\n         | hir::ExprKind::Cast(..)\n+        | hir::ExprKind::If(..)\n         | hir::ExprKind::DropTemps(..)\n         | hir::ExprKind::Unary(..)\n         | hir::ExprKind::Ret(..)"}, {"sha": "93fb23c018bf0d0531e2714e9485f6aa1f99db2c", "filename": "compiler/rustc_passes/src/naked_functions.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fnaked_functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fnaked_functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fnaked_functions.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -201,6 +201,7 @@ impl<'tcx> CheckInlineAssembly<'tcx> {\n             | ExprKind::Type(..)\n             | ExprKind::Loop(..)\n             | ExprKind::Match(..)\n+            | ExprKind::If(..)\n             | ExprKind::Closure(..)\n             | ExprKind::Assign(..)\n             | ExprKind::AssignOp(..)"}, {"sha": "91421d7f5f22ba4f9f273c645ff536b666e162e8", "filename": "compiler/rustc_passes/src/region.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fregion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_passes%2Fsrc%2Fregion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fregion.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -241,6 +241,17 @@ fn resolve_expr<'tcx>(visitor: &mut RegionResolutionVisitor<'tcx>, expr: &'tcx h\n                 terminating(r.hir_id.local_id);\n             }\n \n+            hir::ExprKind::If(ref expr, ref then, Some(ref otherwise)) => {\n+                terminating(expr.hir_id.local_id);\n+                terminating(then.hir_id.local_id);\n+                terminating(otherwise.hir_id.local_id);\n+            }\n+\n+            hir::ExprKind::If(ref expr, ref then, None) => {\n+                terminating(expr.hir_id.local_id);\n+                terminating(then.hir_id.local_id);\n+            }\n+\n             hir::ExprKind::Loop(ref body, _, _) => {\n                 terminating(body.hir_id.local_id);\n             }"}, {"sha": "eaa9ee7209d56498949b83759201ee06f896dec1", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -2278,6 +2278,12 @@ impl<'v> Visitor<'v> for ReturnsVisitor<'v> {\n                     self.visit_expr(expr);\n                 }\n             }\n+            hir::ExprKind::If(_, then, else_opt) if self.in_block_tail => {\n+                self.visit_expr(then);\n+                if let Some(el) = else_opt {\n+                    self.visit_expr(el);\n+                }\n+            }\n             hir::ExprKind::Match(_, arms, _) if self.in_block_tail => {\n                 for arm in arms {\n                     self.visit_expr(arm.body);"}, {"sha": "322ec9640f4648d04fd803212c3498f891e61152", "filename": "compiler/rustc_typeck/src/check/_match.rs", "status": "modified", "additions": 123, "deletions": 91, "changes": 214, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,9 +1,9 @@\n-use crate::check::coercion::CoerceMany;\n+use crate::check::coercion::{AsCoercionSite, CoerceMany};\n use crate::check::{Diverges, Expectation, FnCtxt, Needs};\n use rustc_hir::{self as hir, ExprKind};\n use rustc_infer::infer::type_variable::{TypeVariableOrigin, TypeVariableOriginKind};\n use rustc_infer::traits::Obligation;\n-use rustc_middle::ty::{self, ToPredicate, Ty};\n+use rustc_middle::ty::{self, ToPredicate, Ty, TyS};\n use rustc_span::Span;\n use rustc_trait_selection::opaque_types::InferCtxtExt as _;\n use rustc_trait_selection::traits::query::evaluate_obligation::InferCtxtExt;\n@@ -12,6 +12,41 @@ use rustc_trait_selection::traits::{\n     StatementAsExpression,\n };\n \n+macro_rules! create_maybe_get_coercion_reason {\n+    ($fn_name:ident, $node:expr) => {\n+        pub(crate) fn $fn_name(&self, hir_id: hir::HirId, sp: Span) -> Option<(Span, String)> {\n+            let node = $node(self.tcx.hir(), hir_id);\n+            if let hir::Node::Block(block) = node {\n+                // check that the body's parent is an fn\n+                let parent = self.tcx.hir().get(\n+                    self.tcx.hir().get_parent_node(self.tcx.hir().get_parent_node(block.hir_id)),\n+                );\n+                if let (\n+                    Some(expr),\n+                    hir::Node::Item(hir::Item { kind: hir::ItemKind::Fn(..), .. }),\n+                ) = (&block.expr, parent)\n+                {\n+                    // check that the `if` expr without `else` is the fn body's expr\n+                    if expr.span == sp {\n+                        return self.get_fn_decl(hir_id).and_then(|(fn_decl, _)| {\n+                            let span = fn_decl.output.span();\n+                            let snippet = self.tcx.sess.source_map().span_to_snippet(span).ok()?;\n+                            Some((\n+                                span,\n+                                format!(\"expected `{}` because of this return type\", snippet),\n+                            ))\n+                        });\n+                    }\n+                }\n+            }\n+            if let hir::Node::Local(hir::Local { ty: Some(_), pat, .. }) = node {\n+                return Some((pat.span, \"expected because of this assignment\".to_string()));\n+            }\n+            None\n+        }\n+    };\n+}\n+\n impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     pub fn check_match(\n         &self,\n@@ -25,7 +60,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         use hir::MatchSource::*;\n         let (source_if, if_no_else, force_scrutinee_bool) = match match_src {\n-            IfDesugar { contains_else_clause } => (true, !contains_else_clause, true),\n             IfLetDesugar { contains_else_clause, .. } => (true, !contains_else_clause, false),\n             WhileDesugar => (false, false, true),\n             _ => (false, false, false),\n@@ -115,8 +149,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             let arm_ty = if source_if\n                 && if_no_else\n                 && i != 0\n-                && self.if_fallback_coercion(expr.span, &arms[0].body, &mut coercion)\n-            {\n+                && self.if_fallback_coercion(\n+                    expr.span,\n+                    &arms[0].body,\n+                    &mut coercion,\n+                    |hir_id, span| self.maybe_get_coercion_reason(hir_id, span),\n+                ) {\n                 tcx.ty_error()\n             } else {\n                 // Only call this if this is not an `if` expr with an expected type and no `else`\n@@ -125,58 +163,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             };\n             all_arms_diverge &= self.diverges.get();\n \n-            // When we have a `match` as a tail expression in a `fn` with a returned `impl Trait`\n-            // we check if the different arms would work with boxed trait objects instead and\n-            // provide a structured suggestion in that case.\n-            let opt_suggest_box_span = match (\n-                orig_expected,\n-                self.ret_coercion_impl_trait.map(|ty| (self.body_id.owner, ty)),\n-            ) {\n-                (Expectation::ExpectHasType(expected), Some((id, ty)))\n-                    if self.in_tail_expr && self.can_coerce(arm_ty, expected) =>\n-                {\n-                    let impl_trait_ret_ty = self.infcx.instantiate_opaque_types(\n-                        id,\n-                        self.body_id,\n-                        self.param_env,\n-                        ty,\n-                        arm.body.span,\n-                    );\n-                    let mut suggest_box = !impl_trait_ret_ty.obligations.is_empty();\n-                    for o in impl_trait_ret_ty.obligations {\n-                        match o.predicate.skip_binders_unchecked() {\n-                            ty::PredicateAtom::Trait(t, constness) => {\n-                                let pred = ty::PredicateAtom::Trait(\n-                                    ty::TraitPredicate {\n-                                        trait_ref: ty::TraitRef {\n-                                            def_id: t.def_id(),\n-                                            substs: self.infcx.tcx.mk_substs_trait(arm_ty, &[]),\n-                                        },\n-                                    },\n-                                    constness,\n-                                );\n-                                let obl = Obligation::new(\n-                                    o.cause.clone(),\n-                                    self.param_env,\n-                                    pred.to_predicate(self.infcx.tcx),\n-                                );\n-                                suggest_box &= self.infcx.predicate_must_hold_modulo_regions(&obl);\n-                                if !suggest_box {\n-                                    // We've encountered some obligation that didn't hold, so the\n-                                    // return expression can't just be boxed. We don't need to\n-                                    // evaluate the rest of the obligations.\n-                                    break;\n-                                }\n-                            }\n-                            _ => {}\n-                        }\n-                    }\n-                    // If all the obligations hold (or there are no obligations) the tail expression\n-                    // we can suggest to return a boxed trait object instead of an opaque type.\n-                    if suggest_box { self.ret_type_span } else { None }\n-                }\n-                _ => None,\n-            };\n+            let opt_suggest_box_span =\n+                self.opt_suggest_box_span(arm.body.span, arm_ty, orig_expected);\n \n             if source_if {\n                 let then_expr = &arms[0].body;\n@@ -279,7 +267,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     ) {\n         use hir::MatchSource::*;\n         let msg = match source {\n-            IfDesugar { .. } | IfLetDesugar { .. } => \"block in `if` expression\",\n+            IfLetDesugar { .. } => \"block in `if` expression\",\n             WhileDesugar { .. } | WhileLetDesugar { .. } => \"block in `while` expression\",\n             _ => \"arm\",\n         };\n@@ -291,15 +279,20 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     /// Handle the fallback arm of a desugared if(-let) like a missing else.\n     ///\n     /// Returns `true` if there was an error forcing the coercion to the `()` type.\n-    fn if_fallback_coercion(\n+    pub(crate) fn if_fallback_coercion<F, T>(\n         &self,\n         span: Span,\n         then_expr: &'tcx hir::Expr<'tcx>,\n-        coercion: &mut CoerceMany<'tcx, '_, rustc_hir::Arm<'tcx>>,\n-    ) -> bool {\n+        coercion: &mut CoerceMany<'tcx, '_, T>,\n+        ret_reason: F,\n+    ) -> bool\n+    where\n+        F: Fn(hir::HirId, Span) -> Option<(Span, String)>,\n+        T: AsCoercionSite,\n+    {\n         // If this `if` expr is the parent's function return expr,\n         // the cause of the type coercion is the return type, point at it. (#25228)\n-        let ret_reason = self.maybe_get_coercion_reason(then_expr.hir_id, span);\n+        let ret_reason = ret_reason(then_expr.hir_id, span);\n         let cause = self.cause(span, ObligationCauseCode::IfExpressionWithNoElse);\n         let mut error = false;\n         coercion.coerce_forced_unit(\n@@ -322,38 +315,25 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         error\n     }\n \n-    fn maybe_get_coercion_reason(&self, hir_id: hir::HirId, span: Span) -> Option<(Span, String)> {\n-        use hir::Node::{Block, Item, Local};\n-\n-        let hir = self.tcx.hir();\n-        let arm_id = hir.get_parent_node(hir_id);\n-        let match_id = hir.get_parent_node(arm_id);\n-        let containing_id = hir.get_parent_node(match_id);\n-\n-        let node = hir.get(containing_id);\n-        if let Block(block) = node {\n-            // check that the body's parent is an fn\n-            let parent = hir.get(hir.get_parent_node(hir.get_parent_node(block.hir_id)));\n-            if let (Some(expr), Item(hir::Item { kind: hir::ItemKind::Fn(..), .. })) =\n-                (&block.expr, parent)\n-            {\n-                // check that the `if` expr without `else` is the fn body's expr\n-                if expr.span == span {\n-                    return self.get_fn_decl(hir_id).and_then(|(fn_decl, _)| {\n-                        let span = fn_decl.output.span();\n-                        let snippet = self.tcx.sess.source_map().span_to_snippet(span).ok()?;\n-                        Some((span, format!(\"expected `{}` because of this return type\", snippet)))\n-                    });\n-                }\n-            }\n+    create_maybe_get_coercion_reason!(\n+        maybe_get_coercion_reason,\n+        |hir: rustc_middle::hir::map::Map<'a>, id| {\n+            let arm_id = hir.get_parent_node(id);\n+            let match_id = hir.get_parent_node(arm_id);\n+            let containing_id = hir.get_parent_node(match_id);\n+            hir.get(containing_id)\n         }\n-        if let Local(hir::Local { ty: Some(_), pat, .. }) = node {\n-            return Some((pat.span, \"expected because of this assignment\".to_string()));\n+    );\n+\n+    create_maybe_get_coercion_reason!(\n+        maybe_get_coercion_reason_if,\n+        |hir: rustc_middle::hir::map::Map<'a>, id| {\n+            let rslt = hir.get_parent_node(hir.get_parent_node(id));\n+            hir.get(rslt)\n         }\n-        None\n-    }\n+    );\n \n-    fn if_cause(\n+    pub(crate) fn if_cause(\n         &self,\n         span: Span,\n         then_expr: &'tcx hir::Expr<'tcx>,\n@@ -546,6 +526,58 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             (block.span, None)\n         }\n     }\n+\n+    // When we have a `match` as a tail expression in a `fn` with a returned `impl Trait`\n+    // we check if the different arms would work with boxed trait objects instead and\n+    // provide a structured suggestion in that case.\n+    pub(crate) fn opt_suggest_box_span(\n+        &self,\n+        span: Span,\n+        outer_ty: &'tcx TyS<'tcx>,\n+        orig_expected: Expectation<'tcx>,\n+    ) -> Option<Span> {\n+        match (orig_expected, self.ret_coercion_impl_trait.map(|ty| (self.body_id.owner, ty))) {\n+            (Expectation::ExpectHasType(expected), Some((id, ty)))\n+                if self.in_tail_expr && self.can_coerce(outer_ty, expected) =>\n+            {\n+                let impl_trait_ret_ty =\n+                    self.infcx.instantiate_opaque_types(id, self.body_id, self.param_env, ty, span);\n+                let mut suggest_box = !impl_trait_ret_ty.obligations.is_empty();\n+                for o in impl_trait_ret_ty.obligations {\n+                    match o.predicate.skip_binders_unchecked() {\n+                        ty::PredicateAtom::Trait(t, constness) => {\n+                            let pred = ty::PredicateAtom::Trait(\n+                                ty::TraitPredicate {\n+                                    trait_ref: ty::TraitRef {\n+                                        def_id: t.def_id(),\n+                                        substs: self.infcx.tcx.mk_substs_trait(outer_ty, &[]),\n+                                    },\n+                                },\n+                                constness,\n+                            );\n+                            let obl = Obligation::new(\n+                                o.cause.clone(),\n+                                self.param_env,\n+                                pred.to_predicate(self.infcx.tcx),\n+                            );\n+                            suggest_box &= self.infcx.predicate_must_hold_modulo_regions(&obl);\n+                            if !suggest_box {\n+                                // We've encountered some obligation that didn't hold, so the\n+                                // return expression can't just be boxed. We don't need to\n+                                // evaluate the rest of the obligations.\n+                                break;\n+                            }\n+                        }\n+                        _ => {}\n+                    }\n+                }\n+                // If all the obligations hold (or there are no obligations) the tail expression\n+                // we can suggest to return a boxed trait object instead of an opaque type.\n+                if suggest_box { self.ret_type_span } else { None }\n+            }\n+            _ => None,\n+        }\n+    }\n }\n \n fn arms_contain_ref_bindings(arms: &'tcx [hir::Arm<'tcx>]) -> Option<hir::Mutability> {"}, {"sha": "0d21c56f4cf4de1c37b0e598c91323902d802c0f", "filename": "compiler/rustc_typeck/src/check/coercion.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcoercion.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1443,14 +1443,14 @@ impl<'tcx, 'exprs, E: AsCoercionSite> CoerceMany<'tcx, 'exprs, E> {\n                 &mut err, expr, expected, found, cause.span, blk_id,\n             );\n             let parent = fcx.tcx.hir().get(parent_id);\n-            if let (Some(match_expr), true, false) = (\n-                fcx.tcx.hir().get_match_if_cause(expr.hir_id),\n+            if let (Some(cond_expr), true, false) = (\n+                fcx.tcx.hir().get_if_cause(expr.hir_id),\n                 expected.is_unit(),\n                 pointing_at_return_type,\n             ) {\n-                if match_expr.span.desugaring_kind().is_none() {\n-                    err.span_label(match_expr.span, \"expected this to be `()`\");\n-                    fcx.suggest_semicolon_at_end(match_expr.span, &mut err);\n+                if cond_expr.span.desugaring_kind().is_none() {\n+                    err.span_label(cond_expr.span, \"expected this to be `()`\");\n+                    fcx.suggest_semicolon_at_end(cond_expr.span, &mut err);\n                 }\n             }\n             fcx.get_node_fn_decl(parent).map(|(fn_decl, _, is_main)| (fn_decl, is_main))"}, {"sha": "8aa6c6d924a5334b56bc3280836f790ad0708585", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 82, "deletions": 13, "changes": 95, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -10,6 +10,7 @@ use crate::check::method::{probe, MethodError, SelfSource};\n use crate::check::report_unexpected_variant_res;\n use crate::check::BreakableCtxt;\n use crate::check::Diverges;\n+use crate::check::DynamicCoerceMany;\n use crate::check::Expectation::{self, ExpectCastableToType, ExpectHasType, NoExpectation};\n use crate::check::FnCtxt;\n use crate::check::Needs;\n@@ -188,7 +189,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Warn for non-block expressions with diverging children.\n         match expr.kind {\n-            ExprKind::Block(..) | ExprKind::Loop(..) | ExprKind::Match(..) => {}\n+            ExprKind::Block(..) | ExprKind::If(..) | ExprKind::Loop(..) | ExprKind::Match(..) => {}\n             // If `expr` is a result of desugaring the try block and is an ok-wrapped\n             // diverging expression (e.g. it arose from desugaring of `try { return }`),\n             // we skip issuing a warning because it is autogenerated code.\n@@ -285,6 +286,13 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 self.check_expr_eq_type(&e, ty);\n                 ty\n             }\n+            ExprKind::If(ref cond, ref then_expr, ref opt_else_expr) => self.check_then_else(\n+                &cond,\n+                then_expr,\n+                opt_else_expr.as_ref().map(|e| &**e),\n+                expr.span,\n+                expected,\n+            ),\n             ExprKind::DropTemps(ref e) => self.check_expr_with_expectation(e, expected),\n             ExprKind::Array(ref args) => self.check_expr_array(args, expected, expr),\n             ExprKind::ConstBlock(ref anon_const) => self.to_const(anon_const).ty,\n@@ -739,8 +747,67 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         err.emit();\n     }\n \n+    // A generic function for checking the 'then' and 'else' clauses in an 'if'\n+    // or 'if-else' expression.\n+    fn check_then_else(\n+        &self,\n+        cond_expr: &'tcx hir::Expr<'tcx>,\n+        then_expr: &'tcx hir::Expr<'tcx>,\n+        opt_else_expr: Option<&'tcx hir::Expr<'tcx>>,\n+        sp: Span,\n+        orig_expected: Expectation<'tcx>,\n+    ) -> Ty<'tcx> {\n+        let cond_ty = self.check_expr_has_type_or_error(cond_expr, self.tcx.types.bool, |_| {});\n+\n+        self.warn_if_unreachable(cond_expr.hir_id, then_expr.span, \"block in `if` expression\");\n+\n+        let cond_diverges = self.diverges.get();\n+        self.diverges.set(Diverges::Maybe);\n+\n+        let expected = orig_expected.adjust_for_branches(self);\n+        let then_ty = self.check_expr_with_expectation(then_expr, expected);\n+        let then_diverges = self.diverges.get();\n+        self.diverges.set(Diverges::Maybe);\n+\n+        // We've already taken the expected type's preferences\n+        // into account when typing the `then` branch. To figure\n+        // out the initial shot at a LUB, we thus only consider\n+        // `expected` if it represents a *hard* constraint\n+        // (`only_has_type`); otherwise, we just go with a\n+        // fresh type variable.\n+        let coerce_to_ty = expected.coercion_target_type(self, sp);\n+        let mut coerce: DynamicCoerceMany<'_> = CoerceMany::new(coerce_to_ty);\n+\n+        coerce.coerce(self, &self.misc(sp), then_expr, then_ty);\n+\n+        if let Some(else_expr) = opt_else_expr {\n+            let else_ty = self.check_expr_with_expectation(else_expr, expected);\n+            let else_diverges = self.diverges.get();\n+\n+            let opt_suggest_box_span =\n+                self.opt_suggest_box_span(else_expr.span, else_ty, orig_expected);\n+            let if_cause =\n+                self.if_cause(sp, then_expr, else_expr, then_ty, else_ty, opt_suggest_box_span);\n+\n+            coerce.coerce(self, &if_cause, else_expr, else_ty);\n+\n+            // We won't diverge unless both branches do (or the condition does).\n+            self.diverges.set(cond_diverges | then_diverges & else_diverges);\n+        } else {\n+            self.if_fallback_coercion(sp, then_expr, &mut coerce, |hir_id, span| {\n+                self.maybe_get_coercion_reason_if(hir_id, span)\n+            });\n+\n+            // If the condition is false we can't diverge.\n+            self.diverges.set(cond_diverges);\n+        }\n+\n+        let result_ty = coerce.complete(self);\n+        if cond_ty.references_error() { self.tcx.ty_error() } else { result_ty }\n+    }\n+\n     /// Type check assignment expression `expr` of form `lhs = rhs`.\n-    /// The expected type is `()` and is passsed to the function for the purposes of diagnostics.\n+    /// The expected type is `()` and is passed to the function for the purposes of diagnostics.\n     fn check_expr_assign(\n         &self,\n         expr: &'tcx hir::Expr<'tcx>,\n@@ -765,24 +832,26 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             };\n             if !lhs.is_syntactic_place_expr() {\n                 // Do not suggest `if let x = y` as `==` is way more likely to be the intention.\n-                if let hir::Node::Expr(hir::Expr {\n-                    kind:\n-                        ExprKind::Match(\n-                            _,\n-                            _,\n-                            hir::MatchSource::IfDesugar { .. } | hir::MatchSource::WhileDesugar,\n-                        ),\n-                    ..\n-                }) = self.tcx.hir().get(\n-                    self.tcx.hir().get_parent_node(self.tcx.hir().get_parent_node(expr.hir_id)),\n-                ) {\n+                let mut span_err = || {\n                     // Likely `if let` intended.\n                     err.span_suggestion_verbose(\n                         expr.span.shrink_to_lo(),\n                         \"you might have meant to use pattern matching\",\n                         \"let \".to_string(),\n                         applicability,\n                     );\n+                };\n+                if let hir::Node::Expr(hir::Expr {\n+                    kind: ExprKind::Match(_, _, hir::MatchSource::WhileDesugar),\n+                    ..\n+                }) = self.tcx.hir().get(\n+                    self.tcx.hir().get_parent_node(self.tcx.hir().get_parent_node(expr.hir_id)),\n+                ) {\n+                    span_err();\n+                } else if let hir::Node::Expr(hir::Expr { kind: ExprKind::If { .. }, .. }) =\n+                    self.tcx.hir().get(self.tcx.hir().get_parent_node(expr.hir_id))\n+                {\n+                    span_err();\n                 }\n             }\n             if eq {"}, {"sha": "8fa0de623b0a4018e44ad475c71d8da31df2016f", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/checks.rs", "status": "modified", "additions": 28, "deletions": 22, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -803,33 +803,39 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     /// //                               ^^^^ point at this instead of the whole `if` expression\n     /// ```\n     fn get_expr_coercion_span(&self, expr: &hir::Expr<'_>) -> rustc_span::Span {\n-        if let hir::ExprKind::Match(_, arms, _) = &expr.kind {\n-            let arm_spans: Vec<Span> = arms\n-                .iter()\n-                .filter_map(|arm| {\n-                    self.in_progress_typeck_results\n-                        .and_then(|typeck_results| {\n-                            typeck_results.borrow().node_type_opt(arm.body.hir_id)\n-                        })\n-                        .and_then(|arm_ty| {\n-                            if arm_ty.is_never() {\n-                                None\n-                            } else {\n-                                Some(match &arm.body.kind {\n-                                    // Point at the tail expression when possible.\n-                                    hir::ExprKind::Block(block, _) => {\n-                                        block.expr.as_ref().map(|e| e.span).unwrap_or(block.span)\n-                                    }\n-                                    _ => arm.body.span,\n-                                })\n+        let check_in_progress = |elem: &hir::Expr<'_>| {\n+            self.in_progress_typeck_results\n+                .and_then(|typeck_results| typeck_results.borrow().node_type_opt(elem.hir_id))\n+                .and_then(|ty| {\n+                    if ty.is_never() {\n+                        None\n+                    } else {\n+                        Some(match &elem.kind {\n+                            // Point at the tail expression when possible.\n+                            hir::ExprKind::Block(block, _) => {\n+                                block.expr.as_ref().map(|e| e.span).unwrap_or(block.span)\n                             }\n+                            _ => elem.span,\n                         })\n+                    }\n                 })\n-                .collect();\n-            if arm_spans.len() == 1 {\n-                return arm_spans[0];\n+        };\n+\n+        if let hir::ExprKind::If(_, _, Some(el)) = &expr.kind {\n+            if let Some(rslt) = check_in_progress(el) {\n+                return rslt;\n             }\n         }\n+\n+        if let hir::ExprKind::Match(_, arms, _) = &expr.kind {\n+            let mut iter = arms.iter().filter_map(|arm| check_in_progress(&arm.body));\n+            if let Some(span) = iter.next() {\n+                if iter.next().is_none() {\n+                    return span;\n+                }\n+            }\n+        }\n+\n         expr.span\n     }\n "}, {"sha": "e698ef5efbcac0dad8dd6509b75f1881da6d196f", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/suggestions.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -358,6 +358,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 ExprKind::Call(..)\n                 | ExprKind::MethodCall(..)\n                 | ExprKind::Loop(..)\n+                | ExprKind::If(..)\n                 | ExprKind::Match(..)\n                 | ExprKind::Block(..) => {\n                     err.span_suggestion("}, {"sha": "01519e4c8f7c495aeff7541d2d14db2292384fce", "filename": "compiler/rustc_typeck/src/expr_use_visitor.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fexpr_use_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fexpr_use_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fexpr_use_visitor.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -219,6 +219,14 @@ impl<'a, 'tcx> ExprUseVisitor<'a, 'tcx> {\n                 self.consume_exprs(exprs);\n             }\n \n+            hir::ExprKind::If(ref cond_expr, ref then_expr, ref opt_else_expr) => {\n+                self.consume_expr(&cond_expr);\n+                self.consume_expr(&then_expr);\n+                if let Some(ref else_expr) = *opt_else_expr {\n+                    self.consume_expr(&else_expr);\n+                }\n+            }\n+\n             hir::ExprKind::Match(ref discr, arms, _) => {\n                 let discr_place = return_if_err!(self.mc.cat_expr(&discr));\n                 self.borrow_expr(&discr, ty::ImmBorrow);"}, {"sha": "37f9e3d63b83022ad11d139af8494b688d23bfa6", "filename": "compiler/rustc_typeck/src/mem_categorization.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fmem_categorization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/compiler%2Frustc_typeck%2Fsrc%2Fmem_categorization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fmem_categorization.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -364,6 +364,7 @@ impl<'a, 'tcx> MemCategorizationContext<'a, 'tcx> {\n             | hir::ExprKind::Cast(..)\n             | hir::ExprKind::DropTemps(..)\n             | hir::ExprKind::Array(..)\n+            | hir::ExprKind::If(..)\n             | hir::ExprKind::Tup(..)\n             | hir::ExprKind::Binary(..)\n             | hir::ExprKind::Block(..)"}, {"sha": "ca8daae152cdd93c72c68ebf9ad98c6f7be84aa1", "filename": "src/test/incremental/hashes/if_expressions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fincremental%2Fhashes%2Fif_expressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fincremental%2Fhashes%2Fif_expressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fhashes%2Fif_expressions.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -94,7 +94,7 @@ pub fn add_else_branch(x: bool) -> u32 {\n }\n \n #[cfg(not(cfail1))]\n-#[rustc_clean(cfg=\"cfail2\", except=\"hir_owner_nodes\")]\n+#[rustc_clean(cfg=\"cfail2\", except=\"hir_owner_nodes,typeck\")]\n #[rustc_clean(cfg=\"cfail3\")]\n pub fn add_else_branch(x: bool) -> u32 {\n     let mut ret = 1;"}, {"sha": "64c270393735a5b9a106c31bb382043f17f5db67", "filename": "src/test/mir-opt/const_prop/control_flow_simplification.hello.ConstProp.diff", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -9,18 +9,12 @@\n       bb0: {\n           StorageLive(_1);                 // scope 0 at $DIR/control-flow-simplification.rs:12:8: 12:21\n -         _1 = const <bool as NeedsDrop>::NEEDS; // scope 0 at $DIR/control-flow-simplification.rs:12:8: 12:21\n--         switchInt(_1) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/control-flow-simplification.rs:12:5: 14:6\n+-         switchInt(move _1) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/control-flow-simplification.rs:12:5: 14:6\n +         _1 = const false;                // scope 0 at $DIR/control-flow-simplification.rs:12:8: 12:21\n-+         switchInt(const false) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/control-flow-simplification.rs:12:5: 14:6\n++         switchInt(const false) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/control-flow-simplification.rs:12:5: 14:6\n       }\n   \n       bb1: {\n-          _0 = const ();                   // scope 0 at $DIR/control-flow-simplification.rs:14:6: 14:6\n-          StorageDead(_1);                 // scope 0 at $DIR/control-flow-simplification.rs:15:1: 15:2\n-          return;                          // scope 0 at $DIR/control-flow-simplification.rs:15:2: 15:2\n-      }\n-  \n-      bb2: {\n           StorageLive(_2);                 // scope 0 at $SRC_DIR/std/src/macros.rs:LL:COL\n           begin_panic::<&str>(const \"explicit panic\"); // scope 0 at $SRC_DIR/std/src/macros.rs:LL:COL\n                                            // mir::Constant\n@@ -33,5 +27,11 @@\n                                            // + span: $SRC_DIR/std/src/macros.rs:LL:COL\n                                            // + literal: Const { ty: &str, val: Value(Slice { data: Allocation { bytes: [101, 120, 112, 108, 105, 99, 105, 116, 32, 112, 97, 110, 105, 99], relocations: Relocations(SortedMap { data: [] }), init_mask: InitMask { blocks: [16383], len: Size { raw: 14 } }, size: Size { raw: 14 }, align: Align { pow2: 0 }, mutability: Not, extra: () }, start: 0, end: 14 }) }\n       }\n+  \n+      bb2: {\n+          _0 = const ();                   // scope 0 at $DIR/control-flow-simplification.rs:14:6: 14:6\n+          StorageDead(_1);                 // scope 0 at $DIR/control-flow-simplification.rs:14:5: 14:6\n+          return;                          // scope 0 at $DIR/control-flow-simplification.rs:15:2: 15:2\n+      }\n   }\n   "}, {"sha": "6d2dbb820f9621212b3d59ccbf098f8baae79a34", "filename": "src/test/mir-opt/deaggregator_test_enum_2.test1.Deaggregator.diff", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fdeaggregator_test_enum_2.test1.Deaggregator.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fdeaggregator_test_enum_2.test1.Deaggregator.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fdeaggregator_test_enum_2.test1.Deaggregator.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -12,20 +12,10 @@\n       bb0: {\n           StorageLive(_3);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:8: 10:9\n           _3 = _1;                         // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:8: 10:9\n-          switchInt(_3) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:5: 14:6\n+          switchInt(move _3) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:5: 14:6\n       }\n   \n       bb1: {\n-          StorageLive(_5);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:16: 13:17\n-          _5 = _2;                         // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:16: 13:17\n--         _0 = Foo::B(move _5);            // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n-+         ((_0 as B).0: i32) = move _5;    // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n-+         discriminant(_0) = 1;            // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n-          StorageDead(_5);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:17: 13:18\n-          goto -> bb3;                     // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:5: 14:6\n-      }\n-  \n-      bb2: {\n           StorageLive(_4);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:11:16: 11:17\n           _4 = _2;                         // scope 0 at $DIR/deaggregator_test_enum_2.rs:11:16: 11:17\n -         _0 = Foo::A(move _4);            // scope 0 at $DIR/deaggregator_test_enum_2.rs:11:9: 11:18\n@@ -35,8 +25,18 @@\n           goto -> bb3;                     // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:5: 14:6\n       }\n   \n+      bb2: {\n+          StorageLive(_5);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:16: 13:17\n+          _5 = _2;                         // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:16: 13:17\n+-         _0 = Foo::B(move _5);            // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n++         ((_0 as B).0: i32) = move _5;    // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n++         discriminant(_0) = 1;            // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:9: 13:18\n+          StorageDead(_5);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:13:17: 13:18\n+          goto -> bb3;                     // scope 0 at $DIR/deaggregator_test_enum_2.rs:10:5: 14:6\n+      }\n+  \n       bb3: {\n-          StorageDead(_3);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:15:1: 15:2\n+          StorageDead(_3);                 // scope 0 at $DIR/deaggregator_test_enum_2.rs:14:5: 14:6\n           return;                          // scope 0 at $DIR/deaggregator_test_enum_2.rs:15:2: 15:2\n       }\n   }"}, {"sha": "e11d24cac8c2edbb42dfb78f420f8c48a855617c", "filename": "src/test/mir-opt/dest-prop/branch.main.DestinationPropagation.diff", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fdest-prop%2Fbranch.main.DestinationPropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fdest-prop%2Fbranch.main.DestinationPropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fdest-prop%2Fbranch.main.DestinationPropagation.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -36,23 +36,23 @@\n       }\n   \n       bb2: {\n-          switchInt(_3) -> [false: bb3, otherwise: bb4]; // scope 1 at $DIR/branch.rs:15:13: 20:6\n+          switchInt(move _3) -> [false: bb4, otherwise: bb3]; // scope 1 at $DIR/branch.rs:15:13: 20:6\n       }\n   \n       bb3: {\n+-         _2 = _1;                         // scope 1 at $DIR/branch.rs:16:9: 16:10\n++         nop;                             // scope 1 at $DIR/branch.rs:16:9: 16:10\n+          goto -> bb6;                     // scope 1 at $DIR/branch.rs:15:13: 20:6\n+      }\n+  \n+      bb4: {\n           StorageLive(_4);                 // scope 1 at $DIR/branch.rs:18:9: 18:14\n           _4 = val() -> bb5;               // scope 1 at $DIR/branch.rs:18:9: 18:14\n                                            // mir::Constant\n                                            // + span: $DIR/branch.rs:18:9: 18:12\n                                            // + literal: Const { ty: fn() -> i32 {val}, val: Value(Scalar(<ZST>)) }\n       }\n   \n-      bb4: {\n--         _2 = _1;                         // scope 1 at $DIR/branch.rs:16:9: 16:10\n-+         nop;                             // scope 1 at $DIR/branch.rs:16:9: 16:10\n-          goto -> bb6;                     // scope 1 at $DIR/branch.rs:15:13: 20:6\n-      }\n-  \n       bb5: {\n           StorageDead(_4);                 // scope 1 at $DIR/branch.rs:18:14: 18:15\n -         _2 = _1;                         // scope 1 at $DIR/branch.rs:19:9: 19:10\n@@ -61,7 +61,7 @@\n       }\n   \n       bb6: {\n-          StorageDead(_3);                 // scope 1 at $DIR/branch.rs:20:6: 20:7\n+          StorageDead(_3);                 // scope 1 at $DIR/branch.rs:20:5: 20:6\n           _0 = const ();                   // scope 0 at $DIR/branch.rs:12:11: 21:2\n -         StorageDead(_2);                 // scope 1 at $DIR/branch.rs:21:1: 21:2\n -         StorageDead(_1);                 // scope 0 at $DIR/branch.rs:21:1: 21:2"}, {"sha": "1bc4c0f8b37e3c1e54ab51a42d205c7a8e4e53f9", "filename": "src/test/mir-opt/equal_true.opt.InstCombine.diff", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fequal_true.opt.InstCombine.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fequal_true.opt.InstCombine.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fequal_true.opt.InstCombine.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -14,21 +14,21 @@\n -         _2 = Eq(move _3, const true);    // scope 0 at $DIR/equal_true.rs:4:8: 4:17\n +         _2 = move _3;                    // scope 0 at $DIR/equal_true.rs:4:8: 4:17\n           StorageDead(_3);                 // scope 0 at $DIR/equal_true.rs:4:16: 4:17\n-          switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/equal_true.rs:4:5: 4:34\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/equal_true.rs:4:5: 4:34\n       }\n   \n       bb1: {\n-          _0 = const 1_i32;                // scope 0 at $DIR/equal_true.rs:4:31: 4:32\n+          _0 = const 0_i32;                // scope 0 at $DIR/equal_true.rs:4:20: 4:21\n           goto -> bb3;                     // scope 0 at $DIR/equal_true.rs:4:5: 4:34\n       }\n   \n       bb2: {\n-          _0 = const 0_i32;                // scope 0 at $DIR/equal_true.rs:4:20: 4:21\n+          _0 = const 1_i32;                // scope 0 at $DIR/equal_true.rs:4:31: 4:32\n           goto -> bb3;                     // scope 0 at $DIR/equal_true.rs:4:5: 4:34\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/equal_true.rs:5:1: 5:2\n+          StorageDead(_2);                 // scope 0 at $DIR/equal_true.rs:4:33: 4:34\n           return;                          // scope 0 at $DIR/equal_true.rs:5:2: 5:2\n       }\n   }"}, {"sha": "875e5a0a71f336272d4dbe4512503c005328d319", "filename": "src/test/mir-opt/if_condition_int.dont_opt_bool.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_bool.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_bool.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_bool.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -9,21 +9,21 @@\n       bb0: {\n           StorageLive(_2);                 // scope 0 at $DIR/if-condition-int.rs:17:8: 17:9\n           _2 = _1;                         // scope 0 at $DIR/if-condition-int.rs:17:8: 17:9\n-          switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:17:5: 17:26\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:17:5: 17:26\n       }\n   \n       bb1: {\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:17:23: 17:24\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:17:12: 17:13\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:17:5: 17:26\n       }\n   \n       bb2: {\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:17:12: 17:13\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:17:23: 17:24\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:17:5: 17:26\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:18:1: 18:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:17:25: 17:26\n           return;                          // scope 0 at $DIR/if-condition-int.rs:18:2: 18:2\n       }\n   }"}, {"sha": "2c4952402a49d907783efd663300622e5763306a", "filename": "src/test/mir-opt/if_condition_int.dont_opt_floats.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_floats.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_floats.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.dont_opt_floats.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -16,21 +16,21 @@\n                                            // + span: $DIR/if-condition-int.rs:53:13: 53:18\n                                            // + literal: Const { ty: f32, val: Value(Scalar(0xc2280000)) }\n           StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:53:17: 53:18\n-          switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:53:5: 53:35\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:53:5: 53:35\n       }\n   \n       bb1: {\n-          _0 = const 1_i32;                // scope 0 at $DIR/if-condition-int.rs:53:32: 53:33\n+          _0 = const 0_i32;                // scope 0 at $DIR/if-condition-int.rs:53:21: 53:22\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:53:5: 53:35\n       }\n   \n       bb2: {\n-          _0 = const 0_i32;                // scope 0 at $DIR/if-condition-int.rs:53:21: 53:22\n+          _0 = const 1_i32;                // scope 0 at $DIR/if-condition-int.rs:53:32: 53:33\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:53:5: 53:35\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:54:1: 54:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:53:34: 53:35\n           return;                          // scope 0 at $DIR/if-condition-int.rs:54:2: 54:2\n       }\n   }"}, {"sha": "661591658df89c0c1ccc1d7fa5fbd1d3ba76c358", "filename": "src/test/mir-opt/if_condition_int.opt_char.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_char.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_char.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_char.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -13,26 +13,26 @@\n           _3 = _1;                         // scope 0 at $DIR/if-condition-int.rs:21:8: 21:9\n -         _2 = Eq(move _3, const 'x');     // scope 0 at $DIR/if-condition-int.rs:21:8: 21:16\n -         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:21:15: 21:16\n--         switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n-+         _2 = Eq(_3, const 'x');          // scope 0 at $DIR/if-condition-int.rs:21:8: 21:16\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:21:8: 21:16\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:21:15: 21:16\n-+         switchInt(move _3) -> ['x': bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n++         switchInt(move _3) -> ['x': bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n       }\n   \n       bb1: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:21:30: 21:31\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:21:19: 21:20\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n       }\n   \n       bb2: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:21:19: 21:20\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:21:30: 21:31\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:21:5: 21:33\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:22:1: 22:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:21:32: 21:33\n           return;                          // scope 0 at $DIR/if-condition-int.rs:22:2: 22:2\n       }\n   }"}, {"sha": "7d0ed7338d7d230651c980c4a14ad48f685dce61", "filename": "src/test/mir-opt/if_condition_int.opt_i8.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_i8.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_i8.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_i8.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -13,26 +13,26 @@\n           _3 = _1;                         // scope 0 at $DIR/if-condition-int.rs:25:8: 25:9\n -         _2 = Eq(move _3, const 42_i8);   // scope 0 at $DIR/if-condition-int.rs:25:8: 25:15\n -         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:25:14: 25:15\n--         switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n-+         _2 = Eq(_3, const 42_i8);        // scope 0 at $DIR/if-condition-int.rs:25:8: 25:15\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:25:8: 25:15\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:25:14: 25:15\n-+         switchInt(move _3) -> [42_i8: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n++         switchInt(move _3) -> [42_i8: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n       }\n   \n       bb1: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:25:29: 25:30\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:25:18: 25:19\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n       }\n   \n       bb2: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:25:18: 25:19\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:25:29: 25:30\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:25:5: 25:32\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:26:1: 26:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:25:31: 25:32\n           return;                          // scope 0 at $DIR/if-condition-int.rs:26:2: 26:2\n       }\n   }"}, {"sha": "bf388a141b617a198689e15a1f921fafd3e3fece", "filename": "src/test/mir-opt/if_condition_int.opt_multiple_ifs.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_multiple_ifs.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_multiple_ifs.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_multiple_ifs.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -15,40 +15,40 @@\n           _3 = _1;                         // scope 0 at $DIR/if-condition-int.rs:33:8: 33:9\n -         _2 = Eq(move _3, const 42_u32);  // scope 0 at $DIR/if-condition-int.rs:33:8: 33:15\n -         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:33:14: 33:15\n--         switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n-+         _2 = Eq(_3, const 42_u32);       // scope 0 at $DIR/if-condition-int.rs:33:8: 33:15\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:33:8: 33:15\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:33:14: 33:15\n-+         switchInt(move _3) -> [42_u32: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n++         switchInt(move _3) -> [42_u32: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n       }\n   \n       bb1: {\n++         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:34:9: 34:10\n+          goto -> bb6;                     // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n+      }\n+  \n+      bb2: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n           StorageLive(_4);                 // scope 0 at $DIR/if-condition-int.rs:35:15: 35:22\n           StorageLive(_5);                 // scope 0 at $DIR/if-condition-int.rs:35:15: 35:16\n           _5 = _1;                         // scope 0 at $DIR/if-condition-int.rs:35:15: 35:16\n -         _4 = Ne(move _5, const 21_u32);  // scope 0 at $DIR/if-condition-int.rs:35:15: 35:22\n -         StorageDead(_5);                 // scope 0 at $DIR/if-condition-int.rs:35:21: 35:22\n--         switchInt(_4) -> [false: bb3, otherwise: bb4]; // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n-+         _4 = Ne(_5, const 21_u32);       // scope 0 at $DIR/if-condition-int.rs:35:15: 35:22\n+-         switchInt(move _4) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:35:15: 35:22\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:35:21: 35:22\n-+         switchInt(move _5) -> [21_u32: bb3, otherwise: bb4]; // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n-      }\n-  \n-      bb2: {\n-+         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:34:9: 34:10\n-          goto -> bb6;                     // scope 0 at $DIR/if-condition-int.rs:33:5: 39:6\n++         switchInt(move _5) -> [21_u32: bb4, otherwise: bb3]; // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n       }\n   \n       bb3: {\n +         StorageDead(_5);                 // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n-          _0 = const 2_u32;                // scope 0 at $DIR/if-condition-int.rs:38:9: 38:10\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:36:9: 36:10\n           goto -> bb5;                     // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n       }\n   \n       bb4: {\n +         StorageDead(_5);                 // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:36:9: 36:10\n+          _0 = const 2_u32;                // scope 0 at $DIR/if-condition-int.rs:38:9: 38:10\n           goto -> bb5;                     // scope 0 at $DIR/if-condition-int.rs:35:12: 39:6\n       }\n   \n@@ -58,7 +58,7 @@\n       }\n   \n       bb6: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:40:1: 40:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:39:5: 39:6\n           return;                          // scope 0 at $DIR/if-condition-int.rs:40:2: 40:2\n       }\n   }"}, {"sha": "bee2e030b7ed55126fb2b87e3e9655aee6c354ec", "filename": "src/test/mir-opt/if_condition_int.opt_negative.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_negative.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_negative.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_negative.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -13,26 +13,26 @@\n           _3 = _1;                         // scope 0 at $DIR/if-condition-int.rs:29:8: 29:9\n -         _2 = Eq(move _3, const -42_i32); // scope 0 at $DIR/if-condition-int.rs:29:8: 29:16\n -         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:29:15: 29:16\n--         switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n-+         _2 = Eq(_3, const -42_i32);      // scope 0 at $DIR/if-condition-int.rs:29:8: 29:16\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:29:8: 29:16\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:29:15: 29:16\n-+         switchInt(move _3) -> [-42_i32: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n++         switchInt(move _3) -> [-42_i32: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n       }\n   \n       bb1: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:29:30: 29:31\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:29:19: 29:20\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n       }\n   \n       bb2: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:29:19: 29:20\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:29:30: 29:31\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:29:5: 29:33\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:30:1: 30:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:29:32: 29:33\n           return;                          // scope 0 at $DIR/if-condition-int.rs:30:2: 30:2\n       }\n   }"}, {"sha": "09a87591be10793a283ad2de3822e642b2db3b87", "filename": "src/test/mir-opt/if_condition_int.opt_u32.SimplifyComparisonIntegral.diff", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_u32.SimplifyComparisonIntegral.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_u32.SimplifyComparisonIntegral.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fif_condition_int.opt_u32.SimplifyComparisonIntegral.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -13,26 +13,26 @@\n           _3 = _1;                         // scope 0 at $DIR/if-condition-int.rs:12:8: 12:9\n -         _2 = Eq(move _3, const 42_u32);  // scope 0 at $DIR/if-condition-int.rs:12:8: 12:15\n -         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:12:14: 12:15\n--         switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n-+         _2 = Eq(_3, const 42_u32);       // scope 0 at $DIR/if-condition-int.rs:12:8: 12:15\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n++         nop;                             // scope 0 at $DIR/if-condition-int.rs:12:8: 12:15\n +         nop;                             // scope 0 at $DIR/if-condition-int.rs:12:14: 12:15\n-+         switchInt(move _3) -> [42_u32: bb2, otherwise: bb1]; // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n++         switchInt(move _3) -> [42_u32: bb1, otherwise: bb2]; // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n       }\n   \n       bb1: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n-          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:12:29: 12:30\n+          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:12:18: 12:19\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n       }\n   \n       bb2: {\n +         StorageDead(_3);                 // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n-          _0 = const 0_u32;                // scope 0 at $DIR/if-condition-int.rs:12:18: 12:19\n+          _0 = const 1_u32;                // scope 0 at $DIR/if-condition-int.rs:12:29: 12:30\n           goto -> bb3;                     // scope 0 at $DIR/if-condition-int.rs:12:5: 12:32\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:13:1: 13:2\n+          StorageDead(_2);                 // scope 0 at $DIR/if-condition-int.rs:12:31: 12:32\n           return;                          // scope 0 at $DIR/if-condition-int.rs:13:2: 13:2\n       }\n   }"}, {"sha": "a746baa63eb53ee8cc9fe33fbec9e25dbdf18354", "filename": "src/test/mir-opt/inline/inline_diverging.g.Inline.diff", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finline%2Finline_diverging.g.Inline.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finline%2Finline_diverging.g.Inline.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline%2Finline_diverging.g.Inline.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -19,10 +19,19 @@\n           _3 = _1;                         // scope 0 at $DIR/inline-diverging.rs:13:8: 13:9\n           _2 = Gt(move _3, const 0_i32);   // scope 0 at $DIR/inline-diverging.rs:13:8: 13:13\n           StorageDead(_3);                 // scope 0 at $DIR/inline-diverging.rs:13:12: 13:13\n-          switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/inline-diverging.rs:13:5: 17:6\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/inline-diverging.rs:13:5: 17:6\n       }\n   \n       bb1: {\n+          StorageLive(_4);                 // scope 0 at $DIR/inline-diverging.rs:14:9: 14:10\n+          _4 = _1;                         // scope 0 at $DIR/inline-diverging.rs:14:9: 14:10\n+          _0 = move _4 as u32 (Misc);      // scope 0 at $DIR/inline-diverging.rs:14:9: 14:17\n+          StorageDead(_4);                 // scope 0 at $DIR/inline-diverging.rs:14:16: 14:17\n+          StorageDead(_2);                 // scope 0 at $DIR/inline-diverging.rs:17:5: 17:6\n+          return;                          // scope 0 at $DIR/inline-diverging.rs:18:2: 18:2\n+      }\n+  \n+      bb2: {\n           StorageLive(_6);                 // scope 0 at $DIR/inline-diverging.rs:16:9: 16:16\n -         panic();                         // scope 0 at $DIR/inline-diverging.rs:16:9: 16:16\n +         StorageLive(_7);                 // scope 0 at $DIR/inline-diverging.rs:16:9: 16:16\n@@ -39,14 +48,5 @@\n +                                          // + span: $DIR/inline-diverging.rs:16:9: 16:16\n +                                          // + literal: Const { ty: &str, val: Value(Slice { data: Allocation { bytes: [101, 120, 112, 108, 105, 99, 105, 116, 32, 112, 97, 110, 105, 99], relocations: Relocations(SortedMap { data: [] }), init_mask: InitMask { blocks: [16383], len: Size { raw: 14 } }, size: Size { raw: 14 }, align: Align { pow2: 0 }, mutability: Not, extra: () }, start: 0, end: 14 }) }\n       }\n-  \n-      bb2: {\n-          StorageLive(_4);                 // scope 0 at $DIR/inline-diverging.rs:14:9: 14:10\n-          _4 = _1;                         // scope 0 at $DIR/inline-diverging.rs:14:9: 14:10\n-          _0 = move _4 as u32 (Misc);      // scope 0 at $DIR/inline-diverging.rs:14:9: 14:17\n-          StorageDead(_4);                 // scope 0 at $DIR/inline-diverging.rs:14:16: 14:17\n-          StorageDead(_2);                 // scope 0 at $DIR/inline-diverging.rs:18:1: 18:2\n-          return;                          // scope 0 at $DIR/inline-diverging.rs:18:2: 18:2\n-      }\n   }\n   "}, {"sha": "066ac8d82d36bb405c6631ddb6d08ffd5f529299", "filename": "src/test/mir-opt/inline/inline_generator.main.Inline.diff", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finline%2Finline_generator.main.Inline.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finline%2Finline_generator.main.Inline.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline%2Finline_generator.main.Inline.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -90,16 +90,16 @@\n + \n +     bb3: {\n +         _8 = move _7;                    // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n-+         switchInt(_8) -> [false: bb4, otherwise: bb5]; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n++         switchInt(move _8) -> [false: bb5, otherwise: bb4]; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n +     }\n + \n +     bb4: {\n-+         ((_1 as Yielded).0: i32) = const 13_i32; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n++         ((_1 as Yielded).0: i32) = const 7_i32; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n +         goto -> bb6;                     // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n +     }\n + \n +     bb5: {\n-+         ((_1 as Yielded).0: i32) = const 7_i32; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n++         ((_1 as Yielded).0: i32) = const 13_i32; // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n +         goto -> bb6;                     // scope 6 at $DIR/inline-generator.rs:9:14: 9:46\n +     }\n + "}, {"sha": "ee8fcdcde4095ef23ae91740074dd86d539a4b12", "filename": "src/test/mir-opt/inst_combine_deref.do_not_miscompile.InstCombine.diff", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finst_combine_deref.do_not_miscompile.InstCombine.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Finst_combine_deref.do_not_miscompile.InstCombine.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finst_combine_deref.do_not_miscompile.InstCombine.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -53,22 +53,10 @@\n           StorageDead(_10);                // scope 4 at $DIR/inst_combine_deref.rs:60:20: 60:21\n           _8 = Not(move _9);               // scope 4 at $DIR/inst_combine_deref.rs:60:5: 60:23\n           StorageDead(_9);                 // scope 4 at $DIR/inst_combine_deref.rs:60:22: 60:23\n-          switchInt(_8) -> [false: bb1, otherwise: bb2]; // scope 4 at $DIR/inst_combine_deref.rs:60:5: 60:23\n+          switchInt(move _8) -> [false: bb2, otherwise: bb1]; // scope 4 at $DIR/inst_combine_deref.rs:60:5: 60:23\n       }\n   \n       bb1: {\n-          _7 = const ();                   // scope 4 at $DIR/inst_combine_deref.rs:60:23: 60:23\n-          StorageDead(_8);                 // scope 4 at $DIR/inst_combine_deref.rs:60:22: 60:23\n-          StorageDead(_7);                 // scope 4 at $DIR/inst_combine_deref.rs:60:22: 60:23\n-          _0 = const ();                   // scope 0 at $DIR/inst_combine_deref.rs:54:24: 61:2\n-          StorageDead(_4);                 // scope 3 at $DIR/inst_combine_deref.rs:61:1: 61:2\n-          StorageDead(_3);                 // scope 2 at $DIR/inst_combine_deref.rs:61:1: 61:2\n-          StorageDead(_2);                 // scope 1 at $DIR/inst_combine_deref.rs:61:1: 61:2\n-          StorageDead(_1);                 // scope 0 at $DIR/inst_combine_deref.rs:61:1: 61:2\n-          return;                          // scope 0 at $DIR/inst_combine_deref.rs:61:2: 61:2\n-      }\n-  \n-      bb2: {\n           StorageLive(_11);                // scope 4 at $DIR/inst_combine_deref.rs:60:5: 60:23\n           core::panicking::panic(const \"assertion failed: *y == 99\"); // scope 4 at $DIR/inst_combine_deref.rs:60:5: 60:23\n                                            // mir::Constant\n@@ -81,5 +69,17 @@\n                                            // + span: $DIR/inst_combine_deref.rs:1:1: 1:1\n                                            // + literal: Const { ty: &str, val: Value(Slice { data: Allocation { bytes: [97, 115, 115, 101, 114, 116, 105, 111, 110, 32, 102, 97, 105, 108, 101, 100, 58, 32, 42, 121, 32, 61, 61, 32, 57, 57], relocations: Relocations(SortedMap { data: [] }), init_mask: InitMask { blocks: [67108863], len: Size { raw: 26 } }, size: Size { raw: 26 }, align: Align { pow2: 0 }, mutability: Not, extra: () }, start: 0, end: 26 }) }\n       }\n+  \n+      bb2: {\n+          _7 = const ();                   // scope 4 at $DIR/inst_combine_deref.rs:60:23: 60:23\n+          StorageDead(_8);                 // scope 4 at $DIR/inst_combine_deref.rs:60:22: 60:23\n+          StorageDead(_7);                 // scope 4 at $DIR/inst_combine_deref.rs:60:22: 60:23\n+          _0 = const ();                   // scope 0 at $DIR/inst_combine_deref.rs:54:24: 61:2\n+          StorageDead(_4);                 // scope 3 at $DIR/inst_combine_deref.rs:61:1: 61:2\n+          StorageDead(_3);                 // scope 2 at $DIR/inst_combine_deref.rs:61:1: 61:2\n+          StorageDead(_2);                 // scope 1 at $DIR/inst_combine_deref.rs:61:1: 61:2\n+          StorageDead(_1);                 // scope 0 at $DIR/inst_combine_deref.rs:61:1: 61:2\n+          return;                          // scope 0 at $DIR/inst_combine_deref.rs:61:2: 61:2\n+      }\n   }\n   "}, {"sha": "e9e5a101a64a5f56c26064405852f90bcc059bfd", "filename": "src/test/mir-opt/issue_38669.main.SimplifyCfg-initial.after.mir", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_38669.main.SimplifyCfg-initial.after.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_38669.main.SimplifyCfg-initial.after.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_38669.main.SimplifyCfg-initial.after.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -19,19 +19,22 @@ fn main() -> () {\n     }\n \n     bb1: {\n-        falseUnwind -> [real: bb2, cleanup: bb6]; // scope 1 at $DIR/issue-38669.rs:6:5: 11:6\n+        falseUnwind -> [real: bb2, cleanup: bb5]; // scope 1 at $DIR/issue-38669.rs:6:5: 11:6\n     }\n \n     bb2: {\n         StorageLive(_3);                 // scope 1 at $DIR/issue-38669.rs:7:9: 9:10\n         StorageLive(_4);                 // scope 1 at $DIR/issue-38669.rs:7:12: 7:24\n         _4 = _1;                         // scope 1 at $DIR/issue-38669.rs:7:12: 7:24\n-        FakeRead(ForMatchedPlace, _4);   // scope 1 at $DIR/issue-38669.rs:7:12: 7:24\n-        switchInt(_4) -> [false: bb4, otherwise: bb3]; // scope 1 at $DIR/issue-38669.rs:7:9: 9:10\n+        switchInt(move _4) -> [false: bb4, otherwise: bb3]; // scope 1 at $DIR/issue-38669.rs:7:9: 9:10\n     }\n \n     bb3: {\n-        falseEdge -> [real: bb5, imaginary: bb4]; // scope 1 at $DIR/issue-38669.rs:7:9: 9:10\n+        _0 = const ();                   // scope 1 at $DIR/issue-38669.rs:8:13: 8:18\n+        StorageDead(_4);                 // scope 1 at $DIR/issue-38669.rs:9:9: 9:10\n+        StorageDead(_3);                 // scope 1 at $DIR/issue-38669.rs:9:9: 9:10\n+        StorageDead(_1);                 // scope 0 at $DIR/issue-38669.rs:12:1: 12:2\n+        return;                          // scope 0 at $DIR/issue-38669.rs:12:2: 12:2\n     }\n \n     bb4: {\n@@ -43,15 +46,7 @@ fn main() -> () {\n         goto -> bb1;                     // scope 1 at $DIR/issue-38669.rs:6:5: 11:6\n     }\n \n-    bb5: {\n-        _0 = const ();                   // scope 1 at $DIR/issue-38669.rs:8:13: 8:18\n-        StorageDead(_4);                 // scope 1 at $DIR/issue-38669.rs:9:9: 9:10\n-        StorageDead(_3);                 // scope 1 at $DIR/issue-38669.rs:9:9: 9:10\n-        StorageDead(_1);                 // scope 0 at $DIR/issue-38669.rs:12:1: 12:2\n-        return;                          // scope 0 at $DIR/issue-38669.rs:12:2: 12:2\n-    }\n-\n-    bb6 (cleanup): {\n+    bb5 (cleanup): {\n         resume;                          // scope 0 at $DIR/issue-38669.rs:4:1: 12:2\n     }\n }"}, {"sha": "4fc7f9daa22b9cde483418d8ad11250cf64414b4", "filename": "src/test/mir-opt/issue_41888.main.ElaborateDrops.after.mir", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_41888.main.ElaborateDrops.after.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_41888.main.ElaborateDrops.after.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_41888.main.ElaborateDrops.after.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -33,15 +33,10 @@ fn main() -> () {\n     }\n \n     bb1: {\n-        switchInt(_2) -> [false: bb2, otherwise: bb3]; // scope 1 at $DIR/issue-41888.rs:8:5: 14:6\n+        switchInt(move _2) -> [false: bb3, otherwise: bb2]; // scope 1 at $DIR/issue-41888.rs:8:5: 14:6\n     }\n \n     bb2: {\n-        _0 = const ();                   // scope 1 at $DIR/issue-41888.rs:14:6: 14:6\n-        goto -> bb7;                     // scope 1 at $DIR/issue-41888.rs:8:5: 14:6\n-    }\n-\n-    bb3: {\n         StorageLive(_3);                 // scope 1 at $DIR/issue-41888.rs:9:13: 9:20\n         StorageLive(_4);                 // scope 1 at $DIR/issue-41888.rs:9:18: 9:19\n         _4 = K;                          // scope 1 at $DIR/issue-41888.rs:9:18: 9:19\n@@ -50,6 +45,11 @@ fn main() -> () {\n         goto -> bb12;                    // scope 1 at $DIR/issue-41888.rs:9:9: 9:10\n     }\n \n+    bb3: {\n+        _0 = const ();                   // scope 1 at $DIR/issue-41888.rs:14:6: 14:6\n+        goto -> bb7;                     // scope 1 at $DIR/issue-41888.rs:8:5: 14:6\n+    }\n+\n     bb4: {\n         StorageDead(_3);                 // scope 1 at $DIR/issue-41888.rs:9:19: 9:20\n         _5 = discriminant(_1);           // scope 1 at $DIR/issue-41888.rs:10:16: 10:24\n@@ -71,6 +71,7 @@ fn main() -> () {\n     }\n \n     bb7: {\n+        StorageDead(_2);                 // scope 1 at $DIR/issue-41888.rs:14:5: 14:6\n         goto -> bb18;                    // scope 0 at $DIR/issue-41888.rs:15:1: 15:2\n     }\n \n@@ -79,7 +80,6 @@ fn main() -> () {\n         _8 = const false;                // scope 0 at $DIR/issue-41888.rs:15:1: 15:2\n         _9 = const false;                // scope 0 at $DIR/issue-41888.rs:15:1: 15:2\n         StorageDead(_1);                 // scope 0 at $DIR/issue-41888.rs:15:1: 15:2\n-        StorageDead(_2);                 // scope 0 at $DIR/issue-41888.rs:15:1: 15:2\n         return;                          // scope 0 at $DIR/issue-41888.rs:15:2: 15:2\n     }\n "}, {"sha": "435b2a1360a6b9da53d42c5142246326f1b006ac", "filename": "src/test/mir-opt/issue_73223.main.PreCodegen.32bit.diff", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.32bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -99,19 +99,10 @@\n           StorageDead(_11);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _9 = Not(move _10);              // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_10);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          switchInt(_9) -> [false: bb1, otherwise: bb2]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          switchInt(move _9) -> [false: bb2, otherwise: bb1]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n       }\n   \n       bb1: {\n-          StorageDead(_9);                 // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_7);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n-          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n-          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n-      }\n-  \n-      bb2: {\n           _13 = const main::promoted[0];   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n                                            // ty::Const\n                                            // + ty: &[&str; 3]\n@@ -143,6 +134,15 @@\n                                            // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn(for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>) -> for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error> {std::intrinsics::transmute::<for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>, for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>>}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb2: {\n+          StorageDead(_9);                 // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_7);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n+          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n+          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n+      }\n+  \n       bb3: {\n           (_20.0: &core::fmt::Opaque) = transmute::<&&i32, &core::fmt::Opaque>(move _24) -> bb4; // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n                                            // mir::Constant"}, {"sha": "435b2a1360a6b9da53d42c5142246326f1b006ac", "filename": "src/test/mir-opt/issue_73223.main.PreCodegen.64bit.diff", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_73223.main.PreCodegen.64bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -99,19 +99,10 @@\n           StorageDead(_11);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _9 = Not(move _10);              // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_10);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          switchInt(_9) -> [false: bb1, otherwise: bb2]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          switchInt(move _9) -> [false: bb2, otherwise: bb1]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n       }\n   \n       bb1: {\n-          StorageDead(_9);                 // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_7);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n-          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n-          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n-      }\n-  \n-      bb2: {\n           _13 = const main::promoted[0];   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n                                            // ty::Const\n                                            // + ty: &[&str; 3]\n@@ -143,6 +134,15 @@\n                                            // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn(for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>) -> for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error> {std::intrinsics::transmute::<for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>, for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>>}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb2: {\n+          StorageDead(_9);                 // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_7);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n+          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n+          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n+      }\n+  \n       bb3: {\n           (_20.0: &core::fmt::Opaque) = transmute::<&&i32, &core::fmt::Opaque>(move _24) -> bb4; // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n                                            // mir::Constant"}, {"sha": "d87cb2af8baac15ce33f9334f73dc1de7eb16e6f", "filename": "src/test/mir-opt/issue_73223.main.SimplifyArmIdentity.32bit.diff", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.32bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -151,23 +151,10 @@\n           StorageDead(_17);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _15 = Not(move _16);             // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_16);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          switchInt(_15) -> [false: bb3, otherwise: bb4]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          switchInt(move _15) -> [false: bb4, otherwise: bb3]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n       }\n   \n       bb3: {\n-          _8 = const ();                   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_15);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_14);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_13);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_9);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n-          StorageDead(_6);                 // scope 1 at $DIR/issue-73223.rs:9:1: 9:2\n-          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n-          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n-      }\n-  \n-      bb4: {\n           StorageLive(_19);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_20);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_21);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n@@ -222,6 +209,19 @@\n                                            // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn(for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>) -> for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error> {std::intrinsics::transmute::<for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>, for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>>}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb4: {\n+          _8 = const ();                   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_15);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_14);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_13);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_9);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n+          StorageDead(_6);                 // scope 1 at $DIR/issue-73223.rs:9:1: 9:2\n+          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n+          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n+      }\n+  \n       bb5: {\n           StorageDead(_45);                // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_46);                // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL"}, {"sha": "d87cb2af8baac15ce33f9334f73dc1de7eb16e6f", "filename": "src/test/mir-opt/issue_73223.main.SimplifyArmIdentity.64bit.diff", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue_73223.main.SimplifyArmIdentity.64bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -151,23 +151,10 @@\n           StorageDead(_17);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           _15 = Not(move _16);             // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_16);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          switchInt(_15) -> [false: bb3, otherwise: bb4]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          switchInt(move _15) -> [false: bb4, otherwise: bb3]; // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n       }\n   \n       bb3: {\n-          _8 = const ();                   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_15);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_14);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_13);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_9);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n-          StorageDead(_6);                 // scope 1 at $DIR/issue-73223.rs:9:1: 9:2\n-          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n-          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n-      }\n-  \n-      bb4: {\n           StorageLive(_19);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_20);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_21);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n@@ -222,6 +209,19 @@\n                                            // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn(for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>) -> for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error> {std::intrinsics::transmute::<for<'r, 's, 't0> fn(&'r &i32, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>, for<'r, 's, 't0> fn(&'r core::fmt::Opaque, &'s mut std::fmt::Formatter<'t0>) -> std::result::Result<(), std::fmt::Error>>}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb4: {\n+          _8 = const ();                   // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_15);                // scope 4 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_14);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_13);                // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_9);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          StorageDead(_8);                 // scope 3 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+          _0 = const ();                   // scope 0 at $DIR/issue-73223.rs:1:11: 9:2\n+          StorageDead(_6);                 // scope 1 at $DIR/issue-73223.rs:9:1: 9:2\n+          StorageDead(_1);                 // scope 0 at $DIR/issue-73223.rs:9:1: 9:2\n+          return;                          // scope 0 at $DIR/issue-73223.rs:9:2: 9:2\n+      }\n+  \n       bb5: {\n           StorageDead(_45);                // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageLive(_46);                // scope 7 at $SRC_DIR/core/src/macros/mod.rs:LL:COL"}, {"sha": "f109937dbf937f0a1d218d69b21e84f8df4dc581", "filename": "src/test/mir-opt/loop_test.main.SimplifyCfg-promote-consts.after.mir", "status": "modified", "additions": 9, "deletions": 14, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Floop_test.main.SimplifyCfg-promote-consts.after.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Floop_test.main.SimplifyCfg-promote-consts.after.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Floop_test.main.SimplifyCfg-promote-consts.after.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -16,42 +16,37 @@ fn main() -> () {\n         StorageLive(_1);                 // scope 0 at $DIR/loop_test.rs:10:5: 12:6\n         StorageLive(_2);                 // scope 0 at $DIR/loop_test.rs:10:8: 10:12\n         _2 = const true;                 // scope 0 at $DIR/loop_test.rs:10:8: 10:12\n-        FakeRead(ForMatchedPlace, _2);   // scope 0 at $DIR/loop_test.rs:10:8: 10:12\n-        switchInt(_2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/loop_test.rs:10:5: 12:6\n+        switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/loop_test.rs:10:5: 12:6\n     }\n \n     bb1: {\n-        falseEdge -> [real: bb3, imaginary: bb2]; // scope 0 at $DIR/loop_test.rs:10:5: 12:6\n+        _0 = const ();                   // scope 0 at $DIR/loop_test.rs:11:9: 11:15\n+        StorageDead(_2);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n+        StorageDead(_1);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n+        return;                          // scope 0 at $DIR/loop_test.rs:17:2: 17:2\n     }\n \n     bb2: {\n         _1 = const ();                   // scope 0 at $DIR/loop_test.rs:12:6: 12:6\n         StorageDead(_2);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n         StorageDead(_1);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n         StorageLive(_4);                 // scope 0 at $DIR/loop_test.rs:13:5: 16:6\n-        goto -> bb4;                     // scope 0 at $DIR/loop_test.rs:13:5: 16:6\n+        goto -> bb3;                     // scope 0 at $DIR/loop_test.rs:13:5: 16:6\n     }\n \n     bb3: {\n-        _0 = const ();                   // scope 0 at $DIR/loop_test.rs:11:9: 11:15\n-        StorageDead(_2);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n-        StorageDead(_1);                 // scope 0 at $DIR/loop_test.rs:12:5: 12:6\n-        return;                          // scope 0 at $DIR/loop_test.rs:17:2: 17:2\n+        falseUnwind -> [real: bb4, cleanup: bb5]; // scope 0 at $DIR/loop_test.rs:13:5: 16:6\n     }\n \n     bb4: {\n-        falseUnwind -> [real: bb5, cleanup: bb6]; // scope 0 at $DIR/loop_test.rs:13:5: 16:6\n-    }\n-\n-    bb5: {\n         StorageLive(_6);                 // scope 0 at $DIR/loop_test.rs:14:13: 14:14\n         _6 = const 1_i32;                // scope 0 at $DIR/loop_test.rs:14:17: 14:18\n         FakeRead(ForLet, _6);            // scope 0 at $DIR/loop_test.rs:14:13: 14:14\n         StorageDead(_6);                 // scope 0 at $DIR/loop_test.rs:16:5: 16:6\n-        goto -> bb4;                     // scope 0 at $DIR/loop_test.rs:1:1: 1:1\n+        goto -> bb3;                     // scope 0 at $DIR/loop_test.rs:1:1: 1:1\n     }\n \n-    bb6 (cleanup): {\n+    bb5 (cleanup): {\n         resume;                          // scope 0 at $DIR/loop_test.rs:6:1: 17:2\n     }\n }"}, {"sha": "740a6e0edb0c4c132425de3fc5756eb5f68bac2f", "filename": "src/test/mir-opt/lower_intrinsics.f_u64.PreCodegen.before.mir", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Flower_intrinsics.f_u64.PreCodegen.before.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Flower_intrinsics.f_u64.PreCodegen.before.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Flower_intrinsics.f_u64.PreCodegen.before.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -3,24 +3,28 @@\n fn f_u64() -> () {\n     let mut _0: ();                      // return place in scope 0 at $DIR/lower_intrinsics.rs:34:16: 34:16\n     scope 1 (inlined f_dispatch::<u64>) { // at $DIR/lower_intrinsics.rs:35:5: 35:21\n-        debug t => _2;                   // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n-        let _1: ();                      // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n-        let mut _2: u64;                 // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        debug t => _1;                   // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        let mut _1: u64;                 // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        let _2: ();                      // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        let mut _3: u64;                 // in scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n         scope 2 (inlined std::mem::size_of::<u64>) { // at $DIR/lower_intrinsics.rs:35:5: 35:21\n         }\n     }\n \n     bb0: {\n-        _2 = const 0_u64;                // scope 0 at $DIR/lower_intrinsics.rs:35:5: 35:21\n-        StorageLive(_1);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n-        _1 = f_non_zst::<u64>(move _2) -> bb1; // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        _1 = const 0_u64;                // scope 0 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        StorageLive(_2);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        StorageLive(_3);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        _3 = move _1;                    // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        _2 = f_non_zst::<u64>(move _3) -> bb1; // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n                                          // mir::Constant\n                                          // + span: $DIR/lower_intrinsics.rs:35:5: 35:21\n                                          // + literal: Const { ty: fn(u64) {f_non_zst::<u64>}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb1: {\n-        StorageDead(_1);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        StorageDead(_3);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n+        StorageDead(_2);                 // scope 1 at $DIR/lower_intrinsics.rs:35:5: 35:21\n         _0 = const ();                   // scope 0 at $DIR/lower_intrinsics.rs:34:16: 36:2\n         return;                          // scope 0 at $DIR/lower_intrinsics.rs:36:2: 36:2\n     }"}, {"sha": "95beab2ec9af75b6859a6b044330fc8ddc81ea3a", "filename": "src/test/mir-opt/match_arm_scopes.complicated_match.SimplifyCfg-initial.after-ElaborateDrops.after.diff", "status": "modified", "additions": 46, "deletions": 56, "changes": 102, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatch_arm_scopes.complicated_match.SimplifyCfg-initial.after-ElaborateDrops.after.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatch_arm_scopes.complicated_match.SimplifyCfg-initial.after-ElaborateDrops.after.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatch_arm_scopes.complicated_match.SimplifyCfg-initial.after-ElaborateDrops.after.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -47,30 +47,30 @@\n       }\n   \n       bb3: {\n--         falseEdge -> [real: bb14, imaginary: bb5]; // scope 0 at $DIR/match-arm-scopes.rs:15:25: 15:38\n+-         falseEdge -> [real: bb13, imaginary: bb5]; // scope 0 at $DIR/match-arm-scopes.rs:15:25: 15:38\n -     }\n - \n -     bb4: {\n -         switchInt((_2.0: bool)) -> [false: bb6, otherwise: bb5]; // scope 0 at $DIR/match-arm-scopes.rs:16:10: 16:14\n -     }\n - \n -     bb5: {\n--         falseEdge -> [real: bb22, imaginary: bb6]; // scope 0 at $DIR/match-arm-scopes.rs:16:9: 16:21\n+-         falseEdge -> [real: bb20, imaginary: bb6]; // scope 0 at $DIR/match-arm-scopes.rs:16:9: 16:21\n -     }\n - \n -     bb6: {\n           StorageLive(_15);                // scope 0 at $DIR/match-arm-scopes.rs:16:32: 16:33\n           _15 = (_2.1: bool);              // scope 0 at $DIR/match-arm-scopes.rs:16:32: 16:33\n           StorageLive(_16);                // scope 0 at $DIR/match-arm-scopes.rs:16:35: 16:36\n           _16 = move (_2.2: std::string::String); // scope 0 at $DIR/match-arm-scopes.rs:16:35: 16:36\n--         goto -> bb21;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n+-         goto -> bb19;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n +         goto -> bb16;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n -     bb7: {\n +     bb4: {\n           _0 = const 1_i32;                // scope 1 at $DIR/match-arm-scopes.rs:15:77: 15:78\n--         drop(_7) -> [return: bb20, unwind: bb27]; // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n+-         drop(_7) -> [return: bb18, unwind: bb25]; // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n +         drop(_7) -> [return: bb15, unwind: bb22]; // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n       }\n   \n@@ -85,33 +85,28 @@\n           StorageLive(_9);                 // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n           StorageLive(_10);                // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n           _10 = _1;                        // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n--         FakeRead(ForMatchedPlace, _10);  // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n--         switchInt(_10) -> [false: bb10, otherwise: bb9]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n-+         switchInt(_10) -> [false: bb6, otherwise: bb7]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n+-         switchInt(move _10) -> [false: bb10, otherwise: bb9]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n++         switchInt(move _10) -> [false: bb7, otherwise: bb6]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n -     bb9: {\n--         falseEdge -> [real: bb11, imaginary: bb10]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n--     }\n-- \n--     bb10: {\n +     bb6: {\n-          _9 = (*_6);                      // scope 0 at $DIR/match-arm-scopes.rs:15:70: 15:71\n+          _0 = const 3_i32;                // scope 0 at $DIR/match-arm-scopes.rs:15:59: 15:60\n           StorageDead(_10);                // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n--         switchInt(move _9) -> [false: bb13, otherwise: bb12]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n-+         switchInt(move _9) -> [false: bb9, otherwise: bb8]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n+          StorageDead(_9);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n+-         goto -> bb23;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n++         goto -> bb20;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n       }\n   \n--     bb11: {\n+-     bb10: {\n +     bb7: {\n-          _0 = const 3_i32;                // scope 0 at $DIR/match-arm-scopes.rs:15:59: 15:60\n+          _9 = (*_6);                      // scope 0 at $DIR/match-arm-scopes.rs:15:70: 15:71\n           StorageDead(_10);                // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n-          StorageDead(_9);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n--         goto -> bb25;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n-+         goto -> bb20;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n+-         switchInt(move _9) -> [false: bb12, otherwise: bb11]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n++         switchInt(move _9) -> [false: bb9, otherwise: bb8]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n--     bb12: {\n+-     bb11: {\n +     bb8: {\n           StorageDead(_9);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n -         FakeRead(ForMatchGuard, _3);     // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n@@ -126,7 +121,7 @@\n +         goto -> bb4;                     // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n--     bb13: {\n+-     bb12: {\n +     bb9: {\n           StorageDead(_9);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_8);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n@@ -135,7 +130,7 @@\n +         goto -> bb1;                     // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n--     bb14: {\n+-     bb13: {\n +     bb10: {\n           StorageLive(_6);                 // scope 0 at $DIR/match-arm-scopes.rs:15:26: 15:27\n           _6 = &(_2.0: bool);              // scope 0 at $DIR/match-arm-scopes.rs:15:26: 15:27\n@@ -146,33 +141,28 @@\n           StorageLive(_12);                // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n           StorageLive(_13);                // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n           _13 = _1;                        // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n--         FakeRead(ForMatchedPlace, _13);  // scope 0 at $DIR/match-arm-scopes.rs:15:45: 15:49\n--         switchInt(_13) -> [false: bb16, otherwise: bb15]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n-+         switchInt(_13) -> [false: bb11, otherwise: bb12]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n+-         switchInt(move _13) -> [false: bb15, otherwise: bb14]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n++         switchInt(move _13) -> [false: bb12, otherwise: bb11]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n--     bb15: {\n--         falseEdge -> [real: bb17, imaginary: bb16]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n--     }\n-- \n--     bb16: {\n+-     bb14: {\n +     bb11: {\n-          _12 = (*_6);                     // scope 0 at $DIR/match-arm-scopes.rs:15:70: 15:71\n+          _0 = const 3_i32;                // scope 0 at $DIR/match-arm-scopes.rs:15:59: 15:60\n           StorageDead(_13);                // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n--         switchInt(move _12) -> [false: bb19, otherwise: bb18]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n-+         switchInt(move _12) -> [false: bb14, otherwise: bb13]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n+          StorageDead(_12);                // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n+-         goto -> bb23;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n++         goto -> bb20;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n       }\n   \n--     bb17: {\n+-     bb15: {\n +     bb12: {\n-          _0 = const 3_i32;                // scope 0 at $DIR/match-arm-scopes.rs:15:59: 15:60\n+          _12 = (*_6);                     // scope 0 at $DIR/match-arm-scopes.rs:15:70: 15:71\n           StorageDead(_13);                // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n-          StorageDead(_12);                // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n--         goto -> bb25;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n-+         goto -> bb20;                    // scope 0 at $DIR/match-arm-scopes.rs:1:1: 1:1\n+-         switchInt(move _12) -> [false: bb17, otherwise: bb16]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n++         switchInt(move _12) -> [false: bb14, otherwise: bb13]; // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n--     bb18: {\n+-     bb16: {\n +     bb13: {\n           StorageDead(_12);                // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n -         FakeRead(ForMatchGuard, _3);     // scope 0 at $DIR/match-arm-scopes.rs:15:72: 15:73\n@@ -187,7 +177,7 @@\n +         goto -> bb4;                     // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n--     bb19: {\n+-     bb17: {\n +     bb14: {\n           StorageDead(_12);                // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_8);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n@@ -196,67 +186,67 @@\n +         goto -> bb2;                     // scope 0 at $DIR/match-arm-scopes.rs:15:42: 15:73\n       }\n   \n--     bb20: {\n+-     bb18: {\n +     bb15: {\n           StorageDead(_7);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_5);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_8);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_6);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n--         goto -> bb24;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n+-         goto -> bb22;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n +         goto -> bb19;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n--     bb21: {\n+-     bb19: {\n +     bb16: {\n           _0 = const 2_i32;                // scope 2 at $DIR/match-arm-scopes.rs:16:41: 16:42\n--         drop(_16) -> [return: bb23, unwind: bb27]; // scope 0 at $DIR/match-arm-scopes.rs:16:41: 16:42\n+-         drop(_16) -> [return: bb21, unwind: bb25]; // scope 0 at $DIR/match-arm-scopes.rs:16:41: 16:42\n +         drop(_16) -> [return: bb18, unwind: bb22]; // scope 0 at $DIR/match-arm-scopes.rs:16:41: 16:42\n       }\n   \n--     bb22: {\n+-     bb20: {\n +     bb17: {\n           StorageLive(_15);                // scope 0 at $DIR/match-arm-scopes.rs:16:16: 16:17\n           _15 = (_2.1: bool);              // scope 0 at $DIR/match-arm-scopes.rs:16:16: 16:17\n           StorageLive(_16);                // scope 0 at $DIR/match-arm-scopes.rs:16:19: 16:20\n           _16 = move (_2.2: std::string::String); // scope 0 at $DIR/match-arm-scopes.rs:16:19: 16:20\n--         goto -> bb21;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n+-         goto -> bb19;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n +         goto -> bb16;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n--     bb23: {\n+-     bb21: {\n +     bb18: {\n           StorageDead(_16);                // scope 0 at $DIR/match-arm-scopes.rs:16:41: 16:42\n           StorageDead(_15);                // scope 0 at $DIR/match-arm-scopes.rs:16:41: 16:42\n--         goto -> bb24;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n+-         goto -> bb22;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n +         goto -> bb19;                    // scope 0 at $DIR/match-arm-scopes.rs:14:5: 17:6\n       }\n   \n--     bb24: {\n--         drop(_2) -> [return: bb26, unwind: bb28]; // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n+-     bb22: {\n+-         drop(_2) -> [return: bb24, unwind: bb26]; // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n +     bb19: {\n +         goto -> bb26;                    // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n       }\n   \n--     bb25: {\n+-     bb23: {\n +     bb20: {\n           StorageDead(_8);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n           StorageDead(_6);                 // scope 0 at $DIR/match-arm-scopes.rs:15:77: 15:78\n--         drop(_2) -> [return: bb26, unwind: bb28]; // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n+-         drop(_2) -> [return: bb24, unwind: bb26]; // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n +         drop(_2) -> [return: bb21, unwind: bb23]; // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n       }\n   \n--     bb26: {\n+-     bb24: {\n +     bb21: {\n           return;                          // scope 0 at $DIR/match-arm-scopes.rs:18:2: 18:2\n       }\n   \n--     bb27 (cleanup): {\n--         drop(_2) -> bb28;                // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n+-     bb25 (cleanup): {\n+-         drop(_2) -> bb26;                // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n +     bb22 (cleanup): {\n +         goto -> bb27;                    // scope 0 at $DIR/match-arm-scopes.rs:18:1: 18:2\n       }\n   \n--     bb28 (cleanup): {\n+-     bb26 (cleanup): {\n +     bb23 (cleanup): {\n           resume;                          // scope 0 at $DIR/match-arm-scopes.rs:13:1: 18:2\n +     }"}, {"sha": "20240348230f227ba0f616e263ce461e859c8140", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -30,7 +30,7 @@\n       }\n   \n       bb3: {\n-          switchInt(_2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+          switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n       bb4: {\n@@ -39,7 +39,7 @@\n       }\n   \n       bb5: {\n-          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:10:1: 10:2\n+          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:9:5: 9:6\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:10:2: 10:2\n       }\n   }"}, {"sha": "20240348230f227ba0f616e263ce461e859c8140", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -30,7 +30,7 @@\n       }\n   \n       bb3: {\n-          switchInt(_2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+          switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n       bb4: {\n@@ -39,7 +39,7 @@\n       }\n   \n       bb5: {\n-          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:10:1: 10:2\n+          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:9:5: 9:6\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:10:2: 10:2\n       }\n   }"}, {"sha": "1d895852354c9da86b1dbed8acc0ca486f29885a", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -25,9 +25,9 @@\n           StorageLive(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n           StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n           _6 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n--         switchInt(_6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-         switchInt(move _6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-+         _7 = _6;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n++         _7 = move _6;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _5 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n +         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n@@ -45,41 +45,41 @@\n   \n       bb3: {\n           StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:47: 40:48\n--         switchInt(_5) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-         switchInt(move _5) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         StorageLive(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-+         _8 = _5;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n++         _8 = move _5;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _4 = Ne(_8, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n +         StorageDead(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb4: {\n-          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n+          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n           goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb5: {\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n+          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n           goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb6: {\n           StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:67: 40:68\n--         switchInt(_4) -> [false: bb7, otherwise: bb8]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-         switchInt(move _4) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         StorageLive(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         _9 = _4;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n++         _9 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _3 = Ne(_9, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n +         StorageDead(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   \n       bb7: {\n-          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n+          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n           goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   \n       bb8: {\n-          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n+          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n           goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   "}, {"sha": "1d895852354c9da86b1dbed8acc0ca486f29885a", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -25,9 +25,9 @@\n           StorageLive(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n           StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n           _6 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n--         switchInt(_6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-         switchInt(move _6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-+         _7 = _6;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n++         _7 = move _6;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _5 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n +         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n@@ -45,41 +45,41 @@\n   \n       bb3: {\n           StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:47: 40:48\n--         switchInt(_5) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-         switchInt(move _5) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         StorageLive(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-+         _8 = _5;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n++         _8 = move _5;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _4 = Ne(_8, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n +         StorageDead(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb4: {\n-          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n+          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n           goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb5: {\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n+          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n           goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n       }\n   \n       bb6: {\n           StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:67: 40:68\n--         switchInt(_4) -> [false: bb7, otherwise: bb8]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-         switchInt(move _4) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         StorageLive(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         _9 = _4;                         // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n++         _9 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _3 = Ne(_9, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n +         StorageDead(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   \n       bb7: {\n-          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n+          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n           goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   \n       bb8: {\n-          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n+          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n           goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n       }\n   "}, {"sha": "fb25cb90021f3b302aa01084d8b7de39b3c85c3c", "filename": "src/test/mir-opt/multiple_return_terminators.test.MultipleReturnTerminators.diff", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmultiple_return_terminators.test.MultipleReturnTerminators.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fmultiple_return_terminators.test.MultipleReturnTerminators.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmultiple_return_terminators.test.MultipleReturnTerminators.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -9,21 +9,21 @@\n       bb0: {\n           StorageLive(_2);                 // scope 0 at $DIR/multiple_return_terminators.rs:5:8: 5:9\n           _2 = _1;                         // scope 0 at $DIR/multiple_return_terminators.rs:5:8: 5:9\n-          switchInt(_2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/multiple_return_terminators.rs:5:5: 9:6\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/multiple_return_terminators.rs:5:5: 9:6\n       }\n   \n       bb1: {\n-          _0 = const ();                   // scope 0 at $DIR/multiple_return_terminators.rs:7:12: 9:6\n+          _0 = const ();                   // scope 0 at $DIR/multiple_return_terminators.rs:5:10: 7:6\n           goto -> bb3;                     // scope 0 at $DIR/multiple_return_terminators.rs:5:5: 9:6\n       }\n   \n       bb2: {\n-          _0 = const ();                   // scope 0 at $DIR/multiple_return_terminators.rs:5:10: 7:6\n+          _0 = const ();                   // scope 0 at $DIR/multiple_return_terminators.rs:7:12: 9:6\n           goto -> bb3;                     // scope 0 at $DIR/multiple_return_terminators.rs:5:5: 9:6\n       }\n   \n       bb3: {\n-          StorageDead(_2);                 // scope 0 at $DIR/multiple_return_terminators.rs:10:1: 10:2\n+          StorageDead(_2);                 // scope 0 at $DIR/multiple_return_terminators.rs:9:5: 9:6\n           return;                          // scope 0 at $DIR/multiple_return_terminators.rs:10:2: 10:2\n       }\n   }"}, {"sha": "8c939d5fc3da5fa37a924b6c349886de23ee49a3", "filename": "src/test/mir-opt/nll/region_subtyping_basic.main.nll.0.32bit.mir", "status": "modified", "additions": 33, "deletions": 38, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.32bit.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.32bit.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.32bit.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -5,19 +5,19 @@\n | '_#1r | Local | ['_#1r]\n |\n | Inferred Region Values\n-| '_#0r | U0 | {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0], '_#0r, '_#1r}\n-| '_#1r | U0 | {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0], '_#1r}\n+| '_#0r | U0 | {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0], '_#0r, '_#1r}\n+| '_#1r | U0 | {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0], '_#1r}\n | '_#2r | U0 | {}\n-| '_#3r | U0 | {bb1[0..=8], bb2[0], bb4[0..=2]}\n-| '_#4r | U0 | {bb1[1..=8], bb2[0], bb4[0..=2]}\n-| '_#5r | U0 | {bb1[4..=8], bb2[0], bb4[0..=2]}\n+| '_#3r | U0 | {bb1[0..=7], bb2[0..=2]}\n+| '_#4r | U0 | {bb1[1..=7], bb2[0..=2]}\n+| '_#5r | U0 | {bb1[4..=7], bb2[0..=2]}\n |\n | Inference Constraints\n-| '_#0r live at {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0]}\n-| '_#1r live at {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0]}\n+| '_#0r live at {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0]}\n+| '_#1r live at {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0]}\n | '_#3r live at {bb1[0]}\n | '_#4r live at {bb1[1..=3]}\n-| '_#5r live at {bb1[4..=8], bb2[0], bb4[0..=2]}\n+| '_#5r live at {bb1[4..=7], bb2[0..=2]}\n | '_#3r: '_#4r due to Assignment at Single(bb1[0])\n | '_#4r: '_#5r due to Assignment at Single(bb1[3])\n |\n@@ -52,7 +52,7 @@ fn main() -> () {\n         _3 = const Const(Value(Scalar(0x00000000)): usize); // bb0[5]: scope 1 at $DIR/region-subtyping-basic.rs:18:16: 18:17\n         _4 = Len(_1);                    // bb0[6]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n         _5 = Lt(_3, _4);                 // bb0[7]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n-        assert(move _5, \"index out of bounds: the length is {} but the index is {}\", move _4, _3) -> [success: bb1, unwind: bb8]; // bb0[8]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n+        assert(move _5, \"index out of bounds: the length is {} but the index is {}\", move _4, _3) -> [success: bb1, unwind: bb7]; // bb0[8]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n     }\n \n     bb1: {\n@@ -63,55 +63,50 @@ fn main() -> () {\n         FakeRead(ForLet, _6);            // bb1[4]: scope 2 at $DIR/region-subtyping-basic.rs:19:9: 19:10\n         StorageLive(_7);                 // bb1[5]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n         _7 = const Const(Value(Scalar(0x01)): bool); // bb1[6]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n-        FakeRead(ForMatchedPlace, _7);   // bb1[7]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n-        switchInt(_7) -> [Const(Value(Scalar(0x00)): bool): bb3, otherwise: bb2]; // bb1[8]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        switchInt(move _7) -> [Const(Value(Scalar(0x00)): bool): bb3, otherwise: bb2]; // bb1[7]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb2: {\n-        falseEdge -> [real: bb4, imaginary: bb3]; // bb2[0]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        StorageLive(_8);                 // bb2[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n+        StorageLive(_9);                 // bb2[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n+        _9 = (*_6);                      // bb2[2]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n+        _8 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(move _9) -> [return: bb4, unwind: bb7]; // bb2[3]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n+                                         // mir::Constant\n+                                         // + span: $DIR/region-subtyping-basic.rs:21:9: 21:14\n+                                         // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb3: {\n         StorageLive(_10);                // bb3[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n-        _10 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(const Const(Value(Scalar(0x00000016)): usize)) -> [return: bb6, unwind: bb8]; // bb3[1]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n+        _10 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(const Const(Value(Scalar(0x00000016)): usize)) -> [return: bb5, unwind: bb7]; // bb3[1]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n                                          // mir::Constant\n                                          // + span: $DIR/region-subtyping-basic.rs:23:9: 23:14\n                                          // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb4: {\n-        StorageLive(_8);                 // bb4[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n-        StorageLive(_9);                 // bb4[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n-        _9 = (*_6);                      // bb4[2]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n-        _8 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(move _9) -> [return: bb5, unwind: bb8]; // bb4[3]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n-                                         // mir::Constant\n-                                         // + span: $DIR/region-subtyping-basic.rs:21:9: 21:14\n-                                         // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n+        StorageDead(_9);                 // bb4[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:17: 21:18\n+        StorageDead(_8);                 // bb4[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:18: 21:19\n+        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb4[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:13: 22:6\n+        goto -> bb6;                     // bb4[3]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb5: {\n-        StorageDead(_9);                 // bb5[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:17: 21:18\n-        StorageDead(_8);                 // bb5[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:18: 21:19\n-        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb5[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:13: 22:6\n-        goto -> bb7;                     // bb5[3]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        StorageDead(_10);                // bb5[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:18: 23:19\n+        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb5[1]: scope 3 at $DIR/region-subtyping-basic.rs:22:12: 24:6\n+        goto -> bb6;                     // bb5[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb6: {\n-        StorageDead(_10);                // bb6[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:18: 23:19\n-        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb6[1]: scope 3 at $DIR/region-subtyping-basic.rs:22:12: 24:6\n-        goto -> bb7;                     // bb6[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n-    }\n-\n-    bb7: {\n-        StorageDead(_6);                 // bb7[0]: scope 2 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_3);                 // bb7[1]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_2);                 // bb7[2]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_1);                 // bb7[3]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_7);                 // bb7[4]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        return;                          // bb7[5]: scope 0 at $DIR/region-subtyping-basic.rs:25:2: 25:2\n+        StorageDead(_7);                 // bb6[0]: scope 3 at $DIR/region-subtyping-basic.rs:24:5: 24:6\n+        StorageDead(_6);                 // bb6[1]: scope 2 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_3);                 // bb6[2]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_2);                 // bb6[3]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_1);                 // bb6[4]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        return;                          // bb6[5]: scope 0 at $DIR/region-subtyping-basic.rs:25:2: 25:2\n     }\n \n-    bb8 (cleanup): {\n-        resume;                          // bb8[0]: scope 0 at $DIR/region-subtyping-basic.rs:16:1: 25:2\n+    bb7 (cleanup): {\n+        resume;                          // bb7[0]: scope 0 at $DIR/region-subtyping-basic.rs:16:1: 25:2\n     }\n }"}, {"sha": "00704baa6c19fbb9932bbc3b06143e50feafa7aa", "filename": "src/test/mir-opt/nll/region_subtyping_basic.main.nll.0.64bit.mir", "status": "modified", "additions": 33, "deletions": 38, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.64bit.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.64bit.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fnll%2Fregion_subtyping_basic.main.nll.0.64bit.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -5,19 +5,19 @@\n | '_#1r | Local | ['_#1r]\n |\n | Inferred Region Values\n-| '_#0r | U0 | {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0], '_#0r, '_#1r}\n-| '_#1r | U0 | {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0], '_#1r}\n+| '_#0r | U0 | {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0], '_#0r, '_#1r}\n+| '_#1r | U0 | {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0], '_#1r}\n | '_#2r | U0 | {}\n-| '_#3r | U0 | {bb1[0..=8], bb2[0], bb4[0..=2]}\n-| '_#4r | U0 | {bb1[1..=8], bb2[0], bb4[0..=2]}\n-| '_#5r | U0 | {bb1[4..=8], bb2[0], bb4[0..=2]}\n+| '_#3r | U0 | {bb1[0..=7], bb2[0..=2]}\n+| '_#4r | U0 | {bb1[1..=7], bb2[0..=2]}\n+| '_#5r | U0 | {bb1[4..=7], bb2[0..=2]}\n |\n | Inference Constraints\n-| '_#0r live at {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0]}\n-| '_#1r live at {bb0[0..=8], bb1[0..=8], bb2[0], bb3[0..=1], bb4[0..=3], bb5[0..=3], bb6[0..=2], bb7[0..=5], bb8[0]}\n+| '_#0r live at {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0]}\n+| '_#1r live at {bb0[0..=8], bb1[0..=7], bb2[0..=3], bb3[0..=1], bb4[0..=3], bb5[0..=2], bb6[0..=5], bb7[0]}\n | '_#3r live at {bb1[0]}\n | '_#4r live at {bb1[1..=3]}\n-| '_#5r live at {bb1[4..=8], bb2[0], bb4[0..=2]}\n+| '_#5r live at {bb1[4..=7], bb2[0..=2]}\n | '_#3r: '_#4r due to Assignment at Single(bb1[0])\n | '_#4r: '_#5r due to Assignment at Single(bb1[3])\n |\n@@ -52,7 +52,7 @@ fn main() -> () {\n         _3 = const Const(Value(Scalar(0x0000000000000000)): usize); // bb0[5]: scope 1 at $DIR/region-subtyping-basic.rs:18:16: 18:17\n         _4 = Len(_1);                    // bb0[6]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n         _5 = Lt(_3, _4);                 // bb0[7]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n-        assert(move _5, \"index out of bounds: the length is {} but the index is {}\", move _4, _3) -> [success: bb1, unwind: bb8]; // bb0[8]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n+        assert(move _5, \"index out of bounds: the length is {} but the index is {}\", move _4, _3) -> [success: bb1, unwind: bb7]; // bb0[8]: scope 1 at $DIR/region-subtyping-basic.rs:18:14: 18:18\n     }\n \n     bb1: {\n@@ -63,55 +63,50 @@ fn main() -> () {\n         FakeRead(ForLet, _6);            // bb1[4]: scope 2 at $DIR/region-subtyping-basic.rs:19:9: 19:10\n         StorageLive(_7);                 // bb1[5]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n         _7 = const Const(Value(Scalar(0x01)): bool); // bb1[6]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n-        FakeRead(ForMatchedPlace, _7);   // bb1[7]: scope 3 at $DIR/region-subtyping-basic.rs:20:8: 20:12\n-        switchInt(_7) -> [Const(Value(Scalar(0x00)): bool): bb3, otherwise: bb2]; // bb1[8]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        switchInt(move _7) -> [Const(Value(Scalar(0x00)): bool): bb3, otherwise: bb2]; // bb1[7]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb2: {\n-        falseEdge -> [real: bb4, imaginary: bb3]; // bb2[0]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        StorageLive(_8);                 // bb2[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n+        StorageLive(_9);                 // bb2[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n+        _9 = (*_6);                      // bb2[2]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n+        _8 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(move _9) -> [return: bb4, unwind: bb7]; // bb2[3]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n+                                         // mir::Constant\n+                                         // + span: $DIR/region-subtyping-basic.rs:21:9: 21:14\n+                                         // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb3: {\n         StorageLive(_10);                // bb3[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n-        _10 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(const Const(Value(Scalar(0x0000000000000016)): usize)) -> [return: bb6, unwind: bb8]; // bb3[1]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n+        _10 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(const Const(Value(Scalar(0x0000000000000016)): usize)) -> [return: bb5, unwind: bb7]; // bb3[1]: scope 3 at $DIR/region-subtyping-basic.rs:23:9: 23:18\n                                          // mir::Constant\n                                          // + span: $DIR/region-subtyping-basic.rs:23:9: 23:14\n                                          // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb4: {\n-        StorageLive(_8);                 // bb4[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n-        StorageLive(_9);                 // bb4[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n-        _9 = (*_6);                      // bb4[2]: scope 3 at $DIR/region-subtyping-basic.rs:21:15: 21:17\n-        _8 = Const(Value(Scalar(<ZST>)): fn(usize) -> bool {use_x})(move _9) -> [return: bb5, unwind: bb8]; // bb4[3]: scope 3 at $DIR/region-subtyping-basic.rs:21:9: 21:18\n-                                         // mir::Constant\n-                                         // + span: $DIR/region-subtyping-basic.rs:21:9: 21:14\n-                                         // + literal: Const { ty: fn(usize) -> bool {use_x}, val: Value(Scalar(<ZST>)) }\n+        StorageDead(_9);                 // bb4[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:17: 21:18\n+        StorageDead(_8);                 // bb4[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:18: 21:19\n+        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb4[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:13: 22:6\n+        goto -> bb6;                     // bb4[3]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb5: {\n-        StorageDead(_9);                 // bb5[0]: scope 3 at $DIR/region-subtyping-basic.rs:21:17: 21:18\n-        StorageDead(_8);                 // bb5[1]: scope 3 at $DIR/region-subtyping-basic.rs:21:18: 21:19\n-        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb5[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:13: 22:6\n-        goto -> bb7;                     // bb5[3]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n+        StorageDead(_10);                // bb5[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:18: 23:19\n+        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb5[1]: scope 3 at $DIR/region-subtyping-basic.rs:22:12: 24:6\n+        goto -> bb6;                     // bb5[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n     }\n \n     bb6: {\n-        StorageDead(_10);                // bb6[0]: scope 3 at $DIR/region-subtyping-basic.rs:23:18: 23:19\n-        _0 = const Const(Value(Scalar(<ZST>)): ()); // bb6[1]: scope 3 at $DIR/region-subtyping-basic.rs:22:12: 24:6\n-        goto -> bb7;                     // bb6[2]: scope 3 at $DIR/region-subtyping-basic.rs:20:5: 24:6\n-    }\n-\n-    bb7: {\n-        StorageDead(_6);                 // bb7[0]: scope 2 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_3);                 // bb7[1]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_2);                 // bb7[2]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_1);                 // bb7[3]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        StorageDead(_7);                 // bb7[4]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n-        return;                          // bb7[5]: scope 0 at $DIR/region-subtyping-basic.rs:25:2: 25:2\n+        StorageDead(_7);                 // bb6[0]: scope 3 at $DIR/region-subtyping-basic.rs:24:5: 24:6\n+        StorageDead(_6);                 // bb6[1]: scope 2 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_3);                 // bb6[2]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_2);                 // bb6[3]: scope 1 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        StorageDead(_1);                 // bb6[4]: scope 0 at $DIR/region-subtyping-basic.rs:25:1: 25:2\n+        return;                          // bb6[5]: scope 0 at $DIR/region-subtyping-basic.rs:25:2: 25:2\n     }\n \n-    bb8 (cleanup): {\n-        resume;                          // bb8[0]: scope 0 at $DIR/region-subtyping-basic.rs:16:1: 25:2\n+    bb7 (cleanup): {\n+        resume;                          // bb7[0]: scope 0 at $DIR/region-subtyping-basic.rs:16:1: 25:2\n     }\n }"}, {"sha": "52e705fdbeba8eeeefd14a0364c91f885ca029d3", "filename": "src/test/mir-opt/simplify_cfg.main.SimplifyCfg-early-opt.diff", "status": "modified", "additions": 10, "deletions": 15, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -21,31 +21,26 @@\n       }\n   \n -     bb2: {\n--         nop;                             // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n--         switchInt(_2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+-         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n +     bb1: {\n-+         switchInt(_2) -> [false: bb2, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n++         switchInt(move _2) -> [false: bb3, otherwise: bb2]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n       }\n   \n -     bb3: {\n--         goto -> bb5;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n--     }\n-- \n--     bb4: {\n +     bb2: {\n-          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:9:10: 9:10\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:10:5: 10:6\n-          goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n+          return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n       }\n   \n--     bb5: {\n+-     bb4: {\n +     bb3: {\n-          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:10:5: 10:6\n-          return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n+          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:9:10: 9:10\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n+          goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n -     }\n - \n--     bb6 (cleanup): {\n+-     bb5 (cleanup): {\n -         resume;                          // scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n       }\n   }"}, {"sha": "fef3ae2e461d8304dd31813a7ab0ed8b094e587a", "filename": "src/test/mir-opt/simplify_cfg.main.SimplifyCfg-initial.diff", "status": "modified", "additions": 24, "deletions": 30, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -9,69 +9,63 @@\n   \n       bb0: {\n -         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n-+         falseUnwind -> [real: bb1, cleanup: bb6]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n++         falseUnwind -> [real: bb1, cleanup: bb5]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n       }\n   \n       bb1: {\n--         falseUnwind -> [real: bb2, cleanup: bb11]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+-         falseUnwind -> [real: bb2, cleanup: bb10]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n -     }\n - \n -     bb2: {\n           StorageLive(_2);                 // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n--         _2 = bar() -> [return: bb3, unwind: bb11]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n-+         _2 = bar() -> [return: bb2, unwind: bb6]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n+-         _2 = bar() -> [return: bb3, unwind: bb10]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n++         _2 = bar() -> [return: bb2, unwind: bb5]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n                                            // mir::Constant\n                                            // + span: $DIR/simplify_cfg.rs:7:12: 7:15\n                                            // + literal: Const { ty: fn() -> bool {bar}, val: Value(Scalar(<ZST>)) }\n       }\n   \n -     bb3: {\n+-         switchInt(move _2) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n +     bb2: {\n-          FakeRead(ForMatchedPlace, _2);   // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n--         switchInt(_2) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n-+         switchInt(_2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n++         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n       }\n   \n -     bb4: {\n--         falseEdge -> [real: bb6, imaginary: bb5]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n +     bb3: {\n-+         falseEdge -> [real: bb5, imaginary: bb4]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n+-         goto -> bb9;                     // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n++         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n++         return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n       }\n   \n -     bb5: {\n +     bb4: {\n           _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:9:10: 9:10\n--         goto -> bb9;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n-+         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:10:5: 10:6\n-+         goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n-      }\n-  \n--     bb6: {\n-+     bb5: {\n-          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n--         goto -> bb10;                    // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n+-         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n -     }\n - \n--     bb7: {\n+-     bb6: {\n -         unreachable;                     // scope 0 at $DIR/simplify_cfg.rs:7:18: 9:10\n -     }\n - \n--     bb8: {\n--         goto -> bb9;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+-     bb7: {\n+-         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n -     }\n - \n--     bb9: {\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:10:5: 10:6\n+-     bb8: {\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n -         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n--     }\n-- \n--     bb10: {\n--         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:10:5: 10:6\n-          return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n++         goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n       }\n   \n--     bb11 (cleanup): {\n-+     bb6 (cleanup): {\n+-     bb9: {\n+-         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n+-         return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n+-     }\n+- \n+-     bb10 (cleanup): {\n++     bb5 (cleanup): {\n           resume;                          // scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n       }\n   }"}, {"sha": "2cd57cb8474ecfd203861a66e2424597ce317c1d", "filename": "src/test/mir-opt/simplify_if.main.SimplifyBranches-after-const-prop.diff", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_if.main.SimplifyBranches-after-const-prop.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_if.main.SimplifyBranches-after-const-prop.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_if.main.SimplifyBranches-after-const-prop.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -9,31 +9,31 @@\n       bb0: {\n           StorageLive(_1);                 // scope 0 at $DIR/simplify_if.rs:6:8: 6:13\n           _1 = const false;                // scope 0 at $DIR/simplify_if.rs:6:8: 6:13\n--         switchInt(const false) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n-+         goto -> bb1;                     // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n+-         switchInt(const false) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n++         goto -> bb2;                     // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n       }\n   \n       bb1: {\n-          _0 = const ();                   // scope 0 at $DIR/simplify_if.rs:8:6: 8:6\n-          goto -> bb4;                     // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n-      }\n-  \n-      bb2: {\n           StorageLive(_2);                 // scope 0 at $DIR/simplify_if.rs:7:9: 7:15\n           _2 = noop() -> bb3;              // scope 0 at $DIR/simplify_if.rs:7:9: 7:15\n                                            // mir::Constant\n                                            // + span: $DIR/simplify_if.rs:7:9: 7:13\n                                            // + literal: Const { ty: fn() {noop}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb2: {\n+          _0 = const ();                   // scope 0 at $DIR/simplify_if.rs:8:6: 8:6\n+          goto -> bb4;                     // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n+      }\n+  \n       bb3: {\n           StorageDead(_2);                 // scope 0 at $DIR/simplify_if.rs:7:15: 7:16\n           _0 = const ();                   // scope 0 at $DIR/simplify_if.rs:6:14: 8:6\n           goto -> bb4;                     // scope 0 at $DIR/simplify_if.rs:6:5: 8:6\n       }\n   \n       bb4: {\n-          StorageDead(_1);                 // scope 0 at $DIR/simplify_if.rs:9:1: 9:2\n+          StorageDead(_1);                 // scope 0 at $DIR/simplify_if.rs:8:5: 8:6\n           return;                          // scope 0 at $DIR/simplify_if.rs:9:2: 9:2\n       }\n   }"}, {"sha": "70725e5f14f7dfe59df343dc74bd038f7662b508", "filename": "src/test/mir-opt/simplify_locals_fixedpoint.foo.SimplifyLocals.diff", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -47,21 +47,21 @@\n           _8 = _6;                         // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n           _7 = Gt(move _8, const 42_u8);   // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n           StorageDead(_8);                 // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:19: 5:20\n-          switchInt(_7) -> [false: bb4, otherwise: bb5]; // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n+          switchInt(move _7) -> [false: bb5, otherwise: bb4]; // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n       }\n   \n       bb4: {\n-          _0 = const ();                   // scope 1 at $DIR/simplify-locals-fixedpoint.rs:7:10: 7:10\n+          _0 = const ();                   // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:21: 7:10\n           goto -> bb6;                     // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n       }\n   \n       bb5: {\n-          _0 = const ();                   // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:21: 7:10\n+          _0 = const ();                   // scope 1 at $DIR/simplify-locals-fixedpoint.rs:7:10: 7:10\n           goto -> bb6;                     // scope 1 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n       }\n   \n       bb6: {\n-          StorageDead(_7);                 // scope 1 at $DIR/simplify-locals-fixedpoint.rs:8:5: 8:6\n+          StorageDead(_7);                 // scope 1 at $DIR/simplify-locals-fixedpoint.rs:7:9: 7:10\n           StorageDead(_6);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:8:5: 8:6\n           goto -> bb7;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:5: 8:6\n       }"}, {"sha": "23a3fbd5f46518e0dc10aab5a1472425d497c08c", "filename": "src/test/mir-opt/unreachable.main.UnreachablePropagation.diff", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable.main.UnreachablePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable.main.UnreachablePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funreachable.main.UnreachablePropagation.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -44,18 +44,18 @@\n -         StorageLive(_5);                 // scope 2 at $DIR/unreachable.rs:12:9: 16:10\n -         StorageLive(_6);                 // scope 2 at $DIR/unreachable.rs:12:12: 12:16\n -         _6 = const true;                 // scope 2 at $DIR/unreachable.rs:12:12: 12:16\n--         switchInt(_6) -> [false: bb4, otherwise: bb5]; // scope 2 at $DIR/unreachable.rs:12:9: 16:10\n+-         switchInt(move _6) -> [false: bb5, otherwise: bb4]; // scope 2 at $DIR/unreachable.rs:12:9: 16:10\n -     }\n - \n -     bb4: {\n--         _4 = const 42_i32;               // scope 2 at $DIR/unreachable.rs:15:13: 15:20\n--         _5 = const ();                   // scope 2 at $DIR/unreachable.rs:14:16: 16:10\n+-         _4 = const 21_i32;               // scope 2 at $DIR/unreachable.rs:13:13: 13:20\n+-         _5 = const ();                   // scope 2 at $DIR/unreachable.rs:12:17: 14:10\n -         goto -> bb6;                     // scope 2 at $DIR/unreachable.rs:12:9: 16:10\n -     }\n - \n -     bb5: {\n--         _4 = const 21_i32;               // scope 2 at $DIR/unreachable.rs:13:13: 13:20\n--         _5 = const ();                   // scope 2 at $DIR/unreachable.rs:12:17: 14:10\n+-         _4 = const 42_i32;               // scope 2 at $DIR/unreachable.rs:15:13: 15:20\n+-         _5 = const ();                   // scope 2 at $DIR/unreachable.rs:14:16: 16:10\n -         goto -> bb6;                     // scope 2 at $DIR/unreachable.rs:12:9: 16:10\n -     }\n - "}, {"sha": "3eda18317057b4529d1db0439909b4b524cb0037", "filename": "src/test/mir-opt/unreachable_asm.main.UnreachablePropagation.diff", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_asm.main.UnreachablePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_asm.main.UnreachablePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funreachable_asm.main.UnreachablePropagation.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -46,18 +46,18 @@\n           StorageLive(_5);                 // scope 2 at $DIR/unreachable_asm.rs:14:9: 18:10\n           StorageLive(_6);                 // scope 2 at $DIR/unreachable_asm.rs:14:12: 14:16\n           _6 = const true;                 // scope 2 at $DIR/unreachable_asm.rs:14:12: 14:16\n-          switchInt(_6) -> [false: bb4, otherwise: bb5]; // scope 2 at $DIR/unreachable_asm.rs:14:9: 18:10\n+          switchInt(move _6) -> [false: bb5, otherwise: bb4]; // scope 2 at $DIR/unreachable_asm.rs:14:9: 18:10\n       }\n   \n       bb4: {\n-          _4 = const 42_i32;               // scope 2 at $DIR/unreachable_asm.rs:17:13: 17:20\n-          _5 = const ();                   // scope 2 at $DIR/unreachable_asm.rs:16:16: 18:10\n+          _4 = const 21_i32;               // scope 2 at $DIR/unreachable_asm.rs:15:13: 15:20\n+          _5 = const ();                   // scope 2 at $DIR/unreachable_asm.rs:14:17: 16:10\n           goto -> bb6;                     // scope 2 at $DIR/unreachable_asm.rs:14:9: 18:10\n       }\n   \n       bb5: {\n-          _4 = const 21_i32;               // scope 2 at $DIR/unreachable_asm.rs:15:13: 15:20\n-          _5 = const ();                   // scope 2 at $DIR/unreachable_asm.rs:14:17: 16:10\n+          _4 = const 42_i32;               // scope 2 at $DIR/unreachable_asm.rs:17:13: 17:20\n+          _5 = const ();                   // scope 2 at $DIR/unreachable_asm.rs:16:16: 18:10\n           goto -> bb6;                     // scope 2 at $DIR/unreachable_asm.rs:14:9: 18:10\n       }\n   "}, {"sha": "d0d52e869d624379335787827388770af18a4190", "filename": "src/test/mir-opt/unreachable_asm_2.main.UnreachablePropagation.diff", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_asm_2.main.UnreachablePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_asm_2.main.UnreachablePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funreachable_asm_2.main.UnreachablePropagation.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -49,28 +49,28 @@\n           StorageLive(_5);                 // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n           StorageLive(_6);                 // scope 2 at $DIR/unreachable_asm_2.rs:14:12: 14:16\n           _6 = const true;                 // scope 2 at $DIR/unreachable_asm_2.rs:14:12: 14:16\n-          switchInt(_6) -> [false: bb4, otherwise: bb5]; // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n+          switchInt(move _6) -> [false: bb5, otherwise: bb4]; // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n       }\n   \n       bb4: {\n-          StorageLive(_8);                 // scope 2 at $DIR/unreachable_asm_2.rs:20:13: 20:41\n-          llvm_asm!(LlvmInlineAsmInner { asm: \"NOP\", asm_str_style: Cooked, outputs: [], inputs: [], clobbers: [], volatile: true, alignstack: false, dialect: Att } : [] : []); // scope 4 at $DIR/unreachable_asm_2.rs:20:22: 20:39\n-          _8 = const ();                   // scope 4 at $DIR/unreachable_asm_2.rs:20:13: 20:41\n-          StorageDead(_8);                 // scope 2 at $DIR/unreachable_asm_2.rs:20:40: 20:41\n-          _4 = const 42_i32;               // scope 2 at $DIR/unreachable_asm_2.rs:21:13: 21:20\n-          _5 = const ();                   // scope 2 at $DIR/unreachable_asm_2.rs:18:16: 22:10\n--         goto -> bb6;                     // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n-+         unreachable;                     // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n-      }\n-  \n-      bb5: {\n           StorageLive(_7);                 // scope 2 at $DIR/unreachable_asm_2.rs:16:13: 16:41\n           llvm_asm!(LlvmInlineAsmInner { asm: \"NOP\", asm_str_style: Cooked, outputs: [], inputs: [], clobbers: [], volatile: true, alignstack: false, dialect: Att } : [] : []); // scope 3 at $DIR/unreachable_asm_2.rs:16:22: 16:39\n           _7 = const ();                   // scope 3 at $DIR/unreachable_asm_2.rs:16:13: 16:41\n           StorageDead(_7);                 // scope 2 at $DIR/unreachable_asm_2.rs:16:40: 16:41\n           _4 = const 21_i32;               // scope 2 at $DIR/unreachable_asm_2.rs:17:13: 17:20\n           _5 = const ();                   // scope 2 at $DIR/unreachable_asm_2.rs:14:17: 18:10\n -         goto -> bb6;                     // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n++         unreachable;                     // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n+      }\n+  \n+      bb5: {\n+          StorageLive(_8);                 // scope 2 at $DIR/unreachable_asm_2.rs:20:13: 20:41\n+          llvm_asm!(LlvmInlineAsmInner { asm: \"NOP\", asm_str_style: Cooked, outputs: [], inputs: [], clobbers: [], volatile: true, alignstack: false, dialect: Att } : [] : []); // scope 4 at $DIR/unreachable_asm_2.rs:20:22: 20:39\n+          _8 = const ();                   // scope 4 at $DIR/unreachable_asm_2.rs:20:13: 20:41\n+          StorageDead(_8);                 // scope 2 at $DIR/unreachable_asm_2.rs:20:40: 20:41\n+          _4 = const 42_i32;               // scope 2 at $DIR/unreachable_asm_2.rs:21:13: 21:20\n+          _5 = const ();                   // scope 2 at $DIR/unreachable_asm_2.rs:18:16: 22:10\n+-         goto -> bb6;                     // scope 2 at $DIR/unreachable_asm_2.rs:14:9: 22:10\n -     }\n - \n -     bb6: {"}, {"sha": "2c0cc04085efa70a727b5a4b45fd1ef003635cac", "filename": "src/test/mir-opt/unreachable_diverging.main.UnreachablePropagation.diff", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_diverging.main.UnreachablePropagation.diff", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Funreachable_diverging.main.UnreachablePropagation.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funreachable_diverging.main.UnreachablePropagation.diff?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -45,25 +45,24 @@\n           StorageLive(_5);                 // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n           StorageLive(_6);                 // scope 2 at $DIR/unreachable_diverging.rs:15:12: 15:13\n           _6 = _1;                         // scope 2 at $DIR/unreachable_diverging.rs:15:12: 15:13\n--         switchInt(_6) -> [false: bb4, otherwise: bb5]; // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n+-         switchInt(move _6) -> [false: bb5, otherwise: bb4]; // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n +         goto -> bb4;                     // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n       }\n   \n       bb4: {\n--         _5 = const ();                   // scope 2 at $DIR/unreachable_diverging.rs:17:10: 17:10\n--         goto -> bb6;                     // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n--     }\n-- \n--     bb5: {\n -         _5 = loop_forever() -> bb6;      // scope 2 at $DIR/unreachable_diverging.rs:16:13: 16:27\n +         _5 = loop_forever() -> bb5;      // scope 2 at $DIR/unreachable_diverging.rs:16:13: 16:27\n                                            // mir::Constant\n                                            // + span: $DIR/unreachable_diverging.rs:16:13: 16:25\n                                            // + literal: Const { ty: fn() {loop_forever}, val: Value(Scalar(<ZST>)) }\n       }\n   \n+      bb5: {\n+-         _5 = const ();                   // scope 2 at $DIR/unreachable_diverging.rs:17:10: 17:10\n+-         goto -> bb6;                     // scope 2 at $DIR/unreachable_diverging.rs:15:9: 17:10\n+-     }\n+- \n -     bb6: {\n-+     bb5: {\n           StorageDead(_6);                 // scope 2 at $DIR/unreachable_diverging.rs:17:9: 17:10\n           StorageDead(_5);                 // scope 2 at $DIR/unreachable_diverging.rs:17:9: 17:10\n           StorageLive(_7);                 // scope 2 at $DIR/unreachable_diverging.rs:18:9: 18:22"}, {"sha": "0c034891a80db52a6db4347f3edb4f9810726353", "filename": "src/test/mir-opt/while_storage.while_loop.PreCodegen.after.mir", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fwhile_storage.while_loop.PreCodegen.after.mir", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fmir-opt%2Fwhile_storage.while_loop.PreCodegen.after.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fwhile_storage.while_loop.PreCodegen.after.mir?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -40,19 +40,19 @@ fn while_loop(_1: bool) -> () {\n \n     bb4: {\n         StorageDead(_5);                 // scope 0 at $DIR/while-storage.rs:11:22: 11:23\n-        switchInt(_4) -> [false: bb5, otherwise: bb6]; // scope 0 at $DIR/while-storage.rs:11:9: 13:10\n+        switchInt(move _4) -> [false: bb6, otherwise: bb5]; // scope 0 at $DIR/while-storage.rs:11:9: 13:10\n     }\n \n     bb5: {\n-        StorageDead(_4);                 // scope 0 at $DIR/while-storage.rs:14:5: 14:6\n-        StorageDead(_2);                 // scope 0 at $DIR/while-storage.rs:14:5: 14:6\n-        goto -> bb0;                     // scope 0 at $DIR/while-storage.rs:10:5: 14:6\n+        _0 = const ();                   // scope 0 at $DIR/while-storage.rs:12:13: 12:18\n+        StorageDead(_4);                 // scope 0 at $DIR/while-storage.rs:13:9: 13:10\n+        goto -> bb7;                     // scope 0 at $DIR/while-storage.rs:1:1: 1:1\n     }\n \n     bb6: {\n-        _0 = const ();                   // scope 0 at $DIR/while-storage.rs:12:13: 12:18\n-        StorageDead(_4);                 // scope 0 at $DIR/while-storage.rs:14:5: 14:6\n-        goto -> bb7;                     // scope 0 at $DIR/while-storage.rs:1:1: 1:1\n+        StorageDead(_4);                 // scope 0 at $DIR/while-storage.rs:13:9: 13:10\n+        StorageDead(_2);                 // scope 0 at $DIR/while-storage.rs:14:5: 14:6\n+        goto -> bb0;                     // scope 0 at $DIR/while-storage.rs:10:5: 14:6\n     }\n \n     bb7: {"}, {"sha": "fc49cc6d68ea02b673f36d1d8332bf1a409abe0d", "filename": "src/test/ui/issues/issue-14091.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fui%2Fissues%2Fissue-14091.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fui%2Fissues%2Fissue-14091.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-14091.stderr?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -3,6 +3,8 @@ error[E0308]: mismatched types\n    |\n LL |     assert!(1,1);\n    |     ^^^^^^^^^^^^^ expected `bool`, found integer\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error\n "}, {"sha": "c646912d3b67950583d857964329692d36846745", "filename": "src/test/ui/lifetimes/lifetime-errors/liveness-assign-imm-local-notes.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fui%2Flifetimes%2Flifetime-errors%2Fliveness-assign-imm-local-notes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftest%2Fui%2Flifetimes%2Flifetime-errors%2Fliveness-assign-imm-local-notes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Flifetime-errors%2Fliveness-assign-imm-local-notes.stderr?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -28,16 +28,16 @@ LL |     let x;\n ...\n LL |             x = 1;\n    |             ^^^^^ cannot assign twice to immutable variable\n-LL |         } else {\n-LL |             x = 2;\n-   |             ----- first assignment to `x`\n \n error[E0384]: cannot assign twice to immutable variable `x`\n   --> $DIR/liveness-assign-imm-local-notes.rs:32:13\n    |\n LL |     let x;\n    |         - help: make this binding mutable: `mut x`\n ...\n+LL |             x = 1;\n+   |             ----- first assignment to `x`\n+LL |         } else {\n LL |             x = 2;\n    |             ^^^^^ cannot assign twice to immutable variable\n "}, {"sha": "aa431f0596cca9c12ac22d5a7f35d173a64e445c", "filename": "src/tools/clippy/clippy_lints/src/assertions_on_constants.rs", "status": "modified", "additions": 10, "deletions": 20, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fassertions_on_constants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fassertions_on_constants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fassertions_on_constants.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,8 +1,7 @@\n use crate::consts::{constant, Constant};\n use crate::utils::{is_direct_expn_of, is_expn_of, match_panic_call, snippet_opt, span_lint_and_help};\n use if_chain::if_chain;\n-use rustc_ast::ast::LitKind;\n-use rustc_hir::{Expr, ExprKind, PatKind, UnOp};\n+use rustc_hir::{Expr, ExprKind, UnOp};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -102,31 +101,22 @@ enum AssertKind {\n /// Check if the expression matches\n ///\n /// ```rust,ignore\n-/// match { let _t = !c; _t } {\n-///     true => {\n-///         {\n-///             ::std::rt::begin_panic(message, _)\n-///         }\n-///     }\n-///     _ => { }\n-/// };\n+/// if !c {\n+///   {\n+///     ::std::rt::begin_panic(message, _)\n+///   }\n+/// }\n /// ```\n ///\n /// where `message` is any expression and `c` is a constant bool.\n fn match_assert_with_message<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) -> Option<AssertKind> {\n     if_chain! {\n-        if let ExprKind::Match(ref expr, ref arms, _) = expr.kind;\n-        // matches { let _t = expr; _t }\n-        if let ExprKind::DropTemps(ref expr) = expr.kind;\n-        if let ExprKind::Unary(UnOp::UnNot, ref expr) = expr.kind;\n+        if let ExprKind::If(ref cond, ref then, _) = expr.kind;\n+        if let ExprKind::Unary(UnOp::UnNot, ref expr) = cond.kind;\n         // bind the first argument of the `assert!` macro\n         if let Some((Constant::Bool(is_true), _)) = constant(cx, cx.typeck_results(), expr);\n-        // arm 1 pattern\n-        if let PatKind::Lit(ref lit_expr) = arms[0].pat.kind;\n-        if let ExprKind::Lit(ref lit) = lit_expr.kind;\n-        if let LitKind::Bool(true) = lit.node;\n-        // arm 1 block\n-        if let ExprKind::Block(ref block, _) = arms[0].body.kind;\n+        // block\n+        if let ExprKind::Block(ref block, _) = then.kind;\n         if block.stmts.is_empty();\n         if let Some(block_expr) = &block.expr;\n         // inner block is optional. unwrap it if it exists, or use the expression as is otherwise."}, {"sha": "4efca10bcdf13d650cdff8067231ae3f8f32d4f5", "filename": "src/tools/clippy/clippy_lints/src/blocks_in_if_conditions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{differing_macro_contexts, higher, snippet_block_with_applicability, span_lint, span_lint_and_sugg};\n+use crate::utils::{differing_macro_contexts, snippet_block_with_applicability, span_lint, span_lint_and_sugg};\n use rustc_errors::Applicability;\n use rustc_hir::intravisit::{walk_expr, NestedVisitorMap, Visitor};\n use rustc_hir::{BlockCheckMode, Expr, ExprKind};\n@@ -75,7 +75,7 @@ impl<'tcx> LateLintPass<'tcx> for BlocksInIfConditions {\n         if in_external_macro(cx.sess(), expr.span) {\n             return;\n         }\n-        if let Some((cond, _, _)) = higher::if_block(&expr) {\n+        if let ExprKind::If(cond, _, _) = &expr.kind {\n             if let ExprKind::Block(block, _) = &cond.kind {\n                 if block.rules == BlockCheckMode::DefaultBlock {\n                     if block.stmts.is_empty() {"}, {"sha": "b3ebdf4ca30d8d21119c6559b51f9782456d2bc2", "filename": "src/tools/clippy/clippy_lints/src/cognitive_complexity.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcognitive_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcognitive_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcognitive_complexity.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -147,6 +147,9 @@ impl<'tcx> Visitor<'tcx> for CCHelper {\n     fn visit_expr(&mut self, e: &'tcx Expr<'_>) {\n         walk_expr(self, e);\n         match e.kind {\n+            ExprKind::If(_, _, _) => {\n+                self.cc += 1;\n+            },\n             ExprKind::Match(_, ref arms, _) => {\n                 if arms.len() > 1 {\n                     self.cc += 1;"}, {"sha": "166eadf86c177f49aa221145bcfaf4ba6c5342c3", "filename": "src/tools/clippy/clippy_lints/src/consts.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fconsts.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,6 +1,6 @@\n #![allow(clippy::float_cmp)]\n \n-use crate::utils::{clip, higher, sext, unsext};\n+use crate::utils::{clip, sext, unsext};\n use if_chain::if_chain;\n use rustc_ast::ast::{FloatTy, LitFloatType, LitKind};\n use rustc_data_structures::sync::Lrc;\n@@ -228,9 +228,6 @@ pub struct ConstEvalLateContext<'a, 'tcx> {\n impl<'a, 'tcx> ConstEvalLateContext<'a, 'tcx> {\n     /// Simple constant folding: Insert an expression, get a constant or none.\n     pub fn expr(&mut self, e: &Expr<'_>) -> Option<Constant> {\n-        if let Some((ref cond, ref then, otherwise)) = higher::if_block(&e) {\n-            return self.ifthenelse(cond, then, otherwise);\n-        }\n         match e.kind {\n             ExprKind::Path(ref qpath) => self.fetch_path(qpath, e.hir_id, self.typeck_results.expr_ty(e)),\n             ExprKind::Block(ref block, _) => self.block(block),\n@@ -249,6 +246,7 @@ impl<'a, 'tcx> ConstEvalLateContext<'a, 'tcx> {\n                 UnOp::UnNeg => self.constant_negate(&o, self.typeck_results.expr_ty(e)),\n                 UnOp::UnDeref => Some(if let Constant::Ref(r) = o { *r } else { o }),\n             }),\n+            ExprKind::If(ref cond, ref then, ref otherwise) => self.ifthenelse(cond, then, *otherwise),\n             ExprKind::Binary(op, ref left, ref right) => self.binop(op, left, right),\n             ExprKind::Call(ref callee, ref args) => {\n                 // We only handle a few const functions for now."}, {"sha": "6f48ffeb0e9c9255190cfd19e41335a1f07b789f", "filename": "src/tools/clippy/clippy_lints/src/copies.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcopies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcopies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fcopies.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,6 +1,6 @@\n use crate::utils::{eq_expr_value, in_macro, search_same, SpanlessEq, SpanlessHash};\n-use crate::utils::{get_parent_expr, higher, if_sequence, span_lint_and_note};\n-use rustc_hir::{Block, Expr};\n+use crate::utils::{get_parent_expr, if_sequence, span_lint_and_note};\n+use rustc_hir::{Block, Expr, ExprKind};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -109,11 +109,12 @@ impl<'tcx> LateLintPass<'tcx> for CopyAndPaste {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n         if !expr.span.from_expansion() {\n             // skip ifs directly in else, it will be checked in the parent if\n-            if let Some(expr) = get_parent_expr(cx, expr) {\n-                if let Some((_, _, Some(ref else_expr))) = higher::if_block(&expr) {\n-                    if else_expr.hir_id == expr.hir_id {\n-                        return;\n-                    }\n+            if let Some(&Expr {\n+                kind: ExprKind::If(_, _, Some(ref else_expr)),\n+                ..\n+            }) = get_parent_expr(cx, expr) {\n+                if else_expr.hir_id == expr.hir_id {\n+                    return;\n                 }\n             }\n "}, {"sha": "37948e06869c3bfc4100d814663dd00c823dc37f", "filename": "src/tools/clippy/clippy_lints/src/entry.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fentry.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::SpanlessEq;\n-use crate::utils::{get_item_name, higher, is_type_diagnostic_item, match_type, paths, snippet, snippet_opt};\n+use crate::utils::{get_item_name, is_type_diagnostic_item, match_type, paths, snippet, snippet_opt};\n use crate::utils::{snippet_with_applicability, span_lint_and_then};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n@@ -54,7 +54,7 @@ declare_lint_pass!(HashMapPass => [MAP_ENTRY]);\n \n impl<'tcx> LateLintPass<'tcx> for HashMapPass {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n-        if let Some((ref check, ref then_block, ref else_block)) = higher::if_block(&expr) {\n+        if let ExprKind::If(ref check, ref then_block, ref else_block) = expr.kind {\n             if let ExprKind::Unary(UnOp::UnNot, ref check) = check.kind {\n                 if let Some((ty, map, key)) = check_cond(cx, check) {\n                     // in case of `if !m.contains_key(&k) { m.insert(k, v); }`"}, {"sha": "ffef78aac806770f6108d9f5c17c17359aab1855", "filename": "src/tools/clippy/clippy_lints/src/floating_point_arithmetic.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -2,7 +2,7 @@ use crate::consts::{\n     constant, constant_simple, Constant,\n     Constant::{Int, F32, F64},\n };\n-use crate::utils::{eq_expr_value, get_parent_expr, higher, numeric_literal, span_lint_and_sugg, sugg};\n+use crate::utils::{eq_expr_value, get_parent_expr, numeric_literal, span_lint_and_sugg, sugg};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir::{BinOpKind, Expr, ExprKind, PathSegment, UnOp};\n@@ -556,11 +556,11 @@ fn are_negated<'a>(cx: &LateContext<'_>, expr1: &'a Expr<'a>, expr2: &'a Expr<'a\n \n fn check_custom_abs(cx: &LateContext<'_>, expr: &Expr<'_>) {\n     if_chain! {\n-        if let Some((cond, body, Some(else_body))) = higher::if_block(&expr);\n+        if let ExprKind::If(cond, body, else_body) = expr.kind;\n         if let ExprKind::Block(block, _) = body.kind;\n         if block.stmts.is_empty();\n         if let Some(if_body_expr) = block.expr;\n-        if let ExprKind::Block(else_block, _) = else_body.kind;\n+        if let Some(ExprKind::Block(else_block, _)) = else_body.map(|el| &el.kind);\n         if else_block.stmts.is_empty();\n         if let Some(else_body_expr) = else_block.expr;\n         if let Some((if_expr_positive, body)) = are_negated(cx, if_body_expr, else_body_expr);"}, {"sha": "109d90ff772b57b8172761cb06c353283304fdf0", "filename": "src/tools/clippy/clippy_lints/src/implicit_return.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_return.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -81,6 +81,13 @@ fn expr_match(cx: &LateContext<'_>, expr: &Expr<'_>) {\n                 lint(cx, expr.span, break_expr.span, LINT_BREAK);\n             }\n         },\n+        ExprKind::If(.., if_expr, else_expr) => {\n+            expr_match(cx, if_expr);\n+\n+            if let Some(else_expr) = else_expr {\n+                expr_match(cx, else_expr);\n+            }\n+        },\n         ExprKind::Match(.., arms, source) => {\n             let check_all_arms = match source {\n                 MatchSource::IfLetDesugar {"}, {"sha": "16e162badb5ee64a0172a3e23810490e13e2624b", "filename": "src/tools/clippy/clippy_lints/src/implicit_saturating_sub.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{higher, in_macro, match_qpath, span_lint_and_sugg, SpanlessEq};\n+use crate::utils::{in_macro, match_qpath, span_lint_and_sugg, SpanlessEq};\n use if_chain::if_chain;\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n@@ -42,7 +42,7 @@ impl<'tcx> LateLintPass<'tcx> for ImplicitSaturatingSub {\n             return;\n         }\n         if_chain! {\n-            if let Some((ref cond, ref then, None)) = higher::if_block(&expr);\n+            if let ExprKind::If(cond, then, None) = &expr.kind;\n \n             // Check if the conditional expression is a binary operation\n             if let ExprKind::Binary(ref cond_op, ref cond_left, ref cond_right) = cond.kind;"}, {"sha": "db717cd1240a41b38a9f1d871595f3561b02c2b0", "filename": "src/tools/clippy/clippy_lints/src/let_if_seq.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flet_if_seq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flet_if_seq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flet_if_seq.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,5 +1,4 @@\n-use crate::utils::visitors::LocalUsedVisitor;\n-use crate::utils::{higher, qpath_res, snippet, span_lint_and_then};\n+use crate::utils::{qpath_res, snippet, span_lint_and_then, visitors::LocalUsedVisitor};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n@@ -64,7 +63,7 @@ impl<'tcx> LateLintPass<'tcx> for LetIfSeq {\n                 if let hir::StmtKind::Local(ref local) = stmt.kind;\n                 if let hir::PatKind::Binding(mode, canonical_id, ident, None) = local.pat.kind;\n                 if let hir::StmtKind::Expr(ref if_) = expr.kind;\n-                if let Some((ref cond, ref then, ref else_)) = higher::if_block(&if_);\n+                if let hir::ExprKind::If(ref cond, ref then, ref else_) = if_.kind;\n                 if !LocalUsedVisitor::new(canonical_id).check_expr(cond);\n                 if let hir::ExprKind::Block(ref then, _) = then.kind;\n                 if let Some(value) = check_assign(cx, canonical_id, &*then);"}, {"sha": "281964ee5e8f3bb4a01d61303934f9421a4f25d0", "filename": "src/tools/clippy/clippy_lints/src/loops.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -742,6 +742,14 @@ fn never_loop_expr(expr: &Expr<'_>, main_loop_id: HirId) -> NeverLoopResult {\n             // Break can come from the inner loop so remove them.\n             absorb_break(&never_loop_block(b, main_loop_id))\n         },\n+        ExprKind::If(ref e, ref e2, ref e3) => {\n+            let e1 = never_loop_expr(e, main_loop_id);\n+            let e2 = never_loop_expr(e2, main_loop_id);\n+            let e3 = e3\n+                .as_ref()\n+                .map_or(NeverLoopResult::Otherwise, |e| never_loop_expr(e, main_loop_id));\n+            combine_seq(e1, combine_branches(e2, e3))\n+        },\n         ExprKind::Match(ref e, ref arms, _) => {\n             let e = never_loop_expr(e, main_loop_id);\n             if arms.is_empty() {\n@@ -2594,7 +2602,7 @@ fn is_loop(expr: &Expr<'_>) -> bool {\n }\n \n fn is_conditional(expr: &Expr<'_>) -> bool {\n-    matches!(expr.kind, ExprKind::Match(..))\n+    matches!(expr.kind, ExprKind::If(..) | ExprKind::Match(..))\n }\n \n fn is_nested(cx: &LateContext<'_>, match_expr: &Expr<'_>, iter_expr: &Expr<'_>) -> bool {"}, {"sha": "a0cfe145a301cb68649f8ab1f8bf23d35296d4aa", "filename": "src/tools/clippy/clippy_lints/src/manual_strip.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_strip.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_strip.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_strip.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -80,7 +80,7 @@ impl<'tcx> LateLintPass<'tcx> for ManualStrip {\n         }\n \n         if_chain! {\n-            if let Some((cond, then, _)) = higher::if_block(&expr);\n+            if let ExprKind::If(cond, then, _) = &expr.kind;\n             if let ExprKind::MethodCall(_, _, [target_arg, pattern], _) = cond.kind;\n             if let Some(method_def_id) = cx.typeck_results().type_dependent_def_id(cond.hir_id);\n             if let ExprKind::Path(target_path) = &target_arg.kind;"}, {"sha": "2234890d6e94fddbf491caeb790c3f157bc71bd6", "filename": "src/tools/clippy/clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -2048,6 +2048,7 @@ fn lint_expect_fun_call(\n             hir::ExprKind::Call(..)\n             | hir::ExprKind::MethodCall(..)\n             // These variants are debatable or require further examination\n+            | hir::ExprKind::If(..)\n             | hir::ExprKind::Match(..)\n             | hir::ExprKind::Block{ .. } => true,\n             _ => false,"}, {"sha": "d98e6160d308561d2b1f115c1ce5e5372e3ba27f", "filename": "src/tools/clippy/clippy_lints/src/methods/unnecessary_filter_map.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -90,6 +90,12 @@ fn check_expression<'tcx>(cx: &LateContext<'tcx>, arg_id: hir::HirId, expr: &'tc\n             }\n             (found_mapping, found_filtering)\n         },\n+        // There must be an else_arm or there will be a type error\n+        hir::ExprKind::If(_, ref if_arm, Some(ref else_arm)) => {\n+            let if_check = check_expression(cx, arg_id, if_arm);\n+            let else_check = check_expression(cx, arg_id, else_arm);\n+            (if_check.0 | else_check.0, if_check.1 | else_check.1)\n+        },\n         hir::ExprKind::Path(path) if match_qpath(path, &paths::OPTION_NONE) => (false, true),\n         _ => (true, true),\n     }"}, {"sha": "71f91eb4bfbe39bc8e648819f84c1c052315fee8", "filename": "src/tools/clippy/clippy_lints/src/mutable_debug_assertion.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmutable_debug_assertion.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -90,6 +90,10 @@ impl<'a, 'tcx> Visitor<'tcx> for MutArgVisitor<'a, 'tcx> {\n                 self.found = true;\n                 return;\n             },\n+            ExprKind::If(..) => {\n+                self.found = true;\n+                return;\n+            },\n             ExprKind::Path(_) => {\n                 if let Some(adj) = self.cx.typeck_results().adjustments().get(expr.hir_id) {\n                     if adj"}, {"sha": "6b9a37b525201b203f16a665f1e15b9df5294b25", "filename": "src/tools/clippy/clippy_lints/src/needless_bool.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_bool.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -4,7 +4,7 @@\n \n use crate::utils::sugg::Sugg;\n use crate::utils::{\n-    higher, is_expn_of, parent_node_is_if_expr, snippet_with_applicability, span_lint, span_lint_and_sugg,\n+    is_expn_of, parent_node_is_if_expr, snippet_with_applicability, span_lint, span_lint_and_sugg,\n };\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n@@ -71,7 +71,7 @@ declare_lint_pass!(NeedlessBool => [NEEDLESS_BOOL]);\n impl<'tcx> LateLintPass<'tcx> for NeedlessBool {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, e: &'tcx Expr<'_>) {\n         use self::Expression::{Bool, RetBool};\n-        if let Some((ref pred, ref then_block, Some(ref else_expr))) = higher::if_block(&e) {\n+        if let ExprKind::If(ref pred, ref then_block, Some(ref else_expr)) = e.kind {\n             let reduce = |ret, not| {\n                 let mut applicability = Applicability::MachineApplicable;\n                 let snip = Sugg::hir_with_applicability(cx, pred, \"<predicate>\", &mut applicability);"}, {"sha": "391f893ef35ff404bdded2704183df5ccfe38646", "filename": "src/tools/clippy/clippy_lints/src/option_if_let_else.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_if_let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_if_let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_if_let_else.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -109,25 +109,26 @@ fn extract_body_from_arm<'a>(arm: &'a Arm<'a>) -> Option<&'a Expr<'a>> {\n /// it in curly braces. Otherwise, we don't.\n fn should_wrap_in_braces(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n     utils::get_enclosing_block(cx, expr.hir_id).map_or(false, |parent| {\n+        let mut should_wrap = false;\n+        \n         if let Some(Expr {\n             kind:\n                 ExprKind::Match(\n                     _,\n                     arms,\n-                    MatchSource::IfDesugar {\n-                        contains_else_clause: true,\n-                    }\n-                    | MatchSource::IfLetDesugar {\n+                    MatchSource::IfLetDesugar {\n                         contains_else_clause: true,\n                     },\n                 ),\n             ..\n         }) = parent.expr\n         {\n-            expr.hir_id == arms[1].body.hir_id\n-        } else {\n-            false\n+            should_wrap = expr.hir_id == arms[1].body.hir_id;\n+        } else if let Some(Expr { kind: ExprKind::If(_, _, Some(else_clause)), .. }) = parent.expr {\n+            should_wrap = expr.hir_id == else_clause.hir_id;\n         }\n+\n+        should_wrap\n     })\n }\n "}, {"sha": "6c480d48c7561245a0ab0150e49edcf1a5803f1b", "filename": "src/tools/clippy/clippy_lints/src/question_mark.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fquestion_mark.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -8,7 +8,7 @@ use rustc_span::sym;\n \n use crate::utils::sugg::Sugg;\n use crate::utils::{\n-    eq_expr_value, higher, is_type_diagnostic_item, match_def_path, match_qpath, paths, snippet_with_applicability,\n+    eq_expr_value, is_type_diagnostic_item, match_def_path, match_qpath, paths, snippet_with_applicability,\n     span_lint_and_sugg,\n };\n \n@@ -50,7 +50,7 @@ impl QuestionMark {\n     /// If it matches, it will suggest to use the question mark operator instead\n     fn check_is_none_and_early_return_none(cx: &LateContext<'_>, expr: &Expr<'_>) {\n         if_chain! {\n-            if let Some((if_expr, body, else_)) = higher::if_block(&expr);\n+            if let ExprKind::If(if_expr, body, else_) = &expr.kind;\n             if let ExprKind::MethodCall(segment, _, args, _) = &if_expr.kind;\n             if segment.ident.name == sym!(is_none);\n             if Self::expression_returns_none(cx, body);"}, {"sha": "35827e027aab81615fbb21fe3c7e178828bc1708", "filename": "src/tools/clippy/clippy_lints/src/returns.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Freturns.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -184,6 +184,14 @@ fn check_final_expr<'tcx>(\n         ExprKind::Block(ref block, _) => {\n             check_block_return(cx, block);\n         },\n+        ExprKind::If(_, then, else_clause_opt) => {\n+            if let ExprKind::Block(ref ifblock, _) = then.kind {\n+                check_block_return(cx, ifblock);\n+            }\n+            if let Some(else_clause) = else_clause_opt {\n+                check_final_expr(cx, else_clause, None, RetReplacement::Empty);\n+            }\n+        },\n         // a match expr, check all arms\n         // an if/if let expr, check both exprs\n         // note, if without else is going to be a type checking error anyways\n@@ -194,9 +202,6 @@ fn check_final_expr<'tcx>(\n                     check_final_expr(cx, &arm.body, Some(arm.body.span), RetReplacement::Block);\n                 }\n             },\n-            MatchSource::IfDesugar {\n-                contains_else_clause: true,\n-            }\n             | MatchSource::IfLetDesugar {\n                 contains_else_clause: true,\n             } => {"}, {"sha": "f2f3dfa09a7d4099440e6788e1358c8a0f647f5e", "filename": "src/tools/clippy/clippy_lints/src/shadow.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fshadow.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -333,6 +333,13 @@ fn check_expr<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, bindings: &mut\n                 check_expr(cx, e, bindings)\n             }\n         },\n+        ExprKind::If(ref cond, ref then, ref otherwise) => {\n+            check_expr(cx, cond, bindings);\n+            check_expr(cx, &**then, bindings);\n+            if let Some(ref o) = *otherwise {\n+                check_expr(cx, o, bindings);\n+            }\n+        },\n         ExprKind::Match(ref init, arms, _) => {\n             check_expr(cx, init, bindings);\n             let len = bindings.len();"}, {"sha": "6a87f534369803dcc60d37bb78066fb4ea8a1d17", "filename": "src/tools/clippy/clippy_lints/src/unwrap.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funwrap.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::{\n-    differing_macro_contexts, higher::if_block, is_type_diagnostic_item, span_lint_and_then,\n+    differing_macro_contexts, is_type_diagnostic_item, span_lint_and_then,\n     usage::is_potentially_mutated,\n };\n use if_chain::if_chain;\n@@ -158,7 +158,7 @@ impl<'a, 'tcx> Visitor<'tcx> for UnwrappableVariablesVisitor<'a, 'tcx> {\n         if in_external_macro(self.cx.tcx.sess, expr.span) {\n             return;\n         }\n-        if let Some((cond, then, els)) = if_block(&expr) {\n+        if let ExprKind::If(cond, then, els) = &expr.kind {\n             walk_expr(self, cond);\n             self.visit_branch(cond, then, false);\n             if let Some(els) = els {"}, {"sha": "43afa65de3e5518a1bf9c701c1dddf224d7f8775", "filename": "src/tools/clippy/clippy_lints/src/utils/author.rs", "status": "modified", "additions": 20, "deletions": 31, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fauthor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fauthor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fauthor.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,7 +1,7 @@\n //! A group of attributes that can be attached to Rust code in order\n //! to generate a clippy lint detecting said code automatically.\n \n-use crate::utils::{get_attr, higher};\n+use crate::utils::get_attr;\n use rustc_ast::ast::{Attribute, LitFloatType, LitKind};\n use rustc_ast::walk_list;\n use rustc_data_structures::fx::FxHashMap;\n@@ -201,32 +201,6 @@ impl<'tcx> Visitor<'tcx> for PrintVisitor {\n \n     #[allow(clippy::too_many_lines)]\n     fn visit_expr(&mut self, expr: &Expr<'_>) {\n-        // handle if desugarings\n-        // TODO add more desugarings here\n-        if let Some((cond, then, opt_else)) = higher::if_block(&expr) {\n-            let cond_pat = self.next(\"cond\");\n-            let then_pat = self.next(\"then\");\n-            if let Some(else_) = opt_else {\n-                let else_pat = self.next(\"else_\");\n-                println!(\n-                    \"    if let Some((ref {}, ref {}, Some({}))) = higher::if_block(&{});\",\n-                    cond_pat, then_pat, else_pat, self.current\n-                );\n-                self.current = else_pat;\n-                self.visit_expr(else_);\n-            } else {\n-                println!(\n-                    \"    if let Some((ref {}, ref {}, None)) = higher::if_block(&{});\",\n-                    cond_pat, then_pat, self.current\n-                );\n-            }\n-            self.current = cond_pat;\n-            self.visit_expr(cond);\n-            self.current = then_pat;\n-            self.visit_expr(then);\n-            return;\n-        }\n-\n         print!(\"    if let ExprKind::\");\n         let current = format!(\"{}.kind\", self.current);\n         match expr.kind {\n@@ -351,6 +325,25 @@ impl<'tcx> Visitor<'tcx> for PrintVisitor {\n                 self.current = body_pat;\n                 self.visit_block(body);\n             },\n+            ExprKind::If(ref cond, ref then, ref opt_else) => {\n+                let cond_pat = self.next(\"cond\");\n+                let then_pat = self.next(\"then\");\n+                if let Some(ref else_) = *opt_else {\n+                    let else_pat = self.next(\"else_\");\n+                    println!(\n+                        \"If(ref {}, ref {}, Some(ref {})) = {};\",\n+                        cond_pat, then_pat, else_pat, current\n+                    );\n+                    self.current = else_pat;\n+                    self.visit_expr(else_);\n+                } else {\n+                    println!(\"If(ref {}, ref {}, None) = {};\", cond_pat, then_pat, current);\n+                }\n+                self.current = cond_pat;\n+                self.visit_expr(cond);\n+                self.current = then_pat;\n+                self.visit_expr(then);\n+            },\n             ExprKind::Match(ref expr, ref arms, desugaring) => {\n                 let des = desugaring_name(desugaring);\n                 let expr_pat = self.next(\"expr\");\n@@ -743,10 +736,6 @@ fn desugaring_name(des: hir::MatchSource) -> String {\n             contains_else_clause\n         ),\n         hir::MatchSource::IfLetGuardDesugar => \"MatchSource::IfLetGuardDesugar\".to_string(),\n-        hir::MatchSource::IfDesugar { contains_else_clause } => format!(\n-            \"MatchSource::IfDesugar {{ contains_else_clause: {} }}\",\n-            contains_else_clause\n-        ),\n         hir::MatchSource::AwaitDesugar => \"MatchSource::AwaitDesugar\".to_string(),\n     }\n }"}, {"sha": "2f157c5030f4466be1ba2cd83068702e95f85210", "filename": "src/tools/clippy/clippy_lints/src/utils/eager_or_lazy.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -62,6 +62,7 @@ fn identify_some_pure_patterns(expr: &Expr<'_>) -> bool {\n         | ExprKind::Type(..)\n         | ExprKind::DropTemps(..)\n         | ExprKind::Loop(..)\n+        | ExprKind::If(..)\n         | ExprKind::Match(..)\n         | ExprKind::Closure(..)\n         | ExprKind::Block(..)"}, {"sha": "9b3585865da3236c0c7523a2a1058131b5b21542", "filename": "src/tools/clippy/clippy_lints/src/utils/higher.rs", "status": "modified", "additions": 3, "deletions": 31, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhigher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhigher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhigher.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -170,33 +170,6 @@ pub fn while_loop<'tcx>(expr: &'tcx hir::Expr<'tcx>) -> Option<(&'tcx hir::Expr<\n     None\n }\n \n-/// Recover the essential nodes of a desugared if block\n-/// `if cond { then } else { els }` becomes `(cond, then, Some(els))`\n-pub fn if_block<'tcx>(\n-    expr: &'tcx hir::Expr<'tcx>,\n-) -> Option<(\n-    &'tcx hir::Expr<'tcx>,\n-    &'tcx hir::Expr<'tcx>,\n-    Option<&'tcx hir::Expr<'tcx>>,\n-)> {\n-    if let hir::ExprKind::Match(ref cond, ref arms, hir::MatchSource::IfDesugar { contains_else_clause }) = expr.kind {\n-        let cond = if let hir::ExprKind::DropTemps(ref cond) = cond.kind {\n-            cond\n-        } else {\n-            panic!(\"If block desugar must contain DropTemps\");\n-        };\n-        let then = &arms[0].body;\n-        let els = if contains_else_clause {\n-            Some(&*arms[1].body)\n-        } else {\n-            None\n-        };\n-        Some((cond, then, els))\n-    } else {\n-        None\n-    }\n-}\n-\n /// Represent the pre-expansion arguments of a `vec!` invocation.\n pub enum VecArgs<'a> {\n     /// `vec![elem; len]`\n@@ -267,12 +240,11 @@ pub fn extract_assert_macro_args<'tcx>(e: &'tcx Expr<'tcx>) -> Option<Vec<&'tcx\n \n     if let ExprKind::Block(ref block, _) = e.kind {\n         if block.stmts.len() == 1 {\n-            if let StmtKind::Semi(ref matchexpr) = block.stmts[0].kind {\n+            if let StmtKind::Semi(ref matchexpr) = block.stmts.get(0)?.kind {\n                 // macros with unique arg: `{debug_}assert!` (e.g., `debug_assert!(some_condition)`)\n                 if_chain! {\n-                    if let ExprKind::Match(ref ifclause, _, _) = matchexpr.kind;\n-                    if let ExprKind::DropTemps(ref droptmp) = ifclause.kind;\n-                    if let ExprKind::Unary(UnOp::UnNot, condition) = droptmp.kind;\n+                    if let ExprKind::If(ref clause, _, _)  = matchexpr.kind;\n+                    if let ExprKind::Unary(UnOp::UnNot, condition) = clause.kind;\n                     then {\n                         return Some(vec![condition]);\n                     }"}, {"sha": "b5cc2bdc4636a22128673979712f58861628633a", "filename": "src/tools/clippy/clippy_lints/src/utils/hir_utils.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fhir_utils.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -119,6 +119,9 @@ impl<'a, 'tcx> SpanlessEq<'a, 'tcx> {\n             (&ExprKind::Index(ref la, ref li), &ExprKind::Index(ref ra, ref ri)) => {\n                 self.eq_expr(la, ra) && self.eq_expr(li, ri)\n             },\n+            (&ExprKind::If(ref lc, ref lt, ref le), &ExprKind::If(ref rc, ref rt, ref re)) => {\n+                self.eq_expr(lc, rc) && self.eq_expr(&**lt, &**rt) && both(le, re, |l, r| self.eq_expr(l, r))\n+            },\n             (&ExprKind::Lit(ref l), &ExprKind::Lit(ref r)) => l.node == r.node,\n             (&ExprKind::Loop(ref lb, ref ll, ref lls), &ExprKind::Loop(ref rb, ref rl, ref rls)) => {\n                 lls == rls && self.eq_block(lb, rb) && both(ll, rl, |l, r| l.ident.as_str() == r.ident.as_str())\n@@ -564,6 +567,15 @@ impl<'a, 'tcx> SpanlessHash<'a, 'tcx> {\n                     self.hash_name(i.ident.name);\n                 }\n             },\n+            ExprKind::If(ref cond, ref then, ref else_opt) => {\n+                let c: fn(_, _, _) -> _ = ExprKind::If;\n+                c.hash(&mut self.s);\n+                self.hash_expr(cond);\n+                self.hash_expr(&**then);\n+                if let Some(ref e) = *else_opt {\n+                    self.hash_expr(e);\n+                }\n+            },\n             ExprKind::Match(ref e, arms, ref s) => {\n                 self.hash_expr(e);\n "}, {"sha": "71c11788d93ac34735b949250c1dc7d383873ed5", "filename": "src/tools/clippy/clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -213,6 +213,15 @@ fn print_expr(cx: &LateContext<'_>, expr: &hir::Expr<'_>, indent: usize) {\n         hir::ExprKind::Loop(..) => {\n             println!(\"{}Loop\", ind);\n         },\n+        hir::ExprKind::If(ref cond, _, ref else_opt) => {\n+            println!(\"{}If\", ind);\n+            println!(\"{}condition:\", ind);\n+            print_expr(cx, cond, indent + 1);\n+            if let Some(ref els) = *else_opt {\n+                println!(\"{}else:\", ind);\n+                print_expr(cx, els, indent + 1);\n+            }\n+        },\n         hir::ExprKind::Match(ref cond, _, ref source) => {\n             println!(\"{}Match\", ind);\n             println!(\"{}condition:\", ind);"}, {"sha": "bd103246e4ef8ce85e602544eedc613dd9f70f20", "filename": "src/tools/clippy/clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1405,7 +1405,7 @@ pub fn if_sequence<'tcx>(\n     let mut conds = SmallVec::new();\n     let mut blocks: SmallVec<[&Block<'_>; 1]> = SmallVec::new();\n \n-    while let Some((ref cond, ref then_expr, ref else_expr)) = higher::if_block(&expr) {\n+    while let ExprKind::If(ref cond, ref then_expr, ref else_expr) = expr.kind {\n         conds.push(&**cond);\n         if let ExprKind::Block(ref block, _) = then_expr.kind {\n             blocks.push(block);\n@@ -1434,11 +1434,11 @@ pub fn parent_node_is_if_expr(expr: &Expr<'_>, cx: &LateContext<'_>) -> bool {\n     let map = cx.tcx.hir();\n     let parent_id = map.get_parent_node(expr.hir_id);\n     let parent_node = map.get(parent_id);\n-\n-    match parent_node {\n-        Node::Expr(e) => higher::if_block(&e).is_some(),\n-        Node::Arm(e) => higher::if_block(&e.body).is_some(),\n-        _ => false,\n+    if let Node::Expr(Expr { kind: ExprKind::If(_, _, _), .. }) = parent_node {\n+        true\n+    }\n+    else {\n+        false\n     }\n }\n "}, {"sha": "03678db575f0daceef3b58445d55d80c0172b6fd", "filename": "src/tools/clippy/clippy_lints/src/utils/sugg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fsugg.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -103,6 +103,7 @@ impl<'a> Sugg<'a> {\n         match expr.kind {\n             hir::ExprKind::AddrOf(..)\n             | hir::ExprKind::Box(..)\n+            | hir::ExprKind::If(..)\n             | hir::ExprKind::Closure(..)\n             | hir::ExprKind::Unary(..)\n             | hir::ExprKind::Match(..) => Sugg::MaybeParen(snippet),"}, {"sha": "b769a18802b6b8a1292d51af378cf5de8718ed51", "filename": "src/tools/clippy/clippy_lints/src/utils/visitors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fvisitors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fvisitors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fvisitors.rs?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -101,6 +101,13 @@ where\n                 }\n             } else {\n                 match expr.kind {\n+                    hir::ExprKind::If(cond, then, else_opt) => {\n+                        self.inside_stmt(true).visit_expr(cond);\n+                        self.visit_expr(then);\n+                        if let Some(el) = else_opt {\n+                            self.visit_expr(el);\n+                        }\n+                    }\n                     hir::ExprKind::Match(cond, arms, _) => {\n                         self.inside_stmt(true).visit_expr(cond);\n                         for arm in arms {"}, {"sha": "cac64a3f40b41fbd3052577107cdb6fd8cb86779", "filename": "src/tools/clippy/tests/ui/author/if.stdout", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauthor%2Fif.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauthor%2Fif.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauthor%2Fif.stdout?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -1,7 +1,7 @@\n if_chain! {\n     if let StmtKind::Local(ref local) = stmt.kind;\n     if let Some(ref init) = local.init;\n-    if let Some((ref cond, ref then, Some(else_))) = higher::if_block(&init);\n+    if let ExprKind::If(ref cond, ref then, Some(ref else_)) = init.kind;\n     if let ExprKind::Block(ref block) = else_.kind;\n     if let Some(trailing_expr) = &block.expr;\n     if block.stmts.len() == 1;"}, {"sha": "a17f043737d4e009fae59b46d62399e6c8ae3a5d", "filename": "src/tools/clippy/tests/ui/panic_in_result_fn_assertions.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fpanic_in_result_fn_assertions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f85fc264fecf5ab8b16c152dde8a440055323424/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fpanic_in_result_fn_assertions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fpanic_in_result_fn_assertions.stderr?ref=f85fc264fecf5ab8b16c152dde8a440055323424", "patch": "@@ -14,7 +14,7 @@ note: return Err() instead of panicking\n   --> $DIR/panic_in_result_fn_assertions.rs:9:9\n    |\n LL |         assert!(x == 5, \"wrong argument\");\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: used `unimplemented!()`, `unreachable!()`, `todo!()`, `panic!()` or assertion in a function that returns `Result`"}]}