{"sha": "2ee07a19b777149b6723011b361a6324c593438b", "node_id": "C_kwDOAAsO6NoAKDJlZTA3YTE5Yjc3NzE0OWI2NzIzMDExYjM2MWE2MzI0YzU5MzQzOGI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-22T21:44:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-22T21:44:42Z"}, "message": "Rollup merge of #109378 - MU001999:master, r=scottmcm\n\nRemove Ty::is_region_ptr\n\nFixes #109372", "tree": {"sha": "8293dfaca7702570c030d14984e5d9532bfd942c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8293dfaca7702570c030d14984e5d9532bfd942c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ee07a19b777149b6723011b361a6324c593438b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkG3bKCRBK7hj4Ov3rIwAAywEIAFS28MixyIv2oWj6ob/ieGtS\nQTQaaOBmPhUFZf+gP2HL1Y5zB34ZknMr0qRCrISb7CoHw7ebaKt4LjuxzeUUiL0p\n7TNoNICiynzQ5WvbghA8Jbs6KV8fCP7d1459E2eA0FvWOXjvWn6MnJ9Hd/V3ofkC\nZ15t+SoHbmk62zEhHQVBsHXFq85xFJTxVfj4P+znE1OpTye1fA0Qovz5imXAwqga\nxgcPMaZ0uJQCoZa4GBDGMIRZNwK1q4LcL9tjoFkKk5GEKYwMyhDUoMwV5kaGDdIa\n1GRGE3f9Ec4PoXjR87AoYz2Uh+ZHairWmW0046NkyEy/QEUr1JFPAsO1aiNbfLU=\n=oDTQ\n-----END PGP SIGNATURE-----\n", "payload": "tree 8293dfaca7702570c030d14984e5d9532bfd942c\nparent 29d04ff501a9d48c2989144f5cb69ada6092bd45\nparent 20dc53208557db5672a1bcf97b3e582a95913f2c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1679521482 +0100\ncommitter GitHub <noreply@github.com> 1679521482 +0100\n\nRollup merge of #109378 - MU001999:master, r=scottmcm\n\nRemove Ty::is_region_ptr\n\nFixes #109372\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ee07a19b777149b6723011b361a6324c593438b", "html_url": "https://github.com/rust-lang/rust/commit/2ee07a19b777149b6723011b361a6324c593438b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ee07a19b777149b6723011b361a6324c593438b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29d04ff501a9d48c2989144f5cb69ada6092bd45", "url": "https://api.github.com/repos/rust-lang/rust/commits/29d04ff501a9d48c2989144f5cb69ada6092bd45", "html_url": "https://github.com/rust-lang/rust/commit/29d04ff501a9d48c2989144f5cb69ada6092bd45"}, {"sha": "20dc53208557db5672a1bcf97b3e582a95913f2c", "url": "https://api.github.com/repos/rust-lang/rust/commits/20dc53208557db5672a1bcf97b3e582a95913f2c", "html_url": "https://github.com/rust-lang/rust/commit/20dc53208557db5672a1bcf97b3e582a95913f2c"}], "stats": {"total": 36, "additions": 12, "deletions": 24}, "files": [{"sha": "a8c216407f931c01169d2b4204d386afd42c3d92", "filename": "compiler/rustc_borrowck/src/diagnostics/mutability_errors.rs", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -120,9 +120,7 @@ impl<'a, 'tcx> MirBorrowckCtxt<'a, 'tcx> {\n                     && !self.upvars.is_empty()\n                 {\n                     item_msg = access_place_desc;\n-                    debug_assert!(\n-                        self.body.local_decls[ty::CAPTURE_STRUCT_LOCAL].ty.is_region_ptr()\n-                    );\n+                    debug_assert!(self.body.local_decls[ty::CAPTURE_STRUCT_LOCAL].ty.is_ref());\n                     debug_assert!(is_closure_or_generator(\n                         Place::ty_from(\n                             the_place_err.local,\n@@ -470,11 +468,8 @@ impl<'a, 'tcx> MirBorrowckCtxt<'a, 'tcx> {\n             {\n                 let local_decl = &self.body.local_decls[local];\n \n-                let (pointer_sigil, pointer_desc) = if local_decl.ty.is_region_ptr() {\n-                    (\"&\", \"reference\")\n-                } else {\n-                    (\"*const\", \"pointer\")\n-                };\n+                let (pointer_sigil, pointer_desc) =\n+                    if local_decl.ty.is_ref() { (\"&\", \"reference\") } else { (\"*const\", \"pointer\") };\n \n                 match self.local_names[local] {\n                     Some(name) if !local_decl.from_compiler_desugaring() => {\n@@ -1258,7 +1253,7 @@ fn suggest_ampmut<'tcx>(\n     (\n         suggestability,\n         highlight_span,\n-        if local_decl.ty.is_region_ptr() {\n+        if local_decl.ty.is_ref() {\n             format!(\"&mut {}\", ty_mut.ty)\n         } else {\n             format!(\"*mut {}\", ty_mut.ty)"}, {"sha": "94806e0d798ed5a239c40aab8be54d771e453c53", "filename": "compiler/rustc_codegen_cranelift/src/vtable.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvtable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvtable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvtable.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -48,9 +48,7 @@ pub(crate) fn get_ptr_and_method_ref<'tcx>(\n ) -> (Pointer, Value) {\n     let (ptr, vtable) = 'block: {\n         if let Abi::Scalar(_) = arg.layout().abi {\n-            'descend_newtypes: while !arg.layout().ty.is_unsafe_ptr()\n-                && !arg.layout().ty.is_region_ptr()\n-            {\n+            'descend_newtypes: while !arg.layout().ty.is_unsafe_ptr() && !arg.layout().ty.is_ref() {\n                 for i in 0..arg.layout().fields.count() {\n                     let field = arg.value_field(fx, mir::Field::new(i));\n                     if !field.layout().is_zst() {"}, {"sha": "de1e00bd7a3e383b9548df7369baa5b971b58479", "filename": "compiler/rustc_codegen_ssa/src/mir/block.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -917,7 +917,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                         //\n                         // This is also relevant for `Pin<&mut Self>`, where we need to peel the `Pin`.\n                         'descend_newtypes: while !op.layout.ty.is_unsafe_ptr()\n-                            && !op.layout.ty.is_region_ptr()\n+                            && !op.layout.ty.is_ref()\n                         {\n                             for i in 0..op.layout.fields.count() {\n                                 let field = op.extract_field(bx, i);\n@@ -959,7 +959,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                     Immediate(_) => {\n                         // See comment above explaining why we peel these newtypes\n                         'descend_newtypes: while !op.layout.ty.is_unsafe_ptr()\n-                            && !op.layout.ty.is_region_ptr()\n+                            && !op.layout.ty.is_ref()\n                         {\n                             for i in 0..op.layout.fields.count() {\n                                 let field = op.extract_field(bx, i);"}, {"sha": "4846579b9809b041487a705ca652c97e5c0ace36", "filename": "compiler/rustc_hir_typeck/src/demand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fdemand.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -1487,7 +1487,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     {\n                         let deref_kind = if checked_ty.is_box() {\n                             \"unboxing the value\"\n-                        } else if checked_ty.is_region_ptr() {\n+                        } else if checked_ty.is_ref() {\n                             \"dereferencing the borrow\"\n                         } else {\n                             \"dereferencing the type\""}, {"sha": "b219be4ae199219a6980f35b5e9070ab76298c41", "filename": "compiler/rustc_hir_typeck/src/method/suggest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -1182,7 +1182,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                 .inputs()\n                                 .skip_binder()\n                                 .get(0)\n-                                .filter(|ty| ty.is_region_ptr() && !rcvr_ty.is_region_ptr())\n+                                .filter(|ty| ty.is_ref() && !rcvr_ty.is_ref())\n                                 .copied()\n                                 .unwrap_or(rcvr_ty),\n                         };"}, {"sha": "35a581d314cd471ce76a21715f409083a53c1287", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -1925,11 +1925,6 @@ impl<'tcx> Ty<'tcx> {\n         }\n     }\n \n-    #[inline]\n-    pub fn is_region_ptr(self) -> bool {\n-        matches!(self.kind(), Ref(..))\n-    }\n-\n     #[inline]\n     pub fn is_mutable_ptr(self) -> bool {\n         matches!(\n@@ -1956,7 +1951,7 @@ impl<'tcx> Ty<'tcx> {\n     /// Tests if this is any kind of primitive pointer type (reference, raw pointer, fn pointer).\n     #[inline]\n     pub fn is_any_ptr(self) -> bool {\n-        self.is_region_ptr() || self.is_unsafe_ptr() || self.is_fn_ptr()\n+        self.is_ref() || self.is_unsafe_ptr() || self.is_fn_ptr()\n     }\n \n     #[inline]"}, {"sha": "6fd9b9dbb5755f106e54cf42f4ac249e3fb159fd", "filename": "compiler/rustc_mir_build/src/thir/cx/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -185,7 +185,7 @@ impl<'tcx> Cx<'tcx> {\n         if self.typeck_results().is_coercion_cast(source.hir_id) {\n             // Convert the lexpr to a vexpr.\n             ExprKind::Use { source: self.mirror_expr(source) }\n-        } else if self.typeck_results().expr_ty(source).is_region_ptr() {\n+        } else if self.typeck_results().expr_ty(source).is_ref() {\n             // Special cased so that we can type check that the element\n             // type of the source matches the pointed to type of the\n             // destination."}, {"sha": "ee5a7909ba3dc66c3d88c5b9238e850ccd67834a", "filename": "compiler/rustc_ty_utils/src/abi.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_ty_utils%2Fsrc%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee07a19b777149b6723011b361a6324c593438b/compiler%2Frustc_ty_utils%2Fsrc%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fabi.rs?ref=2ee07a19b777149b6723011b361a6324c593438b", "patch": "@@ -539,7 +539,7 @@ fn make_thin_self_ptr<'tcx>(\n         // get a built-in pointer type\n         let mut fat_pointer_layout = layout;\n         'descend_newtypes: while !fat_pointer_layout.ty.is_unsafe_ptr()\n-            && !fat_pointer_layout.ty.is_region_ptr()\n+            && !fat_pointer_layout.ty.is_ref()\n         {\n             for i in 0..fat_pointer_layout.fields.count() {\n                 let field_layout = fat_pointer_layout.field(cx, i);"}]}