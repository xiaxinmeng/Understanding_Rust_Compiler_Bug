{"sha": "8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlODk5YjFjYmU2MjA5ODQyZTExMmYwYjdlYzQ1MGEzY2RmZGIzNmQ=", "commit": {"author": {"name": "Caleb Zulawski", "email": "caleb.zulawski@gmail.com", "date": "2020-06-27T19:51:51Z"}, "committer": {"name": "Caleb Zulawski", "email": "caleb.zulawski@gmail.com", "date": "2020-06-27T19:51:51Z"}, "message": "Don't implement Fn* for unsafe #[target_feature] functions", "tree": {"sha": "8a98b6d03be1b23acc8a53603ecaa15cbcd427ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a98b6d03be1b23acc8a53603ecaa15cbcd427ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "html_url": "https://github.com/rust-lang/rust/commit/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d/comments", "author": {"login": "calebzulawski", "id": 563826, "node_id": "MDQ6VXNlcjU2MzgyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/563826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebzulawski", "html_url": "https://github.com/calebzulawski", "followers_url": "https://api.github.com/users/calebzulawski/followers", "following_url": "https://api.github.com/users/calebzulawski/following{/other_user}", "gists_url": "https://api.github.com/users/calebzulawski/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebzulawski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebzulawski/subscriptions", "organizations_url": "https://api.github.com/users/calebzulawski/orgs", "repos_url": "https://api.github.com/users/calebzulawski/repos", "events_url": "https://api.github.com/users/calebzulawski/events{/privacy}", "received_events_url": "https://api.github.com/users/calebzulawski/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebzulawski", "id": 563826, "node_id": "MDQ6VXNlcjU2MzgyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/563826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebzulawski", "html_url": "https://github.com/calebzulawski", "followers_url": "https://api.github.com/users/calebzulawski/followers", "following_url": "https://api.github.com/users/calebzulawski/following{/other_user}", "gists_url": "https://api.github.com/users/calebzulawski/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebzulawski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebzulawski/subscriptions", "organizations_url": "https://api.github.com/users/calebzulawski/orgs", "repos_url": "https://api.github.com/users/calebzulawski/repos", "events_url": "https://api.github.com/users/calebzulawski/events{/privacy}", "received_events_url": "https://api.github.com/users/calebzulawski/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c98b4c8fdde7812d7af5a060a1e22fd7e3775d3f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c98b4c8fdde7812d7af5a060a1e22fd7e3775d3f", "html_url": "https://github.com/rust-lang/rust/commit/c98b4c8fdde7812d7af5a060a1e22fd7e3775d3f"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "76e01a40a2362484fa8afbd294974c8c2353d6d0", "filename": "src/librustc_trait_selection/traits/error_reporting/mod.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "patch": "@@ -292,11 +292,9 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             self.tcx.lang_items().fn_once_trait(),\n                         ]\n                         .contains(&Some(trait_ref.def_id()));\n-                        let is_safe_target_feature_fn =\n+                        let is_target_feature_fn =\n                             if let ty::FnDef(def_id, _) = trait_ref.skip_binder().self_ty().kind {\n-                                trait_ref.skip_binder().self_ty().fn_sig(self.tcx).unsafety()\n-                                    == hir::Unsafety::Normal\n-                                    && !self.tcx.codegen_fn_attrs(def_id).target_features.is_empty()\n+                                !self.tcx.codegen_fn_attrs(def_id).target_features.is_empty()\n                             } else {\n                                 false\n                             };\n@@ -441,7 +439,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             );\n                         }\n \n-                        if is_fn_trait && is_safe_target_feature_fn {\n+                        if is_fn_trait && is_target_feature_fn {\n                             err.note(&format!(\n                                 \"`{}` has `#[target_feature]` and is unsafe to call\",\n                                 trait_ref.skip_binder().self_ty(),"}, {"sha": "ba3d2eac1a6b0eff2cccd0845504c28ac9d4db6b", "filename": "src/test/ui/rfcs/rfc-2396-target_feature-11/fn-traits.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d/src%2Ftest%2Fui%2Frfcs%2Frfc-2396-target_feature-11%2Ffn-traits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8e899b1cbe6209842e112f0b7ec450a3cdfdb36d/src%2Ftest%2Fui%2Frfcs%2Frfc-2396-target_feature-11%2Ffn-traits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfcs%2Frfc-2396-target_feature-11%2Ffn-traits.stderr?ref=8e899b1cbe6209842e112f0b7ec450a3cdfdb36d", "patch": "@@ -48,6 +48,7 @@ LL |     call(foo_unsafe);\n    |\n    = help: the trait `std::ops::Fn<()>` is not implemented for `unsafe fn() {foo_unsafe}`\n    = note: wrap the `unsafe fn() {foo_unsafe}` in a closure with no arguments: `|| { /* code */ }\n+   = note: `unsafe fn() {foo_unsafe}` has `#[target_feature]` and is unsafe to call\n \n error[E0277]: expected a `std::ops::FnMut<()>` closure, found `unsafe fn() {foo_unsafe}`\n   --> $DIR/fn-traits.rs:30:14\n@@ -60,6 +61,7 @@ LL |     call_mut(foo_unsafe);\n    |\n    = help: the trait `std::ops::FnMut<()>` is not implemented for `unsafe fn() {foo_unsafe}`\n    = note: wrap the `unsafe fn() {foo_unsafe}` in a closure with no arguments: `|| { /* code */ }\n+   = note: `unsafe fn() {foo_unsafe}` has `#[target_feature]` and is unsafe to call\n \n error[E0277]: expected a `std::ops::FnOnce<()>` closure, found `unsafe fn() {foo_unsafe}`\n   --> $DIR/fn-traits.rs:32:15\n@@ -72,6 +74,7 @@ LL |     call_once(foo_unsafe);\n    |\n    = help: the trait `std::ops::FnOnce<()>` is not implemented for `unsafe fn() {foo_unsafe}`\n    = note: wrap the `unsafe fn() {foo_unsafe}` in a closure with no arguments: `|| { /* code */ }\n+   = note: `unsafe fn() {foo_unsafe}` has `#[target_feature]` and is unsafe to call\n \n error: aborting due to 6 previous errors\n "}]}