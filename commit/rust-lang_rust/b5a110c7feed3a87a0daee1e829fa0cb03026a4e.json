{"sha": "b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1YTExMGM3ZmVlZDNhODdhMGRhZWUxZTgyOWZhMGNiMDMwMjZhNGU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-18T21:01:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-18T21:01:47Z"}, "message": "auto merge of #11607 : alexcrichton/rust/issue-9957, r=cmr\n\nFor `use` statements, this means disallowing qualifiers when in functions and\r\ndisallowing `priv` outside of functions.\r\n\r\nFor `extern mod` statements, this means disallowing everything everywhere. It\r\nmay have been envisioned for `pub extern mod foo` to be a thing, but it\r\ncurrently doesn't do anything (resolve doesn't pick it up), so better to err on\r\nthe side of forwards-compatibility and forbid it entirely for now.\r\n\r\nCloses #9957", "tree": {"sha": "3844da3af36ea7c9932b6074348c923e333aa51f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3844da3af36ea7c9932b6074348c923e333aa51f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "html_url": "https://github.com/rust-lang/rust/commit/b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5d05acf392afc9c480ee7b23f2132c1a110de8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5d05acf392afc9c480ee7b23f2132c1a110de8c", "html_url": "https://github.com/rust-lang/rust/commit/c5d05acf392afc9c480ee7b23f2132c1a110de8c"}, {"sha": "4a78364d491ee2d3a49f4ed5e62f63cd5748d898", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a78364d491ee2d3a49f4ed5e62f63cd5748d898", "html_url": "https://github.com/rust-lang/rust/commit/4a78364d491ee2d3a49f4ed5e62f63cd5748d898"}], "stats": {"total": 61, "additions": 55, "deletions": 6}, "files": [{"sha": "c1c31dc310e17bd6fb0ab4cf6b9d5a67b18efc40", "filename": "src/librustc/front/std_inject.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Ffront%2Fstd_inject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Ffront%2Fstd_inject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Fstd_inject.rs?ref=b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "patch": "@@ -73,7 +73,7 @@ impl fold::Folder for StandardLibraryInjector {\n                                          with_version(\"std\"),\n                                          ast::DUMMY_NODE_ID),\n             attrs: ~[],\n-            vis: ast::Private,\n+            vis: ast::Inherited,\n             span: DUMMY_SP\n         }];\n \n@@ -83,15 +83,15 @@ impl fold::Folder for StandardLibraryInjector {\n                                              with_version(\"green\"),\n                                              ast::DUMMY_NODE_ID),\n                 attrs: ~[],\n-                vis: ast::Private,\n+                vis: ast::Inherited,\n                 span: DUMMY_SP\n             });\n             vis.push(ast::ViewItem {\n                 node: ast::ViewItemExternMod(self.sess.ident_of(\"rustuv\"),\n                                              with_version(\"rustuv\"),\n                                              ast::DUMMY_NODE_ID),\n                 attrs: ~[],\n-                vis: ast::Private,\n+                vis: ast::Inherited,\n                 span: DUMMY_SP\n             });\n         }\n@@ -147,7 +147,7 @@ impl fold::Folder for StandardLibraryInjector {\n         let vi2 = ast::ViewItem {\n             node: ast::ViewItemUse(~[vp]),\n             attrs: ~[],\n-            vis: ast::Private,\n+            vis: ast::Inherited,\n             span: DUMMY_SP,\n         };\n "}, {"sha": "0714c1c620bb16849da8c76e6a64ebc8c93e48e1", "filename": "src/librustc/front/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Ffront%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Ffront%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Ftest.rs?ref=b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "patch": "@@ -301,7 +301,7 @@ fn mk_std(cx: &TestCtxt) -> ast::ViewItem {\n     ast::ViewItem {\n         node: vi,\n         attrs: ~[],\n-        vis: ast::Public,\n+        vis: ast::Inherited,\n         span: DUMMY_SP\n     }\n }"}, {"sha": "4318fde9b3a54e49882c1bc7f73faf7573e1cc00", "filename": "src/librustc/middle/privacy.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Fmiddle%2Fprivacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibrustc%2Fmiddle%2Fprivacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fprivacy.rs?ref=b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "patch": "@@ -839,6 +839,32 @@ impl Visitor<()> for SanePrivacyVisitor {\n         visit::walk_fn(self, fk, fd, b, s, n, ());\n         self.in_fn = orig_in_fn;\n     }\n+\n+    fn visit_view_item(&mut self, i: &ast::ViewItem, _: ()) {\n+        match i.vis {\n+            ast::Inherited => {}\n+            ast::Private => {\n+                self.tcx.sess.span_err(i.span, \"unnecessary visibility \\\n+                                                qualifier\");\n+            }\n+            ast::Public => {\n+                if self.in_fn {\n+                    self.tcx.sess.span_err(i.span, \"unnecessary `pub`, imports \\\n+                                                    in functions are never \\\n+                                                    reachable\");\n+                } else {\n+                    match i.node {\n+                        ast::ViewItemExternMod(..) => {\n+                            self.tcx.sess.span_err(i.span, \"`pub` visibility \\\n+                                                            is not allowed\");\n+                        }\n+                        _ => {}\n+                    }\n+                }\n+            }\n+        }\n+        visit::walk_view_item(self, i, ());\n+    }\n }\n \n impl SanePrivacyVisitor {"}, {"sha": "8b5e68728395e785de0a0b789073e0035171cf01", "filename": "src/libsyntax/ext/quote.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibsyntax%2Fext%2Fquote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Flibsyntax%2Fext%2Fquote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fquote.rs?ref=b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "patch": "@@ -648,7 +648,7 @@ fn expand_wrapper(cx: &ExtCtxt,\n                   sp: Span,\n                   cx_expr: @ast::Expr,\n                   expr: @ast::Expr) -> @ast::Expr {\n-    let uses = ~[ cx.view_use_glob(sp, ast::Public,\n+    let uses = ~[ cx.view_use_glob(sp, ast::Inherited,\n                                    ids_ext(~[~\"syntax\",\n                                              ~\"ext\",\n                                              ~\"quote\","}, {"sha": "b8292d617525e92fb2d7c70bd780d61f36966e4b", "filename": "src/test/compile-fail/issue-9957.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Ftest%2Fcompile-fail%2Fissue-9957.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5a110c7feed3a87a0daee1e829fa0cb03026a4e/src%2Ftest%2Fcompile-fail%2Fissue-9957.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-9957.rs?ref=b5a110c7feed3a87a0daee1e829fa0cb03026a4e", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+pub extern mod std; //~ ERROR: `pub` visibility is not allowed\n+priv extern mod std; //~ ERROR: unnecessary visibility qualifier\n+extern mod std;\n+\n+pub use std::bool;\n+priv use std::bool; //~ ERROR: unnecessary visibility qualifier\n+use std::bool;\n+\n+fn main() {\n+    pub use std::bool; //~ ERROR: imports in functions are never reachable\n+    priv use std::bool; //~ ERROR: unnecessary visibility qualifier\n+    use std::bool;\n+}"}]}