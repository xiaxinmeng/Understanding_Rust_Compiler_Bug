{"sha": "e961d397cab900c55f8d8c104648852e2b63664e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5NjFkMzk3Y2FiOTAwYzU1ZjhkOGMxMDQ2NDg4NTJlMmI2MzY2NGU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-10-08T20:51:37Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-10-09T20:55:18Z"}, "message": "Add line numbers option to rustdoc", "tree": {"sha": "cf80f9625fe0d2baf192a6e2c2017705785a4c99", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf80f9625fe0d2baf192a6e2c2017705785a4c99"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e961d397cab900c55f8d8c104648852e2b63664e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e961d397cab900c55f8d8c104648852e2b63664e", "html_url": "https://github.com/rust-lang/rust/commit/e961d397cab900c55f8d8c104648852e2b63664e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e961d397cab900c55f8d8c104648852e2b63664e/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb50e75729bce449272ffb3bfbca2f7234f2ae13", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb50e75729bce449272ffb3bfbca2f7234f2ae13", "html_url": "https://github.com/rust-lang/rust/commit/eb50e75729bce449272ffb3bfbca2f7234f2ae13"}], "stats": {"total": 82, "additions": 68, "deletions": 14}, "files": [{"sha": "bd4cfe51ea72fa9822e980e5841c6a87812f2b70", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -28,9 +28,12 @@ use syntax::parse;\n use syntax_pos::{Span, FileName};\n \n /// Highlights `src`, returning the HTML output.\n-pub fn render_with_highlighting(src: &str, class: Option<&str>,\n-                                extension: Option<&str>,\n-                                tooltip: Option<(&str, &str)>) -> String {\n+pub fn render_with_highlighting(\n+    src: &str,\n+    class: Option<&str>,\n+    extension: Option<&str>,\n+    tooltip: Option<(&str, &str)>,\n+) -> String {\n     debug!(\"highlighting: ================\\n{}\\n==============\", src);\n     let sess = parse::ParseSess::new(FilePathMapping::empty());\n     let fm = sess.source_map().new_source_file(FileName::Custom(\"stdin\".to_string()),\n@@ -373,9 +376,9 @@ impl Class {\n }\n \n fn write_header(class: Option<&str>, out: &mut dyn Write) -> io::Result<()> {\n-    write!(out, \"<pre class=\\\"rust {}\\\">\\n\", class.unwrap_or(\"\"))\n+    write!(out, \"<div class=\\\"example-wrap\\\"><pre class=\\\"rust {}\\\">\\n\", class.unwrap_or(\"\"))\n }\n \n fn write_footer(out: &mut dyn Write) -> io::Result<()> {\n-    write!(out, \"</pre>\\n\")\n+    write!(out, \"</pre></div>\\n\")\n }"}, {"sha": "c83c5d382ddcc94e430d2db321cce4591b43c79f", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -1709,6 +1709,7 @@ impl<'a> Settings<'a> {\n                 (\"method-docs\", \"Auto-hide item methods' documentation\", false),\n                 (\"go-to-only-result\", \"Directly go to item in search if there is only one result\",\n                  false),\n+                (\"line-numbers\", \"Show line numbers on code examples\", false),\n             ],\n             root_path,\n             suffix,"}, {"sha": "9d1a5c38378308f6a6ca4c1ccb096b003d2e70ab", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 33, "deletions": 9, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -2093,6 +2093,7 @@\n         return wrapper;\n     }\n \n+    var hideItemDeclarations = getCurrentValue('rustdoc-item-declarations') === \"false\";\n     onEach(document.getElementsByClassName('docblock'), function(e) {\n         if (hasClass(e, 'autohide')) {\n             var wrap = e.previousElementSibling;\n@@ -2116,16 +2117,14 @@\n             }\n         }\n         if (e.parentNode.id === \"main\") {\n-            var otherMessage;\n+            var otherMessage = '';\n             var fontSize;\n             var extraClass;\n-            var show = true;\n \n             if (hasClass(e, \"type-decl\")) {\n                 fontSize = \"20px\";\n                 otherMessage = '&nbsp;Show&nbsp;declaration';\n-                show = getCurrentValue('rustdoc-item-declarations') === \"false\";\n-                if (!show) {\n+                if (hideItemDeclarations === false) {\n                     extraClass = 'collapsed';\n                 }\n             } else if (hasClass(e, \"non-exhaustive\")) {\n@@ -2142,8 +2141,12 @@\n                 extraClass = \"marg-left\";\n             }\n \n-            e.parentNode.insertBefore(createToggle(otherMessage, fontSize, extraClass, show), e);\n-            if (otherMessage && show) {\n+            e.parentNode.insertBefore(createToggle(otherMessage,\n+                                                   fontSize,\n+                                                   extraClass,\n+                                                   hideItemDeclarations),\n+                                      e);\n+            if (otherMessage.length > 0 && hideItemDeclarations === true) {\n                 collapseDocs(e.previousSibling.childNodes[0], \"toggle\");\n             }\n         }\n@@ -2186,13 +2189,33 @@\n         });\n     }\n \n+    // To avoid checking on \"rustdoc-item-attributes\" value on every loop...\n+    var itemAttributesFunc = function() {};\n+    if (getCurrentValue(\"rustdoc-item-attributes\") !== \"false\") {\n+        itemAttributesFunc = function(x) {\n+            collapseDocs(x.previousSibling.childNodes[0], \"toggle\");\n+        };\n+    }\n     onEach(document.getElementById('main').getElementsByClassName('attributes'), function(i_e) {\n         i_e.parentNode.insertBefore(createToggleWrapper(toggle.cloneNode(true)), i_e);\n-        if (getCurrentValue(\"rustdoc-item-attributes\") !== \"false\") {\n-            collapseDocs(i_e.previousSibling.childNodes[0], \"toggle\");\n-        }\n+        itemAttributesFunc(i_e);\n     });\n \n+    // To avoid checking on \"rustdoc-line-numbers\" value on every loop...\n+    var lineNumbersFunc = function() {};\n+    if (getCurrentValue(\"rustdoc-line-numbers\") === \"true\") {\n+        lineNumbersFunc = function(x) {\n+            var count = x.textContent.split('\\n').length;\n+            var elems = [];\n+            for (var i = 0; i < count; ++i) {\n+                elems.push(i + 1);\n+            }\n+            var node = document.createElement('pre');\n+            addClass(node, 'line-number');\n+            node.innerHTML = elems.join('\\n');\n+            x.parentNode.insertBefore(node, x);\n+        };\n+    }\n     onEach(document.getElementsByClassName('rust-example-rendered'), function(e) {\n         if (hasClass(e, 'compile_fail')) {\n             e.addEventListener(\"mouseover\", function(event) {\n@@ -2209,6 +2232,7 @@\n                 e.previousElementSibling.childNodes[0].style.color = '';\n             });\n         }\n+        lineNumbersFunc(e);\n     });\n \n     function showModal(content) {"}, {"sha": "5817a22574953133f717df0867f0e02f03ec7d94", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -283,6 +283,24 @@ nav.sub {\n \tpadding-left: 0;\n }\n \n+.example-wrap {\n+\tdisplay: inline-flex;\n+\twidth: 100%;\n+}\n+\n+.example-wrap > pre.line-number {\n+\toverflow: initial;\n+\tborder: 1px solid;\n+\tborder-top-left-radius: 5px;\n+\tborder-bottom-left-radius: 5px;\n+\tpadding: 13px 8px;\n+\ttext-align: right;\n+}\n+\n+.example-wrap > pre.rust {\n+\twidth: 100%;\n+}\n+\n #search {\n \tmargin-left: 230px;\n \tposition: relative;"}, {"sha": "e179c4586bc742b0d3522ff6bb285354eb2690fa", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -233,6 +233,10 @@ pre.rust .question-mark {\n \tcolor: #ff9011;\n }\n \n+.example-wrap > pre.line-number {\n+\tborder-color: #4a4949;\n+}\n+\n a.test-arrow {\n \tbackground-color: rgba(78, 139, 202, 0.2);\n }"}, {"sha": "6ef9875ea2d4d1ff1b819ba58dab983c286d775d", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/e961d397cab900c55f8d8c104648852e2b63664e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=e961d397cab900c55f8d8c104648852e2b63664e", "patch": "@@ -227,6 +227,10 @@ pre.rust .question-mark {\n \tcolor: #ff9011;\n }\n \n+.example-wrap > pre.line-number {\n+\tborder-color: #c7c7c7;\n+}\n+\n a.test-arrow {\n \tbackground-color: rgba(78, 139, 202, 0.2);\n }"}]}