{"sha": "ebf03363f2d2385bc2248549cd93fca42779699a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViZjAzMzYzZjJkMjM4NWJjMjI0ODU0OWNkOTNmY2E0Mjc3OTY5OWE=", "commit": {"author": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-11-13T14:36:05Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-11-24T10:36:31Z"}, "message": "Properly test for int pointers in fat pointers to str slices of zero chars", "tree": {"sha": "0c14a447bc384ebdd9fa7fabe0c342961d41b3d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c14a447bc384ebdd9fa7fabe0c342961d41b3d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebf03363f2d2385bc2248549cd93fca42779699a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebf03363f2d2385bc2248549cd93fca42779699a", "html_url": "https://github.com/rust-lang/rust/commit/ebf03363f2d2385bc2248549cd93fca42779699a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebf03363f2d2385bc2248549cd93fca42779699a/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc2f46e55a3fe52affe0dd4aee2ececd75c78031", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2f46e55a3fe52affe0dd4aee2ececd75c78031", "html_url": "https://github.com/rust-lang/rust/commit/cc2f46e55a3fe52affe0dd4aee2ececd75c78031"}], "stats": {"total": 33, "additions": 12, "deletions": 21}, "files": [{"sha": "809cc15be0c3f984e8d9ec5a7c667be9a0274912", "filename": "src/test/ui/consts/int_ptr_for_zst_slices.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ebf03363f2d2385bc2248549cd93fca42779699a/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebf03363f2d2385bc2248549cd93fca42779699a/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.rs?ref=ebf03363f2d2385bc2248549cd93fca42779699a", "patch": "@@ -1,3 +1,6 @@\n-const FOO: &str = unsafe { &*(1_usize as *const [u8; 0] as *const [u8] as *const [str]) };\n+#![feature(const_raw_ptr_deref)]\n \n-fn main() {}\n\\ No newline at end of file\n+const FOO: &str = unsafe { &*(1_usize as *const [u8; 0] as *const [u8] as *const str) };\n+//~^ ERROR it is undefined behaviour to use this value\n+\n+fn main() {}"}, {"sha": "437e6952e740a306c81b47c465f8f629aa163455", "filename": "src/test/ui/consts/int_ptr_for_zst_slices.stderr", "status": "modified", "additions": 7, "deletions": 19, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ebf03363f2d2385bc2248549cd93fca42779699a/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ebf03363f2d2385bc2248549cd93fca42779699a/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fint_ptr_for_zst_slices.stderr?ref=ebf03363f2d2385bc2248549cd93fca42779699a", "patch": "@@ -1,23 +1,11 @@\n-error[E0308]: mismatched types\n-  --> $DIR/int_ptr_for_zst_slices.rs:1:28\n+error[E0080]: it is undefined behavior to use this value\n+  --> $DIR/int_ptr_for_zst_slices.rs:3:1\n    |\n-LL | const FOO: &str = unsafe { &*(1_usize as *const [u8; 0] as *const [u8] as *const [str]) };\n-   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected str, found slice\n+LL | const FOO: &str = unsafe { &*(1_usize as *const [u8; 0] as *const [u8] as *const str) };\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered uninitialized or non-UTF-8 data in str at .<deref>\n    |\n-   = note: expected type `&'static str`\n-              found type `&[str]`\n+   = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n \n-error[E0277]: the size for values of type `str` cannot be known at compilation time\n-  --> $DIR/int_ptr_for_zst_slices.rs:1:75\n-   |\n-LL | const FOO: &str = unsafe { &*(1_usize as *const [u8; 0] as *const [u8] as *const [str]) };\n-   |                                                                           ^^^^^^^^^^^^ doesn't have a size known at compile-time\n-   |\n-   = help: the trait `std::marker::Sized` is not implemented for `str`\n-   = note: to learn more, visit <https://doc.rust-lang.org/book/second-edition/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait>\n-   = note: slice and array elements must have `Sized` type\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n-Some errors occurred: E0277, E0308.\n-For more information about an error, try `rustc --explain E0277`.\n+For more information about this error, try `rustc --explain E0080`."}]}