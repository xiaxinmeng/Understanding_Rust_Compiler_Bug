{"sha": "5793fa9cda2178659768908dda4d6198f43cda08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU3OTNmYTljZGEyMTc4NjU5NzY4OTA4ZGRhNGQ2MTk4ZjQzY2RhMDg=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-22T22:01:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-22T22:01:02Z"}, "message": "Rollup merge of #79267 - ssomers:btree_namespaces, r=Mark-Simulacrum\n\nBTreeMap: address namespace conflicts\n\nFix an annoyance popping up whenever synchronizing the test cases with a version capable of miri-track-raw-pointers.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "b67969ef7c32b659c3f863596fde51ee7b974de6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b67969ef7c32b659c3f863596fde51ee7b974de6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5793fa9cda2178659768908dda4d6198f43cda08", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfut+eCRBK7hj4Ov3rIwAAdHIIAKXIgBkhX8D/LiaD40EhSWmq\nD6U/VcOu/iN8lwTPfPEvwfMaasNhPXbpJKNrTG5KW1p51zOYpl7MMYWKkIIxUJ7w\nF6pj1LuG1qqte4uX4tlpb0+Q3h+qvPOOSLi2ET/eUk85delQ6p/bAYPI+H++M17q\nAvNA6MuzWliI61Uuig7nOwgvGgEPPnre6CGxDtweQ0TmliNWyK3i7wH6GOfpClye\nhFjj8TFjhzCqTMvj/LTzQ9A/QIzI+YVvgCuXgxQc5QRhOo7bLFvbvxFi+wJw3+Vl\niroSpigJoMrzRV0cuU741SP0ldVgcJATFOhpp7EhHeNvquKioeqz5A9unUlgfqw=\n=QF8M\n-----END PGP SIGNATURE-----\n", "payload": "tree b67969ef7c32b659c3f863596fde51ee7b974de6\nparent 8a623e6f98787689381a52308acb4925a358f05b\nparent 0f005c2241df6433a8dd0ea5f185d0143c10c8f5\nauthor Mara Bos <m-ou.se@m-ou.se> 1606082462 +0100\ncommitter GitHub <noreply@github.com> 1606082462 +0100\n\nRollup merge of #79267 - ssomers:btree_namespaces, r=Mark-Simulacrum\n\nBTreeMap: address namespace conflicts\n\nFix an annoyance popping up whenever synchronizing the test cases with a version capable of miri-track-raw-pointers.\n\nr? `@Mark-Simulacrum`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5793fa9cda2178659768908dda4d6198f43cda08", "html_url": "https://github.com/rust-lang/rust/commit/5793fa9cda2178659768908dda4d6198f43cda08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5793fa9cda2178659768908dda4d6198f43cda08/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a623e6f98787689381a52308acb4925a358f05b", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a623e6f98787689381a52308acb4925a358f05b", "html_url": "https://github.com/rust-lang/rust/commit/8a623e6f98787689381a52308acb4925a358f05b"}, {"sha": "0f005c2241df6433a8dd0ea5f185d0143c10c8f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f005c2241df6433a8dd0ea5f185d0143c10c8f5", "html_url": "https://github.com/rust-lang/rust/commit/0f005c2241df6433a8dd0ea5f185d0143c10c8f5"}], "stats": {"total": 68, "additions": 33, "deletions": 35}, "files": [{"sha": "8c7913b533b5f2a16945c572f3fd04cd46ccbfa6", "filename": "library/alloc/src/collections/btree/map/tests.rs", "status": "modified", "additions": 22, "deletions": 23, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs?ref=5793fa9cda2178659768908dda4d6198f43cda08", "patch": "@@ -6,13 +6,14 @@ use crate::fmt::Debug;\n use crate::rc::Rc;\n use crate::string::{String, ToString};\n use crate::vec::Vec;\n+use std::cmp::Ordering;\n use std::convert::TryFrom;\n use std::iter::{self, FromIterator};\n use std::mem;\n use std::ops::Bound::{self, Excluded, Included, Unbounded};\n use std::ops::RangeBounds;\n use std::panic::{catch_unwind, AssertUnwindSafe};\n-use std::sync::atomic::{AtomicUsize, Ordering};\n+use std::sync::atomic::{AtomicUsize, Ordering::SeqCst};\n \n mod ord_chaos;\n use ord_chaos::{Cyclic3, Governed, Governor};\n@@ -1094,7 +1095,7 @@ mod test_drain_filter {\n         struct D;\n         impl Drop for D {\n             fn drop(&mut self) {\n-                if DROPS.fetch_add(1, Ordering::SeqCst) == 1 {\n+                if DROPS.fetch_add(1, SeqCst) == 1 {\n                     panic!(\"panic in `drop`\");\n                 }\n             }\n@@ -1105,14 +1106,14 @@ mod test_drain_filter {\n \n         catch_unwind(move || {\n             drop(map.drain_filter(|i, _| {\n-                PREDS.fetch_add(1usize << i, Ordering::SeqCst);\n+                PREDS.fetch_add(1usize << i, SeqCst);\n                 true\n             }))\n         })\n         .unwrap_err();\n \n-        assert_eq!(PREDS.load(Ordering::SeqCst), 0x011);\n-        assert_eq!(DROPS.load(Ordering::SeqCst), 3);\n+        assert_eq!(PREDS.load(SeqCst), 0x011);\n+        assert_eq!(DROPS.load(SeqCst), 3);\n     }\n \n     #[test]\n@@ -1123,7 +1124,7 @@ mod test_drain_filter {\n         struct D;\n         impl Drop for D {\n             fn drop(&mut self) {\n-                DROPS.fetch_add(1, Ordering::SeqCst);\n+                DROPS.fetch_add(1, SeqCst);\n             }\n         }\n \n@@ -1132,7 +1133,7 @@ mod test_drain_filter {\n \n         catch_unwind(AssertUnwindSafe(|| {\n             drop(map.drain_filter(|i, _| {\n-                PREDS.fetch_add(1usize << i, Ordering::SeqCst);\n+                PREDS.fetch_add(1usize << i, SeqCst);\n                 match i {\n                     0 => true,\n                     _ => panic!(),\n@@ -1141,8 +1142,8 @@ mod test_drain_filter {\n         }))\n         .unwrap_err();\n \n-        assert_eq!(PREDS.load(Ordering::SeqCst), 0x011);\n-        assert_eq!(DROPS.load(Ordering::SeqCst), 1);\n+        assert_eq!(PREDS.load(SeqCst), 0x011);\n+        assert_eq!(DROPS.load(SeqCst), 1);\n         assert_eq!(map.len(), 2);\n         assert_eq!(map.first_entry().unwrap().key(), &4);\n         assert_eq!(map.last_entry().unwrap().key(), &8);\n@@ -1158,7 +1159,7 @@ mod test_drain_filter {\n         struct D;\n         impl Drop for D {\n             fn drop(&mut self) {\n-                DROPS.fetch_add(1, Ordering::SeqCst);\n+                DROPS.fetch_add(1, SeqCst);\n             }\n         }\n \n@@ -1167,7 +1168,7 @@ mod test_drain_filter {\n \n         {\n             let mut it = map.drain_filter(|i, _| {\n-                PREDS.fetch_add(1usize << i, Ordering::SeqCst);\n+                PREDS.fetch_add(1usize << i, SeqCst);\n                 match i {\n                     0 => true,\n                     _ => panic!(),\n@@ -1180,8 +1181,8 @@ mod test_drain_filter {\n             assert!(matches!(result, Ok(None)));\n         }\n \n-        assert_eq!(PREDS.load(Ordering::SeqCst), 0x011);\n-        assert_eq!(DROPS.load(Ordering::SeqCst), 1);\n+        assert_eq!(PREDS.load(SeqCst), 0x011);\n+        assert_eq!(DROPS.load(SeqCst), 1);\n         assert_eq!(map.len(), 2);\n         assert_eq!(map.first_entry().unwrap().key(), &4);\n         assert_eq!(map.last_entry().unwrap().key(), &8);\n@@ -1315,8 +1316,6 @@ fn test_zst() {\n // undefined.\n #[test]\n fn test_bad_zst() {\n-    use std::cmp::Ordering;\n-\n     #[derive(Clone, Copy, Debug)]\n     struct Bad;\n \n@@ -1763,7 +1762,7 @@ fn test_append_drop_leak() {\n \n     impl Drop for D {\n         fn drop(&mut self) {\n-            if DROPS.fetch_add(1, Ordering::SeqCst) == 0 {\n+            if DROPS.fetch_add(1, SeqCst) == 0 {\n                 panic!(\"panic in `drop`\");\n             }\n         }\n@@ -1779,7 +1778,7 @@ fn test_append_drop_leak() {\n \n     catch_unwind(move || left.append(&mut right)).unwrap_err();\n \n-    assert_eq!(DROPS.load(Ordering::SeqCst), 4); // Rust issue #47949 ate one little piggy\n+    assert_eq!(DROPS.load(SeqCst), 4); // Rust issue #47949 ate one little piggy\n }\n \n #[test]\n@@ -1894,7 +1893,7 @@ fn test_into_iter_drop_leak_height_0() {\n \n     impl Drop for D {\n         fn drop(&mut self) {\n-            if DROPS.fetch_add(1, Ordering::SeqCst) == 3 {\n+            if DROPS.fetch_add(1, SeqCst) == 3 {\n                 panic!(\"panic in `drop`\");\n             }\n         }\n@@ -1909,7 +1908,7 @@ fn test_into_iter_drop_leak_height_0() {\n \n     catch_unwind(move || drop(map.into_iter())).unwrap_err();\n \n-    assert_eq!(DROPS.load(Ordering::SeqCst), 5);\n+    assert_eq!(DROPS.load(SeqCst), 5);\n }\n \n #[test]\n@@ -1921,18 +1920,18 @@ fn test_into_iter_drop_leak_height_1() {\n     struct D;\n     impl Drop for D {\n         fn drop(&mut self) {\n-            if DROPS.fetch_add(1, Ordering::SeqCst) == PANIC_POINT.load(Ordering::SeqCst) {\n+            if DROPS.fetch_add(1, SeqCst) == PANIC_POINT.load(SeqCst) {\n                 panic!(\"panic in `drop`\");\n             }\n         }\n     }\n \n     for panic_point in vec![0, 1, size - 2, size - 1] {\n-        DROPS.store(0, Ordering::SeqCst);\n-        PANIC_POINT.store(panic_point, Ordering::SeqCst);\n+        DROPS.store(0, SeqCst);\n+        PANIC_POINT.store(panic_point, SeqCst);\n         let map: BTreeMap<_, _> = (0..size).map(|i| (i, D)).collect();\n         catch_unwind(move || drop(map.into_iter())).unwrap_err();\n-        assert_eq!(DROPS.load(Ordering::SeqCst), size);\n+        assert_eq!(DROPS.load(SeqCst), size);\n     }\n }\n "}, {"sha": "93de2d829ac8d9c6249d5da7efe38131cafca51b", "filename": "library/alloc/src/collections/btree/search.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fsearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fsearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fsearch.rs?ref=5793fa9cda2178659768908dda4d6198f43cda08", "patch": "@@ -50,7 +50,7 @@ where\n {\n     match search_linear(&node, key) {\n         (idx, true) => Found(unsafe { Handle::new_kv(node, idx) }),\n-        (idx, false) => SearchResult::GoDown(unsafe { Handle::new_edge(node, idx) }),\n+        (idx, false) => GoDown(unsafe { Handle::new_edge(node, idx) }),\n     }\n }\n "}, {"sha": "4d05bc4ebfa1e9aa5255d60f5103b123496f6504", "filename": "library/alloc/src/collections/btree/set/tests.rs", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5793fa9cda2178659768908dda4d6198f43cda08/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs?ref=5793fa9cda2178659768908dda4d6198f43cda08", "patch": "@@ -1,9 +1,10 @@\n use super::super::DeterministicRng;\n use super::*;\n use crate::vec::Vec;\n+use std::cmp::Ordering;\n use std::iter::FromIterator;\n use std::panic::{catch_unwind, AssertUnwindSafe};\n-use std::sync::atomic::{AtomicU32, Ordering};\n+use std::sync::atomic::{AtomicU32, Ordering::SeqCst};\n \n #[test]\n fn test_clone_eq() {\n@@ -355,7 +356,7 @@ fn test_drain_filter_drop_panic_leak() {\n     struct D(i32);\n     impl Drop for D {\n         fn drop(&mut self) {\n-            if DROPS.fetch_add(1, Ordering::SeqCst) == 1 {\n+            if DROPS.fetch_add(1, SeqCst) == 1 {\n                 panic!(\"panic in `drop`\");\n             }\n         }\n@@ -368,14 +369,14 @@ fn test_drain_filter_drop_panic_leak() {\n \n     catch_unwind(move || {\n         drop(set.drain_filter(|d| {\n-            PREDS.fetch_add(1u32 << d.0, Ordering::SeqCst);\n+            PREDS.fetch_add(1u32 << d.0, SeqCst);\n             true\n         }))\n     })\n     .ok();\n \n-    assert_eq!(PREDS.load(Ordering::SeqCst), 0x011);\n-    assert_eq!(DROPS.load(Ordering::SeqCst), 3);\n+    assert_eq!(PREDS.load(SeqCst), 0x011);\n+    assert_eq!(DROPS.load(SeqCst), 3);\n }\n \n #[test]\n@@ -387,7 +388,7 @@ fn test_drain_filter_pred_panic_leak() {\n     struct D(i32);\n     impl Drop for D {\n         fn drop(&mut self) {\n-            DROPS.fetch_add(1, Ordering::SeqCst);\n+            DROPS.fetch_add(1, SeqCst);\n         }\n     }\n \n@@ -398,7 +399,7 @@ fn test_drain_filter_pred_panic_leak() {\n \n     catch_unwind(AssertUnwindSafe(|| {\n         drop(set.drain_filter(|d| {\n-            PREDS.fetch_add(1u32 << d.0, Ordering::SeqCst);\n+            PREDS.fetch_add(1u32 << d.0, SeqCst);\n             match d.0 {\n                 0 => true,\n                 _ => panic!(),\n@@ -407,8 +408,8 @@ fn test_drain_filter_pred_panic_leak() {\n     }))\n     .ok();\n \n-    assert_eq!(PREDS.load(Ordering::SeqCst), 0x011);\n-    assert_eq!(DROPS.load(Ordering::SeqCst), 1);\n+    assert_eq!(PREDS.load(SeqCst), 0x011);\n+    assert_eq!(DROPS.load(SeqCst), 1);\n     assert_eq!(set.len(), 2);\n     assert_eq!(set.first().unwrap().0, 4);\n     assert_eq!(set.last().unwrap().0, 8);\n@@ -498,8 +499,6 @@ fn test_extend_ref() {\n \n #[test]\n fn test_recovery() {\n-    use std::cmp::Ordering;\n-\n     #[derive(Debug)]\n     struct Foo(&'static str, i32);\n "}]}