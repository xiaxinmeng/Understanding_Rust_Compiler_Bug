{"sha": "6b46095980bf73512f5ed06d0659d263a4c990df", "node_id": "C_kwDOAAsO6NoAKDZiNDYwOTU5ODBiZjczNTEyZjVlZDA2ZDA2NTlkMjYzYTRjOTkwZGY", "commit": {"author": {"name": "Luna Razzaghipour", "email": "lunarazzaghipour@gmail.com", "date": "2023-05-28T12:10:24Z"}, "committer": {"name": "Luna Razzaghipour", "email": "lunarazzaghipour@gmail.com", "date": "2023-05-28T12:10:24Z"}, "message": "Make formatting a latency-sensitive request", "tree": {"sha": "bd3283d3fef691e3bf41b07f8cd0a520861aaa39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd3283d3fef691e3bf41b07f8cd0a520861aaa39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b46095980bf73512f5ed06d0659d263a4c990df", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN SSH SIGNATURE-----\nU1NIU0lHAAAAAQAAAGgAAAATZWNkc2Etc2hhMi1uaXN0cDI1NgAAAAhuaXN0cDI1NgAAAE\nEEtPEPU+w9oQ90uLBc4R0g0O7C/w+fcT4a+R4nvkvJXioSPGOafBHNQJufyTj3tLLeNtO4\n1H9ztJfn/DlLu2mXigAAAANnaXQAAAAAAAAABnNoYTUxMgAAAGUAAAATZWNkc2Etc2hhMi\n1uaXN0cDI1NgAAAEoAAAAhAJnVWpBWWMvhWVmDsDmQDL+NAtZqv9RGfP2Zvoli59e/AAAA\nIQCHs3pM5xYqVCf/7j+UqLgEpDQgTOcwJ6eZqMwUjSHg5g==\n-----END SSH SIGNATURE-----", "payload": "tree bd3283d3fef691e3bf41b07f8cd0a520861aaa39\nparent 74bc2a47e09cbfa1f52479c083c0a0d4d502dbce\nauthor Luna Razzaghipour <lunarazzaghipour@gmail.com> 1685275824 +1000\ncommitter Luna Razzaghipour <lunarazzaghipour@gmail.com> 1685275824 +1000\n\nMake formatting a latency-sensitive request\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b46095980bf73512f5ed06d0659d263a4c990df", "html_url": "https://github.com/rust-lang/rust/commit/6b46095980bf73512f5ed06d0659d263a4c990df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b46095980bf73512f5ed06d0659d263a4c990df/comments", "author": {"login": "lunacookies", "id": 31783266, "node_id": "MDQ6VXNlcjMxNzgzMjY2", "avatar_url": "https://avatars.githubusercontent.com/u/31783266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunacookies", "html_url": "https://github.com/lunacookies", "followers_url": "https://api.github.com/users/lunacookies/followers", "following_url": "https://api.github.com/users/lunacookies/following{/other_user}", "gists_url": "https://api.github.com/users/lunacookies/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunacookies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunacookies/subscriptions", "organizations_url": "https://api.github.com/users/lunacookies/orgs", "repos_url": "https://api.github.com/users/lunacookies/repos", "events_url": "https://api.github.com/users/lunacookies/events{/privacy}", "received_events_url": "https://api.github.com/users/lunacookies/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lunacookies", "id": 31783266, "node_id": "MDQ6VXNlcjMxNzgzMjY2", "avatar_url": "https://avatars.githubusercontent.com/u/31783266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunacookies", "html_url": "https://github.com/lunacookies", "followers_url": "https://api.github.com/users/lunacookies/followers", "following_url": "https://api.github.com/users/lunacookies/following{/other_user}", "gists_url": "https://api.github.com/users/lunacookies/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunacookies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunacookies/subscriptions", "organizations_url": "https://api.github.com/users/lunacookies/orgs", "repos_url": "https://api.github.com/users/lunacookies/repos", "events_url": "https://api.github.com/users/lunacookies/events{/privacy}", "received_events_url": "https://api.github.com/users/lunacookies/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74bc2a47e09cbfa1f52479c083c0a0d4d502dbce", "url": "https://api.github.com/repos/rust-lang/rust/commits/74bc2a47e09cbfa1f52479c083c0a0d4d502dbce", "html_url": "https://github.com/rust-lang/rust/commit/74bc2a47e09cbfa1f52479c083c0a0d4d502dbce"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "19c49a23000ea57e085c0b04a8eb95ca2aa87ea0", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b46095980bf73512f5ed06d0659d263a4c990df/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b46095980bf73512f5ed06d0659d263a4c990df/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=6b46095980bf73512f5ed06d0659d263a4c990df", "patch": "@@ -695,6 +695,14 @@ impl GlobalState {\n             .on_latency_sensitive::<lsp_types::request::SemanticTokensRangeRequest>(\n                 handlers::handle_semantic_tokens_range,\n             )\n+            // Formatting is not caused by the user typing,\n+            // but it does qualify as latency-sensitive\n+            // because a delay before formatting is applied\n+            // can be confusing for the user.\n+            .on_latency_sensitive::<lsp_types::request::Formatting>(handlers::handle_formatting)\n+            .on_latency_sensitive::<lsp_types::request::RangeFormatting>(\n+                handlers::handle_range_formatting,\n+            )\n             // All other request handlers\n             .on::<lsp_ext::FetchDependencyList>(handlers::fetch_dependency_list)\n             .on::<lsp_ext::AnalyzerStatus>(handlers::handle_analyzer_status)\n@@ -730,8 +738,6 @@ impl GlobalState {\n             .on::<lsp_types::request::PrepareRenameRequest>(handlers::handle_prepare_rename)\n             .on::<lsp_types::request::Rename>(handlers::handle_rename)\n             .on::<lsp_types::request::References>(handlers::handle_references)\n-            .on::<lsp_types::request::Formatting>(handlers::handle_formatting)\n-            .on::<lsp_types::request::RangeFormatting>(handlers::handle_range_formatting)\n             .on::<lsp_types::request::DocumentHighlightRequest>(handlers::handle_document_highlight)\n             .on::<lsp_types::request::CallHierarchyPrepare>(handlers::handle_call_hierarchy_prepare)\n             .on::<lsp_types::request::CallHierarchyIncomingCalls>("}]}