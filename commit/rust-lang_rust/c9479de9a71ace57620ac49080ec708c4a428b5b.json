{"sha": "c9479de9a71ace57620ac49080ec708c4a428b5b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5NDc5ZGU5YTcxYWNlNTc2MjBhYzQ5MDgwZWM3MDhjNGE0MjhiNWI=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seiichi.uchida@dena.com", "date": "2019-03-19T01:50:44Z"}, "committer": {"name": "Seiichi Uchida", "email": "seiichi.uchida@dena.com", "date": "2019-03-19T01:50:44Z"}, "message": "Avoid panic on macro inside deeply nested block\n\nCloses #3457.", "tree": {"sha": "5a78129a5ce4fb55a364e4158877175475436504", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a78129a5ce4fb55a364e4158877175475436504"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9479de9a71ace57620ac49080ec708c4a428b5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9479de9a71ace57620ac49080ec708c4a428b5b", "html_url": "https://github.com/rust-lang/rust/commit/c9479de9a71ace57620ac49080ec708c4a428b5b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9479de9a71ace57620ac49080ec708c4a428b5b/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1427e4c20ba5cdc80a338347585c9de71a0dea4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1427e4c20ba5cdc80a338347585c9de71a0dea4d", "html_url": "https://github.com/rust-lang/rust/commit/1427e4c20ba5cdc80a338347585c9de71a0dea4d"}], "stats": {"total": 112, "additions": 111, "deletions": 1}, "files": [{"sha": "5524a21f4b7fcae520539bb4f0199ceeb5ecd871", "filename": "src/shape.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9479de9a71ace57620ac49080ec708c4a428b5b/src%2Fshape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9479de9a71ace57620ac49080ec708c4a428b5b/src%2Fshape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshape.rs?ref=c9479de9a71ace57620ac49080ec708c4a428b5b", "patch": "@@ -228,6 +228,10 @@ impl Shape {\n         }\n     }\n \n+    pub fn saturating_sub_width(&self, width: usize) -> Shape {\n+        self.sub_width(width).unwrap_or(Shape { width: 0, ..*self })\n+    }\n+\n     pub fn sub_width(&self, width: usize) -> Option<Shape> {\n         Some(Shape {\n             width: self.width.checked_sub(width)?,"}, {"sha": "56a27889c201f37fffb55e33dcce617d3e8dac64", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9479de9a71ace57620ac49080ec708c4a428b5b/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9479de9a71ace57620ac49080ec708c4a428b5b/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=c9479de9a71ace57620ac49080ec708c4a428b5b", "patch": "@@ -536,7 +536,7 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n         skip_out_of_file_lines_range_visitor!(self, mac.span);\n \n         // 1 = ;\n-        let shape = self.shape().sub_width(1).unwrap();\n+        let shape = self.shape().saturating_sub_width(1);\n         let rewrite = self.with_context(|ctx| rewrite_macro(mac, ident, ctx, shape, pos));\n         self.push_rewrite(mac.span, rewrite);\n     }"}, {"sha": "1bb2d9014e2d19f09ed47a35433ae28d434034c1", "filename": "tests/source/expr.rs", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/c9479de9a71ace57620ac49080ec708c4a428b5b/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9479de9a71ace57620ac49080ec708c4a428b5b/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=c9479de9a71ace57620ac49080ec708c4a428b5b", "patch": "@@ -479,3 +479,56 @@ fn issue3226() {\n         }\n     }\n }\n+\n+// #3457\n+fn issue3457() {\n+    {\n+        {\n+            {\n+                {\n+                    {\n+                        {\n+                            {\n+                                {\n+                                    {\n+                                        {\n+                                            {\n+                                                {\n+                                                    {\n+                                                        {\n+                                                            {\n+                                                                {\n+                                                                    {\n+                                                                        {\n+                                                                            {\n+                                                                                {\n+                                                                                    {\n+                                                                                        {\n+                                                                                            {\n+                                                                                                {\n+                                                                                                    println!(\"Test\");\n+                                                                                                }\n+                                                                                            }\n+                                                                                        }\n+                                                                                    }\n+                                                                                }\n+                                                                            }\n+                                                                        }\n+                                                                    }\n+                                                                }\n+                                                            }\n+                                                        }\n+                                                    }\n+                                                }\n+                                            }\n+                                        }\n+                                    }\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "88de6f7fb88c1ce87ccb6eae6e0df591bf8abfb8", "filename": "tests/target/expr.rs", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/c9479de9a71ace57620ac49080ec708c4a428b5b/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9479de9a71ace57620ac49080ec708c4a428b5b/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=c9479de9a71ace57620ac49080ec708c4a428b5b", "patch": "@@ -562,3 +562,56 @@ fn issue3226() {\n         }\n     }\n }\n+\n+// #3457\n+fn issue3457() {\n+    {\n+        {\n+            {\n+                {\n+                    {\n+                        {\n+                            {\n+                                {\n+                                    {\n+                                        {\n+                                            {\n+                                                {\n+                                                    {\n+                                                        {\n+                                                            {\n+                                                                {\n+                                                                    {\n+                                                                        {\n+                                                                            {\n+                                                                                {\n+                                                                                    {\n+                                                                                        {\n+                                                                                            {\n+                                                                                                {\n+                                                                                                    println!(\"Test\");\n+                                                                                                }\n+                                                                                            }\n+                                                                                        }\n+                                                                                    }\n+                                                                                }\n+                                                                            }\n+                                                                        }\n+                                                                    }\n+                                                                }\n+                                                            }\n+                                                        }\n+                                                    }\n+                                                }\n+                                            }\n+                                        }\n+                                    }\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}]}