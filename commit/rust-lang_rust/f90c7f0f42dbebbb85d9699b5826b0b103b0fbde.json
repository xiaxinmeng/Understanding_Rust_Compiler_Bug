{"sha": "f90c7f0f42dbebbb85d9699b5826b0b103b0fbde", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5MGM3ZjBmNDJkYmViYmI4NWQ5Njk5YjU4MjZiMGIxMDNiMGZiZGU=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-01-10T07:55:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-10T07:55:55Z"}, "message": "Rollup merge of #79968 - bjorn3:better_drop_glue_debuginfo, r=matthewjasper\n\nImprove core::ptr::drop_in_place debuginfo\n\n* Use span of the dropped type as function span when possible.\n* Rename symbol from `core::ptr::drop_in_place::$hash` to `{{drop}}::<$TYPE>::$hash`.\n\nFixes #77465\n\n(I haven't yet updated the tests)", "tree": {"sha": "c7fe47c1ea89a479a34ab7e07eb04ce8f60d61b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7fe47c1ea89a479a34ab7e07eb04ce8f60d61b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf+rMMCRBK7hj4Ov3rIwAAdHIIAAQpxPBFyxoElRuOz4gvKpRp\nUuGUAaFGIY0tU9puRwhyNqFDVFY/sCy3mW38QZmCEibJ6FDw6oKmD44UVBR2NFOh\nrBy+37kEyROTzK3Y/nksAldEoWFS58C6MD65pCyjbL9UN7lBmoMIvopn3QowOzjx\nqE0p8io7zAJgzSA+fM0wKTbiFW5C2eVTSHvp4gBL47LcAStCs9Ahl9EpWv2S0vC1\nDyNFS0pRDDfkcxk4LBdrboDNrjjZWbaX7AcLG7uCXhYw4Ym8o3on9tG3DXD2oZVV\ncFsQWFHpKlpsOlkYkMu2nRdOD1x+AOXBxBr1aFrdj+z4NMfsYLUYo6tEckAllf0=\n=PqDU\n-----END PGP SIGNATURE-----\n", "payload": "tree c7fe47c1ea89a479a34ab7e07eb04ce8f60d61b0\nparent 5c0f5b69c2b11a16f34ff25da69be831336f3596\nparent 4a48d680f2a27d3aff5507e973035681a2bec854\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1610265355 +0900\ncommitter GitHub <noreply@github.com> 1610265355 +0900\n\nRollup merge of #79968 - bjorn3:better_drop_glue_debuginfo, r=matthewjasper\n\nImprove core::ptr::drop_in_place debuginfo\n\n* Use span of the dropped type as function span when possible.\n* Rename symbol from `core::ptr::drop_in_place::$hash` to `{{drop}}::<$TYPE>::$hash`.\n\nFixes #77465\n\n(I haven't yet updated the tests)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde", "html_url": "https://github.com/rust-lang/rust/commit/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c0f5b69c2b11a16f34ff25da69be831336f3596", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c0f5b69c2b11a16f34ff25da69be831336f3596", "html_url": "https://github.com/rust-lang/rust/commit/5c0f5b69c2b11a16f34ff25da69be831336f3596"}, {"sha": "4a48d680f2a27d3aff5507e973035681a2bec854", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a48d680f2a27d3aff5507e973035681a2bec854", "html_url": "https://github.com/rust-lang/rust/commit/4a48d680f2a27d3aff5507e973035681a2bec854"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "b0d5f340902411f33ee7e7fe1f5bedde3168d2a7", "filename": "compiler/rustc_symbol_mangling/src/legacy.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde/compiler%2Frustc_symbol_mangling%2Fsrc%2Flegacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f90c7f0f42dbebbb85d9699b5826b0b103b0fbde/compiler%2Frustc_symbol_mangling%2Fsrc%2Flegacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Flegacy.rs?ref=f90c7f0f42dbebbb85d9699b5826b0b103b0fbde", "patch": "@@ -56,7 +56,15 @@ pub(super) fn mangle(\n     let hash = get_symbol_hash(tcx, instance, instance_ty, instantiating_crate);\n \n     let mut printer = SymbolPrinter { tcx, path: SymbolPath::new(), keep_within_component: false }\n-        .print_def_path(def_id, &[])\n+        .print_def_path(\n+            def_id,\n+            if let ty::InstanceDef::DropGlue(_, _) = instance.def {\n+                // Add the name of the dropped type to the symbol name\n+                &*instance.substs\n+            } else {\n+                &[]\n+            },\n+        )\n         .unwrap();\n \n     if let ty::InstanceDef::VtableShim(..) = instance.def {"}]}