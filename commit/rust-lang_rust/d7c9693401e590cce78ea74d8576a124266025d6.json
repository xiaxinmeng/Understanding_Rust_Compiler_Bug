{"sha": "d7c9693401e590cce78ea74d8576a124266025d6", "node_id": "C_kwDOAAsO6NoAKGQ3Yzk2OTM0MDFlNTkwY2NlNzhlYTc0ZDg1NzZhMTI0MjY2MDI1ZDY", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-10-11T12:11:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-11T12:11:42Z"}, "message": "Rollup merge of #89726 - jkugelman:must-use-alloc-constructors, r=joshtriplett\n\nAdd #[must_use] to alloc constructors\n\nAdded `#[must_use]`. to the various forms of `new`, `pin`, and `with_capacity` in the `alloc` crate. No extra explanations given as I couldn't think of anything useful to add.\n\nI figure this deserves extra scrutiny compared to the other PRs I've done so far. In particular:\n\n* The 4 `pin`/`pin_in` methods I touched. Are there legitimate use cases for pinning and not using the result? Pinning's a difficult concept I'm not very comfortable with.\n* `Box`'s constructors. Do people ever create boxes just for the side effects... allocating or zeroing out memory?\n\nParent issue: #89692\n\nr? ``@joshtriplett``", "tree": {"sha": "8d9bb38518242b0e6f494990b4439becaa78f76e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d9bb38518242b0e6f494990b4439becaa78f76e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7c9693401e590cce78ea74d8576a124266025d6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhZCn+CRBK7hj4Ov3rIwAAyVgIAG7XV3uEMt43zrE+8xlnn1dN\np62I/0I/RUMhLQk9pI3z1S1kkPgkBg9XbJ93esmhPpMRq/3geq2LSoqo94EiUQFX\ncuR1L/brDR7kGaXb/+DRoiQeUoUG/p5j2DsTvgbudBm9ZQymkRaMBl7i6GGA/DjM\nAj5flADWN6xGxZlGtPmwch/MPUcCak9/PBtvoNopF6CYvJk9vntx4E6A/wiSncS0\nQJ0nm5i2z7KFep0cghw+32H/LK485dEDZM/5KHOyWx1nR95Kn9tUUB6ZHBOVAHMf\nB0f0B1U9hci1ijsU1WEdXiVxp+eJuHCvXIhc6Y0b0onA+u6SN8FvKza4U+uXWG8=\n=wFKR\n-----END PGP SIGNATURE-----\n", "payload": "tree 8d9bb38518242b0e6f494990b4439becaa78f76e\nparent 08a7a5759a2ac8da317a5fdb0cf827cea605e12b\nparent ecd7ea8a9c4abd3c3d0b23eda9e1a35bbe70215a\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1633954302 +0200\ncommitter GitHub <noreply@github.com> 1633954302 +0200\n\nRollup merge of #89726 - jkugelman:must-use-alloc-constructors, r=joshtriplett\n\nAdd #[must_use] to alloc constructors\n\nAdded `#[must_use]`. to the various forms of `new`, `pin`, and `with_capacity` in the `alloc` crate. No extra explanations given as I couldn't think of anything useful to add.\n\nI figure this deserves extra scrutiny compared to the other PRs I've done so far. In particular:\n\n* The 4 `pin`/`pin_in` methods I touched. Are there legitimate use cases for pinning and not using the result? Pinning's a difficult concept I'm not very comfortable with.\n* `Box`'s constructors. Do people ever create boxes just for the side effects... allocating or zeroing out memory?\n\nParent issue: #89692\n\nr? ``@joshtriplett``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7c9693401e590cce78ea74d8576a124266025d6", "html_url": "https://github.com/rust-lang/rust/commit/d7c9693401e590cce78ea74d8576a124266025d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7c9693401e590cce78ea74d8576a124266025d6/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08a7a5759a2ac8da317a5fdb0cf827cea605e12b", "url": "https://api.github.com/repos/rust-lang/rust/commits/08a7a5759a2ac8da317a5fdb0cf827cea605e12b", "html_url": "https://github.com/rust-lang/rust/commit/08a7a5759a2ac8da317a5fdb0cf827cea605e12b"}, {"sha": "ecd7ea8a9c4abd3c3d0b23eda9e1a35bbe70215a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecd7ea8a9c4abd3c3d0b23eda9e1a35bbe70215a", "html_url": "https://github.com/rust-lang/rust/commit/ecd7ea8a9c4abd3c3d0b23eda9e1a35bbe70215a"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "bd4f52560421b9edd0b5935058ebcd4e6474e2da", "filename": "library/alloc/src/boxed.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fboxed.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -187,6 +187,7 @@ impl<T> Box<T> {\n     #[cfg(not(no_global_oom_handling))]\n     #[inline(always)]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn new(x: T) -> Self {\n         box x\n     }\n@@ -211,6 +212,7 @@ impl<T> Box<T> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     #[inline]\n     pub fn new_uninit() -> Box<mem::MaybeUninit<T>> {\n         Self::new_uninit_in(Global)\n@@ -237,6 +239,7 @@ impl<T> Box<T> {\n     #[cfg(not(no_global_oom_handling))]\n     #[inline]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed() -> Box<mem::MaybeUninit<T>> {\n         Self::new_zeroed_in(Global)\n     }\n@@ -245,6 +248,7 @@ impl<T> Box<T> {\n     /// `x` will be pinned in memory and unable to be moved.\n     #[cfg(not(no_global_oom_handling))]\n     #[stable(feature = \"pin\", since = \"1.33.0\")]\n+    #[must_use]\n     #[inline(always)]\n     pub fn pin(x: T) -> Pin<Box<T>> {\n         (box x).into()\n@@ -339,6 +343,7 @@ impl<T, A: Allocator> Box<T, A> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n+    #[must_use]\n     #[inline]\n     pub fn new_in(x: T, alloc: A) -> Self {\n         let mut boxed = Self::new_uninit_in(alloc);\n@@ -395,6 +400,7 @@ impl<T, A: Allocator> Box<T, A> {\n     /// ```\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n     #[cfg(not(no_global_oom_handling))]\n+    #[must_use]\n     // #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n     pub fn new_uninit_in(alloc: A) -> Box<mem::MaybeUninit<T>, A> {\n         let layout = Layout::new::<mem::MaybeUninit<T>>();\n@@ -459,6 +465,7 @@ impl<T, A: Allocator> Box<T, A> {\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n     #[cfg(not(no_global_oom_handling))]\n     // #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed_in(alloc: A) -> Box<mem::MaybeUninit<T>, A> {\n         let layout = Layout::new::<mem::MaybeUninit<T>>();\n         // NOTE: Prefer match over unwrap_or_else since closure sometimes not inlineable.\n@@ -503,6 +510,7 @@ impl<T, A: Allocator> Box<T, A> {\n     /// `x` will be pinned in memory and unable to be moved.\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n+    #[must_use]\n     #[inline(always)]\n     pub fn pin_in(x: T, alloc: A) -> Pin<Self>\n     where\n@@ -561,6 +569,7 @@ impl<T> Box<[T]> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit_slice(len: usize) -> Box<[mem::MaybeUninit<T>]> {\n         unsafe { RawVec::with_capacity(len).into_box(len) }\n     }\n@@ -585,6 +594,7 @@ impl<T> Box<[T]> {\n     /// [zeroed]: mem::MaybeUninit::zeroed\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed_slice(len: usize) -> Box<[mem::MaybeUninit<T>]> {\n         unsafe { RawVec::with_capacity_zeroed(len).into_box(len) }\n     }\n@@ -681,6 +691,7 @@ impl<T, A: Allocator> Box<[T], A> {\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n     // #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit_slice_in(len: usize, alloc: A) -> Box<[mem::MaybeUninit<T>], A> {\n         unsafe { RawVec::with_capacity_in(len, alloc).into_box(len) }\n     }\n@@ -708,6 +719,7 @@ impl<T, A: Allocator> Box<[T], A> {\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"allocator_api\", issue = \"32838\")]\n     // #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed_slice_in(len: usize, alloc: A) -> Box<[mem::MaybeUninit<T>], A> {\n         unsafe { RawVec::with_capacity_zeroed_in(len, alloc).into_box(len) }\n     }"}, {"sha": "cfb1cd09c39759e4be50b1c6de96283def967bef", "filename": "library/alloc/src/collections/binary_heap.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -364,6 +364,7 @@ impl<T: Ord> BinaryHeap<T> {\n     /// heap.push(4);\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn new() -> BinaryHeap<T> {\n         BinaryHeap { data: vec![] }\n     }\n@@ -383,6 +384,7 @@ impl<T: Ord> BinaryHeap<T> {\n     /// heap.push(4);\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn with_capacity(capacity: usize) -> BinaryHeap<T> {\n         BinaryHeap { data: Vec::with_capacity(capacity) }\n     }"}, {"sha": "fa86e611565e64b0b7ab0a5cb7099bd385c3fa5c", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -502,6 +502,7 @@ impl<K, V> BTreeMap<K, V> {\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[rustc_const_unstable(feature = \"const_btree_new\", issue = \"71835\")]\n+    #[must_use]\n     pub const fn new() -> BTreeMap<K, V> {\n         BTreeMap { root: None, length: 0 }\n     }"}, {"sha": "d732f65b0d05f152174ab10f005a2acc6b7c5b35", "filename": "library/alloc/src/collections/btree/set.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -248,6 +248,7 @@ impl<T> BTreeSet<T> {\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[rustc_const_unstable(feature = \"const_btree_new\", issue = \"71835\")]\n+    #[must_use]\n     pub const fn new() -> BTreeSet<T> {\n         BTreeSet { map: BTreeMap::new() }\n     }"}, {"sha": "6dcba318c3598f4c4307d8849818e307a6d461e6", "filename": "library/alloc/src/collections/linked_list.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Flinked_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Flinked_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Flinked_list.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -417,6 +417,7 @@ impl<T> LinkedList<T> {\n     #[inline]\n     #[rustc_const_stable(feature = \"const_linked_list_new\", since = \"1.32.0\")]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub const fn new() -> Self {\n         LinkedList { head: None, tail: None, len: 0, marker: PhantomData }\n     }"}, {"sha": "09ae1f7eebd09b8b6165fffb5247ba574c3a2ddf", "filename": "library/alloc/src/collections/vec_deque/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -475,6 +475,7 @@ impl<T> VecDeque<T> {\n     /// ```\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn new() -> VecDeque<T> {\n         VecDeque::new_in(Global)\n     }\n@@ -490,6 +491,7 @@ impl<T> VecDeque<T> {\n     /// ```\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn with_capacity(capacity: usize) -> VecDeque<T> {\n         Self::with_capacity_in(capacity, Global)\n     }"}, {"sha": "75dbd4678bb473c39572372c5265a74ae4976ba0", "filename": "library/alloc/src/raw_vec.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fraw_vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fraw_vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fraw_vec.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -69,6 +69,7 @@ impl<T> RawVec<T, Global> {\n     /// `RawVec` with capacity `0`. If `T` is zero-sized, then it makes a\n     /// `RawVec` with capacity `usize::MAX`. Useful for implementing\n     /// delayed allocation.\n+    #[must_use]\n     pub const fn new() -> Self {\n         Self::new_in(Global)\n     }\n@@ -87,13 +88,15 @@ impl<T> RawVec<T, Global> {\n     ///\n     /// Aborts on OOM.\n     #[cfg(not(no_global_oom_handling))]\n+    #[must_use]\n     #[inline]\n     pub fn with_capacity(capacity: usize) -> Self {\n         Self::with_capacity_in(capacity, Global)\n     }\n \n     /// Like `with_capacity`, but guarantees the buffer is zeroed.\n     #[cfg(not(no_global_oom_handling))]\n+    #[must_use]\n     #[inline]\n     pub fn with_capacity_zeroed(capacity: usize) -> Self {\n         Self::with_capacity_zeroed_in(capacity, Global)"}, {"sha": "2f4a131136e928a20a516527ad3682047b7b9959", "filename": "library/alloc/src/rc.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Frc.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -452,6 +452,7 @@ impl<T> Rc<T> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit() -> Rc<mem::MaybeUninit<T>> {\n         unsafe {\n             Rc::from_ptr(Rc::allocate_for_layout(\n@@ -484,6 +485,7 @@ impl<T> Rc<T> {\n     /// [zeroed]: mem::MaybeUninit::zeroed\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed() -> Rc<mem::MaybeUninit<T>> {\n         unsafe {\n             Rc::from_ptr(Rc::allocate_for_layout(\n@@ -587,6 +589,7 @@ impl<T> Rc<T> {\n     /// `value` will be pinned in memory and unable to be moved.\n     #[cfg(not(no_global_oom_handling))]\n     #[stable(feature = \"pin\", since = \"1.33.0\")]\n+    #[must_use]\n     pub fn pin(value: T) -> Pin<Rc<T>> {\n         unsafe { Pin::new_unchecked(Rc::new(value)) }\n     }\n@@ -658,6 +661,7 @@ impl<T> Rc<[T]> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit_slice(len: usize) -> Rc<[mem::MaybeUninit<T>]> {\n         unsafe { Rc::from_ptr(Rc::allocate_for_slice(len)) }\n     }\n@@ -684,6 +688,7 @@ impl<T> Rc<[T]> {\n     /// [zeroed]: mem::MaybeUninit::zeroed\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed_slice(len: usize) -> Rc<[mem::MaybeUninit<T>]> {\n         unsafe {\n             Rc::from_ptr(Rc::allocate_for_layout(\n@@ -2044,6 +2049,7 @@ impl<T> Weak<T> {\n     /// assert!(empty.upgrade().is_none());\n     /// ```\n     #[stable(feature = \"downgraded_weak\", since = \"1.10.0\")]\n+    #[must_use]\n     pub fn new() -> Weak<T> {\n         Weak { ptr: NonNull::new(usize::MAX as *mut RcBox<T>).expect(\"MAX is not 0\") }\n     }"}, {"sha": "7d6609785a0b1a030102b109613caac315dfe096", "filename": "library/alloc/src/string.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fstring.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -378,6 +378,7 @@ impl String {\n     #[inline]\n     #[rustc_const_stable(feature = \"const_string_new\", since = \"1.39.0\")]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub const fn new() -> String {\n         String { vec: Vec::new() }\n     }\n@@ -422,6 +423,7 @@ impl String {\n     #[cfg(not(no_global_oom_handling))]\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn with_capacity(capacity: usize) -> String {\n         String { vec: Vec::with_capacity(capacity) }\n     }"}, {"sha": "1d4216d7d571af24f947a39bc7695773ecd0f8f7", "filename": "library/alloc/src/sync.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fsync.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -448,6 +448,7 @@ impl<T> Arc<T> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit() -> Arc<mem::MaybeUninit<T>> {\n         unsafe {\n             Arc::from_ptr(Arc::allocate_for_layout(\n@@ -480,6 +481,7 @@ impl<T> Arc<T> {\n     /// [zeroed]: mem::MaybeUninit::zeroed\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed() -> Arc<mem::MaybeUninit<T>> {\n         unsafe {\n             Arc::from_ptr(Arc::allocate_for_layout(\n@@ -494,6 +496,7 @@ impl<T> Arc<T> {\n     /// `data` will be pinned in memory and unable to be moved.\n     #[cfg(not(no_global_oom_handling))]\n     #[stable(feature = \"pin\", since = \"1.33.0\")]\n+    #[must_use]\n     pub fn pin(data: T) -> Pin<Arc<T>> {\n         unsafe { Pin::new_unchecked(Arc::new(data)) }\n     }\n@@ -662,6 +665,7 @@ impl<T> Arc<[T]> {\n     /// ```\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_uninit_slice(len: usize) -> Arc<[mem::MaybeUninit<T>]> {\n         unsafe { Arc::from_ptr(Arc::allocate_for_slice(len)) }\n     }\n@@ -688,6 +692,7 @@ impl<T> Arc<[T]> {\n     /// [zeroed]: mem::MaybeUninit::zeroed\n     #[cfg(not(no_global_oom_handling))]\n     #[unstable(feature = \"new_uninit\", issue = \"63291\")]\n+    #[must_use]\n     pub fn new_zeroed_slice(len: usize) -> Arc<[mem::MaybeUninit<T>]> {\n         unsafe {\n             Arc::from_ptr(Arc::allocate_for_layout(\n@@ -1680,6 +1685,7 @@ impl<T> Weak<T> {\n     /// assert!(empty.upgrade().is_none());\n     /// ```\n     #[stable(feature = \"downgraded_weak\", since = \"1.10.0\")]\n+    #[must_use]\n     pub fn new() -> Weak<T> {\n         Weak { ptr: NonNull::new(usize::MAX as *mut ArcInner<T>).expect(\"MAX is not 0\") }\n     }"}, {"sha": "a12acb1a1c07f7da512844658aa3992f18418209", "filename": "library/alloc/src/vec/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -420,6 +420,7 @@ impl<T> Vec<T> {\n     #[inline]\n     #[rustc_const_stable(feature = \"const_vec_new\", since = \"1.39.0\")]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub const fn new() -> Self {\n         Vec { buf: RawVec::NEW, len: 0 }\n     }\n@@ -464,6 +465,7 @@ impl<T> Vec<T> {\n     #[cfg(not(no_global_oom_handling))]\n     #[inline]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[must_use]\n     pub fn with_capacity(capacity: usize) -> Self {\n         Self::with_capacity_in(capacity, Global)\n     }"}, {"sha": "39fbf3c9eb4e29ac6c3cdbec5b8a2f16f3c62946", "filename": "src/test/ui/weak-new-uninhabited-issue-48493.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d7c9693401e590cce78ea74d8576a124266025d6/src%2Ftest%2Fui%2Fweak-new-uninhabited-issue-48493.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7c9693401e590cce78ea74d8576a124266025d6/src%2Ftest%2Fui%2Fweak-new-uninhabited-issue-48493.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fweak-new-uninhabited-issue-48493.rs?ref=d7c9693401e590cce78ea74d8576a124266025d6", "patch": "@@ -2,6 +2,6 @@\n \n fn main() {\n     enum Void {}\n-    std::rc::Weak::<Void>::new();\n-    std::sync::Weak::<Void>::new();\n+    let _ = std::rc::Weak::<Void>::new();\n+    let _ = std::sync::Weak::<Void>::new();\n }"}]}