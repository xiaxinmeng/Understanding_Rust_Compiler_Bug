{"sha": "6dfd8f6e12e94ca17009d641cff743a13a13285c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkZmQ4ZjZlMTJlOTRjYTE3MDA5ZDY0MWNmZjc0M2ExM2ExMzI4NWM=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-04-13T17:04:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-04-13T17:04:15Z"}, "message": "Rollup merge of #41250 - kennytm:fix-41228, r=nikomatsakis\n\nFix invalid 128-bit division on 32-bit target (#41228)\n\nThe bug of #41228 is a typo, this line: https://github.com/rust-lang/rust/blob/1dca19ae3fd195fa517e326a39bfee729da7cadb/src/libcompiler_builtins/lib.rs#L183\n\n```rust\n            // 1 <= sr <= u64::bits() - 1\n            q = n.wrapping_shl(64u32.wrapping_sub(sr));\n```\n\nThe **64** should be **128**.\n\n(Compare with https://github.com/rust-lang-nursery/compiler-builtins/blob/280d19f1127aa80739f4179152b11a5f7d36d79f/src/int/udiv.rs#L213-L214:\n\n```rust\n            // 1 <= sr <= <hty!($ty)>::bits() - 1\n            q = n << (<$ty>::bits() - sr);\n```\n\nOr compare with the C implementation https://github.com/llvm-mirror/compiler-rt/blob/master/lib/builtins/udivmodti4.c#L113-L116\n\n```c\n        /* 1 <= sr <= n_udword_bits - 1 */\n        /* q.all = n.all << (n_utword_bits - sr); */\n        q.s.low = 0;\n        q.s.high = n.s.low << (n_udword_bits - sr);\n```\n)\n\nAdded a bunch of randomly generated division test cases to try to cover every described branch of `udivmodti4`.", "tree": {"sha": "42d36ca52ad06607b2b8d32cd04f3d1b823b2a29", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/42d36ca52ad06607b2b8d32cd04f3d1b823b2a29"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6dfd8f6e12e94ca17009d641cff743a13a13285c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6dfd8f6e12e94ca17009d641cff743a13a13285c", "html_url": "https://github.com/rust-lang/rust/commit/6dfd8f6e12e94ca17009d641cff743a13a13285c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6dfd8f6e12e94ca17009d641cff743a13a13285c/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9eb3468e2f40ea2c3d7f00de07e51214c37f71e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9eb3468e2f40ea2c3d7f00de07e51214c37f71e5", "html_url": "https://github.com/rust-lang/rust/commit/9eb3468e2f40ea2c3d7f00de07e51214c37f71e5"}, {"sha": "71a9e106690627e657a466938e578608d8bcd04a", "url": "https://api.github.com/repos/rust-lang/rust/commits/71a9e106690627e657a466938e578608d8bcd04a", "html_url": "https://github.com/rust-lang/rust/commit/71a9e106690627e657a466938e578608d8bcd04a"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "09b3d63950705001ed439d06d5c7a85d73d2ff75", "filename": "src/libcompiler_builtins/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Flibcompiler_builtins%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Flibcompiler_builtins%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcompiler_builtins%2Flib.rs?ref=6dfd8f6e12e94ca17009d641cff743a13a13285c", "patch": "@@ -180,7 +180,7 @@ pub mod reimpls {\n             sr = sr.wrapping_add(1);\n \n             // 1 <= sr <= u64::bits() - 1\n-            q = n.wrapping_shl(64u32.wrapping_sub(sr));\n+            q = n.wrapping_shl(128u32.wrapping_sub(sr));\n             r = n.wrapping_shr(sr);\n         } else {\n             if d.high() == 0 {"}, {"sha": "c5057f70c065ae1dc784b4c6fe36f57e3835d023", "filename": "src/test/run-pass/i128.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Ftest%2Frun-pass%2Fi128.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Ftest%2Frun-pass%2Fi128.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fi128.rs?ref=6dfd8f6e12e94ca17009d641cff743a13a13285c", "patch": "@@ -104,4 +104,9 @@ fn main() {\n     assert_eq!(l.checked_sub(l), Some(0));\n     assert_eq!(b(1u128).checked_shl(b(127)), Some(1 << 127));\n     assert_eq!(o.checked_shl(b(128)), None);\n+\n+    // https://github.com/rust-lang/rust/issues/41228\n+    assert_eq!(b(-87559967289969187895646876466835277875_i128) /\n+               b(84285771033834995895337664386045050880_i128),\n+               -1i128);\n }"}, {"sha": "cfd616c56b4f02ed18e42a4170d8207d0586a9fe", "filename": "src/test/run-pass/u128.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Ftest%2Frun-pass%2Fu128.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dfd8f6e12e94ca17009d641cff743a13a13285c/src%2Ftest%2Frun-pass%2Fu128.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fu128.rs?ref=6dfd8f6e12e94ca17009d641cff743a13a13285c", "patch": "@@ -77,4 +77,49 @@ fn main() {\n     assert_eq!(o.checked_sub(b(18)), None);\n     assert_eq!(b(1u128).checked_shl(b(127)), Some(1 << 127));\n     assert_eq!(o.checked_shl(b(128)), None);\n+\n+    // Test cases for all udivmodti4 branches.\n+    // case \"0X/0X\"\n+    assert_eq!(b(0x69545bd57727c050_u128) /\n+               b(0x3283527a3350d88c_u128),\n+               2u128);\n+    // case \"0X/KX\"\n+    assert_eq!(b(0x0_8003c9c50b473ae6_u128) /\n+               b(0x1_283e8838c30fa8f4_u128),\n+               0u128);\n+    // case \"K0/K0\"\n+    assert_eq!(b(0xc43f42a207978720_u128 << 64) /\n+               b(0x098e62b74c23cf1a_u128 << 64),\n+               20u128);\n+    // case \"KK/K0\" for power-of-two D.\n+    assert_eq!(b(0xa9008fb6c9d81e42_0e25730562a601c8_u128) /\n+               b(1u128 << 120),\n+               169u128);\n+    // case \"KK/K0\" with N >= D (https://github.com/rust-lang/rust/issues/41228).\n+    assert_eq!(b(0xe4d26e59f0640328_06da5b06efe83a41_u128) /\n+               b(0x330fcb030ea4447c_u128 << 64),\n+               4u128);\n+    assert_eq!(b(3u128 << 64 | 1) /\n+               b(3u128 << 64),\n+               1u128);\n+    // case \"KK/K0\" with N < D.\n+    assert_eq!(b(0x6655c9fb66ca2884_e2d1dfd470158c62_u128) /\n+               b(0xb35b667cab7e355b_u128 << 64),\n+               0u128);\n+    // case \"KX/0K\" for power-of-two D.\n+    assert_eq!(b(0x3e49dd84feb2df59_7b2f97d93a253969_u128) /\n+               b(1u128 << 4),\n+               0x03e49dd84feb2df5_97b2f97d93a25396_u128);\n+    // case \"KX/0K\" in general.\n+    assert_eq!(b(0x299692b3a1dae5bd_6162e6f489d2620e_u128) /\n+               b(0x900b6f027571d6f7_u128),\n+               0x49e95f54b0442578_u128);\n+    // case \"KX/KK\" with N >= D.\n+    assert_eq!(b(0xc7b889180b67b07d_bc1a3c88783d35b5_u128) /\n+               b(0x1d7e69f53160b9e2_60074771e852f244_u128),\n+               6u128);\n+    // case \"KX/KK\" with N < D.\n+    assert_eq!(b(0x679289ac23bb334f_36144401cf882172_u128) /\n+               b(0x7b0b271b64865f05_f54a7b72746c062f_u128),\n+               0u128);\n }"}]}