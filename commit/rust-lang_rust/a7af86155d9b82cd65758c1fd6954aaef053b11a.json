{"sha": "a7af86155d9b82cd65758c1fd6954aaef053b11a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3YWY4NjE1NWQ5YjgyY2Q2NTc1OGMxZmQ2OTU0YWFlZjA1M2IxMWE=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-11-14T19:21:49Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-11-14T19:21:49Z"}, "message": "Support emitting trap instructions for debugging.", "tree": {"sha": "a93b12cac2b0c26f63b9e22cad74d6375668747d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a93b12cac2b0c26f63b9e22cad74d6375668747d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7af86155d9b82cd65758c1fd6954aaef053b11a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7af86155d9b82cd65758c1fd6954aaef053b11a", "html_url": "https://github.com/rust-lang/rust/commit/a7af86155d9b82cd65758c1fd6954aaef053b11a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7af86155d9b82cd65758c1fd6954aaef053b11a/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2de59aa6b9096788577319b258469848e633938f", "url": "https://api.github.com/repos/rust-lang/rust/commits/2de59aa6b9096788577319b258469848e633938f", "html_url": "https://github.com/rust-lang/rust/commit/2de59aa6b9096788577319b258469848e633938f"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "0cd177a406d44a471c94d10c191445e928aaecd8", "filename": "src/comp/lib/llvm.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a7af86155d9b82cd65758c1fd6954aaef053b11a/src%2Fcomp%2Flib%2Fllvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7af86155d9b82cd65758c1fd6954aaef053b11a/src%2Fcomp%2Flib%2Fllvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Flib%2Fllvm.rs?ref=a7af86155d9b82cd65758c1fd6954aaef053b11a", "patch": "@@ -1069,6 +1069,19 @@ obj builder(BuilderRef B) {\n         ret llvm.LLVMBuildPtrDiff(B, LHS, RHS, _str.buf(\"\"));\n     }\n \n+    fn Trap() -> ValueRef {\n+        let BasicBlockRef BB = llvm.LLVMGetInsertBlock(B);\n+        let ValueRef FN = llvm.LLVMGetBasicBlockParent(BB);\n+        let ModuleRef M = llvm.LLVMGetGlobalParent(FN);\n+        let ValueRef T = llvm.LLVMGetNamedFunction(M, _str.buf(\"llvm.trap\"));\n+        check (T as int != 0);\n+        let vec[ValueRef] Args = vec();\n+        ret llvm.LLVMBuildCall(B, T,\n+                               _vec.buf[ValueRef](Args),\n+                               _vec.len[ValueRef](Args),\n+                               _str.buf(\"\"));\n+    }\n+\n     drop {\n         llvm.LLVMDisposeBuilder(B);\n     }"}, {"sha": "4140c0f3c6d510d4faa8379a5846f39774db82c5", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a7af86155d9b82cd65758c1fd6954aaef053b11a/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7af86155d9b82cd65758c1fd6954aaef053b11a/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=a7af86155d9b82cd65758c1fd6954aaef053b11a", "patch": "@@ -1369,13 +1369,20 @@ fn trans_main_fn(@trans_ctxt cx, ValueRef llcrate) {\n \n }\n \n+fn declare_intrinsics(ModuleRef llmod) {\n+    let vec[TypeRef] T_trap_args = vec();\n+    decl_cdecl_fn(llmod, \"llvm.trap\", T_trap_args, T_void());\n+}\n+\n fn trans_crate(session.session sess, @ast.crate crate, str output) {\n     auto llmod =\n         llvm.LLVMModuleCreateWithNameInContext(_str.buf(\"rust_out\"),\n                                                llvm.LLVMGetGlobalContext());\n \n     llvm.LLVMSetModuleInlineAsm(llmod, _str.buf(x86.get_module_asm()));\n \n+    declare_intrinsics(llmod);\n+\n     auto glues = @rec(activate_glue = decl_glue(llmod,\n                                                 abi.activate_glue_name()),\n                       yield_glue = decl_glue(llmod, abi.yield_glue_name()),"}]}