{"sha": "183262d8d3e2af06f07c5d601b71f407846a267b", "node_id": "C_kwDOAAsO6NoAKDE4MzI2MmQ4ZDNlMmFmMDZmMDdjNWQ2MDFiNzFmNDA3ODQ2YTI2N2I", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-15T16:15:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-15T16:15:55Z"}, "message": "Rollup merge of #94958 - est31:pluralize, r=oli-obk\n\nSupport other types of pluralization in pluralize macro", "tree": {"sha": "f2d074688426dbc31be510967d35521632a7346d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f2d074688426dbc31be510967d35521632a7346d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/183262d8d3e2af06f07c5d601b71f407846a267b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiMLu8CRBK7hj4Ov3rIwAAAcMIAIiC4Oo5EE6s4CfnCwhB9Zl/\n/RsyVyPQz8ak5H/24yM8WVd4Pd8X1zMdlU+JoMc3rqVnVFhMfwJitribLoesC9ND\nJcwER8vRVe9UbL8WtwSmDV1iC01czMcG9cFQGW3C82rG+BuFp51JRkUqtGjCgDgr\ndjAt0P9ZhwiXSgzot2tS5OHhtgeQYII1apifgmqV9WlC3BHv/E+ogFr0U/fJqw1e\n4q/ANSwe16zVYNB2gX3v2yxY2dOFh3HcWN2OJnsb+9PDAdkLW93s5WSJ0DRUPnfJ\n6xEq2HGBMThIQZP2N3P5+tzS5jHBwm+WGO4hyBiYMpfYhiKYH1f5vbmFmBqe5y0=\n=I9zJ\n-----END PGP SIGNATURE-----\n", "payload": "tree f2d074688426dbc31be510967d35521632a7346d\nparent 32ca1a6e299efca0fbdfd06f61748a46408f66d6\nparent 3bf9124f14f68f8c3cd26dd27d0ef27c516a5f06\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1647360955 +0100\ncommitter GitHub <noreply@github.com> 1647360955 +0100\n\nRollup merge of #94958 - est31:pluralize, r=oli-obk\n\nSupport other types of pluralization in pluralize macro\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/183262d8d3e2af06f07c5d601b71f407846a267b", "html_url": "https://github.com/rust-lang/rust/commit/183262d8d3e2af06f07c5d601b71f407846a267b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/183262d8d3e2af06f07c5d601b71f407846a267b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32ca1a6e299efca0fbdfd06f61748a46408f66d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/32ca1a6e299efca0fbdfd06f61748a46408f66d6", "html_url": "https://github.com/rust-lang/rust/commit/32ca1a6e299efca0fbdfd06f61748a46408f66d6"}, {"sha": "3bf9124f14f68f8c3cd26dd27d0ef27c516a5f06", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bf9124f14f68f8c3cd26dd27d0ef27c516a5f06", "html_url": "https://github.com/rust-lang/rust/commit/3bf9124f14f68f8c3cd26dd27d0ef27c516a5f06"}], "stats": {"total": 49, "additions": 26, "deletions": 23}, "files": [{"sha": "f0eb27c90025c3fbed84877762ff5b4d38d749e3", "filename": "compiler/rustc_lint_defs/src/lib.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_lint_defs%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_lint_defs%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint_defs%2Fsrc%2Flib.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -20,6 +20,12 @@ macro_rules! pluralize {\n     ($x:expr) => {\n         if $x != 1 { \"s\" } else { \"\" }\n     };\n+    (\"is\", $x:expr) => {\n+        if $x == 1 { \"is\" } else { \"are\" }\n+    };\n+    (\"this\", $x:expr) => {\n+        if $x == 1 { \"this\" } else { \"these\" }\n+    };\n }\n \n /// Indicates the confidence in the correctness of a suggestion."}, {"sha": "2c3c61259c473b604587a8a6efb2811fe4440fc2", "filename": "compiler/rustc_middle/src/mir/interpret/error.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Ferror.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -400,7 +400,7 @@ impl fmt::Display for UndefinedBehaviorInfo<'_> {\n                 Pointer::new(*alloc, access.access_offset),\n                 access.uninit_size.bytes(),\n                 pluralize!(access.uninit_size.bytes()),\n-                if access.uninit_size.bytes() != 1 { \"are\" } else { \"is\" },\n+                pluralize!(\"is\", access.uninit_size.bytes()),\n                 Pointer::new(*alloc, access.uninit_offset),\n             ),\n             InvalidUninitBytes(None) => write!("}, {"sha": "3aad189b222ea7636558b6797c381da8b8d75c68", "filename": "compiler/rustc_middle/src/ty/error.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -847,7 +847,7 @@ fn foo(&self) -> Self::T { String::new() }\n                 \"{some} method{s} {are} available that return{r} `{ty}`\",\n                 some = if methods.len() == 1 { \"a\" } else { \"some\" },\n                 s = pluralize!(methods.len()),\n-                are = if methods.len() == 1 { \"is\" } else { \"are\" },\n+                are = pluralize!(\"is\", methods.len()),\n                 r = if methods.len() == 1 { \"s\" } else { \"\" },\n                 ty = expected\n             );"}, {"sha": "06184b4797255a7f98855ea2269990b5bfc66dad", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -1410,7 +1410,7 @@ impl CheckAttrVisitor<'_> {\n                             span,\n                             format!(\n                                 \"there {} only {} argument{}\",\n-                                if arg_count != 1 { \"are\" } else { \"is\" },\n+                                pluralize!(\"is\", arg_count),\n                                 arg_count,\n                                 pluralize!(arg_count)\n                             ),"}, {"sha": "8dec28c8ae283bef8913b1d496bc401bc73a199b", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -504,9 +504,9 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                     for sp in spans {\n                         let msg = if sp == last_bound_span {\n                             format!(\n-                                \"...because of {} bound{}\",\n-                                if bounds.len() <= 2 { \"this\" } else { \"these\" },\n-                                if bounds.len() <= 2 { \"\" } else { \"s\" },\n+                                \"...because of {these} bound{s}\",\n+                                these = pluralize!(\"this\", bounds.len() - 1),\n+                                s = pluralize!(bounds.len() - 1),\n                             )\n                         } else {\n                             String::new()"}, {"sha": "c16be38d5fc3d2c5f86a3bf701a8d68cd3ff74a6", "filename": "compiler/rustc_typeck/src/check/pat.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fpat.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -1761,7 +1761,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             sp,\n             &format!(\n                 \"include the missing field{} in the pattern{}\",\n-                if len == 1 { \"\" } else { \"s\" },\n+                pluralize!(len),\n                 if have_inaccessible_fields { \" and ignore the inaccessible fields\" } else { \"\" }\n             ),\n             format!(\n@@ -1780,10 +1780,10 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         err.span_suggestion(\n             sp,\n             &format!(\n-                \"if you don't care about {} missing field{}, you can explicitly ignore {}\",\n-                if len == 1 { \"this\" } else { \"these\" },\n-                if len == 1 { \"\" } else { \"s\" },\n-                if len == 1 { \"it\" } else { \"them\" },\n+                \"if you don't care about {these} missing field{s}, you can explicitly ignore {them}\",\n+                these = pluralize!(\"this\", len),\n+                s = pluralize!(len),\n+                them = if len == 1 { \"it\" } else { \"them\" },\n             ),\n             format!(\"{}..{}\", prefix, postfix),\n             Applicability::MachineApplicable,"}, {"sha": "303ec910a9f09e2b548f35ec6f2b4430acf087c2", "filename": "compiler/rustc_typeck/src/coherence/inherent_impls.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -7,7 +7,7 @@\n //! `tcx.inherent_impls(def_id)`). That value, however,\n //! is computed by selecting an idea from this table.\n \n-use rustc_errors::struct_span_err;\n+use rustc_errors::{pluralize, struct_span_err};\n use rustc_hir as hir;\n use rustc_hir::def_id::{DefId, LocalDefId};\n use rustc_hir::itemlikevisit::ItemLikeVisitor;\n@@ -410,7 +410,6 @@ impl<'tcx> InherentCollect<'tcx> {\n                 let to_implement = if assoc_items.is_empty() {\n                     String::new()\n                 } else {\n-                    let plural = assoc_items.len() > 1;\n                     let assoc_items_kind = {\n                         let item_types = assoc_items.iter().map(|x| x.kind);\n                         if item_types.clone().all(|x| x == hir::AssocItemKind::Const) {\n@@ -427,9 +426,9 @@ impl<'tcx> InherentCollect<'tcx> {\n \n                     format!(\n                         \" to implement {} {}{}\",\n-                        if plural { \"these\" } else { \"this\" },\n+                        pluralize!(\"this\", assoc_items.len()),\n                         assoc_items_kind,\n-                        if plural { \"s\" } else { \"\" }\n+                        pluralize!(assoc_items.len()),\n                     )\n                 };\n "}, {"sha": "05b57592572a95a4e6c1af59e9937586ad522a50", "filename": "compiler/rustc_typeck/src/structured_errors/wrong_number_of_generic_args.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fstructured_errors%2Fwrong_number_of_generic_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/183262d8d3e2af06f07c5d601b71f407846a267b/compiler%2Frustc_typeck%2Fsrc%2Fstructured_errors%2Fwrong_number_of_generic_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fstructured_errors%2Fwrong_number_of_generic_args.rs?ref=183262d8d3e2af06f07c5d601b71f407846a267b", "patch": "@@ -657,10 +657,9 @@ impl<'a, 'tcx> WrongNumberOfGenericArgs<'a, 'tcx> {\n \n             let num_redundant_lt_args = lt_arg_spans.len() - self.num_expected_lifetime_args();\n             let msg_lifetimes = format!(\n-                \"remove {} {} argument{}\",\n-                if num_redundant_lt_args == 1 { \"this\" } else { \"these\" },\n-                \"lifetime\",\n-                pluralize!(num_redundant_lt_args),\n+                \"remove {these} lifetime argument{s}\",\n+                these = pluralize!(\"this\", num_redundant_lt_args),\n+                s = pluralize!(num_redundant_lt_args),\n             );\n \n             err.span_suggestion(\n@@ -700,10 +699,9 @@ impl<'a, 'tcx> WrongNumberOfGenericArgs<'a, 'tcx> {\n             let num_redundant_gen_args =\n                 gen_arg_spans.len() - self.num_expected_type_or_const_args();\n             let msg_types_or_consts = format!(\n-                \"remove {} {} argument{}\",\n-                if num_redundant_gen_args == 1 { \"this\" } else { \"these\" },\n-                \"generic\",\n-                pluralize!(num_redundant_type_or_const_args),\n+                \"remove {these} generic argument{s}\",\n+                these = pluralize!(\"this\", num_redundant_gen_args),\n+                s = pluralize!(num_redundant_gen_args),\n             );\n \n             err.span_suggestion("}]}