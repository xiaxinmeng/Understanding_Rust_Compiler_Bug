{"sha": "c955f172b2f09f28d187ed7634e18861258833e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5NTVmMTcyYjJmMDlmMjhkMTg3ZWQ3NjM0ZTE4ODYxMjU4ODMzZTU=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2019-02-01T17:17:33Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2019-02-01T17:17:33Z"}, "message": "don't try to get a DefId for a Def that doesn't have one", "tree": {"sha": "c062f78f9ffd07120cc86239a553c37d65cbaa04", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c062f78f9ffd07120cc86239a553c37d65cbaa04"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c955f172b2f09f28d187ed7634e18861258833e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c955f172b2f09f28d187ed7634e18861258833e5", "html_url": "https://github.com/rust-lang/rust/commit/c955f172b2f09f28d187ed7634e18861258833e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c955f172b2f09f28d187ed7634e18861258833e5/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1aa250635e9fd2646116726c88a31c15eb4ab74e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1aa250635e9fd2646116726c88a31c15eb4ab74e", "html_url": "https://github.com/rust-lang/rust/commit/1aa250635e9fd2646116726c88a31c15eb4ab74e"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "8c8151e1e9509f4f47e65e2a94691a9c8cb4f835", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=c955f172b2f09f28d187ed7634e18861258833e5", "patch": "@@ -37,8 +37,11 @@ use super::Clean;\n /// and `Some` of a vector of items if it was successfully expanded.\n pub fn try_inline(cx: &DocContext, def: Def, name: ast::Name, visited: &mut FxHashSet<DefId>)\n                   -> Option<Vec<clean::Item>> {\n-    if def == Def::Err { return None }\n-    let did = def.def_id();\n+    let did = if let Some(did) = def.opt_def_id() {\n+        did\n+    } else {\n+        return None;\n+    };\n     if did.is_local() { return None }\n     let mut ret = Vec::new();\n     let inner = match def {"}, {"sha": "7d736d40b254761b1f0d549726130f110967ad10", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=c955f172b2f09f28d187ed7634e18861258833e5", "patch": "@@ -3818,7 +3818,7 @@ pub fn register_def(cx: &DocContext, def: Def) -> DefId {\n \n fn resolve_use_source(cx: &DocContext, path: Path) -> ImportSource {\n     ImportSource {\n-        did: if path.def == Def::Err {\n+        did: if path.def.opt_def_id().is_none() {\n             None\n         } else {\n             Some(register_def(cx, path.def))"}, {"sha": "b8eb777a54ba4f548493643821ba085b3693fd45", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c955f172b2f09f28d187ed7634e18861258833e5/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=c955f172b2f09f28d187ed7634e18861258833e5", "patch": "@@ -284,10 +284,11 @@ impl<'a, 'tcx, 'rcx> RustdocVisitor<'a, 'tcx, 'rcx> {\n         debug!(\"maybe_inline_local def: {:?}\", def);\n \n         let tcx = self.cx.tcx;\n-        if def == Def::Err {\n+        let def_did = if let Some(did) = def.opt_def_id() {\n+            did\n+        } else {\n             return false;\n-        }\n-        let def_did = def.def_id();\n+        };\n \n         let use_attrs = tcx.hir().attrs(id);\n         // Don't inline `doc(hidden)` imports so they can be stripped at a later stage."}, {"sha": "996b7bba62181499b2b2cb627b780f3d5ab9217e", "filename": "src/test/rustdoc/use-attr.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c955f172b2f09f28d187ed7634e18861258833e5/src%2Ftest%2Frustdoc%2Fuse-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c955f172b2f09f28d187ed7634e18861258833e5/src%2Ftest%2Frustdoc%2Fuse-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fuse-attr.rs?ref=c955f172b2f09f28d187ed7634e18861258833e5", "patch": "@@ -0,0 +1,8 @@\n+// edition:2018\n+\n+// ICE when rustdoc encountered a use statement of a non-macro attribute (see #58054)\n+\n+// @has use_attr/index.html\n+// @has - '//code' 'pub use proc_macro_attribute'\n+pub use proc_macro_attribute;\n+use proc_macro_derive;"}]}