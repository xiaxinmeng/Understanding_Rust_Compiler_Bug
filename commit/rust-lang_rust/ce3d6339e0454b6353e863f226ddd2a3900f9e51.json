{"sha": "ce3d6339e0454b6353e863f226ddd2a3900f9e51", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlM2Q2MzM5ZTA0NTRiNjM1M2U4NjNmMjI2ZGRkMmEzOTAwZjllNTE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-19T01:28:36Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-19T01:28:36Z"}, "message": "rustc: Translate locals in DPS style", "tree": {"sha": "0d0aaa7a96ef2cdaf47fb55faae69c33268b8185", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d0aaa7a96ef2cdaf47fb55faae69c33268b8185"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce3d6339e0454b6353e863f226ddd2a3900f9e51", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce3d6339e0454b6353e863f226ddd2a3900f9e51", "html_url": "https://github.com/rust-lang/rust/commit/ce3d6339e0454b6353e863f226ddd2a3900f9e51", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce3d6339e0454b6353e863f226ddd2a3900f9e51/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "242ec22032f50a7919e0d02e168a3fe11e2cbc6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/242ec22032f50a7919e0d02e168a3fe11e2cbc6a", "html_url": "https://github.com/rust-lang/rust/commit/242ec22032f50a7919e0d02e168a3fe11e2cbc6a"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "25d349fdba9e7223670a0c19cfe1b06b48c6544f", "filename": "src/comp/middle/trans_dps.rs", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/ce3d6339e0454b6353e863f226ddd2a3900f9e51/src%2Fcomp%2Fmiddle%2Ftrans_dps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce3d6339e0454b6353e863f226ddd2a3900f9e51/src%2Fcomp%2Fmiddle%2Ftrans_dps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_dps.rs?ref=ce3d6339e0454b6353e863f226ddd2a3900f9e51", "patch": "@@ -196,7 +196,10 @@ fn store_imm(&@block_ctxt bcx, &dest dest, ValueRef llsrc, bool cast)\n fn store_ptr(&@block_ctxt bcx, &dest dest, ValueRef llsrcptr) -> @block_ctxt {\n     alt (dest) {\n       dst_nil { /* no-op */ }\n-      dst_imm(?box) { fail \"dst_imm in store_ptr\"; }\n+      dst_imm(?box) {\n+        assert (std::option::is_none(*box));\n+        *box = some(bcx.build.Load(llsrcptr));\n+      }\n       dst_alias(?box) {\n         assert (std::option::is_none(*box));\n         *box = some(llsrcptr);\n@@ -423,6 +426,23 @@ fn trans_log(&@block_ctxt cx, &span sp, int level, &@ast::expr expr)\n     ret next_bcx;\n }\n \n+fn trans_path(&@block_ctxt bcx, &dest dest, &ast::path path, ast::node_id id)\n+        -> @block_ctxt {\n+    alt (bcx_tcx(bcx).def_map.get(id)) {\n+      ast::def_local(?def_id) {\n+        alt (bcx_fcx(bcx).lllocals.find(def_id._1)) {\n+          none { bcx_ccx(bcx).sess.unimpl(\"upvar in trans_path\"); }\n+          some(?llptr) {\n+            // TODO: Copy hooks.\n+            store_ptr(bcx, dest, llptr);\n+          }\n+        }\n+      }\n+      _ { bcx_ccx(bcx).sess.unimpl(\"def variant in trans_dps::trans_path\"); }\n+    }\n+    ret bcx;\n+}\n+\n fn trans_expr(&@block_ctxt bcx, &dest dest, &@ast::expr expr) -> @block_ctxt {\n     alt (expr.node) {\n       ast::expr_lit(?lit) { trans_lit(bcx, dest, *lit); ret bcx; }\n@@ -432,6 +452,7 @@ fn trans_expr(&@block_ctxt bcx, &dest dest, &@ast::expr expr) -> @block_ctxt {\n       ast::expr_binary(?op, ?lhs, ?rhs) {\n         ret trans_binary(bcx, dest, expr.span, op, lhs, rhs);\n       }\n+      ast::expr_path(?path) { ret trans_path(bcx, dest, path, expr.id); }\n       _ { fail \"unhandled expr type in trans_expr\"; }\n     }\n }"}]}