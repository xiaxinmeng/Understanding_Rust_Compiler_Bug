{"sha": "2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "node_id": "C_kwDOAAsO6NoAKDJlYWQyZjU2YzBkNTM0MGJmYTI0MjYxYzBiZDg0ZTNkNjlmODExMzg", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2023-03-22T23:43:20Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2023-04-16T15:35:50Z"}, "message": "Remove #[alloc_error_handler] from the compiler and library", "tree": {"sha": "7189bf49bbdd9944c91b98c7c12f30623542c739", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7189bf49bbdd9944c91b98c7c12f30623542c739"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "html_url": "https://github.com/rust-lang/rust/commit/2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ead2f56c0d5340bfa24261c0bd84e3d69f81138/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe3e38306fd8a367cbe0c968bfdb61288f67991d", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe3e38306fd8a367cbe0c968bfdb61288f67991d", "html_url": "https://github.com/rust-lang/rust/commit/fe3e38306fd8a367cbe0c968bfdb61288f67991d"}], "stats": {"total": 30, "additions": 2, "deletions": 28}, "files": [{"sha": "e39c3272958be449815977e48da43524f652f79d", "filename": "example/alloc_example.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2ead2f56c0d5340bfa24261c0bd84e3d69f81138/example%2Falloc_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ead2f56c0d5340bfa24261c0bd84e3d69f81138/example%2Falloc_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/example%2Falloc_example.rs?ref=2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "patch": "@@ -1,4 +1,4 @@\n-#![feature(start, core_intrinsics, alloc_error_handler)]\n+#![feature(start, core_intrinsics)]\n #![no_std]\n \n extern crate alloc;\n@@ -22,11 +22,6 @@ fn panic_handler(_: &core::panic::PanicInfo) -> ! {\n     core::intrinsics::abort();\n }\n \n-#[alloc_error_handler]\n-fn alloc_error_handler(_: alloc::alloc::Layout) -> ! {\n-    core::intrinsics::abort();\n-}\n-\n #[start]\n fn main(_argc: isize, _argv: *const *const u8) -> isize {\n     let world: Box<&str> = Box::new(\"Hello World!\\0\");"}, {"sha": "9fb8079a21fc2a3929f16bba7bdc185889b3831e", "filename": "src/allocator.rs", "status": "modified", "additions": 1, "deletions": 22, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/2ead2f56c0d5340bfa24261c0bd84e3d69f81138/src%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ead2f56c0d5340bfa24261c0bd84e3d69f81138/src%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fallocator.rs?ref=2ead2f56c0d5340bfa24261c0bd84e3d69f81138", "patch": "@@ -6,7 +6,6 @@ use crate::prelude::*;\n use rustc_ast::expand::allocator::{AllocatorKind, AllocatorTy, ALLOCATOR_METHODS};\n use rustc_codegen_ssa::base::allocator_kind_for_codegen;\n use rustc_session::config::OomStrategy;\n-use rustc_span::symbol::sym;\n \n /// Returns whether an allocator shim was created\n pub(crate) fn codegen(\n@@ -15,21 +14,14 @@ pub(crate) fn codegen(\n     unwind_context: &mut UnwindContext,\n ) -> bool {\n     let Some(kind) = allocator_kind_for_codegen(tcx) else { return false };\n-    codegen_inner(\n-        module,\n-        unwind_context,\n-        kind,\n-        tcx.alloc_error_handler_kind(()).unwrap(),\n-        tcx.sess.opts.unstable_opts.oom,\n-    );\n+    codegen_inner(module, unwind_context, kind, tcx.sess.opts.unstable_opts.oom);\n     true\n }\n \n fn codegen_inner(\n     module: &mut impl Module,\n     unwind_context: &mut UnwindContext,\n     kind: AllocatorKind,\n-    alloc_error_handler_kind: AllocatorKind,\n     oom_strategy: OomStrategy,\n ) {\n     let usize_ty = module.target_config().pointer_type();\n@@ -71,19 +63,6 @@ fn codegen_inner(\n         );\n     }\n \n-    let sig = Signature {\n-        call_conv: module.target_config().default_call_conv,\n-        params: vec![AbiParam::new(usize_ty), AbiParam::new(usize_ty)],\n-        returns: vec![],\n-    };\n-    crate::common::create_wrapper_function(\n-        module,\n-        unwind_context,\n-        sig,\n-        \"__rust_alloc_error_handler\",\n-        &alloc_error_handler_kind.fn_name(sym::oom),\n-    );\n-\n     let data_id = module.declare_data(OomStrategy::SYMBOL, Linkage::Export, false, false).unwrap();\n     let mut data_ctx = DataContext::new();\n     data_ctx.set_align(1);"}]}