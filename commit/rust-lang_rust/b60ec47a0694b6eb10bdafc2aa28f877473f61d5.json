{"sha": "b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2MGVjNDdhMDY5NGI2ZWIxMGJkYWZjMmFhMjhmODc3NDczZjYxZDU=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-21T19:21:17Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-22T09:02:00Z"}, "message": "bootstrap: no `config.toml` exists regression\n\nThis commit fixes a regression introduced in #73317 where an oversight\nmeant that `config.toml` was assumed to exist.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "516db4bd61759463bcb22e80136b61ff187898c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/516db4bd61759463bcb22e80136b61ff187898c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl7wc4gACgkQJZLnbIc4\nH9lxYhAAoAenWVAHGs7mpDDapC3fOXYzuEZ5/3OwF84vCEnJrd2KNBmSK1Cn3u3g\nvib/RbsbAyVfYAEbC4486sd3Bx4WT06eH49DhiXBGOq+T/drx5sdYG2CwkKTofE2\nCKtjS8gZdGGxQVAWIcFy3PLTIITfMfRwf8JlxKCMDghO6rO72SK4hGLwI6LZgRXf\nprPk4X37Q7C7f9b6b+3zIIuBSpsUF7vQZNivo/l9oPGvhVkFzPvViIMvobOkgOrx\nVo7iLQNviqfdfo14nQJ6CLfvvNTPTigG0lGtVFz0n7CJqvONmtUbSdoc9E1E9hJl\n4kcvsS/hhfZ0e9MjgKAoyJG5sVr83iZgbvhBPdFTK38vUrCi9TzIY157QnmbQXqd\n3jR2WpkSxRt8FvnsdMGk/2QXF1fXi616WeVEEWyVrwM3WeAO8fIKMjCi1wSmNZ6W\nqKGkQZvP3mlyYlwA9ZWJzguq2lZ2a1xI7GN3vJh5EUOuMDmaSx3O9h/hN6JBItgX\nPgF0xYuupPSFcqtBDe34BtCV1L3v76/U3TCgNP8z3ukpzoz3FQxoJaVOi+Ax9B1q\n3f9PTPg8EdzFkJY94M1nBKNLtgtthWKhRJkQRE0hoy9D98B6UhVhk7Gl5eMPlQQY\nJXP6FRS5i+tMtl1p3tx7rraskGTiau3DLM6h4mWZgf/gPJEE1xU=\n=mRU6\n-----END PGP SIGNATURE-----", "payload": "tree 516db4bd61759463bcb22e80136b61ff187898c0\nparent 033013cab3a861224fd55f494c8be1cb0349eb49\nauthor David Wood <david@davidtw.co> 1592767277 +0100\ncommitter David Wood <david@davidtw.co> 1592816520 +0100\n\nbootstrap: no `config.toml` exists regression\n\nThis commit fixes a regression introduced in #73317 where an oversight\nmeant that `config.toml` was assumed to exist.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "html_url": "https://github.com/rust-lang/rust/commit/b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b60ec47a0694b6eb10bdafc2aa28f877473f61d5/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "033013cab3a861224fd55f494c8be1cb0349eb49", "url": "https://api.github.com/repos/rust-lang/rust/commits/033013cab3a861224fd55f494c8be1cb0349eb49", "html_url": "https://github.com/rust-lang/rust/commit/033013cab3a861224fd55f494c8be1cb0349eb49"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "82a755c7892b13d1652de7c616a298499230a444", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b60ec47a0694b6eb10bdafc2aa28f877473f61d5/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b60ec47a0694b6eb10bdafc2aa28f877473f61d5/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "patch": "@@ -893,15 +893,18 @@ def bootstrap(help_triggered):\n     build.verbose = args.verbose\n     build.clean = args.clean\n \n-    try:\n-        toml_path = os.getenv('RUST_BOOTSTRAP_CONFIG') or args.config or 'config.toml'\n+    # Read from `RUST_BOOTSTRAP_CONFIG`, then `--config`, then fallback to `config.toml` (if it\n+    # exists).\n+    toml_path = os.getenv('RUST_BOOTSTRAP_CONFIG') or args.config\n+    if not toml_path and os.path.exists('config.toml'):\n+        toml_path = 'config.toml'\n+\n+    if toml_path:\n         if not os.path.exists(toml_path):\n             toml_path = os.path.join(build.rust_root, toml_path)\n \n         with open(toml_path) as config:\n             build.config_toml = config.read()\n-    except (OSError, IOError):\n-        pass\n \n     config_verbose = build.get_toml('verbose', 'build')\n     if config_verbose is not None:\n@@ -947,11 +950,12 @@ def bootstrap(help_triggered):\n     env[\"SRC\"] = build.rust_root\n     env[\"BOOTSTRAP_PARENT_ID\"] = str(os.getpid())\n     env[\"BOOTSTRAP_PYTHON\"] = sys.executable\n-    env[\"BOOTSTRAP_CONFIG\"] = toml_path\n     env[\"BUILD_DIR\"] = build.build_dir\n     env[\"RUSTC_BOOTSTRAP\"] = '1'\n     env[\"CARGO\"] = build.cargo()\n     env[\"RUSTC\"] = build.rustc()\n+    if toml_path:\n+        env[\"BOOTSTRAP_CONFIG\"] = toml_path\n     if build.rustfmt():\n         env[\"RUSTFMT\"] = build.rustfmt()\n     run(args, env=env, verbose=build.verbose)"}]}