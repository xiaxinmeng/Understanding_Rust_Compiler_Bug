{"sha": "dd13761f85f078160f22b947c95bd1461ed23d1b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkMTM3NjFmODVmMDc4MTYwZjIyYjk0N2M5NWJkMTQ2MWVkMjNkMWI=", "commit": {"author": {"name": "Seiichi Uchida", "email": "topecongiro@localhost.localdomain", "date": "2017-06-03T14:18:39Z"}, "committer": {"name": "Seiichi Uchida", "email": "topecongiro@localhost.localdomain", "date": "2017-06-03T14:18:39Z"}, "message": "Organize vertical layout of function definition", "tree": {"sha": "f0b1d8256918bb35d1ccb223e31429799c101a33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f0b1d8256918bb35d1ccb223e31429799c101a33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd13761f85f078160f22b947c95bd1461ed23d1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd13761f85f078160f22b947c95bd1461ed23d1b", "html_url": "https://github.com/rust-lang/rust/commit/dd13761f85f078160f22b947c95bd1461ed23d1b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd13761f85f078160f22b947c95bd1461ed23d1b/comments", "author": null, "committer": null, "parents": [{"sha": "9b7ba980cf9b7f69a8c637aec9c7e2bb9d0fc931", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b7ba980cf9b7f69a8c637aec9c7e2bb9d0fc931", "html_url": "https://github.com/rust-lang/rust/commit/9b7ba980cf9b7f69a8c637aec9c7e2bb9d0fc931"}], "stats": {"total": 39, "additions": 26, "deletions": 13}, "files": [{"sha": "051fb0617d99a92467a7a41e78c6494f70ac81d3", "filename": "src/items.rs", "status": "modified", "additions": 17, "deletions": 13, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/dd13761f85f078160f22b947c95bd1461ed23d1b/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd13761f85f078160f22b947c95bd1461ed23d1b/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=dd13761f85f078160f22b947c95bd1461ed23d1b", "patch": "@@ -1622,24 +1622,28 @@ fn rewrite_fn_base(context: &RewriteContext,\n     // Check if vertical layout was forced.\n     if one_line_budget == 0 {\n         if snuggle_angle_bracket {\n-            result.push_str(\"(\");\n-        } else if context.config.fn_args_paren_newline() {\n-            result.push('\\n');\n-            result.push_str(&arg_indent.to_string(context.config));\n-            arg_indent = arg_indent + 1; // extra space for `(`\n             result.push('(');\n-            if context.config.spaces_within_parens() && fd.inputs.len() > 0 {\n-                result.push(' ')\n-            }\n         } else {\n-            result.push_str(\"(\\n\");\n-            result.push_str(&arg_indent.to_string(context.config));\n+            if context.config.fn_args_paren_newline() {\n+                result.push('\\n');\n+                result.push_str(&arg_indent.to_string(context.config));\n+                if context.config.fn_args_layout() == IndentStyle::Visual {\n+                    arg_indent = arg_indent + 1; // extra space for `(`\n+                }\n+                result.push('(');\n+            } else {\n+                result.push_str(\"(\");\n+                if context.config.fn_args_layout() == IndentStyle::Visual {\n+                    result.push('\\n');\n+                    result.push_str(&arg_indent.to_string(context.config));\n+                }\n+            }\n         }\n     } else {\n         result.push('(');\n-        if context.config.spaces_within_parens() && fd.inputs.len() > 0 {\n-            result.push(' ')\n-        }\n+    }\n+    if context.config.spaces_within_parens() && fd.inputs.len() > 0 && result.ends_with('(') {\n+        result.push(' ')\n     }\n \n     if multi_line_ret_str {"}, {"sha": "dcdb18611a652ec9b46e0e1d31bde71a0fece998", "filename": "tests/target/issue-1624.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/dd13761f85f078160f22b947c95bd1461ed23d1b/tests%2Ftarget%2Fissue-1624.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd13761f85f078160f22b947c95bd1461ed23d1b/tests%2Ftarget%2Fissue-1624.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-1624.rs?ref=dd13761f85f078160f22b947c95bd1461ed23d1b", "patch": "@@ -0,0 +1,9 @@\n+// rustfmt-fn_args_layout: Block\n+// rustfmt-fn_args_paren_newline: false\n+\n+// #1624\n+pub unsafe fn some_long_function_name(\n+    arg1: Type1,\n+    arg2: Type2,\n+) -> (SomeLongTypeName, AnotherLongTypeName, AnotherLongTypeName) {\n+}"}]}