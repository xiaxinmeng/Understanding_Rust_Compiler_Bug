{"sha": "22a9582ca22869df08118c57d32620857e723c7b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyYTk1ODJjYTIyODY5ZGYwODExOGM1N2QzMjYyMDg1N2U3MjNjN2I=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-03-17T23:28:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-17T23:28:16Z"}, "message": "Rollup merge of #83228 - GuillaumeGomez:no-diff-if-no-tidy, r=jyn514\n\nDon't show HTML diff if tidy isn't installed for rustdoc tests\n\nThe output without the `tidy` tool is just way too big to be of any use. It makes reading the error much more complicated.\n\nr? ``@jyn514``", "tree": {"sha": "596ca486ae44f96ddc515dbab72f9ebf72687bc7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/596ca486ae44f96ddc515dbab72f9ebf72687bc7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22a9582ca22869df08118c57d32620857e723c7b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgUpCQCRBK7hj4Ov3rIwAAdHIIAFUK+O4MJpNNJUiigtJCxTv4\nFoBY5o2c/C5WVhGX5gVLyF2d1Qj1H8PIK55yHPyaxWtCXm3QPl3A7Xl8mUhTZ7pe\nKKJs/l5HWR7BfNHZVo6cDH9+yW6xs+HsL2CxHAs7uGLoCQT71Z3WJbo6C3+KBYo3\n+Y7kKgLhANVKRLuirbalNSTgL4zxRTArOTksHh+4I1k4fP9XTazsWsdiLuDekFo7\nXPf2VJqxI2+byqMD4o6TUWjEdczzlBnzH7DrAiuVmk0Qji5mc3XHWYzxJwZ0U5De\nWaT+a/4/gW6BcKhV9W882pYzchmwfGb1o+NPTdG0UhJOCWhJdlMNRFKDCI5OEUE=\n=BFh6\n-----END PGP SIGNATURE-----\n", "payload": "tree 596ca486ae44f96ddc515dbab72f9ebf72687bc7\nparent 03400455e151b0af745b94fc864186c82fe02e36\nparent ee98c6fea4b96abd8cad6616291657dc05329045\nauthor Dylan DPC <dylan.dpc@gmail.com> 1616023696 +0100\ncommitter GitHub <noreply@github.com> 1616023696 +0100\n\nRollup merge of #83228 - GuillaumeGomez:no-diff-if-no-tidy, r=jyn514\n\nDon't show HTML diff if tidy isn't installed for rustdoc tests\n\nThe output without the `tidy` tool is just way too big to be of any use. It makes reading the error much more complicated.\n\nr? ``@jyn514``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22a9582ca22869df08118c57d32620857e723c7b", "html_url": "https://github.com/rust-lang/rust/commit/22a9582ca22869df08118c57d32620857e723c7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22a9582ca22869df08118c57d32620857e723c7b/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03400455e151b0af745b94fc864186c82fe02e36", "url": "https://api.github.com/repos/rust-lang/rust/commits/03400455e151b0af745b94fc864186c82fe02e36", "html_url": "https://github.com/rust-lang/rust/commit/03400455e151b0af745b94fc864186c82fe02e36"}, {"sha": "ee98c6fea4b96abd8cad6616291657dc05329045", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee98c6fea4b96abd8cad6616291657dc05329045", "html_url": "https://github.com/rust-lang/rust/commit/ee98c6fea4b96abd8cad6616291657dc05329045"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "1d4b5e1247de742cfc06ef58ac4cb6d61fe0eee3", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/22a9582ca22869df08118c57d32620857e723c7b/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22a9582ca22869df08118c57d32620857e723c7b/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=22a9582ca22869df08118c57d32620857e723c7b", "patch": "@@ -44,7 +44,7 @@ fn main() {\n     }\n \n     if !config.has_tidy && config.mode == Mode::Rustdoc {\n-        eprintln!(\"warning: `tidy` is not installed; generated diffs will be harder to read\");\n+        eprintln!(\"warning: `tidy` is not installed; diffs will not be generated\");\n     }\n \n     log_config(&config);"}, {"sha": "7aa3d4ab09e41025c990ca125a54b084be53a8d8", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/22a9582ca22869df08118c57d32620857e723c7b/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22a9582ca22869df08118c57d32620857e723c7b/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=22a9582ca22869df08118c57d32620857e723c7b", "patch": "@@ -2367,6 +2367,9 @@ impl<'test> TestCx<'test> {\n     }\n \n     fn compare_to_default_rustdoc(&mut self, out_dir: &Path) {\n+        if !self.config.has_tidy {\n+            return;\n+        }\n         println!(\"info: generating a diff against nightly rustdoc\");\n \n         let suffix =\n@@ -2428,10 +2431,8 @@ impl<'test> TestCx<'test> {\n                 }\n             }\n         };\n-        if self.config.has_tidy {\n-            tidy_dir(out_dir);\n-            tidy_dir(&compare_dir);\n-        }\n+        tidy_dir(out_dir);\n+        tidy_dir(&compare_dir);\n \n         let pager = {\n             let output = Command::new(\"git\").args(&[\"config\", \"--get\", \"core.pager\"]).output().ok();"}]}