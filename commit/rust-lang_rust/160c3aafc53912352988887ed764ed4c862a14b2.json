{"sha": "160c3aafc53912352988887ed764ed4c862a14b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2MGMzYWFmYzUzOTEyMzUyOTg4ODg3ZWQ3NjRlZDRjODYyYTE0YjI=", "commit": {"author": {"name": "St\u00e9phane Campinas", "email": "stephane.campinas@gmail.com", "date": "2019-10-07T07:40:27Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2019-10-07T07:40:27Z"}, "message": "handle hard tabs when formatting trailing comments (#3836)", "tree": {"sha": "fc1df7d5aac4be1106de7ae950056a7752b13848", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc1df7d5aac4be1106de7ae950056a7752b13848"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/160c3aafc53912352988887ed764ed4c862a14b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/160c3aafc53912352988887ed764ed4c862a14b2", "html_url": "https://github.com/rust-lang/rust/commit/160c3aafc53912352988887ed764ed4c862a14b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/160c3aafc53912352988887ed764ed4c862a14b2/comments", "author": {"login": "scampi", "id": 795879, "node_id": "MDQ6VXNlcjc5NTg3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/795879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scampi", "html_url": "https://github.com/scampi", "followers_url": "https://api.github.com/users/scampi/followers", "following_url": "https://api.github.com/users/scampi/following{/other_user}", "gists_url": "https://api.github.com/users/scampi/gists{/gist_id}", "starred_url": "https://api.github.com/users/scampi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scampi/subscriptions", "organizations_url": "https://api.github.com/users/scampi/orgs", "repos_url": "https://api.github.com/users/scampi/repos", "events_url": "https://api.github.com/users/scampi/events{/privacy}", "received_events_url": "https://api.github.com/users/scampi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33e3667085e4c73d4391c6168552458eb47664de", "url": "https://api.github.com/repos/rust-lang/rust/commits/33e3667085e4c73d4391c6168552458eb47664de", "html_url": "https://github.com/rust-lang/rust/commit/33e3667085e4c73d4391c6168552458eb47664de"}], "stats": {"total": 62, "additions": 53, "deletions": 9}, "files": [{"sha": "a957d3b3e30256524c4df2e510094e98707cec27", "filename": "src/missed_spans.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/src%2Fmissed_spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/src%2Fmissed_spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmissed_spans.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "patch": "@@ -7,7 +7,7 @@ use crate::config::Version;\n use crate::coverage::transform_missing_snippet;\n use crate::shape::{Indent, Shape};\n use crate::source_map::LineRangeUtils;\n-use crate::utils::{count_lf_crlf, count_newlines, last_line_indent, last_line_width, mk_sp};\n+use crate::utils::{count_lf_crlf, count_newlines, last_line_width, mk_sp};\n use crate::visitor::FmtVisitor;\n \n struct SnippetStatus {\n@@ -254,7 +254,7 @@ impl<'a> FmtVisitor<'a> {\n             // the same level and avoid mixing it with possible other comment.\n             on_same_line = true;\n             self.push_str(\" \");\n-            Indent::from_width(self.config, last_line_indent(&self.buffer))\n+            self.block_indent\n         } else {\n             self.push_str(\" \");\n             Indent::from_width(self.config, last_line_width(&self.buffer))"}, {"sha": "47f9cd94b8df5b701efa6674628cfbbb5966e4ab", "filename": "src/utils.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "patch": "@@ -205,13 +205,6 @@ pub(crate) fn last_line_width(s: &str) -> usize {\n     unicode_str_width(s.rsplitn(2, '\\n').next().unwrap_or(\"\"))\n }\n \n-/// The indent width of the last line in s.\n-#[inline]\n-pub(crate) fn last_line_indent(s: &str) -> usize {\n-    let last_line = s.rsplitn(2, '\\n').next().unwrap_or(\"\");\n-    last_line.chars().take_while(|c| c.is_whitespace()).count()\n-}\n-\n /// The total used width of the last line.\n #[inline]\n pub(crate) fn last_line_used_width(s: &str, offset: usize) -> usize {"}, {"sha": "88249aa5fb9978ff2ecbe18b34b8c057abc38750", "filename": "tests/source/trailing_comments/hard_tabs.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Fsource%2Ftrailing_comments%2Fhard_tabs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Fsource%2Ftrailing_comments%2Fhard_tabs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ftrailing_comments%2Fhard_tabs.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "patch": "@@ -0,0 +1,21 @@\n+// rustfmt-version: Two\n+// rustfmt-wrap_comments: true\n+// rustfmt-hard_tabs: true\n+\n+impl Foo {\n+    fn foo() {\n+        bar(); // comment 1\n+        // comment 2\n+        // comment 3\n+        baz();\n+    }\n+}\n+\n+fn lorem_ipsum() {\n+    let f = bar(); // Donec consequat mi. Quisque vitae dolor. Integer lobortis. Maecenas id nulla. Lorem.\n+    // Id turpis. Nam posuere lectus vitae nibh. Etiam tortor orci, sagittis malesuada, rhoncus quis, hendrerit eget, libero. Quisque commodo nulla at nunc. Mauris consequat, enim vitae venenatis sollicitudin, dolor orci bibendum enim, a sagittis nulla nunc quis elit. Phasellus augue. Nunc suscipit, magna tincidunt lacinia faucibus, lacus tellus ornare purus, a pulvinar lacus orci eget nibh.  Maecenas sed nibh non lacus tempor faucibus. In hac habitasse platea dictumst. Vivamus a orci at nulla tristique condimentum. Donec arcu quam, dictum accumsan, convallis accumsan, cursus sit amet, ipsum.  In pharetra sagittis nunc.\n+    let b = baz();\n+\n+    let normalized = self.ctfont.all_traits().normalized_weight(); // [-1.0, 1.0]\n+    // TODO(emilio): It may make sense to make this range [.01, 10.0], to align with css-fonts-4's range of [1, 1000].\n+}"}, {"sha": "7845f713b8a934ab3d3930ff624293bcdbf5da00", "filename": "tests/source/trailing_comments/soft_tabs.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Fsource%2Ftrailing_comments%2Fsoft_tabs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Fsource%2Ftrailing_comments%2Fsoft_tabs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ftrailing_comments%2Fsoft_tabs.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "previous_filename": "tests/source/trailing_comments.rs"}, {"sha": "35e72f1affdbd6a70bf2468fe56175b36653db31", "filename": "tests/target/trailing_comments/hard_tabs.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Ftarget%2Ftrailing_comments%2Fhard_tabs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Ftarget%2Ftrailing_comments%2Fhard_tabs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftrailing_comments%2Fhard_tabs.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "patch": "@@ -0,0 +1,30 @@\n+// rustfmt-version: Two\n+// rustfmt-wrap_comments: true\n+// rustfmt-hard_tabs: true\n+\n+impl Foo {\n+\tfn foo() {\n+\t\tbar(); // comment 1\n+\t\t// comment 2\n+\t\t// comment 3\n+\t\tbaz();\n+\t}\n+}\n+\n+fn lorem_ipsum() {\n+\tlet f = bar(); // Donec consequat mi. Quisque vitae dolor. Integer lobortis. Maecenas id nulla. Lorem.\n+\t// Id turpis. Nam posuere lectus vitae nibh. Etiam tortor orci, sagittis\n+\t// malesuada, rhoncus quis, hendrerit eget, libero. Quisque commodo nulla at\n+\t// nunc. Mauris consequat, enim vitae venenatis sollicitudin, dolor orci\n+\t// bibendum enim, a sagittis nulla nunc quis elit. Phasellus augue. Nunc\n+\t// suscipit, magna tincidunt lacinia faucibus, lacus tellus ornare purus, a\n+\t// pulvinar lacus orci eget nibh.  Maecenas sed nibh non lacus tempor faucibus.\n+\t// In hac habitasse platea dictumst. Vivamus a orci at nulla tristique\n+\t// condimentum. Donec arcu quam, dictum accumsan, convallis accumsan, cursus sit\n+\t// amet, ipsum.  In pharetra sagittis nunc.\n+\tlet b = baz();\n+\n+\tlet normalized = self.ctfont.all_traits().normalized_weight(); // [-1.0, 1.0]\n+\t// TODO(emilio): It may make sense to make this range [.01, 10.0], to align\n+\t// with css-fonts-4's range of [1, 1000].\n+}"}, {"sha": "eba943042ad0a0a6e44c9a11109012d7ba2f89ad", "filename": "tests/target/trailing_comments/soft_tabs.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Ftarget%2Ftrailing_comments%2Fsoft_tabs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160c3aafc53912352988887ed764ed4c862a14b2/tests%2Ftarget%2Ftrailing_comments%2Fsoft_tabs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftrailing_comments%2Fsoft_tabs.rs?ref=160c3aafc53912352988887ed764ed4c862a14b2", "previous_filename": "tests/target/trailing_comments.rs"}]}