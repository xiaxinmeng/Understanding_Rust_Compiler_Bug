{"sha": "cb3071b2736244db03f800102f123f437fabc9c1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiMzA3MWIyNzM2MjQ0ZGIwM2Y4MDAxMDJmMTIzZjQzN2ZhYmM5YzE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-05-13T17:03:00Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-05-19T17:53:07Z"}, "message": "mk: Update `make dist` for MSVC targets\n\nThis commit updates the `dist` target for MSVC to not build the mingw components\nand to also ensure that the `llvm-ar.exe` binary is ferried along into the right\nlocation for installs.", "tree": {"sha": "c1a565e86a99035ffa30d0be5311cdc2c9a2ead6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c1a565e86a99035ffa30d0be5311cdc2c9a2ead6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb3071b2736244db03f800102f123f437fabc9c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb3071b2736244db03f800102f123f437fabc9c1", "html_url": "https://github.com/rust-lang/rust/commit/cb3071b2736244db03f800102f123f437fabc9c1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb3071b2736244db03f800102f123f437fabc9c1/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74f4f395aefd1054b8d8974a128007d0671e9d78", "url": "https://api.github.com/repos/rust-lang/rust/commits/74f4f395aefd1054b8d8974a128007d0671e9d78", "html_url": "https://github.com/rust-lang/rust/commit/74f4f395aefd1054b8d8974a128007d0671e9d78"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "bd1088b7cd13348ef691d2994b690acae8ca991a", "filename": "mk/cfg/x86_64-pc-windows-msvc.mk", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fcfg%2Fx86_64-pc-windows-msvc.mk", "raw_url": "https://github.com/rust-lang/rust/raw/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fcfg%2Fx86_64-pc-windows-msvc.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Fx86_64-pc-windows-msvc.mk?ref=cb3071b2736244db03f800102f123f437fabc9c1", "patch": "@@ -45,6 +45,7 @@ endif\n # instead of `lib.exe` for assembling archives, so we need to inject this custom\n # dependency here.\n NATIVE_TOOL_DEPS_core_T_x86_64-pc-windows-msvc += llvm-ar.exe\n+INSTALLED_BINS_x86_64-pc-windows-msvc += llvm-ar.exe\n \n # When working with MSVC on windows, each DLL needs to explicitly declare its\n # interface to the outside world through some means. The options for doing so"}, {"sha": "9aab51daba9141dffff527dfd5d95cd4134168b0", "filename": "mk/dist.mk", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=cb3071b2736244db03f800102f123f437fabc9c1", "patch": "@@ -144,9 +144,11 @@ dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1) prepare-overlay-$(1)\n \t@$(call E, build: $$@)\n # Copy essential gcc components into installer\n ifdef CFG_WINDOWSY_$(1)\n+ifeq ($$(findstring gnu,$(1)),gnu)\n \t$$(Q)rm -Rf tmp/dist/win-rust-gcc-$(1)\n \t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py tmp/dist/$$(PKG_NAME)-$(1)-image tmp/dist/win-rust-gcc-$(1) $(1)\n \t$$(Q)cp -r $$(S)src/etc/third-party tmp/dist/$$(PKG_NAME)-$(1)-image/share/doc/\n+endif\n endif\n \t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n \t\t--product-name=Rust \\\n@@ -213,7 +215,14 @@ endif\n dist-install-dirs: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n \n ifdef CFG_WINDOWSY_$(CFG_BUILD)\n-MAYBE_MINGW_TARBALLS=$(foreach host,$(CFG_HOST),dist/$(MINGW_PKG_NAME)-$(host).tar.gz)\n+define BUILD_MINGW_TARBALL\n+ifeq ($$(findstring gnu,$(1)),gnu)\n+MAYBE_MINGW_TARBALLS += dist/$(MINGW_PKG_NAME)-$(1).tar.gz\n+endif\n+endef\n+\n+$(foreach host,$(CFG_HOST),\\\n+  $(eval $(call BUILD_MINGW_TARBALL,$(host))))\n endif\n \n ifeq ($(CFG_DISABLE_DOCS),)"}, {"sha": "573b7ac79fd1a2fc20241ab854b8d6d25dc42859", "filename": "mk/prepare.mk", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/cb3071b2736244db03f800102f123f437fabc9c1/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=cb3071b2736244db03f800102f123f437fabc9c1", "patch": "@@ -36,7 +36,10 @@ endef\n \n # Copy an executable\n # $(1) is the filename/libname-glob\n+#\n+# Gee, what's up with that $(nop)? See comment below.\n define PREPARE_BIN\n+\t$(nop)\n \t@$(call E, prepare: $(PREPARE_DEST_BIN_DIR)/$(1))\n \t$(Q)$(PREPARE_BIN_CMD) $(PREPARE_SOURCE_BIN_DIR)/$(1) $(PREPARE_DEST_BIN_DIR)/$(1)\n endef\n@@ -119,6 +122,8 @@ define DEF_PREPARE_TARGET_N\n # Rebind PREPARE_*_LIB_DIR to point to rustlib, then install the libs for the targets\n prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_LIB_DIR)/rustlib/$(2)/lib\n prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_LIB_DIR)/rustlib/$(2)/lib\n+prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_SOURCE_BIN_DIR=$$(PREPARE_SOURCE_LIB_DIR)/rustlib/$(3)/bin\n+prepare-target-$(2)-host-$(3)-$(1)-$(4): PREPARE_DEST_BIN_DIR=$$(PREPARE_DEST_LIB_DIR)/rustlib/$(3)/bin\n prepare-target-$(2)-host-$(3)-$(1)-$(4): prepare-maybe-clean-$(4) \\\n         $$(foreach crate,$$(TARGET_CRATES), \\\n           $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\\n@@ -133,6 +138,7 @@ prepare-target-$(2)-host-$(3)-$(1)-$(4): prepare-maybe-clean-$(4) \\\n       $$(if $$(findstring $(2), $$(PREPARE_TARGETS)), \\\n         $$(if $$(findstring $(3), $$(PREPARE_HOST)), \\\n           $$(call PREPARE_DIR,$$(PREPARE_WORKING_DEST_LIB_DIR)) \\\n+          $$(call PREPARE_DIR,$$(PREPARE_DEST_BIN_DIR)) \\\n           $$(foreach crate,$$(TARGET_CRATES), \\\n \t    $$(if $$(or $$(findstring 1, $$(ONLY_RLIB_$$(crate))),$$(findstring 1,$$(CFG_INSTALL_ONLY_RLIB_$(2)))),, \\\n               $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$(2),$$(crate)))) \\\n@@ -141,7 +147,10 @@ prepare-target-$(2)-host-$(3)-$(1)-$(4): prepare-maybe-clean-$(4) \\\n             $$(foreach crate,$$(HOST_CRATES), \\\n               $$(call PREPARE_LIB,$$(call CFG_LIB_GLOB_$(2),$$(crate)))),) \\\n \t  $$(foreach object,$$(INSTALLED_OBJECTS_$(2)),\\\n-\t    $$(call PREPARE_LIB,$$(object))),),),)\n+\t    $$(call PREPARE_LIB,$$(object))) \\\n+\t  $$(foreach bin,$$(INSTALLED_BINS_$(3)),\\\n+\t    $$(call PREPARE_BIN,$$(bin))) \\\n+\t,),),)\n endef\n \n define INSTALL_GDB_DEBUGGER_SCRIPTS_COMMANDS"}]}