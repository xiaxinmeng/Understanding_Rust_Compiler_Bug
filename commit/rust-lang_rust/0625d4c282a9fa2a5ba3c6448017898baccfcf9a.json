{"sha": "0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2MjVkNGMyODJhOWZhMmE1YmEzYzY0NDgwMTc4OThiYWNjZmNmOWE=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-02-11T14:28:47Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-02-22T22:31:37Z"}, "message": "begin crate-relative paths with `crate`", "tree": {"sha": "80f45edb1bf43f3302404a5a8cfffdf2284a1580", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/80f45edb1bf43f3302404a5a8cfffdf2284a1580"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "html_url": "https://github.com/rust-lang/rust/commit/0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1eab1b19a39f54a825c9107086f0c1752b81224d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1eab1b19a39f54a825c9107086f0c1752b81224d", "html_url": "https://github.com/rust-lang/rust/commit/1eab1b19a39f54a825c9107086f0c1752b81224d"}], "stats": {"total": 40, "additions": 30, "deletions": 10}, "files": [{"sha": "57978ca9c80a583d63d693c39ace68a6ea80bf1f", "filename": "src/libsyntax/ext/build.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Flibsyntax%2Fext%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Flibsyntax%2Fext%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbuild.rs?ref=0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "patch": "@@ -319,14 +319,8 @@ impl<'a> AstBuilder for ExtCtxt<'a> {\n                 types: Vec<P<ast::Ty>>,\n                 bindings: Vec<ast::TypeBinding> )\n                 -> ast::Path {\n-        use syntax::parse::token;\n-\n         let last_identifier = idents.pop().unwrap();\n         let mut segments: Vec<ast::PathSegment> = Vec::new();\n-        if global &&\n-           !idents.first().map_or(false, |&ident| token::Ident(ident).is_path_segment_keyword()) {\n-            segments.push(ast::PathSegment::crate_root(span));\n-        }\n \n         segments.extend(idents.into_iter().map(|i| ast::PathSegment::from_ident(i, span)));\n         let parameters = if !lifetimes.is_empty() || !types.is_empty() || !bindings.is_empty() {\n@@ -335,7 +329,9 @@ impl<'a> AstBuilder for ExtCtxt<'a> {\n             None\n         };\n         segments.push(ast::PathSegment { identifier: last_identifier, span, parameters });\n-        ast::Path { span, segments }\n+        let path = ast::Path { span, segments };\n+\n+        if global { path.default_to_global() } else { path }\n     }\n \n     /// Constructs a qualified path."}, {"sha": "6cbb7ab393fae06b88bf40f252d9f20944047c19", "filename": "src/libsyntax/test.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Flibsyntax%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Flibsyntax%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ftest.rs?ref=0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "patch": "@@ -733,9 +733,12 @@ fn mk_test_desc_and_fn_rec(cx: &TestCtxt, test: &Test) -> P<ast::Expr> {\n              field(\"should_panic\", fail_expr),\n              field(\"allow_fail\", allow_fail_expr)]);\n \n-\n-    let mut visible_path = match cx.toplevel_reexport {\n-        Some(id) => vec![id],\n+    let mut visible_path = vec![];\n+    if cx.features.extern_absolute_paths {\n+        visible_path.push(keywords::Crate.ident());\n+    }\n+    match cx.toplevel_reexport {\n+        Some(id) => visible_path.push(id),\n         None => {\n             let diag = cx.span_diagnostic;\n             diag.bug(\"expected to find top-level re-export name, but found None\");"}, {"sha": "796f652d6b57ba05aebf395e102307cbb8536842", "filename": "src/test/run-pass/rfc-2126-extern-absolute-paths/test.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Ftest%2Frun-pass%2Frfc-2126-extern-absolute-paths%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0625d4c282a9fa2a5ba3c6448017898baccfcf9a/src%2Ftest%2Frun-pass%2Frfc-2126-extern-absolute-paths%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-2126-extern-absolute-paths%2Ftest.rs?ref=0625d4c282a9fa2a5ba3c6448017898baccfcf9a", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Check that `#[test]` works with extern-absolute-paths enabled.\n+//\n+// Regression test for #47075.\n+\n+// compile-flags: --test\n+\n+#![feature(extern_absolute_paths)]\n+\n+#[test]\n+fn test() {\n+}"}]}