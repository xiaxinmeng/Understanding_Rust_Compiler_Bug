{"sha": "0a4f3473959411b5488b35cf4cc4379cae69a686", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhNGYzNDczOTU5NDExYjU0ODhiMzVjZjRjYzQzNzljYWU2OWE2ODY=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-01-17T15:39:29Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-01-23T09:44:52Z"}, "message": "incr.comp.: Cache generics_of query.", "tree": {"sha": "ecf541b1d1c9fb9d25d7c7fc13dc0859c7a6cbf5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecf541b1d1c9fb9d25d7c7fc13dc0859c7a6cbf5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a4f3473959411b5488b35cf4cc4379cae69a686", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a4f3473959411b5488b35cf4cc4379cae69a686", "html_url": "https://github.com/rust-lang/rust/commit/0a4f3473959411b5488b35cf4cc4379cae69a686", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a4f3473959411b5488b35cf4cc4379cae69a686/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5d7aae8cf7d989d13a0c7f019f42c9a514e1264", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5d7aae8cf7d989d13a0c7f019f42c9a514e1264", "html_url": "https://github.com/rust-lang/rust/commit/a5d7aae8cf7d989d13a0c7f019f42c9a514e1264"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "5143654e91699fb1498d147baac4d46117bbe77e", "filename": "src/librustc/ty/maps/config.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps%2Fconfig.rs?ref=0a4f3473959411b5488b35cf4cc4379cae69a686", "patch": "@@ -617,8 +617,8 @@ impl<'tcx> QueryDescription<'tcx> for queries::optimized_mir<'tcx> {\n     }\n \n     fn try_load_from_disk<'a>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n-                          id: SerializedDepNodeIndex)\n-                          -> Option<Self::Value> {\n+                              id: SerializedDepNodeIndex)\n+                              -> Option<Self::Value> {\n         let mir: Option<::mir::Mir<'tcx>> = tcx.on_disk_query_result_cache\n                                                .try_load_query_result(tcx, id);\n         mir.map(|x| tcx.alloc_mir(x))\n@@ -637,6 +637,21 @@ impl<'tcx> QueryDescription<'tcx> for queries::target_features_whitelist<'tcx> {\n     }\n }\n \n+impl<'tcx> QueryDescription<'tcx> for queries::generics_of<'tcx> {\n+    #[inline]\n+    fn cache_on_disk(def_id: Self::Key) -> bool {\n+        def_id.is_local()\n+    }\n+\n+    fn try_load_from_disk<'a>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n+                              id: SerializedDepNodeIndex)\n+                              -> Option<Self::Value> {\n+        let generics: Option<ty::Generics> = tcx.on_disk_query_result_cache\n+                                                .try_load_query_result(tcx, id);\n+        generics.map(|x| tcx.alloc_generics(x))\n+    }\n+}\n+\n macro_rules! impl_disk_cacheable_query(\n     ($query_name:ident, |$key:tt| $cond:expr) => {\n         impl<'tcx> QueryDescription<'tcx> for queries::$query_name<'tcx> {"}, {"sha": "56ed0f9106f30d689f08e07eb9e94847f74c3490", "filename": "src/librustc/ty/maps/on_disk_cache.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fon_disk_cache.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fon_disk_cache.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps%2Fon_disk_cache.rs?ref=0a4f3473959411b5488b35cf4cc4379cae69a686", "patch": "@@ -205,6 +205,7 @@ impl<'sess> OnDiskCache<'sess> {\n                 let qri = &mut query_result_index;\n \n                 encode_query_results::<type_of, _>(tcx, enc, qri)?;\n+                encode_query_results::<generics_of, _>(tcx, enc, qri)?;\n                 encode_query_results::<predicates_of, _>(tcx, enc, qri)?;\n                 encode_query_results::<used_trait_imports, _>(tcx, enc, qri)?;\n                 encode_query_results::<typeck_tables_of, _>(tcx, enc, qri)?;"}, {"sha": "3e1b490957ccfae5d702beb122d4dab3400a9ac2", "filename": "src/librustc/ty/maps/plumbing.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a4f3473959411b5488b35cf4cc4379cae69a686/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs?ref=0a4f3473959411b5488b35cf4cc4379cae69a686", "patch": "@@ -983,6 +983,7 @@ impl_load_from_cache!(\n     ContainsExternIndicator => contains_extern_indicator,\n     CheckMatch => check_match,\n     TypeOfItem => type_of,\n+    GenericsOfItem => generics_of,\n     PredicatesOfItem => predicates_of,\n     UsedTraitImports => used_trait_imports,\n );"}]}