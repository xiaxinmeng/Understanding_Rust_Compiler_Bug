{"sha": "6520488e37f39a11affd776ab1283a0a3fe8087e", "node_id": "C_kwDOAAsO6NoAKDY1MjA0ODhlMzdmMzlhMTFhZmZkNzc2YWIxMjgzYTBhM2ZlODA4N2U", "commit": {"author": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-01-27T09:11:42Z"}, "committer": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-01-27T09:11:42Z"}, "message": "std: add safety comment in `LazyLock::get`", "tree": {"sha": "522998bfb177bf6d5af666c257fd4eb514e41ddc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/522998bfb177bf6d5af666c257fd4eb514e41ddc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6520488e37f39a11affd776ab1283a0a3fe8087e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEVuz3PwcqDyifNyYbcE4BSbAZSzwFAmPTlU4ACgkQcE4BSbAZ\nSzx6yQ//Zr+ElflNGkk/WEXTe0E8bgkoC/JVhQFN8Q3DoMQgnLy1K0z/Qka8Mlfl\na6yi7D4axCX1tlgv1Xu4D11Cipd0OyycnQeOSPVapPcbbCwLFGkEuzq6LY+4wGXh\nDwmFJWxzQfYWCghyjGyN4zv9ON7eaFAG0SY5jTuC7jcxYCCGHI2gswOtDdysULo1\novgkcVT/3J5WPCj/yrd/ILuvbJLD4Si5TB5RoYLxT6ykPRuhtOgu/mMvGvAqWUSL\nWNcF7Maj4RaFR+TiSzQBjcdnxWKI8F6dRLKJleUXMH6Ez67Fn1Fy7QLTvXI5q1np\n3wBfTyhrbEJpZ92lfEjnMt4aS0htiPt5Nf8Zo6PSh11J7IJhxDFBLvF2HrM4qzy3\nNOmJZTngxchcGOrg8t9NyQ/Pb2eqiy8ujigIsfY3uRIkrN/uz8x/W3e9pVRbHVaa\nRXE2e0/VPJD62EhW1Qd4kkLsfF5dldieCdFa+UABwszV+/9e0DcJBKH1wWmEi5I7\n9LMbYIws6p0/+mSaVmU+uTalSpoNUC/ww8wbQRG/MLyYXgowtp6VOw4xVyqRY0Nr\nYN1wnZ6qyVhvdcDahtdeu9EUCt797DhL17nwtX7Jt/CymHJbcfWkd3PeC8Zze4Lq\nvUeLdmJImgMQYlNmCjkZ2UT7qodGWelqr/hSExuYn+pCIkHOBFY=\n=6fLv\n-----END PGP SIGNATURE-----", "payload": "tree 522998bfb177bf6d5af666c257fd4eb514e41ddc\nparent 7165e610a21ff78a76775ad2941ef882814f4342\nauthor joboet <jonasboettiger@icloud.com> 1674810702 +0100\ncommitter joboet <jonasboettiger@icloud.com> 1674810702 +0100\n\nstd: add safety comment in `LazyLock::get`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6520488e37f39a11affd776ab1283a0a3fe8087e", "html_url": "https://github.com/rust-lang/rust/commit/6520488e37f39a11affd776ab1283a0a3fe8087e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6520488e37f39a11affd776ab1283a0a3fe8087e/comments", "author": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7165e610a21ff78a76775ad2941ef882814f4342", "url": "https://api.github.com/repos/rust-lang/rust/commits/7165e610a21ff78a76775ad2941ef882814f4342", "html_url": "https://github.com/rust-lang/rust/commit/7165e610a21ff78a76775ad2941ef882814f4342"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "7e85d6a063a785fba7e5e182cc9c4e9d55ff2323", "filename": "library/std/src/sync/lazy_lock.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6520488e37f39a11affd776ab1283a0a3fe8087e/library%2Fstd%2Fsrc%2Fsync%2Flazy_lock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6520488e37f39a11affd776ab1283a0a3fe8087e/library%2Fstd%2Fsrc%2Fsync%2Flazy_lock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsync%2Flazy_lock.rs?ref=6520488e37f39a11affd776ab1283a0a3fe8087e", "patch": "@@ -111,7 +111,14 @@ impl<T, F: FnOnce() -> T> LazyLock<T, F> {\n impl<T, F> LazyLock<T, F> {\n     /// Get the inner value if it has already been initialized.\n     fn get(&self) -> Option<&T> {\n-        if self.once.is_completed() { Some(unsafe { &*(*self.data.get()).value }) } else { None }\n+        if self.once.is_completed() {\n+            // SAFETY:\n+            // The closure has been run successfully, so `value` has been initialized\n+            // and will not be modified again.\n+            Some(unsafe { &*(*self.data.get()).value })\n+        } else {\n+            None\n+        }\n     }\n }\n "}]}