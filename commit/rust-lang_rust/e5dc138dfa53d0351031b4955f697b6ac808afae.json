{"sha": "e5dc138dfa53d0351031b4955f697b6ac808afae", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1ZGMxMzhkZmE1M2QwMzUxMDMxYjQ5NTVmNjk3YjZhYzgwOGFmYWU=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-01T19:01:42Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-01T19:01:42Z"}, "message": "Buffer pending whitespace in printer so as not to introduce trailing whitespace lines.", "tree": {"sha": "2bda542eb96bee7e053d8e69fa8db065256ac06a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2bda542eb96bee7e053d8e69fa8db065256ac06a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5dc138dfa53d0351031b4955f697b6ac808afae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5dc138dfa53d0351031b4955f697b6ac808afae", "html_url": "https://github.com/rust-lang/rust/commit/e5dc138dfa53d0351031b4955f697b6ac808afae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5dc138dfa53d0351031b4955f697b6ac808afae/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "681f0c7a2b2f83b34f9c0f22ca8e109b047df13a", "url": "https://api.github.com/repos/rust-lang/rust/commits/681f0c7a2b2f83b34f9c0f22ca8e109b047df13a", "html_url": "https://github.com/rust-lang/rust/commit/681f0c7a2b2f83b34f9c0f22ca8e109b047df13a"}], "stats": {"total": 25, "additions": 17, "deletions": 8}, "files": [{"sha": "9af781e88baf8de337105404883271fe2ff840c9", "filename": "src/comp/pretty/pp.rs", "status": "modified", "additions": 17, "deletions": 8, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/e5dc138dfa53d0351031b4955f697b6ac808afae/src%2Fcomp%2Fpretty%2Fpp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5dc138dfa53d0351031b4955f697b6ac808afae/src%2Fcomp%2Fpretty%2Fpp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fpretty%2Fpp.rs?ref=e5dc138dfa53d0351031b4955f697b6ac808afae", "patch": "@@ -131,7 +131,8 @@ fn mk_printer(io::writer out, uint linewidth) -> printer {\n                 true,             // scan_stack_empty\n                 0u,               // top\n                 0u,               // bottom\n-                print_stack);\n+                print_stack,\n+                0);\n }\n \n /*\n@@ -236,7 +237,10 @@ obj printer(io::writer out,\n             mutable uint bottom,           // index of bottom of scan_stack\n \n             // stack of blocks-in-progress being flushed by print\n-            mutable vec[print_stack_elt] print_stack\n+            mutable vec[print_stack_elt] print_stack,\n+\n+            // buffered indentation to avoid writing trailing whitespace\n+            mutable int pending_indentation\n             ) {\n \n \n@@ -430,16 +434,13 @@ obj printer(io::writer out,\n     fn print_newline(int amount) {\n         log #fmt(\"NEWLINE %d\", amount);\n         out.write_str(\"\\n\");\n+        pending_indentation = 0;\n         self.indent(amount);\n     }\n \n     fn indent(int amount) {\n         log #fmt(\"INDENT %d\", amount);\n-        auto u = 0;\n-        while (u < amount) {\n-            out.write_str(\" \");\n-            u += 1;\n-        }\n+        pending_indentation += amount;\n     }\n \n     fn top() -> print_stack_elt {\n@@ -452,6 +453,14 @@ obj printer(io::writer out,\n         ret top;\n     }\n \n+    fn write_str(str s) {\n+        while (pending_indentation > 0) {\n+            out.write_str(\" \");\n+            pending_indentation -= 1;\n+        }\n+        out.write_str(s);\n+    }\n+\n     fn print(token x, int L) {\n         log #fmt(\"print %s %d (remaining line space=%d)\",\n                  tok_str(x), L, space);\n@@ -515,7 +524,7 @@ obj printer(io::writer out,\n                 assert L == len;\n                 // assert L <= space;\n                 space -= len;\n-                out.write_str(s);\n+                self.write_str(s);\n             }\n \n             case (EOF) {"}]}