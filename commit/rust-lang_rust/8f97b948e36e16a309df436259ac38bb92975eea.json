{"sha": "8f97b948e36e16a309df436259ac38bb92975eea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmOTdiOTQ4ZTM2ZTE2YTMwOWRmNDM2MjU5YWMzOGJiOTI5NzVlZWE=", "commit": {"author": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2021-03-30T17:36:53Z"}, "committer": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2021-03-30T17:47:34Z"}, "message": "bootstrap: don't complain about linkcheck if it is excluded\n\nWe don't need to complain to the user about linkcheck having different\nhosts and targets when it is already excluded. This can be achieved by\nmoving the check to when the step is run instead of in should_run.", "tree": {"sha": "c2b773743bb0350d329b605ecb7b48ce777678b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2b773743bb0350d329b605ecb7b48ce777678b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f97b948e36e16a309df436259ac38bb92975eea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f97b948e36e16a309df436259ac38bb92975eea", "html_url": "https://github.com/rust-lang/rust/commit/8f97b948e36e16a309df436259ac38bb92975eea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f97b948e36e16a309df436259ac38bb92975eea/comments", "author": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b6fc5a3dd73a341010bd51a19008ed679cd1475", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b6fc5a3dd73a341010bd51a19008ed679cd1475", "html_url": "https://github.com/rust-lang/rust/commit/7b6fc5a3dd73a341010bd51a19008ed679cd1475"}], "stats": {"total": 26, "additions": 13, "deletions": 13}, "files": [{"sha": "adb0a372c64dd16d56cba0ecc469efbb47977b8e", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/8f97b948e36e16a309df436259ac38bb92975eea/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f97b948e36e16a309df436259ac38bb92975eea/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=8f97b948e36e16a309df436259ac38bb92975eea", "patch": "@@ -108,6 +108,19 @@ impl Step for Linkcheck {\n     /// documentation to ensure we don't have a bunch of dead ones.\n     fn run(self, builder: &Builder<'_>) {\n         let host = self.host;\n+        let hosts = &builder.hosts;\n+        let targets = &builder.targets;\n+\n+        // if we have different hosts and targets, some things may be built for\n+        // the host (e.g. rustc) and others for the target (e.g. std). The\n+        // documentation built for each will contain broken links to\n+        // docs built for the other platform (e.g. rustc linking to cargo)\n+        if (hosts != targets) && !hosts.is_empty() && !targets.is_empty() {\n+            panic!(\n+                \"Linkcheck currently does not support builds with different hosts and targets.\n+You can skip linkcheck with --exclude src/tools/linkchecker\"\n+            );\n+        }\n \n         builder.info(&format!(\"Linkcheck ({})\", host));\n \n@@ -123,19 +136,6 @@ impl Step for Linkcheck {\n     fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {\n         let builder = run.builder;\n         let run = run.path(\"src/tools/linkchecker\");\n-        let hosts = &builder.hosts;\n-        let targets = &builder.targets;\n-\n-        // if we have different hosts and targets, some things may be built for\n-        // the host (e.g. rustc) and others for the target (e.g. std). The\n-        // documentation built for each will contain broken links to\n-        // docs built for the other platform (e.g. rustc linking to cargo)\n-        if (hosts != targets) && !hosts.is_empty() && !targets.is_empty() {\n-            panic!(\n-                \"Linkcheck currently does not support builds with different hosts and targets.\n-You can skip linkcheck with --exclude src/tools/linkchecker\"\n-            );\n-        }\n         run.default_condition(builder.config.docs)\n     }\n "}]}