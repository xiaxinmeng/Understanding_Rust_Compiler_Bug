{"sha": "681bce925f92eaebc5ae3fc40a6a4a8720e46790", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MWJjZTkyNWY5MmVhZWJjNWFlM2ZjNDBhNmE0YTg3MjBlNDY3OTA=", "commit": {"author": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-09-11T13:30:08Z"}, "committer": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2015-09-11T13:30:08Z"}, "message": "less false positives for approx_const and float_cmp", "tree": {"sha": "e2473dc33b69c2eab922a0f6e299c4a614e13fc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2473dc33b69c2eab922a0f6e299c4a614e13fc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/681bce925f92eaebc5ae3fc40a6a4a8720e46790", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/681bce925f92eaebc5ae3fc40a6a4a8720e46790", "html_url": "https://github.com/rust-lang/rust/commit/681bce925f92eaebc5ae3fc40a6a4a8720e46790", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/681bce925f92eaebc5ae3fc40a6a4a8720e46790/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aefad45ee72441c46765abb0e92eab34b0ae1a6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/aefad45ee72441c46765abb0e92eab34b0ae1a6d", "html_url": "https://github.com/rust-lang/rust/commit/aefad45ee72441c46765abb0e92eab34b0ae1a6d"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "9a3d46c14bb10dcca6acec5fa1b378d16a7597f1", "filename": "src/approx_const.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/681bce925f92eaebc5ae3fc40a6a4a8720e46790/src%2Fapprox_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bce925f92eaebc5ae3fc40a6a4a8720e46790/src%2Fapprox_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fapprox_const.rs?ref=681bce925f92eaebc5ae3fc40a6a4a8720e46790", "patch": "@@ -1,8 +1,9 @@\n use rustc::lint::*;\n+use rustc::metadata::cstore::crate_metadata;\n use rustc_front::hir::*;\n use syntax::codemap::Span;\n+use std::borrow::Borrow;\n use std::f64::consts as f64;\n-\n use utils::span_lint;\n \n declare_lint! {\n@@ -31,6 +32,13 @@ impl LintPass for ApproxConstant {\n \n     fn check_expr(&mut self, cx: &Context, e: &Expr) {\n         if let &ExprLit(ref lit) = &e.node {\n+            if let Some(res) = cx.tcx.def_map.borrow().get(&e.id) {\n+                let krate = res.def_id().krate;\n+                let cdata = &cx.sess().cstore.get_crate_data(krate);\n+                let crate_data : &crate_metadata = cdata.borrow();\n+                let name = &crate_data.name;\n+                if name == \"f32\" || name == \"f64\" { return; }\n+            }\n             check_lit(cx, lit, e.span);\n         }\n     }"}, {"sha": "2cd6babb9c5902e32d4203fa021eca135d3759c4", "filename": "src/misc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/681bce925f92eaebc5ae3fc40a6a4a8720e46790/src%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bce925f92eaebc5ae3fc40a6a4a8720e46790/src%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmisc.rs?ref=681bce925f92eaebc5ae3fc40a6a4a8720e46790", "patch": "@@ -93,7 +93,7 @@ impl LintPass for FloatCmp {\n                     return;\n                 }\n                 if let Some(name) = get_item_name(cx, expr) {\n-                    if name == \"eq\" || name == \"ne\" ||\n+                    if name == \"eq\" || name == \"ne\" || name == \"is_nan\" ||\n                             name.as_str().starts_with(\"eq_\") ||\n                             name.as_str().ends_with(\"_eq\") {\n                         return;"}]}