{"sha": "32453db3326a9e8331695dda549cfb794feb656a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyNDUzZGIzMzI2YTllODMzMTY5NWRkYTU0OWNmYjc5NGZlYjY1NmE=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-07-19T22:11:30Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-07-20T09:22:24Z"}, "message": "resolve: Fully prohibit shadowing of in-scope names by globs in macro paths", "tree": {"sha": "541361f5cf98e2517ac3f39db8507047ed620232", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/541361f5cf98e2517ac3f39db8507047ed620232"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/32453db3326a9e8331695dda549cfb794feb656a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/32453db3326a9e8331695dda549cfb794feb656a", "html_url": "https://github.com/rust-lang/rust/commit/32453db3326a9e8331695dda549cfb794feb656a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/32453db3326a9e8331695dda549cfb794feb656a/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2eb83ee527fdb4bcd740ea41c43e9d2d52f99c1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/2eb83ee527fdb4bcd740ea41c43e9d2d52f99c1c", "html_url": "https://github.com/rust-lang/rust/commit/2eb83ee527fdb4bcd740ea41c43e9d2d52f99c1c"}], "stats": {"total": 98, "additions": 95, "deletions": 3}, "files": [{"sha": "0ad652b4710ce7df95b7c954655e548742cf66f1", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/32453db3326a9e8331695dda549cfb794feb656a/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32453db3326a9e8331695dda549cfb794feb656a/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=32453db3326a9e8331695dda549cfb794feb656a", "patch": "@@ -588,8 +588,7 @@ impl<'a> Resolver<'a> {\n                             return potential_illegal_shadower;\n                         }\n                     }\n-                    if binding.expansion != Mark::root() ||\n-                       (binding.is_glob_import() && module.unwrap().def().is_some()) {\n+                    if binding.is_glob_import() || binding.expansion != Mark::root() {\n                         potential_illegal_shadower = result;\n                     } else {\n                         return result;"}, {"sha": "ba6630529981935ea0dd9e1e24ad66ec634a14f9", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/32453db3326a9e8331695dda549cfb794feb656a/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32453db3326a9e8331695dda549cfb794feb656a/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=32453db3326a9e8331695dda549cfb794feb656a", "patch": "@@ -233,7 +233,7 @@ impl<'a> Resolver<'a> {\n         // What on earth is this?\n         // Apparently one more subtle interaction with `resolve_lexical_macro_path_segment`\n         // that are going to be removed in the next commit.\n-        if restricted_shadowing && module.def().is_some() {\n+        if restricted_shadowing {\n             return Err(Determined);\n         }\n "}, {"sha": "e4f55137e660fbb2561e9f1cc88a137b219c38ff", "filename": "src/test/ui/imports/glob-shadowing.rs", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/32453db3326a9e8331695dda549cfb794feb656a/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32453db3326a9e8331695dda549cfb794feb656a/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.rs?ref=32453db3326a9e8331695dda549cfb794feb656a", "patch": "@@ -0,0 +1,44 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(decl_macro)]\n+\n+mod m {\n+    pub macro env($e: expr) { $e }\n+    pub macro fenv() { 0 }\n+}\n+\n+mod glob_in_normal_module {\n+    use m::*;\n+    fn check() {\n+        let x = env!(\"PATH\"); //~ ERROR `env` is ambiguous\n+    }\n+}\n+\n+mod glob_in_block_module {\n+    fn block() {\n+        use m::*;\n+        fn check() {\n+            let x = env!(\"PATH\"); //~ ERROR `env` is ambiguous\n+        }\n+    }\n+}\n+\n+mod glob_shadows_item {\n+    pub macro fenv($e: expr) { $e }\n+    fn block() {\n+        use m::*;\n+        fn check() {\n+            let x = fenv!(); //~ ERROR `fenv` is ambiguous\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "7f61cd6c76d6ad3c484bb494f21908315e986e22", "filename": "src/test/ui/imports/glob-shadowing.stderr", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/32453db3326a9e8331695dda549cfb794feb656a/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/32453db3326a9e8331695dda549cfb794feb656a/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fglob-shadowing.stderr?ref=32453db3326a9e8331695dda549cfb794feb656a", "patch": "@@ -0,0 +1,49 @@\n+error[E0659]: `env` is ambiguous\n+  --> $DIR/glob-shadowing.rs:21:17\n+   |\n+LL |         let x = env!(\"PATH\"); //~ ERROR `env` is ambiguous\n+   |                 ^^^\n+   |\n+note: `env` could refer to the name imported here\n+  --> $DIR/glob-shadowing.rs:19:9\n+   |\n+LL |     use m::*;\n+   |         ^^^^\n+   = note: `env` is also a builtin macro\n+   = note: consider adding an explicit import of `env` to disambiguate\n+\n+error[E0659]: `env` is ambiguous\n+  --> $DIR/glob-shadowing.rs:29:21\n+   |\n+LL |             let x = env!(\"PATH\"); //~ ERROR `env` is ambiguous\n+   |                     ^^^\n+   |\n+note: `env` could refer to the name imported here\n+  --> $DIR/glob-shadowing.rs:27:13\n+   |\n+LL |         use m::*;\n+   |             ^^^^\n+   = note: `env` is also a builtin macro\n+   = note: consider adding an explicit import of `env` to disambiguate\n+\n+error[E0659]: `fenv` is ambiguous\n+  --> $DIR/glob-shadowing.rs:39:21\n+   |\n+LL |             let x = fenv!(); //~ ERROR `fenv` is ambiguous\n+   |                     ^^^^\n+   |\n+note: `fenv` could refer to the name imported here\n+  --> $DIR/glob-shadowing.rs:37:13\n+   |\n+LL |         use m::*;\n+   |             ^^^^\n+note: `fenv` could also refer to the name defined here\n+  --> $DIR/glob-shadowing.rs:35:5\n+   |\n+LL |     pub macro fenv($e: expr) { $e }\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   = note: consider adding an explicit import of `fenv` to disambiguate\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0659`."}]}