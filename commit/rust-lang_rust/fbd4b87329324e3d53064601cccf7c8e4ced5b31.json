{"sha": "fbd4b87329324e3d53064601cccf7c8e4ced5b31", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiZDRiODczMjkzMjRlM2Q1MzA2NDYwMWNjY2Y3YzhlNGNlZDViMzE=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-01T10:59:50Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-01T10:59:50Z"}, "message": "Use correct one line budget when using Rfc control style", "tree": {"sha": "2b3ec86d551f6bca738326aa045e2caa10a19cab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b3ec86d551f6bca738326aa045e2caa10a19cab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbd4b87329324e3d53064601cccf7c8e4ced5b31", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbd4b87329324e3d53064601cccf7c8e4ced5b31", "html_url": "https://github.com/rust-lang/rust/commit/fbd4b87329324e3d53064601cccf7c8e4ced5b31", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbd4b87329324e3d53064601cccf7c8e4ced5b31/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b79094262f9737b3fd0379fdd2cb0fc6e23008ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/b79094262f9737b3fd0379fdd2cb0fc6e23008ad", "html_url": "https://github.com/rust-lang/rust/commit/b79094262f9737b3fd0379fdd2cb0fc6e23008ad"}], "stats": {"total": 51, "additions": 40, "deletions": 11}, "files": [{"sha": "b05c7ba6c97ca5abac997057d68ca0a51e456156", "filename": "src/expr.rs", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/fbd4b87329324e3d53064601cccf7c8e4ced5b31/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbd4b87329324e3d53064601cccf7c8e4ced5b31/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=fbd4b87329324e3d53064601cccf7c8e4ced5b31", "patch": "@@ -326,23 +326,29 @@ pub fn rewrite_pair<LHS, RHS>(lhs: &LHS,\n \n     // Re-evaluate the rhs because we have more space now:\n     let infix = infix.trim_right();\n-    let lhs_budget = try_opt!(context\n-                                  .config\n-                                  .max_width()\n-                                  .checked_sub(shape.used_width() + prefix.len() + infix.len()));\n     let rhs_shape = match context.config.control_style() {\n         Style::Default => {\n             try_opt!(shape.sub_width(suffix.len() + prefix.len())).visual_indent(prefix.len())\n         }\n-        Style::Rfc => try_opt!(shape.block_left(context.config.tab_spaces())),\n+        Style::Rfc => {\n+            shape\n+                .block_indent(context.config.tab_spaces())\n+                .with_max_width(context.config)\n+        }\n     };\n \n     let rhs_result = try_opt!(rhs.rewrite(context, rhs_shape));\n-    let lhs_result = try_opt!(lhs.rewrite(context,\n-                                          Shape {\n-                                              width: lhs_budget,\n-                                              ..shape\n-                                          }));\n+    let lhs_shape = match context.config.control_style() {\n+        Style::Default => {\n+            let lhs_overhead = shape.used_width() + prefix.len() + infix.len();\n+            Shape {\n+                width: try_opt!(context.config.max_width().checked_sub(lhs_overhead)),\n+                ..shape\n+            }\n+        }\n+        Style::Rfc => try_opt!(shape.sub_width(prefix.len() + infix.len())),\n+    };\n+    let lhs_result = try_opt!(lhs.rewrite(context, lhs_shape));\n     Some(format!(\"{}{}{}\\n{}{}{}\",\n                  prefix,\n                  lhs_result,\n@@ -906,7 +912,7 @@ impl<'a> Rewrite for ControlFlow<'a> {\n             Some(cond) => {\n                 let mut cond_shape = match context.config.control_style() {\n                     Style::Default => try_opt!(constr_shape.shrink_left(add_offset)),\n-                    Style::Rfc => constr_shape,\n+                    Style::Rfc => try_opt!(constr_shape.sub_width(add_offset)),\n                 };\n                 if context.config.control_brace_style() != ControlBraceStyle::AlwaysNextLine {\n                     // 2 = \" {\".len()"}, {"sha": "a7213c34dfb770eab1d6bfe5295985fa1a86a657", "filename": "tests/target/configs-control_style-rfc.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/fbd4b87329324e3d53064601cccf7c8e4ced5b31/tests%2Ftarget%2Fconfigs-control_style-rfc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbd4b87329324e3d53064601cccf7c8e4ced5b31/tests%2Ftarget%2Fconfigs-control_style-rfc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-control_style-rfc.rs?ref=fbd4b87329324e3d53064601cccf7c8e4ced5b31", "patch": "@@ -0,0 +1,23 @@\n+// rustfmt-control_style: Rfc\n+\n+// #1618\n+fn main() {\n+    loop {\n+        if foo {\n+            if ((right_paddle_speed < 0.) &&\n+                 (right_paddle.position().y - paddle_size.y / 2. > 5.)) ||\n+                ((right_paddle_speed > 0.) &&\n+                     (right_paddle.position().y + paddle_size.y / 2. < game_height as f32 - 5.))\n+            {\n+                foo\n+            }\n+            if ai_timer.elapsed_time().as_microseconds() > ai_time.as_microseconds() {\n+                if ball.position().y + ball_radius >\n+                    right_paddle.position().y + paddle_size.y / 2.\n+                {\n+                    foo\n+                }\n+            }\n+        }\n+    }\n+}"}]}