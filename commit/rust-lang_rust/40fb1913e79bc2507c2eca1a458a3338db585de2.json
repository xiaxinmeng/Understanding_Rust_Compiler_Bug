{"sha": "40fb1913e79bc2507c2eca1a458a3338db585de2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwZmIxOTEzZTc5YmMyNTA3YzJlY2ExYTQ1OGEzMzM4ZGI1ODVkZTI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-05-30T21:08:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-30T21:08:46Z"}, "message": "Rollup merge of #72637 - euclio:env-hygiene, r=davidtwco\n\nexpand `env!` with def-site context\n\nSimilar to #66349.\n\nFixes rust-lang/rust-clippy#5619.", "tree": {"sha": "1ecc99bd74c50f4942cc94d489092fbc4e30ea57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ecc99bd74c50f4942cc94d489092fbc4e30ea57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40fb1913e79bc2507c2eca1a458a3338db585de2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe0steCRBK7hj4Ov3rIwAAdHIIALBYXakD6iQvUm+NGP3ECCsY\n5z/klbRgcAzerc8+6/z8iiYYtoglPxf6S/1kgThYB5WZdcdMKV/aCYBRGBL7mM++\nkJSWY+EZmccyqAVPoPx1TpuTwj/4g3vbgEBPi57mQ9l3SLoueZe9yHf9yI7gatEM\nEh9VvM0OdlKDtyZXOdcZ52rBnEM8ohtsDX4wqdUbdoP8OqN1f2rxAprC8KdVb+8M\nabTiFnDz1BbqidZuchfyRskqr3fQtXrM6Zy0GyfmsGDf056zMTQ4WCBd9Ko4xBVR\nWYWYNEbA4lpbmbd+Pjs0l9kH5GuUDoF8Ki2Kk1B7gGcVfAqvelCX2XFeJ5YJD94=\n=vJlD\n-----END PGP SIGNATURE-----\n", "payload": "tree 1ecc99bd74c50f4942cc94d489092fbc4e30ea57\nparent fadfcb644e3e549b5b080260d4ca4ea2696e7007\nparent 68bf8d2487103f90c0427701cf2247d758de9d13\nauthor Ralf Jung <post@ralfj.de> 1590872926 +0200\ncommitter GitHub <noreply@github.com> 1590872926 +0200\n\nRollup merge of #72637 - euclio:env-hygiene, r=davidtwco\n\nexpand `env!` with def-site context\n\nSimilar to #66349.\n\nFixes rust-lang/rust-clippy#5619.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40fb1913e79bc2507c2eca1a458a3338db585de2", "html_url": "https://github.com/rust-lang/rust/commit/40fb1913e79bc2507c2eca1a458a3338db585de2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40fb1913e79bc2507c2eca1a458a3338db585de2/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fadfcb644e3e549b5b080260d4ca4ea2696e7007", "url": "https://api.github.com/repos/rust-lang/rust/commits/fadfcb644e3e549b5b080260d4ca4ea2696e7007", "html_url": "https://github.com/rust-lang/rust/commit/fadfcb644e3e549b5b080260d4ca4ea2696e7007"}, {"sha": "68bf8d2487103f90c0427701cf2247d758de9d13", "url": "https://api.github.com/repos/rust-lang/rust/commits/68bf8d2487103f90c0427701cf2247d758de9d13", "html_url": "https://github.com/rust-lang/rust/commit/68bf8d2487103f90c0427701cf2247d758de9d13"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "d769ebb1f5520d621ef27b299eccee1217607d49", "filename": "src/librustc_builtin_macros/env.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Flibrustc_builtin_macros%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Flibrustc_builtin_macros%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_builtin_macros%2Fenv.rs?ref=40fb1913e79bc2507c2eca1a458a3338db585de2", "patch": "@@ -77,6 +77,7 @@ pub fn expand_env<'cx>(\n         return DummyResult::any(sp);\n     }\n \n+    let sp = cx.with_def_site_ctxt(sp);\n     let e = match env::var(&*var.as_str()) {\n         Err(_) => {\n             cx.span_err(sp, &msg.as_str());"}, {"sha": "56415fd1f0dd0ef4cd262f0f1d440cdd3557b5ad", "filename": "src/test/ui/extenv/extenv-not-defined-custom.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-custom.stderr?ref=40fb1913e79bc2507c2eca1a458a3338db585de2", "patch": "@@ -3,6 +3,8 @@ error: my error message\n    |\n LL | fn main() { env!(\"__HOPEFULLY_NOT_DEFINED__\", \"my error message\"); }\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error\n "}, {"sha": "1a9332c4f1c9fd6e880457cc13ba18e2788cb960", "filename": "src/test/ui/extenv/extenv-not-defined-default.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fextenv-not-defined-default.stderr?ref=40fb1913e79bc2507c2eca1a458a3338db585de2", "patch": "@@ -3,6 +3,8 @@ error: environment variable `__HOPEFULLY_NOT_DEFINED__` not defined\n    |\n LL |     env!(\"__HOPEFULLY_NOT_DEFINED__\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error\n "}, {"sha": "b62f06e33e531ccbf230c6f21d8c12d5e20e6791", "filename": "src/test/ui/extenv/issue-55897.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextenv%2Fissue-55897.stderr?ref=40fb1913e79bc2507c2eca1a458a3338db585de2", "patch": "@@ -3,6 +3,8 @@ error: environment variable `NON_EXISTENT` not defined\n    |\n LL |     include!(concat!(env!(\"NON_EXISTENT\"), \"/data.rs\"));\n    |                      ^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: suffixes on a string literal are invalid\n   --> $DIR/issue-55897.rs:16:22"}, {"sha": "42954ebcdc1cd4df6e4cdf7f70804773b13ecfca", "filename": "src/test/ui/macros/macros-nonfatal-errors.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/40fb1913e79bc2507c2eca1a458a3338db585de2/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.stderr?ref=40fb1913e79bc2507c2eca1a458a3338db585de2", "patch": "@@ -47,6 +47,8 @@ error: environment variable `RUST_HOPEFULLY_THIS_DOESNT_EXIST` not defined\n    |\n LL |     env!(\"RUST_HOPEFULLY_THIS_DOESNT_EXIST\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: format argument must be a string literal\n   --> $DIR/macros-nonfatal-errors.rs:23:13"}]}