{"sha": "933897c5f57cb2ec2e8b53829b74a4b2b572f718", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzMzg5N2M1ZjU3Y2IyZWMyZThiNTM4MjliNzRhNGIyYjU3MmY3MTg=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-05-20T05:15:50Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-06-01T15:31:44Z"}, "message": "integrate jemalloc into the build", "tree": {"sha": "2a8399fbc4daa65b38b350302713283d26236ce2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a8399fbc4daa65b38b350302713283d26236ce2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/933897c5f57cb2ec2e8b53829b74a4b2b572f718", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/933897c5f57cb2ec2e8b53829b74a4b2b572f718", "html_url": "https://github.com/rust-lang/rust/commit/933897c5f57cb2ec2e8b53829b74a4b2b572f718", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/933897c5f57cb2ec2e8b53829b74a4b2b572f718/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cff203ef762dae6f5f93b55c0d491788b24ea6c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/cff203ef762dae6f5f93b55c0d491788b24ea6c4", "html_url": "https://github.com/rust-lang/rust/commit/cff203ef762dae6f5f93b55c0d491788b24ea6c4"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "e581631b71da51a9085c605a537176b4bec93118", "filename": "configure", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/933897c5f57cb2ec2e8b53829b74a4b2b572f718/configure", "raw_url": "https://github.com/rust-lang/rust/raw/933897c5f57cb2ec2e8b53829b74a4b2b572f718/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=933897c5f57cb2ec2e8b53829b74a4b2b572f718", "patch": "@@ -683,7 +683,8 @@ do\n     for i in                                          \\\n       isaac linenoise sync test \\\n       arch/i386 arch/x86_64 arch/arm arch/mips  \\\n-      libuv libuv/src/ares libuv/src/eio libuv/src/ev\n+      libuv libuv/src/ares libuv/src/eio libuv/src/ev \\\n+      jemalloc\n     do\n       make_dir rt/$t/stage$s/$i\n     done"}, {"sha": "025639bf91d6403b324d4d3ce070f57359689025", "filename": "mk/rt.mk", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/933897c5f57cb2ec2e8b53829b74a4b2b572f718/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/933897c5f57cb2ec2e8b53829b74a4b2b572f718/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=933897c5f57cb2ec2e8b53829b74a4b2b572f718", "patch": "@@ -97,18 +97,23 @@ RUNTIME_S_$(1)_$(2) := rt/arch/$$(HOST_$(1))/_context.S \\\n ifeq ($$(CFG_WINDOWSY_$(1)), 1)\n   LIBUV_OSTYPE_$(1)_$(2) := win\n   LIBUV_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/libuv/libuv.a\n+  JEMALLOC_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/jemalloc/lib/libjemalloc_pic.a\n else ifeq ($(OSTYPE_$(1)), apple-darwin)\n   LIBUV_OSTYPE_$(1)_$(2) := mac\n   LIBUV_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/libuv/libuv.a\n+  JEMALLOC_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/jemalloc/lib/libjemalloc_pic.a\n else ifeq ($(OSTYPE_$(1)), unknown-freebsd)\n   LIBUV_OSTYPE_$(1)_$(2) := unix/freebsd\n   LIBUV_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/libuv/libuv.a\n+  JEMALLOC_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/jemalloc/lib/libjemalloc_pic.a\n else ifeq ($(OSTYPE_$(1)), linux-androideabi)\n   LIBUV_OSTYPE_$(1)_$(2) := unix/android\n   LIBUV_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/libuv/libuv.a\n+  JEMALLOC_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/jemalloc/lib/libjemalloc_pic.a\n else\n   LIBUV_OSTYPE_$(1)_$(2) := unix/linux\n   LIBUV_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/libuv/libuv.a\n+  JEMALLOC_LIB_$(1)_$(2) := rt/$(1)/stage$(2)/jemalloc/lib/libjemalloc_pic.a\n endif\n \n RUNTIME_DEF_$(1)_$(2) := rt/rustrt$(CFG_DEF_SUFFIX_$(1))\n@@ -124,8 +129,6 @@ ALL_OBJ_FILES += $$(RUNTIME_OBJS_$(1)_$(2))\n MORESTACK_OBJ_$(1)_$(2) := rt/$(1)/stage$(2)/arch/$$(HOST_$(1))/morestack.o\n ALL_OBJ_FILES += $$(MORESTACK_OBJS_$(1)_$(2))\n \n-RUNTIME_LIBS_$(1)_$(2) := $$(LIBUV_LIB_$(1)_$(2))\n-\n rt/$(1)/stage$(2)/%.o: rt/%.cpp $$(MKFILE_DEPS)\n \t@$$(call E, compile: $$@)\n \t$$(Q)$$(call CFG_COMPILE_CXX_$(1), $$@, $$(RUNTIME_INCS_$(1)_$(2)) \\\n@@ -146,11 +149,10 @@ rt/$(1)/stage$(2)/arch/$$(HOST_$(1))/libmorestack.a: $$(MORESTACK_OBJ_$(1)_$(2))\n \t$$(Q)$(AR_$(1)) rcs $$@ $$<\n \n rt/$(1)/stage$(2)/$(CFG_RUNTIME_$(1)): $$(RUNTIME_OBJS_$(1)_$(2)) $$(MKFILE_DEPS) \\\n-                        $$(RUNTIME_DEF_$(1)_$(2)) \\\n-                        $$(RUNTIME_LIBS_$(1)_$(2))\n+                        $$(RUNTIME_DEF_$(1)_$(2)) $$(LIBUV_LIB_$(1)_$(2)) $$(JEMALLOC_LIB_$(1)_$(2))\n \t@$$(call E, link: $$@)\n \t$$(Q)$$(call CFG_LINK_CXX_$(1),$$@, $$(RUNTIME_OBJS_$(1)_$(2)) \\\n-\t  $$(CFG_GCCISH_POST_LIB_FLAGS_$(1)) $$(RUNTIME_LIBS_$(1)_$(2)) \\\n+\t  $$(JEMALLOC_LIB_$(1)_$(2)) $$(CFG_GCCISH_POST_LIB_FLAGS_$(1)) $$(LIBUV_LIB_$(1)_$(2)) \\\n \t  $$(CFG_LIBUV_LINK_FLAGS_$(1)),$$(RUNTIME_DEF_$(1)_$(2)),$$(CFG_RUNTIME_$(1)))\n \n # FIXME: For some reason libuv's makefiles can't figure out the\n@@ -199,6 +201,9 @@ $$(LIBUV_LIB_$(1)_$(2)): $$(LIBUV_DEPS)\n \t\tV=$$(VERBOSE)\n endif\n \n+$$(JEMALLOC_LIB_$(1)_$(2)):\n+\tcd $$(CFG_BUILD_DIR)/rt/$(1)/stage$(2)/jemalloc; $(S)src/rt/jemalloc/configure --disable-experimental\n+\t$$(Q)$$(MAKE) -C $$(CFG_BUILD_DIR)/rt/$(1)/stage$(2)/jemalloc\n \n # These could go in rt.mk or rustllvm.mk, they're needed for both.\n "}]}