{"sha": "3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "node_id": "C_kwDOAAsO6NoAKDM1NjBlNjVjNDQ0ZWEwZDMwNjljYTgzYmExYjcwNmFlOWU1YTg1Yzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-02-11T23:01:22Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-02-25T20:01:33Z"}, "message": "Treat `str` as containing `[u8]` for auto trait purposes", "tree": {"sha": "4aebf066a62f9ff29f8f9977f93d5043d92b2059", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4aebf066a62f9ff29f8f9977f93d5043d92b2059"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "html_url": "https://github.com/rust-lang/rust/commit/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31448badfd74ea72d2c8622cc60d3dca889ef7d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/31448badfd74ea72d2c8622cc60d3dca889ef7d4", "html_url": "https://github.com/rust-lang/rust/commit/31448badfd74ea72d2c8622cc60d3dca889ef7d4"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "6d15c952c99f395a72094a7b931fe977424d9780", "filename": "compiler/rustc_trait_selection/src/solve/trait_goals/structural_traits.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Ftrait_goals%2Fstructural_traits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Ftrait_goals%2Fstructural_traits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Ftrait_goals%2Fstructural_traits.rs?ref=3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "patch": "@@ -20,12 +20,14 @@ pub(super) fn instantiate_constituent_tys_for_auto_trait<'tcx>(\n         | ty::Float(_)\n         | ty::FnDef(..)\n         | ty::FnPtr(_)\n-        | ty::Str\n         | ty::Error(_)\n         | ty::Infer(ty::IntVar(_) | ty::FloatVar(_))\n         | ty::Never\n         | ty::Char => Ok(vec![]),\n \n+        // Treat this like `struct str([u8]);`\n+        ty::Str => Ok(vec![tcx.mk_slice(tcx.types.u8)]),\n+\n         ty::Dynamic(..)\n         | ty::Param(..)\n         | ty::Foreign(..)"}, {"sha": "01c1ad3a4cef3890458cf7cc2cde2d8af2c7f5a1", "filename": "compiler/rustc_trait_selection/src/traits/select/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs?ref=3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "patch": "@@ -2300,12 +2300,14 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n             | ty::Float(_)\n             | ty::FnDef(..)\n             | ty::FnPtr(_)\n-            | ty::Str\n             | ty::Error(_)\n             | ty::Infer(ty::IntVar(_) | ty::FloatVar(_))\n             | ty::Never\n             | ty::Char => ty::Binder::dummy(Vec::new()),\n \n+            // Treat this like `struct str([u8]);`\n+            ty::Str => ty::Binder::dummy(vec![self.tcx().mk_slice(self.tcx().types.u8)]),\n+\n             ty::Placeholder(..)\n             | ty::Dynamic(..)\n             | ty::Param(..)"}, {"sha": "6a16fdcf2842f77a65d249f4f3788ab46650bf9c", "filename": "tests/ui/auto-traits/str-contains-slice-conceptually.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.rs?ref=3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "patch": "@@ -0,0 +1,13 @@\n+#![feature(negative_impls)]\n+#![feature(auto_traits)]\n+\n+auto trait AutoTrait {}\n+\n+impl<T> !AutoTrait for [T] {}\n+\n+fn needs_auto_trait<T: AutoTrait + ?Sized>() {}\n+\n+fn main() {\n+  needs_auto_trait::<str>();\n+  //~^ ERROR the trait bound `[u8]: AutoTrait` is not satisfied in `str`\n+}"}, {"sha": "755fc69972e7c2d1fd7e77b78ce6e013a66c3baa", "filename": "tests/ui/auto-traits/str-contains-slice-conceptually.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3560e65c444ea0d3069ca83ba1b706ae9e5a85c9/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fstr-contains-slice-conceptually.stderr?ref=3560e65c444ea0d3069ca83ba1b706ae9e5a85c9", "patch": "@@ -0,0 +1,16 @@\n+error[E0277]: the trait bound `[u8]: AutoTrait` is not satisfied in `str`\n+  --> $DIR/str-contains-slice-conceptually.rs:11:22\n+   |\n+LL |   needs_auto_trait::<str>();\n+   |                      ^^^ within `str`, the trait `AutoTrait` is not implemented for `[u8]`\n+   |\n+   = note: required because it appears within the type `str`\n+note: required by a bound in `needs_auto_trait`\n+  --> $DIR/str-contains-slice-conceptually.rs:8:24\n+   |\n+LL | fn needs_auto_trait<T: AutoTrait + ?Sized>() {}\n+   |                        ^^^^^^^^^ required by this bound in `needs_auto_trait`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}]}