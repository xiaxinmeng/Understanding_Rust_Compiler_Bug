{"sha": "69e3f7a30dc4858d951473d8e4c2540a063e5350", "node_id": "C_kwDOAAsO6NoAKDY5ZTNmN2EzMGRjNDg1OGQ5NTE0NzNkOGU0YzI1NDBhMDYzZTUzNTA", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2023-04-04T01:40:31Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2023-04-04T01:42:42Z"}, "message": "Disable `has_thread_local` on OpenHarmony\n\nOpenHarmony uses emulated TLS, which doesn't link properly when using\nthread-local variables across crate boundaries with `-C prefer-dynamic`.\nThis PR makes thread_local! use pthreads directly instead.", "tree": {"sha": "9fa52dec041851692813b2fdf7adb289eb792b83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fa52dec041851692813b2fdf7adb289eb792b83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69e3f7a30dc4858d951473d8e4c2540a063e5350", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69e3f7a30dc4858d951473d8e4c2540a063e5350", "html_url": "https://github.com/rust-lang/rust/commit/69e3f7a30dc4858d951473d8e4c2540a063e5350", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69e3f7a30dc4858d951473d8e4c2540a063e5350/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "932c173ca1b7a79c1005e2d72ddfa505a7bf2cfa", "url": "https://api.github.com/repos/rust-lang/rust/commits/932c173ca1b7a79c1005e2d72ddfa505a7bf2cfa", "html_url": "https://github.com/rust-lang/rust/commit/932c173ca1b7a79c1005e2d72ddfa505a7bf2cfa"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "bf1b089f657b49d8ab79e3d462d65540ec0fce44", "filename": "compiler/rustc_target/src/spec/aarch64_unknown_linux_ohos.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/69e3f7a30dc4858d951473d8e4c2540a063e5350/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_unknown_linux_ohos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69e3f7a30dc4858d951473d8e4c2540a063e5350/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_unknown_linux_ohos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_unknown_linux_ohos.rs?ref=69e3f7a30dc4858d951473d8e4c2540a063e5350", "patch": "@@ -18,6 +18,7 @@ pub fn target() -> Target {\n             features: \"+reserve-x18\".into(),\n             mcount: \"\\u{1}_mcount\".into(),\n             force_emulated_tls: true,\n+            has_thread_local: false,\n             supported_sanitizers: SanitizerSet::ADDRESS\n                 | SanitizerSet::CFI\n                 | SanitizerSet::LEAK"}, {"sha": "16da2453367735fdb91fd3fd8e85d55643422fdb", "filename": "compiler/rustc_target/src/spec/armv7_unknown_linux_ohos.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/69e3f7a30dc4858d951473d8e4c2540a063e5350/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv7_unknown_linux_ohos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69e3f7a30dc4858d951473d8e4c2540a063e5350/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv7_unknown_linux_ohos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv7_unknown_linux_ohos.rs?ref=69e3f7a30dc4858d951473d8e4c2540a063e5350", "patch": "@@ -21,6 +21,7 @@ pub fn target() -> Target {\n             crt_static_default: false,\n             mcount: \"\\u{1}mcount\".into(),\n             force_emulated_tls: true,\n+            has_thread_local: false,\n             ..super::linux_musl_base::opts()\n         },\n     }"}]}