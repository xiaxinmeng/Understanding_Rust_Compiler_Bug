{"sha": "41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxYzZmNjcxMDllZDhhZGVlMjA5ZjI4Y2U3ZjlkYmUxNDMyYTQ1YmQ=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2013-04-07T14:23:42Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2013-04-08T06:35:39Z"}, "message": "libcore: from_str_common: provide option to ignore underscores.\n\nImplement the possible improvement listed in the comment on\nfrom_str_bytes_common.", "tree": {"sha": "8b80c598fe758498c2e22725bda46828fbd3bf97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b80c598fe758498c2e22725bda46828fbd3bf97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "html_url": "https://github.com/rust-lang/rust/commit/41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49cdf36d2b993e08833bfdda2563b0c22ee42de7", "url": "https://api.github.com/repos/rust-lang/rust/commits/49cdf36d2b993e08833bfdda2563b0c22ee42de7", "html_url": "https://github.com/rust-lang/rust/commit/49cdf36d2b993e08833bfdda2563b0c22ee42de7"}], "stats": {"total": 68, "additions": 44, "deletions": 24}, "files": [{"sha": "fa82001151e2aa1ae5f42704e65adb851b0ca1aa", "filename": "src/libcore/num/f32.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ff32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ff32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Ff32.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -507,7 +507,7 @@ impl num::ToStrRadix for f32 {\n #[inline(always)]\n pub fn from_str(num: &str) -> Option<f32> {\n     strconv::from_str_common(num, 10u, true, true, true,\n-                             strconv::ExpDec, false)\n+                             strconv::ExpDec, false, false)\n }\n \n /**\n@@ -540,7 +540,7 @@ pub fn from_str(num: &str) -> Option<f32> {\n #[inline(always)]\n pub fn from_str_hex(num: &str) -> Option<f32> {\n     strconv::from_str_common(num, 16u, true, true, true,\n-                             strconv::ExpBin, false)\n+                             strconv::ExpBin, false, false)\n }\n \n /**\n@@ -565,7 +565,7 @@ pub fn from_str_hex(num: &str) -> Option<f32> {\n #[inline(always)]\n pub fn from_str_radix(num: &str, rdx: uint) -> Option<f32> {\n     strconv::from_str_common(num, rdx, true, true, false,\n-                             strconv::ExpNone, false)\n+                             strconv::ExpNone, false, false)\n }\n \n impl from_str::FromStr for f32 {"}, {"sha": "67dfabacd0b0ecd11e9e65896f06d463c7211c46", "filename": "src/libcore/num/f64.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ff64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ff64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Ff64.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -529,7 +529,7 @@ impl num::ToStrRadix for f64 {\n #[inline(always)]\n pub fn from_str(num: &str) -> Option<f64> {\n     strconv::from_str_common(num, 10u, true, true, true,\n-                             strconv::ExpDec, false)\n+                             strconv::ExpDec, false, false)\n }\n \n /**\n@@ -562,7 +562,7 @@ pub fn from_str(num: &str) -> Option<f64> {\n #[inline(always)]\n pub fn from_str_hex(num: &str) -> Option<f64> {\n     strconv::from_str_common(num, 16u, true, true, true,\n-                             strconv::ExpBin, false)\n+                             strconv::ExpBin, false, false)\n }\n \n /**\n@@ -587,7 +587,7 @@ pub fn from_str_hex(num: &str) -> Option<f64> {\n #[inline(always)]\n pub fn from_str_radix(num: &str, rdx: uint) -> Option<f64> {\n     strconv::from_str_common(num, rdx, true, true, false,\n-                             strconv::ExpNone, false)\n+                             strconv::ExpNone, false, false)\n }\n \n impl from_str::FromStr for f64 {"}, {"sha": "2508292970303f4e79a8b8fd62e1638ef8a78ed3", "filename": "src/libcore/num/float.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ffloat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Ffloat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Ffloat.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -242,7 +242,7 @@ impl num::ToStrRadix for float {\n #[inline(always)]\n pub fn from_str(num: &str) -> Option<float> {\n     strconv::from_str_common(num, 10u, true, true, true,\n-                             strconv::ExpDec, false)\n+                             strconv::ExpDec, false, false)\n }\n \n /**\n@@ -275,7 +275,7 @@ pub fn from_str(num: &str) -> Option<float> {\n #[inline(always)]\n pub fn from_str_hex(num: &str) -> Option<float> {\n     strconv::from_str_common(num, 16u, true, true, true,\n-                             strconv::ExpBin, false)\n+                             strconv::ExpBin, false, false)\n }\n \n /**\n@@ -300,7 +300,7 @@ pub fn from_str_hex(num: &str) -> Option<float> {\n #[inline(always)]\n pub fn from_str_radix(num: &str, radix: uint) -> Option<float> {\n     strconv::from_str_common(num, radix, true, true, false,\n-                             strconv::ExpNone, false)\n+                             strconv::ExpNone, false, false)\n }\n \n impl from_str::FromStr for float {"}, {"sha": "db90ec7946537e7dc5e7caecbe67e9b0e2c9e07c", "filename": "src/libcore/num/int-template.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fint-template.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fint-template.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Fint-template.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -202,21 +202,21 @@ impl ops::Neg<T> for T {\n #[inline(always)]\n pub fn from_str(s: &str) -> Option<T> {\n     strconv::from_str_common(s, 10u, true, false, false,\n-                         strconv::ExpNone, false)\n+                         strconv::ExpNone, false, false)\n }\n \n /// Parse a string as a number in the given base.\n #[inline(always)]\n pub fn from_str_radix(s: &str, radix: uint) -> Option<T> {\n     strconv::from_str_common(s, radix, true, false, false,\n-                         strconv::ExpNone, false)\n+                         strconv::ExpNone, false, false)\n }\n \n /// Parse a byte slice as a number in the given base.\n #[inline(always)]\n pub fn parse_bytes(buf: &[u8], radix: uint) -> Option<T> {\n     strconv::from_str_bytes_common(buf, radix, true, false, false,\n-                               strconv::ExpNone, false)\n+                               strconv::ExpNone, false, false)\n }\n \n impl FromStr for T {"}, {"sha": "95da5bc29f5df98615e0a5adba48f5451305d1d2", "filename": "src/libcore/num/strconv.rs", "status": "modified", "additions": 29, "deletions": 9, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fstrconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fstrconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Fstrconv.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -429,6 +429,8 @@ priv static DIGIT_E_RADIX: uint = ('e' as uint) - ('a' as uint) + 11u;\n  *                  `FFp128`. The exponent string itself is always base 10.\n  *                  Can conflict with `radix`, see Failure.\n  * - `empty_zero` - Whether to accept a empty `buf` as a 0 or not.\n+ * - `ignore_underscores` - Whether all underscores within the string should\n+ *                          be ignored.\n  *\n  * # Return value\n  * Returns `Some(n)` if `buf` parses to a number n without overflowing, and\n@@ -443,16 +445,13 @@ priv static DIGIT_E_RADIX: uint = ('e' as uint) - ('a' as uint) + 11u;\n  *   between digit and exponent sign `'p'`.\n  * - Fails if `radix` > 18 and `special == true` due to conflict\n  *   between digit and lowest first character in `inf` and `NaN`, the `'i'`.\n- *\n- * # Possible improvements\n- * - Could accept option to allow ignoring underscores, allowing for numbers\n- *   formated like `FF_AE_FF_FF`.\n  */\n pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n                                     Mul<T,T>+Sub<T,T>+Neg<T>+Add<T,T>+\n                                     NumStrConv>(\n         buf: &[u8], radix: uint, negative: bool, fractional: bool,\n-        special: bool, exponent: ExponentFormat, empty_zero: bool\n+        special: bool, exponent: ExponentFormat, empty_zero: bool,\n+        ignore_underscores: bool\n         ) -> Option<T> {\n     match exponent {\n         ExpDec if radix >= DIGIT_E_RADIX       // decimal exponent 'e'\n@@ -540,6 +539,7 @@ pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n                 last_accum = accum;\n             }\n             None => match c {\n+                '_' if ignore_underscores => {}\n                 'e' | 'E' | 'p' | 'P' => {\n                     exp_found = true;\n                     break;                       // start of exponent\n@@ -583,6 +583,7 @@ pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n                     last_accum = accum;\n                 }\n                 None => match c {\n+                    '_' if ignore_underscores => {}\n                     'e' | 'E' | 'p' | 'P' => {\n                         exp_found = true;\n                         break;                   // start of exponent\n@@ -610,6 +611,7 @@ pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n     if exp_found {\n         let c = buf[i] as char;\n         let base = match (c, exponent) {\n+            // c is never _ so don't need to handle specially\n             ('e', ExpDec) | ('E', ExpDec) => 10u,\n             ('p', ExpBin) | ('P', ExpBin) => 2u,\n             _ => return None // char doesn't fit given exponent format\n@@ -618,7 +620,8 @@ pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n         // parse remaining bytes as decimal integer,\n         // skipping the exponent char\n         let exp: Option<int> = from_str_bytes_common(\n-            buf.slice(i+1, len), 10, true, false, false, ExpNone, false);\n+            buf.slice(i+1, len), 10, true, false, false, ExpNone, false,\n+            ignore_underscores);\n \n         match exp {\n             Some(exp_pow) => {\n@@ -643,24 +646,41 @@ pub fn from_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+\n pub fn from_str_common<T:NumCast+Zero+One+Eq+Ord+Copy+Div<T,T>+Mul<T,T>+\n                               Sub<T,T>+Neg<T>+Add<T,T>+NumStrConv>(\n         buf: &str, radix: uint, negative: bool, fractional: bool,\n-        special: bool, exponent: ExponentFormat, empty_zero: bool\n+        special: bool, exponent: ExponentFormat, empty_zero: bool,\n+        ignore_underscores: bool\n         ) -> Option<T> {\n     from_str_bytes_common(str::to_bytes(buf), radix, negative,\n-                            fractional, special, exponent, empty_zero)\n+                          fractional, special, exponent, empty_zero,\n+                          ignore_underscores)\n }\n \n #[cfg(test)]\n mod test {\n     use super::*;\n     use option::*;\n \n+    #[test]\n+    fn from_str_ignore_underscores() {\n+        let s : Option<u8> = from_str_common(\"__1__\", 2, false, false, false,\n+                                             ExpNone, false, true);\n+        assert_eq!(s, Some(1u8));\n+\n+        let n : Option<u8> = from_str_common(\"__1__\", 2, false, false, false,\n+                                             ExpNone, false, false);\n+        assert_eq!(n, None);\n+\n+        let f : Option<f32> = from_str_common(\"_1_._1_e_1_\", 10, false, true, false,\n+                                              ExpDec, false, true);\n+        assert_eq!(f, Some(1.1e1f32));\n+    }\n+\n     #[test]\n     fn from_str_issue5770() {\n         // try to parse 0b1_1111_1111 = 511 as a u8. Caused problems\n         // since 255*2+1 == 255 (mod 256) so the overflow wasn't\n         // detected.\n         let n : Option<u8> = from_str_common(\"111111111\", 2, false, false, false,\n-                                             ExpNone, false);\n+                                             ExpNone, false, false);\n         assert_eq!(n, None);\n     }\n }"}, {"sha": "39af025217c930328d5f330fc9f5e6e33863c0ef", "filename": "src/libcore/num/uint-template.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fuint-template.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c6f67109ed8adee209f28ce7f9dbe1432a45bd/src%2Flibcore%2Fnum%2Fuint-template.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Fuint-template.rs?ref=41c6f67109ed8adee209f28ce7f9dbe1432a45bd", "patch": "@@ -168,21 +168,21 @@ impl ops::Neg<T> for T {\n #[inline(always)]\n pub fn from_str(s: &str) -> Option<T> {\n     strconv::from_str_common(s, 10u, false, false, false,\n-                             strconv::ExpNone, false)\n+                             strconv::ExpNone, false, false)\n }\n \n /// Parse a string as a number in the given base.\n #[inline(always)]\n pub fn from_str_radix(s: &str, radix: uint) -> Option<T> {\n     strconv::from_str_common(s, radix, false, false, false,\n-                             strconv::ExpNone, false)\n+                             strconv::ExpNone, false, false)\n }\n \n /// Parse a byte slice as a number in the given base.\n #[inline(always)]\n pub fn parse_bytes(buf: &[u8], radix: uint) -> Option<T> {\n     strconv::from_str_bytes_common(buf, radix, false, false, false,\n-                                   strconv::ExpNone, false)\n+                                   strconv::ExpNone, false, false)\n }\n \n impl FromStr for T {"}]}