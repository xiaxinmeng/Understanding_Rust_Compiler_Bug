{"sha": "1b7c404d4bf5b28f61da14f84fe73c62862f5963", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiN2M0MDRkNGJmNWIyOGY2MWRhMTRmODRmZTczYzYyODYyZjU5NjM=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2019-12-20T13:38:28Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2020-01-02T13:06:45Z"}, "message": "bootstrap: Allow for setting the ThinLTO import limit used for compiler the compiler.", "tree": {"sha": "83a58f987a751395227a34631bce45d50beb06d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83a58f987a751395227a34631bce45d50beb06d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b7c404d4bf5b28f61da14f84fe73c62862f5963", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b7c404d4bf5b28f61da14f84fe73c62862f5963", "html_url": "https://github.com/rust-lang/rust/commit/1b7c404d4bf5b28f61da14f84fe73c62862f5963", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b7c404d4bf5b28f61da14f84fe73c62862f5963/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "766fba3fdca8fe075c370a63d2f76f8407483af5", "url": "https://api.github.com/repos/rust-lang/rust/commits/766fba3fdca8fe075c370a63d2f76f8407483af5", "html_url": "https://github.com/rust-lang/rust/commit/766fba3fdca8fe075c370a63d2f76f8407483af5"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "f22f4a5a97579a7298a97cadf25ecf3426ced9fc", "filename": "config.toml.example", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1b7c404d4bf5b28f61da14f84fe73c62862f5963/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/1b7c404d4bf5b28f61da14f84fe73c62862f5963/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=1b7c404d4bf5b28f61da14f84fe73c62862f5963", "patch": "@@ -406,6 +406,13 @@\n # Whether to verify generated LLVM IR\n #verify-llvm-ir = false\n \n+# Compile the compiler with a non-default ThinLTO import limit. This import\n+# limit controls the maximum size of functions imported by ThinLTO. Decreasing\n+# will make code compile faster at the expense of lower runtime performance.\n+# If `incremental` is set to true above, the import limit will default to 10\n+# instead of LLVM's default of 100.\n+#thin-lto-import-instr-limit = 100\n+\n # Map all debuginfo paths for libstd and crates to `/rust/$sha/$crate/...`,\n # generally only set for releases\n #remap-debuginfo = false"}, {"sha": "f7d8daa75ecb5fb95fb5bdb5ff382075cb096674", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1b7c404d4bf5b28f61da14f84fe73c62862f5963/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b7c404d4bf5b28f61da14f84fe73c62862f5963/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=1b7c404d4bf5b28f61da14f84fe73c62862f5963", "patch": "@@ -1183,6 +1183,21 @@ impl<'a> Builder<'a> {\n             rustflags.arg(\"-Cprefer-dynamic\");\n         }\n \n+        // When building incrementally we default to a lower ThinLTO import limit\n+        // (unless explicitly specified otherwise). This will produce a somewhat\n+        // slower code but give way better compile times.\n+        {\n+            let limit = match self.config.rust_thin_lto_import_instr_limit {\n+                Some(limit) => Some(limit),\n+                None if self.config.incremental => Some(10),\n+                _ => None,\n+            };\n+\n+            if let Some(limit) = limit {\n+                rustflags.arg(&format!(\"-Cllvm-args=-import-instr-limit={}\", limit));\n+            }\n+        }\n+\n         Cargo { command: cargo, rustflags }\n     }\n "}, {"sha": "ed65a606ff525013f186e66ed4cd6baf16164db7", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1b7c404d4bf5b28f61da14f84fe73c62862f5963/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b7c404d4bf5b28f61da14f84fe73c62862f5963/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=1b7c404d4bf5b28f61da14f84fe73c62862f5963", "patch": "@@ -108,6 +108,7 @@ pub struct Config {\n     pub rust_dist_src: bool,\n     pub rust_codegen_backends: Vec<Interned<String>>,\n     pub rust_verify_llvm_ir: bool,\n+    pub rust_thin_lto_import_instr_limit: Option<u32>,\n     pub rust_remap_debuginfo: bool,\n \n     pub build: Interned<String>,\n@@ -325,6 +326,7 @@ struct Rust {\n     deny_warnings: Option<bool>,\n     backtrace_on_ice: Option<bool>,\n     verify_llvm_ir: Option<bool>,\n+    thin_lto_import_instr_limit: Option<u32>,\n     remap_debuginfo: Option<bool>,\n     jemalloc: Option<bool>,\n     test_compare_mode: Option<bool>,\n@@ -569,6 +571,7 @@ impl Config {\n             set(&mut config.deny_warnings, flags.deny_warnings.or(rust.deny_warnings));\n             set(&mut config.backtrace_on_ice, rust.backtrace_on_ice);\n             set(&mut config.rust_verify_llvm_ir, rust.verify_llvm_ir);\n+            config.rust_thin_lto_import_instr_limit = rust.thin_lto_import_instr_limit;\n             set(&mut config.rust_remap_debuginfo, rust.remap_debuginfo);\n \n             if let Some(ref backends) = rust.codegen_backends {"}]}