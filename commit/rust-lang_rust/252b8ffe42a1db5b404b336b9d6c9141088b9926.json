{"sha": "252b8ffe42a1db5b404b336b9d6c9141088b9926", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MmI4ZmZlNDJhMWRiNWI0MDRiMzM2YjlkNmM5MTQxMDg4Yjk5MjY=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-07-26T08:27:26Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-07-26T08:27:26Z"}, "message": "Add support for new-style local decls\n\n    let x = 5;\n    let y: int = 10;\n    // as soon as a typestate bug is fixed:\n    let x: str = foo, y <- 20u;\n\n'auto' and 'type-first let' will soon be dropped.", "tree": {"sha": "1ea3745a44734e562516cca0b437bd36f402408d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ea3745a44734e562516cca0b437bd36f402408d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/252b8ffe42a1db5b404b336b9d6c9141088b9926", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/252b8ffe42a1db5b404b336b9d6c9141088b9926", "html_url": "https://github.com/rust-lang/rust/commit/252b8ffe42a1db5b404b336b9d6c9141088b9926", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/252b8ffe42a1db5b404b336b9d6c9141088b9926/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ab213a464710d8477fdaaae692fb79e1a91c1d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ab213a464710d8477fdaaae692fb79e1a91c1d6", "html_url": "https://github.com/rust-lang/rust/commit/5ab213a464710d8477fdaaae692fb79e1a91c1d6"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "b8220d814a4a645ca726b44e1a0f0e24208fabd3", "filename": "src/comp/syntax/parse/parser.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/252b8ffe42a1db5b404b336b9d6c9141088b9926/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252b8ffe42a1db5b404b336b9d6c9141088b9926/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs?ref=252b8ffe42a1db5b404b336b9d6c9141088b9926", "patch": "@@ -1593,7 +1593,17 @@ fn parse_auto_local(&parser p) -> @ast::local {\n     ret parse_local_full(none, p);\n }\n \n+// FIXME simplify when old syntax is no longer supported\n fn parse_let(&parser p) -> @ast::decl {\n+    if alt p.peek() { token::IDENT(_, false) { true } _ { false } } {\n+        alt p.look_ahead(1u) {\n+          token::COLON | token::SEMI | token::COMMA | token::EQ |\n+          token::LARROW {\n+            ret parse_let_modern(p);\n+          }\n+          _ {}\n+        }\n+    }\n     auto lo = p.get_last_lo_pos();\n     auto locals = ~[parse_typed_local(p)];\n     while p.peek() == token::COMMA {\n@@ -1603,6 +1613,29 @@ fn parse_let(&parser p) -> @ast::decl {\n     ret @spanned(lo, p.get_hi_pos(), ast::decl_local(locals));\n }\n \n+fn parse_let_modern(&parser p) -> @ast::decl {\n+    fn parse_local(&parser p) -> @ast::local {\n+        auto lo = p.get_lo_pos();\n+        auto ident = parse_value_ident(p);\n+        auto ty = none;\n+        if p.peek() == token::COLON {\n+            p.bump();\n+            ty = some(parse_ty(p));\n+        }\n+        auto init = parse_initializer(p);\n+        ret @spanned(lo, p.get_last_hi_pos(),\n+                     rec(ty=ty, infer=false, ident=ident,\n+                         init=init, id=p.get_id()));\n+    }\n+    auto lo = p.get_lo_pos();\n+    auto locals = ~[parse_local(p)];\n+    while p.peek() == token::COMMA {\n+        p.bump();\n+        locals += ~[parse_local(p)];\n+    }\n+    ret @spanned(lo, p.get_last_hi_pos(), ast::decl_local(locals));\n+}\n+\n fn parse_auto(&parser p) -> @ast::decl {\n     auto lo = p.get_last_lo_pos();\n     auto locals = ~[parse_auto_local(p)];"}]}