{"sha": "d350c9b15f3588525c043fd71872506345fd8281", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzNTBjOWIxNWYzNTg4NTI1YzA0M2ZkNzE4NzI1MDYzNDVmZDgyODE=", "commit": {"author": {"name": "Seo Sanghyeon", "email": "sanxiyn@gmail.com", "date": "2017-01-10T11:27:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-01-10T11:27:41Z"}, "message": "Rollup merge of #38664 - apasel422:may-dangle, r=pnkfelix\n\nReplace uses of `#[unsafe_destructor_blind_to_params]` with `#[may_dangle]`\n\nCC #34761\n\nr? @pnkfelix", "tree": {"sha": "25023beb5622d2ab673fbdaeeba1626ffce406e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25023beb5622d2ab673fbdaeeba1626ffce406e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d350c9b15f3588525c043fd71872506345fd8281", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d350c9b15f3588525c043fd71872506345fd8281", "html_url": "https://github.com/rust-lang/rust/commit/d350c9b15f3588525c043fd71872506345fd8281", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d350c9b15f3588525c043fd71872506345fd8281/comments", "author": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d3d2c73970c9842f1a0570963b0a4d1753ae3a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d3d2c73970c9842f1a0570963b0a4d1753ae3a9", "html_url": "https://github.com/rust-lang/rust/commit/4d3d2c73970c9842f1a0570963b0a4d1753ae3a9"}, {"sha": "ca9b07bbc974414e2b9055c5e50e38a1973401d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca9b07bbc974414e2b9055c5e50e38a1973401d2", "html_url": "https://github.com/rust-lang/rust/commit/ca9b07bbc974414e2b9055c5e50e38a1973401d2"}], "stats": {"total": 49, "additions": 20, "deletions": 29}, "files": [{"sha": "459dc94f33686531efd9ada73e127cfc776dfebf", "filename": "src/liballoc/arc.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Farc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Farc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Farc.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -708,7 +708,7 @@ impl<T: ?Sized> Arc<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T: ?Sized> Drop for Arc<T> {\n+unsafe impl<#[may_dangle] T: ?Sized> Drop for Arc<T> {\n     /// Drops the `Arc`.\n     ///\n     /// This will decrement the strong reference count. If the strong reference\n@@ -736,7 +736,6 @@ impl<T: ?Sized> Drop for Arc<T> {\n     /// drop(foo);    // Doesn't print anything\n     /// drop(foo2);   // Prints \"dropped!\"\n     /// ```\n-    #[unsafe_destructor_blind_to_params]\n     #[inline]\n     fn drop(&mut self) {\n         // Because `fetch_sub` is already atomic, we do not need to synchronize"}, {"sha": "c67106cf57aaf0ea2ab83f573d45c324d5f540bd", "filename": "src/liballoc/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Flib.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -79,9 +79,10 @@\n #![feature(const_fn)]\n #![feature(core_intrinsics)]\n #![feature(custom_attribute)]\n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n #![cfg_attr(not(test), feature(exact_size_is_empty))]\n #![feature(fundamental)]\n+#![feature(generic_param_attrs)]\n #![feature(lang_items)]\n #![feature(needs_allocator)]\n #![feature(optin_builtin_traits)]"}, {"sha": "357a2724e0020cff95807f63246af3f52ecd4691", "filename": "src/liballoc/raw_vec.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Fraw_vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Fraw_vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fraw_vec.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -539,8 +539,7 @@ impl<T> RawVec<T> {\n     }\n }\n \n-impl<T> Drop for RawVec<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for RawVec<T> {\n     /// Frees the memory owned by the RawVec *without* trying to Drop its contents.\n     fn drop(&mut self) {\n         let elem_size = mem::size_of::<T>();"}, {"sha": "010e378ef2f48238ea3880be935b6e2f1f25e737", "filename": "src/liballoc/rc.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Fliballoc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Frc.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -644,7 +644,7 @@ impl<T: ?Sized> Deref for Rc<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T: ?Sized> Drop for Rc<T> {\n+unsafe impl<#[may_dangle] T: ?Sized> Drop for Rc<T> {\n     /// Drops the `Rc`.\n     ///\n     /// This will decrement the strong reference count. If the strong reference\n@@ -672,7 +672,6 @@ impl<T: ?Sized> Drop for Rc<T> {\n     /// drop(foo);    // Doesn't print anything\n     /// drop(foo2);   // Prints \"dropped!\"\n     /// ```\n-    #[unsafe_destructor_blind_to_params]\n     fn drop(&mut self) {\n         unsafe {\n             let ptr = *self.ptr;"}, {"sha": "a3cfc15895eb73cfb4dae3108482efd378eed447", "filename": "src/libarena/lib.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibarena%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibarena%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibarena%2Flib.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -30,10 +30,10 @@\n \n #![feature(alloc)]\n #![feature(core_intrinsics)]\n+#![feature(dropck_eyepatch)]\n #![feature(heap_api)]\n-#![feature(heap_api)]\n+#![feature(generic_param_attrs)]\n #![feature(staged_api)]\n-#![feature(dropck_parametricity)]\n #![cfg_attr(test, feature(test))]\n \n #![allow(deprecated)]\n@@ -258,8 +258,7 @@ impl<T> TypedArena<T> {\n     }\n }\n \n-impl<T> Drop for TypedArena<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for TypedArena<T> {\n     fn drop(&mut self) {\n         unsafe {\n             // Determine how much was filled."}, {"sha": "98c71967f3c394ee0d9642bca82f1bd2b24337f7", "filename": "src/libcollections/btree/map.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fbtree%2Fmap.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -137,8 +137,7 @@ pub struct BTreeMap<K, V> {\n }\n \n #[stable(feature = \"btree_drop\", since = \"1.7.0\")]\n-impl<K, V> Drop for BTreeMap<K, V> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] K, #[may_dangle] V> Drop for BTreeMap<K, V> {\n     fn drop(&mut self) {\n         unsafe {\n             for _ in ptr::read(self).into_iter() {"}, {"sha": "561d8860dc8803f3d5d0e141d19f7c8d12db6edf", "filename": "src/libcollections/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Flib.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -35,10 +35,11 @@\n #![feature(box_syntax)]\n #![cfg_attr(not(test), feature(char_escape_debug))]\n #![feature(core_intrinsics)]\n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n #![feature(exact_size_is_empty)]\n #![feature(fmt_internals)]\n #![feature(fused)]\n+#![feature(generic_param_attrs)]\n #![feature(heap_api)]\n #![feature(inclusive_range)]\n #![feature(lang_items)]"}, {"sha": "7f913d4afe476aeea2c8611f3e87062f9bbb76fd", "filename": "src/libcollections/linked_list.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Flinked_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Flinked_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Flinked_list.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -726,8 +726,7 @@ impl<T> LinkedList<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> Drop for LinkedList<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for LinkedList<T> {\n     fn drop(&mut self) {\n         while let Some(_) = self.pop_front_node() {}\n     }"}, {"sha": "36dfc6b3e2940e689a07295f8992ba2f7c964b74", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -1786,8 +1786,7 @@ impl<T: Ord> Ord for Vec<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> Drop for Vec<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for Vec<T> {\n     fn drop(&mut self) {\n         unsafe {\n             // use drop for [T]\n@@ -2056,8 +2055,7 @@ impl<T: Clone> Clone for IntoIter<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> Drop for IntoIter<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for IntoIter<T> {\n     fn drop(&mut self) {\n         // destroy the remaining elements\n         for _x in self.by_ref() {}"}, {"sha": "76e44c815793feefa5a6c82be214b68273c5b6e4", "filename": "src/libcollections/vec_deque.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibcollections%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec_deque.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -69,8 +69,7 @@ impl<T: Clone> Clone for VecDeque<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> Drop for VecDeque<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for VecDeque<T> {\n     fn drop(&mut self) {\n         let (front, back) = self.as_mut_slices();\n         unsafe {"}, {"sha": "1ab62130cd3ddecedce8d39dbc58c9ebe8a3fcef", "filename": "src/libstd/collections/hash/table.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fcollections%2Fhash%2Ftable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fcollections%2Fhash%2Ftable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fcollections%2Fhash%2Ftable.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -1061,8 +1061,7 @@ impl<K: Clone, V: Clone> Clone for RawTable<K, V> {\n     }\n }\n \n-impl<K, V> Drop for RawTable<K, V> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] K, #[may_dangle] V> Drop for RawTable<K, V> {\n     fn drop(&mut self) {\n         if self.capacity == 0 {\n             return;"}, {"sha": "521b938acfb7ec82c5d36e12b9fb644856218dc4", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -250,13 +250,14 @@\n #![feature(const_fn)]\n #![feature(core_float)]\n #![feature(core_intrinsics)]\n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n #![feature(exact_size_is_empty)]\n #![feature(float_extras)]\n #![feature(float_from_str_radix)]\n #![feature(fn_traits)]\n #![feature(fnbox)]\n #![feature(fused)]\n+#![feature(generic_param_attrs)]\n #![feature(hashmap_hasher)]\n #![feature(heap_api)]\n #![feature(inclusive_range)]"}, {"sha": "f8426e3b5782fab3fa40fa4e1642991db0828716", "filename": "src/libstd/sync/mutex.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fsync%2Fmutex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fsync%2Fmutex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fmutex.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -280,8 +280,7 @@ impl<T: ?Sized> Mutex<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T: ?Sized> Drop for Mutex<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T: ?Sized> Drop for Mutex<T> {\n     fn drop(&mut self) {\n         // This is actually safe b/c we know that there is no further usage of\n         // this mutex (it's up to the user to arrange for a mutex to get"}, {"sha": "adbb98e4b1f4f664a99ab278c06a517639e091de", "filename": "src/libstd/sync/rwlock.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fsync%2Frwlock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d350c9b15f3588525c043fd71872506345fd8281/src%2Flibstd%2Fsync%2Frwlock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Frwlock.rs?ref=d350c9b15f3588525c043fd71872506345fd8281", "patch": "@@ -310,8 +310,7 @@ impl<T: ?Sized> RwLock<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T: ?Sized> Drop for RwLock<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T: ?Sized> Drop for RwLock<T> {\n     fn drop(&mut self) {\n         // IMPORTANT: This code needs to be kept in sync with `RwLock::into_inner`.\n         unsafe { self.inner.destroy() }"}]}