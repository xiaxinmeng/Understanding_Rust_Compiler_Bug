{"sha": "56a5b7e504dcc168e797b7a8e251a02e0209af37", "node_id": "C_kwDOAAsO6NoAKDU2YTViN2U1MDRkY2MxNjhlNzk3YjdhOGUyNTFhMDJlMDIwOWFmMzc", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2023-06-15T20:04:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-06-15T20:04:58Z"}, "message": "Rollup merge of #112664 - djkoloski:fuchsia_test_runner_tmpdir, r=tmandry\n\nAdd support for test tmpdir to fuchsia test runner\n\nAlso format the script to keep the code nice.\n\nThis fixes the `tests/ui/std/switch-stdout.rs` test on Fuchsia.\n\nr? `@tmandry`", "tree": {"sha": "dd0a4110e1129a93e73baa8dd3f48d0bb23aa852", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd0a4110e1129a93e73baa8dd3f48d0bb23aa852"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56a5b7e504dcc168e797b7a8e251a02e0209af37", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJki27qCRBK7hj4Ov3rIwAAQmUIAEWTlhUZLXSF/NpLFcYDg0+t\nDofg/qfD0TeFeSacrg0r+t2FkjlbDYBDePnw0zII+KMzVv3DFTFGxVsRtOriHAJt\n3LhOBUM0YeShZw1GZNwsLC8xsuV187UK+pnjPinobF5pEEyIy8/aqnJzkuLVprBC\nmJFHU4bCS+iWrIBEEfWSQ2RmjSGpqvfhaqQqEct9ZI/s7IQZ6SW/CnWBQ4nhbKKX\n++cR35IMeShYaMq5rrseGQBGMOJfacjlzNUZCi6hRmG2d3+2zFYNhEH/72GYnSQC\n3WE0FljwlMYa9abLoxrm2kLBZ2EpYAjFGxHOWIZl5HUgX6JuLckKjpYOtlwANI0=\n=s/6g\n-----END PGP SIGNATURE-----\n", "payload": "tree dd0a4110e1129a93e73baa8dd3f48d0bb23aa852\nparent b36ddeedc04b02bff42df824d4e88cd49f0c7bab\nparent 71db99935a7dd98dfd9253dac55e58f098f56996\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1686859498 +0200\ncommitter GitHub <noreply@github.com> 1686859498 +0200\n\nRollup merge of #112664 - djkoloski:fuchsia_test_runner_tmpdir, r=tmandry\n\nAdd support for test tmpdir to fuchsia test runner\n\nAlso format the script to keep the code nice.\n\nThis fixes the `tests/ui/std/switch-stdout.rs` test on Fuchsia.\n\nr? `@tmandry`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56a5b7e504dcc168e797b7a8e251a02e0209af37", "html_url": "https://github.com/rust-lang/rust/commit/56a5b7e504dcc168e797b7a8e251a02e0209af37", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56a5b7e504dcc168e797b7a8e251a02e0209af37/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b36ddeedc04b02bff42df824d4e88cd49f0c7bab", "url": "https://api.github.com/repos/rust-lang/rust/commits/b36ddeedc04b02bff42df824d4e88cd49f0c7bab", "html_url": "https://github.com/rust-lang/rust/commit/b36ddeedc04b02bff42df824d4e88cd49f0c7bab"}, {"sha": "71db99935a7dd98dfd9253dac55e58f098f56996", "url": "https://api.github.com/repos/rust-lang/rust/commits/71db99935a7dd98dfd9253dac55e58f098f56996", "html_url": "https://github.com/rust-lang/rust/commit/71db99935a7dd98dfd9253dac55e58f098f56996"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "78a8a6662ea64dcb5fd5154c131f76da7280c35c", "filename": "src/ci/docker/scripts/fuchsia-test-runner.py", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/56a5b7e504dcc168e797b7a8e251a02e0209af37/src%2Fci%2Fdocker%2Fscripts%2Ffuchsia-test-runner.py", "raw_url": "https://github.com/rust-lang/rust/raw/56a5b7e504dcc168e797b7a8e251a02e0209af37/src%2Fci%2Fdocker%2Fscripts%2Ffuchsia-test-runner.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Ffuchsia-test-runner.py?ref=56a5b7e504dcc168e797b7a8e251a02e0209af37", "patch": "@@ -171,7 +171,6 @@ def ffx_isolate_dir(self):\n     def home_dir(self):\n         return os.path.join(self.tmp_dir(), \"user-home\")\n \n-\n     def start_ffx_isolation(self):\n         # Most of this is translated directly from ffx's isolate library\n         os.mkdir(self.ffx_isolate_dir())\n@@ -424,7 +423,7 @@ def start(self):\n         )\n \n         # Create lockfiles\n-        open(self.pm_lockfile_path(), 'a').close()\n+        open(self.pm_lockfile_path(), \"a\").close()\n \n         # Write to file\n         self.write_to_file()\n@@ -458,6 +457,7 @@ def start(self):\n         ],\n         use: [\n             {{ storage: \"data\", path: \"/data\" }},\n+            {{ storage: \"tmp\", path: \"/tmp\" }},\n             {{ protocol: [ \"fuchsia.process.Launcher\" ] }},\n             {{ protocol: [ \"fuchsia.posix.socket.Provider\" ] }}\n         ],\n@@ -571,6 +571,9 @@ def log(msg):\n                 if os.getenv(\"RUST_BACKTRACE\") == None:\n                     env_vars += f'\\n            \"RUST_BACKTRACE=0\",'\n \n+                # Use /tmp as the test temporary directory\n+                env_vars += f'\\n            \"RUST_TEST_TMPDIR=/tmp\",'\n+\n                 cml.write(\n                     self.CML_TEMPLATE.format(env_vars=env_vars, exe_name=exe_name)\n                 )\n@@ -642,7 +645,7 @@ def log(msg):\n             log(\"Publishing package to repo...\")\n \n             # Publish package to repo\n-            with open(self.pm_lockfile_path(), 'w') as pm_lockfile:\n+            with open(self.pm_lockfile_path(), \"w\") as pm_lockfile:\n                 fcntl.lockf(pm_lockfile.fileno(), fcntl.LOCK_EX)\n                 subprocess.check_call(\n                     [\n@@ -1045,9 +1048,7 @@ def print_help(args):\n     )\n     debug_parser.set_defaults(func=debug)\n \n-    syslog_parser = subparsers.add_parser(\n-        \"syslog\", help=\"prints the device syslog\"\n-    )\n+    syslog_parser = subparsers.add_parser(\"syslog\", help=\"prints the device syslog\")\n     syslog_parser.set_defaults(func=syslog)\n \n     args = parser.parse_args()"}]}