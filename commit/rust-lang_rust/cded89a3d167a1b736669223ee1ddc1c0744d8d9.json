{"sha": "cded89a3d167a1b736669223ee1ddc1c0744d8d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkZWQ4OWEzZDE2N2ExYjczNjY2OTIyM2VlMWRkYzFjMDc0NGQ4ZDk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-22T19:00:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-22T19:00:15Z"}, "message": "Auto merge of #30917 - arthurprs:bs_bounds_check, r=alexcrichton\n\nAvoid bounds checking for binary search. All calculated indexes are safe and the branch is useless.", "tree": {"sha": "0da916c67451eacf8d7f58c7a34c9a88a2b7dfab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0da916c67451eacf8d7f58c7a34c9a88a2b7dfab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cded89a3d167a1b736669223ee1ddc1c0744d8d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cded89a3d167a1b736669223ee1ddc1c0744d8d9", "html_url": "https://github.com/rust-lang/rust/commit/cded89a3d167a1b736669223ee1ddc1c0744d8d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cded89a3d167a1b736669223ee1ddc1c0744d8d9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f36038490559a98efcba3521564663b15785d9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f36038490559a98efcba3521564663b15785d9c", "html_url": "https://github.com/rust-lang/rust/commit/8f36038490559a98efcba3521564663b15785d9c"}, {"sha": "7e5b9d721315611be82cc4a1f9c0e895c90b6348", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e5b9d721315611be82cc4a1f9c0e895c90b6348", "html_url": "https://github.com/rust-lang/rust/commit/7e5b9d721315611be82cc4a1f9c0e895c90b6348"}], "stats": {"total": 29, "additions": 13, "deletions": 16}, "files": [{"sha": "40041c748e7ffcd41dbb5ca4078995702ac2c3ff", "filename": "src/libcore/slice.rs", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/cded89a3d167a1b736669223ee1ddc1c0744d8d9/src%2Flibcore%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cded89a3d167a1b736669223ee1ddc1c0744d8d9/src%2Flibcore%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fslice.rs?ref=cded89a3d167a1b736669223ee1ddc1c0744d8d9", "patch": "@@ -294,22 +294,23 @@ impl<T> SliceExt for [T] {\n     fn binary_search_by<F>(&self, mut f: F) -> Result<usize, usize> where\n         F: FnMut(&T) -> Ordering\n     {\n-        let mut base : usize = 0;\n-        let mut lim : usize = self.len();\n+        let mut base = 0usize;\n+        let mut s = self;\n \n-        while lim != 0 {\n-            let ix = base + (lim >> 1);\n-            match f(&self[ix]) {\n-                Equal => return Ok(ix),\n+        loop {\n+            let (head, tail) = s.split_at(s.len() >> 1);\n+            if tail.is_empty() {\n+                return Err(base)\n+            }\n+            match f(&tail[0]) {\n                 Less => {\n-                    base = ix + 1;\n-                    lim -= 1;\n+                    base += head.len() + 1;\n+                    s = &tail[1..];\n                 }\n-                Greater => ()\n+                Greater => s = head,\n+                Equal => return Ok(base + head.len()),\n             }\n-            lim >>= 1;\n         }\n-        Err(base)\n     }\n \n     #[inline]"}, {"sha": "f82ab44adad00b8d762635d75e0fc1d16c9677f5", "filename": "src/libcoretest/slice.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cded89a3d167a1b736669223ee1ddc1c0744d8d9/src%2Flibcoretest%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cded89a3d167a1b736669223ee1ddc1c0744d8d9/src%2Flibcoretest%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcoretest%2Fslice.rs?ref=cded89a3d167a1b736669223ee1ddc1c0744d8d9", "patch": "@@ -11,24 +11,20 @@\n use core::result::Result::{Ok, Err};\n \n #[test]\n-fn binary_search_not_found() {\n+fn test_binary_search() {\n     let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&6)) == Ok(3));\n-    let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&5)) == Err(3));\n     let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&6)) == Ok(3));\n-    let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&5)) == Err(3));\n     let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&8)) == Ok(4));\n-    let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&7)) == Err(4));\n     let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&8)) == Ok(5));\n     let b = [1, 2, 4, 5, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&7)) == Err(5));\n-    let b = [1, 2, 4, 5, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&0)) == Err(0));\n     let b = [1, 2, 4, 5, 6, 8];\n     assert!(b.binary_search_by(|v| v.cmp(&9)) == Err(6));"}]}