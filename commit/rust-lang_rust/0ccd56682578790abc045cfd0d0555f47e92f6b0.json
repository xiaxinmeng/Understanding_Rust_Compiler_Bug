{"sha": "0ccd56682578790abc045cfd0d0555f47e92f6b0", "node_id": "C_kwDOAAsO6NoAKDBjY2Q1NjY4MjU3ODc5MGFiYzA0NWNmZDBkMDU1NWY0N2U5MmY2YjA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-03T05:24:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-03T05:24:13Z"}, "message": "Rollup merge of #91170 - jsha:preload-fonts, r=GuillaumeGomez\n\nrustdoc: preload fonts\n\nFollow-up from #82315.\n\nI noticed that font loading was so slow that even when loading from local disk, we get a flash of unstyled text (FOUT) followed by a reflow when the fonts load. With this change, we reliably get the appropriate fonts in the first render pass when loading locally, and we get it some of the time when loading from a website.\n\nThis only preloads woff2 versions. According to https://caniuse.com/?search=preload and https://caniuse.com/?search=woff2, all browsers that support preload also support woff2, so this is fine; we will never load two copies of a font.\n\nDon't preload italic font faces because they aren't used on all pages.\n\nDemo: https://rustdoc.crud.net/jsha/preload-fonts/std/string/struct.String.html", "tree": {"sha": "761ff4115e4daf779e3bf6c6fa8aee3d8ef07f96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/761ff4115e4daf779e3bf6c6fa8aee3d8ef07f96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0ccd56682578790abc045cfd0d0555f47e92f6b0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhqan+CRBK7hj4Ov3rIwAAZ3sIAIfa42aeRuC0TaBPHdIQRsfg\n4dQJNbYQblLERw8fsBm/+Awp5wa8y+ny0i4/qVY4EwHjL9QPE8WQwxexwhT0Gam4\nE3UvGGJyHT/+qSMJ5BOUCpyA4qWVhr0CTRBYUSl5U6IkOiXstuLLATlUNsnMtgJE\ndmwCWC5l1QDXtkdofvQuzoVhnPKe84U9hy6vd6GVOp8Ek5CPefrP5Eg0DLBsT87W\n8n1LWfCeBDa8oIA2ZnCacQDfiHvPGzzKe7/KWZkP4/yO23I5tVeYCIjWj1eZIc/2\nhFe6HtSMuAwoe4f3dL04BKReKXcA4BRKMYvKM5eozmmSI8UmG3d0nlMlD8hmh+0=\n=GOes\n-----END PGP SIGNATURE-----\n", "payload": "tree 761ff4115e4daf779e3bf6c6fa8aee3d8ef07f96\nparent 570dc70a2b518924384b9d2bbe6736b42b6b4d63\nparent 4198fac7390509128c42757fcfb89a0effde4a8e\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1638509053 +0100\ncommitter GitHub <noreply@github.com> 1638509053 +0100\n\nRollup merge of #91170 - jsha:preload-fonts, r=GuillaumeGomez\n\nrustdoc: preload fonts\n\nFollow-up from #82315.\n\nI noticed that font loading was so slow that even when loading from local disk, we get a flash of unstyled text (FOUT) followed by a reflow when the fonts load. With this change, we reliably get the appropriate fonts in the first render pass when loading locally, and we get it some of the time when loading from a website.\n\nThis only preloads woff2 versions. According to https://caniuse.com/?search=preload and https://caniuse.com/?search=woff2, all browsers that support preload also support woff2, so this is fine; we will never load two copies of a font.\n\nDon't preload italic font faces because they aren't used on all pages.\n\nDemo: https://rustdoc.crud.net/jsha/preload-fonts/std/string/struct.String.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0ccd56682578790abc045cfd0d0555f47e92f6b0", "html_url": "https://github.com/rust-lang/rust/commit/0ccd56682578790abc045cfd0d0555f47e92f6b0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0ccd56682578790abc045cfd0d0555f47e92f6b0/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "570dc70a2b518924384b9d2bbe6736b42b6b4d63", "url": "https://api.github.com/repos/rust-lang/rust/commits/570dc70a2b518924384b9d2bbe6736b42b6b4d63", "html_url": "https://github.com/rust-lang/rust/commit/570dc70a2b518924384b9d2bbe6736b42b6b4d63"}, {"sha": "4198fac7390509128c42757fcfb89a0effde4a8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4198fac7390509128c42757fcfb89a0effde4a8e", "html_url": "https://github.com/rust-lang/rust/commit/4198fac7390509128c42757fcfb89a0effde4a8e"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "c07851da18ac1238c308a50d876ea5a9f86a160a", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0ccd56682578790abc045cfd0d0555f47e92f6b0/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/0ccd56682578790abc045cfd0d0555f47e92f6b0/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=0ccd56682578790abc045cfd0d0555f47e92f6b0", "patch": "@@ -7,6 +7,12 @@\n     <meta name=\"description\" content=\"{{page.description}}\"> {#- -#}\n     <meta name=\"keywords\" content=\"{{page.keywords}}\"> {#- -#}\n     <title>{{page.title}}</title> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}SourceSerif4-Regular.ttf.woff2\"> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}FiraSans-Regular.woff2\"> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}FiraSans-Medium.woff2\"> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}SourceCodePro-Regular.ttf.woff2\"> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}SourceSerif4-Bold.ttf.woff2\"> {#- -#}\n+    <link rel=\"preload\" as=\"font\" type=\"font/woff2\" crossorigin href=\"{{static_root_path | safe}}SourceCodePro-Semibold.ttf.woff2\"> {#- -#}\n     <link rel=\"stylesheet\" type=\"text/css\" {# -#}\n           href=\"{{static_root_path | safe}}normalize{{page.resource_suffix}}.css\"> {#- -#}\n     <link rel=\"stylesheet\" type=\"text/css\" {# -#}"}]}