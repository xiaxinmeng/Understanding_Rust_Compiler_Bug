{"sha": "f842f7547ec1d58261426447cd87d6e0362d9d9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NDJmNzU0N2VjMWQ1ODI2MTQyNjQ0N2NkODdkNmUwMzYyZDlkOWE=", "commit": {"author": {"name": "Bastian K\u00f6cher", "email": "git@kchr.de", "date": "2017-12-21T12:07:50Z"}, "committer": {"name": "Bastian K\u00f6cher", "email": "git@kchr.de", "date": "2017-12-26T11:26:39Z"}, "message": "Fixes tests", "tree": {"sha": "fece0297db03019163cf1dc08b7179304fd6181f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fece0297db03019163cf1dc08b7179304fd6181f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f842f7547ec1d58261426447cd87d6e0362d9d9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f842f7547ec1d58261426447cd87d6e0362d9d9a", "html_url": "https://github.com/rust-lang/rust/commit/f842f7547ec1d58261426447cd87d6e0362d9d9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f842f7547ec1d58261426447cd87d6e0362d9d9a/comments", "author": {"login": "bkchr", "id": 5718007, "node_id": "MDQ6VXNlcjU3MTgwMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5718007?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bkchr", "html_url": "https://github.com/bkchr", "followers_url": "https://api.github.com/users/bkchr/followers", "following_url": "https://api.github.com/users/bkchr/following{/other_user}", "gists_url": "https://api.github.com/users/bkchr/gists{/gist_id}", "starred_url": "https://api.github.com/users/bkchr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bkchr/subscriptions", "organizations_url": "https://api.github.com/users/bkchr/orgs", "repos_url": "https://api.github.com/users/bkchr/repos", "events_url": "https://api.github.com/users/bkchr/events{/privacy}", "received_events_url": "https://api.github.com/users/bkchr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bkchr", "id": 5718007, "node_id": "MDQ6VXNlcjU3MTgwMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5718007?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bkchr", "html_url": "https://github.com/bkchr", "followers_url": "https://api.github.com/users/bkchr/followers", "following_url": "https://api.github.com/users/bkchr/following{/other_user}", "gists_url": "https://api.github.com/users/bkchr/gists{/gist_id}", "starred_url": "https://api.github.com/users/bkchr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bkchr/subscriptions", "organizations_url": "https://api.github.com/users/bkchr/orgs", "repos_url": "https://api.github.com/users/bkchr/repos", "events_url": "https://api.github.com/users/bkchr/events{/privacy}", "received_events_url": "https://api.github.com/users/bkchr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "99a108c03654cd9d2df21223eb55a5dfd6552cb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/99a108c03654cd9d2df21223eb55a5dfd6552cb8", "html_url": "https://github.com/rust-lang/rust/commit/99a108c03654cd9d2df21223eb55a5dfd6552cb8"}], "stats": {"total": 35, "additions": 23, "deletions": 12}, "files": [{"sha": "f11328b2424ed9dbff7a006420f764704d4bf659", "filename": "src/librustc_typeck/lib.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f842f7547ec1d58261426447cd87d6e0362d9d9a/src%2Flibrustc_typeck%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f842f7547ec1d58261426447cd87d6e0362d9d9a/src%2Flibrustc_typeck%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Flib.rs?ref=f842f7547ec1d58261426447cd87d6e0362d9d9a", "patch": "@@ -115,6 +115,8 @@ use syntax::ast;\n use syntax::abi::Abi;\n use syntax_pos::Span;\n \n+use std::iter;\n+\n // NB: This module needs to be declared first so diagnostics are\n // registered before they are used.\n mod diagnostics;\n@@ -199,6 +201,25 @@ fn check_main_fn_ty<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                 }\n                 _ => ()\n             }\n+\n+            let actual = tcx.fn_sig(main_def_id);\n+\n+            let se_ty = tcx.mk_fn_ptr(ty::Binder(\n+                tcx.mk_fn_sig(\n+                    iter::empty(),\n+                    // the return type is checked in `check_fn`\n+                    actual.output().skip_binder(),\n+                    false,\n+                    hir::Unsafety::Normal,\n+                    Abi::Rust\n+                )\n+            ));\n+\n+            require_same_types(\n+                tcx,\n+                &ObligationCause::new(main_span, main_id, ObligationCauseCode::MainFunctionType),\n+                se_ty,\n+                tcx.mk_fn_ptr(actual));\n         }\n         _ => {\n             span_bug!(main_span,"}, {"sha": "a2ef7da78a84366ed2a9fcfbbf6ebfdf631909cb", "filename": "src/test/compile-fail/E0580.rs", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/99a108c03654cd9d2df21223eb55a5dfd6552cb8/src%2Ftest%2Fcompile-fail%2FE0580.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99a108c03654cd9d2df21223eb55a5dfd6552cb8/src%2Ftest%2Fcompile-fail%2FE0580.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0580.rs?ref=99a108c03654cd9d2df21223eb55a5dfd6552cb8", "patch": "@@ -1,11 +0,0 @@\n-// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-fn main() -> i32 { 0 } //~ ERROR E0580"}, {"sha": "a63162cf73d1c4171f3c0f93f29126df96c719e3", "filename": "src/test/compile-fail/main-wrong-type-2.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f842f7547ec1d58261426447cd87d6e0362d9d9a/src%2Ftest%2Fcompile-fail%2Fmain-wrong-type-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f842f7547ec1d58261426447cd87d6e0362d9d9a/src%2Ftest%2Fcompile-fail%2Fmain-wrong-type-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmain-wrong-type-2.rs?ref=f842f7547ec1d58261426447cd87d6e0362d9d9a", "patch": "@@ -7,8 +7,9 @@\n // <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n+#![feature(termination_trait)]\n \n fn main() -> char {\n-//~^ ERROR: main function has wrong type [E0580]\n+//~^ ERROR: the trait bound `char: std::Termination` is not satisfied\n     ' '\n }"}]}