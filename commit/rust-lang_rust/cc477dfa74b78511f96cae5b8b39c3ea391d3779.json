{"sha": "cc477dfa74b78511f96cae5b8b39c3ea391d3779", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjNDc3ZGZhNzRiNzg1MTFmOTZjYWU1YjhiMzljM2VhMzkxZDM3Nzk=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-24T10:09:18Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2013-08-24T10:12:30Z"}, "message": "Added note that there is still more to do on 5516.\n\nAlso added regression test for the byte vs codepoint issues that the\nprevious commit fixes.", "tree": {"sha": "d8b1c1904250cd07ab542e190af7552894200f51", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8b1c1904250cd07ab542e190af7552894200f51"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc477dfa74b78511f96cae5b8b39c3ea391d3779", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc477dfa74b78511f96cae5b8b39c3ea391d3779", "html_url": "https://github.com/rust-lang/rust/commit/cc477dfa74b78511f96cae5b8b39c3ea391d3779", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc477dfa74b78511f96cae5b8b39c3ea391d3779/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae63a3e400970a895d03ec1ef359ba86217c854b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae63a3e400970a895d03ec1ef359ba86217c854b", "html_url": "https://github.com/rust-lang/rust/commit/ae63a3e400970a895d03ec1ef359ba86217c854b"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "87aab3fbae2e14929fbfd82e6486b976671bac05", "filename": "src/libextra/getopts.rs", "status": "modified", "additions": 30, "deletions": 3, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/cc477dfa74b78511f96cae5b8b39c3ea391d3779/src%2Flibextra%2Fgetopts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc477dfa74b78511f96cae5b8b39c3ea391d3779/src%2Flibextra%2Fgetopts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Fgetopts.rs?ref=cc477dfa74b78511f96cae5b8b39c3ea391d3779", "patch": "@@ -690,7 +690,7 @@ pub mod groups {\n                 }\n             }\n \n-            // FIXME: #5516\n+            // FIXME: #5516 should be graphemes not codepoints\n             // here we just need to indent the start of the description\n             let rowlen = str::count_chars(row, 0, row.len());\n             if rowlen < 24 {\n@@ -708,14 +708,14 @@ pub mod groups {\n                 desc_normalized_whitespace.push_char(' ');\n             }\n \n-            // FIXME: #5516\n+            // FIXME: #5516 should be graphemes not codepoints\n             let mut desc_rows = ~[];\n             do each_split_within(desc_normalized_whitespace, 54) |substr| {\n                 desc_rows.push(substr.to_owned());\n                 true\n             };\n \n-            // FIXME: #5516\n+            // FIXME: #5516 should be graphemes not codepoints\n             // wrapped description\n             row.push_str(desc_rows.connect(desc_sep));\n \n@@ -1581,4 +1581,31 @@ Options:\n         debug!(\"generated: <<%s>>\", usage);\n         assert!(usage == expected)\n     }\n+\n+    #[test]\n+    fn test_groups_usage_description_multibyte_handling() {\n+        let optgroups = ~[\n+            groups::optflag(\"k\", \"k\\u2013w\\u2013\",\n+                \"The word kiwi is normally spelled with two i's\"),\n+            groups::optflag(\"a\", \"apple\",\n+                \"This \\u201Cdescription\\u201D has some characters that could \\\n+confuse the line wrapping; an apple costs 0.51\u20ac in some parts of Europe.\"),\n+        ];\n+\n+        let expected =\n+~\"Usage: fruits\n+\n+Options:\n+    -k --k\u2013w\u2013           The word kiwi is normally spelled with two i's\n+    -a --apple          This \u201cdescription\u201d has some characters that could\n+                        confuse the line wrapping; an apple costs 0.51\u20ac in\n+                        some parts of Europe.\n+\";\n+\n+        let usage = groups::usage(\"Usage: fruits\", optgroups);\n+\n+        debug!(\"expected: <<%s>>\", expected);\n+        debug!(\"generated: <<%s>>\", usage);\n+        assert!(usage == expected)\n+    }\n }"}]}