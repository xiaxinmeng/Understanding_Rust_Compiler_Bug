{"sha": "7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlNzhlNzA4ZmIzZjUxMTViNDdjYzFjMGIzMmM3N2EzODE1MTllY2M=", "commit": {"author": {"name": "Nick Hamann", "email": "nick@wabbo.org", "date": "2015-05-28T18:11:05Z"}, "committer": {"name": "Nick Hamann", "email": "nick@wabbo.org", "date": "2015-05-29T00:28:07Z"}, "message": "Convert mutable statics error to have error code and add explanation.\n\nAlso changes 'owned pointers' => 'boxes' in the error message.", "tree": {"sha": "d75a108be3b4f3759bd30d94acb8013d92e97a07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d75a108be3b4f3759bd30d94acb8013d92e97a07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "html_url": "https://github.com/rust-lang/rust/commit/7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/comments", "author": null, "committer": null, "parents": [{"sha": "eb15030dc18933c189daa0f9e0dfc780691a217b", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb15030dc18933c189daa0f9e0dfc780691a217b", "html_url": "https://github.com/rust-lang/rust/commit/eb15030dc18933c189daa0f9e0dfc780691a217b"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "1b63bd7a43704cf263447316791d9fa7cfdca7a5", "filename": "src/librustc/diagnostics.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Flibrustc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Flibrustc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdiagnostics.rs?ref=7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "patch": "@@ -880,6 +880,19 @@ From [RFC 246]:\n  > required that all references be borrowed.\n \n [RFC 246]: https://github.com/rust-lang/rfcs/pull/246\n+\"##,\n+\n+E0397: r##\"\n+It is not allowed for a mutable static to allocate or have destructors. For\n+example:\n+\n+```\n+// error: mutable statics are not allowed to have boxes\n+static mut FOO: Option<Box<usize>> = None;\n+\n+// error: mutable statics are not allowed to have destructors\n+static mut BAR: Option<Vec<i32>> = None;\n+```\n \"##\n \n }"}, {"sha": "2fd39c9d412c78e0217a6a2ec1842fc201d51056", "filename": "src/librustc/middle/check_const.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs?ref=7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "patch": "@@ -249,13 +249,13 @@ impl<'a, 'tcx> CheckCrateVisitor<'a, 'tcx> {\n         let suffix = if tcontents.has_dtor() {\n             \"destructors\"\n         } else if tcontents.owns_owned() {\n-            \"owned pointers\"\n+            \"boxes\"\n         } else {\n             return\n         };\n \n-        self.tcx.sess.span_err(e.span, &format!(\"mutable statics are not allowed \\\n-                                                 to have {}\", suffix));\n+        span_err!(self.tcx.sess, e.span, E0397,\n+                 \"mutable statics are not allowed to have {}\", suffix);\n     }\n \n     fn check_static_type(&self, e: &ast::Expr) {"}, {"sha": "e3bb01e6970786fa1bf94be2ce1502eedf4ec95a", "filename": "src/test/compile-fail/static-mut-not-constant.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Ftest%2Fcompile-fail%2Fstatic-mut-not-constant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e78e708fb3f5115b47cc1c0b32c77a381519ecc/src%2Ftest%2Fcompile-fail%2Fstatic-mut-not-constant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstatic-mut-not-constant.rs?ref=7e78e708fb3f5115b47cc1c0b32c77a381519ecc", "patch": "@@ -12,6 +12,6 @@\n \n static mut a: Box<isize> = box 3;\n //~^ ERROR allocations are not allowed in statics\n-//~^^ ERROR mutable statics are not allowed to have owned pointers\n+//~^^ ERROR mutable statics are not allowed to have boxes\n \n fn main() {}"}]}