{"sha": "7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjYmE3N2VkNGU0MjA3YjJlMjRiOGRkNTc3MjMzNjhjMjcxN2JiMmE=", "commit": {"author": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-09T13:01:00Z"}, "committer": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-09T13:01:00Z"}, "message": "vscode: added logging when donloading binaries", "tree": {"sha": "7f61ae16e22607d28b916345e8a87533ed2b467d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f61ae16e22607d28b916345e8a87533ed2b467d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "html_url": "https://github.com/rust-lang/rust/commit/7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/comments", "author": null, "committer": null, "parents": [{"sha": "f3240e22c6de69b408a83b59e85f40fb913acfab", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3240e22c6de69b408a83b59e85f40fb913acfab", "html_url": "https://github.com/rust-lang/rust/commit/f3240e22c6de69b408a83b59e85f40fb913acfab"}], "stats": {"total": 31, "additions": 26, "deletions": 5}, "files": [{"sha": "b51602ef9fcd4733041a1a96e875c8f5f3d17d54", "filename": "editors/code/src/installation/download_file.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "raw_url": "https://github.com/rust-lang/rust/raw/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts?ref=7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "patch": "@@ -20,6 +20,8 @@ export async function downloadFile(\n \n     let readBytes = 0;\n \n+    console.log(\"Downloading file of\", totalBytes, \"bytes size from\", url, \"to\", destFilePath);\n+\n     return new Promise<void>((resolve, reject) => response.body\n         .on(\"data\", (chunk: Buffer) => {\n             readBytes += chunk.length;"}, {"sha": "7e37006031376c1a138216225d69933a16acca77", "filename": "editors/code/src/installation/fetch_latest_artifact_metadata.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Ffetch_latest_artifact_metadata.ts", "raw_url": "https://github.com/rust-lang/rust/raw/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Ffetch_latest_artifact_metadata.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Ffetch_latest_artifact_metadata.ts?ref=7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "patch": "@@ -19,6 +19,8 @@ export async function fetchLatestArtifactMetadata(\n \n     // We skip runtime type checks for simplicity (here we cast from `any` to `GithubRelease`)\n \n+    console.log(\"Issuing request for released artifacts metadata to\", requestUrl);\n+\n     const response: GithubRelease = await fetch(requestUrl, {\n             headers: { Accept: \"application/vnd.github.v3+json\" }\n         })"}, {"sha": "1ce67b8b25bd8c34e40b4bab62758d3aa2987eae", "filename": "editors/code/src/installation/language_server.ts", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts", "raw_url": "https://github.com/rust-lang/rust/raw/7cba77ed4e4207b2e24b8dd57723368c2717bb2a/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts?ref=7cba77ed4e4207b2e24b8dd57723368c2717bb2a", "patch": "@@ -2,6 +2,7 @@ import * as vscode from \"vscode\";\n import * as path from \"path\";\n import { strict as assert } from \"assert\";\n import { promises as fs } from \"fs\";\n+import { promises as dns } from \"dns\";\n import { spawnSync } from \"child_process\";\n import { throttle } from \"throttle-debounce\";\n \n@@ -25,6 +26,7 @@ export async function downloadLatestLanguageServer(\n \n     const installationPath = path.join(installationDir, artifactFileName);\n \n+    console.time(\"Downloading ra_lsp_server\");\n     await vscode.window.withProgress(\n         {\n             location: vscode.ProgressLocation.Notification,\n@@ -48,6 +50,7 @@ export async function downloadLatestLanguageServer(\n             );\n         }\n     );\n+    console.timeEnd(\"Downloading ra_lsp_server\");\n \n     await fs.chmod(installationPath, 0o755); // Set (rwx, r_x, r_x) permissions\n }\n@@ -101,15 +104,21 @@ export async function ensureLanguageServerBinary(\n                     `Failed to download language server from ${langServerSource.repo.name} ` +\n                     `GitHub repository: ${err.message}`\n                 );\n+\n+                await dns.resolve('www.google.com').catch(err => {\n+                    console.error(\"DNS resolution failed, there might be an issue with Internet availability\");\n+                    console.error(err);\n+                });\n+\n                 return null;\n             }\n \n-\n-            assert(\n-                isBinaryAvailable(prebuiltBinaryPath),\n-                \"Downloaded language server binary is not functional\"\n+            if (!isBinaryAvailable(prebuiltBinaryPath)) assert(false,\n+                `Downloaded language server binary is not functional.` +\n+                `Downloaded from: ${JSON.stringify(langServerSource)}`\n             );\n \n+\n             vscode.window.showInformationMessage(\n                 \"Rust analyzer language server was successfully installed \ud83e\udd80\"\n             );\n@@ -119,6 +128,14 @@ export async function ensureLanguageServerBinary(\n     }\n \n     function isBinaryAvailable(binaryPath: string) {\n-        return spawnSync(binaryPath, [\"--version\"]).status === 0;\n+        const res = spawnSync(binaryPath, [\"--version\"]);\n+\n+        // ACHTUNG! `res` type declaration is inherently wrong, see\n+        // https://github.com/DefinitelyTyped/DefinitelyTyped/issues/42221\n+\n+        console.log(\"Checked binary availablity via --version\", res);\n+        console.log(binaryPath, \"--version output:\", res.output?.map(String));\n+\n+        return res.status === 0;\n     }\n }"}]}