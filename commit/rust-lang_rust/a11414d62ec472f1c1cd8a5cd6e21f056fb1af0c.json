{"sha": "a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "node_id": "C_kwDOAAsO6NoAKGExMTQxNGQ2MmVjNDcyZjFjMWNkOGE1Y2Q2ZTIxZjA1NmZiMWFmMGM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-27T20:42:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-27T20:42:27Z"}, "message": "Rollup merge of #92161 - petrochenkov:misclean, r=cjgillot\n\nresolve: Minor miscellaneous cleanups from #89059\n\n`@bors` rollup=always", "tree": {"sha": "d24915201418f6181129231f94c117768d3279df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d24915201418f6181129231f94c117768d3279df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhyiUzCRBK7hj4Ov3rIwAAAzMIAA7wq359IgsLHhl+jgVwQwcs\nZ1xarHDALUMwSY9NlMwKpLOGd4a7jWztKB83/LY6YMquRClo24QJLfKz7/bNd1va\nSW3PuwiPRaT7aK3gDQBijEg/Wth/wFQIJVpbdpRxzUVdjpcEmV6c3NXouX5ozzwp\n1utK87dQdz35NLDG/ZQO1b20oLw0MlGEym2MPqKNVSxAQh3TkJeNthZ6qYPSMdMD\nX5DzzvCYDDCZIxNGXaP+4ebTFS3pOw3zngHFwRNtRxQQv5RrT179nTZYQcRhZNU0\nx13Rc1eX7szMkiSjxIUddliM3NJRv74nDYZRbAUrz1yWQ1mfWmSl9MjN79HLpeE=\n=EgJv\n-----END PGP SIGNATURE-----\n", "payload": "tree d24915201418f6181129231f94c117768d3279df\nparent a7c79c08d6dea48c853f58fb2386ca4ce92054d3\nparent 13241008005f2471b3e4bae464ff81b2c2e2258f\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1640637747 +0100\ncommitter GitHub <noreply@github.com> 1640637747 +0100\n\nRollup merge of #92161 - petrochenkov:misclean, r=cjgillot\n\nresolve: Minor miscellaneous cleanups from #89059\n\n`@bors` rollup=always\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "html_url": "https://github.com/rust-lang/rust/commit/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a7c79c08d6dea48c853f58fb2386ca4ce92054d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a7c79c08d6dea48c853f58fb2386ca4ce92054d3", "html_url": "https://github.com/rust-lang/rust/commit/a7c79c08d6dea48c853f58fb2386ca4ce92054d3"}, {"sha": "13241008005f2471b3e4bae464ff81b2c2e2258f", "url": "https://api.github.com/repos/rust-lang/rust/commits/13241008005f2471b3e4bae464ff81b2c2e2258f", "html_url": "https://github.com/rust-lang/rust/commit/13241008005f2471b3e4bae464ff81b2c2e2258f"}], "stats": {"total": 42, "additions": 16, "deletions": 26}, "files": [{"sha": "b46a92e2c1b0f5dd1a287d56c58aaa7c9c186fdb", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "patch": "@@ -415,16 +415,12 @@ impl CStore {\n \n         let span = data.get_span(id.index, sess);\n \n-        let attrs = data.get_item_attrs(id.index, sess).collect();\n-\n-        let ident = data.item_ident(id.index, sess);\n-\n         LoadedMacro::MacroDef(\n             ast::Item {\n-                ident,\n+                ident: data.item_ident(id.index, sess),\n                 id: ast::DUMMY_NODE_ID,\n                 span,\n-                attrs,\n+                attrs: data.get_item_attrs(id.index, sess).collect(),\n                 kind: ast::ItemKind::MacroDef(data.get_macro(id.index, sess)),\n                 vis: ast::Visibility {\n                     span: span.shrink_to_lo(),"}, {"sha": "26344080381daba1d0deea4f9811fb37eefc0b78", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 14, "deletions": 20, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=a11414d62ec472f1c1cd8a5cd6e21f056fb1af0c", "patch": "@@ -3419,27 +3419,21 @@ impl<'a> Resolver<'a> {\n                     return v.clone();\n                 }\n \n-                let parse_attrs = || {\n-                    let attrs = self.cstore().item_attrs(def_id, self.session);\n-                    let attr =\n-                        attrs.iter().find(|a| a.has_name(sym::rustc_legacy_const_generics))?;\n-                    let mut ret = vec![];\n-                    for meta in attr.meta_item_list()? {\n-                        match meta.literal()?.kind {\n-                            LitKind::Int(a, _) => {\n-                                ret.push(a as usize);\n-                            }\n-                            _ => panic!(\"invalid arg index\"),\n-                        }\n+                let attr = self\n+                    .cstore()\n+                    .item_attrs(def_id, self.session)\n+                    .into_iter()\n+                    .find(|a| a.has_name(sym::rustc_legacy_const_generics))?;\n+                let mut ret = Vec::new();\n+                for meta in attr.meta_item_list()? {\n+                    match meta.literal()?.kind {\n+                        LitKind::Int(a, _) => ret.push(a as usize),\n+                        _ => panic!(\"invalid arg index\"),\n                     }\n-                    Some(ret)\n-                };\n-\n-                // Cache the lookup to avoid parsing attributes for an iterm\n-                // multiple times.\n-                let ret = parse_attrs();\n-                self.legacy_const_generic_args.insert(def_id, ret.clone());\n-                return ret;\n+                }\n+                // Cache the lookup to avoid parsing attributes for an iterm multiple times.\n+                self.legacy_const_generic_args.insert(def_id, Some(ret.clone()));\n+                return Some(ret);\n             }\n         }\n         None"}]}