{"sha": "1b5bbbf87792859c0f9bb797688259b19f626ab0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiNWJiYmY4Nzc5Mjg1OWMwZjliYjc5NzY4ODI1OWIxOWY2MjZhYjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-05T01:36:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-05T01:36:43Z"}, "message": "auto merge of #13865 : alexcrichton/rust/issue-13861, r=brson\n\nPreviously, windows was using the CREATE_NEW flag which fails if the file\r\npreviously existed, which differed from the unix semantics. This alters the\r\nopening to use the OPEN_ALWAYS flag to mirror the unix semantics.\r\n\r\nCloses #13861", "tree": {"sha": "07ec9365f43f8fb8636b96e021d168ff36927f14", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/07ec9365f43f8fb8636b96e021d168ff36927f14"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b5bbbf87792859c0f9bb797688259b19f626ab0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b5bbbf87792859c0f9bb797688259b19f626ab0", "html_url": "https://github.com/rust-lang/rust/commit/1b5bbbf87792859c0f9bb797688259b19f626ab0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b5bbbf87792859c0f9bb797688259b19f626ab0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b0977b1e0f7ba53b6301e2d5f7b26dd2d9c72fbf", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0977b1e0f7ba53b6301e2d5f7b26dd2d9c72fbf", "html_url": "https://github.com/rust-lang/rust/commit/b0977b1e0f7ba53b6301e2d5f7b26dd2d9c72fbf"}, {"sha": "8375a22b16ae6d746ccfd1f725a26562f55a82ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/8375a22b16ae6d746ccfd1f725a26562f55a82ba", "html_url": "https://github.com/rust-lang/rust/commit/8375a22b16ae6d746ccfd1f725a26562f55a82ba"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "88ba6dcbc7e58a5513df022028eb9cfe826f40f2", "filename": "src/libnative/io/file_win32.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1b5bbbf87792859c0f9bb797688259b19f626ab0/src%2Flibnative%2Fio%2Ffile_win32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b5bbbf87792859c0f9bb797688259b19f626ab0/src%2Flibnative%2Fio%2Ffile_win32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibnative%2Fio%2Ffile_win32.rs?ref=1b5bbbf87792859c0f9bb797688259b19f626ab0", "patch": "@@ -274,7 +274,7 @@ pub fn open(path: &CString, fm: io::FileMode, fa: io::FileAccess)\n         (io::Truncate, io::Read) => libc::TRUNCATE_EXISTING,\n         (io::Truncate, _) => libc::CREATE_ALWAYS,\n         (io::Open, io::Read) => libc::OPEN_EXISTING,\n-        (io::Open, _) => libc::CREATE_NEW,\n+        (io::Open, _) => libc::OPEN_ALWAYS,\n         (io::Append, io::Read) => {\n             dwDesiredAccess |= libc::FILE_APPEND_DATA;\n             libc::OPEN_EXISTING"}, {"sha": "cd304250b19281a8ea4e917317d1870ebc8ddd33", "filename": "src/libstd/io/fs.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/1b5bbbf87792859c0f9bb797688259b19f626ab0/src%2Flibstd%2Fio%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b5bbbf87792859c0f9bb797688259b19f626ab0/src%2Flibstd%2Fio%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Ffs.rs?ref=1b5bbbf87792859c0f9bb797688259b19f626ab0", "patch": "@@ -1255,11 +1255,31 @@ mod test {\n         match File::open_mode(&tmpdir.join(\"a\"), io::Open, io::Read) {\n             Ok(..) => fail!(), Err(..) => {}\n         }\n+\n+        // Perform each one twice to make sure that it succeeds the second time\n+        // (where the file exists)\n+        check!(File::open_mode(&tmpdir.join(\"b\"), io::Open, io::Write));\n+        assert!(tmpdir.join(\"b\").exists());\n         check!(File::open_mode(&tmpdir.join(\"b\"), io::Open, io::Write));\n+\n         check!(File::open_mode(&tmpdir.join(\"c\"), io::Open, io::ReadWrite));\n+        assert!(tmpdir.join(\"c\").exists());\n+        check!(File::open_mode(&tmpdir.join(\"c\"), io::Open, io::ReadWrite));\n+\n+        check!(File::open_mode(&tmpdir.join(\"d\"), io::Append, io::Write));\n+        assert!(tmpdir.join(\"d\").exists());\n         check!(File::open_mode(&tmpdir.join(\"d\"), io::Append, io::Write));\n+\n+        check!(File::open_mode(&tmpdir.join(\"e\"), io::Append, io::ReadWrite));\n+        assert!(tmpdir.join(\"e\").exists());\n         check!(File::open_mode(&tmpdir.join(\"e\"), io::Append, io::ReadWrite));\n+\n         check!(File::open_mode(&tmpdir.join(\"f\"), io::Truncate, io::Write));\n+        assert!(tmpdir.join(\"f\").exists());\n+        check!(File::open_mode(&tmpdir.join(\"f\"), io::Truncate, io::Write));\n+\n+        check!(File::open_mode(&tmpdir.join(\"g\"), io::Truncate, io::ReadWrite));\n+        assert!(tmpdir.join(\"g\").exists());\n         check!(File::open_mode(&tmpdir.join(\"g\"), io::Truncate, io::ReadWrite));\n \n         check!(File::create(&tmpdir.join(\"h\")).write(\"foo\".as_bytes()));"}]}