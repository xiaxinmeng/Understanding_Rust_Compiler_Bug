{"sha": "822957f49cf74705248ab1ff62c3bfc890a33562", "node_id": "C_kwDOAAsO6NoAKDgyMjk1N2Y0OWNmNzQ3MDUyNDhhYjFmZjYyYzNiZmM4OTBhMzM1NjI", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2022-07-04T12:04:35Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2022-07-04T12:11:28Z"}, "message": "incr.comp.: Make split-dwarf commandline options [TRACKED].", "tree": {"sha": "d371021f0acab5be20c5056d5917fdc3cba161a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d371021f0acab5be20c5056d5917fdc3cba161a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/822957f49cf74705248ab1ff62c3bfc890a33562", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/822957f49cf74705248ab1ff62c3bfc890a33562", "html_url": "https://github.com/rust-lang/rust/commit/822957f49cf74705248ab1ff62c3bfc890a33562", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/822957f49cf74705248ab1ff62c3bfc890a33562/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5c6a48aee84215a9200dfa1c4c6ad88f5721f56", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5c6a48aee84215a9200dfa1c4c6ad88f5721f56", "html_url": "https://github.com/rust-lang/rust/commit/a5c6a48aee84215a9200dfa1c4c6ad88f5721f56"}], "stats": {"total": 42, "additions": 38, "deletions": 4}, "files": [{"sha": "e7717f1367cb053d4619a7a27f4e9189d2ce3354", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/822957f49cf74705248ab1ff62c3bfc890a33562/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/822957f49cf74705248ab1ff62c3bfc890a33562/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=822957f49cf74705248ab1ff62c3bfc890a33562", "patch": "@@ -2724,8 +2724,8 @@ pub(crate) mod dep_tracking {\n     use super::{\n         BranchProtection, CFGuard, CFProtection, CrateType, DebugInfo, ErrorOutputType,\n         InstrumentCoverage, LdImpl, LinkerPluginLto, LocationDetail, LtoCli, OomStrategy, OptLevel,\n-        OutputType, OutputTypes, Passes, SourceFileHashAlgorithm, SwitchWithOptPath,\n-        SymbolManglingVersion, TrimmedDefPaths,\n+        OutputType, OutputTypes, Passes, SourceFileHashAlgorithm, SplitDwarfKind,\n+        SwitchWithOptPath, SymbolManglingVersion, TrimmedDefPaths,\n     };\n     use crate::lint;\n     use crate::options::WasiExecModel;\n@@ -2812,6 +2812,7 @@ pub(crate) mod dep_tracking {\n         Edition,\n         LinkerPluginLto,\n         SplitDebuginfo,\n+        SplitDwarfKind,\n         StackProtector,\n         SwitchWithOptPath,\n         SymbolManglingVersion,"}, {"sha": "be70ea5d5e48059b9c92548af34b446fef2ebf61", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/822957f49cf74705248ab1ff62c3bfc890a33562/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/822957f49cf74705248ab1ff62c3bfc890a33562/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=822957f49cf74705248ab1ff62c3bfc890a33562", "patch": "@@ -1496,15 +1496,15 @@ options! {\n         \"control if mem::uninitialized and mem::zeroed panic on more UB\"),\n     strip: Strip = (Strip::None, parse_strip, [UNTRACKED],\n         \"tell the linker which information to strip (`none` (default), `debuginfo` or `symbols`)\"),\n-    split_dwarf_kind: SplitDwarfKind = (SplitDwarfKind::Split, parse_split_dwarf_kind, [UNTRACKED],\n+    split_dwarf_kind: SplitDwarfKind = (SplitDwarfKind::Split, parse_split_dwarf_kind, [TRACKED],\n         \"split dwarf variant (only if -Csplit-debuginfo is enabled and on relevant platform)\n         (default: `split`)\n \n         `split`: sections which do not require relocation are written into a DWARF object (`.dwo`)\n                  file which is ignored by the linker\n         `single`: sections which do not require relocation are written into object file but ignored\n                   by the linker\"),\n-    split_dwarf_inlining: bool = (true, parse_bool, [UNTRACKED],\n+    split_dwarf_inlining: bool = (true, parse_bool, [TRACKED],\n         \"provide minimal debug info in the object/executable to facilitate online \\\n          symbolication/stack traces in the absence of .dwo/.dwp files when using Split DWARF\"),\n     symbol_mangling_version: Option<SymbolManglingVersion> = (None,"}, {"sha": "f2533e4146a84fe1eb19ba8bc661f54ed96adda7", "filename": "src/test/incremental/split_debuginfo_mode.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/822957f49cf74705248ab1ff62c3bfc890a33562/src%2Ftest%2Fincremental%2Fsplit_debuginfo_mode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/822957f49cf74705248ab1ff62c3bfc890a33562/src%2Ftest%2Fincremental%2Fsplit_debuginfo_mode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fsplit_debuginfo_mode.rs?ref=822957f49cf74705248ab1ff62c3bfc890a33562", "patch": "@@ -0,0 +1,33 @@\n+// This test case makes sure that changing split-debuginfo commandline options triggers a full re-compilation.\n+// We only test on x86_64-unknown-linux-gnu because there all combinations split-debuginfo settings are valid\n+// and the test is platform-independent otherwise.\n+\n+// ignore-tidy-linelength\n+// only-x86_64-unknown-linux-gnu\n+// revisions:rpass1 rpass2 rpass3 rpass4\n+\n+// [rpass1]compile-flags: -Zquery-dep-graph -Zunstable-options -Csplit-debuginfo=unpacked -Zsplit-dwarf-kind=single -Zsplit-dwarf-inlining=on\n+// [rpass2]compile-flags: -Zquery-dep-graph -Zunstable-options -Csplit-debuginfo=packed -Zsplit-dwarf-kind=single -Zsplit-dwarf-inlining=on\n+// [rpass3]compile-flags: -Zquery-dep-graph -Zunstable-options -Csplit-debuginfo=packed -Zsplit-dwarf-kind=split -Zsplit-dwarf-inlining=on\n+// [rpass4]compile-flags: -Zquery-dep-graph -Zunstable-options -Csplit-debuginfo=packed -Zsplit-dwarf-kind=split -Zsplit-dwarf-inlining=off\n+\n+#![feature(rustc_attrs)]\n+// For rpass2 we change -Csplit-debuginfo and thus expect every CGU to be recompiled\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode\", cfg = \"rpass2\")]\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode-another_module\", cfg = \"rpass2\")]\n+// For rpass3 we change -Zsplit-dwarf-kind and thus also expect every CGU to be recompiled\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode\", cfg = \"rpass3\")]\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode-another_module\", cfg = \"rpass3\")]\n+// For rpass4 we change -Zsplit-dwarf-inlining and thus also expect every CGU to be recompiled\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode\", cfg = \"rpass4\")]\n+#![rustc_partition_codegened(module = \"split_debuginfo_mode-another_module\", cfg = \"rpass4\")]\n+\n+mod another_module {\n+    pub fn foo() -> &'static str {\n+        \"hello world\"\n+    }\n+}\n+\n+pub fn main() {\n+    println!(\"{}\", another_module::foo());\n+}"}]}