{"sha": "500aeccc5b3135cc5a400faa3b739abaed87d722", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwMGFlY2NjNWIzMTM1Y2M1YTQwMGZhYTNiNzM5YWJhZWQ4N2Q3MjI=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-02-21T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-02-27T09:19:19Z"}, "message": "Use optional values for inlining thresholds\n\nTurn inlining threshold into optional values to make it possible to\nconfigure different defaults depending on the current mir-opt-level.", "tree": {"sha": "7fe46e971894d253816cb4708f1751569b9da9a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fe46e971894d253816cb4708f1751569b9da9a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/500aeccc5b3135cc5a400faa3b739abaed87d722", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/500aeccc5b3135cc5a400faa3b739abaed87d722", "html_url": "https://github.com/rust-lang/rust/commit/500aeccc5b3135cc5a400faa3b739abaed87d722", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/500aeccc5b3135cc5a400faa3b739abaed87d722/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f895f1c35a99eed6a173d4e699a71abc1b9823ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/f895f1c35a99eed6a173d4e699a71abc1b9823ff", "html_url": "https://github.com/rust-lang/rust/commit/f895f1c35a99eed6a173d4e699a71abc1b9823ff"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "9a11b53488786a15fe591e09e454e3b137991d9b", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=500aeccc5b3135cc5a400faa3b739abaed87d722", "patch": "@@ -558,8 +558,8 @@ fn test_debugging_options_tracking_hash() {\n     tracked!(human_readable_cgu_names, true);\n     tracked!(inline_in_all_cgus, Some(true));\n     tracked!(inline_mir, Some(true));\n-    tracked!(inline_mir_threshold, 123);\n-    tracked!(inline_mir_hint_threshold, 123);\n+    tracked!(inline_mir_threshold, Some(123));\n+    tracked!(inline_mir_hint_threshold, Some(123));\n     tracked!(insert_sideeffect, true);\n     tracked!(instrument_coverage, true);\n     tracked!(instrument_mcount, true);"}, {"sha": "16410175bd25b1d9569d06e517c6f8d29f4a7d4c", "filename": "compiler/rustc_mir/src/transform/inline.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs?ref=500aeccc5b3135cc5a400faa3b739abaed87d722", "patch": "@@ -349,9 +349,9 @@ impl Inliner<'tcx> {\n         let tcx = self.tcx;\n \n         let mut threshold = if callee_attrs.requests_inline() {\n-            self.tcx.sess.opts.debugging_opts.inline_mir_hint_threshold\n+            self.tcx.sess.opts.debugging_opts.inline_mir_hint_threshold.unwrap_or(100)\n         } else {\n-            self.tcx.sess.opts.debugging_opts.inline_mir_threshold\n+            self.tcx.sess.opts.debugging_opts.inline_mir_threshold.unwrap_or(50)\n         };\n \n         // Give a bonus functions with a small number of blocks,"}, {"sha": "e2b6b1dc2437b40cb8e58a169c98471bbdacfc11", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/500aeccc5b3135cc5a400faa3b739abaed87d722/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=500aeccc5b3135cc5a400faa3b739abaed87d722", "patch": "@@ -959,9 +959,9 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"verify incr. comp. hashes of green query instances (default: no)\"),\n     inline_mir: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"enable MIR inlining (default: no)\"),\n-    inline_mir_threshold: usize = (50, parse_uint, [TRACKED],\n+    inline_mir_threshold: Option<usize> = (None, parse_opt_uint, [TRACKED],\n         \"a default MIR inlining threshold (default: 50)\"),\n-    inline_mir_hint_threshold: usize = (100, parse_uint, [TRACKED],\n+    inline_mir_hint_threshold: Option<usize> = (None, parse_opt_uint, [TRACKED],\n         \"inlining threshold for functions with inline hint (default: 100)\"),\n     inline_in_all_cgus: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"control whether `#[inline]` functions are in all CGUs\"),"}]}