{"sha": "27943bead6798cd202d7398f38cecfd3f5840645", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3OTQzYmVhZDY3OThjZDIwMmQ3Mzk4ZjM4Y2VjZmQzZjU4NDA2NDU=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-11-26T20:33:40Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-11-26T20:34:06Z"}, "message": "Remove progress bar and add a true counter", "tree": {"sha": "6e1378c5225401c0ae04f39e869b28a0ee417fdb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e1378c5225401c0ae04f39e869b28a0ee417fdb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27943bead6798cd202d7398f38cecfd3f5840645", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27943bead6798cd202d7398f38cecfd3f5840645", "html_url": "https://github.com/rust-lang/rust/commit/27943bead6798cd202d7398f38cecfd3f5840645", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27943bead6798cd202d7398f38cecfd3f5840645/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97f6f141ee06ddfb22f8c02223fa71102b670528", "url": "https://api.github.com/repos/rust-lang/rust/commits/97f6f141ee06ddfb22f8c02223fa71102b670528", "html_url": "https://github.com/rust-lang/rust/commit/97f6f141ee06ddfb22f8c02223fa71102b670528"}], "stats": {"total": 41, "additions": 12, "deletions": 29}, "files": [{"sha": "9b1802a5fc8b337092cfc8a35732740788b2bd19", "filename": "crates/ra_cli/src/analysis_stats.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs?ref=27943bead6798cd202d7398f38cecfd3f5840645", "patch": "@@ -6,7 +6,7 @@ use ra_db::SourceDatabaseExt;\n use ra_hir::{AssocItem, Crate, HasSource, HirDisplay, ModuleDef, Ty, TypeWalk};\n use ra_syntax::AstNode;\n \n-use crate::{progress_bar::ProgressBar, Result, Verbosity};\n+use crate::{progress_report::ProgressReport, Result, Verbosity};\n \n pub fn run(\n     verbosity: Verbosity,\n@@ -76,8 +76,8 @@ pub fn run(\n \n     let inference_time = Instant::now();\n     let mut bar = match verbosity {\n-        Verbosity::Verbose | Verbosity::Normal => ProgressBar::new(funcs.len() as u64),\n-        Verbosity::Quiet => ProgressBar::hidden(),\n+        Verbosity::Verbose | Verbosity::Normal => ProgressReport::new(funcs.len() as u64),\n+        Verbosity::Quiet => ProgressReport::hidden(),\n     };\n \n     bar.tick();"}, {"sha": "08f3531477016666f82c4781d586045d90198938", "filename": "crates/ra_cli/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fmain.rs?ref=27943bead6798cd202d7398f38cecfd3f5840645", "patch": "@@ -3,7 +3,7 @@\n mod analysis_stats;\n mod analysis_bench;\n mod help;\n-mod progress_bar;\n+mod progress_report;\n \n use std::{error::Error, fmt::Write, io::Read};\n "}, {"sha": "6ce0d4cab7893f68e77a6e75feb000a32b82bfe5", "filename": "crates/ra_cli/src/progress_report.rs", "status": "renamed", "additions": 8, "deletions": 25, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fprogress_report.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27943bead6798cd202d7398f38cecfd3f5840645/crates%2Fra_cli%2Fsrc%2Fprogress_report.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fprogress_report.rs?ref=27943bead6798cd202d7398f38cecfd3f5840645", "patch": "@@ -4,38 +4,32 @@\n use std::io::Write;\n \n /// A Simple ASCII Progress Bar\n-pub struct ProgressBar {\n+pub struct ProgressReport {\n     curr: f32,\n     text: String,\n-    anim: usize,\n     hidden: bool,\n \n     len: u64,\n     pos: u64,\n     msg: String,\n }\n \n-impl ProgressBar {\n-    const ANIMATION: &'static str = r#\"|/-\\\"#;\n-    const BLOCK_COUNT: usize = 20;\n-\n-    pub fn new(len: u64) -> ProgressBar {\n-        ProgressBar {\n+impl ProgressReport {\n+    pub fn new(len: u64) -> ProgressReport {\n+        ProgressReport {\n             curr: 0.0,\n             text: String::new(),\n-            anim: 0,\n             hidden: false,\n             len,\n             pos: 0,\n             msg: String::new(),\n         }\n     }\n \n-    pub fn hidden() -> ProgressBar {\n-        ProgressBar {\n+    pub fn hidden() -> ProgressReport {\n+        ProgressReport {\n             curr: 0.0,\n             text: String::new(),\n-            anim: 0,\n             hidden: true,\n             len: 0,\n             pos: 0,\n@@ -72,19 +66,8 @@ impl ProgressBar {\n         if self.hidden {\n             return;\n         }\n-\n-        let progress_block: usize = (self.curr * Self::BLOCK_COUNT as f32) as usize;\n         let percent = (self.curr * 100.0) as u32;\n-        let text = format!(\n-            \"[{}{}] {:3>}% {} {}\",\n-            \"#\".repeat(progress_block),\n-            \"-\".repeat(Self::BLOCK_COUNT - progress_block),\n-            percent,\n-            Self::ANIMATION.chars().nth(self.anim).unwrap(),\n-            self.msg,\n-        );\n-\n-        self.anim = (self.anim + 1) % Self::ANIMATION.len();\n+        let text = format!(\"{}/{} {:3>}% {}\", self.pos, self.len, percent, self.msg);\n         self.update_text(&text);\n     }\n \n@@ -124,7 +107,7 @@ impl ProgressBar {\n     }\n \n     fn clear(&mut self) {\n-        print!(\"{}\", \"\\x08\".repeat(self.text.len()));\n+        print!(\"{}{}\", \" \".repeat(self.text.len()), \"\\x08\".repeat(self.text.len()));\n         self.text = String::new();\n     }\n }", "previous_filename": "crates/ra_cli/src/progress_bar.rs"}]}