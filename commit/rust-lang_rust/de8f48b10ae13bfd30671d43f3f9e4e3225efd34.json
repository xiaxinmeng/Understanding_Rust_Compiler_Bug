{"sha": "de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlOGY0OGIxMGFlMTNiZmQzMDY3MWQ0M2YzZjllNGUzMjI1ZWZkMzQ=", "commit": {"author": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2014-12-06T09:32:57Z"}, "committer": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2014-12-06T20:48:32Z"}, "message": "- Support gcc-less installation on Windows.  To do so in unattended mode run:`<intaller>.exe /TYPE=compact /SILENT`.\n- Do not require admin privileges to install.", "tree": {"sha": "2efd57c1f1cdc4ff56c4fa5fb9f8c08f0563def7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2efd57c1f1cdc4ff56c4fa5fb9f8c08f0563def7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "html_url": "https://github.com/rust-lang/rust/commit/de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/comments", "author": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c89031e1f213030f0514c8dcb9e6fa19ddbd323", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c89031e1f213030f0514c8dcb9e6fa19ddbd323", "html_url": "https://github.com/rust-lang/rust/commit/3c89031e1f213030f0514c8dcb9e6fa19ddbd323"}], "stats": {"total": 31, "additions": 22, "deletions": 9}, "files": [{"sha": "0b9cd86c61fe47c668578026807de3c0fbbf6447", "filename": "mk/dist.mk", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "patch": "@@ -123,15 +123,16 @@ PKG_EXE = dist/$(PKG_NAME)-$(CFG_BUILD).exe\n $(PKG_EXE): rust.iss modpath.iss upgrade.iss LICENSE.txt rust-logo.ico \\\n             $(CSREQ3_T_$(CFG_BUILD)_H_$(CFG_BUILD)) \\\n             dist-prepare-win\n-\t$(CFG_PYTHON) $(S)src/etc/make-win-dist.py tmp/dist/win $(CFG_BUILD)\n+\t$(Q)rm -rf tmp/dist/win/gcc\n+\t$(CFG_PYTHON) $(S)src/etc/make-win-dist.py tmp/dist/win/rust tmp/dist/win/gcc $(CFG_BUILD)\n \t@$(call E, ISCC: $@)\n \t$(Q)$(CFG_ISCC) $<\n \n $(eval $(call DEF_PREPARE,win))\n \n dist-prepare-win: PREPARE_HOST=$(CFG_BUILD)\n dist-prepare-win: PREPARE_TARGETS=$(CFG_BUILD)\n-dist-prepare-win: PREPARE_DEST_DIR=tmp/dist/win\n+dist-prepare-win: PREPARE_DEST_DIR=tmp/dist/win/rust\n dist-prepare-win: PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n dist-prepare-win: PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n dist-prepare-win: PREPARE_LIB_CMD=$(DEFAULT_PREPARE_LIB_CMD)"}, {"sha": "7fb86f904a20be3e023fb28f4c8a4df383655021", "filename": "src/etc/make-win-dist.py", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/src%2Fetc%2Fmake-win-dist.py", "raw_url": "https://github.com/rust-lang/rust/raw/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/src%2Fetc%2Fmake-win-dist.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmake-win-dist.py?ref=de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "patch": "@@ -8,6 +8,12 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n+# Script parameters:\n+#     argv[1] = rust component root,\n+#     argv[2] = gcc component root,\n+#     argv[3] = target triple\n+# The first two correspond to the two installable components defined in the setup script.\n+\n import sys, os, shutil, subprocess\n \n def find_files(files, path):\n@@ -22,7 +28,7 @@ def find_files(files, path):\n             raise Exception(\"Could not find '%s' in %s\" % (fname, path))\n     return found\n \n-def make_win_dist(dist_root, target_triple):\n+def make_win_dist(rust_root, gcc_root, target_triple):\n     # Ask gcc where it keeps its stuff\n     gcc_out = subprocess.check_output([\"gcc.exe\", \"-print-search-dirs\"])\n     bin_path = os.environ[\"PATH\"].split(os.pathsep)\n@@ -90,29 +96,29 @@ def make_win_dist(dist_root, target_triple):\n     target_libs = find_files(target_libs, lib_path)\n \n     # Copy runtime dlls next to rustc.exe\n-    dist_bin_dir = os.path.join(dist_root, \"bin\")\n+    dist_bin_dir = os.path.join(rust_root, \"bin\")\n     for src in rustc_dlls:\n         shutil.copy(src, dist_bin_dir)\n \n     # Copy platform tools to platform-specific bin directory\n-    target_bin_dir = os.path.join(dist_root, \"bin\", \"rustlib\", target_triple, \"bin\")\n+    target_bin_dir = os.path.join(gcc_root, \"bin\", \"rustlib\", target_triple, \"bin\")\n     if not os.path.exists(target_bin_dir):\n         os.makedirs(target_bin_dir)\n     for src in target_tools:\n         shutil.copy(src, target_bin_dir)\n \n     # Copy platform libs to platform-spcific lib directory\n-    target_lib_dir = os.path.join(dist_root, \"bin\", \"rustlib\", target_triple, \"lib\")\n+    target_lib_dir = os.path.join(gcc_root, \"bin\", \"rustlib\", target_triple, \"lib\")\n     if not os.path.exists(target_lib_dir):\n         os.makedirs(target_lib_dir)\n     for src in target_libs:\n         shutil.copy(src, target_lib_dir)\n \n     # Copy license files\n-    lic_dir = os.path.join(dist_root, \"bin\", \"third-party\")\n+    lic_dir = os.path.join(rust_root, \"bin\", \"third-party\")\n     if os.path.exists(lic_dir):\n         shutil.rmtree(lic_dir) # copytree() won't overwrite existing files\n     shutil.copytree(os.path.join(os.path.dirname(__file__), \"third-party\"), lic_dir)\n \n if __name__==\"__main__\":\n-    make_win_dist(sys.argv[1], sys.argv[2])\n+    make_win_dist(sys.argv[1], sys.argv[2], sys.argv[3])"}, {"sha": "c57a7ab6c7059d98048203d6b9d9dda5ad0e9f78", "filename": "src/etc/pkg/rust.iss", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/src%2Fetc%2Fpkg%2Frust.iss", "raw_url": "https://github.com/rust-lang/rust/raw/de8f48b10ae13bfd30671d43f3f9e4e3225efd34/src%2Fetc%2Fpkg%2Frust.iss", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fpkg%2Frust.iss?ref=de8f48b10ae13bfd30671d43f3f9e4e3225efd34", "patch": "@@ -14,6 +14,7 @@ AppPublisherURL=http://www.rust-lang.org\n VersionInfoVersion={#CFG_VERSION_WIN}\n LicenseFile=LICENSE.txt\n \n+PrivilegesRequired=lowest\n DisableWelcomePage=true\n DisableProgramGroupPage=true\n DisableReadyPage=true\n@@ -37,8 +38,13 @@ Uninstallable=yes\n [Tasks]\n Name: modifypath; Description: &Add {app}\\bin to your PATH (recommended)\n \n+[Components]\n+Name: rust; Description: \"Rust compiler and standard crates\"; Types: full compact custom; Flags: fixed\n+Name: gcc; Description: \"Linker and platform libraries\"; Types: full\n+\n [Files]\n-Source: \"tmp/dist/win/*.*\" ; DestDir: \"{app}\"; Flags: ignoreversion recursesubdirs\n+Source: \"tmp/dist/win/rust/*.*\"; DestDir: \"{app}\"; Flags: ignoreversion recursesubdirs; Components: rust\n+Source: \"tmp/dist/win/gcc/*.*\"; DestDir: \"{app}\"; Flags: ignoreversion recursesubdirs; Components: gcc\n \n [Code]\n const"}]}