{"sha": "d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5M2Q3N2I3MTMwNjViZWU5YTVhNDRmYmI2NjNmNmZiZmFmMDBhZGE=", "commit": {"author": {"name": "Arpad Borsos", "email": "swatinem@swatinem.de", "date": "2021-04-19T21:31:11Z"}, "committer": {"name": "Arpad Borsos", "email": "swatinem@swatinem.de", "date": "2021-04-19T21:42:09Z"}, "message": "rustdoc: Simplify some document functions\n\n* Remove `prefix` param of `document_short/full`, `render_markdown`, as its always an empty string.\n* Remove `Option` wrapping of `document_short` `parent`, as its always `Some`.", "tree": {"sha": "393866110ad2040b708f56edf1d872dc4eeaebe8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/393866110ad2040b708f56edf1d872dc4eeaebe8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZNNjbpmzULCa7LeL/HvKd4JLMpgFAmB9+ToACgkQ/HvKd4JL\nMph7ShAA1Z75c6MKsPpCXQiA9Hj6fPTGV9TY2EFBnC2IuE4g1HIRdu1geFnGXaqb\nfv3jKeYYbLicE4qJnwee0HpDG/8y2Gyf7jr3RhGDs28YvuGVnTg0qwSh2+4M/u1K\n3Nn11iaw+4PcFhVrQRz6lmbAdBxXdRLzDEtxItvpTedrwnOALrm+UoE9BGYHmZ+q\nNNV1LwTr6yV8D9qAs1LmXbh4AhyTY6jnysVQSS5NKkzTLkicTCH1xFj6qjP9Vsu6\nkFOHEnq5LN/37RETFEB1LPeOMdB9E7rdmolsjU4tG7MtrORncjWQJNa8gkU4CHGi\nVOZIekKBKUvks3TRztpgpEbhkChgAYW4T5KwOP/Jus6j1z+iwHa1jKq4jKUDMDCG\nd/8OhaOgkIPImhELu1VVFPBZugQobnK5uyOeTK1rzzgX6oiY6pqSZWYEi0D1xyJ1\neHmrMVAW5jNjBgT0vUcuaTcPH31ZyXqkq0LczHd+STk+rUrCYSG8T53GymDmwb8p\nojU1uMvcZInPV0wWls9Xp46uge0SGUxKxcxyztKx2dvyTMUFfuM0w9An4RnimgCd\ny4Je9E0y44CBDP9gMScF4xeSK4wyyI10xr+WkOVATnOFiUmd1RoZaGcR6RGN5iuH\n25Dnb+opv8HahWdSb4rYk5b390OuXiJ7CJxI8gzVsuIwjOH8MSM=\n=ZzbG\n-----END PGP SIGNATURE-----", "payload": "tree 393866110ad2040b708f56edf1d872dc4eeaebe8\nparent 1a6c98e4d6f6338dac2357b9433af8ef2a6ba320\nauthor Arpad Borsos <swatinem@swatinem.de> 1618867871 +0200\ncommitter Arpad Borsos <swatinem@swatinem.de> 1618868529 +0200\n\nrustdoc: Simplify some document functions\n\n* Remove `prefix` param of `document_short/full`, `render_markdown`, as its always an empty string.\n* Remove `Option` wrapping of `document_short` `parent`, as its always `Some`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "html_url": "https://github.com/rust-lang/rust/commit/d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d93d77b713065bee9a5a44fbb663f6fbfaf00ada/comments", "author": {"login": "Swatinem", "id": 580492, "node_id": "MDQ6VXNlcjU4MDQ5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/580492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swatinem", "html_url": "https://github.com/Swatinem", "followers_url": "https://api.github.com/users/Swatinem/followers", "following_url": "https://api.github.com/users/Swatinem/following{/other_user}", "gists_url": "https://api.github.com/users/Swatinem/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swatinem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swatinem/subscriptions", "organizations_url": "https://api.github.com/users/Swatinem/orgs", "repos_url": "https://api.github.com/users/Swatinem/repos", "events_url": "https://api.github.com/users/Swatinem/events{/privacy}", "received_events_url": "https://api.github.com/users/Swatinem/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Swatinem", "id": 580492, "node_id": "MDQ6VXNlcjU4MDQ5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/580492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swatinem", "html_url": "https://github.com/Swatinem", "followers_url": "https://api.github.com/users/Swatinem/followers", "following_url": "https://api.github.com/users/Swatinem/following{/other_user}", "gists_url": "https://api.github.com/users/Swatinem/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swatinem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swatinem/subscriptions", "organizations_url": "https://api.github.com/users/Swatinem/orgs", "repos_url": "https://api.github.com/users/Swatinem/repos", "events_url": "https://api.github.com/users/Swatinem/events{/privacy}", "received_events_url": "https://api.github.com/users/Swatinem/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a6c98e4d6f6338dac2357b9433af8ef2a6ba320", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a6c98e4d6f6338dac2357b9433af8ef2a6ba320", "html_url": "https://github.com/rust-lang/rust/commit/1a6c98e4d6f6338dac2357b9433af8ef2a6ba320"}], "stats": {"total": 56, "additions": 11, "deletions": 45}, "files": [{"sha": "d773f37ad90a3b6af995773effc68ea32d020db9", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 11, "deletions": 45, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/d93d77b713065bee9a5a44fbb663f6fbfaf00ada/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d93d77b713065bee9a5a44fbb663f6fbfaf00ada/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=d93d77b713065bee9a5a44fbb663f6fbfaf00ada", "patch": "@@ -509,7 +509,7 @@ fn document(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item, parent: Option\n         info!(\"Documenting {}\", name);\n     }\n     document_item_info(w, cx, item, false, parent);\n-    document_full(w, item, cx, \"\", false);\n+    document_full(w, item, cx, false);\n }\n \n /// Render md_text as markdown.\n@@ -518,15 +518,13 @@ fn render_markdown(\n     cx: &Context<'_>,\n     md_text: &str,\n     links: Vec<RenderedLink>,\n-    prefix: &str,\n     is_hidden: bool,\n ) {\n     let mut ids = cx.id_map.borrow_mut();\n     write!(\n         w,\n-        \"<div class=\\\"docblock{}\\\">{}{}</div>\",\n+        \"<div class=\\\"docblock{}\\\">{}</div>\",\n         if is_hidden { \" hidden\" } else { \"\" },\n-        prefix,\n         Markdown(\n             md_text,\n             &links,\n@@ -546,12 +544,11 @@ fn document_short(\n     item: &clean::Item,\n     cx: &Context<'_>,\n     link: AssocItemLink<'_>,\n-    prefix: &str,\n     is_hidden: bool,\n-    parent: Option<&clean::Item>,\n+    parent: &clean::Item,\n     show_def_docs: bool,\n ) {\n-    document_item_info(w, cx, item, is_hidden, parent);\n+    document_item_info(w, cx, item, is_hidden, Some(parent));\n     if !show_def_docs {\n         return;\n     }\n@@ -570,39 +567,17 @@ fn document_short(\n \n         write!(\n             w,\n-            \"<div class='docblock{}'>{}{}</div>\",\n+            \"<div class='docblock{}'>{}</div>\",\n             if is_hidden { \" hidden\" } else { \"\" },\n-            prefix,\n             summary_html,\n         );\n-    } else if !prefix.is_empty() {\n-        write!(\n-            w,\n-            \"<div class=\\\"docblock{}\\\">{}</div>\",\n-            if is_hidden { \" hidden\" } else { \"\" },\n-            prefix\n-        );\n     }\n }\n \n-fn document_full(\n-    w: &mut Buffer,\n-    item: &clean::Item,\n-    cx: &Context<'_>,\n-    prefix: &str,\n-    is_hidden: bool,\n-) {\n+fn document_full(w: &mut Buffer, item: &clean::Item, cx: &Context<'_>, is_hidden: bool) {\n     if let Some(s) = cx.shared.maybe_collapsed_doc_value(item) {\n         debug!(\"Doc block: =====\\n{}\\n=====\", s);\n-        render_markdown(w, cx, &*s, item.links(cx), prefix, is_hidden);\n-    } else if !prefix.is_empty() {\n-        if is_hidden {\n-            w.write_str(\"<div class=\\\"docblock hidden\\\">\");\n-        } else {\n-            w.write_str(\"<div class=\\\"docblock\\\">\");\n-        }\n-        w.write_str(prefix);\n-        w.write_str(\"</div>\");\n+        render_markdown(w, cx, &s, item.links(cx), is_hidden);\n     }\n }\n \n@@ -1547,30 +1522,21 @@ fn render_impl(\n                         // because impls can't have a stability.\n                         if item.doc_value().is_some() {\n                             document_item_info(w, cx, it, is_hidden, Some(parent));\n-                            document_full(w, item, cx, \"\", is_hidden);\n+                            document_full(w, item, cx, is_hidden);\n                         } else {\n                             // In case the item isn't documented,\n                             // provide short documentation from the trait.\n-                            document_short(\n-                                w,\n-                                it,\n-                                cx,\n-                                link,\n-                                \"\",\n-                                is_hidden,\n-                                Some(parent),\n-                                show_def_docs,\n-                            );\n+                            document_short(w, it, cx, link, is_hidden, parent, show_def_docs);\n                         }\n                     }\n                 } else {\n                     document_item_info(w, cx, item, is_hidden, Some(parent));\n                     if show_def_docs {\n-                        document_full(w, item, cx, \"\", is_hidden);\n+                        document_full(w, item, cx, is_hidden);\n                     }\n                 }\n             } else {\n-                document_short(w, item, cx, link, \"\", is_hidden, Some(parent), show_def_docs);\n+                document_short(w, item, cx, link, is_hidden, parent, show_def_docs);\n             }\n         }\n     }"}]}