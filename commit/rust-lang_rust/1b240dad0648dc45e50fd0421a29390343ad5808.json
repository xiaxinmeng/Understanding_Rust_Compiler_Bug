{"sha": "1b240dad0648dc45e50fd0421a29390343ad5808", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiMjQwZGFkMDY0OGRjNDVlNTBmZDA0MjFhMjkzOTAzNDNhZDU4MDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-19T14:52:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-19T14:52:30Z"}, "message": "Auto merge of #50763 - KyleStach1678:unused-loop-label, r=petrochenkov\n\nAdd lint checks for unused loop labels\n\nPreviously no warning was generated when a loop label was written out but never used (i.e. in a `break` or `continue` statement):\n```rust\nfn main() {\n    'unused_label: loop {}\n}\n```\nwould compile without complaint.\n\nThis fix introduces `-W unused_loop_label`, which generates the following warning message for the above snippet:\n```\nwarning: unused loop label\n --> main.rs:2:5\n  |\n2 |     'unused_label: loop {}\n  |     ^^^^^^^^^^^^^\n  |\n  = note: #[warn(unused_loop_label)] on by default\n```\n\nFixes: #50751.", "tree": {"sha": "32a9591c9cd4f961182958e1d238f6065c826928", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32a9591c9cd4f961182958e1d238f6065c826928"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b240dad0648dc45e50fd0421a29390343ad5808", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b240dad0648dc45e50fd0421a29390343ad5808", "html_url": "https://github.com/rust-lang/rust/commit/1b240dad0648dc45e50fd0421a29390343ad5808", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b240dad0648dc45e50fd0421a29390343ad5808/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef8ee647749ad2f0acf235aaf18debacb974a048", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef8ee647749ad2f0acf235aaf18debacb974a048", "html_url": "https://github.com/rust-lang/rust/commit/ef8ee647749ad2f0acf235aaf18debacb974a048"}, {"sha": "6da64a7666e89b39b99d728aaa3a40c124f31563", "url": "https://api.github.com/repos/rust-lang/rust/commits/6da64a7666e89b39b99d728aaa3a40c124f31563", "html_url": "https://github.com/rust-lang/rust/commit/6da64a7666e89b39b99d728aaa3a40c124f31563"}], "stats": {"total": 237, "additions": 210, "deletions": 27}, "files": [{"sha": "ac2fa8515bc1d1a836231592e63aea784f379be4", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -273,6 +273,12 @@ declare_lint! {\n     \"detects name collision with an existing but unstable method\"\n }\n \n+declare_lint! {\n+    pub UNUSED_LABELS,\n+    Allow,\n+    \"detects labels that are never used\"\n+}\n+\n /// Does nothing as a lint pass, but registers some `Lint`s\n /// which are used by other parts of the compiler.\n #[derive(Copy, Clone)]\n@@ -318,6 +324,7 @@ impl LintPass for HardwiredLints {\n             UNUSED_MUT,\n             SINGLE_USE_LIFETIME,\n             UNUSED_LIFETIME,\n+            UNUSED_LABELS,\n             TYVAR_BEHIND_RAW_POINTER,\n             ELIDED_LIFETIME_IN_PATH,\n             BARE_TRAIT_OBJECT,"}, {"sha": "cfd5cf5a0f98c7a83565a0b4038ff69acc132979", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -177,6 +177,7 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n                     UNUSED_DOC_COMMENT,\n                     UNUSED_EXTERN_CRATES,\n                     UNUSED_FEATURES,\n+                    UNUSED_LABELS,\n                     UNUSED_PARENS);\n \n     add_lint_group!(sess,"}, {"sha": "590ce168d5d0fdac64d6dd81967a5aa308d5d881", "filename": "src/librustc_resolve/check_unused.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_resolve%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_resolve%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fcheck_unused.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -142,6 +142,10 @@ pub fn check_crate(resolver: &mut Resolver, krate: &ast::Crate) {\n         }\n     }\n \n+    for (id, span) in resolver.unused_labels.iter() {\n+        resolver.session.buffer_lint(lint::builtin::UNUSED_LABELS, *id, *span, \"unused label\");\n+    }\n+\n     let mut visitor = UnusedImportCheckVisitor {\n         resolver,\n         unused_imports: NodeMap(),"}, {"sha": "bc5d50491ad6be021b585aa27d771d7b94d116a7", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -1468,6 +1468,10 @@ pub struct Resolver<'a> {\n     pub maybe_unused_trait_imports: NodeSet,\n     pub maybe_unused_extern_crates: Vec<(NodeId, Span)>,\n \n+    /// A list of labels as of yet unused. Labels will be removed from this map when\n+    /// they are used (in a `break` or `continue` statement)\n+    pub unused_labels: FxHashMap<NodeId, Span>,\n+\n     /// privacy errors are delayed until the end in order to deduplicate them\n     privacy_errors: Vec<PrivacyError<'a>>,\n     /// ambiguity errors are delayed for deduplication\n@@ -1747,6 +1751,8 @@ impl<'a> Resolver<'a> {\n             maybe_unused_trait_imports: NodeSet(),\n             maybe_unused_extern_crates: Vec::new(),\n \n+            unused_labels: FxHashMap(),\n+\n             privacy_errors: Vec::new(),\n             ambiguity_errors: Vec::new(),\n             use_injections: Vec::new(),\n@@ -3682,6 +3688,7 @@ impl<'a> Resolver<'a> {\n         where F: FnOnce(&mut Resolver)\n     {\n         if let Some(label) = label {\n+            self.unused_labels.insert(id, label.ident.span);\n             let def = Def::Label(id);\n             self.with_label_rib(|this| {\n                 this.label_ribs.last_mut().unwrap().bindings.insert(label.ident, def);\n@@ -3730,9 +3737,10 @@ impl<'a> Resolver<'a> {\n                                       ResolutionError::UndeclaredLabel(&label.ident.name.as_str(),\n                                                                        close_match));\n                     }\n-                    Some(def @ Def::Label(_)) => {\n+                    Some(Def::Label(id)) => {\n                         // Since this def is a label, it is never read.\n-                        self.record_def(expr.id, PathResolution::new(def));\n+                        self.record_def(expr.id, PathResolution::new(Def::Label(id)));\n+                        self.unused_labels.remove(&id);\n                     }\n                     Some(_) => {\n                         span_bug!(expr.span, \"label wasn't mapped to a label def!\");"}, {"sha": "4a505dff3d467c4be00465cf886717ece79ba5ef", "filename": "src/test/ui/label_break_value_continue.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_continue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_continue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flabel_break_value_continue.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -9,6 +9,7 @@\n // except according to those terms.\n \n #![feature(label_break_value)]\n+#![allow(unused_labels)]\n \n // Simple continue pointing to an unlabeled break should yield in an error\n fn continue_simple() {"}, {"sha": "12a21a8a59441ab9dca819786245c139e09843d4", "filename": "src/test/ui/label_break_value_continue.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_continue.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_continue.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flabel_break_value_continue.stderr?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -1,25 +1,25 @@\n error[E0695]: unlabeled `continue` inside of a labeled block\n-  --> $DIR/label_break_value_continue.rs:16:9\n+  --> $DIR/label_break_value_continue.rs:17:9\n    |\n LL |         continue; //~ ERROR unlabeled `continue` inside of a labeled block\n    |         ^^^^^^^^ `continue` statements that would diverge to or through a labeled block need to bear a label\n \n error[E0696]: `continue` pointing to a labeled block\n-  --> $DIR/label_break_value_continue.rs:23:9\n+  --> $DIR/label_break_value_continue.rs:24:9\n    |\n LL |         continue 'b; //~ ERROR `continue` pointing to a labeled block\n    |         ^^^^^^^^^^^ labeled blocks cannot be `continue`'d\n    |\n note: labeled block the continue points to\n-  --> $DIR/label_break_value_continue.rs:22:5\n+  --> $DIR/label_break_value_continue.rs:23:5\n    |\n LL | /     'b: {\n LL | |         continue 'b; //~ ERROR `continue` pointing to a labeled block\n LL | |     }\n    | |_____^\n \n error[E0695]: unlabeled `continue` inside of a labeled block\n-  --> $DIR/label_break_value_continue.rs:31:13\n+  --> $DIR/label_break_value_continue.rs:32:13\n    |\n LL |             continue; //~ ERROR unlabeled `continue` inside of a labeled block\n    |             ^^^^^^^^ `continue` statements that would diverge to or through a labeled block need to bear a label"}, {"sha": "454ebd4c6cf6d7bb555cfeb640b7209ab8aa1fe9", "filename": "src/test/ui/label_break_value_unlabeled_break.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -9,6 +9,7 @@\n // except according to those terms.\n \n #![feature(label_break_value)]\n+#![allow(unused_labels)]\n \n // Simple unlabeled break should yield in an error\n fn unlabeled_break_simple() {"}, {"sha": "62c4a12231baf9d85f0c44bf54518346084c806c", "filename": "src/test/ui/label_break_value_unlabeled_break.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flabel_break_value_unlabeled_break.stderr?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -1,11 +1,11 @@\n error[E0695]: unlabeled `break` inside of a labeled block\n-  --> $DIR/label_break_value_unlabeled_break.rs:16:9\n+  --> $DIR/label_break_value_unlabeled_break.rs:17:9\n    |\n LL |         break; //~ ERROR unlabeled `break` inside of a labeled block\n    |         ^^^^^ `break` statements that would diverge to or through a labeled block need to bear a label\n \n error[E0695]: unlabeled `break` inside of a labeled block\n-  --> $DIR/label_break_value_unlabeled_break.rs:24:13\n+  --> $DIR/label_break_value_unlabeled_break.rs:25:13\n    |\n LL |             break; //~ ERROR unlabeled `break` inside of a labeled block\n    |             ^^^^^ `break` statements that would diverge to or through a labeled block need to bear a label"}, {"sha": "23add604da6ab29feda8ae149b6c9313145a2018", "filename": "src/test/ui/lint/unused_labels.rs", "status": "added", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flint%2Funused_labels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flint%2Funused_labels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused_labels.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -0,0 +1,96 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// The output should warn when a loop label is not used. However, it\n+// should also deal with the edge cases where a label is shadowed,\n+// within nested loops\n+\n+// compile-pass\n+\n+#![feature(label_break_value)]\n+#![warn(unused_labels)]\n+\n+fn main() {\n+    'unused_while_label: while 0 == 0 {\n+        //~^ WARN unused label\n+    }\n+\n+    let opt = Some(0);\n+    'unused_while_let_label: while let Some(_) = opt {\n+        //~^ WARN unused label\n+    }\n+\n+    'unused_for_label: for _ in 0..10 {\n+        //~^ WARN unused label\n+    }\n+\n+    'used_loop_label: loop {\n+        break 'used_loop_label;\n+    }\n+\n+    'used_loop_label_outer_1: for _ in 0..10 {\n+        'used_loop_label_inner_1: for _ in 0..10 {\n+            break 'used_loop_label_inner_1;\n+        }\n+        break 'used_loop_label_outer_1;\n+    }\n+\n+    'used_loop_label_outer_2: for _ in 0..10 {\n+        'unused_loop_label_inner_2: for _ in 0..10 {\n+            //~^ WARN unused label\n+            break 'used_loop_label_outer_2;\n+        }\n+    }\n+\n+    'unused_loop_label_outer_3: for _ in 0..10 {\n+        //~^ WARN unused label\n+        'used_loop_label_inner_3: for _ in 0..10 {\n+            break 'used_loop_label_inner_3;\n+        }\n+    }\n+\n+    // You should be able to break the same label many times\n+    'many_used: loop {\n+        if true {\n+            break 'many_used;\n+        } else {\n+            break 'many_used;\n+        }\n+    }\n+\n+    // Test breaking many times with the same inner label doesn't break the\n+    // warning on the outer label\n+    'many_used_shadowed: for _ in 0..10 {\n+        //~^ WARN unused label\n+        'many_used_shadowed: for _ in 0..10 {\n+            //~^ WARN label name `'many_used_shadowed` shadows a label name that is already in scope\n+            if 1 % 2 == 0 {\n+                break 'many_used_shadowed;\n+            } else {\n+                break 'many_used_shadowed;\n+            }\n+        }\n+    }\n+\n+    'unused_loop_label: loop {\n+        //~^ WARN unused label\n+        break;\n+    }\n+\n+    // Make sure unused block labels give warnings...\n+    'unused_block_label: {\n+        //~^ WARN unused label\n+    }\n+\n+    // ...and that used ones don't:\n+    'used_block_label: {\n+        break 'used_block_label;\n+    }\n+}"}, {"sha": "825f5e281f0b9d784ef42fb19ace6d97f5c76b3e", "filename": "src/test/ui/lint/unused_labels.stderr", "status": "added", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flint%2Funused_labels.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Flint%2Funused_labels.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused_labels.stderr?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -0,0 +1,63 @@\n+warning: unused label\n+  --> $DIR/unused_labels.rs:21:5\n+   |\n+LL |     'unused_while_label: while 0 == 0 {\n+   |     ^^^^^^^^^^^^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/unused_labels.rs:18:9\n+   |\n+LL | #![warn(unused_labels)]\n+   |         ^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:26:5\n+   |\n+LL |     'unused_while_let_label: while let Some(_) = opt {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:30:5\n+   |\n+LL |     'unused_for_label: for _ in 0..10 {\n+   |     ^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:46:9\n+   |\n+LL |         'unused_loop_label_inner_2: for _ in 0..10 {\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:52:5\n+   |\n+LL |     'unused_loop_label_outer_3: for _ in 0..10 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:70:5\n+   |\n+LL |     'many_used_shadowed: for _ in 0..10 {\n+   |     ^^^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:82:5\n+   |\n+LL |     'unused_loop_label: loop {\n+   |     ^^^^^^^^^^^^^^^^^^\n+\n+warning: unused label\n+  --> $DIR/unused_labels.rs:88:5\n+   |\n+LL |     'unused_block_label: {\n+   |     ^^^^^^^^^^^^^^^^^^^\n+\n+warning: label name `'many_used_shadowed` shadows a label name that is already in scope\n+  --> $DIR/unused_labels.rs:72:9\n+   |\n+LL |     'many_used_shadowed: for _ in 0..10 {\n+   |     ------------------- first declared here\n+LL |         //~^ WARN unused label\n+LL |         'many_used_shadowed: for _ in 0..10 {\n+   |         ^^^^^^^^^^^^^^^^^^^ lifetime 'many_used_shadowed already in scope\n+"}, {"sha": "b273e7a0c7c9e750e02fc085d2ef8c31603b70d9", "filename": "src/test/ui/loops-reject-duplicate-labels-2.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -18,6 +18,7 @@\n // discussed here:\n // https://internals.rust-lang.org/t/psa-rejecting-duplicate-loop-labels/1833\n \n+#[allow(unused_labels)]\n pub fn foo() {\n     { 'fl: for _ in 0..10 { break; } }\n     { 'fl: loop { break; } }             //~ WARN label name `'fl` shadows a label name that is already in scope"}, {"sha": "41b4a850f1bfb28c5c426665c45ad2b494e88b52", "filename": "src/test/ui/loops-reject-duplicate-labels-2.stderr", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Floops-reject-duplicate-labels-2.stderr?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -1,69 +1,69 @@\n warning: label name `'fl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:23:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:24:7\n    |\n LL |     { 'fl: for _ in 0..10 { break; } }\n    |       --- first declared here\n LL |     { 'fl: loop { break; } }             //~ WARN label name `'fl` shadows a label name that is already in scope\n    |       ^^^ lifetime 'fl already in scope\n \n warning: label name `'lf` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:25:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:26:7\n    |\n LL |     { 'lf: loop { break; } }\n    |       --- first declared here\n LL |     { 'lf: for _ in 0..10 { break; } }   //~ WARN label name `'lf` shadows a label name that is already in scope\n    |       ^^^ lifetime 'lf already in scope\n \n warning: label name `'wl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:27:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:28:7\n    |\n LL |     { 'wl: while 2 > 1 { break; } }\n    |       --- first declared here\n LL |     { 'wl: loop { break; } }             //~ WARN label name `'wl` shadows a label name that is already in scope\n    |       ^^^ lifetime 'wl already in scope\n \n warning: label name `'lw` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:29:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:30:7\n    |\n LL |     { 'lw: loop { break; } }\n    |       --- first declared here\n LL |     { 'lw: while 2 > 1 { break; } }      //~ WARN label name `'lw` shadows a label name that is already in scope\n    |       ^^^ lifetime 'lw already in scope\n \n warning: label name `'fw` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:31:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:32:7\n    |\n LL |     { 'fw: for _ in 0..10 { break; } }\n    |       --- first declared here\n LL |     { 'fw: while 2 > 1 { break; } }      //~ WARN label name `'fw` shadows a label name that is already in scope\n    |       ^^^ lifetime 'fw already in scope\n \n warning: label name `'wf` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:33:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:34:7\n    |\n LL |     { 'wf: while 2 > 1 { break; } }\n    |       --- first declared here\n LL |     { 'wf: for _ in 0..10 { break; } }   //~ WARN label name `'wf` shadows a label name that is already in scope\n    |       ^^^ lifetime 'wf already in scope\n \n warning: label name `'tl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:35:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:36:7\n    |\n LL |     { 'tl: while let Some(_) = None::<i32> { break; } }\n    |       --- first declared here\n LL |     { 'tl: loop { break; } }             //~ WARN label name `'tl` shadows a label name that is already in scope\n    |       ^^^ lifetime 'tl already in scope\n \n warning: label name `'lt` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:37:7\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:38:7\n    |\n LL |     { 'lt: loop { break; } }\n    |       --- first declared here\n LL |     { 'lt: while let Some(_) = None::<i32> { break; } }\n    |       ^^^ lifetime 'lt already in scope\n \n error: compilation successful\n-  --> $DIR/loops-reject-duplicate-labels-2.rs:42:1\n+  --> $DIR/loops-reject-duplicate-labels-2.rs:43:1\n    |\n LL | / pub fn main() { //~ ERROR compilation successful\n LL | |     foo();"}, {"sha": "ad24f69871c85cdf3bd4e1076d4e4a4dac401695", "filename": "src/test/ui/loops-reject-duplicate-labels.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -15,6 +15,7 @@\n // Issue #21633: reject duplicate loop labels in function bodies.\n // This is testing the exact cases that are in the issue description.\n \n+#[allow(unused_labels)]\n fn foo() {\n     'fl: for _ in 0..10 { break; }\n     'fl: loop { break; }           //~ WARN label name `'fl` shadows a label name that is already in scope"}, {"sha": "d0cb81544f8280840c91e866b01c3bc00f7af807", "filename": "src/test/ui/loops-reject-duplicate-labels.stderr", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Floops-reject-duplicate-labels.stderr?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -1,69 +1,69 @@\n warning: label name `'fl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:20:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:21:5\n    |\n LL |     'fl: for _ in 0..10 { break; }\n    |     --- first declared here\n LL |     'fl: loop { break; }           //~ WARN label name `'fl` shadows a label name that is already in scope\n    |     ^^^ lifetime 'fl already in scope\n \n warning: label name `'lf` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:23:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:24:5\n    |\n LL |     'lf: loop { break; }\n    |     --- first declared here\n LL |     'lf: for _ in 0..10 { break; } //~ WARN label name `'lf` shadows a label name that is already in scope\n    |     ^^^ lifetime 'lf already in scope\n \n warning: label name `'wl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:25:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:26:5\n    |\n LL |     'wl: while 2 > 1 { break; }\n    |     --- first declared here\n LL |     'wl: loop { break; }           //~ WARN label name `'wl` shadows a label name that is already in scope\n    |     ^^^ lifetime 'wl already in scope\n \n warning: label name `'lw` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:27:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:28:5\n    |\n LL |     'lw: loop { break; }\n    |     --- first declared here\n LL |     'lw: while 2 > 1 { break; }    //~ WARN label name `'lw` shadows a label name that is already in scope\n    |     ^^^ lifetime 'lw already in scope\n \n warning: label name `'fw` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:29:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:30:5\n    |\n LL |     'fw: for _ in 0..10 { break; }\n    |     --- first declared here\n LL |     'fw: while 2 > 1 { break; }    //~ WARN label name `'fw` shadows a label name that is already in scope\n    |     ^^^ lifetime 'fw already in scope\n \n warning: label name `'wf` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:31:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:32:5\n    |\n LL |     'wf: while 2 > 1 { break; }\n    |     --- first declared here\n LL |     'wf: for _ in 0..10 { break; } //~ WARN label name `'wf` shadows a label name that is already in scope\n    |     ^^^ lifetime 'wf already in scope\n \n warning: label name `'tl` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:33:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:34:5\n    |\n LL |     'tl: while let Some(_) = None::<i32> { break; }\n    |     --- first declared here\n LL |     'tl: loop { break; }           //~ WARN label name `'tl` shadows a label name that is already in scope\n    |     ^^^ lifetime 'tl already in scope\n \n warning: label name `'lt` shadows a label name that is already in scope\n-  --> $DIR/loops-reject-duplicate-labels.rs:35:5\n+  --> $DIR/loops-reject-duplicate-labels.rs:36:5\n    |\n LL |     'lt: loop { break; }\n    |     --- first declared here\n LL |     'lt: while let Some(_) = None::<i32> { break; }\n    |     ^^^ lifetime 'lt already in scope\n \n error: compilation successful\n-  --> $DIR/loops-reject-duplicate-labels.rs:49:1\n+  --> $DIR/loops-reject-duplicate-labels.rs:50:1\n    |\n LL | / pub fn main() { //~ ERROR compilation successful\n LL | |     let s = S;"}, {"sha": "9fb519c57edf35dbfade0332a3fa1fe5eb2d8b05", "filename": "src/test/ui/suggestions/suggest-labels.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-labels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b240dad0648dc45e50fd0421a29390343ad5808/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-labels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-labels.rs?ref=1b240dad0648dc45e50fd0421a29390343ad5808", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#[allow(unreachable_code)]\n+#[allow(unreachable_code, unused_labels)]\n fn main() {\n     'foo: loop {\n         break 'fo; //~ ERROR use of undeclared label"}]}