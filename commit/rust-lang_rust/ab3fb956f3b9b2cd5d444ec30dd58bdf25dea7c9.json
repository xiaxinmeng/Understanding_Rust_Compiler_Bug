{"sha": "ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiM2ZiOTU2ZjNiOWIyY2Q1ZDQ0NGVjMzBkZDU4YmRmMjVkZWE3Yzk=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-08-02T01:22:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-08-02T01:22:26Z"}, "message": "Rollup merge of #43389 - alexcrichton:thread-error, r=michaelwoerister\n\nThread through the original error when opening archives\n\nThis updates the management of opening archives to thread through the original\npiece of error information from LLVM over to the end consumer, trans.", "tree": {"sha": "049ac4995acaa398d0a87ca8c42c2f3ef5869714", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/049ac4995acaa398d0a87ca8c42c2f3ef5869714"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "html_url": "https://github.com/rust-lang/rust/commit/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "640cfc852ae17d51a2f5e75fcae9a93431a3b38c", "url": "https://api.github.com/repos/rust-lang/rust/commits/640cfc852ae17d51a2f5e75fcae9a93431a3b38c", "html_url": "https://github.com/rust-lang/rust/commit/640cfc852ae17d51a2f5e75fcae9a93431a3b38c"}, {"sha": "81eea9e4312253afb655c051d0bf0661744ab56e", "url": "https://api.github.com/repos/rust-lang/rust/commits/81eea9e4312253afb655c051d0bf0661744ab56e", "html_url": "https://github.com/rust-lang/rust/commit/81eea9e4312253afb655c051d0bf0661744ab56e"}], "stats": {"total": 29, "additions": 14, "deletions": 15}, "files": [{"sha": "0b24e55541b07269f52f3f41d5e924c834d6cb74", "filename": "src/librustc_llvm/archive_ro.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_llvm%2Farchive_ro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_llvm%2Farchive_ro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Farchive_ro.rs?ref=ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "patch": "@@ -39,14 +39,14 @@ impl ArchiveRO {\n     ///\n     /// If this archive is used with a mutable method, then an error will be\n     /// raised.\n-    pub fn open(dst: &Path) -> Option<ArchiveRO> {\n+    pub fn open(dst: &Path) -> Result<ArchiveRO, String> {\n         return unsafe {\n             let s = path2cstr(dst);\n             let ar = ::LLVMRustOpenArchive(s.as_ptr());\n             if ar.is_null() {\n-                None\n+                Err(::last_error().unwrap_or(\"failed to open archive\".to_string()))\n             } else {\n-                Some(ArchiveRO { ptr: ar })\n+                Ok(ArchiveRO { ptr: ar })\n             }\n         };\n "}, {"sha": "6ec40bd689c23eb963a6ee93679d0d710a2d5c33", "filename": "src/librustc_trans/back/archive.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_trans%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_trans%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Farchive.rs?ref=ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "patch": "@@ -126,7 +126,7 @@ impl<'a> ArchiveBuilder<'a> {\n             Some(ref src) => src,\n             None => return None,\n         };\n-        self.src_archive = Some(ArchiveRO::open(src));\n+        self.src_archive = Some(ArchiveRO::open(src).ok());\n         self.src_archive.as_ref().unwrap().as_ref()\n     }\n \n@@ -186,9 +186,8 @@ impl<'a> ArchiveBuilder<'a> {\n         where F: FnMut(&str) -> bool + 'static\n     {\n         let archive = match ArchiveRO::open(archive) {\n-            Some(ar) => ar,\n-            None => return Err(io::Error::new(io::ErrorKind::Other,\n-                                              \"failed to open archive\")),\n+            Ok(ar) => ar,\n+            Err(e) => return Err(io::Error::new(io::ErrorKind::Other, e)),\n         };\n         self.additions.push(Addition::Archive {\n             archive: archive,"}, {"sha": "883808c59091a02d60e45f7308fc41af46d6ce08", "filename": "src/librustc_trans/metadata.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_trans%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9/src%2Flibrustc_trans%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fmetadata.rs?ref=ab3fb956f3b9b2cd5d444ec30dd58bdf25dea7c9", "patch": "@@ -31,21 +31,21 @@ impl MetadataLoader for LlvmMetadataLoader {\n         // just keeping the archive along while the metadata is in use.\n         let archive = ArchiveRO::open(filename)\n             .map(|ar| OwningRef::new(box ar))\n-            .ok_or_else(|| {\n-                            debug!(\"llvm didn't like `{}`\", filename.display());\n-                            format!(\"failed to read rlib metadata: '{}'\", filename.display())\n-                        })?;\n+            .map_err(|e| {\n+                debug!(\"llvm didn't like `{}`: {}\", filename.display(), e);\n+                format!(\"failed to read rlib metadata in '{}': {}\", filename.display(), e)\n+            })?;\n         let buf: OwningRef<_, [u8]> = archive\n             .try_map(|ar| {\n                 ar.iter()\n                     .filter_map(|s| s.ok())\n                     .find(|sect| sect.name() == Some(METADATA_FILENAME))\n                     .map(|s| s.data())\n                     .ok_or_else(|| {\n-                                    debug!(\"didn't find '{}' in the archive\", METADATA_FILENAME);\n-                                    format!(\"failed to read rlib metadata: '{}'\",\n-                                            filename.display())\n-                                })\n+                        debug!(\"didn't find '{}' in the archive\", METADATA_FILENAME);\n+                        format!(\"failed to read rlib metadata: '{}'\",\n+                                filename.display())\n+                    })\n             })?;\n         Ok(buf.erase_owner())\n     }"}]}