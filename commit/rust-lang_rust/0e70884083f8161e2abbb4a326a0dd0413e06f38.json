{"sha": "0e70884083f8161e2abbb4a326a0dd0413e06f38", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlNzA4ODQwODNmODE2MWUyYWJiYjRhMzI2YTBkZDA0MTNlMDZmMzg=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-17T00:08:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-17T00:08:59Z"}, "message": "Rollup merge of #74351 - lzutao:remove-rustc-internal-compiler-warns, r=Mark-Simulacrum\n\nDo not render unstable items for rustc doc\n\nSee the zulip conversion: https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/rustc.20doc.3A.20.22internal.20compiler.20API.22.20warns.20are.20everywhere!/near/203850782\n\nBefore:\n![image](https://user-images.githubusercontent.com/15225902/87501971-9cff8780-c68a-11ea-93b4-ea53ce18a77b.png)\nAfter:\n![image](https://user-images.githubusercontent.com/15225902/87501985-a7218600-c68a-11ea-81c0-a6b5b120832c.png)\n\nNothing changes in unstable items of std:\nBefore:\n![image](https://user-images.githubusercontent.com/15225902/87502004-b7d1fc00-c68a-11ea-9224-a27a1d2a81d6.png)\nAfter:\n![image](https://user-images.githubusercontent.com/15225902/87502018-c0c2cd80-c68a-11ea-9773-4c63158025cb.png)\n\nCloses  #54682", "tree": {"sha": "04f327fdb1b1a01f3ce085950e5407de1c0678ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04f327fdb1b1a01f3ce085950e5407de1c0678ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e70884083f8161e2abbb4a326a0dd0413e06f38", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfEOwbCRBK7hj4Ov3rIwAAdHIIABjdepu2TbY3VenlCsjQ9ZGB\n+XEIAwHxuVlgUBHadLhw2NjBOK/LWLzdMUa0A9rbMcydzFpF/9NTD/izYt66XMYX\nZd95xcW3HBVt/looMPbLborytEbaxSmTGGLoBA1OGsmdjaRVIz/bv9Zs0tT3MwUA\n919eGBg5sB6cwsVbpHxTKXdztGu4UgNmEWNUgDiMJfQVJRpQ2RC5z5r8d65ykUHX\np5NtXmj1tE4O6TotC4gJD9EQs7Bjnv2+aKbTDWo02NPudZqePejgi75P9LD5pJsx\nUImpFd1TYlgesgJrsHrv4BXHJTkDAnNeQN4HBOq3qscx1OeGrIxq+68YB69QQfI=\n=jmAS\n-----END PGP SIGNATURE-----\n", "payload": "tree 04f327fdb1b1a01f3ce085950e5407de1c0678ef\nparent 5751c7f1db9aced9aae5a1327fcdf67438aad59e\nparent 47fea961ba2cada1ca9a28f971cbe79ec525697e\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594944539 -0700\ncommitter GitHub <noreply@github.com> 1594944539 -0700\n\nRollup merge of #74351 - lzutao:remove-rustc-internal-compiler-warns, r=Mark-Simulacrum\n\nDo not render unstable items for rustc doc\n\nSee the zulip conversion: https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/rustc.20doc.3A.20.22internal.20compiler.20API.22.20warns.20are.20everywhere!/near/203850782\n\nBefore:\n![image](https://user-images.githubusercontent.com/15225902/87501971-9cff8780-c68a-11ea-93b4-ea53ce18a77b.png)\nAfter:\n![image](https://user-images.githubusercontent.com/15225902/87501985-a7218600-c68a-11ea-81c0-a6b5b120832c.png)\n\nNothing changes in unstable items of std:\nBefore:\n![image](https://user-images.githubusercontent.com/15225902/87502004-b7d1fc00-c68a-11ea-9224-a27a1d2a81d6.png)\nAfter:\n![image](https://user-images.githubusercontent.com/15225902/87502018-c0c2cd80-c68a-11ea-9773-4c63158025cb.png)\n\nCloses  #54682\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e70884083f8161e2abbb4a326a0dd0413e06f38", "html_url": "https://github.com/rust-lang/rust/commit/0e70884083f8161e2abbb4a326a0dd0413e06f38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e70884083f8161e2abbb4a326a0dd0413e06f38/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5751c7f1db9aced9aae5a1327fcdf67438aad59e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5751c7f1db9aced9aae5a1327fcdf67438aad59e", "html_url": "https://github.com/rust-lang/rust/commit/5751c7f1db9aced9aae5a1327fcdf67438aad59e"}, {"sha": "47fea961ba2cada1ca9a28f971cbe79ec525697e", "url": "https://api.github.com/repos/rust-lang/rust/commits/47fea961ba2cada1ca9a28f971cbe79ec525697e", "html_url": "https://github.com/rust-lang/rust/commit/47fea961ba2cada1ca9a28f971cbe79ec525697e"}], "stats": {"total": 71, "additions": 23, "deletions": 48}, "files": [{"sha": "f872ed7010c7537ad3aae0cdec855f2e6a771213", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 17, "deletions": 28, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=0e70884083f8161e2abbb4a326a0dd0413e06f38", "patch": "@@ -2230,12 +2230,15 @@ fn stability_tags(item: &clean::Item) -> String {\n         tags += &tag_html(\"deprecated\", message);\n     }\n \n-    if let Some(stab) = item.stability.as_ref().filter(|s| s.level == stability::Unstable) {\n-        if stab.feature.as_deref() == Some(\"rustc_private\") {\n-            tags += &tag_html(\"internal\", \"Internal\");\n-        } else {\n-            tags += &tag_html(\"unstable\", \"Experimental\");\n-        }\n+    // The \"rustc_private\" crates are permanently unstable so it makes no sense\n+    // to render \"unstable\" everywhere.\n+    if item\n+        .stability\n+        .as_ref()\n+        .map(|s| s.level == stability::Unstable && s.feature.as_deref() != Some(\"rustc_private\"))\n+        == Some(true)\n+    {\n+        tags += &tag_html(\"unstable\", \"Experimental\");\n     }\n \n     if let Some(ref cfg) = item.attrs.cfg {\n@@ -2286,15 +2289,13 @@ fn short_stability(item: &clean::Item, cx: &Context) -> Vec<String> {\n         ));\n     }\n \n-    if let Some(stab) = item.stability.as_ref().filter(|stab| stab.level == stability::Unstable) {\n-        let is_rustc_private = stab.feature.as_deref() == Some(\"rustc_private\");\n-\n-        let mut message = if is_rustc_private {\n-            \"<span class='emoji'>\u2699\ufe0f</span> This is an internal compiler API.\"\n-        } else {\n-            \"<span class='emoji'>\ud83d\udd2c</span> This is a nightly-only experimental API.\"\n-        }\n-        .to_owned();\n+    // Render unstable items. But don't render \"rustc_private\" crates (internal compiler crates).\n+    // Those crates are permanently unstable so it makes no sense to render \"unstable\" everywhere.\n+    if let Some(stab) = item.stability.as_ref().filter(|stab| {\n+        stab.level == stability::Unstable && stab.feature.as_deref() != Some(\"rustc_private\")\n+    }) {\n+        let mut message =\n+            \"<span class='emoji'>\ud83d\udd2c</span> This is a nightly-only experimental API.\".to_owned();\n \n         if let Some(feature) = stab.feature.as_deref() {\n             let mut feature = format!(\"<code>{}</code>\", Escape(&feature));\n@@ -2310,17 +2311,6 @@ fn short_stability(item: &clean::Item, cx: &Context) -> Vec<String> {\n         }\n \n         if let Some(unstable_reason) = &stab.unstable_reason {\n-            // Provide a more informative message than the compiler help.\n-            let unstable_reason = if is_rustc_private {\n-                \"This crate is being loaded from the sysroot, a permanently unstable location \\\n-                for private compiler dependencies. It is not intended for general use. Prefer \\\n-                using a public version of this crate from \\\n-                [crates.io](https://crates.io) via [`Cargo.toml`]\\\n-                (https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html).\"\n-            } else {\n-                unstable_reason\n-            };\n-\n             let mut ids = cx.id_map.borrow_mut();\n             message = format!(\n                 \"<details><summary>{}</summary>{}</details>\",\n@@ -2336,8 +2326,7 @@ fn short_stability(item: &clean::Item, cx: &Context) -> Vec<String> {\n             );\n         }\n \n-        let class = if is_rustc_private { \"internal\" } else { \"unstable\" };\n-        stability.push(format!(\"<div class='stab {}'>{}</div>\", class, message));\n+        stability.push(format!(\"<div class='stab unstable'>{}</div>\", message));\n     }\n \n     if let Some(ref cfg) = item.attrs.cfg {"}, {"sha": "382c0f417aed27398dc96719f2ee5ec4b1fda84e", "filename": "src/librustdoc/html/static/themes/ayu.css", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css?ref=0e70884083f8161e2abbb4a326a0dd0413e06f38", "patch": "@@ -216,10 +216,6 @@ a {\n \tcolor: #39AFD7;\n }\n \n-.stab.internal a {\n-\tcolor: #304FFE;\n-}\n-\n .collapse-toggle {\n \tcolor: #999;\n }\n@@ -254,7 +250,6 @@ a {\n }\n \n .stab.unstable,\n-.stab.internal,\n .stab.deprecated,\n .stab.portability {\n     color: #c5c5c5;\n@@ -462,7 +457,6 @@ pre.rust .doccomment {}\n .content .highlighted.type {}\n pre.rust .kw-2,pre.rust .prelude-ty {}\n .content span.trait,.content a.trait,.block a.current.trait {}\n-.stab.internal {}\n \n @media (max-width: 700px) {\n \t.sidebar-menu {"}, {"sha": "dc15220aa0690b6572c3f724a0247ca1e733b209", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=0e70884083f8161e2abbb4a326a0dd0413e06f38", "patch": "@@ -172,10 +172,6 @@ a {\n \tcolor: #D2991D;\n }\n \n-.stab.internal a {\n-\tcolor: #304FFE;\n-}\n-\n a.test-arrow {\n \tcolor: #dedede;\n }\n@@ -214,7 +210,6 @@ a.test-arrow {\n }\n \n .stab.unstable { background: #FFF5D6; border-color: #FFC600; color: #2f2f2f; }\n-.stab.internal { background: #FFB9B3; border-color: #B71C1C; color: #2f2f2f; }\n .stab.deprecated { background: #F3DFFF; border-color: #7F0087; color: #2f2f2f; }\n .stab.portability { background: #C4ECFF; border-color: #7BA5DB; color: #2f2f2f; }\n "}, {"sha": "64d59ca411a87eafb543407319c3fbdad6081a4a", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=0e70884083f8161e2abbb4a326a0dd0413e06f38", "patch": "@@ -173,10 +173,6 @@ a {\n \tcolor: #3873AD;\n }\n \n-.stab.internal a {\n-\tcolor: #304FFE;\n-}\n-\n a.test-arrow {\n \tcolor: #f5f5f5;\n }\n@@ -215,7 +211,6 @@ a.test-arrow {\n }\n \n .stab.unstable { background: #FFF5D6; border-color: #FFC600; }\n-.stab.internal { background: #FFB9B3; border-color: #B71C1C; }\n .stab.deprecated { background: #F3DFFF; border-color: #7F0087; }\n .stab.portability { background: #C4ECFF; border-color: #7BA5DB; }\n "}, {"sha": "a1e322fb9a30704e45e120048864fd263fc8b8ae", "filename": "src/test/rustdoc/internal.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Ftest%2Frustdoc%2Finternal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e70884083f8161e2abbb4a326a0dd0413e06f38/src%2Ftest%2Frustdoc%2Finternal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Finternal.rs?ref=0e70884083f8161e2abbb4a326a0dd0413e06f38", "patch": "@@ -1,11 +1,13 @@\n // compile-flags: -Z force-unstable-if-unmarked\n \n-// @matches internal/index.html '//*[@class=\"docblock-short\"]/span[@class=\"stab internal\"]' \\\n-//      'Internal'\n+// Check that the unstable marker is not added for \"rustc_private\".\n+\n+// @!matches internal/index.html '//*[@class=\"docblock-short\"]/span[@class=\"stab unstable\"]'\n+// @!matches internal/index.html '//*[@class=\"docblock-short\"]/span[@class=\"stab internal\"]'\n // @matches - '//*[@class=\"docblock-short\"]' 'Docs'\n \n-// @has internal/struct.S.html '//*[@class=\"stab internal\"]' \\\n-//      'This is an internal compiler API. (rustc_private)'\n+// @!has internal/struct.S.html '//*[@class=\"stab unstable\"]'\n+// @!has internal/struct.S.html '//*[@class=\"stab internal\"]'\n /// Docs\n pub struct S;\n "}]}