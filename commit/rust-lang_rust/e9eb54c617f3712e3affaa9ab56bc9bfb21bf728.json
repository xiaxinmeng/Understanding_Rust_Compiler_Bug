{"sha": "e9eb54c617f3712e3affaa9ab56bc9bfb21bf728", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5ZWI1NGM2MTdmMzcxMmUzYWZmYWE5YWI1NmJjOWJmYjIxYmY3Mjg=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-13T16:55:10Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-06-13T17:05:46Z"}, "message": "Fix `rewrite_root` when there's only 1 replacement", "tree": {"sha": "441fcfc6af48d6fd526f62ed79c48bf6c970d68b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/441fcfc6af48d6fd526f62ed79c48bf6c970d68b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728", "html_url": "https://github.com/rust-lang/rust/commit/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "246c66a7f7fd3f85d7d6e47a36f17bafb0ccb08a", "url": "https://api.github.com/repos/rust-lang/rust/commits/246c66a7f7fd3f85d7d6e47a36f17bafb0ccb08a", "html_url": "https://github.com/rust-lang/rust/commit/246c66a7f7fd3f85d7d6e47a36f17bafb0ccb08a"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "f7a885eb3eb17aaf7ab7e3946adc86a9ef060be8", "filename": "crates/ra_syntax/src/algo.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728/crates%2Fra_syntax%2Fsrc%2Falgo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9eb54c617f3712e3affaa9ab56bc9bfb21bf728/crates%2Fra_syntax%2Fsrc%2Falgo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Falgo.rs?ref=e9eb54c617f3712e3affaa9ab56bc9bfb21bf728", "patch": "@@ -290,6 +290,11 @@ impl<'a> SyntaxRewriter<'a> {\n         N::cast(self.rewrite(node.syntax())).unwrap()\n     }\n \n+    /// Returns a node that encompasses all replacements to be done by this rewriter.\n+    ///\n+    /// Passing the returned node to `rewrite` will apply all replacements queued up in `self`.\n+    ///\n+    /// Returns `None` when there are no replacements.\n     pub fn rewrite_root(&self) -> Option<SyntaxNode> {\n         assert!(self.f.is_none());\n         self.replacements\n@@ -298,6 +303,9 @@ impl<'a> SyntaxRewriter<'a> {\n                 SyntaxElement::Node(it) => it.clone(),\n                 SyntaxElement::Token(it) => it.parent(),\n             })\n+            // If we only have one replacement, we must return its parent node, since `rewrite` does\n+            // not replace the node passed to it.\n+            .map(|it| it.parent().unwrap_or(it))\n             .fold1(|a, b| least_common_ancestor(&a, &b).unwrap())\n     }\n "}]}