{"sha": "49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5ZWZhYjhhYzkwNDRlMmNiOGVhMzFhYzE2ZmEwODhhZjg4ZmFmNGQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-06T23:45:21Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-06T23:45:21Z"}, "message": "rustc: Fix enum variant privacy across crates\n\nThe code in resolve erroneously assumed that private enums weren't visited, so\nthe logic was adjusted to check to see if the enum definition itself was public.\n\nCloses #11680", "tree": {"sha": "18ac9280a00c938c88615ed38d33232511a44d6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18ac9280a00c938c88615ed38d33232511a44d6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "html_url": "https://github.com/rust-lang/rust/commit/49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf6857b9e9427f14d383ae2924555bedc251fa02", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf6857b9e9427f14d383ae2924555bedc251fa02", "html_url": "https://github.com/rust-lang/rust/commit/cf6857b9e9427f14d383ae2924555bedc251fa02"}], "stats": {"total": 54, "additions": 48, "deletions": 6}, "files": [{"sha": "27373ce045def259c06df8967a3b9be49a2ee0c3", "filename": "src/librustc/middle/resolve.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve.rs?ref=49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "patch": "@@ -1620,18 +1620,20 @@ impl<'a> Resolver<'a> {\n \n         match def {\n           DefMod(_) | DefForeignMod(_) => {}\n-          DefVariant(_, variant_id, is_struct) => {\n+          DefVariant(enum_did, variant_id, is_struct) => {\n             debug!(\"(building reduced graph for external crate) building \\\n                     variant {}\",\n                    final_ident);\n-            // We assume the parent is visible, or else we wouldn't have seen\n-            // it. Also variants are public-by-default if the parent was also\n-            // public.\n+            // If this variant is public, then it was publicly reexported,\n+            // otherwise we need to inherit the visibility of the enum\n+            // definition.\n+            let is_exported = is_public ||\n+                              self.external_exports.contains(&enum_did);\n             if is_struct {\n-                child_name_bindings.define_type(def, DUMMY_SP, true);\n+                child_name_bindings.define_type(def, DUMMY_SP, is_exported);\n                 self.structs.insert(variant_id);\n             } else {\n-                child_name_bindings.define_value(def, DUMMY_SP, true);\n+                child_name_bindings.define_value(def, DUMMY_SP, is_exported);\n             }\n           }\n           DefFn(..) | DefStaticMethod(..) | DefStatic(..) => {"}, {"sha": "249a1bab465e9b341fbd2c4fe422822b259c13c8", "filename": "src/test/auxiliary/issue-11680.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Ftest%2Fauxiliary%2Fissue-11680.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Ftest%2Fauxiliary%2Fissue-11680.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fissue-11680.rs?ref=49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+enum Foo {\n+    Bar(int)\n+}\n+\n+pub mod test {\n+    enum Foo {\n+        Bar(int)\n+    }\n+}"}, {"sha": "9c9663a2f38c32fe2333f0acedac7f5dfe983f54", "filename": "src/test/compile-fail/issue-11680.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Ftest%2Fcompile-fail%2Fissue-11680.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49efab8ac9044e2cb8ea31ac16fa088af88faf4d/src%2Ftest%2Fcompile-fail%2Fissue-11680.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-11680.rs?ref=49efab8ac9044e2cb8ea31ac16fa088af88faf4d", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:issue-11680.rs\n+\n+extern crate other = \"issue-11680\";\n+\n+fn main() {\n+    let _b = other::Bar(1);\n+    //~^ ERROR: variant `Bar` is private\n+\n+    let _b = other::test::Bar(1);\n+    //~^ ERROR: variant `Bar` is private\n+}"}]}