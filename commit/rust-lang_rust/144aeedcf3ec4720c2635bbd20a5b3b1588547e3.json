{"sha": "144aeedcf3ec4720c2635bbd20a5b3b1588547e3", "node_id": "C_kwDOAAsO6NoAKDE0NGFlZWRjZjNlYzQ3MjBjMjYzNWJiZDIwYTViM2IxNTg4NTQ3ZTM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-24T11:29:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-24T11:29:51Z"}, "message": "Rollup merge of #93152 - ivmarkov:master, r=m-ou-se\n\nFix STD compilation for the ESP-IDF target (regression from CVE-2022-21658)\n\nCommit https://github.com/rust-lang/rust/commit/54e22eb7dbb615bd44355028d3fd867aa93c0972 broke the compilation of STD for the ESP-IDF embedded \"unix-like\" Tier 3 target, because the fix for [CVE-2022-21658](https://blog.rust-lang.org/2022/01/20/Rust-1.58.1.html) uses [libc flags](https://github.com/esp-rs/esp-idf-svc/runs/4892221554?check_suite_focus=true) which are not supported on the ESP-IDF platform.\n\nThis PR simply redirects the ESP-IDF compilation to the \"classic\" implementation, similar to REDOX. This should be safe because:\n* Neither of the two filesystems supported by ESP-IDF (spiffs and fatfs) support [symlinks](https://github.com/natevw/fatfs/blob/master/README.md) in the first place\n* There is no notion of fs permissions at all, as the ESP-IDF is an embedded platform that does not have the notion of users, groups, etc.\n* Similarly, ESP-IDF has just one \"process\" - the firmware itself - which contains the user code and the \"OS\" fused together and running with all permissions", "tree": {"sha": "df469222d15fa329a8bc33eb4dc452e784c0eeca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df469222d15fa329a8bc33eb4dc452e784c0eeca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/144aeedcf3ec4720c2635bbd20a5b3b1588547e3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh7o2vCRBK7hj4Ov3rIwAAsxwIAGtAoDjUt+6Hwu0NVeGhKmi7\niS+Rv0A0EiEjQCyynXRCj6KeBe2TZjSzhhneV6ECNXwac5VB9UeVWm9IZkF6bLBi\nK4iG/VMtRflyWJ9jNZowiSIeOR5aHZ2s5NHKl8FVAkuGwzTyv7rcuNVn3XJ1kCiN\n8kXqCFvqebkIsGx6Bn1P5K41aiigWc6a5zVFN2FQvtwm4ad0w82uPQIJwHtRKVll\nHdEts6Xek8GU3iPf7YBD8zEC0gJ2dQ23+2v8Z0NAX6vZxp3QMLIeshF3AW1a3VUg\nZdNOHMuLISG2EGYG+KjY0ikdfnhsjnTkmvE1LdBb/bWL70qpxOid3MuU5sXdeVU=\n=D685\n-----END PGP SIGNATURE-----\n", "payload": "tree df469222d15fa329a8bc33eb4dc452e784c0eeca\nparent b92a1e9c20327c26097a7ddf55a022d2ea58fbf5\nparent 495c7b31aaef783c583d2a0304002367df0a1474\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1643023791 +0100\ncommitter GitHub <noreply@github.com> 1643023791 +0100\n\nRollup merge of #93152 - ivmarkov:master, r=m-ou-se\n\nFix STD compilation for the ESP-IDF target (regression from CVE-2022-21658)\n\nCommit https://github.com/rust-lang/rust/commit/54e22eb7dbb615bd44355028d3fd867aa93c0972 broke the compilation of STD for the ESP-IDF embedded \"unix-like\" Tier 3 target, because the fix for [CVE-2022-21658](https://blog.rust-lang.org/2022/01/20/Rust-1.58.1.html) uses [libc flags](https://github.com/esp-rs/esp-idf-svc/runs/4892221554?check_suite_focus=true) which are not supported on the ESP-IDF platform.\n\nThis PR simply redirects the ESP-IDF compilation to the \"classic\" implementation, similar to REDOX. This should be safe because:\n* Neither of the two filesystems supported by ESP-IDF (spiffs and fatfs) support [symlinks](https://github.com/natevw/fatfs/blob/master/README.md) in the first place\n* There is no notion of fs permissions at all, as the ESP-IDF is an embedded platform that does not have the notion of users, groups, etc.\n* Similarly, ESP-IDF has just one \"process\" - the firmware itself - which contains the user code and the \"OS\" fused together and running with all permissions\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/144aeedcf3ec4720c2635bbd20a5b3b1588547e3", "html_url": "https://github.com/rust-lang/rust/commit/144aeedcf3ec4720c2635bbd20a5b3b1588547e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/144aeedcf3ec4720c2635bbd20a5b3b1588547e3/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b92a1e9c20327c26097a7ddf55a022d2ea58fbf5", "url": "https://api.github.com/repos/rust-lang/rust/commits/b92a1e9c20327c26097a7ddf55a022d2ea58fbf5", "html_url": "https://github.com/rust-lang/rust/commit/b92a1e9c20327c26097a7ddf55a022d2ea58fbf5"}, {"sha": "495c7b31aaef783c583d2a0304002367df0a1474", "url": "https://api.github.com/repos/rust-lang/rust/commits/495c7b31aaef783c583d2a0304002367df0a1474", "html_url": "https://github.com/rust-lang/rust/commit/495c7b31aaef783c583d2a0304002367df0a1474"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "ad656582a0970058f45a86a99c9b121a84d2a2dd", "filename": "library/std/src/sys/unix/fs.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/144aeedcf3ec4720c2635bbd20a5b3b1588547e3/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/144aeedcf3ec4720c2635bbd20a5b3b1588547e3/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs?ref=144aeedcf3ec4720c2635bbd20a5b3b1588547e3", "patch": "@@ -1448,8 +1448,8 @@ pub fn chroot(dir: &Path) -> io::Result<()> {\n \n pub use remove_dir_impl::remove_dir_all;\n \n-// Fallback for REDOX\n-#[cfg(target_os = \"redox\")]\n+// Fallback for REDOX and ESP-IDF\n+#[cfg(any(target_os = \"redox\", target_os = \"espidf\"))]\n mod remove_dir_impl {\n     pub use crate::sys_common::fs::remove_dir_all;\n }\n@@ -1573,7 +1573,11 @@ mod remove_dir_impl {\n }\n \n // Modern implementation using openat(), unlinkat() and fdopendir()\n-#[cfg(not(any(all(target_os = \"macos\", target_arch = \"x86_64\"), target_os = \"redox\")))]\n+#[cfg(not(any(\n+    all(target_os = \"macos\", target_arch = \"x86_64\"),\n+    target_os = \"redox\",\n+    target_os = \"espidf\"\n+)))]\n mod remove_dir_impl {\n     use super::{cstr, lstat, Dir, DirEntry, InnerReadDir, ReadDir};\n     use crate::ffi::CStr;"}]}