{"sha": "1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkZjJlMzgyMTlhNzk1MTdiYzRjOGNiYTQ3YmMxYTZkZWMyMDFlYjU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-13T16:47:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-13T16:47:33Z"}, "message": "Auto merge of #6443 - matthiaskrgr:clone_on_copy_type, r=ebroto\n\nclone_on_copy: show the type in the lint message\n\nchangelog: clone_on_copy: show the type in the lint message", "tree": {"sha": "3fa9e0aaed9302a91abd39a77a9c4792b199f9b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3fa9e0aaed9302a91abd39a77a9c4792b199f9b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "html_url": "https://github.com/rust-lang/rust/commit/1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "684f17e565594c8451ee588d77a3289dcc816a8a", "url": "https://api.github.com/repos/rust-lang/rust/commits/684f17e565594c8451ee588d77a3289dcc816a8a", "html_url": "https://github.com/rust-lang/rust/commit/684f17e565594c8451ee588d77a3289dcc816a8a"}, {"sha": "b2cb6ffbe3735ef8f137c9a6c1290c4a078793ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2cb6ffbe3735ef8f137c9a6c1290c4a078793ef", "html_url": "https://github.com/rust-lang/rust/commit/b2cb6ffbe3735ef8f137c9a6c1290c4a078793ef"}], "stats": {"total": 32, "additions": 19, "deletions": 13}, "files": [{"sha": "6a141d777dafa2af796a8c63808125d1f1ab6636", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "patch": "@@ -2177,11 +2177,17 @@ fn lint_clone_on_copy(cx: &LateContext<'_>, expr: &hir::Expr<'_>, arg: &hir::Exp\n         } else {\n             snip = None;\n         }\n-        span_lint_and_then(cx, CLONE_ON_COPY, expr.span, \"using `clone` on a `Copy` type\", |diag| {\n-            if let Some((text, snip)) = snip {\n-                diag.span_suggestion(expr.span, text, snip, Applicability::MachineApplicable);\n-            }\n-        });\n+        span_lint_and_then(\n+            cx,\n+            CLONE_ON_COPY,\n+            expr.span,\n+            &format!(\"using `clone` on type `{}` which implements the `Copy` trait\", ty),\n+            |diag| {\n+                if let Some((text, snip)) = snip {\n+                    diag.span_suggestion(expr.span, text, snip, Applicability::MachineApplicable);\n+                }\n+            },\n+        );\n     }\n }\n "}, {"sha": "14a700886a7bc1a4171bea3873ae0c053c9847aa", "filename": "tests/ui/clone_on_copy.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/tests%2Fui%2Fclone_on_copy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/tests%2Fui%2Fclone_on_copy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.stderr?ref=1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "patch": "@@ -1,30 +1,30 @@\n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `i32` which implements the `Copy` trait\n   --> $DIR/clone_on_copy.rs:22:5\n    |\n LL |     42.clone();\n    |     ^^^^^^^^^^ help: try removing the `clone` call: `42`\n    |\n    = note: `-D clippy::clone-on-copy` implied by `-D warnings`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `i32` which implements the `Copy` trait\n   --> $DIR/clone_on_copy.rs:26:5\n    |\n LL |     (&42).clone();\n    |     ^^^^^^^^^^^^^ help: try dereferencing it: `*(&42)`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `i32` which implements the `Copy` trait\n   --> $DIR/clone_on_copy.rs:29:5\n    |\n LL |     rc.borrow().clone();\n    |     ^^^^^^^^^^^^^^^^^^^ help: try dereferencing it: `*rc.borrow()`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `char` which implements the `Copy` trait\n   --> $DIR/clone_on_copy.rs:35:14\n    |\n LL |     is_ascii('z'.clone());\n    |              ^^^^^^^^^^^ help: try removing the `clone` call: `'z'`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `i32` which implements the `Copy` trait\n   --> $DIR/clone_on_copy.rs:39:14\n    |\n LL |     vec.push(42.clone());"}, {"sha": "9df1ae568673084298ac3c1acb5672c602616a50", "filename": "tests/ui/unnecessary_clone.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/tests%2Fui%2Funnecessary_clone.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1df2e38219a79517bc4c8cba47bc1a6dec201eb5/tests%2Fui%2Funnecessary_clone.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_clone.stderr?ref=1df2e38219a79517bc4c8cba47bc1a6dec201eb5", "patch": "@@ -30,15 +30,15 @@ error: using `.clone()` on a ref-counted pointer\n LL |     let _: Arc<dyn SomeTrait> = x.clone();\n    |                                 ^^^^^^^^^ help: try this: `Arc::<SomeImpl>::clone(&x)`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `T` which implements the `Copy` trait\n   --> $DIR/unnecessary_clone.rs:40:5\n    |\n LL |     t.clone();\n    |     ^^^^^^^^^ help: try removing the `clone` call: `t`\n    |\n    = note: `-D clippy::clone-on-copy` implied by `-D warnings`\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `std::option::Option<T>` which implements the `Copy` trait\n   --> $DIR/unnecessary_clone.rs:42:5\n    |\n LL |     Some(t).clone();\n@@ -60,7 +60,7 @@ help: or try being explicit if you are sure, that you want to clone a reference\n LL |     let z: &Vec<_> = <&std::vec::Vec<i32>>::clone(y);\n    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: using `clone` on a `Copy` type\n+error: using `clone` on type `many_derefs::E` which implements the `Copy` trait\n   --> $DIR/unnecessary_clone.rs:84:20\n    |\n LL |         let _: E = a.clone();"}]}