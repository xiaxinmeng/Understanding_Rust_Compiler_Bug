{"sha": "60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwYzFiYjA1NDY2YTgxN2NjOGJkNDc4MWU4Y2Q0ZDg3ZjQwYjlhZDQ=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2019-04-07T09:11:06Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2019-04-07T09:11:06Z"}, "message": "Fix ICE in suspicious_else_formatting", "tree": {"sha": "fac11060e4c4099b6d26021830c2613b6c85ef8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fac11060e4c4099b6d26021830c2613b6c85ef8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlypvsMACgkQtvoGpuDi\nZlto8xAAprS/HGBHNi0HAE1PkYENqe0Qs1mhqzDBo5qso2cINdzlVkZhQYD+nLWv\nHvTvqy6OoFRT6ImWp+S8Ayneehl4k3c3b05im7aH/lAPSVb43vRZr88tHUw/Xe95\nRq6vGCah7GNO75y/IQ9m0JUy08z+aBIS9Y1ovTdOtEDrL/UrsetnT5xnLPXr1+YO\nNEk57LxUmn8eJYNGQXrGJjvQDZePxsi6T7A9qvfr5nYh+HylDjZeiKWDuzXSbGpt\npEDj/NBQpb1TA90PSL1CuNPxE6VHimS4wZIRUy19S5be9IAB/6QyLKLb91Qo1/Rc\n+VUo/VG07QmLf3u3Jh0q8IUwLSuzf0ALUaO9V6TkKi6dFSiMi6nvazvZt86IewbS\nfpQMvmPfbvlT7nYLjZcKOSEyw/4ux5Bt7viwMoSrXGlvXM8wavGZONZEx6PdAwQt\nvTcFPZX97qbATYhN/4aIh1G2qBuuO68DdiUnuyzUftbWwJb9YApepUhFHag359sw\n09yyFuXKpLowU+lKd+vru+ti06DCI1mCJsxVIfjt49owKq1TTZHeie3K/fU/AUQw\nN6pL4+QJXIMNdQqgskqxPMlUK8g+Aiae6xq50lSE35WjClIkdBIUC6IfNd0t/JZm\n8xBJi1TZjkWLbMu4xvuV4uj3b7e5/JoQJ7DLLJ8C4LzrIlrzaS0=\n=Mxj7\n-----END PGP SIGNATURE-----", "payload": "tree fac11060e4c4099b6d26021830c2613b6c85ef8c\nparent b996fd52ffb8dc4779744cbde57e07e10a677867\nauthor Philipp Hansch <dev@phansch.net> 1554628266 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1554628266 +0200\n\nFix ICE in suspicious_else_formatting\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "html_url": "https://github.com/rust-lang/rust/commit/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b996fd52ffb8dc4779744cbde57e07e10a677867", "url": "https://api.github.com/repos/rust-lang/rust/commits/b996fd52ffb8dc4779744cbde57e07e10a677867", "html_url": "https://github.com/rust-lang/rust/commit/b996fd52ffb8dc4779744cbde57e07e10a677867"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "7c5c1169c4374a508d472e7b993046b2d8b7eabb", "filename": "clippy_lints/src/formatting.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/clippy_lints%2Fsrc%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/clippy_lints%2Fsrc%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformatting.rs?ref=60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::{differing_macro_contexts, in_macro, snippet_opt, span_note_and_lint};\n-use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n+use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass, in_external_macro};\n use rustc::{declare_tool_lint, lint_array};\n use syntax::ast;\n use syntax::ptr::P;\n@@ -149,7 +149,7 @@ fn check_else(cx: &EarlyContext<'_>, expr: &ast::Expr) {\n     if let Some((then, &Some(ref else_))) = unsugar_if(expr) {\n         if (is_block(else_) || unsugar_if(else_).is_some())\n             && !differing_macro_contexts(then.span, else_.span)\n-            && !in_macro(then.span)\n+            && !in_macro(then.span) && !in_external_macro(cx.sess, expr.span)\n         {\n             // workaround for rust-lang/rust#43081\n             if expr.span.lo().0 == 0 && expr.span.hi().0 == 0 {"}, {"sha": "d708e22310915e0c239cdf9bd440d65abd0d217b", "filename": "tests/ui/crashes/auxiliary/proc_macro_crash.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs?ref=60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "patch": "@@ -0,0 +1,34 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![feature(repr128)]\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::{Delimiter, Group, Ident, Span, TokenStream, TokenTree};\n+use std::iter::FromIterator;\n+\n+#[proc_macro]\n+pub fn macro_test(input_stream: TokenStream) -> TokenStream {\n+    let first_token = input_stream.into_iter().next().unwrap();\n+    let span = first_token.span();\n+\n+    TokenStream::from_iter(vec![\n+        TokenTree::Ident(Ident::new(\"fn\", Span::call_site())),\n+        TokenTree::Ident(Ident::new(\"code\", Span::call_site())),\n+        TokenTree::Group(Group::new(Delimiter::Parenthesis, TokenStream::new())),\n+        TokenTree::Group(Group::new(Delimiter::Brace, {\n+            let mut clause = Group::new(Delimiter::Brace, TokenStream::new());\n+            clause.set_span(span);\n+\n+            TokenStream::from_iter(vec![\n+                TokenTree::Ident(Ident::new(\"if\", Span::call_site())),\n+                TokenTree::Ident(Ident::new(\"true\", Span::call_site())),\n+                TokenTree::Group(clause.clone()),\n+                TokenTree::Ident(Ident::new(\"else\", Span::call_site())),\n+                TokenTree::Group(clause.clone()),\n+            ])\n+        })),\n+    ])\n+}"}, {"sha": "74b9c9c86c81cc5372520db1952b9e4449af2015", "filename": "tests/ui/crashes/ice-3741.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/tests%2Fui%2Fcrashes%2Fice-3741.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4/tests%2Fui%2Fcrashes%2Fice-3741.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-3741.rs?ref=60c1bb05466a817cc8bd4781e8cd4d87f40b9ad4", "patch": "@@ -0,0 +1,12 @@\n+// aux-build:proc_macro_crash.rs\n+// run-pass\n+\n+#![feature(proc_macro_hygiene)]\n+#![warn(clippy::suspicious_else_formatting)]\n+\n+extern crate proc_macro_crash;\n+use proc_macro_crash::macro_test;\n+\n+fn main() {\n+    macro_test!(2);\n+}"}]}