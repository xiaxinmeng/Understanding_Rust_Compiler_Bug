{"sha": "d90921a9d87b17df5eeab9e5f18581e8b04a1ba9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5MDkyMWE5ZDg3YjE3ZGY1ZWVhYjllNWYxODU4MWU4YjA0YTFiYTk=", "commit": {"author": {"name": "NODA, Kai", "email": "nodakai@gmail.com", "date": "2014-09-03T11:21:01Z"}, "committer": {"name": "NODA, Kai", "email": "nodakai@gmail.com", "date": "2014-09-03T11:31:46Z"}, "message": "libnative/io/file_unix: remove superfluous retry().\n\nThese syscalls don't return EINTR:\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/fstat.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/mkdir.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/unlink.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/rename.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/rmdir.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/readlink.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/symlink.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/link.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/fstatat.html\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/utime.html", "tree": {"sha": "f951f621e78b5d975c41b22410710ca4f556dfd8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f951f621e78b5d975c41b22410710ca4f556dfd8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9", "html_url": "https://github.com/rust-lang/rust/commit/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9/comments", "author": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7ec95efbb96f8e9bcb8b5e71b5d13803e840dc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7ec95efbb96f8e9bcb8b5e71b5d13803e840dc9", "html_url": "https://github.com/rust-lang/rust/commit/f7ec95efbb96f8e9bcb8b5e71b5d13803e840dc9"}], "stats": {"total": 36, "additions": 12, "deletions": 24}, "files": [{"sha": "136652f3ebfc9e1e0cbc555b13ac812c67d8b3f9", "filename": "src/libnative/io/file_unix.rs", "status": "modified", "additions": 12, "deletions": 24, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9/src%2Flibnative%2Fio%2Ffile_unix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d90921a9d87b17df5eeab9e5f18581e8b04a1ba9/src%2Flibnative%2Fio%2Ffile_unix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibnative%2Fio%2Ffile_unix.rs?ref=d90921a9d87b17df5eeab9e5f18581e8b04a1ba9", "patch": "@@ -154,7 +154,7 @@ impl rtio::RtioFileStream for FileDesc {\n \n     fn fstat(&mut self) -> IoResult<rtio::FileStat> {\n         let mut stat: libc::stat = unsafe { mem::zeroed() };\n-        match retry(|| unsafe { libc::fstat(self.fd(), &mut stat) }) {\n+        match unsafe { libc::fstat(self.fd(), &mut stat) } {\n             0 => Ok(mkstat(&stat)),\n             _ => Err(super::last_error()),\n         }\n@@ -346,9 +346,7 @@ pub fn open(path: &CString, fm: rtio::FileMode, fa: rtio::FileAccess)\n }\n \n pub fn mkdir(p: &CString, mode: uint) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::mkdir(p.as_ptr(), mode as libc::mode_t)\n-    }))\n+    super::mkerr_libc(unsafe { libc::mkdir(p.as_ptr(), mode as libc::mode_t) })\n }\n \n pub fn readdir(p: &CString) -> IoResult<Vec<CString>> {\n@@ -393,13 +391,11 @@ pub fn readdir(p: &CString) -> IoResult<Vec<CString>> {\n }\n \n pub fn unlink(p: &CString) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe { libc::unlink(p.as_ptr()) }))\n+    super::mkerr_libc(unsafe { libc::unlink(p.as_ptr()) })\n }\n \n pub fn rename(old: &CString, new: &CString) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::rename(old.as_ptr(), new.as_ptr())\n-    }))\n+    super::mkerr_libc(unsafe { libc::rename(old.as_ptr(), new.as_ptr()) })\n }\n \n pub fn chmod(p: &CString, mode: uint) -> IoResult<()> {\n@@ -409,9 +405,7 @@ pub fn chmod(p: &CString, mode: uint) -> IoResult<()> {\n }\n \n pub fn rmdir(p: &CString) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::rmdir(p.as_ptr())\n-    }))\n+    super::mkerr_libc(unsafe { libc::rmdir(p.as_ptr()) })\n }\n \n pub fn chown(p: &CString, uid: int, gid: int) -> IoResult<()> {\n@@ -428,10 +422,10 @@ pub fn readlink(p: &CString) -> IoResult<CString> {\n         len = 1024; // FIXME: read PATH_MAX from C ffi?\n     }\n     let mut buf: Vec<u8> = Vec::with_capacity(len as uint);\n-    match retry(|| unsafe {\n+    match unsafe {\n         libc::readlink(p, buf.as_ptr() as *mut libc::c_char,\n                        len as libc::size_t) as libc::c_int\n-    }) {\n+    } {\n         -1 => Err(super::last_error()),\n         n => {\n             assert!(n > 0);\n@@ -442,15 +436,11 @@ pub fn readlink(p: &CString) -> IoResult<CString> {\n }\n \n pub fn symlink(src: &CString, dst: &CString) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::symlink(src.as_ptr(), dst.as_ptr())\n-    }))\n+    super::mkerr_libc(unsafe { libc::symlink(src.as_ptr(), dst.as_ptr()) })\n }\n \n pub fn link(src: &CString, dst: &CString) -> IoResult<()> {\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::link(src.as_ptr(), dst.as_ptr())\n-    }))\n+    super::mkerr_libc(unsafe { libc::link(src.as_ptr(), dst.as_ptr()) })\n }\n \n fn mkstat(stat: &libc::stat) -> rtio::FileStat {\n@@ -489,15 +479,15 @@ fn mkstat(stat: &libc::stat) -> rtio::FileStat {\n \n pub fn stat(p: &CString) -> IoResult<rtio::FileStat> {\n     let mut stat: libc::stat = unsafe { mem::zeroed() };\n-    match retry(|| unsafe { libc::stat(p.as_ptr(), &mut stat) }) {\n+    match unsafe { libc::stat(p.as_ptr(), &mut stat) } {\n         0 => Ok(mkstat(&stat)),\n         _ => Err(super::last_error()),\n     }\n }\n \n pub fn lstat(p: &CString) -> IoResult<rtio::FileStat> {\n     let mut stat: libc::stat = unsafe { mem::zeroed() };\n-    match retry(|| unsafe { libc::lstat(p.as_ptr(), &mut stat) }) {\n+    match unsafe { libc::lstat(p.as_ptr(), &mut stat) } {\n         0 => Ok(mkstat(&stat)),\n         _ => Err(super::last_error()),\n     }\n@@ -508,9 +498,7 @@ pub fn utime(p: &CString, atime: u64, mtime: u64) -> IoResult<()> {\n         actime: (atime / 1000) as libc::time_t,\n         modtime: (mtime / 1000) as libc::time_t,\n     };\n-    super::mkerr_libc(retry(|| unsafe {\n-        libc::utime(p.as_ptr(), &buf)\n-    }))\n+    super::mkerr_libc(unsafe { libc::utime(p.as_ptr(), &buf) })\n }\n \n #[cfg(test)]"}]}