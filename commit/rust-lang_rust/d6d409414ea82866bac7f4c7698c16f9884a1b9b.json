{"sha": "d6d409414ea82866bac7f4c7698c16f9884a1b9b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2ZDQwOTQxNGVhODI4NjZiYWM3ZjRjNzY5OGMxNmY5ODg0YTFiOWI=", "commit": {"author": {"name": "KALPESH KRISHNA", "email": "kalpeshk2011@gmail.com", "date": "2016-03-07T21:27:45Z"}, "committer": {"name": "KALPESH KRISHNA", "email": "kalpeshk2011@gmail.com", "date": "2016-03-07T21:27:45Z"}, "message": "Adding underflow checks and tests", "tree": {"sha": "06056cca33c0488e34d3f09ca3d364319ee757fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06056cca33c0488e34d3f09ca3d364319ee757fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d6d409414ea82866bac7f4c7698c16f9884a1b9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d6d409414ea82866bac7f4c7698c16f9884a1b9b", "html_url": "https://github.com/rust-lang/rust/commit/d6d409414ea82866bac7f4c7698c16f9884a1b9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d6d409414ea82866bac7f4c7698c16f9884a1b9b/comments", "author": {"login": "martiansideofthemoon", "id": 8805240, "node_id": "MDQ6VXNlcjg4MDUyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8805240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martiansideofthemoon", "html_url": "https://github.com/martiansideofthemoon", "followers_url": "https://api.github.com/users/martiansideofthemoon/followers", "following_url": "https://api.github.com/users/martiansideofthemoon/following{/other_user}", "gists_url": "https://api.github.com/users/martiansideofthemoon/gists{/gist_id}", "starred_url": "https://api.github.com/users/martiansideofthemoon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martiansideofthemoon/subscriptions", "organizations_url": "https://api.github.com/users/martiansideofthemoon/orgs", "repos_url": "https://api.github.com/users/martiansideofthemoon/repos", "events_url": "https://api.github.com/users/martiansideofthemoon/events{/privacy}", "received_events_url": "https://api.github.com/users/martiansideofthemoon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "martiansideofthemoon", "id": 8805240, "node_id": "MDQ6VXNlcjg4MDUyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8805240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martiansideofthemoon", "html_url": "https://github.com/martiansideofthemoon", "followers_url": "https://api.github.com/users/martiansideofthemoon/followers", "following_url": "https://api.github.com/users/martiansideofthemoon/following{/other_user}", "gists_url": "https://api.github.com/users/martiansideofthemoon/gists{/gist_id}", "starred_url": "https://api.github.com/users/martiansideofthemoon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martiansideofthemoon/subscriptions", "organizations_url": "https://api.github.com/users/martiansideofthemoon/orgs", "repos_url": "https://api.github.com/users/martiansideofthemoon/repos", "events_url": "https://api.github.com/users/martiansideofthemoon/events{/privacy}", "received_events_url": "https://api.github.com/users/martiansideofthemoon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "55fbf59f3bec1425e03b56516050912ed02147c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/55fbf59f3bec1425e03b56516050912ed02147c9", "html_url": "https://github.com/rust-lang/rust/commit/55fbf59f3bec1425e03b56516050912ed02147c9"}], "stats": {"total": 27, "additions": 27, "deletions": 0}, "files": [{"sha": "c89a3dd273277d047085c385db0f538928a68f7a", "filename": "src/overflow_check_conditional.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d6d409414ea82866bac7f4c7698c16f9884a1b9b/src%2Foverflow_check_conditional.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6d409414ea82866bac7f4c7698c16f9884a1b9b/src%2Foverflow_check_conditional.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Foverflow_check_conditional.rs?ref=d6d409414ea82866bac7f4c7698c16f9884a1b9b", "patch": "@@ -37,5 +37,20 @@ impl LateLintPass for OverflowCheckConditional {\n         ], {\n             span_lint(cx, OVERFLOW_CHECK_CONDITIONAL, expr.span, \"You are trying to use classic C overflow conditons that will fail in Rust.\");\n         }}\n+\n+        if_let_chain! {[\n+        let Expr_::ExprBinary(ref op, ref first, ref second) = expr.node,\n+        let BinOp_::BiGt = op.node,\n+        let Expr_::ExprBinary(ref op2, ref sub1, ref sub2) = first.node,\n+        let BinOp_::BiSub = op2.node,\n+        let Expr_::ExprPath(_,ref path1) = sub1.node,\n+        let Expr_::ExprPath(_, ref path2) = sub2.node,\n+        let Expr_::ExprPath(_, ref path3) = second.node,\n+        (&path1.segments[0]).identifier == (&path3.segments[0]).identifier || (&path2.segments[0]).identifier == (&path3.segments[0]).identifier,\n+        cx.tcx.expr_ty(sub1).is_integral(),\n+        cx.tcx.expr_ty(sub2).is_integral()\n+        ], {\n+            span_lint(cx, OVERFLOW_CHECK_CONDITIONAL, expr.span, \"You are trying to use classic C underflow conditons that will fail in Rust.\");\n+        }}\n     }\n }"}, {"sha": "a59fa2a444a51e850250297a7d476f5d4074be40", "filename": "tests/compile-fail/overflow_check_conditional.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d6d409414ea82866bac7f4c7698c16f9884a1b9b/tests%2Fcompile-fail%2Foverflow_check_conditional.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6d409414ea82866bac7f4c7698c16f9884a1b9b/tests%2Fcompile-fail%2Foverflow_check_conditional.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Foverflow_check_conditional.rs?ref=d6d409414ea82866bac7f4c7698c16f9884a1b9b", "patch": "@@ -12,14 +12,26 @@ fn main() {\n \t}\n \tif a + b < b { //~ERROR You are trying to use classic C overflow conditons that will fail in Rust.\n \n+\t}\n+\tif a - b > b { //~ERROR You are trying to use classic C underflow conditons that will fail in Rust.\n+\n+\t}\n+\tif a - b > a { //~ERROR You are trying to use classic C underflow conditons that will fail in Rust.\n+\n \t}\n \tif a + b < c {\n \n+\t}\n+\tif a - b < c {\n+\n \t}\n \tlet i = 1.1;\n \tlet j = 2.2;\n \tif i + j < i {\n \n+\t}\n+\tif i - j < i {\n+\n \t}\n }\n "}]}