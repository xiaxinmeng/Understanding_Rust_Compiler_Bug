{"sha": "34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0ZWUzMWQ2ZjJiN2Q3MDAzZWY4ZjYyM2NkMmMwYjFmYzFlMDEwYmI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-16T17:51:02Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-16T19:34:31Z"}, "message": "Rollup merge of #49959 - cuviper:debuginfo-tools, r=Mark-Simulacrum\n\nrustbuild: allow building tools with debuginfo\n\nDebugging information for the extended tools is currently disabled for\nconcerns about the size.  This patch adds `--enable-debuginfo-tools` to\nlet one opt into having that debuginfo.\n\nThis is useful for debugging the tools in distro packages.  We always\nstrip debuginfo into separate packages anyway, so the extra size is not\na concern in regular use.", "tree": {"sha": "fe8d5a99772292691d190d43e9aef76a0479bf8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe8d5a99772292691d190d43e9aef76a0479bf8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlrU+sgACgkQ/vbIBR0O\nATy1MBAAkMlHWvUQr3SjIeSLvuwdQM6316l2dEyjS7bcAyp1fc7AUj0W1A9LWWjQ\ndG9BK1jt8I75/mpTMkHkrjYyJ0BXCrK6gyyb5cyMOR4XUjKJfW2t98vnIeuG7hS/\ndurb2DZSN5yxhgsck8fdmc4HxW4XIv5uwjZ06kBovLWRhSLFA9z4vdd1eaAn+8EG\ndDlbvVTExRXQZW75fFbzBn2EC44+/miVQJcAcedLjxgN5GSP5+HCOJAGeU0QAA6x\nN3GWaTq0uizwNH6lCVSHaZ1fMwfIm0ueEicvKeSK1syj7aR/TY6k/VaiIOdq9WQK\nml/EOhtmddkjW8wSpwVSrIaijtUzUPKoMhszipyts4MFZz6JjVcVnE75jiBBwiFD\nhr7wC4jEcPx3HpBTFDV4P/lyr72pgkvG3/o7OscCUz+o4VvZO5wbV/9wC94r9cwd\n3tRmbYLunsGUxL1ESV2WHtRuF8r3qAQhYclWuCoISZEFI8JVaDmTE+DyO7fn6Sh4\nV2CurNpJxTr5iM9W7E+ejBYb2xr1wqI5Ujs7jElopgkB2G+aKLXhzsZT3ASeOCG8\ntI1eNrm5G3m90m6YyJ9u3BTmIgNnARR+qzr7Hk96s7JIAy0byTTE/QkAWdwLhEM0\nl0v5qZ9jnN4WxlfuGv6bUkJ7yffVHpdrHI/KSeaeaXd2Gof9MX0=\n=6QUc\n-----END PGP SIGNATURE-----", "payload": "tree fe8d5a99772292691d190d43e9aef76a0479bf8e\nparent 73ea8939ee3480f8605360e1ec88b4b86a9f2c8b\nparent 93734e9c46e30acc9a51f19c56511ce8516b6855\nauthor kennytm <kennytm@gmail.com> 1523901062 +0800\ncommitter kennytm <kennytm@gmail.com> 1523907271 +0800\n\nRollup merge of #49959 - cuviper:debuginfo-tools, r=Mark-Simulacrum\n\nrustbuild: allow building tools with debuginfo\n\nDebugging information for the extended tools is currently disabled for\nconcerns about the size.  This patch adds `--enable-debuginfo-tools` to\nlet one opt into having that debuginfo.\n\nThis is useful for debugging the tools in distro packages.  We always\nstrip debuginfo into separate packages anyway, so the extra size is not\na concern in regular use.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "html_url": "https://github.com/rust-lang/rust/commit/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "url": "https://api.github.com/repos/rust-lang/rust/commits/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "html_url": "https://github.com/rust-lang/rust/commit/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b"}, {"sha": "93734e9c46e30acc9a51f19c56511ce8516b6855", "url": "https://api.github.com/repos/rust-lang/rust/commits/93734e9c46e30acc9a51f19c56511ce8516b6855", "html_url": "https://github.com/rust-lang/rust/commit/93734e9c46e30acc9a51f19c56511ce8516b6855"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "73d4188d695498e68e10388ce24b0e57bab27b11", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "patch": "@@ -121,6 +121,7 @@ configuration used in the build process. Some options to note:\n #### `[rust]`:\n - `debuginfo = true` - Build a compiler with debuginfo. Makes building rustc slower, but then you can use a debugger to debug `rustc`.\n - `debuginfo-lines = true` - An alternative to `debuginfo = true` that doesn't let you use a debugger, but doesn't make building rustc slower and still gives you line numbers in backtraces.\n+- `debuginfo-tools = true` - Build the extended tools with debuginfo.\n - `debug-assertions = true` - Makes the log output of `debug!` work.\n - `optimize = false` - Disable optimizations to speed up compilation of stage1 rust, but makes the stage1 compiler x100 slower.\n "}, {"sha": "effe00843810da1dcd993bfc48ec00f6df6e288c", "filename": "config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "patch": "@@ -262,6 +262,10 @@\n # standard library.\n #debuginfo-only-std = false\n \n+# Enable debuginfo for the extended tools: cargo, rls, rustfmt\n+# Adding debuginfo makes them several times larger.\n+#debuginfo-tools = false\n+\n # Whether or not jemalloc is built and enabled\n #use-jemalloc = true\n "}, {"sha": "6874efa5a4c73f9941947a799d182c4b7f8070e4", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "patch": "@@ -622,10 +622,14 @@ impl<'a> Builder<'a> {\n             cargo.env(\"RUSTDOC_LIBDIR\", self.rustc_libdir(self.compiler(2, self.build.build)));\n         }\n \n-        if mode != Mode::Tool {\n-            // Tools don't get debuginfo right now, e.g. cargo and rls don't\n-            // get compiled with debuginfo.\n-            // Adding debuginfo increases their sizes by a factor of 3-4.\n+        if mode == Mode::Tool {\n+            // Tools like cargo and rls don't get debuginfo by default right now, but this can be\n+            // enabled in the config.  Adding debuginfo makes them several times larger.\n+            if self.config.rust_debuginfo_tools {\n+                cargo.env(\"RUSTC_DEBUGINFO\", self.config.rust_debuginfo.to_string());\n+                cargo.env(\"RUSTC_DEBUGINFO_LINES\", self.config.rust_debuginfo_lines.to_string());\n+            }\n+        } else {\n             cargo.env(\"RUSTC_DEBUGINFO\", self.config.rust_debuginfo.to_string());\n             cargo.env(\"RUSTC_DEBUGINFO_LINES\", self.config.rust_debuginfo_lines.to_string());\n             cargo.env(\"RUSTC_FORCE_UNSTABLE\", \"1\");"}, {"sha": "1b4b2c5fb2a54cab90d9bf633b6dfabd4f6b8d78", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "patch": "@@ -94,6 +94,7 @@ pub struct Config {\n     pub rust_debuginfo: bool,\n     pub rust_debuginfo_lines: bool,\n     pub rust_debuginfo_only_std: bool,\n+    pub rust_debuginfo_tools: bool,\n     pub rust_rpath: bool,\n     pub rustc_parallel_queries: bool,\n     pub rustc_default_linker: Option<String>,\n@@ -282,6 +283,7 @@ struct Rust {\n     debuginfo: Option<bool>,\n     debuginfo_lines: Option<bool>,\n     debuginfo_only_std: Option<bool>,\n+    debuginfo_tools: Option<bool>,\n     experimental_parallel_queries: Option<bool>,\n     debug_jemalloc: Option<bool>,\n     use_jemalloc: Option<bool>,\n@@ -462,6 +464,7 @@ impl Config {\n         let mut llvm_assertions = None;\n         let mut debuginfo_lines = None;\n         let mut debuginfo_only_std = None;\n+        let mut debuginfo_tools = None;\n         let mut debug = None;\n         let mut debug_jemalloc = None;\n         let mut debuginfo = None;\n@@ -499,6 +502,7 @@ impl Config {\n             debuginfo = rust.debuginfo;\n             debuginfo_lines = rust.debuginfo_lines;\n             debuginfo_only_std = rust.debuginfo_only_std;\n+            debuginfo_tools = rust.debuginfo_tools;\n             optimize = rust.optimize;\n             ignore_git = rust.ignore_git;\n             debug_jemalloc = rust.debug_jemalloc;\n@@ -582,6 +586,7 @@ impl Config {\n         };\n         config.rust_debuginfo_lines = debuginfo_lines.unwrap_or(default);\n         config.rust_debuginfo_only_std = debuginfo_only_std.unwrap_or(default);\n+        config.rust_debuginfo_tools = debuginfo_tools.unwrap_or(false);\n \n         let default = debug == Some(true);\n         config.debug_jemalloc = debug_jemalloc.unwrap_or(default);"}, {"sha": "a0123da6d8ff9ba077663f4f10334a03c271baef", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=34ee31d6f2b7d7003ef8f623cd2c0b1fc1e010bb", "patch": "@@ -79,6 +79,7 @@ def v(*args):\n o(\"debuginfo\", \"rust.debuginfo\", \"build with debugger metadata\")\n o(\"debuginfo-lines\", \"rust.debuginfo-lines\", \"build with line number debugger metadata\")\n o(\"debuginfo-only-std\", \"rust.debuginfo-only-std\", \"build only libstd with debugging information\")\n+o(\"debuginfo-tools\", \"rust.debuginfo-tools\", \"build extended tools with debugging information\")\n o(\"debug-jemalloc\", \"rust.debug-jemalloc\", \"build jemalloc with --enable-debug --enable-fill\")\n v(\"save-toolstates\", \"rust.save-toolstates\", \"save build and test status of external tools into this file\")\n "}]}