{"sha": "582f99d293359b6276813c4433db36c6e790152e", "node_id": "C_kwDOAAsO6NoAKDU4MmY5OWQyOTMzNTliNjI3NjgxM2M0NDMzZGIzNmM2ZTc5MDE1MmU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-05-06T11:11:50Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-05-06T11:11:50Z"}, "message": "internal: Improve completion tests by checking that the offset is included in the source_range of items", "tree": {"sha": "cceb703603a0a013cb4024ee2620c7e27131aa41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cceb703603a0a013cb4024ee2620c7e27131aa41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/582f99d293359b6276813c4433db36c6e790152e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/582f99d293359b6276813c4433db36c6e790152e", "html_url": "https://github.com/rust-lang/rust/commit/582f99d293359b6276813c4433db36c6e790152e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/582f99d293359b6276813c4433db36c6e790152e/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57a9915c1f59126883e0df22be1a3e11ab3c1e2d", "url": "https://api.github.com/repos/rust-lang/rust/commits/57a9915c1f59126883e0df22be1a3e11ab3c1e2d", "html_url": "https://github.com/rust-lang/rust/commit/57a9915c1f59126883e0df22be1a3e11ab3c1e2d"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "140e5b600b17d26b7c5194cb64e423ec78e69dd3", "filename": "crates/ide-completion/src/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/582f99d293359b6276813c4433db36c6e790152e/crates%2Fide-completion%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/582f99d293359b6276813c4433db36c6e790152e/crates%2Fide-completion%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fitem.rs?ref=582f99d293359b6276813c4433db36c6e790152e", "patch": "@@ -26,7 +26,7 @@ pub struct CompletionItem {\n     /// It should be used primarily for UI, but we also use this to convert\n     /// generic TextEdit into LSP's completion edit (see conv.rs).\n     ///\n-    /// `source_range` must contain the completion offset. `insert_text` should\n+    /// `source_range` must contain the completion offset. `text_edit` should\n     /// start with what `source_range` points to, or VSCode will filter out the\n     /// completion silently.\n     source_range: TextRange,"}, {"sha": "72b7a5584aa69ef1357bcc536539ac097020c831", "filename": "crates/ide-completion/src/tests.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/582f99d293359b6276813c4433db36c6e790152e/crates%2Fide-completion%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/582f99d293359b6276813c4433db36c6e790152e/crates%2Fide-completion%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests.rs?ref=582f99d293359b6276813c4433db36c6e790152e", "patch": "@@ -214,7 +214,17 @@ pub(crate) fn check_pattern_is_applicable(code: &str, check: impl FnOnce(SyntaxE\n \n pub(crate) fn get_all_items(config: CompletionConfig, code: &str) -> Vec<CompletionItem> {\n     let (db, position) = position(code);\n-    crate::completions(&db, &config, position).map_or_else(Vec::default, Into::into)\n+    let res = crate::completions(&db, &config, position).map_or_else(Vec::default, Into::into);\n+    // validate\n+    res.iter().for_each(|it| {\n+        let sr = it.source_range();\n+        assert!(\n+            sr.contains_inclusive(position.offset),\n+            \"source range {sr:?} does not contain the offset {:?} of the completion request: {it:?}\",\n+            position.offset\n+        );\n+    });\n+    res\n }\n \n #[test]"}]}