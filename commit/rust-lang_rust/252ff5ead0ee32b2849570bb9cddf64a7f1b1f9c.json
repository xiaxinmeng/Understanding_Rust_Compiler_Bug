{"sha": "252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "node_id": "C_kwDOAAsO6NoAKDI1MmZmNWVhZDBlZTMyYjI4NDk1NzBiYjljZGRmNjRhN2YxYjFmOWM", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2022-02-07T14:08:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-07T14:08:34Z"}, "message": "Rollup merge of #93416 - name1e5s:chore/remove_allow_fail, r=m-ou-se\n\nremove `allow_fail` test flag\n\nclose #93345", "tree": {"sha": "c531c818589f1296c45f57f52cf1869cbd346341", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c531c818589f1296c45f57f52cf1869cbd346341"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiASfiCRBK7hj4Ov3rIwAAiv8IAKdjJ79h0a2Bwd6oy94KcGzx\nmLdNttVpalm6cLuYdgzZwZUxQ+hzkU00I2X+2jFTrPWogcs/enR4VehanBb0L+ZC\nXtDfytoj/3cTUWPHTjyaVLYEkro0bYWktNWsSZrWShxiaJI9si5k56qJwhr+24kg\nv/5HgsjklJN6xgmr8r5IbsHbB/1m7Utccwm20hGTNOUFy6XpMjxIvZPECAgDhihd\nhWYN//TnU7K8HN1T7s4Ypr1YEfAA+AS5ep8ys2MYYU7VwPmQqtQBuOc1N5WqqO9H\n+Vo9suaCKfKQiY8Z3/2JxMJ/XyTrOFLwlms9hy+Fwvp6H2HlixT8tSF9OagTbGQ=\n=ZRRQ\n-----END PGP SIGNATURE-----\n", "payload": "tree c531c818589f1296c45f57f52cf1869cbd346341\nparent 4445a8ff84e1d729df1b0320760bd8f5dd618e78\nparent 0b8c9fbf0bd5e7e9917e7c26e9216d41ddcd2ef7\nauthor Mara Bos <m-ou.se@m-ou.se> 1644242914 +0000\ncommitter GitHub <noreply@github.com> 1644242914 +0000\n\nRollup merge of #93416 - name1e5s:chore/remove_allow_fail, r=m-ou-se\n\nremove `allow_fail` test flag\n\nclose #93345\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "html_url": "https://github.com/rust-lang/rust/commit/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4445a8ff84e1d729df1b0320760bd8f5dd618e78", "url": "https://api.github.com/repos/rust-lang/rust/commits/4445a8ff84e1d729df1b0320760bd8f5dd618e78", "html_url": "https://github.com/rust-lang/rust/commit/4445a8ff84e1d729df1b0320760bd8f5dd618e78"}, {"sha": "0b8c9fbf0bd5e7e9917e7c26e9216d41ddcd2ef7", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b8c9fbf0bd5e7e9917e7c26e9216d41ddcd2ef7", "html_url": "https://github.com/rust-lang/rust/commit/0b8c9fbf0bd5e7e9917e7c26e9216d41ddcd2ef7"}], "stats": {"total": 349, "additions": 79, "deletions": 270}, "files": [{"sha": "9459bb7047f5c64e2f45b53c7c8787431bd349e4", "filename": "compiler/rustc_builtin_macros/src/test.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -252,11 +252,6 @@ pub fn expand_test_or_bench(\n                                         \"ignore\",\n                                         cx.expr_bool(sp, should_ignore(&cx.sess, &item)),\n                                     ),\n-                                    // allow_fail: true | false\n-                                    field(\n-                                        \"allow_fail\",\n-                                        cx.expr_bool(sp, should_fail(&cx.sess, &item)),\n-                                    ),\n                                     // compile_fail: true | false\n                                     field(\"compile_fail\", cx.expr_bool(sp, false)),\n                                     // no_run: true | false\n@@ -359,10 +354,6 @@ fn should_ignore(sess: &Session, i: &ast::Item) -> bool {\n     sess.contains_name(&i.attrs, sym::ignore)\n }\n \n-fn should_fail(sess: &Session, i: &ast::Item) -> bool {\n-    sess.contains_name(&i.attrs, sym::allow_fail)\n-}\n-\n fn should_panic(cx: &ExtCtxt<'_>, i: &ast::Item) -> ShouldPanic {\n     match cx.sess.find_by_name(&i.attrs, sym::should_panic) {\n         Some(attr) => {"}, {"sha": "b4cfad215e2bc737d0b9a9513e1b9da5e417ae05", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -277,8 +277,6 @@ declare_features! (\n     (incomplete, adt_const_params, \"1.56.0\", Some(44580), None),\n     /// Allows defining an `#[alloc_error_handler]`.\n     (active, alloc_error_handler, \"1.29.0\", Some(51540), None),\n-    /// Allows a test to fail without failing the whole suite.\n-    (active, allow_fail, \"1.19.0\", Some(46488), None),\n     /// Allows explicit discriminants on non-unit enum variants.\n     (active, arbitrary_enum_discriminant, \"1.37.0\", Some(60553), None),\n     /// Allows trait methods with arbitrary self types."}, {"sha": "cb2562d09a5250e5c39c1ddf2944927c891e05bc", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -403,7 +403,6 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n     },\n \n     // Testing:\n-    gated!(allow_fail, Normal, template!(Word), WarnFollowing, experimental!(allow_fail)),\n     gated!(\n         test_runner, CrateLevel, template!(List: \"path\"), ErrorFollowing, custom_test_frameworks,\n         \"custom test frameworks are an unstable feature\","}, {"sha": "f5f944db5e90b23cbbd63a3a381beb997e566ff1", "filename": "compiler/rustc_feature/src/removed.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -48,6 +48,8 @@ declare_features! (\n     (removed, advanced_slice_patterns, \"1.0.0\", Some(62254), None,\n      Some(\"merged into `#![feature(slice_patterns)]`\")),\n     (removed, allocator, \"1.0.0\", None, None, None),\n+    /// Allows a test to fail without failing the whole suite.\n+    (removed, allow_fail, \"1.19.0\", Some(46488), None, Some(\"removed due to no clear use cases\")),\n     (removed, await_macro, \"1.38.0\", Some(50547), None,\n      Some(\"subsumed by `.await` syntax\")),\n     /// Allows comparing raw pointers during const eval."}, {"sha": "920f55ad251a651ca3f484c6d8f2fc1eb2c0d2c2", "filename": "library/test/src/console.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fconsole.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fconsole.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fconsole.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -47,7 +47,6 @@ pub struct ConsoleTestState {\n     pub passed: usize,\n     pub failed: usize,\n     pub ignored: usize,\n-    pub allowed_fail: usize,\n     pub filtered_out: usize,\n     pub measured: usize,\n     pub exec_time: Option<TestSuiteExecTime>,\n@@ -71,7 +70,6 @@ impl ConsoleTestState {\n             passed: 0,\n             failed: 0,\n             ignored: 0,\n-            allowed_fail: 0,\n             filtered_out: 0,\n             measured: 0,\n             exec_time: None,\n@@ -112,7 +110,6 @@ impl ConsoleTestState {\n                     TestResult::TrFailed => \"failed\".to_owned(),\n                     TestResult::TrFailedMsg(ref msg) => format!(\"failed: {}\", msg),\n                     TestResult::TrIgnored => \"ignored\".to_owned(),\n-                    TestResult::TrAllowedFail => \"failed (allowed)\".to_owned(),\n                     TestResult::TrBench(ref bs) => fmt_bench_samples(bs),\n                     TestResult::TrTimedFail => \"failed (time limit exceeded)\".to_owned(),\n                 },\n@@ -126,7 +123,7 @@ impl ConsoleTestState {\n     }\n \n     fn current_test_count(&self) -> usize {\n-        self.passed + self.failed + self.ignored + self.measured + self.allowed_fail\n+        self.passed + self.failed + self.ignored + self.measured\n     }\n }\n \n@@ -191,7 +188,6 @@ fn handle_test_result(st: &mut ConsoleTestState, completed_test: CompletedTest)\n             st.not_failures.push((test, stdout));\n         }\n         TestResult::TrIgnored => st.ignored += 1,\n-        TestResult::TrAllowedFail => st.allowed_fail += 1,\n         TestResult::TrBench(bs) => {\n             st.metrics.insert_metric(\n                 test.name.as_slice(),"}, {"sha": "c089bfc4791b5e2bf9b8162c1e72b9bba4ff9d75", "filename": "library/test/src/formatters/json.rs", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fformatters%2Fjson.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -124,15 +124,6 @@ impl<T: Write> OutputFormatter for JsonFormatter<T> {\n                 self.write_event(\"test\", desc.name.as_slice(), \"ignored\", exec_time, stdout, None)\n             }\n \n-            TestResult::TrAllowedFail => self.write_event(\n-                \"test\",\n-                desc.name.as_slice(),\n-                \"allowed_failure\",\n-                exec_time,\n-                stdout,\n-                None,\n-            ),\n-\n             TestResult::TrBench(ref bs) => {\n                 let median = bs.ns_iter_summ.median as usize;\n                 let deviation = (bs.ns_iter_summ.max - bs.ns_iter_summ.min) as usize;\n@@ -172,14 +163,12 @@ impl<T: Write> OutputFormatter for JsonFormatter<T> {\n              \\\"event\\\": \\\"{}\\\", \\\n              \\\"passed\\\": {}, \\\n              \\\"failed\\\": {}, \\\n-             \\\"allowed_fail\\\": {}, \\\n              \\\"ignored\\\": {}, \\\n              \\\"measured\\\": {}, \\\n              \\\"filtered_out\\\": {}\",\n             if state.failed == 0 { \"ok\" } else { \"failed\" },\n             state.passed,\n-            state.failed + state.allowed_fail,\n-            state.allowed_fail,\n+            state.failed,\n             state.ignored,\n             state.measured,\n             state.filtered_out,"}, {"sha": "54e9860ab548779173d623709d5a33fe4c98eb9e", "filename": "library/test/src/formatters/junit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -121,7 +121,7 @@ impl<T: Write> OutputFormatter for JunitFormatter<T> {\n                     ))?;\n                 }\n \n-                TestResult::TrOk | TestResult::TrAllowedFail => {\n+                TestResult::TrOk => {\n                     self.write_message(&*format!(\n                         \"<testcase classname=\\\"{}\\\" \\\n                          name=\\\"{}\\\" time=\\\"{}\\\"/>\","}, {"sha": "4726ae864df7733a34551e7c4181426231dcc87f", "filename": "library/test/src/formatters/pretty.rs", "status": "modified", "additions": 4, "deletions": 21, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fformatters%2Fpretty.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -49,10 +49,6 @@ impl<T: Write> PrettyFormatter<T> {\n         self.write_short_result(\"ignored\", term::color::YELLOW)\n     }\n \n-    pub fn write_allowed_fail(&mut self) -> io::Result<()> {\n-        self.write_short_result(\"FAILED (allowed)\", term::color::YELLOW)\n-    }\n-\n     pub fn write_time_failed(&mut self) -> io::Result<()> {\n         self.write_short_result(\"FAILED (time limit exceeded)\", term::color::RED)\n     }\n@@ -219,7 +215,6 @@ impl<T: Write> OutputFormatter for PrettyFormatter<T> {\n             TestResult::TrOk => self.write_ok()?,\n             TestResult::TrFailed | TestResult::TrFailedMsg(_) => self.write_failed()?,\n             TestResult::TrIgnored => self.write_ignored()?,\n-            TestResult::TrAllowedFail => self.write_allowed_fail()?,\n             TestResult::TrBench(ref bs) => {\n                 self.write_bench()?;\n                 self.write_plain(&format!(\": {}\", fmt_bench_samples(bs)))?;\n@@ -263,22 +258,10 @@ impl<T: Write> OutputFormatter for PrettyFormatter<T> {\n             self.write_pretty(\"FAILED\", term::color::RED)?;\n         }\n \n-        let s = if state.allowed_fail > 0 {\n-            format!(\n-                \". {} passed; {} failed ({} allowed); {} ignored; {} measured; {} filtered out\",\n-                state.passed,\n-                state.failed + state.allowed_fail,\n-                state.allowed_fail,\n-                state.ignored,\n-                state.measured,\n-                state.filtered_out\n-            )\n-        } else {\n-            format!(\n-                \". {} passed; {} failed; {} ignored; {} measured; {} filtered out\",\n-                state.passed, state.failed, state.ignored, state.measured, state.filtered_out\n-            )\n-        };\n+        let s = format!(\n+            \". {} passed; {} failed; {} ignored; {} measured; {} filtered out\",\n+            state.passed, state.failed, state.ignored, state.measured, state.filtered_out\n+        );\n \n         self.write_plain(&s)?;\n "}, {"sha": "12aca7cd9a42dd7af12b5cea216bd1e164a751a4", "filename": "library/test/src/formatters/terse.rs", "status": "modified", "additions": 4, "deletions": 21, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fterse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Fformatters%2Fterse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fformatters%2Fterse.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -54,10 +54,6 @@ impl<T: Write> TerseFormatter<T> {\n         self.write_short_result(\"i\", term::color::YELLOW)\n     }\n \n-    pub fn write_allowed_fail(&mut self) -> io::Result<()> {\n-        self.write_short_result(\"a\", term::color::YELLOW)\n-    }\n-\n     pub fn write_bench(&mut self) -> io::Result<()> {\n         self.write_pretty(\"bench\", term::color::CYAN)\n     }\n@@ -207,7 +203,6 @@ impl<T: Write> OutputFormatter for TerseFormatter<T> {\n                 self.write_failed()\n             }\n             TestResult::TrIgnored => self.write_ignored(),\n-            TestResult::TrAllowedFail => self.write_allowed_fail(),\n             TestResult::TrBench(ref bs) => {\n                 if self.is_multithreaded {\n                     self.write_test_name(desc)?;\n@@ -244,22 +239,10 @@ impl<T: Write> OutputFormatter for TerseFormatter<T> {\n             self.write_pretty(\"FAILED\", term::color::RED)?;\n         }\n \n-        let s = if state.allowed_fail > 0 {\n-            format!(\n-                \". {} passed; {} failed ({} allowed); {} ignored; {} measured; {} filtered out\",\n-                state.passed,\n-                state.failed + state.allowed_fail,\n-                state.allowed_fail,\n-                state.ignored,\n-                state.measured,\n-                state.filtered_out\n-            )\n-        } else {\n-            format!(\n-                \". {} passed; {} failed; {} ignored; {} measured; {} filtered out\",\n-                state.passed, state.failed, state.ignored, state.measured, state.filtered_out\n-            )\n-        };\n+        let s = format!(\n+            \". {} passed; {} failed; {} ignored; {} measured; {} filtered out\",\n+            state.passed, state.failed, state.ignored, state.measured, state.filtered_out\n+        );\n \n         self.write_plain(&s)?;\n "}, {"sha": "8c216a1e0e70e2d40206073610ac6b7be29a1cf1", "filename": "library/test/src/test_result.rs", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftest_result.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftest_result.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftest_result.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -19,7 +19,6 @@ pub enum TestResult {\n     TrFailed,\n     TrFailedMsg(String),\n     TrIgnored,\n-    TrAllowedFail,\n     TrBench(BenchSamples),\n     TrTimedFail,\n }\n@@ -42,8 +41,6 @@ pub fn calc_result<'a>(\n \n             if maybe_panic_str.map(|e| e.contains(msg)).unwrap_or(false) {\n                 TestResult::TrOk\n-            } else if desc.allow_fail {\n-                TestResult::TrAllowedFail\n             } else if let Some(panic_str) = maybe_panic_str {\n                 TestResult::TrFailedMsg(format!(\n                     r#\"panic did not contain expected string\n@@ -64,7 +61,6 @@ pub fn calc_result<'a>(\n         (&ShouldPanic::Yes, Ok(())) | (&ShouldPanic::YesWithMessage(_), Ok(())) => {\n             TestResult::TrFailedMsg(\"test did not panic as expected\".to_string())\n         }\n-        _ if desc.allow_fail => TestResult::TrAllowedFail,\n         _ => TestResult::TrFailed,\n     };\n \n@@ -90,11 +86,10 @@ pub fn get_result_from_exit_code(\n     time_opts: &Option<time::TestTimeOptions>,\n     exec_time: &Option<time::TestExecTime>,\n ) -> TestResult {\n-    let result = match (desc.allow_fail, code) {\n-        (_, TR_OK) => TestResult::TrOk,\n-        (true, TR_FAILED) => TestResult::TrAllowedFail,\n-        (false, TR_FAILED) => TestResult::TrFailed,\n-        (_, _) => TestResult::TrFailedMsg(format!(\"got unexpected return code {}\", code)),\n+    let result = match code {\n+        TR_OK => TestResult::TrOk,\n+        TR_FAILED => TestResult::TrFailed,\n+        _ => TestResult::TrFailedMsg(format!(\"got unexpected return code {}\", code)),\n     };\n \n     // If test is already failed (or allowed to fail), do not change the result."}, {"sha": "9b9c5205686629cc1c6105117d4955de54208dd7", "filename": "library/test/src/tests.rs", "status": "modified", "additions": 38, "deletions": 20, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftests.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -62,10 +62,11 @@ fn one_ignored_one_unignored_test() -> Vec<TestDescAndFn> {\n                 name: StaticTestName(\"1\"),\n                 ignore: true,\n                 should_panic: ShouldPanic::No,\n-                allow_fail: false,\n                 compile_fail: false,\n                 no_run: false,\n                 test_type: TestType::Unknown,\n+                #[cfg(bootstrap)]\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move || {})),\n         },\n@@ -74,10 +75,11 @@ fn one_ignored_one_unignored_test() -> Vec<TestDescAndFn> {\n                 name: StaticTestName(\"2\"),\n                 ignore: false,\n                 should_panic: ShouldPanic::No,\n-                allow_fail: false,\n                 compile_fail: false,\n                 no_run: false,\n                 test_type: TestType::Unknown,\n+                #[cfg(bootstrap)]\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move || {})),\n         },\n@@ -94,10 +96,11 @@ pub fn do_not_run_ignored_tests() {\n             name: StaticTestName(\"whatever\"),\n             ignore: true,\n             should_panic: ShouldPanic::No,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -115,10 +118,11 @@ pub fn ignored_tests_result_in_ignored() {\n             name: StaticTestName(\"whatever\"),\n             ignore: true,\n             should_panic: ShouldPanic::No,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -140,10 +144,11 @@ fn test_should_panic() {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::Yes,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -165,10 +170,11 @@ fn test_should_panic_good_message() {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::YesWithMessage(\"error message\"),\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -195,10 +201,11 @@ fn test_should_panic_bad_message() {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::YesWithMessage(expected),\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -229,10 +236,11 @@ fn test_should_panic_non_string_message_type() {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::YesWithMessage(expected),\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -255,10 +263,11 @@ fn test_should_panic_but_succeeds() {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: false,\n                 should_panic,\n-                allow_fail: false,\n                 compile_fail: false,\n                 no_run: false,\n                 test_type: TestType::Unknown,\n+                #[cfg(bootstrap)]\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(f)),\n         };\n@@ -289,10 +298,11 @@ fn report_time_test_template(report_time: bool) -> Option<TestExecTime> {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::No,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -324,10 +334,11 @@ fn time_test_failure_template(test_type: TestType) -> TestResult {\n             name: StaticTestName(\"whatever\"),\n             ignore: false,\n             should_panic: ShouldPanic::No,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(f)),\n     };\n@@ -363,10 +374,11 @@ fn typed_test_desc(test_type: TestType) -> TestDesc {\n         name: StaticTestName(\"whatever\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     }\n }\n \n@@ -476,10 +488,11 @@ pub fn exclude_should_panic_option() {\n             name: StaticTestName(\"3\"),\n             ignore: false,\n             should_panic: ShouldPanic::Yes,\n-            allow_fail: false,\n             compile_fail: false,\n             no_run: false,\n             test_type: TestType::Unknown,\n+            #[cfg(bootstrap)]\n+            allow_fail: false,\n         },\n         testfn: DynTestFn(Box::new(move || {})),\n     });\n@@ -500,10 +513,11 @@ pub fn exact_filter_match() {\n                     name: StaticTestName(name),\n                     ignore: false,\n                     should_panic: ShouldPanic::No,\n-                    allow_fail: false,\n                     compile_fail: false,\n                     no_run: false,\n                     test_type: TestType::Unknown,\n+                    #[cfg(bootstrap)]\n+                    allow_fail: false,\n                 },\n                 testfn: DynTestFn(Box::new(move || {})),\n             })\n@@ -589,10 +603,11 @@ fn sample_tests() -> Vec<TestDescAndFn> {\n                 name: DynTestName((*name).clone()),\n                 ignore: false,\n                 should_panic: ShouldPanic::No,\n-                allow_fail: false,\n                 compile_fail: false,\n                 no_run: false,\n                 test_type: TestType::Unknown,\n+                #[cfg(bootstrap)]\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(testfn)),\n         };\n@@ -740,10 +755,11 @@ pub fn test_bench_no_iter() {\n         name: StaticTestName(\"f\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type: TestType::Unknown,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     };\n \n     crate::bench::benchmark(TestId(0), desc, tx, true, f);\n@@ -762,10 +778,11 @@ pub fn test_bench_iter() {\n         name: StaticTestName(\"f\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type: TestType::Unknown,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     };\n \n     crate::bench::benchmark(TestId(0), desc, tx, true, f);\n@@ -778,20 +795,22 @@ fn should_sort_failures_before_printing_them() {\n         name: StaticTestName(\"a\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type: TestType::Unknown,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     };\n \n     let test_b = TestDesc {\n         name: StaticTestName(\"b\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type: TestType::Unknown,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     };\n \n     let mut out = PrettyFormatter::new(OutputLocation::Raw(Vec::new()), false, 10, false, None);\n@@ -802,7 +821,6 @@ fn should_sort_failures_before_printing_them() {\n         passed: 0,\n         failed: 0,\n         ignored: 0,\n-        allowed_fail: 0,\n         filtered_out: 0,\n         measured: 0,\n         exec_time: None,"}, {"sha": "43e5a10ebbe95a02f6184410fb9368e7556a1f1f", "filename": "library/test/src/types.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/library%2Ftest%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftypes.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -118,10 +118,11 @@ pub struct TestDesc {\n     pub name: TestName,\n     pub ignore: bool,\n     pub should_panic: options::ShouldPanic,\n-    pub allow_fail: bool,\n     pub compile_fail: bool,\n     pub no_run: bool,\n     pub test_type: TestType,\n+    #[cfg(bootstrap)]\n+    pub allow_fail: bool,\n }\n \n impl TestDesc {\n@@ -150,9 +151,6 @@ impl TestDesc {\n             }\n             options::ShouldPanic::No => {}\n         }\n-        if self.allow_fail {\n-            return Some(\"allow fail\");\n-        }\n         if self.compile_fail {\n             return Some(\"compile fail\");\n         }"}, {"sha": "6c55721c0dd9422dcd6f03ad8de6c9ca7841662d", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -951,10 +951,11 @@ impl Tester for Collector {\n                 },\n                 // compiler failures are test failures\n                 should_panic: test::ShouldPanic::No,\n-                allow_fail: config.allow_fail,\n                 compile_fail: config.compile_fail,\n                 no_run,\n                 test_type: test::TestType::DocTest,\n+                #[cfg(bootstrap)]\n+                allow_fail: false,\n             },\n             testfn: test::DynTestFn(box move || {\n                 let report_unused_externs = |uext| {"}, {"sha": "a40181352f6c03a19fc955b8ff8c21c85c2586e7", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -847,7 +847,6 @@ crate struct LangString {\n     crate test_harness: bool,\n     crate compile_fail: bool,\n     crate error_codes: Vec<String>,\n-    crate allow_fail: bool,\n     crate edition: Option<Edition>,\n }\n \n@@ -869,7 +868,6 @@ impl Default for LangString {\n             test_harness: false,\n             compile_fail: false,\n             error_codes: Vec::new(),\n-            allow_fail: false,\n             edition: None,\n         }\n     }\n@@ -943,10 +941,6 @@ impl LangString {\n                         seen_rust_tags = !seen_other_tags;\n                     }\n                 }\n-                \"allow_fail\" => {\n-                    data.allow_fail = true;\n-                    seen_rust_tags = !seen_other_tags;\n-                }\n                 \"rust\" => {\n                     data.rust = true;\n                     seen_rust_tags = true;\n@@ -994,12 +988,6 @@ impl LangString {\n                             \"the code block will either not be tested if not marked as a rust one \\\n                              or will be run (which you might not want)\",\n                         ))\n-                    } else if s == \"allow-fail\" || s == \"allow_fail\" || s == \"allowfail\" {\n-                        Some((\n-                            \"allow_fail\",\n-                            \"the code block will either not be tested if not marked as a rust one \\\n-                             or will be run (which you might not want)\",\n-                        ))\n                     } else if s == \"test-harness\" || s == \"test_harness\" || s == \"testharness\" {\n                         Some((\n                             \"test_harness\","}, {"sha": "ea6575d179d86716a10891c598c41b9ca20a2e8a", "filename": "src/librustdoc/html/markdown/tests.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -70,7 +70,6 @@ fn test_lang_string_parse() {\n         compile_fail: true,\n         ..Default::default()\n     });\n-    t(LangString { original: \"allow_fail\".into(), allow_fail: true, ..Default::default() });\n     t(LangString { original: \"no_run,example\".into(), no_run: true, ..Default::default() });\n     t(LangString {\n         original: \"sh,should_panic\".into(),"}, {"sha": "e2c778aa8650964a540d747c0ace08018a7bda80", "filename": "src/test/run-make-fulldeps/libtest-json/output-default.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-default.json", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-default.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-default.json?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -7,4 +7,4 @@\n { \"type\": \"test\", \"name\": \"c\", \"event\": \"ok\" }\n { \"type\": \"test\", \"event\": \"started\", \"name\": \"d\" }\n { \"type\": \"test\", \"name\": \"d\", \"event\": \"ignored\" }\n-{ \"type\": \"suite\", \"event\": \"failed\", \"passed\": 2, \"failed\": 1, \"allowed_fail\": 0, \"ignored\": 1, \"measured\": 0, \"filtered_out\": 0, \"exec_time\": $TIME }\n+{ \"type\": \"suite\", \"event\": \"failed\", \"passed\": 2, \"failed\": 1, \"ignored\": 1, \"measured\": 0, \"filtered_out\": 0, \"exec_time\": $TIME }"}, {"sha": "68eb00c297ea72a175bbd3c3b952572503d62478", "filename": "src/test/run-make-fulldeps/libtest-json/output-stdout-success.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-stdout-success.json", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-stdout-success.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Flibtest-json%2Foutput-stdout-success.json?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -7,4 +7,4 @@\n { \"type\": \"test\", \"name\": \"c\", \"event\": \"ok\", \"stdout\": \"thread 'main' panicked at 'assertion failed: false', f.rs:15:5\\n\" }\n { \"type\": \"test\", \"event\": \"started\", \"name\": \"d\" }\n { \"type\": \"test\", \"name\": \"d\", \"event\": \"ignored\" }\n-{ \"type\": \"suite\", \"event\": \"failed\", \"passed\": 2, \"failed\": 1, \"allowed_fail\": 0, \"ignored\": 1, \"measured\": 0, \"filtered_out\": 0, \"exec_time\": $TIME }\n+{ \"type\": \"suite\", \"event\": \"failed\", \"passed\": 2, \"failed\": 1, \"ignored\": 1, \"measured\": 0, \"filtered_out\": 0, \"exec_time\": $TIME }"}, {"sha": "e955470148a16cba9c857c43d0877f5d9f99f539", "filename": "src/test/rustdoc-ui/check-attr-test.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -23,13 +23,6 @@ pub fn bar() {}\n /// ```\n pub fn foobar() {}\n \n-/// barfoo\n-///\n-/// ```allow-fail,allowfail,allOw_fail\n-/// boo\n-/// ```\n-pub fn barfoo() {}\n-\n /// b\n ///\n /// ```test-harness,testharness,tesT_harness"}, {"sha": "b1fa9edf0e4cb3cb6ed3c688e5a8ce3f50cb0c1e", "filename": "src/test/rustdoc-ui/check-attr-test.stderr", "status": "modified", "additions": 12, "deletions": 48, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-attr-test.stderr?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -111,77 +111,41 @@ error: unknown attribute `nO_run`. Did you mean `no_run`?\n    |\n    = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n \n-error: unknown attribute `allow-fail`. Did you mean `allow_fail`?\n+error: unknown attribute `test-harness`. Did you mean `test_harness`?\n   --> $DIR/check-attr-test.rs:26:1\n    |\n-26 | / /// barfoo\n+26 | / /// b\n 27 | | ///\n-28 | | /// ```allow-fail,allowfail,allOw_fail\n+28 | | /// ```test-harness,testharness,tesT_harness\n 29 | | /// boo\n 30 | | /// ```\n    | |_______^\n    |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n+   = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n-error: unknown attribute `allowfail`. Did you mean `allow_fail`?\n+error: unknown attribute `testharness`. Did you mean `test_harness`?\n   --> $DIR/check-attr-test.rs:26:1\n    |\n-26 | / /// barfoo\n+26 | / /// b\n 27 | | ///\n-28 | | /// ```allow-fail,allowfail,allOw_fail\n+28 | | /// ```test-harness,testharness,tesT_harness\n 29 | | /// boo\n 30 | | /// ```\n    | |_______^\n    |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n+   = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n-error: unknown attribute `allOw_fail`. Did you mean `allow_fail`?\n+error: unknown attribute `tesT_harness`. Did you mean `test_harness`?\n   --> $DIR/check-attr-test.rs:26:1\n    |\n-26 | / /// barfoo\n+26 | / /// b\n 27 | | ///\n-28 | | /// ```allow-fail,allowfail,allOw_fail\n+28 | | /// ```test-harness,testharness,tesT_harness\n 29 | | /// boo\n 30 | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n-\n-error: unknown attribute `test-harness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr-test.rs:33:1\n-   |\n-33 | / /// b\n-34 | | ///\n-35 | | /// ```test-harness,testharness,tesT_harness\n-36 | | /// boo\n-37 | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n-\n-error: unknown attribute `testharness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr-test.rs:33:1\n-   |\n-33 | / /// b\n-34 | | ///\n-35 | | /// ```test-harness,testharness,tesT_harness\n-36 | | /// boo\n-37 | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n-\n-error: unknown attribute `tesT_harness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr-test.rs:33:1\n-   |\n-33 | / /// b\n-34 | | ///\n-35 | | /// ```test-harness,testharness,tesT_harness\n-36 | | /// boo\n-37 | | /// ```\n    | |_______^\n    |\n    = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n-error: aborting due to 15 previous errors\n+error: aborting due to 12 previous errors\n "}, {"sha": "0b3f7bedda5cf9b442a625b2a97e7bb90bd71141", "filename": "src/test/rustdoc-ui/check-attr.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -30,16 +30,6 @@ pub fn bar() {}\n /// ```\n pub fn foobar() {}\n \n-/// barfoo\n-//~^ ERROR\n-//~^^ ERROR\n-//~^^^ ERROR\n-///\n-/// ```allow-fail,allowfail,alLow_fail\n-/// boo\n-/// ```\n-pub fn barfoo() {}\n-\n /// b\n //~^ ERROR\n //~^^ ERROR"}, {"sha": "370b804c56c64a840e3cfd37d909b15342e13be3", "filename": "src/test/rustdoc-ui/check-attr.stderr", "status": "modified", "additions": 4, "deletions": 46, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fcheck-attr.stderr?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -129,50 +129,8 @@ LL | | /// ```\n    |\n    = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n \n-error: unknown attribute `allow-fail`. Did you mean `allow_fail`?\n-  --> $DIR/check-attr.rs:33:1\n-   |\n-LL | / /// barfoo\n-LL | |\n-LL | |\n-LL | |\n-...  |\n-LL | | /// boo\n-LL | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n-\n-error: unknown attribute `allowfail`. Did you mean `allow_fail`?\n-  --> $DIR/check-attr.rs:33:1\n-   |\n-LL | / /// barfoo\n-LL | |\n-LL | |\n-LL | |\n-...  |\n-LL | | /// boo\n-LL | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n-\n-error: unknown attribute `alLow_fail`. Did you mean `allow_fail`?\n-  --> $DIR/check-attr.rs:33:1\n-   |\n-LL | / /// barfoo\n-LL | |\n-LL | |\n-LL | |\n-...  |\n-LL | | /// boo\n-LL | | /// ```\n-   | |_______^\n-   |\n-   = help: the code block will either not be tested if not marked as a rust one or will be run (which you might not want)\n-\n error: unknown attribute `test-harness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr.rs:43:1\n+  --> $DIR/check-attr.rs:33:1\n    |\n LL | / /// b\n LL | |\n@@ -186,7 +144,7 @@ LL | | /// ```\n    = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n error: unknown attribute `testharness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr.rs:43:1\n+  --> $DIR/check-attr.rs:33:1\n    |\n LL | / /// b\n LL | |\n@@ -200,7 +158,7 @@ LL | | /// ```\n    = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n error: unknown attribute `teSt_harness`. Did you mean `test_harness`?\n-  --> $DIR/check-attr.rs:43:1\n+  --> $DIR/check-attr.rs:33:1\n    |\n LL | / /// b\n LL | |\n@@ -213,5 +171,5 @@ LL | | /// ```\n    |\n    = help: the code block will either not be tested if not marked as a rust one or the code will be wrapped inside a main function\n \n-error: aborting due to 15 previous errors\n+error: aborting due to 12 previous errors\n "}, {"sha": "287d4ccf18010a6e803c18fc14bc6935524e90b4", "filename": "src/test/ui/feature-gates/feature-gate-allow_fail.rs", "status": "removed", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.rs?ref=4445a8ff84e1d729df1b0320760bd8f5dd618e78", "patch": "@@ -1,8 +0,0 @@\n-// check that #[allow_fail] is feature-gated\n-\n-#[allow_fail] //~ ERROR the `#[allow_fail]` attribute is an experimental feature\n-fn ok_to_fail() {\n-    assert!(false);\n-}\n-\n-fn main() {}"}, {"sha": "76115fb9698332502d0722020bcd0fad7690dcac", "filename": "src/test/ui/feature-gates/feature-gate-allow_fail.stderr", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-allow_fail.stderr?ref=4445a8ff84e1d729df1b0320760bd8f5dd618e78", "patch": "@@ -1,12 +0,0 @@\n-error[E0658]: the `#[allow_fail]` attribute is an experimental feature\n-  --> $DIR/feature-gate-allow_fail.rs:3:1\n-   |\n-LL | #[allow_fail]\n-   | ^^^^^^^^^^^^^\n-   |\n-   = note: see issue #46488 <https://github.com/rust-lang/rust/issues/46488> for more information\n-   = help: add `#![feature(allow_fail)]` to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "29ce9f7c2e94fe3dd1d5f663cf9854e3c528e70c", "filename": "src/test/ui/test-attrs/test-allow-fail-attr.rs", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-allow-fail-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4445a8ff84e1d729df1b0320760bd8f5dd618e78/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-allow-fail-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-allow-fail-attr.rs?ref=4445a8ff84e1d729df1b0320760bd8f5dd618e78", "patch": "@@ -1,17 +0,0 @@\n-// run-pass\n-// compile-flags: --test\n-#![feature(allow_fail)]\n-#![feature(cfg_panic)]\n-\n-#[test]\n-#[allow_fail]\n-fn test1() {\n-    #[cfg(not(panic = \"abort\"))]\n-    panic!();\n-}\n-\n-#[test]\n-#[allow_fail]\n-fn test2() {\n-    assert!(true);\n-}"}, {"sha": "da7a19139c65b3f28d019b33fbeef5ad883a7e0e", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=252ff5ead0ee32b2849570bb9cddf64a7f1b1f9c", "patch": "@@ -922,10 +922,11 @@ pub fn make_test_description<R: Read>(\n         name,\n         ignore,\n         should_panic,\n-        allow_fail: false,\n         compile_fail: false,\n         no_run: false,\n         test_type: test::TestType::Unknown,\n+        #[cfg(bootstrap)]\n+        allow_fail: false,\n     }\n }\n "}]}