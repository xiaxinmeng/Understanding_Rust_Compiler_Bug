{"sha": "c91ce02600d5b41805c3d39f64fde5f9a1d01be8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5MWNlMDI2MDBkNWI0MTgwNWMzZDM5ZjY0ZmRlNWY5YTFkMDFiZTg=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-28T22:48:49Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-28T22:50:35Z"}, "message": "install: Extract function for creating absolute paths and reuse it", "tree": {"sha": "6dbc5a3b0d34844428ea0130b2d0ee81b45a80de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6dbc5a3b0d34844428ea0130b2d0ee81b45a80de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c91ce02600d5b41805c3d39f64fde5f9a1d01be8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c91ce02600d5b41805c3d39f64fde5f9a1d01be8", "html_url": "https://github.com/rust-lang/rust/commit/c91ce02600d5b41805c3d39f64fde5f9a1d01be8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c91ce02600d5b41805c3d39f64fde5f9a1d01be8/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "766a7c224bb96d9a43a99e3032af07c477d2b04d", "url": "https://api.github.com/repos/rust-lang/rust/commits/766a7c224bb96d9a43a99e3032af07c477d2b04d", "html_url": "https://github.com/rust-lang/rust/commit/766a7c224bb96d9a43a99e3032af07c477d2b04d"}], "stats": {"total": 32, "additions": 23, "deletions": 9}, "files": [{"sha": "67f48d2a0793cb9a5dbde76a8b2ab3f48944d405", "filename": "src/etc/install.sh", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/c91ce02600d5b41805c3d39f64fde5f9a1d01be8/src%2Fetc%2Finstall.sh", "raw_url": "https://github.com/rust-lang/rust/raw/c91ce02600d5b41805c3d39f64fde5f9a1d01be8/src%2Fetc%2Finstall.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Finstall.sh?ref=c91ce02600d5b41805c3d39f64fde5f9a1d01be8", "patch": "@@ -189,6 +189,16 @@ validate_opt () {\n     done\n }\n \n+absolutify() {\n+    FILE_PATH=\"${1}\"\n+    FILE_PATH_DIRNAME=\"$(dirname ${FILE_PATH})\"\n+    FILE_PATH_BASENAME=\"$(basename ${FILE_PATH})\"\n+    FILE_ABS_PATH=\"$(cd ${FILE_PATH_DIRNAME} && pwd)\"\n+    FILE_PATH=\"${FILE_ABS_PATH}/${FILE_PATH_BASENAME}\"\n+    # This is the return value\n+    ABSOLUTIFIED=\"${FILE_PATH}\"\n+}\n+\n CFG_SRC_DIR=\"$(cd $(dirname $0) && pwd)/\"\n CFG_SELF=\"$0\"\n CFG_ARGS=\"$@\"\n@@ -268,8 +278,13 @@ then\n     err \"can't install to same directory as installer\"\n fi\n \n+# Using an absolute path to libdir in a few places so that the status\n+# messages are consistently using absolute paths.\n+absolutify \"${CFG_LIBDIR}\"\n+ABS_LIBDIR=\"${ABSOLUTIFIED}\"\n+\n # The file name of the manifest we're going to create during install\n-INSTALLED_MANIFEST=\"${CFG_LIBDIR}/rustlib/manifest\"\n+INSTALLED_MANIFEST=\"${ABS_LIBDIR}/rustlib/manifest\"\n \n # First, uninstall from the installation prefix.\n # Errors are warnings - try to rm everything in the manifest even if some fail.\n@@ -293,14 +308,14 @@ then\n \n     # If we fail to remove rustlib below, then the installed manifest will\n     # still be full; the installed manifest needs to be empty before install.\n-    msg \"removing ${CFG_LIBDIR}/rustlib/manifest\"\n-    rm -f \"${CFG_LIBDIR}/rustlib/manifest\"\n+    msg \"removing ${INSTALLED_MANIFEST}\"\n+    rm -f \"${INSTALLED_MANIFEST}\"\n     # For the above reason, this is a hard error\n     need_ok \"failed to remove installed manifest\"\n \n     # Remove 'rustlib' directory\n-    msg \"removing ${CFG_LIBDIR}/rustlib\"\n-    rm -Rf \"${CFG_LIBDIR}/rustlib\"\n+    msg \"removing ${ABS_LIBDIR}/rustlib\"\n+    rm -Rf \"${ABS_LIBDIR}/rustlib\"\n     if [ $? -ne 0 ]\n     then\n         warn \"failed to remove rustlib\"\n@@ -325,6 +340,7 @@ fi\n # Create the installed manifest, which we will fill in with absolute file paths\n mkdir -p \"${CFG_LIBDIR}/rustlib\"\n touch \"${INSTALLED_MANIFEST}\"\n+need_ok \"failed to create installed manifest\"\n \n # Now install, iterate through the new manifest and copy files\n while read p; do\n@@ -350,10 +366,8 @@ while read p; do\n \n     # Make the path absolute so we can uninstall it later without\n     # starting from the installation cwd\n-    FILE_INSTALL_PATH_DIRNAME=\"$(dirname ${FILE_INSTALL_PATH})\"\n-    FILE_INSTALL_PATH_BASENAME=\"$(basename ${FILE_INSTALL_PATH})\"\n-    FILE_INSTALL_ABS_PATH=\"$(cd ${FILE_INSTALL_PATH_DIRNAME} && pwd)\"\n-    FILE_INSTALL_PATH=\"${FILE_INSTALL_ABS_PATH}/${FILE_INSTALL_PATH_BASENAME}\"\n+    absolutify \"${FILE_INSTALL_PATH}\"\n+    FILE_INSTALL_PATH=\"${ABSOLUTIFIED}\"\n \n     # Install the file\n     msg \"${FILE_INSTALL_PATH}\""}]}