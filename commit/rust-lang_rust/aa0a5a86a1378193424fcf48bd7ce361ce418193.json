{"sha": "aa0a5a86a1378193424fcf48bd7ce361ce418193", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhMGE1YTg2YTEzNzgxOTM0MjRmY2Y0OGJkN2NlMzYxY2U0MTgxOTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-02-03T14:38:52Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-02-03T14:38:52Z"}, "message": "Auto merge of #46254 - Dylan-DPC:ellided-lifetime, r=nikomatsakis\n\nelided lifetime\n\nCloses #45992\n\nHey\nHaving a problem with my config so decided to make a WIP PR nevertheless. Will add some more tests.", "tree": {"sha": "ba93434cdb38fcd6154bc2e233b62987e96ee29e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba93434cdb38fcd6154bc2e233b62987e96ee29e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa0a5a86a1378193424fcf48bd7ce361ce418193", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa0a5a86a1378193424fcf48bd7ce361ce418193", "html_url": "https://github.com/rust-lang/rust/commit/aa0a5a86a1378193424fcf48bd7ce361ce418193", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa0a5a86a1378193424fcf48bd7ce361ce418193/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d04b8fda74767c673c59ff78c1d874af0d16651", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d04b8fda74767c673c59ff78c1d874af0d16651", "html_url": "https://github.com/rust-lang/rust/commit/8d04b8fda74767c673c59ff78c1d874af0d16651"}, {"sha": "accd997b546d73ce6f59070bc4277556f27cd539", "url": "https://api.github.com/repos/rust-lang/rust/commits/accd997b546d73ce6f59070bc4277556f27cd539", "html_url": "https://github.com/rust-lang/rust/commit/accd997b546d73ce6f59070bc4277556f27cd539"}], "stats": {"total": 59, "additions": 55, "deletions": 4}, "files": [{"sha": "0577800f3f4113f92e9534a3a4b5d991126af718", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=aa0a5a86a1378193424fcf48bd7ce361ce418193", "patch": "@@ -246,6 +246,12 @@ declare_lint! {\n     \"raw pointer to an inference variable\"\n }\n \n+declare_lint! {\n+    pub ELIDED_LIFETIME_IN_PATH,\n+    Allow,\n+    \"hidden lifetime parameters are deprecated, try `Foo<'_>`\"\n+}\n+\n /// Does nothing as a lint pass, but registers some `Lint`s\n /// which are used by other parts of the compiler.\n #[derive(Copy, Clone)]\n@@ -291,7 +297,9 @@ impl LintPass for HardwiredLints {\n             UNUSED_MUT,\n             COERCE_NEVER,\n             SINGLE_USE_LIFETIME,\n-            TYVAR_BEHIND_RAW_POINTER\n+            TYVAR_BEHIND_RAW_POINTER,\n+            ELIDED_LIFETIME_IN_PATH\n+\n         )\n     }\n }"}, {"sha": "59460141166b113585fd203453f2269035fd6df0", "filename": "src/librustc/middle/resolve_lifetime.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs?ref=aa0a5a86a1378193424fcf48bd7ce361ce418193", "patch": "@@ -737,7 +737,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n \n     fn visit_lifetime(&mut self, lifetime_ref: &'tcx hir::Lifetime) {\n         if lifetime_ref.is_elided() {\n-            self.resolve_elided_lifetimes(slice::from_ref(lifetime_ref));\n+            self.resolve_elided_lifetimes(slice::from_ref(lifetime_ref), false);\n             return;\n         }\n         if lifetime_ref.is_static() {\n@@ -1444,7 +1444,7 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n         }\n \n         if params.lifetimes.iter().all(|l| l.is_elided()) {\n-            self.resolve_elided_lifetimes(&params.lifetimes);\n+            self.resolve_elided_lifetimes(&params.lifetimes, true);\n         } else {\n             for l in &params.lifetimes {\n                 self.visit_lifetime(l);\n@@ -1803,14 +1803,24 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n         }\n     }\n \n-    fn resolve_elided_lifetimes(&mut self, lifetime_refs: &'tcx [hir::Lifetime]) {\n+    fn resolve_elided_lifetimes(&mut self, lifetime_refs: &'tcx [hir::Lifetime], deprecated: bool) {\n         if lifetime_refs.is_empty() {\n             return;\n         }\n \n         let span = lifetime_refs[0].span;\n+        let id = lifetime_refs[0].id;\n         let mut late_depth = 0;\n         let mut scope = self.scope;\n+        if deprecated {\n+            self.tcx\n+                .struct_span_lint_node(\n+                    lint::builtin::ELIDED_LIFETIME_IN_PATH,\n+                    id,\n+                    span,\n+                    &format!(\"hidden lifetime parameters are deprecated, try `Foo<'_>`\"))\n+                .emit();\n+        }\n         let error = loop {\n             match *scope {\n                 // Do not assign any resolution, it will be inferred."}, {"sha": "5151abd68232cad8f4bec3a9b997baaf0cf3656a", "filename": "src/test/ui/in-band-lifetimes/ellided-lifetimes.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.rs?ref=aa0a5a86a1378193424fcf48bd7ce361ce418193", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+#![allow(warnings)]\n+#![allow(unused_variables, dead_code, unused, bad_style)]\n+#![deny(elided_lifetime_in_path)]\n+\n+struct Foo<'a> { x: &'a u32 }\n+fn foo(x: &Foo) {\n+    //~^ ERROR: hidden lifetime parameters are deprecated, try `Foo<'_>`\n+}\n+\n+fn main() {}"}, {"sha": "613a7be6ed2c14c4fe96a6eabb2d6204dae163ac", "filename": "src/test/ui/in-band-lifetimes/ellided-lifetimes.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa0a5a86a1378193424fcf48bd7ce361ce418193/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fellided-lifetimes.stderr?ref=aa0a5a86a1378193424fcf48bd7ce361ce418193", "patch": "@@ -0,0 +1,14 @@\n+error: hidden lifetime parameters are deprecated, try `Foo<'_>`\n+  --> $DIR/ellided-lifetimes.rs:15:12\n+   |\n+15 | fn foo(x: &Foo) {\n+   |            ^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/ellided-lifetimes.rs:12:9\n+   |\n+12 | #![deny(elided_lifetime_in_path)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}