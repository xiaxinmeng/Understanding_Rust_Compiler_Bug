{"sha": "2959aa446e452d2176f9db453e52047453a3904e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5NTlhYTQ0NmU0NTJkMjE3NmY5ZGI0NTNlNTIwNDc0NTNhMzkwNGU=", "commit": {"author": {"name": "Ryan Cumming", "email": "etaoins@gmail.com", "date": "2019-06-30T09:55:50Z"}, "committer": {"name": "Ryan Cumming", "email": "etaoins@gmail.com", "date": "2019-06-30T09:55:50Z"}, "message": "Remove parse error on array initializer attributes\n\nThis is actually allowed by the `rustc` parser but most attributes will\nfail later due to attributes on expressions being experimental.", "tree": {"sha": "dbbf03d1a15b142cbc14087f61c9c2ba74d7d35b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbbf03d1a15b142cbc14087f61c9c2ba74d7d35b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2959aa446e452d2176f9db453e52047453a3904e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2959aa446e452d2176f9db453e52047453a3904e", "html_url": "https://github.com/rust-lang/rust/commit/2959aa446e452d2176f9db453e52047453a3904e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2959aa446e452d2176f9db453e52047453a3904e/comments", "author": {"login": "etaoins", "id": 687534, "node_id": "MDQ6VXNlcjY4NzUzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/687534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/etaoins", "html_url": "https://github.com/etaoins", "followers_url": "https://api.github.com/users/etaoins/followers", "following_url": "https://api.github.com/users/etaoins/following{/other_user}", "gists_url": "https://api.github.com/users/etaoins/gists{/gist_id}", "starred_url": "https://api.github.com/users/etaoins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/etaoins/subscriptions", "organizations_url": "https://api.github.com/users/etaoins/orgs", "repos_url": "https://api.github.com/users/etaoins/repos", "events_url": "https://api.github.com/users/etaoins/events{/privacy}", "received_events_url": "https://api.github.com/users/etaoins/received_events", "type": "User", "site_admin": false}, "committer": {"login": "etaoins", "id": 687534, "node_id": "MDQ6VXNlcjY4NzUzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/687534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/etaoins", "html_url": "https://github.com/etaoins", "followers_url": "https://api.github.com/users/etaoins/followers", "following_url": "https://api.github.com/users/etaoins/following{/other_user}", "gists_url": "https://api.github.com/users/etaoins/gists{/gist_id}", "starred_url": "https://api.github.com/users/etaoins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/etaoins/subscriptions", "organizations_url": "https://api.github.com/users/etaoins/orgs", "repos_url": "https://api.github.com/users/etaoins/repos", "events_url": "https://api.github.com/users/etaoins/events{/privacy}", "received_events_url": "https://api.github.com/users/etaoins/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b01496538c938d6a0c904512a38e4325cc960334", "url": "https://api.github.com/repos/rust-lang/rust/commits/b01496538c938d6a0c904512a38e4325cc960334", "html_url": "https://github.com/rust-lang/rust/commit/b01496538c938d6a0c904512a38e4325cc960334"}], "stats": {"total": 76, "additions": 0, "deletions": 76}, "files": [{"sha": "6bda041416438405b3e594923793b480be51ef22", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2959aa446e452d2176f9db453e52047453a3904e/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2959aa446e452d2176f9db453e52047453a3904e/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=2959aa446e452d2176f9db453e52047453a3904e", "patch": "@@ -177,21 +177,10 @@ fn array_expr(p: &mut Parser) -> CompletedMarker {\n     //    1,\n     //    2,\n     // ];\n-    let first_member_has_attrs = p.at(T![#]);\n     attributes::outer_attributes(p);\n \n     expr(p);\n     if p.eat(T![;]) {\n-        if first_member_has_attrs {\n-            // test_err array_length_attributes\n-            // pub const A: &[i64] = &[\n-            //   #[cfg(test)]\n-            //   1;\n-            //   2,\n-            // ];\n-            p.error(\"removing an expression is not supported in this position\");\n-        }\n-\n         expr(p);\n         p.expect(T![']']);\n         return m.complete(p, ARRAY_EXPR);"}, {"sha": "ba630981dad66ad1ab653f22306142ef8ed34333", "filename": "crates/ra_syntax/tests/data/parser/inline/err/0015_array_length_attributes.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b01496538c938d6a0c904512a38e4325cc960334/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b01496538c938d6a0c904512a38e4325cc960334/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.rs?ref=b01496538c938d6a0c904512a38e4325cc960334", "patch": "@@ -1,5 +0,0 @@\n-pub const A: &[i64] = &[\n-  #[cfg(test)]\n-  1;\n-  2,\n-];"}, {"sha": "5f0e3f22cc588f1d32f2e7cda793f886e7bdd1da", "filename": "crates/ra_syntax/tests/data/parser/inline/err/0015_array_length_attributes.txt", "status": "removed", "additions": 0, "deletions": 60, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/b01496538c938d6a0c904512a38e4325cc960334/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.txt", "raw_url": "https://github.com/rust-lang/rust/raw/b01496538c938d6a0c904512a38e4325cc960334/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Ferr%2F0015_array_length_attributes.txt?ref=b01496538c938d6a0c904512a38e4325cc960334", "patch": "@@ -1,60 +0,0 @@\n-SOURCE_FILE@[0; 53)\n-  CONST_DEF@[0; 48)\n-    VISIBILITY@[0; 3)\n-      PUB_KW@[0; 3) \"pub\"\n-    WHITESPACE@[3; 4) \" \"\n-    CONST_KW@[4; 9) \"const\"\n-    WHITESPACE@[9; 10) \" \"\n-    NAME@[10; 11)\n-      IDENT@[10; 11) \"A\"\n-    COLON@[11; 12) \":\"\n-    WHITESPACE@[12; 13) \" \"\n-    REFERENCE_TYPE@[13; 19)\n-      AMP@[13; 14) \"&\"\n-      SLICE_TYPE@[14; 19)\n-        L_BRACK@[14; 15) \"[\"\n-        PATH_TYPE@[15; 18)\n-          PATH@[15; 18)\n-            PATH_SEGMENT@[15; 18)\n-              NAME_REF@[15; 18)\n-                IDENT@[15; 18) \"i64\"\n-        R_BRACK@[18; 19) \"]\"\n-    WHITESPACE@[19; 20) \" \"\n-    EQ@[20; 21) \"=\"\n-    WHITESPACE@[21; 22) \" \"\n-    REF_EXPR@[22; 48)\n-      AMP@[22; 23) \"&\"\n-      ARRAY_EXPR@[23; 48)\n-        L_BRACK@[23; 24) \"[\"\n-        WHITESPACE@[24; 27) \"\\n  \"\n-        ATTR@[27; 39)\n-          POUND@[27; 28) \"#\"\n-          TOKEN_TREE@[28; 39)\n-            L_BRACK@[28; 29) \"[\"\n-            IDENT@[29; 32) \"cfg\"\n-            TOKEN_TREE@[32; 38)\n-              L_PAREN@[32; 33) \"(\"\n-              IDENT@[33; 37) \"test\"\n-              R_PAREN@[37; 38) \")\"\n-            R_BRACK@[38; 39) \"]\"\n-        WHITESPACE@[39; 42) \"\\n  \"\n-        LITERAL@[42; 43)\n-          INT_NUMBER@[42; 43) \"1\"\n-        SEMI@[43; 44) \";\"\n-        WHITESPACE@[44; 47) \"\\n  \"\n-        LITERAL@[47; 48)\n-          INT_NUMBER@[47; 48) \"2\"\n-  ERROR@[48; 49)\n-    COMMA@[48; 49) \",\"\n-  WHITESPACE@[49; 50) \"\\n\"\n-  ERROR@[50; 51)\n-    R_BRACK@[50; 51) \"]\"\n-  ERROR@[51; 52)\n-    SEMI@[51; 52) \";\"\n-  WHITESPACE@[52; 53) \"\\n\"\n-error 44: removing an expression is not supported in this position\n-error 48: expected R_BRACK\n-error 48: expected SEMI\n-error 48: expected an item\n-error 50: expected an item\n-error 51: expected an item"}]}