{"sha": "921e311da214c64d6aad81c3b836402aed718019", "node_id": "C_kwDOAAsO6NoAKDkyMWUzMTFkYTIxNGM2NGQ2YWFkODFjM2I4MzY0MDJhZWQ3MTgwMTk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-06-29T18:35:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-29T18:35:01Z"}, "message": "Rollup merge of #98643 - voidc:valtree-ref-pretty, r=lcnr\n\nImprove pretty printing of valtrees for references\n\nThis implements the changes outlined in https://github.com/rust-lang/rust/issues/66451#issuecomment-1168859638.\n\nr? `@lcnr`\nFixes #66451", "tree": {"sha": "1fe9e64a5b53885a4dc9b6f81a81dc809f3730ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1fe9e64a5b53885a4dc9b6f81a81dc809f3730ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/921e311da214c64d6aad81c3b836402aed718019", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJivJtVCRBK7hj4Ov3rIwAAaykIAIfcULM6SuhGnZo0tevvdDgj\nJ+qruaxoZ1rSCtCe0BdJpDMKcJVGxGfxyjX1v6YIZsSwGauoI0I0Al216lUHOTXY\n+hp0Ch8m/giC6Gkdwk8l5huatMlyQR+lWRnKhRw+VwU49EFdcGB80K+0Ktnc0YfI\nu9R9RJ2liVkuFsbiX3PFk1FYPQyM1i2pZbOr/rFeefizSR6Blhy/Zxp9A9jLsNw2\npKJ3ZCy1WMbjC84mWlxeVFg2wiBqHAgsF4d1wnFvFwQRh7bECsCpM6g2OKhUSB/s\nVr3w+WCVSqAt0TXrR7cl/LIi17AIjW5i9YIfQ9y6XM+y8ixCECNiu03n2fxK2Cw=\n=LlJn\n-----END PGP SIGNATURE-----\n", "payload": "tree 1fe9e64a5b53885a4dc9b6f81a81dc809f3730ea\nparent 05c0b2e397cad7a1aec40b8d9f910e81196a06e8\nparent d048b15216a14711b386ac5322cf24583df5ed3d\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1656527701 +0200\ncommitter GitHub <noreply@github.com> 1656527701 +0200\n\nRollup merge of #98643 - voidc:valtree-ref-pretty, r=lcnr\n\nImprove pretty printing of valtrees for references\n\nThis implements the changes outlined in https://github.com/rust-lang/rust/issues/66451#issuecomment-1168859638.\n\nr? `@lcnr`\nFixes #66451\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/921e311da214c64d6aad81c3b836402aed718019", "html_url": "https://github.com/rust-lang/rust/commit/921e311da214c64d6aad81c3b836402aed718019", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/921e311da214c64d6aad81c3b836402aed718019/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05c0b2e397cad7a1aec40b8d9f910e81196a06e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/05c0b2e397cad7a1aec40b8d9f910e81196a06e8", "html_url": "https://github.com/rust-lang/rust/commit/05c0b2e397cad7a1aec40b8d9f910e81196a06e8"}, {"sha": "d048b15216a14711b386ac5322cf24583df5ed3d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d048b15216a14711b386ac5322cf24583df5ed3d", "html_url": "https://github.com/rust-lang/rust/commit/d048b15216a14711b386ac5322cf24583df5ed3d"}], "stats": {"total": 240, "additions": 138, "deletions": 102}, "files": [{"sha": "bf65fdc54ca48a6ca15525213e2091ec06326ca7", "filename": "compiler/rustc_const_eval/src/const_eval/mod.rs", "status": "modified", "additions": 0, "deletions": 78, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmod.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -5,7 +5,6 @@ use rustc_middle::mir;\n use rustc_middle::mir::interpret::{EvalToValTreeResult, GlobalId};\n use rustc_middle::ty::{self, TyCtxt};\n use rustc_span::{source_map::DUMMY_SP, symbol::Symbol};\n-use rustc_target::abi::VariantIdx;\n \n use crate::interpret::{\n     intern_const_alloc_recursive, ConstValue, InternKind, InterpCx, InterpResult, MemPlaceMeta,\n@@ -91,83 +90,6 @@ pub(crate) fn eval_to_valtree<'tcx>(\n     }\n }\n \n-/// Tries to destructure constants of type Array or Adt into the constants\n-/// of its fields.\n-pub(crate) fn try_destructure_const<'tcx>(\n-    tcx: TyCtxt<'tcx>,\n-    const_: ty::Const<'tcx>,\n-) -> Option<ty::DestructuredConst<'tcx>> {\n-    if let ty::ConstKind::Value(valtree) = const_.kind() {\n-        let branches = match valtree {\n-            ty::ValTree::Branch(b) => b,\n-            _ => return None,\n-        };\n-\n-        let (fields, variant) = match const_.ty().kind() {\n-            ty::Array(inner_ty, _) | ty::Slice(inner_ty) => {\n-                // construct the consts for the elements of the array/slice\n-                let field_consts = branches\n-                    .iter()\n-                    .map(|b| {\n-                        tcx.mk_const(ty::ConstS { kind: ty::ConstKind::Value(*b), ty: *inner_ty })\n-                    })\n-                    .collect::<Vec<_>>();\n-                debug!(?field_consts);\n-\n-                (field_consts, None)\n-            }\n-            ty::Adt(def, _) if def.variants().is_empty() => bug!(\"unreachable\"),\n-            ty::Adt(def, substs) => {\n-                let variant_idx = if def.is_enum() {\n-                    VariantIdx::from_u32(branches[0].unwrap_leaf().try_to_u32().ok()?)\n-                } else {\n-                    VariantIdx::from_u32(0)\n-                };\n-                let fields = &def.variant(variant_idx).fields;\n-                let mut field_consts = Vec::with_capacity(fields.len());\n-\n-                // Note: First element inValTree corresponds to variant of enum\n-                let mut valtree_idx = if def.is_enum() { 1 } else { 0 };\n-                for field in fields {\n-                    let field_ty = field.ty(tcx, substs);\n-                    let field_valtree = branches[valtree_idx]; // first element of branches is variant\n-                    let field_const = tcx.mk_const(ty::ConstS {\n-                        kind: ty::ConstKind::Value(field_valtree),\n-                        ty: field_ty,\n-                    });\n-                    field_consts.push(field_const);\n-                    valtree_idx += 1;\n-                }\n-                debug!(?field_consts);\n-\n-                (field_consts, Some(variant_idx))\n-            }\n-            ty::Tuple(elem_tys) => {\n-                let fields = elem_tys\n-                    .iter()\n-                    .enumerate()\n-                    .map(|(i, elem_ty)| {\n-                        let elem_valtree = branches[i];\n-                        tcx.mk_const(ty::ConstS {\n-                            kind: ty::ConstKind::Value(elem_valtree),\n-                            ty: elem_ty,\n-                        })\n-                    })\n-                    .collect::<Vec<_>>();\n-\n-                (fields, None)\n-            }\n-            _ => bug!(\"cannot destructure constant {:?}\", const_),\n-        };\n-\n-        let fields = tcx.arena.alloc_from_iter(fields.into_iter());\n-\n-        Some(ty::DestructuredConst { variant, fields })\n-    } else {\n-        None\n-    }\n-}\n-\n #[instrument(skip(tcx), level = \"debug\")]\n pub(crate) fn try_destructure_mir_constant<'tcx>(\n     tcx: TyCtxt<'tcx>,"}, {"sha": "5bf91879066f483008426082dd542e3796a7eeee", "filename": "compiler/rustc_const_eval/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_const_eval%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_const_eval%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Flib.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -42,7 +42,6 @@ pub fn provide(providers: &mut Providers) {\n     providers.eval_to_const_value_raw = const_eval::eval_to_const_value_raw_provider;\n     providers.eval_to_allocation_raw = const_eval::eval_to_allocation_raw_provider;\n     providers.const_caller_location = const_eval::const_caller_location;\n-    providers.try_destructure_const = |tcx, val| const_eval::try_destructure_const(tcx, val);\n     providers.eval_to_valtree = |tcx, param_env_and_value| {\n         let (param_env, raw) = param_env_and_value.into_parts();\n         const_eval::eval_to_valtree(tcx, param_env, raw)"}, {"sha": "575147feebc94f051bb3109d42fc16114a1cf358", "filename": "compiler/rustc_middle/src/mir/interpret/queries.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fqueries.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fqueries.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fqueries.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -205,14 +205,8 @@ impl<'tcx> TyCtxtEnsure<'tcx> {\n }\n \n impl<'tcx> TyCtxt<'tcx> {\n-    /// Destructure a type-level constant ADT or array into its variant index and its field values.\n-    /// Panics if the destructuring fails, use `try_destructure_const` for fallible version.\n-    pub fn destructure_const(self, const_: ty::Const<'tcx>) -> ty::DestructuredConst<'tcx> {\n-        self.try_destructure_const(const_).unwrap()\n-    }\n-\n     /// Destructure a mir constant ADT or array into its variant index and its field values.\n-    /// Panics if the destructuring fails, use `try_destructure_const` for fallible version.\n+    /// Panics if the destructuring fails, use `try_destructure_mir_constant` for fallible version.\n     pub fn destructure_mir_constant(\n         self,\n         param_env: ty::ParamEnv<'tcx>,"}, {"sha": "a1065eef8509dcce3020626974a751df9622f9e8", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -978,11 +978,9 @@ rustc_queries! {\n         desc { \"converting type-level constant value to mir constant value\"}\n     }\n \n-    /// Destructure a constant ADT or array into its variant index and its\n-    /// field values or return `None` if constant is invalid.\n-    ///\n-    /// Use infallible `TyCtxt::destructure_const` when you know that constant is valid.\n-    query try_destructure_const(key: ty::Const<'tcx>) -> Option<ty::DestructuredConst<'tcx>> {\n+    /// Destructures array, ADT or tuple constants into the constants\n+    /// of their fields.\n+    query destructure_const(key: ty::Const<'tcx>) -> ty::DestructuredConst<'tcx> {\n         desc { \"destructuring type level constant\"}\n     }\n "}, {"sha": "7f3b0fdccc6f11ffc9a05bef5a95a634a7102d6b", "filename": "compiler/rustc_middle/src/ty/print/pretty.rs", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -1447,7 +1447,11 @@ pub trait PrettyPrinter<'tcx>:\n                     p!(write(\"{:?}\", String::from_utf8_lossy(bytes)));\n                     return Ok(self);\n                 }\n-                _ => {}\n+                _ => {\n+                    p!(\"&\");\n+                    p!(pretty_print_const_valtree(valtree, *inner_ty, print_ty));\n+                    return Ok(self);\n+                }\n             },\n             (ty::ValTree::Branch(_), ty::Array(t, _)) if *t == u8_type => {\n                 let bytes = valtree.try_to_raw_bytes(self.tcx(), *t).unwrap_or_else(|| {\n@@ -1459,16 +1463,8 @@ pub trait PrettyPrinter<'tcx>:\n             }\n             // Aggregates, printed as array/tuple/struct/variant construction syntax.\n             (ty::ValTree::Branch(_), ty::Array(..) | ty::Tuple(..) | ty::Adt(..)) => {\n-                let Some(contents) = self.tcx().try_destructure_const(\n-                    ty::Const::from_value(self.tcx(), valtree, ty)\n-                ) else {\n-                    // Fall back to debug pretty printing for invalid constants.\n-                    p!(write(\"{:?}\", valtree));\n-                    if print_ty {\n-                        p!(\": \", print(ty));\n-                    }\n-                    return Ok(self);\n-                };\n+                let contents =\n+                    self.tcx().destructure_const(ty::Const::from_value(self.tcx(), valtree, ty));\n                 let fields = contents.fields.iter().copied();\n                 match *ty.kind() {\n                     ty::Array(..) => {"}, {"sha": "0b83cdb78dce769835558cac7481eea655b83fdf", "filename": "compiler/rustc_ty_utils/src/consts.rs", "status": "added", "additions": 77, "deletions": 0, "changes": 77, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_ty_utils%2Fsrc%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_ty_utils%2Fsrc%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fconsts.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -0,0 +1,77 @@\n+use rustc_middle::ty::{self, TyCtxt};\n+use rustc_target::abi::VariantIdx;\n+\n+use std::iter;\n+\n+/// Destructures array, ADT or tuple constants into the constants\n+/// of their fields.\n+pub(crate) fn destructure_const<'tcx>(\n+    tcx: TyCtxt<'tcx>,\n+    const_: ty::Const<'tcx>,\n+) -> ty::DestructuredConst<'tcx> {\n+    let ty::ConstKind::Value(valtree) = const_.kind() else {\n+        bug!(\"cannot destructure constant {:?}\", const_)\n+    };\n+\n+    let branches = match valtree {\n+        ty::ValTree::Branch(b) => b,\n+        _ => bug!(\"cannot destructure constant {:?}\", const_),\n+    };\n+\n+    let (fields, variant) = match const_.ty().kind() {\n+        ty::Array(inner_ty, _) | ty::Slice(inner_ty) => {\n+            // construct the consts for the elements of the array/slice\n+            let field_consts = branches\n+                .iter()\n+                .map(|b| tcx.mk_const(ty::ConstS { kind: ty::ConstKind::Value(*b), ty: *inner_ty }))\n+                .collect::<Vec<_>>();\n+            debug!(?field_consts);\n+\n+            (field_consts, None)\n+        }\n+        ty::Adt(def, _) if def.variants().is_empty() => bug!(\"unreachable\"),\n+        ty::Adt(def, substs) => {\n+            let (variant_idx, branches) = if def.is_enum() {\n+                let (head, rest) = branches.split_first().unwrap();\n+                (VariantIdx::from_u32(head.unwrap_leaf().try_to_u32().unwrap()), rest)\n+            } else {\n+                (VariantIdx::from_u32(0), branches)\n+            };\n+            let fields = &def.variant(variant_idx).fields;\n+            let mut field_consts = Vec::with_capacity(fields.len());\n+\n+            for (field, field_valtree) in iter::zip(fields, branches) {\n+                let field_ty = field.ty(tcx, substs);\n+                let field_const = tcx.mk_const(ty::ConstS {\n+                    kind: ty::ConstKind::Value(*field_valtree),\n+                    ty: field_ty,\n+                });\n+                field_consts.push(field_const);\n+            }\n+            debug!(?field_consts);\n+\n+            (field_consts, Some(variant_idx))\n+        }\n+        ty::Tuple(elem_tys) => {\n+            let fields = iter::zip(*elem_tys, branches)\n+                .map(|(elem_ty, elem_valtree)| {\n+                    tcx.mk_const(ty::ConstS {\n+                        kind: ty::ConstKind::Value(*elem_valtree),\n+                        ty: elem_ty,\n+                    })\n+                })\n+                .collect::<Vec<_>>();\n+\n+            (fields, None)\n+        }\n+        _ => bug!(\"cannot destructure constant {:?}\", const_),\n+    };\n+\n+    let fields = tcx.arena.alloc_from_iter(fields.into_iter());\n+\n+    ty::DestructuredConst { variant, fields }\n+}\n+\n+pub fn provide(providers: &mut ty::query::Providers) {\n+    *providers = ty::query::Providers { destructure_const, ..*providers };\n+}"}, {"sha": "7624d31b40bc7d851df965b3c06476b9c89a9153", "filename": "compiler/rustc_ty_utils/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_ty_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/compiler%2Frustc_ty_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Flib.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -18,6 +18,7 @@ use rustc_middle::ty::query::Providers;\n \n mod assoc;\n mod common_traits;\n+mod consts;\n pub mod instance;\n mod needs_drop;\n pub mod representability;\n@@ -26,6 +27,7 @@ mod ty;\n pub fn provide(providers: &mut Providers) {\n     assoc::provide(providers);\n     common_traits::provide(providers);\n+    consts::provide(providers);\n     needs_drop::provide(providers);\n     ty::provide(providers);\n     instance::provide(providers);"}, {"sha": "3335f7d598480c1d916fd4df3110dbcd8d78b31e", "filename": "src/test/ui/const-generics/issue-66451.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.rs", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.rs?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -0,0 +1,28 @@\n+#![feature(adt_const_params)]\n+#![allow(incomplete_features)]\n+\n+#[derive(Debug, PartialEq, Eq)]\n+struct Foo {\n+    value: i32,\n+    nested: &'static Bar<i32>,\n+}\n+\n+#[derive(Debug, PartialEq, Eq)]\n+struct Bar<T>(T);\n+\n+struct Test<const F: Foo>;\n+\n+fn main() {\n+    let x: Test<{\n+        Foo {\n+            value: 3,\n+            nested: &Bar(4),\n+        }\n+    }> = Test;\n+    let y: Test<{\n+        Foo {\n+            value: 3,\n+            nested: &Bar(5),\n+        }\n+    }> = x; //~ ERROR mismatched types\n+}"}, {"sha": "b691eac4f2d0e16d6e28bc81d9329246ac0af8c6", "filename": "src/test/ui/const-generics/issue-66451.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/921e311da214c64d6aad81c3b836402aed718019/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/921e311da214c64d6aad81c3b836402aed718019/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissue-66451.stderr?ref=921e311da214c64d6aad81c3b836402aed718019", "patch": "@@ -0,0 +1,20 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-66451.rs:27:10\n+   |\n+LL |       let y: Test<{\n+   |  ____________-\n+LL | |         Foo {\n+LL | |             value: 3,\n+LL | |             nested: &Bar(5),\n+LL | |         }\n+LL | |     }> = x;\n+   | |      -   ^ expected `Foo { value: 3_i32, nested: &Bar::<i32>(5_i32) }`, found `Foo { value: 3_i32, nested: &Bar::<i32>(4_i32) }`\n+   | |______|\n+   |        expected due to this\n+   |\n+   = note: expected struct `Test<Foo { value: 3_i32, nested: &Bar::<i32>(5_i32) }>`\n+              found struct `Test<Foo { value: 3_i32, nested: &Bar::<i32>(4_i32) }>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}