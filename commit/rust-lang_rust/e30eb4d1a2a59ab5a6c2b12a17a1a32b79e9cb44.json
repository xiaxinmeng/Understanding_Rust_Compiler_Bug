{"sha": "e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMGViNGQxYTJhNTlhYjVhNmMyYjEyYTE3YTFhMzJiNzllOWNiNDQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-07-08T16:30:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-08T16:30:39Z"}, "message": "Rollup merge of #86913 - Stupremee:document-rustdoc-private-items, r=jyn514\n\nDocument rustdoc with `--document-private-items`\n\nThe `tool_doc` macro introduced in #86737 did not use `false` as the default value for `binary` when it is not provided, so the `if` is not even expanded and thus the argument is never provided if the `binary` argument isn't.\n\nResolves #86900\n\nr? ```@Mark-Simulacrum```", "tree": {"sha": "a17939640e01188083f28c2807b7443c9f94dfb3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a17939640e01188083f28c2807b7443c9f94dfb3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg5ygvCRBK7hj4Ov3rIwAAmPsIAHWvLiyF8E3m7ESr6NuSn+WL\nehg79r6Xc3fV9u67r26Cdh0Yd+YSIFr0zv5KIYxNiHAraRHf42U9aZL5ONc397Jy\nH8YlDIQVg5BYy6vD+H215geMtqmTcfAxP7tmhnlsxy1rwTwvjhhH4a08LKAjwMEt\n0U5lsa4fJ+IGxpcQ4Bodc99olGmRhyavDv0GqS4R7t1a7jNSvAM8D28jBQwIK2Iw\nkKkJxhYW7V7iMxhp6vOZTrcNsrdoV510gxOtHoMvcy45kJUR+HD80d9WQ474bbWy\nCeB9No/RgKZ9xguBAfBGCVJ7ojGxTvNf1sNYDRu0ErhWYTbSjYL/7lpr3pwOTgo=\n=izAr\n-----END PGP SIGNATURE-----\n", "payload": "tree a17939640e01188083f28c2807b7443c9f94dfb3\nparent 46314f7d85aa6fb1dccb0f58c8f79935837fd300\nparent 27b55e636f43fdb6e49e200db79f3591993dcb98\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1625761839 +0200\ncommitter GitHub <noreply@github.com> 1625761839 +0200\n\nRollup merge of #86913 - Stupremee:document-rustdoc-private-items, r=jyn514\n\nDocument rustdoc with `--document-private-items`\n\nThe `tool_doc` macro introduced in #86737 did not use `false` as the default value for `binary` when it is not provided, so the `if` is not even expanded and thus the argument is never provided if the `binary` argument isn't.\n\nResolves #86900\n\nr? ```@Mark-Simulacrum```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44", "html_url": "https://github.com/rust-lang/rust/commit/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46314f7d85aa6fb1dccb0f58c8f79935837fd300", "url": "https://api.github.com/repos/rust-lang/rust/commits/46314f7d85aa6fb1dccb0f58c8f79935837fd300", "html_url": "https://github.com/rust-lang/rust/commit/46314f7d85aa6fb1dccb0f58c8f79935837fd300"}, {"sha": "27b55e636f43fdb6e49e200db79f3591993dcb98", "url": "https://api.github.com/repos/rust-lang/rust/commits/27b55e636f43fdb6e49e200db79f3591993dcb98", "html_url": "https://github.com/rust-lang/rust/commit/27b55e636f43fdb6e49e200db79f3591993dcb98"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "d3f2c87c0d22f4c966c2215889c60d4b9392be1d", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=e30eb4d1a2a59ab5a6c2b12a17a1a32b79e9cb44", "patch": "@@ -600,7 +600,7 @@ impl Step for Rustc {\n }\n \n macro_rules! tool_doc {\n-    ($tool: ident, $should_run: literal, $path: literal, [$($krate: literal),+ $(,)?] $(, binary=$bin:expr)?) => {\n+    ($tool: ident, $should_run: literal, $path: literal, [$($krate: literal),+ $(,)?], binary=$bin:expr) => {\n         #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n         pub struct $tool {\n             stage: u32,\n@@ -669,9 +669,9 @@ macro_rules! tool_doc {\n                     cargo.arg(\"-p\").arg($krate);\n                 )+\n \n-                $(if !$bin {\n+                if !$bin {\n                     cargo.rustdocflag(\"--document-private-items\");\n-                })?\n+                }\n                 cargo.rustdocflag(\"--enable-index-page\");\n                 cargo.rustdocflag(\"--show-type-layout\");\n                 cargo.rustdocflag(\"-Zunstable-options\");\n@@ -681,7 +681,13 @@ macro_rules! tool_doc {\n     }\n }\n \n-tool_doc!(Rustdoc, \"rustdoc-tool\", \"src/tools/rustdoc\", [\"rustdoc\", \"rustdoc-json-types\"]);\n+tool_doc!(\n+    Rustdoc,\n+    \"rustdoc-tool\",\n+    \"src/tools/rustdoc\",\n+    [\"rustdoc\", \"rustdoc-json-types\"],\n+    binary = false\n+);\n tool_doc!(\n     Rustfmt,\n     \"rustfmt-nightly\","}]}