{"sha": "64ad5928e7a8171aaf194912a500fd0c1be426d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0YWQ1OTI4ZTdhODE3MWFhZjE5NDkxMmE1MDBmZDBjMWJlNDI2ZDU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-11T18:19:32Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-11T18:19:32Z"}, "message": "Actually run tests from the std runner. Issue #428", "tree": {"sha": "4075bed4ad41f39cc819837c43ecf38d64285071", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4075bed4ad41f39cc819837c43ecf38d64285071"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64ad5928e7a8171aaf194912a500fd0c1be426d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64ad5928e7a8171aaf194912a500fd0c1be426d5", "html_url": "https://github.com/rust-lang/rust/commit/64ad5928e7a8171aaf194912a500fd0c1be426d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64ad5928e7a8171aaf194912a500fd0c1be426d5/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f666c97e6dec25f1894cf9e39bfe89f2a5d8fde3", "url": "https://api.github.com/repos/rust-lang/rust/commits/f666c97e6dec25f1894cf9e39bfe89f2a5d8fde3", "html_url": "https://github.com/rust-lang/rust/commit/f666c97e6dec25f1894cf9e39bfe89f2a5d8fde3"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "fbd9c27df22fa7845c2af6035e2cbb74bae2ff30", "filename": "src/lib/test.rs", "status": "modified", "additions": 48, "deletions": 1, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/64ad5928e7a8171aaf194912a500fd0c1be426d5/src%2Flib%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ad5928e7a8171aaf194912a500fd0c1be426d5/src%2Flib%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Ftest.rs?ref=64ad5928e7a8171aaf194912a500fd0c1be426d5", "patch": "@@ -36,16 +36,63 @@ fn test_main(&test_desc[] tests) -> int {\n }\n \n fn run_tests(&test_desc[] tests) -> bool {\n+\n     auto out = io::stdout();\n \n+    auto total = ivec::len(tests);\n+    out.write_line(#fmt(\"running %u tests\", total));\n+\n+    auto passed = 0u;\n+    auto failed = 0u;\n+\n     for (test_desc test in tests) {\n-        out.write_line(\"running \" + test.name);\n+        out.write_str(#fmt(\"running %s ... \", test.name));\n+        if (run_test(test)) {\n+            passed += 1u;\n+            write_ok(out);\n+            out.write_line(\"\");\n+        } else {\n+            failed += 1u;\n+            write_failed(out);\n+            out.write_line(\"\");\n+        }\n     }\n \n+    assert passed + failed == total;\n+\n+    out.write_str(#fmt(\"\\nresults: %u passed; %u failed\\n\\n\",\n+                        passed, failed));\n+\n     ret true;\n+\n+    fn run_test(&test_desc test) -> bool {\n+        test.fn();\n+        ret true;\n+    }\n+\n+    fn write_ok(&io::writer out) {\n+        if (term::color_supported()) {\n+            term::fg(out.get_buf_writer(), term::color_green);\n+        }\n+        out.write_str(\"ok\");\n+        if (term::color_supported()) {\n+            term::reset(out.get_buf_writer());\n+        }\n+     }\n+\n+    fn write_failed(&io::writer out) {\n+        if (term::color_supported()) {\n+            term::fg(out.get_buf_writer(), term::color_red);\n+        }\n+        out.write_str(\"FAILED\");\n+        if (term::color_supported()) {\n+            term::reset(out.get_buf_writer());\n+        }\n+    }\n }\n \n \n+\n // Local Variables:\n // mode: rust;\n // fill-column: 78;"}]}