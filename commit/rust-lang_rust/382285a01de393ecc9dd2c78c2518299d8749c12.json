{"sha": "382285a01de393ecc9dd2c78c2518299d8749c12", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM4MjI4NWEwMWRlMzkzZWNjOWRkMmM3OGMyNTE4Mjk5ZDg3NDljMTI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-07-20T09:45:07Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-07-20T09:45:07Z"}, "message": "Revert some use of `PtrKey` to fix parallel_queries build", "tree": {"sha": "e3095693d82cf984bf7fc56fc194a48f4f19fd3f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3095693d82cf984bf7fc56fc194a48f4f19fd3f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/382285a01de393ecc9dd2c78c2518299d8749c12", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/382285a01de393ecc9dd2c78c2518299d8749c12", "html_url": "https://github.com/rust-lang/rust/commit/382285a01de393ecc9dd2c78c2518299d8749c12", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/382285a01de393ecc9dd2c78c2518299d8749c12/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7aeb2b1c7e9776a6771f8d345390c2ab1ceb947", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7aeb2b1c7e9776a6771f8d345390c2ab1ceb947", "html_url": "https://github.com/rust-lang/rust/commit/e7aeb2b1c7e9776a6771f8d345390c2ab1ceb947"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "56a8c13a8d3b80864e2e19c29f5767d51f9b1518", "filename": "src/librustc/ty/query/job.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/382285a01de393ecc9dd2c78c2518299d8749c12/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/382285a01de393ecc9dd2c78c2518299d8749c12/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fjob.rs?ref=382285a01de393ecc9dd2c78c2518299d8749c12", "patch": "@@ -11,7 +11,6 @@\n #![allow(warnings)]\n \n use std::mem;\n-use rustc_data_structures::ptr_key::PtrKey;\n use rustc_data_structures::sync::{Lock, LockGuard, Lrc, Weak};\n use rustc_data_structures::OnDrop;\n use syntax_pos::Span;\n@@ -283,7 +282,7 @@ where\n fn cycle_check<'tcx>(query: Lrc<QueryJob<'tcx>>,\n                      span: Span,\n                      stack: &mut Vec<(Span, Lrc<QueryJob<'tcx>>)>,\n-                     visited: &mut HashSet<PtrKey<'tcx, QueryJob<'tcx>>>\n+                     visited: &mut HashSet<*const QueryJob<'tcx>>\n ) -> Option<Option<Waiter<'tcx>>> {\n     if visited.contains(&query.as_ptr()) {\n         return if let Some(p) = stack.iter().position(|q| q.1.as_ptr() == query.as_ptr()) {\n@@ -322,7 +321,7 @@ fn cycle_check<'tcx>(query: Lrc<QueryJob<'tcx>>,\n #[cfg(parallel_queries)]\n fn connected_to_root<'tcx>(\n     query: Lrc<QueryJob<'tcx>>,\n-    visited: &mut HashSet<PtrKey<'tcx, QueryJob<'tcx>>>\n+    visited: &mut HashSet<*const QueryJob<'tcx>>\n ) -> bool {\n     // We already visited this or we're deliberately ignoring it\n     if visited.contains(&query.as_ptr()) {"}]}