{"sha": "047c7cc60c05e2cf182c6f578581cf2a67b1d0ff", "node_id": "C_kwDOAAsO6NoAKDA0N2M3Y2M2MGMwNWUyY2YxODJjNmY1Nzg1ODFjZjJhNjdiMWQwZmY", "commit": {"author": {"name": "Alex Gaynor", "email": "alex.gaynor@gmail.com", "date": "2022-12-03T18:29:22Z"}, "committer": {"name": "Alex Gaynor", "email": "alex.gaynor@gmail.com", "date": "2022-12-03T18:29:22Z"}, "message": "Remove macOS fat archive support from LlvmArchiveBuilder\n\nits only ever used for wasm targets", "tree": {"sha": "e36fcb2a41cfdcf10da6c43384ff6b7897258398", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e36fcb2a41cfdcf10da6c43384ff6b7897258398"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff", "comment_count": 0, "verification": {"verified": false, "reason": "bad_cert", "signature": "-----BEGIN SIGNED MESSAGE-----\nMIIEBwYJKoZIhvcNAQcCoIID+DCCA/QCAQExDTALBglghkgBZQMEAgEwCwYJKoZI\nhvcNAQcBoIICqDCCAqQwggIqoAMCAQICFClOdG6PsaylLhV03PUaMr43qo4aMAoG\nCCqGSM49BAMDMDcxFTATBgNVBAoTDHNpZ3N0b3JlLmRldjEeMBwGA1UEAxMVc2ln\nc3RvcmUtaW50ZXJtZWRpYXRlMB4XDTIyMTIwMzE4MjkyNloXDTIyMTIwMzE4Mzky\nNlowADBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABP2v900ptCM7Neb3q94MNX4C\nvpG0UbsP6sDmcfwpaIs/A3PCRmL6IwL4EnI9JDH1FtjnBY6ghx3Xb3gFRQo90q+j\nggFJMIIBRTAOBgNVHQ8BAf8EBAMCB4AwEwYDVR0lBAwwCgYIKwYBBQUHAwMwHQYD\nVR0OBBYEFC28XmbzXuCcWk6eYxpkFJqABdDGMB8GA1UdIwQYMBaAFN/T6c9WJBGW\n+ajY6ShVosYuGGQ/MCMGA1UdEQEB/wQZMBeBFWFsZXguZ2F5bm9yQGdtYWlsLmNv\nbTAsBgorBgEEAYO/MAEBBB5odHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgw\ngYoGCisGAQQB1nkCBAIEfAR6AHgAdgDdPTBqxscRMmMZHhyZZzcCokpeuN48rf+H\ninKALynujgAAAYTZQBdYAAAEAwBHMEUCIQCZWS9iReJCVknFHguAJ3QaQ/M8yKNL\njv9eHbBFnbmSGgIgC06dRYXIwF9bn9BptGPnzkmj3VSCvp8RHaRhuD0jQeowCgYI\nKoZIzj0EAwMDaAAwZQIwckWEbr8Ju9wrCDHhY1YuKsy0TNx4FFu1x5yOrGAnUe6c\nqVasH/LkgJiDTD//UbAyAjEA/gwNKky0g0UMhF02iF53p3H7R/FqECrNFtKj0TY/\newSyAIAG/m+rFGO5oQf7Xib4MYIBJTCCASECAQEwTzA3MRUwEwYDVQQKEwxzaWdz\ndG9yZS5kZXYxHjAcBgNVBAMTFXNpZ3N0b3JlLWludGVybWVkaWF0ZQIUKU50bo+x\nrKUuFXTc9RoyvjeqjhowCwYJYIZIAWUDBAIBoGkwGAYJKoZIhvcNAQkDMQsGCSqG\nSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMjIxMjAzMTgyOTI3WjAvBgkqhkiG9w0B\nCQQxIgQgt95nwCBPNgNOaPCI3dhDv9GZdEnl5On13GkJOkqZBeowCgYIKoZIzj0E\nAwIERzBFAiBXqKJ7t85BVxMCVCj4MwN8nO091nM0NuHDvHIlPEUDQwIhAJfD4cPt\nmrY1DaKSRFynOyODVXSpVL9v4DeR5hKi21bb\n-----END SIGNED MESSAGE-----", "payload": "tree e36fcb2a41cfdcf10da6c43384ff6b7897258398\nparent cab4fd678c5b148a330f2bf255bf28a67dfea0fc\nauthor Alex Gaynor <alex.gaynor@gmail.com> 1670092162 -0500\ncommitter Alex Gaynor <alex.gaynor@gmail.com> 1670092162 -0500\n\nRemove macOS fat archive support from LlvmArchiveBuilder\n\nits only ever used for wasm targets\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff", "html_url": "https://github.com/rust-lang/rust/commit/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff/comments", "author": {"login": "alex", "id": 772, "node_id": "MDQ6VXNlcjc3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex", "html_url": "https://github.com/alex", "followers_url": "https://api.github.com/users/alex/followers", "following_url": "https://api.github.com/users/alex/following{/other_user}", "gists_url": "https://api.github.com/users/alex/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex/subscriptions", "organizations_url": "https://api.github.com/users/alex/orgs", "repos_url": "https://api.github.com/users/alex/repos", "events_url": "https://api.github.com/users/alex/events{/privacy}", "received_events_url": "https://api.github.com/users/alex/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alex", "id": 772, "node_id": "MDQ6VXNlcjc3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex", "html_url": "https://github.com/alex", "followers_url": "https://api.github.com/users/alex/followers", "following_url": "https://api.github.com/users/alex/following{/other_user}", "gists_url": "https://api.github.com/users/alex/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex/subscriptions", "organizations_url": "https://api.github.com/users/alex/orgs", "repos_url": "https://api.github.com/users/alex/repos", "events_url": "https://api.github.com/users/alex/events{/privacy}", "received_events_url": "https://api.github.com/users/alex/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cab4fd678c5b148a330f2bf255bf28a67dfea0fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/cab4fd678c5b148a330f2bf255bf28a67dfea0fc", "html_url": "https://github.com/rust-lang/rust/commit/cab4fd678c5b148a330f2bf255bf28a67dfea0fc"}], "stats": {"total": 14, "additions": 4, "deletions": 10}, "files": [{"sha": "36aba5bb740bd6120030c0cbf0e5d6654fa0afc8", "filename": "compiler/rustc_codegen_llvm/src/back/archive.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/047c7cc60c05e2cf182c6f578581cf2a67b1d0ff/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs?ref=047c7cc60c05e2cf182c6f578581cf2a67b1d0ff", "patch": "@@ -15,8 +15,8 @@ use crate::errors::{\n use crate::llvm::archive_ro::{ArchiveRO, Child};\n use crate::llvm::{self, ArchiveKind, LLVMMachineType, LLVMRustCOFFShortExport};\n use rustc_codegen_ssa::back::archive::{\n-    get_native_object_symbols, try_extract_macho_fat_archive, ArArchiveBuilder,\n-    ArchiveBuildFailure, ArchiveBuilder, ArchiveBuilderBuilder, UnknownArchiveKind,\n+    get_native_object_symbols, ArArchiveBuilder, ArchiveBuildFailure, ArchiveBuilder,\n+    ArchiveBuilderBuilder, UnknownArchiveKind,\n };\n \n use rustc_session::cstore::DllImport;\n@@ -66,21 +66,15 @@ impl<'a> ArchiveBuilder<'a> for LlvmArchiveBuilder<'a> {\n         archive: &Path,\n         skip: Box<dyn FnMut(&str) -> bool + 'static>,\n     ) -> io::Result<()> {\n-        let mut archive = archive.to_path_buf();\n-        if self.sess.target.llvm_target.contains(\"-apple-macosx\") {\n-            if let Some(new_archive) = try_extract_macho_fat_archive(&self.sess, &archive)? {\n-                archive = new_archive\n-            }\n-        }\n-        let archive_ro = match ArchiveRO::open(&archive) {\n+        let archive_ro = match ArchiveRO::open(archive) {\n             Ok(ar) => ar,\n             Err(e) => return Err(io::Error::new(io::ErrorKind::Other, e)),\n         };\n         if self.additions.iter().any(|ar| ar.path() == archive) {\n             return Ok(());\n         }\n         self.additions.push(Addition::Archive {\n-            path: archive,\n+            path: archive.to_path_buf(),\n             archive: archive_ro,\n             skip: Box::new(skip),\n         });"}]}