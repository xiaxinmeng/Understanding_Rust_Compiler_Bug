{"sha": "9f37b3a4c251d7caaa2870952e217be369e8e9c1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmMzdiM2E0YzI1MWQ3Y2FhYTI4NzA5NTJlMjE3YmUzNjllOGU5YzE=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-05-20T08:07:17Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-05-20T08:11:09Z"}, "message": "ci: deploy artifacts on azure", "tree": {"sha": "b3ec20d65b1936a5c028267a1fbd0db8a5c5c3b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3ec20d65b1936a5c028267a1fbd0db8a5c5c3b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f37b3a4c251d7caaa2870952e217be369e8e9c1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAlziYR8ACgkQPgar6Auq\n8ZykOxAAk9UKXehOZTrIC/S4kz5eXAFzSrjnzqU5fKKTZi2bOrrBo2Q00KDYOKs7\nrg0owCSLYUZkTc25SEC6A1HGtXeIb6Yf1ISzvXIlHv2tenP4N4qGtcB3TxCrfqhy\n7uNi0afxI7dZpDjQm3ucaoMp6mAvHc4MYpP/vV1Sp0y7vxcU5cJnkfPKScfBY3ch\nkepaR92iraRPsRF0hlfZPK6HU8tAMdXhM4sLQHyKom52zKcLx5Fzh2mgJJxMUVVF\nA7ab32SnYFhfI8E+xLYc2GS+9R7MIXjTy6Bdixd7hK/gsUPk49ggUNwIigN0CaXz\n3XvkoB+mwG8c60X88r5FkVuhxCgSadqb3nWTwe95HMkU6ozqdyTI0IvbRvlHY7iv\nICDDzk2nSqKjp+IzEZXD2Bv77LvIk/Gr15OETokF9zvIYs8VZESezVldraUW5hok\n7WD+WzMMxQwOw5IDWgntTXUnexJicb7JqYQmpacAaSCJj+oB+JSJpeZVZKkGVQW7\nRQlYyyq/MfjFGNnd3Ot/i9hFLHGtQ6DhAOPMrjhyzk9Wdf6WnO5gliAt44aRvN4X\nggchNVRuCW5XvFvoU9BZ1H9qIGZ4tZb2A0mKrTB/LzZ+D524NlYC0nKCPQRYsrEj\nhvgqKhwl+eVGuznWawe/ilcGgQEpXIipOQNLhOSk/PEzZXQwCSc=\n=Y0Yf\n-----END PGP SIGNATURE-----", "payload": "tree b3ec20d65b1936a5c028267a1fbd0db8a5c5c3b3\nparent d27cb827c60e70eb5415a45e882c8f0a1fa72f3e\nauthor Pietro Albini <pietro@pietroalbini.org> 1558339637 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1558339869 +0200\n\nci: deploy artifacts on azure\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f37b3a4c251d7caaa2870952e217be369e8e9c1", "html_url": "https://github.com/rust-lang/rust/commit/9f37b3a4c251d7caaa2870952e217be369e8e9c1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f37b3a4c251d7caaa2870952e217be369e8e9c1/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d27cb827c60e70eb5415a45e882c8f0a1fa72f3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d27cb827c60e70eb5415a45e882c8f0a1fa72f3e", "html_url": "https://github.com/rust-lang/rust/commit/d27cb827c60e70eb5415a45e882c8f0a1fa72f3e"}], "stats": {"total": 23, "additions": 17, "deletions": 6}, "files": [{"sha": "bf18518e6b1ca54516227f5271a8811b424fff18", "filename": ".azure-pipelines/steps/run-script.yml", "status": "modified", "additions": 17, "deletions": 6, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9f37b3a4c251d7caaa2870952e217be369e8e9c1/.azure-pipelines%2Fsteps%2Frun-script.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9f37b3a4c251d7caaa2870952e217be369e8e9c1/.azure-pipelines%2Fsteps%2Frun-script.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fsteps%2Frun-script.yml?ref=9f37b3a4c251d7caaa2870952e217be369e8e9c1", "patch": "@@ -1,13 +1,14 @@\n steps:\n-# Log time information from this machine and an external machine for insight into possible\n-# clock drift. Timezones don't matter since relative deltas give all the necessary info.\n+\n - bash: |\n+    # Log time information from this machine and an external machine for insight into possible\n+    # clock drift. Timezones don't matter since relative deltas give all the necessary info.\n     date && (curl -fs --head https://google.com | grep ^Date: | sed 's/Date: //g' || true)\n-  displayName: Log time information (before)\n \n-- bash: |\n     which sccache\n     stamp sh -x -c \"$RUN_SCRIPT\"\n+\n+    date && (curl -fs --head https://google.com | grep ^Date: | sed 's/Date: //g' || true)\n   env:\n     CI: true\n     CI_JOB_NAME: $(IMAGE)\n@@ -20,5 +21,15 @@ steps:\n   displayName: Run script\n \n - bash: |\n-    date && (curl -fs --head https://google.com | grep ^Date: | sed 's/Date: //g' || true)\n-  displayName: Log time information (after)\n+    deploy_dir=rustc-builds\n+    if [ \"$DEPLOY_ALT\" == \"1\" ]; then\n+        deploy_dir=rustc-builds-alt\n+    fi\n+    aws s3 cp --no-progress --recursive --acl public-read ./deploy s3://$DEPLOY_BUCKET/$deploy_dir\n+  env:\n+    # Explicitly decrypt secret variables\n+    # See https://docs.microsoft.com/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#secret-variables\n+    AWS_ACCESS_KEY_ID: $(SCCACHE_AWS_ACCESS_KEY_ID)\n+    AWS_SECRET_ACCESS_KEY: $(SCCACHE_AWS_SECRET_ACCESS_KEY)\n+  condition: and(succeeded(), or(eq(variables.DEPLOY, '1'), eq(variables.DEPLOY_ALT, '1')))\n+  displayName: Upload artifacts"}]}