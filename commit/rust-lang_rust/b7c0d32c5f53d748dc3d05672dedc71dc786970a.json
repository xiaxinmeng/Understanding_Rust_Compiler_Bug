{"sha": "b7c0d32c5f53d748dc3d05672dedc71dc786970a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3YzBkMzJjNWY1M2Q3NDhkYzNkMDU2NzJkZWRjNzFkYzc4Njk3MGE=", "commit": {"author": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-09-05T14:37:21Z"}, "committer": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-09-05T14:37:21Z"}, "message": "A few cleanups and minor improvements to mir/dataflow", "tree": {"sha": "54f4bddb49a0d176bf50dd9f86f0981b69414178", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54f4bddb49a0d176bf50dd9f86f0981b69414178"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7c0d32c5f53d748dc3d05672dedc71dc786970a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7c0d32c5f53d748dc3d05672dedc71dc786970a", "html_url": "https://github.com/rust-lang/rust/commit/b7c0d32c5f53d748dc3d05672dedc71dc786970a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7c0d32c5f53d748dc3d05672dedc71dc786970a/comments", "author": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0be2c303692cab31390e52701007cfa87867bf74", "url": "https://api.github.com/repos/rust-lang/rust/commits/0be2c303692cab31390e52701007cfa87867bf74", "html_url": "https://github.com/rust-lang/rust/commit/0be2c303692cab31390e52701007cfa87867bf74"}], "stats": {"total": 30, "additions": 12, "deletions": 18}, "files": [{"sha": "1d35bb85a21a199243561b508383932342d28e78", "filename": "src/librustc_mir/dataflow/graphviz.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs?ref=b7c0d32c5f53d748dc3d05672dedc71dc786970a", "patch": "@@ -265,15 +265,12 @@ impl<'a, 'tcx, MWF, P> dot::GraphWalk<'a> for Graph<'a, 'tcx, MWF, P>\n \n     fn edges(&self) -> dot::Edges<Edge> {\n         let mir = self.mbcx.mir();\n-        // base initial capacity on assumption every block has at\n-        // least one outgoing edge (Which should be true for all\n-        // blocks but one, the exit-block).\n-        let mut edges = Vec::with_capacity(mir.basic_blocks().len());\n-        for bb in mir.basic_blocks().indices() {\n-            let outgoing = outgoing(mir, bb);\n-            edges.extend(outgoing.into_iter());\n-        }\n-        edges.into_cow()\n+\n+        mir.basic_blocks()\n+           .indices()\n+           .flat_map(|bb| outgoing(mir, bb))\n+           .collect::<Vec<_>>()\n+           .into_cow()\n     }\n \n     fn source(&self, edge: &Edge) -> Node {"}, {"sha": "cb551df910627c4d6e8ed8b044177d0bd9974237", "filename": "src/librustc_mir/dataflow/impls/borrows.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs?ref=b7c0d32c5f53d748dc3d05672dedc71dc786970a", "patch": "@@ -168,9 +168,7 @@ impl<'a, 'gcx, 'tcx> Borrows<'a, 'gcx, 'tcx> {\n         // region, then setting that gen-bit will override any\n         // potential kill introduced here.\n         if let Some(indices) = self.borrows_out_of_scope_at_location.get(&location) {\n-            for index in indices {\n-                sets.kill(&index);\n-            }\n+            sets.kill_all(indices);\n         }\n     }\n "}, {"sha": "d6874e290d4f6cb7398fff416d826d55c70338ab", "filename": "src/librustc_mir/dataflow/mod.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs?ref=b7c0d32c5f53d748dc3d05672dedc71dc786970a", "patch": "@@ -250,8 +250,7 @@ impl<'b, 'a: 'b, 'tcx: 'a, BD> PropagationContext<'b, 'a, 'tcx, BD> where BD: Bi\n     }\n }\n \n-fn dataflow_path(context: &str, prepost: &str, path: &str) -> PathBuf {\n-    format!(\"{}_{}\", context, prepost);\n+fn dataflow_path(context: &str, path: &str) -> PathBuf {\n     let mut path = PathBuf::from(path);\n     let new_file_name = {\n         let orig_file_name = path.file_name().unwrap().to_str().unwrap();\n@@ -267,7 +266,7 @@ impl<'a, 'tcx: 'a, BD> DataflowBuilder<'a, 'tcx, BD> where BD: BitDenotation\n         where P: Fn(&BD, BD::Idx) -> DebugFormatted\n     {\n         if let Some(ref path_str) = self.print_preflow_to {\n-            let path = dataflow_path(BD::name(), \"preflow\", path_str);\n+            let path = dataflow_path(BD::name(), path_str);\n             graphviz::print_borrowck_graph_to(self, &path, p)\n         } else {\n             Ok(())\n@@ -278,9 +277,9 @@ impl<'a, 'tcx: 'a, BD> DataflowBuilder<'a, 'tcx, BD> where BD: BitDenotation\n         where P: Fn(&BD, BD::Idx) -> DebugFormatted\n     {\n         if let Some(ref path_str) = self.print_postflow_to {\n-            let path = dataflow_path(BD::name(), \"postflow\", path_str);\n+            let path = dataflow_path(BD::name(), path_str);\n             graphviz::print_borrowck_graph_to(self, &path, p)\n-        } else{\n+        } else {\n             Ok(())\n         }\n     }"}, {"sha": "732aa7904d3198ebd8d551896d8dffd898161065", "filename": "src/librustc_mir/dataflow/move_paths/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7c0d32c5f53d748dc3d05672dedc71dc786970a/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs?ref=b7c0d32c5f53d748dc3d05672dedc71dc786970a", "patch": "@@ -201,7 +201,7 @@ impl<'a, 'gcx, 'tcx> MoveDataBuilder<'a, 'gcx, 'tcx> {\n             \"done dumping moves\"\n         });\n \n-        if self.errors.len() > 0 {\n+        if !self.errors.is_empty() {\n             Err((self.data, self.errors))\n         } else {\n             Ok(self.data)"}]}