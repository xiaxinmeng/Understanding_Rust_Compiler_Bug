{"sha": "17cc9b6256c95c31944591aec683884fead4e3b6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3Y2M5YjYyNTZjOTVjMzE5NDQ1OTFhZWM2ODM4ODRmZWFkNGUzYjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-10-25T04:48:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-10-25T04:48:37Z"}, "message": "Auto merge of #77398 - wesleywiser:measureme_0_8, r=Mark-Simulacrum\n\nUpgrade to measureme 9.0.0\n\nI believe I did this correctly but there's still a reference to `measureme@0.7.1` coming from `rustc-ap-rustc_data_structures` and I'm not sure how to resolve that.\n\nr? `@Mark-Simulacrum`\n\nWe'll also need to deploy the new version of the tools on perf.rlo.", "tree": {"sha": "90c35a605e4a5af74a092f42ccd540057fa84796", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90c35a605e4a5af74a092f42ccd540057fa84796"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17cc9b6256c95c31944591aec683884fead4e3b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17cc9b6256c95c31944591aec683884fead4e3b6", "html_url": "https://github.com/rust-lang/rust/commit/17cc9b6256c95c31944591aec683884fead4e3b6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17cc9b6256c95c31944591aec683884fead4e3b6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36a74944cbf7fd29da9ddfb13a0feb485d4ca934", "url": "https://api.github.com/repos/rust-lang/rust/commits/36a74944cbf7fd29da9ddfb13a0feb485d4ca934", "html_url": "https://github.com/rust-lang/rust/commit/36a74944cbf7fd29da9ddfb13a0feb485d4ca934"}, {"sha": "5ac5556d63ac03a4d73982ca8cc8287823e876f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ac5556d63ac03a4d73982ca8cc8287823e876f1", "html_url": "https://github.com/rust-lang/rust/commit/5ac5556d63ac03a4d73982ca8cc8287823e876f1"}], "stats": {"total": 47, "additions": 22, "deletions": 25}, "files": [{"sha": "bd3a97d69c835d5ec5cee9b75a46fd9eaada09b5", "filename": "Cargo.lock", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/17cc9b6256c95c31944591aec683884fead4e3b6/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/17cc9b6256c95c31944591aec683884fead4e3b6/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=17cc9b6256c95c31944591aec683884fead4e3b6", "patch": "@@ -1967,6 +1967,17 @@ dependencies = [\n  \"rustc-hash\",\n ]\n \n+[[package]]\n+name = \"measureme\"\n+version = \"9.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"22bf8d885d073610aee20e7fa205c4341ed32a761dbde96da5fd96301a8d3e82\"\n+dependencies = [\n+ \"parking_lot 0.11.0\",\n+ \"rustc-hash\",\n+ \"smallvec 1.4.2\",\n+]\n+\n [[package]]\n name = \"memchr\"\n version = \"2.3.3\"\n@@ -3099,7 +3110,7 @@ dependencies = [\n  \"indexmap\",\n  \"jobserver\",\n  \"libc\",\n- \"measureme\",\n+ \"measureme 0.7.1\",\n  \"parking_lot 0.11.0\",\n  \"rustc-ap-rustc_graphviz\",\n  \"rustc-ap-rustc_index\",\n@@ -3501,7 +3512,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"bitflags\",\n  \"libc\",\n- \"measureme\",\n+ \"measureme 9.0.0\",\n  \"rustc-demangle\",\n  \"rustc_ast\",\n  \"rustc_attr\",\n@@ -3567,7 +3578,7 @@ dependencies = [\n  \"indexmap\",\n  \"jobserver\",\n  \"libc\",\n- \"measureme\",\n+ \"measureme 9.0.0\",\n  \"parking_lot 0.11.0\",\n  \"rustc-hash\",\n  \"rustc-rayon\",\n@@ -3872,7 +3883,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"bitflags\",\n  \"chalk-ir\",\n- \"measureme\",\n+ \"measureme 9.0.0\",\n  \"polonius-engine\",\n  \"rustc-rayon-core\",\n  \"rustc_apfloat\","}, {"sha": "f9373640dce5ea3c1f5f560a7f0cda0f7a998a07", "filename": "compiler/rustc_codegen_llvm/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_codegen_llvm%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_codegen_llvm%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2FCargo.toml?ref=17cc9b6256c95c31944591aec683884fead4e3b6", "patch": "@@ -11,7 +11,7 @@ doctest = false\n [dependencies]\n bitflags = \"1.0\"\n libc = \"0.2\"\n-measureme = \"0.7.1\"\n+measureme = \"9.0.0\"\n snap = \"1\"\n tracing = \"0.1\"\n rustc_middle = { path = \"../rustc_middle\" }"}, {"sha": "23e689fcae7963f0c00c21ef362be7003d92243b", "filename": "compiler/rustc_data_structures/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2FCargo.toml?ref=17cc9b6256c95c31944591aec683884fead4e3b6", "patch": "@@ -25,7 +25,7 @@ rustc-hash = \"1.1.0\"\n smallvec = { version = \"1.0\", features = [\"union\", \"may_dangle\"] }\n rustc_index = { path = \"../rustc_index\", package = \"rustc_index\" }\n bitflags = \"1.2.1\"\n-measureme = \"0.7.1\"\n+measureme = \"9.0.0\"\n libc = \"0.2\"\n stacker = \"0.1.12\"\n tempfile = \"3.0.5\""}, {"sha": "e598d7a683d5aefeb8d22904edaff92dd7448a1c", "filename": "compiler/rustc_data_structures/src/profiling.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs?ref=17cc9b6256c95c31944591aec683884fead4e3b6", "patch": "@@ -94,23 +94,9 @@ use std::process;\n use std::sync::Arc;\n use std::time::{Duration, Instant};\n \n-use measureme::{EventId, EventIdBuilder, SerializableString, StringId};\n+use measureme::{EventId, EventIdBuilder, Profiler, SerializableString, StringId};\n use parking_lot::RwLock;\n \n-cfg_if! {\n-    if #[cfg(any(windows, target_os = \"wasi\"))] {\n-        /// FileSerializationSink is faster on Windows\n-        type SerializationSink = measureme::FileSerializationSink;\n-    } else if #[cfg(target_arch = \"wasm32\")] {\n-        type SerializationSink = measureme::ByteVecSink;\n-    } else {\n-        /// MmapSerializatioSink is faster on macOS and Linux\n-        type SerializationSink = measureme::MmapSerializationSink;\n-    }\n-}\n-\n-type Profiler = measureme::Profiler<SerializationSink>;\n-\n bitflags::bitflags! {\n     struct EventFilter: u32 {\n         const GENERIC_ACTIVITIES = 1 << 0;\n@@ -389,7 +375,7 @@ impl SelfProfiler {\n         output_directory: &Path,\n         crate_name: Option<&str>,\n         event_filters: &Option<Vec<String>>,\n-    ) -> Result<SelfProfiler, Box<dyn Error>> {\n+    ) -> Result<SelfProfiler, Box<dyn Error + Send + Sync>> {\n         fs::create_dir_all(output_directory)?;\n \n         let crate_name = crate_name.unwrap_or(\"unknown-crate\");\n@@ -500,13 +486,13 @@ impl SelfProfiler {\n         self.event_filter_mask.contains(EventFilter::QUERY_KEYS)\n     }\n \n-    pub fn event_id_builder(&self) -> EventIdBuilder<'_, SerializationSink> {\n+    pub fn event_id_builder(&self) -> EventIdBuilder<'_> {\n         EventIdBuilder::new(&self.profiler)\n     }\n }\n \n #[must_use]\n-pub struct TimingGuard<'a>(Option<measureme::TimingGuard<'a, SerializationSink>>);\n+pub struct TimingGuard<'a>(Option<measureme::TimingGuard<'a>>);\n \n impl<'a> TimingGuard<'a> {\n     #[inline]"}, {"sha": "66532ea02f3681fa08db3fe6276b954b7866fa54", "filename": "compiler/rustc_middle/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_middle%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/17cc9b6256c95c31944591aec683884fead4e3b6/compiler%2Frustc_middle%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2FCargo.toml?ref=17cc9b6256c95c31944591aec683884fead4e3b6", "patch": "@@ -28,5 +28,5 @@ rustc_ast = { path = \"../rustc_ast\" }\n rustc_span = { path = \"../rustc_span\" }\n chalk-ir = \"0.32.0\"\n smallvec = { version = \"1.0\", features = [\"union\", \"may_dangle\"] }\n-measureme = \"0.7.1\"\n+measureme = \"9.0.0\"\n rustc_session = { path = \"../rustc_session\" }"}]}