{"sha": "3a95338f312c630e89c35ffa9e5ece97520e5253", "node_id": "C_kwDOAAsO6NoAKDNhOTUzMzhmMzEyYzYzMGU4OWMzNWZmYTllNWVjZTk3NTIwZTUyNTM", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-10-31T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-10-31T00:00:00Z"}, "message": "Remove unnecessary `Option` from `promote_candidate` return type", "tree": {"sha": "5059c250889fc5ffcf62356295b0a959182abdfb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5059c250889fc5ffcf62356295b0a959182abdfb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a95338f312c630e89c35ffa9e5ece97520e5253", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a95338f312c630e89c35ffa9e5ece97520e5253", "html_url": "https://github.com/rust-lang/rust/commit/3a95338f312c630e89c35ffa9e5ece97520e5253", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a95338f312c630e89c35ffa9e5ece97520e5253/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68b554e6af18726fe6fa8de2134c59c441e0b019", "url": "https://api.github.com/repos/rust-lang/rust/commits/68b554e6af18726fe6fa8de2134c59c441e0b019", "html_url": "https://github.com/rust-lang/rust/commit/68b554e6af18726fe6fa8de2134c59c441e0b019"}], "stats": {"total": 16, "additions": 5, "deletions": 11}, "files": [{"sha": "7bf378601e053317963dcdc036129b94c05be7e3", "filename": "compiler/rustc_const_eval/src/transform/promote_consts.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3a95338f312c630e89c35ffa9e5ece97520e5253/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a95338f312c630e89c35ffa9e5ece97520e5253/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs?ref=3a95338f312c630e89c35ffa9e5ece97520e5253", "patch": "@@ -835,11 +835,7 @@ impl<'a, 'tcx> Promoter<'a, 'tcx> {\n         new_temp\n     }\n \n-    fn promote_candidate(\n-        mut self,\n-        candidate: Candidate,\n-        next_promoted_id: usize,\n-    ) -> Option<Body<'tcx>> {\n+    fn promote_candidate(mut self, candidate: Candidate, next_promoted_id: usize) -> Body<'tcx> {\n         let def = self.source.source.with_opt_param();\n         let mut rvalue = {\n             let promoted = &mut self.promoted;\n@@ -938,7 +934,7 @@ impl<'a, 'tcx> Promoter<'a, 'tcx> {\n \n         let span = self.promoted.span;\n         self.assign(RETURN_PLACE, rvalue, span);\n-        Some(self.promoted)\n+        self.promoted\n     }\n }\n \n@@ -1011,11 +1007,9 @@ pub fn promote_candidates<'tcx>(\n             keep_original: false,\n         };\n \n-        //FIXME(oli-obk): having a `maybe_push()` method on `IndexVec` might be nice\n-        if let Some(mut promoted) = promoter.promote_candidate(candidate, promotions.len()) {\n-            promoted.source.promoted = Some(promotions.next_index());\n-            promotions.push(promoted);\n-        }\n+        let mut promoted = promoter.promote_candidate(candidate, promotions.len());\n+        promoted.source.promoted = Some(promotions.next_index());\n+        promotions.push(promoted);\n     }\n \n     // Insert each of `extra_statements` before its indicated location, which"}]}