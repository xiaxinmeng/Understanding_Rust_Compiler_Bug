{"sha": "3c4a58622128887778c6fd7c35de66f3fa463708", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjNGE1ODYyMjEyODg4Nzc3OGM2ZmQ3YzM1ZGU2NmYzZmE0NjM3MDg=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-07T18:01:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-07T18:01:43Z"}, "message": "Rollup merge of #64098 - Mark-Simulacrum:always-warn, r=alexcrichton\n\nEnsure edition lints and internal lints are enabled with deny-warnings=false\n\nPreviously we only passed the deny command line flags if deny-warnings was enabled, but now we either pass -W... or -D... for each of the flags as appropriate.\n\nThis is also a breaking change to x.py as it changes `--warnings=allow` to `--warnings=warn` which is what that flag actually did; we don't have an allow warnings mode.", "tree": {"sha": "115597017ec6ea54fad54ff982923db0d4c14b06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/115597017ec6ea54fad54ff982923db0d4c14b06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c4a58622128887778c6fd7c35de66f3fa463708", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdc/CHCRBK7hj4Ov3rIwAAdHIIAGGQnsy6rvFmQAZqAvnB/ha9\n/sJn8RTmhf39gYhy33BZaZCRFcS+NA+8egcXtVweyP7s7Au/QlXqgTu1Cv8P33bI\nhHiWO3tpuce1E1EQk+C583O4kCKYMcxbqQm8M6RYM/Y16fK5u23AmO9x3ca/1dR9\njiEDSLG5bRFt6y+p5buqovwbK0i75P8c3MhVfKgQyM5i0Oopv/9hY1MAA8PrX8k0\nQHc9h4em6VjoW4ZRo7ftJlyCZEt9W3sKGsej+fYiZ2DvAJ1497AU384AKRV5XAwa\nQn7N4LAMvxhQBgrhMoByQUhM9q8Rwhks4SziKiRZbB3nvCfzVsr/hO3h2RjiM7w=\n=7OQS\n-----END PGP SIGNATURE-----\n", "payload": "tree 115597017ec6ea54fad54ff982923db0d4c14b06\nparent 8bee18baa341cb315bc2b86f3f9a375f8ce01739\nparent fda251b966ec5a8d1c3c001242777861f15b95e2\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1567879303 +0200\ncommitter GitHub <noreply@github.com> 1567879303 +0200\n\nRollup merge of #64098 - Mark-Simulacrum:always-warn, r=alexcrichton\n\nEnsure edition lints and internal lints are enabled with deny-warnings=false\n\nPreviously we only passed the deny command line flags if deny-warnings was enabled, but now we either pass -W... or -D... for each of the flags as appropriate.\n\nThis is also a breaking change to x.py as it changes `--warnings=allow` to `--warnings=warn` which is what that flag actually did; we don't have an allow warnings mode.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c4a58622128887778c6fd7c35de66f3fa463708", "html_url": "https://github.com/rust-lang/rust/commit/3c4a58622128887778c6fd7c35de66f3fa463708", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c4a58622128887778c6fd7c35de66f3fa463708/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8bee18baa341cb315bc2b86f3f9a375f8ce01739", "url": "https://api.github.com/repos/rust-lang/rust/commits/8bee18baa341cb315bc2b86f3f9a375f8ce01739", "html_url": "https://github.com/rust-lang/rust/commit/8bee18baa341cb315bc2b86f3f9a375f8ce01739"}, {"sha": "fda251b966ec5a8d1c3c001242777861f15b95e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/fda251b966ec5a8d1c3c001242777861f15b95e2", "html_url": "https://github.com/rust-lang/rust/commit/fda251b966ec5a8d1c3c001242777861f15b95e2"}], "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "84415baa3a14085a63b572e0e4d625c18d077a42", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=3c4a58622128887778c6fd7c35de66f3fa463708", "patch": "@@ -119,17 +119,18 @@ fn main() {\n         cmd.arg(format!(\"-Cdebuginfo={}\", debuginfo_level));\n     }\n \n-    if env::var_os(\"RUSTC_DENY_WARNINGS\").is_some() &&\n-       env::var_os(\"RUSTC_EXTERNAL_TOOL\").is_none() {\n+    if env::var_os(\"RUSTC_EXTERNAL_TOOL\").is_none() {\n         // When extending this list, add the new lints to the RUSTFLAGS of the\n         // build_bootstrap function of src/bootstrap/bootstrap.py as well as\n         // some code doesn't go through this `rustc` wrapper.\n-        cmd.arg(\"-Dwarnings\");\n-        cmd.arg(\"-Drust_2018_idioms\");\n-        cmd.arg(\"-Dunused_lifetimes\");\n+        cmd.arg(\"-Wrust_2018_idioms\");\n+        cmd.arg(\"-Wunused_lifetimes\");\n         if use_internal_lints(crate_name) {\n             cmd.arg(\"-Zunstable-options\");\n-            cmd.arg(\"-Drustc::internal\");\n+            cmd.arg(\"-Wrustc::internal\");\n+        }\n+        if env::var_os(\"RUSTC_DENY_WARNINGS\").is_some() {\n+            cmd.arg(\"-Dwarnings\");\n         }\n     }\n "}, {"sha": "e0e4c076071b65b3c71150359c5ffe38d4896c65", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=3c4a58622128887778c6fd7c35de66f3fa463708", "patch": "@@ -631,8 +631,9 @@ def build_bootstrap(self):\n         target_linker = self.get_toml(\"linker\", build_section)\n         if target_linker is not None:\n             env[\"RUSTFLAGS\"] += \"-C linker=\" + target_linker + \" \"\n+        env[\"RUSTFLAGS\"] += \" -Wrust_2018_idioms -Wunused_lifetimes \"\n         if self.get_toml(\"deny-warnings\", \"rust\") != \"false\":\n-            env[\"RUSTFLAGS\"] += \"-Dwarnings -Drust_2018_idioms -Dunused_lifetimes \"\n+            env[\"RUSTFLAGS\"] += \"-Dwarnings \"\n \n         env[\"PATH\"] = os.path.join(self.bin_root(), \"bin\") + \\\n             os.pathsep + env[\"PATH\"]"}, {"sha": "d9580b598155edc946002b2a77efa6ad0d73ad7f", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a58622128887778c6fd7c35de66f3fa463708/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=3c4a58622128887778c6fd7c35de66f3fa463708", "patch": "@@ -36,7 +36,7 @@ pub struct Flags {\n     // This overrides the deny-warnings configuation option,\n     // which passes -Dwarnings to the compiler invocations.\n     //\n-    // true => deny, false => allow\n+    // true => deny, false => warn\n     pub deny_warnings: Option<bool>,\n }\n \n@@ -556,10 +556,10 @@ fn split(s: &[String]) -> Vec<String> {\n fn parse_deny_warnings(matches: &getopts::Matches) -> Option<bool> {\n     match matches.opt_str(\"warnings\").as_ref().map(|v| v.as_str()) {\n         Some(\"deny\") => Some(true),\n-        Some(\"allow\") => Some(false),\n+        Some(\"warn\") => Some(false),\n         Some(value) => {\n             eprintln!(\n-                r#\"invalid value for --warnings: {:?}, expected \"allow\" or \"deny\"\"#,\n+                r#\"invalid value for --warnings: {:?}, expected \"warn\" or \"deny\"\"#,\n                 value,\n                 );\n             process::exit(1);"}]}