{"sha": "39231b4b503955626c1ccf965b8328ac67c523bb", "node_id": "C_kwDOAAsO6NoAKDM5MjMxYjRiNTAzOTU1NjI2YzFjY2Y5NjViODMyOGFjNjdjNTIzYmI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-28T14:27:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-28T14:27:51Z"}, "message": "Auto merge of #8385 - cameron1024:doc_link_with_quotes, r=llogiq\n\nadd doc_link_with_quotes lint\n\nI'm not sure about wording, it seems OK to me but happy to change if other people have better ideas\n\ncloses #8383\n\n---\nchangelog: add [`doc_link_with_quotes`] lint", "tree": {"sha": "86535068d198165ca21390f001f99e31f10d8030", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86535068d198165ca21390f001f99e31f10d8030"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39231b4b503955626c1ccf965b8328ac67c523bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39231b4b503955626c1ccf965b8328ac67c523bb", "html_url": "https://github.com/rust-lang/rust/commit/39231b4b503955626c1ccf965b8328ac67c523bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39231b4b503955626c1ccf965b8328ac67c523bb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5920fa35169b2ab6fa7335dccf26c9b4626016ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/5920fa35169b2ab6fa7335dccf26c9b4626016ab", "html_url": "https://github.com/rust-lang/rust/commit/5920fa35169b2ab6fa7335dccf26c9b4626016ab"}, {"sha": "c9be57dbf3d4a376620d6c29ef4cc486a1735dcb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9be57dbf3d4a376620d6c29ef4cc486a1735dcb", "html_url": "https://github.com/rust-lang/rust/commit/c9be57dbf3d4a376620d6c29ef4cc486a1735dcb"}], "stats": {"total": 87, "additions": 87, "deletions": 0}, "files": [{"sha": "3aaa79a1719c231be2b76c08cd8d44a7b11835c0", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -3362,6 +3362,7 @@ Released 2018-09-13\n [`disallowed_type`]: https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_type\n [`disallowed_types`]: https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_types\n [`diverging_sub_expression`]: https://rust-lang.github.io/rust-clippy/master/index.html#diverging_sub_expression\n+[`doc_link_with_quotes`]: https://rust-lang.github.io/rust-clippy/master/index.html#doc_link_with_quotes\n [`doc_markdown`]: https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown\n [`double_comparisons`]: https://rust-lang.github.io/rust-clippy/master/index.html#double_comparisons\n [`double_must_use`]: https://rust-lang.github.io/rust-clippy/master/index.html#double_must_use"}, {"sha": "cb07f57e87006ff95368b8619b4bb559f983bc8a", "filename": "clippy_lints/src/doc_link_with_quotes.rs", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Fdoc_link_with_quotes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Fdoc_link_with_quotes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc_link_with_quotes.rs?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -0,0 +1,60 @@\n+use clippy_utils::diagnostics::span_lint;\n+use itertools::Itertools;\n+use rustc_ast::{AttrKind, Attribute};\n+use rustc_lint::{EarlyContext, EarlyLintPass};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+\n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Detects the syntax `['foo']` in documentation comments (notice quotes instead of backticks)\n+    /// outside of code blocks\n+    /// ### Why is this bad?\n+    /// It is likely a typo when defining an intra-doc link\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    /// /// See also: ['foo']\n+    /// fn bar() {}\n+    /// ```\n+    /// Use instead:\n+    /// ```rust\n+    /// /// See also: [`foo`]\n+    /// fn bar() {}\n+    /// ```\n+    #[clippy::version = \"1.60.0\"]\n+    pub DOC_LINK_WITH_QUOTES,\n+    pedantic,\n+    \"possible typo for an intra-doc link\"\n+}\n+declare_lint_pass!(DocLinkWithQuotes => [DOC_LINK_WITH_QUOTES]);\n+\n+impl EarlyLintPass for DocLinkWithQuotes {\n+    fn check_attribute(&mut self, ctx: &EarlyContext<'_>, attr: &Attribute) {\n+        if let AttrKind::DocComment(_, symbol) = attr.kind {\n+            if contains_quote_link(symbol.as_str()) {\n+                span_lint(\n+                    ctx,\n+                    DOC_LINK_WITH_QUOTES,\n+                    attr.span,\n+                    \"possible intra-doc link using quotes instead of backticks\",\n+                );\n+            }\n+        }\n+    }\n+}\n+\n+fn contains_quote_link(s: &str) -> bool {\n+    let mut in_backticks = false;\n+    let mut found_opening = false;\n+\n+    for c in s.chars().tuple_windows::<(char, char)>() {\n+        match c {\n+            ('`', _) => in_backticks = !in_backticks,\n+            ('[', '\\'') if !in_backticks => found_opening = true,\n+            ('\\'', ']') if !in_backticks && found_opening => return true,\n+            _ => {},\n+        }\n+    }\n+\n+    false\n+}"}, {"sha": "1f2132cf6200326b06f423e986391778430c91b4", "filename": "clippy_lints/src/lib.register_lints.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.register_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.register_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_lints.rs?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -124,6 +124,7 @@ store.register_lints(&[\n     doc::MISSING_PANICS_DOC,\n     doc::MISSING_SAFETY_DOC,\n     doc::NEEDLESS_DOCTEST_MAIN,\n+    doc_link_with_quotes::DOC_LINK_WITH_QUOTES,\n     double_comparison::DOUBLE_COMPARISONS,\n     double_parens::DOUBLE_PARENS,\n     drop_forget_ref::DROP_COPY,"}, {"sha": "5684972b8bedfde3acb8d4851f6ee4b22943b81d", "filename": "clippy_lints/src/lib.register_pedantic.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.register_pedantic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.register_pedantic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_pedantic.rs?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -26,6 +26,7 @@ store.register_group(true, \"clippy::pedantic\", Some(\"clippy_pedantic\"), vec![\n     LintId::of(doc::DOC_MARKDOWN),\n     LintId::of(doc::MISSING_ERRORS_DOC),\n     LintId::of(doc::MISSING_PANICS_DOC),\n+    LintId::of(doc_link_with_quotes::DOC_LINK_WITH_QUOTES),\n     LintId::of(empty_enum::EMPTY_ENUM),\n     LintId::of(enum_variants::MODULE_NAME_REPETITIONS),\n     LintId::of(eta_reduction::REDUNDANT_CLOSURE_FOR_METHOD_CALLS),"}, {"sha": "d611600cf711b36d854704b029184f762c1c70e9", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -208,6 +208,7 @@ mod disallowed_methods;\n mod disallowed_script_idents;\n mod disallowed_types;\n mod doc;\n+mod doc_link_with_quotes;\n mod double_comparison;\n mod double_parens;\n mod drop_forget_ref;\n@@ -886,6 +887,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(move || Box::new(borrow_as_ptr::BorrowAsPtr::new(msrv)));\n     store.register_late_pass(move || Box::new(manual_bits::ManualBits::new(msrv)));\n     store.register_late_pass(|| Box::new(default_union_representation::DefaultUnionRepresentation));\n+    store.register_early_pass(|| Box::new(doc_link_with_quotes::DocLinkWithQuotes));\n     store.register_late_pass(|| Box::new(only_used_in_recursion::OnlyUsedInRecursion));\n     store.register_late_pass(|| Box::new(significant_drop_in_scrutinee::SignificantDropInScrutinee));\n     let allow_dbg_in_tests = conf.allow_dbg_in_tests;"}, {"sha": "ab52fb1a4a69eebe55c83af2599c4919f13f8532", "filename": "tests/ui/doc_link_with_quotes.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/tests%2Fui%2Fdoc_link_with_quotes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/tests%2Fui%2Fdoc_link_with_quotes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc_link_with_quotes.rs?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -0,0 +1,12 @@\n+#![warn(clippy::doc_link_with_quotes)]\n+\n+fn main() {\n+    foo()\n+}\n+\n+/// Calls ['bar']\n+pub fn foo() {\n+    bar()\n+}\n+\n+pub fn bar() {}"}, {"sha": "bf6d57d8afe8c8788eae2122b30a1e2f69963bb0", "filename": "tests/ui/doc_link_with_quotes.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/39231b4b503955626c1ccf965b8328ac67c523bb/tests%2Fui%2Fdoc_link_with_quotes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/39231b4b503955626c1ccf965b8328ac67c523bb/tests%2Fui%2Fdoc_link_with_quotes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc_link_with_quotes.stderr?ref=39231b4b503955626c1ccf965b8328ac67c523bb", "patch": "@@ -0,0 +1,10 @@\n+error: possible intra-doc link using quotes instead of backticks\n+  --> $DIR/doc_link_with_quotes.rs:7:1\n+   |\n+LL | /// Calls ['bar']\n+   | ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::doc-link-with-quotes` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}