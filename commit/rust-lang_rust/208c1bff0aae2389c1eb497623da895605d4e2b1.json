{"sha": "208c1bff0aae2389c1eb497623da895605d4e2b1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwOGMxYmZmMGFhZTIzODljMWViNDk3NjIzZGE4OTU2MDVkNGUyYjE=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-12-29T21:23:19Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-12-30T17:01:34Z"}, "message": "Support `-Z ui-testing=yes/no`", "tree": {"sha": "c76cc3625d29d7ea878d2740f2debd00d031f66e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c76cc3625d29d7ea878d2740f2debd00d031f66e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/208c1bff0aae2389c1eb497623da895605d4e2b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/208c1bff0aae2389c1eb497623da895605d4e2b1", "html_url": "https://github.com/rust-lang/rust/commit/208c1bff0aae2389c1eb497623da895605d4e2b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/208c1bff0aae2389c1eb497623da895605d4e2b1/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fb43801368ae8b5931583f813071120bed55c35", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fb43801368ae8b5931583f813071120bed55c35", "html_url": "https://github.com/rust-lang/rust/commit/0fb43801368ae8b5931583f813071120bed55c35"}], "stats": {"total": 44, "additions": 17, "deletions": 27}, "files": [{"sha": "75bd6babe16ec5607eb074e05a0ce1bd5513814c", "filename": "src/librustc_session/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fconfig.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -593,6 +593,12 @@ impl Options {\n     }\n }\n \n+impl DebuggingOptions {\n+    pub fn ui_testing(&self) -> bool {\n+        self.ui_testing.unwrap_or(false)\n+    }\n+}\n+\n // The type of entry function, so users can have their own entry functions\n #[derive(Copy, Clone, PartialEq, Hash, Debug)]\n pub enum EntryFnType {"}, {"sha": "3683daf7a87de801419d69dc9ad8616056654beb", "filename": "src/librustc_session/options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Foptions.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -904,7 +904,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         `mir` (the MIR), or `mir-cfg` (graphviz formatted MIR)\"),\n     run_dsymutil: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"run `dsymutil` and delete intermediate object files\"),\n-    ui_testing: bool = (false, parse_bool, [UNTRACKED],\n+    ui_testing: Option<bool> = (None, parse_opt_bool, [UNTRACKED],\n         \"format compiler diagnostics in a way that's better suitable for UI testing\"),\n     embed_bitcode: bool = (false, parse_bool, [TRACKED],\n         \"embed LLVM bitcode in object files\"),"}, {"sha": "8e9de69539a86afb954047721f584b34092b8c20", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -869,7 +869,7 @@ fn default_emitter(\n                     short,\n                     external_macro_backtrace,\n                 );\n-                Box::new(emitter.ui_testing(sopts.debugging_opts.ui_testing))\n+                Box::new(emitter.ui_testing(sopts.debugging_opts.ui_testing()))\n             } else {\n                 let emitter = match dst {\n                     None => EmitterWriter::stderr(\n@@ -890,7 +890,7 @@ fn default_emitter(\n                         external_macro_backtrace,\n                     ),\n                 };\n-                Box::new(emitter.ui_testing(sopts.debugging_opts.ui_testing))\n+                Box::new(emitter.ui_testing(sopts.debugging_opts.ui_testing()))\n             }\n         }\n         (config::ErrorOutputType::Json { pretty, json_rendered }, None) => Box::new(\n@@ -901,7 +901,7 @@ fn default_emitter(\n                 json_rendered,\n                 external_macro_backtrace,\n             )\n-            .ui_testing(sopts.debugging_opts.ui_testing),\n+            .ui_testing(sopts.debugging_opts.ui_testing()),\n         ),\n         (config::ErrorOutputType::Json { pretty, json_rendered }, Some(dst)) => Box::new(\n             JsonEmitter::new(\n@@ -912,7 +912,7 @@ fn default_emitter(\n                 json_rendered,\n                 external_macro_backtrace,\n             )\n-            .ui_testing(sopts.debugging_opts.ui_testing),\n+            .ui_testing(sopts.debugging_opts.ui_testing()),\n         ),\n     }\n }"}, {"sha": "25a892062fcbb01bd273fb8484c60d43b8d2a3b9", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -273,7 +273,7 @@ impl Options {\n             error_format,\n             None,\n             debugging_options.treat_err_as_bug,\n-            debugging_options.ui_testing,\n+            debugging_options.ui_testing(),\n         );\n \n         // check for deprecated options"}, {"sha": "d5cb17674f7b2f7b60cdc467a649cd2a498028f2", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -449,7 +449,7 @@ fn main_options(options: config::Options) -> i32 {\n         options.error_format,\n         None,\n         options.debugging_options.treat_err_as_bug,\n-        options.debugging_options.ui_testing,\n+        options.debugging_options.ui_testing(),\n     );\n \n     match (options.should_test, options.markdown_input()) {\n@@ -466,7 +466,7 @@ fn main_options(options: config::Options) -> i32 {\n     let diag_opts = (\n         options.error_format,\n         options.debugging_options.treat_err_as_bug,\n-        options.debugging_options.ui_testing,\n+        options.debugging_options.ui_testing(),\n         options.edition,\n     );\n     let show_coverage = options.show_coverage;"}, {"sha": "901263c5bf8d2e18fa9c9d8e841c57171bcbd7c8", "filename": "src/test/ui/ui-testing-optout.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftest%2Fui%2Fui-testing-optout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftest%2Fui%2Fui-testing-optout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fui-testing-optout.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -1,4 +1,4 @@\n-// disable-ui-testing-normalization\n+// compile-flags: -Z ui-testing=no\n \n // Line number < 10\n type A = B; //~ ERROR"}, {"sha": "691b8d3ccfd39c28e4862de975386f77c6e6e76c", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -376,8 +376,6 @@ pub struct TestProps {\n     pub fail_mode: Option<FailMode>,\n     // rustdoc will test the output of the `--test` option\n     pub check_test_line_numbers_match: bool,\n-    // Do not pass `-Z ui-testing` to UI tests\n-    pub disable_ui_testing_normalization: bool,\n     // customized normalization rules\n     pub normalize_stdout: Vec<(String, String)>,\n     pub normalize_stderr: Vec<(String, String)>,\n@@ -422,7 +420,6 @@ impl TestProps {\n             fail_mode: None,\n             ignore_pass: false,\n             check_test_line_numbers_match: false,\n-            disable_ui_testing_normalization: false,\n             normalize_stdout: vec![],\n             normalize_stderr: vec![],\n             failure_status: -1,\n@@ -569,11 +566,6 @@ impl TestProps {\n                 self.ignore_pass = config.parse_ignore_pass(ln);\n             }\n \n-            if !self.disable_ui_testing_normalization {\n-                self.disable_ui_testing_normalization =\n-                    config.parse_disable_ui_testing_normalization(ln);\n-            }\n-\n             if let Some(rule) = config.parse_custom_normalization(ln, \"normalize-stdout\") {\n                 self.normalize_stdout.push(rule);\n             }\n@@ -826,10 +818,6 @@ impl Config {\n         }\n     }\n \n-    fn parse_disable_ui_testing_normalization(&self, line: &str) -> bool {\n-        self.parse_name_directive(line, \"disable-ui-testing-normalization\")\n-    }\n-\n     fn parse_check_test_line_numbers_match(&self, line: &str) -> bool {\n         self.parse_name_directive(line, \"check-test-line-numbers-match\")\n     }"}, {"sha": "226a12c6734b70b404118b0f7a55f238726bd3c2", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208c1bff0aae2389c1eb497623da895605d4e2b1/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=208c1bff0aae2389c1eb497623da895605d4e2b1", "patch": "@@ -1863,17 +1863,13 @@ impl<'test> TestCx<'test> {\n                 if self.props.error_patterns.is_empty() {\n                     rustc.args(&[\"--error-format\", \"json\"]);\n                 }\n-                if !self.props.disable_ui_testing_normalization {\n-                    rustc.arg(\"-Zui-testing\");\n-                }\n+                rustc.arg(\"-Zui-testing\");\n             }\n             Ui => {\n                 if !self.props.compile_flags.iter().any(|s| s.starts_with(\"--error-format\")) {\n                     rustc.args(&[\"--error-format\", \"json\"]);\n                 }\n-                if !self.props.disable_ui_testing_normalization {\n-                    rustc.arg(\"-Zui-testing\");\n-                }\n+                rustc.arg(\"-Zui-testing\");\n             }\n             MirOpt => {\n                 rustc.args(&["}]}