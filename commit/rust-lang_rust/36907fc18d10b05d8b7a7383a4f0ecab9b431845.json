{"sha": "36907fc18d10b05d8b7a7383a4f0ecab9b431845", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2OTA3ZmMxOGQxMGIwNWQ4YjdhNzM4M2E0ZjBlY2FiOWI0MzE4NDU=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-08-03T09:12:10Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-08-07T12:41:33Z"}, "message": "Also put comparing raw pointers behind a feature gate", "tree": {"sha": "174c2ada9ffe6fb325f599e7e0033794a75aa449", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/174c2ada9ffe6fb325f599e7e0033794a75aa449"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/36907fc18d10b05d8b7a7383a4f0ecab9b431845", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/36907fc18d10b05d8b7a7383a4f0ecab9b431845", "html_url": "https://github.com/rust-lang/rust/commit/36907fc18d10b05d8b7a7383a4f0ecab9b431845", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/36907fc18d10b05d8b7a7383a4f0ecab9b431845/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fc7580a8e75020c486cd73ab3b149f0df2a6abd", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fc7580a8e75020c486cd73ab3b149f0df2a6abd", "html_url": "https://github.com/rust-lang/rust/commit/1fc7580a8e75020c486cd73ab3b149f0df2a6abd"}], "stats": {"total": 68, "additions": 22, "deletions": 46}, "files": [{"sha": "3312cd78c547b59266f86f8bc0ee488a9c930552", "filename": "src/librustc_mir/diagnostics.rs", "status": "modified", "additions": 0, "deletions": 30, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibrustc_mir%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibrustc_mir%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdiagnostics.rs?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -1113,36 +1113,6 @@ fn main() {\n ```\n \"##,\n \n-E0395: r##\"\n-The value assigned to a constant scalar must be known at compile time,\n-which is not the case when comparing raw pointers.\n-\n-Erroneous code example:\n-\n-```compile_fail,E0395\n-static FOO: i32 = 42;\n-static BAR: i32 = 42;\n-\n-static BAZ: bool = { (&FOO as *const i32) == (&BAR as *const i32) };\n-// error: raw pointers cannot be compared in statics!\n-```\n-\n-The address assigned by the linker to `FOO` and `BAR` may or may not\n-be identical, so the value of `BAZ` can't be determined.\n-\n-If you want to do the comparison, please do it at run-time.\n-\n-For example:\n-\n-```\n-static FOO: i32 = 42;\n-static BAR: i32 = 42;\n-\n-let baz: bool = { (&FOO as *const i32) == (&BAR as *const i32) };\n-// baz isn't a constant expression so it's ok\n-```\n-\"##,\n-\n E0161: r##\"\n A value was moved. However, its size was not known at compile time, and only\n values of a known size can be moved."}, {"sha": "1a66a1751ffa0cede1dfa89ca0bc1e0b4ff6931b", "filename": "src/librustc_mir/transform/qualify_consts.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -752,14 +752,13 @@ impl<'a, 'tcx> Visitor<'tcx> for Qualifier<'a, 'tcx, 'tcx> {\n \n                     self.add(Qualif::NOT_CONST);\n                     if self.mode != Mode::Fn {\n-                        struct_span_err!(\n-                            self.tcx.sess, self.span, E0395,\n-                            \"raw pointers cannot be compared in {}s\",\n-                            self.mode)\n-                        .span_label(\n+                        emit_feature_err(\n+                            &self.tcx.sess.parse_sess,\n+                            \"const_compare_raw_pointers\",\n                             self.span,\n-                            \"comparing raw pointers in static\")\n-                        .emit();\n+                            GateIssue::Language,\n+                            &format!(\"comparing raw pointers inside {}\", self.mode),\n+                        );\n                     }\n                 }\n             }"}, {"sha": "a3090597096d9bf17953462d700e44eb3f8e51ca", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -225,6 +225,9 @@ declare_features! (\n     // Allows dereferencing raw pointers during const eval\n     (active, const_raw_ptr_deref, \"1.27.0\", Some(51911), None),\n \n+    // Allows comparing raw pointers during const eval\n+    (active, const_compare_raw_pointers, \"1.27.0\", Some(53020), None),\n+\n     // Allows using #[prelude_import] on glob `use` items.\n     //\n     // rustc internal"}, {"sha": "e8d1b0f54c1c009bf9738e37511e7e2045e69191", "filename": "src/test/ui/error-codes/E0395.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Ferror-codes%2FE0395.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Ferror-codes%2FE0395.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0395.rs?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -11,6 +11,6 @@\n static FOO: i32 = 42;\n static BAR: i32 = 42;\n \n-static BAZ: bool = { (&FOO as *const i32) == (&BAR as *const i32) }; //~ ERROR E0395\n+static BAZ: bool = { (&FOO as *const i32) == (&BAR as *const i32) }; //~ ERROR issue #53020\n fn main() {\n }"}, {"sha": "90f9ab9ec3641a1319e87be9e5de9d878fabd8d1", "filename": "src/test/ui/error-codes/E0395.stderr", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Ferror-codes%2FE0395.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Ferror-codes%2FE0395.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0395.stderr?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -1,9 +1,11 @@\n-error[E0395]: raw pointers cannot be compared in statics\n+error[E0658]: comparing raw pointers inside static (see issue #53020)\n   --> $DIR/E0395.rs:14:22\n    |\n-LL | static BAZ: bool = { (&FOO as *const i32) == (&BAR as *const i32) }; //~ ERROR E0395\n-   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ comparing raw pointers in static\n+LL | static BAZ: bool = { (&FOO as *const i32) == (&BAR as *const i32) }; //~ ERROR issue #53020\n+   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: add #![feature(const_compare_raw_pointers)] to the crate attributes to enable\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0395`.\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "6b9caba0218f3fbc79cefa6f5f1597ee6f244d8b", "filename": "src/test/ui/issue-25826.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Fissue-25826.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Fissue-25826.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-25826.rs?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -11,6 +11,6 @@\n fn id<T>(t: T) -> T { t }\n fn main() {\n     const A: bool = id::<u8> as *const () < id::<u16> as *const ();\n-    //~^ ERROR raw pointers cannot be compared in constants [E0395]\n+    //~^ ERROR comparing raw pointers inside constant\n     println!(\"{}\", A);\n }"}, {"sha": "a5ab7cfa6d3c5b1a98910588bd88a185b3ff00f9", "filename": "src/test/ui/issue-25826.stderr", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Fissue-25826.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/36907fc18d10b05d8b7a7383a4f0ecab9b431845/src%2Ftest%2Fui%2Fissue-25826.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-25826.stderr?ref=36907fc18d10b05d8b7a7383a4f0ecab9b431845", "patch": "@@ -1,9 +1,11 @@\n-error[E0395]: raw pointers cannot be compared in constants\n+error[E0658]: comparing raw pointers inside constant (see issue #53020)\n   --> $DIR/issue-25826.rs:13:21\n    |\n LL |     const A: bool = id::<u8> as *const () < id::<u16> as *const ();\n-   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ comparing raw pointers in static\n+   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: add #![feature(const_compare_raw_pointers)] to the crate attributes to enable\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0395`.\n+For more information about this error, try `rustc --explain E0658`."}]}