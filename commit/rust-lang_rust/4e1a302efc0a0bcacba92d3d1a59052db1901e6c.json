{"sha": "4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "node_id": "C_kwDOAAsO6NoAKDRlMWEzMDJlZmMwYTBiY2FjYmE5MmQzZDFhNTkwNTJkYjE5MDFlNmM", "commit": {"author": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-24T14:04:20Z"}, "committer": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-24T14:04:20Z"}, "message": "Sort in DefMap::dump, since HashMap iteration order isn't defined", "tree": {"sha": "b9ab4fb4125b86b5a57d988c1c74dbdc8f53470d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9ab4fb4125b86b5a57d988c1c74dbdc8f53470d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "html_url": "https://github.com/rust-lang/rust/commit/4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/comments", "author": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e436260d7ab81b4d0f61f5d27a967d8b8341d587", "url": "https://api.github.com/repos/rust-lang/rust/commits/e436260d7ab81b4d0f61f5d27a967d8b8341d587", "html_url": "https://github.com/rust-lang/rust/commit/e436260d7ab81b4d0f61f5d27a967d8b8341d587"}], "stats": {"total": 67, "additions": 33, "deletions": 34}, "files": [{"sha": "756fd583af4d60be4df94ee47737a94b6f628944", "filename": "src/tools/rust-analyzer/crates/hir-def/src/nameres.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres.rs?ref=4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "patch": "@@ -48,19 +48,20 @@\n //! the result\n \n pub mod attr_resolution;\n-pub mod diagnostics;\n mod collector;\n+pub mod diagnostics;\n mod mod_resolution;\n mod path_resolution;\n mod proc_macro;\n \n #[cfg(test)]\n mod tests;\n \n-use std::sync::Arc;\n+use std::{cmp::Ord, sync::Arc};\n \n use base_db::{CrateId, Edition, FileId};\n use hir_expand::{name::Name, InFile, MacroDefId};\n+use itertools::Itertools;\n use la_arena::Arena;\n use profile::Count;\n use rustc_hash::FxHashMap;\n@@ -333,11 +334,7 @@ impl DefMap {\n \n     pub(crate) fn crate_root(&self, db: &dyn DefDatabase) -> ModuleId {\n         self.with_ancestor_maps(db, self.root, &mut |def_map, _module| {\n-            if def_map.block.is_none() {\n-                Some(def_map.module_id(def_map.root))\n-            } else {\n-                None\n-            }\n+            if def_map.block.is_none() { Some(def_map.module_id(def_map.root)) } else { None }\n         })\n         .expect(\"DefMap chain without root\")\n     }\n@@ -431,7 +428,9 @@ impl DefMap {\n \n             map.modules[module].scope.dump(buf);\n \n-            for (name, child) in map.modules[module].children.iter() {\n+            for (name, child) in\n+                map.modules[module].children.iter().sorted_by(|a, b| Ord::cmp(&a.0, &b.0))\n+            {\n                 let path = format!(\"{}::{}\", path, name);\n                 buf.push('\\n');\n                 go(buf, map, &path, *child);"}, {"sha": "70dd2eb3ade69d2a07ecb6550748abe45744bc82", "filename": "src/tools/rust-analyzer/crates/hir-def/src/nameres/tests.rs", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests.rs?ref=4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "patch": "@@ -648,11 +648,11 @@ mod b {\n             a: t\n             b: t\n \n-            crate::b\n-            T: v\n-\n             crate::a\n             T: t v\n+\n+            crate::b\n+            T: v\n         \"#]],\n     );\n }\n@@ -704,13 +704,13 @@ use crate::reex::*;\n             reex: t\n             tr: t\n \n-            crate::tr\n-            PrivTr: t\n-            PubTr: t\n-\n             crate::reex\n             _: t\n             _: t\n+\n+            crate::tr\n+            PrivTr: t\n+            PubTr: t\n         \"#]],\n     );\n }\n@@ -920,14 +920,14 @@ use some_module::unknown_func;\n             some_module: t\n             unknown_func: v\n \n-            crate::some_module\n-            unknown_func: v\n-\n             crate::other_module\n             some_submodule: t\n \n             crate::other_module::some_submodule\n             unknown_func: v\n+\n+            crate::some_module\n+            unknown_func: v\n         \"#]],\n     )\n }"}, {"sha": "b2a6a592cf38b4b756b7fedbdcc812bb2e6c8097", "filename": "src/tools/rust-analyzer/crates/hir-def/src/nameres/tests/globs.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fglobs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fglobs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fglobs.rs?ref=4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "patch": "@@ -315,8 +315,13 @@ mod d {\n             c: t\n             d: t\n \n-            crate::d\n-            Y: t v\n+            crate::a\n+            foo: t\n+\n+            crate::a::foo\n+            X: t v\n+\n+            crate::b\n             foo: t\n \n             crate::c\n@@ -325,14 +330,9 @@ mod d {\n             crate::c::foo\n             Y: t v\n \n-            crate::b\n-            foo: t\n-\n-            crate::a\n+            crate::d\n+            Y: t v\n             foo: t\n-\n-            crate::a::foo\n-            X: t v\n         \"#]],\n     );\n }"}, {"sha": "7b7f94c5333eb202f86ff4d0a45110ed6907177c", "filename": "src/tools/rust-analyzer/crates/hir-def/src/nameres/tests/macros.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e1a302efc0a0bcacba92d3d1a59052db1901e6c/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fcrates%2Fhir-def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs?ref=4e1a302efc0a0bcacba92d3d1a59052db1901e6c", "patch": "@@ -439,15 +439,8 @@ macro_rules! baz {\n             m7: t\n             ok_double_macro_use_shadow: v\n \n-            crate::m7\n-\n             crate::m1\n \n-            crate::m5\n-            m6: t\n-\n-            crate::m5::m6\n-\n             crate::m2\n \n             crate::m3\n@@ -462,6 +455,13 @@ macro_rules! baz {\n             ok_shadow_deep: v\n \n             crate::m3::m5\n+\n+            crate::m5\n+            m6: t\n+\n+            crate::m5::m6\n+\n+            crate::m7\n         \"#]],\n     );\n     // FIXME: should not see `NotFoundBefore`"}]}