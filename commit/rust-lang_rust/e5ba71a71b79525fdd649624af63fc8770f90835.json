{"sha": "e5ba71a71b79525fdd649624af63fc8770f90835", "node_id": "C_kwDOAAsO6NoAKGU1YmE3MWE3MWI3OTUyNWZkZDY0OTYyNGFmNjNmYzg3NzBmOTA4MzU", "commit": {"author": {"name": "Afonso Bordado", "email": "afonsobordado@az8.co", "date": "2022-08-06T19:51:47Z"}, "committer": {"name": "Afonso Bordado", "email": "afonsobordado@az8.co", "date": "2022-08-06T19:51:47Z"}, "message": "Pass all pairs to abi-checker", "tree": {"sha": "58c2e6be841287c643df779a72857507e9109291", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/58c2e6be841287c643df779a72857507e9109291"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5ba71a71b79525fdd649624af63fc8770f90835", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5ba71a71b79525fdd649624af63fc8770f90835", "html_url": "https://github.com/rust-lang/rust/commit/e5ba71a71b79525fdd649624af63fc8770f90835", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5ba71a71b79525fdd649624af63fc8770f90835/comments", "author": {"login": "afonso360", "id": 1357143, "node_id": "MDQ6VXNlcjEzNTcxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1357143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/afonso360", "html_url": "https://github.com/afonso360", "followers_url": "https://api.github.com/users/afonso360/followers", "following_url": "https://api.github.com/users/afonso360/following{/other_user}", "gists_url": "https://api.github.com/users/afonso360/gists{/gist_id}", "starred_url": "https://api.github.com/users/afonso360/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/afonso360/subscriptions", "organizations_url": "https://api.github.com/users/afonso360/orgs", "repos_url": "https://api.github.com/users/afonso360/repos", "events_url": "https://api.github.com/users/afonso360/events{/privacy}", "received_events_url": "https://api.github.com/users/afonso360/received_events", "type": "User", "site_admin": false}, "committer": {"login": "afonso360", "id": 1357143, "node_id": "MDQ6VXNlcjEzNTcxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1357143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/afonso360", "html_url": "https://github.com/afonso360", "followers_url": "https://api.github.com/users/afonso360/followers", "following_url": "https://api.github.com/users/afonso360/following{/other_user}", "gists_url": "https://api.github.com/users/afonso360/gists{/gist_id}", "starred_url": "https://api.github.com/users/afonso360/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/afonso360/subscriptions", "organizations_url": "https://api.github.com/users/afonso360/orgs", "repos_url": "https://api.github.com/users/afonso360/repos", "events_url": "https://api.github.com/users/afonso360/events{/privacy}", "received_events_url": "https://api.github.com/users/afonso360/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "569312278f1d38cd5634d4fd6fa1beef6ded69e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/569312278f1d38cd5634d4fd6fa1beef6ded69e2", "html_url": "https://github.com/rust-lang/rust/commit/569312278f1d38cd5634d4fd6fa1beef6ded69e2"}], "stats": {"total": 41, "additions": 18, "deletions": 23}, "files": [{"sha": "21d9afc823138542d7de5180555b53cd28b05308", "filename": "build_system/abi_checker.rs", "status": "modified", "additions": 18, "deletions": 23, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/e5ba71a71b79525fdd649624af63fc8770f90835/build_system%2Fabi_checker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5ba71a71b79525fdd649624af63fc8770f90835/build_system%2Fabi_checker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fabi_checker.rs?ref=e5ba71a71b79525fdd649624af63fc8770f90835", "patch": "@@ -37,31 +37,26 @@ pub(crate) fn run(\n     let cg_clif_dylib_path = build_dir.join(if cfg!(windows) { \"bin\" } else { \"lib\" }).join(\n         env::consts::DLL_PREFIX.to_string() + \"rustc_codegen_cranelift\" + env::consts::DLL_SUFFIX,\n     );\n-    println!(\"cg_clif_dylib_path: {}\", cg_clif_dylib_path.display());\n \n     let pairs = [\"rustc_calls_cgclif\", \"cgclif_calls_rustc\", \"cgclif_calls_cc\", \"cc_calls_cgclif\"];\n \n-    for pair in pairs {\n-        eprintln!(\"[ABI-CHECKER] Running pair {pair}\");\n-\n-        let mut cmd = Command::new(\"cargo\");\n-        cmd.arg(\"run\");\n-        cmd.arg(\"--target\");\n-        cmd.arg(target_triple);\n-        cmd.arg(\"--\");\n-        cmd.arg(\"--pairs\");\n-        cmd.arg(pair);\n-        cmd.arg(\"--add-rustc-codegen-backend\");\n-        cmd.arg(format!(\"cgclif:{}\", cg_clif_dylib_path.display()));\n-\n-        let output = spawn_and_wait_with_input(cmd, \"\".to_string());\n-\n-        // TODO: The correct thing to do here is to check the exit code, but abi-checker\n-        // currently doesn't return 0 on success, so check for the test fail count.\n-        // See: https://github.com/Gankra/abi-checker/issues/10\n-        let failed = !(output.contains(\"0 failed\") && output.contains(\"0 completely failed\"));\n-        if failed {\n-            panic!(\"abi-checker for pair {} failed!\", pair);\n-        }\n+    let mut cmd = Command::new(\"cargo\");\n+    cmd.arg(\"run\");\n+    cmd.arg(\"--target\");\n+    cmd.arg(target_triple);\n+    cmd.arg(\"--\");\n+    cmd.arg(\"--pairs\");\n+    cmd.args(pairs);\n+    cmd.arg(\"--add-rustc-codegen-backend\");\n+    cmd.arg(format!(\"cgclif:{}\", cg_clif_dylib_path.display()));\n+\n+    let output = spawn_and_wait_with_input(cmd, \"\".to_string());\n+\n+    // TODO: The correct thing to do here is to check the exit code, but abi-checker\n+    // currently doesn't return 0 on success, so check for the test fail count.\n+    // See: https://github.com/Gankra/abi-checker/issues/10\n+    let failed = !(output.contains(\"0 failed\") && output.contains(\"0 completely failed\"));\n+    if failed {\n+        panic!(\"abi-checker failed!\");\n     }\n }"}]}