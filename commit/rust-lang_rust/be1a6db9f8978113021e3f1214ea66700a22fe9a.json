{"sha": "be1a6db9f8978113021e3f1214ea66700a22fe9a", "node_id": "C_kwDOAAsO6NoAKGJlMWE2ZGI5Zjg5NzgxMTMwMjFlM2YxMjE0ZWE2NjcwMGEyMmZlOWE", "commit": {"author": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-01-09T10:21:31Z"}, "committer": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-01-14T09:04:42Z"}, "message": "fix: don't emit `E0711` if `staged_api` not enabled", "tree": {"sha": "6b35d538b73ed2ba7dd6c2eecd2893541396a8a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b35d538b73ed2ba7dd6c2eecd2893541396a8a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be1a6db9f8978113021e3f1214ea66700a22fe9a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJJBAABCAAzFiEEYSWD6p+RIeSP1N2eF81cKtrg00QFAmPCcCwVHGV6cmFzdXJl\nQG91dGxvb2suY29tAAoJEBfNXCra4NNEIF0QAJAljRkgqNkVlszB94WRk+9KYS6H\nub3B1k+d+kUZ56ZQsME3xajPOlZOgrekieb2v5CjZJiJkxSTihESxjV7155P3BfX\nocm6Yh3VXCsL8o1v4jI3o2QKLcsJ+Y5unK0Ltd9KUaxvIB8ODRdqwzeX2xLi3lAJ\nBivFxO6iUjsiV/uuoDSXzfWS8qibdmkFoBqN7fBe8U0o9Yq2bGsqQZNw7fLFuhdb\nJpA450DCI6UhocvgFoVMLRwv6DbRVPfHcSphlz6ydvCInFyUIE/5CvZFbt3bpvCU\nWTj+HHejq1a0X04/daH3Ib1kPNr8cCx+OtVNgOC5SVuFphpQ/cQPcr/Wc47UJ6jJ\naDoxcr5zSiIXw1BiwEE4fobEu0Q+av/eVF6+wcxVvT3+R8zYdyXXilfXZfvs/1UV\nzavcj5ejwaVPwSwQttAPYsaktZr19JxdwK4aghiPtnyY7vhsZvw1b/XvR5C0nVKy\np8Y4hbXarrSFOyICCFfFOgoMvj+p12kOl3sgn1V5u7NpbEu3dmYxd+8daaefXkT3\nsVnLfRskdFAiYlCtQ0zR5eGW4XlKE+o8ypsX2DPYejBedx+eOJI4uB7QxPeaV30A\nfeqQ/F8g0IFK9dieSmx8TpsN3bAas2d4sCia6UFtefAUm1KFPiPm5nJf0v13ipTe\njiCS2hGw1vBzLzLZ\n=vJhN\n-----END PGP SIGNATURE-----", "payload": "tree 6b35d538b73ed2ba7dd6c2eecd2893541396a8a8\nparent e9e09083674a58d361cd805877be55b5856d2806\nauthor Ezra Shaw <ezrasure@outlook.com> 1673259691 +1300\ncommitter Ezra Shaw <ezrasure@outlook.com> 1673687082 +1300\n\nfix: don't emit `E0711` if `staged_api` not enabled\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be1a6db9f8978113021e3f1214ea66700a22fe9a", "html_url": "https://github.com/rust-lang/rust/commit/be1a6db9f8978113021e3f1214ea66700a22fe9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be1a6db9f8978113021e3f1214ea66700a22fe9a/comments", "author": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9e09083674a58d361cd805877be55b5856d2806", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9e09083674a58d361cd805877be55b5856d2806", "html_url": "https://github.com/rust-lang/rust/commit/e9e09083674a58d361cd805877be55b5856d2806"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "4c6a9b23fdf12a9ed33c99f71337ce81c64364d0", "filename": "compiler/rustc_passes/src/lib_features.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/be1a6db9f8978113021e3f1214ea66700a22fe9a/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be1a6db9f8978113021e3f1214ea66700a22fe9a/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs?ref=be1a6db9f8978113021e3f1214ea66700a22fe9a", "patch": "@@ -137,6 +137,12 @@ impl<'tcx> Visitor<'tcx> for LibFeatureCollector<'tcx> {\n }\n \n fn lib_features(tcx: TyCtxt<'_>, (): ()) -> LibFeatures {\n+    // If `staged_api` is not enabled then we aren't allowed to define lib\n+    // features; there is no point collecting them.\n+    if !tcx.features().staged_api {\n+        return new_lib_features();\n+    }\n+\n     let mut collector = LibFeatureCollector::new(tcx);\n     tcx.hir().walk_attributes(&mut collector);\n     collector.lib_features"}, {"sha": "3cad9a3d283242d3a168f9c6f1b9bf1934f9864c", "filename": "tests/ui/stability-attribute/issue-106589.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/be1a6db9f8978113021e3f1214ea66700a22fe9a/tests%2Fui%2Fstability-attribute%2Fissue-106589.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be1a6db9f8978113021e3f1214ea66700a22fe9a/tests%2Fui%2Fstability-attribute%2Fissue-106589.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstability-attribute%2Fissue-106589.rs?ref=be1a6db9f8978113021e3f1214ea66700a22fe9a", "patch": "@@ -0,0 +1,10 @@\n+// #![feature(staged_api)] // note: `staged_api` not enabled\n+\n+#![stable(feature = \"foo\", since = \"1.0.0\")]\n+//~^ ERROR stability attributes may not be used outside of the standard library\n+\n+#[unstable(feature = \"foo\", issue = \"none\")]\n+//~^ ERROR stability attributes may not be used outside of the standard library\n+fn foo_unstable() {}\n+\n+fn main() {}"}, {"sha": "ccf3f7164e3e1d6b64a4d50230f00223c6f9df76", "filename": "tests/ui/stability-attribute/issue-106589.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/be1a6db9f8978113021e3f1214ea66700a22fe9a/tests%2Fui%2Fstability-attribute%2Fissue-106589.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/be1a6db9f8978113021e3f1214ea66700a22fe9a/tests%2Fui%2Fstability-attribute%2Fissue-106589.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstability-attribute%2Fissue-106589.stderr?ref=be1a6db9f8978113021e3f1214ea66700a22fe9a", "patch": "@@ -0,0 +1,15 @@\n+error[E0734]: stability attributes may not be used outside of the standard library\n+  --> $DIR/issue-106589.rs:6:1\n+   |\n+LL | #[unstable(feature = \"foo\", issue = \"none\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0734]: stability attributes may not be used outside of the standard library\n+  --> $DIR/issue-106589.rs:3:1\n+   |\n+LL | #![stable(feature = \"foo\", since = \"1.0.0\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0734`."}]}