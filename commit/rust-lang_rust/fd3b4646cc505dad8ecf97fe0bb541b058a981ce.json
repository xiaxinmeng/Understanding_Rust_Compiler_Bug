{"sha": "fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkM2I0NjQ2Y2M1MDVkYWQ4ZWNmOTdmZTBiYjU0MWIwNThhOTgxY2U=", "commit": {"author": {"name": "Luqman Aden", "email": "laden@csclub.uwaterloo.ca", "date": "2016-07-05T07:44:26Z"}, "committer": {"name": "Luqman Aden", "email": "laden@csclub.uwaterloo.ca", "date": "2016-07-05T07:48:12Z"}, "message": "Just pass in NodeId to FunctionContext::new instead of looking it up.", "tree": {"sha": "b32bd12c641d6d425eb1a6dbd91c5d519a19815f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b32bd12c641d6d425eb1a6dbd91c5d519a19815f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "html_url": "https://github.com/rust-lang/rust/commit/fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f4c4f8c2910d717044a041039a1a1aa914ff59e", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f4c4f8c2910d717044a041039a1a1aa914ff59e", "html_url": "https://github.com/rust-lang/rust/commit/0f4c4f8c2910d717044a041039a1a1aa914ff59e"}], "stats": {"total": 64, "additions": 54, "deletions": 10}, "files": [{"sha": "590220f0c8b6478c172254f830e950fcf7804f31", "filename": "src/librustc_trans/base.rs", "status": "modified", "additions": 11, "deletions": 10, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Flibrustc_trans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Flibrustc_trans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fbase.rs?ref=fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "patch": "@@ -75,7 +75,6 @@ use debuginfo::{self, DebugLoc, ToDebugLoc};\n use declare;\n use expr;\n use glue;\n-use inline;\n use machine;\n use machine::{llalign_of_min, llsize_of, llsize_of_real};\n use meth;\n@@ -1407,19 +1406,17 @@ impl<'blk, 'tcx> FunctionContext<'blk, 'tcx> {\n     pub fn new(ccx: &'blk CrateContext<'blk, 'tcx>,\n                llfndecl: ValueRef,\n                fn_ty: FnType,\n-               definition: Option<(Instance<'tcx>, &ty::FnSig<'tcx>, Abi)>,\n+               definition: Option<(Instance<'tcx>, &ty::FnSig<'tcx>, Abi, ast::NodeId)>,\n                block_arena: &'blk TypedArena<common::BlockS<'blk, 'tcx>>)\n                -> FunctionContext<'blk, 'tcx> {\n-        let (param_substs, def_id) = match definition {\n-            Some((instance, _, _)) => {\n+        let (param_substs, def_id, inlined_id) = match definition {\n+            Some((instance, _, _, inlined_id)) => {\n                 common::validate_substs(instance.substs);\n-                (instance.substs, Some(instance.def))\n+                (instance.substs, Some(instance.def), Some(inlined_id))\n             }\n-            None => (ccx.tcx().mk_substs(Substs::empty()), None)\n+            None => (ccx.tcx().mk_substs(Substs::empty()), None, None)\n         };\n \n-        let inlined_did = def_id.and_then(|def_id| inline::get_local_instance(ccx, def_id));\n-        let inlined_id = inlined_did.and_then(|id| ccx.tcx().map.as_local_node_id(id));\n         let local_id = def_id.and_then(|id| ccx.tcx().map.as_local_node_id(id));\n \n         debug!(\"FunctionContext::new({})\",\n@@ -1454,7 +1451,7 @@ impl<'blk, 'tcx> FunctionContext<'blk, 'tcx> {\n         };\n \n         let debug_context = if let (false, Some(definition)) = (no_debug, definition) {\n-            let (instance, sig, abi) = definition;\n+            let (instance, sig, abi, _) = definition;\n             debuginfo::create_function_debug_context(ccx, instance, sig, abi, llfndecl)\n         } else {\n             debuginfo::empty_function_debug_context(ccx)\n@@ -1850,7 +1847,11 @@ pub fn trans_closure<'a, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n \n     let (arena, fcx): (TypedArena<_>, FunctionContext);\n     arena = TypedArena::new();\n-    fcx = FunctionContext::new(ccx, llfndecl, fn_ty, Some((instance, sig, abi)), &arena);\n+    fcx = FunctionContext::new(ccx,\n+                               llfndecl,\n+                               fn_ty,\n+                               Some((instance, sig, abi, inlined_id)),\n+                               &arena);\n \n     if fcx.mir.is_some() {\n         return mir::trans_mir(&fcx);"}, {"sha": "48fb05f7779d230f320c11ecc7ac35747fac6790", "filename": "src/test/run-pass/auxiliary/xcrate_generic_fn_nested_return.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Ftest%2Frun-pass%2Fauxiliary%2Fxcrate_generic_fn_nested_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Ftest%2Frun-pass%2Fauxiliary%2Fxcrate_generic_fn_nested_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fauxiliary%2Fxcrate_generic_fn_nested_return.rs?ref=fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+pub struct Request {\n+    pub id: String,\n+    pub arg: String,\n+}\n+\n+pub fn decode<T>() -> Result<Request, ()> {\n+    (|| {\n+        Ok(Request {\n+            id: \"hi\".to_owned(),\n+            arg: match Err(()) {\n+                Ok(v) => v,\n+                Err(e) => return Err(e)\n+            },\n+        })\n+    })()\n+}"}, {"sha": "181c91686823da032d05db3d986b408badb6bcb2", "filename": "src/test/run-pass/xcrate_generic_fn_nested_return.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Ftest%2Frun-pass%2Fxcrate_generic_fn_nested_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd3b4646cc505dad8ecf97fe0bb541b058a981ce/src%2Ftest%2Frun-pass%2Fxcrate_generic_fn_nested_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fxcrate_generic_fn_nested_return.rs?ref=fd3b4646cc505dad8ecf97fe0bb541b058a981ce", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:xcrate_generic_fn_nested_return.rs\n+\n+extern crate xcrate_generic_fn_nested_return as test;\n+\n+pub fn main() {\n+    assert!(test::decode::<()>().is_err());\n+}"}]}