{"sha": "3b25e92a8fbb5856499a84e02bf393a9c18eb962", "node_id": "C_kwDOAAsO6NoAKDNiMjVlOTJhOGZiYjU4NTY0OTlhODRlMDJiZjM5M2E5YzE4ZWI5NjI", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-29T12:12:21Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-11-24T07:55:21Z"}, "message": "Debug", "tree": {"sha": "6022deb6414a1ebbccf7385980669fd3e36e2a86", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6022deb6414a1ebbccf7385980669fd3e36e2a86"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b25e92a8fbb5856499a84e02bf393a9c18eb962", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEQ7Fl7qPq2YcWF1dqAn35M4hird0FAmGd7+kACgkQAn35M4hi\nrd1fxQ/+MCAP1IzVhemyMaEMXenyhurJDKntjvmFLBBsooCo8vi1RhrsRxRjQuNF\n4PhrllkYAb0rdy55dZOqlzgg1Pw0ZeTRVX96VSwS/5qpQHuZbzjh3Egom+qDJDMK\nHJusfVTVrW8/sBqrgBqjTzXuBIp/w2N1i8QHBr3Rj7Img1p7uEW88iJP+5e7QYFj\nBMHrha3gYlp6VbRHJa9pCzRao2xfYE7d3t1agf/t2LV5KFG7ZY2PXUevm4f3KJep\n36NQGLPfCPkMvDH7Pe2s2euyOALP0+YCbaejjGqq4yM+i6l17YYyE3tn/HJvystY\nmcrkr/byJw8kSgKL+SS+WivIa6uGx4PXECvRr8kRwKqcE6JY+zI/c5HDX5r+iXvf\nqSgDCurmz1vbUT9hbrqcW5Uf/zz2oNU3dpuAjT/kbw97iUKQ/mwll0eNWFGHillK\npiQQCBv7WEVwLfY6PZQQHusVho2AgndQ/ml9z+Esq4HAYJpIsPOcU/gYkgT+tf64\nE5Td63nZI3plq4jkrp9eihsWJsRqEA2ie8wSiJ9wZDObTPnDl3tGwmpeHyM3e0TJ\n/QlHbzT2wf5dEFQY9QIZPr11X0FFKOiIyIUzNQ+KTZbd8ovz8/OfAQZsSmOCd74F\neVb2y7k+kvvfkmYi+c/urfUUxUi8/7/AkpAlFMIDDilO6CDlv0Y=\n=gZkh\n-----END PGP SIGNATURE-----", "payload": "tree 6022deb6414a1ebbccf7385980669fd3e36e2a86\nparent de4b242e1e2143f549f25ac5a8f7de9d902ef3b4\nauthor Deadbeef <ent3rm4n@gmail.com> 1632917541 +0000\ncommitter Deadbeef <ent3rm4n@gmail.com> 1637740521 +0800\n\nDebug\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b25e92a8fbb5856499a84e02bf393a9c18eb962", "html_url": "https://github.com/rust-lang/rust/commit/3b25e92a8fbb5856499a84e02bf393a9c18eb962", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b25e92a8fbb5856499a84e02bf393a9c18eb962/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "de4b242e1e2143f549f25ac5a8f7de9d902ef3b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/de4b242e1e2143f549f25ac5a8f7de9d902ef3b4", "html_url": "https://github.com/rust-lang/rust/commit/de4b242e1e2143f549f25ac5a8f7de9d902ef3b4"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "4e3a8b64094af7c20c7982833c39e30521a6cb45", "filename": "compiler/rustc_const_eval/src/transform/check_consts/check.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3b25e92a8fbb5856499a84e02bf393a9c18eb962/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b25e92a8fbb5856499a84e02bf393a9c18eb962/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs?ref=3b25e92a8fbb5856499a84e02bf393a9c18eb962", "patch": "@@ -1004,11 +1004,12 @@ impl Visitor<'tcx> for Checker<'mir, 'tcx> {\n                 }\n \n                 let mut err_span = self.span;\n+                let ty_of_dropped_place = dropped_place.ty(self.body, self.tcx).ty;\n \n-                let ty_needs_non_const_drop = qualifs::NeedsNonConstDrop::in_any_value_of_ty(\n-                    self.ccx,\n-                    dropped_place.ty(self.body, self.tcx).ty,\n-                );\n+                let ty_needs_non_const_drop =\n+                    qualifs::NeedsNonConstDrop::in_any_value_of_ty(self.ccx, ty_of_dropped_place);\n+\n+                debug!(?ty_of_dropped_place, ?ty_needs_non_const_drop);\n \n                 if !ty_needs_non_const_drop {\n                     return;"}]}