{"sha": "ceb496cf59ea28d98146cdcfc072cede4f7c6585", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlYjQ5NmNmNTllYTI4ZDk4MTQ2Y2RjZmMwNzJjZWRlNGY3YzY1ODU=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-07-01T17:19:19Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-07-04T08:47:23Z"}, "message": "improve validity error range printing for singleton ranges", "tree": {"sha": "6fab33a8390c55c7a2b962235eae99f31216c3aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6fab33a8390c55c7a2b962235eae99f31216c3aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ceb496cf59ea28d98146cdcfc072cede4f7c6585", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ceb496cf59ea28d98146cdcfc072cede4f7c6585", "html_url": "https://github.com/rust-lang/rust/commit/ceb496cf59ea28d98146cdcfc072cede4f7c6585", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ceb496cf59ea28d98146cdcfc072cede4f7c6585/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9d6b3bb28a0a1e94486f066f38f2923dc0cd64d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9d6b3bb28a0a1e94486f066f38f2923dc0cd64d", "html_url": "https://github.com/rust-lang/rust/commit/d9d6b3bb28a0a1e94486f066f38f2923dc0cd64d"}], "stats": {"total": 21, "additions": 11, "deletions": 10}, "files": [{"sha": "34892f5b8ca01bda2f702e94523609fdf6e423f5", "filename": "src/librustc_mir/interpret/validity.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ceb496cf59ea28d98146cdcfc072cede4f7c6585/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ceb496cf59ea28d98146cdcfc072cede4f7c6585/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs?ref=ceb496cf59ea28d98146cdcfc072cede4f7c6585", "patch": "@@ -151,15 +151,16 @@ fn wrapping_range_format(r: &RangeInclusive<u128>, max_hi: u128) -> String {\n     debug_assert!(hi <= max_hi);\n     if lo > hi {\n         format!(\"less or equal to {}, or greater or equal to {}\", hi, lo)\n+    } else if lo == hi {\n+        format!(\"equal to {}\", lo)\n+    } else if lo == 0 {\n+        debug_assert!(hi < max_hi, \"should not be printing if the range covers everything\");\n+        format!(\"less or equal to {}\", hi)\n+    } else if hi == max_hi {\n+        debug_assert!(lo > 0, \"should not be printing if the range covers everything\");\n+        format!(\"greater or equal to {}\", lo)\n     } else {\n-        if lo == 0 {\n-            debug_assert!(hi < max_hi, \"should not be printing if the range covers everything\");\n-            format!(\"less or equal to {}\", hi)\n-        } else if hi == max_hi {\n-            format!(\"greater or equal to {}\", lo)\n-        } else {\n-            format!(\"in the range {:?}\", r)\n-        }\n+        format!(\"in the range {:?}\", r)\n     }\n }\n "}, {"sha": "8ecb1aabdd0f72a55a2e6b0de0c1681403fd3a55", "filename": "src/test/ui/consts/const-eval/ub-enum.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ceb496cf59ea28d98146cdcfc072cede4f7c6585/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ceb496cf59ea28d98146cdcfc072cede4f7c6585/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-enum.stderr?ref=ceb496cf59ea28d98146cdcfc072cede4f7c6585", "patch": "@@ -18,7 +18,7 @@ error[E0080]: it is undefined behavior to use this value\n   --> $DIR/ub-enum.rs:28:1\n    |\n LL | const BAD_ENUM_WRAPPED: Wrap<Enum> = unsafe { TransmuteEnum { in1: &1 }.out2 };\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered a pointer, but expected something that cannot possibly fail to be less or equal to 0\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered a pointer, but expected something that cannot possibly fail to be equal to 0\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n \n@@ -42,7 +42,7 @@ error[E0080]: it is undefined behavior to use this value\n   --> $DIR/ub-enum.rs:50:1\n    |\n LL | const BAD_ENUM2_WRAPPED: Wrap<Enum2> = unsafe { TransmuteEnum2 { in2: &0 }.out2 };\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered a pointer, but expected something that cannot possibly fail to be in the range 2..=2\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered a pointer, but expected something that cannot possibly fail to be equal to 2\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\n "}]}