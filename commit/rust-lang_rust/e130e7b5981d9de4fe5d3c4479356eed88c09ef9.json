{"sha": "e130e7b5981d9de4fe5d3c4479356eed88c09ef9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxMzBlN2I1OTgxZDlkZTRmZTVkM2M0NDc5MzU2ZWVkODhjMDllZjk=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-29T18:12:13Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-29T21:35:39Z"}, "message": "Display an error when linking fails", "tree": {"sha": "500e51fb4636113cd5f4ab7ee35d29f10bc87375", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/500e51fb4636113cd5f4ab7ee35d29f10bc87375"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e130e7b5981d9de4fe5d3c4479356eed88c09ef9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e130e7b5981d9de4fe5d3c4479356eed88c09ef9", "html_url": "https://github.com/rust-lang/rust/commit/e130e7b5981d9de4fe5d3c4479356eed88c09ef9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e130e7b5981d9de4fe5d3c4479356eed88c09ef9/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e60cb9197f4404684206e282c1d8391fd7b3e26c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e60cb9197f4404684206e282c1d8391fd7b3e26c", "html_url": "https://github.com/rust-lang/rust/commit/e60cb9197f4404684206e282c1d8391fd7b3e26c"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "aeb3467a2d9543b191d4902cb7de3519d796bf22", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e130e7b5981d9de4fe5d3c4479356eed88c09ef9/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e130e7b5981d9de4fe5d3c4479356eed88c09ef9/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=e130e7b5981d9de4fe5d3c4479356eed88c09ef9", "patch": "@@ -419,7 +419,13 @@ fn main(vec[str] args) {\n             }\n         }\n \n-        gcc_args += sess.get_used_crate_files();\n+        for (str cratepath in sess.get_used_crate_files()) {\n+            auto dir = fs::dirname(cratepath);\n+            if (dir != \"\") {\n+                gcc_args += [\"-L\" + dir];\n+            }\n+            gcc_args += [fs::basename(cratepath)];\n+        }\n \n         auto used_libs = sess.get_used_libraries();\n         for (str l in used_libs) {\n@@ -435,7 +441,12 @@ fn main(vec[str] args) {\n         }\n         // We run 'gcc' here\n \n-        run::run_program(prog, gcc_args);\n+        auto err_code = run::run_program(prog, gcc_args);\n+        if (0 != err_code) {\n+            sess.err(#fmt(\"linking with gcc failed with code %d\", err_code));\n+            sess.note(#fmt(\"gcc arguments: %s\", str::connect(gcc_args, \" \")));\n+            sess.abort_if_errors();\n+        }\n         // Clean up on Darwin\n \n         if (sess.get_targ_cfg().os == session::os_macos) {"}]}