{"sha": "0509b1b9d78da4abe5c6f32231889d5ee865428e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MDliMWI5ZDc4ZGE0YWJlNWM2ZjMyMjMxODg5ZDVlZTg2NTQyOGU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-11T01:47:53Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-11T01:49:28Z"}, "message": "rustc: Add update_env_for_arm to fold; we'll need it to resolve pattern bindings", "tree": {"sha": "9c9daf9a45e06943c858db149574887892aaf8d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c9daf9a45e06943c858db149574887892aaf8d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0509b1b9d78da4abe5c6f32231889d5ee865428e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0509b1b9d78da4abe5c6f32231889d5ee865428e", "html_url": "https://github.com/rust-lang/rust/commit/0509b1b9d78da4abe5c6f32231889d5ee865428e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0509b1b9d78da4abe5c6f32231889d5ee865428e/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f97242c255dfe07f1c8d3908d4bfd2942e1b2428", "url": "https://api.github.com/repos/rust-lang/rust/commits/f97242c255dfe07f1c8d3908d4bfd2942e1b2428", "html_url": "https://github.com/rust-lang/rust/commit/f97242c255dfe07f1c8d3908d4bfd2942e1b2428"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "54e098384c5a6a86c1152c77e5663185f6349ff1", "filename": "src/comp/middle/fold.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0509b1b9d78da4abe5c6f32231889d5ee865428e/src%2Fcomp%2Fmiddle%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0509b1b9d78da4abe5c6f32231889d5ee865428e/src%2Fcomp%2Fmiddle%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ffold.rs?ref=0509b1b9d78da4abe5c6f32231889d5ee865428e", "patch": "@@ -210,6 +210,7 @@ type ast_fold[ENV] =\n      (fn(&ENV e, @stmt s) -> ENV) update_env_for_stmt,\n      (fn(&ENV e, @decl i) -> ENV) update_env_for_decl,\n      (fn(&ENV e, @pat p) -> ENV) update_env_for_pat,\n+     (fn(&ENV e, &arm a) -> ENV) update_env_for_arm,\n      (fn(&ENV e, @expr x) -> ENV) update_env_for_expr,\n      (fn(&ENV e, @ty t) -> ENV) update_env_for_ty,\n \n@@ -455,10 +456,8 @@ fn fold_expr[ENV](&ENV env, ast_fold[ENV] fld, &@expr e) -> @expr {\n         case (ast.expr_alt(?expr, ?arms, ?t)) {\n             auto eexpr = fold_expr(env_, fld, expr);\n             let vec[ast.arm] aarms = vec();\n-            for (ast.arm arm in arms) {\n-                auto ppat = fold_pat(env_, fld, arm.pat);\n-                auto bblock = fold_block(env_, fld, arm.block);\n-                aarms += vec(rec(pat=ppat, block=bblock));\n+            for (ast.arm a in arms) {\n+                aarms += vec(fold_arm(env_, fld, a));\n             }\n             ret fld.fold_expr_alt(env_, e.span, eexpr, aarms, t);\n         }\n@@ -571,6 +570,13 @@ fn fold_block[ENV](&ENV env, ast_fold[ENV] fld, &block blk) -> block {\n     ret respan(blk.span, rec(stmts=stmts, expr=expr, index=blk.node.index));\n }\n \n+fn fold_arm[ENV](&ENV env, ast_fold[ENV] fld, &arm a) -> arm {\n+    let ENV env_ = fld.update_env_for_arm(env, a);\n+    auto ppat = fold_pat(env_, fld, a.pat);\n+    auto bblock = fold_block(env_, fld, a.block);\n+    ret rec(pat=ppat, block=bblock);\n+}\n+\n fn fold_arg[ENV](&ENV env, ast_fold[ENV] fld, &arg a) -> arg {\n     auto ty = fold_ty(env, fld, a.ty);\n     ret rec(ty=ty with a);\n@@ -965,6 +971,10 @@ fn identity_update_env_for_decl[ENV](&ENV e, @decl d) -> ENV {\n     ret e;\n }\n \n+fn identity_update_env_for_arm[ENV](&ENV e, &arm a) -> ENV {\n+    ret e;\n+}\n+\n fn identity_update_env_for_pat[ENV](&ENV e, @pat p) -> ENV {\n     ret e;\n }\n@@ -1057,6 +1067,7 @@ fn new_identity_fold[ENV]() -> ast_fold[ENV] {\n          update_env_for_stmt = bind identity_update_env_for_stmt[ENV](_,_),\n          update_env_for_decl = bind identity_update_env_for_decl[ENV](_,_),\n          update_env_for_pat = bind identity_update_env_for_pat[ENV](_,_),\n+         update_env_for_arm = bind identity_update_env_for_arm[ENV](_,_),\n          update_env_for_expr = bind identity_update_env_for_expr[ENV](_,_),\n          update_env_for_ty = bind identity_update_env_for_ty[ENV](_,_),\n "}]}