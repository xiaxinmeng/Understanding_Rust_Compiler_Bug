{"sha": "3b1ba01095aaf37e3f3edf251332e0682bd98c8a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiMWJhMDEwOTVhYWYzN2UzZjNlZGYyNTEzMzJlMDY4MmJkOThjOGE=", "commit": {"author": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2017-03-24T17:58:18Z"}, "committer": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2017-03-30T23:31:46Z"}, "message": "Fix stage0->stage1 build when using \"pthreads\" mingw compiler.", "tree": {"sha": "bdc7eabcd36843265373ef128bba299706f5bf72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bdc7eabcd36843265373ef128bba299706f5bf72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b1ba01095aaf37e3f3edf251332e0682bd98c8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b1ba01095aaf37e3f3edf251332e0682bd98c8a", "html_url": "https://github.com/rust-lang/rust/commit/3b1ba01095aaf37e3f3edf251332e0682bd98c8a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b1ba01095aaf37e3f3edf251332e0682bd98c8a/comments", "author": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c2fc62a47a9e7e6c71492d5b3752ab78cf0af0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c2fc62a47a9e7e6c71492d5b3752ab78cf0af0d", "html_url": "https://github.com/rust-lang/rust/commit/7c2fc62a47a9e7e6c71492d5b3752ab78cf0af0d"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "9f9d3471640ff37fc7fda03740d64987a37e4bad", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3b1ba01095aaf37e3f3edf251332e0682bd98c8a/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/3b1ba01095aaf37e3f3edf251332e0682bd98c8a/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=3b1ba01095aaf37e3f3edf251332e0682bd98c8a", "patch": "@@ -163,12 +163,13 @@ def download_stage0(self):\n         if not os.path.exists(rustc_cache):\n             os.makedirs(rustc_cache)\n \n+        channel = self.stage0_rustc_channel()\n+\n         if self.rustc().startswith(self.bin_root()) and \\\n                 (not os.path.exists(self.rustc()) or self.rustc_out_of_date()):\n             self.print_what_it_means_to_bootstrap()\n             if os.path.exists(self.bin_root()):\n                 shutil.rmtree(self.bin_root())\n-            channel = self.stage0_rustc_channel()\n             filename = \"rust-std-{}-{}.tar.gz\".format(channel, self.build)\n             url = \"https://static.rust-lang.org/dist/\" + self.stage0_rustc_date()\n             tarball = os.path.join(rustc_cache, filename)\n@@ -189,6 +190,14 @@ def download_stage0(self):\n             with open(self.rustc_stamp(), 'w') as f:\n                 f.write(self.stage0_rustc_date())\n \n+            if \"pc-windows-gnu\" in self.build:\n+                filename = \"rust-mingw-{}-{}.tar.gz\".format(channel, self.build)\n+                url = \"https://static.rust-lang.org/dist/\" + self.stage0_rustc_date()\n+                tarball = os.path.join(rustc_cache, filename)\n+                if not os.path.exists(tarball):\n+                    get(\"{}/{}\".format(url, filename), tarball, verbose=self.verbose)\n+                unpack(tarball, self.bin_root(), match=\"rust-mingw\", verbose=self.verbose)\n+\n         if self.cargo().startswith(self.bin_root()) and \\\n                 (not os.path.exists(self.cargo()) or self.cargo_out_of_date()):\n             self.print_what_it_means_to_bootstrap()"}]}