{"sha": "28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4ZjAxNzFkYmRmNTFhYjAyYmYzZTgwOTBkODBkY2RmMGI3MzM2NjI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-07-12T09:45:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-12T09:45:37Z"}, "message": "Merge #5326\n\n5326: infer: Add type inference support for Union types r=flodiebold a=otavio\n\nThis adds the type inference to Union types and add a small test case\nfor it, ensuring it keeps working in future.\n\nFixes: #5277\nSigned-off-by: Otavio Salvador <otavio@ossystems.com.br>\n\n\n----\n\n#\n\nCo-authored-by: Otavio Salvador <otavio@ossystems.com.br>", "tree": {"sha": "72dd0e6a6d4cb466c654986a903b974392d3375c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72dd0e6a6d4cb466c654986a903b974392d3375c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfCtvBCRBK7hj4Ov3rIwAAdHIIAKUEaEaE4qFFZuOrRJVrfV0b\nMnXRyzfiYt1FXRkXGWzUDwbqgbRMQqMEptQcKUVCIrwGh6fzTDSM5ECc6gkIjTdA\na43cwWXU99MDPmXWcNAj/TaTi41IoM9yBt+oeLKmQU9NUF00w6IzNVFcNPn95eUO\ncXGIvLgTxhsS4/nLza5bWoLEQzGpa1fB1Tf5iZz9RcI4RYH2a45SOxl/m+EX+VUp\nEUKmbmYnDTaRyxlloLvenq3zrN1HGWa4sN0Y3dOWTOH4aOY028vpHjNha8rqju3W\nqWYPRpEcz8t28BEqLQD9/Q6q3xyXX1DoHefMe0m0MqbMSE19DWXhMzow16Cio8g=\n=3kTk\n-----END PGP SIGNATURE-----\n", "payload": "tree 72dd0e6a6d4cb466c654986a903b974392d3375c\nparent 1a9d7724dac54510c7b702d11a126364604af61c\nparent 9d114b9707fd3d6aaa3224cd1794e8e49e433f36\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1594547137 +0000\ncommitter GitHub <noreply@github.com> 1594547137 +0000\n\nMerge #5326\n\n5326: infer: Add type inference support for Union types r=flodiebold a=otavio\n\nThis adds the type inference to Union types and add a small test case\nfor it, ensuring it keeps working in future.\n\nFixes: #5277\nSigned-off-by: Otavio Salvador <otavio@ossystems.com.br>\n\n\n----\n\n#\n\nCo-authored-by: Otavio Salvador <otavio@ossystems.com.br>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "html_url": "https://github.com/rust-lang/rust/commit/28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/28f0171dbdf51ab02bf3e8090d80dcdf0b733662/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a9d7724dac54510c7b702d11a126364604af61c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a9d7724dac54510c7b702d11a126364604af61c", "html_url": "https://github.com/rust-lang/rust/commit/1a9d7724dac54510c7b702d11a126364604af61c"}, {"sha": "9d114b9707fd3d6aaa3224cd1794e8e49e433f36", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d114b9707fd3d6aaa3224cd1794e8e49e433f36", "html_url": "https://github.com/rust-lang/rust/commit/9d114b9707fd3d6aaa3224cd1794e8e49e433f36"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "bd9a387f5881c8fe235d262a506d1df2339e2b47", "filename": "crates/ra_hir_ty/src/infer/expr.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/28f0171dbdf51ab02bf3e8090d80dcdf0b733662/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/28f0171dbdf51ab02bf3e8090d80dcdf0b733662/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Fexpr.rs?ref=28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "patch": "@@ -405,8 +405,15 @@ impl<'a> InferenceContext<'a> {\n                                     .subst(&a_ty.parameters)\n                             })\n                         }\n-                        // FIXME:\n-                        TypeCtor::Adt(AdtId::UnionId(_)) => None,\n+                        TypeCtor::Adt(AdtId::UnionId(u)) => {\n+                            self.db.union_data(u).variant_data.field(name).map(|local_id| {\n+                                let field = FieldId { parent: u.into(), local_id };\n+                                self.write_field_resolution(tgt_expr, field);\n+                                self.db.field_types(u.into())[field.local_id]\n+                                    .clone()\n+                                    .subst(&a_ty.parameters)\n+                            })\n+                        }\n                         _ => None,\n                     },\n                     _ => None,"}, {"sha": "6d3e264af3ade6cb91a4403eb38391a7f190867a", "filename": "crates/ra_hir_ty/src/tests/simple.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/28f0171dbdf51ab02bf3e8090d80dcdf0b733662/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/28f0171dbdf51ab02bf3e8090d80dcdf0b733662/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs?ref=28f0171dbdf51ab02bf3e8090d80dcdf0b733662", "patch": "@@ -324,6 +324,29 @@ fn test() {\n     );\n }\n \n+#[test]\n+fn infer_union() {\n+    assert_snapshot!(\n+        infer(r#\"\n+union MyUnion {\n+    foo: u32,\n+    bar: f32,\n+}\n+\n+unsafe fn baz(u: MyUnion) {\n+    let inner = u.foo;\n+}\n+\"#),\n+        @r###\"\n+    61..62 'u': MyUnion\n+    73..99 '{     ...foo; }': ()\n+    83..88 'inner': u32\n+    91..92 'u': MyUnion\n+    91..96 'u.foo': u32\n+    \"###\n+    );\n+}\n+\n #[test]\n fn infer_refs() {\n     assert_snapshot!("}]}