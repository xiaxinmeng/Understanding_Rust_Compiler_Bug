{"sha": "695aa59c6df35343ebbcb153f6249cde0d018139", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5NWFhNTljNmRmMzUzNDNlYmJjYjE1M2Y2MjQ5Y2RlMGQwMTgxMzk=", "commit": {"author": {"name": "Heinz N. Gies", "email": "heinz@licenser.net", "date": "2019-10-18T19:09:42Z"}, "committer": {"name": "Heinz N. Gies", "email": "heinz@licenser.net", "date": "2019-11-07T16:10:18Z"}, "message": "Add lint for exit", "tree": {"sha": "6568687cf11fc47b09bc49766d6fca22f116a290", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6568687cf11fc47b09bc49766d6fca22f116a290"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/695aa59c6df35343ebbcb153f6249cde0d018139", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/695aa59c6df35343ebbcb153f6249cde0d018139", "html_url": "https://github.com/rust-lang/rust/commit/695aa59c6df35343ebbcb153f6249cde0d018139", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/695aa59c6df35343ebbcb153f6249cde0d018139/comments", "author": {"login": "Licenser", "id": 119093, "node_id": "MDQ6VXNlcjExOTA5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/119093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Licenser", "html_url": "https://github.com/Licenser", "followers_url": "https://api.github.com/users/Licenser/followers", "following_url": "https://api.github.com/users/Licenser/following{/other_user}", "gists_url": "https://api.github.com/users/Licenser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Licenser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Licenser/subscriptions", "organizations_url": "https://api.github.com/users/Licenser/orgs", "repos_url": "https://api.github.com/users/Licenser/repos", "events_url": "https://api.github.com/users/Licenser/events{/privacy}", "received_events_url": "https://api.github.com/users/Licenser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Licenser", "id": 119093, "node_id": "MDQ6VXNlcjExOTA5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/119093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Licenser", "html_url": "https://github.com/Licenser", "followers_url": "https://api.github.com/users/Licenser/followers", "following_url": "https://api.github.com/users/Licenser/following{/other_user}", "gists_url": "https://api.github.com/users/Licenser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Licenser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Licenser/subscriptions", "organizations_url": "https://api.github.com/users/Licenser/orgs", "repos_url": "https://api.github.com/users/Licenser/repos", "events_url": "https://api.github.com/users/Licenser/events{/privacy}", "received_events_url": "https://api.github.com/users/Licenser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7531a08eed84a86e96d1cffdd002654507819873", "url": "https://api.github.com/repos/rust-lang/rust/commits/7531a08eed84a86e96d1cffdd002654507819873", "html_url": "https://github.com/rust-lang/rust/commit/7531a08eed84a86e96d1cffdd002654507819873"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "222f84bd028e0ecc38015da013995f80c4d637ea", "filename": "clippy_lints/src/exit.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Fexit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Fexit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fexit.rs?ref=695aa59c6df35343ebbcb153f6249cde0d018139", "patch": "@@ -0,0 +1,41 @@\n+use crate::utils::{match_def_path, paths, qpath_res, span_lint};\n+use if_chain::if_chain;\n+use rustc::hir::{Expr, ExprKind};\n+use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n+use rustc::{declare_lint_pass, declare_tool_lint};\n+\n+declare_clippy_lint! {\n+    /// **What it does:** `exit()`  terminates the program and doesn't provide a\n+    /// stack trace.\n+    ///\n+    /// **Why is this bad?** Ideally a program is terminated by finishing\n+    /// the main function.\n+    ///\n+    /// **Known problems:** This can be valid code in main() to return\n+    /// errors\n+    ///\n+    /// **Example:**\n+    /// ```ignore\n+    /// std::process::exit(0)\n+    /// ```\n+    pub EXIT,\n+    restriction,\n+    \"`std::process::exit` is called, terminating the program\"\n+}\n+\n+declare_lint_pass!(Exit => [EXIT]);\n+\n+impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Exit {\n+    fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, e: &'tcx Expr) {\n+        if_chain! {\n+            if let ExprKind::Call(ref path_expr, ref _args) = e.kind;\n+            if let ExprKind::Path(ref path) = path_expr.kind;\n+            if let Some(def_id) = qpath_res(cx, path, path_expr.hir_id).opt_def_id();\n+            if match_def_path(cx, def_id, &paths::EXIT);\n+            then {\n+                span_lint(cx, EXIT, e.span, \"usage of `process::exit`\");\n+            }\n+\n+        }\n+    }\n+}"}, {"sha": "99bbaf32c2908edb269616c23e6292a5d23b97d6", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=695aa59c6df35343ebbcb153f6249cde0d018139", "patch": "@@ -188,6 +188,7 @@ pub mod escape;\n pub mod eta_reduction;\n pub mod eval_order_dependence;\n pub mod excessive_precision;\n+pub mod exit;\n pub mod explicit_write;\n pub mod fallible_impl_from;\n pub mod format;\n@@ -941,6 +942,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n     store.register_early_pass(move || box enum_variants::EnumVariantNames::new(enum_variant_name_threshold));\n     store.register_late_pass(|| box unused_self::UnusedSelf);\n     store.register_late_pass(|| box mutable_debug_assertion::DebugAssertWithMutCall);\n+    reg.register_late_lint_pass(||box exit::Exit);\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),"}, {"sha": "042ca4ee7fdc1bc2dd4c69df211e5654d17a61e9", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/695aa59c6df35343ebbcb153f6249cde0d018139/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=695aa59c6df35343ebbcb153f6249cde0d018139", "patch": "@@ -27,6 +27,7 @@ pub const DROP: [&str; 3] = [\"core\", \"mem\", \"drop\"];\n pub const DROP_TRAIT: [&str; 4] = [\"core\", \"ops\", \"drop\", \"Drop\"];\n pub const DURATION: [&str; 3] = [\"core\", \"time\", \"Duration\"];\n pub const EARLY_CONTEXT: [&str; 4] = [\"rustc\", \"lint\", \"context\", \"EarlyContext\"];\n+pub const EXIT: [&str; 3] = [\"std\", \"process\", \"exit\"];\n pub const FMT_ARGUMENTS_NEW_V1: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1\"];\n pub const FMT_ARGUMENTS_NEW_V1_FORMATTED: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1_formatted\"];\n pub const FMT_ARGUMENTV1_NEW: [&str; 4] = [\"core\", \"fmt\", \"ArgumentV1\", \"new\"];"}, {"sha": "1850241c4768e3a40ad69fb8dec4934bfeba390a", "filename": "tests/ui/exit.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/695aa59c6df35343ebbcb153f6249cde0d018139/tests%2Fui%2Fexit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/695aa59c6df35343ebbcb153f6249cde0d018139/tests%2Fui%2Fexit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit.rs?ref=695aa59c6df35343ebbcb153f6249cde0d018139", "patch": "@@ -0,0 +1,4 @@\n+#[warn(clippy::exit)]\n+fn main() {\n+    std::process::exit(1);\n+}"}, {"sha": "4fd29439550101fb065d65167305ed266d5c0bff", "filename": "tests/ui/exit.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/695aa59c6df35343ebbcb153f6249cde0d018139/tests%2Fui%2Fexit.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/695aa59c6df35343ebbcb153f6249cde0d018139/tests%2Fui%2Fexit.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit.stderr?ref=695aa59c6df35343ebbcb153f6249cde0d018139", "patch": "@@ -0,0 +1,10 @@\n+error: usage of `process::exit`\n+  --> $DIR/exit.rs:3:5\n+   |\n+LL |     std::process::exit(1);\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::exit` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}