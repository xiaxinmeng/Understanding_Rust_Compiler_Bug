{"sha": "b5c330bf5a1884ff8ad196a23fa6e356c460e130", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1YzMzMGJmNWExODg0ZmY4YWQxOTZhMjNmYTZlMzU2YzQ2MGUxMzA=", "commit": {"author": {"name": "Jesse Bakker", "email": "git@jessebakker.com", "date": "2020-05-02T16:10:23Z"}, "committer": {"name": "Jesse Bakker", "email": "git@jessebakker.com", "date": "2020-05-02T16:25:38Z"}, "message": "Make `change_visibility` assist work for tuple struct field visibility", "tree": {"sha": "638ce4b87487a89a5f28962a26dba8d0efa5ad74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/638ce4b87487a89a5f28962a26dba8d0efa5ad74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5c330bf5a1884ff8ad196a23fa6e356c460e130", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5c330bf5a1884ff8ad196a23fa6e356c460e130", "html_url": "https://github.com/rust-lang/rust/commit/b5c330bf5a1884ff8ad196a23fa6e356c460e130", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5c330bf5a1884ff8ad196a23fa6e356c460e130/comments", "author": null, "committer": null, "parents": [{"sha": "89e1f97515c36ab97bd378d972cabec0feb6d77e", "url": "https://api.github.com/repos/rust-lang/rust/commits/89e1f97515c36ab97bd378d972cabec0feb6d77e", "html_url": "https://github.com/rust-lang/rust/commit/89e1f97515c36ab97bd378d972cabec0feb6d77e"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "1cd532e801d3395c62076102b9cbe5f4b29f0627", "filename": "crates/ra_assists/src/handlers/change_visibility.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b5c330bf5a1884ff8ad196a23fa6e356c460e130/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fchange_visibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5c330bf5a1884ff8ad196a23fa6e356c460e130/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fchange_visibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fchange_visibility.rs?ref=b5c330bf5a1884ff8ad196a23fa6e356c460e130", "patch": "@@ -47,8 +47,7 @@ fn add_vis(ctx: AssistCtx) -> Option<Assist> {\n             return None;\n         }\n         (vis_offset(&parent), keyword.text_range())\n-    } else {\n-        let field_name: ast::Name = ctx.find_node_at_offset()?;\n+    } else if let Some(field_name) = ctx.find_node_at_offset::<ast::Name>() {\n         let field = field_name.syntax().ancestors().find_map(ast::RecordFieldDef::cast)?;\n         if field.name()? != field_name {\n             tested_by!(change_visibility_field_false_positive);\n@@ -58,6 +57,13 @@ fn add_vis(ctx: AssistCtx) -> Option<Assist> {\n             return None;\n         }\n         (vis_offset(field.syntax()), field_name.syntax().text_range())\n+    } else if let Some(field) = ctx.find_node_at_offset::<ast::TupleFieldDef>() {\n+        if field.visibility().is_some() {\n+            return None;\n+        }\n+        (vis_offset(field.syntax()), field.syntax().text_range())\n+    } else {\n+        return None;\n     };\n \n     ctx.add_assist(AssistId(\"change_visibility\"), \"Change visibility to pub(crate)\", |edit| {\n@@ -129,7 +135,8 @@ mod tests {\n             change_visibility,\n             r\"struct S { <|>field: u32 }\",\n             r\"struct S { <|>pub(crate) field: u32 }\",\n-        )\n+        );\n+        check_assist(change_visibility, r\"struct S ( <|>u32 )\", r\"struct S ( <|>pub(crate) u32 )\");\n     }\n \n     #[test]"}]}