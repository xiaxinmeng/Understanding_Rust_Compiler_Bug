{"sha": "d88269bc2d36d163eef5173912c40d5b6eee3847", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4ODI2OWJjMmQzNmQxNjNlZWY1MTczOTEyYzQwZDViNmVlZTM4NDc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-04-13T06:38:37Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-04-13T06:38:37Z"}, "message": "generalize", "tree": {"sha": "482bdca882f4c61861735a344e4dd2f48887c5cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/482bdca882f4c61861735a344e4dd2f48887c5cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d88269bc2d36d163eef5173912c40d5b6eee3847", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d88269bc2d36d163eef5173912c40d5b6eee3847", "html_url": "https://github.com/rust-lang/rust/commit/d88269bc2d36d163eef5173912c40d5b6eee3847", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d88269bc2d36d163eef5173912c40d5b6eee3847/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17a0e228833de16ed7e8718ba177dceeec4abfb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/17a0e228833de16ed7e8718ba177dceeec4abfb2", "html_url": "https://github.com/rust-lang/rust/commit/17a0e228833de16ed7e8718ba177dceeec4abfb2"}], "stats": {"total": 22, "additions": 7, "deletions": 15}, "files": [{"sha": "5bb6d64ffc9a3d523e6721b82cf23b6195565326", "filename": "crates/ra_hir/src/source_binder.rs", "status": "modified", "additions": 7, "deletions": 15, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d88269bc2d36d163eef5173912c40d5b6eee3847/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d88269bc2d36d163eef5173912c40d5b6eee3847/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs?ref=d88269bc2d36d163eef5173912c40d5b6eee3847", "patch": "@@ -139,21 +139,13 @@ fn resolver_for_node(\n     node.ancestors()\n         .find_map(|node| {\n             if ast::Expr::cast(node).is_some() || ast::Block::cast(node).is_some() {\n-                if let Some(func) = node\n-                    .ancestors()\n-                    .find_map(ast::FnDef::cast)\n-                    .and_then(|it| function_from_source(db, file_id, it))\n-                {\n-                    let scopes = func.scopes(db);\n-                    let scope = match offset {\n-                        None => scopes.scope_for(&node),\n-                        Some(offset) => scopes.scope_for_offset(offset),\n-                    };\n-                    Some(expr::resolver_for_scope(func.body(db), db, scope))\n-                } else {\n-                    // FIXME const/static/array length\n-                    None\n-                }\n+                let def = def_with_body_from_child_node(db, file_id, node)?;\n+                let scopes = def.scopes(db);\n+                let scope = match offset {\n+                    None => scopes.scope_for(&node),\n+                    Some(offset) => scopes.scope_for_offset(offset),\n+                };\n+                Some(expr::resolver_for_scope(def.body(db), db, scope))\n             } else {\n                 try_get_resolver_for_node(db, file_id, node)\n             }"}]}