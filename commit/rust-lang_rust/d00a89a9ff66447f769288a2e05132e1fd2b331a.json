{"sha": "d00a89a9ff66447f769288a2e05132e1fd2b331a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwMGE4OWE5ZmY2NjQ0N2Y3NjkyODhhMmUwNTEzMmUxZmQyYjMzMWE=", "commit": {"author": {"name": "Jonathan Turner", "email": "jonathandturner@users.noreply.github.com", "date": "2016-08-27T19:43:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-27T19:43:31Z"}, "message": "Rollup merge of #36044 - mikhail-m1:master, r=jonathandturner\n\nupdate error E0450 to new format\n\nFixes #35925 as part of #35233.\n\nI've solve the bonus, and I wonder if any simpler way to do this. But may be possible simplify if let expressions?\n\nr? @jonathandturner", "tree": {"sha": "e1d9dd3c908e1121806b25945f8ab1055a9ffb87", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1d9dd3c908e1121806b25945f8ab1055a9ffb87"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d00a89a9ff66447f769288a2e05132e1fd2b331a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d00a89a9ff66447f769288a2e05132e1fd2b331a", "html_url": "https://github.com/rust-lang/rust/commit/d00a89a9ff66447f769288a2e05132e1fd2b331a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d00a89a9ff66447f769288a2e05132e1fd2b331a/comments", "author": {"login": "jonathandturner", "id": 111457284, "node_id": "O_kgDOBqS0BA", "avatar_url": "https://avatars.githubusercontent.com/u/111457284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathandturner", "html_url": "https://github.com/jonathandturner", "followers_url": "https://api.github.com/users/jonathandturner/followers", "following_url": "https://api.github.com/users/jonathandturner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathandturner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathandturner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathandturner/subscriptions", "organizations_url": "https://api.github.com/users/jonathandturner/orgs", "repos_url": "https://api.github.com/users/jonathandturner/repos", "events_url": "https://api.github.com/users/jonathandturner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathandturner/received_events", "type": "Organization", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bab26e6f3fabdd9f5c3b855047fdad2179f4334", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bab26e6f3fabdd9f5c3b855047fdad2179f4334", "html_url": "https://github.com/rust-lang/rust/commit/3bab26e6f3fabdd9f5c3b855047fdad2179f4334"}, {"sha": "9c07ed21282fa0710580d589c6ba468ae12455df", "url": "https://api.github.com/repos/rust-lang/rust/commits/9c07ed21282fa0710580d589c6ba468ae12455df", "html_url": "https://github.com/rust-lang/rust/commit/9c07ed21282fa0710580d589c6ba468ae12455df"}], "stats": {"total": 41, "additions": 32, "deletions": 9}, "files": [{"sha": "6da901a5f86c03a4345cd6e6a77ebe5966fd56b7", "filename": "src/librustc_privacy/lib.rs", "status": "modified", "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/d00a89a9ff66447f769288a2e05132e1fd2b331a/src%2Flibrustc_privacy%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d00a89a9ff66447f769288a2e05132e1fd2b331a/src%2Flibrustc_privacy%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_privacy%2Flib.rs?ref=d00a89a9ff66447f769288a2e05132e1fd2b331a", "patch": "@@ -444,13 +444,32 @@ impl<'a, 'tcx, 'v> Visitor<'v> for PrivacyVisitor<'a, 'tcx> {\n                         }), ..}) => ty,\n                         _ => expr_ty\n                     }.ty_adt_def().unwrap();\n-                    let any_priv = def.struct_variant().fields.iter().any(|f| {\n-                        !f.vis.is_accessible_from(self.curitem, &self.tcx.map)\n-                    });\n-                    if any_priv {\n-                        span_err!(self.tcx.sess, expr.span, E0450,\n-                                  \"cannot invoke tuple struct constructor with private \\\n-                                   fields\");\n+\n+                    let private_indexes : Vec<_> = def.struct_variant().fields.iter().enumerate()\n+                        .filter(|&(_,f)| {\n+                            !f.vis.is_accessible_from(self.curitem, &self.tcx.map)\n+                    }).map(|(n,&_)|n).collect();\n+\n+                    if !private_indexes.is_empty() {\n+\n+                        let mut error = struct_span_err!(self.tcx.sess, expr.span, E0450,\n+                                                         \"cannot invoke tuple struct constructor \\\n+                                                         with private fields\");\n+                        error.span_label(expr.span,\n+                                         &format!(\"cannot construct with a private field\"));\n+\n+                        if let Some(def_id) = self.tcx.map.as_local_node_id(def.did) {\n+                            if let Some(hir::map::NodeItem(node)) = self.tcx.map.find(def_id) {\n+                                if let hir::Item_::ItemStruct(ref tuple_data, _) = node.node {\n+\n+                                    for i in private_indexes {\n+                                        error.span_label(tuple_data.fields()[i].span,\n+                                                         &format!(\"private field declared here\"));\n+                                    }\n+                                }\n+                            }\n+                        }\n+                        error.emit();\n                     }\n                 }\n             }"}, {"sha": "200b58a329344780be4b7610c1787fe6c7b589aa", "filename": "src/test/compile-fail/E0450.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d00a89a9ff66447f769288a2e05132e1fd2b331a/src%2Ftest%2Fcompile-fail%2FE0450.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d00a89a9ff66447f769288a2e05132e1fd2b331a/src%2Ftest%2Fcompile-fail%2FE0450.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0450.rs?ref=d00a89a9ff66447f769288a2e05132e1fd2b331a", "patch": "@@ -9,9 +9,13 @@\n // except according to those terms.\n \n mod Bar {\n-    pub struct Foo(isize);\n+    pub struct Foo( bool, pub i32, f32, bool);\n+    //~^ NOTE private field declared here\n+    //~| NOTE private field declared here\n+    //~| NOTE private field declared here\n }\n \n fn main() {\n-    let f = Bar::Foo(0); //~ ERROR E0450\n+    let f = Bar::Foo(false,1,0.1, true); //~ ERROR E0450\n+                         //~^ NOTE cannot construct with a private field\n }"}]}