{"sha": "24380a60f5452a673ed892a3c12b9556b57b12a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0MzgwYTYwZjU0NTJhNjczZWQ4OTJhM2MxMmI5NTU2YjU3YjEyYTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-06T15:35:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-06T15:35:01Z"}, "message": "Auto merge of #87784 - rusticstuff:bootstrap_config_overflow_checks, r=Mark-Simulacrum\n\nAdd config.toml options for enabling overflow checks in rustc and std\n\nThe names are `overflow-checks` and `overflow-checks-std` and they work similar to  `debug-assertions` and `debug-assertions-std`. Once added we can measure how big the performance impact actually is and maybe enable them for CI tests.\n\nEnabling them already makes two ui tests fail:\n```\nfailures:\n    [ui] ui/parser/item-free-const-no-body-semantic-fail.rs\n    [ui] ui/parser/item-free-static-no-body-semantic-fail.rs\n```\n(See #84219 and #87761.)", "tree": {"sha": "ba2d564a3528250d87f752aab56f7f824b95cb83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba2d564a3528250d87f752aab56f7f824b95cb83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24380a60f5452a673ed892a3c12b9556b57b12a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24380a60f5452a673ed892a3c12b9556b57b12a1", "html_url": "https://github.com/rust-lang/rust/commit/24380a60f5452a673ed892a3c12b9556b57b12a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24380a60f5452a673ed892a3c12b9556b57b12a1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c29cc8fd09889880880cb6081174c79744ab1b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c29cc8fd09889880880cb6081174c79744ab1b6", "html_url": "https://github.com/rust-lang/rust/commit/4c29cc8fd09889880880cb6081174c79744ab1b6"}, {"sha": "2f7095389d70d3a677d3eb61821e26affe4f92ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f7095389d70d3a677d3eb61821e26affe4f92ce", "html_url": "https://github.com/rust-lang/rust/commit/2f7095389d70d3a677d3eb61821e26affe4f92ce"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "2f99e36aef219c99c4f57da1cf3b1150c417d50e", "filename": "src/bootstrap/CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCHANGELOG.md?ref=24380a60f5452a673ed892a3c12b9556b57b12a1", "patch": "@@ -9,6 +9,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n \n - `llvm-libunwind` now accepts `in-tree` (formerly true), `system` or `no` (formerly false) [#77703](https://github.com/rust-lang/rust/pull/77703)\n - The options `infodir`, `localstatedir`, and `gpg-password-file` are no longer allowed in config.toml. Previously, they were ignored without warning. Note that `infodir` and `localstatedir` are still accepted by `./configure`, with a warning. [#82451](https://github.com/rust-lang/rust/pull/82451)\n+- Add options for enabling overflow checks, one for std (`overflow-checks-std`) and one for everything else (`overflow-checks`). Both default to false.\n \n ### Non-breaking changes\n "}, {"sha": "34708fb0816df65139fa754b137b7525ba304856", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=24380a60f5452a673ed892a3c12b9556b57b12a1", "patch": "@@ -1205,6 +1205,14 @@ impl<'a> Builder<'a> {\n                 self.config.rust_debug_assertions.to_string()\n             },\n         );\n+        cargo.env(\n+            profile_var(\"OVERFLOW_CHECKS\"),\n+            if mode == Mode::Std {\n+                self.config.rust_overflow_checks_std.to_string()\n+            } else {\n+                self.config.rust_overflow_checks.to_string()\n+            },\n+        );\n \n         // `dsymutil` adds time to builds on Apple platforms for no clear benefit, and also makes\n         // it more difficult for debuggers to find debug info. The compiler currently defaults to"}, {"sha": "dd536cb7b02bfdc74ba4a23723e7c129ff285e8b", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=24380a60f5452a673ed892a3c12b9556b57b12a1", "patch": "@@ -123,6 +123,8 @@ pub struct Config {\n     pub rust_codegen_units_std: Option<u32>,\n     pub rust_debug_assertions: bool,\n     pub rust_debug_assertions_std: bool,\n+    pub rust_overflow_checks: bool,\n+    pub rust_overflow_checks_std: bool,\n     pub rust_debug_logging: bool,\n     pub rust_debuginfo_level_rustc: u32,\n     pub rust_debuginfo_level_std: u32,\n@@ -473,6 +475,8 @@ struct Rust {\n     codegen_units_std: Option<u32>,\n     debug_assertions: Option<bool>,\n     debug_assertions_std: Option<bool>,\n+    overflow_checks: Option<bool>,\n+    overflow_checks_std: Option<bool>,\n     debug_logging: Option<bool>,\n     debuginfo_level: Option<u32>,\n     debuginfo_level_rustc: Option<u32>,\n@@ -710,6 +714,8 @@ impl Config {\n         let mut debug = None;\n         let mut debug_assertions = None;\n         let mut debug_assertions_std = None;\n+        let mut overflow_checks = None;\n+        let mut overflow_checks_std = None;\n         let mut debug_logging = None;\n         let mut debuginfo_level = None;\n         let mut debuginfo_level_rustc = None;\n@@ -831,6 +837,8 @@ impl Config {\n             debug = rust.debug;\n             debug_assertions = rust.debug_assertions;\n             debug_assertions_std = rust.debug_assertions_std;\n+            overflow_checks = rust.overflow_checks;\n+            overflow_checks_std = rust.overflow_checks_std;\n             debug_logging = rust.debug_logging;\n             debuginfo_level = rust.debuginfo_level;\n             debuginfo_level_rustc = rust.debuginfo_level_rustc;\n@@ -968,6 +976,8 @@ impl Config {\n         config.rust_debug_assertions = debug_assertions.unwrap_or(default);\n         config.rust_debug_assertions_std =\n             debug_assertions_std.unwrap_or(config.rust_debug_assertions);\n+        config.rust_overflow_checks = overflow_checks.unwrap_or(default);\n+        config.rust_overflow_checks_std = overflow_checks_std.unwrap_or(default);\n \n         config.rust_debug_logging = debug_logging.unwrap_or(config.rust_debug_assertions);\n "}, {"sha": "fd148d14478d89db4ac62ce10b3e3a22c5edeed8", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/24380a60f5452a673ed892a3c12b9556b57b12a1/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=24380a60f5452a673ed892a3c12b9556b57b12a1", "patch": "@@ -75,6 +75,7 @@ def v(*args):\n o(\"llvm-assertions\", \"llvm.assertions\", \"build LLVM with assertions\")\n o(\"llvm-plugins\", \"llvm.plugins\", \"build LLVM with plugin interface\")\n o(\"debug-assertions\", \"rust.debug-assertions\", \"build with debugging assertions\")\n+o(\"overflow-checks\", \"rust.overflow-checks\", \"build with overflow checks\")\n o(\"llvm-release-debuginfo\", \"llvm.release-debuginfo\", \"build LLVM with debugger metadata\")\n v(\"debuginfo-level\", \"rust.debuginfo-level\", \"debuginfo level for Rust code\")\n v(\"debuginfo-level-rustc\", \"rust.debuginfo-level-rustc\", \"debuginfo level for the compiler\")"}]}