{"sha": "038394a330f24e5ec63d78657a32f3279b8b276b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzODM5NGEzMzBmMjRlNWVjNjNkNzg2NTdhMzJmMzI3OWI4YjI3NmI=", "commit": {"author": {"name": "The8472", "email": "git@infinite-source.de", "date": "2019-10-18T22:00:45Z"}, "committer": {"name": "The8472", "email": "git@infinite-source.de", "date": "2020-09-03T18:56:34Z"}, "message": "bench", "tree": {"sha": "5da46b05827bbfbc0c4a84f274d61b161afbaf9d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5da46b05827bbfbc0c4a84f274d61b161afbaf9d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/038394a330f24e5ec63d78657a32f3279b8b276b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/038394a330f24e5ec63d78657a32f3279b8b276b", "html_url": "https://github.com/rust-lang/rust/commit/038394a330f24e5ec63d78657a32f3279b8b276b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/038394a330f24e5ec63d78657a32f3279b8b276b/comments", "author": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "committer": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "076417e978d86676bc403bb7ed963c107a8f72db", "url": "https://api.github.com/repos/rust-lang/rust/commits/076417e978d86676bc403bb7ed963c107a8f72db", "html_url": "https://github.com/rust-lang/rust/commit/076417e978d86676bc403bb7ed963c107a8f72db"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "2eee988dccc808da47738148587f8ba24cd9feaa", "filename": "library/alloc/benches/vec.rs", "status": "modified", "additions": 40, "deletions": 1, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/038394a330f24e5ec63d78657a32f3279b8b276b/library%2Falloc%2Fbenches%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/038394a330f24e5ec63d78657a32f3279b8b276b/library%2Falloc%2Fbenches%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fbenches%2Fvec.rs?ref=038394a330f24e5ec63d78657a32f3279b8b276b", "patch": "@@ -1,5 +1,5 @@\n use std::iter::{repeat, FromIterator};\n-use test::Bencher;\n+use test::{black_box, Bencher};\n \n #[bench]\n fn bench_new(b: &mut Bencher) {\n@@ -431,3 +431,42 @@ fn bench_clone_from_10_0100_0010(b: &mut Bencher) {\n fn bench_clone_from_10_1000_0100(b: &mut Bencher) {\n     do_bench_clone_from(b, 10, 1000, 100)\n }\n+\n+macro_rules! bench_in_place {\n+    (\n+        $($fname:ident, $type:ty , $count:expr, $init: expr);*\n+    ) => {\n+        $(\n+            #[bench]\n+            fn $fname(b: &mut Bencher) {\n+                b.iter(|| {\n+                    let src: Vec<$type> = vec![$init; $count];\n+                    black_box(src.into_iter()\n+                        .enumerate()\n+                        .map(|(idx, e)| { (idx as $type) ^ e }).collect::<Vec<$type>>())\n+                });\n+            }\n+        )+\n+    };\n+}\n+\n+bench_in_place![\n+    bench_in_place_xxu8_i0_0010,     u8,     10, 0;\n+    bench_in_place_xxu8_i0_0100,     u8,    100, 0;\n+    bench_in_place_xxu8_i0_1000,     u8,   1000, 0;\n+    bench_in_place_xxu8_i1_0010,     u8,     10, 1;\n+    bench_in_place_xxu8_i1_0100,     u8,    100, 1;\n+    bench_in_place_xxu8_i1_1000,     u8,   1000, 1;\n+    bench_in_place_xu32_i0_0010,    u32,     10, 0;\n+    bench_in_place_xu32_i0_0100,    u32,    100, 0;\n+    bench_in_place_xu32_i0_1000,    u32,   1000, 0;\n+    bench_in_place_xu32_i1_0010,    u32,     10, 1;\n+    bench_in_place_xu32_i1_0100,    u32,    100, 1;\n+    bench_in_place_xu32_i1_1000,    u32,   1000, 1;\n+    bench_in_place_u128_i0_0010,   u128,     10, 0;\n+    bench_in_place_u128_i0_0100,   u128,    100, 0;\n+    bench_in_place_u128_i0_1000,   u128,   1000, 0;\n+    bench_in_place_u128_i1_0010,   u128,     10, 1;\n+    bench_in_place_u128_i1_0100,   u128,    100, 1;\n+    bench_in_place_u128_i1_1000,   u128,   1000, 1\n+];"}]}