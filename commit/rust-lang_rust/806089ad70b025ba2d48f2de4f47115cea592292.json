{"sha": "806089ad70b025ba2d48f2de4f47115cea592292", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwNjA4OWFkNzBiMDI1YmEyZDQ4ZjJkZTRmNDcxMTVjZWE1OTIyOTI=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-05-07T15:58:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-07T15:58:59Z"}, "message": "Rollup merge of #71972 - RalfJung:miri-validity-error-refine, r=oli-obk\n\nuse hex for pointers in Miri error messages\n\nAlso refine vtable error message: distinguish between \"drop fn does not point to a function\" and \"drop fn points to a function with the wrong signature\".", "tree": {"sha": "6f9ec4a25b2a24072d1c7fd6fbe64593da2200d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f9ec4a25b2a24072d1c7fd6fbe64593da2200d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/806089ad70b025ba2d48f2de4f47115cea592292", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJetDBDCRBK7hj4Ov3rIwAAdHIIACy+PH0/KofTm3y1Rxy1cOLP\nPYVeMQoXxltGD/xgv6XuMy1R0doz/z+XMet5WABwYBUZpnwU3t1/HFvHcqVmj4/q\n1U2Rasg3AjioF+u+XXblNjHcDbXONSspCBhVQGv8MXyHiZQ3Q08oEzyq05nl88rw\nPDNYBM2G7gRFjO+nIxXG5BXVAumfCTE4pv+vZZ2rdTykojT0ZQO/SeHeBYYqlvhh\nXa0h9Tuz2WiHzT7YX/BNLTemCiCNMKP8L1nff8rCFSPazg6FUOmZlocOLoM/F32L\n3U1C99GS6Y83nudZ8OR8TY5c5ERVmnG/EGk8ZUqdG+F28EkJeyvie2oG37Po/rM=\n=kXXd\n-----END PGP SIGNATURE-----\n", "payload": "tree 6f9ec4a25b2a24072d1c7fd6fbe64593da2200d4\nparent 2e9db8df65ac143648664359dcc153325cf2bd04\nparent d1ea287febf5ea99551543ebd8cb26124e94280f\nauthor Dylan DPC <dylan.dpc@gmail.com> 1588867139 +0200\ncommitter GitHub <noreply@github.com> 1588867139 +0200\n\nRollup merge of #71972 - RalfJung:miri-validity-error-refine, r=oli-obk\n\nuse hex for pointers in Miri error messages\n\nAlso refine vtable error message: distinguish between \"drop fn does not point to a function\" and \"drop fn points to a function with the wrong signature\".\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/806089ad70b025ba2d48f2de4f47115cea592292", "html_url": "https://github.com/rust-lang/rust/commit/806089ad70b025ba2d48f2de4f47115cea592292", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/806089ad70b025ba2d48f2de4f47115cea592292/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e9db8df65ac143648664359dcc153325cf2bd04", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e9db8df65ac143648664359dcc153325cf2bd04", "html_url": "https://github.com/rust-lang/rust/commit/2e9db8df65ac143648664359dcc153325cf2bd04"}, {"sha": "d1ea287febf5ea99551543ebd8cb26124e94280f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1ea287febf5ea99551543ebd8cb26124e94280f", "html_url": "https://github.com/rust-lang/rust/commit/d1ea287febf5ea99551543ebd8cb26124e94280f"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "eb743675d91d3eceb843ff89d54fc3f42332bf9c", "filename": "src/librustc_mir/interpret/validity.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/806089ad70b025ba2d48f2de4f47115cea592292/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/806089ad70b025ba2d48f2de4f47115cea592292/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs?ref=806089ad70b025ba2d48f2de4f47115cea592292", "patch": "@@ -321,11 +321,12 @@ impl<'rt, 'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> ValidityVisitor<'rt, 'mir, '\n                 try_validation!(\n                     self.ecx.read_drop_type_from_vtable(vtable),\n                     self.path,\n-                    err_ub!(InvalidDropFn(..)) |\n                     err_ub!(DanglingIntPointer(..)) |\n                     err_ub!(InvalidFunctionPointer(..)) |\n                     err_unsup!(ReadBytesAsPointer) =>\n-                        { \"invalid drop function pointer in vtable\" },\n+                        { \"invalid drop function pointer in vtable (not pointing to a function)\" },\n+                    err_ub!(InvalidDropFn(..)) =>\n+                        { \"invalid drop function pointer in vtable (function has incompatible signature)\" },\n                 );\n                 try_validation!(\n                     self.ecx.read_size_and_align_from_vtable(vtable),\n@@ -400,7 +401,7 @@ impl<'rt, 'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> ValidityVisitor<'rt, 'mir, '\n             err_ub!(DanglingIntPointer(0, _)) =>\n                 { \"a NULL {}\", kind },\n             err_ub!(DanglingIntPointer(i, _)) =>\n-                { \"a dangling {} (address {} is unallocated)\", kind, i },\n+                { \"a dangling {} (address 0x{:x} is unallocated)\", kind, i },\n             err_ub!(PointerOutOfBounds { .. }) =>\n                 { \"a dangling {} (going beyond the bounds of its allocation)\", kind },\n             err_unsup!(ReadBytesAsPointer) =>"}, {"sha": "063ea81036b69d0972ce182636c84598f30e84b8", "filename": "src/test/ui/consts/const-eval/ub-wide-ptr.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/806089ad70b025ba2d48f2de4f47115cea592292/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-wide-ptr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/806089ad70b025ba2d48f2de4f47115cea592292/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-wide-ptr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fub-wide-ptr.stderr?ref=806089ad70b025ba2d48f2de4f47115cea592292", "patch": "@@ -170,23 +170,23 @@ error[E0080]: it is undefined behavior to use this value\n   --> $DIR/ub-wide-ptr.rs:109:1\n    |\n LL | const TRAIT_OBJ_BAD_DROP_FN_NULL: &dyn Trait = unsafe { mem::transmute((&92u8, &[0usize; 8])) };\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable (not pointing to a function)\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rustc repository if you believe it should not be considered undefined behavior.\n \n error[E0080]: it is undefined behavior to use this value\n   --> $DIR/ub-wide-ptr.rs:111:1\n    |\n LL | const TRAIT_OBJ_BAD_DROP_FN_INT: &dyn Trait = unsafe { mem::transmute((&92u8, &[1usize; 8])) };\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable (not pointing to a function)\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rustc repository if you believe it should not be considered undefined behavior.\n \n error[E0080]: it is undefined behavior to use this value\n   --> $DIR/ub-wide-ptr.rs:113:1\n    |\n LL | const TRAIT_OBJ_BAD_DROP_FN_NOT_FN_PTR: &dyn Trait = unsafe { mem::transmute((&92u8, &[&42u8; 8])) };\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered invalid drop function pointer in vtable (not pointing to a function)\n    |\n    = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rustc repository if you believe it should not be considered undefined behavior.\n "}]}