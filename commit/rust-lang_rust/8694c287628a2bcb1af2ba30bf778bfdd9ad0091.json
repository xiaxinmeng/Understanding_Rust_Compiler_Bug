{"sha": "8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2OTRjMjg3NjI4YTJiY2IxYWYyYmEzMGJmNzc4YmZkZDlhZDAwOTE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-22T00:25:02Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-24T21:29:17Z"}, "message": "mk: Run 'make install' through install.sh", "tree": {"sha": "663c9d978dcb9aa885913531b778bc654a7e8c74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/663c9d978dcb9aa885913531b778bc654a7e8c74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "html_url": "https://github.com/rust-lang/rust/commit/8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "805d0e53fd174eb2ba1f14b69db797a386d98f13", "url": "https://api.github.com/repos/rust-lang/rust/commits/805d0e53fd174eb2ba1f14b69db797a386d98f13", "html_url": "https://github.com/rust-lang/rust/commit/805d0e53fd174eb2ba1f14b69db797a386d98f13"}], "stats": {"total": 80, "additions": 15, "deletions": 65}, "files": [{"sha": "660aeae62171328509f283cc646b42d7475782de", "filename": "Makefile.in", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "patch": "@@ -232,19 +232,20 @@ ifneq ($(strip $(findstring prepare,$(MAKECMDGOALS)) \\\n   include $(CFG_SRC_DIR)mk/prepare.mk\n endif\n \n-# (Unix) Installation from the build directory\n-ifneq ($(findstring install,$(MAKECMDGOALS)),)\n-  CFG_INFO := $(info cfg: including install rules)\n-  include $(CFG_SRC_DIR)mk/install.mk\n-endif\n-\n # Source and binary distribution artifacts\n ifneq ($(strip $(findstring dist,$(MAKECMDGOALS)) \\\n+               $(findstring install,$(MAKECMDGOALS)) \\\n                $(findstring clean,$(MAKECMDGOALS))),)\n   CFG_INFO := $(info cfg: including dist rules)\n   include $(CFG_SRC_DIR)mk/dist.mk\n endif\n \n+# (Unix) Installation from the build directory\n+ifneq ($(findstring install,$(MAKECMDGOALS)),)\n+  CFG_INFO := $(info cfg: including install rules)\n+  include $(CFG_SRC_DIR)mk/install.mk\n+endif\n+\n # Cleaning\n ifneq ($(findstring clean,$(MAKECMDGOALS)),)\n   CFG_INFO := $(info cfg: including clean rules)"}, {"sha": "f50ba91bf2bdbdc93dcdf1e902c055e0aecc181e", "filename": "mk/dist.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "patch": "@@ -22,7 +22,7 @@\n # * dist-tar-bins - Ad-hoc Unix binary installers\n # * dist-docs - Stage docs for upload\n \n-PKG_NAME = $(CFG_PACKAGE_NAME)\n+PKG_NAME := $(CFG_PACKAGE_NAME)\n \n PKG_GITMODULES := $(S)src/libuv $(S)src/llvm $(S)src/gyp $(S)src/compiler-rt\n PKG_FILES := \\"}, {"sha": "7bae272b47aa94a5d1444ff311d4b1eb06cc8b91", "filename": "mk/install.mk", "status": "modified", "additions": 7, "deletions": 58, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/8694c287628a2bcb1af2ba30bf778bfdd9ad0091/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=8694c287628a2bcb1af2ba30bf778bfdd9ad0091", "patch": "@@ -8,68 +8,17 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n-# FIXME: Docs are currently not installed from the stageN dirs.\n-# For consistency it might be desirable for stageN to be an exact\n-# mirror of the installation directory structure.\n \n-# The stage we install from\n-ISTAGE = $(PREPARE_STAGE)\n+install: dist-install-dir-$(CFG_BUILD)\n+\t$(Q)sh tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(CFG_PREFIX)\"\n \n-install: PREPARE_HOST=$(CFG_BUILD)\n-install: PREPARE_TARGETS=$(CFG_TARGET)\n-install: PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n-install: PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n-install: PREPARE_LIB_CMD=$(DEFAULT_PREPARE_LIB_CMD)\n-install: PREPARE_MAN_CMD=$(DEFAULT_PREPARE_MAN_CMD)\n-install: PREPARE_SOURCE_DIR=$(PREPARE_HOST)/stage$(PREPARE_STAGE)\n-install: PREPARE_SOURCE_BIN_DIR=$(PREPARE_SOURCE_DIR)/bin\n-install: PREPARE_SOURCE_LIB_DIR=$(PREPARE_SOURCE_DIR)/$(CFG_LIBDIR_RELATIVE)\n-install: PREPARE_SOURCE_MAN_DIR=$(S)/man\n-install: PREPARE_DEST_BIN_DIR=$(DESTDIR)$(CFG_PREFIX)/bin\n-install: PREPARE_DEST_LIB_DIR=$(DESTDIR)$(CFG_LIBDIR)\n-install: PREPARE_DEST_MAN_DIR=$(DESTDIR)$(CFG_MANDIR)/man1\n-install: prepare-everything\n+uninstall: dist-install-dir-$(CFG_BUILD)\n+\t$(Q)sh tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(CFG_PREFIX)\" --uninstall\n \n \n-# Uninstall code\n-\n-PREFIX_ROOT = $(CFG_PREFIX)\n-PREFIX_BIN = $(PREFIX_ROOT)/bin\n-PREFIX_LIB = $(CFG_LIBDIR)\n-\n-INSTALL_TOOLS := $(PREPARE_TOOLS)\n-\n-# Shorthand for build/stageN/bin\n-HB = $(HBIN$(ISTAGE)_H_$(CFG_BUILD))\n-HB2 = $(HBIN2_H_$(CFG_BUILD))\n-# Shorthand for build/stageN/lib\n-HL = $(HLIB$(ISTAGE)_H_$(CFG_BUILD))\n-# Shorthand for the prefix bin directory\n-PHB = $(PREFIX_BIN)\n-# Shorthand for the prefix bin directory\n-PHL = $(PREFIX_LIB)\n-\n-HOST_LIB_FROM_HL_GLOB = \\\n-  $(patsubst $(HL)/%,$(PHL)/%,$(wildcard $(HL)/$(1)))\n-\n-uninstall: $(foreach tool,$(INSTALL_TOOLS),uninstall-tool-$(tool))\n-\t$(Q)rm -Rf $(PHL)/$(CFG_RUSTLIBDIR)\n-\n-define UNINSTALL_TOOL\n-uninstall-tool-$(1): $$(foreach dep,$$(TOOL_DEPS_$(1)),uninstall-lib-$$(dep))\n-\t$$(Q)rm -f $$(PHB)/$(1)$$(X_$$(CFG_BUILD))\n-\t$$(Q)rm -f $$(CFG_MANDIR)/man1/$(1).1\n-endef\n-\n-$(foreach tool,$(INSTALL_TOOLS),$(eval $(call UNINSTALL_TOOL,$(tool))))\n-\n-define UNINSTALL_LIB\n-uninstall-lib-$(1): $$(foreach dep,$$(RUST_DEPS_$(1)),uninstall-lib-$$(dep))\n-\t$$(Q)rm -f $$(call HOST_LIB_FROM_HL_GLOB,$$(call CFG_LIB_GLOB_$$(CFG_BUILD),$(1)))\n-endef\n-\n-$(foreach lib,$(CRATES),$(eval $(call UNINSTALL_LIB,$(lib))))\n-\n+######################################################################\n+# Android remote installation\n+######################################################################\n \n # Android runtime setup\n # FIXME: This probably belongs somewhere else"}]}