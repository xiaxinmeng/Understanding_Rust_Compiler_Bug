{"sha": "1e4c2fb713a9d92828f63b63595e177fb575fd77", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNGMyZmI3MTNhOWQ5MjgyOGY2M2I2MzU5NWUxNzdmYjU3NWZkNzc=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-11-04T20:27:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-11-04T20:27:36Z"}, "message": "Merge pull request #2117 from adeschamps/issue-2103\n\nHandle case where there is a where clause but no generic parameters.", "tree": {"sha": "dccd46c6f5140586d68ae098d391978505444079", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dccd46c6f5140586d68ae098d391978505444079"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e4c2fb713a9d92828f63b63595e177fb575fd77", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJZ/iK4CRBK7hj4Ov3rIwAAdHIIAEq8gORkWzbvdQEPT9PbgYqr\n/ukRz8/+1MrOjLFxBWFt1CG9pUlof78HGIkKnzATrngh9Cci6N4WqVsvkp56cokK\nIXeXACydlWF2pGVVheoRishCTASFMapTrGxKPQNSLKiW2ZGUlv4LEOLUOK3ib/BB\nwYPIGKr8d0EM5yfQj1/7puAclZ8PqVat86QPqBnC2dT91WuLvO5RYDCBeZXgrcBN\nRl5KMBXRKI7kOZjfih7d7a2hWFTZSdrE9fjQjSFQ4OWS9zjFgtAqNAQqs1+CCMxT\n2YwmJnC1LUwT4tBe2oAN0r42jT0jR/oVgBbe1NVjyznaPtUlj/pT2zm2oBvPbY4=\n=immB\n-----END PGP SIGNATURE-----\n", "payload": "tree dccd46c6f5140586d68ae098d391978505444079\nparent db14ce0c69cd9f0363cdba75cf189872a76eb0b5\nparent 18ac341413cbac544ee16be0a0dbab865947fb63\nauthor Seiichi Uchida <seuchida@gmail.com> 1509827256 +0900\ncommitter GitHub <noreply@github.com> 1509827256 +0900\n\nMerge pull request #2117 from adeschamps/issue-2103\n\nHandle case where there is a where clause but no generic parameters."}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e4c2fb713a9d92828f63b63595e177fb575fd77", "html_url": "https://github.com/rust-lang/rust/commit/1e4c2fb713a9d92828f63b63595e177fb575fd77", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e4c2fb713a9d92828f63b63595e177fb575fd77/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db14ce0c69cd9f0363cdba75cf189872a76eb0b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/db14ce0c69cd9f0363cdba75cf189872a76eb0b5", "html_url": "https://github.com/rust-lang/rust/commit/db14ce0c69cd9f0363cdba75cf189872a76eb0b5"}, {"sha": "18ac341413cbac544ee16be0a0dbab865947fb63", "url": "https://api.github.com/repos/rust-lang/rust/commits/18ac341413cbac544ee16be0a0dbab865947fb63", "html_url": "https://github.com/rust-lang/rust/commit/18ac341413cbac544ee16be0a0dbab865947fb63"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "8fe51f7855cca06b3d42880226fd25e76872a063", "filename": "src/items.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1e4c2fb713a9d92828f63b63595e177fb575fd77/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e4c2fb713a9d92828f63b63595e177fb575fd77/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=1e4c2fb713a9d92828f63b63595e177fb575fd77", "patch": "@@ -1070,6 +1070,7 @@ pub fn format_struct_struct(\n     let header_str = format_header(item_name, ident, vis);\n     result.push_str(&header_str);\n \n+    let header_hi = span.lo() + BytePos(header_str.len() as u32);\n     let body_lo = context.codemap.span_after(span, \"{\");\n \n     let generics_str = match generics {\n@@ -1081,7 +1082,7 @@ pub fn format_struct_struct(\n             context.config.item_brace_style(),\n             fields.is_empty(),\n             offset,\n-            mk_sp(span.lo(), body_lo),\n+            mk_sp(header_hi, body_lo),\n             last_line_width(&result),\n         )?,\n         None => {\n@@ -2663,6 +2664,13 @@ fn format_generics(\n     let same_line_brace = if !generics.where_clause.predicates.is_empty() || result.contains('\\n') {\n         let budget = context.budget(last_line_used_width(&result, offset.width()));\n         let option = WhereClauseOption::snuggled(&result);\n+        // If the generics are not parameterized then generics.span.hi() == 0,\n+        // so we use span.lo(), which is the position after `struct Foo`.\n+        let span_end_before_where = if generics.is_parameterized() {\n+            generics.span.hi()\n+        } else {\n+            span.lo()\n+        };\n         let where_clause_str = rewrite_where_clause(\n             context,\n             &generics.where_clause,\n@@ -2671,7 +2679,7 @@ fn format_generics(\n             Density::Tall,\n             terminator,\n             Some(span.hi()),\n-            generics.span.hi(),\n+            span_end_before_where,\n             option,\n         )?;\n         result.push_str(&where_clause_str);"}, {"sha": "5a043d54b75baf8ee80bed671f1f719da81342ef", "filename": "tests/target/issue-2103.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1e4c2fb713a9d92828f63b63595e177fb575fd77/tests%2Ftarget%2Fissue-2103.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e4c2fb713a9d92828f63b63595e177fb575fd77/tests%2Ftarget%2Fissue-2103.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2103.rs?ref=1e4c2fb713a9d92828f63b63595e177fb575fd77", "patch": "@@ -0,0 +1,14 @@\n+struct X\n+where\n+    i32: Sized,\n+{\n+    x: i32,\n+}\n+\n+struct X\n+// with comment\n+where\n+    i32: Sized,\n+{\n+    x: i32,\n+}"}]}