{"sha": "36e6aa0aa686049736810d7444c1bfca8e14d38d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2ZTZhYTBhYTY4NjA0OTczNjgxMGQ3NDQ0YzFiZmNhOGUxNGQzOGQ=", "commit": {"author": {"name": "Nam Nguyen", "email": "nanguye@microsoft.com", "date": "2020-11-18T21:42:36Z"}, "committer": {"name": "Nam Nguyen", "email": "nanguye@microsoft.com", "date": "2020-11-30T22:31:34Z"}, "message": "Stop adding '*' at the end of type names for Ref and Slice when computing debug info for MSVC debuggers", "tree": {"sha": "e43c76e182f9d8edfa466ca7488056c69071fa88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e43c76e182f9d8edfa466ca7488056c69071fa88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/36e6aa0aa686049736810d7444c1bfca8e14d38d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/36e6aa0aa686049736810d7444c1bfca8e14d38d", "html_url": "https://github.com/rust-lang/rust/commit/36e6aa0aa686049736810d7444c1bfca8e14d38d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/36e6aa0aa686049736810d7444c1bfca8e14d38d/comments", "author": {"login": "nanguye", "id": 58788112, "node_id": "MDQ6VXNlcjU4Nzg4MTEy", "avatar_url": "https://avatars.githubusercontent.com/u/58788112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nanguye", "html_url": "https://github.com/nanguye", "followers_url": "https://api.github.com/users/nanguye/followers", "following_url": "https://api.github.com/users/nanguye/following{/other_user}", "gists_url": "https://api.github.com/users/nanguye/gists{/gist_id}", "starred_url": "https://api.github.com/users/nanguye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nanguye/subscriptions", "organizations_url": "https://api.github.com/users/nanguye/orgs", "repos_url": "https://api.github.com/users/nanguye/repos", "events_url": "https://api.github.com/users/nanguye/events{/privacy}", "received_events_url": "https://api.github.com/users/nanguye/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nanguye", "id": 58788112, "node_id": "MDQ6VXNlcjU4Nzg4MTEy", "avatar_url": "https://avatars.githubusercontent.com/u/58788112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nanguye", "html_url": "https://github.com/nanguye", "followers_url": "https://api.github.com/users/nanguye/followers", "following_url": "https://api.github.com/users/nanguye/following{/other_user}", "gists_url": "https://api.github.com/users/nanguye/gists{/gist_id}", "starred_url": "https://api.github.com/users/nanguye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nanguye/subscriptions", "organizations_url": "https://api.github.com/users/nanguye/orgs", "repos_url": "https://api.github.com/users/nanguye/repos", "events_url": "https://api.github.com/users/nanguye/events{/privacy}", "received_events_url": "https://api.github.com/users/nanguye/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d747db0d5dd8f08f2efb073e2e77a34553465a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d747db0d5dd8f08f2efb073e2e77a34553465a7", "html_url": "https://github.com/rust-lang/rust/commit/7d747db0d5dd8f08f2efb073e2e77a34553465a7"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "d1bbf74307c6bd1f7b8dbff0783e1f1ced5dfab6", "filename": "compiler/rustc_codegen_ssa/src/debuginfo/type_names.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/36e6aa0aa686049736810d7444c1bfca8e14d38d/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36e6aa0aa686049736810d7444c1bfca8e14d38d/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs?ref=36e6aa0aa686049736810d7444c1bfca8e14d38d", "patch": "@@ -94,7 +94,14 @@ pub fn push_debuginfo_type_name<'tcx>(\n             push_debuginfo_type_name(tcx, inner_type, true, output, visited);\n \n             if cpp_like_names {\n-                output.push('*');\n+                // Slices and `&str` are treated like C++ pointers when computing debug\n+                // info for MSVC debugger. However, adding '*' at the end of these types' names\n+                // causes the .natvis engine for WinDbg to fail to display their data, so we opt these\n+                // types out to aid debugging in MSVC.\n+                match *inner_type.kind() {\n+                    ty::Slice(_) | ty::Str => {}\n+                    _ => output.push('*'),\n+                }\n             }\n         }\n         ty::Array(inner_type, len) => {"}]}