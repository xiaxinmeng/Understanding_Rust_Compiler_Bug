{"sha": "67403da1ebefa360a4a2309d3ec92b56c8471362", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY3NDAzZGExZWJlZmEzNjBhNGEyMzA5ZDNlYzkyYjU2Yzg0NzEzNjI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-02-12T10:32:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-12T10:32:11Z"}, "message": "Rollup merge of #81955 - dtolnay:dwp, r=Mark-Simulacrum\n\nbootstrap: Locate llvm-dwp based on llvm-config bindir\n\nFixes #81949.\n\nTested by successfully building 1.50.0 pre-release, which is where I originally hit the issue (https://internals.rust-lang.org/t/rust-1-50-0-pre-release-testing/14012/4?u=dtolnay). Tested both with and without prebuilt LLVM. The check for dry_run is necessary in the non-prebuilt case because the llvm-config built by bootstrap won't exist yet.", "tree": {"sha": "8f9e6dbb0d83e092f192925def0292a90422e6aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f9e6dbb0d83e092f192925def0292a90422e6aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/67403da1ebefa360a4a2309d3ec92b56c8471362", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgJlkrCRBK7hj4Ov3rIwAAdHIIAK+hIUYLcq2SpaKNbyNSmZ1Q\nWFqX1d3SWLlHpEsSdxigTxlLF9y8dhGQ3vuIbWKFsDc/7GhqFPJ+r5EPVPUDCeUd\npoJPzV9UgGgrEEsXABcaSQGIbbP0aFKuOWgCatbo4Rx9rvgRhp0dBwgftWHvbt25\nTlYU12UmofQSFyDOajrCF5A4g0Yi9IZ1ejoWsDk4fxx6eyI7X29UDc+FOoiDwdaq\n58rJHna7bu8vjvPl4Fa/9FnvoL//G/Fe3D/nnfBcrorW/0D3yxbSA8d1l/kBMF7A\nlrtm+lr9orceXnmyPKvxQEkMXOcvAd7DnekBNKEGr0z8D1O3FNjqfBMtx8uP9cY=\n=nz6z\n-----END PGP SIGNATURE-----\n", "payload": "tree 8f9e6dbb0d83e092f192925def0292a90422e6aa\nparent 2a76add29f3c78cffa6475c4e6fdf6dd49a8299c\nparent d3fea13ae0949a64b5809ba6a7304307ddf3528e\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1613125931 +0900\ncommitter GitHub <noreply@github.com> 1613125931 +0900\n\nRollup merge of #81955 - dtolnay:dwp, r=Mark-Simulacrum\n\nbootstrap: Locate llvm-dwp based on llvm-config bindir\n\nFixes #81949.\n\nTested by successfully building 1.50.0 pre-release, which is where I originally hit the issue (https://internals.rust-lang.org/t/rust-1-50-0-pre-release-testing/14012/4?u=dtolnay). Tested both with and without prebuilt LLVM. The check for dry_run is necessary in the non-prebuilt case because the llvm-config built by bootstrap won't exist yet.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/67403da1ebefa360a4a2309d3ec92b56c8471362", "html_url": "https://github.com/rust-lang/rust/commit/67403da1ebefa360a4a2309d3ec92b56c8471362", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/67403da1ebefa360a4a2309d3ec92b56c8471362/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a76add29f3c78cffa6475c4e6fdf6dd49a8299c", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a76add29f3c78cffa6475c4e6fdf6dd49a8299c", "html_url": "https://github.com/rust-lang/rust/commit/2a76add29f3c78cffa6475c4e6fdf6dd49a8299c"}, {"sha": "d3fea13ae0949a64b5809ba6a7304307ddf3528e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3fea13ae0949a64b5809ba6a7304307ddf3528e", "html_url": "https://github.com/rust-lang/rust/commit/d3fea13ae0949a64b5809ba6a7304307ddf3528e"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "dee0c154201362f89c5f052033115188e24cd822", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/67403da1ebefa360a4a2309d3ec92b56c8471362/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/67403da1ebefa360a4a2309d3ec92b56c8471362/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=67403da1ebefa360a4a2309d3ec92b56c8471362", "patch": "@@ -1075,8 +1075,11 @@ impl Step for Assemble {\n             let src_exe = exe(\"llvm-dwp\", target_compiler.host);\n             let dst_exe = exe(\"rust-llvm-dwp\", target_compiler.host);\n             let llvm_config_bin = builder.ensure(native::Llvm { target: target_compiler.host });\n-            let llvm_bin_dir = llvm_config_bin.parent().unwrap();\n-            builder.copy(&llvm_bin_dir.join(&src_exe), &libdir_bin.join(&dst_exe));\n+            if !builder.config.dry_run {\n+                let llvm_bin_dir = output(Command::new(llvm_config_bin).arg(\"--bindir\"));\n+                let llvm_bin_dir = Path::new(llvm_bin_dir.trim());\n+                builder.copy(&llvm_bin_dir.join(&src_exe), &libdir_bin.join(&dst_exe));\n+            }\n         }\n \n         // Ensure that `libLLVM.so` ends up in the newly build compiler directory,"}]}