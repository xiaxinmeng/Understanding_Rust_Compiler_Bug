{"sha": "22e5194396c2d26e870cda6e4712f1ec56efb04e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyZTUxOTQzOTZjMmQyNmU4NzBjZGE2ZTQ3MTJmMWVjNTZlZmIwNGU=", "commit": {"author": {"name": "Domantas Jadenkus", "email": "djadenkus@gmail.com", "date": "2021-05-24T18:53:42Z"}, "committer": {"name": "Domantas Jadenkus", "email": "djadenkus@gmail.com", "date": "2021-05-24T19:17:16Z"}, "message": "generate match arms with todo!() as placeholder body", "tree": {"sha": "2d190bbdd34851f91a293a1321acebcb2fb3929b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d190bbdd34851f91a293a1321acebcb2fb3929b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22e5194396c2d26e870cda6e4712f1ec56efb04e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22e5194396c2d26e870cda6e4712f1ec56efb04e", "html_url": "https://github.com/rust-lang/rust/commit/22e5194396c2d26e870cda6e4712f1ec56efb04e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22e5194396c2d26e870cda6e4712f1ec56efb04e/comments", "author": {"login": "jDomantas", "id": 8329015, "node_id": "MDQ6VXNlcjgzMjkwMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8329015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jDomantas", "html_url": "https://github.com/jDomantas", "followers_url": "https://api.github.com/users/jDomantas/followers", "following_url": "https://api.github.com/users/jDomantas/following{/other_user}", "gists_url": "https://api.github.com/users/jDomantas/gists{/gist_id}", "starred_url": "https://api.github.com/users/jDomantas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jDomantas/subscriptions", "organizations_url": "https://api.github.com/users/jDomantas/orgs", "repos_url": "https://api.github.com/users/jDomantas/repos", "events_url": "https://api.github.com/users/jDomantas/events{/privacy}", "received_events_url": "https://api.github.com/users/jDomantas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jDomantas", "id": 8329015, "node_id": "MDQ6VXNlcjgzMjkwMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8329015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jDomantas", "html_url": "https://github.com/jDomantas", "followers_url": "https://api.github.com/users/jDomantas/followers", "following_url": "https://api.github.com/users/jDomantas/following{/other_user}", "gists_url": "https://api.github.com/users/jDomantas/gists{/gist_id}", "starred_url": "https://api.github.com/users/jDomantas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jDomantas/subscriptions", "organizations_url": "https://api.github.com/users/jDomantas/orgs", "repos_url": "https://api.github.com/users/jDomantas/repos", "events_url": "https://api.github.com/users/jDomantas/events{/privacy}", "received_events_url": "https://api.github.com/users/jDomantas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c139eff5b8a764fe64ec28c3028d3deb23c14adc", "url": "https://api.github.com/repos/rust-lang/rust/commits/c139eff5b8a764fe64ec28c3028d3deb23c14adc", "html_url": "https://github.com/rust-lang/rust/commit/c139eff5b8a764fe64ec28c3028d3deb23c14adc"}], "stats": {"total": 149, "additions": 89, "deletions": 60}, "files": [{"sha": "711ef2393dc6c5f2c1ed48c4c6df1f6255ec0d97", "filename": "crates/ide_assists/src/handlers/fill_match_arms.rs", "status": "modified", "additions": 74, "deletions": 54, "changes": 128, "blob_url": "https://github.com/rust-lang/rust/blob/22e5194396c2d26e870cda6e4712f1ec56efb04e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22e5194396c2d26e870cda6e4712f1ec56efb04e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs?ref=22e5194396c2d26e870cda6e4712f1ec56efb04e", "patch": "@@ -31,8 +31,8 @@ use crate::{\n //\n // fn handle(action: Action) {\n //     match action {\n-//         $0Action::Move { distance } => {}\n-//         Action::Stop => {}\n+//         $0Action::Move { distance } => todo!(),\n+//         Action::Stop => todo!(),\n //     }\n // }\n // ```\n@@ -129,7 +129,7 @@ pub(crate) fn fill_match_arms(acc: &mut Assists, ctx: &AssistContext) -> Option<\n         |builder| {\n             let new_match_arm_list = match_arm_list.clone_for_update();\n             let missing_arms = missing_pats\n-                .map(|pat| make::match_arm(iter::once(pat), make::expr_empty_block()))\n+                .map(|pat| make::match_arm(iter::once(pat), make::ext::expr_todo()))\n                 .map(|it| it.clone_for_update());\n \n             let catch_all_arm = new_match_arm_list\n@@ -350,8 +350,8 @@ fn foo(a: bool) {\n             r#\"\n fn foo(a: bool) {\n     match a {\n-        $0true => {}\n-        false => {}\n+        $0true => todo!(),\n+        false => todo!(),\n     }\n }\n \"#,\n@@ -373,7 +373,7 @@ fn foo(a: bool) {\n fn foo(a: bool) {\n     match a {\n         true => {}\n-        $0false => {}\n+        $0false => todo!(),\n     }\n }\n \"#,\n@@ -410,10 +410,10 @@ fn foo(a: bool) {\n             r#\"\n fn foo(a: bool) {\n     match (a, a) {\n-        $0(true, true) => {}\n-        (true, false) => {}\n-        (false, true) => {}\n-        (false, false) => {}\n+        $0(true, true) => todo!(),\n+        (true, false) => todo!(),\n+        (false, true) => todo!(),\n+        (false, false) => todo!(),\n     }\n }\n \"#,\n@@ -435,9 +435,9 @@ fn foo(a: bool) {\n fn foo(a: bool) {\n     match (a, a) {\n         (false, true) => {}\n-        $0(true, true) => {}\n-        (true, false) => {}\n-        (false, false) => {}\n+        $0(true, true) => todo!(),\n+        (true, false) => todo!(),\n+        (false, false) => todo!(),\n     }\n }\n \"#,\n@@ -471,7 +471,7 @@ fn main() {\n     match A::As {\n         A::Bs { x, y: Some(_) } => {}\n         A::Cs(_, Some(_)) => {}\n-        $0A::As => {}\n+        $0A::As => todo!(),\n     }\n }\n \"#,\n@@ -499,7 +499,7 @@ use Option::*;\n fn main() {\n     match None {\n         None => {}\n-        Some(${0:_}) => {}\n+        Some(${0:_}) => todo!(),\n     }\n }\n             \"#,\n@@ -523,7 +523,7 @@ enum A { As, Bs, Cs(Option<i32>) }\n fn main() {\n     match A::As {\n         A::Cs(_) | A::Bs => {}\n-        $0A::As => {}\n+        $0A::As => todo!(),\n     }\n }\n \"#,\n@@ -553,8 +553,8 @@ fn main() {\n         A::Bs if 0 < 1 => {}\n         A::Ds(_value) => { let x = 1; }\n         A::Es(B::Xs) => (),\n-        $0A::As => {}\n-        A::Cs => {}\n+        $0A::As => todo!(),\n+        A::Cs => todo!(),\n     }\n }\n \"#,\n@@ -580,7 +580,7 @@ fn main() {\n     match A::As {\n         A::As(_) => {}\n         a @ A::Bs(_) => {}\n-        A::Cs(${0:_}) => {}\n+        A::Cs(${0:_}) => todo!(),\n     }\n }\n \"#,\n@@ -605,11 +605,11 @@ enum A { As, Bs, Cs(String), Ds(String, String), Es { x: usize, y: usize } }\n fn main() {\n     let a = A::As;\n     match a {\n-        $0A::As => {}\n-        A::Bs => {}\n-        A::Cs(_) => {}\n-        A::Ds(_, _) => {}\n-        A::Es { x, y } => {}\n+        $0A::As => todo!(),\n+        A::Bs => todo!(),\n+        A::Cs(_) => todo!(),\n+        A::Ds(_, _) => todo!(),\n+        A::Es { x, y } => todo!(),\n     }\n }\n \"#,\n@@ -638,10 +638,10 @@ fn main() {\n     let a = A::One;\n     let b = B::One;\n     match (a, b) {\n-        $0(A::One, B::One) => {}\n-        (A::One, B::Two) => {}\n-        (A::Two, B::One) => {}\n-        (A::Two, B::Two) => {}\n+        $0(A::One, B::One) => todo!(),\n+        (A::One, B::Two) => todo!(),\n+        (A::Two, B::One) => todo!(),\n+        (A::Two, B::Two) => todo!(),\n     }\n }\n \"#,\n@@ -670,10 +670,10 @@ fn main() {\n     let a = A::One;\n     let b = B::One;\n     match (&a, &b) {\n-        $0(A::One, B::One) => {}\n-        (A::One, B::Two) => {}\n-        (A::Two, B::One) => {}\n-        (A::Two, B::Two) => {}\n+        $0(A::One, B::One) => todo!(),\n+        (A::One, B::Two) => todo!(),\n+        (A::Two, B::One) => todo!(),\n+        (A::Two, B::Two) => todo!(),\n     }\n }\n \"#,\n@@ -705,9 +705,9 @@ fn main() {\n     let b = B::One;\n     match (a, b) {\n         (A::Two, B::One) => {}\n-        $0(A::One, B::One) => {}\n-        (A::One, B::Two) => {}\n-        (A::Two, B::Two) => {}\n+        $0(A::One, B::One) => todo!(),\n+        (A::One, B::Two) => todo!(),\n+        (A::Two, B::Two) => todo!(),\n     }\n }\n \"#,\n@@ -736,7 +736,7 @@ fn main() {\n     match (a, b) {\n         (Some(_), _) => {}\n         (None, Some(_)) => {}\n-        $0(None, None) => {}\n+        $0(None, None) => todo!(),\n     }\n }\n \"#,\n@@ -801,8 +801,8 @@ enum A { One, Two }\n fn main() {\n     let a = A::One;\n     match (a, ) {\n-        $0(A::One,) => {}\n-        (A::Two,) => {}\n+        $0(A::One,) => todo!(),\n+        (A::Two,) => todo!(),\n     }\n }\n \"#,\n@@ -826,7 +826,7 @@ enum A { As }\n \n fn foo(a: &A) {\n     match a {\n-        $0A::As => {}\n+        $0A::As => todo!(),\n     }\n }\n \"#,\n@@ -851,7 +851,7 @@ enum A {\n \n fn foo(a: &mut A) {\n     match a {\n-        $0A::Es { x, y } => {}\n+        $0A::Es { x, y } => todo!(),\n     }\n }\n \"#,\n@@ -891,8 +891,8 @@ enum E { X, Y }\n \n fn main() {\n     match E::X {\n-        $0E::X => {}\n-        E::Y => {}\n+        $0E::X => todo!(),\n+        E::Y => todo!(),\n     }\n }\n \"#,\n@@ -919,8 +919,8 @@ use foo::E::X;\n \n fn main() {\n     match X {\n-        $0X => {}\n-        foo::E::Y => {}\n+        $0X => todo!(),\n+        foo::E::Y => todo!(),\n     }\n }\n \"#,\n@@ -947,7 +947,7 @@ fn foo(a: A) {\n     match a {\n         // foo bar baz\n         A::One => {}\n-        $0A::Two => {}\n+        $0A::Two => todo!(),\n         // This is where the rest should be\n     }\n }\n@@ -971,8 +971,8 @@ fn foo(a: A) {\n enum A { One, Two }\n fn foo(a: A) {\n     match a {\n-        $0A::One => {}\n-        A::Two => {}\n+        $0A::One => todo!(),\n+        A::Two => todo!(),\n         // foo bar baz\n     }\n }\n@@ -996,8 +996,8 @@ fn foo(a: A) {\n enum A { One, Two, }\n fn foo(a: A) {\n     match a {\n-        $0A::One => {}\n-        A::Two => {}\n+        $0A::One => todo!(),\n+        A::Two => todo!(),\n     }\n }\n \"#,\n@@ -1021,8 +1021,8 @@ fn foo(opt: Option<i32>) {\n             r#\"\n fn foo(opt: Option<i32>) {\n     match opt {\n-        Some(${0:_}) => {}\n-        None => {}\n+        Some(${0:_}) => todo!(),\n+        None => todo!(),\n     }\n }\n \"#,\n@@ -1054,9 +1054,9 @@ enum Test {\n \n fn foo(t: Test) {\n     m!(match t {\n-    $0Test::A => {}\n-    Test::B => {}\n-    Test::C => {}\n+    $0Test::A => todo!(),\n+    Test::B => todo!(),\n+    Test::C => todo!(),\n });\n }\"#,\n         );\n@@ -1076,4 +1076,24 @@ fn foo(tuple: (A, A)) {\n \"#,\n         );\n     }\n+\n+    #[test]\n+    fn adds_comma_before_new_arms() {\n+        check_assist(\n+            fill_match_arms,\n+            r#\"\n+fn foo(t: bool) {\n+    match $0t {\n+        true => 1 + 2\n+    }\n+}\"#,\n+            r#\"\n+fn foo(t: bool) {\n+    match t {\n+        true => 1 + 2,\n+        $0false => todo!(),\n+    }\n+}\"#,\n+        );\n+    }\n }"}, {"sha": "f7ee29d14cc06f9769fd582ca411e2e7d56a2188", "filename": "crates/syntax/src/ast/edit_in_place.rs", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/22e5194396c2d26e870cda6e4712f1ec56efb04e/crates%2Fsyntax%2Fsrc%2Fast%2Fedit_in_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22e5194396c2d26e870cda6e4712f1ec56efb04e/crates%2Fsyntax%2Fsrc%2Fast%2Fedit_in_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fedit_in_place.rs?ref=22e5194396c2d26e870cda6e4712f1ec56efb04e", "patch": "@@ -356,25 +356,34 @@ impl ast::MatchArm {\n impl ast::MatchArmList {\n     pub fn add_arm(&self, arm: ast::MatchArm) {\n         normalize_ws_between_braces(self.syntax());\n+        let mut elements = Vec::new();\n         let position = match self.arms().last() {\n             Some(last_arm) => {\n-                let curly = last_arm\n+                let comma = last_arm\n                     .syntax()\n                     .siblings_with_tokens(Direction::Next)\n                     .find(|it| it.kind() == T![,]);\n-                Position::after(curly.unwrap_or_else(|| last_arm.syntax().clone().into()))\n+                if needs_comma(&last_arm) && comma.is_none() {\n+                    elements.push(make::token(SyntaxKind::COMMA).into());\n+                }\n+                Position::after(comma.unwrap_or_else(|| last_arm.syntax().clone().into()))\n             }\n             None => match self.l_curly_token() {\n                 Some(it) => Position::after(it),\n                 None => Position::last_child_of(self.syntax()),\n             },\n         };\n         let indent = IndentLevel::from_node(self.syntax()) + 1;\n-        let elements = vec![\n-            make::tokens::whitespace(&format!(\"\\n{}\", indent)).into(),\n-            arm.syntax().clone().into(),\n-        ];\n+        elements.push(make::tokens::whitespace(&format!(\"\\n{}\", indent)).into());\n+        elements.push(arm.syntax().clone().into());\n+        if needs_comma(&arm) {\n+            elements.push(make::token(SyntaxKind::COMMA).into());\n+        }\n         ted::insert_all(position, elements);\n+\n+        fn needs_comma(arm: &ast::MatchArm) -> bool {\n+            arm.expr().map_or(false, |e| !e.is_block_like())\n+        }\n     }\n }\n "}]}