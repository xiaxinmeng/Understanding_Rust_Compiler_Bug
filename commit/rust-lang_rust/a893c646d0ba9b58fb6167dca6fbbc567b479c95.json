{"sha": "a893c646d0ba9b58fb6167dca6fbbc567b479c95", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4OTNjNjQ2ZDBiYTliNThmYjYxNjdkY2E2ZmJiYzU2N2I0NzljOTU=", "commit": {"author": {"name": "Ryan Prichard", "email": "ryan.prichard@gmail.com", "date": "2015-04-04T03:22:36Z"}, "committer": {"name": "Ryan Prichard", "email": "ryan.prichard@gmail.com", "date": "2015-04-11T23:00:58Z"}, "message": "Expand internal-unstable to handle named field accesses and method calls.", "tree": {"sha": "21b590b7afdbc0ef77dbf7eb6ae3dc0294a9ae7b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21b590b7afdbc0ef77dbf7eb6ae3dc0294a9ae7b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a893c646d0ba9b58fb6167dca6fbbc567b479c95", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a893c646d0ba9b58fb6167dca6fbbc567b479c95", "html_url": "https://github.com/rust-lang/rust/commit/a893c646d0ba9b58fb6167dca6fbbc567b479c95", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a893c646d0ba9b58fb6167dca6fbbc567b479c95/comments", "author": {"login": "rprichard", "id": 1572855, "node_id": "MDQ6VXNlcjE1NzI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rprichard", "html_url": "https://github.com/rprichard", "followers_url": "https://api.github.com/users/rprichard/followers", "following_url": "https://api.github.com/users/rprichard/following{/other_user}", "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions", "organizations_url": "https://api.github.com/users/rprichard/orgs", "repos_url": "https://api.github.com/users/rprichard/repos", "events_url": "https://api.github.com/users/rprichard/events{/privacy}", "received_events_url": "https://api.github.com/users/rprichard/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rprichard", "id": 1572855, "node_id": "MDQ6VXNlcjE1NzI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rprichard", "html_url": "https://github.com/rprichard", "followers_url": "https://api.github.com/users/rprichard/followers", "following_url": "https://api.github.com/users/rprichard/following{/other_user}", "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions", "organizations_url": "https://api.github.com/users/rprichard/orgs", "repos_url": "https://api.github.com/users/rprichard/repos", "events_url": "https://api.github.com/users/rprichard/events{/privacy}", "received_events_url": "https://api.github.com/users/rprichard/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f46e4f1f23368f4615a9847671e3a91b2ebaf18", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f46e4f1f23368f4615a9847671e3a91b2ebaf18", "html_url": "https://github.com/rust-lang/rust/commit/0f46e4f1f23368f4615a9847671e3a91b2ebaf18"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "7f682d5d8d1007eb323e3a24683b6e4aa4b4bf5b", "filename": "src/test/auxiliary/internal_unstable.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fauxiliary%2Finternal_unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fauxiliary%2Finternal_unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Finternal_unstable.rs?ref=a893c646d0ba9b58fb6167dca6fbbc567b479c95", "patch": "@@ -22,6 +22,17 @@ pub struct Foo {\n     pub x: u8\n }\n \n+impl Foo {\n+    #[unstable(feature = \"method\")]\n+    pub fn method(&self) {}\n+}\n+\n+#[stable(feature = \"stable\", since = \"1.0.0\")]\n+pub struct Bar {\n+    #[unstable(feature = \"struct2_field\")]\n+    pub x: u8\n+}\n+\n #[allow_internal_unstable]\n #[macro_export]\n macro_rules! call_unstable_allow {\n@@ -36,6 +47,18 @@ macro_rules! construct_unstable_allow {\n     }\n }\n \n+#[allow_internal_unstable]\n+#[macro_export]\n+macro_rules! call_method_allow {\n+    ($e: expr) => { $e.method() }\n+}\n+\n+#[allow_internal_unstable]\n+#[macro_export]\n+macro_rules! access_field_allow {\n+    ($e: expr) => { $e.x }\n+}\n+\n #[allow_internal_unstable]\n #[macro_export]\n macro_rules! pass_through_allow {\n@@ -54,6 +77,16 @@ macro_rules! construct_unstable_noallow {\n     }\n }\n \n+#[macro_export]\n+macro_rules! call_method_noallow {\n+    ($e: expr) => { $e.method() }\n+}\n+\n+#[macro_export]\n+macro_rules! access_field_noallow {\n+    ($e: expr) => { $e.x }\n+}\n+\n #[macro_export]\n macro_rules! pass_through_noallow {\n     ($e: expr) => { $e }"}, {"sha": "2e42e9d3b019522d46420a3395843a8c9f8634ae", "filename": "src/test/compile-fail/internal-unstable-noallow.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fcompile-fail%2Finternal-unstable-noallow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fcompile-fail%2Finternal-unstable-noallow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Finternal-unstable-noallow.rs?ref=a893c646d0ba9b58fb6167dca6fbbc567b479c95", "patch": "@@ -16,6 +16,8 @@\n // aux-build:internal_unstable.rs\n // error-pattern:use of unstable library feature 'function'\n // error-pattern:use of unstable library feature 'struct_field'\n+// error-pattern:use of unstable library feature 'method'\n+// error-pattern:use of unstable library feature 'struct2_field'\n \n #[macro_use]\n extern crate internal_unstable;\n@@ -24,4 +26,8 @@ fn main() {\n     call_unstable_noallow!();\n \n     construct_unstable_noallow!(0);\n+\n+    |x: internal_unstable::Foo| { call_method_noallow!(x) };\n+\n+    |x: internal_unstable::Bar| { access_field_noallow!(x) };\n }"}, {"sha": "e01259f0debbddf3e8c91faf26d4668a133c3275", "filename": "src/test/compile-fail/internal-unstable.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fcompile-fail%2Finternal-unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a893c646d0ba9b58fb6167dca6fbbc567b479c95/src%2Ftest%2Fcompile-fail%2Finternal-unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Finternal-unstable.rs?ref=a893c646d0ba9b58fb6167dca6fbbc567b479c95", "patch": "@@ -36,6 +36,8 @@ fn main() {\n     // ok, the instability is contained.\n     call_unstable_allow!();\n     construct_unstable_allow!(0);\n+    |x: internal_unstable::Foo| { call_method_allow!(x) };\n+    |x: internal_unstable::Bar| { access_field_allow!(x) };\n \n     // bad.\n     pass_through_allow!(internal_unstable::unstable()); //~ ERROR use of unstable"}]}