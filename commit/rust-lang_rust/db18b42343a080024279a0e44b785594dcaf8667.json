{"sha": "db18b42343a080024279a0e44b785594dcaf8667", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiMThiNDIzNDNhMDgwMDI0Mjc5YTBlNDRiNzg1NTk0ZGNhZjg2Njc=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2020-04-05T13:30:32Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2020-04-23T19:50:17Z"}, "message": "Evaluate unevaluated MIR constants in codegen_mir", "tree": {"sha": "8c55be0e9612b706e334a2169654921ba9bd1952", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c55be0e9612b706e334a2169654921ba9bd1952"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db18b42343a080024279a0e44b785594dcaf8667", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAl6h8XkACgkQgTGiTgx5\n769KNRAAt19EH+SZAx7JUZMBkeIyEjsZK6UyJUClUi4ufTrpS+RQycoRTpM/WRV8\ntTSDP0r3G5Qj6e18D8yeTe1asZZaEaepwWEswCDtNHQZA/7Q2kUbUQohowNRKHFY\nl6UfoCS63kRV9FRW1yErkYwi9dxjVOgO22htl/nHC7m1SuQYa/opcL2zL2HHrJRO\nTICU9CKI6bO/ZsMRBTDpilJt2CNK1tWAJ87Jd8dDn1KpLhJF4/ozpqaywhyqC/as\nJFeJDuVlkmipV+SkHxo9fvOcWKVK/Qe8WRlEQHjKjVydfVifwIHus3eWKgTDw7LW\nIDRfs4aDLWnsTAdpgz9sUSNg5JYjgprqMvRuM1HRIfhkdONVHwD8mk2hZX0FNu2U\n3xx/MQfWl4zrfwK5wY74Ie6v+xeb6W4sq+WJY1Iss2NOtcBvYYM1GJol1pITG1W7\nid/Qzp4zXyGku90P/qwW+nMF+AcxqWocyPYWNwe/oXvqN9FNK1s0+OSgeK9xBVW0\np9qVtg7qglszzMVlhxt+S16NhxGrIJ4ZqlrMvagt3i3uK5ks+VmYOjADnzsNSO8l\nv7Fx3sgGYH8un4+iwvqBfmu6FVAi+hbJnXJq/YEslz2cdzUEUa6F/W9Jc8NCEDvL\n909b0477az8P4i3QzCll8ptbGR/gcu+QEWe5XTNg79nsh8/YSX4=\n=plxq\n-----END PGP SIGNATURE-----", "payload": "tree 8c55be0e9612b706e334a2169654921ba9bd1952\nparent f8976e377f694c98c180ce967b295531d1824563\nauthor Santiago Pastorino <spastorino@gmail.com> 1586093432 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1587671417 -0300\n\nEvaluate unevaluated MIR constants in codegen_mir\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db18b42343a080024279a0e44b785594dcaf8667", "html_url": "https://github.com/rust-lang/rust/commit/db18b42343a080024279a0e44b785594dcaf8667", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db18b42343a080024279a0e44b785594dcaf8667/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f8976e377f694c98c180ce967b295531d1824563", "url": "https://api.github.com/repos/rust-lang/rust/commits/f8976e377f694c98c180ce967b295531d1824563", "html_url": "https://github.com/rust-lang/rust/commit/f8976e377f694c98c180ce967b295531d1824563"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "663b37d5e6508101fb0f411e21a7a668b5ca6649", "filename": "src/librustc_codegen_ssa/mir/mod.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/db18b42343a080024279a0e44b785594dcaf8667/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db18b42343a080024279a0e44b785594dcaf8667/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs?ref=db18b42343a080024279a0e44b785594dcaf8667", "patch": "@@ -1,6 +1,8 @@\n use crate::base;\n use crate::traits::*;\n+use rustc_errors::ErrorReported;\n use rustc_middle::mir;\n+use rustc_middle::mir::interpret::ErrorHandled;\n use rustc_middle::ty::layout::{FnAbiExt, HasTyCtxt, TyAndLayout};\n use rustc_middle::ty::{self, Instance, Ty, TypeFoldable};\n use rustc_target::abi::call::{FnAbi, PassMode};\n@@ -189,6 +191,18 @@ pub fn codegen_mir<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>>(\n \n     fx.per_local_var_debug_info = fx.compute_per_local_var_debug_info();\n \n+    for const_ in &mir.uneval_consts {\n+        if let Err(err) = fx.eval_mir_constant(const_) {\n+            match err {\n+                // errored or at least linted\n+                ErrorHandled::Reported(ErrorReported) | ErrorHandled::Linted => {}\n+                ErrorHandled::TooGeneric => {\n+                    span_bug!(const_.span, \"codgen encountered polymorphic constant: {:?}\", err)\n+                }\n+            }\n+        }\n+    }\n+\n     let memory_locals = analyze::non_ssa_locals(&fx);\n \n     // Allocate variable and temp allocas"}]}