{"sha": "b999973c0ffa86738daab277cd6e985248ef08aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5OTk5NzNjMGZmYTg2NzM4ZGFhYjI3N2NkNmU5ODUyNDhlZjA4YWE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-08-28T23:27:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-08-31T23:20:36Z"}, "message": "Add a morestack_addr (temporary) intrinsic", "tree": {"sha": "dd9bf206a6b6a5d19e3f8873f370540b9ad27063", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd9bf206a6b6a5d19e3f8873f370540b9ad27063"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b999973c0ffa86738daab277cd6e985248ef08aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b999973c0ffa86738daab277cd6e985248ef08aa", "html_url": "https://github.com/rust-lang/rust/commit/b999973c0ffa86738daab277cd6e985248ef08aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b999973c0ffa86738daab277cd6e985248ef08aa/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a02ab41b65927c39e912ea820b5dff5032ad5695", "url": "https://api.github.com/repos/rust-lang/rust/commits/a02ab41b65927c39e912ea820b5dff5032ad5695", "html_url": "https://github.com/rust-lang/rust/commit/a02ab41b65927c39e912ea820b5dff5032ad5695"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "05f1d83cc893c0871f847bb844cf2c049afa28c9", "filename": "src/rustc/middle/trans/foreign.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=b999973c0ffa86738daab277cd6e985248ef08aa", "patch": "@@ -993,6 +993,16 @@ fn trans_intrinsic(ccx: @crate_ctxt, decl: ValueRef, item: @ast::foreign_item,\n                                    lv_temporary),\n                                arg_vals(~[frameaddress_val]), ignore);\n       }\n+      ~\"morestack_addr\" => {\n+        // XXX This is a hack to grab the address of this particular\n+        // native function. There should be a general in-language\n+        // way to do this\n+        let llfty = type_of_fn(bcx.ccx(), ~[], ty::mk_nil(bcx.tcx()));\n+        let morestack_addr = decl_cdecl_fn(\n+            bcx.ccx().llmod, ~\"__morestack\", llfty);\n+        let morestack_addr = PointerCast(bcx, morestack_addr, T_ptr(T_nil()));\n+        Store(bcx, morestack_addr, fcx.llretptr);\n+      }\n       _ => {\n       // Could we make this an enum rather than a string? does it get\n       // checked earlier?"}, {"sha": "da096cbab24f9f7335fbed39f0142a8ef6494ba6", "filename": "src/rustc/middle/typeck/check.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Frustc%2Fmiddle%2Ftypeck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Frustc%2Fmiddle%2Ftypeck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftypeck%2Fcheck.rs?ref=b999973c0ffa86738daab277cd6e985248ef08aa", "patch": "@@ -2590,6 +2590,9 @@ fn check_intrinsic_type(ccx: @crate_ctxt, it: @ast::foreign_item) {\n         });\n         (0u, ~[arg(ast::by_ref, fty)], ty::mk_nil(tcx))\n       }\n+      ~\"morestack_addr\" => {\n+        (0u, ~[], ty::mk_nil_ptr(tcx))\n+      }\n       other => {\n         tcx.sess.span_err(it.span, ~\"unrecognized intrinsic function: `\" +\n                           other + ~\"`\");"}, {"sha": "7f0adcf0920ff4143e34674b96268e02587c24c8", "filename": "src/test/run-pass/morestack-address.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Ftest%2Frun-pass%2Fmorestack-address.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b999973c0ffa86738daab277cd6e985248ef08aa/src%2Ftest%2Frun-pass%2Fmorestack-address.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmorestack-address.rs?ref=b999973c0ffa86738daab277cd6e985248ef08aa", "patch": "@@ -0,0 +1,11 @@\n+#[nolink]\n+#[abi = \"rust-intrinsic\"]\n+extern mod rusti {\n+    fn morestack_addr() -> *();\n+}\n+\n+fn main() {\n+    let addr = rusti::morestack_addr();\n+    assert addr.is_not_null();\n+    error!(\"%?\", addr);\n+}\n\\ No newline at end of file"}]}