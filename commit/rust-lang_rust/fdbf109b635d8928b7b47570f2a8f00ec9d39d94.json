{"sha": "fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "node_id": "C_kwDOAAsO6NoAKGZkYmYxMDliNjM1ZDg5MjhiN2I0NzU3MGYyYThmMDBlYzlkMzlkOTQ", "commit": {"author": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-26T10:33:28Z"}, "committer": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-26T10:33:28Z"}, "message": "std: use random HashMap keys on Hermit", "tree": {"sha": "2041e3d6518dd30ff0e71d02ac5a2dbe3d5591b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2041e3d6518dd30ff0e71d02ac5a2dbe3d5591b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEVuz3PwcqDyifNyYbcE4BSbAZSzwFAmP7NXgACgkQcE4BSbAZ\nSzxm7g/9Foemt7te2UxSjxIgS3XYTkyBRwzuuWbhN83PP20rfl2WGWMZZz/Fbkqz\nil5xvqSdoClkJDLmZd9st912OkNdvX3t7vPeR9r1FeSeB8P0vhG4X7/nZ/VNeseA\nh/qoJ8kQXkI9aQ5rvGo0ltfV5ViQYTyDzffQsLIU4oZGLPBkJUUZ4PcbvpDyRzCw\nR/6lluxgM2q+A9isjYvkfPwM+j+2arDZMBd5CvoloOm6VDWM8x0dN6qQRoJ5rGoq\nWORKanJnC0irg+mMwciVeI1YawgVqM/yw8U9FDY5alTdkHUyG6VV+bkSFmod2FRA\n+ggpygUs0ebx7FXr6XXmxRF5Ie2efbriZIBCxLxdXr1hF8GfAQxbE7eZsQ/7qhZI\nBvWOhmDNWvyWKgcNTaycQjSvReIxmmlP/yBd48kuaGeVizM0JLDyxI9nFjr1+up5\n10YV0u6EtRoU+qXnmO992/u6lgcGAISj0mPqmqlKhfbR80/kPbYwlCAFGsVjL3k6\nZazQYRMGPCFLR7eHRx6pjrCiitU5gFnwEOlHUc4AT02+2zN6qGKPEM2aDqKYA41k\nPmB5cPNPLaKi5KGsvts/uslHSE09nVU6XHGMI6EhkCmEvOlyRjwmBYMW7DW5k/OD\nJ+UJ679Xw0xidLLjXSSfmHEK7s0LwV43wJ9Vd0NGBoBkQIahtMM=\n=Tp5Q\n-----END PGP SIGNATURE-----", "payload": "tree 2041e3d6518dd30ff0e71d02ac5a2dbe3d5591b6\nparent 70fd012439d75fd6ce561a6518b9b8fd399f455f\nauthor joboet <jonasboettiger@icloud.com> 1677407608 +0100\ncommitter joboet <jonasboettiger@icloud.com> 1677407608 +0100\n\nstd: use random HashMap keys on Hermit\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "html_url": "https://github.com/rust-lang/rust/commit/fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fdbf109b635d8928b7b47570f2a8f00ec9d39d94/comments", "author": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70fd012439d75fd6ce561a6518b9b8fd399f455f", "url": "https://api.github.com/repos/rust-lang/rust/commits/70fd012439d75fd6ce561a6518b9b8fd399f455f", "html_url": "https://github.com/rust-lang/rust/commit/70fd012439d75fd6ce561a6518b9b8fd399f455f"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "d0e09890b8b6c4ae39cf35531264a63e886648b6", "filename": "library/std/src/sys/hermit/mod.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/fdbf109b635d8928b7b47570f2a8f00ec9d39d94/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fdbf109b635d8928b7b47570f2a8f00ec9d39d94/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs?ref=fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "patch": "@@ -76,9 +76,24 @@ pub fn abort_internal() -> ! {\n     }\n }\n \n-// FIXME: just a workaround to test the system\n pub fn hashmap_random_keys() -> (u64, u64) {\n-    (1, 2)\n+    let mut buf = [0; 16];\n+    let mut slice = &mut buf[..];\n+    while !slice.is_empty() {\n+        let res = unsafe { abi::read_entropy(slice.as_mut_ptr(), slice.len(), 0) };\n+        if res < 0 {\n+            panic!(\n+                \"random key generation failed: {}\",\n+                crate::io::Error::from_raw_os_error(-res as i32)\n+            );\n+        } else {\n+            slice = &mut slice[res as usize..];\n+        }\n+    }\n+\n+    let key1 = buf[..8].try_into().unwrap();\n+    let key2 = buf[8..].try_into().unwrap();\n+    (u64::from_ne_bytes(key1), u64::from_ne_bytes(key2))\n }\n \n // This function is needed by the panic runtime. The symbol is named in"}]}