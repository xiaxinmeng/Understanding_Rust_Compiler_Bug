{"sha": "76be7e20820f88a4addd70aea309e531be59096f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2YmU3ZTIwODIwZjg4YTRhZGRkNzBhZWEzMDllNTMxYmU1OTA5NmY=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-05T21:24:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-05T21:24:11Z"}, "message": "Rollup merge of #83734 - JohnTitor:issue-83621, r=davidtwco\n\nCatch a bad placeholder type error for statics in `extern`s\n\nFixes #83621", "tree": {"sha": "4d5ac7e97984387a7abe86847d79664285d157bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d5ac7e97984387a7abe86847d79664285d157bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76be7e20820f88a4addd70aea309e531be59096f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJga3/7CRBK7hj4Ov3rIwAAdHIIACA4LU4Odt2gtIQPlaCIfguz\nnan5cY9p5k48FAvwvHv5Z6udwauwYtCR60GxJC2smsUsbQRfZke43B6JtKXk3yeJ\nqyhF3x8LniedtML2/DFDmfL8wVwMpuYGQRNt9JFUw+9Yiz8m4hmldzrUibNgg28X\nyR1ZLKryGamfZPnms/E4u11srS0fsSyBT/wPZA8tAKizD0GDJnTP6N33VdJ4jMBR\nsz4T/lNReTeb9SNG/+6lFtxdDoOiXMxqb1OUe/KTY15iI1LdHJGdHGDFMKRQtRuL\nx4dc4J6B4NWkOgCGXgbUi+ybbeR7Cr/OJe1mB33gV3lnb7H35r4St/fzw+lJAhA=\n=4eS3\n-----END PGP SIGNATURE-----\n", "payload": "tree 4d5ac7e97984387a7abe86847d79664285d157bf\nparent d9f123a5ae88a519bd13600e13a2a71555415467\nparent b5782bad743f596061e9c75d0a3f8a8ed8213b03\nauthor Yuki Okushi <jtitor@2k36.org> 1617657851 +0900\ncommitter GitHub <noreply@github.com> 1617657851 +0900\n\nRollup merge of #83734 - JohnTitor:issue-83621, r=davidtwco\n\nCatch a bad placeholder type error for statics in `extern`s\n\nFixes #83621\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76be7e20820f88a4addd70aea309e531be59096f", "html_url": "https://github.com/rust-lang/rust/commit/76be7e20820f88a4addd70aea309e531be59096f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76be7e20820f88a4addd70aea309e531be59096f/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9f123a5ae88a519bd13600e13a2a71555415467", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9f123a5ae88a519bd13600e13a2a71555415467", "html_url": "https://github.com/rust-lang/rust/commit/d9f123a5ae88a519bd13600e13a2a71555415467"}, {"sha": "b5782bad743f596061e9c75d0a3f8a8ed8213b03", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5782bad743f596061e9c75d0a3f8a8ed8213b03", "html_url": "https://github.com/rust-lang/rust/commit/b5782bad743f596061e9c75d0a3f8a8ed8213b03"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "53dc79106de2ec9816e0c99ee850f21b78d994a5", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/76be7e20820f88a4addd70aea309e531be59096f/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76be7e20820f88a4addd70aea309e531be59096f/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=76be7e20820f88a4addd70aea309e531be59096f", "patch": "@@ -734,8 +734,14 @@ fn convert_item(tcx: TyCtxt<'_>, item_id: hir::ItemId) {\n                 tcx.ensure().generics_of(item.def_id);\n                 tcx.ensure().type_of(item.def_id);\n                 tcx.ensure().predicates_of(item.def_id);\n-                if let hir::ForeignItemKind::Fn(..) = item.kind {\n-                    tcx.ensure().fn_sig(item.def_id);\n+                match item.kind {\n+                    hir::ForeignItemKind::Fn(..) => tcx.ensure().fn_sig(item.def_id),\n+                    hir::ForeignItemKind::Static(..) => {\n+                        let mut visitor = PlaceholderHirTyCollector::default();\n+                        visitor.visit_foreign_item(item);\n+                        placeholder_type_error(tcx, None, &[], visitor.0, false, None);\n+                    }\n+                    _ => (),\n                 }\n             }\n         }"}, {"sha": "16ec2a546434c20fbe79ebfb10d1445eb65841ea", "filename": "src/test/ui/typeck/issue-83621-placeholder-static-in-extern.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/76be7e20820f88a4addd70aea309e531be59096f/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76be7e20820f88a4addd70aea309e531be59096f/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs?ref=76be7e20820f88a4addd70aea309e531be59096f", "patch": "@@ -0,0 +1,7 @@\n+// Regression test for #83621.\n+\n+extern \"C\" {\n+    static x: _; //~ ERROR: [E0121]\n+}\n+\n+fn main() {}"}, {"sha": "b1bec4c0827f9255077a5e8112a504c7847782d9", "filename": "src/test/ui/typeck/issue-83621-placeholder-static-in-extern.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/76be7e20820f88a4addd70aea309e531be59096f/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76be7e20820f88a4addd70aea309e531be59096f/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr?ref=76be7e20820f88a4addd70aea309e531be59096f", "patch": "@@ -0,0 +1,9 @@\n+error[E0121]: the type placeholder `_` is not allowed within types on item signatures\n+  --> $DIR/issue-83621-placeholder-static-in-extern.rs:4:15\n+   |\n+LL |     static x: _;\n+   |               ^ not allowed in type signatures\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0121`."}]}