{"sha": "b869aa5f316ae065ce2215e69811e3216c6250cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4NjlhYTVmMzE2YWUwNjVjZTIyMTVlNjk4MTFlMzIxNmM2MjUwY2I=", "commit": {"author": {"name": "marmeladema", "email": "xademax@gmail.com", "date": "2020-08-30T17:31:34Z"}, "committer": {"name": "marmeladema", "email": "xademax@gmail.com", "date": "2020-09-07T23:42:56Z"}, "message": "Add saturating methods for `Duration`", "tree": {"sha": "710d8a4638630879e53a6eaf50c355ee13ae5d6b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/710d8a4638630879e53a6eaf50c355ee13ae5d6b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b869aa5f316ae065ce2215e69811e3216c6250cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b869aa5f316ae065ce2215e69811e3216c6250cb", "html_url": "https://github.com/rust-lang/rust/commit/b869aa5f316ae065ce2215e69811e3216c6250cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b869aa5f316ae065ce2215e69811e3216c6250cb/comments", "author": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fe551ae49289ce6f693ca0dabf4c9c15164f67d", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fe551ae49289ce6f693ca0dabf4c9c15164f67d", "html_url": "https://github.com/rust-lang/rust/commit/9fe551ae49289ce6f693ca0dabf4c9c15164f67d"}], "stats": {"total": 172, "additions": 156, "deletions": 16}, "files": [{"sha": "c3cadcbb01e31b339071c6d3bb8c12d4ab76bb75", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=b869aa5f316ae065ce2215e69811e3216c6250cb", "patch": "@@ -100,6 +100,7 @@\n #![feature(doc_cfg)]\n #![feature(doc_spotlight)]\n #![feature(duration_consts_2)]\n+#![feature(duration_saturating_ops)]\n #![feature(extern_types)]\n #![feature(fundamental)]\n #![feature(intrinsics)]"}, {"sha": "f39781788d7c04e09a5da36744a9ab77e5b37553", "filename": "library/core/src/time.rs", "status": "modified", "additions": 97, "deletions": 0, "changes": 97, "blob_url": "https://github.com/rust-lang/rust/blob/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Fsrc%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Fsrc%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Ftime.rs?ref=b869aa5f316ae065ce2215e69811e3216c6250cb", "patch": "@@ -108,6 +108,34 @@ impl Duration {\n     #[unstable(feature = \"duration_constants\", issue = \"57391\")]\n     pub const NANOSECOND: Duration = Duration::from_nanos(1);\n \n+    /// The minimum duration.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(duration_constants)]\n+    /// use std::time::Duration;\n+    ///\n+    /// assert_eq!(Duration::MIN, Duration::new(0, 0));\n+    /// ```\n+    #[unstable(feature = \"duration_constants\", issue = \"57391\")]\n+    pub const MIN: Duration = Duration::from_nanos(0);\n+\n+    /// The maximum duration.\n+    ///\n+    /// It is roughly equal to a duration of 584,942,417,355 years.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(duration_constants)]\n+    /// use std::time::Duration;\n+    ///\n+    /// assert_eq!(Duration::MAX, Duration::new(u64::MAX, 1_000_000_000 - 1));\n+    /// ```\n+    #[unstable(feature = \"duration_constants\", issue = \"57391\")]\n+    pub const MAX: Duration = Duration::new(u64::MAX, NANOS_PER_SEC - 1);\n+\n     /// Creates a new `Duration` from the specified number of whole seconds and\n     /// additional nanoseconds.\n     ///\n@@ -450,6 +478,29 @@ impl Duration {\n         }\n     }\n \n+    /// Saturating `Duration` addition. Computes `self + other`, returning [`Duration::MAX`]\n+    /// if overflow occurred.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(duration_saturating_ops)]\n+    /// #![feature(duration_constants)]\n+    /// use std::time::Duration;\n+    ///\n+    /// assert_eq!(Duration::new(0, 0).saturating_add(Duration::new(0, 1)), Duration::new(0, 1));\n+    /// assert_eq!(Duration::new(1, 0).saturating_add(Duration::new(u64::MAX, 0)), Duration::MAX);\n+    /// ```\n+    #[unstable(feature = \"duration_saturating_ops\", issue = \"76416\")]\n+    #[inline]\n+    #[rustc_const_unstable(feature = \"duration_consts_2\", issue = \"72440\")]\n+    pub const fn saturating_add(self, rhs: Duration) -> Duration {\n+        match self.checked_add(rhs) {\n+            Some(res) => res,\n+            None => Duration::MAX,\n+        }\n+    }\n+\n     /// Checked `Duration` subtraction. Computes `self - other`, returning [`None`]\n     /// if the result would be negative or if overflow occurred.\n     ///\n@@ -485,6 +536,29 @@ impl Duration {\n         }\n     }\n \n+    /// Saturating `Duration` subtraction. Computes `self - other`, returning [`Duration::MIN`]\n+    /// if the result would be negative or if overflow occurred.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(duration_saturating_ops)]\n+    /// #![feature(duration_constants)]\n+    /// use std::time::Duration;\n+    ///\n+    /// assert_eq!(Duration::new(0, 1).saturating_sub(Duration::new(0, 0)), Duration::new(0, 1));\n+    /// assert_eq!(Duration::new(0, 0).saturating_sub(Duration::new(0, 1)), Duration::MIN);\n+    /// ```\n+    #[unstable(feature = \"duration_saturating_ops\", issue = \"76416\")]\n+    #[inline]\n+    #[rustc_const_unstable(feature = \"duration_consts_2\", issue = \"72440\")]\n+    pub const fn saturating_sub(self, rhs: Duration) -> Duration {\n+        match self.checked_sub(rhs) {\n+            Some(res) => res,\n+            None => Duration::MIN,\n+        }\n+    }\n+\n     /// Checked `Duration` multiplication. Computes `self * other`, returning\n     /// [`None`] if overflow occurred.\n     ///\n@@ -515,6 +589,29 @@ impl Duration {\n         None\n     }\n \n+    /// Saturating `Duration` multiplication. Computes `self * other`, returning\n+    /// [`Duration::MAX`] if overflow occurred.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(duration_saturating_ops)]\n+    /// #![feature(duration_constants)]\n+    /// use std::time::Duration;\n+    ///\n+    /// assert_eq!(Duration::new(0, 500_000_001).saturating_mul(2), Duration::new(1, 2));\n+    /// assert_eq!(Duration::new(u64::MAX - 1, 0).saturating_mul(2), Duration::MAX);\n+    /// ```\n+    #[unstable(feature = \"duration_saturating_ops\", issue = \"76416\")]\n+    #[inline]\n+    #[rustc_const_unstable(feature = \"duration_consts_2\", issue = \"72440\")]\n+    pub const fn saturating_mul(self, rhs: u32) -> Duration {\n+        match self.checked_mul(rhs) {\n+            Some(res) => res,\n+            None => Duration::MAX,\n+        }\n+    }\n+\n     /// Checked `Duration` division. Computes `self / other`, returning [`None`]\n     /// if `other == 0`.\n     ///"}, {"sha": "a2e294ace1860f2226350fb80c1df9fd2c647e82", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=b869aa5f316ae065ce2215e69811e3216c6250cb", "patch": "@@ -10,6 +10,8 @@\n #![feature(core_private_diy_float)]\n #![feature(debug_non_exhaustive)]\n #![feature(dec2flt)]\n+#![feature(duration_constants)]\n+#![feature(duration_saturating_ops)]\n #![feature(exact_size_is_empty)]\n #![feature(fixed_size_array)]\n #![feature(flt2dec)]"}, {"sha": "4f90eb63b0472393c2d8e7beeaef66b9f56d0cdb", "filename": "library/core/tests/time.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Ftests%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b869aa5f316ae065ce2215e69811e3216c6250cb/library%2Fcore%2Ftests%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Ftime.rs?ref=b869aa5f316ae065ce2215e69811e3216c6250cb", "patch": "@@ -89,6 +89,16 @@ fn checked_add() {\n     assert_eq!(Duration::new(1, 0).checked_add(Duration::new(u64::MAX, 0)), None);\n }\n \n+#[test]\n+fn saturating_add() {\n+    assert_eq!(Duration::new(0, 0).saturating_add(Duration::new(0, 1)), Duration::new(0, 1));\n+    assert_eq!(\n+        Duration::new(0, 500_000_000).saturating_add(Duration::new(0, 500_000_001)),\n+        Duration::new(1, 1)\n+    );\n+    assert_eq!(Duration::new(1, 0).saturating_add(Duration::new(u64::MAX, 0)), Duration::MAX);\n+}\n+\n #[test]\n fn sub() {\n     assert_eq!(Duration::new(0, 1) - Duration::new(0, 0), Duration::new(0, 1));\n@@ -107,6 +117,17 @@ fn checked_sub() {\n     assert_eq!(zero.checked_sub(one_sec), None);\n }\n \n+#[test]\n+fn saturating_sub() {\n+    let zero = Duration::new(0, 0);\n+    let one_nano = Duration::new(0, 1);\n+    let one_sec = Duration::new(1, 0);\n+    assert_eq!(one_nano.saturating_sub(zero), Duration::new(0, 1));\n+    assert_eq!(one_sec.saturating_sub(one_nano), Duration::new(0, 999_999_999));\n+    assert_eq!(zero.saturating_sub(one_nano), Duration::MIN);\n+    assert_eq!(zero.saturating_sub(one_sec), Duration::MIN);\n+}\n+\n #[test]\n #[should_panic]\n fn sub_bad1() {\n@@ -136,6 +157,15 @@ fn checked_mul() {\n     assert_eq!(Duration::new(u64::MAX - 1, 0).checked_mul(2), None);\n }\n \n+#[test]\n+fn saturating_mul() {\n+    assert_eq!(Duration::new(0, 1).saturating_mul(2), Duration::new(0, 2));\n+    assert_eq!(Duration::new(1, 1).saturating_mul(3), Duration::new(3, 3));\n+    assert_eq!(Duration::new(0, 500_000_001).saturating_mul(4), Duration::new(2, 4));\n+    assert_eq!(Duration::new(0, 500_000_001).saturating_mul(4000), Duration::new(2000, 4000));\n+    assert_eq!(Duration::new(u64::MAX - 1, 0).saturating_mul(2), Duration::MAX);\n+}\n+\n #[test]\n fn div() {\n     assert_eq!(Duration::new(0, 1) / 2, Duration::new(0, 0));"}, {"sha": "bc0969e4f1fbadfb9454ab2b0c6855be6b94b5f9", "filename": "src/test/ui/consts/duration-consts-2.rs", "status": "modified", "additions": 26, "deletions": 16, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/b869aa5f316ae065ce2215e69811e3216c6250cb/src%2Ftest%2Fui%2Fconsts%2Fduration-consts-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b869aa5f316ae065ce2215e69811e3216c6250cb/src%2Ftest%2Fui%2Fconsts%2Fduration-consts-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fduration-consts-2.rs?ref=b869aa5f316ae065ce2215e69811e3216c6250cb", "patch": "@@ -3,6 +3,7 @@\n #![feature(const_panic)]\n #![feature(duration_consts_2)]\n #![feature(div_duration)]\n+#![feature(duration_saturating_ops)]\n \n use std::time::Duration;\n \n@@ -15,29 +16,29 @@ fn duration() {\n \n     const MAX : Duration = Duration::new(u64::MAX, 1_000_000_000 - 1);\n \n-    const MAX_ADD_ZERO : Option<Duration> = MAX.checked_add(ZERO);\n-    assert_eq!(MAX_ADD_ZERO, Some(MAX));\n+    const MAX_CHECKED_ADD_ZERO : Option<Duration> = MAX.checked_add(ZERO);\n+    assert_eq!(MAX_CHECKED_ADD_ZERO, Some(MAX));\n \n-    const MAX_ADD_ONE : Option<Duration> = MAX.checked_add(ONE);\n-    assert_eq!(MAX_ADD_ONE, None);\n+    const MAX_CHECKED_ADD_ONE : Option<Duration> = MAX.checked_add(ONE);\n+    assert_eq!(MAX_CHECKED_ADD_ONE, None);\n \n-    const ONE_SUB_ONE : Option<Duration> = ONE.checked_sub(ONE);\n-    assert_eq!(ONE_SUB_ONE, Some(ZERO));\n+    const ONE_CHECKED_SUB_ONE : Option<Duration> = ONE.checked_sub(ONE);\n+    assert_eq!(ONE_CHECKED_SUB_ONE, Some(ZERO));\n \n-    const ZERO_SUB_ONE : Option<Duration> = ZERO.checked_sub(ONE);\n-    assert_eq!(ZERO_SUB_ONE, None);\n+    const ZERO_CHECKED_SUB_ONE : Option<Duration> = ZERO.checked_sub(ONE);\n+    assert_eq!(ZERO_CHECKED_SUB_ONE, None);\n \n-    const ONE_MUL_ONE : Option<Duration> = ONE.checked_mul(1);\n-    assert_eq!(ONE_MUL_ONE, Some(ONE));\n+    const ONE_CHECKED_MUL_ONE : Option<Duration> = ONE.checked_mul(1);\n+    assert_eq!(ONE_CHECKED_MUL_ONE, Some(ONE));\n \n-    const MAX_MUL_TWO : Option<Duration> = MAX.checked_mul(2);\n-    assert_eq!(MAX_MUL_TWO, None);\n+    const MAX_CHECKED_MUL_TWO : Option<Duration> = MAX.checked_mul(2);\n+    assert_eq!(MAX_CHECKED_MUL_TWO, None);\n \n-    const ONE_DIV_ONE : Option<Duration> = ONE.checked_div(1);\n-    assert_eq!(ONE_DIV_ONE, Some(ONE));\n+    const ONE_CHECKED_DIV_ONE : Option<Duration> = ONE.checked_div(1);\n+    assert_eq!(ONE_CHECKED_DIV_ONE, Some(ONE));\n \n-    const ONE_DIV_ZERO : Option<Duration> = ONE.checked_div(0);\n-    assert_eq!(ONE_DIV_ZERO, None);\n+    const ONE_CHECKED_DIV_ZERO : Option<Duration> = ONE.checked_div(0);\n+    assert_eq!(ONE_CHECKED_DIV_ZERO, None);\n \n     const MAX_AS_F32 : f32 = MAX.as_secs_f32();\n     assert_eq!(MAX_AS_F32, 18446744000000000000.0_f32);\n@@ -50,6 +51,15 @@ fn duration() {\n \n     const ONE_AS_F64 : f64 = ONE.div_duration_f64(ONE);\n     assert_eq!(ONE_AS_F64, 1.0_f64);\n+\n+    const MAX_SATURATING_ADD_ONE : Duration = MAX.saturating_add(ONE);\n+    assert_eq!(MAX_SATURATING_ADD_ONE, MAX);\n+\n+    const ZERO_SATURATING_SUB_ONE : Duration = ZERO.saturating_sub(ONE);\n+    assert_eq!(ZERO_SATURATING_SUB_ONE, ZERO);\n+\n+    const MAX_SATURATING_MUL_TWO : Duration = MAX.saturating_mul(2);\n+    assert_eq!(MAX_SATURATING_MUL_TWO, MAX);\n }\n \n fn main() {"}]}