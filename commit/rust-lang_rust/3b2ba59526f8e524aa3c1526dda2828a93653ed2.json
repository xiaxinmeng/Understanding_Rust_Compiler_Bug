{"sha": "3b2ba59526f8e524aa3c1526dda2828a93653ed2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiMmJhNTk1MjZmOGU1MjRhYTNjMTUyNmRkYTI4MjhhOTM2NTNlZDI=", "commit": {"author": {"name": "Adolfo Ochagav\u00eda", "email": "github@adolfo.ochagavia.xyz", "date": "2018-11-07T10:58:34Z"}, "committer": {"name": "Adolfo Ochagav\u00eda", "email": "github@adolfo.ochagavia.xyz", "date": "2018-11-07T10:58:34Z"}, "message": "Use ArrayString instead of hand rolled data structure", "tree": {"sha": "3ef9368b78dfb558c8b015d0914412d49c479e60", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ef9368b78dfb558c8b015d0914412d49c479e60"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b2ba59526f8e524aa3c1526dda2828a93653ed2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b2ba59526f8e524aa3c1526dda2828a93653ed2", "html_url": "https://github.com/rust-lang/rust/commit/3b2ba59526f8e524aa3c1526dda2828a93653ed2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b2ba59526f8e524aa3c1526dda2828a93653ed2/comments", "author": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e37ba706ccc435346c35042c2b6c4b483494268b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e37ba706ccc435346c35042c2b6c4b483494268b", "html_url": "https://github.com/rust-lang/rust/commit/e37ba706ccc435346c35042c2b6c4b483494268b"}], "stats": {"total": 45, "additions": 6, "deletions": 39}, "files": [{"sha": "555efdfb91aa83b61adf03b832b6ef784526d6c5", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3b2ba59526f8e524aa3c1526dda2828a93653ed2/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/3b2ba59526f8e524aa3c1526dda2828a93653ed2/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=3b2ba59526f8e524aa3c1526dda2828a93653ed2", "patch": "@@ -671,6 +671,7 @@ dependencies = [\n name = \"ra_syntax\"\n version = \"0.1.0\"\n dependencies = [\n+ \"arrayvec 0.4.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"drop_bomb 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "0f709026f4e2f3528daa89210b1348252cb445b2", "filename": "crates/ra_syntax/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2FCargo.toml?ref=3b2ba59526f8e524aa3c1526dda2828a93653ed2", "patch": "@@ -8,6 +8,7 @@ description = \"Comment and whitespace preserving parser for the Rust langauge\"\n repository = \"https://github.com/rust-analyzer/rust-analyzer\"\n \n [dependencies]\n+arrayvec = \"0.4.7\"\n unicode-xid = \"0.1.0\"\n itertools = \"0.7.8\"\n drop_bomb = \"0.1.4\""}, {"sha": "319fb947d369a2872981664e01044be27e803279", "filename": "crates/ra_syntax/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Flib.rs?ref=3b2ba59526f8e524aa3c1526dda2828a93653ed2", "patch": "@@ -20,6 +20,7 @@\n #![allow(missing_docs)]\n //#![warn(unreachable_pub)] // rust-lang/rust#47816\n \n+extern crate arrayvec;\n extern crate drop_bomb;\n extern crate itertools;\n extern crate parking_lot;"}, {"sha": "cad9544bef9a6765571bb03fa7d03537275d7e2f", "filename": "crates/ra_syntax/src/utils.rs", "status": "modified", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Futils.rs?ref=3b2ba59526f8e524aa3c1526dda2828a93653ed2", "patch": "@@ -1,6 +1,5 @@\n use crate::{File, SyntaxKind, SyntaxNodeRef, WalkEvent};\n use std::fmt::Write;\n-use std::ops::Deref;\n use std::str;\n \n /// Parse a file and create a string representation of the resulting parse tree.\n@@ -80,38 +79,3 @@ pub(crate) fn validate_block_structure(root: SyntaxNodeRef) {\n         }\n     }\n }\n-\n-#[derive(Debug)]\n-pub struct MutAsciiString<'a> {\n-    buf: &'a mut [u8],\n-    len: usize,\n-}\n-\n-impl<'a> MutAsciiString<'a> {\n-    pub fn new(buf: &'a mut [u8]) -> MutAsciiString<'a> {\n-        MutAsciiString { buf, len: 0 }\n-    }\n-\n-    pub fn as_str(&self) -> &str {\n-        str::from_utf8(&self.buf[..self.len]).unwrap()\n-    }\n-\n-    pub fn len(&self) -> usize {\n-        self.len\n-    }\n-\n-    pub fn push(&mut self, c: char) {\n-        assert!(self.len() < self.buf.len());\n-        assert!(c.is_ascii());\n-\n-        self.buf[self.len] = c as u8;\n-        self.len += 1;\n-    }\n-}\n-\n-impl<'a> Deref for MutAsciiString<'a> {\n-    type Target = str;\n-    fn deref(&self) -> &str {\n-        self.as_str()\n-    }\n-}"}, {"sha": "61cf83c84660f1abf8c473db32aacc7856ff6a2e", "filename": "crates/ra_syntax/src/validation.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b2ba59526f8e524aa3c1526dda2828a93653ed2/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs?ref=3b2ba59526f8e524aa3c1526dda2828a93653ed2", "patch": "@@ -1,11 +1,12 @@\n use std::u32;\n \n+use arrayvec::ArrayString;\n+\n use crate::{\n     algo::visit::{visitor_ctx, VisitorCtx},\n     ast::{self, AstNode},\n     File,\n     string_lexing::{self, CharComponentKind},\n-    utils::MutAsciiString,\n     yellow::{\n         SyntaxError,\n         SyntaxErrorKind::*,\n@@ -76,8 +77,7 @@ fn validate_char(node: ast::Char, errors: &mut Vec<SyntaxError>) {\n                     return;\n                 }\n \n-                let mut buf = &mut [0; 6];\n-                let mut code = MutAsciiString::new(buf);\n+                let mut code = ArrayString::<[_; 6]>::new();\n                 let mut closed = false;\n                 for c in text[3..].chars() {\n                     assert!(!closed, \"no characters after escape is closed\");"}]}