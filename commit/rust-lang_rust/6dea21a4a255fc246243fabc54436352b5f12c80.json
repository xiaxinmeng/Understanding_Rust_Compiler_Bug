{"sha": "6dea21a4a255fc246243fabc54436352b5f12c80", "node_id": "C_kwDOAAsO6NoAKDZkZWEyMWE0YTI1NWZjMjQ2MjQzZmFiYzU0NDM2MzUyYjVmMTJjODA", "commit": {"author": {"name": "Hudson Ayers", "email": "hayers@stanford.edu", "date": "2022-07-22T19:21:32Z"}, "committer": {"name": "Hudson Ayers", "email": "hayers@stanford.edu", "date": "2022-07-28T16:45:59Z"}, "message": "location-detail: disable all location details when passed `none`\n\nPrior to this fix, `-Z location-detail` provided no mechanism for\ndisabling all location details. This commit also adds a test case\nto verify that this option continues to work as intended, and\nclarifies the documentation of this option.", "tree": {"sha": "5a5bd17aac2727829b06797e5c7de453c3925181", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a5bd17aac2727829b06797e5c7de453c3925181"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6dea21a4a255fc246243fabc54436352b5f12c80", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6dea21a4a255fc246243fabc54436352b5f12c80", "html_url": "https://github.com/rust-lang/rust/commit/6dea21a4a255fc246243fabc54436352b5f12c80", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6dea21a4a255fc246243fabc54436352b5f12c80/comments", "author": {"login": "hudson-ayers", "id": 32688905, "node_id": "MDQ6VXNlcjMyNjg4OTA1", "avatar_url": "https://avatars.githubusercontent.com/u/32688905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hudson-ayers", "html_url": "https://github.com/hudson-ayers", "followers_url": "https://api.github.com/users/hudson-ayers/followers", "following_url": "https://api.github.com/users/hudson-ayers/following{/other_user}", "gists_url": "https://api.github.com/users/hudson-ayers/gists{/gist_id}", "starred_url": "https://api.github.com/users/hudson-ayers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hudson-ayers/subscriptions", "organizations_url": "https://api.github.com/users/hudson-ayers/orgs", "repos_url": "https://api.github.com/users/hudson-ayers/repos", "events_url": "https://api.github.com/users/hudson-ayers/events{/privacy}", "received_events_url": "https://api.github.com/users/hudson-ayers/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hudson-ayers", "id": 32688905, "node_id": "MDQ6VXNlcjMyNjg4OTA1", "avatar_url": "https://avatars.githubusercontent.com/u/32688905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hudson-ayers", "html_url": "https://github.com/hudson-ayers", "followers_url": "https://api.github.com/users/hudson-ayers/followers", "following_url": "https://api.github.com/users/hudson-ayers/following{/other_user}", "gists_url": "https://api.github.com/users/hudson-ayers/gists{/gist_id}", "starred_url": "https://api.github.com/users/hudson-ayers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hudson-ayers/subscriptions", "organizations_url": "https://api.github.com/users/hudson-ayers/orgs", "repos_url": "https://api.github.com/users/hudson-ayers/repos", "events_url": "https://api.github.com/users/hudson-ayers/events{/privacy}", "received_events_url": "https://api.github.com/users/hudson-ayers/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05e678ccca974a8d0c26991083fb4cf8fff84e74", "url": "https://api.github.com/repos/rust-lang/rust/commits/05e678ccca974a8d0c26991083fb4cf8fff84e74", "html_url": "https://github.com/rust-lang/rust/commit/05e678ccca974a8d0c26991083fb4cf8fff84e74"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "6d96cf9410bef8bfe80b5751bbcfe7cd0b40463c", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6dea21a4a255fc246243fabc54436352b5f12c80/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dea21a4a255fc246243fabc54436352b5f12c80/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=6dea21a4a255fc246243fabc54436352b5f12c80", "patch": "@@ -393,8 +393,7 @@ mod desc {\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), `thin`, `fat`, or omitted\";\n     pub const parse_linker_plugin_lto: &str =\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), or the path to the linker plugin\";\n-    pub const parse_location_detail: &str =\n-        \"comma separated list of location details to track: `file`, `line`, or `column`\";\n+    pub const parse_location_detail: &str = \"either `none`, or a comma separated list of location details to track: `file`, `line`, or `column`\";\n     pub const parse_switch_with_opt_path: &str =\n         \"an optional path to the profiling data output directory\";\n     pub const parse_merge_functions: &str = \"one of: `disabled`, `trampolines`, or `aliases`\";\n@@ -549,6 +548,9 @@ mod parse {\n             ld.line = false;\n             ld.file = false;\n             ld.column = false;\n+            if v == \"none\" {\n+                return true;\n+            }\n             for s in v.split(',') {\n                 match s {\n                     \"file\" => ld.file = true,\n@@ -1360,8 +1362,9 @@ options! {\n     llvm_time_trace: bool = (false, parse_bool, [UNTRACKED],\n         \"generate JSON tracing data file from LLVM data (default: no)\"),\n     location_detail: LocationDetail = (LocationDetail::all(), parse_location_detail, [TRACKED],\n-        \"comma separated list of location details to be tracked when using caller_location \\\n-        valid options are `file`, `line`, and `column` (default: all)\"),\n+        \"what location details should be tracked when using caller_location, either \\\n+        `none`, or a comma separated list of location details, for which \\\n+        valid options are `file`, `line`, and `column` (default: `file,line,column`)\"),\n     ls: bool = (false, parse_bool, [UNTRACKED],\n         \"list the symbols defined by a library crate (default: no)\"),\n     macro_backtrace: bool = (false, parse_bool, [UNTRACKED],"}, {"sha": "db070619969649034ba4f531cb47a65289afe07e", "filename": "src/doc/unstable-book/src/compiler-flags/location-detail.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "raw_url": "https://github.com/rust-lang/rust/raw/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md?ref=6dea21a4a255fc246243fabc54436352b5f12c80", "patch": "@@ -17,8 +17,9 @@ within this list are:\n - `line` - the source line of the panic will be included in the panic output\n - `column` - the source column of the panic will be included in the panic output\n \n-Any combination of these three options are supported. If this option is not specified,\n-all three are included by default.\n+Any combination of these three options are supported. Alternatively, you can pass\n+`none` to this option, which results in no location details being tracked.\n+If this option is not specified, all three are included by default.\n \n An example of a panic output when using `-Z location-detail=line`:\n ```text"}, {"sha": "9a492f1a810dc0f1855b983f05e7e3d60f4797f9", "filename": "src/test/rustdoc-ui/z-help.stdout", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout?ref=6dea21a4a255fc246243fabc54436352b5f12c80", "patch": "@@ -69,7 +69,7 @@\n     -Z                               link-only=val -- link the `.rlink` file generated by `-Z no-link` (default: no)\n     -Z                            llvm-plugins=val -- a list LLVM plugins to enable (space separated)\n     -Z                         llvm-time-trace=val -- generate JSON tracing data file from LLVM data (default: no)\n-    -Z                         location-detail=val -- comma separated list of location details to be tracked when using caller_location valid options are `file`, `line`, and `column` (default: all)\n+    -Z                         location-detail=val -- what location details should be tracked when using caller_location, either `none`, or a comma separated list of location details, for which valid options are `file`, `line`, and `column` (default: `file,line,column`)\n     -Z                                      ls=val -- list the symbols defined by a library crate (default: no)\n     -Z                         macro-backtrace=val -- show macro backtraces (default: no)\n     -Z                         merge-functions=val -- control the operation of the MergeFunctions LLVM pass, taking the same values as the target option of the same name"}, {"sha": "7b609145bad7298ca95197ab553de4cb50c47d11", "filename": "src/test/ui/panics/location-detail-panic-no-location-info.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs?ref=6dea21a4a255fc246243fabc54436352b5f12c80", "patch": "@@ -0,0 +1,8 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=none\n+// exec-env:RUST_BACKTRACE=0\n+\n+fn main() {\n+    panic!(\"no location info\");\n+}"}, {"sha": "d1c3108643c6c9ae4dc2a9fdc78dacf6560686f0", "filename": "src/test/ui/panics/location-detail-panic-no-location-info.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6dea21a4a255fc246243fabc54436352b5f12c80/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr?ref=6dea21a4a255fc246243fabc54436352b5f12c80", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'no location info', <redacted>:0:0\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}]}