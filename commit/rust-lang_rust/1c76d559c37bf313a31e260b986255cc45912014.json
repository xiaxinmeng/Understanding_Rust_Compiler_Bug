{"sha": "1c76d559c37bf313a31e260b986255cc45912014", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjNzZkNTU5YzM3YmYzMTNhMzFlMjYwYjk4NjI1NWNjNDU5MTIwMTQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-08-25T00:05:47Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-08-25T12:01:51Z"}, "message": "rustc: Encode the visibility of foreign items\n\nThe privacy pass of the compiler was previously not taking into account the\nprivacy of foreign items, or bindings to external functions. This commit fixes\nthis oversight by encoding the visibility of foreign items into the metadata for\neach crate.\n\nAny code relying on this will start to fail to  compile and the bindings must be\nmarked with `pub` to indicate that they can be used externally.\n\nCloses #16725\n[breaking-change]", "tree": {"sha": "0e4226b93d88621a942dd1377d15298b7c508725", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e4226b93d88621a942dd1377d15298b7c508725"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c76d559c37bf313a31e260b986255cc45912014", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c76d559c37bf313a31e260b986255cc45912014", "html_url": "https://github.com/rust-lang/rust/commit/1c76d559c37bf313a31e260b986255cc45912014", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c76d559c37bf313a31e260b986255cc45912014/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "url": "https://api.github.com/repos/rust-lang/rust/commits/17f79af31c4d413352a967b6cfe9ba7d70f66ff7", "html_url": "https://github.com/rust-lang/rust/commit/17f79af31c4d413352a967b6cfe9ba7d70f66ff7"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "ffa4a1b5bf0838f62a856c0fe92ce4732708596a", "filename": "src/librustc/metadata/encoder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1c76d559c37bf313a31e260b986255cc45912014/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c76d559c37bf313a31e260b986255cc45912014/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fencoder.rs?ref=1c76d559c37bf313a31e260b986255cc45912014", "patch": "@@ -1371,6 +1371,7 @@ fn encode_info_for_foreign_item(ecx: &EncodeContext,\n \n     rbml_w.start_tag(tag_items_data_item);\n     encode_def_id(rbml_w, local_def(nitem.id));\n+    encode_visibility(rbml_w, nitem.vis);\n     match nitem.node {\n       ForeignItemFn(..) => {\n         encode_family(rbml_w, style_fn_family(NormalFn));"}, {"sha": "500475091e0d3f883d650f83f29b120c30e0cf07", "filename": "src/test/auxiliary/foreign_lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fauxiliary%2Fforeign_lib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fauxiliary%2Fforeign_lib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fforeign_lib.rs?ref=1c76d559c37bf313a31e260b986255cc45912014", "patch": "@@ -15,6 +15,6 @@ pub mod rustrt {\n \n     #[link(name = \"rust_test_helpers\")]\n     extern {\n-        fn rust_get_test_int() -> libc::intptr_t;\n+        pub fn rust_get_test_int() -> libc::intptr_t;\n     }\n }"}, {"sha": "7f388c13e15a8a7351d1a6d3d0439c99e8bc1f27", "filename": "src/test/auxiliary/issue-16725.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fauxiliary%2Fissue-16725.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fauxiliary%2Fissue-16725.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fissue-16725.rs?ref=1c76d559c37bf313a31e260b986255cc45912014", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+extern {\n+    fn bar();\n+}\n+"}, {"sha": "f70d88a41cd1f5e02d09c5de65749771f69cf43c", "filename": "src/test/compile-fail/issue-16725.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fcompile-fail%2Fissue-16725.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c76d559c37bf313a31e260b986255cc45912014/src%2Ftest%2Fcompile-fail%2Fissue-16725.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-16725.rs?ref=1c76d559c37bf313a31e260b986255cc45912014", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:issue-16725.rs\n+\n+extern crate foo = \"issue-16725\";\n+\n+fn main() {\n+    unsafe { foo::bar(); }\n+    //~^ ERROR: function `bar` is private\n+}\n+"}]}