{"sha": "0ea59f3bd69b78e4d3812452a0df401662d28fb6", "node_id": "C_kwDOAAsO6NoAKDBlYTU5ZjNiZDY5Yjc4ZTRkMzgxMjQ1MmEwZGY0MDE2NjJkMjhmYjY", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-06-25T22:46:47Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-06-25T22:50:00Z"}, "message": "diagnostics: consider parameter count when suggesting smart pointers", "tree": {"sha": "b75fec139d7de236f3a001d48920177e3d8e7672", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b75fec139d7de236f3a001d48920177e3d8e7672"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0ea59f3bd69b78e4d3812452a0df401662d28fb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0ea59f3bd69b78e4d3812452a0df401662d28fb6", "html_url": "https://github.com/rust-lang/rust/commit/0ea59f3bd69b78e4d3812452a0df401662d28fb6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0ea59f3bd69b78e4d3812452a0df401662d28fb6/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9cf699d2ff4ff23a6d6862a35727f4d5d3567dae", "url": "https://api.github.com/repos/rust-lang/rust/commits/9cf699d2ff4ff23a6d6862a35727f4d5d3567dae", "html_url": "https://github.com/rust-lang/rust/commit/9cf699d2ff4ff23a6d6862a35727f4d5d3567dae"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "79a13ce2fcac969cd4b99c4d8511fd260b85ec88", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0ea59f3bd69b78e4d3812452a0df401662d28fb6/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ea59f3bd69b78e4d3812452a0df401662d28fb6/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=0ea59f3bd69b78e4d3812452a0df401662d28fb6", "patch": "@@ -994,6 +994,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         span,\n                         rcvr_ty,\n                         item_name,\n+                        args.map(|args| args.len()),\n                         source,\n                         out_of_scope_traits,\n                         &unsatisfied_predicates,\n@@ -1732,6 +1733,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         span: Span,\n         rcvr_ty: Ty<'tcx>,\n         item_name: Ident,\n+        inputs_len: Option<usize>,\n         source: SelfSource<'tcx>,\n         valid_out_of_scope_traits: Vec<DefId>,\n         unsatisfied_predicates: &[(\n@@ -1808,7 +1810,8 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         // Explicitly ignore the `Pin::as_ref()` method as `Pin` does not\n                         // implement the `AsRef` trait.\n                         let skip = skippable.contains(&did)\n-                            || ((\"Pin::new\" == *pre) && (sym::as_ref == item_name.name));\n+                            || ((\"Pin::new\" == *pre) && (sym::as_ref == item_name.name))\n+                            || inputs_len.map_or(false, |inputs_len| pick.item.kind == ty::AssocKind::Fn && self.tcx.fn_sig(pick.item.def_id).skip_binder().inputs().len() != inputs_len);\n                         // Make sure the method is defined for the *actual* receiver: we don't\n                         // want to treat `Box<Self>` as a receiver if it only works because of\n                         // an autoderef to `&self`"}, {"sha": "acb897571d64e38d809064cae77e1b670e19d7bd", "filename": "src/test/ui/suggestions/dont-suggest-pin-array-dot-set.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/0ea59f3bd69b78e4d3812452a0df401662d28fb6/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ea59f3bd69b78e4d3812452a0df401662d28fb6/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.rs?ref=0ea59f3bd69b78e4d3812452a0df401662d28fb6", "patch": "@@ -0,0 +1,15 @@\n+// https://github.com/rust-lang/rust/issues/96834\n+//\n+// This test case verifies that rustc does not make an unhelpful suggestion:\n+//\n+//     help: consider wrapping the receiver expression with the appropriate type\n+//         |\n+//     14  |     Pin::new(&mut a).set(0, 3);\n+//         |     +++++++++++++  +\n+//\n+// We can tell that it isn't helpful, because `Pin::set` takes two parameters (including\n+// the receiver), but the function call on line 14 supplies three.\n+fn main() {\n+    let mut a = [0u8; 1];\n+    a.set(0, 3); //~ERROR\n+}"}, {"sha": "677aa031bf7d65dce3ca16bb54c20bf53879af7d", "filename": "src/test/ui/suggestions/dont-suggest-pin-array-dot-set.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0ea59f3bd69b78e4d3812452a0df401662d28fb6/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0ea59f3bd69b78e4d3812452a0df401662d28fb6/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fdont-suggest-pin-array-dot-set.stderr?ref=0ea59f3bd69b78e4d3812452a0df401662d28fb6", "patch": "@@ -0,0 +1,9 @@\n+error[E0599]: no method named `set` found for array `[u8; 1]` in the current scope\n+  --> $DIR/dont-suggest-pin-array-dot-set.rs:14:7\n+   |\n+LL |     a.set(0, 3);\n+   |       ^^^ help: there is an associated function with a similar name: `get`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0599`."}]}