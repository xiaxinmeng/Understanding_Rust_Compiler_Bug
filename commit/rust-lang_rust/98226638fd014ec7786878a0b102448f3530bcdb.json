{"sha": "98226638fd014ec7786878a0b102448f3530bcdb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4MjI2NjM4ZmQwMTRlYzc3ODY4NzhhMGIxMDI0NDhmMzUzMGJjZGI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-01-28T06:09:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-28T06:09:04Z"}, "message": "Rollup merge of #80868 - johanngan:should-panic-msg-with-expected, r=m-ou-se\n\nPrint failure message on all tests that should panic, but don't\n\nFixes #80861. Tests with the `#[should_panic]` attribute should always print a failure message if no panic occurs, regardless of whether or not an `expected` panic message is specified.", "tree": {"sha": "ef0823a99c280875e9f065888dd83b715bafe99b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef0823a99c280875e9f065888dd83b715bafe99b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/98226638fd014ec7786878a0b102448f3530bcdb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgElUBCRBK7hj4Ov3rIwAAdHIIAFIfSjgXZqhHcw8x89Z/UgWB\nGwFgNU+rcsiI791to/cJhdzG5STIoDqTjHIRj+5oPV7QqiSQxif/3W18ZWbsqUp6\nAVIMP4hEmje6cv8Ivqz/Sgyf19IpS/rhPOofrhtq3ae/hkMSRcdAlSbksIph37o2\nHc0mMd9uD66loXWZAPgrisdNiedHH+5li4LhExAChEiCrmO1EaIbz1s1BWfNboqM\njUiImOhOM858Y8LT2Pnygan4HSDY8cC+4xoiPXdFch3uW7tgbegKUw5Y5Wl4GdLY\nSJ0QqvkJ13SV2JfGKFTLt21EVoD1bmbmC/SQvwgTt5BiEm5Bf5/oNWtn4DtB+Ug=\n=dBJ/\n-----END PGP SIGNATURE-----\n", "payload": "tree ef0823a99c280875e9f065888dd83b715bafe99b\nparent 446edd1e1a4e024949a84533e027da9d384b79f7\nparent b43aa960d0a7d09f137cc6b7f26605f6183cd72f\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1611814144 +0900\ncommitter GitHub <noreply@github.com> 1611814144 +0900\n\nRollup merge of #80868 - johanngan:should-panic-msg-with-expected, r=m-ou-se\n\nPrint failure message on all tests that should panic, but don't\n\nFixes #80861. Tests with the `#[should_panic]` attribute should always print a failure message if no panic occurs, regardless of whether or not an `expected` panic message is specified.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/98226638fd014ec7786878a0b102448f3530bcdb", "html_url": "https://github.com/rust-lang/rust/commit/98226638fd014ec7786878a0b102448f3530bcdb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/98226638fd014ec7786878a0b102448f3530bcdb/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "446edd1e1a4e024949a84533e027da9d384b79f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/446edd1e1a4e024949a84533e027da9d384b79f7", "html_url": "https://github.com/rust-lang/rust/commit/446edd1e1a4e024949a84533e027da9d384b79f7"}, {"sha": "b43aa960d0a7d09f137cc6b7f26605f6183cd72f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b43aa960d0a7d09f137cc6b7f26605f6183cd72f", "html_url": "https://github.com/rust-lang/rust/commit/b43aa960d0a7d09f137cc6b7f26605f6183cd72f"}], "stats": {"total": 41, "additions": 25, "deletions": 16}, "files": [{"sha": "598fb670bb4bf678242921f42d7c966a6866aa3d", "filename": "library/test/src/test_result.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/98226638fd014ec7786878a0b102448f3530bcdb/library%2Ftest%2Fsrc%2Ftest_result.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98226638fd014ec7786878a0b102448f3530bcdb/library%2Ftest%2Fsrc%2Ftest_result.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftest_result.rs?ref=98226638fd014ec7786878a0b102448f3530bcdb", "patch": "@@ -63,7 +63,7 @@ pub fn calc_result<'a>(\n                 ))\n             }\n         }\n-        (&ShouldPanic::Yes, Ok(())) => {\n+        (&ShouldPanic::Yes, Ok(())) | (&ShouldPanic::YesWithMessage(_), Ok(())) => {\n             TestResult::TrFailedMsg(\"test did not panic as expected\".to_string())\n         }\n         _ if desc.allow_fail => TestResult::TrAllowedFail,"}, {"sha": "a629829b885145f4af02fb64e5985a13eb1c6836", "filename": "library/test/src/tests.rs", "status": "modified", "additions": 24, "deletions": 15, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/98226638fd014ec7786878a0b102448f3530bcdb/library%2Ftest%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/98226638fd014ec7786878a0b102448f3530bcdb/library%2Ftest%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftests.rs?ref=98226638fd014ec7786878a0b102448f3530bcdb", "patch": "@@ -228,21 +228,30 @@ fn test_should_panic_non_string_message_type() {\n #[test]\n #[cfg(not(target_os = \"emscripten\"))]\n fn test_should_panic_but_succeeds() {\n-    fn f() {}\n-    let desc = TestDescAndFn {\n-        desc: TestDesc {\n-            name: StaticTestName(\"whatever\"),\n-            ignore: false,\n-            should_panic: ShouldPanic::Yes,\n-            allow_fail: false,\n-            test_type: TestType::Unknown,\n-        },\n-        testfn: DynTestFn(Box::new(f)),\n-    };\n-    let (tx, rx) = channel();\n-    run_test(&TestOpts::new(), false, desc, RunStrategy::InProcess, tx, Concurrent::No);\n-    let result = rx.recv().unwrap().result;\n-    assert_eq!(result, TrFailedMsg(\"test did not panic as expected\".to_string()));\n+    let should_panic_variants = [ShouldPanic::Yes, ShouldPanic::YesWithMessage(\"error message\")];\n+\n+    for &should_panic in should_panic_variants.iter() {\n+        fn f() {}\n+        let desc = TestDescAndFn {\n+            desc: TestDesc {\n+                name: StaticTestName(\"whatever\"),\n+                ignore: false,\n+                should_panic,\n+                allow_fail: false,\n+                test_type: TestType::Unknown,\n+            },\n+            testfn: DynTestFn(Box::new(f)),\n+        };\n+        let (tx, rx) = channel();\n+        run_test(&TestOpts::new(), false, desc, RunStrategy::InProcess, tx, Concurrent::No);\n+        let result = rx.recv().unwrap().result;\n+        assert_eq!(\n+            result,\n+            TrFailedMsg(\"test did not panic as expected\".to_string()),\n+            \"should_panic == {:?}\",\n+            should_panic\n+        );\n+    }\n }\n \n fn report_time_test_template(report_time: bool) -> Option<TestExecTime> {"}]}