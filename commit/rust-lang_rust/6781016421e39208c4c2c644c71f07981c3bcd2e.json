{"sha": "6781016421e39208c4c2c644c71f07981c3bcd2e", "node_id": "C_kwDOAAsO6NoAKDY3ODEwMTY0MjFlMzkyMDhjNGMyYzY0NGM3MWYwNzk4MWMzYmNkMmU", "commit": {"author": {"name": "Lo\u00efc BRANSTETT", "email": "lolo.branstett@numericable.fr", "date": "2022-03-09T15:52:38Z"}, "committer": {"name": "Lo\u00efc BRANSTETT", "email": "lolo.branstett@numericable.fr", "date": "2022-03-09T15:58:07Z"}, "message": "Add miri to the well known conditional compilation names and values", "tree": {"sha": "abfd36353fe08f0e42a6c621028e5e1c195472c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abfd36353fe08f0e42a6c621028e5e1c195472c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6781016421e39208c4c2c644c71f07981c3bcd2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6781016421e39208c4c2c644c71f07981c3bcd2e", "html_url": "https://github.com/rust-lang/rust/commit/6781016421e39208c4c2c644c71f07981c3bcd2e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6781016421e39208c4c2c644c71f07981c3bcd2e/comments", "author": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Urgau", "id": 3616612, "node_id": "MDQ6VXNlcjM2MTY2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3616612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Urgau", "html_url": "https://github.com/Urgau", "followers_url": "https://api.github.com/users/Urgau/followers", "following_url": "https://api.github.com/users/Urgau/following{/other_user}", "gists_url": "https://api.github.com/users/Urgau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Urgau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Urgau/subscriptions", "organizations_url": "https://api.github.com/users/Urgau/orgs", "repos_url": "https://api.github.com/users/Urgau/repos", "events_url": "https://api.github.com/users/Urgau/events{/privacy}", "received_events_url": "https://api.github.com/users/Urgau/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b97dc20784698730bd7bc1a20eabdcd32066d174", "url": "https://api.github.com/repos/rust-lang/rust/commits/b97dc20784698730bd7bc1a20eabdcd32066d174", "html_url": "https://github.com/rust-lang/rust/commit/b97dc20784698730bd7bc1a20eabdcd32066d174"}], "stats": {"total": 59, "additions": 52, "deletions": 7}, "files": [{"sha": "1d36ff059de81eb89456660854facc29f1888a64", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -1072,6 +1072,7 @@ impl CrateCheckConfig {\n         // NOTE: This should be kept in sync with `default_configuration` and\n         // `fill_well_known_values`\n         const WELL_KNOWN_NAMES: &[Symbol] = &[\n+            // rustc\n             sym::unix,\n             sym::windows,\n             sym::target_os,\n@@ -1091,9 +1092,12 @@ impl CrateCheckConfig {\n             sym::debug_assertions,\n             sym::proc_macro,\n             sym::test,\n+            sym::feature,\n+            // rustdoc\n             sym::doc,\n             sym::doctest,\n-            sym::feature,\n+            // miri\n+            sym::miri,\n         ];\n \n         // We only insert well-known names if `names()` was activated\n@@ -1128,13 +1132,14 @@ impl CrateCheckConfig {\n \n         // No-values\n         for name in [\n+            sym::doc,\n+            sym::miri,\n             sym::unix,\n-            sym::windows,\n-            sym::debug_assertions,\n-            sym::proc_macro,\n             sym::test,\n-            sym::doc,\n             sym::doctest,\n+            sym::windows,\n+            sym::proc_macro,\n+            sym::debug_assertions,\n             sym::target_thread_local,\n         ] {\n             self.values_valid.entry(name).or_default();"}, {"sha": "3884578f5d46caf3e86357b6d6ec2557f6261dbe", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -891,6 +891,7 @@ symbols! {\n         minnumf32,\n         minnumf64,\n         mips_target_feature,\n+        miri,\n         misc,\n         mmx_reg,\n         modifiers,"}, {"sha": "8dfb90c0de13195b0a80b0b3da6decad7b6bb52e", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -193,7 +193,6 @@ const EXTRA_CHECK_CFGS: &[(Option<Mode>, &'static str, Option<&[&'static str]>)]\n     (None, \"bootstrap\", None),\n     (Some(Mode::Rustc), \"parallel_compiler\", None),\n     (Some(Mode::ToolRustc), \"parallel_compiler\", None),\n-    (Some(Mode::Std), \"miri\", None),\n     (Some(Mode::Std), \"stdarch_intel_sde\", None),\n     (Some(Mode::Std), \"no_fp_fmt_parse\", None),\n     (Some(Mode::Std), \"no_global_oom_handling\", None),"}, {"sha": "e57fb69a1e05f2d94a7982ee39af6fa2b4fb03fd", "filename": "src/test/ui/check-cfg/well-known-names.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -24,4 +24,10 @@ fn unix_misspell() {}\n #[cfg(unix)]\n fn unix() {}\n \n+#[cfg(miri)]\n+fn miri() {}\n+\n+#[cfg(doc)]\n+fn doc() {}\n+\n fn main() {}"}, {"sha": "96375dc8d3130e0518ddaa49d1df7974b3232898", "filename": "src/test/ui/check-cfg/well-known-values.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -25,4 +25,18 @@ fn unix_with_value() {}\n #[cfg(unix)]\n fn unix() {}\n \n+#[cfg(miri = \"miri\")]\n+//~^ WARNING unexpected `cfg` condition value\n+fn miri_with_value() {}\n+\n+#[cfg(miri)]\n+fn miri() {}\n+\n+#[cfg(doc = \"linux\")]\n+//~^ WARNING unexpected `cfg` condition value\n+fn doc_with_value() {}\n+\n+#[cfg(doc)]\n+fn doc() {}\n+\n fn main() {}"}, {"sha": "8b04c770fb505f99c805aabaf8a938b56ceabf9d", "filename": "src/test/ui/check-cfg/well-known-values.stderr", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6781016421e39208c4c2c644c71f07981c3bcd2e/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr?ref=6781016421e39208c4c2c644c71f07981c3bcd2e", "patch": "@@ -29,5 +29,25 @@ LL | #[cfg(unix = \"aa\")]\n    |\n    = note: no expected value for `unix`\n \n-warning: 3 warnings emitted\n+warning: unexpected `cfg` condition value\n+  --> $DIR/well-known-values.rs:28:7\n+   |\n+LL | #[cfg(miri = \"miri\")]\n+   |       ^^^^---------\n+   |           |\n+   |           help: remove the value\n+   |\n+   = note: no expected value for `miri`\n+\n+warning: unexpected `cfg` condition value\n+  --> $DIR/well-known-values.rs:35:7\n+   |\n+LL | #[cfg(doc = \"linux\")]\n+   |       ^^^----------\n+   |          |\n+   |          help: remove the value\n+   |\n+   = note: no expected value for `doc`\n+\n+warning: 5 warnings emitted\n "}]}