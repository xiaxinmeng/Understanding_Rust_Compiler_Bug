{"sha": "979c26e1aebee85e664899235d5fbc67ca26d6e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3OWMyNmUxYWViZWU4NWU2NjQ4OTkyMzVkNWZiYzY3Y2EyNmQ2ZTg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-03-01T18:29:40Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-03-01T18:30:21Z"}, "message": "Axe pre-commit", "tree": {"sha": "0653d4a9a0c5cfed7f9016e21727f49dae7051a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0653d4a9a0c5cfed7f9016e21727f49dae7051a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/979c26e1aebee85e664899235d5fbc67ca26d6e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/979c26e1aebee85e664899235d5fbc67ca26d6e8", "html_url": "https://github.com/rust-lang/rust/commit/979c26e1aebee85e664899235d5fbc67ca26d6e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/979c26e1aebee85e664899235d5fbc67ca26d6e8/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8", "html_url": "https://github.com/rust-lang/rust/commit/5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8"}], "stats": {"total": 55, "additions": 0, "deletions": 55}, "files": [{"sha": "b91013f13789384fdc87234ac172f712f9fd6c6b", "filename": "docs/dev/README.md", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/979c26e1aebee85e664899235d5fbc67ca26d6e8/docs%2Fdev%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/979c26e1aebee85e664899235d5fbc67ca26d6e8/docs%2Fdev%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2FREADME.md?ref=979c26e1aebee85e664899235d5fbc67ca26d6e8", "patch": "@@ -58,8 +58,6 @@ Use `env RUN_SLOW_TESTS=1 cargo test` to run the full suite.\n \n We use bors-ng to enforce the [not rocket science](https://graydon2.dreamwidth.org/1597.html) rule.\n \n-You can run `cargo xtask install-pre-commit-hook` to install git-hook to run rustfmt on commit.\n-\n # Launching rust-analyzer\n \n Debugging the language server can be tricky."}, {"sha": "84b17ce23032ad7107824969bdfa634944574d4d", "filename": "xtask/src/main.rs", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/979c26e1aebee85e664899235d5fbc67ca26d6e8/xtask%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979c26e1aebee85e664899235d5fbc67ca26d6e8/xtask%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmain.rs?ref=979c26e1aebee85e664899235d5fbc67ca26d6e8", "patch": "@@ -15,7 +15,6 @@ mod tidy;\n mod install;\n mod release;\n mod dist;\n-mod pre_commit;\n mod metrics;\n mod pre_cache;\n \n@@ -39,10 +38,6 @@ use crate::{\n };\n \n fn main() -> Result<()> {\n-    if env::args().next().map(|it| it.contains(\"pre-commit\")) == Some(true) {\n-        return pre_commit::run_hook();\n-    }\n-\n     let _d = pushd(project_root())?;\n \n     let mut args = Arguments::from_env();\n@@ -103,14 +98,6 @@ FLAGS:\n             finish_args(args)?;\n             CodegenCmd { features }.run()\n         }\n-        \"format\" => {\n-            finish_args(args)?;\n-            run_rustfmt(Mode::Overwrite)\n-        }\n-        \"install-pre-commit-hook\" => {\n-            finish_args(args)?;\n-            pre_commit::install_hook()\n-        }\n         \"lint\" => {\n             finish_args(args)?;\n             run_clippy()\n@@ -164,8 +151,6 @@ USAGE:\n     cargo xtask <SUBCOMMAND>\n \n SUBCOMMANDS:\n-    format\n-    install-pre-commit-hook\n     fuzz-tests\n     codegen\n     install"}, {"sha": "b57cf3ce2bbf07c2737888244378d2f7e57368bf", "filename": "xtask/src/pre_commit.rs", "status": "removed", "additions": 0, "deletions": 38, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8/xtask%2Fsrc%2Fpre_commit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8/xtask%2Fsrc%2Fpre_commit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fpre_commit.rs?ref=5efb7f85eb24c7ad76136a7d81e8f8cffe213aa8", "patch": "@@ -1,38 +0,0 @@\n-//! pre-commit hook for code formatting.\n-\n-use std::{fs, path::PathBuf};\n-\n-use anyhow::{bail, Result};\n-use xshell::cmd;\n-\n-use crate::{project_root, run_rustfmt, Mode};\n-\n-// FIXME: if there are changed `.ts` files, also reformat TypeScript (by\n-// shelling out to `npm fmt`).\n-pub(crate) fn run_hook() -> Result<()> {\n-    run_rustfmt(Mode::Overwrite)?;\n-\n-    let diff = cmd!(\"git diff --diff-filter=MAR --name-only --cached\").read()?;\n-\n-    let root = project_root();\n-    for line in diff.lines() {\n-        let file = root.join(line);\n-        cmd!(\"git update-index --add {file}\").run()?;\n-    }\n-\n-    Ok(())\n-}\n-\n-pub(crate) fn install_hook() -> Result<()> {\n-    let hook_path: PathBuf =\n-        format!(\"./.git/hooks/pre-commit{}\", std::env::consts::EXE_SUFFIX).into();\n-\n-    if hook_path.exists() {\n-        bail!(\"Git hook already created\");\n-    }\n-\n-    let me = std::env::current_exe()?;\n-    fs::copy(me, hook_path)?;\n-\n-    Ok(())\n-}"}]}