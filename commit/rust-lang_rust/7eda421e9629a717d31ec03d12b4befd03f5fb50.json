{"sha": "7eda421e9629a717d31ec03d12b4befd03f5fb50", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlZGE0MjFlOTYyOWE3MTdkMzFlYzAzZDEyYjRiZWZkMDNmNWZiNTA=", "commit": {"author": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-11-25T14:02:47Z"}, "committer": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-11-27T16:41:50Z"}, "message": "Apply suggestion regarding clippy_enabled bool", "tree": {"sha": "2230efc0bf43047ef7cddac3749303144c9ad6ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2230efc0bf43047ef7cddac3749303144c9ad6ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7eda421e9629a717d31ec03d12b4befd03f5fb50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7eda421e9629a717d31ec03d12b4befd03f5fb50", "html_url": "https://github.com/rust-lang/rust/commit/7eda421e9629a717d31ec03d12b4befd03f5fb50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7eda421e9629a717d31ec03d12b4befd03f5fb50/comments", "author": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "192ccfb4efc0a38378f4564b26e6033dec432bdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/192ccfb4efc0a38378f4564b26e6033dec432bdb", "html_url": "https://github.com/rust-lang/rust/commit/192ccfb4efc0a38378f4564b26e6033dec432bdb"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "03381106de1a645b7a9dc93f0284e9d011ee4882", "filename": "src/driver.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7eda421e9629a717d31ec03d12b4befd03f5fb50/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7eda421e9629a717d31ec03d12b4befd03f5fb50/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=7eda421e9629a717d31ec03d12b4befd03f5fb50", "patch": "@@ -182,6 +182,7 @@ fn toolchain_path(home: Option<String>, toolchain: Option<String>) -> Option<Pat\n     })\n }\n \n+#[allow(clippy::too_many_lines)]\n pub fn main() {\n     rustc_driver::init_rustc_env_logger();\n     SyncLazy::force(&ICE_HOOK);\n@@ -294,17 +295,20 @@ pub fn main() {\n \n         // this check ensures that dependencies are built but not linted and the final\n         // crate is linted but not built\n-        let clippy_disabled = env::var(\"CLIPPY_TESTS\").map_or(false, |val| val != \"true\")\n-            || arg_value(&orig_args, \"--cap-lints\", |val| val == \"allow\").is_some()\n-            || no_deps && env::var(\"CARGO_PRIMARY_PACKAGE\").is_err();\n+        let clippy_tests_set = env::var(\"CLIPPY_TESTS\").map_or(false, |val| val == \"true\");\n+        let cap_lints_allow = arg_value(&orig_args, \"--cap-lints\", |val| val == \"allow\").is_some();\n+        let in_primary_package = env::var(\"CARGO_PRIMARY_PACKAGE\").is_ok();\n \n-        if !clippy_disabled {\n+        let clippy_enabled = clippy_tests_set || (!cap_lints_allow && (!no_deps || in_primary_package));\n+        if clippy_enabled {\n             args.extend(clippy_args);\n         }\n+\n         let mut clippy = ClippyCallbacks;\n         let mut default = DefaultCallbacks;\n         let callbacks: &mut (dyn rustc_driver::Callbacks + Send) =\n-            if clippy_disabled { &mut default } else { &mut clippy };\n+            if clippy_enabled { &mut clippy } else { &mut default };\n+\n         rustc_driver::RunCompiler::new(&args, callbacks).run()\n     }))\n }"}]}