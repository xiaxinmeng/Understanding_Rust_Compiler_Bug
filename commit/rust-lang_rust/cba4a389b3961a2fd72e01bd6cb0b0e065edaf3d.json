{"sha": "cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "node_id": "C_kwDOAAsO6NoAKGNiYTRhMzg5YjM5NjFhMmZkNzJlMDFiZDZjYjBiMGUwNjVlZGFmM2Q", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-21T09:36:21Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-21T09:36:21Z"}, "message": "Auto merge of #101329 - QuinnPainter:armv5te-targets, r=nagisa\n\nAdd armv5te-none-eabi and thumbv5te-none-eabi targets\n\nCreates two new Tier 3 targets, `armv5te-none-eabi` and `thumbv5te-none-eabi`. They are for the same target architecture (armv5te), but one defaults to the A32 instruction set and the other defaults to T32. Based on the existing `armv4t-none-eabi` and `thumbv4t-none-eabi` targets.\n\nMy particular use case for these targets is Nintendo DS homebrew, but they should be usable for any armv5te system.\n\nGoing through the Tier 3 target policy:\n\n> A tier 3 target must have a designated developer or developers (the \"target maintainers\") on record to be CCed when issues arise regarding the target. (The mechanism to track and CC such developers may evolve over time.)\n\nThat will be me.\n\n> Targets must use naming consistent with any existing targets.\n\nNaming is consistent with previous targets.\n\n>> Target names should not introduce undue confusion or ambiguity unless absolutely necessary to maintain ecosystem compatibility.\n\nNo ambiguity here.\n\n> Tier 3 targets may have unusual requirements to build or use, but must not create legal issues or impose onerous legal terms for the Rust project or for Rust developers or users.\n\nDoesn't create any legal issues.\n\n>> The target must not introduce license incompatibilities.\n\nThis doesn't introduce any new licenses.\n\n>> Anything added to the Rust repository must be under the standard Rust license (MIT OR Apache-2.0).\n\nYep.\n\n>> The target must not cause the Rust tools or libraries built for any other host (even when supporting cross-compilation to the target) to depend on any new dependency less permissive than the Rust licensing policy. This applies whether the dependency is a Rust crate that would require adding new license exceptions (as specified by the tidy tool in the rust-lang/rust repository), or whether the dependency is a native library or binary. In other words, the introduction of the target must not cause a user installing or running a version of Rust or the Rust tools to be subject to any new license requirements.\n\nNo new license requirements.\n\n>> Compiling, linking, and emitting functional binaries, libraries, or other code for the target (whether hosted on the target itself or cross-compiling from another target) must not depend on proprietary (non-FOSS) libraries.\n\nEverything this uses is FOSS, no proprietary required.\n\n> Neither this policy nor any decisions made regarding targets shall create any binding agreement or estoppel by any party. If any member of an approving Rust team serves as one of the maintainers of a target, or has any legal or employment requirement (explicit or implicit) that might affect their decisions regarding a target, they must recuse themselves from any approval decisions regarding the target's tier status, though they may otherwise participate in discussions.\n\nOK.\n\n>> This requirement does not prevent part or all of this policy from being cited in an explicit contract or work agreement (e.g. to implement or maintain support for a target). This requirement exists to ensure that a developer or team responsible for reviewing and approving a target does not face any legal threats or obligations that would prevent them from freely exercising their judgment in such approval, even if such judgment involves subjective matters or goes beyond the letter of these requirements.\n\nOK.\n\n> Tier 3 targets should attempt to implement as much of the standard libraries as possible and appropriate (core for most targets, alloc for targets that can support dynamic memory allocation, std for targets with an operating system or equivalent layer of system-provided functionality), but may leave some code unimplemented (either unavailable or stubbed out as appropriate), whether because the target makes it impossible to implement or challenging to implement. The authors of pull requests are not obligated to avoid calling any portions of the standard library on the basis of a tier 3 target not implementing those portions.\n\nThis is a bare-metal target with only support for `core` (and `alloc`, if the user provides an allocator).\n\n> The target must provide documentation for the Rust community explaining how to build for the target, using cross-compilation if possible. If the target supports running binaries, or running tests (even if they do not pass), the documentation must explain how to run such binaries or tests for the target, using emulation if possible or dedicated hardware if necessary.\n\nDocumentation has been added.\n\n> Tier 3 targets must not impose burden on the authors of pull requests, or other developers in the community, to maintain the target. In particular, do not post comments (automated or manual) on a PR that derail or suggest a block on the PR based on a tier 3 target. Do not send automated messages or notifications (via any medium, including via `@)` to a PR author or others involved with a PR regarding a tier 3 target, unless they have opted into such messages.\n\nOK.\n\n> Backlinks such as those generated by the issue/PR tracker when linking to an issue or PR are not considered a violation of this policy, within reason. However, such messages (even on a separate repository) must not generate notifications to anyone involved with a PR who has not requested such notifications.\n\nOK.\n\n> Patches adding or updating tier 3 targets must not break any existing tier 2 or tier 1 target, and must not knowingly break another tier 3 target without approval of either the compiler team or the maintainers of the other tier 3 target.\n\nThis doesn't break any other targets.\n\n>> In particular, this may come up when working on closely related targets, such as variations of the same architecture with different features. Avoid introducing unconditional uses of features that another variation of the target may not have; use conditional compilation or runtime detection, as appropriate, to let each target run code supported by that target.\n\nNo unnecessary unconditional features here.", "tree": {"sha": "c3c93a67ac497f0620302e0deffe6b6527f41b18", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c3c93a67ac497f0620302e0deffe6b6527f41b18"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "html_url": "https://github.com/rust-lang/rust/commit/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1de00d1ac5247a02184ef7ad044f6521ade7e0cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/1de00d1ac5247a02184ef7ad044f6521ade7e0cc", "html_url": "https://github.com/rust-lang/rust/commit/1de00d1ac5247a02184ef7ad044f6521ade7e0cc"}, {"sha": "c227f0a8c958e8c5e331a5da99a749c8eb9bc625", "url": "https://api.github.com/repos/rust-lang/rust/commits/c227f0a8c958e8c5e331a5da99a749c8eb9bc625", "html_url": "https://github.com/rust-lang/rust/commit/c227f0a8c958e8c5e331a5da99a749c8eb9bc625"}], "stats": {"total": 153, "additions": 153, "deletions": 0}, "files": [{"sha": "dfd27b6547467bd9aa70cabebed7e75d70e51f02", "filename": "compiler/rustc_target/src/spec/armv5te_none_eabi.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv5te_none_eabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv5te_none_eabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Farmv5te_none_eabi.rs?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -0,0 +1,41 @@\n+//! Targets the ARMv5TE, with code as `a32` code by default.\n+\n+use crate::spec::{cvs, FramePointer, Target, TargetOptions};\n+\n+pub fn target() -> Target {\n+    Target {\n+        llvm_target: \"armv5te-none-eabi\".into(),\n+        pointer_width: 32,\n+        arch: \"arm\".into(),\n+        /* Data layout args are '-' separated:\n+         * little endian\n+         * stack is 64-bit aligned (EABI)\n+         * pointers are 32-bit\n+         * i64 must be 64-bit aligned (EABI)\n+         * mangle names with ELF style\n+         * native integers are 32-bit\n+         * All other elements are default\n+         */\n+        data_layout: \"e-m:e-p:32:32-Fi8-i64:64-v128:64:128-a:0:32-n32-S64\".into(),\n+\n+        options: TargetOptions {\n+            abi: \"eabi\".into(),\n+            // extra args passed to the external assembler (assuming `arm-none-eabi-as`):\n+            // * activate t32/a32 interworking\n+            // * use arch ARMv5TE\n+            // * use little-endian\n+            asm_args: cvs![\"-mthumb-interwork\", \"-march=armv5te\", \"-mlittle-endian\",],\n+            // minimum extra features, these cannot be disabled via -C\n+            // Also force-enable 32-bit atomics, which allows the use of atomic load/store only.\n+            // The resulting atomics are ABI incompatible with atomics backed by libatomic.\n+            features: \"+soft-float,+strict-align,+atomics-32\".into(),\n+            frame_pointer: FramePointer::MayOmit,\n+            main_needs_argc_argv: false,\n+            // don't have atomic compare-and-swap\n+            atomic_cas: false,\n+            has_thumb_interworking: true,\n+\n+            ..super::thumb_base::opts()\n+        },\n+    }\n+}"}, {"sha": "f4960b261173a1a5bb2ee6921f2e10e69307fe2d", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -1120,6 +1120,8 @@ supported_targets! {\n     (\"mipsel-unknown-none\", mipsel_unknown_none),\n     (\"thumbv4t-none-eabi\", thumbv4t_none_eabi),\n     (\"armv4t-none-eabi\", armv4t_none_eabi),\n+    (\"thumbv5te-none-eabi\", thumbv5te_none_eabi),\n+    (\"armv5te-none-eabi\", armv5te_none_eabi),\n \n     (\"aarch64_be-unknown-linux-gnu\", aarch64_be_unknown_linux_gnu),\n     (\"aarch64-unknown-linux-gnu_ilp32\", aarch64_unknown_linux_gnu_ilp32),"}, {"sha": "021b0e0eb622822dba37ae487692905fbc2b50f5", "filename": "compiler/rustc_target/src/spec/thumbv5te_none_eabi.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fthumbv5te_none_eabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fthumbv5te_none_eabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fthumbv5te_none_eabi.rs?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -0,0 +1,41 @@\n+//! Targets the ARMv5TE, with code as `t32` code by default.\n+\n+use crate::spec::{cvs, FramePointer, Target, TargetOptions};\n+\n+pub fn target() -> Target {\n+    Target {\n+        llvm_target: \"thumbv5te-none-eabi\".into(),\n+        pointer_width: 32,\n+        arch: \"arm\".into(),\n+        /* Data layout args are '-' separated:\n+         * little endian\n+         * stack is 64-bit aligned (EABI)\n+         * pointers are 32-bit\n+         * i64 must be 64-bit aligned (EABI)\n+         * mangle names with ELF style\n+         * native integers are 32-bit\n+         * All other elements are default\n+         */\n+        data_layout: \"e-m:e-p:32:32-Fi8-i64:64-v128:64:128-a:0:32-n32-S64\".into(),\n+\n+        options: TargetOptions {\n+            abi: \"eabi\".into(),\n+            // extra args passed to the external assembler (assuming `arm-none-eabi-as`):\n+            // * activate t32/a32 interworking\n+            // * use arch ARMv5TE\n+            // * use little-endian\n+            asm_args: cvs![\"-mthumb-interwork\", \"-march=armv5te\", \"-mlittle-endian\",],\n+            // minimum extra features, these cannot be disabled via -C\n+            // Also force-enable 32-bit atomics, which allows the use of atomic load/store only.\n+            // The resulting atomics are ABI incompatible with atomics backed by libatomic.\n+            features: \"+soft-float,+strict-align,+atomics-32\".into(),\n+            frame_pointer: FramePointer::MayOmit,\n+            main_needs_argc_argv: false,\n+            // don't have atomic compare-and-swap\n+            atomic_cas: false,\n+            has_thumb_interworking: true,\n+\n+            ..super::thumb_base::opts()\n+        },\n+    }\n+}"}, {"sha": "4fbfd3a4cec790cfd3c729f6f5555be6797007e0", "filename": "src/doc/rustc/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -20,6 +20,7 @@\n     - [aarch64-nintendo-switch-freestanding](platform-support/aarch64-nintendo-switch-freestanding.md)\n     - [armeb-unknown-linux-gnueabi](platform-support/armeb-unknown-linux-gnueabi.md)\n     - [armv4t-none-eabi](platform-support/armv4t-none-eabi.md)\n+    - [armv5te-none-eabi](platform-support/armv5te-none-eabi.md)\n     - [armv6k-nintendo-3ds](platform-support/armv6k-nintendo-3ds.md)\n     - [armv7-unknown-linux-uclibceabi](platform-support/armv7-unknown-linux-uclibceabi.md)\n     - [armv7-unknown-linux-uclibceabihf](platform-support/armv7-unknown-linux-uclibceabihf.md)"}, {"sha": "37b530dcb06cf80282a858b39c7317798b8214cc", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -226,6 +226,7 @@ target | std | host | notes\n [`armeb-unknown-linux-gnueabi`](platform-support/armeb-unknown-linux-gnueabi.md) | \u2713 | ? | ARM BE8 the default ARM big-endian architecture since [ARMv6](https://developer.arm.com/documentation/101754/0616/armlink-Reference/armlink-Command-line-Options/--be8?lang=en).\n `armv4t-none-eabi` | * |  | ARMv4T A32\n `armv4t-unknown-linux-gnueabi` | ? |  |\n+[`armv5te-none-eabi`](platform-support/armv5te-none-eabi.md) | * | | ARMv5TE A32\n `armv5te-unknown-linux-uclibceabi` | ? |  | ARMv5TE Linux with uClibc\n `armv6-unknown-freebsd` | \u2713 | \u2713 | ARMv6 FreeBSD\n `armv6-unknown-netbsd-eabihf` | ? |  |\n@@ -292,6 +293,7 @@ target | std | host | notes\n `sparc64-unknown-netbsd` | \u2713 | \u2713 | NetBSD/sparc64\n [`sparc64-unknown-openbsd`](platform-support/openbsd.md) | \u2713 | \u2713 | OpenBSD/sparc64\n `thumbv4t-none-eabi` | * |  | ARMv4T T32\n+[`thumbv5te-none-eabi`](platform-support/armv5te-none-eabi.md) | * | | ARMv5TE T32\n `thumbv7a-pc-windows-msvc` | ? |  |\n `thumbv7a-uwp-windows-msvc` | \u2713 |  |\n `thumbv7neon-unknown-linux-musleabihf` | ? |  | Thumb2-mode ARMv7a Linux with NEON, MUSL"}, {"sha": "f469dab1c42faaf78db9fd9aabe66c773e71342c", "filename": "src/doc/rustc/src/platform-support/armv5te-none-eabi.md", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmv5te-none-eabi.md", "raw_url": "https://github.com/rust-lang/rust/raw/cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmv5te-none-eabi.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmv5te-none-eabi.md?ref=cba4a389b3961a2fd72e01bd6cb0b0e065edaf3d", "patch": "@@ -0,0 +1,66 @@\n+# `armv5te-none-eabi`\n+\n+**Tier: 3**\n+\n+Bare-metal target for any cpu in the ARMv5TE architecture family, supporting\n+ARM/Thumb code interworking (aka `a32`/`t32`), with `a32` code as the default code\n+generation.\n+\n+The `thumbv5te-none-eabi` target is the same as this one, but the instruction set defaults to `t32`.\n+\n+## Target Maintainers\n+\n+* [@QuinnPainter](https://github.com/QuinnPainter)\n+\n+## Requirements\n+\n+The target is cross-compiled, and uses static linking.\n+\n+By default, the `lld` linker included with Rust will be used.\n+\n+However, you may want to use the `arm-none-eabi-ld` linker instead. This can be obtained for Windows/Mac/Linux from the [ARM\n+Developer Website][arm-dev], or possibly from your OS's package manager. To use it, add the following to your `.cargo/config.toml`:\n+\n+```toml\n+[target.armv5te-none-eabi]\n+linker = \"arm-none-eabi-ld\"\n+```\n+\n+[arm-dev]: https://developer.arm.com/Tools%20and%20Software/GNU%20Toolchain\n+\n+This target doesn't provide a linker script, you'll need to bring your own\n+according to the specific device you want to target. Pass\n+`-Clink-arg=-Tyour_script.ld` as a rustc argument to make the linker use\n+`your_script.ld` during linking.\n+\n+## Building Rust Programs\n+\n+Because it is Tier 3, rust does not yet ship pre-compiled artifacts for this target.\n+\n+Just use the `build-std` nightly cargo feature to build the `core` library. You\n+can pass this as a command line argument to cargo, or your `.cargo/config.toml`\n+file might include the following lines:\n+\n+```toml\n+[unstable]\n+build-std = [\"core\"]\n+```\n+\n+Most of `core` should work as expected, with the following notes:\n+* the target is \"soft float\", so `f32` and `f64` operations are emulated in\n+  software.\n+* integer division is also emulated in software.\n+* the target is old enough that it doesn't have atomic instructions.\n+\n+`alloc` is also supported, as long as you provide your own global allocator.\n+\n+Rust programs are output as ELF files.\n+\n+## Testing\n+\n+This is a cross-compiled target that you will need to emulate during testing.\n+\n+Because this is a device-agnostic target, and the exact emulator that you'll\n+need depends on the specific device you want to run your code on.\n+\n+For example, when programming for the DS, you can use one of the several available DS emulators, such as [melonDS](https://melonds.kuribo64.net/)."}]}