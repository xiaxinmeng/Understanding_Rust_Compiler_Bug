{"sha": "272c324b25ebbb05d5de4f55268ded976d863210", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3MmMzMjRiMjVlYmJiMDVkNWRlNGY1NTI2OGRlZDk3NmQ4NjMyMTA=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2017-09-28T11:26:15Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2017-10-02T13:45:46Z"}, "message": "incr.comp.: Build DepGraphQuery from new dep-graph impl.", "tree": {"sha": "ffcf162de578779f635783c027f978e226ebf2d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ffcf162de578779f635783c027f978e226ebf2d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/272c324b25ebbb05d5de4f55268ded976d863210", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/272c324b25ebbb05d5de4f55268ded976d863210", "html_url": "https://github.com/rust-lang/rust/commit/272c324b25ebbb05d5de4f55268ded976d863210", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/272c324b25ebbb05d5de4f55268ded976d863210/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6badfd449fa501c4565f93a1d8faee9d9d6c8df", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6badfd449fa501c4565f93a1d8faee9d9d6c8df", "html_url": "https://github.com/rust-lang/rust/commit/e6badfd449fa501c4565f93a1d8faee9d9d6c8df"}], "stats": {"total": 28, "additions": 14, "deletions": 14}, "files": [{"sha": "241bec39256de8255be072de1876304c356a1f62", "filename": "src/librustc/dep_graph/edges.rs", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc%2Fdep_graph%2Fedges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc%2Fdep_graph%2Fedges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fedges.rs?ref=272c324b25ebbb05d5de4f55268ded976d863210", "patch": "@@ -14,7 +14,7 @@ use rustc_data_structures::stable_hasher::StableHasher;\n use std::env;\n use std::hash::Hash;\n use std::mem;\n-use super::{DepGraphQuery, DepKind, DepNode};\n+use super::{DepKind, DepNode};\n use super::debug::EdgeFilter;\n \n pub(super) struct DepGraphEdges {\n@@ -89,10 +89,6 @@ impl DepGraphEdges {\n         }\n     }\n \n-    fn id(&self, index: DepNodeIndex) -> DepNode {\n-        self.nodes[index.index()]\n-    }\n-\n     pub fn push_ignore(&mut self) {\n         self.task_stack.push(OpenTask::Ignore);\n     }\n@@ -231,13 +227,6 @@ impl DepGraphEdges {\n         self.read(dep_node);\n     }\n \n-    pub fn query(&self) -> DepGraphQuery {\n-        let edges: Vec<_> = self.edges.iter()\n-                                      .map(|&(i, j)| (self.id(i), self.id(j)))\n-                                      .collect();\n-        DepGraphQuery::new(&self.nodes, &edges)\n-    }\n-\n     #[inline]\n     pub fn add_edge(&mut self, source: DepNode, target: DepNode) {\n         let source = self.get_or_create_node(source);"}, {"sha": "07e3fb45cc6b84f23246c0f05f94193142d747a0", "filename": "src/librustc/dep_graph/graph.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc%2Fdep_graph%2Fgraph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc%2Fdep_graph%2Fgraph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fgraph.rs?ref=272c324b25ebbb05d5de4f55268ded976d863210", "patch": "@@ -140,7 +140,18 @@ impl DepGraph {\n     }\n \n     pub fn query(&self) -> DepGraphQuery {\n-        self.data.as_ref().unwrap().edges.borrow().query()\n+        let current_dep_graph = self.data.as_ref().unwrap().current.borrow();\n+        let nodes: Vec<_> = current_dep_graph.nodes.iter().cloned().collect();\n+        let mut edges = Vec::new();\n+        for (index, edge_targets) in current_dep_graph.edges.iter_enumerated() {\n+            let from = current_dep_graph.nodes[index];\n+            for &edge_target in edge_targets {\n+                let to = current_dep_graph.nodes[edge_target];\n+                edges.push((from, to));\n+            }\n+        }\n+\n+        DepGraphQuery::new(&nodes[..], &edges[..])\n     }\n \n     pub fn in_ignore<'graph>(&'graph self) -> Option<raii::IgnoreTask<'graph>> {"}, {"sha": "acbd3e0d63ddedf387ab9ae620739668df62f1a0", "filename": "src/librustc_incremental/assert_dep_graph.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc_incremental%2Fassert_dep_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/272c324b25ebbb05d5de4f55268ded976d863210/src%2Flibrustc_incremental%2Fassert_dep_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fassert_dep_graph.rs?ref=272c324b25ebbb05d5de4f55268ded976d863210", "patch": "@@ -209,7 +209,7 @@ fn check_paths<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     }\n     let query = tcx.dep_graph.query();\n     for &(_, source_def_id, ref source_dep_node) in if_this_changed {\n-        let dependents = query.transitive_successors(source_dep_node);\n+        let dependents = query.transitive_predecessors(source_dep_node);\n         for &(target_span, ref target_pass, _, ref target_dep_node) in then_this_would_need {\n             if !dependents.contains(&target_dep_node) {\n                 tcx.sess.span_err("}]}