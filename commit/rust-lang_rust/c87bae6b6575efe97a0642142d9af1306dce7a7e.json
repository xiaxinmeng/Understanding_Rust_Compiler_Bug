{"sha": "c87bae6b6575efe97a0642142d9af1306dce7a7e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4N2JhZTZiNjU3NWVmZTk3YTA2NDIxNDJkOWFmMTMwNmRjZTdhN2U=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-15T23:59:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-15T23:59:52Z"}, "message": "Auto merge of #37758 - euclio:unstable, r=brson\n\ndo not use deprecated text for unstable docs\n\n![2016-11-13-18 55 23](https://cloud.githubusercontent.com/assets/1372438/20249943/d7f684a2-a9d2-11e6-8c5a-a2bfe354b9aa.png)\n![2016-11-13-18 55 12](https://cloud.githubusercontent.com/assets/1372438/20249942/d7f6595a-a9d2-11e6-9240-07f5a89367f4.png)\n\n![2016-11-13-18 54 00](https://cloud.githubusercontent.com/assets/1372438/20249946/da176d46-a9d2-11e6-8f34-c09cff9bcc15.png)\n![2016-11-13-18 54 45](https://cloud.githubusercontent.com/assets/1372438/20249941/d7d9837a-a9d2-11e6-99f4-e4bf8807b1c9.png)", "tree": {"sha": "7a5dabae1deb834aab022d52f84eaedd91a93fad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a5dabae1deb834aab022d52f84eaedd91a93fad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c87bae6b6575efe97a0642142d9af1306dce7a7e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c87bae6b6575efe97a0642142d9af1306dce7a7e", "html_url": "https://github.com/rust-lang/rust/commit/c87bae6b6575efe97a0642142d9af1306dce7a7e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c87bae6b6575efe97a0642142d9af1306dce7a7e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43006fcea0066a935b657fff9ccef56983cbf56c", "url": "https://api.github.com/repos/rust-lang/rust/commits/43006fcea0066a935b657fff9ccef56983cbf56c", "html_url": "https://github.com/rust-lang/rust/commit/43006fcea0066a935b657fff9ccef56983cbf56c"}, {"sha": "30f75e396a82d9c84372d14708822d68f7cd36b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/30f75e396a82d9c84372d14708822d68f7cd36b3", "html_url": "https://github.com/rust-lang/rust/commit/30f75e396a82d9c84372d14708822d68f7cd36b3"}], "stats": {"total": 42, "additions": 28, "deletions": 14}, "files": [{"sha": "4d70c64634fb03c1d99517deeac1a2f53054eee4", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=c87bae6b6575efe97a0642142d9af1306dce7a7e", "patch": "@@ -2890,7 +2890,8 @@ pub struct Stability {\n     pub feature: String,\n     pub since: String,\n     pub deprecated_since: String,\n-    pub reason: String,\n+    pub deprecated_reason: String,\n+    pub unstable_reason: String,\n     pub issue: Option<u32>\n }\n \n@@ -2913,12 +2914,13 @@ impl Clean<Stability> for attr::Stability {\n                 Some(attr::RustcDeprecation {ref since, ..}) => since.to_string(),\n                 _=> \"\".to_string(),\n             },\n-            reason: {\n-                match (&self.rustc_depr, &self.level) {\n-                    (&Some(ref depr), _) => depr.reason.to_string(),\n-                    (&None, &attr::Unstable {reason: Some(ref reason), ..}) => reason.to_string(),\n-                    _ => \"\".to_string(),\n-                }\n+            deprecated_reason: match self.rustc_depr {\n+                Some(ref depr) => depr.reason.to_string(),\n+                _ => \"\".to_string(),\n+            },\n+            unstable_reason: match self.level {\n+                attr::Unstable { reason: Some(ref reason), .. } => reason.to_string(),\n+                _ => \"\".to_string(),\n             },\n             issue: match self.level {\n                 attr::Unstable {issue, ..} => Some(issue),"}, {"sha": "90f954aa86abe0abaa73e621bffcfcb61aada5b2", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=c87bae6b6575efe97a0642142d9af1306dce7a7e", "patch": "@@ -1878,8 +1878,8 @@ fn short_stability(item: &clean::Item, cx: &Context, show_reason: bool) -> Vec<S\n     let mut stability = vec![];\n \n     if let Some(stab) = item.stability.as_ref() {\n-        let reason = if show_reason && !stab.reason.is_empty() {\n-            format!(\": {}\", stab.reason)\n+        let deprecated_reason = if show_reason && !stab.deprecated_reason.is_empty() {\n+            format!(\": {}\", stab.deprecated_reason)\n         } else {\n             String::new()\n         };\n@@ -1889,7 +1889,7 @@ fn short_stability(item: &clean::Item, cx: &Context, show_reason: bool) -> Vec<S\n             } else {\n                 String::new()\n             };\n-            let text = format!(\"Deprecated{}{}\", since, Markdown(&reason));\n+            let text = format!(\"Deprecated{}{}\", since, Markdown(&deprecated_reason));\n             stability.push(format!(\"<em class='stab deprecated'>{}</em>\", text))\n         };\n \n@@ -1909,7 +1909,12 @@ fn short_stability(item: &clean::Item, cx: &Context, show_reason: bool) -> Vec<S\n             } else {\n                 String::new()\n             };\n-            let text = format!(\"Unstable{}{}\", unstable_extra, Markdown(&reason));\n+            let unstable_reason = if show_reason && !stab.unstable_reason.is_empty() {\n+                format!(\": {}\", stab.unstable_reason)\n+            } else {\n+                String::new()\n+            };\n+            let text = format!(\"Unstable{}{}\", unstable_extra, Markdown(&unstable_reason));\n             stability.push(format!(\"<em class='stab unstable'>{}</em>\", text))\n         };\n     } else if let Some(depr) = item.deprecation.as_ref() {"}, {"sha": "2977e340a3c0c10b2e9f50320fc8a80f1ebe6692", "filename": "src/libsyntax/attr.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibsyntax%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Flibsyntax%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr.rs?ref=c87bae6b6575efe97a0642142d9af1306dce7a7e", "patch": "@@ -789,9 +789,6 @@ fn find_stability_generic<'a, I>(diagnostic: &Handler,\n     // Merge the deprecation info into the stability info\n     if let Some(rustc_depr) = rustc_depr {\n         if let Some(ref mut stab) = stab {\n-            if let Unstable {reason: ref mut reason @ None, ..} = stab.level {\n-                *reason = Some(rustc_depr.reason.clone())\n-            }\n             stab.rustc_depr = Some(rustc_depr);\n         } else {\n             span_err!(diagnostic, item_sp, E0549,"}, {"sha": "dea73317e5e3d144ca90feb4381e539abec69929", "filename": "src/test/rustdoc/issue-32374.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Ftest%2Frustdoc%2Fissue-32374.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c87bae6b6575efe97a0642142d9af1306dce7a7e/src%2Ftest%2Frustdoc%2Fissue-32374.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-32374.rs?ref=c87bae6b6575efe97a0642142d9af1306dce7a7e", "patch": "@@ -20,6 +20,16 @@\n //      'Deprecated since 1.0.0: text'\n // @has - '<code>test</code>'\n // @has - '<a href=\"http://issue_url/32374\">#32374</a>'\n+// @matches issue_32374/struct.T.html '//*[@class=\"stab unstable\"]' \\\n+//      'Unstable \\(test #32374\\)$'\n #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n #[unstable(feature = \"test\", issue = \"32374\")]\n pub struct T;\n+\n+// @has issue_32374/struct.U.html '//*[@class=\"stab deprecated\"]' \\\n+//      'Deprecated since 1.0.0: deprecated'\n+// @has issue_32374/struct.U.html '//*[@class=\"stab unstable\"]' \\\n+//      'Unstable (test #32374): unstable'\n+#[rustc_deprecated(since = \"1.0.0\", reason = \"deprecated\")]\n+#[unstable(feature = \"test\", issue = \"32374\", reason = \"unstable\")]\n+pub struct U;"}]}