{"sha": "d020565ed2d65efbd852aab298c4b8c69de75b12", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwMjA1NjVlZDJkNjVlZmJkODUyYWFiMjk4YzRiOGM2OWRlNzViMTI=", "commit": {"author": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-03-26T09:55:03Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-03-26T09:55:03Z"}, "message": "Hacky rustup", "tree": {"sha": "0e08f343c9ecef89e51bc531f24a8b6a2efb3b5b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e08f343c9ecef89e51bc531f24a8b6a2efb3b5b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d020565ed2d65efbd852aab298c4b8c69de75b12", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d020565ed2d65efbd852aab298c4b8c69de75b12", "html_url": "https://github.com/rust-lang/rust/commit/d020565ed2d65efbd852aab298c4b8c69de75b12", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d020565ed2d65efbd852aab298c4b8c69de75b12/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61aa5c957c219abe1fb2d1b5e51db8b365b4f565", "url": "https://api.github.com/repos/rust-lang/rust/commits/61aa5c957c219abe1fb2d1b5e51db8b365b4f565", "html_url": "https://github.com/rust-lang/rust/commit/61aa5c957c219abe1fb2d1b5e51db8b365b4f565"}], "stats": {"total": 214, "additions": 91, "deletions": 123}, "files": [{"sha": "3d36e52d2df81c2682da0c8d245a352d1625c805", "filename": "Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -47,7 +47,8 @@ rustc_tools_util = { version = \"0.1.1\", path = \"rustc_tools_util\"}\n [dev-dependencies]\n clippy_dev = { version = \"0.0.1\", path = \"clippy_dev\" }\n cargo_metadata = \"0.7.1\"\n-compiletest_rs = \"0.3.19\"\n+compiletest_rs = { version = \"=0.3.19\", features = [\"tmp\", \"stable\"] }\n+libtest = \"0.0.1\"\n lazy_static = \"1.0\"\n serde_derive = \"1.0\"\n clippy-mini-macro-test = { version = \"0.2\", path = \"mini-macro\" }"}, {"sha": "c054a00894e75ebcafe2d77cd91747236bf2ba50", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -208,8 +208,8 @@ impl LintPass for AttrPass {\n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for AttrPass {\n     fn check_attribute(&mut self, cx: &LateContext<'a, 'tcx>, attr: &'tcx Attribute) {\n         if let Some(items) = &attr.meta_item_list() {\n-            if let Some(ident) = attr.ident_str() {\n-                match ident {\n+            if let Some(ident) = attr.ident() {\n+                match &*ident.as_str() {\n                     \"allow\" | \"warn\" | \"deny\" | \"forbid\" => {\n                         check_clippy_lint_names(cx, items);\n                     },\n@@ -242,8 +242,8 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for AttrPass {\n \n                 for attr in &item.attrs {\n                     if let Some(lint_list) = &attr.meta_item_list() {\n-                        if let Some(ident) = attr.ident_str() {\n-                            match ident {\n+                        if let Some(ident) = attr.ident() {\n+                            match &*ident.as_str() {\n                                 \"allow\" | \"warn\" | \"deny\" | \"forbid\" => {\n                                     // whitelist `unused_imports` and `deprecated` for `use` items\n                                     // and `unused_imports` for `extern crate` items with `macro_use`"}, {"sha": "34cb2422e1c5e4f10744c79a4bad1e86d6d487e6", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -516,11 +516,11 @@ fn check_wild_enum_match(cx: &LateContext<'_, '_>, ex: &Expr, arms: &[Arm]) {\n             for pat in &arm.pats {\n                 if let PatKind::Path(ref path) = pat.deref().node {\n                     if let QPath::Resolved(_, p) = path {\n-                        missing_variants.retain(|e| e.did != p.def.def_id());\n+                        missing_variants.retain(|e| e.ctor_def_id != Some(p.def.def_id()));\n                     }\n                 } else if let PatKind::TupleStruct(ref path, ..) = pat.deref().node {\n                     if let QPath::Resolved(_, p) = path {\n-                        missing_variants.retain(|e| e.did != p.def.def_id());\n+                        missing_variants.retain(|e| e.ctor_def_id != Some(p.def.def_id()));\n                     }\n                 }\n             }\n@@ -539,7 +539,7 @@ fn check_wild_enum_match(cx: &LateContext<'_, '_>, ex: &Expr, arms: &[Arm]) {\n                     String::new()\n                 };\n                 // This path assumes that the enum type is imported into scope.\n-                format!(\"{}{}{}\", ident_str, cx.tcx.def_path_str(v.did), suffix)\n+                format!(\"{}{}{}\", ident_str, cx.tcx.def_path_str(v.def_id), suffix)\n             })\n             .collect();\n "}, {"sha": "721cfd870201b97011c2777c31b30f61ddf6b81f", "filename": "clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_doc.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -58,9 +58,9 @@ impl MissingDoc {\n             if let Some(meta) = meta;\n             if let MetaItemKind::List(list) = meta.node;\n             if let Some(meta) = list.get(0);\n-            if let Some(name) = meta.ident_str();\n+            if let Some(name) = meta.ident();\n             then {\n-                name == \"include\"\n+                name.as_str() == \"include\"\n             } else {\n                 false\n             }"}, {"sha": "c6b1b7eaf517a4669379d056e3b75d4a45bff25d", "filename": "clippy_lints/src/missing_inline.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmissing_inline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fmissing_inline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmissing_inline.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -162,12 +162,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MissingInline {\n         };\n \n         if let Some(trait_def_id) = trait_def_id {\n-            if cx.tcx.hir().as_local_node_id(trait_def_id).is_some() {\n-                if !cx.access_levels.is_exported(impl_item.hir_id) {\n-                    // If a trait is being implemented for an item, and the\n-                    // trait is not exported, we don't need #[inline]\n-                    return;\n-                }\n+            if cx.tcx.hir().as_local_node_id(trait_def_id).is_some() && !cx.access_levels.is_exported(impl_item.hir_id)\n+            {\n+                // If a trait is being implemented for an item, and the\n+                // trait is not exported, we don't need #[inline]\n+                return;\n             }\n         }\n "}, {"sha": "74a9b353ea97a516c6db31b877676a9c60572bdb", "filename": "clippy_lints/src/no_effect.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fno_effect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fno_effect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fno_effect.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -72,7 +72,7 @@ fn has_no_effect(cx: &LateContext<'_, '_>, expr: &Expr) -> bool {\n             if let ExprKind::Path(ref qpath) = callee.node {\n                 let def = cx.tables.qpath_def(qpath, callee.hir_id);\n                 match def {\n-                    Def::Struct(..) | Def::Variant(..) | Def::StructCtor(..) | Def::VariantCtor(..) => {\n+                    Def::Struct(..) | Def::Variant(..) | Def::Ctor(..) => {\n                         !has_drop(cx, cx.tables.expr_ty(expr)) && args.iter().all(|arg| has_no_effect(cx, arg))\n                     },\n                     _ => false,\n@@ -166,9 +166,7 @@ fn reduce_expression<'a>(cx: &LateContext<'_, '_>, expr: &'a Expr) -> Option<Vec\n             if let ExprKind::Path(ref qpath) = callee.node {\n                 let def = cx.tables.qpath_def(qpath, callee.hir_id);\n                 match def {\n-                    Def::Struct(..) | Def::Variant(..) | Def::StructCtor(..) | Def::VariantCtor(..)\n-                        if !has_drop(cx, cx.tables.expr_ty(expr)) =>\n-                    {\n+                    Def::Struct(..) | Def::Variant(..) | Def::Ctor(..) if !has_drop(cx, cx.tables.expr_ty(expr)) => {\n                         Some(args.iter().collect())\n                     },\n                     _ => None,"}, {"sha": "5c64cd1c15c7905d09979adb99517da54531a737", "filename": "clippy_lints/src/question_mark.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fquestion_mark.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -128,7 +128,7 @@ impl Pass {\n             },\n             ExprKind::Ret(Some(ref expr)) => Self::expression_returns_none(cx, expr),\n             ExprKind::Path(ref qp) => {\n-                if let Def::VariantCtor(def_id, _) = cx.tables.qpath_def(qp, expression.hir_id) {\n+                if let Def::Ctor(def_id, def::CtorOf::Variant, _) = cx.tables.qpath_def(qp, expression.hir_id) {\n                     return match_def_path(cx.tcx, def_id, &OPTION_NONE);\n                 }\n "}, {"sha": "87aeaf5210287819438a16555ef74d7bd36c88a1", "filename": "clippy_lints/src/ranges.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Franges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Franges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Franges.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -157,25 +157,31 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n             }) = higher::range(cx, expr);\n             if let Some(y) = y_plus_one(end);\n             then {\n+                let span = expr.span\n+                    .ctxt()\n+                    .outer()\n+                    .expn_info()\n+                    .map(|info| info.call_site)\n+                    .unwrap_or(expr.span);\n                 span_lint_and_then(\n                     cx,\n                     RANGE_PLUS_ONE,\n-                    expr.span,\n+                    span,\n                     \"an inclusive range would be more readable\",\n                     |db| {\n                         let start = start.map_or(String::new(), |x| Sugg::hir(cx, x, \"x\").to_string());\n                         let end = Sugg::hir(cx, y, \"y\");\n-                        if let Some(is_wrapped) = &snippet_opt(cx, expr.span) {\n+                        if let Some(is_wrapped) = &snippet_opt(cx, span) {\n                             if is_wrapped.starts_with('(') && is_wrapped.ends_with(')') {\n                                 db.span_suggestion(\n-                                    expr.span,\n+                                    span,\n                                     \"use\",\n                                     format!(\"({}..={})\", start, end),\n                                     Applicability::MaybeIncorrect,\n                                 );\n                             } else {\n                                 db.span_suggestion(\n-                                    expr.span,\n+                                    span,\n                                     \"use\",\n                                     format!(\"{}..={}\", start, end),\n                                     Applicability::MachineApplicable, // snippet"}, {"sha": "d3b011a3bd983fbba296d2f153f40f2df26c109e", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -233,7 +233,7 @@ impl<'a, 'tcx> Visitor<'tcx> for UseSelfVisitor<'a, 'tcx> {\n         if path.segments.last().expect(SEGMENTS_MSG).ident.name != SelfUpper.name() {\n             if self.item_path.def == path.def {\n                 span_use_self_lint(self.cx, path);\n-            } else if let Def::StructCtor(ctor_did, CtorKind::Fn) = path.def {\n+            } else if let Def::Ctor(ctor_did, def::CtorOf::Struct, CtorKind::Fn) = path.def {\n                 if self.item_path.def.opt_def_id() == self.cx.tcx.parent(ctor_did) {\n                     span_use_self_lint(self.cx, path);\n                 }"}, {"sha": "d70d3ff1239d01448e1ed0abb7a32d70809e4358", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -863,7 +863,7 @@ pub fn is_refutable(cx: &LateContext<'_, '_>, pat: &Pat) -> bool {\n     fn is_enum_variant(cx: &LateContext<'_, '_>, qpath: &QPath, id: HirId) -> bool {\n         matches!(\n             cx.tables.qpath_def(qpath, id),\n-            def::Def::Variant(..) | def::Def::VariantCtor(..)\n+            def::Def::Variant(..) | def::Def::Ctor(_, def::CtorOf::Variant, _)\n         )\n     }\n "}, {"sha": "9b8b2372c53bc38d8a1feb675fa0ab43871f13fa", "filename": "clippy_lints/src/vec.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/clippy_lints%2Fsrc%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fvec.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -59,6 +59,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n             then {\n                 // report the error around the `vec!` not inside `<std macros>:`\n                 let span = arg.span\n+                    .ctxt()\n+                    .outer()\n+                    .expn_info()\n+                    .map(|info| info.call_site)\n+                    .expect(\"unable to get call_site\")\n                     .ctxt()\n                     .outer()\n                     .expn_info()"}, {"sha": "37a33911d9e64a9674c8fde9109dad0f68f1421f", "filename": "tests/compile-test.rs", "status": "modified", "additions": 37, "deletions": 9, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -1,7 +1,7 @@\n #![feature(test)]\n \n use compiletest_rs as compiletest;\n-extern crate test;\n+use libtest::TestDescAndFn;\n \n use std::env::{set_var, var};\n use std::ffi::OsStr;\n@@ -74,15 +74,11 @@ fn run_mode(mode: &str, dir: PathBuf) {\n     compiletest::run_tests(&cfg);\n }\n \n-fn run_ui_toml_tests(config: &compiletest::Config, mut tests: Vec<test::TestDescAndFn>) -> Result<bool, io::Error> {\n+fn run_ui_toml_tests(config: &compiletest::Config, mut tests: Vec<TestDescAndFn>) -> Result<bool, io::Error> {\n     let mut result = true;\n     let opts = compiletest::test_opts(config);\n     for dir in fs::read_dir(&config.src_base)? {\n-        let dir = dir?;\n-        if !dir.file_type()?.is_dir() {\n-            continue;\n-        }\n-        let dir_path = dir.path();\n+        let dir_path = dir.unwrap().path();\n         set_var(\"CARGO_MANIFEST_DIR\", &dir_path);\n         for file in fs::read_dir(&dir_path)? {\n             let file = file?;\n@@ -101,9 +97,25 @@ fn run_ui_toml_tests(config: &compiletest::Config, mut tests: Vec<test::TestDesc\n             let test_name = compiletest::make_test_name(&config, &paths);\n             let index = tests\n                 .iter()\n-                .position(|test| test.desc.name == test_name)\n+                .position(|test| test.desc.name.to_string() == test_name.to_string())\n                 .expect(\"The test should be in there\");\n-            result &= test::run_tests_console(&opts, vec![tests.swap_remove(index)])?;\n+            let opts = libtest::TestOpts {\n+                list: opts.list.clone(),\n+                filter: opts.filter.clone(),\n+                filter_exact: opts.filter_exact.clone(),\n+                exclude_should_panic: Default::default(),\n+                run_ignored: libtest::RunIgnored::No,\n+                run_tests: opts.run_tests.clone(),\n+                bench_benchmarks: opts.bench_benchmarks.clone(),\n+                logfile: opts.logfile.clone(),\n+                nocapture: opts.nocapture,\n+                color: libtest::ColorConfig::AutoColor,\n+                format: libtest::OutputFormat::Pretty,\n+                test_threads: opts.test_threads,\n+                skip: opts.skip.clone(),\n+                options: libtest::Options::new(),\n+            };\n+            result &= libtest::run_tests_console(&opts, vec![tests.swap_remove(index)])?;\n         }\n     }\n     Ok(result)\n@@ -114,6 +126,22 @@ fn run_ui_toml() {\n     let config = config(\"ui\", path);\n     let tests = compiletest::make_tests(&config);\n \n+    let tests = tests\n+        .into_iter()\n+        .map(|test| {\n+            libtest::TestDescAndFn {\n+                desc: libtest::TestDesc {\n+                    name: libtest::TestName::DynTestName(test.desc.name.to_string()),\n+                    ignore: test.desc.ignore,\n+                    allow_fail: test.desc.allow_fail,\n+                    should_panic: libtest::ShouldPanic::No,\n+                },\n+                // oli obk giving up\n+                testfn: unsafe { std::mem::transmute(test.testfn) },\n+            }\n+        })\n+        .collect();\n+\n     let res = run_ui_toml_tests(&config, tests);\n     match res {\n         Ok(true) => {},"}, {"sha": "c1ad236148405e61f33455ae24492f991f60f7dc", "filename": "tests/ui/for_loop.stderr", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Ffor_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Ffor_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stderr?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -198,83 +198,83 @@ error: it is more concise to loop over references to containers instead of using\n   --> $DIR/for_loop.rs:170:15\n    |\n LL |     for _v in vec.iter() {}\n-   |               ^^^^^^^^^^ help: to write this more concisely, try: `&vec`\n+   |               ^^^^^^^^^^\n    |\n    = note: `-D clippy::explicit-iter-loop` implied by `-D warnings`\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:172:15\n    |\n LL |     for _v in vec.iter_mut() {}\n-   |               ^^^^^^^^^^^^^^ help: to write this more concisely, try: `&mut vec`\n+   |               ^^^^^^^^^^^^^^\n \n error: it is more concise to loop over containers instead of using explicit iteration methods`\n   --> $DIR/for_loop.rs:175:15\n    |\n LL |     for _v in out_vec.into_iter() {}\n-   |               ^^^^^^^^^^^^^^^^^^^ help: to write this more concisely, try: `out_vec`\n+   |               ^^^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::explicit-into-iter-loop` implied by `-D warnings`\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:178:15\n    |\n LL |     for _v in array.into_iter() {}\n-   |               ^^^^^^^^^^^^^^^^^ help: to write this more concisely, try: `&array`\n+   |               ^^^^^^^^^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:183:15\n    |\n LL |     for _v in [1, 2, 3].iter() {}\n-   |               ^^^^^^^^^^^^^^^^ help: to write this more concisely, try: `&[1, 2, 3]`\n+   |               ^^^^^^^^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:187:15\n    |\n LL |     for _v in [0; 32].iter() {}\n-   |               ^^^^^^^^^^^^^^ help: to write this more concisely, try: `&[0; 32]`\n+   |               ^^^^^^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:192:15\n    |\n LL |     for _v in ll.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&ll`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:195:15\n    |\n LL |     for _v in vd.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&vd`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:198:15\n    |\n LL |     for _v in bh.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&bh`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:201:15\n    |\n LL |     for _v in hm.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&hm`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:204:15\n    |\n LL |     for _v in bt.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&bt`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:207:15\n    |\n LL |     for _v in hs.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&hs`\n+   |               ^^^^^^^^^\n \n error: it is more concise to loop over references to containers instead of using explicit iteration methods\n   --> $DIR/for_loop.rs:210:15\n    |\n LL |     for _v in bs.iter() {}\n-   |               ^^^^^^^^^ help: to write this more concisely, try: `&bs`\n+   |               ^^^^^^^^^\n \n error: you are iterating over `Iterator::next()` which is an Option; this will compile but is probably not what you want\n   --> $DIR/for_loop.rs:212:15"}, {"sha": "659fd56f9a9d9bf7ae237dd06a98caa5c78427b7", "filename": "tests/ui/into_iter_on_ref.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Finto_iter_on_ref.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Finto_iter_on_ref.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.fixed?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -10,7 +10,7 @@ fn main() {\n     for _ in &[1, 2, 3] {}\n     for _ in vec![X, X] {}\n     for _ in &vec![X, X] {}\n-    for _ in [1, 2, 3].iter() {} //~ ERROR equivalent to .iter()\n+    for _ in [1, 2, 3].into_iter() {} //~ ERROR equivalent to .iter()\n \n     let _ = [1, 2, 3].iter(); //~ ERROR equivalent to .iter()\n     let _ = vec![1, 2, 3].into_iter();"}, {"sha": "c3e5c85618b8a3c0fb2d8d45128d68e73fe3e2b2", "filename": "tests/ui/into_iter_on_ref.stderr", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Finto_iter_on_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Finto_iter_on_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.stderr?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -1,21 +1,15 @@\n error: this .into_iter() call is equivalent to .iter() and will not move the array\n-  --> $DIR/into_iter_on_ref.rs:13:24\n+  --> $DIR/into_iter_on_ref.rs:15:23\n    |\n-LL |     for _ in [1, 2, 3].into_iter() {} //~ ERROR equivalent to .iter()\n-   |                        ^^^^^^^^^ help: call directly: `iter`\n+LL |     let _ = [1, 2, 3].into_iter(); //~ ERROR equivalent to .iter()\n+   |                       ^^^^^^^^^ help: call directly: `iter`\n    |\n note: lint level defined here\n   --> $DIR/into_iter_on_ref.rs:4:9\n    |\n LL | #![deny(clippy::into_iter_on_array)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: this .into_iter() call is equivalent to .iter() and will not move the array\n-  --> $DIR/into_iter_on_ref.rs:15:23\n-   |\n-LL |     let _ = [1, 2, 3].into_iter(); //~ ERROR equivalent to .iter()\n-   |                       ^^^^^^^^^ help: call directly: `iter`\n-\n error: this .into_iter() call is equivalent to .iter() and will not move the Vec\n   --> $DIR/into_iter_on_ref.rs:17:30\n    |\n@@ -174,5 +168,5 @@ error: this .into_iter() call is equivalent to .iter() and will not move the Pat\n LL |     let _ = std::path::PathBuf::from(\"12/34\").into_iter(); //~ ERROR equivalent to .iter()\n    |                                               ^^^^^^^^^ help: call directly: `iter`\n \n-error: aborting due to 28 previous errors\n+error: aborting due to 27 previous errors\n "}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "tests/ui/question_mark.stderr", "status": "modified", "additions": 0, "deletions": 63, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Fquestion_mark.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d020565ed2d65efbd852aab298c4b8c69de75b12/tests%2Fui%2Fquestion_mark.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fquestion_mark.stderr?ref=d020565ed2d65efbd852aab298c4b8c69de75b12", "patch": "@@ -1,63 +0,0 @@\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:2:5\n-   |\n-LL | /     if a.is_none() {\n-LL | |         return None;\n-LL | |     }\n-   | |_____^ help: replace_it_with: `a?;`\n-   |\n-   = note: `-D clippy::question-mark` implied by `-D warnings`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:47:9\n-   |\n-LL | /         if (self.opt).is_none() {\n-LL | |             return None;\n-LL | |         }\n-   | |_________^ help: replace_it_with: `(self.opt)?;`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:51:9\n-   |\n-LL | /         if self.opt.is_none() {\n-LL | |             return None\n-LL | |         }\n-   | |_________^ help: replace_it_with: `self.opt?;`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:55:17\n-   |\n-LL |           let _ = if self.opt.is_none() {\n-   |  _________________^\n-LL | |             return None;\n-LL | |         } else {\n-LL | |             self.opt\n-LL | |         };\n-   | |_________^ help: replace_it_with: `Some(self.opt?)`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:72:9\n-   |\n-LL | /         if self.opt.is_none() {\n-LL | |             return None;\n-LL | |         }\n-   | |_________^ help: replace_it_with: `self.opt.as_ref()?;`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:80:9\n-   |\n-LL | /         if self.opt.is_none() {\n-LL | |             return None;\n-LL | |         }\n-   | |_________^ help: replace_it_with: `self.opt.as_ref()?;`\n-\n-error: this block may be rewritten with the `?` operator\n-  --> $DIR/question_mark.rs:88:9\n-   |\n-LL | /         if self.opt.is_none() {\n-LL | |             return None;\n-LL | |         }\n-   | |_________^ help: replace_it_with: `self.opt.as_ref()?;`\n-\n-error: aborting due to 7 previous errors\n-"}]}