{"sha": "871b8b5d4c980462ad4b665ee17157de0fab9da2", "node_id": "C_kwDOAAsO6NoAKDg3MWI4YjVkNGM5ODA0NjJhZDRiNjY1ZWUxNzE1N2RlMGZhYjlkYTI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-06T07:38:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-06T07:38:38Z"}, "message": "Auto merge of #7773 - Manishearth:update-lints-mods, r=flip1995\n\nMove module declarations back into lib.rs\n\nWith #7673 we moved a lot of things from lib.rs to lib.foo.rs. Unfortunately, rustfmt doesn't seem to work when module declarations are included via `include!` (and trying the `mod foo; use foo::*;` trick doesn't seem to work much either in our specific case).\n\nWith this PR we continue generating everything in subfiles except for module declarations, which are now generated within lib.rs.\n\nchangelog: none", "tree": {"sha": "53e959f61b1693a7e466eb647f79a4f160ca1d03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53e959f61b1693a7e466eb647f79a4f160ca1d03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/871b8b5d4c980462ad4b665ee17157de0fab9da2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/871b8b5d4c980462ad4b665ee17157de0fab9da2", "html_url": "https://github.com/rust-lang/rust/commit/871b8b5d4c980462ad4b665ee17157de0fab9da2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/871b8b5d4c980462ad4b665ee17157de0fab9da2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9dedf395918275aa09710d2f51f62a1285bc035", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9dedf395918275aa09710d2f51f62a1285bc035", "html_url": "https://github.com/rust-lang/rust/commit/b9dedf395918275aa09710d2f51f62a1285bc035"}, {"sha": "d9488c50ce64d09c6f598e4a3c7a5566faff3b11", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9488c50ce64d09c6f598e4a3c7a5566faff3b11", "html_url": "https://github.com/rust-lang/rust/commit/d9488c50ce64d09c6f598e4a3c7a5566faff3b11"}], "stats": {"total": 488, "additions": 248, "deletions": 240}, "files": [{"sha": "6ec812909f2b59713f03058c79a4bca8196d5128", "filename": "clippy_dev/src/update_lints.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/871b8b5d4c980462ad4b665ee17157de0fab9da2/clippy_dev%2Fsrc%2Fupdate_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/871b8b5d4c980462ad4b665ee17157de0fab9da2/clippy_dev%2Fsrc%2Fupdate_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fupdate_lints.rs?ref=871b8b5d4c980462ad4b665ee17157de0fab9da2", "patch": "@@ -98,6 +98,17 @@ pub fn run(update_mode: UpdateMode) {\n     )\n     .changed;\n \n+    // This has to be in lib.rs, otherwise rustfmt doesn't work\n+    file_change |= replace_region_in_file(\n+        Path::new(\"clippy_lints/src/lib.rs\"),\n+        \"begin lints modules\",\n+        \"end lints modules\",\n+        false,\n+        update_mode == UpdateMode::Change,\n+        || vec![gen_modules_list(usable_lints.iter())],\n+    )\n+    .changed;\n+\n     if file_change && update_mode == UpdateMode::Check {\n         exit_with_failure();\n     }\n@@ -112,11 +123,6 @@ pub fn run(update_mode: UpdateMode) {\n         update_mode,\n         &gen_deprecated(deprecated_lints.iter()),\n     );\n-    process_file(\n-        \"clippy_lints/src/lib.mods.rs\",\n-        update_mode,\n-        &gen_modules_list(usable_lints.iter()),\n-    );\n \n     let all_group_lints = usable_lints.iter().filter(|l| {\n         matches!("}, {"sha": "8e899553e69ca6f81486e0ba162efa8e0cd7c860", "filename": "clippy_lints/src/lib.mods.rs", "status": "removed", "additions": 0, "deletions": 234, "changes": 234, "blob_url": "https://github.com/rust-lang/rust/blob/b9dedf395918275aa09710d2f51f62a1285bc035/clippy_lints%2Fsrc%2Flib.mods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9dedf395918275aa09710d2f51f62a1285bc035/clippy_lints%2Fsrc%2Flib.mods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.mods.rs?ref=b9dedf395918275aa09710d2f51f62a1285bc035", "patch": "@@ -1,234 +0,0 @@\n-// This file was generated by `cargo dev update_lints`.\n-// Use that command to update this file and do not edit by hand.\n-// Manual edits will be overwritten.\n-\n-mod absurd_extreme_comparisons;\n-mod approx_const;\n-mod arithmetic;\n-mod as_conversions;\n-mod asm_syntax;\n-mod assertions_on_constants;\n-mod assign_ops;\n-mod async_yields_async;\n-mod attrs;\n-mod await_holding_invalid;\n-mod bit_mask;\n-mod blacklisted_name;\n-mod blocks_in_if_conditions;\n-mod bool_assert_comparison;\n-mod booleans;\n-mod bytecount;\n-mod cargo_common_metadata;\n-mod case_sensitive_file_extension_comparisons;\n-mod casts;\n-mod checked_conversions;\n-mod cognitive_complexity;\n-mod collapsible_if;\n-mod collapsible_match;\n-mod comparison_chain;\n-mod copies;\n-mod copy_iterator;\n-mod create_dir;\n-mod dbg_macro;\n-mod default;\n-mod default_numeric_fallback;\n-mod dereference;\n-mod derivable_impls;\n-mod derive;\n-mod disallowed_method;\n-mod disallowed_script_idents;\n-mod disallowed_type;\n-mod doc;\n-mod double_comparison;\n-mod double_parens;\n-mod drop_forget_ref;\n-mod duration_subsec;\n-mod else_if_without_else;\n-mod empty_enum;\n-mod entry;\n-mod enum_clike;\n-mod enum_variants;\n-mod eq_op;\n-mod equatable_if_let;\n-mod erasing_op;\n-mod escape;\n-mod eta_reduction;\n-mod eval_order_dependence;\n-mod excessive_bools;\n-mod exhaustive_items;\n-mod exit;\n-mod explicit_write;\n-mod fallible_impl_from;\n-mod feature_name;\n-mod float_equality_without_abs;\n-mod float_literal;\n-mod floating_point_arithmetic;\n-mod format;\n-mod formatting;\n-mod from_over_into;\n-mod from_str_radix_10;\n-mod functions;\n-mod future_not_send;\n-mod get_last_with_len;\n-mod identity_op;\n-mod if_let_mutex;\n-mod if_not_else;\n-mod if_then_panic;\n-mod if_then_some_else_none;\n-mod implicit_hasher;\n-mod implicit_return;\n-mod implicit_saturating_sub;\n-mod inconsistent_struct_constructor;\n-mod indexing_slicing;\n-mod infinite_iter;\n-mod inherent_impl;\n-mod inherent_to_string;\n-mod inline_fn_without_body;\n-mod int_plus_one;\n-mod integer_division;\n-mod invalid_upcast_comparisons;\n-mod items_after_statements;\n-mod iter_not_returning_iterator;\n-mod large_const_arrays;\n-mod large_enum_variant;\n-mod large_stack_arrays;\n-mod len_zero;\n-mod let_if_seq;\n-mod let_underscore;\n-mod lifetimes;\n-mod literal_representation;\n-mod loops;\n-mod macro_use;\n-mod main_recursion;\n-mod manual_async_fn;\n-mod manual_map;\n-mod manual_non_exhaustive;\n-mod manual_ok_or;\n-mod manual_strip;\n-mod manual_unwrap_or;\n-mod map_clone;\n-mod map_err_ignore;\n-mod map_unit_fn;\n-mod match_on_vec_items;\n-mod match_result_ok;\n-mod matches;\n-mod mem_discriminant;\n-mod mem_forget;\n-mod mem_replace;\n-mod methods;\n-mod minmax;\n-mod misc;\n-mod misc_early;\n-mod missing_const_for_fn;\n-mod missing_doc;\n-mod missing_enforced_import_rename;\n-mod missing_inline;\n-mod module_style;\n-mod modulo_arithmetic;\n-mod multiple_crate_versions;\n-mod mut_key;\n-mod mut_mut;\n-mod mut_mutex_lock;\n-mod mut_reference;\n-mod mutable_debug_assertion;\n-mod mutex_atomic;\n-mod needless_arbitrary_self_type;\n-mod needless_bitwise_bool;\n-mod needless_bool;\n-mod needless_borrow;\n-mod needless_borrowed_ref;\n-mod needless_continue;\n-mod needless_for_each;\n-mod needless_option_as_deref;\n-mod needless_pass_by_value;\n-mod needless_question_mark;\n-mod needless_update;\n-mod neg_cmp_op_on_partial_ord;\n-mod neg_multiply;\n-mod new_without_default;\n-mod no_effect;\n-mod non_copy_const;\n-mod non_expressive_names;\n-mod non_octal_unix_permissions;\n-mod non_send_fields_in_send_ty;\n-mod nonstandard_macro_braces;\n-mod open_options;\n-mod option_env_unwrap;\n-mod option_if_let_else;\n-mod overflow_check_conditional;\n-mod panic_in_result_fn;\n-mod panic_unimplemented;\n-mod partialeq_ne_impl;\n-mod pass_by_ref_or_value;\n-mod path_buf_push_overwrite;\n-mod pattern_type_mismatch;\n-mod precedence;\n-mod ptr;\n-mod ptr_eq;\n-mod ptr_offset_with_cast;\n-mod question_mark;\n-mod ranges;\n-mod redundant_clone;\n-mod redundant_closure_call;\n-mod redundant_else;\n-mod redundant_field_names;\n-mod redundant_pub_crate;\n-mod redundant_slicing;\n-mod redundant_static_lifetimes;\n-mod ref_option_ref;\n-mod reference;\n-mod regex;\n-mod repeat_once;\n-mod returns;\n-mod same_name_method;\n-mod self_assignment;\n-mod self_named_constructors;\n-mod semicolon_if_nothing_returned;\n-mod serde_api;\n-mod shadow;\n-mod single_component_path_imports;\n-mod size_of_in_element_count;\n-mod slow_vector_initialization;\n-mod stable_sort_primitive;\n-mod strings;\n-mod strlen_on_c_strings;\n-mod suspicious_operation_groupings;\n-mod suspicious_trait_impl;\n-mod swap;\n-mod tabs_in_doc_comments;\n-mod temporary_assignment;\n-mod to_digit_is_some;\n-mod to_string_in_display;\n-mod trait_bounds;\n-mod transmute;\n-mod transmuting_null;\n-mod try_err;\n-mod types;\n-mod undropped_manually_drops;\n-mod unicode;\n-mod unit_return_expecting_ord;\n-mod unit_types;\n-mod unnamed_address;\n-mod unnecessary_self_imports;\n-mod unnecessary_sort_by;\n-mod unnecessary_wraps;\n-mod unnested_or_patterns;\n-mod unsafe_removed_from_name;\n-mod unused_async;\n-mod unused_io_amount;\n-mod unused_self;\n-mod unused_unit;\n-mod unwrap;\n-mod unwrap_in_result;\n-mod upper_case_acronyms;\n-mod use_self;\n-mod useless_conversion;\n-mod vec;\n-mod vec_init_then_push;\n-mod vec_resize_to_zero;\n-mod verbose_file_reads;\n-mod wildcard_dependencies;\n-mod wildcard_imports;\n-mod write;\n-mod zero_div_zero;\n-mod zero_sized_map_values;"}, {"sha": "c2376575cb81da30ceb9e4437be9f9854bd864a7", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 237, "deletions": 1, "changes": 238, "blob_url": "https://github.com/rust-lang/rust/blob/871b8b5d4c980462ad4b665ee17157de0fab9da2/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/871b8b5d4c980462ad4b665ee17157de0fab9da2/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=871b8b5d4c980462ad4b665ee17157de0fab9da2", "patch": "@@ -155,7 +155,243 @@ macro_rules! declare_clippy_lint {\n mod deprecated_lints;\n mod utils;\n \n-include!(\"lib.mods.rs\");\n+// begin lints modules, do not remove this comment, it\u2019s used in `update_lints`\n+// This file was generated by `cargo dev update_lints`.\n+// Use that command to update this file and do not edit by hand.\n+// Manual edits will be overwritten.\n+\n+mod absurd_extreme_comparisons;\n+mod approx_const;\n+mod arithmetic;\n+mod as_conversions;\n+mod asm_syntax;\n+mod assertions_on_constants;\n+mod assign_ops;\n+mod async_yields_async;\n+mod attrs;\n+mod await_holding_invalid;\n+mod bit_mask;\n+mod blacklisted_name;\n+mod blocks_in_if_conditions;\n+mod bool_assert_comparison;\n+mod booleans;\n+mod bytecount;\n+mod cargo_common_metadata;\n+mod case_sensitive_file_extension_comparisons;\n+mod casts;\n+mod checked_conversions;\n+mod cognitive_complexity;\n+mod collapsible_if;\n+mod collapsible_match;\n+mod comparison_chain;\n+mod copies;\n+mod copy_iterator;\n+mod create_dir;\n+mod dbg_macro;\n+mod default;\n+mod default_numeric_fallback;\n+mod dereference;\n+mod derivable_impls;\n+mod derive;\n+mod disallowed_method;\n+mod disallowed_script_idents;\n+mod disallowed_type;\n+mod doc;\n+mod double_comparison;\n+mod double_parens;\n+mod drop_forget_ref;\n+mod duration_subsec;\n+mod else_if_without_else;\n+mod empty_enum;\n+mod entry;\n+mod enum_clike;\n+mod enum_variants;\n+mod eq_op;\n+mod equatable_if_let;\n+mod erasing_op;\n+mod escape;\n+mod eta_reduction;\n+mod eval_order_dependence;\n+mod excessive_bools;\n+mod exhaustive_items;\n+mod exit;\n+mod explicit_write;\n+mod fallible_impl_from;\n+mod feature_name;\n+mod float_equality_without_abs;\n+mod float_literal;\n+mod floating_point_arithmetic;\n+mod format;\n+mod formatting;\n+mod from_over_into;\n+mod from_str_radix_10;\n+mod functions;\n+mod future_not_send;\n+mod get_last_with_len;\n+mod identity_op;\n+mod if_let_mutex;\n+mod if_not_else;\n+mod if_then_panic;\n+mod if_then_some_else_none;\n+mod implicit_hasher;\n+mod implicit_return;\n+mod implicit_saturating_sub;\n+mod inconsistent_struct_constructor;\n+mod indexing_slicing;\n+mod infinite_iter;\n+mod inherent_impl;\n+mod inherent_to_string;\n+mod inline_fn_without_body;\n+mod int_plus_one;\n+mod integer_division;\n+mod invalid_upcast_comparisons;\n+mod items_after_statements;\n+mod iter_not_returning_iterator;\n+mod large_const_arrays;\n+mod large_enum_variant;\n+mod large_stack_arrays;\n+mod len_zero;\n+mod let_if_seq;\n+mod let_underscore;\n+mod lifetimes;\n+mod literal_representation;\n+mod loops;\n+mod macro_use;\n+mod main_recursion;\n+mod manual_async_fn;\n+mod manual_map;\n+mod manual_non_exhaustive;\n+mod manual_ok_or;\n+mod manual_strip;\n+mod manual_unwrap_or;\n+mod map_clone;\n+mod map_err_ignore;\n+mod map_unit_fn;\n+mod match_on_vec_items;\n+mod match_result_ok;\n+mod matches;\n+mod mem_discriminant;\n+mod mem_forget;\n+mod mem_replace;\n+mod methods;\n+mod minmax;\n+mod misc;\n+mod misc_early;\n+mod missing_const_for_fn;\n+mod missing_doc;\n+mod missing_enforced_import_rename;\n+mod missing_inline;\n+mod module_style;\n+mod modulo_arithmetic;\n+mod multiple_crate_versions;\n+mod mut_key;\n+mod mut_mut;\n+mod mut_mutex_lock;\n+mod mut_reference;\n+mod mutable_debug_assertion;\n+mod mutex_atomic;\n+mod needless_arbitrary_self_type;\n+mod needless_bitwise_bool;\n+mod needless_bool;\n+mod needless_borrow;\n+mod needless_borrowed_ref;\n+mod needless_continue;\n+mod needless_for_each;\n+mod needless_option_as_deref;\n+mod needless_pass_by_value;\n+mod needless_question_mark;\n+mod needless_update;\n+mod neg_cmp_op_on_partial_ord;\n+mod neg_multiply;\n+mod new_without_default;\n+mod no_effect;\n+mod non_copy_const;\n+mod non_expressive_names;\n+mod non_octal_unix_permissions;\n+mod non_send_fields_in_send_ty;\n+mod nonstandard_macro_braces;\n+mod open_options;\n+mod option_env_unwrap;\n+mod option_if_let_else;\n+mod overflow_check_conditional;\n+mod panic_in_result_fn;\n+mod panic_unimplemented;\n+mod partialeq_ne_impl;\n+mod pass_by_ref_or_value;\n+mod path_buf_push_overwrite;\n+mod pattern_type_mismatch;\n+mod precedence;\n+mod ptr;\n+mod ptr_eq;\n+mod ptr_offset_with_cast;\n+mod question_mark;\n+mod ranges;\n+mod redundant_clone;\n+mod redundant_closure_call;\n+mod redundant_else;\n+mod redundant_field_names;\n+mod redundant_pub_crate;\n+mod redundant_slicing;\n+mod redundant_static_lifetimes;\n+mod ref_option_ref;\n+mod reference;\n+mod regex;\n+mod repeat_once;\n+mod returns;\n+mod same_name_method;\n+mod self_assignment;\n+mod self_named_constructors;\n+mod semicolon_if_nothing_returned;\n+mod serde_api;\n+mod shadow;\n+mod single_component_path_imports;\n+mod size_of_in_element_count;\n+mod slow_vector_initialization;\n+mod stable_sort_primitive;\n+mod strings;\n+mod strlen_on_c_strings;\n+mod suspicious_operation_groupings;\n+mod suspicious_trait_impl;\n+mod swap;\n+mod tabs_in_doc_comments;\n+mod temporary_assignment;\n+mod to_digit_is_some;\n+mod to_string_in_display;\n+mod trait_bounds;\n+mod transmute;\n+mod transmuting_null;\n+mod try_err;\n+mod types;\n+mod undropped_manually_drops;\n+mod unicode;\n+mod unit_return_expecting_ord;\n+mod unit_types;\n+mod unnamed_address;\n+mod unnecessary_self_imports;\n+mod unnecessary_sort_by;\n+mod unnecessary_wraps;\n+mod unnested_or_patterns;\n+mod unsafe_removed_from_name;\n+mod unused_async;\n+mod unused_io_amount;\n+mod unused_self;\n+mod unused_unit;\n+mod unwrap;\n+mod unwrap_in_result;\n+mod upper_case_acronyms;\n+mod use_self;\n+mod useless_conversion;\n+mod vec;\n+mod vec_init_then_push;\n+mod vec_resize_to_zero;\n+mod verbose_file_reads;\n+mod wildcard_dependencies;\n+mod wildcard_imports;\n+mod write;\n+mod zero_div_zero;\n+mod zero_sized_map_values;\n+\n+// end lints modules, do not remove this comment, it\u2019s used in `update_lints`\n \n pub use crate::utils::conf::Conf;\n use crate::utils::conf::TryConf;"}]}