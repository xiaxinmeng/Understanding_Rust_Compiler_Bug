{"sha": "3264c836bbbbf9d62bc088443ca844709f8746a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyNjRjODM2YmJiYmY5ZDYyYmMwODg0NDNjYTg0NDcwOWY4NzQ2YTE=", "commit": {"author": {"name": "Matt", "email": "undecidabot@gmail.com", "date": "2017-10-03T16:55:57Z"}, "committer": {"name": "Matt", "email": "undecidabot@gmail.com", "date": "2017-10-03T17:04:15Z"}, "message": "Optimize comparison functions of Iterator\n\nReplaced matching on tuples which led to less performant code generation.", "tree": {"sha": "c99c76c0e238d87c5ad8d91a9e00cdcf03d2923b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c99c76c0e238d87c5ad8d91a9e00cdcf03d2923b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3264c836bbbbf9d62bc088443ca844709f8746a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3264c836bbbbf9d62bc088443ca844709f8746a1", "html_url": "https://github.com/rust-lang/rust/commit/3264c836bbbbf9d62bc088443ca844709f8746a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3264c836bbbbf9d62bc088443ca844709f8746a1/comments", "author": {"login": "lezgomatt", "id": 16533424, "node_id": "MDQ6VXNlcjE2NTMzNDI0", "avatar_url": "https://avatars.githubusercontent.com/u/16533424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lezgomatt", "html_url": "https://github.com/lezgomatt", "followers_url": "https://api.github.com/users/lezgomatt/followers", "following_url": "https://api.github.com/users/lezgomatt/following{/other_user}", "gists_url": "https://api.github.com/users/lezgomatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/lezgomatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lezgomatt/subscriptions", "organizations_url": "https://api.github.com/users/lezgomatt/orgs", "repos_url": "https://api.github.com/users/lezgomatt/repos", "events_url": "https://api.github.com/users/lezgomatt/events{/privacy}", "received_events_url": "https://api.github.com/users/lezgomatt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lezgomatt", "id": 16533424, "node_id": "MDQ6VXNlcjE2NTMzNDI0", "avatar_url": "https://avatars.githubusercontent.com/u/16533424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lezgomatt", "html_url": "https://github.com/lezgomatt", "followers_url": "https://api.github.com/users/lezgomatt/followers", "following_url": "https://api.github.com/users/lezgomatt/following{/other_user}", "gists_url": "https://api.github.com/users/lezgomatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/lezgomatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lezgomatt/subscriptions", "organizations_url": "https://api.github.com/users/lezgomatt/orgs", "repos_url": "https://api.github.com/users/lezgomatt/repos", "events_url": "https://api.github.com/users/lezgomatt/events{/privacy}", "received_events_url": "https://api.github.com/users/lezgomatt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8891044e89a22eeed1fcea957140072c26fcc62e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8891044e89a22eeed1fcea957140072c26fcc62e", "html_url": "https://github.com/rust-lang/rust/commit/8891044e89a22eeed1fcea957140072c26fcc62e"}], "stats": {"total": 186, "additions": 114, "deletions": 72}, "files": [{"sha": "79767b37601f8e91c55d8b1a3f34dd95cda7ced1", "filename": "src/libcore/iter/iterator.rs", "status": "modified", "additions": 114, "deletions": 72, "changes": 186, "blob_url": "https://github.com/rust-lang/rust/blob/3264c836bbbbf9d62bc088443ca844709f8746a1/src%2Flibcore%2Fiter%2Fiterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3264c836bbbbf9d62bc088443ca844709f8746a1/src%2Flibcore%2Fiter%2Fiterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Fiterator.rs?ref=3264c836bbbbf9d62bc088443ca844709f8746a1", "patch": "@@ -2059,14 +2059,23 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return Ordering::Equal,\n-                (None, _   ) => return Ordering::Less,\n-                (_   , None) => return Ordering::Greater,\n-                (Some(x), Some(y)) => match x.cmp(&y) {\n-                    Ordering::Equal => (),\n-                    non_eq => return non_eq,\n+            let x = match self.next() {\n+                None => if other.next().is_none() {\n+                    return Ordering::Equal\n+                } else {\n+                    return Ordering::Less\n                 },\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return Ordering::Greater,\n+                Some(val) => val,\n+            };\n+\n+            match x.cmp(&y) {\n+                Ordering::Equal => (),\n+                non_eq => return non_eq,\n             }\n         }\n     }\n@@ -2082,14 +2091,23 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return Some(Ordering::Equal),\n-                (None, _   ) => return Some(Ordering::Less),\n-                (_   , None) => return Some(Ordering::Greater),\n-                (Some(x), Some(y)) => match x.partial_cmp(&y) {\n-                    Some(Ordering::Equal) => (),\n-                    non_eq => return non_eq,\n+            let x = match self.next() {\n+                None => if other.next().is_none() {\n+                    return Some(Ordering::Equal)\n+                } else {\n+                    return Some(Ordering::Less)\n                 },\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return Some(Ordering::Greater),\n+                Some(val) => val,\n+            };\n+\n+            match x.partial_cmp(&y) {\n+                Some(Ordering::Equal) => (),\n+                non_eq => return non_eq,\n             }\n         }\n     }\n@@ -2105,11 +2123,17 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return true,\n-                (None, _) | (_, None) => return false,\n-                (Some(x), Some(y)) => if x != y { return false },\n-            }\n+            let x = match self.next() {\n+                None => return other.next().is_none(),\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return false,\n+                Some(val) => val,\n+            };\n+\n+            if x != y { return false }\n         }\n     }\n \n@@ -2124,11 +2148,17 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return false,\n-                (None, _) | (_, None) => return true,\n-                (Some(x), Some(y)) => if x.ne(&y) { return true },\n-            }\n+            let x = match self.next() {\n+                None => return other.next().is_some(),\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return true,\n+                Some(val) => val,\n+            };\n+\n+            if x != y { return true }\n         }\n     }\n \n@@ -2143,18 +2173,21 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return false,\n-                (None, _   ) => return true,\n-                (_   , None) => return false,\n-                (Some(x), Some(y)) => {\n-                    match x.partial_cmp(&y) {\n-                        Some(Ordering::Less) => return true,\n-                        Some(Ordering::Equal) => {}\n-                        Some(Ordering::Greater) => return false,\n-                        None => return false,\n-                    }\n-                },\n+            let x = match self.next() {\n+                None => return other.next().is_some(),\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return false,\n+                Some(val) => val,\n+            };\n+\n+            match x.partial_cmp(&y) {\n+                Some(Ordering::Less) => return true,\n+                Some(Ordering::Equal) => (),\n+                Some(Ordering::Greater) => return false,\n+                None => return false,\n             }\n         }\n     }\n@@ -2170,18 +2203,21 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return true,\n-                (None, _   ) => return true,\n-                (_   , None) => return false,\n-                (Some(x), Some(y)) => {\n-                    match x.partial_cmp(&y) {\n-                        Some(Ordering::Less) => return true,\n-                        Some(Ordering::Equal) => {}\n-                        Some(Ordering::Greater) => return false,\n-                        None => return false,\n-                    }\n-                },\n+            let x = match self.next() {\n+                None => { other.next(); return true; },\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return false,\n+                Some(val) => val,\n+            };\n+\n+            match x.partial_cmp(&y) {\n+                Some(Ordering::Less) => return true,\n+                Some(Ordering::Equal) => (),\n+                Some(Ordering::Greater) => return false,\n+                None => return false,\n             }\n         }\n     }\n@@ -2197,18 +2233,21 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return false,\n-                (None, _   ) => return false,\n-                (_   , None) => return true,\n-                (Some(x), Some(y)) => {\n-                    match x.partial_cmp(&y) {\n-                        Some(Ordering::Less) => return false,\n-                        Some(Ordering::Equal) => {}\n-                        Some(Ordering::Greater) => return true,\n-                        None => return false,\n-                    }\n-                }\n+            let x = match self.next() {\n+                None => { other.next(); return false; },\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return true,\n+                Some(val) => val,\n+            };\n+\n+            match x.partial_cmp(&y) {\n+                Some(Ordering::Less) => return false,\n+                Some(Ordering::Equal) => (),\n+                Some(Ordering::Greater) => return true,\n+                None => return false,\n             }\n         }\n     }\n@@ -2224,18 +2263,21 @@ pub trait Iterator {\n         let mut other = other.into_iter();\n \n         loop {\n-            match (self.next(), other.next()) {\n-                (None, None) => return true,\n-                (None, _   ) => return false,\n-                (_   , None) => return true,\n-                (Some(x), Some(y)) => {\n-                    match x.partial_cmp(&y) {\n-                        Some(Ordering::Less) => return false,\n-                        Some(Ordering::Equal) => {}\n-                        Some(Ordering::Greater) => return true,\n-                        None => return false,\n-                    }\n-                },\n+            let x = match self.next() {\n+                None => return other.next().is_none(),\n+                Some(val) => val,\n+            };\n+\n+            let y = match other.next() {\n+                None => return true,\n+                Some(val) => val,\n+            };\n+\n+            match x.partial_cmp(&y) {\n+                Some(Ordering::Less) => return false,\n+                Some(Ordering::Equal) => (),\n+                Some(Ordering::Greater) => return true,\n+                None => return false,\n             }\n         }\n     }"}]}