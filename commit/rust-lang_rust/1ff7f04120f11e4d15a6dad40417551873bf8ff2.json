{"sha": "1ff7f04120f11e4d15a6dad40417551873bf8ff2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFmZjdmMDQxMjBmMTFlNGQxNWE2ZGFkNDA0MTc1NTE4NzNiZjhmZjI=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-06-30T22:27:44Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-07-05T15:18:45Z"}, "message": "Fix rustdoc run failures by shutting down definitely some lints", "tree": {"sha": "a0f919231e898d9fd5d324f8ce51cc567cebd584", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0f919231e898d9fd5d324f8ce51cc567cebd584"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ff7f04120f11e4d15a6dad40417551873bf8ff2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ff7f04120f11e4d15a6dad40417551873bf8ff2", "html_url": "https://github.com/rust-lang/rust/commit/1ff7f04120f11e4d15a6dad40417551873bf8ff2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ff7f04120f11e4d15a6dad40417551873bf8ff2/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94eb1760551096363ec04e42367b6b195592dbd8", "url": "https://api.github.com/repos/rust-lang/rust/commits/94eb1760551096363ec04e42367b6b195592dbd8", "html_url": "https://github.com/rust-lang/rust/commit/94eb1760551096363ec04e42367b6b195592dbd8"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "f8676a3e7a11370b28a021f0df86824ec9a1c34d", "filename": "src/librustc/lint/levels.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustc%2Flint%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustc%2Flint%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Flevels.rs?ref=1ff7f04120f11e4d15a6dad40417551873bf8ff2", "patch": "@@ -118,6 +118,11 @@ impl LintLevelSets {\n         // Ensure that we never exceed the `--cap-lints` argument.\n         level = cmp::min(level, self.lint_cap);\n \n+        if let Some(driver_level) = sess.driver_lint_caps.get(&LintId::of(lint)) {\n+            // Ensure that we never exceed driver level.\n+            level = cmp::min(*driver_level, level);\n+        }\n+\n         return (level, src)\n     }\n "}, {"sha": "180c5867e93d8bd9c359d6db2ca26f5faed706f5", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=1ff7f04120f11e4d15a6dad40417551873bf8ff2", "patch": "@@ -22,7 +22,7 @@ use middle::dependency_format;\n use session::search_paths::PathKind;\n use session::config::{OutputType};\n use ty::tls;\n-use util::nodemap::{FxHashSet};\n+use util::nodemap::{FxHashMap, FxHashSet};\n use util::common::{duration_to_secs_str, ErrorReported};\n use util::common::ProfileQueriesMsg;\n \n@@ -160,6 +160,9 @@ pub struct Session {\n \n     /// Metadata about the allocators for the current crate being compiled\n     pub has_global_allocator: Once<bool>,\n+\n+    /// Cap lint level specified by a driver specifically.\n+    pub driver_lint_caps: FxHashMap<lint::LintId, lint::Level>,\n }\n \n pub struct PerfStats {\n@@ -1164,6 +1167,7 @@ pub fn build_session_(\n             (*GLOBAL_JOBSERVER).clone()\n         },\n         has_global_allocator: Once::new(),\n+        driver_lint_caps: FxHashMap(),\n     };\n \n     sess"}, {"sha": "5cfdd07ab92043e0f304cfe190976a9eacb56b00", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=1ff7f04120f11e4d15a6dad40417551873bf8ff2", "patch": "@@ -235,6 +235,14 @@ pub fn run_core(search_paths: SearchPaths,\n         let mut sess = session::build_session_(\n             sessopts, cpath, diagnostic_handler, codemap,\n         );\n+\n+        let shutdown_lints = [lint::builtin::UNUSED_IMPORTS,\n+                              lint::builtin::UNUSED_EXTERN_CRATES];\n+\n+        for l in &shutdown_lints {\n+            sess.driver_lint_caps.insert(lint::LintId::of(l), lint::Allow);\n+        }\n+\n         let codegen_backend = rustc_driver::get_codegen_backend(&sess);\n         let cstore = Rc::new(CStore::new(codegen_backend.metadata_loader()));\n         rustc_lint::register_builtins(&mut sess.lint_store.borrow_mut(), Some(&sess));\n@@ -299,7 +307,6 @@ pub fn run_core(search_paths: SearchPaths,\n                                                             &sess);\n \n         let resolver = RefCell::new(resolver);\n-\n         abort_on_err(driver::phase_3_run_analysis_passes(&*codegen_backend,\n                                                         control,\n                                                         &sess,"}, {"sha": "8b53098639232032319608695614893b0cb9aaf5", "filename": "src/test/rustdoc-ui/unused.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Ftest%2Frustdoc-ui%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ff7f04120f11e4d15a6dad40417551873bf8ff2/src%2Ftest%2Frustdoc-ui%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funused.rs?ref=1ff7f04120f11e4d15a6dad40417551873bf8ff2", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-pass\n+\n+// This test purpose is to check that unused_imports lint isn't fired\n+// by rustdoc. Why would it? Because when rustdoc is running, it uses\n+// \"everybody-loops\" which replaces parts of code with \"loop {}\" to get\n+// huge performance improvements.\n+\n+#![deny(unused_imports)]\n+\n+use std::fs::File;\n+\n+pub fn f() {\n+    let _: File;\n+}"}]}