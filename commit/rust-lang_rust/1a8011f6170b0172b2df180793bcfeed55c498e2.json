{"sha": "1a8011f6170b0172b2df180793bcfeed55c498e2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhODAxMWY2MTcwYjAxNzJiMmRmMTgwNzkzYmNmZWVkNTVjNDk4ZTI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-06T05:02:06Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-06T05:02:06Z"}, "message": "Rollup merge of #52093 - alexcrichton:update-issue, r=kennytm\n\nrustc: Update tracking issue for wasm_import_module\n\nIt's now https://github.com/rust-lang/rust/issues/52090", "tree": {"sha": "72417cb6d5430dd0dbab5f7ee078decb01dc04b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72417cb6d5430dd0dbab5f7ee078decb01dc04b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a8011f6170b0172b2df180793bcfeed55c498e2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAls+988ACgkQ/vbIBR0O\nATwJ8BAAvEjcaxoUhxPjHaP8Rehzy3EHH2qY5/J//rF5dWpehKSm2YlolrqVXFtn\n340cWA+gjAZeFRgk6U1eewhAOGx0LdAhGiNTKwAedF70Wj3uvT1slisQ2fkVY0WI\nr50FXjad74XrrWfWoJjvh2K23hfpRshBLiazwyG19Jn2/uWmBknANSAndy3D0IrN\nqJco/pmOW5JNUubDvtVyluCKuVdEMejqNtLMMQTs7jL3sOI1TGrZw97GmsKCUnFs\nNyOHnAWW6qv4BsGogxIl1+cGnqH3HLZ3fDxJHwDSoFYV6OxtglWYCwRFNM5zlRrX\n5TpmVafufkMTBqsVO3ute/HREafPOMHMkr4pN5FL1UoTQGCpvalZgt4HY14Mm9g1\nsQatSUStsye5lfjf4xbYVoO6oOXOq/Xt2OabFHlc6+kc44jfciHmAVTXKIcAHDgK\nZwcTV2u3+3kf8Wk35mzcYyi+E+KlpiEYTa9mQEMeZ+VQ18F9CgKFYadO803PY9gG\nKUTYc03QtezR2xDbHalkAk0Ve0vvluvZQY0AFbdiRjm6n/MNE8Z6D0vsfWqR7SpX\noOrJnLvNjmJOMR+rMt3jtZIgBF2JZvLgyVeKl7NfuSOO+mzckTOaxNw6FKW3U1Qe\nauYHF9wsxWz1ho8+CwydH3Tg/m9TvtueVgT94aX1EWpf3E0u5i4=\n=yV6v\n-----END PGP SIGNATURE-----", "payload": "tree 72417cb6d5430dd0dbab5f7ee078decb01dc04b6\nparent 20e32ee61f80ee44a216a6d5ea99365841142ec4\nparent 23fbfb57cfbfa24325046cadb50518eed262695c\nauthor kennytm <kennytm@gmail.com> 1530853326 +0800\ncommitter kennytm <kennytm@gmail.com> 1530853326 +0800\n\nRollup merge of #52093 - alexcrichton:update-issue, r=kennytm\n\nrustc: Update tracking issue for wasm_import_module\n\nIt's now https://github.com/rust-lang/rust/issues/52090\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a8011f6170b0172b2df180793bcfeed55c498e2", "html_url": "https://github.com/rust-lang/rust/commit/1a8011f6170b0172b2df180793bcfeed55c498e2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a8011f6170b0172b2df180793bcfeed55c498e2/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "20e32ee61f80ee44a216a6d5ea99365841142ec4", "url": "https://api.github.com/repos/rust-lang/rust/commits/20e32ee61f80ee44a216a6d5ea99365841142ec4", "html_url": "https://github.com/rust-lang/rust/commit/20e32ee61f80ee44a216a6d5ea99365841142ec4"}, {"sha": "23fbfb57cfbfa24325046cadb50518eed262695c", "url": "https://api.github.com/repos/rust-lang/rust/commits/23fbfb57cfbfa24325046cadb50518eed262695c", "html_url": "https://github.com/rust-lang/rust/commit/23fbfb57cfbfa24325046cadb50518eed262695c"}], "stats": {"total": 82, "additions": 60, "deletions": 22}, "files": [{"sha": "b188f850575a6105da6b31a13d67f09b68d8135e", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 24, "deletions": 17, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=1a8011f6170b0172b2df180793bcfeed55c498e2", "patch": "@@ -1749,6 +1749,29 @@ pub fn parse_cfgspecs(cfgspecs: Vec<String>) -> ast::CrateConfig {\n         .collect::<ast::CrateConfig>()\n }\n \n+pub fn get_cmd_lint_options(matches: &getopts::Matches,\n+                            error_format: ErrorOutputType)\n+                            -> (Vec<(String, lint::Level)>, bool, Option<lint::Level>) {\n+    let mut lint_opts = vec![];\n+    let mut describe_lints = false;\n+\n+    for &level in &[lint::Allow, lint::Warn, lint::Deny, lint::Forbid] {\n+        for lint_name in matches.opt_strs(level.as_str()) {\n+            if lint_name == \"help\" {\n+                describe_lints = true;\n+            } else {\n+                lint_opts.push((lint_name.replace(\"-\", \"_\"), level));\n+            }\n+        }\n+    }\n+\n+    let lint_cap = matches.opt_str(\"cap-lints\").map(|cap| {\n+        lint::Level::from_str(&cap)\n+            .unwrap_or_else(|| early_error(error_format, &format!(\"unknown lint level: `{}`\", cap)))\n+    });\n+    (lint_opts, describe_lints, lint_cap)\n+}\n+\n pub fn build_session_options_and_crate_config(\n     matches: &getopts::Matches,\n ) -> (Options, ast::CrateConfig) {\n@@ -1826,23 +1849,7 @@ pub fn build_session_options_and_crate_config(\n     let crate_types = parse_crate_types_from_list(unparsed_crate_types)\n         .unwrap_or_else(|e| early_error(error_format, &e[..]));\n \n-    let mut lint_opts = vec![];\n-    let mut describe_lints = false;\n-\n-    for &level in &[lint::Allow, lint::Warn, lint::Deny, lint::Forbid] {\n-        for lint_name in matches.opt_strs(level.as_str()) {\n-            if lint_name == \"help\" {\n-                describe_lints = true;\n-            } else {\n-                lint_opts.push((lint_name.replace(\"-\", \"_\"), level));\n-            }\n-        }\n-    }\n-\n-    let lint_cap = matches.opt_str(\"cap-lints\").map(|cap| {\n-        lint::Level::from_str(&cap)\n-            .unwrap_or_else(|| early_error(error_format, &format!(\"unknown lint level: `{}`\", cap)))\n-    });\n+    let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n \n     let mut debugging_opts = build_debugging_options(matches, error_format);\n "}, {"sha": "2514fa044dd6bacc9a01ddeed8bd168a2d740981", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=1a8011f6170b0172b2df180793bcfeed55c498e2", "patch": "@@ -178,7 +178,10 @@ pub fn run_core(search_paths: SearchPaths,\n                 force_unstable_if_unmarked: bool,\n                 edition: Edition,\n                 cg: CodegenOptions,\n-                error_format: ErrorOutputType) -> (clean::Crate, RenderInfo)\n+                error_format: ErrorOutputType,\n+                cmd_lints: Vec<(String, lint::Level)>,\n+                lint_cap: Option<lint::Level>,\n+                describe_lints: bool) -> (clean::Crate, RenderInfo)\n {\n     // Parse, resolve, and typecheck the given crate.\n \n@@ -200,6 +203,7 @@ pub fn run_core(search_paths: SearchPaths,\n                             Some((lint.name_lower(), lint::Allow))\n                         }\n                     })\n+                    .chain(cmd_lints.into_iter())\n                     .collect::<Vec<_>>();\n \n     let host_triple = TargetTriple::from_triple(config::host_triple());\n@@ -213,7 +217,7 @@ pub fn run_core(search_paths: SearchPaths,\n         } else {\n             vec![]\n         },\n-        lint_cap: Some(lint::Forbid),\n+        lint_cap: Some(lint_cap.unwrap_or_else(|| lint::Forbid)),\n         cg,\n         externs,\n         target_triple: triple.unwrap_or(host_triple),\n@@ -226,6 +230,7 @@ pub fn run_core(search_paths: SearchPaths,\n         },\n         error_format,\n         edition,\n+        describe_lints,\n         ..config::basic_options()\n     };\n     driver::spawn_thread_pool(sessopts, move |sessopts| {"}, {"sha": "5f4739bd22276ac10247e3871a43664d573ac8fd", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 27, "deletions": 1, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=1a8011f6170b0172b2df180793bcfeed55c498e2", "patch": "@@ -68,6 +68,7 @@ use rustc::session::search_paths::SearchPaths;\n use rustc::session::config::{ErrorOutputType, RustcOptGroup, Externs, CodegenOptions};\n use rustc::session::config::{nightly_options, build_codegen_options};\n use rustc_target::spec::TargetTriple;\n+use rustc::session::config::get_cmd_lint_options;\n \n #[macro_use]\n pub mod externalfiles;\n@@ -308,6 +309,28 @@ pub fn opts() -> Vec<RustcOptGroup> {\n                        \"disable-minification\",\n                        \"Disable minification applied on JS files\")\n         }),\n+        unstable(\"warn\", |o| {\n+            o.optmulti(\"W\", \"warn\", \"Set lint warnings\", \"OPT\")\n+        }),\n+        unstable(\"allow\", |o| {\n+            o.optmulti(\"A\", \"allow\", \"Set lint allowed\", \"OPT\")\n+        }),\n+        unstable(\"deny\", |o| {\n+            o.optmulti(\"D\", \"deny\", \"Set lint denied\", \"OPT\")\n+        }),\n+        unstable(\"forbid\", |o| {\n+            o.optmulti(\"F\", \"forbid\", \"Set lint forbidden\", \"OPT\")\n+        }),\n+        unstable(\"cap-lints\", |o| {\n+            o.optmulti(\n+                \"\",\n+                \"cap-lints\",\n+                \"Set the most restrictive lint level. \\\n+                 More restrictive lints are capped at this \\\n+                 level. By default, it is at `forbid` level.\",\n+                \"LEVEL\",\n+            )\n+        }),\n     ]\n }\n \n@@ -640,6 +663,8 @@ where R: 'static + Send,\n         *x == \"force-unstable-if-unmarked\"\n     });\n \n+    let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n+\n     let (tx, rx) = channel();\n \n     rustc_driver::monitor(move || syntax::with_globals(move || {\n@@ -648,7 +673,8 @@ where R: 'static + Send,\n         let (mut krate, renderinfo) =\n             core::run_core(paths, cfgs, externs, Input::File(cratefile), triple, maybe_sysroot,\n                            display_warnings, crate_name.clone(),\n-                           force_unstable_if_unmarked, edition, cg, error_format);\n+                           force_unstable_if_unmarked, edition, cg, error_format,\n+                           lint_opts, lint_cap, describe_lints);\n \n         info!(\"finished with rustc\");\n "}, {"sha": "4c88325378793fcd92b0c2938abfe2984d3ada0c", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=1a8011f6170b0172b2df180793bcfeed55c498e2", "patch": "@@ -421,7 +421,7 @@ declare_features! (\n     (active, wasm_custom_section, \"1.26.0\", Some(51088), None),\n \n     // The #![wasm_import_module] attribute\n-    (active, wasm_import_module, \"1.26.0\", Some(51088), None),\n+    (active, wasm_import_module, \"1.26.0\", Some(52090), None),\n \n     // Allows keywords to be escaped for use as identifiers\n     (active, raw_identifiers, \"1.26.0\", Some(48589), None),"}, {"sha": "5430f6b5825eb7b98eef187d2466fb293e4a18c6", "filename": "src/test/ui/feature-gate-wasm_import_module.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Ftest%2Fui%2Ffeature-gate-wasm_import_module.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1a8011f6170b0172b2df180793bcfeed55c498e2/src%2Ftest%2Fui%2Ffeature-gate-wasm_import_module.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate-wasm_import_module.stderr?ref=1a8011f6170b0172b2df180793bcfeed55c498e2", "patch": "@@ -1,4 +1,4 @@\n-error[E0658]: experimental attribute (see issue #51088)\n+error[E0658]: experimental attribute (see issue #52090)\n   --> $DIR/feature-gate-wasm_import_module.rs:11:1\n    |\n LL | #[wasm_import_module = \"test\"] //~ ERROR: experimental"}]}