{"sha": "a9f50bdc16e27debb9896e74313193915ed29a41", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5ZjUwYmRjMTZlMjdkZWJiOTg5NmU3NDMxMzE5MzkxNWVkMjlhNDE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-09T09:12:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-09T09:12:09Z"}, "message": "Auto merge of #26068 - bluss:bench-sigfigs, r=huonw\n\ntest: Display benchmark results with thousands separators\r\n\r\nExample display:\r\n\r\n```\r\nrunning 9 tests\r\ntest a ... bench:           0 ns/iter (+/- 0)\r\ntest b ... bench:          52 ns/iter (+/- 0)\r\ntest c ... bench:          88 ns/iter (+/- 0)\r\ntest d ... bench:         618 ns/iter (+/- 111)\r\ntest e ... bench:       5,933 ns/iter (+/- 87)\r\ntest f ... bench:      59,280 ns/iter (+/- 1,052)\r\ntest g ... bench:     588,672 ns/iter (+/- 3,381)\r\ntest h ... bench:   5,894,227 ns/iter (+/- 303,489)\r\ntest i ... bench:  59,112,382 ns/iter (+/- 1,500,110)\r\n```\r\n\r\nFixes #10953\r\nFixes #26109", "tree": {"sha": "40b9682d1c4ca01a26972978e6446a2087332fc0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/40b9682d1c4ca01a26972978e6446a2087332fc0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a9f50bdc16e27debb9896e74313193915ed29a41", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a9f50bdc16e27debb9896e74313193915ed29a41", "html_url": "https://github.com/rust-lang/rust/commit/a9f50bdc16e27debb9896e74313193915ed29a41", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a9f50bdc16e27debb9896e74313193915ed29a41/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6daf1dcb80e324df94ad4a1d263c832ab589b33a", "url": "https://api.github.com/repos/rust-lang/rust/commits/6daf1dcb80e324df94ad4a1d263c832ab589b33a", "html_url": "https://github.com/rust-lang/rust/commit/6daf1dcb80e324df94ad4a1d263c832ab589b33a"}, {"sha": "2b50c157d62f566fc367693cd15d55568fb5e33e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b50c157d62f566fc367693cd15d55568fb5e33e", "html_url": "https://github.com/rust-lang/rust/commit/2b50c157d62f566fc367693cd15d55568fb5e33e"}], "stats": {"total": 43, "additions": 35, "deletions": 8}, "files": [{"sha": "5ea843918be5f1a4c495d60dea0a6cefbd7dbc5b", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 35, "deletions": 8, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/a9f50bdc16e27debb9896e74313193915ed29a41/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a9f50bdc16e27debb9896e74313193915ed29a41/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=a9f50bdc16e27debb9896e74313193915ed29a41", "patch": "@@ -625,17 +625,44 @@ impl<T: Write> ConsoleTestState<T> {\n     }\n }\n \n+// Format a number with thousands separators\n+fn fmt_thousands_sep(mut n: usize, sep: char) -> String {\n+    use std::fmt::Write;\n+    let mut output = String::new();\n+    let mut first = true;\n+    for &pow in &[9, 6, 3, 0] {\n+        let base = 10_usize.pow(pow);\n+        if pow == 0 || n / base != 0 {\n+            if first {\n+                output.write_fmt(format_args!(\"{}\", n / base)).unwrap();\n+            } else {\n+                output.write_fmt(format_args!(\"{:03}\", n / base)).unwrap();\n+            }\n+            if pow != 0 {\n+                output.push(sep);\n+            }\n+            first = false;\n+        }\n+        n %= base;\n+    }\n+\n+    output\n+}\n+\n pub fn fmt_bench_samples(bs: &BenchSamples) -> String {\n+    use std::fmt::Write;\n+    let mut output = String::new();\n+\n+    let median = bs.ns_iter_summ.median as usize;\n+    let deviation = (bs.ns_iter_summ.max - bs.ns_iter_summ.min) as usize;\n+\n+    output.write_fmt(format_args!(\"{:>11} ns/iter (+/- {})\",\n+                     fmt_thousands_sep(median, ','),\n+                     fmt_thousands_sep(deviation, ','))).unwrap();\n     if bs.mb_s != 0 {\n-        format!(\"{:>9} ns/iter (+/- {}) = {} MB/s\",\n-             bs.ns_iter_summ.median as usize,\n-             (bs.ns_iter_summ.max - bs.ns_iter_summ.min) as usize,\n-             bs.mb_s)\n-    } else {\n-        format!(\"{:>9} ns/iter (+/- {})\",\n-             bs.ns_iter_summ.median as usize,\n-             (bs.ns_iter_summ.max - bs.ns_iter_summ.min) as usize)\n+        output.write_fmt(format_args!(\" = {} MB/s\", bs.mb_s)).unwrap();\n     }\n+    output\n }\n \n // A simple console test runner"}]}