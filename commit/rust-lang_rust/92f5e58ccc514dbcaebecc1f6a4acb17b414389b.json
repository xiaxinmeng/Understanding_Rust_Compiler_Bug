{"sha": "92f5e58ccc514dbcaebecc1f6a4acb17b414389b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyZjVlNThjY2M1MTRkYmNhZWJlY2MxZjZhNGFjYjE3YjQxNDM4OWI=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-06-07T15:39:28Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-06-13T14:57:55Z"}, "message": "Delete Rustbook step\n\nThere's no need to have it given it merely forwarded to RustbookSrc.", "tree": {"sha": "20ddacac52b84d0e2d038097f4230d36fee61ed9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20ddacac52b84d0e2d038097f4230d36fee61ed9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92f5e58ccc514dbcaebecc1f6a4acb17b414389b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92f5e58ccc514dbcaebecc1f6a4acb17b414389b", "html_url": "https://github.com/rust-lang/rust/commit/92f5e58ccc514dbcaebecc1f6a4acb17b414389b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92f5e58ccc514dbcaebecc1f6a4acb17b414389b/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96636f3eb8206f7499451ebc5b347d000d7aee08", "url": "https://api.github.com/repos/rust-lang/rust/commits/96636f3eb8206f7499451ebc5b347d000d7aee08", "html_url": "https://github.com/rust-lang/rust/commit/96636f3eb8206f7499451ebc5b347d000d7aee08"}], "stats": {"total": 46, "additions": 12, "deletions": 34}, "files": [{"sha": "9d8e0d5eb6f0ba2a7a7e11dd7d57eb7beb61e29e", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 12, "deletions": 34, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/92f5e58ccc514dbcaebecc1f6a4acb17b414389b/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92f5e58ccc514dbcaebecc1f6a4acb17b414389b/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=92f5e58ccc514dbcaebecc1f6a4acb17b414389b", "patch": "@@ -46,10 +46,11 @@ macro_rules! book {\n             }\n \n             fn run(self, builder: &Builder<'_>) {\n-                builder.ensure(Rustbook {\n+                builder.ensure(RustbookSrc {\n                     target: self.target,\n                     name: INTERNER.intern_str($book_name),\n                     version: $book_ver,\n+                    src: doc_src(builder),\n                 })\n             }\n         }\n@@ -75,35 +76,8 @@ enum RustbookVersion {\n     MdBook2,\n }\n \n-#[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n-struct Rustbook {\n-    target: Interned<String>,\n-    name: Interned<String>,\n-    version: RustbookVersion,\n-}\n-\n-impl Step for Rustbook {\n-    type Output = ();\n-\n-    // rustbook is never directly called, and only serves as a shim for the nomicon and the\n-    // reference.\n-    fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {\n-        run.never()\n-    }\n-\n-    /// Invoke `rustbook` for `target` for the doc book `name`.\n-    ///\n-    /// This will not actually generate any documentation if the documentation has\n-    /// already been generated.\n-    fn run(self, builder: &Builder<'_>) {\n-        let src = builder.src.join(\"src/doc\");\n-        builder.ensure(RustbookSrc {\n-            target: self.target,\n-            name: self.name,\n-            src: INTERNER.intern_path(src),\n-            version: self.version,\n-        });\n-    }\n+fn doc_src(builder: &Builder<'_>) -> Interned<PathBuf> {\n+    INTERNER.intern_path(builder.src.join(\"src/doc\"))\n }\n \n #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq)]\n@@ -274,33 +248,37 @@ impl Step for TheBook {\n         let name = self.name;\n \n         // build book\n-        builder.ensure(Rustbook {\n+        builder.ensure(RustbookSrc {\n             target,\n             name: INTERNER.intern_string(name.to_string()),\n             version: RustbookVersion::MdBook2,\n+            src: doc_src(builder),\n         });\n \n         // building older edition redirects\n \n         let source_name = format!(\"{}/first-edition\", name);\n-        builder.ensure(Rustbook {\n+        builder.ensure(RustbookSrc {\n             target,\n             name: INTERNER.intern_string(source_name),\n             version: RustbookVersion::MdBook2,\n+            src: doc_src(builder),\n         });\n \n         let source_name = format!(\"{}/second-edition\", name);\n-        builder.ensure(Rustbook {\n+        builder.ensure(RustbookSrc {\n             target,\n             name: INTERNER.intern_string(source_name),\n             version: RustbookVersion::MdBook2,\n+            src: doc_src(builder),\n         });\n \n         let source_name = format!(\"{}/2018-edition\", name);\n-        builder.ensure(Rustbook {\n+        builder.ensure(RustbookSrc {\n             target,\n             name: INTERNER.intern_string(source_name),\n             version: RustbookVersion::MdBook2,\n+            src: doc_src(builder),\n         });\n \n         // build the version info page and CSS"}]}