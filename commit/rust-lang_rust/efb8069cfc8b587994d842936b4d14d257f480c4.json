{"sha": "efb8069cfc8b587994d842936b4d14d257f480c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmYjgwNjljZmM4YjU4Nzk5NGQ4NDI5MzZiNGQxNGQyNTdmNDgwYzQ=", "commit": {"author": {"name": "Tibo", "email": "delor.thibault@gmail.com", "date": "2018-04-24T05:45:28Z"}, "committer": {"name": "Tibo", "email": "delor.thibault@gmail.com", "date": "2018-04-26T02:18:20Z"}, "message": "Replace std::Error with failure for FormatDiff", "tree": {"sha": "a2a64e4c293131b7ab0e0b95efefa97351180be5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2a64e4c293131b7ab0e0b95efefa97351180be5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/efb8069cfc8b587994d842936b4d14d257f480c4", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEmVxnM0/G1oDSm5ipxT9CfVmUEWwFAlrhNvUACgkQxT9CfVmU\nEWzC0wf/RBBMsN8wUbZJAJM1tjnOaC4hGwCVPS6oUn46oPQYkOFqh3VaOB//w7Dk\nq9rXVgo/Q8n/bct9v88p6smeRJ3KMp0U90EdQqIHR4P9gXqct1RkN4sKNbZp9IIB\n2KhJlZBlYsF5TVHPFWQd5RAPsHC+r92MGtLUeSd9QCWFfGrTuwrCzwz/jj28VD3Y\nSQ0s+8heRNlBOhbFzA7p9q0rPBtcOabuoiH+In22UcYbVEubZOHi9bN4FE1DY8kN\nJFAYcR8Z0U24u3CwZ66IcOjUhomYmAp9nf9xSIDevHPtsqkExVYG4JwBjlIOKE4L\ndANwAO3MIMYANodiBF46Ogavs5KUag==\n=h3U/\n-----END PGP SIGNATURE-----", "payload": "tree a2a64e4c293131b7ab0e0b95efefa97351180be5\nparent ac8ae0062544743aaea1719a34f299b66f2b7dc9\nauthor Tibo <delor.thibault@gmail.com> 1524548728 +1000\ncommitter Tibo <delor.thibault@gmail.com> 1524709100 +1000\n\nReplace std::Error with failure for FormatDiff\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/efb8069cfc8b587994d842936b4d14d257f480c4", "html_url": "https://github.com/rust-lang/rust/commit/efb8069cfc8b587994d842936b4d14d257f480c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/efb8069cfc8b587994d842936b4d14d257f480c4/comments", "author": {"login": "t-botz", "id": 693797, "node_id": "MDQ6VXNlcjY5Mzc5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/693797?v=4", "gravatar_id": "", "url": "https://api.github.com/users/t-botz", "html_url": "https://github.com/t-botz", "followers_url": "https://api.github.com/users/t-botz/followers", "following_url": "https://api.github.com/users/t-botz/following{/other_user}", "gists_url": "https://api.github.com/users/t-botz/gists{/gist_id}", "starred_url": "https://api.github.com/users/t-botz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/t-botz/subscriptions", "organizations_url": "https://api.github.com/users/t-botz/orgs", "repos_url": "https://api.github.com/users/t-botz/repos", "events_url": "https://api.github.com/users/t-botz/events{/privacy}", "received_events_url": "https://api.github.com/users/t-botz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "t-botz", "id": 693797, "node_id": "MDQ6VXNlcjY5Mzc5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/693797?v=4", "gravatar_id": "", "url": "https://api.github.com/users/t-botz", "html_url": "https://github.com/t-botz", "followers_url": "https://api.github.com/users/t-botz/followers", "following_url": "https://api.github.com/users/t-botz/following{/other_user}", "gists_url": "https://api.github.com/users/t-botz/gists{/gist_id}", "starred_url": "https://api.github.com/users/t-botz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/t-botz/subscriptions", "organizations_url": "https://api.github.com/users/t-botz/orgs", "repos_url": "https://api.github.com/users/t-botz/repos", "events_url": "https://api.github.com/users/t-botz/events{/privacy}", "received_events_url": "https://api.github.com/users/t-botz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac8ae0062544743aaea1719a34f299b66f2b7dc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac8ae0062544743aaea1719a34f299b66f2b7dc9", "html_url": "https://github.com/rust-lang/rust/commit/ac8ae0062544743aaea1719a34f299b66f2b7dc9"}], "stats": {"total": 103, "additions": 76, "deletions": 27}, "files": [{"sha": "3d1d1cb200b0aa6c88d10d1f66a41f05c58fa2d3", "filename": "Cargo.lock", "status": "modified", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/efb8069cfc8b587994d842936b4d14d257f480c4/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/efb8069cfc8b587994d842936b4d14d257f480c4/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=efb8069cfc8b587994d842936b4d14d257f480c4", "patch": "@@ -175,6 +175,25 @@ dependencies = [\n  \"backtrace 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"failure\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"backtrace 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"failure_derive 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"failure_derive\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.11.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"synstructure 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"fuchsia-zircon\"\n version = \"0.3.3\"\n@@ -309,6 +328,11 @@ name = \"quick-error\"\n version = \"1.2.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"quote\"\n+version = \"0.3.15\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"quote\"\n version = \"0.5.2\"\n@@ -453,6 +477,7 @@ dependencies = [\n  \"derive-new 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.5.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -566,6 +591,16 @@ name = \"stable_deref_trait\"\n version = \"1.0.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"syn\"\n+version = \"0.11.11\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"synom 0.11.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"syn\"\n version = \"0.13.1\"\n@@ -576,6 +611,23 @@ dependencies = [\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"synom\"\n+version = \"0.11.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"synstructure\"\n+version = \"0.6.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.11.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"tempdir\"\n version = \"0.3.7\"\n@@ -653,6 +705,11 @@ name = \"unicode-width\"\n version = \"0.1.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"unicode-xid\"\n+version = \"0.0.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"unicode-xid\"\n version = \"0.1.0\"\n@@ -747,6 +804,8 @@ dependencies = [\n \"checksum env_logger 0.5.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"00c45cec4cde3daac5f036c74098b4956151525cdf360cff5ee0092c98823e54\"\n \"checksum environment 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1f4b14e20978669064c33b4c1e0fb4083412e40fe56cbea2eae80fd7591503ee\"\n \"checksum error-chain 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ff511d5dc435d703f4971bc399647c9bc38e20cb41452e3b9feb4765419ed3f3\"\n+\"checksum failure 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"934799b6c1de475a012a02dab0ace1ace43789ee4b99bcfbf1a2e3e8ced5de82\"\n+\"checksum failure_derive 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c7cdda555bb90c9bb67a3b670a0f42de8e73f5981524123ad8578aafec8ddb8b\"\n \"checksum fuchsia-zircon 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2e9763c69ebaae630ba35f74888db465e49e259ba1bc0eda7d06f4a067615d82\"\n \"checksum fuchsia-zircon-sys 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3dcaa9ae7725d12cdb85b3ad99a434db70b468c09ded17e012d86b5c1010f7a7\"\n \"checksum getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b900c08c1939860ce8b54dc6a89e26e00c04c380fd0e09796799bd7f12861e05\"\n@@ -766,6 +825,7 @@ dependencies = [\n \"checksum proc-macro2 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b16749538926f394755373f0dfec0852d79b3bd512a5906ceaeb72ee64a4eaa0\"\n \"checksum pulldown-cmark 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d6fdf85cda6cadfae5428a54661d431330b312bc767ddbc57adbedc24da66e32\"\n \"checksum quick-error 1.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eda5fe9b71976e62bc81b781206aaa076401769b2143379d3eb2118388babac4\"\n+\"checksum quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7a6e920b65c65f10b2ae65c831a81a073a89edd28c7cce89475bff467ab4167a\"\n \"checksum quote 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9949cfe66888ffe1d53e6ec9d9f3b70714083854be20fd5e271b232a017401e8\"\n \"checksum rand 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eba5f8cb59cc50ed56be8880a5c7b496bfd9bd26394e176bc67884094145c2c5\"\n \"checksum redox_syscall 0.1.37 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0d92eecebad22b767915e4d529f89f28ee96dbbf5a4810d2b844373f136417fd\"\n@@ -792,7 +852,10 @@ dependencies = [\n \"checksum skeptic 0.13.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c8431f8fca168e2db4be547bd8329eac70d095dff1444fee4b0fa0fabc7df75a\"\n \"checksum smallvec 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"03dab98ab5ded3a8b43b2c80751194608d0b2aa0f1d46cf95d1c35e192844aa7\"\n \"checksum stable_deref_trait 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15132e0e364248108c5e2c02e3ab539be8d6f5d52a01ca9bbf27ed657316f02b\"\n+\"checksum syn 0.11.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d3b891b9015c88c576343b9b3e41c2c11a51c219ef067b264bd9c8aa9b441dad\"\n \"checksum syn 0.13.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"91b52877572087400e83d24b9178488541e3d535259e04ff17a63df1e5ceff59\"\n+\"checksum synom 0.11.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a393066ed9010ebaed60b9eafa373d4b1baac186dd7e008555b0f702b51945b6\"\n+\"checksum synstructure 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3a761d12e6d8dcb4dcf952a7a89b475e3a9d69e4a69307e01a470977642914bd\"\n \"checksum tempdir 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15f2b5fb00ccdf689e0149d1b1b3c03fead81c2b37735d812fa8bddbbf41b6d8\"\n \"checksum term 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fa63644f74ce96fbeb9b794f66aff2a52d601cbd5e80f4b97123e3899f4570f1\"\n \"checksum term 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5e6b677dd1e8214ea1ef4297f85dbcbed8e8cdddb561040cc998ca2551c37561\"\n@@ -803,6 +866,7 @@ dependencies = [\n \"checksum ucd-util 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fd2be2d6639d0f8fe6cdda291ad456e23629558d466e2789d2c3e9892bda285d\"\n \"checksum unicode-segmentation 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a8083c594e02b8ae1654ae26f0ade5158b119bd88ad0e8227a5d8fcd72407946\"\n \"checksum unicode-width 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bf3a113775714a22dcb774d8ea3655c53a32debae63a063acc00a91cc586245f\"\n+\"checksum unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8c1f860d7d29cf02cb2f3f359fd35991af3d30bac52c57d265a3c461074cb4dc\"\n \"checksum unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fc72304796d0818e357ead4e000d19c9c174ab23dc11093ac919054d20a6a7fc\"\n \"checksum unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56\"\n \"checksum utf8-ranges 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"662fab6525a98beff2921d7f61a39e7d59e0b425ebc7d0d9e66d316e55124122\""}, {"sha": "4074f67b8756e2cfdc7fc734f03b204b0169a5a9", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/efb8069cfc8b587994d842936b4d14d257f480c4/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/efb8069cfc8b587994d842936b4d14d257f480c4/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=efb8069cfc8b587994d842936b4d14d257f480c4", "patch": "@@ -47,6 +47,7 @@ getopts = \"0.2\"\n derive-new = \"0.5\"\n cargo_metadata = \"0.5.1\"\n rustc-ap-syntax = \"110.0.0\"\n+failure = \"0.1.1\"\n \n [dev-dependencies]\n assert_cli = \"0.5\""}, {"sha": "fe528a6c0ea7bb9ae57f8f862c5753df5feb9a08", "filename": "src/format-diff/main.rs", "status": "modified", "additions": 11, "deletions": 27, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/efb8069cfc8b587994d842936b4d14d257f480c4/src%2Fformat-diff%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efb8069cfc8b587994d842936b4d14d257f480c4/src%2Fformat-diff%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fformat-diff%2Fmain.rs?ref=efb8069cfc8b587994d842936b4d14d257f480c4", "patch": "@@ -15,6 +15,8 @@\n #![deny(warnings)]\n \n extern crate env_logger;\n+#[macro_use]\n+extern crate failure;\n extern crate getopts;\n #[macro_use]\n extern crate log;\n@@ -24,9 +26,8 @@ extern crate serde_derive;\n extern crate serde_json as json;\n \n use std::collections::HashSet;\n-use std::error::Error;\n use std::io::{self, BufRead};\n-use std::{env, fmt, process};\n+use std::{env, process};\n \n use regex::Regex;\n \n@@ -35,31 +36,14 @@ use regex::Regex;\n /// We only want to format rust files by default.\n const DEFAULT_PATTERN: &str = r\".*\\.rs\";\n \n-#[derive(Debug)]\n+#[derive(Fail, Debug)]\n enum FormatDiffError {\n-    IncorrectOptions(getopts::Fail),\n-    IncorrectFilter(regex::Error),\n-    IoError(io::Error),\n-}\n-\n-impl fmt::Display for FormatDiffError {\n-    fn fmt(&self, f: &mut fmt::Formatter) -> Result<(), fmt::Error> {\n-        fmt::Display::fmt(self.cause().unwrap(), f)\n-    }\n-}\n-\n-impl Error for FormatDiffError {\n-    fn description(&self) -> &str {\n-        self.cause().unwrap().description()\n-    }\n-\n-    fn cause(&self) -> Option<&Error> {\n-        Some(match *self {\n-            FormatDiffError::IoError(ref e) => e,\n-            FormatDiffError::IncorrectFilter(ref e) => e,\n-            FormatDiffError::IncorrectOptions(ref e) => e,\n-        })\n-    }\n+    #[fail(display = \"{}\", _0)]\n+    IncorrectOptions(#[cause] getopts::Fail),\n+    #[fail(display = \"{}\", _0)]\n+    IncorrectFilter(#[cause] regex::Error),\n+    #[fail(display = \"{}\", _0)]\n+    IoError(#[cause] io::Error),\n }\n \n impl From<getopts::Fail> for FormatDiffError {\n@@ -99,7 +83,7 @@ fn main() {\n     );\n \n     if let Err(e) = run(&opts) {\n-        println!(\"{}\", opts.usage(e.description()));\n+        println!(\"{}\", opts.usage(&format!(\"{}\", e)));\n         process::exit(1);\n     }\n }"}]}