{"sha": "e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzZDUyYjgwNTFiNWFjNTBkYmY3MWFiNzNmMmI0N2VjYjhkN2M2MjQ=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-11-15T02:02:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-15T02:02:55Z"}, "message": "Rollup merge of #78986 - Mark-Simulacrum:fix-llvm, r=alexcrichton\n\nAvoid installing external LLVM dylibs\n\nIf the LLVM was externally provided, then we don't currently copy artifacts into\nthe sysroot. This is not necessarily the right choice (in particular, it will\nrequire the LLVM dylib to be in the linker's load path at runtime), but the\ncommon use case for external LLVMs is distribution provided LLVMs, and in that\ncase they're usually in the standard search path (e.g., /usr/lib) and copying\nthem here is going to cause problems as we may end up with the wrong files and\nisn't what distributions want.\n\nThis behavior may be revisited in the future though.\n\nFixes #78932.", "tree": {"sha": "24f24115a5e54dfd66da0fb74e547e9a30687c35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/24f24115a5e54dfd66da0fb74e547e9a30687c35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfsIxPCRBK7hj4Ov3rIwAAdHIIAFu6eZZq+lgEzGsUC4WIMsUf\ntLO2bSTnUPUpiwMWMIxJrzuPJaEtSzxpuUNL4nOUuK6ea/iwTfwDrSdTNGYyTJxr\ntB7gOPbGEBrfoq6p9Xyoz74lnbqKrw5e3MP6LsbrUYvuTYsn1YGLvtZN6XfoQ8vH\nnAh0afHJaLdOnHKCOvJ9yX0VwF1IOJy/0AxzGeZyVynwFupWIrZqBcTJYuGoIt4J\ntAseivH9x5Vw2yOm4v7cj3od41NlnlUe/AM21DtmkOGZPfSGVMOBUxf95KvOUCHB\nmxm2iWnsKnTcwuJFkYM4QLJTKcGvXvZGPZDe4ep1caQRGK5GsqpldKydR3Rg9sk=\n=3oz6\n-----END PGP SIGNATURE-----\n", "payload": "tree 24f24115a5e54dfd66da0fb74e547e9a30687c35\nparent 4fcb617cbe6a92dabac763bd38862d2c40b4d247\nparent 3747df71fa280557f85d847dcb460c0cbe0d16ce\nauthor Dylan DPC <dylan.dpc@gmail.com> 1605405775 +0100\ncommitter GitHub <noreply@github.com> 1605405775 +0100\n\nRollup merge of #78986 - Mark-Simulacrum:fix-llvm, r=alexcrichton\n\nAvoid installing external LLVM dylibs\n\nIf the LLVM was externally provided, then we don't currently copy artifacts into\nthe sysroot. This is not necessarily the right choice (in particular, it will\nrequire the LLVM dylib to be in the linker's load path at runtime), but the\ncommon use case for external LLVMs is distribution provided LLVMs, and in that\ncase they're usually in the standard search path (e.g., /usr/lib) and copying\nthem here is going to cause problems as we may end up with the wrong files and\nisn't what distributions want.\n\nThis behavior may be revisited in the future though.\n\nFixes #78932.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624", "html_url": "https://github.com/rust-lang/rust/commit/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fcb617cbe6a92dabac763bd38862d2c40b4d247", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fcb617cbe6a92dabac763bd38862d2c40b4d247", "html_url": "https://github.com/rust-lang/rust/commit/4fcb617cbe6a92dabac763bd38862d2c40b4d247"}, {"sha": "3747df71fa280557f85d847dcb460c0cbe0d16ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/3747df71fa280557f85d847dcb460c0cbe0d16ce", "html_url": "https://github.com/rust-lang/rust/commit/3747df71fa280557f85d847dcb460c0cbe0d16ce"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "514be9e6864ba01e9d1ccdabd92ffd2043903ba8", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=e3d52b8051b5ac50dbf71ab73f2b47ecb8d7c624", "patch": "@@ -2357,6 +2357,22 @@ fn maybe_install_llvm(builder: &Builder<'_>, target: TargetSelection, dst_libdir\n         return;\n     }\n \n+    if let Some(config) = builder.config.target_config.get(&target) {\n+        if config.llvm_config.is_some() {\n+            // If the LLVM was externally provided, then we don't currently copy\n+            // artifacts into the sysroot. This is not necessarily the right\n+            // choice (in particular, it will require the LLVM dylib to be in\n+            // the linker's load path at runtime), but the common use case for\n+            // external LLVMs is distribution provided LLVMs, and in that case\n+            // they're usually in the standard search path (e.g., /usr/lib) and\n+            // copying them here is going to cause problems as we may end up\n+            // with the wrong files and isn't what distributions want.\n+            //\n+            // This behavior may be revisited in the future though.\n+            return;\n+        }\n+    }\n+\n     // On macOS, rustc (and LLVM tools) link to an unversioned libLLVM.dylib\n     // instead of libLLVM-11-rust-....dylib, as on linux. It's not entirely\n     // clear why this is the case, though. llvm-config will emit the versioned"}]}