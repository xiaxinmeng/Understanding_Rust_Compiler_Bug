{"sha": "ccd7aaf17a4fa3c4851758ec70ffa755e25455be", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjZDdhYWYxN2E0ZmEzYzQ4NTE3NThlYzcwZmZhNzU1ZTI1NDU1YmU=", "commit": {"author": {"name": "Mike Boutin", "email": "mike.boutin@gmail.com", "date": "2014-06-21T18:55:08Z"}, "committer": {"name": "Mike Boutin", "email": "mike.boutin@gmail.com", "date": "2014-07-03T00:03:10Z"}, "message": "install: Correct libdir for Windows installs.\n\nPlatform-detection code from `configure` copied over to `install.sh`\nin order to special case the lib dir being `bin` on Windows instead\nof `lib`.\n\nShort-term fix for #13810.", "tree": {"sha": "872c6ea6cc2112bcf860e2284b285389834bbe22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/872c6ea6cc2112bcf860e2284b285389834bbe22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ccd7aaf17a4fa3c4851758ec70ffa755e25455be", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ccd7aaf17a4fa3c4851758ec70ffa755e25455be", "html_url": "https://github.com/rust-lang/rust/commit/ccd7aaf17a4fa3c4851758ec70ffa755e25455be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ccd7aaf17a4fa3c4851758ec70ffa755e25455be/comments", "author": {"login": "iliekturtles", "id": 5081378, "node_id": "MDQ6VXNlcjUwODEzNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/5081378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iliekturtles", "html_url": "https://github.com/iliekturtles", "followers_url": "https://api.github.com/users/iliekturtles/followers", "following_url": "https://api.github.com/users/iliekturtles/following{/other_user}", "gists_url": "https://api.github.com/users/iliekturtles/gists{/gist_id}", "starred_url": "https://api.github.com/users/iliekturtles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iliekturtles/subscriptions", "organizations_url": "https://api.github.com/users/iliekturtles/orgs", "repos_url": "https://api.github.com/users/iliekturtles/repos", "events_url": "https://api.github.com/users/iliekturtles/events{/privacy}", "received_events_url": "https://api.github.com/users/iliekturtles/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iliekturtles", "id": 5081378, "node_id": "MDQ6VXNlcjUwODEzNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/5081378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iliekturtles", "html_url": "https://github.com/iliekturtles", "followers_url": "https://api.github.com/users/iliekturtles/followers", "following_url": "https://api.github.com/users/iliekturtles/following{/other_user}", "gists_url": "https://api.github.com/users/iliekturtles/gists{/gist_id}", "starred_url": "https://api.github.com/users/iliekturtles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iliekturtles/subscriptions", "organizations_url": "https://api.github.com/users/iliekturtles/orgs", "repos_url": "https://api.github.com/users/iliekturtles/repos", "events_url": "https://api.github.com/users/iliekturtles/events{/privacy}", "received_events_url": "https://api.github.com/users/iliekturtles/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3035d8dfb13077e195eb056568183911c90c1b4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/3035d8dfb13077e195eb056568183911c90c1b4b", "html_url": "https://github.com/rust-lang/rust/commit/3035d8dfb13077e195eb056568183911c90c1b4b"}], "stats": {"total": 69, "additions": 67, "deletions": 2}, "files": [{"sha": "fd4c20d73c5d1df40979ed95a3f691026caed0b3", "filename": "src/etc/install.sh", "status": "modified", "additions": 67, "deletions": 2, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/ccd7aaf17a4fa3c4851758ec70ffa755e25455be/src%2Fetc%2Finstall.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ccd7aaf17a4fa3c4851758ec70ffa755e25455be/src%2Fetc%2Finstall.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Finstall.sh?ref=ccd7aaf17a4fa3c4851758ec70ffa755e25455be", "patch": "@@ -35,6 +35,13 @@ need_ok() {\n     fi\n }\n \n+need_cmd() {\n+    if command -v $1 >/dev/null 2>&1\n+    then msg \"found $1\"\n+    else err \"need $1\"\n+    fi\n+}\n+\n putvar() {\n     local T\n     eval T=\\$$1\n@@ -198,6 +205,15 @@ absolutify() {\n     ABSOLUTIFIED=\"${FILE_PATH}\"\n }\n \n+msg \"looking for install programs\"\n+need_cmd mkdir\n+need_cmd printf\n+need_cmd cut\n+need_cmd grep\n+need_cmd uname\n+need_cmd tr\n+need_cmd sed\n+\n CFG_SRC_DIR=\"$(cd $(dirname $0) && pwd)/\"\n CFG_SELF=\"$0\"\n CFG_ARGS=\"$@\"\n@@ -216,16 +232,65 @@ else\n     step_msg \"processing $CFG_SELF args\"\n fi\n \n+# Check for mingw or cygwin in order to special case $CFG_LIBDIR_RELATIVE.\n+# This logic is duplicated from configure in order to get the correct libdir\n+# for Windows installs.\n+CFG_OSTYPE=$(uname -s)\n+\n+case $CFG_OSTYPE in\n+\n+    MINGW32*)\n+        CFG_OSTYPE=pc-mingw32\n+        ;;\n+\n+    MINGW64*)\n+        # msys2, MSYSTEM=MINGW64\n+        CFG_OSTYPE=w64-mingw32\n+        ;;\n+\n+# Thad's Cygwin identifers below\n+\n+#   Vista 32 bit\n+    CYGWIN_NT-6.0)\n+        CFG_OSTYPE=pc-mingw32\n+        ;;\n+\n+#   Vista 64 bit\n+    CYGWIN_NT-6.0-WOW64)\n+        CFG_OSTYPE=w64-mingw32\n+        ;;\n+\n+#   Win 7 32 bit\n+    CYGWIN_NT-6.1)\n+        CFG_OSTYPE=pc-mingw32\n+        ;;\n+\n+#   Win 7 64 bit\n+    CYGWIN_NT-6.1-WOW64)\n+        CFG_OSTYPE=w64-mingw32\n+        ;;\n+esac\n+\n OPTIONS=\"\"\n BOOL_OPTIONS=\"\"\n VAL_OPTIONS=\"\"\n \n+# On windows we just store the libraries in the bin directory because\n+# there's no rpath. This is where the build system itself puts libraries;\n+# --libdir is used to configure the installation directory.\n+# FIXME: Thise needs to parameterized over target triples. Do it in platform.mk\n+CFG_LIBDIR_RELATIVE=lib\n+if [ \"$CFG_OSTYPE\" = \"pc-mingw32\" ] || [ \"$CFG_OSTYPE\" = \"w64-mingw32\" ]\n+then\n+    CFG_LIBDIR_RELATIVE=bin\n+fi\n+\n flag uninstall \"only uninstall from the installation prefix\"\n opt verify 1 \"verify that the installed binaries run correctly\"\n valopt prefix \"/usr/local\" \"set installation prefix\"\n # NB This isn't quite the same definition as in `configure`.\n # just using 'lib' instead of CFG_LIBDIR_RELATIVE\n-valopt libdir \"${CFG_PREFIX}/lib\" \"install libraries\"\n+valopt libdir \"${CFG_PREFIX}/${CFG_LIBDIR_RELATIVE}\" \"install libraries\"\n valopt mandir \"${CFG_PREFIX}/share/man\" \"install man pages in PATH\"\n \n if [ $HELP -eq 1 ]\n@@ -384,7 +449,7 @@ while read p; do\n     need_ok \"failed to update manifest\"\n \n # The manifest lists all files to install\n-done < \"${CFG_SRC_DIR}/lib/rustlib/manifest.in\"\n+done < \"${CFG_SRC_DIR}/${CFG_LIBDIR_RELATIVE}/rustlib/manifest.in\"\n \n # Sanity check: can we run the installed binaries?\n if [ -z \"${CFG_DISABLE_VERIFY}\" ]"}]}