{"sha": "bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjOWEwZGMxYjM0N2Q1ZDJmZjM2MWQwZDUwMWUzODM2ZjMwYWZmZTA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-08T09:01:47Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:08:31Z"}, "message": "ci: extract installing ninja into a script", "tree": {"sha": "5c1a11377c651c606ad7ffaadcf79282117fcf73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c1a11377c651c606ad7ffaadcf79282117fcf73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIyBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAd8ACgkQPgar6Auq\n8ZwsSA/4yPc+8NaR7ffSdkb5mMK75oxL33f767+WwgZ0Oh/CDFZv8lpfsNRsAupi\nF56uw/CWfkS8VOEh8ECs87RIl3DM+oNcmttgn+1WK6SFxCNdl+fZYNtE34MDP45i\nB0Y0sQgE9DlSL1dr114GS5R7KCmHbt18puXalx8KLkPaIg7HgP9SgF/mEsJ0UNiI\nwAvgECL843t3fmlu/yYbfPufzdyms2iSRmIh69HrQbT3c1HIpBGl0YR8EAQcUTK0\nq6DlzaltYMj/8UsTMHaxoMNwqCtTQN8nJwf29/CkjfBTWM+urJ4xHJZ8YG8hJM4M\nGQVPXd3ligFFS+v1+1ZvoMs16TP/5R3fvOBtNrPEOGRsOnpAXmBZSiZQqneMzEhW\nG3s9fepGxwigt9IDrcJIBPk5Znhsg6G4genvtLcCpa1izCGtM9dzb7XaiXBGbs1m\n7YeuETySDT6GGSpViSAsz3UlgSg6WIa+EUxNNoeeDpNEnbLMrfGGTGRTt4z2NLcf\nZWsi3fEd9ZUxZ4zXTVc/8aQIHfZfSL6BgHaFB+eQCz5dDDNn2kbRcV7jddnBJ0su\nFfORixCbF8Od9c1HitUpW/l2dAwVau/lxa0YinLMWGlRKE2xaE5b6/k8obk4fOAP\nrJZsweLzv5aZ73rHLYJb4ygZ6RqoS60zxhqPsr+Vwl2GNDcecQ==\n=pEa+\n-----END PGP SIGNATURE-----", "payload": "tree 5c1a11377c651c606ad7ffaadcf79282117fcf73\nparent e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3\nauthor Pietro Albini <pietro@pietroalbini.org> 1570525307 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012511 +0200\n\nci: extract installing ninja into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "html_url": "https://github.com/rust-lang/rust/commit/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3", "url": "https://api.github.com/repos/rust-lang/rust/commits/e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3", "html_url": "https://github.com/rust-lang/rust/commit/e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3"}], "stats": {"total": 35, "additions": 21, "deletions": 14}, "files": [{"sha": "7aab5658dc05a27f07d615ce8714fd3d8d110776", "filename": "src/ci/azure-pipelines/steps/install-windows-build-deps.yml", "status": "removed", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Finstall-windows-build-deps.yml?ref=e55059a5e6ef0bec7fdf76ce6bd80b2034815cb3", "patch": "@@ -1,13 +0,0 @@\n-steps:\n-\n-# Note that this is originally from the github releases patch of Ninja\n-- bash: |\n-    set -e\n-    mkdir ninja\n-    curl -o ninja.zip https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc/2017-03-15-ninja-win.zip\n-    7z x -oninja ninja.zip\n-    rm ninja.zip\n-    echo \"##vso[task.setvariable variable=RUST_CONFIGURE_ARGS]$RUST_CONFIGURE_ARGS --enable-ninja\"\n-    echo \"##vso[task.prependpath]`pwd`/ninja\"\n-  displayName: Download and install ninja\n-  condition: and(succeeded(), eq(variables['Agent.OS'], 'Windows_NT'))"}, {"sha": "04281e54cf4c1d006ed8b783e2cc78559f7e6ef2", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "patch": "@@ -105,7 +105,11 @@ steps:\n   displayName: Install MinGW\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n \n-- template: install-windows-build-deps.yml\n+- bash: src/ci/scripts/install-ninja.sh\n+  env:\n+    AGENT_OS: $(Agent.OS)\n+  displayName: Install ninja\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n \n # Looks like docker containers have IPv6 disabled by default, so let's turn it\n # on since libstd tests require it"}, {"sha": "c3d0217706ad917ee2601edcb28985430f3624dd", "filename": "src/ci/scripts/install-ninja.sh", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0/src%2Fci%2Fscripts%2Finstall-ninja.sh", "raw_url": "https://github.com/rust-lang/rust/raw/bc9a0dc1b347d5d2ff361d0d501e3836f30affe0/src%2Fci%2Fscripts%2Finstall-ninja.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-ninja.sh?ref=bc9a0dc1b347d5d2ff361d0d501e3836f30affe0", "patch": "@@ -0,0 +1,16 @@\n+#!/bin/bash\n+# Note that this is originally from the github releases patch of Ninja\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+if isWindows; then\n+    mkdir ninja\n+    curl -o ninja.zip https://rust-lang-ci-mirrors.s3-us-west-1.amazonaws.com/rustc/2017-03-15-ninja-win.zip\n+    7z x -oninja ninja.zip\n+    rm ninja.zip\n+    ciCommandSetEnv \"RUST_CONFIGURE_ARGS\" \"${RUST_CONFIGURE_ARGS} --enable-ninja\"\n+    ciCommandAddPath \"$(pwd)/ninja\"\n+fi"}]}