{"sha": "40d19bf64107622763f9b2c1a94e1c7576138b14", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwZDE5YmY2NDEwNzYyMjc2M2Y5YjJjMWE5NGUxYzc1NzYxMzhiMTQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-20T17:53:36Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-20T17:53:36Z"}, "message": "Auto merge of #26456 - Manishearth:rollup, r=Manishearth\n\n- Successful merges: #26410, #26432, #26434, #26439, #26451, #26452\n- Failed merges:", "tree": {"sha": "4a9ea9bd7be8de631c9c5e3cae6bea0c1844fa39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a9ea9bd7be8de631c9c5e3cae6bea0c1844fa39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40d19bf64107622763f9b2c1a94e1c7576138b14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40d19bf64107622763f9b2c1a94e1c7576138b14", "html_url": "https://github.com/rust-lang/rust/commit/40d19bf64107622763f9b2c1a94e1c7576138b14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40d19bf64107622763f9b2c1a94e1c7576138b14/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a49444cefe533960c91e975b2672aeaf0aaba5b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a49444cefe533960c91e975b2672aeaf0aaba5b", "html_url": "https://github.com/rust-lang/rust/commit/2a49444cefe533960c91e975b2672aeaf0aaba5b"}, {"sha": "7effb31fa201213929eb2cefc3c2b52013e307ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/7effb31fa201213929eb2cefc3c2b52013e307ac", "html_url": "https://github.com/rust-lang/rust/commit/7effb31fa201213929eb2cefc3c2b52013e307ac"}], "stats": {"total": 205, "additions": 107, "deletions": 98}, "files": [{"sha": "c8f00ba1acd8db3eed85f5c9415c71d8cfaded3e", "filename": "README.md", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -1,12 +1,14 @@\n # The Rust Programming Language\n \n-Rust is a systems programming language that is fast, memory safe and\n-multithreaded, but does not employ a garbage collector or otherwise\n-impose significant runtime overhead.\n+Rust is a fast systems programming language that guarantees\n+memory safety and offers painless concurrency ([no data races]).\n+It does not employ a garbage collector and has minimal runtime overhead.\n \n This repo contains the code for `rustc`, the Rust compiler, as well\n as standard libraries, tools and documentation for Rust.\n \n+[no data races]: http://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html\n+\n ## Quick Start\n \n Read [\"Installing Rust\"] from [The Book]."}, {"sha": "617c3ddf8dec1eb94fe49751d886d59102e9a730", "filename": "mk/docs.mk", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -77,8 +77,7 @@ ERR_IDX_GEN = $(RPATH_VAR2_T_$(CFG_BUILD)_H_$(CFG_BUILD)) $(ERR_IDX_GEN_EXE)\n \n D := $(S)src/doc\n \n-# FIXME (#25705) eventually may want to put error-index target back here.\n-DOC_TARGETS := trpl style\n+DOC_TARGETS := trpl style error-index\n COMPILER_DOC_TARGETS :=\n DOC_L10N_TARGETS :=\n "}, {"sha": "cbb67014e276025f4e3e3eb1473cbf642ff8a67f", "filename": "src/error-index-generator/main.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ferror-index-generator%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ferror-index-generator%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ferror-index-generator%2Fmain.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -17,6 +17,7 @@ extern crate serialize as rustc_serialize;\n use std::collections::BTreeMap;\n use std::fs::{read_dir, File};\n use std::io::{Read, Write};\n+use std::env;\n use std::path::Path;\n use std::error::Error;\n \n@@ -106,7 +107,8 @@ r##\"<!DOCTYPE html>\n }\n \n fn main_with_result() -> Result<(), Box<Error>> {\n-    let metadata_dir = get_metadata_dir();\n+    let build_arch = try!(env::var(\"CFG_BUILD\"));\n+    let metadata_dir = get_metadata_dir(&build_arch);\n     let err_map = try!(load_all_errors(&metadata_dir));\n     try!(render_error_page(&err_map, Path::new(\"doc/error-index.html\")));\n     Ok(())"}, {"sha": "f2792a525d66b311f3fcdde63fe71af580b2642e", "filename": "src/libcore/ptr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibcore%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibcore%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fptr.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -512,6 +512,11 @@ impl<T: ?Sized> PartialOrd for *mut T {\n #[unstable(feature = \"unique\", reason = \"needs an RFC to flesh out design\")]\n pub struct Unique<T: ?Sized> {\n     pointer: NonZero<*const T>,\n+    // NOTE: this marker has no consequences for variance, but is necessary\n+    // for dropck to understand that we logically own a `T`.\n+    //\n+    // For details, see:\n+    // https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md#phantom-data\n     _marker: PhantomData<T>,\n }\n "}, {"sha": "725bd1d4e0855fee96fef2d68e22385b60f19732", "filename": "src/librustc_typeck/diagnostics.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibrustc_typeck%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibrustc_typeck%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fdiagnostics.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -730,9 +730,11 @@ struct ListNode {\n This type cannot have a well-defined size, because it needs to be arbitrarily\n large (since we would be able to nest `ListNode`s to any depth). Specifically,\n \n-    size of `ListNode` = 1 byte for `head`\n-                       + 1 byte for the discriminant of the `Option`\n-                       + size of `ListNode`\n+```plain\n+size of `ListNode` = 1 byte for `head`\n+                   + 1 byte for the discriminant of the `Option`\n+                   + size of `ListNode`\n+```\n \n One way to fix this is by wrapping `ListNode` in a `Box`, like so:\n "}, {"sha": "02c35e9526d36d071c0f211a1b42f63b7aa48393", "filename": "src/libstd/macros.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibstd%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibstd%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacros.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -331,7 +331,7 @@ pub mod builtin {\n \n     /// A macro which expands to the line number on which it was invoked.\n     ///\n-    /// The expanded expression has type `usize`, and the returned line is not\n+    /// The expanded expression has type `u32`, and the returned line is not\n     /// the invocation of the `line!()` macro itself, but rather the first macro\n     /// invocation leading up to the invocation of the `line!()` macro.\n     ///\n@@ -346,7 +346,7 @@ pub mod builtin {\n \n     /// A macro which expands to the column number on which it was invoked.\n     ///\n-    /// The expanded expression has type `usize`, and the returned column is not\n+    /// The expanded expression has type `u32`, and the returned column is not\n     /// the invocation of the `column!()` macro itself, but rather the first macro\n     /// invocation leading up to the invocation of the `column!()` macro.\n     ///"}, {"sha": "e988b74cb3d1d3ceedbefc4f179d87718a564069", "filename": "src/libsyntax/diagnostics/metadata.rs", "status": "modified", "additions": 29, "deletions": 83, "changes": 112, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibsyntax%2Fdiagnostics%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibsyntax%2Fdiagnostics%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostics%2Fmetadata.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -14,24 +14,18 @@\n //! currently always a crate name.\n \n use std::collections::BTreeMap;\n-use std::env;\n use std::path::PathBuf;\n-use std::fs::{read_dir, create_dir_all, OpenOptions, File};\n-use std::io::{Read, Write};\n+use std::fs::{remove_file, create_dir_all, File};\n+use std::io::Write;\n use std::error::Error;\n-use rustc_serialize::json::{self, as_json};\n+use rustc_serialize::json::as_json;\n \n use codemap::Span;\n use ext::base::ExtCtxt;\n use diagnostics::plugin::{ErrorMap, ErrorInfo};\n \n-pub use self::Uniqueness::*;\n-\n // Default metadata directory to use for extended error JSON.\n-const ERROR_METADATA_DIR_DEFAULT: &'static str = \"tmp/extended-errors\";\n-\n-// The name of the environment variable that sets the metadata dir.\n-const ERROR_METADATA_VAR: &'static str = \"ERROR_METADATA_DIR\";\n+const ERROR_METADATA_PREFIX: &'static str = \"tmp/extended-errors\";\n \n /// JSON encodable/decodable version of `ErrorInfo`.\n #[derive(PartialEq, RustcDecodable, RustcEncodable)]\n@@ -61,84 +55,32 @@ impl ErrorLocation {\n     }\n }\n \n-/// Type for describing the uniqueness of a set of error codes, as returned by `check_uniqueness`.\n-pub enum Uniqueness {\n-    /// All errors in the set checked are unique according to the metadata files checked.\n-    Unique,\n-    /// One or more errors in the set occur in another metadata file.\n-    /// This variant contains the first duplicate error code followed by the name\n-    /// of the metadata file where the duplicate appears.\n-    Duplicate(String, String)\n-}\n-\n-/// Get the directory where metadata files should be stored.\n-pub fn get_metadata_dir() -> PathBuf {\n-    match env::var(ERROR_METADATA_VAR) {\n-        Ok(v) => From::from(v),\n-        Err(_) => From::from(ERROR_METADATA_DIR_DEFAULT)\n-    }\n-}\n-\n-/// Get the path where error metadata for the set named by `name` should be stored.\n-fn get_metadata_path(name: &str) -> PathBuf {\n-    get_metadata_dir().join(format!(\"{}.json\", name))\n+/// Get the directory where metadata for a given `prefix` should be stored.\n+///\n+/// See `output_metadata`.\n+pub fn get_metadata_dir(prefix: &str) -> PathBuf {\n+    PathBuf::from(ERROR_METADATA_PREFIX).join(prefix)\n }\n \n-/// Check that the errors in `err_map` aren't present in any metadata files in the\n-/// metadata directory except the metadata file corresponding to `name`.\n-pub fn check_uniqueness(name: &str, err_map: &ErrorMap) -> Result<Uniqueness, Box<Error>> {\n-    let metadata_dir = get_metadata_dir();\n-    let metadata_path = get_metadata_path(name);\n-\n-    // Create the error directory if it does not exist.\n-    try!(create_dir_all(&metadata_dir));\n-\n-    // Check each file in the metadata directory.\n-    for entry in try!(read_dir(&metadata_dir)) {\n-        let path = try!(entry).path();\n-\n-        // Skip any existing file for this set.\n-        if path == metadata_path {\n-            continue;\n-        }\n-\n-        // Read the metadata file into a string.\n-        let mut metadata_str = String::new();\n-        try!(\n-            File::open(&path).and_then(|mut f|\n-            f.read_to_string(&mut metadata_str))\n-        );\n-\n-        // Parse the JSON contents.\n-        let metadata: ErrorMetadataMap = try!(json::decode(&metadata_str));\n-\n-        // Check for duplicates.\n-        for err in err_map.keys() {\n-            let err_code = err.as_str();\n-            if metadata.contains_key(err_code) {\n-                return Ok(Duplicate(\n-                    err_code.to_string(),\n-                    path.to_string_lossy().into_owned()\n-                ));\n-            }\n-        }\n-    }\n-\n-    Ok(Unique)\n+/// Map `name` to a path in the given directory: <directory>/<name>.json\n+fn get_metadata_path(directory: PathBuf, name: &str) -> PathBuf {\n+    directory.join(format!(\"{}.json\", name))\n }\n \n-/// Write metadata for the errors in `err_map` to disk, to a file corresponding to `name`.\n-pub fn output_metadata(ecx: &ExtCtxt, name: &str, err_map: &ErrorMap)\n+/// Write metadata for the errors in `err_map` to disk, to a file corresponding to `prefix/name`.\n+///\n+/// For our current purposes the prefix is the target architecture and the name is a crate name.\n+/// If an error occurs steps will be taken to ensure that no file is created.\n+pub fn output_metadata(ecx: &ExtCtxt, prefix: &str, name: &str, err_map: &ErrorMap)\n     -> Result<(), Box<Error>>\n {\n-    let metadata_path = get_metadata_path(name);\n+    // Create the directory to place the file in.\n+    let metadata_dir = get_metadata_dir(prefix);\n+    try!(create_dir_all(&metadata_dir));\n \n-    // Open the dump file.\n-    let mut dump_file = try!(OpenOptions::new()\n-        .write(true)\n-        .create(true)\n-        .open(&metadata_path)\n-    );\n+    // Open the metadata file.\n+    let metadata_path = get_metadata_path(metadata_dir, name);\n+    let mut metadata_file = try!(File::create(&metadata_path));\n \n     // Construct a serializable map.\n     let json_map = err_map.iter().map(|(k, &ErrorInfo { description, use_site })| {\n@@ -150,6 +92,10 @@ pub fn output_metadata(ecx: &ExtCtxt, name: &str, err_map: &ErrorMap)\n         (key, value)\n     }).collect::<ErrorMetadataMap>();\n \n-    try!(write!(&mut dump_file, \"{}\", as_json(&json_map)));\n-    Ok(())\n+    // Write the data to the file, deleting it if the write fails.\n+    let result = write!(&mut metadata_file, \"{}\", as_json(&json_map));\n+    if result.is_err() {\n+        try!(remove_file(&metadata_path));\n+    }\n+    Ok(try!(result))\n }"}, {"sha": "aee066807f49a5fef9f6b21071428bf599f2c990", "filename": "src/libsyntax/diagnostics/plugin.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibsyntax%2Fdiagnostics%2Fplugin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Flibsyntax%2Fdiagnostics%2Fplugin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostics%2Fplugin.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -10,6 +10,7 @@\n \n use std::cell::RefCell;\n use std::collections::BTreeMap;\n+use std::env;\n \n use ast;\n use ast::{Ident, Name, TokenTree};\n@@ -20,6 +21,8 @@ use parse::token;\n use ptr::P;\n use util::small_vector::SmallVector;\n \n+use diagnostics::metadata::output_metadata;\n+\n // Maximum width of any line in an extended error description (inclusive).\n const MAX_DESCRIPTION_WIDTH: usize = 80;\n \n@@ -154,7 +157,7 @@ pub fn expand_build_diagnostic_array<'cx>(ecx: &'cx mut ExtCtxt,\n                                           token_tree: &[TokenTree])\n                                           -> Box<MacResult+'cx> {\n     assert_eq!(token_tree.len(), 3);\n-    let (_crate_name, name) = match (&token_tree[0], &token_tree[2]) {\n+    let (crate_name, name) = match (&token_tree[0], &token_tree[2]) {\n         (\n             // Crate name.\n             &ast::TtToken(_, token::Ident(ref crate_name, _)),\n@@ -164,9 +167,18 @@ pub fn expand_build_diagnostic_array<'cx>(ecx: &'cx mut ExtCtxt,\n         _ => unreachable!()\n     };\n \n-    // FIXME (#25705): we used to ensure error code uniqueness and\n-    // output error description JSON metadata here, but the approach\n-    // employed was too brittle.\n+    // Output error metadata to `tmp/extended-errors/<target arch>/<crate name>.json`\n+    let target_triple = env::var(\"CFG_COMPILER_HOST_TRIPLE\")\n+        .ok().expect(\"unable to determine target arch from $CFG_COMPILER_HOST_TRIPLE\");\n+\n+    with_registered_diagnostics(|diagnostics| {\n+        if let Err(e) = output_metadata(ecx, &target_triple, crate_name, &diagnostics) {\n+            ecx.span_bug(span, &format!(\n+                \"error writing metadata for triple `{}` and crate `{}`, error: {}, cause: {:?}\",\n+                target_triple, crate_name, e.description(), e.cause()\n+            ));\n+        }\n+    });\n \n     // Construct the output expression.\n     let (count, expr) ="}, {"sha": "bbb540200b436d5ca1d6a0de9fd9988899258f77", "filename": "src/test/compile-fail/issue-18058.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ftest%2Fcompile-fail%2Fissue-18058.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ftest%2Fcompile-fail%2Fissue-18058.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-18058.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+impl Undefined {}\n+//~^ ERROR use of undeclared type name `Undefined`\n+\n+fn main() {}"}, {"sha": "34c16bd4003ad554fee90386baae54c9362f8906", "filename": "src/test/run-pass/issue-24227.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ftest%2Frun-pass%2Fissue-24227.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40d19bf64107622763f9b2c1a94e1c7576138b14/src%2Ftest%2Frun-pass%2Fissue-24227.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-24227.rs?ref=40d19bf64107622763f9b2c1a94e1c7576138b14", "patch": "@@ -0,0 +1,27 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// This resulted in an ICE. Test for future-proofing\n+// Issue #24227\n+\n+#![allow(unused)]\n+\n+struct Foo<'a> {\n+    x: &'a u8\n+}\n+\n+impl<'a> Foo<'a> {\n+    fn foo() {\n+        let mut tmp: Self;\n+    }\n+\n+}\n+\n+fn main() {}"}]}