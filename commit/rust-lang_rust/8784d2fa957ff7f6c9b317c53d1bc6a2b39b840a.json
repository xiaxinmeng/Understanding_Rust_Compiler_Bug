{"sha": "8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3ODRkMmZhOTU3ZmY3ZjZjOWIzMTdjNTNkMWJjNmEyYjM5Yjg0MGE=", "commit": {"author": {"name": "Flavio Percoco", "email": "flaper87@gmail.com", "date": "2014-02-18T14:19:44Z"}, "committer": {"name": "Flavio Percoco", "email": "flaper87@gmail.com", "date": "2014-02-27T08:24:17Z"}, "message": "Forbid moves out of static items Closes #10577", "tree": {"sha": "1148cd19d8126cfc09f22868f2550884643dee0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1148cd19d8126cfc09f22868f2550884643dee0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "html_url": "https://github.com/rust-lang/rust/commit/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/comments", "author": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c75dd78ccb07f395285acebeb8617a7fe6911f71", "url": "https://api.github.com/repos/rust-lang/rust/commits/c75dd78ccb07f395285acebeb8617a7fe6911f71", "html_url": "https://github.com/rust-lang/rust/commit/c75dd78ccb07f395285acebeb8617a7fe6911f71"}], "stats": {"total": 56, "additions": 36, "deletions": 20}, "files": [{"sha": "7ec9f1f8f47953f986362921c711cc9177fdb6ac", "filename": "src/librustc/middle/borrowck/gather_loans/gather_moves.rs", "status": "modified", "additions": 1, "deletions": 14, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans%2Fgather_moves.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans%2Fgather_moves.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans%2Fgather_moves.rs?ref=8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "patch": "@@ -104,7 +104,7 @@ fn check_is_legal_to_move_from(bccx: &BorrowckCtxt,\n         mc::cat_deref(_, _, mc::BorrowedPtr(..)) |\n         mc::cat_deref(_, _, mc::GcPtr) |\n         mc::cat_deref(_, _, mc::UnsafePtr(..)) |\n-        mc::cat_upvar(..) |\n+        mc::cat_upvar(..) | mc::cat_static_item |\n         mc::cat_copied_upvar(mc::CopiedUpvar { onceness: ast::Many, .. }) => {\n             bccx.span_err(\n                 cmt0.span,\n@@ -120,19 +120,6 @@ fn check_is_legal_to_move_from(bccx: &BorrowckCtxt,\n             true\n         }\n \n-        // It seems strange to allow a move out of a static item,\n-        // but what happens in practice is that you have a\n-        // reference to a constant with a type that should be\n-        // moved, like `None::<~int>`.  The type of this constant\n-        // is technically `Option<~int>`, which moves, but we know\n-        // that the content of static items will never actually\n-        // contain allocated pointers, so we can just memcpy it.\n-        // Since static items can never have allocated memory,\n-        // this is ok. For now anyhow.\n-        mc::cat_static_item => {\n-            true\n-        }\n-\n         mc::cat_rvalue(..) |\n         mc::cat_local(..) |\n         mc::cat_arg(..) => {"}, {"sha": "a7e5573ccfc6666b1221584ac392c18df478b43e", "filename": "src/test/compile-fail/borrowck-move-out-of-static-item.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fborrowck-move-out-of-static-item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fborrowck-move-out-of-static-item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck-move-out-of-static-item.rs?ref=8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Ensure that moves out of static items is forbidden\n+\n+use std::kinds::marker;\n+\n+struct Foo {\n+    foo: int,\n+    nopod: marker::NoPod\n+}\n+\n+static BAR: Foo = Foo{foo: 5, nopod: marker::NoPod};\n+\n+\n+fn test(f: Foo) {\n+    let _f = Foo{foo: 4, ..f};\n+}\n+\n+fn main() {\n+    test(BAR); //~ ERROR cannot move out of static item\n+}"}, {"sha": "f089904dd91497552f99552e89fca3d5b8f64d66", "filename": "src/test/compile-fail/static-items-cant-move.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fstatic-items-cant-move.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fstatic-items-cant-move.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstatic-items-cant-move.rs?ref=8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "patch": "@@ -25,5 +25,5 @@ fn test(f: Foo) {\n }\n \n fn main() {\n-    test(BAR);\n+    test(BAR); //~ ERROR cannot move out of static item\n }"}, {"sha": "5c0e7e90aa932eedf90aadff44b7cfe29203cb00", "filename": "src/test/compile-fail/std-uncopyable-atomics.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fstd-uncopyable-atomics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Fcompile-fail%2Fstd-uncopyable-atomics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstd-uncopyable-atomics.rs?ref=8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "patch": "@@ -16,13 +16,13 @@ use std::sync::atomics::*;\n use std::ptr;\n \n fn main() {\n-    let x = INIT_ATOMIC_FLAG;\n+    let x = INIT_ATOMIC_FLAG; //~ ERROR cannot move out of static item\n     let x = *&x; //~ ERROR: cannot move out of dereference\n-    let x = INIT_ATOMIC_BOOL;\n+    let x = INIT_ATOMIC_BOOL; //~ ERROR cannot move out of static item\n     let x = *&x; //~ ERROR: cannot move out of dereference\n-    let x = INIT_ATOMIC_INT;\n+    let x = INIT_ATOMIC_INT; //~ ERROR cannot move out of static item\n     let x = *&x; //~ ERROR: cannot move out of dereference\n-    let x = INIT_ATOMIC_UINT;\n+    let x = INIT_ATOMIC_UINT; //~ ERROR cannot move out of static item\n     let x = *&x; //~ ERROR: cannot move out of dereference\n     let x: AtomicPtr<uint> = AtomicPtr::new(ptr::mut_null());\n     let x = *&x; //~ ERROR: cannot move out of dereference"}, {"sha": "5afffb3d029f71cb04f94a66fc1a0ba264b0a7f7", "filename": "src/test/run-pass/issue-6919.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Frun-pass%2Fissue-6919.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a/src%2Ftest%2Frun-pass%2Fissue-6919.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-6919.rs?ref=8784d2fa957ff7f6c9b317c53d1bc6a2b39b840a", "patch": "@@ -15,6 +15,6 @@\n extern crate issue6919_3;\n \n pub fn main() {\n-    issue6919_3::D.k;\n+    let _ = issue6919_3::D.k;\n }\n "}]}