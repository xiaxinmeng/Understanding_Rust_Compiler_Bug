{"sha": "3f317ede41d69a8fd5e1690c4ed509a4e826ea11", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmMzE3ZWRlNDFkNjlhOGZkNWUxNjkwYzRlZDUwOWE0ZTgyNmVhMTE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-03T20:03:32Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-03T21:41:05Z"}, "message": "rustc: Name type glue properly", "tree": {"sha": "f05696b1e3133dfdb4e95adbb371dee3e385949d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f05696b1e3133dfdb4e95adbb371dee3e385949d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f317ede41d69a8fd5e1690c4ed509a4e826ea11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f317ede41d69a8fd5e1690c4ed509a4e826ea11", "html_url": "https://github.com/rust-lang/rust/commit/3f317ede41d69a8fd5e1690c4ed509a4e826ea11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f317ede41d69a8fd5e1690c4ed509a4e826ea11/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c85712db3a647595c57d9f5ad2d4306df1f2d69", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c85712db3a647595c57d9f5ad2d4306df1f2d69", "html_url": "https://github.com/rust-lang/rust/commit/1c85712db3a647595c57d9f5ad2d4306df1f2d69"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "4c9e299045fd100745ed0547d21e56c4e0ec3130", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3f317ede41d69a8fd5e1690c4ed509a4e826ea11/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f317ede41d69a8fd5e1690c4ed509a4e826ea11/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=3f317ede41d69a8fd5e1690c4ed509a4e826ea11", "patch": "@@ -184,7 +184,7 @@ fn path_name(vec[str] path) -> str {\n }\n \n \n-fn mangle_name_by_type(@crate_ctxt ccx, vec[str] path, ty.t t) -> str {\n+fn get_type_sha1(@crate_ctxt ccx, ty.t t) -> str {\n     auto hash = \"\";\n     alt (ccx.type_sha1s.find(t)) {\n         case (some[str](?h)) { hash = h; }\n@@ -200,9 +200,24 @@ fn mangle_name_by_type(@crate_ctxt ccx, vec[str] path, ty.t t) -> str {\n             ccx.type_sha1s.insert(t, hash);\n         }\n     }\n+    ret hash;\n+}\n+\n+fn mangle_name_by_type(@crate_ctxt ccx, vec[str] path, ty.t t) -> str {\n+    auto hash = get_type_sha1(ccx, t);\n     ret sep() + \"rust\" + sep() + hash + sep() + path_name(path);\n }\n \n+fn mangle_name_by_type_only(@crate_ctxt ccx, ty.t t, str name) -> str {\n+    auto f = metadata.def_to_str;\n+    auto cx = @rec(ds=f, tcx=ccx.tcx,\n+                   use_abbrevs=false, abbrevs=ccx.type_abbrevs);\n+    auto s = metadata.Encode.ty_str(cx, t);\n+\n+    auto hash = get_type_sha1(ccx, t);\n+    ret sep() + \"rust\" + sep() + hash + sep() + name + \"_\" + s;\n+}\n+\n fn mangle_name_by_seq(@crate_ctxt ccx, vec[str] path, str flav) -> str {\n     ret sep() + \"rust\" + sep()\n         + ccx.names.next(flav) + sep()\n@@ -1774,8 +1789,7 @@ fn declare_generic_glue(@local_ctxt cx,\n                         ty.t t,\n                         TypeRef llfnty,\n                         str name) -> ValueRef {\n-    auto gcx = @rec(path=vec(\"glue\", name) with *cx);\n-    auto fn_nm = mangle_name_by_seq(cx.ccx, cx.path, \"glue\");\n+    auto fn_nm = mangle_name_by_type_only(cx.ccx, t, \"glue_\" + name);\n     fn_nm = sanitize(fn_nm);\n     auto llfn = decl_internal_fastcall_fn(cx.ccx.llmod, fn_nm, llfnty);\n     ret llfn;"}]}