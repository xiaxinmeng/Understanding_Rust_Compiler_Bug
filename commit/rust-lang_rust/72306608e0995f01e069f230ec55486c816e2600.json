{"sha": "72306608e0995f01e069f230ec55486c816e2600", "node_id": "C_kwDOAAsO6NoAKDcyMzA2NjA4ZTA5OTVmMDFlMDY5ZjIzMGVjNTU0ODZjODE2ZTI2MDA", "commit": {"author": {"name": "yvt", "email": "i@yvt.jp", "date": "2022-03-23T14:16:45Z"}, "committer": {"name": "yvt", "email": "i@yvt.jp", "date": "2022-03-23T14:16:45Z"}, "message": "Add a simple argument parser to `build.sh`", "tree": {"sha": "d0195eb3954353409e853d3874197994a88365d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d0195eb3954353409e853d3874197994a88365d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/72306608e0995f01e069f230ec55486c816e2600", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/72306608e0995f01e069f230ec55486c816e2600", "html_url": "https://github.com/rust-lang/rust/commit/72306608e0995f01e069f230ec55486c816e2600", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/72306608e0995f01e069f230ec55486c816e2600/comments", "author": {"login": "yvt", "id": 5253988, "node_id": "MDQ6VXNlcjUyNTM5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/5253988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yvt", "html_url": "https://github.com/yvt", "followers_url": "https://api.github.com/users/yvt/followers", "following_url": "https://api.github.com/users/yvt/following{/other_user}", "gists_url": "https://api.github.com/users/yvt/gists{/gist_id}", "starred_url": "https://api.github.com/users/yvt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yvt/subscriptions", "organizations_url": "https://api.github.com/users/yvt/orgs", "repos_url": "https://api.github.com/users/yvt/repos", "events_url": "https://api.github.com/users/yvt/events{/privacy}", "received_events_url": "https://api.github.com/users/yvt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yvt", "id": 5253988, "node_id": "MDQ6VXNlcjUyNTM5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/5253988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yvt", "html_url": "https://github.com/yvt", "followers_url": "https://api.github.com/users/yvt/followers", "following_url": "https://api.github.com/users/yvt/following{/other_user}", "gists_url": "https://api.github.com/users/yvt/gists{/gist_id}", "starred_url": "https://api.github.com/users/yvt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yvt/subscriptions", "organizations_url": "https://api.github.com/users/yvt/orgs", "repos_url": "https://api.github.com/users/yvt/repos", "events_url": "https://api.github.com/users/yvt/events{/privacy}", "received_events_url": "https://api.github.com/users/yvt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44c0204af3ac285474a779f777f0adc158a8344b", "url": "https://api.github.com/repos/rust-lang/rust/commits/44c0204af3ac285474a779f777f0adc158a8344b", "html_url": "https://github.com/rust-lang/rust/commit/44c0204af3ac285474a779f777f0adc158a8344b"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "7e8a5ecd88ee3b817207cde2822a1d871be2b0d3", "filename": "build.sh", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/72306608e0995f01e069f230ec55486c816e2600/build.sh", "raw_url": "https://github.com/rust-lang/rust/raw/72306608e0995f01e069f230ec55486c816e2600/build.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.sh?ref=72306608e0995f01e069f230ec55486c816e2600", "patch": "@@ -3,6 +3,21 @@\n #set -x\n set -e\n \n+codegen_channel=debug\n+\n+while [[ $# -gt 0 ]]; do\n+    case $1 in\n+        --release)\n+            codegen_channel=release\n+            shift\n+            ;;\n+        *)\n+            echo \"Unknown option $1\"\n+            exit 1\n+            ;;\n+    esac\n+done\n+\n if [ -f ./gcc_path ]; then\n     export GCC_PATH=$(cat gcc_path)\n else\n@@ -21,7 +36,7 @@ if [[ \"$1\" == \"--features\" ]]; then\n     shift\n fi\n \n-if [[ \"$1\" == \"--release\" ]]; then\n+if [[ \"$codegen_channel\" == \"release\" ]]; then\n     export CHANNEL='release'\n     CARGO_INCREMENTAL=1 cargo rustc --release $features\n else\n@@ -37,3 +52,4 @@ mkdir -p target/out/gccjit\n \n echo \"[BUILD] sysroot\"\n time ./build_sysroot/build_sysroot.sh $CHANNEL\n+"}]}