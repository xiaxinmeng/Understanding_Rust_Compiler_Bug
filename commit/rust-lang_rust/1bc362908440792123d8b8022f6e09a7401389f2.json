{"sha": "1bc362908440792123d8b8022f6e09a7401389f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiYzM2MjkwODQ0MDc5MjEyM2Q4YjgwMjJmNmUwOWE3NDAxMzg5ZjI=", "commit": {"author": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2019-12-25T23:22:33Z"}, "committer": {"name": "Christian Poveda", "email": "git@christianpoveda.xyz", "date": "2019-12-25T23:22:33Z"}, "message": "do padding correctly", "tree": {"sha": "67f37ca56c311f5a8ab67adbd6848c9222e1f0e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67f37ca56c311f5a8ab67adbd6848c9222e1f0e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1bc362908440792123d8b8022f6e09a7401389f2", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niI4EABYIADYWIQRsB8A/3NrzTlMMjT0nUl7150IKUAUCXgPvORgcZ2l0QGNocmlz\ndGlhbnBvdmVkYS54eXoACgkQJ1Je9edCClC9twEAocBwx+jbSuKpe/vQ+uDadB1b\ntbv36kxU2aNHsUEcdWUBAPtAc/ay0a8SokMB5/BKxsp8P+aj1NlHoJQRAXYetpoD\n=LAWI\n-----END PGP SIGNATURE-----", "payload": "tree 67f37ca56c311f5a8ab67adbd6848c9222e1f0e7\nparent d17625900234f9643180075ea44756c98a92819a\nauthor Christian Poveda <git@christianpoveda.xyz> 1577316153 -0500\ncommitter Christian Poveda <git@christianpoveda.xyz> 1577316153 -0500\n\ndo padding correctly\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1bc362908440792123d8b8022f6e09a7401389f2", "html_url": "https://github.com/rust-lang/rust/commit/1bc362908440792123d8b8022f6e09a7401389f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1bc362908440792123d8b8022f6e09a7401389f2/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d17625900234f9643180075ea44756c98a92819a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d17625900234f9643180075ea44756c98a92819a", "html_url": "https://github.com/rust-lang/rust/commit/d17625900234f9643180075ea44756c98a92819a"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "8cd1afd02c9f7b0b7195d82b1aaa687c5ef8516c", "filename": "src/shims/fs.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1bc362908440792123d8b8022f6e09a7401389f2/src%2Fshims%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1bc362908440792123d8b8022f6e09a7401389f2/src%2Fshims%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Ffs.rs?ref=1bc362908440792123d8b8022f6e09a7401389f2", "patch": "@@ -302,12 +302,11 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n         let blksize_t_layout = this.libc_ty_layout(\"blksize_t\")?;\n         let uint32_t_layout = this.libc_ty_layout(\"uint32_t\")?;\n \n-        // We need to add 32 bits of padding after `st_rdev` if we are in a 64-bit platform. To do\n-        // this, we store `st_rdev` as a `c_long` instead of a `dev_t`.\n-        let st_rdev_layout = if this.tcx.sess.target.ptr_width == 64 {\n-            long_layout\n+        // We need to add 32 bits of padding after `st_rdev` if we are in a 64-bit platform.\n+        let pad_layout = if this.tcx.sess.target.ptr_width == 64 {\n+            uint32_t_layout\n         } else {\n-            dev_t_layout\n+            this.layout_of(this.tcx.mk_unit())?\n         };\n \n         let imms = [\n@@ -317,7 +316,8 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n             immty_from_uint_checked(0u128, ino_t_layout)?, // st_ino\n             immty_from_uint_checked(0u128, uid_t_layout)?, // st_uid\n             immty_from_uint_checked(0u128, gid_t_layout)?, // st_gid\n-            immty_from_uint_checked(0u128, st_rdev_layout)?, // st_rdev\n+            immty_from_uint_checked(0u128, dev_t_layout)?, // st_rdev\n+            immty_from_uint_checked(0u128, pad_layout)?, // padding for 64-bit targets\n             immty_from_uint_checked(access_sec, time_t_layout)?, // st_atime\n             immty_from_uint_checked(access_nsec, long_layout)?, // st_atime_nsec\n             immty_from_uint_checked(modified_sec, time_t_layout)?, // st_mtime"}]}