{"sha": "e7f04857efc4ebc369e588d194e5288ef57752e7", "node_id": "C_kwDOAAsO6NoAKGU3ZjA0ODU3ZWZjNGViYzM2OWU1ODhkMTk0ZTUyODhlZjU3NzUyZTc", "commit": {"author": {"name": "Eliza Weisman", "email": "eliza@buoyant.io", "date": "2021-10-07T16:17:57Z"}, "committer": {"name": "Eliza Weisman", "email": "eliza@buoyant.io", "date": "2021-10-07T16:23:42Z"}, "message": "rustc_driver: Enable the `WARN` log level by default\n\nThis commit changes the `tracing_subscriber` initialization in\n`rustc_driver` so that the `WARN` verbosity level is enabled by default\nwhen the `RUSTC_LOG` env variable is empty. If the `RUSTC_LOG` env\nvariable is set, the filter string in the environment variable is\nhonored, instead.\n\nFixes #76824\nCloses #89623\n\ncc @eddyb, @oli-obk", "tree": {"sha": "a2c8394cfe941e7c24bd1df5ca390b36b1171ed1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2c8394cfe941e7c24bd1df5ca390b36b1171ed1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7f04857efc4ebc369e588d194e5288ef57752e7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEECszHvuPUbxBZfriN+cGllcOBRDYFAmFfHw4ACgkQ+cGllcOB\nRDaY0xAA2o6aaxo7wFk7djZbdR31cOCDO5byajk4U4D70nStW0zZk7vHY9izn5/g\ntxlzD5m7znXuk2DeuoleA22iIEIg9Pvxpsv8bnildRaOwX1aRNuG4WlTLXLecwvF\nuV5+YbJ+SfVbNihXOVL4qtsrrSzsJZo7TVCdrfHDC58MCESuKSCQ0VqBCbU2hlsH\ns2n8vZBcXqE5FgxuRN+G6iwq61pXqsk/OTSQRNBYmL0deXlLEW+JrgxI6OZLsOcd\n4zLQCuiyjCZvqitIV0oo0hL+jd+6lLT/W+6JvJnh8H/hSBcxSvVYeplixsLtzzqY\nlB6oaIumCq1iW8Fpb7fQ8DY5MF6T0zy+j48r3iS1dm8lndFG5PYkAuTYU5xviLAu\nyrIt/0mAcB07GZctE3bWaFe/YjLjjAMBXUq7bV34CNPygvjtN6DxP41EFqCUTwLk\nM/CMbwcS3Gpo3s0v3Id3kHBMcxWWMTBINpMvkTmk7Ey/Xwk4apLfjRYC8Wh2sYnz\n4oF51ZuHHLhgmUK5Lb4oEnA9SZd8XpgNzJOtlnsrrCK+q7YGqco9WxvXI++KN394\nkKd52NO/7uic5yRpLLRfGD5i8pXdbQU6Q8t60MrkaaJzA13WIOuz/zkLdEpUfPUf\nHf5KwRMF8CZzGZvgGQ4BpRna068zfIYSAzmAOPI8rLgSe9J6rS0=\n=wRxH\n-----END PGP SIGNATURE-----", "payload": "tree a2c8394cfe941e7c24bd1df5ca390b36b1171ed1\nparent 680ff86391f19e12b485293f01372036e85ba87c\nauthor Eliza Weisman <eliza@buoyant.io> 1633623477 -0700\ncommitter Eliza Weisman <eliza@buoyant.io> 1633623822 -0700\n\nrustc_driver: Enable the `WARN` log level by default\n\nThis commit changes the `tracing_subscriber` initialization in\n`rustc_driver` so that the `WARN` verbosity level is enabled by default\nwhen the `RUSTC_LOG` env variable is empty. If the `RUSTC_LOG` env\nvariable is set, the filter string in the environment variable is\nhonored, instead.\n\nFixes #76824\nCloses #89623\n\ncc @eddyb, @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7f04857efc4ebc369e588d194e5288ef57752e7", "html_url": "https://github.com/rust-lang/rust/commit/e7f04857efc4ebc369e588d194e5288ef57752e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7f04857efc4ebc369e588d194e5288ef57752e7/comments", "author": {"login": "hawkw", "id": 2796466, "node_id": "MDQ6VXNlcjI3OTY0NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2796466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawkw", "html_url": "https://github.com/hawkw", "followers_url": "https://api.github.com/users/hawkw/followers", "following_url": "https://api.github.com/users/hawkw/following{/other_user}", "gists_url": "https://api.github.com/users/hawkw/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawkw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawkw/subscriptions", "organizations_url": "https://api.github.com/users/hawkw/orgs", "repos_url": "https://api.github.com/users/hawkw/repos", "events_url": "https://api.github.com/users/hawkw/events{/privacy}", "received_events_url": "https://api.github.com/users/hawkw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hawkw", "id": 2796466, "node_id": "MDQ6VXNlcjI3OTY0NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2796466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawkw", "html_url": "https://github.com/hawkw", "followers_url": "https://api.github.com/users/hawkw/followers", "following_url": "https://api.github.com/users/hawkw/following{/other_user}", "gists_url": "https://api.github.com/users/hawkw/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawkw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawkw/subscriptions", "organizations_url": "https://api.github.com/users/hawkw/orgs", "repos_url": "https://api.github.com/users/hawkw/repos", "events_url": "https://api.github.com/users/hawkw/events{/privacy}", "received_events_url": "https://api.github.com/users/hawkw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "680ff86391f19e12b485293f01372036e85ba87c", "url": "https://api.github.com/repos/rust-lang/rust/commits/680ff86391f19e12b485293f01372036e85ba87c", "html_url": "https://github.com/rust-lang/rust/commit/680ff86391f19e12b485293f01372036e85ba87c"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "c658bf322e5180812576ce77c100c20902450ee9", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/e7f04857efc4ebc369e588d194e5288ef57752e7/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7f04857efc4ebc369e588d194e5288ef57752e7/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=e7f04857efc4ebc369e588d194e5288ef57752e7", "patch": "@@ -1253,12 +1253,16 @@ pub fn init_rustc_env_logger() {\n /// tracing crate version. In contrast to `init_rustc_env_logger` it allows you to choose an env var\n /// other than `RUSTC_LOG`.\n pub fn init_env_logger(env: &str) {\n-    // Don't register a dispatcher if there's no filter to print anything\n-    match std::env::var(env) {\n-        Err(_) => return,\n-        Ok(s) if s.is_empty() => return,\n-        Ok(_) => {}\n-    }\n+    use tracing_subscriber::{\n+        filter::{self, EnvFilter, LevelFilter},\n+        layer::SubscriberExt,\n+    };\n+\n+    let filter = match std::env::var(env) {\n+        Ok(env) => EnvFilter::from_env(env),\n+        _ => EnvFilter::default().add_directive(filter::Directive::from(LevelFilter: WARN)),\n+    };\n+\n     let color_logs = match std::env::var(String::from(env) + \"_COLOR\") {\n         Ok(value) => match value.as_ref() {\n             \"always\" => true,\n@@ -1278,7 +1282,7 @@ pub fn init_env_logger(env: &str) {\n             \"non-Unicode log color value: expected one of always, never, or auto\",\n         ),\n     };\n-    let filter = tracing_subscriber::EnvFilter::from_env(env);\n+\n     let layer = tracing_tree::HierarchicalLayer::default()\n         .with_writer(io::stderr)\n         .with_indent_lines(true)\n@@ -1288,7 +1292,6 @@ pub fn init_env_logger(env: &str) {\n     #[cfg(parallel_compiler)]\n     let layer = layer.with_thread_ids(true).with_thread_names(true);\n \n-    use tracing_subscriber::layer::SubscriberExt;\n     let subscriber = tracing_subscriber::Registry::default().with(filter).with(layer);\n     tracing::subscriber::set_global_default(subscriber).unwrap();\n }"}]}