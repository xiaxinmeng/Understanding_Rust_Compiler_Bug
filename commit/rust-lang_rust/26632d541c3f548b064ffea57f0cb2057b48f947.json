{"sha": "26632d541c3f548b064ffea57f0cb2057b48f947", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2NjMyZDU0MWMzZjU0OGIwNjRmZmVhNTdmMGNiMjA1N2I0OGY5NDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-08T05:01:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-08T05:01:37Z"}, "message": "auto merge of #13976 : pnkfelix/rust/fsk-fix-13965, r=alexcrichton\n\nFix #13965.\r\n\r\nThis commit adopts the second strategy I outlined in #13965, where the bulk of the code is still \"smoke tested\" (in the sense that rustdoc attempts to run it, sending all of the generated output into a locally allocated `MemWriter`).  The part of the code that is ignored (but included in the presentation) is isolated to a three-line `main` function that invokes the core rendering routine.\r\n\r\nIn the generated rustdoc output, this leads to a small break between the two code blocks, but I do not think this is a large issue.", "tree": {"sha": "af2e71bd60eaa1f9d1356c40d465d935260b1b52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af2e71bd60eaa1f9d1356c40d465d935260b1b52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26632d541c3f548b064ffea57f0cb2057b48f947", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26632d541c3f548b064ffea57f0cb2057b48f947", "html_url": "https://github.com/rust-lang/rust/commit/26632d541c3f548b064ffea57f0cb2057b48f947", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26632d541c3f548b064ffea57f0cb2057b48f947/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0fcb4eb3d516017c7c2fa8d17e7b8b82bdc065b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0fcb4eb3d516017c7c2fa8d17e7b8b82bdc065b", "html_url": "https://github.com/rust-lang/rust/commit/e0fcb4eb3d516017c7c2fa8d17e7b8b82bdc065b"}, {"sha": "a22413b46aa57ed22e59a9c0e4d581d1eabfe2b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/a22413b46aa57ed22e59a9c0e4d581d1eabfe2b2", "html_url": "https://github.com/rust-lang/rust/commit/a22413b46aa57ed22e59a9c0e4d581d1eabfe2b2"}], "stats": {"total": 51, "additions": 39, "deletions": 12}, "files": [{"sha": "f2d4d84f601f5142889c6254d097a6d6e8c007ce", "filename": "src/libgraphviz/lib.rs", "status": "modified", "additions": 39, "deletions": 12, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/26632d541c3f548b064ffea57f0cb2057b48f947/src%2Flibgraphviz%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26632d541c3f548b064ffea57f0cb2057b48f947/src%2Flibgraphviz%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibgraphviz%2Flib.rs?ref=26632d541c3f548b064ffea57f0cb2057b48f947", "patch": "@@ -54,11 +54,9 @@ type Nd = int;\n type Ed = (int,int);\n struct Edges(Vec<Ed>);\n \n-pub fn main() {\n-    use std::io::File;\n+pub fn render_to<W:Writer>(output: &mut W) {\n     let edges = Edges(vec!((0,1), (0,2), (1,3), (2,3), (3,4), (4,4)));\n-    let mut f = File::create(&Path::new(\"example1.dot\"));\n-    dot::render(&edges, &mut f).unwrap()\n+    dot::render(&edges, output).unwrap()\n }\n \n impl<'a> dot::Labeller<'a, Nd, Ed> for Edges {\n@@ -91,6 +89,17 @@ impl<'a> dot::GraphWalk<'a, Nd, Ed> for Edges {\n \n     fn target(&self, e: &Ed) -> Nd { let &(_,t) = e; t }\n }\n+\n+# pub fn main() { use std::io::MemWriter; render_to(&mut MemWriter::new()) }\n+```\n+\n+```no_run\n+# pub fn render_to<W:Writer>(output: &mut W) { unimplemented!() }\n+pub fn main() {\n+    use std::io::File;\n+    let mut f = File::create(&Path::new(\"example1.dot\"));\n+    render_to(&mut f)\n+}\n ```\n \n Output from first example (in `example1.dot`):\n@@ -140,19 +149,17 @@ entity `&sube`).\n ```rust\n use dot = graphviz;\n use std::str;\n-use std::io::File;\n \n type Nd = uint;\n type Ed<'a> = &'a (uint, uint);\n struct Graph { nodes: Vec<&'static str>, edges: Vec<(uint,uint)> }\n \n-pub fn main() {\n+pub fn render_to<W:Writer>(output: &mut W) {\n     let nodes = vec!(\"{x,y}\",\"{x}\",\"{y}\",\"{}\");\n     let edges = vec!((0,1), (0,2), (1,3), (2,3));\n     let graph = Graph { nodes: nodes, edges: edges };\n \n-    let mut f = File::create(&Path::new(\"example2.dot\"));\n-    dot::render(&graph, &mut f).unwrap()\n+    dot::render(&graph, output).unwrap()\n }\n \n impl<'a> dot::Labeller<'a, Nd, Ed<'a>> for Graph {\n@@ -174,6 +181,17 @@ impl<'a> dot::GraphWalk<'a, Nd, Ed<'a>> for Graph {\n     fn source(&self, e: &Ed) -> Nd { let & &(s,_) = e; s }\n     fn target(&self, e: &Ed) -> Nd { let & &(_,t) = e; t }\n }\n+\n+# pub fn main() { use std::io::MemWriter; render_to(&mut MemWriter::new()) }\n+```\n+\n+```no_run\n+# pub fn render_to<W:Writer>(output: &mut W) { unimplemented!() }\n+pub fn main() {\n+    use std::io::File;\n+    let mut f = File::create(&Path::new(\"example2.dot\"));\n+    render_to(&mut f)\n+}\n ```\n \n The third example is similar to the second, except now each node and\n@@ -187,19 +205,17 @@ Hasse-diagram for the subsets of the set `{x, y}`.\n ```rust\n use dot = graphviz;\n use std::str;\n-use std::io::File;\n \n type Nd<'a> = (uint, &'a str);\n type Ed<'a> = (Nd<'a>, Nd<'a>);\n struct Graph { nodes: Vec<&'static str>, edges: Vec<(uint,uint)> }\n \n-pub fn main() {\n+pub fn render_to<W:Writer>(output: &mut W) {\n     let nodes = vec!(\"{x,y}\",\"{x}\",\"{y}\",\"{}\");\n     let edges = vec!((0,1), (0,2), (1,3), (2,3));\n     let graph = Graph { nodes: nodes, edges: edges };\n \n-    let mut f = File::create(&Path::new(\"example3.dot\"));\n-    dot::render(&graph, &mut f).unwrap()\n+    dot::render(&graph, output).unwrap()\n }\n \n impl<'a> dot::Labeller<'a, Nd<'a>, Ed<'a>> for Graph {\n@@ -229,6 +245,17 @@ impl<'a> dot::GraphWalk<'a, Nd<'a>, Ed<'a>> for Graph {\n     fn source(&self, e: &Ed<'a>) -> Nd<'a> { let &(s,_) = e; s }\n     fn target(&self, e: &Ed<'a>) -> Nd<'a> { let &(_,t) = e; t }\n }\n+\n+# pub fn main() { use std::io::MemWriter; render_to(&mut MemWriter::new()) }\n+```\n+\n+```no_run\n+# pub fn render_to<W:Writer>(output: &mut W) { unimplemented!() }\n+pub fn main() {\n+    use std::io::File;\n+    let mut f = File::create(&Path::new(\"example3.dot\"));\n+    render_to(&mut f)\n+}\n ```\n \n # References"}]}