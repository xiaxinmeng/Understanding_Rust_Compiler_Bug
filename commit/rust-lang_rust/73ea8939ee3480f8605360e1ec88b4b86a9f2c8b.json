{"sha": "73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczZWE4OTM5ZWUzNDgwZjg2MDUzNjBlMWVjODhiNGI4NmE5ZjJjOGI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-16T17:51:01Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-16T19:34:30Z"}, "message": "Rollup merge of #49931 - csmoe:end_span, r=estebank\n\nFix incorrect span in `&mut` suggestion\n\nFixes #49859", "tree": {"sha": "ce2b295581c065067d18e4934226d1b413da2dd3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce2b295581c065067d18e4934226d1b413da2dd3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlrU+sYACgkQ/vbIBR0O\nATyojxAAtl3sjM12XoRk4xnK4egwewlW1XHxth2rR9AzXNjsx6eoPgoJKYxO8iim\nrSEWQvYTXTfsxtkle8JzlHLrQALo1Dci2MNYSIYwlXwTG1rI6Z2Lp0zyfNbFKhZJ\nHVhF5+ljm1aY4ugSGYiNIsVwr0aJTYSZrw27tzRDCj7PQBWSYAQkCFhnsZCGkNNq\nqMh2qwpqR/WLgWkymLrIySb0TIpP3po//AtzXJfoge0uxIglO6hNCj0wR8WidOv+\n6uAIxlyI6+bI7cNwGGkaPr0+3fvYJqWT8zI0PiDJB6D+du6APHNiB2NNgKOAVFQ4\nD5C7B0b5AmMA6yJa1xlLkEILJJDMb0sSk5HZONnqVeWq4phHJtNDP4P5RBiWL9a8\nco4cjqn7qk9BPYoKKl+oFZbzuTa2vfDH9vcriPOSCliU0r6lN3rECCEZ18cEhR+O\ns6YgjcVBCzsmE9SiCMmjLSBzxUiGzzzax3bmiPTv/Wl3PyXiND7sqGfTxm0Tj/UP\nQ+UCPJj1smrMuc6LkgMhTNVcepoif9D95V3qvcEFqsRYIKxuVBs93SlXZl/joZuD\ndbdVrgnB8q1Z3cSzPbLWPhf9N9erIM8CjNkXqaKRyZxAKlAreZNUA0SR+pN++eO1\nlvXmws7DhTRpVP5XxjJ1SMipAruUtBwj8Yg296z0/PpprQN3CoA=\n=tmyk\n-----END PGP SIGNATURE-----", "payload": "tree ce2b295581c065067d18e4934226d1b413da2dd3\nparent e4991b2f48c02d2fc278c5018103530c1e4577e6\nparent 6f5a16bf1e23d885fd898d430be3cc07eb572163\nauthor kennytm <kennytm@gmail.com> 1523901061 +0800\ncommitter kennytm <kennytm@gmail.com> 1523907270 +0800\n\nRollup merge of #49931 - csmoe:end_span, r=estebank\n\nFix incorrect span in `&mut` suggestion\n\nFixes #49859\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "html_url": "https://github.com/rust-lang/rust/commit/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e4991b2f48c02d2fc278c5018103530c1e4577e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e4991b2f48c02d2fc278c5018103530c1e4577e6", "html_url": "https://github.com/rust-lang/rust/commit/e4991b2f48c02d2fc278c5018103530c1e4577e6"}, {"sha": "6f5a16bf1e23d885fd898d430be3cc07eb572163", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f5a16bf1e23d885fd898d430be3cc07eb572163", "html_url": "https://github.com/rust-lang/rust/commit/6f5a16bf1e23d885fd898d430be3cc07eb572163"}], "stats": {"total": 24, "additions": 19, "deletions": 5}, "files": [{"sha": "87379651c232f1eea4d987324c0b2f1b7d73333b", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "patch": "@@ -1639,10 +1639,18 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                                             } else {\n                                                 self.get_default_err_msg(place)\n                                             };\n+                                            let sp = self.mir.source_info(locations[0]).span;\n+                                            let mut to_suggest_span = String::new();\n+                                            if let Ok(src) =\n+                                                self.tcx.sess.codemap().span_to_snippet(sp) {\n+                                                    to_suggest_span = src[1..].to_string();\n+                                            };\n                                             err_info = Some((\n-                                                self.mir.source_info(locations[0]).span,\n+                                                    sp,\n                                                     \"consider changing this to be a \\\n-                                                    mutable reference: `&mut`\", item_msg,\n+                                                    mutable reference\",\n+                                                    to_suggest_span,\n+                                                    item_msg,\n                                                     self.get_primary_err_msg(base)));\n                                         }\n                                 },\n@@ -1652,9 +1660,15 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                         _ => {},\n                     }\n \n-                    if let Some((err_help_span, err_help_stmt, item_msg, sec_span)) = err_info {\n+                    if let Some((err_help_span,\n+                                 err_help_stmt,\n+                                 to_suggest_span,\n+                                 item_msg,\n+                                 sec_span)) = err_info {\n                         let mut err = self.tcx.cannot_assign(span, &item_msg, Origin::Mir);\n-                        err.span_suggestion(err_help_span, err_help_stmt, format!(\"\"));\n+                        err.span_suggestion(err_help_span,\n+                                            err_help_stmt,\n+                                            format!(\"&mut {}\", to_suggest_span));\n                         if place != place_err {\n                             err.span_label(span, sec_span);\n                         }"}, {"sha": "f3952c49a2a36fecd13ff84996782ed83cff5d39", "filename": "src/test/ui/nll/issue-47388.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b/src%2Ftest%2Fui%2Fnll%2Fissue-47388.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/73ea8939ee3480f8605360e1ec88b4b86a9f2c8b/src%2Ftest%2Fui%2Fnll%2Fissue-47388.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-47388.stderr?ref=73ea8939ee3480f8605360e1ec88b4b86a9f2c8b", "patch": "@@ -2,7 +2,7 @@ error[E0594]: cannot assign to data in a `&` reference\n   --> $DIR/issue-47388.rs:18:5\n    |\n LL |     let fancy_ref = &(&mut fancy);\n-   |                     ------------- help: consider changing this to be a mutable reference: `&mut`\n+   |                     ------------- help: consider changing this to be a mutable reference: `&mut (&mut fancy)`\n LL |     fancy_ref.num = 6; //~ ERROR E0594\n    |     ^^^^^^^^^^^^^^^^^ `fancy_ref` is a `&` reference, so the data it refers to cannot be written\n "}]}