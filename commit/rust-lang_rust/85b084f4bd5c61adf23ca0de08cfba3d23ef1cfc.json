{"sha": "85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1YjA4NGY0YmQ1YzYxYWRmMjNjYTBkZTA4Y2ZiYTNkMjNlZjFjZmM=", "commit": {"author": {"name": "Ryan Prichard", "email": "ryan.prichard@gmail.com", "date": "2015-03-14T06:49:44Z"}, "committer": {"name": "Ryan Prichard", "email": "ryan.prichard@gmail.com", "date": "2015-03-14T06:49:44Z"}, "message": "Reject `-L \"\"`, `-L native=`, and other empty search paths.\n\nIt wasn't clear to me that early_error was correct here, but it seems to\nwork. This code is reachable from `rustdoc`, which is problematic, because\nearly_error panics. rustc handles the panics gracefully (without ICEing or\ncrashing), but rustdoc does not. It's not the first such rustdoc problem,\nthough:\n\n    $ rustdoc hello.rs --extern std=bad-std\n    error: extern location for std does not exist: bad-std\n    hello.rs:1:1: 1:1 error: can't find crate for `std`\n    hello.rs:1\n           ^\n    error: aborting due to 2 previous errors\n    thread '<unnamed>' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:151\n    thread '<unnamed>' panicked at 'called `Result::unwrap()` on an `Err` value: \"rustc failed\"', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/result.rs:744\n    thread '<main>' panicked at 'child thread None panicked', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/thread.rs:661", "tree": {"sha": "0ce13f4224635dced5d20397e622c25447078cbf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ce13f4224635dced5d20397e622c25447078cbf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "html_url": "https://github.com/rust-lang/rust/commit/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc/comments", "author": {"login": "rprichard", "id": 1572855, "node_id": "MDQ6VXNlcjE1NzI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rprichard", "html_url": "https://github.com/rprichard", "followers_url": "https://api.github.com/users/rprichard/followers", "following_url": "https://api.github.com/users/rprichard/following{/other_user}", "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions", "organizations_url": "https://api.github.com/users/rprichard/orgs", "repos_url": "https://api.github.com/users/rprichard/repos", "events_url": "https://api.github.com/users/rprichard/events{/privacy}", "received_events_url": "https://api.github.com/users/rprichard/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rprichard", "id": 1572855, "node_id": "MDQ6VXNlcjE1NzI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rprichard", "html_url": "https://github.com/rprichard", "followers_url": "https://api.github.com/users/rprichard/followers", "following_url": "https://api.github.com/users/rprichard/following{/other_user}", "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions", "organizations_url": "https://api.github.com/users/rprichard/orgs", "repos_url": "https://api.github.com/users/rprichard/repos", "events_url": "https://api.github.com/users/rprichard/events{/privacy}", "received_events_url": "https://api.github.com/users/rprichard/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00211ecfda53521ea6b6405beff1c490b04f3ce5", "url": "https://api.github.com/repos/rust-lang/rust/commits/00211ecfda53521ea6b6405beff1c490b04f3ce5", "html_url": "https://github.com/rust-lang/rust/commit/00211ecfda53521ea6b6405beff1c490b04f3ce5"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "3c5d97445058b2d7ed3743a35192bb3bf4d5c910", "filename": "src/librustc/session/search_paths.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc/src%2Flibrustc%2Fsession%2Fsearch_paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc/src%2Flibrustc%2Fsession%2Fsearch_paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fsearch_paths.rs?ref=85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "patch": "@@ -10,6 +10,7 @@\n \n use std::slice;\n use std::path::{Path, PathBuf};\n+use session::early_error;\n \n #[derive(Clone, Debug)]\n pub struct SearchPaths {\n@@ -50,6 +51,9 @@ impl SearchPaths {\n         } else {\n             (PathKind::All, path)\n         };\n+        if path.is_empty() {\n+            early_error(\"empty search path given via `-L`\");\n+        }\n         self.paths.push((kind, PathBuf::new(path)));\n     }\n "}, {"sha": "2bf61cbe24ca30e6e8fda66a8b048cbe6c5c5e95", "filename": "src/test/compile-fail/manual-link-bad-search-path.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc/src%2Ftest%2Fcompile-fail%2Fmanual-link-bad-search-path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc/src%2Ftest%2Fcompile-fail%2Fmanual-link-bad-search-path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmanual-link-bad-search-path.rs?ref=85b084f4bd5c61adf23ca0de08cfba3d23ef1cfc", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags:-L native=\n+// error-pattern: empty search path given via `-L`\n+\n+fn main() {\n+}"}]}