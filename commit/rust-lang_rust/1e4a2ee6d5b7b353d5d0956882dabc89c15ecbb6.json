{"sha": "1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNGEyZWU2ZDViN2IzNTNkNWQwOTU2ODgyZGFiYzg5YzE1ZWNiYjY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-10-24T18:20:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-24T18:20:05Z"}, "message": "Rollup merge of #65746 - estebank:newcomer-format, r=Centril\n\nTweak format string error to point at arguments always\n\nAdd secondary span labels with no text to make it clear when there's a\nmismatch bewteen the positional arguments in a format string and the\narguments to the macro. This shouldn't affect experienced users, but it\nshould make it easier for newcomers to more clearly understand how\n`format!()` and `println!()` are supposed to be used.\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^   -\n```\n\ninstead of\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^\n```\n\nr? @Centril", "tree": {"sha": "e1f72da4abf9d64687cff291b6c126b16e4c41cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1f72da4abf9d64687cff291b6c126b16e4c41cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdsetWCRBK7hj4Ov3rIwAAdHIIAHctpTfXnHuUneHMjk9Gv+xz\npfD7xd6yZckNhVPE+K+UgW4qQnKOXgj38VRaQmh6XKCo1JhEuf0V+LELFjWQclgX\nQX7/t1alPmeapWOnYloZ/Zv0yx27ryUTwlpXLoZOHOppuv+Up1omVLSL/FKZ+SCE\nM7KM5teaSn7G8924Nd8Y0zbEhCJKvZz3xb82wB9zoMTrDx7J8t3ZCvSe1OY/gimn\nS6n+jkL0h8pt+JA8ml6Ak5e68eoe7mJJP4+TG/rmZAYDC6H5ZWo6KtWsj09JrTIl\n1VHUGgexdp6APPBc//K86a9NdE6GvdFh4ZJYL1+swYZ9xd+XejGa2toDZIqo6tU=\n=ykZ6\n-----END PGP SIGNATURE-----\n", "payload": "tree e1f72da4abf9d64687cff291b6c126b16e4c41cf\nparent efa50378d592b8fdc0eeb8ac48a453e0f1babacf\nparent 8467ceff22477fe567883e6fbd810e0f9e220686\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1571941205 +0200\ncommitter GitHub <noreply@github.com> 1571941205 +0200\n\nRollup merge of #65746 - estebank:newcomer-format, r=Centril\n\nTweak format string error to point at arguments always\n\nAdd secondary span labels with no text to make it clear when there's a\nmismatch bewteen the positional arguments in a format string and the\narguments to the macro. This shouldn't affect experienced users, but it\nshould make it easier for newcomers to more clearly understand how\n`format!()` and `println!()` are supposed to be used.\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^   -\n```\n\ninstead of\n\n```\nerror: 2 positional arguments in format string, but there is 1 argument\n --> file8.rs:2:14\n  |\n2 |     format!(\"{} {}\", 1);\n  |              ^^ ^^\n```\n\nr? @Centril\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "html_url": "https://github.com/rust-lang/rust/commit/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efa50378d592b8fdc0eeb8ac48a453e0f1babacf", "url": "https://api.github.com/repos/rust-lang/rust/commits/efa50378d592b8fdc0eeb8ac48a453e0f1babacf", "html_url": "https://github.com/rust-lang/rust/commit/efa50378d592b8fdc0eeb8ac48a453e0f1babacf"}, {"sha": "8467ceff22477fe567883e6fbd810e0f9e220686", "url": "https://api.github.com/repos/rust-lang/rust/commits/8467ceff22477fe567883e6fbd810e0f9e220686", "html_url": "https://github.com/rust-lang/rust/commit/8467ceff22477fe567883e6fbd810e0f9e220686"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "37310f46f7eed7c4a93fca9b99306fd0ab610593", "filename": "src/libsyntax_ext/format.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Flibsyntax_ext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Flibsyntax_ext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fformat.rs?ref=1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "patch": "@@ -278,7 +278,7 @@ impl<'a, 'b> Context<'a, 'b> {\n     /// format string.\n     fn report_invalid_references(&self, numbered_position_args: bool) {\n         let mut e;\n-        let sp = if self.is_literal {\n+        let sp = if self.is_literal { // Point at the formatting arguments.\n             MultiSpan::from_spans(self.arg_spans.clone())\n         } else {\n             MultiSpan::from_span(self.fmtsp)\n@@ -304,6 +304,9 @@ impl<'a, 'b> Context<'a, 'b> {\n                     self.describe_num_args(),\n                 ),\n             );\n+            for arg in &self.args { // Point at the arguments that will be formatted.\n+                e.span_label(arg.span, \"\");\n+            }\n         } else {\n             let (mut refs, spans): (Vec<_>, Vec<_>) = refs.unzip();\n             // Avoid `invalid reference to positional arguments 7 and 7 (there is 1 argument)`"}, {"sha": "691c06a2402c5352ec39c4650ff3d82bb0d76505", "filename": "src/test/ui/fmt/format-string-error.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.rs?ref=1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "patch": "@@ -48,4 +48,6 @@ fn main() {\n \n \"###);\n     //~^^^ ERROR invalid format string: unmatched `}` found\n+    println!(\"{} {} {}\", 1, 2);\n+    //~^ ERROR 3 positional arguments in format string, but there are 2 arguments\n }"}, {"sha": "32119b18774b25585c1f00395a2a80b5fd04dbf0", "filename": "src/test/ui/fmt/format-string-error.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-string-error.stderr?ref=1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "patch": "@@ -107,5 +107,11 @@ LL |         }\n    |\n    = note: if you intended to print `}`, you can escape it using `}}`\n \n-error: aborting due to 12 previous errors\n+error: 3 positional arguments in format string, but there are 2 arguments\n+  --> $DIR/format-string-error.rs:51:15\n+   |\n+LL |     println!(\"{} {} {}\", 1, 2);\n+   |               ^^ ^^ ^^   -  -\n+\n+error: aborting due to 13 previous errors\n "}, {"sha": "c58cbc312335a6588553ec4967cd721672eb074d", "filename": "src/test/ui/if/ifmt-bad-arg.stderr", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr?ref=1e4a2ee6d5b7b353d5d0956882dabc89c15ecbb6", "patch": "@@ -224,8 +224,9 @@ error: 4 positional arguments in format string, but there are 3 arguments\n   --> $DIR/ifmt-bad-arg.rs:78:15\n    |\n LL |     println!(\"{} {:.*} {}\", 1, 3.2, 4);\n-   |               ^^ ^^--^ ^^      --- this parameter corresponds to the precision flag\n-   |                    |\n+   |               ^^ ^^--^ ^^   -  ---  -\n+   |                    |           |\n+   |                    |           this parameter corresponds to the precision flag\n    |                    this precision flag adds an extra required argument at position 1, which is why there are 4 arguments expected\n    |\n    = note: positional arguments are zero-based\n@@ -235,8 +236,9 @@ error: 4 positional arguments in format string, but there are 3 arguments\n   --> $DIR/ifmt-bad-arg.rs:81:15\n    |\n LL |     println!(\"{} {:07$.*} {}\", 1, 3.2, 4);\n-   |               ^^ ^^^----^ ^^      --- this parameter corresponds to the precision flag\n-   |                     | |\n+   |               ^^ ^^^----^ ^^   -  ---  -\n+   |                     | |           |\n+   |                     | |           this parameter corresponds to the precision flag\n    |                     | this precision flag adds an extra required argument at position 1, which is why there are 4 arguments expected\n    |                     this width flag expects an `usize` argument at position 7, but there are 3 arguments\n    |"}]}