{"sha": "5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "node_id": "C_kwDOAAsO6NoAKDU0OTk2ODcxMjhmYzFkOGNmMjBlYTk5YjhmZDkxOGMyYmJiMWViMTQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-10T05:53:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-10T05:53:36Z"}, "message": "Rollup merge of #104115 - GuillaumeGomez:migrate-crate-search-div, r=notriddle\n\nMigrate crate-search element to CSS variables\n\nThere should no UI changes.\n\nr? ```@notriddle```", "tree": {"sha": "e56ae8ba30e156d84614c9177573999b5b8e51fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e56ae8ba30e156d84614c9177573999b5b8e51fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjbJHgCRBK7hj4Ov3rIwAAknQIAFpzdxoConSrZgko702LreEB\nGT5lFKuNGgzMv5oLbjrglKGVxV/QZpq/YgAqpBd0VBM1gl3CWHW4tyf720rq8jXD\nlZQPQNpYBKpRRKzQO1vfSWk6sjJT3wTwoi77Gkyp9N8XDakC9E8MSov496LwXvd0\nP9MyJ39sTDAveQTaMPr60v5G7lb/eRtFs1e1THwS1x+fqIi3jYT/btUKmuSCoqRK\nGrXkT1PeZvX7NmPLapO/161sksmDFwJI72yr7vw27Jj4fs8L0xWqKnP+E+xsYmSq\njpRP+5yjFNzDoFy0nxMBBCWp5pfHtVkzqaK93l3jz+YhHaTa/8nYzSfyhYNRN5M=\n=FW6G\n-----END PGP SIGNATURE-----\n", "payload": "tree e56ae8ba30e156d84614c9177573999b5b8e51fc\nparent 7124590dcc96e1646d529447be878f99b3dbe63c\nparent 0e804b4b476622faa3e2213d4dd2dd316f4731a3\nauthor Michael Goulet <michael@errs.io> 1668059616 -0800\ncommitter GitHub <noreply@github.com> 1668059616 -0800\n\nRollup merge of #104115 - GuillaumeGomez:migrate-crate-search-div, r=notriddle\n\nMigrate crate-search element to CSS variables\n\nThere should no UI changes.\n\nr? ```@notriddle```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "html_url": "https://github.com/rust-lang/rust/commit/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7124590dcc96e1646d529447be878f99b3dbe63c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7124590dcc96e1646d529447be878f99b3dbe63c", "html_url": "https://github.com/rust-lang/rust/commit/7124590dcc96e1646d529447be878f99b3dbe63c"}, {"sha": "0e804b4b476622faa3e2213d4dd2dd316f4731a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e804b4b476622faa3e2213d4dd2dd316f4731a3", "html_url": "https://github.com/rust-lang/rust/commit/0e804b4b476622faa3e2213d4dd2dd316f4731a3"}], "stats": {"total": 101, "additions": 67, "deletions": 34}, "files": [{"sha": "86a5b0b303f39bf426b8aafd8d4531b85fa4ff24", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "patch": "@@ -830,6 +830,9 @@ table,\n \tline-height: 1.5;\n \tfont-weight: 500;\n }\n+#crate-search:hover, #crate-search:focus {\n+\tborder-color: var(--crate-search-hover-border);\n+}\n /* cancel stylistic differences in padding in firefox\n for \"appearance: none\"-style (or equivalent) <select>s */\n @-moz-document url-prefix() {\n@@ -853,8 +856,13 @@ so that we can apply CSS-filters to change the arrow color in themes */\n \tbackground-repeat: no-repeat;\n \tbackground-size: 20px;\n \tbackground-position: calc(100% - 2px) 56%;\n-\t/* image is black color, themes should apply a \"filter\" property to change the color */\n+\t/* image is black color */\n \tbackground-image: url(\"down-arrow-927217e04c7463ac.svg\");\n+\t/* changes the arrow image color */\n+\tfilter: var(--crate-search-div-filter);\n+}\n+#crate-search-div:hover::after, #crate-search-div:focus-within::after {\n+\tfilter: var(--crate-search-div-hover-filter);\n }\n #crate-search > option {\n \tfont-size: 1rem;"}, {"sha": "129ef6e10e7e7c31fe82fcb56f329d3269d8894e", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "patch": "@@ -67,6 +67,12 @@ Original by Dempfi (https://github.com/dempfi/ayu)\n \t\tdrop-shadow(0 1px 0 #fff)\n \t\tdrop-shadow(-1px 0 0 #fff)\n \t\tdrop-shadow(0 -1px 0 #fff);\n+\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n+\t--crate-search-div-filter: invert(41%) sepia(12%) saturate(487%) hue-rotate(171deg)\n+\t\tbrightness(94%) contrast(94%);\n+\t--crate-search-div-hover-filter: invert(98%) sepia(12%) saturate(81%) hue-rotate(343deg)\n+\t\tbrightness(113%) contrast(76%);\n+\t--crate-search-hover-border: #e0e0e0;\n }\n \n .slider {\n@@ -153,17 +159,6 @@ details.rustdoc-toggle > summary::before {\n \tfilter: invert(100%);\n }\n \n-#crate-search-div::after {\n-\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n-\tfilter: invert(41%) sepia(12%) saturate(487%) hue-rotate(171deg) brightness(94%) contrast(94%);\n-}\n-#crate-search:hover, #crate-search:focus {\n-\tborder-color: #e0e0e0 !important;\n-}\n-#crate-search-div:hover::after, #crate-search-div:focus-within::after {\n-\tfilter: invert(98%) sepia(12%) saturate(81%) hue-rotate(343deg) brightness(113%) contrast(76%);\n-}\n-\n .module-item .stab,\n .import-item .stab {\n \tcolor: #000;"}, {"sha": "7cd2d7817d59d26896cd2eb4232808b3803db7d0", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "patch": "@@ -62,6 +62,12 @@\n \t\tdrop-shadow(0 1px 0 #fff)\n \t\tdrop-shadow(-1px 0 0 #fff)\n \t\tdrop-shadow(0 -1px 0 #fff);\n+\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n+\t--crate-search-div-filter: invert(94%) sepia(0%) saturate(721%) hue-rotate(255deg)\n+\t\tbrightness(90%) contrast(90%);\n+\t--crate-search-div-hover-filter: invert(69%) sepia(60%) saturate(6613%) hue-rotate(184deg)\n+\t\tbrightness(100%) contrast(91%);\n+\t--crate-search-hover-border: #2196f3;\n }\n \n .slider {\n@@ -84,17 +90,6 @@ details.rustdoc-toggle > summary::before {\n \tfilter: invert(100%);\n }\n \n-#crate-search-div::after {\n-\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n-\tfilter: invert(94%) sepia(0%) saturate(721%) hue-rotate(255deg) brightness(90%) contrast(90%);\n-}\n-#crate-search:hover, #crate-search:focus {\n-\tborder-color: #2196f3 !important;\n-}\n-#crate-search-div:hover::after, #crate-search-div:focus-within::after {\n-\tfilter: invert(69%) sepia(60%) saturate(6613%) hue-rotate(184deg) brightness(100%) contrast(91%);\n-}\n-\n :target {\n \tbackground-color: #494a3d;\n \tborder-right: 3px solid #bb7410;"}, {"sha": "c41ec248841279ce4ce3dc3390b12b79a08e1dfd", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "patch": "@@ -59,6 +59,12 @@\n \t--test-arrow-hover-color: #f5f5f5;\n \t--test-arrow-hover-background-color: #4e8bca;\n \t--rust-logo-filter: initial;\n+\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n+\t--crate-search-div-filter: invert(100%) sepia(0%) saturate(4223%) hue-rotate(289deg)\n+\t\tbrightness(114%) contrast(76%);\n+\t--crate-search-div-hover-filter: invert(44%) sepia(18%) saturate(23%) hue-rotate(317deg)\n+\t\tbrightness(96%) contrast(93%);\n+\t--crate-search-hover-border: #717171;\n }\n \n .slider {\n@@ -77,17 +83,6 @@ body.source .example-wrap pre.rust a {\n \tbackground: #eee;\n }\n \n-#crate-search-div::after {\n-\t/* match border-color; uses https://codepen.io/sosuke/pen/Pjoqqp */\n-\tfilter: invert(100%) sepia(0%) saturate(4223%) hue-rotate(289deg) brightness(114%) contrast(76%);\n-}\n-#crate-search:hover, #crate-search:focus {\n-\tborder-color: #717171 !important;\n-}\n-#crate-search-div:hover::after, #crate-search-div:focus-within::after {\n-\tfilter: invert(44%) sepia(18%) saturate(23%) hue-rotate(317deg) brightness(96%) contrast(93%);\n-}\n-\n :target {\n \tbackground: #FDFFD3;\n \tborder-right: 3px solid #AD7C37;"}, {"sha": "fa349c872ae205b183f0329dab696620d9720d38", "filename": "src/test/rustdoc-gui/search-result-display.goml", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5499687128fc1d8cf20ea99b8fd918c2bbb1eb14/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-display.goml?ref=5499687128fc1d8cf20ea99b8fd918c2bbb1eb14", "patch": "@@ -35,3 +35,43 @@ assert-css: (\"#crate-search\", {\"width\": \"527px\"})\n assert-css: (\".search-results-title\", {\"height\": \"44px\", \"width\": \"640px\"})\n // And we check that the `<select>` isn't bigger than its container (\".search-results-title\").\n assert-css: (\"#search\", {\"width\": \"640px\"})\n+\n+// Now checking that the crate filter is working as expected too.\n+show-text: true\n+define-function: (\n+    \"check-filter\",\n+    (theme, border, filter, hover_border, hover_filter),\n+    [\n+        (\"local-storage\", {\"rustdoc-theme\": |theme|, \"rustdoc-use-system-theme\": \"false\"}),\n+        (\"reload\"),\n+        (\"wait-for\", \"#crate-search\"),\n+        (\"assert-css\", (\"#crate-search\", {\"border\": \"1px solid \" + |border|})),\n+        (\"assert-css\", (\"#crate-search-div::after\", {\"filter\": |filter|})),\n+        (\"move-cursor-to\", \"#crate-search\"),\n+        (\"assert-css\", (\"#crate-search\", {\"border\": \"1px solid \" + |hover_border|})),\n+        (\"assert-css\", (\"#crate-search-div::after\", {\"filter\": |hover_filter|})),\n+        (\"move-cursor-to\", \".search-input\"),\n+    ],\n+)\n+\n+call-function: (\"check-filter\", {\n+    \"theme\": \"ayu\",\n+    \"border\": \"rgb(92, 103, 115)\",\n+    \"filter\": \"invert(0.41) sepia(0.12) saturate(4.87) hue-rotate(171deg) brightness(0.94) contrast(0.94)\",\n+    \"hover_border\": \"rgb(224, 224, 224)\",\n+    \"hover_filter\": \"invert(0.98) sepia(0.12) saturate(0.81) hue-rotate(343deg) brightness(1.13) contrast(0.76)\",\n+})\n+call-function: (\"check-filter\", {\n+    \"theme\": \"dark\",\n+    \"border\": \"rgb(224, 224, 224)\",\n+    \"filter\": \"invert(0.94) sepia(0) saturate(7.21) hue-rotate(255deg) brightness(0.9) contrast(0.9)\",\n+    \"hover_border\": \"rgb(33, 150, 243)\",\n+    \"hover_filter\": \"invert(0.69) sepia(0.6) saturate(66.13) hue-rotate(184deg) brightness(1) contrast(0.91)\",\n+})\n+call-function: (\"check-filter\", {\n+    \"theme\": \"light\",\n+    \"border\": \"rgb(224, 224, 224)\",\n+    \"filter\": \"invert(1) sepia(0) saturate(42.23) hue-rotate(289deg) brightness(1.14) contrast(0.76)\",\n+    \"hover_border\": \"rgb(113, 113, 113)\",\n+    \"hover_filter\": \"invert(0.44) sepia(0.18) saturate(0.23) hue-rotate(317deg) brightness(0.96) contrast(0.93)\",\n+})"}]}