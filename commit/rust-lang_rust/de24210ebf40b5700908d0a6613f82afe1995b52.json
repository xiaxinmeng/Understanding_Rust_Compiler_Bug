{"sha": "de24210ebf40b5700908d0a6613f82afe1995b52", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlMjQyMTBlYmY0MGI1NzAwOTA4ZDBhNjYxM2Y4MmFmZTE5OTViNTI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-10-21T04:59:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-21T04:59:44Z"}, "message": "Rollup merge of #78118 - spastorino:inline-const-followups, r=petrochenkov\n\nInline const followups\n\nr? @petrochenkov\n\nFollow ups of #77124", "tree": {"sha": "7b4db815ca111d129ecda5f620695fff51563a2e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b4db815ca111d129ecda5f620695fff51563a2e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de24210ebf40b5700908d0a6613f82afe1995b52", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfj8BBCRBK7hj4Ov3rIwAAdHIIAFgSib7ct9jEL6wn0NkftcdQ\nnnB5cG2VJs7stkyn5OiJ/w7Z057yyB6XXnoFs6qK8Zv/GvvTnhql+OBAbyP6jBev\nRdaB3Lzgtgs+vSgOa0wk38KNkol2cKUc6ircHwjfO3aLS1C/nG3O+nMG7uusIGaq\nsW37aJX6k43pQN2y1hTqLyRbuEGrd7Sv7KtPkxfQPwfgR6xR6ba8P4b780VJL4LT\nTJefcFXTg1jZBQ2SiVoUOantl3HEEXz1DQvfsqh/sJJhRrbiw0oodcRSw/eSQmlA\no1X+fb9J0Yfc/994RTQGSART+OAwML2lUCNwyYEcoZvjjN6N1bS6EQ+ou3/lYYA=\n=lIZG\n-----END PGP SIGNATURE-----\n", "payload": "tree 7b4db815ca111d129ecda5f620695fff51563a2e\nparent 83f126bedf227103463f6f505398d72d4efedd42\nparent dcd2d91a647c101c7226e594ecae23bc5fb3bb69\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1603256384 +0900\ncommitter GitHub <noreply@github.com> 1603256384 +0900\n\nRollup merge of #78118 - spastorino:inline-const-followups, r=petrochenkov\n\nInline const followups\n\nr? @petrochenkov\n\nFollow ups of #77124\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de24210ebf40b5700908d0a6613f82afe1995b52", "html_url": "https://github.com/rust-lang/rust/commit/de24210ebf40b5700908d0a6613f82afe1995b52", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de24210ebf40b5700908d0a6613f82afe1995b52/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83f126bedf227103463f6f505398d72d4efedd42", "url": "https://api.github.com/repos/rust-lang/rust/commits/83f126bedf227103463f6f505398d72d4efedd42", "html_url": "https://github.com/rust-lang/rust/commit/83f126bedf227103463f6f505398d72d4efedd42"}, {"sha": "dcd2d91a647c101c7226e594ecae23bc5fb3bb69", "url": "https://api.github.com/repos/rust-lang/rust/commits/dcd2d91a647c101c7226e594ecae23bc5fb3bb69", "html_url": "https://github.com/rust-lang/rust/commit/dcd2d91a647c101c7226e594ecae23bc5fb3bb69"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "1cd4ddad5783a528e5d9e18bff2de66ef7f79588", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de24210ebf40b5700908d0a6613f82afe1995b52/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de24210ebf40b5700908d0a6613f82afe1995b52/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=de24210ebf40b5700908d0a6613f82afe1995b52", "patch": "@@ -1138,9 +1138,7 @@ impl<'a> State<'a> {\n     fn print_expr_anon_const(&mut self, anon_const: &hir::AnonConst) {\n         self.ibox(INDENT_UNIT);\n         self.s.word_space(\"const\");\n-        self.s.word(\"{\");\n         self.print_anon_const(anon_const);\n-        self.s.word(\"}\");\n         self.end()\n     }\n "}, {"sha": "5176db82d3b410cf26827f85a1ab24aaa28ebc2d", "filename": "compiler/rustc_parse/src/parser/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/de24210ebf40b5700908d0a6613f82afe1995b52/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de24210ebf40b5700908d0a6613f82afe1995b52/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs?ref=de24210ebf40b5700908d0a6613f82afe1995b52", "patch": "@@ -548,7 +548,11 @@ impl<'a> Parser<'a> {\n \n     fn check_inline_const(&mut self) -> bool {\n         self.check_keyword(kw::Const)\n-            && self.look_ahead(1, |t| t == &token::OpenDelim(DelimToken::Brace))\n+            && self.look_ahead(1, |t| match t.kind {\n+                token::Interpolated(ref nt) => matches!(**nt, token::NtBlock(..)),\n+                token::OpenDelim(DelimToken::Brace) => true,\n+                _ => false,\n+            })\n     }\n \n     /// Checks to see if the next token is either `+` or `+=`."}, {"sha": "66b58571751ceb6b5660092d84aa167e2e4c9857", "filename": "src/test/ui/inline-const/const-expr-macro.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/de24210ebf40b5700908d0a6613f82afe1995b52/src%2Ftest%2Fui%2Finline-const%2Fconst-expr-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de24210ebf40b5700908d0a6613f82afe1995b52/src%2Ftest%2Fui%2Finline-const%2Fconst-expr-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finline-const%2Fconst-expr-macro.rs?ref=de24210ebf40b5700908d0a6613f82afe1995b52", "patch": "@@ -0,0 +1,12 @@\n+// run-pass\n+\n+#![allow(incomplete_features)]\n+#![feature(inline_const)]\n+macro_rules! do_const_block{\n+    ($val:block) => { const $val }\n+}\n+\n+fn main() {\n+    let s = do_const_block!({ 22 });\n+    assert_eq!(s, 22);\n+}"}]}