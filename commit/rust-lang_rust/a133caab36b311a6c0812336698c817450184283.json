{"sha": "a133caab36b311a6c0812336698c817450184283", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExMzNjYWFiMzZiMzExYTZjMDgxMjMzNjY5OGM4MTc0NTAxODQyODM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-04-26T01:50:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-04-26T01:50:26Z"}, "message": "Rollup merge of #60289 - tmandry:allow-features-include-std, r=cramertj\n\nMake `-Z allow-features` work for stdlib features\n\nr? @cramertj", "tree": {"sha": "9de980a6d79928bd00a4004d5587c6dc7582bbec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9de980a6d79928bd00a4004d5587c6dc7582bbec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a133caab36b311a6c0812336698c817450184283", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcwmPjCRBK7hj4Ov3rIwAAdHIIAAPGnnrfn5F056aNd0gQmtHc\nZyA0Bv4NeAEo/9jSWR4P6srv24T9WEsh8QAnpbhBcBYgpJDx8VhPzf49zfzhlULQ\nMY1hG5S1dd2xUjv9P4AVaJkFIL9FviqcIsgsQXmLyH8DzpY7maDIZ9VmMyKlZJzj\nARuJRijwWC0vk2lwzHea9Dc+2lHrH1jyX4CdnjtNjOZPstWJXaQZ41RlZA+8ZOaK\nV4mMzbD4ZMa8gepplt6qOFRDCIcT1RHr2pkKtAUFl3a7Z3IwHecmnmupdYQQAwak\npdb+bYhOOZhjq4ZKaGdRKBByGSSSLUt3aFIUXhFpg+3CgZA4kqVbx3HllhIbUjg=\n=swH1\n-----END PGP SIGNATURE-----\n", "payload": "tree 9de980a6d79928bd00a4004d5587c6dc7582bbec\nparent 66645340edcb706453c8647f4c42063f73e7e9ed\nparent 0a26789af90a78558144db0dbedeb820f07f2a61\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1556243426 +0200\ncommitter GitHub <noreply@github.com> 1556243426 +0200\n\nRollup merge of #60289 - tmandry:allow-features-include-std, r=cramertj\n\nMake `-Z allow-features` work for stdlib features\n\nr? @cramertj\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a133caab36b311a6c0812336698c817450184283", "html_url": "https://github.com/rust-lang/rust/commit/a133caab36b311a6c0812336698c817450184283", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a133caab36b311a6c0812336698c817450184283/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66645340edcb706453c8647f4c42063f73e7e9ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/66645340edcb706453c8647f4c42063f73e7e9ed", "html_url": "https://github.com/rust-lang/rust/commit/66645340edcb706453c8647f4c42063f73e7e9ed"}, {"sha": "0a26789af90a78558144db0dbedeb820f07f2a61", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a26789af90a78558144db0dbedeb820f07f2a61", "html_url": "https://github.com/rust-lang/rust/commit/0a26789af90a78558144db0dbedeb820f07f2a61"}], "stats": {"total": 54, "additions": 35, "deletions": 19}, "files": [{"sha": "98952ad918c923e1119e679193db22818b1817df", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/a133caab36b311a6c0812336698c817450184283/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a133caab36b311a6c0812336698c817450184283/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=a133caab36b311a6c0812336698c817450184283", "patch": "@@ -2259,32 +2259,32 @@ pub fn get_features(span_handler: &Handler, krate_attrs: &[ast::Attribute],\n                 continue;\n             }\n \n-            if let Some((.., set)) = ACTIVE_FEATURES.iter().find(|f| name == f.0) {\n-                if let Some(allowed) = allow_features.as_ref() {\n-                    if allowed.iter().find(|f| *f == name.as_str()).is_none() {\n-                        span_err!(span_handler, mi.span(), E0725,\n-                                  \"the feature `{}` is not in the list of allowed features\",\n-                                  name);\n-                        continue;\n-                    }\n-                }\n-\n-                set(&mut features, mi.span());\n-                features.declared_lang_features.push((name, mi.span(), None));\n-                continue\n-            }\n-\n             let removed = REMOVED_FEATURES.iter().find(|f| name == f.0);\n             let stable_removed = STABLE_REMOVED_FEATURES.iter().find(|f| name == f.0);\n             if let Some((.., reason)) = removed.or(stable_removed) {\n                 feature_removed(span_handler, mi.span(), *reason);\n-                continue\n+                continue;\n             }\n \n             if let Some((_, since, ..)) = ACCEPTED_FEATURES.iter().find(|f| name == f.0) {\n                 let since = Some(Symbol::intern(since));\n                 features.declared_lang_features.push((name, mi.span(), since));\n-                continue\n+                continue;\n+            }\n+\n+            if let Some(allowed) = allow_features.as_ref() {\n+                if allowed.iter().find(|f| *f == name.as_str()).is_none() {\n+                    span_err!(span_handler, mi.span(), E0725,\n+                              \"the feature `{}` is not in the list of allowed features\",\n+                              name);\n+                    continue;\n+                }\n+            }\n+\n+            if let Some((.., set)) = ACTIVE_FEATURES.iter().find(|f| name == f.0) {\n+                set(&mut features, mi.span());\n+                features.declared_lang_features.push((name, mi.span(), None));\n+                continue;\n             }\n \n             features.declared_lib_features.push((name, mi.span()));"}, {"sha": "784a1d2697d672b7816b3c42efab2c0bee0f7c13", "filename": "src/test/ui/feature-gate/allow-features-empty.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.rs?ref=a133caab36b311a6c0812336698c817450184283", "patch": "@@ -7,4 +7,6 @@\n \n #![feature(lang_items)] //~ ERROR\n \n+#![feature(unknown_stdlib_feature)] //~ ERROR\n+\n fn main() {}"}, {"sha": "ab41422ed05b858851ccd2499ad9712e258488e5", "filename": "src/test/ui/feature-gate/allow-features-empty.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features-empty.stderr?ref=a133caab36b311a6c0812336698c817450184283", "patch": "@@ -16,6 +16,12 @@ error[E0725]: the feature `lang_items` is not in the list of allowed features\n LL | #![feature(lang_items)]\n    |            ^^^^^^^^^^\n \n-error: aborting due to 3 previous errors\n+error[E0725]: the feature `unknown_stdlib_feature` is not in the list of allowed features\n+  --> $DIR/allow-features-empty.rs:10:12\n+   |\n+LL | #![feature(unknown_stdlib_feature)]\n+   |            ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0725`."}, {"sha": "de3439a5b628f1868d81564a63019968dddbedb9", "filename": "src/test/ui/feature-gate/allow-features.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.rs?ref=a133caab36b311a6c0812336698c817450184283", "patch": "@@ -7,4 +7,6 @@\n \n #![feature(lang_items)]\n \n+#![feature(unknown_stdlib_feature)] //~ ERROR\n+\n fn main() {}"}, {"sha": "5b39a6f053bde479da20e4973a96897903561119", "filename": "src/test/ui/feature-gate/allow-features.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a133caab36b311a6c0812336698c817450184283/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fallow-features.stderr?ref=a133caab36b311a6c0812336698c817450184283", "patch": "@@ -4,6 +4,12 @@ error[E0725]: the feature `rustc_const_unstable` is not in the list of allowed f\n LL | #![feature(rustc_const_unstable)]\n    |            ^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to previous error\n+error[E0725]: the feature `unknown_stdlib_feature` is not in the list of allowed features\n+  --> $DIR/allow-features.rs:10:12\n+   |\n+LL | #![feature(unknown_stdlib_feature)]\n+   |            ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0725`."}]}