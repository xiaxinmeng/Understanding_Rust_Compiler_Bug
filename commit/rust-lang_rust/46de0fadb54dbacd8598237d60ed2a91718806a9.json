{"sha": "46de0fadb54dbacd8598237d60ed2a91718806a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2ZGUwZmFkYjU0ZGJhY2Q4NTk4MjM3ZDYwZWQyYTkxNzE4ODA2YTk=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-05-03T15:20:48Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-05-10T11:36:39Z"}, "message": "fix Registry::args for plugins loaded with --extra-plugins", "tree": {"sha": "eb3cc7ea2630abea0da51b99eccac90f3d95c064", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb3cc7ea2630abea0da51b99eccac90f3d95c064"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46de0fadb54dbacd8598237d60ed2a91718806a9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXMcfHAAoJEFbW7qD8Z6xGh3AQAJIFiynQx4NIvwrJ2wx83fz3\nz8WRu1E+DnBraW2ECMwNM/glrX8D2rsLSezOodk1L4UY921Tun5LT425N31woKXU\nFWkL8UHIooy0dbD9/IVO34mBJGUFmDbvoEQVNpWUmQURb9X0Ub5ZbeMD1foEi09P\nmLmTu7394hs+qLDhYFnXiW/Ho48CHZ4NrLwLlmxDspZ+aIeTqBqRQ0NahqMQ7PN/\nVjUXB02Sl1lS1ByHE7vuP5vt2JwA1oeBim5vPLj9BtvGYlFieWIVCy1CLkUvxesT\nwnzp24TeUxxlrJb6jwkjgOKDX2YXvnc9I7En3Jut1IBVLmvIOKdbn/E2s1qDLBnB\nPXUjtYN/o/mlOTkQkgLw2xlLT9fdZlYZM6EEfY+55eeZsIQ123G05u5tUy4oTCRw\nysuutXka4AOq5H2NVdJn3DDB1KLKAuBhQCH/zvrCnOqv15x24LIbexiocKUnBGIz\nrkeC81OxPgfAI45mifCva6PlK3A7E0q+0hpo4NHy0wGIAh3nNSXEqWTvi1Z4Zk8p\nyis1hs+wNLIFjhWO902EYl0c5JE2X38raW9xRnkjtSW6JG0JJs+7bkdMRkiRCo4m\nBvsjAMTEFTSVpla/pL5BUSdLxDLwMVZhL0RJZpiWu3CO10EEOcNgSv3rm7k/ylC1\njVBZVUFPs4ht9MwppvEM\n=nhkZ\n-----END PGP SIGNATURE-----", "payload": "tree eb3cc7ea2630abea0da51b99eccac90f3d95c064\nparent 1939b76903eb8a4aa02dadc52353541637e3b98c\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1462288848 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1462880199 +0200\n\nfix Registry::args for plugins loaded with --extra-plugins\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46de0fadb54dbacd8598237d60ed2a91718806a9", "html_url": "https://github.com/rust-lang/rust/commit/46de0fadb54dbacd8598237d60ed2a91718806a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46de0fadb54dbacd8598237d60ed2a91718806a9/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1939b76903eb8a4aa02dadc52353541637e3b98c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1939b76903eb8a4aa02dadc52353541637e3b98c", "html_url": "https://github.com/rust-lang/rust/commit/1939b76903eb8a4aa02dadc52353541637e3b98c"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "dc5a38bb7647ee6d2974c4e9f7a611a2b093be0b", "filename": "src/librustc_plugin/registry.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/46de0fadb54dbacd8598237d60ed2a91718806a9/src%2Flibrustc_plugin%2Fregistry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46de0fadb54dbacd8598237d60ed2a91718806a9/src%2Flibrustc_plugin%2Fregistry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_plugin%2Fregistry.rs?ref=46de0fadb54dbacd8598237d60ed2a91718806a9", "patch": "@@ -92,8 +92,11 @@ impl<'a> Registry<'a> {\n     /// ```no_run\n     /// #![plugin(my_plugin_name(... args ...))]\n     /// ```\n-    pub fn args<'b>(&'b self) -> &'b Vec<P<ast::MetaItem>> {\n-        self.args_hidden.as_ref().expect(\"args not set\")\n+    ///\n+    /// Returns empty slice in case the plugin was loaded\n+    /// with `--extra-plugins`\n+    pub fn args<'b>(&'b self) -> &'b [P<ast::MetaItem>] {\n+        self.args_hidden.as_ref().map(|v| &v[..]).unwrap_or(&[])\n     }\n \n     /// Register a syntax extension of any kind."}, {"sha": "99321ad42418dd8f0b2dddb61b84e1289e25e514", "filename": "src/test/run-pass-fulldeps/auxiliary/plugin_args.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46de0fadb54dbacd8598237d60ed2a91718806a9/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46de0fadb54dbacd8598237d60ed2a91718806a9/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs?ref=46de0fadb54dbacd8598237d60ed2a91718806a9", "patch": "@@ -45,7 +45,7 @@ impl TTMacroExpander for Expander {\n \n #[plugin_registrar]\n pub fn plugin_registrar(reg: &mut Registry) {\n-    let args = reg.args().clone();\n+    let args = reg.args().to_owned();\n     reg.register_syntax_extension(token::intern(\"plugin_args\"),\n         // FIXME (#22405): Replace `Box::new` with `box` here when/if possible.\n         NormalTT(Box::new(Expander { args: args, }), None, false));"}]}