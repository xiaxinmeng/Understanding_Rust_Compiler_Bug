{"sha": "f1eb5f800fddbea8876930cdeffa55545e17f447", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxZWI1ZjgwMGZkZGJlYTg4NzY5MzBjZGVmZmE1NTU0NWUxN2Y0NDc=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-09-05T14:28:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-09-05T14:28:28Z"}, "message": "Rollup merge of #76082 - jyn514:top-level-links, r=ollie27,GuillaumeGomez\n\nFix intra-doc links on pub re-exports\n\nPartial fix for https://github.com/rust-lang/rust/issues/76073 - This removes the incorrect error, but doesn't show the documentation anywhere.\nr? @GuillaumeGomez", "tree": {"sha": "47726eb4a325f5d3df97630a4209a91d2327e523", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47726eb4a325f5d3df97630a4209a91d2327e523"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1eb5f800fddbea8876930cdeffa55545e17f447", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfU6CNCRBK7hj4Ov3rIwAAdHIIAIFcO6J2kHLyIHC5+ctnmGXl\nv1+CLVb/1dlU9Xu95VYRuE2ylFrUnsjmTMz+YI5fb9JdFEzoNuvPN0mYcF0E9VLR\nb56GsAHMAV74BaMGIcA1KNy4cisssFpfdUzGrRACR+gYbPAh/3AhtmezXZro+xKj\nvHTwN/F8z1olH4z9X2uOQXrLL5AUfaRNlW1ZIBBeFwAQZwGB0j6G1leE3iBMtVPz\nOwbeZ8XRAosGidt8N8hKOhLtod9lJxxUgvsdvXvLAXZNJrfq2kT7mRroDjU0jCNh\nsdJDcj8e2gXzr8mg5lYnyQdokJWs0jvQ8D/p0qMlRXKbgmv2dktq6Eg+PqmD6pE=\n=0E4F\n-----END PGP SIGNATURE-----\n", "payload": "tree 47726eb4a325f5d3df97630a4209a91d2327e523\nparent ed39e6d60a415f827aaca7fdbd571b309b1bb310\nparent d7150154fa5c35c0b570570f156ba3a5cc6dfb1d\nauthor Dylan DPC <dylan.dpc@gmail.com> 1599316108 +0200\ncommitter GitHub <noreply@github.com> 1599316108 +0200\n\nRollup merge of #76082 - jyn514:top-level-links, r=ollie27,GuillaumeGomez\n\nFix intra-doc links on pub re-exports\n\nPartial fix for https://github.com/rust-lang/rust/issues/76073 - This removes the incorrect error, but doesn't show the documentation anywhere.\nr? @GuillaumeGomez\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1eb5f800fddbea8876930cdeffa55545e17f447", "html_url": "https://github.com/rust-lang/rust/commit/f1eb5f800fddbea8876930cdeffa55545e17f447", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1eb5f800fddbea8876930cdeffa55545e17f447/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed39e6d60a415f827aaca7fdbd571b309b1bb310", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed39e6d60a415f827aaca7fdbd571b309b1bb310", "html_url": "https://github.com/rust-lang/rust/commit/ed39e6d60a415f827aaca7fdbd571b309b1bb310"}, {"sha": "d7150154fa5c35c0b570570f156ba3a5cc6dfb1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7150154fa5c35c0b570570f156ba3a5cc6dfb1d", "html_url": "https://github.com/rust-lang/rust/commit/d7150154fa5c35c0b570570f156ba3a5cc6dfb1d"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "5d10e2e149b32ee005f2954c9bf368b5d007033c", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=f1eb5f800fddbea8876930cdeffa55545e17f447", "patch": "@@ -582,6 +582,9 @@ impl<'a, 'tcx> DocFolder for LinkCollector<'a, 'tcx> {\n         let parent_node = if item.is_fake() {\n             // FIXME: is this correct?\n             None\n+        // If we're documenting the crate root itself, it has no parent. Use the root instead.\n+        } else if item.def_id.is_top_level_module() {\n+            Some(item.def_id)\n         } else {\n             let mut current = item.def_id;\n             // The immediate parent might not always be a module.\n@@ -593,6 +596,12 @@ impl<'a, 'tcx> DocFolder for LinkCollector<'a, 'tcx> {\n                     }\n                     current = parent;\n                 } else {\n+                    debug!(\n+                        \"{:?} has no parent (kind={:?}, original was {:?})\",\n+                        current,\n+                        self.cx.tcx.def_kind(current),\n+                        item.def_id\n+                    );\n                     break None;\n                 }\n             }"}, {"sha": "a4db2ffc445f8f9562681bd7cecd275c9a83c78e", "filename": "src/test/rustdoc/auxiliary/intra-link-pub-use.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-pub-use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-pub-use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauxiliary%2Fintra-link-pub-use.rs?ref=f1eb5f800fddbea8876930cdeffa55545e17f447", "patch": "@@ -0,0 +1,4 @@\n+#![crate_name = \"inner\"]\n+\n+/// Documentation, including a link to [std::ptr]\n+pub fn f() {}"}, {"sha": "dd52249abc6d0ad27cab524bd0c82325ba7fa7e5", "filename": "src/test/rustdoc/intra-link-pub-use.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Ftest%2Frustdoc%2Fintra-link-pub-use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1eb5f800fddbea8876930cdeffa55545e17f447/src%2Ftest%2Frustdoc%2Fintra-link-pub-use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fintra-link-pub-use.rs?ref=f1eb5f800fddbea8876930cdeffa55545e17f447", "patch": "@@ -0,0 +1,27 @@\n+// aux-build: intra-link-pub-use.rs\n+#![deny(broken_intra_doc_links)]\n+#![crate_name = \"outer\"]\n+\n+extern crate inner;\n+\n+/// [mod@std::env] [g]\n+\n+// FIXME: This can't be tested because rustdoc doesn't show documentation on pub re-exports.\n+// Until then, comment out the `htmldocck` test.\n+// This test still does something; namely check that no incorrect errors are emitted when\n+// documenting the re-export.\n+\n+// @has outer/index.html\n+// @ has - '//a[@href=\"https://doc.rust-lang.org/nightly/std/env/fn.var.html\"]' \"std::env\"\n+// @ has - '//a[@href=\"../outer/fn.f.html\"]' \"g\"\n+pub use f as g;\n+\n+// FIXME: same as above\n+/// [std::env]\n+extern crate self as _;\n+\n+// Make sure the documentation is actually correct by documenting an inlined re-export\n+/// [mod@std::env]\n+// @has outer/fn.f.html\n+// @has - '//a[@href=\"https://doc.rust-lang.org/nightly/std/env/index.html\"]' \"std::env\"\n+pub use inner::f;"}]}