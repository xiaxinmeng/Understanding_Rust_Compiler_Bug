{"sha": "16f69b5430cd543d5767401d760cc644dc836906", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2ZjY5YjU0MzBjZDU0M2Q1NzY3NDAxZDc2MGNjNjQ0ZGM4MzY5MDY=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-12-12T17:02:37Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-12-12T17:06:07Z"}, "message": "Don't checkout llvm-project when the LLVM backend isn't built", "tree": {"sha": "4ae53d1c9717d4a2a71c5efce08bf1e3a4a92dfc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ae53d1c9717d4a2a71c5efce08bf1e3a4a92dfc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/16f69b5430cd543d5767401d760cc644dc836906", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/16f69b5430cd543d5767401d760cc644dc836906", "html_url": "https://github.com/rust-lang/rust/commit/16f69b5430cd543d5767401d760cc644dc836906", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/16f69b5430cd543d5767401d760cc644dc836906/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f2088aa603d2cd3f43c20795872de9cd6ec7735", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f2088aa603d2cd3f43c20795872de9cd6ec7735", "html_url": "https://github.com/rust-lang/rust/commit/3f2088aa603d2cd3f43c20795872de9cd6ec7735"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "63975c6dedac3e8b0c3967991f3e01627eac9a38", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/16f69b5430cd543d5767401d760cc644dc836906/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/16f69b5430cd543d5767401d760cc644dc836906/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=16f69b5430cd543d5767401d760cc644dc836906", "patch": "@@ -892,13 +892,17 @@ def update_submodules(self):\n         filtered_submodules = []\n         submodules_names = []\n         llvm_checked_out = os.path.exists(os.path.join(self.rust_root, \"src/llvm-project/.git\"))\n+        external_llvm_provided = self.get_toml('llvm-config') or self.downloading_llvm()\n+        llvm_needed = not self.get_toml('codegen-backends', 'rust') \\\n+            or \"llvm\" in self.get_toml('codegen-backends', 'rust')\n         for module in submodules:\n             if module.endswith(\"llvm-project\"):\n-                # Don't sync the llvm-project submodule either if an external LLVM\n-                # was provided, or if we are downloading LLVM. Also, if the\n-                # submodule has been initialized already, sync it anyways so that\n-                # it doesn't mess up contributor pull requests.\n-                if self.get_toml('llvm-config') or self.downloading_llvm():\n+                # Don't sync the llvm-project submodule if an external LLVM was\n+                # provided, if we are downloading LLVM or if the LLVM backend is\n+                # not being built. Also, if the submodule has been initialized\n+                # already, sync it anyways so that it doesn't mess up contributor\n+                # pull requests.\n+                if external_llvm_provided or not llvm_needed:\n                     if self.get_toml('lld') != 'true' and not llvm_checked_out:\n                         continue\n             check = self.check_submodule(module, slow_submodules)"}]}