{"sha": "84ef603c8400db203fefd714de963c88e5523424", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0ZWY2MDNjODQwMGRiMjAzZmVmZDcxNGRlOTYzYzg4ZTU1MjM0MjQ=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-09-17T19:11:22Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-09-17T19:54:13Z"}, "message": "Fix 'FIXME' about using NonZeroU32 instead of u32.\n\nIt was blocked by #58732 (const fn NonZeroU32::new), which is fixed now.", "tree": {"sha": "ab94037d3111b05e5d3f37f86fee19d10212e08e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab94037d3111b05e5d3f37f86fee19d10212e08e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84ef603c8400db203fefd714de963c88e5523424", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84ef603c8400db203fefd714de963c88e5523424", "html_url": "https://github.com/rust-lang/rust/commit/84ef603c8400db203fefd714de963c88e5523424", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84ef603c8400db203fefd714de963c88e5523424/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7bdb5dee7bac15458b10b148e9e24968e633053e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7bdb5dee7bac15458b10b148e9e24968e633053e", "html_url": "https://github.com/rust-lang/rust/commit/7bdb5dee7bac15458b10b148e9e24968e633053e"}], "stats": {"total": 35, "additions": 18, "deletions": 17}, "files": [{"sha": "e2492efb9d79ed4c758787765ff3b3fedb756aa8", "filename": "compiler/rustc_feature/src/accepted.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs?ref=84ef603c8400db203fefd714de963c88e5523424", "patch": "@@ -1,6 +1,6 @@\n //! List of the accepted feature gates.\n \n-use super::{Feature, State};\n+use super::{to_nonzero, Feature, State};\n use rustc_span::symbol::sym;\n \n macro_rules! declare_features {\n@@ -14,7 +14,7 @@ macro_rules! declare_features {\n                     state: State::Accepted,\n                     name: sym::$feature,\n                     since: $ver,\n-                    issue: $issue,\n+                    issue: to_nonzero($issue),\n                     edition: None,\n                     description: concat!($($doc,)*),\n                 }"}, {"sha": "7dcd563228f7f75c28f2c33203c78d32e6486860", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=84ef603c8400db203fefd714de963c88e5523424", "patch": "@@ -1,6 +1,6 @@\n //! List of the active feature gates.\n \n-use super::{Feature, State};\n+use super::{to_nonzero, Feature, State};\n \n use rustc_span::edition::Edition;\n use rustc_span::symbol::{sym, Symbol};\n@@ -29,7 +29,7 @@ macro_rules! declare_features {\n                     state: State::Active { set: set!($feature) },\n                     name: sym::$feature,\n                     since: $ver,\n-                    issue: $issue,\n+                    issue: to_nonzero($issue),\n                     edition: $edition,\n                     description: concat!($($doc,)*),\n                 }"}, {"sha": "c70f3c3cd402fe44a86a31472d4f35e7b4c89007", "filename": "compiler/rustc_feature/src/lib.rs", "status": "modified", "additions": 11, "deletions": 10, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Flib.rs?ref=84ef603c8400db203fefd714de963c88e5523424", "patch": "@@ -46,17 +46,11 @@ pub struct Feature {\n     pub state: State,\n     pub name: Symbol,\n     pub since: &'static str,\n-    issue: Option<u32>, // FIXME: once #58732 is done make this an Option<NonZeroU32>\n+    issue: Option<NonZeroU32>,\n     pub edition: Option<Edition>,\n     description: &'static str,\n }\n \n-impl Feature {\n-    fn issue(&self) -> Option<NonZeroU32> {\n-        self.issue.and_then(NonZeroU32::new)\n-    }\n-}\n-\n #[derive(Copy, Clone, Debug)]\n pub enum Stability {\n     Unstable,\n@@ -102,8 +96,8 @@ impl UnstableFeatures {\n fn find_lang_feature_issue(feature: Symbol) -> Option<NonZeroU32> {\n     if let Some(info) = ACTIVE_FEATURES.iter().find(|t| t.name == feature) {\n         // FIXME (#28244): enforce that active features have issue numbers\n-        // assert!(info.issue().is_some())\n-        info.issue()\n+        // assert!(info.issue.is_some())\n+        info.issue\n     } else {\n         // search in Accepted, Removed, or Stable Removed features\n         let found = ACCEPTED_FEATURES\n@@ -112,12 +106,19 @@ fn find_lang_feature_issue(feature: Symbol) -> Option<NonZeroU32> {\n             .chain(STABLE_REMOVED_FEATURES)\n             .find(|t| t.name == feature);\n         match found {\n-            Some(found) => found.issue(),\n+            Some(found) => found.issue,\n             None => panic!(\"feature `{}` is not declared anywhere\", feature),\n         }\n     }\n }\n \n+const fn to_nonzero(n: Option<u32>) -> Option<NonZeroU32> {\n+    match n {\n+        None => None,\n+        Some(n) => NonZeroU32::new(n),\n+    }\n+}\n+\n pub enum GateIssue {\n     Language,\n     Library(Option<NonZeroU32>),"}, {"sha": "a480ddc7f34b1f2e41b8004b300272ac6dbe73f6", "filename": "compiler/rustc_feature/src/removed.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84ef603c8400db203fefd714de963c88e5523424/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fremoved.rs?ref=84ef603c8400db203fefd714de963c88e5523424", "patch": "@@ -1,6 +1,6 @@\n //! List of the removed feature gates.\n \n-use super::{Feature, State};\n+use super::{to_nonzero, Feature, State};\n use rustc_span::symbol::sym;\n \n macro_rules! declare_features {\n@@ -14,7 +14,7 @@ macro_rules! declare_features {\n                     state: State::Removed { reason: $reason },\n                     name: sym::$feature,\n                     since: $ver,\n-                    issue: $issue,\n+                    issue: to_nonzero($issue),\n                     edition: None,\n                     description: concat!($($doc,)*),\n                 }\n@@ -32,7 +32,7 @@ macro_rules! declare_features {\n                     state: State::Stabilized { reason: None },\n                     name: sym::$feature,\n                     since: $ver,\n-                    issue: $issue,\n+                    issue: to_nonzero($issue),\n                     edition: None,\n                     description: concat!($($doc,)*),\n                 }"}]}