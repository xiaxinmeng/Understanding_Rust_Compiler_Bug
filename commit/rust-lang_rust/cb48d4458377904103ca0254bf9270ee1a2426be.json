{"sha": "cb48d4458377904103ca0254bf9270ee1a2426be", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiNDhkNDQ1ODM3NzkwNDEwM2NhMDI1NGJmOTI3MGVlMWEyNDI2YmU=", "commit": {"author": {"name": "arcnmx", "email": "arcnmx@users.noreply.github.com", "date": "2015-10-11T23:49:57Z"}, "committer": {"name": "arcnmx", "email": "arcnmx@users.noreply.github.com", "date": "2015-10-19T05:29:44Z"}, "message": "Owned conversions for CString", "tree": {"sha": "da8c3c40252f8e149913385b8566b7aacec6a5b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da8c3c40252f8e149913385b8566b7aacec6a5b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb48d4458377904103ca0254bf9270ee1a2426be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb48d4458377904103ca0254bf9270ee1a2426be", "html_url": "https://github.com/rust-lang/rust/commit/cb48d4458377904103ca0254bf9270ee1a2426be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb48d4458377904103ca0254bf9270ee1a2426be/comments", "author": {"login": "arcnmx", "id": 13426784, "node_id": "MDQ6VXNlcjEzNDI2Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/13426784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arcnmx", "html_url": "https://github.com/arcnmx", "followers_url": "https://api.github.com/users/arcnmx/followers", "following_url": "https://api.github.com/users/arcnmx/following{/other_user}", "gists_url": "https://api.github.com/users/arcnmx/gists{/gist_id}", "starred_url": "https://api.github.com/users/arcnmx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arcnmx/subscriptions", "organizations_url": "https://api.github.com/users/arcnmx/orgs", "repos_url": "https://api.github.com/users/arcnmx/repos", "events_url": "https://api.github.com/users/arcnmx/events{/privacy}", "received_events_url": "https://api.github.com/users/arcnmx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arcnmx", "id": 13426784, "node_id": "MDQ6VXNlcjEzNDI2Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/13426784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arcnmx", "html_url": "https://github.com/arcnmx", "followers_url": "https://api.github.com/users/arcnmx/followers", "following_url": "https://api.github.com/users/arcnmx/following{/other_user}", "gists_url": "https://api.github.com/users/arcnmx/gists{/gist_id}", "starred_url": "https://api.github.com/users/arcnmx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arcnmx/subscriptions", "organizations_url": "https://api.github.com/users/arcnmx/orgs", "repos_url": "https://api.github.com/users/arcnmx/repos", "events_url": "https://api.github.com/users/arcnmx/events{/privacy}", "received_events_url": "https://api.github.com/users/arcnmx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c413bb4fff6f0ff718f2b8aaa6c871d00b86e77b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c413bb4fff6f0ff718f2b8aaa6c871d00b86e77b", "html_url": "https://github.com/rust-lang/rust/commit/c413bb4fff6f0ff718f2b8aaa6c871d00b86e77b"}], "stats": {"total": 74, "additions": 72, "deletions": 2}, "files": [{"sha": "89427f7851b389cbbb54599eac953a82e21e6623", "filename": "src/libstd/ffi/c_str.rs", "status": "modified", "additions": 71, "deletions": 1, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/cb48d4458377904103ca0254bf9270ee1a2426be/src%2Flibstd%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb48d4458377904103ca0254bf9270ee1a2426be/src%2Flibstd%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fc_str.rs?ref=cb48d4458377904103ca0254bf9270ee1a2426be", "patch": "@@ -23,7 +23,7 @@ use ops::Deref;\n use option::Option::{self, Some, None};\n use result::Result::{self, Ok, Err};\n use slice;\n-use str;\n+use str::{self, Utf8Error};\n use string::String;\n use vec::Vec;\n \n@@ -151,6 +151,15 @@ pub struct CStr {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub struct NulError(usize, Vec<u8>);\n \n+/// An error returned from `CString::into_string` to indicate that a UTF-8 error\n+/// was encountered during the conversion.\n+#[derive(Clone, PartialEq, Debug)]\n+#[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+pub struct IntoStringError {\n+    inner: CString,\n+    error: Utf8Error,\n+}\n+\n impl CString {\n     /// Creates a new C-compatible string from a container of bytes.\n     ///\n@@ -255,6 +264,38 @@ impl CString {\n         Box::into_raw(self.inner) as *mut libc::c_char\n     }\n \n+    /// Converts the `CString` into a `String` if it contains valid Unicode data.\n+    ///\n+    /// On failure, ownership of the original `CString` is returned.\n+    #[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+    pub fn into_string(self) -> Result<String, IntoStringError> {\n+        String::from_utf8(self.into_bytes())\n+            .map_err(|e| IntoStringError {\n+                error: e.utf8_error(),\n+                inner: unsafe { CString::from_vec_unchecked(e.into_bytes()) },\n+            })\n+    }\n+\n+    /// Returns the underlying byte buffer.\n+    ///\n+    /// The returned buffer does **not** contain the trailing nul separator and\n+    /// it is guaranteed to not have any interior nul bytes.\n+    #[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+    pub fn into_bytes(self) -> Vec<u8> {\n+        // FIXME: Once this method becomes stable, add an `impl Into<Vec<u8>> for CString`\n+        let mut vec = self.inner.into_vec();\n+        let _nul = vec.pop();\n+        debug_assert_eq!(_nul, Some(0u8));\n+        vec\n+    }\n+\n+    /// Equivalent to the `into_bytes` function except that the returned vector\n+    /// includes the trailing nul byte.\n+    #[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+    pub fn into_bytes_with_nul(self) -> Vec<u8> {\n+        self.inner.into_vec()\n+    }\n+\n     /// Returns the contents of this `CString` as a slice of bytes.\n     ///\n     /// The returned slice does **not** contain the trailing nul separator and\n@@ -336,6 +377,35 @@ impl From<NulError> for io::Error {\n     }\n }\n \n+impl IntoStringError {\n+    /// Consumes this error, returning original `CString` which generated the\n+    /// error.\n+    #[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+    pub fn into_cstring(self) -> CString {\n+        self.inner\n+    }\n+\n+    /// Access the underlying UTF-8 error that was the cause of this error.\n+    #[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+    pub fn utf8_error(&self) -> Utf8Error {\n+        self.error\n+    }\n+}\n+\n+#[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+impl Error for IntoStringError {\n+    fn description(&self) -> &str {\n+        Error::description(&self.error)\n+    }\n+}\n+\n+#[unstable(feature = \"cstring_into\", reason = \"recently added\", issue = \"29157\")]\n+impl fmt::Display for IntoStringError {\n+    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n+        fmt::Display::fmt(&self.error, f)\n+    }\n+}\n+\n impl CStr {\n     /// Casts a raw C string to a safe C string wrapper.\n     ///"}, {"sha": "bfd6ab52289b2f159190dfe9ee3470d65ac1ddde", "filename": "src/libstd/ffi/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cb48d4458377904103ca0254bf9270ee1a2426be/src%2Flibstd%2Fffi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb48d4458377904103ca0254bf9270ee1a2426be/src%2Flibstd%2Fffi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fmod.rs?ref=cb48d4458377904103ca0254bf9270ee1a2426be", "patch": "@@ -13,7 +13,7 @@\n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub use self::c_str::{CString, CStr, NulError};\n+pub use self::c_str::{CString, CStr, NulError, IntoStringError};\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub use self::os_str::{OsString, OsStr};"}]}