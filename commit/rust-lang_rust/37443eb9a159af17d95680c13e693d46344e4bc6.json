{"sha": "37443eb9a159af17d95680c13e693d46344e4bc6", "node_id": "C_kwDOAAsO6NoAKDM3NDQzZWI5YTE1OWFmMTdkOTU2ODBjMTNlNjkzZDQ2MzQ0ZTRiYzY", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-05-05T14:26:16Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-05-05T14:28:59Z"}, "message": "Maybe everything else *should* have to deal with it", "tree": {"sha": "478bae0792aa7d85e41dbc8f0b5e8c53a4bd91ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/478bae0792aa7d85e41dbc8f0b5e8c53a4bd91ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37443eb9a159af17d95680c13e693d46344e4bc6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37443eb9a159af17d95680c13e693d46344e4bc6", "html_url": "https://github.com/rust-lang/rust/commit/37443eb9a159af17d95680c13e693d46344e4bc6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37443eb9a159af17d95680c13e693d46344e4bc6/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2fe38d3b63cf4b6f2278a656b7ffed40a524f0ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/2fe38d3b63cf4b6f2278a656b7ffed40a524f0ff", "html_url": "https://github.com/rust-lang/rust/commit/2fe38d3b63cf4b6f2278a656b7ffed40a524f0ff"}], "stats": {"total": 75, "additions": 35, "deletions": 40}, "files": [{"sha": "bafbf6d9cc886c8e5f4d1ee429077d3ac76f3070", "filename": "crates/ide/src/syntax_highlighting/highlight.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -30,8 +30,13 @@ pub(super) fn token(sema: &Semantics<RootDatabase>, token: SyntaxToken) -> Optio\n         INT_NUMBER if token.ancestors().nth(1).map(|it| it.kind()) == Some(FIELD_EXPR) => {\n             SymbolKind::Field.into()\n         }\n-        INT_NUMBER | FLOAT_NUMBER_PART => HlTag::NumericLiteral.into(),\n-        DOT if token.parent().map(|n| n.kind()) == Some(FLOAT_LITERAL) => {\n+        INT_NUMBER | FLOAT_NUMBER_PART | FLOAT_NUMBER_START_0 | FLOAT_NUMBER_START_1\n+        | FLOAT_NUMBER_START_2 => HlTag::NumericLiteral.into(),\n+        DOT if matches!(\n+            token.prev_token().map(|n| n.kind()),\n+            Some(FLOAT_NUMBER_START_1 | FLOAT_NUMBER_START_2)\n+        ) =>\n+        {\n             HlTag::NumericLiteral.into()\n         }\n         BYTE => HlTag::ByteLiteral.into(),"}, {"sha": "79fd1250e0e302893e1e291003bd04f59f59cff5", "filename": "crates/mbe/src/syntax_bridge.rs", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -260,23 +260,19 @@ fn convert_tokens<C: TokenConvertor>(conv: &mut C) -> tt::Subtree {\n                 IDENT => make_leaf!(Ident),\n                 UNDERSCORE => make_leaf!(Ident),\n                 k if k.is_keyword() => make_leaf!(Ident),\n-                FLOAT_NUMBER_PART => {\n+                FLOAT_NUMBER_START_0 | FLOAT_NUMBER_START_1 | FLOAT_NUMBER_START_2 => {\n                     // Reassemble a split-up float token.\n                     let mut range = range;\n                     let mut text = token.to_text(conv).to_string();\n-                    if let Some(dot) = conv.peek() {\n-                        if dot.kind(conv) == DOT {\n-                            let (_, dot_range) = conv.bump().unwrap();\n-                            text += &*dot.to_text(conv);\n-                            range = TextRange::new(range.start(), dot_range.end());\n-\n-                            if let Some(tail) = conv.peek() {\n-                                if tail.kind(conv) == FLOAT_NUMBER_PART {\n-                                    let (_, tail_range) = conv.bump().unwrap();\n-                                    text += &*tail.to_text(conv);\n-                                    range = TextRange::new(range.start(), tail_range.end());\n-                                }\n-                            }\n+                    if kind == FLOAT_NUMBER_START_1 || kind == FLOAT_NUMBER_START_2 {\n+                        let (dot, dot_range) = conv.bump().unwrap();\n+                        text += &*dot.to_text(conv);\n+                        range = TextRange::new(range.start(), dot_range.end());\n+\n+                        if kind == FLOAT_NUMBER_START_2 {\n+                            let (tail, tail_range) = conv.bump().unwrap();\n+                            text += &*tail.to_text(conv);\n+                            range = TextRange::new(range.start(), tail_range.end());\n                         }\n                     }\n "}, {"sha": "290083b343495a3e2e2597027d0012424692da9e", "filename": "crates/parser/src/grammar/expressions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions.rs?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -3,7 +3,7 @@ mod atom;\n use super::*;\n \n pub(crate) use self::atom::{block_expr, match_arm_list};\n-pub(super) use self::atom::{float_literal, literal, FLOAT_LITERAL_FIRST, LITERAL_FIRST};\n+pub(super) use self::atom::{literal, FLOAT_LITERAL_FIRST, LITERAL_FIRST};\n \n #[derive(PartialEq, Eq)]\n pub(super) enum Semicolon {"}, {"sha": "5ab148ff288080f46fe2daf027b95d3ccf988321", "filename": "crates/parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -53,16 +53,14 @@ pub(crate) fn literal(p: &mut Parser) -> Option<CompletedMarker> {\n // }\n pub(crate) fn float_literal(p: &mut Parser) {\n     // Floats can be up to 3 tokens. The first token indicates how many there are.\n-    // We remap the first token to `FLOAT_NUMBER_PART` so that no subsequent code has to deal with\n-    // this awful, awful hack.\n     let f = p.start();\n     if p.at(FLOAT_NUMBER_START_0) {\n-        p.bump_remap(FLOAT_NUMBER_PART);\n+        p.bump(FLOAT_NUMBER_START_0);\n     } else if p.at(FLOAT_NUMBER_START_1) {\n-        p.bump_remap(FLOAT_NUMBER_PART);\n+        p.bump(FLOAT_NUMBER_START_1);\n         p.bump(DOT);\n     } else if p.at(FLOAT_NUMBER_START_2) {\n-        p.bump_remap(FLOAT_NUMBER_PART);\n+        p.bump(FLOAT_NUMBER_START_2);\n         p.bump(DOT);\n         p.bump(FLOAT_NUMBER_PART);\n     } else {"}, {"sha": "7bfd9ef8c8a12852fb97d2512f3ac889fbd0077f", "filename": "crates/parser/src/grammar/items.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -9,7 +9,7 @@ pub(crate) use self::{\n     traits::assoc_item_list,\n     use_item::use_tree_list,\n };\n-use super::{expressions::float_literal, *};\n+use super::*;\n \n // test mod_contents\n // fn foo() {}\n@@ -457,9 +457,6 @@ pub(crate) fn token_tree(p: &mut Parser) {\n                 return;\n             }\n             T![')'] | T![']'] => p.err_and_bump(\"unmatched brace\"),\n-            FLOAT_NUMBER_START_0 | FLOAT_NUMBER_START_1 | FLOAT_NUMBER_START_2 => {\n-                float_literal(p);\n-            }\n             _ => p.bump_any(),\n         }\n     }"}, {"sha": "70cd030da1ec1aae7d015b4eb34e8e43fd8efff9", "filename": "crates/parser/test_data/parser/err/0023_mismatched_paren.rast", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Ferr%2F0023_mismatched_paren.rast", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Ferr%2F0023_mismatched_paren.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Ferr%2F0023_mismatched_paren.rast?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -32,10 +32,9 @@ SOURCE_FILE\n               INT_NUMBER \"1\"\n               COMMA \",\"\n               WHITESPACE \" \"\n-              FLOAT_LITERAL\n-                FLOAT_NUMBER_PART \"2\"\n-                DOT \".\"\n-                FLOAT_NUMBER_PART \"0\"\n+              FLOAT_NUMBER_START_2 \"2\"\n+              DOT \".\"\n+              FLOAT_NUMBER_PART \"0\"\n         WHITESPACE \"\\n    \"\n         R_CURLY \"}\"\n   WHITESPACE \" \""}, {"sha": "b3236976b984deecf88662f14ac35d27e018e15b", "filename": "crates/parser/test_data/parser/inline/ok/0085_expr_literals.rast", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0085_expr_literals.rast", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0085_expr_literals.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0085_expr_literals.rast?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -58,7 +58,7 @@ SOURCE_FILE\n           WHITESPACE \" \"\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"2\"\n+              FLOAT_NUMBER_START_2 \"2\"\n               DOT \".\"\n               FLOAT_NUMBER_PART \"0\"\n           SEMICOLON \";\""}, {"sha": "69f1055b7e36009724f273ec853c5edc67729ae1", "filename": "crates/parser/test_data/parser/inline/ok/0107_method_call_expr.rast", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0107_method_call_expr.rast", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0107_method_call_expr.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0107_method_call_expr.rast?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -63,7 +63,7 @@ SOURCE_FILE\n           METHOD_CALL_EXPR\n             LITERAL\n               FLOAT_LITERAL\n-                FLOAT_NUMBER_PART \"0e0\"\n+                FLOAT_NUMBER_START_0 \"0e0\"\n             DOT \".\"\n             NAME_REF\n               IDENT \"sin\"\n@@ -76,7 +76,7 @@ SOURCE_FILE\n           METHOD_CALL_EXPR\n             LITERAL\n               FLOAT_LITERAL\n-                FLOAT_NUMBER_PART \"0e0f32\"\n+                FLOAT_NUMBER_START_0 \"0e0f32\"\n             DOT \".\"\n             NAME_REF\n               IDENT \"sin\""}, {"sha": "df4fb6eb417ba0ceb9b79ba9a86d584cfb6b4861", "filename": "crates/parser/test_data/parser/inline/ok/0201_float_literal.rast", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0201_float_literal.rast", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0201_float_literal.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0201_float_literal.rast?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -15,34 +15,34 @@ SOURCE_FILE\n         EXPR_STMT\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"0\"\n+              FLOAT_NUMBER_START_2 \"0\"\n               DOT \".\"\n               FLOAT_NUMBER_PART \"0\"\n           SEMICOLON \";\"\n         WHITESPACE \"\\n    \"\n         EXPR_STMT\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"1\"\n+              FLOAT_NUMBER_START_1 \"1\"\n               DOT \".\"\n           SEMICOLON \";\"\n         WHITESPACE \"\\n    \"\n         EXPR_STMT\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"0e0\"\n+              FLOAT_NUMBER_START_0 \"0e0\"\n           SEMICOLON \";\"\n         WHITESPACE \"\\n    \"\n         EXPR_STMT\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"0e0f32\"\n+              FLOAT_NUMBER_START_0 \"0e0f32\"\n           SEMICOLON \";\"\n         WHITESPACE \"\\n    \"\n         EXPR_STMT\n           LITERAL\n             FLOAT_LITERAL\n-              FLOAT_NUMBER_PART \"1\"\n+              FLOAT_NUMBER_START_2 \"1\"\n               DOT \".\"\n               FLOAT_NUMBER_PART \"23f64\"\n           SEMICOLON \";\""}, {"sha": "b2f66e2f1e7c3260ede7397fd66d986349f4943d", "filename": "crates/parser/test_data/parser/ok/0056_neq_in_type.rast", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Fok%2F0056_neq_in_type.rast", "raw_url": "https://github.com/rust-lang/rust/raw/37443eb9a159af17d95680c13e693d46344e4bc6/crates%2Fparser%2Ftest_data%2Fparser%2Fok%2F0056_neq_in_type.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Fok%2F0056_neq_in_type.rast?ref=37443eb9a159af17d95680c13e693d46344e4bc6", "patch": "@@ -20,7 +20,7 @@ SOURCE_FILE\n               METHOD_CALL_EXPR\n                 LITERAL\n                   FLOAT_LITERAL\n-                    FLOAT_NUMBER_PART \"1\"\n+                    FLOAT_NUMBER_START_2 \"1\"\n                     DOT \".\"\n                     FLOAT_NUMBER_PART \"0f32\"\n                 DOT \".\"\n@@ -44,7 +44,7 @@ SOURCE_FILE\n               METHOD_CALL_EXPR\n                 LITERAL\n                   FLOAT_LITERAL\n-                    FLOAT_NUMBER_PART \"1\"\n+                    FLOAT_NUMBER_START_2 \"1\"\n                     DOT \".\"\n                     FLOAT_NUMBER_PART \"0f32\"\n                 DOT \".\""}]}