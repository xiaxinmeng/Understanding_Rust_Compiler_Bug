{"sha": "b50bb65c2a2e1814099f16f56a6e787eda1da09a", "node_id": "C_kwDOAAsO6NoAKGI1MGJiNjVjMmEyZTE4MTQwOTlmMTZmNTZhNmU3ODdlZGExZGEwOWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-14T09:21:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-14T09:21:05Z"}, "message": "Rollup merge of #91875 - b-naber:mir-transform-norm-erase-reg, r=Aaron1011\n\nUse try_normalize_erasing_regions in RevealAllVisitor\n\nFixes https://github.com/rust-lang/rust/issues/91745\n\nThanks to ``@Aaron1011`` for [pointing out the problem](https://github.com/rust-lang/rust/issues/91745#issuecomment-991996008).\n\nr? ``@Aaron1011``", "tree": {"sha": "4ddbb2df075c13aab1fd12de0e0018835324e19a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ddbb2df075c13aab1fd12de0e0018835324e19a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b50bb65c2a2e1814099f16f56a6e787eda1da09a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhuGIBCRBK7hj4Ov3rIwAAArMIAC4C3wv/sOqyy+Nn6kwrHjZp\nMf1wbvEginYfX1W6HmM8Jy3pmlH5Qh8UQOJXcBfGyxYOvenTJARrnrSGTir+xlr5\nx/Cqj63lG5CLEeaNzmX3DHR01g7qU9yggJIIruXncbxh+wjpw5MHV+Md6aZQsrTM\np10ob/HreuIiukrGOx3cd/L2tH5w8SANL/3Yww7qHgv4M2NNn7cqiey5MY0UXYJl\nHFGv66mDIruyuJUcvplNXgyoq+SwGx74mdg4SiqW9LeE0S7BjhHKj/8tRQ1ySL5R\nXTx0GWP5hvr0HzM8o0qDI1eo3ihNVztXUKsozrmw1hpJyslheHKvp4o68TuxrmE=\n=3qhB\n-----END PGP SIGNATURE-----\n", "payload": "tree 4ddbb2df075c13aab1fd12de0e0018835324e19a\nparent 75e8d65ccde2f4c238770db19adaf9c50a4c559c\nparent f3ecd64c617585e79956a3bba265e22ff1cad1e4\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1639473665 +0100\ncommitter GitHub <noreply@github.com> 1639473665 +0100\n\nRollup merge of #91875 - b-naber:mir-transform-norm-erase-reg, r=Aaron1011\n\nUse try_normalize_erasing_regions in RevealAllVisitor\n\nFixes https://github.com/rust-lang/rust/issues/91745\n\nThanks to ``@Aaron1011`` for [pointing out the problem](https://github.com/rust-lang/rust/issues/91745#issuecomment-991996008).\n\nr? ``@Aaron1011``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b50bb65c2a2e1814099f16f56a6e787eda1da09a", "html_url": "https://github.com/rust-lang/rust/commit/b50bb65c2a2e1814099f16f56a6e787eda1da09a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b50bb65c2a2e1814099f16f56a6e787eda1da09a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75e8d65ccde2f4c238770db19adaf9c50a4c559c", "url": "https://api.github.com/repos/rust-lang/rust/commits/75e8d65ccde2f4c238770db19adaf9c50a4c559c", "html_url": "https://github.com/rust-lang/rust/commit/75e8d65ccde2f4c238770db19adaf9c50a4c559c"}, {"sha": "f3ecd64c617585e79956a3bba265e22ff1cad1e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3ecd64c617585e79956a3bba265e22ff1cad1e4", "html_url": "https://github.com/rust-lang/rust/commit/f3ecd64c617585e79956a3bba265e22ff1cad1e4"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "ee661793a44aae74cc7f042cd140f94ad32d1db2", "filename": "compiler/rustc_mir_transform/src/reveal_all.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b50bb65c2a2e1814099f16f56a6e787eda1da09a/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b50bb65c2a2e1814099f16f56a6e787eda1da09a/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Freveal_all.rs?ref=b50bb65c2a2e1814099f16f56a6e787eda1da09a", "patch": "@@ -36,6 +36,9 @@ impl<'tcx> MutVisitor<'tcx> for RevealAllVisitor<'tcx> {\n \n     #[inline]\n     fn visit_ty(&mut self, ty: &mut Ty<'tcx>, _: TyContext) {\n-        *ty = self.tcx.normalize_erasing_regions(self.param_env, ty);\n+        // We have to use `try_normalize_erasing_regions` here, since it's\n+        // possible that we visit impossible-to-satisfy where clauses here,\n+        // see #91745\n+        *ty = self.tcx.try_normalize_erasing_regions(self.param_env, *ty).unwrap_or(ty);\n     }\n }"}, {"sha": "ca3d66b1c8eb7d9cb96551589f5a97b26da50e31", "filename": "src/test/ui/mir/issue-91745.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b50bb65c2a2e1814099f16f56a6e787eda1da09a/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b50bb65c2a2e1814099f16f56a6e787eda1da09a/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmir%2Fissue-91745.rs?ref=b50bb65c2a2e1814099f16f56a6e787eda1da09a", "patch": "@@ -0,0 +1,21 @@\n+// check-pass\n+\n+pub trait Foo {\n+    type Bar;\n+}\n+\n+pub trait Broken {\n+    type Assoc;\n+    fn broken(&self) where Self::Assoc: Foo;\n+}\n+\n+impl<T> Broken for T {\n+    type Assoc = ();\n+    fn broken(&self) where Self::Assoc: Foo {\n+        let _x: <Self::Assoc as Foo>::Bar;\n+    }\n+}\n+\n+fn main() {\n+    let _m: &dyn Broken<Assoc=()> = &();\n+}"}]}