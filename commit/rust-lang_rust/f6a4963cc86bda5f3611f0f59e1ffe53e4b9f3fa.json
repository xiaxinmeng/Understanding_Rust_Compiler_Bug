{"sha": "f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2YTQ5NjNjYzg2YmRhNWYzNjExZjBmNTllMWZmZTUzZTRiOWYzZmE=", "commit": {"author": {"name": "Ian Jackson", "email": "ijackson@chiark.greenend.org.uk", "date": "2021-05-13T17:38:25Z"}, "committer": {"name": "Ian Jackson", "email": "ijackson@chiark.greenend.org.uk", "date": "2021-05-13T17:38:25Z"}, "message": "Use SIGUSR1 rather than SIGTRAP for \"allocated after fork\"\n\nSome platforma (eg ARM64) apparently generate SIGTRAP for panic abort!\n\nSee eg\n  https://github.com/rust-lang/rust/pull/81858#issuecomment-840702765\n\nThis is probably a bug, but (i) we want to avoid that bug rather than\ntrying to fix it now and (ii) it would better to use a signal that is\nless at risk of strangeness.\n\nI grepped the rust-lang/rut codebase for SIGUSR and there were no hits.\n\nSigned-off-by: Ian Jackson <ijackson@chiark.greenend.org.uk>", "tree": {"sha": "44cf734c168a994c8ec7ad541f11abea2de9b4fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44cf734c168a994c8ec7ad541f11abea2de9b4fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa", "html_url": "https://github.com/rust-lang/rust/commit/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa/comments", "author": {"login": "ijackson", "id": 2090772, "node_id": "MDQ6VXNlcjIwOTA3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2090772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ijackson", "html_url": "https://github.com/ijackson", "followers_url": "https://api.github.com/users/ijackson/followers", "following_url": "https://api.github.com/users/ijackson/following{/other_user}", "gists_url": "https://api.github.com/users/ijackson/gists{/gist_id}", "starred_url": "https://api.github.com/users/ijackson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ijackson/subscriptions", "organizations_url": "https://api.github.com/users/ijackson/orgs", "repos_url": "https://api.github.com/users/ijackson/repos", "events_url": "https://api.github.com/users/ijackson/events{/privacy}", "received_events_url": "https://api.github.com/users/ijackson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ijackson", "id": 2090772, "node_id": "MDQ6VXNlcjIwOTA3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2090772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ijackson", "html_url": "https://github.com/ijackson", "followers_url": "https://api.github.com/users/ijackson/followers", "following_url": "https://api.github.com/users/ijackson/following{/other_user}", "gists_url": "https://api.github.com/users/ijackson/gists{/gist_id}", "starred_url": "https://api.github.com/users/ijackson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ijackson/subscriptions", "organizations_url": "https://api.github.com/users/ijackson/orgs", "repos_url": "https://api.github.com/users/ijackson/repos", "events_url": "https://api.github.com/users/ijackson/events{/privacy}", "received_events_url": "https://api.github.com/users/ijackson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8220f2f2127b9aec972163ded97be7d8cff6b9a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/8220f2f2127b9aec972163ded97be7d8cff6b9a8", "html_url": "https://github.com/rust-lang/rust/commit/8220f2f2127b9aec972163ded97be7d8cff6b9a8"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "5cc436c335edd6881bd48c96959e2a45ad4ee1de", "filename": "src/test/ui/process/process-panic-after-fork.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa/src%2Ftest%2Fui%2Fprocess%2Fprocess-panic-after-fork.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa/src%2Ftest%2Fui%2Fprocess%2Fprocess-panic-after-fork.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprocess%2Fprocess-panic-after-fork.rs?ref=f6a4963cc86bda5f3611f0f59e1ffe53e4b9f3fa", "patch": "@@ -46,7 +46,7 @@ impl<A> PidChecking<A> {\n             let actual_pid = process::id();\n             if require_pid != actual_pid {\n                 unsafe {\n-                    libc::raise(libc::SIGTRAP);\n+                    libc::raise(libc::SIGUSR1);\n                 }\n             }\n         }\n@@ -146,5 +146,5 @@ fn main() {\n \n     let status = run(&|| panic!(\"allocating to display... {}\", DisplayWithHeap));\n     dbg!(status);\n-    assert_eq!(status.signal(), Some(libc::SIGTRAP));\n+    assert_eq!(status.signal(), Some(libc::SIGUSR1));\n }"}]}