{"sha": "d67eb1f1487c04cdd2564741828cba0784ed8501", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2N2ViMWYxNDg3YzA0Y2RkMjU2NDc0MTgyOGNiYTA3ODRlZDg1MDE=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-08-28T04:23:24Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-09-05T17:48:20Z"}, "message": "Don't suggest \\[ \\] if there's a :: in the path", "tree": {"sha": "6441888d461bc212b5fd3ac0da9f773cab6c0aef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6441888d461bc212b5fd3ac0da9f773cab6c0aef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d67eb1f1487c04cdd2564741828cba0784ed8501", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d67eb1f1487c04cdd2564741828cba0784ed8501", "html_url": "https://github.com/rust-lang/rust/commit/d67eb1f1487c04cdd2564741828cba0784ed8501", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d67eb1f1487c04cdd2564741828cba0784ed8501/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2826d9e9bcba3c161812fca893f98b3dc010f19", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2826d9e9bcba3c161812fca893f98b3dc010f19", "html_url": "https://github.com/rust-lang/rust/commit/f2826d9e9bcba3c161812fca893f98b3dc010f19"}], "stats": {"total": 44, "additions": 20, "deletions": 24}, "files": [{"sha": "0ae322ee11ae3130268c0130598aa45a7f868c0a", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=d67eb1f1487c04cdd2564741828cba0784ed8501", "patch": "@@ -592,7 +592,6 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n     /// (such as having invalid URL fragments or being in the wrong namespace).\n     fn check_full_res(\n         &self,\n-        // TODO: is this parameter actually needed, since we return results for the wrong namespace?\n         ns: Namespace,\n         path_str: &str,\n         base_node: Option<DefId>,\n@@ -1511,7 +1510,13 @@ fn resolution_failure(\n                             continue;\n                         }\n                         diag.note(&format!(\"no item named `{}` is in scope\", base));\n-                        diag.help(r#\"to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\"#);\n+                        // If the link has `::` in the path, assume it's meant to be an intra-doc link\n+                        if !path_str.contains(\"::\") {\n+                            // Otherwise, the `[]` might be unrelated.\n+                            // FIXME(https://github.com/raphlinus/pulldown-cmark/issues/373):\n+                            // don't show this for autolinks (`<>`), `()` style links, or reference links\n+                            diag.help(r#\"to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\"#);\n+                        }\n                     }\n                     ResolutionFailure::Dummy => continue,\n                     ResolutionFailure::WrongNamespace(res, expected_ns) => {"}, {"sha": "f66bb8a453305f81d3add3d29a00874c2cbb0f7e", "filename": "src/test/rustdoc-ui/intra-link-errors.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs?ref=d67eb1f1487c04cdd2564741828cba0784ed8501", "patch": "@@ -7,7 +7,6 @@\n /// [path::to::nonexistent::module]\n //~^ ERROR unresolved link\n //~| NOTE no item named `path` is in scope\n-//~| HELP to escape\n \n /// [std::io::not::here]\n //~^ ERROR unresolved link\n@@ -67,7 +66,6 @@ impl S {\n /// [T::h!]\n //~^ ERROR unresolved link\n //~| NOTE no item named `T::h`\n-//~| HELP to escape\n pub trait T {\n     fn g() {}\n }"}, {"sha": "4dac892b82051c65a65b4367a0f62e364e425cb3", "filename": "src/test/rustdoc-ui/intra-link-errors.stderr", "status": "modified", "additions": 13, "deletions": 15, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr?ref=d67eb1f1487c04cdd2564741828cba0784ed8501", "patch": "@@ -10,74 +10,73 @@ note: the lint level is defined here\n LL | #![deny(broken_intra_doc_links)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n    = note: no item named `path` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n error: unresolved link to `std::io::not::here`\n-  --> $DIR/intra-link-errors.rs:13:6\n+  --> $DIR/intra-link-errors.rs:12:6\n    |\n LL | /// [std::io::not::here]\n    |      ^^^^^^^^^^^^^^^^^^\n    |\n    = note: the module `io` has no inner item named `not`\n \n error: unresolved link to `std::io::Error::x`\n-  --> $DIR/intra-link-errors.rs:17:6\n+  --> $DIR/intra-link-errors.rs:16:6\n    |\n LL | /// [std::io::Error::x]\n    |      ^^^^^^^^^^^^^^^^^\n    |\n    = note: the struct `Error` has no field or associated item named `x`\n \n error: unresolved link to `std::io::ErrorKind::x`\n-  --> $DIR/intra-link-errors.rs:21:6\n+  --> $DIR/intra-link-errors.rs:20:6\n    |\n LL | /// [std::io::ErrorKind::x]\n    |      ^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: the enum `ErrorKind` has no variant or associated item named `x`\n \n error: unresolved link to `f::A`\n-  --> $DIR/intra-link-errors.rs:25:6\n+  --> $DIR/intra-link-errors.rs:24:6\n    |\n LL | /// [f::A]\n    |      ^^^^\n    |\n    = note: `f` is a function, not a module or type, and cannot have associated items\n \n error: unresolved link to `S::A`\n-  --> $DIR/intra-link-errors.rs:29:6\n+  --> $DIR/intra-link-errors.rs:28:6\n    |\n LL | /// [S::A]\n    |      ^^^^\n    |\n    = note: the struct `S` has no field or associated item named `A`\n \n error: unresolved link to `S::fmt`\n-  --> $DIR/intra-link-errors.rs:33:6\n+  --> $DIR/intra-link-errors.rs:32:6\n    |\n LL | /// [S::fmt]\n    |      ^^^^^^\n    |\n    = note: the struct `S` has no field or associated item named `fmt`\n \n error: unresolved link to `E::D`\n-  --> $DIR/intra-link-errors.rs:37:6\n+  --> $DIR/intra-link-errors.rs:36:6\n    |\n LL | /// [E::D]\n    |      ^^^^\n    |\n    = note: the enum `E` has no variant or associated item named `D`\n \n error: unresolved link to `u8::not_found`\n-  --> $DIR/intra-link-errors.rs:41:6\n+  --> $DIR/intra-link-errors.rs:40:6\n    |\n LL | /// [u8::not_found]\n    |      ^^^^^^^^^^^^^\n    |\n    = note: the builtin type `u8` does not have an associated item named `not_found`\n \n error: unresolved link to `S`\n-  --> $DIR/intra-link-errors.rs:45:6\n+  --> $DIR/intra-link-errors.rs:44:6\n    |\n LL | /// [S!]\n    |      ^^\n@@ -89,32 +88,31 @@ LL | /// [struct@S]\n    |      ^^^^^^^^\n \n error: unresolved link to `T::g`\n-  --> $DIR/intra-link-errors.rs:63:6\n+  --> $DIR/intra-link-errors.rs:62:6\n    |\n LL | /// [type@T::g]\n    |      ^^^^^^^^^ help: to link to the associated function, add parentheses: `T::g()`\n    |\n    = note: this link resolves to the associated function `g`, which is not in the type namespace\n \n error: unresolved link to `T::h`\n-  --> $DIR/intra-link-errors.rs:68:6\n+  --> $DIR/intra-link-errors.rs:67:6\n    |\n LL | /// [T::h!]\n    |      ^^^^^\n    |\n    = note: no item named `T::h` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n error: unresolved link to `S::h`\n-  --> $DIR/intra-link-errors.rs:55:6\n+  --> $DIR/intra-link-errors.rs:54:6\n    |\n LL | /// [type@S::h]\n    |      ^^^^^^^^^ help: to link to the associated function, add parentheses: `S::h()`\n    |\n    = note: this link resolves to the associated function `h`, which is not in the type namespace\n \n error: unresolved link to `m`\n-  --> $DIR/intra-link-errors.rs:76:6\n+  --> $DIR/intra-link-errors.rs:74:6\n    |\n LL | /// [m()]\n    |      ^^^ help: to link to the macro, add an exclamation mark: `m!`"}, {"sha": "25c6975d3a509d04c0cd9eb3c0ba1f7c3cab8d39", "filename": "src/test/rustdoc-ui/intra-links-warning.stderr", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d67eb1f1487c04cdd2564741828cba0784ed8501/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr?ref=d67eb1f1487c04cdd2564741828cba0784ed8501", "patch": "@@ -14,7 +14,6 @@ LL |        //! Test with [Foo::baz], [Bar::foo], ...\n    |                                   ^^^^^^^^\n    |\n    = note: no item named `Bar` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n warning: unresolved link to `Uniooon::X`\n   --> $DIR/intra-links-warning.rs:6:13\n@@ -23,7 +22,6 @@ LL |      //! , [Uniooon::X] and [Qux::Z].\n    |             ^^^^^^^^^^\n    |\n    = note: no item named `Uniooon` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n warning: unresolved link to `Qux::Z`\n   --> $DIR/intra-links-warning.rs:6:30\n@@ -32,7 +30,6 @@ LL |      //! , [Uniooon::X] and [Qux::Z].\n    |                              ^^^^^^\n    |\n    = note: no item named `Qux` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n warning: unresolved link to `Uniooon::X`\n   --> $DIR/intra-links-warning.rs:10:14\n@@ -41,7 +38,6 @@ LL |       //! , [Uniooon::X] and [Qux::Z].\n    |              ^^^^^^^^^^\n    |\n    = note: no item named `Uniooon` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n warning: unresolved link to `Qux::Z`\n   --> $DIR/intra-links-warning.rs:10:31\n@@ -50,7 +46,6 @@ LL |       //! , [Uniooon::X] and [Qux::Z].\n    |                               ^^^^^^\n    |\n    = note: no item named `Qux` is in scope\n-   = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n warning: unresolved link to `Qux:Y`\n   --> $DIR/intra-links-warning.rs:14:13"}]}