{"sha": "ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhMDNhNDNmZTY3ZjA2YTEzNjU0ZGM3ZGRmODllNjJiYTlkYmUyZTk=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-10-24T15:57:22Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-10-31T16:41:38Z"}, "message": "introduce `apply` helper that applies a DefUse set to live bits", "tree": {"sha": "0459054bf5c7006cde393e797397c1366e3f0c86", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0459054bf5c7006cde393e797397c1366e3f0c86"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9", "html_url": "https://github.com/rust-lang/rust/commit/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd2511652fec706c306a3c11742e69756a4d0fb1", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd2511652fec706c306a3c11742e69756a4d0fb1", "html_url": "https://github.com/rust-lang/rust/commit/bd2511652fec706c306a3c11742e69756a4d0fb1"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "d3a10225cdc2d7ad1016df70314b325e197ef9ec", "filename": "src/librustc_mir/util/liveness.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9/src%2Flibrustc_mir%2Futil%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9/src%2Flibrustc_mir%2Futil%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fliveness.rs?ref=ea03a43fe67f06a13654dc7ddf89e62ba9dbe2e9", "patch": "@@ -54,6 +54,10 @@ struct DefsUses {\n }\n \n impl DefsUses {\n+    fn apply(&self, bits: &mut LocalSet) -> bool {\n+        bits.subtract(&self.defs) | bits.union(&self.uses)\n+    }\n+\n     fn add_def(&mut self, index: Local) {\n         // If it was used already in the block, remove that use\n         // now that we found a definition.\n@@ -194,8 +198,9 @@ pub fn liveness_of_locals<'tcx>(mir: &Mir<'tcx>) -> LivenessResult {\n \n             // in = use \u222a (out - def)\n             ins[b].clone_from(&outs[b]);\n-            ins[b].subtract(&def_use[b].defs);\n-            ins[b].union(&def_use[b].uses);\n+\n+            // FIXME use the return value to detect if we have changed things\n+            def_use[b].apply(&mut ins[b]);\n         }\n \n         if ins_ == ins && outs_ == outs {"}]}