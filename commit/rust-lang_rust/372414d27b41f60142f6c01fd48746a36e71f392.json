{"sha": "372414d27b41f60142f6c01fd48746a36e71f392", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3MjQxNGQyN2I0MWY2MDE0MmY2YzAxZmQ0ODc0NmEzNmU3MWYzOTI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-04-11T13:26:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-11T13:26:17Z"}, "message": "Merge #3942\n\n3942: vscode: fix typing bug in config r=matklad a=Veetaha\n\nI noticed that the type of nullable properties in config is actually non-nullable\r\n![Screenshot from 2020-04-11 15-29-45](https://user-images.githubusercontent.com/36276403/79043702-6a686d80-7c09-11ea-9ae8-f1a777c7d0f2.png)\r\n\n\nCo-authored-by: veetaha <veetaha2@gmail.com>", "tree": {"sha": "f6ee7802c775681ff6269000222aa322eeac7b10", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6ee7802c775681ff6269000222aa322eeac7b10"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/372414d27b41f60142f6c01fd48746a36e71f392", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJekcV5CRBK7hj4Ov3rIwAAdHIIADvG500QQK3cdmD4b2jsVw/h\nvZBkfozTPDHSj9+vMnoUsl0sgYa0Y9KhF7KLEatnGKIYYHF7UC2RGYb8+y6SptJF\nf937J0KHyyGTCn4nSL4PAwxM4dDRpvxpALAsadRE4zm70RMvkkhWJtdyi5zrv9ML\n9a2qJAg/P15GeqzidAOjuNrYVzaWogRweYPnslCLPh903QnuMZx7LOCUhBvkFsDY\nmuGstz/bRaN/JBDCm/aW4X8i7uAqtclf71Dj19Wh28b+tJrtayONhdp9Z3hgq3fL\nhBnBXGZFeDsxQGeUZQjuiQNw/1NMHHz/w/KI7ehoyY12QBYRt4NA3sXS6FXzuLk=\n=DENE\n-----END PGP SIGNATURE-----\n", "payload": "tree f6ee7802c775681ff6269000222aa322eeac7b10\nparent 0679d8cbe7acc5221d985e6d4187d6df293bd9d5\nparent 12e23bd60b9c3dde24bb9fa597ad88705abd2b76\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1586611577 +0000\ncommitter GitHub <noreply@github.com> 1586611577 +0000\n\nMerge #3942\n\n3942: vscode: fix typing bug in config r=matklad a=Veetaha\n\nI noticed that the type of nullable properties in config is actually non-nullable\r\n![Screenshot from 2020-04-11 15-29-45](https://user-images.githubusercontent.com/36276403/79043702-6a686d80-7c09-11ea-9ae8-f1a777c7d0f2.png)\r\n\n\nCo-authored-by: veetaha <veetaha2@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/372414d27b41f60142f6c01fd48746a36e71f392", "html_url": "https://github.com/rust-lang/rust/commit/372414d27b41f60142f6c01fd48746a36e71f392", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/372414d27b41f60142f6c01fd48746a36e71f392/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0679d8cbe7acc5221d985e6d4187d6df293bd9d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/0679d8cbe7acc5221d985e6d4187d6df293bd9d5", "html_url": "https://github.com/rust-lang/rust/commit/0679d8cbe7acc5221d985e6d4187d6df293bd9d5"}, {"sha": "12e23bd60b9c3dde24bb9fa597ad88705abd2b76", "url": "https://api.github.com/repos/rust-lang/rust/commits/12e23bd60b9c3dde24bb9fa597ad88705abd2b76", "html_url": "https://github.com/rust-lang/rust/commit/12e23bd60b9c3dde24bb9fa597ad88705abd2b76"}], "stats": {"total": 39, "additions": 30, "deletions": 9}, "files": [{"sha": "35a05131c88773050f97bf91f1f4d75ffcf8492c", "filename": "editors/code/src/config.ts", "status": "modified", "additions": 30, "deletions": 9, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/372414d27b41f60142f6c01fd48746a36e71f392/editors%2Fcode%2Fsrc%2Fconfig.ts", "raw_url": "https://github.com/rust-lang/rust/raw/372414d27b41f60142f6c01fd48746a36e71f392/editors%2Fcode%2Fsrc%2Fconfig.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fconfig.ts?ref=372414d27b41f60142f6c01fd48746a36e71f392", "patch": "@@ -66,23 +66,44 @@ export class Config {\n         return vscode.workspace.getConfiguration(this.rootSection);\n     }\n \n-    get serverPath() { return this.cfg.get<null | string>(\"serverPath\")!; }\n-    get channel() { return this.cfg.get<UpdatesChannel>(\"updates.channel\")!; }\n-    get askBeforeDownload() { return this.cfg.get<boolean>(\"updates.askBeforeDownload\")!; }\n-    get traceExtension() { return this.cfg.get<boolean>(\"trace.extension\")!; }\n+    /**\n+     * Beware that postfix `!` operator erases both `null` and `undefined`.\n+     * This is why the following doesn't work as expected:\n+     *\n+     * ```ts\n+     * const nullableNum = vscode\n+     *  .workspace\n+     *  .getConfiguration\n+     *  .getConfiguration(\"rust-analyer\")\n+     *  .get<number | null>(path)!;\n+     *\n+     * // What happens is that type of `nullableNum` is `number` but not `null | number`:\n+     * const fullFledgedNum: number = nullableNum;\n+     * ```\n+     * So this getter handles this quirk by not requiring the caller to use postfix `!`\n+     */\n+    private get<T>(path: string): T {\n+        return this.cfg.get<T>(path)!;\n+    }\n+\n+    get serverPath() { return this.get<null | string>(\"serverPath\"); }\n+    get channel() { return this.get<UpdatesChannel>(\"updates.channel\"); }\n+    get askBeforeDownload() { return this.get<boolean>(\"updates.askBeforeDownload\"); }\n+    get traceExtension() { return this.get<boolean>(\"trace.extension\"); }\n+\n \n     get inlayHints() {\n         return {\n-            typeHints: this.cfg.get<boolean>(\"inlayHints.typeHints\")!,\n-            parameterHints: this.cfg.get<boolean>(\"inlayHints.parameterHints\")!,\n-            chainingHints: this.cfg.get<boolean>(\"inlayHints.chainingHints\")!,\n-            maxLength: this.cfg.get<null | number>(\"inlayHints.maxLength\")!,\n+            typeHints: this.get<boolean>(\"inlayHints.typeHints\"),\n+            parameterHints: this.get<boolean>(\"inlayHints.parameterHints\"),\n+            chainingHints: this.get<boolean>(\"inlayHints.chainingHints\"),\n+            maxLength: this.get<null | number>(\"inlayHints.maxLength\"),\n         };\n     }\n \n     get checkOnSave() {\n         return {\n-            command: this.cfg.get<string>(\"checkOnSave.command\")!,\n+            command: this.get<string>(\"checkOnSave.command\"),\n         };\n     }\n }"}]}