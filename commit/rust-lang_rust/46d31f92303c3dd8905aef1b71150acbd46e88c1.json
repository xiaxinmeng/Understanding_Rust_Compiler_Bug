{"sha": "46d31f92303c3dd8905aef1b71150acbd46e88c1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2ZDMxZjkyMzAzYzNkZDg5MDVhZWYxYjcxMTUwYWNiZDQ2ZTg4YzE=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-07-24T12:02:09Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-07-24T12:02:09Z"}, "message": "show proper error when using a sysroot without MIR", "tree": {"sha": "d1d57265b73976ed2fa2ba7ba16f6c0fd6d60aab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d1d57265b73976ed2fa2ba7ba16f6c0fd6d60aab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46d31f92303c3dd8905aef1b71150acbd46e88c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46d31f92303c3dd8905aef1b71150acbd46e88c1", "html_url": "https://github.com/rust-lang/rust/commit/46d31f92303c3dd8905aef1b71150acbd46e88c1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46d31f92303c3dd8905aef1b71150acbd46e88c1/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2872a3f2a26154b91a6a6085d56016509803c61", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2872a3f2a26154b91a6a6085d56016509803c61", "html_url": "https://github.com/rust-lang/rust/commit/e2872a3f2a26154b91a6a6085d56016509803c61"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "cad08a2831a362aa11a7c109262e3ab2b93c7c17", "filename": "src/diagnostics.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46d31f92303c3dd8905aef1b71150acbd46e88c1/src%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d31f92303c3dd8905aef1b71150acbd46e88c1/src%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdiagnostics.rs?ref=46d31f92303c3dd8905aef1b71150acbd46e88c1", "patch": "@@ -132,8 +132,6 @@ pub fn report_error<'tcx, 'mir>(\n             };\n             #[rustfmt::skip]\n             let helps = match e.kind() {\n-                Unsupported(UnsupportedOpInfo::NoMirFor(..)) =>\n-                    vec![(None, format!(\"make sure to use a Miri sysroot, which you can prepare with `cargo miri setup`\"))],\n                 Unsupported(UnsupportedOpInfo::ThreadLocalStatic(_) | UnsupportedOpInfo::ReadExternStatic(_)) =>\n                     panic!(\"Error should never be raised by Miri: {:?}\", e.kind()),\n                 Unsupported(_) =>"}, {"sha": "02feae4a3503cf4efe13644227d7fe8ae265f8d5", "filename": "src/eval.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/46d31f92303c3dd8905aef1b71150acbd46e88c1/src%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46d31f92303c3dd8905aef1b71150acbd46e88c1/src%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Feval.rs?ref=46d31f92303c3dd8905aef1b71150acbd46e88c1", "patch": "@@ -138,6 +138,12 @@ pub fn create_ecx<'mir, 'tcx: 'mir>(\n     EnvVars::init(&mut ecx, config.excluded_env_vars)?;\n     MemoryExtra::init_extern_statics(&mut ecx)?;\n \n+    // Make sure we have MIR. We check MIR for some stable monomorphic function in libcore.\n+    let sentinel = ecx.resolve_path(&[\"core\", \"ascii\", \"escape_default\"]);\n+    if !tcx.is_mir_available(sentinel.def.def_id()) {\n+        tcx.sess.fatal(\"the current sysroot was built without `-Zalways-encode-mir`. Use `cargo miri setup` to prepare a sysroot that is suitable for Miri.\");\n+    }\n+\n     // Setup first stack-frame\n     let main_instance = ty::Instance::mono(tcx, main_id);\n     let main_mir = ecx.load_mir(main_instance.def, None)?;"}]}