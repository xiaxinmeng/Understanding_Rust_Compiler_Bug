{"sha": "b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4MTk4ZGE0ZDJhOWU2NDNhOTg2M2JmNGNkZGQ4MmQwMWViYzNmNzE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-30T17:05:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-11-30T17:05:48Z"}, "message": "Rollup merge of #55821 - ljedrz:cached_key_sorts, r=michaelwoerister\n\nUse sort_by_cached_key when the key function is not trivial/free\n\nI'm not 100% sure about `def_path_hash` (everything it does is inlined) but it seems like a good idea at least for the rest, as they are cloning.", "tree": {"sha": "b916e01b11813d6477161904f5f9382c61ca1023", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b916e01b11813d6477161904f5f9382c61ca1023"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcAW3tCRBK7hj4Ov3rIwAAdHIIAI1iBiHhpYad7fV99phQ3Zsf\nGixR9gvUr4/Ua86U2GyHciygaD/yG1dhRBmpPMDFMfFuOYflNgebDKMopt1WyZ3S\nsD2pQD0bXbc7BxrscuWPxnrXzDdc0Zym1qSv7uvmbkGPAmZdZbUjWzgoMO/tW0Hv\nfckPA6Opl2K1jgvVW3oVXj5v4PaxCXzulHft4iGIoyNXGhuN7X/+pbOakgbC+QpF\nY+Cgk/iC4mpgmEOD0duX4Y2AMPVKtAZOihoRgBH4jWpVh+DtFV14Yes4Dwx4lFAD\nQZam2DkUo2xGXVB/sWov0CClLeqeO5fDUbGwMXn1+us2SYZ3oASOPelQ69l0m2c=\n=qv6Y\n-----END PGP SIGNATURE-----\n", "payload": "tree b916e01b11813d6477161904f5f9382c61ca1023\nparent d48ab693d1ce99f30c0cf9abdf45c209824fe825\nparent d4a6e739f3322c56e66fa8fef31569b7f16bc325\nauthor kennytm <kennytm@gmail.com> 1543597548 +0800\ncommitter GitHub <noreply@github.com> 1543597548 +0800\n\nRollup merge of #55821 - ljedrz:cached_key_sorts, r=michaelwoerister\n\nUse sort_by_cached_key when the key function is not trivial/free\n\nI'm not 100% sure about `def_path_hash` (everything it does is inlined) but it seems like a good idea at least for the rest, as they are cloning.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "html_url": "https://github.com/rust-lang/rust/commit/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d48ab693d1ce99f30c0cf9abdf45c209824fe825", "url": "https://api.github.com/repos/rust-lang/rust/commits/d48ab693d1ce99f30c0cf9abdf45c209824fe825", "html_url": "https://github.com/rust-lang/rust/commit/d48ab693d1ce99f30c0cf9abdf45c209824fe825"}, {"sha": "d4a6e739f3322c56e66fa8fef31569b7f16bc325", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4a6e739f3322c56e66fa8fef31569b7f16bc325", "html_url": "https://github.com/rust-lang/rust/commit/d4a6e739f3322c56e66fa8fef31569b7f16bc325"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "07054ee99af76fc9fc00ced43dee4da22b59997e", "filename": "src/librustc/middle/resolve_lifetime.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs?ref=b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "patch": "@@ -1573,7 +1573,7 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n             .collect();\n \n         // ensure that we issue lints in a repeatable order\n-        def_ids.sort_by_key(|&def_id| self.tcx.def_path_hash(def_id));\n+        def_ids.sort_by_cached_key(|&def_id| self.tcx.def_path_hash(def_id));\n \n         for def_id in def_ids {\n             debug!("}, {"sha": "2909daf22b3bab0933676b4df20e8854174e87c2", "filename": "src/librustc/traits/object_safety.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fobject_safety.rs?ref=b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "patch": "@@ -409,7 +409,7 @@ impl<'a, 'tcx> TyCtxt<'a, 'tcx, 'tcx> {\n             .collect::<Vec<_>>();\n \n         // existential predicates need to be in a specific order\n-        associated_types.sort_by_key(|item| self.def_path_hash(item.def_id));\n+        associated_types.sort_by_cached_key(|item| self.def_path_hash(item.def_id));\n \n         let projection_predicates = associated_types.into_iter().map(|item| {\n             ty::ExistentialPredicate::Projection(ty::ExistentialProjection {"}, {"sha": "3a6ee6da42215b21c45f2b2f40a6c2ea245205e9", "filename": "src/librustc_mir/monomorphize/partitioning.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc_mir%2Fmonomorphize%2Fpartitioning.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8198da4d2a9e643a9863bf4cddd82d01ebc3f71/src%2Flibrustc_mir%2Fmonomorphize%2Fpartitioning.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fpartitioning.rs?ref=b8198da4d2a9e643a9863bf4cddd82d01ebc3f71", "patch": "@@ -985,7 +985,7 @@ fn collect_and_partition_mono_items<'a, 'tcx>(\n                 output.push_str(\" @@\");\n                 let mut empty = Vec::new();\n                 let cgus = item_to_cgus.get_mut(i).unwrap_or(&mut empty);\n-                cgus.as_mut_slice().sort_by_key(|&(ref name, _)| name.clone());\n+                cgus.as_mut_slice().sort_by_cached_key(|&(ref name, _)| name.clone());\n                 cgus.dedup();\n                 for &(ref cgu_name, (linkage, _)) in cgus.iter() {\n                     output.push_str(\" \");"}]}