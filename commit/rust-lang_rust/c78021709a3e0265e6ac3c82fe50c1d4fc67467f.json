{"sha": "c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "node_id": "C_kwDOAAsO6NoAKGM3ODAyMTcwOWEzZTAyNjVlNmFjM2M4MmZlNTBjMWQ0ZmM2NzQ2N2Y", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-13T11:14:59Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-13T11:23:53Z"}, "message": "add is_sized method on Abi and Layout, and use it", "tree": {"sha": "b114d56d6eb0224b7e976bc5dcc6ec4468b1c926", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b114d56d6eb0224b7e976bc5dcc6ec4468b1c926"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "html_url": "https://github.com/rust-lang/rust/commit/c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "742d3f02c243964e5b868d90afd60c2907be5853", "url": "https://api.github.com/repos/rust-lang/rust/commits/742d3f02c243964e5b868d90afd60c2907be5853", "html_url": "https://github.com/rust-lang/rust/commit/742d3f02c243964e5b868d90afd60c2907be5853"}], "stats": {"total": 68, "additions": 39, "deletions": 29}, "files": [{"sha": "df1150ec0b8ce266e610de2a0a52052ebd9dc992", "filename": "compiler/rustc_codegen_cranelift/src/constant.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fconstant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fconstant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fconstant.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -128,7 +128,7 @@ pub(crate) fn codegen_const_value<'tcx>(\n     ty: Ty<'tcx>,\n ) -> CValue<'tcx> {\n     let layout = fx.layout_of(ty);\n-    assert!(!layout.is_unsized(), \"sized const value\");\n+    assert!(layout.is_sized(), \"unsized const value\");\n \n     if layout.is_zst() {\n         return CValue::by_ref(crate::Pointer::dangling(layout.align.pref), layout);"}, {"sha": "c5bd574623df68d2644ce5908d136d696b12e979", "filename": "compiler/rustc_codegen_cranelift/src/value_and_place.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvalue_and_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvalue_and_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fvalue_and_place.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -19,7 +19,7 @@ fn codegen_field<'tcx>(\n     };\n \n     if let Some(extra) = extra {\n-        if !field_layout.is_unsized() {\n+        if field_layout.is_sized() {\n             return simple(fx);\n         }\n         match field_layout.ty.kind() {\n@@ -364,7 +364,7 @@ impl<'tcx> CPlace<'tcx> {\n         fx: &mut FunctionCx<'_, '_, 'tcx>,\n         layout: TyAndLayout<'tcx>,\n     ) -> CPlace<'tcx> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         if layout.size.bytes() == 0 {\n             return CPlace {\n                 inner: CPlaceInner::Addr(Pointer::dangling(layout.align.pref), None),\n@@ -825,7 +825,7 @@ impl<'tcx> CPlace<'tcx> {\n         fx: &FunctionCx<'_, '_, 'tcx>,\n         variant: VariantIdx,\n     ) -> Self {\n-        assert!(!self.layout().is_unsized());\n+        assert!(self.layout().is_sized());\n         let layout = self.layout().for_variant(fx, variant);\n         CPlace { inner: self.inner, layout }\n     }"}, {"sha": "bdf7318ce48c9505887b2287c0201bf66742bc54", "filename": "compiler/rustc_codegen_gcc/src/type_.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_gcc%2Fsrc%2Ftype_.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_gcc%2Fsrc%2Ftype_.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_gcc%2Fsrc%2Ftype_.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -277,7 +277,7 @@ pub fn struct_fields<'gcc, 'tcx>(cx: &CodegenCx<'gcc, 'tcx>, layout: TyAndLayout\n         offset = target_offset + field.size;\n         prev_effective_align = effective_field_align;\n     }\n-    if !layout.is_unsized() && field_count > 0 {\n+    if layout.is_sized() && field_count > 0 {\n         if offset > layout.size {\n             bug!(\"layout: {:#?} stride: {:?} offset: {:?}\", layout, layout.size, offset);\n         }"}, {"sha": "5cd0e1cb63ae1b6b2c602272ba506cbf45dc1c45", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Futils.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -72,7 +72,7 @@ pub(crate) fn fat_pointer_kind<'ll, 'tcx>(\n         layout.is_unsized()\n     );\n \n-    if !layout.is_unsized() {\n+    if layout.is_sized() {\n         return None;\n     }\n "}, {"sha": "182adf81785716fe5abea7b91e0571dc6bda7a8b", "filename": "compiler/rustc_codegen_llvm/src/type_of.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Ftype_of.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -140,7 +140,7 @@ fn struct_llfields<'a, 'tcx>(\n         prev_effective_align = effective_field_align;\n     }\n     let padding_used = result.len() > field_count;\n-    if !layout.is_unsized() && field_count > 0 {\n+    if layout.is_sized() && field_count > 0 {\n         if offset > layout.size {\n             bug!(\"layout: {:#?} stride: {:?} offset: {:?}\", layout, layout.size, offset);\n         }"}, {"sha": "6015d48decae930ac7cfc764663680d25d830c8b", "filename": "compiler/rustc_codegen_ssa/src/glue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fglue.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -15,7 +15,7 @@ pub fn size_and_align_of_dst<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>>(\n ) -> (Bx::Value, Bx::Value) {\n     let layout = bx.layout_of(t);\n     debug!(\"size_and_align_of_dst(ty={}, info={:?}): layout: {:?}\", t, info, layout);\n-    if !layout.is_unsized() {\n+    if layout.is_sized() {\n         let size = bx.const_usize(layout.size.bytes());\n         let align = bx.const_usize(layout.align.abi.bytes());\n         return (size, align);"}, {"sha": "908555385891d85417e4710ad4b860b790e43676", "filename": "compiler/rustc_codegen_ssa/src/mir/place.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -29,7 +29,7 @@ pub struct PlaceRef<'tcx, V> {\n \n impl<'a, 'tcx, V: CodegenObject> PlaceRef<'tcx, V> {\n     pub fn new_sized(llval: V, layout: TyAndLayout<'tcx>) -> PlaceRef<'tcx, V> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         PlaceRef { llval, llextra: None, layout, align: layout.align.abi }\n     }\n \n@@ -38,7 +38,7 @@ impl<'a, 'tcx, V: CodegenObject> PlaceRef<'tcx, V> {\n         layout: TyAndLayout<'tcx>,\n         align: Align,\n     ) -> PlaceRef<'tcx, V> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         PlaceRef { llval, llextra: None, layout, align }\n     }\n \n@@ -48,7 +48,7 @@ impl<'a, 'tcx, V: CodegenObject> PlaceRef<'tcx, V> {\n         bx: &mut Bx,\n         layout: TyAndLayout<'tcx>,\n     ) -> Self {\n-        assert!(!layout.is_unsized(), \"tried to statically allocate unsized place\");\n+        assert!(layout.is_sized(), \"tried to statically allocate unsized place\");\n         let tmp = bx.alloca(bx.cx().backend_type(layout), layout.align.abi);\n         Self::new_sized(tmp, layout)\n     }\n@@ -145,7 +145,7 @@ impl<'a, 'tcx, V: CodegenObject> PlaceRef<'tcx, V> {\n                 );\n                 return simple();\n             }\n-            _ if !field.is_unsized() => return simple(),\n+            _ if field.is_sized() => return simple(),\n             ty::Slice(..) | ty::Str | ty::Foreign(..) => return simple(),\n             ty::Adt(def, _) => {\n                 if def.repr().packed() {"}, {"sha": "8f5e503d659dad30b1d16c7199bfcb7dc7276bfd", "filename": "compiler/rustc_const_eval/src/const_eval/eval_queries.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Feval_queries.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Feval_queries.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Feval_queries.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -46,7 +46,7 @@ fn eval_body_using_ecx<'mir, 'tcx>(\n         ecx.tcx.def_kind(cid.instance.def_id())\n     );\n     let layout = ecx.layout_of(body.bound_return_ty().subst(tcx, cid.instance.substs))?;\n-    assert!(!layout.is_unsized());\n+    assert!(layout.is_sized());\n     let ret = ecx.allocate(layout, MemoryKind::Stack)?;\n \n     trace!("}, {"sha": "ab82268dde3ab5898bce8cb11ccda94b43ec7bf9", "filename": "compiler/rustc_const_eval/src/interpret/eval_context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -572,7 +572,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         metadata: &MemPlaceMeta<M::Provenance>,\n         layout: &TyAndLayout<'tcx>,\n     ) -> InterpResult<'tcx, Option<(Size, Align)>> {\n-        if !layout.is_unsized() {\n+        if layout.is_sized() {\n             return Ok(Some((layout.size, layout.align.abi)));\n         }\n         match layout.ty.kind() {"}, {"sha": "e68456a1d731a2989ceace8449d42c7bdc406982", "filename": "compiler/rustc_const_eval/src/interpret/intrinsics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -713,7 +713,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         rhs: &OpTy<'tcx, <M as Machine<'mir, 'tcx>>::Provenance>,\n     ) -> InterpResult<'tcx, Scalar<M::Provenance>> {\n         let layout = self.layout_of(lhs.layout.ty.builtin_deref(true).unwrap().ty)?;\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n \n         let get_bytes = |this: &InterpCx<'mir, 'tcx, M>,\n                          op: &OpTy<'tcx, <M as Machine<'mir, 'tcx>>::Provenance>,"}, {"sha": "a529972db9d6fec739332ae5b9ad2ee8f1dc5dda", "filename": "compiler/rustc_const_eval/src/interpret/memory.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmemory.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -683,7 +683,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                 // Use size and align of the type.\n                 let ty = self.tcx.type_of(def_id);\n                 let layout = self.tcx.layout_of(ParamEnv::empty().and(ty)).unwrap();\n-                assert!(!layout.is_unsized());\n+                assert!(layout.is_sized());\n                 (layout.size, layout.align.abi, AllocKind::LiveData)\n             }\n             Some(GlobalAlloc::Memory(alloc)) => {"}, {"sha": "274917f09fe3648e88dc5fd7cf97e85a59d859b7", "filename": "compiler/rustc_const_eval/src/interpret/operand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Foperand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Foperand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Foperand.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -280,7 +280,7 @@ impl<'tcx, Prov: Provenance> OpTy<'tcx, Prov> {\n         layout: TyAndLayout<'tcx>,\n         cx: &impl HasDataLayout,\n     ) -> InterpResult<'tcx, Self> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         self.offset_with_meta(offset, MemPlaceMeta::None, layout, cx)\n     }\n }"}, {"sha": "4d0125bf395d69174206a67d238edb94694d4e54", "filename": "compiler/rustc_const_eval/src/interpret/place.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fplace.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -201,7 +201,7 @@ impl<'tcx, Prov: Provenance> MPlaceTy<'tcx, Prov> {\n         layout: TyAndLayout<'tcx>,\n         cx: &impl HasDataLayout,\n     ) -> InterpResult<'tcx, Self> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         self.offset_with_meta(offset, MemPlaceMeta::None, layout, cx)\n     }\n \n@@ -340,7 +340,7 @@ where\n         &self,\n         place: &MPlaceTy<'tcx, M::Provenance>,\n     ) -> InterpResult<'tcx, Option<AllocRef<'_, 'tcx, M::Provenance, M::AllocExtra>>> {\n-        assert!(!place.layout.is_unsized());\n+        assert!(place.layout.is_sized());\n         assert!(!place.meta.has_meta());\n         let size = place.layout.size;\n         self.get_ptr_alloc(place.ptr, size, place.align)\n@@ -351,7 +351,7 @@ where\n         &mut self,\n         place: &MPlaceTy<'tcx, M::Provenance>,\n     ) -> InterpResult<'tcx, Option<AllocRefMut<'_, 'tcx, M::Provenance, M::AllocExtra>>> {\n-        assert!(!place.layout.is_unsized());\n+        assert!(place.layout.is_sized());\n         assert!(!place.meta.has_meta());\n         let size = place.layout.size;\n         self.get_ptr_alloc_mut(place.ptr, size, place.align)\n@@ -485,7 +485,7 @@ where\n         src: Immediate<M::Provenance>,\n         dest: &PlaceTy<'tcx, M::Provenance>,\n     ) -> InterpResult<'tcx> {\n-        assert!(!dest.layout.is_unsized(), \"Cannot write unsized data\");\n+        assert!(dest.layout.is_sized(), \"Cannot write unsized data\");\n         trace!(\"write_immediate: {:?} <- {:?}: {}\", *dest, src, dest.layout.ty);\n \n         // See if we can avoid an allocation. This is the counterpart to `read_immediate_raw`,\n@@ -746,7 +746,7 @@ where\n         layout: TyAndLayout<'tcx>,\n         kind: MemoryKind<M::MemoryKind>,\n     ) -> InterpResult<'tcx, MPlaceTy<'tcx, M::Provenance>> {\n-        assert!(!layout.is_unsized());\n+        assert!(layout.is_sized());\n         let ptr = self.allocate_ptr(layout.size, layout.align.abi, kind)?;\n         Ok(MPlaceTy::from_aligned_ptr(ptr.into(), layout))\n     }"}, {"sha": "3c286fa61bec5c9cb1a9501924ceded45ab5d13b", "filename": "compiler/rustc_const_eval/src/interpret/step.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -209,7 +209,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n \n             Repeat(ref operand, _) => {\n                 let src = self.eval_operand(operand, None)?;\n-                assert!(!src.layout.is_unsized());\n+                assert!(src.layout.is_sized());\n                 let dest = self.force_allocation(&dest)?;\n                 let length = dest.len(self)?;\n "}, {"sha": "fa15d466ac125cf910f3e2cbd13e27c362ee6154", "filename": "compiler/rustc_const_eval/src/interpret/traits.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Ftraits.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -53,7 +53,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n     ) -> InterpResult<'tcx, (Size, Align)> {\n         let (ty, _trait_ref) = self.get_ptr_vtable(vtable)?;\n         let layout = self.layout_of(ty)?;\n-        assert!(!layout.is_unsized(), \"there are no vtables for unsized types\");\n+        assert!(layout.is_sized(), \"there are no vtables for unsized types\");\n         Ok((layout.size, layout.align.abi))\n     }\n }"}, {"sha": "6eae94511e4d63c05f1a508da14027ac07cf0399", "filename": "compiler/rustc_middle/src/ty/vtable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_middle%2Fsrc%2Fty%2Fvtable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_middle%2Fsrc%2Fty%2Fvtable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fvtable.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -66,7 +66,7 @@ pub(super) fn vtable_allocation_provider<'tcx>(\n     let layout = tcx\n         .layout_of(ty::ParamEnv::reveal_all().and(ty))\n         .expect(\"failed to build vtable representation\");\n-    assert!(!layout.is_unsized(), \"can't create a vtable for an unsized type\");\n+    assert!(layout.is_sized(), \"can't create a vtable for an unsized type\");\n     let size = layout.size.bytes();\n     let align = layout.align.abi.bytes();\n "}, {"sha": "4f30e8a0be03ef3cda925f60540da06bb4111d56", "filename": "compiler/rustc_mir_transform/src/const_prop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -385,7 +385,7 @@ impl<'mir, 'tcx> ConstPropagator<'mir, 'tcx> {\n             // I don't know how return types can seem to be unsized but this happens in the\n             // `type/type-unsatisfiable.rs` test.\n             .filter(|ret_layout| {\n-                !ret_layout.is_unsized() && ret_layout.size < Size::from_bytes(MAX_ALLOC_LIMIT)\n+                ret_layout.is_sized() && ret_layout.size < Size::from_bytes(MAX_ALLOC_LIMIT)\n             })\n             .unwrap_or_else(|| ecx.layout_of(tcx.types.unit).unwrap());\n "}, {"sha": "163446c52e4c28112ad4d90681c3f01d5a365c21", "filename": "compiler/rustc_mir_transform/src/const_prop_lint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop_lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop_lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop_lint.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -199,7 +199,7 @@ impl<'mir, 'tcx> ConstPropagator<'mir, 'tcx> {\n             // I don't know how return types can seem to be unsized but this happens in the\n             // `type/type-unsatisfiable.rs` test.\n             .filter(|ret_layout| {\n-                !ret_layout.is_unsized() && ret_layout.size < Size::from_bytes(MAX_ALLOC_LIMIT)\n+                ret_layout.is_sized() && ret_layout.size < Size::from_bytes(MAX_ALLOC_LIMIT)\n             })\n             .unwrap_or_else(|| ecx.layout_of(tcx.types.unit).unwrap());\n "}, {"sha": "decbefc2f7c622b8a4d85a95b3b97bb4bdeb7616", "filename": "compiler/rustc_target/src/abi/mod.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -1083,6 +1083,11 @@ impl Abi {\n         }\n     }\n \n+    #[inline]\n+    pub fn is_sized(&self) -> bool {\n+        !self.is_unsized()\n+    }\n+\n     /// Returns `true` if this is a single signed integer scalar\n     #[inline]\n     pub fn is_signed(&self) -> bool {\n@@ -1490,6 +1495,11 @@ impl<'a, Ty> TyAndLayout<'a, Ty> {\n         self.abi.is_unsized()\n     }\n \n+    #[inline]\n+    pub fn is_sized(&self) -> bool {\n+        self.abi.is_sized()\n+    }\n+\n     /// Returns `true` if the type is a ZST and not unsized.\n     pub fn is_zst(&self) -> bool {\n         match self.abi {"}, {"sha": "b59be0a0ea7945d5907438b653215a5f6320c165", "filename": "compiler/rustc_ty_utils/src/layout.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_ty_utils%2Fsrc%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/compiler%2Frustc_ty_utils%2Fsrc%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Flayout.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -668,7 +668,7 @@ fn layout_of_uncached<'tcx>(\n                 let mut abi = Abi::Aggregate { sized: true };\n                 let index = VariantIdx::new(0);\n                 for field in &variants[index] {\n-                    assert!(!field.is_unsized());\n+                    assert!(field.is_sized());\n                     align = align.max(field.align);\n \n                     // If all non-ZST fields have the same ABI, forward this ABI"}, {"sha": "644095279fd8c8dfb035a4dfbbd147cd06a15429", "filename": "src/tools/miri/src/stacked_borrows/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/src%2Ftools%2Fmiri%2Fsrc%2Fstacked_borrows%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c78021709a3e0265e6ac3c82fe50c1d4fc67467f/src%2Ftools%2Fmiri%2Fsrc%2Fstacked_borrows%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Fstacked_borrows%2Fmod.rs?ref=c78021709a3e0265e6ac3c82fe50c1d4fc67467f", "patch": "@@ -1053,7 +1053,7 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriInterpCxExt<'mir, 'tcx> {\n                 // pointers we need to retag, so we can stop recursion early.\n                 // This optimization is crucial for ZSTs, because they can contain way more fields\n                 // than we can ever visit.\n-                if !place.layout.is_unsized() && place.layout.size < self.ecx.pointer_size() {\n+                if place.layout.is_sized() && place.layout.size < self.ecx.pointer_size() {\n                     return Ok(());\n                 }\n "}]}