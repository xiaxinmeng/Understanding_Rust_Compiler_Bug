{"sha": "629e7aa71803ea3300559e65a4abc17dba984837", "node_id": "C_kwDOAAsO6NoAKDYyOWU3YWE3MTgwM2VhMzMwMDU1OWU2NWE0YWJjMTdkYmE5ODQ4Mzc", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-03-04T21:58:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-04T21:58:37Z"}, "message": "Rollup merge of #94618 - lewisclark:remove-stack-size-rounding, r=yaahc\n\nDon't round stack size up for created threads in Windows\n\nFixes #94454\n\nWindows does the rounding itself, so there isn't a need to explicity do the rounding beforehand, as mentioned by ```@ChrisDenton``` in #94454\n\n> The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB). To retrieve the allocation granularity of the current system, use the [GetSystemInfo](https://docs.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.\n\nhttps://docs.microsoft.com/en-us/windows/win32/procthread/thread-stack-size", "tree": {"sha": "a290fa7864da2608b5660753e1057432d421f431", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a290fa7864da2608b5660753e1057432d421f431"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/629e7aa71803ea3300559e65a4abc17dba984837", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiIouNCRBK7hj4Ov3rIwAAn7YIAJbhFqPvXFpG3G9WKQRhrWZL\nKHe106zoQBh5Ca2TqVC/9CS0i/Kg3ReqH1ceeVgy/g7gNTcayv7l4ubQd23l0VkJ\nZ8FmayXQmrtvjyfexoaRAQxTWNEtTXuANdFv96DGJ7ejjNCk5N/MXPUR5J09idYC\n/domu+4icQaD2G1039T+7WHXhxgHQPSFa9ysTrGe10RkJYlcIY0iyXpPPJ0Yrqkm\njdrrOineXRwnbWisHdbJ17D/ZQ/DfM0Zoh9oC+oLH6iFVJNMYJ+gRagpUNmaZ80E\nPYSHFlWUh/KIyf5UNOv4Tc7ot/ByEe8gqFB4VLDhWKUvICmx9fn0Fgfg0ncnP4I=\n=MwSc\n-----END PGP SIGNATURE-----\n", "payload": "tree a290fa7864da2608b5660753e1057432d421f431\nparent 3064d6ec4d5f4679ac3c73eaa26a91c5faf63797\nparent 6843dd5013545652ccd1ff3e63462d6cffbe1dcf\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1646431117 +0100\ncommitter GitHub <noreply@github.com> 1646431117 +0100\n\nRollup merge of #94618 - lewisclark:remove-stack-size-rounding, r=yaahc\n\nDon't round stack size up for created threads in Windows\n\nFixes #94454\n\nWindows does the rounding itself, so there isn't a need to explicity do the rounding beforehand, as mentioned by ```@ChrisDenton``` in #94454\n\n> The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB). To retrieve the allocation granularity of the current system, use the [GetSystemInfo](https://docs.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.\n\nhttps://docs.microsoft.com/en-us/windows/win32/procthread/thread-stack-size\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/629e7aa71803ea3300559e65a4abc17dba984837", "html_url": "https://github.com/rust-lang/rust/commit/629e7aa71803ea3300559e65a4abc17dba984837", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/629e7aa71803ea3300559e65a4abc17dba984837/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3064d6ec4d5f4679ac3c73eaa26a91c5faf63797", "url": "https://api.github.com/repos/rust-lang/rust/commits/3064d6ec4d5f4679ac3c73eaa26a91c5faf63797", "html_url": "https://github.com/rust-lang/rust/commit/3064d6ec4d5f4679ac3c73eaa26a91c5faf63797"}, {"sha": "6843dd5013545652ccd1ff3e63462d6cffbe1dcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/6843dd5013545652ccd1ff3e63462d6cffbe1dcf", "html_url": "https://github.com/rust-lang/rust/commit/6843dd5013545652ccd1ff3e63462d6cffbe1dcf"}], "stats": {"total": 5, "additions": 1, "deletions": 4}, "files": [{"sha": "2f469513eb4fd63ac50c2b9f022ea1eab90ec30e", "filename": "library/std/src/sys/windows/thread.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/629e7aa71803ea3300559e65a4abc17dba984837/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/629e7aa71803ea3300559e65a4abc17dba984837/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread.rs?ref=629e7aa71803ea3300559e65a4abc17dba984837", "patch": "@@ -30,12 +30,9 @@ impl Thread {\n         // PTHREAD_STACK_MIN bytes big.  Windows has no such lower limit, it's\n         // just that below a certain threshold you can't do anything useful.\n         // That threshold is application and architecture-specific, however.\n-        // Round up to the next 64 kB because that's what the NT kernel does,\n-        // might as well make it explicit.\n-        let stack_size = (stack + 0xfffe) & (!0xfffe);\n         let ret = c::CreateThread(\n             ptr::null_mut(),\n-            stack_size,\n+            stack,\n             thread_start,\n             p as *mut _,\n             c::STACK_SIZE_PARAM_IS_A_RESERVATION,"}]}