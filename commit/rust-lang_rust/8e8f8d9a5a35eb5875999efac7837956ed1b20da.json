{"sha": "8e8f8d9a5a35eb5875999efac7837956ed1b20da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlOGY4ZDlhNWEzNWViNTg3NTk5OWVmYWM3ODM3OTU2ZWQxYjIwZGE=", "commit": {"author": {"name": "inrustwetrust", "email": "inrustwetrust@users.noreply.github.com", "date": "2015-05-09T22:07:26Z"}, "committer": {"name": "inrustwetrust", "email": "inrustwetrust@users.noreply.github.com", "date": "2015-05-09T22:07:26Z"}, "message": "Upgraded warning for invalid crate_type attribute syntax to an error\n\nIf the user intended to set the crate_type to \"lib\" but accidentally used\nincorrect syntax such as `#![crate_type(lib)]`, the compilation would fail with\n\"main function not found\". This made it hard to locate the source of the\nproblem, since the failure would cause the warning about the incorrect\nattribute not to be shown.", "tree": {"sha": "3429248fc009c88153f24260455786c004796a8d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3429248fc009c88153f24260455786c004796a8d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e8f8d9a5a35eb5875999efac7837956ed1b20da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e8f8d9a5a35eb5875999efac7837956ed1b20da", "html_url": "https://github.com/rust-lang/rust/commit/8e8f8d9a5a35eb5875999efac7837956ed1b20da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e8f8d9a5a35eb5875999efac7837956ed1b20da/comments", "author": {"login": "inrustwetrust", "id": 8572437, "node_id": "MDQ6VXNlcjg1NzI0Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/8572437?v=4", "gravatar_id": "", "url": "https://api.github.com/users/inrustwetrust", "html_url": "https://github.com/inrustwetrust", "followers_url": "https://api.github.com/users/inrustwetrust/followers", "following_url": "https://api.github.com/users/inrustwetrust/following{/other_user}", "gists_url": "https://api.github.com/users/inrustwetrust/gists{/gist_id}", "starred_url": "https://api.github.com/users/inrustwetrust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/inrustwetrust/subscriptions", "organizations_url": "https://api.github.com/users/inrustwetrust/orgs", "repos_url": "https://api.github.com/users/inrustwetrust/repos", "events_url": "https://api.github.com/users/inrustwetrust/events{/privacy}", "received_events_url": "https://api.github.com/users/inrustwetrust/received_events", "type": "User", "site_admin": false}, "committer": {"login": "inrustwetrust", "id": 8572437, "node_id": "MDQ6VXNlcjg1NzI0Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/8572437?v=4", "gravatar_id": "", "url": "https://api.github.com/users/inrustwetrust", "html_url": "https://github.com/inrustwetrust", "followers_url": "https://api.github.com/users/inrustwetrust/followers", "following_url": "https://api.github.com/users/inrustwetrust/following{/other_user}", "gists_url": "https://api.github.com/users/inrustwetrust/gists{/gist_id}", "starred_url": "https://api.github.com/users/inrustwetrust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/inrustwetrust/subscriptions", "organizations_url": "https://api.github.com/users/inrustwetrust/orgs", "repos_url": "https://api.github.com/users/inrustwetrust/repos", "events_url": "https://api.github.com/users/inrustwetrust/events{/privacy}", "received_events_url": "https://api.github.com/users/inrustwetrust/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8b64c7fb2809eeba8ff9125cc95c4c38efb9a8a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8b64c7fb2809eeba8ff9125cc95c4c38efb9a8a", "html_url": "https://github.com/rust-lang/rust/commit/d8b64c7fb2809eeba8ff9125cc95c4c38efb9a8a"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "a956b173f96c685d3ef7286c3d74d776998b581a", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8e8f8d9a5a35eb5875999efac7837956ed1b20da/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e8f8d9a5a35eb5875999efac7837956ed1b20da/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=8e8f8d9a5a35eb5875999efac7837956ed1b20da", "patch": "@@ -871,11 +871,8 @@ pub fn collect_crate_types(session: &Session,\n                     None\n                 }\n                 _ => {\n-                    session.add_lint(lint::builtin::UNKNOWN_CRATE_TYPES,\n-                                     ast::CRATE_NODE_ID,\n-                                     a.span,\n-                                     \"`crate_type` requires a \\\n-                                      value\".to_string());\n+                    session.span_err(a.span, \"`crate_type` requires a value\");\n+                    session.note(\"for example: `#![crate_type=\\\"lib\\\"]`\");\n                     None\n                 }\n             }"}, {"sha": "6d42515704ea117a95e42655de397df4602bcf7c", "filename": "src/test/compile-fail/invalid_crate_type_syntax.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8e8f8d9a5a35eb5875999efac7837956ed1b20da/src%2Ftest%2Fcompile-fail%2Finvalid_crate_type_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e8f8d9a5a35eb5875999efac7837956ed1b20da/src%2Ftest%2Fcompile-fail%2Finvalid_crate_type_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Finvalid_crate_type_syntax.rs?ref=8e8f8d9a5a35eb5875999efac7837956ed1b20da", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// regression test for issue 16974\n+#![crate_type(lib)]  //~ ERROR `crate_type` requires a value\n+\n+fn my_lib_fn() {}"}]}