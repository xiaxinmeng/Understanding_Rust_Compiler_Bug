{"sha": "92e90f943cf6b62346074b3a17669c3a7c1637b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyZTkwZjk0M2NmNmI2MjM0NjA3NGIzYTE3NjY5YzNhN2MxNjM3YjQ=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-14T20:19:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-14T20:19:32Z"}, "message": "Rollup merge of #74272 - davidtwco:issue-73626-multiline-mixed-comments, r=Mark-Simulacrum\n\npprust: support multiline comments within lines\n\nFixes #73626.\n\nThis PR adds support to `rustc_ast_pretty` for multiline comments that start and end within a line of source code.\n\nFun fact: [the commit which added this assert](https://github.com/rust-lang/rust/commit/d12ea3989649616437a7c1434f5c5a6438235eb7) was from 2011!\nhttps://github.com/rust-lang/rust/blob/d12ea3989649616437a7c1434f5c5a6438235eb7/src/comp/pretty/pprust.rs#L1146-L1150", "tree": {"sha": "5e2d6ac0731853b1d29b04a41cd834560d3dabdd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e2d6ac0731853b1d29b04a41cd834560d3dabdd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92e90f943cf6b62346074b3a17669c3a7c1637b4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfDhNUCRBK7hj4Ov3rIwAAdHIIACCQWLVbTPnzPZNW3lgrLOid\nDe+2Ei0Vx+1AgP5zucwLjEJ/hOjlTKpQKcPNgo3AhzfDRQs9Stppx3iWJ3qVN9TG\nVTttY+8EE4KAFHXxCl933kP+cR30ZuYEpcN6tqQIQFQW7YevQDnOY0TRH6Qt+GxU\nTEU0/gLflXeqnn+B+lpX66dAzbS8XfHDXGFop10ZETdmtIgZWLKFLMxC4nRfCKDC\n1p3gkVoeI4R6Lgbx0fEWDaKU4KOKjGRiSqd9+mskP1qudnewHsSZTYNytWGD+Lb1\n8Kx5Ztx5mkgm/5F5Ur0k5AJZwBqmejxqMKqPtSEqPXX0cjYq5OILkUc3oKog8uc=\n=tdXV\n-----END PGP SIGNATURE-----\n", "payload": "tree 5e2d6ac0731853b1d29b04a41cd834560d3dabdd\nparent 7b1247c34fe40f397053344b2f98a51fcc45f2a2\nparent 083c2f6ceb82b75ec04c73f2b39a414985fd9a92\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594757972 -0700\ncommitter GitHub <noreply@github.com> 1594757972 -0700\n\nRollup merge of #74272 - davidtwco:issue-73626-multiline-mixed-comments, r=Mark-Simulacrum\n\npprust: support multiline comments within lines\n\nFixes #73626.\n\nThis PR adds support to `rustc_ast_pretty` for multiline comments that start and end within a line of source code.\n\nFun fact: [the commit which added this assert](https://github.com/rust-lang/rust/commit/d12ea3989649616437a7c1434f5c5a6438235eb7) was from 2011!\nhttps://github.com/rust-lang/rust/blob/d12ea3989649616437a7c1434f5c5a6438235eb7/src/comp/pretty/pprust.rs#L1146-L1150\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92e90f943cf6b62346074b3a17669c3a7c1637b4", "html_url": "https://github.com/rust-lang/rust/commit/92e90f943cf6b62346074b3a17669c3a7c1637b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92e90f943cf6b62346074b3a17669c3a7c1637b4/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b1247c34fe40f397053344b2f98a51fcc45f2a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b1247c34fe40f397053344b2f98a51fcc45f2a2", "html_url": "https://github.com/rust-lang/rust/commit/7b1247c34fe40f397053344b2f98a51fcc45f2a2"}, {"sha": "083c2f6ceb82b75ec04c73f2b39a414985fd9a92", "url": "https://api.github.com/repos/rust-lang/rust/commits/083c2f6ceb82b75ec04c73f2b39a414985fd9a92", "html_url": "https://github.com/rust-lang/rust/commit/083c2f6ceb82b75ec04c73f2b39a414985fd9a92"}], "stats": {"total": 49, "additions": 47, "deletions": 2}, "files": [{"sha": "c33cae57872ac2bfd0c62c25a97b9c1aa1a62c6b", "filename": "src/librustc_ast_pretty/pprust.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/92e90f943cf6b62346074b3a17669c3a7c1637b4/src%2Flibrustc_ast_pretty%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92e90f943cf6b62346074b3a17669c3a7c1637b4/src%2Flibrustc_ast_pretty%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_pretty%2Fpprust.rs?ref=92e90f943cf6b62346074b3a17669c3a7c1637b4", "patch": "@@ -450,9 +450,20 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n     fn print_comment(&mut self, cmnt: &comments::Comment) {\n         match cmnt.style {\n             comments::Mixed => {\n-                assert_eq!(cmnt.lines.len(), 1);\n                 self.zerobreak();\n-                self.word(cmnt.lines[0].clone());\n+                if let Some((last, lines)) = cmnt.lines.split_last() {\n+                    self.ibox(0);\n+\n+                    for line in lines {\n+                        self.word(line.clone());\n+                        self.hardbreak()\n+                    }\n+\n+                    self.word(last.clone());\n+                    self.space();\n+\n+                    self.end();\n+                }\n                 self.zerobreak()\n             }\n             comments::Isolated => {"}, {"sha": "a002f09be3b4eb89e2e498215d95eceb52e0872b", "filename": "src/test/pretty/issue-73626.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/92e90f943cf6b62346074b3a17669c3a7c1637b4/src%2Ftest%2Fpretty%2Fissue-73626.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92e90f943cf6b62346074b3a17669c3a7c1637b4/src%2Ftest%2Fpretty%2Fissue-73626.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fissue-73626.rs?ref=92e90f943cf6b62346074b3a17669c3a7c1637b4", "patch": "@@ -0,0 +1,34 @@\n+fn main(/*\n+    ---\n+*/) {\n+    let x /* this is one line */ = 3;\n+\n+    let x /*\n+           * this\n+           * is\n+           * multiple\n+           * lines\n+           */ = 3;\n+\n+    let x = /*\n+           * this\n+           * is\n+           * multiple\n+           * lines\n+           * after\n+           * the\n+           * =\n+           */ 3;\n+\n+    let x /*\n+           * this\n+           * is\n+           * multiple\n+           * lines\n+           * including\n+           * a\n+\n+           * blank\n+           * line\n+           */ = 3;\n+}"}]}