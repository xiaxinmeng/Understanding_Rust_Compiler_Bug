{"sha": "8177e49e100fc3934e2df877e469f08961604ddc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxNzdlNDllMTAwZmMzOTM0ZTJkZjg3N2U0NjlmMDg5NjE2MDRkZGM=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-03-27T14:34:29Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-03-27T19:41:35Z"}, "message": "rustup https://github.com/rust-lang/rust/pull/70344", "tree": {"sha": "56b0e20ae6f5d2f921d7bcb0c378ea5d4468a029", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56b0e20ae6f5d2f921d7bcb0c378ea5d4468a029"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8177e49e100fc3934e2df877e469f08961604ddc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8177e49e100fc3934e2df877e469f08961604ddc", "html_url": "https://github.com/rust-lang/rust/commit/8177e49e100fc3934e2df877e469f08961604ddc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8177e49e100fc3934e2df877e469f08961604ddc/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ff568d746e4641b992c0b74bea046e43a637997", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ff568d746e4641b992c0b74bea046e43a637997", "html_url": "https://github.com/rust-lang/rust/commit/2ff568d746e4641b992c0b74bea046e43a637997"}], "stats": {"total": 52, "additions": 34, "deletions": 18}, "files": [{"sha": "eaff716e14503a298d8c6dc050c544442eabcacf", "filename": "clippy_lints/src/derive.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fderive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fderive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fderive.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -94,7 +94,8 @@ fn check_hash_peq<'a, 'tcx>(\n     if_chain! {\n         if match_path(&trait_ref.path, &paths::HASH);\n         if let Some(peq_trait_def_id) = cx.tcx.lang_items().eq_trait();\n-        if !&trait_ref.trait_def_id().is_local();\n+        if let Some(def_id) = &trait_ref.trait_def_id();\n+        if !def_id.is_local();\n         then {\n             // Look for the PartialEq implementations for `ty`\n             cx.tcx.for_each_relevant_impl(peq_trait_def_id, ty, |impl_id| {"}, {"sha": "ebc8aa4193786d0261a3cb1785bedb9d8a5e61a2", "filename": "clippy_lints/src/if_let_some_result.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fif_let_some_result.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fif_let_some_result.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fif_let_some_result.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -1,7 +1,8 @@\n use crate::utils::{match_type, method_chain_args, paths, snippet_with_applicability, span_lint_and_sugg};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n-use rustc_hir::{print, Expr, ExprKind, MatchSource, PatKind, QPath};\n+use rustc_hir::{Expr, ExprKind, MatchSource, PatKind, QPath};\n+use rustc_hir_pretty;\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -46,7 +47,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for OkIfLet {\n             if let PatKind::TupleStruct(QPath::Resolved(_, ref x), ref y, _)  = body[0].pat.kind; //get operation\n             if method_chain_args(op, &[\"ok\"]).is_some(); //test to see if using ok() methoduse std::marker::Sized;\n             let is_result_type = match_type(cx, cx.tables.expr_ty(&result_types[0]), &paths::RESULT);\n-            if print::to_string(print::NO_ANN, |s| s.print_path(x, false)) == \"Some\" && is_result_type;\n+            if rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_path(x, false)) == \"Some\" && is_result_type;\n \n             then {\n                 let mut applicability = Applicability::MachineApplicable;"}, {"sha": "108e28235c427f5adb013e118ebc375bb16b27d6", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -34,6 +34,8 @@ extern crate rustc_errors;\n #[allow(unused_extern_crates)]\n extern crate rustc_hir;\n #[allow(unused_extern_crates)]\n+extern crate rustc_hir_pretty;\n+#[allow(unused_extern_crates)]\n extern crate rustc_index;\n #[allow(unused_extern_crates)]\n extern crate rustc_infer;"}, {"sha": "4892feba3ba7c44452a6babed9bf404d3ebff09e", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -15,9 +15,10 @@ use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n use rustc_hir::def::CtorKind;\n use rustc_hir::{\n-    print, Arm, BindingAnnotation, Block, BorrowKind, Expr, ExprKind, Local, MatchSource, Mutability, Node, Pat,\n-    PatKind, QPath, RangeEnd,\n+    Arm, BindingAnnotation, Block, BorrowKind, Expr, ExprKind, Local, MatchSource, Mutability, Node, Pat, PatKind,\n+    QPath, RangeEnd,\n };\n+use rustc_hir_pretty;\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::Span;\n@@ -536,10 +537,12 @@ fn check_single_match_opt_like(\n             if !inner.iter().all(is_wild) {\n                 return;\n             }\n-            print::to_string(print::NO_ANN, |s| s.print_qpath(path, false))\n+            rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false))\n         },\n         PatKind::Binding(BindingAnnotation::Unannotated, .., ident, None) => ident.to_string(),\n-        PatKind::Path(ref path) => print::to_string(print::NO_ANN, |s| s.print_qpath(path, false)),\n+        PatKind::Path(ref path) => {\n+            rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false))\n+        },\n         _ => return,\n     };\n \n@@ -638,7 +641,7 @@ fn check_wild_err_arm(cx: &LateContext<'_, '_>, ex: &Expr<'_>, arms: &[Arm<'_>])\n     if match_type(cx, ex_ty, &paths::RESULT) {\n         for arm in arms {\n             if let PatKind::TupleStruct(ref path, ref inner, _) = arm.pat.kind {\n-                let path_str = print::to_string(print::NO_ANN, |s| s.print_qpath(path, false));\n+                let path_str = rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false));\n                 if path_str == \"Err\" {\n                     let mut matching_wild = inner.iter().any(is_wild);\n                     let mut ident_bind_name = String::from(\"_\");"}, {"sha": "316df21e7805a1ec6910f7b2d9c7106d090e2b1d", "filename": "clippy_lints/src/mut_reference.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fmut_reference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Fmut_reference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmut_reference.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -1,7 +1,8 @@\n use crate::utils::span_lint;\n use rustc::ty::subst::Subst;\n use rustc::ty::{self, Ty};\n-use rustc_hir::{print, BorrowKind, Expr, ExprKind, Mutability};\n+use rustc_hir::{BorrowKind, Expr, ExprKind, Mutability};\n+use rustc_hir_pretty;\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -34,7 +35,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for UnnecessaryMutPassed {\n                         cx,\n                         arguments,\n                         cx.tables.expr_ty(fn_expr),\n-                        &print::to_string(print::NO_ANN, |s| s.print_qpath(path, false)),\n+                        &rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false)),\n                     );\n                 }\n             },"}, {"sha": "075df19a71e289aabcda714b1d0b782ae46108a0", "filename": "clippy_lints/src/trait_bounds.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Ftrait_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Ftrait_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftrait_bounds.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -1,5 +1,6 @@\n-use crate::utils::{in_macro, snippet, span_lint_and_help, SpanlessHash};\n+use crate::utils::{in_macro, snippet, snippet_with_applicability, span_lint_and_help, SpanlessHash};\n use rustc_data_structures::fx::FxHashMap;\n+use rustc_errors::Applicability;\n use rustc_hir::{GenericBound, Generics, WherePredicate};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n@@ -41,6 +42,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for TraitBounds {\n             hasher.finish()\n         };\n         let mut map = FxHashMap::default();\n+        let mut applicability = Applicability::MaybeIncorrect;\n         for bound in gen.where_clause.predicates {\n             if let WherePredicate::BoundPredicate(ref p) = bound {\n                 let h = hash(&p.bounded_ty);\n@@ -52,13 +54,19 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for TraitBounds {\n                     for b in v.iter() {\n                         if let GenericBound::Trait(ref poly_trait_ref, _) = b {\n                             let path = &poly_trait_ref.trait_ref.path;\n-                            hint_string.push_str(&format!(\" {} +\", path));\n+                            hint_string.push_str(&format!(\n+                                \" {} +\",\n+                                snippet_with_applicability(cx, path.span, \"..\", &mut applicability)\n+                            ));\n                         }\n                     }\n                     for b in p.bounds.iter() {\n                         if let GenericBound::Trait(ref poly_trait_ref, _) = b {\n                             let path = &poly_trait_ref.trait_ref.path;\n-                            hint_string.push_str(&format!(\" {} +\", path));\n+                            hint_string.push_str(&format!(\n+                                \" {} +\",\n+                                snippet_with_applicability(cx, path.span, \"..\", &mut applicability)\n+                            ));\n                         }\n                     }\n                     hint_string.truncate(hint_string.len() - 2);"}, {"sha": "085184015e3ee8b9db3393dde8248a38dfdba538", "filename": "clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8177e49e100fc3934e2df877e469f08961604ddc/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=8177e49e100fc3934e2df877e469f08961604ddc", "patch": "@@ -3,7 +3,7 @@\n use crate::utils::get_attr;\n use rustc_ast::ast::Attribute;\n use rustc_hir as hir;\n-use rustc_hir::print;\n+use rustc_hir_pretty;\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_session::Session;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n@@ -50,7 +50,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for DeepCodeInspector {\n             hir::VisibilityKind::Crate(_) => println!(\"visible crate wide\"),\n             hir::VisibilityKind::Restricted { ref path, .. } => println!(\n                 \"visible in module `{}`\",\n-                print::to_string(print::NO_ANN, |s| s.print_path(path, false))\n+                rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_path(path, false))\n             ),\n             hir::VisibilityKind::Inherited => println!(\"visibility inherited from outer item\"),\n         }\n@@ -333,7 +333,7 @@ fn print_item(cx: &LateContext<'_, '_>, item: &hir::Item<'_>) {\n         hir::VisibilityKind::Crate(_) => println!(\"visible crate wide\"),\n         hir::VisibilityKind::Restricted { ref path, .. } => println!(\n             \"visible in module `{}`\",\n-            print::to_string(print::NO_ANN, |s| s.print_path(path, false))\n+            rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_path(path, false))\n         ),\n         hir::VisibilityKind::Inherited => println!(\"visibility inherited from outer item\"),\n     }\n@@ -427,7 +427,7 @@ fn print_pat(cx: &LateContext<'_, '_>, pat: &hir::Pat<'_>, indent: usize) {\n             println!(\n                 \"{}name: {}\",\n                 ind,\n-                print::to_string(print::NO_ANN, |s| s.print_qpath(path, false))\n+                rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false))\n             );\n             println!(\"{}ignore leftover fields: {}\", ind, ignore);\n             println!(\"{}fields:\", ind);\n@@ -444,7 +444,7 @@ fn print_pat(cx: &LateContext<'_, '_>, pat: &hir::Pat<'_>, indent: usize) {\n             println!(\n                 \"{}path: {}\",\n                 ind,\n-                print::to_string(print::NO_ANN, |s| s.print_qpath(path, false))\n+                rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_qpath(path, false))\n             );\n             if let Some(dot_position) = opt_dots_position {\n                 println!(\"{}dot position: {}\", ind, dot_position);"}]}