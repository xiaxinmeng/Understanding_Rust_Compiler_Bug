{"sha": "2a6d02e0925d18db33c29a058df47ed272719c65", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhNmQwMmUwOTI1ZDE4ZGIzM2MyOWEwNThkZjQ3ZWQyNzI3MTljNjU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-18T13:03:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-18T13:03:03Z"}, "message": "Auto merge of #37769 - alexcrichton:rustbuild-python, r=brson\n\nrustbuild: Allow configuration of python interpreter\n\nAdd a configuration key to `config.toml`, read it from `./configure`, and add\nauto-detection if none of those were specified.\n\nCloses #35760", "tree": {"sha": "e25e988cc8c085bd8bbd678204870816a511751d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e25e988cc8c085bd8bbd678204870816a511751d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a6d02e0925d18db33c29a058df47ed272719c65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a6d02e0925d18db33c29a058df47ed272719c65", "html_url": "https://github.com/rust-lang/rust/commit/2a6d02e0925d18db33c29a058df47ed272719c65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a6d02e0925d18db33c29a058df47ed272719c65/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "01d061fdc04ed78ff65138e96c212ecc678a9f8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/01d061fdc04ed78ff65138e96c212ecc678a9f8f", "html_url": "https://github.com/rust-lang/rust/commit/01d061fdc04ed78ff65138e96c212ecc678a9f8f"}, {"sha": "5f626138a0a4848704b291bdba4d2c445fcffa3b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f626138a0a4848704b291bdba4d2c445fcffa3b", "html_url": "https://github.com/rust-lang/rust/commit/5f626138a0a4848704b291bdba4d2c445fcffa3b"}], "stats": {"total": 46, "additions": 38, "deletions": 8}, "files": [{"sha": "ac6be2a870b0951973258d7e30c48870bb298ff4", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -130,17 +130,15 @@ pub fn compiletest(build: &Build,\n                              build.test_helpers_out(target).display()));\n     cmd.arg(\"--target-rustcflags\").arg(targetflags.join(\" \"));\n \n-    // FIXME: CFG_PYTHON should probably be detected more robustly elsewhere\n-    let python_default = \"python\";\n-    cmd.arg(\"--docck-python\").arg(python_default);\n+    cmd.arg(\"--docck-python\").arg(build.python());\n \n     if build.config.build.ends_with(\"apple-darwin\") {\n         // Force /usr/bin/python on OSX for LLDB tests because we're loading the\n         // LLDB plugin's compiled module which only works with the system python\n         // (namely not Homebrew-installed python)\n         cmd.arg(\"--lldb-python\").arg(\"/usr/bin/python\");\n     } else {\n-        cmd.arg(\"--lldb-python\").arg(python_default);\n+        cmd.arg(\"--lldb-python\").arg(build.python());\n     }\n \n     if let Some(ref gdb) = build.config.gdb {"}, {"sha": "996544a25996ff145b85c56c0527bddf9bb32ac1", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -90,6 +90,7 @@ pub struct Config {\n     pub codegen_tests: bool,\n     pub nodejs: Option<PathBuf>,\n     pub gdb: Option<PathBuf>,\n+    pub python: Option<PathBuf>,\n }\n \n /// Per-target configuration stored in the global configuration structure.\n@@ -130,6 +131,7 @@ struct Build {\n     gdb: Option<String>,\n     vendor: Option<bool>,\n     nodejs: Option<String>,\n+    python: Option<String>,\n }\n \n /// TOML representation of how the LLVM build is configured.\n@@ -237,6 +239,7 @@ impl Config {\n         config.cargo = build.cargo.map(PathBuf::from);\n         config.nodejs = build.nodejs.map(PathBuf::from);\n         config.gdb = build.gdb.map(PathBuf::from);\n+        config.python = build.python.map(PathBuf::from);\n         set(&mut config.compiler_docs, build.compiler_docs);\n         set(&mut config.docs, build.docs);\n         set(&mut config.submodules, build.submodules);\n@@ -466,6 +469,10 @@ impl Config {\n                     self.rustc = Some(push_exe_path(path.clone(), &[\"bin\", \"rustc\"]));\n                     self.cargo = Some(push_exe_path(path, &[\"bin\", \"cargo\"]));\n                 }\n+                \"CFG_PYTHON\" if value.len() > 0 => {\n+                    let path = parse_configure_path(value);\n+                    self.python = Some(path);\n+                }\n                 _ => {}\n             }\n         }"}, {"sha": "b6774b3af20a52af1f3a0e279ad69cd80fbaf9da", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -82,9 +82,19 @@\n # Indicate whether submodules are managed and updated automatically.\n #submodules = true\n \n-# The path to (or name of) the GDB executable to use\n+# The path to (or name of) the GDB executable to use. This is only used for\n+# executing the debuginfo test suite.\n #gdb = \"gdb\"\n \n+# The node.js executable to use. Note that this is only used for the emscripten\n+# target when running tests, otherwise this can be omitted.\n+#nodejs = \"node\"\n+\n+# Python interpreter to use for various tasks throughout the build, notably\n+# rustdoc tests, the lldb python interpreter, and some dist bits and pieces.\n+# Note that Python 2 is currently required.\n+#python = \"python2.7\"\n+\n # Indicate whether the vendored sources are used for Rust dependencies or not\n #vendor = false\n "}, {"sha": "d603455122eb23c279136b37eec80e355b298a7d", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -99,7 +99,7 @@ pub fn mingw(build: &Build, host: &str) {\n     // (which is what we want).\n     //\n     // FIXME: this script should be rewritten into Rust\n-    let mut cmd = Command::new(\"python\");\n+    let mut cmd = Command::new(build.python());\n     cmd.arg(build.src.join(\"src/etc/make-win-dist.py\"))\n        .arg(tmpdir(build))\n        .arg(&image)\n@@ -159,7 +159,7 @@ pub fn rustc(build: &Build, stage: u32, host: &str) {\n     //\n     // FIXME: this script should be rewritten into Rust\n     if host.contains(\"pc-windows-gnu\") {\n-        let mut cmd = Command::new(\"python\");\n+        let mut cmd = Command::new(build.python());\n         cmd.arg(build.src.join(\"src/etc/make-win-dist.py\"))\n            .arg(&image)\n            .arg(tmpdir(build))"}, {"sha": "828e82d38321df60efe09df359dbd243e4f6f661", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -774,6 +774,11 @@ impl Build {\n             .or(self.config.musl_root.as_ref())\n             .map(|p| &**p)\n     }\n+\n+    /// Path to the python interpreter to use\n+    fn python(&self) -> &Path {\n+        self.config.python.as_ref().unwrap()\n+    }\n }\n \n impl<'a> Compiler<'a> {"}, {"sha": "47efa6952177cd82d2f010b28e6376d476f63004", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a6d02e0925d18db33c29a058df47ed272719c65/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=2a6d02e0925d18db33c29a058df47ed272719c65", "patch": "@@ -79,7 +79,17 @@ pub fn check(build: &mut Build) {\n         break\n     }\n \n-    need_cmd(\"python\".as_ref());\n+    if build.config.python.is_none() {\n+        build.config.python = have_cmd(\"python2.7\".as_ref());\n+    }\n+    if build.config.python.is_none() {\n+        build.config.python = have_cmd(\"python2\".as_ref());\n+    }\n+    if build.config.python.is_none() {\n+        need_cmd(\"python\".as_ref());\n+        build.config.python = Some(\"python\".into());\n+    }\n+    need_cmd(build.config.python.as_ref().unwrap().as_ref());\n \n \n     if let Some(ref s) = build.config.nodejs {"}]}