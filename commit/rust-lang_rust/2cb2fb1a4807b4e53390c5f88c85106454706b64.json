{"sha": "2cb2fb1a4807b4e53390c5f88c85106454706b64", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjYjJmYjFhNDgwN2I0ZTUzMzkwYzVmODhjODUxMDY0NTQ3MDZiNjQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-11-20T19:23:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-11-20T19:23:31Z"}, "message": "Merge #2332\n\n2332: Add HasResolver trait r=matklad a=matklad\n\nbors merge\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "f081f89d08f2edf7859c6d3f9738f507c1dca2d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f081f89d08f2edf7859c6d3f9738f507c1dca2d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2cb2fb1a4807b4e53390c5f88c85106454706b64", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd1ZKzCRBK7hj4Ov3rIwAAdHIIAFok8mRyc2fWYLgj53t7VC5E\nHBolI7yIGJ920SAMyMXHDQQmA8Xn5yvGKWeM74iaq8Q5LpD3B4RIRtuQBIVv5aiB\nNoa9ihyXxrt21lfBalmQ/B0p4ZsEeXhTZIClESMTuE5dUdQE7NnwmARMpkxZ4up5\n9r/W9q5P91EO6C/kUPGAcGfdAcGejkDF+iwoyAEJGIyuOKc1o1buDqzMKztSWNhb\njcWmSTjnvlvHdskW6QDjtbLlcRLgp5NjXvbWaSTi38+t4Cj1/0qNZkJx+frLb6pV\n5KWO+v9EToO/55yKI745bavpR4nX5vA05vYUEjYedJBcgFgU8GcLN3veA3uNSnA=\n=UGt2\n-----END PGP SIGNATURE-----\n", "payload": "tree f081f89d08f2edf7859c6d3f9738f507c1dca2d6\nparent 6983afdea9f41e58d7ebbd15012532cd3935451f\nparent 63f327be67a8e6e0786cc089fba5f9b3f53c5bd6\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1574277811 +0000\ncommitter GitHub <noreply@github.com> 1574277811 +0000\n\nMerge #2332\n\n2332: Add HasResolver trait r=matklad a=matklad\n\nbors merge\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2cb2fb1a4807b4e53390c5f88c85106454706b64", "html_url": "https://github.com/rust-lang/rust/commit/2cb2fb1a4807b4e53390c5f88c85106454706b64", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2cb2fb1a4807b4e53390c5f88c85106454706b64/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6983afdea9f41e58d7ebbd15012532cd3935451f", "url": "https://api.github.com/repos/rust-lang/rust/commits/6983afdea9f41e58d7ebbd15012532cd3935451f", "html_url": "https://github.com/rust-lang/rust/commit/6983afdea9f41e58d7ebbd15012532cd3935451f"}, {"sha": "63f327be67a8e6e0786cc089fba5f9b3f53c5bd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/63f327be67a8e6e0786cc089fba5f9b3f53c5bd6", "html_url": "https://github.com/rust-lang/rust/commit/63f327be67a8e6e0786cc089fba5f9b3f53c5bd6"}], "stats": {"total": 268, "additions": 127, "deletions": 141}, "files": [{"sha": "560ab30752c57e17e0c9f3f40340f4dda6c2a51b", "filename": ".cargo/config", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/.cargo%2Fconfig", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/.cargo%2Fconfig", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.cargo%2Fconfig?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -2,3 +2,4 @@\n xtask = \"run --package xtask --bin xtask --\"\n install-ra = \"run --package xtask --bin xtask -- install\" # for backwards compat\n tq = \"test -- -q\"\n+qt = \"tq\""}, {"sha": "a132d128b57162abe5e640cccdcbb4f490e90594", "filename": "crates/ra_hir/src/code_model.rs", "status": "modified", "additions": 10, "deletions": 111, "changes": 121, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -30,7 +30,7 @@ use crate::{\n         AstItemDef, ConstId, EnumId, FunctionId, MacroDefId, StaticId, StructId, TraitId,\n         TypeAliasId,\n     },\n-    resolve::{Resolver, Scope, TypeNs},\n+    resolve::{HasResolver, TypeNs},\n     ty::{InferenceResult, Namespace, TraitRef},\n     Either, HasSource, ImportId, Name, ScopeDef, Source, Ty,\n };\n@@ -223,11 +223,6 @@ impl Module {\n         }\n     }\n \n-    pub(crate) fn resolver(self, db: &impl DefDatabase) -> Resolver {\n-        let def_map = db.crate_def_map(self.id.krate);\n-        Resolver::default().push_module_scope(def_map, self.id.module_id)\n-    }\n-\n     pub fn declarations(self, db: &impl DefDatabase) -> Vec<ModuleDef> {\n         let def_map = db.crate_def_map(self.id.krate);\n         def_map[self.id.module_id].scope.declarations().map(ModuleDef::from).collect()\n@@ -315,15 +310,6 @@ impl Struct {\n         db.type_for_def(self.into(), Namespace::Values)\n     }\n \n-    // FIXME move to a more general type\n-    /// Builds a resolver for type references inside this struct.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self.module(db).resolver(db);\n-        // ...and add generic params, if present\n-        r.push_generic_params_scope(db, self.into())\n-    }\n-\n     fn variant_data(self, db: &impl DefDatabase) -> Arc<VariantData> {\n         db.struct_data(self.id.into()).variant_data.clone()\n     }\n@@ -339,22 +325,13 @@ impl Union {\n         db.struct_data(self.id.into()).name.clone()\n     }\n \n-    pub fn module(self, db: &impl HirDatabase) -> Module {\n+    pub fn module(self, db: &impl DefDatabase) -> Module {\n         Module { id: self.id.0.module(db) }\n     }\n \n     pub fn ty(self, db: &impl HirDatabase) -> Ty {\n         db.type_for_def(self.into(), Namespace::Types)\n     }\n-\n-    // FIXME move to a more general type\n-    /// Builds a resolver for type references inside this union.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self.module(db).resolver(db);\n-        // ...and add generic params, if present\n-        r.push_generic_params_scope(db, self.into())\n-    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -394,16 +371,6 @@ impl Enum {\n     pub fn ty(self, db: &impl HirDatabase) -> Ty {\n         db.type_for_def(self.into(), Namespace::Types)\n     }\n-\n-    // FIXME: move to a more general type\n-    /// Builds a resolver for type references inside this struct.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self.module(db).resolver(db);\n-        // ...and add generic params, if present\n-        let r = r.push_generic_params_scope(db, self.into());\n-        r.push_scope(Scope::AdtScope(self.into()))\n-    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -465,24 +432,17 @@ impl Adt {\n         }\n     }\n \n-    pub fn krate(self, db: &impl HirDatabase) -> Option<Crate> {\n-        Some(\n-            match self {\n-                Adt::Struct(s) => s.module(db),\n-                Adt::Union(s) => s.module(db),\n-                Adt::Enum(e) => e.module(db),\n-            }\n-            .krate(),\n-        )\n-    }\n-\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n+    pub fn module(self, db: &impl DefDatabase) -> Module {\n         match self {\n-            Adt::Struct(it) => it.resolver(db),\n-            Adt::Union(it) => it.resolver(db),\n-            Adt::Enum(it) => it.resolver(db),\n+            Adt::Struct(s) => s.module(db),\n+            Adt::Union(s) => s.module(db),\n+            Adt::Enum(e) => e.module(db),\n         }\n     }\n+\n+    pub fn krate(self, db: &impl HirDatabase) -> Option<Crate> {\n+        Some(self.module(db).krate())\n+    }\n }\n \n #[derive(Clone, Copy, Debug, PartialEq, Eq, Hash)]\n@@ -533,15 +493,6 @@ pub enum DefWithBody {\n impl_froms!(DefWithBody: Function, Const, Static);\n \n impl DefWithBody {\n-    /// Builds a resolver for code inside this item.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        match self {\n-            DefWithBody::Const(c) => c.resolver(db),\n-            DefWithBody::Function(f) => f.resolver(db),\n-            DefWithBody::Static(s) => s.resolver(db),\n-        }\n-    }\n-\n     pub(crate) fn krate(self, db: &impl HirDatabase) -> Option<Crate> {\n         match self {\n             DefWithBody::Const(c) => c.krate(db),\n@@ -738,15 +689,6 @@ impl Function {\n         }\n     }\n \n-    // FIXME: move to a more general type for 'body-having' items\n-    /// Builds a resolver for code inside this item.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self.container(db).map_or_else(|| self.module(db).resolver(db), |c| c.resolver(db));\n-        // ...and add generic params, if present\n-        r.push_generic_params_scope(db, self.into())\n-    }\n-\n     pub fn diagnostics(self, db: &impl HirDatabase, sink: &mut DiagnosticSink) {\n         let infer = self.infer(db);\n         infer.add_diagnostics(db, self, sink);\n@@ -804,17 +746,6 @@ impl Const {\n             ContainerId::ModuleId(_) => None,\n         }\n     }\n-\n-    // FIXME: move to a more general type for 'body-having' items\n-    /// Builds a resolver for code inside this item.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self\n-            .impl_block(db)\n-            .map(|ib| ib.resolver(db))\n-            .unwrap_or_else(|| self.module(db).resolver(db));\n-        r\n-    }\n }\n \n #[derive(Debug, Clone, PartialEq, Eq)]\n@@ -874,12 +805,6 @@ impl Static {\n         db.static_data(self)\n     }\n \n-    /// Builds a resolver for code inside this item.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        self.module(db).resolver(db)\n-    }\n-\n     pub fn infer(self, db: &impl HirDatabase) -> Arc<InferenceResult> {\n         db.infer(self.into())\n     }\n@@ -975,12 +900,6 @@ impl Trait {\n     pub fn is_auto(self, db: &impl DefDatabase) -> bool {\n         self.trait_data(db).auto\n     }\n-\n-    pub(crate) fn resolver(self, db: &impl DefDatabase) -> Resolver {\n-        let r = self.module(db).resolver(db);\n-        // add generic params, if present\n-        r.push_generic_params_scope(db, self.into())\n-    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -1032,17 +951,6 @@ impl TypeAlias {\n     pub fn name(self, db: &impl DefDatabase) -> Name {\n         db.type_alias_data(self).name.clone()\n     }\n-\n-    /// Builds a resolver for the type references in this type alias.\n-    pub(crate) fn resolver(self, db: &impl HirDatabase) -> Resolver {\n-        // take the outer scope...\n-        let r = self\n-            .impl_block(db)\n-            .map(|ib| ib.resolver(db))\n-            .unwrap_or_else(|| self.module(db).resolver(db));\n-        // ...and add generic params, if present\n-        r.push_generic_params_scope(db, self.into())\n-    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n@@ -1058,15 +966,6 @@ pub enum Container {\n }\n impl_froms!(Container: Trait, ImplBlock);\n \n-impl Container {\n-    pub(crate) fn resolver(self, db: &impl DefDatabase) -> Resolver {\n-        match self {\n-            Container::Trait(trait_) => trait_.resolver(db),\n-            Container::ImplBlock(impl_block) => impl_block.resolver(db),\n-        }\n-    }\n-}\n-\n #[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n pub enum AssocItem {\n     Function(Function),"}, {"sha": "869879bdfa44e052858635883a35e01422feb95a", "filename": "crates/ra_hir/src/expr.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fexpr.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -11,6 +11,7 @@ use rustc_hash::FxHashSet;\n use crate::{\n     db::HirDatabase,\n     diagnostics::{MissingFields, MissingOkInTailExpr},\n+    resolve::HasResolver,\n     ty::{ApplicationTy, InferenceResult, Ty, TypeCtor},\n     Adt, DefWithBody, Function, HasBody, Name, Path, Resolver,\n };"}, {"sha": "f1bf2ee9d19b823ad677142e48366324e5bc6599", "filename": "crates/ra_hir/src/generics.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fgenerics.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -2,8 +2,8 @@\n use std::sync::Arc;\n \n use crate::{\n-    db::{DefDatabase, HirDatabase},\n-    Adt, Const, Container, Enum, EnumVariant, Function, ImplBlock, Struct, Trait, TypeAlias, Union,\n+    db::DefDatabase, Adt, Const, Container, Enum, EnumVariant, Function, ImplBlock, Struct, Trait,\n+    TypeAlias, Union,\n };\n \n pub use hir_def::generics::{GenericParam, GenericParams, WherePredicate};\n@@ -31,20 +31,6 @@ impl_froms!(\n     Const\n );\n \n-impl GenericDef {\n-    pub(crate) fn resolver(&self, db: &impl HirDatabase) -> crate::Resolver {\n-        match self {\n-            GenericDef::Function(inner) => inner.resolver(db),\n-            GenericDef::Adt(adt) => adt.resolver(db),\n-            GenericDef::Trait(inner) => inner.resolver(db),\n-            GenericDef::TypeAlias(inner) => inner.resolver(db),\n-            GenericDef::ImplBlock(inner) => inner.resolver(db),\n-            GenericDef::EnumVariant(inner) => inner.parent_enum(db).resolver(db),\n-            GenericDef::Const(inner) => inner.resolver(db),\n-        }\n-    }\n-}\n-\n impl From<Container> for GenericDef {\n     fn from(c: Container) -> Self {\n         match c {"}, {"sha": "964a3da8c0810ccd30e18bd6c03fed563f81c205", "filename": "crates/ra_hir/src/impl_block.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fimpl_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fimpl_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fimpl_block.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -5,7 +5,7 @@ use ra_syntax::ast::{self};\n \n use crate::{\n     db::{AstDatabase, DefDatabase, HirDatabase},\n-    resolve::Resolver,\n+    resolve::HasResolver,\n     ty::Ty,\n     AssocItem, Crate, HasSource, ImplBlock, Module, Source, TraitRef,\n };\n@@ -50,12 +50,4 @@ impl ImplBlock {\n     pub fn krate(&self, db: &impl DefDatabase) -> Crate {\n         Crate { crate_id: self.module(db).id.krate }\n     }\n-\n-    pub(crate) fn resolver(self, db: &impl DefDatabase) -> Resolver {\n-        let r = self.module(db).resolver(db);\n-        // add generic params, if present\n-        let r = r.push_generic_params_scope(db, self.into());\n-        let r = r.push_impl_block_scope(self);\n-        r\n-    }\n }"}, {"sha": "eca8e05969baf9a2778d19bcd446953cba07451b", "filename": "crates/ra_hir/src/resolve.rs", "status": "modified", "additions": 102, "deletions": 2, "changes": 104, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fresolve.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -15,8 +15,8 @@ use crate::{\n     db::{DefDatabase, HirDatabase},\n     expr::{ExprScopes, PatId, ScopeId},\n     generics::{GenericParams, HasGenericParams},\n-    Adt, Const, DefWithBody, Enum, EnumVariant, Function, GenericDef, ImplBlock, Local, MacroDef,\n-    ModuleDef, PerNs, Static, Struct, Trait, TypeAlias,\n+    Adt, Const, Container, DefWithBody, Enum, EnumVariant, Function, GenericDef, ImplBlock, Local,\n+    MacroDef, Module, ModuleDef, PerNs, Static, Struct, Trait, TypeAlias,\n };\n \n #[derive(Debug, Clone, Default)]\n@@ -486,3 +486,103 @@ impl Scope {\n         }\n     }\n }\n+\n+pub(crate) trait HasResolver {\n+    /// Builds a resolver for type references inside this def.\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver;\n+}\n+\n+impl HasResolver for Module {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        let def_map = db.crate_def_map(self.id.krate);\n+        Resolver::default().push_module_scope(def_map, self.id.module_id)\n+    }\n+}\n+\n+impl HasResolver for Trait {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.module(db).resolver(db).push_generic_params_scope(db, self.into())\n+    }\n+}\n+\n+impl<T: Into<Adt>> HasResolver for T {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        let def = self.into();\n+        def.module(db)\n+            .resolver(db)\n+            .push_generic_params_scope(db, def.into())\n+            .push_scope(Scope::AdtScope(def))\n+    }\n+}\n+\n+impl HasResolver for Function {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.container(db)\n+            .map(|c| c.resolver(db))\n+            .unwrap_or_else(|| self.module(db).resolver(db))\n+            .push_generic_params_scope(db, self.into())\n+    }\n+}\n+\n+impl HasResolver for DefWithBody {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        match self {\n+            DefWithBody::Const(c) => c.resolver(db),\n+            DefWithBody::Function(f) => f.resolver(db),\n+            DefWithBody::Static(s) => s.resolver(db),\n+        }\n+    }\n+}\n+\n+impl HasResolver for Const {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.container(db).map(|c| c.resolver(db)).unwrap_or_else(|| self.module(db).resolver(db))\n+    }\n+}\n+\n+impl HasResolver for Static {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.module(db).resolver(db)\n+    }\n+}\n+\n+impl HasResolver for TypeAlias {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.container(db)\n+            .map(|ib| ib.resolver(db))\n+            .unwrap_or_else(|| self.module(db).resolver(db))\n+            .push_generic_params_scope(db, self.into())\n+    }\n+}\n+\n+impl HasResolver for Container {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        match self {\n+            Container::Trait(trait_) => trait_.resolver(db),\n+            Container::ImplBlock(impl_block) => impl_block.resolver(db),\n+        }\n+    }\n+}\n+\n+impl HasResolver for GenericDef {\n+    fn resolver(self, db: &impl DefDatabase) -> crate::Resolver {\n+        match self {\n+            GenericDef::Function(inner) => inner.resolver(db),\n+            GenericDef::Adt(adt) => adt.resolver(db),\n+            GenericDef::Trait(inner) => inner.resolver(db),\n+            GenericDef::TypeAlias(inner) => inner.resolver(db),\n+            GenericDef::ImplBlock(inner) => inner.resolver(db),\n+            GenericDef::EnumVariant(inner) => inner.parent_enum(db).resolver(db),\n+            GenericDef::Const(inner) => inner.resolver(db),\n+        }\n+    }\n+}\n+\n+impl HasResolver for ImplBlock {\n+    fn resolver(self, db: &impl DefDatabase) -> Resolver {\n+        self.module(db)\n+            .resolver(db)\n+            .push_generic_params_scope(db, self.into())\n+            .push_impl_block_scope(self)\n+    }\n+}"}, {"sha": "727310f0662ce57fc4597d3c72765ac4cbe191da", "filename": "crates/ra_hir/src/source_binder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -23,7 +23,7 @@ use crate::{\n     db::HirDatabase,\n     expr::{self, BodySourceMap, ExprScopes, ScopeId},\n     ids::LocationCtx,\n-    resolve::{ScopeDef, TypeNs, ValueNs},\n+    resolve::{HasResolver, ScopeDef, TypeNs, ValueNs},\n     ty::method_resolution::{self, implements_trait},\n     AssocItem, Const, DefWithBody, Either, Enum, FromSource, Function, GenericParam, HasBody,\n     HirFileId, Local, MacroDef, Module, Name, Path, Resolver, Static, Struct, Ty,"}, {"sha": "7f9e81d6492b203f781fb66f135876c8be779827", "filename": "crates/ra_hir/src/ty/infer.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fty%2Finfer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fty%2Finfer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Finfer.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -40,7 +40,7 @@ use crate::{\n     code_model::TypeAlias,\n     db::HirDatabase,\n     expr::{BindingAnnotation, Body, ExprId, PatId},\n-    resolve::{Resolver, TypeNs},\n+    resolve::{HasResolver, Resolver, TypeNs},\n     ty::infer::diagnostics::InferenceDiagnostic,\n     Adt, AssocItem, ConstData, DefWithBody, FloatTy, FnData, Function, HasBody, IntTy, Path,\n     StructField, VariantDef,"}, {"sha": "397ee7d5fc365b1fab35d121d5e8e1eb18a31c7f", "filename": "crates/ra_hir/src/ty/lower.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -22,7 +22,7 @@ use crate::{\n     db::HirDatabase,\n     generics::HasGenericParams,\n     generics::{GenericDef, WherePredicate},\n-    resolve::{Resolver, TypeNs},\n+    resolve::{HasResolver, Resolver, TypeNs},\n     ty::{\n         primitive::{FloatTy, IntTy, Uncertain},\n         Adt,"}, {"sha": "d5739b58a6d759741360c196397b18821c332fc5", "filename": "crates/ra_ide_api/src/completion/complete_scope.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cb2fb1a4807b4e53390c5f88c85106454706b64/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=2cb2fb1a4807b4e53390c5f88c85106454706b64", "patch": "@@ -304,6 +304,13 @@ mod tests {\n             ),\n             @r###\"\n         [\n+            CompletionItem {\n+                label: \"Self\",\n+                source_range: [54; 54),\n+                delete: [54; 54),\n+                insert: \"Self\",\n+                kind: TypeParam,\n+            },\n             CompletionItem {\n                 label: \"T\",\n                 source_range: [54; 54),"}]}