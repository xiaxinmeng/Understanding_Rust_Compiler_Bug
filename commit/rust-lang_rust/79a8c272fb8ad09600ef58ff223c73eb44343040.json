{"sha": "79a8c272fb8ad09600ef58ff223c73eb44343040", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5YThjMjcyZmI4YWQwOTYwMGVmNThmZjIyM2M3M2ViNDQzNDMwNDA=", "commit": {"author": {"name": "Jeremy Soller", "email": "jackpot51@gmail.com", "date": "2016-11-11T02:58:19Z"}, "committer": {"name": "Jeremy Soller", "email": "jackpot51@gmail.com", "date": "2016-11-11T02:58:19Z"}, "message": "Fix readdir", "tree": {"sha": "0820d60e0912ec28b8a70e771efd3d3e14d226fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0820d60e0912ec28b8a70e771efd3d3e14d226fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79a8c272fb8ad09600ef58ff223c73eb44343040", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79a8c272fb8ad09600ef58ff223c73eb44343040", "html_url": "https://github.com/rust-lang/rust/commit/79a8c272fb8ad09600ef58ff223c73eb44343040", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79a8c272fb8ad09600ef58ff223c73eb44343040/comments", "author": {"login": "jackpot51", "id": 7741236, "node_id": "MDQ6VXNlcjc3NDEyMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7741236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackpot51", "html_url": "https://github.com/jackpot51", "followers_url": "https://api.github.com/users/jackpot51/followers", "following_url": "https://api.github.com/users/jackpot51/following{/other_user}", "gists_url": "https://api.github.com/users/jackpot51/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackpot51/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackpot51/subscriptions", "organizations_url": "https://api.github.com/users/jackpot51/orgs", "repos_url": "https://api.github.com/users/jackpot51/repos", "events_url": "https://api.github.com/users/jackpot51/events{/privacy}", "received_events_url": "https://api.github.com/users/jackpot51/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jackpot51", "id": 7741236, "node_id": "MDQ6VXNlcjc3NDEyMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7741236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackpot51", "html_url": "https://github.com/jackpot51", "followers_url": "https://api.github.com/users/jackpot51/followers", "following_url": "https://api.github.com/users/jackpot51/following{/other_user}", "gists_url": "https://api.github.com/users/jackpot51/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackpot51/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackpot51/subscriptions", "organizations_url": "https://api.github.com/users/jackpot51/orgs", "repos_url": "https://api.github.com/users/jackpot51/repos", "events_url": "https://api.github.com/users/jackpot51/events{/privacy}", "received_events_url": "https://api.github.com/users/jackpot51/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a90850995f9f177c910ba548f1a6312353673926", "url": "https://api.github.com/repos/rust-lang/rust/commits/a90850995f9f177c910ba548f1a6312353673926", "html_url": "https://github.com/rust-lang/rust/commit/a90850995f9f177c910ba548f1a6312353673926"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "1a96ac2f2eabd591fefacd7b0f4d082c2369a41e", "filename": "src/libstd/sys/redox/fs.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/79a8c272fb8ad09600ef58ff223c73eb44343040/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79a8c272fb8ad09600ef58ff223c73eb44343040/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs?ref=79a8c272fb8ad09600ef58ff223c73eb44343040", "patch": "@@ -146,16 +146,17 @@ impl Iterator for ReadDir {\n     fn next(&mut self) -> Option<io::Result<DirEntry>> {\n         loop {\n             let start = self.i;\n-            while self.i < self.data.len() {\n-                let i = self.i;\n+            let mut i = self.i;\n+            while i < self.data.len() {\n                 self.i += 1;\n                 if self.data[i] == b'\\n' {\n                     break;\n                 }\n+                i += 1;\n             }\n             if start < self.i {\n                 let ret = DirEntry {\n-                    name: self.data[start .. self.i].to_owned().into_boxed_slice(),\n+                    name: self.data[start .. i].to_owned().into_boxed_slice(),\n                     root: self.root.clone()\n                 };\n                 if ret.name_bytes() != b\".\" && ret.name_bytes() != b\"..\" {\n@@ -182,7 +183,7 @@ impl DirEntry {\n     }\n \n     pub fn file_type(&self) -> io::Result<FileType> {\n-        stat(&self.path()).map(|m| m.file_type())\n+        lstat(&self.path()).map(|m| m.file_type())\n     }\n \n     fn name_bytes(&self) -> &[u8] {\n@@ -367,7 +368,8 @@ impl fmt::Debug for File {\n \n pub fn readdir(p: &Path) -> io::Result<ReadDir> {\n     let root = Arc::new(p.to_path_buf());\n-    let options = OpenOptions::new();\n+    let mut options = OpenOptions::new();\n+    options.read(true);\n     let fd = File::open(p, &options)?;\n     let mut data = Vec::new();\n     fd.read_to_end(&mut data)?;\n@@ -431,7 +433,8 @@ pub fn link(_src: &Path, _dst: &Path) -> io::Result<()> {\n \n pub fn stat(p: &Path) -> io::Result<FileAttr> {\n     let mut stat: stat = stat::default();\n-    let options = OpenOptions::new();\n+    let mut options = OpenOptions::new();\n+    options.read(true);\n     let file = File::open(p, &options)?;\n     cvt(fstat(file.0.raw(), &mut stat))?;\n     Ok(FileAttr { stat: stat })\n@@ -442,7 +445,8 @@ pub fn lstat(p: &Path) -> io::Result<FileAttr> {\n }\n \n pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {\n-    let options = OpenOptions::new();\n+    let mut options = OpenOptions::new();\n+    options.read(true);\n     let file = File::open(p, &options)?;\n     file.path()\n }"}]}