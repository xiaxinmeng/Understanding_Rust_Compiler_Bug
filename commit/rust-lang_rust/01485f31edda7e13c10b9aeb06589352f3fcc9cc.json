{"sha": "01485f31edda7e13c10b9aeb06589352f3fcc9cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxNDg1ZjMxZWRkYTdlMTNjMTBiOWFlYjA2NTg5MzUyZjNmY2M5Y2M=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-24T21:17:29Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-24T21:22:26Z"}, "message": "build: Add -Wl,-whole-archive to the link flags. Should put out the burning tinderbox on Linux.", "tree": {"sha": "f74acb4feba6ae4419f9a50450dceeb4f1a9f874", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f74acb4feba6ae4419f9a50450dceeb4f1a9f874"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01485f31edda7e13c10b9aeb06589352f3fcc9cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01485f31edda7e13c10b9aeb06589352f3fcc9cc", "html_url": "https://github.com/rust-lang/rust/commit/01485f31edda7e13c10b9aeb06589352f3fcc9cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01485f31edda7e13c10b9aeb06589352f3fcc9cc/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2d4fb0fb2089adbafecbeb6f3601d86dc44f301", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2d4fb0fb2089adbafecbeb6f3601d86dc44f301", "html_url": "https://github.com/rust-lang/rust/commit/e2d4fb0fb2089adbafecbeb6f3601d86dc44f301"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "4c5c89812593146c7ec26e7795866a8aafebc9d8", "filename": "Makefile.in", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/01485f31edda7e13c10b9aeb06589352f3fcc9cc/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/01485f31edda7e13c10b9aeb06589352f3fcc9cc/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=01485f31edda7e13c10b9aeb06589352f3fcc9cc", "patch": "@@ -38,7 +38,8 @@ ifeq ($(CFG_OSTYPE), Linux)\n   CFG_LIB_NAME=lib$(1).so\n   CFG_GCC_CFLAGS += -fPIC -march=i686\n   CFG_GCC_LINK_FLAGS += -shared -fPIC -ldl -lpthread -lrt\n-  CFG_GCC_DEF_FLAG := -Wl,--export-dynamic,--dynamic-list=\n+  CFG_GCC_DEF_FLAG := -Wl,-whole-archive,--export-dynamic,--dynamic-list=\n+  CFG_GCC_POST_LIB_FLAGS := -Wl,-no-whole-archive\n   ifeq ($(CFG_CPUTYPE), x86_64)\n     CFG_GCC_CFLAGS += -m32\n     CFG_GCC_LINK_FLAGS += -m32\n@@ -347,6 +348,7 @@ RUNTIME_HDR := rt/globals.h \\\n RUNTIME_DEF := rt/rustrt$(CFG_DEF_SUFFIX)\n RUNTIME_INCS := -I $(S)src/rt/isaac -I $(S)src/rt/uthash\n RUNTIME_OBJS := $(RUNTIME_CS:.cpp=.o)\n+RUNTIME_LIBS := $(CFG_GCC_POST_LIB_FLAGS)\n \n ######################################################################\n # rustc LLVM-extensions (C++) library variables\n@@ -361,7 +363,8 @@ RUSTLLVM_DEF := rustllvm/rustllvm$(CFG_DEF_SUFFIX)\n RUSTLLVM_INCS := -iquote $(CFG_LLVM_INCDIR) \\\n                  -iquote $(S)src/rustllvm/include\n RUSTLLVM_OBJS := $(RUSTLLVM_CS:.cpp=.o)\n-RUSTLLVM_LIBS := $(CFG_LLVM_LDFLAGS) $(CFG_LLVM_LIBS)\n+RUSTLLVM_LIBS := $(CFG_LLVM_LDFLAGS) $(CFG_LLVM_LIBS) \\\n+                 $(CFG_GCC_POST_LIB_FLAGS)\n \n ######################################################################\n # Standard library variables\n@@ -404,12 +407,12 @@ all: boot/rustboot$(X)          \\\n \n rt/$(CFG_RUNTIME): $(RUNTIME_OBJS) $(MKFILES) $(RUNTIME_HDR) $(RUNTIME_DEF)\n \t@$(call E, link: $@)\n-\t$(Q)$(call CFG_LINK_C,$@,$(RUNTIME_OBJS),$(RUNTIME_DEF))\n+\t$(Q)$(call CFG_LINK_C,$@,$(RUNTIME_LIBS) $(RUNTIME_OBJS),$(RUNTIME_DEF))\n \n rustllvm/$(CFG_RUSTLLVM): $(RUSTLLVM_OBJS) $(MKFILES) $(RUSTLLVM_HDR) \\\n                           $(RUSTLLVM_DEF)\n \t@$(call E, link: $@)\n-\t$(Q)$(call CFG_LINK_C,$@,$(CFG_LLVM_LDFLAGS) $(RUSTLLVM_OBJS) \\\n+\t$(Q)$(call CFG_LINK_C,$@,$(RUSTLLVM_LIBS) $(RUSTLLVM_OBJS) \\\n           $(CFG_LLVM_LIBS) $(CFG_LLVM_LDFLAGS),$(RUSTLLVM_DEF))\n \n ifdef CFG_BOOT_NATIVE"}]}