{"sha": "172662dede507cc678747cc3d090f2ae744733cf", "node_id": "C_kwDOAAsO6NoAKDE3MjY2MmRlZGU1MDdjYzY3ODc0N2NjM2QwOTBmMmFlNzQ0NzMzY2Y", "commit": {"author": {"name": "Bryan Garza", "email": "1396101+bryangarza@users.noreply.github.com", "date": "2022-12-30T00:34:17Z"}, "committer": {"name": "Bryan Garza", "email": "1396101+bryangarza@users.noreply.github.com", "date": "2023-01-23T23:56:22Z"}, "message": "Add back Machine::before_terminator(...) method\n\nAdded it back because it's used by Miri, but in the compiler itself, it\nwill not do anything (just return `Ok(())`.", "tree": {"sha": "5c843b9856a1cb3e44922a43073079fd6e6ff759", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c843b9856a1cb3e44922a43073079fd6e6ff759"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/172662dede507cc678747cc3d090f2ae744733cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/172662dede507cc678747cc3d090f2ae744733cf", "html_url": "https://github.com/rust-lang/rust/commit/172662dede507cc678747cc3d090f2ae744733cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/172662dede507cc678747cc3d090f2ae744733cf/comments", "author": {"login": "bryangarza", "id": 1396101, "node_id": "MDQ6VXNlcjEzOTYxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1396101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bryangarza", "html_url": "https://github.com/bryangarza", "followers_url": "https://api.github.com/users/bryangarza/followers", "following_url": "https://api.github.com/users/bryangarza/following{/other_user}", "gists_url": "https://api.github.com/users/bryangarza/gists{/gist_id}", "starred_url": "https://api.github.com/users/bryangarza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bryangarza/subscriptions", "organizations_url": "https://api.github.com/users/bryangarza/orgs", "repos_url": "https://api.github.com/users/bryangarza/repos", "events_url": "https://api.github.com/users/bryangarza/events{/privacy}", "received_events_url": "https://api.github.com/users/bryangarza/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bryangarza", "id": 1396101, "node_id": "MDQ6VXNlcjEzOTYxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1396101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bryangarza", "html_url": "https://github.com/bryangarza", "followers_url": "https://api.github.com/users/bryangarza/followers", "following_url": "https://api.github.com/users/bryangarza/following{/other_user}", "gists_url": "https://api.github.com/users/bryangarza/gists{/gist_id}", "starred_url": "https://api.github.com/users/bryangarza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bryangarza/subscriptions", "organizations_url": "https://api.github.com/users/bryangarza/orgs", "repos_url": "https://api.github.com/users/bryangarza/repos", "events_url": "https://api.github.com/users/bryangarza/events{/privacy}", "received_events_url": "https://api.github.com/users/bryangarza/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08de246cd71a67915d4931aa37bc4f1c6374be0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/08de246cd71a67915d4931aa37bc4f1c6374be0e", "html_url": "https://github.com/rust-lang/rust/commit/08de246cd71a67915d4931aa37bc4f1c6374be0e"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "e51f52783d4c1a2fce3f10c4557ca8b4c45f731f", "filename": "compiler/rustc_const_eval/src/const_eval/machine.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmachine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmachine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Fconst_eval%2Fmachine.rs?ref=172662dede507cc678747cc3d090f2ae744733cf", "patch": "@@ -561,6 +561,11 @@ impl<'mir, 'tcx> interpret::Machine<'mir, 'tcx> for CompileTimeInterpreter<'mir,\n         throw_unsup_format!(\"pointer arithmetic or comparison is not supported at compile-time\");\n     }\n \n+    // Not used here, but used by Miri (see `src/tools/miri/src/machine.rs`).\n+    fn before_terminator(_ecx: &mut InterpCx<'mir, 'tcx, Self>) -> InterpResult<'tcx> {\n+        Ok(())\n+    }\n+\n     fn increment_const_eval_counter(ecx: &mut InterpCx<'mir, 'tcx, Self>) -> InterpResult<'tcx> {\n         // The step limit has already been hit in a previous call to `increment_const_eval_counter`.\n         if ecx.machine.steps_remaining == 0 {"}, {"sha": "76ed7b80f8d81b7a69c553a2597450cd5710572a", "filename": "compiler/rustc_const_eval/src/interpret/machine.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmachine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmachine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fmachine.rs?ref=172662dede507cc678747cc3d090f2ae744733cf", "patch": "@@ -243,6 +243,12 @@ pub trait Machine<'mir, 'tcx>: Sized {\n         ecx.stack_mut()[frame].locals[local].access_mut()\n     }\n \n+    /// Called before a basic block terminator is executed.\n+    #[inline]\n+    fn before_terminator(_ecx: &mut InterpCx<'mir, 'tcx, Self>) -> InterpResult<'tcx> {\n+        Ok(())\n+    }\n+\n     /// Called when the interpreter encounters a `StatementKind::ConstEvalCounter` instruction.\n     /// You can use this to detect long or endlessly running programs.\n     #[inline]"}, {"sha": "d101937fd7406cc64f214f60b0c1073024b87bc3", "filename": "compiler/rustc_const_eval/src/interpret/step.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/172662dede507cc678747cc3d090f2ae744733cf/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fstep.rs?ref=172662dede507cc678747cc3d090f2ae744733cf", "patch": "@@ -62,6 +62,8 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n             return Ok(true);\n         }\n \n+        M::before_terminator(self)?;\n+\n         let terminator = basic_block.terminator();\n         self.terminator(terminator)?;\n         Ok(true)"}]}