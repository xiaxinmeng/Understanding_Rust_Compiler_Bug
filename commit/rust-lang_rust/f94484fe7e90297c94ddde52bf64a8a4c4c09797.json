{"sha": "f94484fe7e90297c94ddde52bf64a8a4c4c09797", "node_id": "C_kwDOAAsO6NoAKGY5NDQ4NGZlN2U5MDI5N2M5NGRkZGU1MmJmNjRhOGE0YzRjMDk3OTc", "commit": {"author": {"name": "Niklas Jonsson", "email": "niklasandersjonsson@gmail.com", "date": "2022-07-10T20:59:06Z"}, "committer": {"name": "Niklas Jonsson", "email": "niklasandersjonsson@gmail.com", "date": "2022-07-13T17:30:08Z"}, "message": "reduce scope of allow(rustc::potential_query_instability) in rustc_span", "tree": {"sha": "8f0dd2520e7b992ff62b52317a425a3723057995", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f0dd2520e7b992ff62b52317a425a3723057995"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f94484fe7e90297c94ddde52bf64a8a4c4c09797", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f94484fe7e90297c94ddde52bf64a8a4c4c09797", "html_url": "https://github.com/rust-lang/rust/commit/f94484fe7e90297c94ddde52bf64a8a4c4c09797", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f94484fe7e90297c94ddde52bf64a8a4c4c09797/comments", "author": {"login": "NiklasJonsson", "id": 14359487, "node_id": "MDQ6VXNlcjE0MzU5NDg3", "avatar_url": "https://avatars.githubusercontent.com/u/14359487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NiklasJonsson", "html_url": "https://github.com/NiklasJonsson", "followers_url": "https://api.github.com/users/NiklasJonsson/followers", "following_url": "https://api.github.com/users/NiklasJonsson/following{/other_user}", "gists_url": "https://api.github.com/users/NiklasJonsson/gists{/gist_id}", "starred_url": "https://api.github.com/users/NiklasJonsson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NiklasJonsson/subscriptions", "organizations_url": "https://api.github.com/users/NiklasJonsson/orgs", "repos_url": "https://api.github.com/users/NiklasJonsson/repos", "events_url": "https://api.github.com/users/NiklasJonsson/events{/privacy}", "received_events_url": "https://api.github.com/users/NiklasJonsson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "NiklasJonsson", "id": 14359487, "node_id": "MDQ6VXNlcjE0MzU5NDg3", "avatar_url": "https://avatars.githubusercontent.com/u/14359487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NiklasJonsson", "html_url": "https://github.com/NiklasJonsson", "followers_url": "https://api.github.com/users/NiklasJonsson/followers", "following_url": "https://api.github.com/users/NiklasJonsson/following{/other_user}", "gists_url": "https://api.github.com/users/NiklasJonsson/gists{/gist_id}", "starred_url": "https://api.github.com/users/NiklasJonsson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NiklasJonsson/subscriptions", "organizations_url": "https://api.github.com/users/NiklasJonsson/orgs", "repos_url": "https://api.github.com/users/NiklasJonsson/repos", "events_url": "https://api.github.com/users/NiklasJonsson/events{/privacy}", "received_events_url": "https://api.github.com/users/NiklasJonsson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29554c0a120f6c1eb0c60f2a88c06faeb3d0f3c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/29554c0a120f6c1eb0c60f2a88c06faeb3d0f3c9", "html_url": "https://github.com/rust-lang/rust/commit/29554c0a120f6c1eb0c60f2a88c06faeb3d0f3c9"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "0d9100f63b144bf3dfb20499450a599af339e878", "filename": "compiler/rustc_span/src/hygiene.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f94484fe7e90297c94ddde52bf64a8a4c4c09797/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f94484fe7e90297c94ddde52bf64a8a4c4c09797/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs?ref=f94484fe7e90297c94ddde52bf64a8a4c4c09797", "patch": "@@ -644,7 +644,10 @@ pub fn debug_hygiene_data(verbose: bool) -> String {\n                 let expn_data = expn_data.as_ref().expect(\"no expansion data for an expansion ID\");\n                 debug_expn_data((&id.to_expn_id(), expn_data))\n             });\n+\n             // Sort the hash map for more reproducible output.\n+            // Because of this, it is fine to rely on the unstable iteration order of the map.\n+            #[allow(rustc::potential_query_instability)]\n             let mut foreign_expn_data: Vec<_> = data.foreign_expn_data.iter().collect();\n             foreign_expn_data.sort_by_key(|(id, _)| (id.krate, id.local_id));\n             foreign_expn_data.into_iter().for_each(debug_expn_data);\n@@ -1210,6 +1213,7 @@ impl HygieneEncodeContext {\n             // It's fine to iterate over a HashMap, because the serialization\n             // of the table that we insert data into doesn't depend on insertion\n             // order\n+            #[allow(rustc::potential_query_instability)]\n             for_all_ctxts_in(latest_ctxts.into_iter(), |index, ctxt, data| {\n                 if self.serialized_ctxts.lock().insert(ctxt) {\n                     encode_ctxt(encoder, index, data);\n@@ -1218,6 +1222,8 @@ impl HygieneEncodeContext {\n \n             let latest_expns = { std::mem::take(&mut *self.latest_expns.lock()) };\n \n+            // Same as above, this is fine as we are inserting into a order-independent hashset\n+            #[allow(rustc::potential_query_instability)]\n             for_all_expns_in(latest_expns.into_iter(), |expn, data, hash| {\n                 if self.serialized_expns.lock().insert(expn) {\n                     encode_expn(encoder, expn, data, hash);"}, {"sha": "a8074b5b1ba8f06ae317fb5932b7260299eaa2e5", "filename": "compiler/rustc_span/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f94484fe7e90297c94ddde52bf64a8a4c4c09797/compiler%2Frustc_span%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f94484fe7e90297c94ddde52bf64a8a4c4c09797/compiler%2Frustc_span%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Flib.rs?ref=f94484fe7e90297c94ddde52bf64a8a4c4c09797", "patch": "@@ -20,7 +20,6 @@\n #![feature(negative_impls)]\n #![feature(min_specialization)]\n #![feature(rustc_attrs)]\n-#![allow(rustc::potential_query_instability)]\n \n #[macro_use]\n extern crate rustc_macros;"}]}