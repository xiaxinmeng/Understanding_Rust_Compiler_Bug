{"sha": "7b862a52781e8939d8917c355f0833b25ea5bbd6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiODYyYTUyNzgxZTg5MzlkODkxN2MzNTVmMDgzM2IyNWVhNWJiZDY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-06-01T23:10:22Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-06-01T23:10:37Z"}, "message": "core: Fix handling of 0-padded floats with precision in #fmt", "tree": {"sha": "c1837e75d54e6e2b98c6dc174c2bad6cdf42b549", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c1837e75d54e6e2b98c6dc174c2bad6cdf42b549"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b862a52781e8939d8917c355f0833b25ea5bbd6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b862a52781e8939d8917c355f0833b25ea5bbd6", "html_url": "https://github.com/rust-lang/rust/commit/7b862a52781e8939d8917c355f0833b25ea5bbd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b862a52781e8939d8917c355f0833b25ea5bbd6/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "630c084da618036769506308e58c06d27b42d029", "url": "https://api.github.com/repos/rust-lang/rust/commits/630c084da618036769506308e58c06d27b42d029", "html_url": "https://github.com/rust-lang/rust/commit/630c084da618036769506308e58c06d27b42d029"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "30a3bc1ef693f949772476e4f5fbf72678bd051c", "filename": "src/libcore/extfmt.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7b862a52781e8939d8917c355f0833b25ea5bbd6/src%2Flibcore%2Fextfmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b862a52781e8939d8917c355f0833b25ea5bbd6/src%2Flibcore%2Fextfmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fextfmt.rs?ref=7b862a52781e8939d8917c355f0833b25ea5bbd6", "patch": "@@ -339,7 +339,7 @@ mod rt {\n                 s = \" \" + s;\n             }\n         }\n-        ret pad(cv, s, pad_signed);\n+        ret pad(cv, s, pad_float);\n     }\n     fn conv_poly<T>(cv: conv, v: T) -> str {\n         let s = sys::log_str(v);\n@@ -376,7 +376,7 @@ mod rt {\n               count_implied { 1u }\n             };\n     }\n-    enum pad_mode { pad_signed, pad_unsigned, pad_nozero, }\n+    enum pad_mode { pad_signed, pad_unsigned, pad_nozero, pad_float }\n     fn pad(cv: conv, &s: str, mode: pad_mode) -> str unsafe {\n         let uwidth : uint = alt cv.width {\n           count_implied { ret s; }\n@@ -396,14 +396,15 @@ mod rt {\n         let {might_zero_pad, signed} = alt mode {\n           pad_nozero {   {might_zero_pad:false, signed:false} }\n           pad_signed {   {might_zero_pad:true,  signed:true } }\n+          pad_float {   {might_zero_pad:true,  signed:true } }\n           pad_unsigned { {might_zero_pad:true,  signed:false} }\n         };\n         fn have_precision(cv: conv) -> bool {\n             ret alt cv.precision { count_implied { false } _ { true } };\n         }\n         let zero_padding = {\n             if might_zero_pad && have_flag(cv.flags, flag_left_zero_pad) &&\n-                !have_precision(cv) {\n+                (!have_precision(cv) || mode == pad_float) {\n                 padchar = '0';\n                 true\n             } else {"}, {"sha": "e6ec4b5dc37c8feecf6adfe445e9a70b678ed087", "filename": "src/test/run-pass/syntax-extension-fmt.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7b862a52781e8939d8917c355f0833b25ea5bbd6/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b862a52781e8939d8917c355f0833b25ea5bbd6/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs?ref=7b862a52781e8939d8917c355f0833b25ea5bbd6", "patch": "@@ -199,6 +199,7 @@ fn part5() {\n }\n fn part6() {\n     // Precision overrides 0-padding\n+    // FIXME #2481: Recent gcc's report some of these as warnings\n \n     test(#fmt[\"%06.5d\", 0], \" 00000\");\n     test(#fmt[\"%06.5u\", 0u], \" 00000\");\n@@ -211,7 +212,10 @@ fn part6() {\n     test(#fmt[\"%06.5x\", 127u], \" 0007f\");\n     test(#fmt[\"%06.5X\", 127u], \" 0007F\");\n     test(#fmt[\"%06.5o\", 10u], \" 00012\");\n-    test(#fmt[\"%08.5f\", 5.82], \" 5.82000\");\n+\n+    // Precision does not override zero-padding for floats\n+    test(#fmt[\"%08.5f\", 5.82], \"05.82000\");\n+\n     // Signed combinations\n \n     test(#fmt[\"% 5d\", 1], \"    1\");"}]}