{"sha": "e57307560e7ac522b18f79fc7e98a808664f4059", "node_id": "C_kwDOAAsO6NoAKGU1NzMwNzU2MGU3YWM1MjJiMThmNzlmYzdlOThhODA4NjY0ZjQwNTk", "commit": {"author": {"name": "Lucas Kent", "email": "rubickent@gmail.com", "date": "2021-12-18T01:57:55Z"}, "committer": {"name": "Lucas Kent", "email": "rubickent@gmail.com", "date": "2021-12-18T02:00:08Z"}, "message": "get_mut_span_in_struct_field uses span.between", "tree": {"sha": "674d620ed8dde79551b4f15e8fb97307c487eb07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/674d620ed8dde79551b4f15e8fb97307c487eb07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e57307560e7ac522b18f79fc7e98a808664f4059", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e57307560e7ac522b18f79fc7e98a808664f4059", "html_url": "https://github.com/rust-lang/rust/commit/e57307560e7ac522b18f79fc7e98a808664f4059", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e57307560e7ac522b18f79fc7e98a808664f4059/comments", "author": {"login": "rukai", "id": 5120858, "node_id": "MDQ6VXNlcjUxMjA4NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5120858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rukai", "html_url": "https://github.com/rukai", "followers_url": "https://api.github.com/users/rukai/followers", "following_url": "https://api.github.com/users/rukai/following{/other_user}", "gists_url": "https://api.github.com/users/rukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/rukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rukai/subscriptions", "organizations_url": "https://api.github.com/users/rukai/orgs", "repos_url": "https://api.github.com/users/rukai/repos", "events_url": "https://api.github.com/users/rukai/events{/privacy}", "received_events_url": "https://api.github.com/users/rukai/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rukai", "id": 5120858, "node_id": "MDQ6VXNlcjUxMjA4NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5120858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rukai", "html_url": "https://github.com/rukai", "followers_url": "https://api.github.com/users/rukai/followers", "following_url": "https://api.github.com/users/rukai/following{/other_user}", "gists_url": "https://api.github.com/users/rukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/rukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rukai/subscriptions", "organizations_url": "https://api.github.com/users/rukai/orgs", "repos_url": "https://api.github.com/users/rukai/repos", "events_url": "https://api.github.com/users/rukai/events{/privacy}", "received_events_url": "https://api.github.com/users/rukai/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97bf7b934e740b8b94aaf0e75a17f995444e44b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/97bf7b934e740b8b94aaf0e75a17f995444e44b6", "html_url": "https://github.com/rust-lang/rust/commit/97bf7b934e740b8b94aaf0e75a17f995444e44b6"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "b5dad5ccdea8ead7f3054015f95d2dc9a42eda7f", "filename": "compiler/rustc_borrowck/src/diagnostics/mutability_errors.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e57307560e7ac522b18f79fc7e98a808664f4059/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e57307560e7ac522b18f79fc7e98a808664f4059/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs?ref=e57307560e7ac522b18f79fc7e98a808664f4059", "patch": "@@ -237,7 +237,7 @@ impl<'a, 'tcx> MirBorrowckCtxt<'a, 'tcx> {\n                     err.span_suggestion_verbose(\n                         span,\n                         \"consider changing this to be mutable\",\n-                        \"mut \".into(),\n+                        \" mut \".into(),\n                         Applicability::MaybeIncorrect,\n                     );\n                 }\n@@ -1059,12 +1059,12 @@ fn is_closure_or_generator(ty: Ty<'_>) -> bool {\n     ty.is_closure() || ty.is_generator()\n }\n \n-/// Given a field that needs to be mutuable, returns a span where the mut could go.\n+/// Given a field that needs to be mutable, returns a span where the \" mut \" could go.\n /// This function expects the local to be a reference to a struct in order to produce a span.\n ///\n /// ```text\n-/// LL |     s: &'a String\n-///    |            ^ returns a span pointing here\n+/// LL |     s: &'a   String\n+///    |           ^^^ returns a span taking up the space here\n /// ```\n fn get_mut_span_in_struct_field<'tcx>(\n     tcx: TyCtxt<'tcx>,\n@@ -1081,12 +1081,10 @@ fn get_mut_span_in_struct_field<'tcx>(\n             // Now we're dealing with the actual struct that we're going to suggest a change to,\n             // we can expect a field that is an immutable reference to a type.\n             if let hir::Node::Field(field) = node {\n-                if let hir::TyKind::Rptr(lifetime, hir::MutTy { mutbl: hir::Mutability::Not, .. }) =\n+                if let hir::TyKind::Rptr(lifetime, hir::MutTy { mutbl: hir::Mutability::Not, ty }) =\n                     field.ty.kind\n                 {\n-                    return Some(\n-                        lifetime.span.with_hi(lifetime.span.hi() + BytePos(1)).shrink_to_hi(),\n-                    );\n+                    return Some(lifetime.span.between(ty.span));\n                 }\n             }\n         }"}, {"sha": "7c287a7dbfa0d0e9893c9653bbd416e9fd2516c1", "filename": "src/test/ui/did_you_mean/issue-38147-2.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e57307560e7ac522b18f79fc7e98a808664f4059/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-38147-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e57307560e7ac522b18f79fc7e98a808664f4059/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-38147-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-38147-2.stderr?ref=e57307560e7ac522b18f79fc7e98a808664f4059", "patch": "@@ -17,7 +17,7 @@ LL |         self.longer_name.push(13);\n    |\n help: consider changing this to be mutable\n    |\n-LL |     longer_name:   &   'a mut     Vec<u8>\n+LL |     longer_name:   &   'a mut Vec<u8>\n    |                           +++\n \n error: aborting due to 2 previous errors"}]}