{"sha": "3ae9ca444ce244e2bab660de28a5bf7047aa3813", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhZTljYTQ0NGNlMjQ0ZTJiYWI2NjBkZTI4YTViZjcwNDdhYTM4MTM=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-17T21:26:24Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-17T21:26:32Z"}, "message": "Move Makefile.in and configure to top level, BOOT_-qualify names, various tweaks.", "tree": {"sha": "959ca1af375cfc9c383342e720984e452470f1a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/959ca1af375cfc9c383342e720984e452470f1a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ae9ca444ce244e2bab660de28a5bf7047aa3813", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ae9ca444ce244e2bab660de28a5bf7047aa3813", "html_url": "https://github.com/rust-lang/rust/commit/3ae9ca444ce244e2bab660de28a5bf7047aa3813", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ae9ca444ce244e2bab660de28a5bf7047aa3813/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67bac63aa39aa9d2166e769fcef7b1249509bc17", "url": "https://api.github.com/repos/rust-lang/rust/commits/67bac63aa39aa9d2166e769fcef7b1249509bc17", "html_url": "https://github.com/rust-lang/rust/commit/67bac63aa39aa9d2166e769fcef7b1249509bc17"}], "stats": {"total": 76, "additions": 57, "deletions": 19}, "files": [{"sha": "ad96251ac266c581101b4fe4a6af186d3680ab8d", "filename": "Makefile.in", "status": "renamed", "additions": 40, "deletions": 16, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/3ae9ca444ce244e2bab660de28a5bf7047aa3813/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/3ae9ca444ce244e2bab660de28a5bf7047aa3813/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=3ae9ca444ce244e2bab660de28a5bf7047aa3813", "patch": "@@ -49,7 +49,8 @@ endif\n \n BOOT_MLS :=                                              \\\n     $(addsuffix .ml,                                     \\\n-        $(addprefix boot/util/, version fmt common bits) \\\n+        boot/version                                     \\\n+        $(addprefix boot/util/, fmt common bits)         \\\n         $(addprefix boot/driver/, session)               \\\n         $(addprefix boot/fe/, ast token lexer parser     \\\n           extfmt pexp item cexp fuzz)                    \\\n@@ -65,13 +66,15 @@ BOOT_CMXS := $(BOOT_MLS:.ml=.cmx)\n BOOT_OBJS := $(BOOT_MLS:.ml=.o)\n BOOT_CMIS := $(BOOT_MLS:.ml=.cmi)\n \n-ML_DEP_INCS := -I $(S)boot/fe     -I $(S)boot/me   -I $(S)boot/be \\\n-               -I $(S)boot/driver -I $(S)boot/util\n+BOOT_ML_DEP_INCS := -I boot                              \\\n+                    -I $(S)boot/fe   -I $(S)boot/me      \\\n+                    -I $(S)boot/be   -I $(S)boot/driver  \\\n+                    -I $(S)boot/util\n \n-ML_INCS        := $(ML_DEP_INCS)\n-ML_LIBS        := unix.cma  nums.cma  bigarray.cma\n-ML_NATIVE_LIBS := unix.cmxa nums.cmxa bigarray.cmxa\n-OCAMLC_FLAGS   := -g $(ML_INCS) -w Ael -warn-error Ael\n+BOOT_ML_INCS        := $(BOOT_ML_DEP_INCS)\n+BOOT_ML_LIBS        := unix.cma  nums.cma  bigarray.cma\n+BOOT_ML_NATIVE_LIBS := unix.cmxa nums.cmxa bigarray.cmxa\n+BOOT_OCAMLC_FLAGS   := -g $(BOOT_ML_INCS) -w Ael -warn-error Ael\n \n \n ######################################################################\n@@ -89,8 +92,8 @@ endif\n S := $(CFG_SRC_DIR)\n X := $(CFG_EXE_SUFFIX)\n \n-# Look in src dir.\n-VPATH := $(CFG_SRC_DIR)\n+# Look in doc and src dirs.\n+VPATH := $(CFG_SRC_DIR)/doc $(CFG_SRC_DIR)/src\n \n # Delete the built-in rules.\n .SUFFIXES:\n@@ -104,26 +107,47 @@ VPATH := $(CFG_SRC_DIR)\n # Targets and rules\n ######################################################################\n \n-all: rustboot$(X)\n+all: boot/rustboot$(X)\n \n ifdef CFG_NATIVE_BOOT\n-rustboot$(X): $(BOOT_CMXS) $(MKFILES)\n+boot/rustboot$(X): $(BOOT_CMXS) $(MKFILES)\n \t@$(call E, compile: $@)\n-\t$(Q)ocamlopt$(OPT) -o $@ $(OCAMLOPT_FLAGS) $(ML_NATIVE_LIBS) \\\n+\t$(Q)ocamlopt$(OPT) -o $@ $(BOOT_OCAMLOPT_FLAGS) $(ML_NATIVE_LIBS) \\\n         $(BOOT_CMXS)\n else\n-rustboot$(X): $(BOOT_CMOS) $(MKFILES)\n+boot/rustboot$(X): $(BOOT_CMOS) $(MKFILES)\n \t@$(call E, compile: $@)\n-\t$(Q)ocamlc$(OPT) -o $@ $(OCAMLC_FLAGS) $(ML_LIBS) $(BOOT_CMOS)\n+\t$(Q)ocamlc$(OPT) -o $@ $(BOOT_OCAMLC_FLAGS) $(BOOT_ML_LIBS) $(BOOT_CMOS)\n endif\n \n \n-boot/util/version.ml: $(MKFILES)\n+boot/version.ml: $(MKFILES)\n+\t@$(call E, git: $@)\n \t$(Q)git log -1 \\\n       --pretty=format:'let version = \"prerelease (%h %ci)\";;' >$@ || exit 1\n \n %.cmo: %.ml $(MKFILES)\n \t@$(call E, compile: $@)\n-\t$(Q)ocamlc$(OPT) -c -o $@ $(OCAMLC_FLAGS) $<\n+\t$(Q)ocamlc$(OPT) -c -o $@ $(BOOT_OCAMLC_FLAGS) $<\n \n %.cmo: %.cmi $(MKFILES)\n+\n+\n+\n+######################################################################\n+# Cleanup\n+######################################################################\n+\n+.PHONY: clean\n+\n+clean:\n+\t@$(call E, cleaning)\n+\t$(Q)rm -f $(foreach ext, cmx cmi cmo cma bc o a d $(X)     \\\n+                             h cpp ml s                        \\\n+                             out bc dSYM                       \\\n+                             ,                                 \\\n+                  $(wildcard     *.$(ext)                      \\\n+                               */*.$(ext)                      \\\n+                             */*/*.$(ext)                      \\\n+                           */*/*/*.$(ext)                      \\\n+                   ))", "previous_filename": "src/Makefile.in"}, {"sha": "0e584f35eca01894478194e1eb31cedf180eea6e", "filename": "configure", "status": "renamed", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3ae9ca444ce244e2bab660de28a5bf7047aa3813/configure", "raw_url": "https://github.com/rust-lang/rust/raw/3ae9ca444ce244e2bab660de28a5bf7047aa3813/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=3ae9ca444ce244e2bab660de28a5bf7047aa3813", "patch": "@@ -8,14 +8,28 @@ echo '' >config.mk\n \n echo \"configure: making directories\"\n for i in \\\n+    doc \\\n     boot/fe boot/me boot/be boot/driver boot/util \\\n-    rt/isaac rt/bigint rt/sync rt/test \\\n-    stage0 stage1 stage2 \\\n-    test/run-pass test/compile-pass test/compile-fail\n+    rt/isaac rt/bigint rt/sync rt/test\n do\n     mkdir -p -v $i\n done\n \n+make_test_subdirs() {\n+    for t in run-pass run-fail compile-fail\n+    do\n+        mkdir -p -v $1/test/$t\n+    done\n+}\n+\n+make_test_subdirs boot\n+\n+for i in 0 1 2\n+do\n+    mkdir -p -v stage$i\n+    make_test_subdirs stage$i\n+done\n+\n echo \"configure: copying Makefile\"\n cp -v ${CFG_SRC_DIR}Makefile.in ./Makefile\n ", "previous_filename": "src/configure.sh"}]}