{"sha": "bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "node_id": "C_kwDOAAsO6NoAKGJjMDY5ZWZiMWZmZmMxODBiMTNmMDNmYmRjMmFiNDgzZTViYWIxM2I", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-12T01:11:54Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-12T01:11:54Z"}, "message": "Auto merge of #8688 - kyoto7250:adding_condition_for_map_clone, r=giraffate\n\nadding condition for map_clone message\n\nThis PR fixes the message about `map_clone`.\n\nif msrv >= 1.36, the message is correct.\n\n```bash\n$ cat main.rs\nfn main() {\n  let x: Vec<&i32> = vec![&1, &2];\n  let y: Vec<_>  = x.iter().map(|i| *i).collect();\n  println!(\"{:?}\", y);\n}\n\n$ cargo clippy\nwarning: you are using an explicit closure for copying elements\n --> main.rs:3:20\n  |\n3 |   let y: Vec<_>  = x.iter().map(|i| *i).collect();\n  |                    ^^^^^^^^^^^^^^^^^^^^ help: consider calling the dedicated `copied` method: `x.iter().copied()`\n  |\n  = note: `#[warn(clippy::map_clone)]` on by default\n  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#map_clone\n\nwarning: `test` (build script) generated 1 warning\nwarning: `test` (bin \"test\") generated 1 warning (1 duplicate)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.00s\n```\n\nbut, if msrv < 1.36, the suggestion is `cloned`, but the message is `copying`.\n```bash\n$ cat clippy.toml\nmsrv = \"1.35\"\n\n$ cargo clippy\nwarning: you are using an explicit closure for copying elements\n --> main.rs:3:20\n  |\n3 |   let y: Vec<_>  = x.iter().map(|i| *i).collect();\n  |                    ^^^^^^^^^^^^^^^^^^^^ help: consider calling the dedicated `cloned` method: `x.iter().cloned()`\n```\n\nI think  the separation of messages will make it more user-friendly.\n\nthank you in advance.\n\nchangelog: Fixed a message in map_clone.", "tree": {"sha": "fa5a1275f2ef868814a94d4289ed261e76dde2ca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa5a1275f2ef868814a94d4289ed261e76dde2ca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "html_url": "https://github.com/rust-lang/rust/commit/bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc069efb1fffc180b13f03fbdc2ab483e5bab13b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbcd82885f4730077fabd57340d7e297122bc596", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbcd82885f4730077fabd57340d7e297122bc596", "html_url": "https://github.com/rust-lang/rust/commit/dbcd82885f4730077fabd57340d7e297122bc596"}, {"sha": "40224f46c0158ff8bf6657f2272dba9ec2ee96d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/40224f46c0158ff8bf6657f2272dba9ec2ee96d7", "html_url": "https://github.com/rust-lang/rust/commit/40224f46c0158ff8bf6657f2272dba9ec2ee96d7"}], "stats": {"total": 14, "additions": 5, "deletions": 9}, "files": [{"sha": "ceb66947d02c6717a0ba802f61268997c00e48f0", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bc069efb1fffc180b13f03fbdc2ab483e5bab13b/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc069efb1fffc180b13f03fbdc2ab483e5bab13b/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "patch": "@@ -143,15 +143,11 @@ fn lint_needless_cloning(cx: &LateContext<'_>, root: Span, receiver: Span) {\n impl MapClone {\n     fn lint_explicit_closure(&self, cx: &LateContext<'_>, replace: Span, root: Span, is_copy: bool) {\n         let mut applicability = Applicability::MachineApplicable;\n-        let message = if is_copy {\n-            \"you are using an explicit closure for copying elements\"\n-        } else {\n-            \"you are using an explicit closure for cloning elements\"\n-        };\n-        let sugg_method = if is_copy && meets_msrv(self.msrv.as_ref(), &msrvs::ITERATOR_COPIED) {\n-            \"copied\"\n+\n+        let (message, sugg_method) = if is_copy && meets_msrv(self.msrv.as_ref(), &msrvs::ITERATOR_COPIED) {\n+            (\"you are using an explicit closure for copying elements\", \"copied\")\n         } else {\n-            \"cloned\"\n+            (\"you are using an explicit closure for cloning elements\", \"cloned\")\n         };\n \n         span_lint_and_sugg("}, {"sha": "5dae5af7eb5a9cc9413582d37256b2869abd32c8", "filename": "tests/ui-toml/min_rust_version/min_rust_version.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc069efb1fffc180b13f03fbdc2ab483e5bab13b/tests%2Fui-toml%2Fmin_rust_version%2Fmin_rust_version.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bc069efb1fffc180b13f03fbdc2ab483e5bab13b/tests%2Fui-toml%2Fmin_rust_version%2Fmin_rust_version.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-toml%2Fmin_rust_version%2Fmin_rust_version.stderr?ref=bc069efb1fffc180b13f03fbdc2ab483e5bab13b", "patch": "@@ -1,4 +1,4 @@\n-error: you are using an explicit closure for copying elements\n+error: you are using an explicit closure for cloning elements\n   --> $DIR/min_rust_version.rs:74:26\n    |\n LL |     let _: Option<u64> = Some(&16).map(|b| *b);"}]}