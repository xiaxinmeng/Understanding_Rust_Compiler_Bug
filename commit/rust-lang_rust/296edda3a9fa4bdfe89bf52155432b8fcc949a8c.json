{"sha": "296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5NmVkZGEzYTlmYTRiZGZlODliZjUyMTU1NDMyYjhmY2M5NDlhOGM=", "commit": {"author": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2017-11-18T15:10:28Z"}, "committer": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2017-11-18T15:10:29Z"}, "message": "const_static_lifetime: this applies not only to path types\n\nFor example, &'static [u8] or &'static (t1, t2).", "tree": {"sha": "969faab77992dea5db396e3bc9b078657d886274", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/969faab77992dea5db396e3bc9b078657d886274"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "html_url": "https://github.com/rust-lang/rust/commit/296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/comments", "author": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d005b58c545faee28d7d5b3b9523ffac19b286b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d005b58c545faee28d7d5b3b9523ffac19b286b", "html_url": "https://github.com/rust-lang/rust/commit/2d005b58c545faee28d7d5b3b9523ffac19b286b"}], "stats": {"total": 65, "additions": 52, "deletions": 13}, "files": [{"sha": "69a4c0ae8808bb489e487ad504892b1e1cf53fed", "filename": "clippy_lints/src/const_static_lifetime.rs", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs?ref=296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "patch": "@@ -48,20 +48,23 @@ impl StaticConst {\n             TyKind::Rptr(ref optional_lifetime, ref borrow_type) => {\n                 // Match the 'static lifetime\n                 if let Some(lifetime) = *optional_lifetime {\n-                    if let TyKind::Path(_, _) = borrow_type.ty.node {\n-                        // Verify that the path is a str\n-                        if lifetime.ident.name == \"'static\" {\n-                            let mut sug: String = String::new();\n-                            span_lint_and_then(\n-                                cx,\n-                                CONST_STATIC_LIFETIME,\n-                                lifetime.span,\n-                                \"Constants have by default a `'static` lifetime\",\n-                                |db| {\n-                                    db.span_suggestion(lifetime.span, \"consider removing `'static`\", sug);\n-                                },\n-                            );\n+                    match borrow_type.ty.node {\n+                        TyKind::Path(..) | TyKind::Slice(..) | TyKind::Array(..) |\n+                        TyKind::Tup(..) => {\n+                            if lifetime.ident.name == \"'static\" {\n+                                let mut sug: String = String::new();\n+                                span_lint_and_then(\n+                                    cx,\n+                                    CONST_STATIC_LIFETIME,\n+                                    lifetime.span,\n+                                    \"Constants have by default a `'static` lifetime\",\n+                                    |db| {\n+                                        db.span_suggestion(lifetime.span, \"consider removing `'static`\", sug);\n+                                    },\n+                                );\n+                            }\n                         }\n+                        _ => {}\n                     }\n                 }\n                 self.visit_type(&*borrow_type.ty, cx);"}, {"sha": "a033f2b368e26baa77250de1764bb46324fcfd9f", "filename": "tests/ui/const_static_lifetime.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/tests%2Fui%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/tests%2Fui%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.rs?ref=296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "patch": "@@ -17,6 +17,12 @@ const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"]\n \n const VAR_HEIGHT: &'static Foo = &Foo {};\n \n+const VAR_SLICE: &'static [u8] = b\"Test constant #1\"; // ERROR Consider removing 'static.\n+\n+const VAR_TUPLE: &'static (u8, u8) = &(1, 2); // ERROR Consider removing 'static.\n+\n+const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n+\n fn main() {\n     let false_positive: &'static str = \"test\";\n     println!(\"{}\", VAR_ONE);"}, {"sha": "d4558f7b24147d83b1f9214cdfe42ec88e84765a", "filename": "tests/ui/const_static_lifetime.stderr", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/tests%2Fui%2Fconst_static_lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/296edda3a9fa4bdfe89bf52155432b8fcc949a8c/tests%2Fui%2Fconst_static_lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.stderr?ref=296edda3a9fa4bdfe89bf52155432b8fcc949a8c", "patch": "@@ -24,6 +24,12 @@ error: Constants have by default a `'static` lifetime\n 10 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n    |                                               ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:12:18\n+   |\n+12 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n+   |                  ^^^^^^^ help: consider removing `'static`\n+\n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:12:30\n    |\n@@ -36,6 +42,12 @@ error: Constants have by default a `'static` lifetime\n 14 | const VAR_SIX: &'static u8 = &5;\n    |                 ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:16:29\n+   |\n+16 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n+   |                             ^^^^^^^ help: consider removing `'static`\n+\n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:16:39\n    |\n@@ -48,3 +60,21 @@ error: Constants have by default a `'static` lifetime\n 18 | const VAR_HEIGHT: &'static Foo = &Foo {};\n    |                    ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:20:19\n+   |\n+20 | const VAR_SLICE: &'static [u8] = b\"Test constant #1\"; // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:22:19\n+   |\n+22 | const VAR_TUPLE: &'static (u8, u8) = &(1, 2); // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:24:19\n+   |\n+24 | const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+"}]}