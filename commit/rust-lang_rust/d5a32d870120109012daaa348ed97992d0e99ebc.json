{"sha": "d5a32d870120109012daaa348ed97992d0e99ebc", "node_id": "C_kwDOAAsO6NoAKGQ1YTMyZDg3MDEyMDEwOTAxMmRhYWEzNDhlZDk3OTkyZDBlOTllYmM", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-19T02:51:26Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-24T05:17:30Z"}, "message": "Add known-bug for #94034", "tree": {"sha": "34a86271b254ab521722baa1abae659e7b8f26fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/34a86271b254ab521722baa1abae659e7b8f26fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d5a32d870120109012daaa348ed97992d0e99ebc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d5a32d870120109012daaa348ed97992d0e99ebc", "html_url": "https://github.com/rust-lang/rust/commit/d5a32d870120109012daaa348ed97992d0e99ebc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d5a32d870120109012daaa348ed97992d0e99ebc/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6970f88db3ac2a9cefa9c585228291ae1f18fb04", "url": "https://api.github.com/repos/rust-lang/rust/commits/6970f88db3ac2a9cefa9c585228291ae1f18fb04", "html_url": "https://github.com/rust-lang/rust/commit/6970f88db3ac2a9cefa9c585228291ae1f18fb04"}], "stats": {"total": 97, "additions": 97, "deletions": 0}, "files": [{"sha": "5239e5db11c961562429126d2fa3910d265bda89", "filename": "src/test/ui/hrtb/issue-94034.rs", "status": "added", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/rust-lang/rust/blob/d5a32d870120109012daaa348ed97992d0e99ebc/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5a32d870120109012daaa348ed97992d0e99ebc/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.rs?ref=d5a32d870120109012daaa348ed97992d0e99ebc", "patch": "@@ -0,0 +1,96 @@\n+// known-bug\n+// failure-status: 101\n+// compile-flags: --edition=2021 --crate-type=lib\n+// rustc-env:RUST_BACKTRACE=0\n+\n+// normalize-stderr-test \"thread 'rustc' panicked.*\" -> \"thread 'rustc' panicked\"\n+// normalize-stderr-test \"note:.*RUST_BACKTRACE=1.*\\n\" -> \"\"\n+// normalize-stderr-test \"\\nerror: internal compiler error.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note:.*unexpectedly panicked.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: we would appreciate a bug report.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: compiler flags.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: rustc.*running on.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"query stack during panic:\\n\" -> \"\"\n+// normalize-stderr-test \"we're just showing a limited slice of the query stack\\n\" -> \"\"\n+// normalize-stderr-test \"end of query stack\\n\" -> \"\"\n+// normalize-stderr-test \"#.*\\n\" -> \"\"\n+\n+// This should not ICE.\n+\n+use std::{\n+    future::Future,\n+    marker::PhantomData,\n+    pin::Pin,\n+    task::{Context, Poll},\n+};\n+\n+mod object {\n+    use super::*;\n+\n+    pub trait Object<'a> {\n+        type Error;\n+        type Future: Future<Output = Self>;\n+        fn create() -> Self::Future;\n+    }\n+\n+    impl<'a> Object<'a> for u8 {\n+        type Error = ();\n+        type Future = Pin<Box<dyn Future<Output = Self>>>;\n+        fn create() -> Self::Future {\n+            unimplemented!()\n+        }\n+    }\n+\n+    impl<'a, E, A: Object<'a, Error = E>> Object<'a> for (A,) {\n+        type Error = ();\n+        type Future = CustomFut<'a, E, A>;\n+        fn create() -> Self::Future {\n+            unimplemented!()\n+        }\n+    }\n+\n+    pub struct CustomFut<'f, E, A: Object<'f, Error = E>> {\n+        ph: PhantomData<(A::Future,)>,\n+    }\n+\n+    impl<'f, E, A: Object<'f, Error = E>> Future for CustomFut<'f, E, A> {\n+        type Output = (A,);\n+        fn poll(self: Pin<&mut Self>, _: &mut Context<'_>) -> Poll<Self::Output> {\n+            unimplemented!()\n+        }\n+    }\n+}\n+\n+mod async_fn {\n+    use super::*;\n+\n+    pub trait AsyncFn {\n+        type Future: Future<Output = ()>;\n+        fn call(&self) -> Self::Future;\n+    }\n+\n+    impl<F, Fut> AsyncFn for F\n+    where\n+        F: Fn() -> Fut,\n+        Fut: Future<Output = ()>,\n+    {\n+        type Future = Fut;\n+        fn call(&self) -> Self::Future {\n+            (self)()\n+        }\n+    }\n+}\n+\n+pub async fn test() {\n+    use self::{async_fn::AsyncFn, object::Object};\n+\n+    async fn create<T: Object<'static>>() {\n+        T::create().await;\n+    }\n+\n+    async fn call_async_fn(inner: impl AsyncFn) {\n+        inner.call().await;\n+    }\n+\n+    call_async_fn(create::<(u8,)>).await;\n+}"}, {"sha": "1d8329142fc5c0a142f078d1106713135539f7ad", "filename": "src/test/ui/hrtb/issue-94034.stderr", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d5a32d870120109012daaa348ed97992d0e99ebc/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d5a32d870120109012daaa348ed97992d0e99ebc/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fhrtb%2Fissue-94034.stderr?ref=d5a32d870120109012daaa348ed97992d0e99ebc", "patch": "@@ -0,0 +1 @@\n+thread 'rustc' panicked"}]}