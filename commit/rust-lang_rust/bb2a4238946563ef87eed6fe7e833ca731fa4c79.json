{"sha": "bb2a4238946563ef87eed6fe7e833ca731fa4c79", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiMmE0MjM4OTQ2NTYzZWY4N2VlZDZmZTdlODMzY2E3MzFmYTRjNzk=", "commit": {"author": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-11-18T02:11:46Z"}, "committer": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-12-02T14:03:40Z"}, "message": "Allow &mut in const fns when feature gate is enabled", "tree": {"sha": "b0a509a835bc816aa00df5d4b0e4c04831553b39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0a509a835bc816aa00df5d4b0e4c04831553b39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb2a4238946563ef87eed6fe7e833ca731fa4c79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb2a4238946563ef87eed6fe7e833ca731fa4c79", "html_url": "https://github.com/rust-lang/rust/commit/bb2a4238946563ef87eed6fe7e833ca731fa4c79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb2a4238946563ef87eed6fe7e833ca731fa4c79/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12ac49afc9e1c33fe94f01dfca9efda4d7fed0b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/12ac49afc9e1c33fe94f01dfca9efda4d7fed0b2", "html_url": "https://github.com/rust-lang/rust/commit/12ac49afc9e1c33fe94f01dfca9efda4d7fed0b2"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "28240f6beca713d77091b614c92fe2f4701288eb", "filename": "src/librustc_mir/transform/qualify_min_const_fn.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bb2a4238946563ef87eed6fe7e833ca731fa4c79/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb2a4238946563ef87eed6fe7e833ca731fa4c79/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs?ref=bb2a4238946563ef87eed6fe7e833ca731fa4c79", "patch": "@@ -80,10 +80,14 @@ pub fn is_min_const_fn(tcx: TyCtxt<'tcx>, def_id: DefId, body: &'a Body<'tcx>) -\n fn check_ty(tcx: TyCtxt<'tcx>, ty: Ty<'tcx>, span: Span, fn_def_id: DefId) -> McfResult {\n     for ty in ty.walk() {\n         match ty.kind {\n-            ty::Ref(_, _, hir::Mutability::Mutable) => return Err((\n-                span,\n-                \"mutable references in const fn are unstable\".into(),\n-            )),\n+            ty::Ref(_, _, hir::Mutability::Mutable) => {\n+                if !tcx.features().const_fn_mut_refs {\n+                    return Err((\n+                        span,\n+                        \"mutable references in const fn are unstable\".into(),\n+                    ))\n+                }\n+            }\n             ty::Opaque(..) => return Err((span, \"`impl Trait` in const fn is unstable\".into())),\n             ty::FnPtr(..) => {\n                 if !tcx.const_fn_is_allowed_fn_ptr(fn_def_id) {"}]}