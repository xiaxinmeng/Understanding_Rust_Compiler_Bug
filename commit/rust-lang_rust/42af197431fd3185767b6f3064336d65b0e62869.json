{"sha": "42af197431fd3185767b6f3064336d65b0e62869", "node_id": "C_kwDOAAsO6NoAKDQyYWYxOTc0MzFmZDMxODU3NjdiNmYzMDY0MzM2ZDY1YjBlNjI4Njk", "commit": {"author": {"name": "Cliff L. Biffle", "email": "cliff@oxide.computer", "date": "2022-04-05T17:35:52Z"}, "committer": {"name": "Cliff L. Biffle", "email": "cliff@oxide.computer", "date": "2022-04-05T19:32:24Z"}, "message": "Improve debuginfo test coverage for simple statics.\n\n- Re-enabled basic-types-globals which has been disabled since 2018\n- Updated its now-rotted assertions about GDB's output to pass\n- Rewrote header comment describing some previous state of GDB behavior\n  that didn't match either the checked-in assertions _or_ the current\n  behavior, and so I assume has just been wrong for some time.\n- Copy-pasta'd the test into a version that uses LTO to check for\n  regression on #90357, because I don't see a way to matrix the same\n  test into several build configurations.", "tree": {"sha": "bb4bc94bbd1dd3c19dbdcb9cdd90d1de7ffb7008", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb4bc94bbd1dd3c19dbdcb9cdd90d1de7ffb7008"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42af197431fd3185767b6f3064336d65b0e62869", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42af197431fd3185767b6f3064336d65b0e62869", "html_url": "https://github.com/rust-lang/rust/commit/42af197431fd3185767b6f3064336d65b0e62869", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42af197431fd3185767b6f3064336d65b0e62869/comments", "author": {"login": "cbiffle", "id": 45247, "node_id": "MDQ6VXNlcjQ1MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/45247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbiffle", "html_url": "https://github.com/cbiffle", "followers_url": "https://api.github.com/users/cbiffle/followers", "following_url": "https://api.github.com/users/cbiffle/following{/other_user}", "gists_url": "https://api.github.com/users/cbiffle/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbiffle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbiffle/subscriptions", "organizations_url": "https://api.github.com/users/cbiffle/orgs", "repos_url": "https://api.github.com/users/cbiffle/repos", "events_url": "https://api.github.com/users/cbiffle/events{/privacy}", "received_events_url": "https://api.github.com/users/cbiffle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cbiffle", "id": 45247, "node_id": "MDQ6VXNlcjQ1MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/45247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbiffle", "html_url": "https://github.com/cbiffle", "followers_url": "https://api.github.com/users/cbiffle/followers", "following_url": "https://api.github.com/users/cbiffle/following{/other_user}", "gists_url": "https://api.github.com/users/cbiffle/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbiffle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbiffle/subscriptions", "organizations_url": "https://api.github.com/users/cbiffle/orgs", "repos_url": "https://api.github.com/users/cbiffle/repos", "events_url": "https://api.github.com/users/cbiffle/events{/privacy}", "received_events_url": "https://api.github.com/users/cbiffle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98190b716829fd4edbf1b364a1a662de9a9ca7bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/98190b716829fd4edbf1b364a1a662de9a9ca7bb", "html_url": "https://github.com/rust-lang/rust/commit/98190b716829fd4edbf1b364a1a662de9a9ca7bb"}], "stats": {"total": 90, "additions": 83, "deletions": 7}, "files": [{"sha": "03770eb6f01c7e3c64574f869dd87cafc60799c4", "filename": "src/test/debuginfo/basic-types-globals-lto.rs", "status": "added", "additions": 80, "deletions": 0, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/42af197431fd3185767b6f3064336d65b0e62869/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals-lto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42af197431fd3185767b6f3064336d65b0e62869/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals-lto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals-lto.rs?ref=42af197431fd3185767b6f3064336d65b0e62869", "patch": "@@ -0,0 +1,80 @@\n+// Caveat - gdb doesn't know about UTF-32 character encoding and will print a\n+// rust char as only its numerical value.\n+\n+// min-lldb-version: 310\n+\n+// no-prefer-dynamic\n+// compile-flags:-g -C lto\n+// gdb-command:run\n+// gdbg-command:print 'basic_types_globals::B'\n+// gdbr-command:print B\n+// gdb-check:$1 = false\n+// gdbg-command:print 'basic_types_globals::I'\n+// gdbr-command:print I\n+// gdb-check:$2 = -1\n+// gdbg-command:print 'basic_types_globals::C'\n+// gdbr-command:print C\n+// gdbg-check:$3 = 97\n+// gdbr-check:$3 = 97\n+// gdbg-command:print/d 'basic_types_globals::I8'\n+// gdbr-command:print I8\n+// gdb-check:$4 = 68\n+// gdbg-command:print 'basic_types_globals::I16'\n+// gdbr-command:print I16\n+// gdb-check:$5 = -16\n+// gdbg-command:print 'basic_types_globals::I32'\n+// gdbr-command:print I32\n+// gdb-check:$6 = -32\n+// gdbg-command:print 'basic_types_globals::I64'\n+// gdbr-command:print I64\n+// gdb-check:$7 = -64\n+// gdbg-command:print 'basic_types_globals::U'\n+// gdbr-command:print U\n+// gdb-check:$8 = 1\n+// gdbg-command:print/d 'basic_types_globals::U8'\n+// gdbr-command:print U8\n+// gdb-check:$9 = 100\n+// gdbg-command:print 'basic_types_globals::U16'\n+// gdbr-command:print U16\n+// gdb-check:$10 = 16\n+// gdbg-command:print 'basic_types_globals::U32'\n+// gdbr-command:print U32\n+// gdb-check:$11 = 32\n+// gdbg-command:print 'basic_types_globals::U64'\n+// gdbr-command:print U64\n+// gdb-check:$12 = 64\n+// gdbg-command:print 'basic_types_globals::F32'\n+// gdbr-command:print F32\n+// gdb-check:$13 = 2.5\n+// gdbg-command:print 'basic_types_globals::F64'\n+// gdbr-command:print F64\n+// gdb-check:$14 = 3.5\n+// gdb-command:continue\n+\n+#![allow(unused_variables)]\n+#![feature(omit_gdb_pretty_printer_section)]\n+#![omit_gdb_pretty_printer_section]\n+\n+// N.B. These are `mut` only so they don't constant fold away.\n+static mut B: bool = false;\n+static mut I: isize = -1;\n+static mut C: char = 'a';\n+static mut I8: i8 = 68;\n+static mut I16: i16 = -16;\n+static mut I32: i32 = -32;\n+static mut I64: i64 = -64;\n+static mut U: usize = 1;\n+static mut U8: u8 = 100;\n+static mut U16: u16 = 16;\n+static mut U32: u32 = 32;\n+static mut U64: u64 = 64;\n+static mut F32: f32 = 2.5;\n+static mut F64: f64 = 3.5;\n+\n+fn main() {\n+    _zzz(); // #break\n+\n+    let a = unsafe { (B, I, C, I8, I16, I32, I64, U, U8, U16, U32, U64, F32, F64) };\n+}\n+\n+fn _zzz() {()}"}, {"sha": "11637d2294a8355722d0c96aa8149f4502424d5d", "filename": "src/test/debuginfo/basic-types-globals.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/42af197431fd3185767b6f3064336d65b0e62869/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42af197431fd3185767b6f3064336d65b0e62869/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fbasic-types-globals.rs?ref=42af197431fd3185767b6f3064336d65b0e62869", "patch": "@@ -1,11 +1,7 @@\n-// Caveats - gdb prints any 8-bit value (meaning rust I8 and u8 values)\n-// as its numerical value along with its associated ASCII char, there\n-// doesn't seem to be any way around this. Also, gdb doesn't know\n-// about UTF-32 character encoding and will print a rust char as only\n-// its numerical value.\n+// Caveat - gdb doesn't know about UTF-32 character encoding and will print a\n+// rust char as only its numerical value.\n \n // min-lldb-version: 310\n-// ignore-gdb // Test temporarily ignored due to debuginfo tests being disabled, see PR 47155\n \n // compile-flags:-g\n // gdb-command:run\n@@ -18,7 +14,7 @@\n // gdbg-command:print 'basic_types_globals::C'\n // gdbr-command:print C\n // gdbg-check:$3 = 97\n-// gdbr-check:$3 = 97 'a'\n+// gdbr-check:$3 = 97\n // gdbg-command:print/d 'basic_types_globals::I8'\n // gdbr-command:print I8\n // gdb-check:$4 = 68"}]}