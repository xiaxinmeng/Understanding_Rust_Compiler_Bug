{"sha": "57847e451af3d0057f36f61c357f5c451b4ac7ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU3ODQ3ZTQ1MWFmM2QwMDU3ZjM2ZjYxYzM1N2Y1YzQ1MWI0YWM3ZWQ=", "commit": {"author": {"name": "Erik Johnston", "email": "erikj@jki.re", "date": "2016-04-01T23:25:35Z"}, "committer": {"name": "Erik Johnston", "email": "erikj@jki.re", "date": "2016-04-01T23:25:35Z"}, "message": "Add fn_arg_one_line option\n\nIf set, arguments will be kept on one line if they fit. Currently only\napplies when `fn_args_layout` is set to `Block`.\n\nThis commit also fixes a bug where newlines were inserted inbetween\nargument brackets when there were no arguments and `fn_args_layout` was\nset to `Block`.", "tree": {"sha": "fd79e4ab041017d787a06f8a3afe19c0552b8499", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd79e4ab041017d787a06f8a3afe19c0552b8499"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/57847e451af3d0057f36f61c357f5c451b4ac7ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/57847e451af3d0057f36f61c357f5c451b4ac7ed", "html_url": "https://github.com/rust-lang/rust/commit/57847e451af3d0057f36f61c357f5c451b4ac7ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/57847e451af3d0057f36f61c357f5c451b4ac7ed/comments", "author": {"login": "erikjohnston", "id": 8428120, "node_id": "MDQ6VXNlcjg0MjgxMjA=", "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikjohnston", "html_url": "https://github.com/erikjohnston", "followers_url": "https://api.github.com/users/erikjohnston/followers", "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}", "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions", "organizations_url": "https://api.github.com/users/erikjohnston/orgs", "repos_url": "https://api.github.com/users/erikjohnston/repos", "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}", "received_events_url": "https://api.github.com/users/erikjohnston/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erikjohnston", "id": 8428120, "node_id": "MDQ6VXNlcjg0MjgxMjA=", "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikjohnston", "html_url": "https://github.com/erikjohnston", "followers_url": "https://api.github.com/users/erikjohnston/followers", "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}", "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions", "organizations_url": "https://api.github.com/users/erikjohnston/orgs", "repos_url": "https://api.github.com/users/erikjohnston/repos", "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}", "received_events_url": "https://api.github.com/users/erikjohnston/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3cef52cde49245982f044a481fd6ebbbfb7dcb5", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3cef52cde49245982f044a481fd6ebbbfb7dcb5", "html_url": "https://github.com/rust-lang/rust/commit/c3cef52cde49245982f044a481fd6ebbbfb7dcb5"}], "stats": {"total": 167, "additions": 160, "deletions": 7}, "files": [{"sha": "02ee5741c45014bdc4e1e8ad9a5a1d09ecf1f1ce", "filename": "src/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -310,6 +310,7 @@ create_config! {\n     fn_args_density: Density, Density::Tall, \"Argument density in functions\";\n     fn_args_layout: StructLitStyle, StructLitStyle::Visual, \"Layout of function arguments\";\n     fn_arg_indent: BlockIndentStyle, BlockIndentStyle::Visual, \"Indent on function arguments\";\n+    fn_arg_one_line: bool, false, \"Keep arguments on one line if they fit\";\n     type_punctuation_density: TypeDensity, TypeDensity::Wide,\n         \"Determines if '+' or '=' are wrapped in spaces in the punctuation of types\";\n     // Should we at least try to put the where clause on the same line as the rest of the"}, {"sha": "da6d77fca45bb9f275b8eef4c53c53b4139ad7bf", "filename": "src/items.rs", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -1293,6 +1293,10 @@ fn rewrite_fn_base(context: &RewriteContext,\n     let (mut one_line_budget, multi_line_budget, mut arg_indent) =\n         compute_budgets_for_args(context, &result, indent, ret_str_len, newline_brace);\n \n+    if context.config.fn_args_layout == StructLitStyle::Block {\n+        arg_indent = indent.block_indent(context.config);\n+    }\n+\n     debug!(\"rewrite_fn: one_line_budget: {}, multi_line_budget: {}, arg_indent: {:?}\",\n            one_line_budget,\n            multi_line_budget,\n@@ -1309,10 +1313,6 @@ fn rewrite_fn_base(context: &RewriteContext,\n             result.push_str(\"(\\n\");\n             result.push_str(&arg_indent.to_string(context.config));\n         }\n-    } else if context.config.fn_args_layout == StructLitStyle::Block {\n-        arg_indent = indent.block_indent(context.config);\n-        result.push_str(\"(\\n\");\n-        result.push_str(&arg_indent.to_string(context.config));\n     } else {\n         result.push('(');\n     }\n@@ -1336,12 +1336,25 @@ fn rewrite_fn_base(context: &RewriteContext,\n                                         arg_indent,\n                                         args_span,\n                                         fd.variadic));\n-    result.push_str(&arg_str);\n-    if context.config.fn_args_layout == StructLitStyle::Block {\n+\n+    let multi_line_arg_str = arg_str.contains('\\n');\n+\n+    let should_put_args_in_block = context.config.fn_args_layout == StructLitStyle::Block &&\n+                                   (multi_line_arg_str || !context.config.fn_arg_one_line) &&\n+                                   fd.inputs.len() > 0;\n+\n+    if should_put_args_in_block {\n+        arg_indent = indent.block_indent(context.config);\n+        result.push('\\n');\n+        result.push_str(&arg_indent.to_string(context.config));\n+        result.push_str(&arg_str);\n         result.push('\\n');\n         result.push_str(&indent.to_string(context.config));\n+        result.push(')');\n+    } else {\n+        result.push_str(&arg_str);\n+        result.push(')');\n     }\n-    result.push(')');\n \n     // Return type.\n     if !ret_str.is_empty() {"}, {"sha": "23aea2b58f766e28e28708eeb3387f0d10fa5381", "filename": "tests/source/fn_arg_one_line.rs", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Fsource%2Ffn_arg_one_line.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Fsource%2Ffn_arg_one_line.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ffn_arg_one_line.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -0,0 +1,48 @@\n+// rustfmt-fn_args_layout: Block\n+// rustfmt-fn_arg_one_line: true\n+\n+fn foo() {\n+    foo();\n+}\n+\n+fn foo(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb) {\n+    foo();\n+}\n+\n+fn bar(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb, c: Cccccccccccccccccc, d: Dddddddddddddddd, e: Eeeeeeeeeeeeeee) {\n+    bar();\n+}\n+\n+fn foo(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb) -> String {\n+    foo();\n+}\n+\n+fn bar(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb, c: Cccccccccccccccccc, d: Dddddddddddddddd, e: Eeeeeeeeeeeeeee) -> String {\n+    bar();\n+}\n+\n+fn foo(a: u8 /* Comment 1 */, b: u8 /* Comment 2 */) -> u8 {\n+    bar()\n+}\n+\n+fn foo(a: u8 /* Comment 1 */, b: Bbbbbbbbbbbbbb, c: Cccccccccccccccccc, d: Dddddddddddddddd, e: Eeeeeeeeeeeeeee /* Comment 2 */) -> u8 {\n+    bar()\n+}\n+\n+fn bar(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb, c: Cccccccccccccccccc, d: Dddddddddddddddd, e: Eeeeeeeeeeeeeee) -> String where X: Fooooo, Y: Baaar  {\n+    bar();\n+}\n+\n+fn foo() -> T {\n+    foo();\n+}\n+\n+fn foo() -> T where X: Foooo, Y: Baaar {\n+    foo();\n+}\n+\n+trait Test {\n+    fn foo(a: u8) {}\n+\n+    fn bar(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb, c: Cccccccccccccccccc, d: Dddddddddddddddd, e: Eeeeeeeeeeeeeee) -> String {}\n+}"}, {"sha": "a5b8e66931fdfd7b8933cc9657892a7cfd1e93a0", "filename": "tests/source/fn_args_layout-block.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Fsource%2Ffn_args_layout-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Fsource%2Ffn_args_layout-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ffn_args_layout-block.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -1,5 +1,8 @@\n // rustfmt-fn_args_layout: Block\n \n+fn foo() {\n+    foo();\n+}\n \n fn foo(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb) {\n     foo();"}, {"sha": "ef5eeea90bdada986adf7355813d50167dce8d14", "filename": "tests/target/fn_arg_one_line.rs", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Ftarget%2Ffn_arg_one_line.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Ftarget%2Ffn_arg_one_line.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ffn_arg_one_line.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -0,0 +1,85 @@\n+// rustfmt-fn_args_layout: Block\n+// rustfmt-fn_arg_one_line: true\n+\n+fn foo() {\n+    foo();\n+}\n+\n+fn foo(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb) {\n+    foo();\n+}\n+\n+fn bar(\n+    a: Aaaaaaaaaaaaaa,\n+    b: Bbbbbbbbbbbbbb,\n+    c: Cccccccccccccccccc,\n+    d: Dddddddddddddddd,\n+    e: Eeeeeeeeeeeeeee\n+) {\n+    bar();\n+}\n+\n+fn foo(a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb) -> String {\n+    foo();\n+}\n+\n+fn bar(\n+    a: Aaaaaaaaaaaaaa,\n+    b: Bbbbbbbbbbbbbb,\n+    c: Cccccccccccccccccc,\n+    d: Dddddddddddddddd,\n+    e: Eeeeeeeeeeeeeee\n+) -> String {\n+    bar();\n+}\n+\n+fn foo(a: u8 /* Comment 1 */, b: u8 /* Comment 2 */) -> u8 {\n+    bar()\n+}\n+\n+fn foo(\n+    a: u8, // Comment 1\n+    b: Bbbbbbbbbbbbbb,\n+    c: Cccccccccccccccccc,\n+    d: Dddddddddddddddd,\n+    e: Eeeeeeeeeeeeeee // Comment 2\n+) -> u8 {\n+    bar()\n+}\n+\n+fn bar(\n+    a: Aaaaaaaaaaaaaa,\n+    b: Bbbbbbbbbbbbbb,\n+    c: Cccccccccccccccccc,\n+    d: Dddddddddddddddd,\n+    e: Eeeeeeeeeeeeeee\n+) -> String\n+    where X: Fooooo,\n+          Y: Baaar\n+{\n+    bar();\n+}\n+\n+fn foo() -> T {\n+    foo();\n+}\n+\n+fn foo() -> T\n+    where X: Foooo,\n+          Y: Baaar\n+{\n+    foo();\n+}\n+\n+trait Test {\n+    fn foo(a: u8) {}\n+\n+    fn bar(\n+        a: Aaaaaaaaaaaaaa,\n+        b: Bbbbbbbbbbbbbb,\n+        c: Cccccccccccccccccc,\n+        d: Dddddddddddddddd,\n+        e: Eeeeeeeeeeeeeee\n+    ) -> String {\n+    }\n+}"}, {"sha": "f18cf2197d813377f1fce13666d3d9a932a3dfbc", "filename": "tests/target/fn_args_layout-block.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Ftarget%2Ffn_args_layout-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57847e451af3d0057f36f61c357f5c451b4ac7ed/tests%2Ftarget%2Ffn_args_layout-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ffn_args_layout-block.rs?ref=57847e451af3d0057f36f61c357f5c451b4ac7ed", "patch": "@@ -1,5 +1,8 @@\n // rustfmt-fn_args_layout: Block\n \n+fn foo() {\n+    foo();\n+}\n \n fn foo(\n     a: Aaaaaaaaaaaaaa, b: Bbbbbbbbbbbbbb"}]}