{"sha": "3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhODNjYjJjOWJhMmFjY2EwNTc3YTVmNGEwOTJkN2ZjNWIyNDNmYWY=", "commit": {"author": {"name": "Dan Robertson", "email": "dan@dlrobertson.com", "date": "2019-03-09T03:39:23Z"}, "committer": {"name": "Dan Robertson", "email": "dan@dlrobertson.com", "date": "2019-03-10T00:19:00Z"}, "message": "Fix ICE in MIR pretty printing\n\nA `Def::Variant` should be considered as a function in mir pretty\nprinting. Each variant has a constructor that we must print.\n\nGiven the following enum definition:\n\n```\npub enum TestMe {\n    X(usize),\n}\n```\n\nWe will need to generate a constructor for the variant `X` with a\nsignature that looks something like the following:\n\n```\nfn TestMe::X(_1: usize) -> TestMe;\n```", "tree": {"sha": "f6e94c4cbb1171d9088b0acafff726e7394c444c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6e94c4cbb1171d9088b0acafff726e7394c444c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF5dO2RaKc5C+SCJ9RcSmUsR+QqUFAlyEV/oACgkQRcSmUsR+\nQqXxoQ/+L/67IPanzVxj69sP+coOgzdSNZq0KfnHxe6P4Xnt2wZ3GE2OG6Rp50hF\nZ1EYKN1CXuRXUsu65a6wBjx9FJskFxzv39YvQLqRX1niwOA/s0GfW8ApZDcFvgbl\nbtzluszHP30KOOtmWRT//rNZLIGXEHxzKAEUSUg6XqJjoEVC7q5tU6ZoygLox/Og\nEIrJzuN/+fL2gJIg2IN8V0WBvXYh9MXVVnTwww4ngWDiroEk2Mw8bprAOcloEGqL\nJ25cvsMCLpUHOMipnonaTwoQXLSXz1OsAbL3DlI0A6IheE/p+2UJcKYL7q0ryWTP\nivKSbNdf3FLIzTpe/h9KHe2WDUsKKUnG4u0i8E6Bd1IxtJWIuaYcXEonvavjrw+j\n9J9amV+b2+kaTkxFmN/fzIGHLaBZt+ukXlQfQytru9YAeaS4+EHw0Ou0EmJ3JY/U\nDM3JfVZgFq/NajEpcdGv7H+LeayCBNJxjfARfMHcRMyq010ERZX5OMdgY+v+Hy/D\nV13iXrYk/LuRAUZdPV+amjRrF+3/m7/jd9nr+Jh1QKKiwJzlZwRCDnhgwzwn34Nm\nou93K1z6S8cooDAzKuUNEjMTslypb5JxzrLaSgehR1qjC6fXQxeKLQS7r9MXxO4E\nlphKiiqvV+nAuJgV/+z43cFkfBeEcH8xLSm0ZZNiZXqHCVCYSYY=\n=P9JL\n-----END PGP SIGNATURE-----", "payload": "tree f6e94c4cbb1171d9088b0acafff726e7394c444c\nparent b2ea6c86ae8b9f8845aaff5a1453e4f5ceb53d59\nauthor Dan Robertson <dan@dlrobertson.com> 1552102763 +0000\ncommitter Dan Robertson <dan@dlrobertson.com> 1552177140 +0000\n\nFix ICE in MIR pretty printing\n\nA `Def::Variant` should be considered as a function in mir pretty\nprinting. Each variant has a constructor that we must print.\n\nGiven the following enum definition:\n\n```\npub enum TestMe {\n    X(usize),\n}\n```\n\nWe will need to generate a constructor for the variant `X` with a\nsignature that looks something like the following:\n\n```\nfn TestMe::X(_1: usize) -> TestMe;\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "html_url": "https://github.com/rust-lang/rust/commit/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf/comments", "author": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2ea6c86ae8b9f8845aaff5a1453e4f5ceb53d59", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2ea6c86ae8b9f8845aaff5a1453e4f5ceb53d59", "html_url": "https://github.com/rust-lang/rust/commit/b2ea6c86ae8b9f8845aaff5a1453e4f5ceb53d59"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "af49f61ae86c78a5e3f94ba2ada8a0a6558c4dd3", "filename": "src/librustc_mir/util/pretty.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fpretty.rs?ref=3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "patch": "@@ -1,4 +1,5 @@\n use rustc::hir::def_id::{DefId, LOCAL_CRATE};\n+use rustc::hir::def::CtorKind;\n use rustc::mir::*;\n use rustc::mir::visit::Visitor;\n use rustc::ty::{self, TyCtxt};\n@@ -597,7 +598,8 @@ fn write_mir_sig(\n     trace!(\"write_mir_sig: {:?}\", src.instance);\n     let descr = tcx.describe_def(src.def_id());\n     let is_function = match descr {\n-        Some(Def::Fn(_)) | Some(Def::Method(_)) | Some(Def::StructCtor(..)) => true,\n+        Some(Def::Fn(_)) | Some(Def::Method(_)) | Some(Def::Variant(..)) |\n+        Some(Def::StructCtor(_, CtorKind::Fn)) => true,\n         _ => tcx.is_closure(src.def_id()),\n     };\n     match (descr, src.promoted) {"}, {"sha": "ced30381fda68cb0f81a16151a9f3005297456bb", "filename": "src/test/mir-opt/unusual-item-types.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs?ref=3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "patch": "@@ -7,11 +7,18 @@ impl A {\n     const ASSOCIATED_CONSTANT: i32 = 2;\n }\n \n+// See #59021\n+enum Test {\n+    X(usize),\n+    Y { a: usize },\n+}\n+\n enum E {\n     V = 5,\n }\n \n fn main() {\n+    let f = Test::X as fn(usize) -> Test;\n     let v = Vec::<i32>::new();\n }\n \n@@ -64,3 +71,14 @@ fn main() {\n //     _3 = const std::ops::Drop::drop(move _2) -> [return: bb6, unwind: bb5];\n // }\n // END rustc.ptr-real_drop_in_place.std__vec__Vec_i32_.AddMovesForPackedDrops.before.mir\n+\n+// START rustc.Test-X.mir_map.0.mir\n+// fn Test::X(_1: usize) -> Test {\n+//     let mut _0: Test;\n+//\n+//     bb0: {\n+//         _0 = Test::X(move _1,);\n+//         return;\n+//     }\n+// }\n+// END rustc.Test-X.mir_map.0.mir"}]}