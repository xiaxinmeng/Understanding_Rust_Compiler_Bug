{"sha": "4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhMDA5NGYyOGYxMTQzMzNlMWExZmUxMDVjNGRkNTdmM2M4MzhhN2I=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-03T13:50:13Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-04T10:35:29Z"}, "message": "Add combine_control_expr option", "tree": {"sha": "286fcfc1d18ccf9fed2034a2e9f8b2200fd5db6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/286fcfc1d18ccf9fed2034a2e9f8b2200fd5db6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "html_url": "https://github.com/rust-lang/rust/commit/4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b548d8d77339eefb46ca6a0c38fa430ddb05017a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b548d8d77339eefb46ca6a0c38fa430ddb05017a", "html_url": "https://github.com/rust-lang/rust/commit/b548d8d77339eefb46ca6a0c38fa430ddb05017a"}], "stats": {"total": 69, "additions": 64, "deletions": 5}, "files": [{"sha": "605f5d63291b41323e0c35df6e8d80d22d9e4543", "filename": "Configurations.md", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/Configurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/Configurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Configurations.md?ref=4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "patch": "@@ -166,6 +166,62 @@ lorem_ipsum(|| {\n });\n ```\n \n+## `combine_control_expr`\n+\n+Combine control expressions with function calls.\n+\n+- **Default value**: `true`\n+- **Possible values**: `true`, `false`\n+\n+#### `true`\n+\n+```rust\n+fn example() {\n+    // If\n+    foo!(if x {\n+        foo();\n+    } else {\n+        bar();\n+    });\n+\n+    // IfLet\n+    foo!(if let Some(..) = x {\n+        foo();\n+    } else {\n+        bar();\n+    });\n+\n+    // While\n+    foo!(while x {\n+        foo();\n+        bar();\n+    });\n+\n+    // WhileLet\n+    foo!(while let Some(..) = x {\n+        foo();\n+        bar();\n+    });\n+\n+    // ForLoop\n+    foo!(for x in y {\n+        foo();\n+        bar();\n+    });\n+\n+    // Loop\n+    foo!(loop {\n+        foo();\n+        bar();\n+    });\n+}\n+```\n+\n+#### `false`\n+\n+```rust\n+```\n+\n ## `comment_width`\n \n Maximum length of comments. No effect unless`wrap_comments = true`."}, {"sha": "d4bff961e7439d66fe220219ff100e2c04a3b583", "filename": "src/config.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "patch": "@@ -575,7 +575,8 @@ create_config! {\n     write_mode: WriteMode, WriteMode::Replace,\n         \"What Write Mode to use when none is supplied: Replace, Overwrite, Display, Diff, Coverage\";\n     condense_wildcard_suffixes: bool, false, \"Replace strings of _ wildcards by a single .. in \\\n-                                              tuple patterns\"\n+                                              tuple patterns\";\n+    combine_control_expr: bool, true, \"Combine control expressions with funciton calls.\"\n }\n \n #[cfg(test)]"}, {"sha": "0ec459f8e19136d54a31e7be5b026327f3fbcc7f", "filename": "src/expr.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0094f28f114333e1a1fe105c4dd57f3c838a7b/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=4a0094f28f114333e1a1fe105c4dd57f3c838a7b", "patch": "@@ -980,12 +980,14 @@ impl<'a> Rewrite for ControlFlow<'a> {\n         // for event in event\n         let between_kwd_cond = mk_sp(\n             context.codemap.span_after(self.span, self.keyword.trim()),\n-            self.pat\n-                .map_or(cond_span.lo, |p| if self.matcher.is_empty() {\n+            self.pat.map_or(\n+                cond_span.lo,\n+                |p| if self.matcher.is_empty() {\n                     p.span.lo\n                 } else {\n                     context.codemap.span_before(self.span, self.matcher.trim())\n-                }),\n+                },\n+            ),\n         );\n \n         let between_kwd_cond_comment = extract_comment(between_kwd_cond, context, shape);\n@@ -1863,7 +1865,7 @@ fn can_be_overflowed_expr(context: &RewriteContext, expr: &ast::Expr, args_len:\n         ast::ExprKind::Loop(..) |\n         ast::ExprKind::While(..) |\n         ast::ExprKind::WhileLet(..) => {\n-            context.use_block_indent() && args_len == 1\n+            context.config.combine_control_expr() && context.use_block_indent() && args_len == 1\n         }\n         ast::ExprKind::Block(..) |\n         ast::ExprKind::Closure(..) => {"}]}