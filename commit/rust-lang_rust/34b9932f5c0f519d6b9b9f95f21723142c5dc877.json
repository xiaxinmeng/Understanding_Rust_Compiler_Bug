{"sha": "34b9932f5c0f519d6b9b9f95f21723142c5dc877", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0Yjk5MzJmNWMwZjUxOWQ2YjliOWY5NWYyMTcyMzE0MmM1ZGM4Nzc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-05T08:42:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-05T08:42:05Z"}, "message": "Auto merge of #85990 - jyn514:channel-replace-rustdoc, r=Manishearth\n\nrustdoc: link consistently to stable/beta in diagnostic messages\n\nBuilds on https://github.com/rust-lang/rust/pull/84942. This makes the diagnostics consistent with the links.", "tree": {"sha": "84bbc2d0eebe41c31c1d90479cbb817225c8da7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84bbc2d0eebe41c31c1d90479cbb817225c8da7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34b9932f5c0f519d6b9b9f95f21723142c5dc877", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34b9932f5c0f519d6b9b9f95f21723142c5dc877", "html_url": "https://github.com/rust-lang/rust/commit/34b9932f5c0f519d6b9b9f95f21723142c5dc877", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34b9932f5c0f519d6b9b9f95f21723142c5dc877/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e20754629c2ee51760d2d5ab3abb09d3e994e8a", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e20754629c2ee51760d2d5ab3abb09d3e994e8a", "html_url": "https://github.com/rust-lang/rust/commit/4e20754629c2ee51760d2d5ab3abb09d3e994e8a"}, {"sha": "4c71610e3e9f6f0d322990b75b388a625edc2b17", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c71610e3e9f6f0d322990b75b388a625edc2b17", "html_url": "https://github.com/rust-lang/rust/commit/4c71610e3e9f6f0d322990b75b388a625edc2b17"}], "stats": {"total": 24, "additions": 17, "deletions": 7}, "files": [{"sha": "706a56fbcbfe6c7f01961bca88ee2fdfe6126e1d", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=34b9932f5c0f519d6b9b9f95f21723142c5dc877", "patch": "@@ -557,7 +557,8 @@ crate fn has_doc_flag(attrs: ty::Attributes<'_>, flag: Symbol) -> bool {\n     })\n }\n \n-/// A link to `doc.rust-lang.org` that includes the channel name.\n+/// A link to `doc.rust-lang.org` that includes the channel name. Use this instead of manual links\n+/// so that the channel is consistent.\n ///\n /// Set by `bootstrap::Builder::doc_rust_lang_org_channel` in order to keep tests passing on beta/stable.\n crate const DOC_RUST_LANG_ORG_CHANNEL: &'static str = env!(\"DOC_RUST_LANG_ORG_CHANNEL\");"}, {"sha": "52cae5631c8bf703e87fc0986bbb45ff7dc7f9cc", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=34b9932f5c0f519d6b9b9f95f21723142c5dc877", "patch": "@@ -399,15 +399,18 @@ crate fn run_global_ctxt(\n     let mut krate = tcx.sess.time(\"clean_crate\", || clean::krate(&mut ctxt));\n \n     if krate.module.doc_value().map(|d| d.is_empty()).unwrap_or(true) {\n-        let help = \"The following guide may be of use:\\n\\\n-                https://doc.rust-lang.org/nightly/rustdoc/how-to-write-documentation.html\";\n+        let help = format!(\n+            \"The following guide may be of use:\\n\\\n+            {}/rustdoc/how-to-write-documentation.html\",\n+            crate::DOC_RUST_LANG_ORG_CHANNEL\n+        );\n         tcx.struct_lint_node(\n             crate::lint::MISSING_CRATE_LEVEL_DOCS,\n             DocContext::as_local_hir_id(tcx, krate.module.def_id).unwrap(),\n             |lint| {\n                 let mut diag =\n                     lint.build(\"no documentation found for this crate's top-level module\");\n-                diag.help(help);\n+                diag.help(&help);\n                 diag.emit();\n             },\n         );"}, {"sha": "ee7a716655bd2d7b1d2bc98df19e5a631e24e788", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=34b9932f5c0f519d6b9b9f95f21723142c5dc877", "patch": "@@ -613,7 +613,10 @@ fn usage(argv0: &str) {\n     }\n     println!(\"{}\", options.usage(&format!(\"{} [options] <input>\", argv0)));\n     println!(\"    @path               Read newline separated options from `path`\\n\");\n-    println!(\"More information available at https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html\")\n+    println!(\n+        \"More information available at {}/rustdoc/what-is-rustdoc.html\",\n+        DOC_RUST_LANG_ORG_CHANNEL\n+    );\n }\n \n /// A result type used by several functions under `main()`."}, {"sha": "247a020f2a20d28f3ccba04026e310384e5a774e", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34b9932f5c0f519d6b9b9f95f21723142c5dc877/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=34b9932f5c0f519d6b9b9f95f21723142c5dc877", "patch": "@@ -1999,8 +1999,11 @@ fn disambiguator_error(\n ) {\n     diag_info.link_range = disambiguator_range;\n     report_diagnostic(cx.tcx, BROKEN_INTRA_DOC_LINKS, msg, &diag_info, |diag, _sp| {\n-        let msg = \"see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\";\n-        diag.note(msg);\n+        let msg = format!(\n+            \"see {}/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\",\n+            crate::DOC_RUST_LANG_ORG_CHANNEL\n+        );\n+        diag.note(&msg);\n     });\n }\n "}]}