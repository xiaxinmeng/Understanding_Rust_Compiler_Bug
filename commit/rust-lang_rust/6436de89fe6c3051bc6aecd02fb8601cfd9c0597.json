{"sha": "6436de89fe6c3051bc6aecd02fb8601cfd9c0597", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0MzZkZTg5ZmU2YzMwNTFiYzZhZWNkMDJmYjg2MDFjZmQ5YzA1OTc=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-05-20T22:00:38Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-05-24T18:47:35Z"}, "message": "Differentiate between interpret::Scalar and layout::Scalar", "tree": {"sha": "d7425a992cea0912ba500a03b80fcf7a015fc73c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7425a992cea0912ba500a03b80fcf7a015fc73c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6436de89fe6c3051bc6aecd02fb8601cfd9c0597", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6436de89fe6c3051bc6aecd02fb8601cfd9c0597", "html_url": "https://github.com/rust-lang/rust/commit/6436de89fe6c3051bc6aecd02fb8601cfd9c0597", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6436de89fe6c3051bc6aecd02fb8601cfd9c0597/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef2177cffc66abdffad4b09a093239a8ba22e434", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef2177cffc66abdffad4b09a093239a8ba22e434", "html_url": "https://github.com/rust-lang/rust/commit/ef2177cffc66abdffad4b09a093239a8ba22e434"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "29b39de82178955171ed16e38363cb1383e14624", "filename": "src/librustc_codegen_llvm/mir/constant.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6436de89fe6c3051bc6aecd02fb8601cfd9c0597/src%2Flibrustc_codegen_llvm%2Fmir%2Fconstant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6436de89fe6c3051bc6aecd02fb8601cfd9c0597/src%2Flibrustc_codegen_llvm%2Fmir%2Fconstant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fmir%2Fconstant.rs?ref=6436de89fe6c3051bc6aecd02fb8601cfd9c0597", "patch": "@@ -16,7 +16,7 @@ use rustc::mir;\n use rustc_data_structures::indexed_vec::Idx;\n use rustc::mir::interpret::{GlobalId, MemoryPointer, Scalar, Allocation, ConstValue, AllocType};\n use rustc::ty::{self, Ty};\n-use rustc::ty::layout::{self, HasDataLayout, LayoutOf, Scalar, Size};\n+use rustc::ty::layout::{self, HasDataLayout, LayoutOf, Size};\n use builder::Builder;\n use common::{CodegenCx};\n use common::{C_bytes, C_struct, C_uint_big, C_undef, C_usize};\n@@ -30,14 +30,14 @@ use super::FunctionCx;\n \n pub fn primval_to_llvm(cx: &CodegenCx,\n                        cv: Scalar,\n-                       scalar: &Scalar,\n+                       layout: &layout::Scalar,\n                        llty: Type) -> ValueRef {\n-    let bits = if scalar.is_bool() { 1 } else { scalar.value.size(cx).bits() };\n+    let bits = if layout.is_bool() { 1 } else { layout.value.size(cx).bits() };\n     match cv {\n         Scalar::Undef => C_undef(Type::ix(cx, bits)),\n         Scalar::Bytes(b) => {\n             let llval = C_uint_big(Type::ix(cx, bits), b);\n-            if scalar.value == layout::Pointer {\n+            if layout.value == layout::Pointer {\n                 unsafe { llvm::LLVMConstIntToPtr(llval, llty.to_ref()) }\n             } else {\n                 consts::bitcast(llval, llty)\n@@ -68,7 +68,7 @@ pub fn primval_to_llvm(cx: &CodegenCx,\n                 &C_usize(cx, ptr.offset.bytes()),\n                 1,\n             ) };\n-            if scalar.value != layout::Pointer {\n+            if layout.value != layout::Pointer {\n                 unsafe { llvm::LLVMConstPtrToInt(llval, llty.to_ref()) }\n             } else {\n                 consts::bitcast(llval, llty)\n@@ -97,7 +97,7 @@ pub fn const_alloc_to_llvm(cx: &CodegenCx, alloc: &Allocation) -> ValueRef {\n         llvals.push(primval_to_llvm(\n             cx,\n             Scalar::Ptr(MemoryPointer { alloc_id, offset: Size::from_bytes(ptr_offset) }),\n-            &Scalar {\n+            &layout::Scalar {\n                 value: layout::Primitive::Pointer,\n                 valid_range: 0..=!0\n             },"}]}