{"sha": "2bfa72ea42493c3337737cd35c5cd366502031c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiZmE3MmVhNDI0OTNjMzMzNzczN2NkMzVjNWNkMzY2NTAyMDMxYzM=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-02T00:28:41Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-02T21:14:20Z"}, "message": "virtualize rustllvm construction per target triple", "tree": {"sha": "4a2de6934308739f4436bc462534bb037af2dbd5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a2de6934308739f4436bc462534bb037af2dbd5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2bfa72ea42493c3337737cd35c5cd366502031c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2bfa72ea42493c3337737cd35c5cd366502031c3", "html_url": "https://github.com/rust-lang/rust/commit/2bfa72ea42493c3337737cd35c5cd366502031c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2bfa72ea42493c3337737cd35c5cd366502031c3/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54af489e6f14fd1382c7b84c9cf85fecf91ba276", "url": "https://api.github.com/repos/rust-lang/rust/commits/54af489e6f14fd1382c7b84c9cf85fecf91ba276", "html_url": "https://github.com/rust-lang/rust/commit/54af489e6f14fd1382c7b84c9cf85fecf91ba276"}], "stats": {"total": 51, "additions": 32, "deletions": 19}, "files": [{"sha": "34861581283f30ca55c427b3699e7883ea4c361f", "filename": "configure", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2bfa72ea42493c3337737cd35c5cd366502031c3/configure", "raw_url": "https://github.com/rust-lang/rust/raw/2bfa72ea42493c3337737cd35c5cd366502031c3/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=2bfa72ea42493c3337737cd35c5cd366502031c3", "patch": "@@ -394,13 +394,19 @@ step_msg \"making directories\"\n for i in \\\n     doc doc/std \\\n     nd nd/std \\\n-    rustllvm dl \\\n+    dl \\\n     test/run-pass test/run-fail test/compile-fail \\\n     test/bench test/perf test/pretty\n do\n     make_dir $i\n done\n \n+make_dir rustllvm\n+for t in $CFG_TARGET_TRIPLES\n+do\n+    make_dir rustllvm/$t\n+done\n+\n make_dir rt\n for t in $CFG_TARGET_TRIPLES\n do"}, {"sha": "e5d30d5487b3932854b5d0d6e7baa7e0d7803459", "filename": "mk/rustllvm.mk", "status": "modified", "additions": 23, "deletions": 16, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/2bfa72ea42493c3337737cd35c5cd366502031c3/mk%2Frustllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/2bfa72ea42493c3337737cd35c5cd366502031c3/mk%2Frustllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frustllvm.mk?ref=2bfa72ea42493c3337737cd35c5cd366502031c3", "patch": "@@ -2,29 +2,36 @@\n # rustc LLVM-extensions (C++) library variables and rules\n ######################################################################\n \n-RUSTLLVM_OBJS_CS := $(addprefix rustllvm/, RustGCMetadataPrinter.cpp \\\n+define DEF_RUSTLLVM_TARGETS\n+\n+RUSTLLVM_OBJS_CS_$(1) := $$(addprefix rustllvm/, RustGCMetadataPrinter.cpp \\\n     RustGCStrategy.cpp RustWrapper.cpp)\n \n # Behind an ifdef for now since this requires a patched LLVM.\n ifdef CFG_STACK_GROWTH\n-RUSTLLVM_OBJS_CS += rustllvm/RustPrologHook.cpp\n+RUSTLLVM_OBJS_CS_$(1) += rustllvm/RustPrologHook.cpp\n endif\n \n-RUSTLLVM_DEF := rustllvm/rustllvm$(CFG_DEF_SUFFIX)\n+RUSTLLVM_DEF_$(1) := rustllvm/rustllvm$$(CFG_DEF_SUFFIX)\n+\n+RUSTLLVM_INCS_$(1) := -iquote $$(CFG_LLVM_INCDIR) \\\n+                      -iquote $$(S)src/rustllvm/include\n+RUSTLLVM_OBJS_OBJS_$(1) := $$(RUSTLLVM_OBJS_CS_$(1):rustllvm/%.cpp=rustllvm/$(1)/%.o)\n \n-RUSTLLVM_INCS := -iquote $(CFG_LLVM_INCDIR) \\\n-                 -iquote $(S)src/rustllvm/include\n-RUSTLLVM_OBJS_OBJS := $(RUSTLLVM_OBJS_CS:.cpp=.o)\n+rustllvm/$(1)/$(CFG_RUSTLLVM): $$(RUSTLLVM_OBJS_OBJS_$(1)) \\\n+                          $$(MKFILES) $$(RUSTLLVM_DEF_$(1))\n+\t@$$(call E, link: $$@)\n+\t$$(Q)$$(call CFG_LINK_C_$(1),$$@,$$(RUSTLLVM_OBJS_OBJS_$(1)) \\\n+\t  $$(CFG_GCCISH_PRE_LIB_FLAGS) $$(CFG_LLVM_LIBS) \\\n+          $$(CFG_GCCISH_POST_LIB_FLAGS) \\\n+          $$(CFG_LLVM_LDFLAGS),$$(RUSTLLVM_DEF_$(1)),$$(CFG_RUSTLLVM))\n \n-rustllvm/$(CFG_RUSTLLVM): $(RUSTLLVM_OBJS_OBJS) \\\n-                          $(MKFILES) $(RUSTLLVM_DEF)\n-\t@$(call E, link: $@)\n-\t$(Q)$(call CFG_LINK_C,$@,$(RUSTLLVM_OBJS_OBJS) \\\n-\t  $(CFG_GCCISH_PRE_LIB_FLAGS) $(CFG_LLVM_LIBS) \\\n-          $(CFG_GCCISH_POST_LIB_FLAGS) \\\n-          $(CFG_LLVM_LDFLAGS),$(RUSTLLVM_DEF),$(CFG_RUSTLLVM))\n+rustllvm/$(1)/%.o: rustllvm/%.cpp $$(MKFILES)\n+\t@$$(call E, compile: $$@)\n+\t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(CFG_LLVM_CXXFLAGS) $$(RUSTLLVM_INCS_$(1))) $$<\n \n-rustllvm/%.o: rustllvm/%.cpp $(MKFILES)\n-\t@$(call E, compile: $@)\n-\t$(Q)$(call CFG_COMPILE_C, $@, $(CFG_LLVM_CXXFLAGS) $(RUSTLLVM_INCS)) $<\n+endef\n \n+# Instantiate template for all stages\n+$(foreach target,$(CFG_TARGET_TRIPLES), \\\n+ $(eval $(call DEF_RUSTLLVM_TARGETS,$(target))))"}, {"sha": "0844db9e43314d3c733ce5e6b7f3715ab5fde93c", "filename": "mk/target.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2bfa72ea42493c3337737cd35c5cd366502031c3/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/2bfa72ea42493c3337737cd35c5cd366502031c3/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=2bfa72ea42493c3337737cd35c5cd366502031c3", "patch": "@@ -35,11 +35,11 @@ $$(TARGET_LIB$(1)$(2))/libstd.rlib: \\\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(1)_$(2)) --lib --static -o $$@ $$<\n \n-$$(TARGET_LIB$(1)$(2))/$$(CFG_RUNTIME): rt/$(2)/$(CFG_RUNTIME)\n+$$(TARGET_LIB$(1)$(2))/$$(CFG_RUNTIME): rt/$(2)/$$(CFG_RUNTIME)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TARGET_LIB$(1)$(2))/$$(CFG_RUSTLLVM): rustllvm/$$(CFG_RUSTLLVM)\n+$$(TARGET_LIB$(1)$(2))/$$(CFG_RUSTLLVM): rustllvm/$(2)/$$(CFG_RUSTLLVM)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n "}]}