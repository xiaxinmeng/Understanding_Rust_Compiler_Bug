{"sha": "e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5ZjZmM2YyY2NmNTYzYjM5Zjc0ODQwMjVjODI3MmRhNjBjMjRkZmE=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2013-08-22T21:00:02Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2013-08-23T21:24:14Z"}, "message": "Parse and reserve typeof keyword. #3228", "tree": {"sha": "42e2f6b59b1972cbfe75ec69d14aa97fbbb478a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/42e2f6b59b1972cbfe75ec69d14aa97fbbb478a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "html_url": "https://github.com/rust-lang/rust/commit/e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c0f9bd35493def5e23f0f43ddeba54da9d788b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c0f9bd35493def5e23f0f43ddeba54da9d788b4", "html_url": "https://github.com/rust-lang/rust/commit/2c0f9bd35493def5e23f0f43ddeba54da9d788b4"}], "stats": {"total": 47, "additions": 43, "deletions": 4}, "files": [{"sha": "b5e52939635977bede356378a109b735a6208807", "filename": "src/etc/vim/syntax/rust.vim", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -33,7 +33,7 @@ syn match     rustIdentifier  contains=rustIdentifierPrime \"\\%([^[:cntrl:][:spac\n syn match     rustFuncName    \"\\%([^[:cntrl:][:space:][:punct:][:digit:]]\\|_\\)\\%([^[:cntrl:][:punct:][:space:]]\\|_\\)*\" display contained\n \n \" reserved\n-syn keyword   rustKeyword     be\n+syn keyword   rustKeyword     be yield typeof\n \n syn keyword   rustType        int uint float char bool u8 u16 u32 u64 f32\n syn keyword   rustType        f64 i8 i16 i32 i64 str Self"}, {"sha": "62e46bdd23c8aa70ccaa3b1b3f65a4f1c2a7c160", "filename": "src/librustc/middle/typeck/astconv.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fastconv.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -504,6 +504,9 @@ pub fn ast_ty_to_ty<AC:AstConv, RS:region_scope + Clone + 'static>(\n           }\n         }\n       }\n+      ast::ty_typeof(_e) => {\n+          tcx.sess.span_bug(ast_ty.span, \"typeof is reserved but unimplemented\");\n+      }\n       ast::ty_infer => {\n         // ty_infer should only appear as the type of arguments or return\n         // values in a fn_expr, or as the type of local variables.  Both of"}, {"sha": "b0c324012929f0e9cb77a7ff55e8562f75fc0333", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -775,6 +775,7 @@ pub enum ty_ {\n     ty_tup(~[Ty]),\n     ty_path(Path, Option<OptVec<TyParamBound>>, NodeId), // for #7264; see above\n     ty_mac(mac),\n+    ty_typeof(@expr),\n     // ty_infer means the type should be inferred instead of it having been\n     // specified. This should only appear at the \"top level\" of a type and not\n     // nested in one."}, {"sha": "2b483c2c2a9638524081d789f9b97e2d776454c4", "filename": "src/libsyntax/fold.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffold.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -697,6 +697,7 @@ pub fn noop_fold_ty(t: &ty_, fld: @ast_fold) -> ty_ {\n                 fld.fold_expr(e)\n             )\n         }\n+        ty_typeof(e) => ty_typeof(fld.fold_expr(e)),\n         ty_mac(ref mac) => ty_mac(fold_mac(mac))\n     }\n }"}, {"sha": "8087efd5a8b00cf55a3307925409f12a44633d0c", "filename": "src/libsyntax/oldvisit.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Foldvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Foldvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Foldvisit.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -279,6 +279,9 @@ pub fn visit_ty<E:Clone>(t: &Ty, (e, v): (E, vt<E>)) {\n             (v.visit_ty)(mt.ty, (e.clone(), v));\n             (v.visit_expr)(ex, (e.clone(), v));\n         },\n+        ty_typeof(ex) => {\n+            (v.visit_expr)(ex, (e.clone(), v));\n+        }\n         ty_nil | ty_bot | ty_mac(_) | ty_infer => ()\n     }\n }"}, {"sha": "51213512a55056700805bde66959b0ea66bad919", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -51,7 +51,7 @@ use ast::{struct_variant_kind, subtract};\n use ast::{sty_box, sty_region, sty_static, sty_uniq, sty_value};\n use ast::{token_tree, trait_method, trait_ref, tt_delim, tt_seq, tt_tok};\n use ast::{tt_nonterminal, tuple_variant_kind, Ty, ty_, ty_bot, ty_box};\n-use ast::{TypeField, ty_fixed_length_vec, ty_closure, ty_bare_fn};\n+use ast::{TypeField, ty_fixed_length_vec, ty_closure, ty_bare_fn, ty_typeof};\n use ast::{ty_infer, TypeMethod};\n use ast::{ty_nil, TyParam, TyParamBound, ty_path, ty_ptr, ty_rptr};\n use ast::{ty_tup, ty_u32, ty_uniq, ty_vec, uniq};\n@@ -1105,6 +1105,13 @@ impl Parser {\n             let result = self.parse_ty_closure(ast::BorrowedSigil, None);\n             self.obsolete(*self.last_span, ObsoleteBareFnType);\n             result\n+        } else if self.eat_keyword(keywords::Typeof) {\n+            // TYPEOF\n+            // In order to not be ambiguous, the type must be surrounded by parens.\n+            self.expect(&token::LPAREN);\n+            let e = self.parse_expr();\n+            self.expect(&token::RPAREN);\n+            ty_typeof(e)\n         } else if *self.token == token::MOD_SEP\n             || is_ident_or_path(self.token) {\n             // NAMED TYPE"}, {"sha": "8128a4e905c16ff77e90bcfc4214bc34438bc1bd", "filename": "src/libsyntax/parse/token.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fparse%2Ftoken.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fparse%2Ftoken.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Ftoken.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -478,6 +478,7 @@ fn mk_fresh_ident_interner() -> @ident_interner {\n         \"be\",                 // 64\n         \"pure\",               // 65\n         \"yield\",              // 66\n+        \"typeof\",             // 67\n     ];\n \n     @ident_interner {\n@@ -595,6 +596,7 @@ pub mod keywords {\n         True,\n         Trait,\n         Type,\n+        Typeof,\n         Unsafe,\n         Use,\n         While,\n@@ -639,6 +641,7 @@ pub mod keywords {\n                 True => ident { name: 57, ctxt: 0 },\n                 Trait => ident { name: 58, ctxt: 0 },\n                 Type => ident { name: 59, ctxt: 0 },\n+                Typeof => ident { name: 67, ctxt: 0 },\n                 Unsafe => ident { name: 60, ctxt: 0 },\n                 Use => ident { name: 61, ctxt: 0 },\n                 While => ident { name: 62, ctxt: 0 },\n@@ -660,7 +663,7 @@ pub fn is_keyword(kw: keywords::Keyword, tok: &Token) -> bool {\n pub fn is_any_keyword(tok: &Token) -> bool {\n     match *tok {\n         token::IDENT(sid, false) => match sid.name {\n-            8 | 27 | 32 .. 66 => true,\n+            8 | 27 | 32 .. 67 => true,\n             _ => false,\n         },\n         _ => false\n@@ -680,7 +683,7 @@ pub fn is_strict_keyword(tok: &Token) -> bool {\n pub fn is_reserved_keyword(tok: &Token) -> bool {\n     match *tok {\n         token::IDENT(sid, false) => match sid.name {\n-            64 .. 66 => true,\n+            64 .. 67 => true,\n             _ => false,\n         },\n         _ => false,"}, {"sha": "f7714d4e8365a0573c18eb8c2e061eec4217497c", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -437,6 +437,11 @@ pub fn print_type(s: @ps, ty: &ast::Ty) {\n         print_expr(s, v);\n         word(s.s, \"]\");\n       }\n+      ast::ty_typeof(e) => {\n+          word(s.s, \"typeof(\");\n+          print_expr(s, e);\n+          word(s.s, \")\");\n+      }\n       ast::ty_mac(_) => {\n           fail!(\"print_type doesn't know how to print a ty_mac\");\n       }"}, {"sha": "b78bf41bc30f6027f6db2f6dae4fef369be32c0b", "filename": "src/libsyntax/visit.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Flibsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fvisit.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -314,6 +314,9 @@ pub fn walk_ty<E:Clone, V:Visitor<E>>(visitor: &mut V, typ: &Ty, env: E) {\n             visitor.visit_ty(mutable_type.ty, env.clone());\n             visitor.visit_expr(expression, env)\n         }\n+        ty_typeof(expression) => {\n+            visitor.visit_expr(expression, env)\n+        }\n         ty_nil | ty_bot | ty_mac(_) | ty_infer => ()\n     }\n }"}, {"sha": "c42875382b98d088af5804a1cec90293b3b4e4f8", "filename": "src/test/compile-fail/keyword-typeof.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Ftest%2Fcompile-fail%2Fkeyword-typeof.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9f6f3f2ccf563b39f7484025c8272da60c24dfa/src%2Ftest%2Fcompile-fail%2Fkeyword-typeof.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fkeyword-typeof.rs?ref=e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let typeof = (); //~ ERROR `typeof` is a reserved keyword\n+}"}]}