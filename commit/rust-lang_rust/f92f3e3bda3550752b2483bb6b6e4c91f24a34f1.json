{"sha": "f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5MmYzZTNiZGEzNTUwNzUyYjI0ODNiYjZiNmU0YzkxZjI0YTM0ZjE=", "commit": {"author": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-01-27T05:33:03Z"}, "committer": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-01-27T05:38:57Z"}, "message": "add the version gate to the code and test", "tree": {"sha": "befc875e446147746eb24aedbaa356d0bb366730", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/befc875e446147746eb24aedbaa356d0bb366730"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "html_url": "https://github.com/rust-lang/rust/commit/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/comments", "author": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b996542cc2677523570d0c64daf9c7f1601155f", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b996542cc2677523570d0c64daf9c7f1601155f", "html_url": "https://github.com/rust-lang/rust/commit/7b996542cc2677523570d0c64daf9c7f1601155f"}], "stats": {"total": 105, "additions": 96, "deletions": 9}, "files": [{"sha": "a2bf023a33eb475c2f37780bdd6914a7341c289a", "filename": "src/items.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -24,7 +24,7 @@ use comment::{\n     combine_strs_with_missing_comments, contains_comment, recover_comment_removed,\n     recover_missing_comment_in_span, rewrite_missing_comment, FindUncommented,\n };\n-use config::{BraceStyle, Config, Density, IndentStyle};\n+use config::{BraceStyle, Config, Density, IndentStyle, Version};\n use expr::{\n     format_expr, is_empty_block, is_simple_block_stmt, rewrite_assign_rhs, rewrite_assign_rhs_with,\n     ExprType, RhsTactics,\n@@ -2085,11 +2085,18 @@ fn rewrite_fn_base(\n             .lines()\n             .last()\n             .map_or(false, |last_line| last_line.contains(\"//\"));\n-        result.push(')');\n \n-        if closing_paren_overflow_max_width || args_last_line_contains_comment {\n-            result.push_str(&indent.to_string_with_newline(context.config));\n-            no_args_and_over_max_width = true;\n+        if context.config.version() == Version::Two {\n+            result.push(')');\n+            if closing_paren_overflow_max_width || args_last_line_contains_comment {\n+                result.push_str(&indent.to_string_with_newline(context.config));\n+                no_args_and_over_max_width = true;\n+            }\n+        } else {\n+            if closing_paren_overflow_max_width || args_last_line_contains_comment {\n+                result.push_str(&indent.to_string_with_newline(context.config));\n+            }\n+            result.push(')');\n         }\n     }\n \n@@ -2130,9 +2137,14 @@ fn rewrite_fn_base(\n             result.push_str(&indent.to_string_with_newline(context.config));\n             indent\n         } else {\n-            if arg_str.len() != 0 || !no_args_and_over_max_width {\n+            if context.config.version() == Version::Two {\n+                if arg_str.len() != 0 || !no_args_and_over_max_width {\n+                    result.push(' ');\n+                }\n+            } else {\n                 result.push(' ');\n             }\n+\n             Indent::new(indent.block_indent, last_line_width(&result))\n         };\n "}, {"sha": "f86caafc54121ad36341790d835a073e31d0f210", "filename": "tests/source/issue-3278.rs", "status": "removed", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7b996542cc2677523570d0c64daf9c7f1601155f/tests%2Fsource%2Fissue-3278.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b996542cc2677523570d0c64daf9c7f1601155f/tests%2Fsource%2Fissue-3278.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3278.rs?ref=7b996542cc2677523570d0c64daf9c7f1601155f", "patch": "@@ -1,3 +0,0 @@\n-pub fn parse_conditional<'a, I: 'a>() -> impl Parser<Input = I, Output = Expr, PartialState = ()> + 'a\n-where I: Stream<Item = char>\n-{}\n\\ No newline at end of file"}, {"sha": "580679fbae34b07782ac1408f1ff287afbdce851", "filename": "tests/source/issue-3278/version_one.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Fissue-3278%2Fversion_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Fissue-3278%2Fversion_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3278%2Fversion_one.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -0,0 +1,8 @@\n+// rustfmt-version: One\n+\n+pub fn parse_conditional<'a, I: 'a>(\n+) -> impl Parser<Input = I, Output = Expr, PartialState = ()> + 'a\n+where\n+    I: Stream<Item = char>,\n+{\n+}"}, {"sha": "c17b1742d396b8c00693a65a2764f2f68ed5a0d6", "filename": "tests/source/issue-3278/version_two.rs", "status": "renamed", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Fissue-3278%2Fversion_two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Fissue-3278%2Fversion_two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3278%2Fversion_two.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -1,3 +1,5 @@\n+// rustfmt-version: Two\n+\n pub fn parse_conditional<'a, I: 'a>()\n -> impl Parser<Input = I, Output = Expr, PartialState = ()> + 'a\n where", "previous_filename": "tests/target/issue-3278.rs"}, {"sha": "d6832c2af09548307ef9f1f49c1894983ef216c4", "filename": "tests/source/long-fn-1/version_one.rs", "status": "renamed", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Flong-fn-1%2Fversion_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Flong-fn-1%2Fversion_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Flong-fn-1%2Fversion_one.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -1,3 +1,4 @@\n+// rustfmt-version: One\n // Tests that a function which is almost short enough, but not quite, gets\n // formatted correctly.\n ", "previous_filename": "tests/source/long-fn-1.rs"}, {"sha": "f402a26e8b6a80597323a31bfdd40a0c51c89467", "filename": "tests/source/long-fn-1/version_two.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Flong-fn-1%2Fversion_two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Fsource%2Flong-fn-1%2Fversion_two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Flong-fn-1%2Fversion_two.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -0,0 +1,21 @@\n+// rustfmt-version: Two\n+// Tests that a function which is almost short enough, but not quite, gets\n+// formatted correctly.\n+\n+impl Foo {\n+    fn some_input(&mut self, input: Input, input_path: Option<PathBuf>, ) -> (Input, Option<PathBuf>) {}\n+\n+    fn some_inpu(&mut self, input: Input, input_path: Option<PathBuf>) -> (Input, Option<PathBuf>) {}\n+}\n+\n+// #1843\n+#[allow(non_snake_case)]\n+pub extern \"C\" fn Java_com_exonum_binding_storage_indices_ValueSetIndexProxy_nativeContainsByHash() -> bool {\n+    false\n+}\n+\n+// #3009\n+impl Something {\n+    fn my_function_name_is_way_to_long_but_used_as_a_case_study_or_an_example_its_fine(\n+) -> Result<  (), String  > {}\n+}"}, {"sha": "580679fbae34b07782ac1408f1ff287afbdce851", "filename": "tests/target/issue-3278/version_one.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Fissue-3278%2Fversion_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Fissue-3278%2Fversion_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3278%2Fversion_one.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -0,0 +1,8 @@\n+// rustfmt-version: One\n+\n+pub fn parse_conditional<'a, I: 'a>(\n+) -> impl Parser<Input = I, Output = Expr, PartialState = ()> + 'a\n+where\n+    I: Stream<Item = char>,\n+{\n+}"}, {"sha": "c17b1742d396b8c00693a65a2764f2f68ed5a0d6", "filename": "tests/target/issue-3278/version_two.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Fissue-3278%2Fversion_two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Fissue-3278%2Fversion_two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3278%2Fversion_two.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -0,0 +1,8 @@\n+// rustfmt-version: Two\n+\n+pub fn parse_conditional<'a, I: 'a>()\n+-> impl Parser<Input = I, Output = Expr, PartialState = ()> + 'a\n+where\n+    I: Stream<Item = char>,\n+{\n+}"}, {"sha": "05f69953c26d788c25637b4695a9aaa186522e9e", "filename": "tests/target/long-fn-1/version_one.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Flong-fn-1%2Fversion_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Flong-fn-1%2Fversion_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Flong-fn-1%2Fversion_one.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -0,0 +1,29 @@\n+// rustfmt-version: One\n+// Tests that a function which is almost short enough, but not quite, gets\n+// formatted correctly.\n+\n+impl Foo {\n+    fn some_input(\n+        &mut self,\n+        input: Input,\n+        input_path: Option<PathBuf>,\n+    ) -> (Input, Option<PathBuf>) {\n+    }\n+\n+    fn some_inpu(&mut self, input: Input, input_path: Option<PathBuf>) -> (Input, Option<PathBuf>) {\n+    }\n+}\n+\n+// #1843\n+#[allow(non_snake_case)]\n+pub extern \"C\" fn Java_com_exonum_binding_storage_indices_ValueSetIndexProxy_nativeContainsByHash(\n+) -> bool {\n+    false\n+}\n+\n+// #3009\n+impl Something {\n+    fn my_function_name_is_way_to_long_but_used_as_a_case_study_or_an_example_its_fine(\n+    ) -> Result<(), String> {\n+    }\n+}"}, {"sha": "32794bccde2e823ccc8318f2aa85a1af47a4dbee", "filename": "tests/target/long-fn-1/version_two.rs", "status": "renamed", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Flong-fn-1%2Fversion_two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f92f3e3bda3550752b2483bb6b6e4c91f24a34f1/tests%2Ftarget%2Flong-fn-1%2Fversion_two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Flong-fn-1%2Fversion_two.rs?ref=f92f3e3bda3550752b2483bb6b6e4c91f24a34f1", "patch": "@@ -1,3 +1,4 @@\n+// rustfmt-version: Two\n // Tests that a function which is almost short enough, but not quite, gets\n // formatted correctly.\n ", "previous_filename": "tests/target/long-fn-1.rs"}]}