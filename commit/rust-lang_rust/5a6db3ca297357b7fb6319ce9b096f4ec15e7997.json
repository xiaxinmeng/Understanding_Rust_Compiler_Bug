{"sha": "5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhNmRiM2NhMjk3MzU3YjdmYjYzMTljZTliMDk2ZjRlYzE1ZTc5OTc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-10-28T12:36:38Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-10-28T12:41:34Z"}, "message": "fix parsing of for loops inside expressions\n\ncloses #2051", "tree": {"sha": "6ff282a66cd3e95531f56a295a26793c681c694a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ff282a66cd3e95531f56a295a26793c681c694a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "html_url": "https://github.com/rust-lang/rust/commit/5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02828520a75f686d044cb9767572ea49e93c4828", "url": "https://api.github.com/repos/rust-lang/rust/commits/02828520a75f686d044cb9767572ea49e93c4828", "html_url": "https://github.com/rust-lang/rust/commit/02828520a75f686d044cb9767572ea49e93c4828"}], "stats": {"total": 200, "additions": 151, "deletions": 49}, "files": [{"sha": "4952bd1891b5f85aaaaef642049afa427fad3a27", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "patch": "@@ -56,7 +56,8 @@ pub(super) const ATOM_EXPR_FIRST: TokenSet =\n         LIFETIME,\n         ASYNC_KW,\n         TRY_KW,\n-        LOOP_KW\n+        LOOP_KW,\n+        FOR_KW,\n     ]);\n \n const EXPR_RECOVERY_SET: TokenSet = token_set![LET_KW];"}, {"sha": "0a93e11a53217f4d5a14fc4bbb4bd6fb59ca6cb7", "filename": "crates/ra_syntax/test_data/parser/err/0024_many_type_parens.txt", "status": "modified", "additions": 43, "deletions": 48, "changes": 91, "blob_url": "https://github.com/rust-lang/rust/blob/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.txt?ref=5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "patch": "@@ -179,50 +179,47 @@ SOURCE_FILE@[0; 240)\n           ERROR@[148; 149)\n             PLUS@[148; 149) \"+\"\n         WHITESPACE@[149; 150) \" \"\n-        EXPR_STMT@[150; 151)\n-          PAREN_EXPR@[150; 151)\n+        EXPR_STMT@[150; 180)\n+          TUPLE_EXPR@[150; 180)\n             L_PAREN@[150; 151) \"(\"\n-        EXPR_STMT@[151; 157)\n-          FOR_EXPR@[151; 157)\n-            FOR_KW@[151; 154) \"for\"\n-            ERROR@[154; 155)\n-              L_ANGLE@[154; 155) \"<\"\n-            ERROR@[155; 157)\n-              LIFETIME@[155; 157) \"\\'a\"\n-        EXPR_STMT@[157; 158)\n-          ERROR@[157; 158)\n-            R_ANGLE@[157; 158) \">\"\n-        WHITESPACE@[158; 159) \" \"\n-        EXPR_STMT@[159; 180)\n-          BIN_EXPR@[159; 180)\n-            BIN_EXPR@[159; 178)\n-              BIN_EXPR@[159; 169)\n-                BIN_EXPR@[159; 167)\n-                  PATH_EXPR@[159; 164)\n-                    PATH@[159; 164)\n-                      PATH_SEGMENT@[159; 164)\n-                        NAME_REF@[159; 164)\n-                          IDENT@[159; 164) \"Trait\"\n-                  L_ANGLE@[164; 165) \"<\"\n-                  ERROR@[165; 167)\n-                    LIFETIME@[165; 167) \"\\'a\"\n-                R_ANGLE@[167; 168) \">\"\n-                ERROR@[168; 169)\n-                  R_PAREN@[168; 169) \")\"\n-              WHITESPACE@[169; 170) \" \"\n-              PLUS@[170; 171) \"+\"\n-              WHITESPACE@[171; 172) \" \"\n-              PAREN_EXPR@[172; 178)\n-                L_PAREN@[172; 173) \"(\"\n-                PATH_EXPR@[173; 177)\n-                  PATH@[173; 177)\n-                    PATH_SEGMENT@[173; 177)\n-                      NAME_REF@[173; 177)\n-                        IDENT@[173; 177) \"Copy\"\n-                R_PAREN@[177; 178) \")\"\n-            R_ANGLE@[178; 179) \">\"\n-            ERROR@[179; 180)\n-              SEMI@[179; 180) \";\"\n+            BIN_EXPR@[151; 180)\n+              BIN_EXPR@[151; 178)\n+                BIN_EXPR@[151; 169)\n+                  BIN_EXPR@[151; 167)\n+                    BIN_EXPR@[151; 164)\n+                      FOR_EXPR@[151; 157)\n+                        FOR_KW@[151; 154) \"for\"\n+                        ERROR@[154; 155)\n+                          L_ANGLE@[154; 155) \"<\"\n+                        ERROR@[155; 157)\n+                          LIFETIME@[155; 157) \"\\'a\"\n+                      R_ANGLE@[157; 158) \">\"\n+                      WHITESPACE@[158; 159) \" \"\n+                      PATH_EXPR@[159; 164)\n+                        PATH@[159; 164)\n+                          PATH_SEGMENT@[159; 164)\n+                            NAME_REF@[159; 164)\n+                              IDENT@[159; 164) \"Trait\"\n+                    L_ANGLE@[164; 165) \"<\"\n+                    ERROR@[165; 167)\n+                      LIFETIME@[165; 167) \"\\'a\"\n+                  R_ANGLE@[167; 168) \">\"\n+                  ERROR@[168; 169)\n+                    R_PAREN@[168; 169) \")\"\n+                WHITESPACE@[169; 170) \" \"\n+                PLUS@[170; 171) \"+\"\n+                WHITESPACE@[171; 172) \" \"\n+                PAREN_EXPR@[172; 178)\n+                  L_PAREN@[172; 173) \"(\"\n+                  PATH_EXPR@[173; 177)\n+                    PATH@[173; 177)\n+                      PATH_SEGMENT@[173; 177)\n+                        NAME_REF@[173; 177)\n+                          IDENT@[173; 177) \"Copy\"\n+                  R_PAREN@[177; 178) \")\"\n+              R_ANGLE@[178; 179) \">\"\n+              ERROR@[179; 180)\n+                SEMI@[179; 180) \";\"\n         WHITESPACE@[180; 185) \"\\n    \"\n         LET_STMT@[185; 235)\n           LET_KW@[185; 188) \"let\"\n@@ -307,18 +304,16 @@ error 146: expected expression\n error 147: expected SEMI\n error 148: expected expression\n error 149: expected SEMI\n-error 151: expected expression\n-error 151: expected R_PAREN\n-error 151: expected SEMI\n error 154: expected pattern\n error 155: expected IN_KW\n error 155: expected expression\n error 157: expected a block\n-error 157: expected expression\n-error 158: expected SEMI\n error 165: expected expression\n error 168: expected expression\n error 179: expected expression\n+error 180: expected COMMA\n+error 180: expected expression\n+error 180: expected R_PAREN\n error 180: expected SEMI\n error 215: expected COMMA\n error 215: expected R_ANGLE"}, {"sha": "6e8b718aaf9a09dd576886be6ac035234dce2095", "filename": "crates/ra_syntax/test_data/parser/ok/0059_loops_in_parens.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.rs?ref=5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    Some(for _ in [1].into_iter() {});\n+    Some(loop { break; });\n+    Some(while true {});\n+}"}, {"sha": "c011187ead5e76630d0663df2da536d701cb2611", "filename": "crates/ra_syntax/test_data/parser/ok/0059_loops_in_parens.txt", "status": "added", "additions": 101, "deletions": 0, "changes": 101, "blob_url": "https://github.com/rust-lang/rust/blob/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5a6db3ca297357b7fb6319ce9b096f4ec15e7997/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0059_loops_in_parens.txt?ref=5a6db3ca297357b7fb6319ce9b096f4ec15e7997", "patch": "@@ -0,0 +1,101 @@\n+SOURCE_FILE@[0; 105)\n+  FN_DEF@[0; 104)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 7)\n+      IDENT@[3; 7) \"main\"\n+    PARAM_LIST@[7; 9)\n+      L_PAREN@[7; 8) \"(\"\n+      R_PAREN@[8; 9) \")\"\n+    WHITESPACE@[9; 10) \" \"\n+    BLOCK_EXPR@[10; 104)\n+      BLOCK@[10; 104)\n+        L_CURLY@[10; 11) \"{\"\n+        WHITESPACE@[11; 16) \"\\n    \"\n+        EXPR_STMT@[16; 50)\n+          CALL_EXPR@[16; 49)\n+            PATH_EXPR@[16; 20)\n+              PATH@[16; 20)\n+                PATH_SEGMENT@[16; 20)\n+                  NAME_REF@[16; 20)\n+                    IDENT@[16; 20) \"Some\"\n+            ARG_LIST@[20; 49)\n+              L_PAREN@[20; 21) \"(\"\n+              FOR_EXPR@[21; 48)\n+                FOR_KW@[21; 24) \"for\"\n+                WHITESPACE@[24; 25) \" \"\n+                PLACEHOLDER_PAT@[25; 26)\n+                  UNDERSCORE@[25; 26) \"_\"\n+                WHITESPACE@[26; 27) \" \"\n+                IN_KW@[27; 29) \"in\"\n+                WHITESPACE@[29; 30) \" \"\n+                METHOD_CALL_EXPR@[30; 45)\n+                  ARRAY_EXPR@[30; 33)\n+                    L_BRACK@[30; 31) \"[\"\n+                    LITERAL@[31; 32)\n+                      INT_NUMBER@[31; 32) \"1\"\n+                    R_BRACK@[32; 33) \"]\"\n+                  DOT@[33; 34) \".\"\n+                  NAME_REF@[34; 43)\n+                    IDENT@[34; 43) \"into_iter\"\n+                  ARG_LIST@[43; 45)\n+                    L_PAREN@[43; 44) \"(\"\n+                    R_PAREN@[44; 45) \")\"\n+                WHITESPACE@[45; 46) \" \"\n+                BLOCK_EXPR@[46; 48)\n+                  BLOCK@[46; 48)\n+                    L_CURLY@[46; 47) \"{\"\n+                    R_CURLY@[47; 48) \"}\"\n+              R_PAREN@[48; 49) \")\"\n+          SEMI@[49; 50) \";\"\n+        WHITESPACE@[50; 55) \"\\n    \"\n+        EXPR_STMT@[55; 77)\n+          CALL_EXPR@[55; 76)\n+            PATH_EXPR@[55; 59)\n+              PATH@[55; 59)\n+                PATH_SEGMENT@[55; 59)\n+                  NAME_REF@[55; 59)\n+                    IDENT@[55; 59) \"Some\"\n+            ARG_LIST@[59; 76)\n+              L_PAREN@[59; 60) \"(\"\n+              LOOP_EXPR@[60; 75)\n+                LOOP_KW@[60; 64) \"loop\"\n+                WHITESPACE@[64; 65) \" \"\n+                BLOCK_EXPR@[65; 75)\n+                  BLOCK@[65; 75)\n+                    L_CURLY@[65; 66) \"{\"\n+                    WHITESPACE@[66; 67) \" \"\n+                    EXPR_STMT@[67; 73)\n+                      BREAK_EXPR@[67; 72)\n+                        BREAK_KW@[67; 72) \"break\"\n+                      SEMI@[72; 73) \";\"\n+                    WHITESPACE@[73; 74) \" \"\n+                    R_CURLY@[74; 75) \"}\"\n+              R_PAREN@[75; 76) \")\"\n+          SEMI@[76; 77) \";\"\n+        WHITESPACE@[77; 82) \"\\n    \"\n+        EXPR_STMT@[82; 102)\n+          CALL_EXPR@[82; 101)\n+            PATH_EXPR@[82; 86)\n+              PATH@[82; 86)\n+                PATH_SEGMENT@[82; 86)\n+                  NAME_REF@[82; 86)\n+                    IDENT@[82; 86) \"Some\"\n+            ARG_LIST@[86; 101)\n+              L_PAREN@[86; 87) \"(\"\n+              WHILE_EXPR@[87; 100)\n+                WHILE_KW@[87; 92) \"while\"\n+                WHITESPACE@[92; 93) \" \"\n+                CONDITION@[93; 97)\n+                  LITERAL@[93; 97)\n+                    TRUE_KW@[93; 97) \"true\"\n+                WHITESPACE@[97; 98) \" \"\n+                BLOCK_EXPR@[98; 100)\n+                  BLOCK@[98; 100)\n+                    L_CURLY@[98; 99) \"{\"\n+                    R_CURLY@[99; 100) \"}\"\n+              R_PAREN@[100; 101) \")\"\n+          SEMI@[101; 102) \";\"\n+        WHITESPACE@[102; 103) \"\\n\"\n+        R_CURLY@[103; 104) \"}\"\n+  WHITESPACE@[104; 105) \"\\n\""}]}