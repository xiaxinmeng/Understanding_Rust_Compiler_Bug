{"sha": "9dc82face341121e3464a59665bc7c5b394cacc0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkYzgyZmFjZTM0MTEyMWUzNDY0YTU5NjY1YmM3YzViMzk0Y2FjYzA=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-09T23:01:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-09T23:01:37Z"}, "message": "Rollup merge of #82942 - m-ou-se:diagnostics-hardcoded-prelude-v1, r=estebank\n\nDon't hardcode the `v1` prelude in diagnostics, to allow for new preludes.\n\nInstead of looking for `std::prelude::v1`, this changes the two places where that was hardcoded to look for `std::prelude::<anything>` instead.\n\nThis is needed for https://github.com/rust-lang/rust/pull/82217.\n\nr? `@estebank`", "tree": {"sha": "fd570f707b6a801d7f1e7fd6b72fc983184daa04", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd570f707b6a801d7f1e7fd6b72fc983184daa04"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9dc82face341121e3464a59665bc7c5b394cacc0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgR/5RCRBK7hj4Ov3rIwAAdHIIAAZcST/lqTnYlmny/Sviumho\nRjLKYe+yW5JtUUkTZyOo6xMgIuDS+bx/8/4nFsouJFdDAGLbYJtzGOZoE9nSvF4k\nWvaa9+24DROL6MiGigq88oiJ1xYG1+mN010SErWkvAM0zf8nZeTKDkF4OyfGV06d\nVDq3TEjRyzbr8CbGKWzhMC+Xz3f7+6kioy9qGu75oNJ6Ri7rigtjC8w5+KxeWxPt\noX9R7zKJp+yfb2/VQEd0uRBuvIJh+BZSicMEdWLa+VGbIIcbxUkIeBio6UQQ90AV\nyHbIb0XMEleHPqU8TjIiJsEPdoG3teVVMPanoyvlQ8ZgxVtb3/tCArPmc3cNbH8=\n=4iyL\n-----END PGP SIGNATURE-----\n", "payload": "tree fd570f707b6a801d7f1e7fd6b72fc983184daa04\nparent 56b5393cc2cc0ac5769b00dbccbd34dc9202dd67\nparent 1e4d8042fc98dd07546a0eb201517983e82f4235\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1615330897 +0900\ncommitter GitHub <noreply@github.com> 1615330897 +0900\n\nRollup merge of #82942 - m-ou-se:diagnostics-hardcoded-prelude-v1, r=estebank\n\nDon't hardcode the `v1` prelude in diagnostics, to allow for new preludes.\n\nInstead of looking for `std::prelude::v1`, this changes the two places where that was hardcoded to look for `std::prelude::<anything>` instead.\n\nThis is needed for https://github.com/rust-lang/rust/pull/82217.\n\nr? `@estebank`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9dc82face341121e3464a59665bc7c5b394cacc0", "html_url": "https://github.com/rust-lang/rust/commit/9dc82face341121e3464a59665bc7c5b394cacc0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9dc82face341121e3464a59665bc7c5b394cacc0/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "56b5393cc2cc0ac5769b00dbccbd34dc9202dd67", "url": "https://api.github.com/repos/rust-lang/rust/commits/56b5393cc2cc0ac5769b00dbccbd34dc9202dd67", "html_url": "https://github.com/rust-lang/rust/commit/56b5393cc2cc0ac5769b00dbccbd34dc9202dd67"}, {"sha": "1e4d8042fc98dd07546a0eb201517983e82f4235", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e4d8042fc98dd07546a0eb201517983e82f4235", "html_url": "https://github.com/rust-lang/rust/commit/1e4d8042fc98dd07546a0eb201517983e82f4235"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "e7b3d45976611ff5dfee7834c6eece780f2133df", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9dc82face341121e3464a59665bc7c5b394cacc0/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9dc82face341121e3464a59665bc7c5b394cacc0/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=9dc82face341121e3464a59665bc7c5b394cacc0", "patch": "@@ -334,7 +334,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                 .lookup_import_candidates(ident, ns, &self.parent_scope, is_enum_variant)\n                 .into_iter()\n                 .map(|suggestion| import_candidate_to_enum_paths(&suggestion))\n-                .filter(|(_, enum_ty_path)| enum_ty_path != \"std::prelude::v1\")\n+                .filter(|(_, enum_ty_path)| !enum_ty_path.starts_with(\"std::prelude::\"))\n                 .collect();\n             if !enum_candidates.is_empty() {\n                 if let (PathSource::Type, Some(span)) ="}, {"sha": "f9f67769e96a41d475960d1493492354c9626eeb", "filename": "compiler/rustc_typeck/src/check/demand.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9dc82face341121e3464a59665bc7c5b394cacc0/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9dc82face341121e3464a59665bc7c5b394cacc0/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs?ref=9dc82face341121e3464a59665bc7c5b394cacc0", "patch": "@@ -200,7 +200,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     if self.can_coerce(expr_ty, sole_field_ty) {\n                         let variant_path = self.tcx.def_path_str(variant.def_id);\n                         // FIXME #56861: DRYer prelude filtering\n-                        Some(variant_path.trim_start_matches(\"std::prelude::v1::\").to_string())\n+                        if let Some(path) = variant_path.strip_prefix(\"std::prelude::\") {\n+                            if let Some((_, path)) = path.split_once(\"::\") {\n+                                return Some(path.to_string());\n+                            }\n+                        }\n+                        Some(variant_path)\n                     } else {\n                         None\n                     }"}]}