{"sha": "09ed9d044495971c143dc8c9879dd92d3989976f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5ZWQ5ZDA0NDQ5NTk3MWMxNDNkYzhjOTg3OWRkOTJkMzk4OTk3NmY=", "commit": {"author": {"name": "ShuiRuTian", "email": "158983297@qq.com", "date": "2021-01-10T06:10:36Z"}, "committer": {"name": "ShuiRuTian", "email": "158983297@qq.com", "date": "2021-01-10T06:10:36Z"}, "message": "fix issue.", "tree": {"sha": "1cca70c65dbadc2e1d747c67a8557a94f143d3de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1cca70c65dbadc2e1d747c67a8557a94f143d3de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09ed9d044495971c143dc8c9879dd92d3989976f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09ed9d044495971c143dc8c9879dd92d3989976f", "html_url": "https://github.com/rust-lang/rust/commit/09ed9d044495971c143dc8c9879dd92d3989976f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09ed9d044495971c143dc8c9879dd92d3989976f/comments", "author": {"login": "ShuiRuTian", "id": 28779355, "node_id": "MDQ6VXNlcjI4Nzc5MzU1", "avatar_url": "https://avatars.githubusercontent.com/u/28779355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShuiRuTian", "html_url": "https://github.com/ShuiRuTian", "followers_url": "https://api.github.com/users/ShuiRuTian/followers", "following_url": "https://api.github.com/users/ShuiRuTian/following{/other_user}", "gists_url": "https://api.github.com/users/ShuiRuTian/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShuiRuTian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShuiRuTian/subscriptions", "organizations_url": "https://api.github.com/users/ShuiRuTian/orgs", "repos_url": "https://api.github.com/users/ShuiRuTian/repos", "events_url": "https://api.github.com/users/ShuiRuTian/events{/privacy}", "received_events_url": "https://api.github.com/users/ShuiRuTian/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ShuiRuTian", "id": 28779355, "node_id": "MDQ6VXNlcjI4Nzc5MzU1", "avatar_url": "https://avatars.githubusercontent.com/u/28779355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShuiRuTian", "html_url": "https://github.com/ShuiRuTian", "followers_url": "https://api.github.com/users/ShuiRuTian/followers", "following_url": "https://api.github.com/users/ShuiRuTian/following{/other_user}", "gists_url": "https://api.github.com/users/ShuiRuTian/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShuiRuTian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShuiRuTian/subscriptions", "organizations_url": "https://api.github.com/users/ShuiRuTian/orgs", "repos_url": "https://api.github.com/users/ShuiRuTian/repos", "events_url": "https://api.github.com/users/ShuiRuTian/events{/privacy}", "received_events_url": "https://api.github.com/users/ShuiRuTian/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64240a44bec83da2a51a887aac3520110977a7e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/64240a44bec83da2a51a887aac3520110977a7e1", "html_url": "https://github.com/rust-lang/rust/commit/64240a44bec83da2a51a887aac3520110977a7e1"}], "stats": {"total": 35, "additions": 21, "deletions": 14}, "files": [{"sha": "48060819668708b415c03d11533db5f53de9a70a", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/09ed9d044495971c143dc8c9879dd92d3989976f/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ed9d044495971c143dc8c9879dd92d3989976f/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=09ed9d044495971c143dc8c9879dd92d3989976f", "patch": "@@ -435,22 +435,22 @@ pub(crate) fn handle_will_rename_files(\n                     if from_path.is_dir() {\n                         // This is a quick implement, try to use will_rename_file code.\n                         // imitate change the older_folder/mod.rs to older_folder/new_folder.rs\n-                        let imitate_from_path = from_path.join(\"mod.rs\");\n-                        let new_from_url = imitate_from_path.to_str()?;\n-                        let new_from_url = Url::parse(new_from_url).ok()?;\n-\n-                        let new_folder_name = to_path.file_name()?.to_str()?;\n-                        let mut imite_new_file_name  = new_folder_name.to_string();\n-                        imite_new_file_name.push_str(\".rs\");\n-                        let new_to = from_path.join(imite_new_file_name);\n-                        let new_to = new_to.to_str()?;\n-\n-                        Some((snap.url_to_file_id(&new_from_url).ok()?, new_to.to_string()))\n-                    }\n-                    else{\n+                        let imitate_from_url = from.join(\"mod.rs\").ok()?;\n+                        let imite_new_file_name = to_path.file_name()?.to_str()?;\n+                        Some((\n+                            snap.url_to_file_id(&imitate_from_url).ok()?,\n+                            imite_new_file_name.to_string(),\n+                        ))\n+                    } else {\n+                        let old_name = from_path.file_stem()?;\n+                        let old_name = old_name.to_str()?;\n                         let new_name = to_path.file_stem()?;\n                         let new_name = new_name.to_str()?;\n-                        Some((snap.url_to_file_id(&from).ok()?, new_name.to_string()))\n+                        if old_name != \"mod\" || new_name != \"mod\" {\n+                            Some((snap.url_to_file_id(&from).ok()?, new_name.to_string()))\n+                        } else {\n+                            None\n+                        }\n                     }\n                 }\n                 _ => None,"}, {"sha": "fb8cd4873ce1379ba11cbe531dc00a0eaf9bbe88", "filename": "editors/code/src/client.ts", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/09ed9d044495971c143dc8c9879dd92d3989976f/editors%2Fcode%2Fsrc%2Fclient.ts", "raw_url": "https://github.com/rust-lang/rust/raw/09ed9d044495971c143dc8c9879dd92d3989976f/editors%2Fcode%2Fsrc%2Fclient.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fclient.ts?ref=09ed9d044495971c143dc8c9879dd92d3989976f", "patch": "@@ -58,6 +58,13 @@ export function createClient(serverPath: string, cwd: string, extraEnv: Env): lc\n             // 2. filter some change in here.\n             //     2.1 rename from or to `mod.rs` should be special. \n             //     2.2 not all folder change should be cared, only those have files with \".rs\" postfix.\n+            let newFiles =  data.files.map((file)=>{\n+                const isFolder = !file.oldUri.path.endsWith(\".rs\");\n+                return !isFolder ? file : {\n+                    oldUri:vscode.Uri.file(file.oldUri.path+'/'),\n+                    newUri:vscode.Uri.file(file.newUri.path+'/')\n+                }});\n+            data = {...data, files:newFiles};\n             return next(data);\n         }\n     }"}]}