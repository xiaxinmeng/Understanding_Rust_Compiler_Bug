{"sha": "6bf1aa6ff2f8b401ed93f41bb248389c95458112", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiZjFhYTZmZjJmOGI0MDFlZDkzZjQxYmIyNDgzODljOTU0NTgxMTI=", "commit": {"author": {"name": "Alexander Regueiro", "email": "alexreg@me.com", "date": "2018-09-27T01:32:55Z"}, "committer": {"name": "Alexander Regueiro", "email": "alexreg@me.com", "date": "2018-09-27T03:19:31Z"}, "message": "Added help message for feature gate.", "tree": {"sha": "e3ea258a5f4a3430e922c46f50127ad23bc8dab2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3ea258a5f4a3430e922c46f50127ad23bc8dab2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6bf1aa6ff2f8b401ed93f41bb248389c95458112", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6bf1aa6ff2f8b401ed93f41bb248389c95458112", "html_url": "https://github.com/rust-lang/rust/commit/6bf1aa6ff2f8b401ed93f41bb248389c95458112", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6bf1aa6ff2f8b401ed93f41bb248389c95458112/comments", "author": {"login": "alexreg", "id": 67036, "node_id": "MDQ6VXNlcjY3MDM2", "avatar_url": "https://avatars.githubusercontent.com/u/67036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexreg", "html_url": "https://github.com/alexreg", "followers_url": "https://api.github.com/users/alexreg/followers", "following_url": "https://api.github.com/users/alexreg/following{/other_user}", "gists_url": "https://api.github.com/users/alexreg/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexreg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexreg/subscriptions", "organizations_url": "https://api.github.com/users/alexreg/orgs", "repos_url": "https://api.github.com/users/alexreg/repos", "events_url": "https://api.github.com/users/alexreg/events{/privacy}", "received_events_url": "https://api.github.com/users/alexreg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexreg", "id": 67036, "node_id": "MDQ6VXNlcjY3MDM2", "avatar_url": "https://avatars.githubusercontent.com/u/67036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexreg", "html_url": "https://github.com/alexreg", "followers_url": "https://api.github.com/users/alexreg/followers", "following_url": "https://api.github.com/users/alexreg/following{/other_user}", "gists_url": "https://api.github.com/users/alexreg/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexreg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexreg/subscriptions", "organizations_url": "https://api.github.com/users/alexreg/orgs", "repos_url": "https://api.github.com/users/alexreg/repos", "events_url": "https://api.github.com/users/alexreg/events{/privacy}", "received_events_url": "https://api.github.com/users/alexreg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "441519536c8bd138e8c651743249acd6814747a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/441519536c8bd138e8c651743249acd6814747a1", "html_url": "https://github.com/rust-lang/rust/commit/441519536c8bd138e8c651743249acd6814747a1"}], "stats": {"total": 49, "additions": 35, "deletions": 14}, "files": [{"sha": "6187e091319e0f03fcd44ce8b2a3ed2fe62ce40f", "filename": "src/librustc_mir/hair/pattern/check_match.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs?ref=6bf1aa6ff2f8b401ed93f41bb248389c95458112", "patch": "@@ -539,7 +539,7 @@ fn check_legality_of_move_bindings(cx: &MatchVisitor,\n                 .emit();\n         } else if has_guard && !cx.tcx.allow_bind_by_move_patterns_with_guards() {\n             let mut err = struct_span_err!(cx.tcx.sess, p.span, E0008,\n-                                       \"cannot bind by-move into a pattern guard\");\n+                                           \"cannot bind by-move into a pattern guard\");\n             err.span_label(p.span, \"moves value into pattern guard\");\n             if cx.tcx.sess.opts.unstable_features.is_nightly_build() && cx.tcx.use_mir_borrowck() {\n                 err.help(\"add #![feature(bind_by_move_pattern_guards)] to the \\"}, {"sha": "5e3f7470099117c806abfd11e5eba77ee59fe066", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 29, "deletions": 9, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=6bf1aa6ff2f8b401ed93f41bb248389c95458112", "patch": "@@ -42,8 +42,9 @@ use rustc::lint;\n use rustc::hir::def::*;\n use rustc::hir::def::Namespace::*;\n use rustc::hir::def_id::{CRATE_DEF_INDEX, LOCAL_CRATE, DefId};\n-use rustc::ty;\n use rustc::hir::{Freevar, FreevarMap, TraitCandidate, TraitMap, GlobMap};\n+use rustc::session::config::nightly_options;\n+use rustc::ty;\n use rustc::util::nodemap::{NodeMap, NodeSet, FxHashMap, FxHashSet, DefIdMap};\n \n use rustc_metadata::creader::CrateLoader;\n@@ -1381,6 +1382,9 @@ pub struct Resolver<'a, 'b: 'a> {\n     /// The current self type if inside an impl (used for better errors).\n     current_self_type: Option<Ty>,\n \n+    /// The current self item if inside an ADT (used for better errors).\n+    current_self_item: Option<NodeId>,\n+\n     /// The idents for the primitive types.\n     primitive_type_table: PrimitiveTypeTable,\n \n@@ -1710,6 +1714,7 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n \n             current_trait_ref: None,\n             current_self_type: None,\n+            current_self_item: None,\n \n             primitive_type_table: PrimitiveTypeTable::new(),\n \n@@ -2186,15 +2191,17 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n     }\n \n     fn resolve_adt(&mut self, item: &Item, generics: &Generics) {\n-        self.with_type_parameter_rib(HasTypeParameters(generics, ItemRibKind), |this| {\n-            let item_def_id = this.definitions.local_def_id(item.id);\n-            if this.session.features_untracked().self_in_typedefs {\n-                this.with_self_rib(Def::SelfTy(None, Some(item_def_id)), |this| {\n+        self.with_current_self_item(item, |this| {\n+            this.with_type_parameter_rib(HasTypeParameters(generics, ItemRibKind), |this| {\n+                let item_def_id = this.definitions.local_def_id(item.id);\n+                if this.session.features_untracked().self_in_typedefs {\n+                    this.with_self_rib(Def::SelfTy(None, Some(item_def_id)), |this| {\n+                        visit::walk_item(this, item);\n+                    });\n+                } else {\n                     visit::walk_item(this, item);\n-                });\n-            } else {\n-                visit::walk_item(this, item);\n-            }\n+                }\n+            });\n         });\n     }\n \n@@ -2435,6 +2442,15 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n         result\n     }\n \n+    fn with_current_self_item<T, F>(&mut self, self_item: &Item, f: F) -> T\n+        where F: FnOnce(&mut Resolver) -> T\n+    {\n+        let previous_value = replace(&mut self.current_self_item, Some(self_item.id));\n+        let result = f(self);\n+        self.current_self_item = previous_value;\n+        result\n+    }\n+\n     /// This is called to resolve a trait reference from an `impl` (i.e. `impl Trait for Foo`)\n     fn with_optional_trait_ref<T, F>(&mut self, opt_trait_ref: Option<&TraitRef>, f: F) -> T\n         where F: FnOnce(&mut Resolver, Option<DefId>) -> T\n@@ -3004,6 +3020,10 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n                     \"traits and impls\"\n                 };\n                 err.span_label(span, format!(\"`Self` is only available in {}\", available_in));\n+                if this.current_self_item.is_some() && nightly_options::is_nightly_build() {\n+                    err.help(\"add #![feature(self_in_typedefs)] to the crate attributes \\\n+                              to enable\");\n+                }\n                 return (err, Vec::new());\n             }\n             if is_self_value(path, ns) {"}, {"sha": "ae97cdc85ad38e388a4f7a15be89dccde9a303af", "filename": "src/librustc_typeck/check/method/probe.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6bf1aa6ff2f8b401ed93f41bb248389c95458112/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs?ref=6bf1aa6ff2f8b401ed93f41bb248389c95458112", "patch": "@@ -17,6 +17,9 @@ use check::FnCtxt;\n use hir::def_id::DefId;\n use hir::def::Def;\n use namespace::Namespace;\n+use rustc::hir;\n+use rustc::lint;\n+use rustc::session::config::nightly_options;\n use rustc::ty::subst::{Subst, Substs};\n use rustc::traits::{self, ObligationCause};\n use rustc::ty::{self, Ty, ToPolyTraitRef, ToPredicate, TraitRef, TypeFoldable};\n@@ -28,8 +31,6 @@ use rustc::middle::stability;\n use syntax::ast;\n use syntax::util::lev_distance::{lev_distance, find_best_match_for_name};\n use syntax_pos::{Span, symbol::Symbol};\n-use rustc::hir;\n-use rustc::lint;\n use std::mem;\n use std::ops::Deref;\n use std::rc::Rc;\n@@ -1073,9 +1074,9 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n             self.tcx.item_path_str(stable_pick.item.def_id),\n         ));\n \n-        if ::rustc::session::config::nightly_options::is_nightly_build() {\n+        if nightly_options::is_nightly_build() {\n             for (candidate, feature) in unstable_candidates {\n-                diag.note(&format!(\n+                diag.help(&format!(\n                     \"add #![feature({})] to the crate attributes to enable `{}`\",\n                     feature,\n                     self.tcx.item_path_str(candidate.item.def_id),"}]}