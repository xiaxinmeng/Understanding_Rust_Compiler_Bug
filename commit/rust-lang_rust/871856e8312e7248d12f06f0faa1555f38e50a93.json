{"sha": "871856e8312e7248d12f06f0faa1555f38e50a93", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3MTg1NmU4MzEyZTcyNDhkMTJmMDZmMGZhYTE1NTVmMzhlNTBhOTM=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-10-02T22:28:52Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-29T01:15:15Z"}, "message": "Highlight code on diagnostics when underlined", "tree": {"sha": "b43d6d37be3105623dc62652b490b43a15759755", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b43d6d37be3105623dc62652b490b43a15759755"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/871856e8312e7248d12f06f0faa1555f38e50a93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/871856e8312e7248d12f06f0faa1555f38e50a93", "html_url": "https://github.com/rust-lang/rust/commit/871856e8312e7248d12f06f0faa1555f38e50a93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/871856e8312e7248d12f06f0faa1555f38e50a93/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bacb5c58dfdde7c35e99b2b0d8171238cc33cf6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/bacb5c58dfdde7c35e99b2b0d8171238cc33cf6c", "html_url": "https://github.com/rust-lang/rust/commit/bacb5c58dfdde7c35e99b2b0d8171238cc33cf6c"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "289383088c86f9e9c7a8533729267a0dffc8468c", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/871856e8312e7248d12f06f0faa1555f38e50a93/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/871856e8312e7248d12f06f0faa1555f38e50a93/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=871856e8312e7248d12f06f0faa1555f38e50a93", "patch": "@@ -551,7 +551,13 @@ impl EmitterWriter {\n                                code_offset + annotation.start_col,\n                                style);\n                 }\n-                _ => (),\n+                _ => {\n+                    buffer.set_style_range(line_offset,\n+                                           code_offset + annotation.start_col,\n+                                           code_offset + annotation.end_col,\n+                                           style,\n+                                           annotation.is_primary);\n+               }\n             }\n         }\n "}, {"sha": "2c736ec22c3b3fd76b97e47dafe1848b3ebd6fac", "filename": "src/librustc_errors/styled_buffer.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/871856e8312e7248d12f06f0faa1555f38e50a93/src%2Flibrustc_errors%2Fstyled_buffer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/871856e8312e7248d12f06f0faa1555f38e50a93/src%2Flibrustc_errors%2Fstyled_buffer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Fstyled_buffer.rs?ref=871856e8312e7248d12f06f0faa1555f38e50a93", "patch": "@@ -144,4 +144,25 @@ impl StyledBuffer {\n     pub fn num_lines(&self) -> usize {\n         self.text.len()\n     }\n+\n+    pub fn set_style_range(&mut self,\n+                           line: usize,\n+                           col_start: usize,\n+                           col_end: usize,\n+                           style: Style,\n+                           overwrite: bool) {\n+        for col in col_start..col_end {\n+            self.set_style(line, col, style, overwrite);\n+        }\n+    }\n+\n+    pub fn set_style(&mut self, line: usize, col: usize, style: Style, overwrite: bool) {\n+        if let Some(ref mut line) = self.styles.get_mut(line) {\n+            if let Some(s) = line.get_mut(col) {\n+                if *s == Style::NoStyle || *s == Style::Quotation || overwrite {\n+                    *s = style;\n+                }\n+            }\n+        }\n+    }\n }"}]}