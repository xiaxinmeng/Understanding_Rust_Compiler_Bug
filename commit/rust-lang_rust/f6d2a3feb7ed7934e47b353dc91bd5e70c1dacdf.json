{"sha": "f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2ZDJhM2ZlYjdlZDc5MzRlNDdiMzUzZGM5MWJkNWU3MGMxZGFjZGY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-03-28T12:35:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-03-28T12:35:35Z"}, "message": "Rollup merge of #59318 - alexcrichton:check-for-clang, r=michaelwoerister\n\nrustc: Update linker flavor inference from filename\n\nThis commit fixes what is believed to be a preexisting bug in the linker\nflavor inference and additionally adds a new features. Previously if the\nlinker didn't end in `exe` the entire file name was compared to infer\nthe linker's flavor. This commit fixes the code to instead\nunconditionally inspect `file_stem()` which is the relevant part we're\nlooking at to figure out what the linker flavor is.\n\nAdditionally this commit now also adds recognition of `clang` and clang\nwrappers that end in `-clang` (which look like gcc wrappers). This\nshould allow clang-specific wrappers to get correctly inferred to the\n`Gcc` linker flavor rather than the default linker flavor configured for\na target.", "tree": {"sha": "ddcd3173f5a8f79b5c2f266ef607064b8333a5da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ddcd3173f5a8f79b5c2f266ef607064b8333a5da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcnL+XCRBK7hj4Ov3rIwAAdHIIADZMI1LMtcmuwypJZgYOOGGS\n5EmKWdod/CSXNMNrG4z4GzRStpfqrbvxbPjEyAKJN0gf3JXaCOuihhbM8TbqlvDQ\n/XNXut2rIGDKxWBPO6tSr04j5zH8qVdMSlATzhDTPuUTbv6n4KIYKab3k7kL0RS2\nDTEl/AsYR4j3ycF4Ha+iiRaPu9wf5JUpCN6mKsAnEN0Dc4PXbEYOXEV6KVgCHqat\nNgsshlqswezNc8AR1c2YU/KGUZr20rC/1E2Os/SLzehrZ6pdag2pZeeSF2nJa2+U\nwCOFd0CUTG8kQ/pU+0RJNTb42kMooELDqVr0sr/WHxhmE42+ALCNkhZTx2gzb6Q=\n=H6HG\n-----END PGP SIGNATURE-----\n", "payload": "tree ddcd3173f5a8f79b5c2f266ef607064b8333a5da\nparent 4720fcac4c8a9667f8160a67260a080a2553cd58\nparent 664838582b6d973620930a2ba75f369f44debecd\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1553776535 +0100\ncommitter GitHub <noreply@github.com> 1553776535 +0100\n\nRollup merge of #59318 - alexcrichton:check-for-clang, r=michaelwoerister\n\nrustc: Update linker flavor inference from filename\n\nThis commit fixes what is believed to be a preexisting bug in the linker\nflavor inference and additionally adds a new features. Previously if the\nlinker didn't end in `exe` the entire file name was compared to infer\nthe linker's flavor. This commit fixes the code to instead\nunconditionally inspect `file_stem()` which is the relevant part we're\nlooking at to figure out what the linker flavor is.\n\nAdditionally this commit now also adds recognition of `clang` and clang\nwrappers that end in `-clang` (which look like gcc wrappers). This\nshould allow clang-specific wrappers to get correctly inferred to the\n`Gcc` linker flavor rather than the default linker flavor configured for\na target.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf", "html_url": "https://github.com/rust-lang/rust/commit/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4720fcac4c8a9667f8160a67260a080a2553cd58", "url": "https://api.github.com/repos/rust-lang/rust/commits/4720fcac4c8a9667f8160a67260a080a2553cd58", "html_url": "https://github.com/rust-lang/rust/commit/4720fcac4c8a9667f8160a67260a080a2553cd58"}, {"sha": "664838582b6d973620930a2ba75f369f44debecd", "url": "https://api.github.com/repos/rust-lang/rust/commits/664838582b6d973620930a2ba75f369f44debecd", "html_url": "https://github.com/rust-lang/rust/commit/664838582b6d973620930a2ba75f369f44debecd"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "a0e2dcd646df88361d4b4da61ee2c6ec00e2eca3", "filename": "src/librustc_codegen_ssa/back/link.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs?ref=f6d2a3feb7ed7934e47b353dc91bd5e70c1dacdf", "patch": "@@ -152,17 +152,20 @@ pub fn linker_and_flavor(sess: &Session) -> (PathBuf, LinkerFlavor) {\n                 LinkerFlavor::PtxLinker => \"rust-ptx-linker\",\n             }), flavor)),\n             (Some(linker), None) => {\n-                let stem = if linker.extension().and_then(|ext| ext.to_str()) == Some(\"exe\") {\n-                    linker.file_stem().and_then(|stem| stem.to_str())\n-                } else {\n-                    linker.to_str()\n-                }.unwrap_or_else(|| {\n-                    sess.fatal(\"couldn't extract file stem from specified linker\");\n-                }).to_owned();\n+                let stem = linker\n+                    .file_stem()\n+                    .and_then(|stem| stem.to_str())\n+                    .unwrap_or_else(|| {\n+                        sess.fatal(\"couldn't extract file stem from specified linker\")\n+                    });\n \n                 let flavor = if stem == \"emcc\" {\n                     LinkerFlavor::Em\n-                } else if stem == \"gcc\" || stem.ends_with(\"-gcc\") {\n+                } else if stem == \"gcc\"\n+                    || stem.ends_with(\"-gcc\")\n+                    || stem == \"clang\"\n+                    || stem.ends_with(\"-clang\")\n+                {\n                     LinkerFlavor::Gcc\n                 } else if stem == \"ld\" || stem == \"ld.lld\" || stem.ends_with(\"-ld\") {\n                     LinkerFlavor::Ld"}]}