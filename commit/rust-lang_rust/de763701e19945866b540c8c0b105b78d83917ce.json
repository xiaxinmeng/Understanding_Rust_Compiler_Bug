{"sha": "de763701e19945866b540c8c0b105b78d83917ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlNzYzNzAxZTE5OTQ1ODY2YjU0MGM4YzBiMTA1Yjc4ZDgzOTE3Y2U=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-10-11T18:44:24Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-10-22T20:43:38Z"}, "message": "Remove unused category from macros.", "tree": {"sha": "e783b02774a24f2efb5c714b70cf239cb6e30a88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e783b02774a24f2efb5c714b70cf239cb6e30a88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de763701e19945866b540c8c0b105b78d83917ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de763701e19945866b540c8c0b105b78d83917ce", "html_url": "https://github.com/rust-lang/rust/commit/de763701e19945866b540c8c0b105b78d83917ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de763701e19945866b540c8c0b105b78d83917ce/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a4d948b4a8c69de0e3fdb231fdb14097849f6ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a4d948b4a8c69de0e3fdb231fdb14097849f6ce", "html_url": "https://github.com/rust-lang/rust/commit/0a4d948b4a8c69de0e3fdb231fdb14097849f6ce"}], "stats": {"total": 33, "additions": 11, "deletions": 22}, "files": [{"sha": "df569566f76d5268316159367df12b18df7e7679", "filename": "compiler/rustc_macros/src/query.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fquery.rs?ref=de763701e19945866b540c8c0b105b78d83917ce", "patch": "@@ -190,7 +190,11 @@ impl<T: Parse> Parse for List<T> {\n }\n \n /// A named group containing queries.\n+///\n+/// For now, the name is not used any more, but the capability remains interesting for future\n+/// developments of the query system.\n struct Group {\n+    #[allow(unused)]\n     name: Ident,\n     queries: List<Query>,\n }\n@@ -422,7 +426,6 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n     let mut cached_queries = quote! {};\n \n     for group in groups.0 {\n-        let mut group_stream = quote! {};\n         for mut query in group.queries.0 {\n             let modifiers = process_modifiers(&mut query);\n             let name = &query.name;\n@@ -485,7 +488,7 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n             let attribute_stream = quote! {#(#attributes),*};\n             let doc_comments = query.doc_comments.iter();\n             // Add the query to the group\n-            group_stream.extend(quote! {\n+            query_stream.extend(quote! {\n                 #(#doc_comments)*\n                 [#attribute_stream] fn #name: #name(#arg) #result,\n             });\n@@ -514,10 +517,6 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n \n             add_query_description_impl(&query, modifiers, &mut query_description_stream);\n         }\n-        let name = &group.name;\n-        query_stream.extend(quote! {\n-            #name { #group_stream },\n-        });\n     }\n \n     dep_node_force_stream.extend(quote! {"}, {"sha": "7c8e7cd0182d0b8fd601031bd09694c7481a0e93", "filename": "compiler/rustc_middle/src/ty/query/plumbing.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fplumbing.rs?ref=de763701e19945866b540c8c0b105b78d83917ce", "patch": "@@ -242,24 +242,14 @@ macro_rules! hash_result {\n     };\n }\n \n-macro_rules! define_queries {\n-    (<$tcx:tt> $($category:tt {\n-        $($(#[$attr:meta])* [$($modifiers:tt)*] fn $name:ident: $node:ident($($K:tt)*) -> $V:ty,)*\n-    },)*) => {\n-        define_queries_inner! { <$tcx>\n-            $($( $(#[$attr])* category<$category> [$($modifiers)*] fn $name: $node($($K)*) -> $V,)*)*\n-        }\n-    }\n-}\n-\n macro_rules! query_helper_param_ty {\n     (DefId) => { impl IntoQueryParam<DefId> };\n     ($K:ty) => { $K };\n }\n \n-macro_rules! define_queries_inner {\n+macro_rules! define_queries {\n     (<$tcx:tt>\n-     $($(#[$attr:meta])* category<$category:tt>\n+     $($(#[$attr:meta])*\n         [$($modifiers:tt)*] fn $name:ident: $node:ident($($K:tt)*) -> $V:ty,)*) => {\n \n         use std::mem;"}, {"sha": "f6df83c912394b26dbb9645f844e730513a76cdc", "filename": "compiler/rustc_middle/src/ty/query/stats.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fstats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de763701e19945866b540c8c0b105b78d83917ce/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fstats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery%2Fstats.rs?ref=de763701e19945866b540c8c0b105b78d83917ce", "patch": "@@ -120,13 +120,13 @@ pub fn print_stats(tcx: TyCtxt<'_>) {\n }\n \n macro_rules! print_stats {\n-    (<$tcx:tt> $($category:tt {\n+    (<$tcx:tt>\n         $($(#[$attr:meta])* [$($modifiers:tt)*] fn $name:ident: $node:ident($K:ty) -> $V:ty,)*\n-    },)*) => {\n+    ) => {\n         fn query_stats(tcx: TyCtxt<'_>) -> Vec<QueryStats> {\n             let mut queries = Vec::new();\n \n-            $($(\n+            $(\n                 queries.push(stats::<\n                     crate::dep_graph::DepKind,\n                     <TyCtxt<'_> as QueryContext>::Query,\n@@ -135,7 +135,7 @@ macro_rules! print_stats {\n                     stringify!($name),\n                     &tcx.queries.$name,\n                 ));\n-            )*)*\n+            )*\n \n             queries\n         }"}]}