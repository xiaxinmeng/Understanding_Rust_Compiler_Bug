{"sha": "665ba3531d60d26a0f582693255629040313d29d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2NWJhMzUzMWQ2MGQyNmEwZjU4MjY5MzI1NTYyOTA0MDMxM2QyOWQ=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2012-06-08T19:54:23Z"}, "committer": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2012-06-11T19:29:04Z"}, "message": "Clean up tydesc declaration to make it clear what is unused.", "tree": {"sha": "241051a2aae8b143f3653a0baeeb39d8067eba1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/241051a2aae8b143f3653a0baeeb39d8067eba1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/665ba3531d60d26a0f582693255629040313d29d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/665ba3531d60d26a0f582693255629040313d29d", "html_url": "https://github.com/rust-lang/rust/commit/665ba3531d60d26a0f582693255629040313d29d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/665ba3531d60d26a0f582693255629040313d29d/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b22620624cdc4c35a74fce7eca9f6f279a403f56", "url": "https://api.github.com/repos/rust-lang/rust/commits/b22620624cdc4c35a74fce7eca9f6f279a403f56", "html_url": "https://github.com/rust-lang/rust/commit/b22620624cdc4c35a74fce7eca9f6f279a403f56"}], "stats": {"total": 37, "additions": 16, "deletions": 21}, "files": [{"sha": "8a105c1db0f0ce4bc3cd16196cd2d94aaf048519", "filename": "src/rt/rust_type.h", "status": "modified", "additions": 9, "deletions": 14, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/665ba3531d60d26a0f582693255629040313d29d/src%2Frt%2Frust_type.h", "raw_url": "https://github.com/rust-lang/rust/raw/665ba3531d60d26a0f582693255629040313d29d/src%2Frt%2Frust_type.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_type.h?ref=665ba3531d60d26a0f582693255629040313d29d", "patch": "@@ -42,29 +42,24 @@ static inline void *box_body(rust_opaque_box *box) {\n     return (void*)(box + 1);\n }\n \n+// N.B. If you want to add a field to tydesc, please use one of the\n+// unused fields!\n struct type_desc {\n-    // First part of type_desc is known to compiler.\n-    // first_param = &descs[1] if dynamic, null if static.\n     const type_desc **first_param;\n     size_t size;\n     size_t align;\n     glue_fn *take_glue;\n     glue_fn *drop_glue;\n     glue_fn *free_glue;\n-    void *UNUSED;\n-    glue_fn *sever_glue;    // For GC.\n-    glue_fn *mark_glue;     // For GC.\n-    uintptr_t unused2;\n-    void *UNUSED_2;\n+    glue_fn *visit_glue;\n+    uintptr_t UNUSED_1;\n+    uintptr_t UNUSED_2;\n+    uintptr_t UNUSED_3;\n+    uintptr_t UNUSED_4;\n     const uint8_t *shape;\n     const rust_shape_tables *shape_tables;\n-    uintptr_t n_params;\n-    uintptr_t n_obj_params;\n-\n-    // Residual fields past here are known only to runtime.\n-    UT_hash_handle hh;\n-    size_t n_descs;\n-    const type_desc *descs[];\n+    uintptr_t UNUSED_5;\n+    uintptr_t UNUSED_6;\n };\n \n extern \"C\" type_desc *rust_clone_type_desc(type_desc*);"}, {"sha": "a6806d97559da3f51502cbda0b05300a4a4ddea3", "filename": "src/rustc/middle/trans/base.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/665ba3531d60d26a0f582693255629040313d29d/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/665ba3531d60d26a0f582693255629040313d29d/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=665ba3531d60d26a0f582693255629040313d29d", "patch": "@@ -630,14 +630,14 @@ fn emit_tydescs(ccx: @crate_ctxt) {\n                             drop_glue, // drop_glue\n                             free_glue, // free_glue\n                             visit_glue, // visit_glue\n-                            C_null(glue_fn_ty), // sever_glue\n-                            C_null(glue_fn_ty), // mark_glue\n-                            C_null(glue_fn_ty), // unused\n-                            C_null(T_ptr(T_i8())), // cmp_glue\n+                            C_int(ccx, 0), // ununsed\n+                            C_int(ccx, 0), // ununsed\n+                            C_int(ccx, 0), // ununsed\n+                            C_int(ccx, 0), // ununsed\n                             C_shape(ccx, shape), // shape\n                             shape_tables, // shape_tables\n-                            C_int(ccx, 0), // n_params\n-                            C_int(ccx, 0)]); // n_obj_params\n+                            C_int(ccx, 0), // ununsed\n+                            C_int(ccx, 0)]); // unused\n \n         let gvar = ti.tydesc;\n         llvm::LLVMSetInitializer(gvar, tydesc);"}, {"sha": "9dc8fdd4557c47aa44d7b8f59ddfb7b3417d00a2", "filename": "src/rustc/middle/trans/common.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/665ba3531d60d26a0f582693255629040313d29d/src%2Frustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/665ba3531d60d26a0f582693255629040313d29d/src%2Frustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=665ba3531d60d26a0f582693255629040313d29d", "patch": "@@ -621,7 +621,7 @@ fn T_tydesc(targ_cfg: @session::config) -> TypeRef {\n     let elems =\n         [tydescpp, int_type, int_type,\n          glue_fn_ty, glue_fn_ty, glue_fn_ty, glue_fn_ty,\n-         glue_fn_ty, glue_fn_ty, glue_fn_ty, T_ptr(T_i8()),\n+         int_type, int_type, int_type, int_type,\n          T_ptr(T_i8()), T_ptr(T_i8()), int_type, int_type];\n     set_struct_body(tydesc, elems);\n     ret tydesc;"}]}