{"sha": "96736f215fadc7f6c11b085c92de895626ab4d59", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2NzM2ZjIxNWZhZGM3ZjZjMTFiMDg1YzkyZGU4OTU2MjZhYjRkNTk=", "commit": {"author": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-10-02T16:21:39Z"}, "committer": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2018-10-06T08:24:54Z"}, "message": "rustc/middle: improve allocations", "tree": {"sha": "e72f4eb18ba00b45496e8cd132ef775bbdd72096", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e72f4eb18ba00b45496e8cd132ef775bbdd72096"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96736f215fadc7f6c11b085c92de895626ab4d59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96736f215fadc7f6c11b085c92de895626ab4d59", "html_url": "https://github.com/rust-lang/rust/commit/96736f215fadc7f6c11b085c92de895626ab4d59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96736f215fadc7f6c11b085c92de895626ab4d59/comments", "author": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a256a66305d52b463699f50a3ad18db5d46ce0e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/a256a66305d52b463699f50a3ad18db5d46ce0e2", "html_url": "https://github.com/rust-lang/rust/commit/a256a66305d52b463699f50a3ad18db5d46ce0e2"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "e0d6bc104a9fef158e288e9a1be54bad7e004c13", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/96736f215fadc7f6c11b085c92de895626ab4d59/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96736f215fadc7f6c11b085c92de895626ab4d59/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=96736f215fadc7f6c11b085c92de895626ab4d59", "patch": "@@ -474,13 +474,15 @@ fn visit_expr<'a, 'tcx>(ir: &mut IrMaps<'a, 'tcx>, expr: &'tcx Expr) {\n         // construction site.\n         let mut call_caps = Vec::new();\n         ir.tcx.with_freevars(expr.id, |freevars| {\n-            for fv in freevars {\n+            call_caps.extend(freevars.iter().filter_map(|fv| {\n                 if let Def::Local(rv) = fv.def {\n                     let fv_ln = ir.add_live_node(FreeVarNode(fv.span));\n                     let var_hid = ir.tcx.hir.node_to_hir_id(rv);\n-                    call_caps.push(CaptureInfo { ln: fv_ln, var_hid });\n+                    Some(CaptureInfo { ln: fv_ln, var_hid })\n+                } else {\n+                    None\n                 }\n-            }\n+            }));\n         });\n         ir.set_captures(expr.id, call_caps);\n "}, {"sha": "03a6036b4ea9211e52f032d0a94b3bd9b94568a3", "filename": "src/librustc/middle/reachable.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96736f215fadc7f6c11b085c92de895626ab4d59/src%2Flibrustc%2Fmiddle%2Freachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96736f215fadc7f6c11b085c92de895626ab4d59/src%2Flibrustc%2Fmiddle%2Freachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Freachable.rs?ref=96736f215fadc7f6c11b085c92de895626ab4d59", "patch": "@@ -371,7 +371,9 @@ impl<'a, 'tcx: 'a> ItemLikeVisitor<'tcx> for CollectPrivateImplItemsVisitor<'a,\n                     return\n                 }\n \n-                for default_method in self.tcx.provided_trait_methods(trait_def_id) {\n+                let provided_trait_methods = self.tcx.provided_trait_methods(trait_def_id);\n+                self.worklist.reserve(provided_trait_methods.len());\n+                for default_method in provided_trait_methods {\n                     let node_id = self.tcx\n                                       .hir\n                                       .as_local_node_id(default_method.def_id)"}]}