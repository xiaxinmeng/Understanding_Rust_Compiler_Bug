{"sha": "4dc48db31015b6ac4dccb953aeeceee55752f592", "node_id": "C_kwDOAAsO6NoAKDRkYzQ4ZGIzMTAxNWI2YWM0ZGNjYjk1M2FlZWNlZWU1NTc1MmY1OTI", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-03-07T14:06:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-07T14:06:23Z"}, "message": "Rollup merge of #108774 - jyn514:translation-errors, r=davidtwco\n\nGreatly improve the error messages when `run-make/translation` fails\n\nBefore:\n```\nLD_LIBRARY_PATH=\"/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/lib:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0-bootstrap-tools/aarch64-unknown-linux-gnu/release/deps:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0/lib\" '/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/bin/rustc' --out-dir /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation -L /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation  test.rs --sysroot /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation/fakeroot -Ztranslate-lang=zh-CN 2>&1 | grep \"this is a test message\"\n------------------------------------------\n--- stderr -------------------------------\nmake: *** [Makefile:51: sysroot] Error 1\n------------------------------------------\n\nfailures:\n    [run-make] tests/run-make/translation\n```\n\nAfter:\n\n```\nLD_LIBRARY_PATH=\"/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/lib:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0-bootstrap-tools/aarch64-unknown-linux-gnu/release/deps:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0/lib\" '/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/bin/rustc' --out-dir /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation -L /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation  test.rs --sysroot /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation/fakeroot -Ztranslate-lang=zh-CN 2>&1 | grep \"this is a test message\"\n[[[ begin stdout ]]]\nerror: failed to load fluent bundle: failed to add resource: Attempt to override an existing message: \"parse_struct_literal_body_without_path\".\n\n[[[ end stdout ]]]\nError: cannot match: this is a test message\n------------------------------------------\n--- stderr -------------------------------\nmake: *** [Makefile:51: sysroot] Error 1\n------------------------------------------\n\nfailures:\n    [run-make] tests/run-make/translation\n```", "tree": {"sha": "fa116b32fbf800759e55f09101c896f7b975b808", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa116b32fbf800759e55f09101c896f7b975b808"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4dc48db31015b6ac4dccb953aeeceee55752f592", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkB0TfCRBK7hj4Ov3rIwAAbygIADctI0TdG40T+vYcs2JgTPER\nFcVjDWbvBcvZK5t1wDQjzZZNM9J0fmIPmEsZn2oR3KaWuAONkmTZBTkgJySL07Sf\nAyO1a5gqxQ4JfEdIb0mfBgmgrZ6QrR4ED8SOTAMdJUqOO/hetiiH0M8Vv0Skrmhc\ngIHZr1lwcPhBTnCBt4vRV21QOBbMasAeKmRvT/VzaJbaPb9W9hXXESTH3r6lzL0F\n6SAIK4EfYjj4JdSq6hCIc+PHGH0wRmKatQC+5aFRJxFWv+a5ZWCjBlRIqmSQOHvG\nhzSNSU+L60iy9vXM8Rao80deqK+oGG97OUCKwzxeVTnfjZlC7DyJpKbOcI6Qy+M=\n=Jqg4\n-----END PGP SIGNATURE-----\n", "payload": "tree fa116b32fbf800759e55f09101c896f7b975b808\nparent 8f775dc7a6fae384bdd47b08ab75830358191534\nparent 339980930de5728b6702eeef16dbaeb69ff83edb\nauthor Yuki Okushi <jtitor@2k36.org> 1678197983 +0900\ncommitter GitHub <noreply@github.com> 1678197983 +0900\n\nRollup merge of #108774 - jyn514:translation-errors, r=davidtwco\n\nGreatly improve the error messages when `run-make/translation` fails\n\nBefore:\n```\nLD_LIBRARY_PATH=\"/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/lib:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0-bootstrap-tools/aarch64-unknown-linux-gnu/release/deps:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0/lib\" '/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/bin/rustc' --out-dir /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation -L /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation  test.rs --sysroot /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation/fakeroot -Ztranslate-lang=zh-CN 2>&1 | grep \"this is a test message\"\n------------------------------------------\n--- stderr -------------------------------\nmake: *** [Makefile:51: sysroot] Error 1\n------------------------------------------\n\nfailures:\n    [run-make] tests/run-make/translation\n```\n\nAfter:\n\n```\nLD_LIBRARY_PATH=\"/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/lib:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0-bootstrap-tools/aarch64-unknown-linux-gnu/release/deps:/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage0/lib\" '/home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/stage2/bin/rustc' --out-dir /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation -L /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation  test.rs --sysroot /home/gh-jyn514/rust/build/aarch64-unknown-linux-gnu/test/run-make/translation/translation/fakeroot -Ztranslate-lang=zh-CN 2>&1 | grep \"this is a test message\"\n[[[ begin stdout ]]]\nerror: failed to load fluent bundle: failed to add resource: Attempt to override an existing message: \"parse_struct_literal_body_without_path\".\n\n[[[ end stdout ]]]\nError: cannot match: this is a test message\n------------------------------------------\n--- stderr -------------------------------\nmake: *** [Makefile:51: sysroot] Error 1\n------------------------------------------\n\nfailures:\n    [run-make] tests/run-make/translation\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4dc48db31015b6ac4dccb953aeeceee55752f592", "html_url": "https://github.com/rust-lang/rust/commit/4dc48db31015b6ac4dccb953aeeceee55752f592", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4dc48db31015b6ac4dccb953aeeceee55752f592/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f775dc7a6fae384bdd47b08ab75830358191534", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f775dc7a6fae384bdd47b08ab75830358191534", "html_url": "https://github.com/rust-lang/rust/commit/8f775dc7a6fae384bdd47b08ab75830358191534"}, {"sha": "339980930de5728b6702eeef16dbaeb69ff83edb", "url": "https://api.github.com/repos/rust-lang/rust/commits/339980930de5728b6702eeef16dbaeb69ff83edb", "html_url": "https://github.com/rust-lang/rust/commit/339980930de5728b6702eeef16dbaeb69ff83edb"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "397fc542909ac1c6b8898a10071b5c2a2b465928", "filename": "tests/run-make/translation/Makefile", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4dc48db31015b6ac4dccb953aeeceee55752f592/tests%2Frun-make%2Ftranslation%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/4dc48db31015b6ac4dccb953aeeceee55752f592/tests%2Frun-make%2Ftranslation%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-make%2Ftranslation%2FMakefile?ref=4dc48db31015b6ac4dccb953aeeceee55752f592", "patch": "@@ -13,22 +13,22 @@ all: normal custom missing broken sysroot sysroot-invalid sysroot-missing\n \n # Check that the test works normally, using the built-in fallback bundle.\n normal: test.rs\n-\t$(RUSTC) $< 2>&1 | grep \"struct literal body without path\"\n+\t$(RUSTC) $< 2>&1 | $(CGREP) \"struct literal body without path\"\n \n # Check that a primary bundle can be loaded and will be preferentially used\n # where possible.\n custom: test.rs working.ftl\n-\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/working.ftl 2>&1 | grep \"this is a test message\"\n+\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/working.ftl 2>&1 | $(CGREP) \"this is a test message\"\n \n # Check that a primary bundle with a broken message (e.g. a interpolated\n # variable is missing) will use the fallback bundle.\n missing: test.rs missing.ftl\n-\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/missing.ftl 2>&1 | grep \"struct literal body without path\"\n+\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/missing.ftl 2>&1 | $(CGREP) \"struct literal body without path\"\n \n # Check that a primary bundle without the desired message will use the fallback\n # bundle.\n broken: test.rs broken.ftl\n-\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/broken.ftl 2>&1 | grep \"struct literal body without path\"\n+\t$(RUSTC) $< -Ztranslate-additional-ftl=$(CURDIR)/broken.ftl 2>&1 | $(CGREP) \"struct literal body without path\"\n \n # Check that a locale can be loaded from the sysroot given a language\n # identifier by making a local copy of the sysroot and adding the custom locale\n@@ -48,13 +48,13 @@ sysroot: test.rs working.ftl\n \tln -s $(SYSROOT)/lib/rustlib/src/* $(FAKEROOT)/lib/rustlib/src\n \tmkdir -p $(FAKEROOT)/share/locale/zh-CN/\n \tln -s $(CURDIR)/working.ftl $(FAKEROOT)/share/locale/zh-CN/basic-translation.ftl\n-\t$(RUSTC) $< --sysroot $(FAKEROOT) -Ztranslate-lang=zh-CN 2>&1 | grep \"this is a test message\"\n+\t$(RUSTC) $< --sysroot $(FAKEROOT) -Ztranslate-lang=zh-CN 2>&1 | $(CGREP) \"this is a test message\"\n \n # Check that the compiler errors out when the sysroot requested cannot be\n # found. This test might start failing if there actually exists a Klingon\n # translation of rustc's error messages.\n-sysroot-missing: \n-\t$(RUSTC) $< -Ztranslate-lang=tlh 2>&1 | grep \"missing locale directory\"\n+sysroot-missing:\n+\t$(RUSTC) $< -Ztranslate-lang=tlh 2>&1 | $(CGREP) \"missing locale directory\"\n \n # Check that the compiler errors out when the directory for the locale in the\n # sysroot is actually a file.\n@@ -73,4 +73,4 @@ sysroot-invalid: test.rs working.ftl\n \tln -s $(SYSROOT)/lib/rustlib/src/* $(FAKEROOT)/lib/rustlib/src\n \tmkdir -p $(FAKEROOT)/share/locale\n \ttouch $(FAKEROOT)/share/locale/zh-CN\n-\t$(RUSTC) $< --sysroot $(FAKEROOT) -Ztranslate-lang=zh-CN 2>&1 | grep \"`\\$sysroot/share/locales/\\$locale` is not a directory\"\n+\t$(RUSTC) $< --sysroot $(FAKEROOT) -Ztranslate-lang=zh-CN 2>&1 | $(CGREP) \"`\\$sysroot/share/locales/\\$locale` is not a directory\""}]}