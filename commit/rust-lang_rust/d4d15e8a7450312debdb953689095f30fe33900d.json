{"sha": "d4d15e8a7450312debdb953689095f30fe33900d", "node_id": "C_kwDOAAsO6NoAKGQ0ZDE1ZThhNzQ1MDMxMmRlYmRiOTUzNjg5MDk1ZjMwZmUzMzkwMGQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-12T00:43:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-12T00:43:08Z"}, "message": "Rollup merge of #111439 - uweigand:backtrace-normalize, r=compiler-errors\n\nFix backtrace normalization in ice-bug-report-url.rs\n\nThis test case currently fails on s390x, and probably other platforms where the last line of a backtrace does not contain and \" at <source location>\" specification.\n\nThe problem with the existing normalization lines\n// normalize-stderr-test \"\\s*\\d{1,}: .*\\n\" -> \"\"\n// normalize-stderr-test \"\\s at .*\\n\" -> \"\"\nis that \\s matches all whitespace, including newlines, so the first (but not second) of these regexes may merge multiple lines.  Thus the output differs depending on which of these matches on the last line of a backtrace.\n\nAs the whitespace used in backtraces is just normal space characters, change both regexes to just match at least one space character instead:\n// normalize-stderr-test \" +\\d{1,}: .*\\n\" -> \"\"\n// normalize-stderr-test \" + at .*\\n\" -> \"\"", "tree": {"sha": "8827b974e9099a7795678437409b979bf079d222", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8827b974e9099a7795678437409b979bf079d222"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4d15e8a7450312debdb953689095f30fe33900d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkXYucCRBK7hj4Ov3rIwAAx3sIAD6gY+qnANscztjigW7IcQqS\n13Hill851kI7nqj0A/biXqvvnZRtBLgakb9W0jkzoB12zlJg2Gf/6kvFXPmCLLyZ\nnFPgHl3b0aMW0dUTkGIq3cK89/OemTECe7j3wsxFMUjj4xRG4U2zDfxg/Mc1UOhC\nK6uAcYKM5iaOjR77O2Ac81jXJGeN9Q/iZG65zoUmD6BUdqxyUXS8Xni/t5DbbM7R\nbiCWma2YzOa9gMhCEW65SG/W+nFvQEe6DDVyCBhpgmMbEdSrfgGy75PbGTWKm+zm\npfgpLl7m5jlsprOhEEOjrwNfxRP9M5jrJDteh4g1c4qVtzG6obRZACmchpLvqpk=\n=KtUL\n-----END PGP SIGNATURE-----\n", "payload": "tree 8827b974e9099a7795678437409b979bf079d222\nparent 691a5f388396d4cad18421dba55ac770f7e7a7f9\nparent cac7e42b5278ad46214c741f01e537dff1fa9372\nauthor Michael Goulet <michael@errs.io> 1683852188 -0700\ncommitter GitHub <noreply@github.com> 1683852188 -0700\n\nRollup merge of #111439 - uweigand:backtrace-normalize, r=compiler-errors\n\nFix backtrace normalization in ice-bug-report-url.rs\n\nThis test case currently fails on s390x, and probably other platforms where the last line of a backtrace does not contain and \" at <source location>\" specification.\n\nThe problem with the existing normalization lines\n// normalize-stderr-test \"\\s*\\d{1,}: .*\\n\" -> \"\"\n// normalize-stderr-test \"\\s at .*\\n\" -> \"\"\nis that \\s matches all whitespace, including newlines, so the first (but not second) of these regexes may merge multiple lines.  Thus the output differs depending on which of these matches on the last line of a backtrace.\n\nAs the whitespace used in backtraces is just normal space characters, change both regexes to just match at least one space character instead:\n// normalize-stderr-test \" +\\d{1,}: .*\\n\" -> \"\"\n// normalize-stderr-test \" + at .*\\n\" -> \"\"\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4d15e8a7450312debdb953689095f30fe33900d", "html_url": "https://github.com/rust-lang/rust/commit/d4d15e8a7450312debdb953689095f30fe33900d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4d15e8a7450312debdb953689095f30fe33900d/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "691a5f388396d4cad18421dba55ac770f7e7a7f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/691a5f388396d4cad18421dba55ac770f7e7a7f9", "html_url": "https://github.com/rust-lang/rust/commit/691a5f388396d4cad18421dba55ac770f7e7a7f9"}, {"sha": "cac7e42b5278ad46214c741f01e537dff1fa9372", "url": "https://api.github.com/repos/rust-lang/rust/commits/cac7e42b5278ad46214c741f01e537dff1fa9372", "html_url": "https://github.com/rust-lang/rust/commit/cac7e42b5278ad46214c741f01e537dff1fa9372"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "8ede91cf8f4f4493caa8c0d386f7b53093878eaa", "filename": "tests/rustdoc-ui/ice-bug-report-url.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d4d15e8a7450312debdb953689095f30fe33900d/tests%2Frustdoc-ui%2Fice-bug-report-url.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4d15e8a7450312debdb953689095f30fe33900d/tests%2Frustdoc-ui%2Fice-bug-report-url.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-ui%2Fice-bug-report-url.rs?ref=d4d15e8a7450312debdb953689095f30fe33900d", "patch": "@@ -6,8 +6,8 @@\n // normalize-stderr-test \"note: compiler flags.*\\n\\n\" -> \"\"\n // normalize-stderr-test \"note: rustc.*running on.*\" -> \"note: rustc {version} running on {platform}\"\n // normalize-stderr-test \"thread.*panicked at .*, compiler.*\" -> \"thread panicked at 'aborting due to `-Z treat-err-as-bug`'\"\n-// normalize-stderr-test \"\\s*\\d{1,}: .*\\n\" -> \"\"\n-// normalize-stderr-test \"\\s at .*\\n\" -> \"\"\n+// normalize-stderr-test \" +\\d{1,}: .*\\n\" -> \"\"\n+// normalize-stderr-test \" + at .*\\n\" -> \"\"\n // normalize-stderr-test \".*note: Some details are omitted.*\\n\" -> \"\"\n \n fn wrong()"}, {"sha": "98c08b9a8944b7962c0c9669abf8aa9c2acb8a2a", "filename": "tests/rustdoc-ui/ice-bug-report-url.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d4d15e8a7450312debdb953689095f30fe33900d/tests%2Frustdoc-ui%2Fice-bug-report-url.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d4d15e8a7450312debdb953689095f30fe33900d/tests%2Frustdoc-ui%2Fice-bug-report-url.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-ui%2Fice-bug-report-url.stderr?ref=d4d15e8a7450312debdb953689095f30fe33900d", "patch": "@@ -6,6 +6,7 @@ LL | fn wrong()\n \n thread panicked at 'aborting due to `-Z treat-err-as-bug`'\n stack backtrace:\n+\n error: the compiler unexpectedly panicked. this is a bug.\n \n note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-rustdoc&template=ice.md"}]}