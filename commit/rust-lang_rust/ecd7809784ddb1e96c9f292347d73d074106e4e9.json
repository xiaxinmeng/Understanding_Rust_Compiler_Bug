{"sha": "ecd7809784ddb1e96c9f292347d73d074106e4e9", "node_id": "C_kwDOAAsO6NoAKGVjZDc4MDk3ODRkZGIxZTk2YzlmMjkyMzQ3ZDczZDA3NDEwNmU0ZTk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-06-02T19:21:56Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-06-02T19:22:25Z"}, "message": "Don't ICE in new solver when auto traits have associated types", "tree": {"sha": "47a0333a790990d451627d38e9c5f226cd6800b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47a0333a790990d451627d38e9c5f226cd6800b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ecd7809784ddb1e96c9f292347d73d074106e4e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ecd7809784ddb1e96c9f292347d73d074106e4e9", "html_url": "https://github.com/rust-lang/rust/commit/ecd7809784ddb1e96c9f292347d73d074106e4e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ecd7809784ddb1e96c9f292347d73d074106e4e9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9baa16482ba4100df529ccba39c787f27ad0475", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9baa16482ba4100df529ccba39c787f27ad0475", "html_url": "https://github.com/rust-lang/rust/commit/a9baa16482ba4100df529ccba39c787f27ad0475"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "becd84e79e12c8072075d4e86f85715c39d83de6", "filename": "compiler/rustc_trait_selection/src/solve/project_goals.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ecd7809784ddb1e96c9f292347d73d074106e4e9/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fproject_goals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ecd7809784ddb1e96c9f292347d73d074106e4e9/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fproject_goals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fproject_goals.rs?ref=ecd7809784ddb1e96c9f292347d73d074106e4e9", "patch": "@@ -193,10 +193,14 @@ impl<'tcx> assembly::GoalKind<'tcx> for ProjectionPredicate<'tcx> {\n     }\n \n     fn consider_auto_trait_candidate(\n-        _ecx: &mut EvalCtxt<'_, 'tcx>,\n+        ecx: &mut EvalCtxt<'_, 'tcx>,\n         goal: Goal<'tcx, Self>,\n     ) -> QueryResult<'tcx> {\n-        bug!(\"auto traits do not have associated types: {:?}\", goal);\n+        ecx.tcx().sess.delay_span_bug(\n+            ecx.tcx().def_span(goal.predicate.def_id()),\n+            \"associated types not allowed on auto traits\",\n+        );\n+        Err(NoSolution)\n     }\n \n     fn consider_trait_alias_candidate("}, {"sha": "a57c6d9b0cbf9c631760bff757a330d5099e9a7c", "filename": "tests/ui/auto-traits/issue-23080-2.current.stderr", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.current.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.current.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fissue-23080-2.current.stderr?ref=ecd7809784ddb1e96c9f292347d73d074106e4e9", "patch": "@@ -1,5 +1,5 @@\n error[E0380]: auto traits cannot have associated items\n-  --> $DIR/issue-23080-2.rs:5:10\n+  --> $DIR/issue-23080-2.rs:8:10\n    |\n LL | unsafe auto trait Trait {\n    |                   ----- auto traits cannot have associated items", "previous_filename": "tests/ui/auto-traits/issue-23080-2.stderr"}, {"sha": "a57c6d9b0cbf9c631760bff757a330d5099e9a7c", "filename": "tests/ui/auto-traits/issue-23080-2.next.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.next.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.next.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fissue-23080-2.next.stderr?ref=ecd7809784ddb1e96c9f292347d73d074106e4e9", "patch": "@@ -0,0 +1,11 @@\n+error[E0380]: auto traits cannot have associated items\n+  --> $DIR/issue-23080-2.rs:8:10\n+   |\n+LL | unsafe auto trait Trait {\n+   |                   ----- auto traits cannot have associated items\n+LL |     type Output;\n+   |     -----^^^^^^- help: remove these associated items\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0380`."}, {"sha": "882b8f3938428e2e7313d94e77c4bdcdf5a604d4", "filename": "tests/ui/auto-traits/issue-23080-2.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ecd7809784ddb1e96c9f292347d73d074106e4e9/tests%2Fui%2Fauto-traits%2Fissue-23080-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fissue-23080-2.rs?ref=ecd7809784ddb1e96c9f292347d73d074106e4e9", "patch": "@@ -1,3 +1,6 @@\n+// revisions: current next\n+//[next] compile-flags: -Ztrait-solver=next\n+\n #![feature(auto_traits)]\n #![feature(negative_impls)]\n "}]}