{"sha": "a7665b2ae1df56ca81d142abafcb8826cbbf79bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3NjY1YjJhZTFkZjU2Y2E4MWQxNDJhYmFmY2I4ODI2Y2JiZjc5YmM=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-02T16:46:27Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-02T16:46:27Z"}, "message": "Correct drop-ty path; many tests now run.", "tree": {"sha": "277bfa7c385b1bf51ded186ab7057acd6037336d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/277bfa7c385b1bf51ded186ab7057acd6037336d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7665b2ae1df56ca81d142abafcb8826cbbf79bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7665b2ae1df56ca81d142abafcb8826cbbf79bc", "html_url": "https://github.com/rust-lang/rust/commit/a7665b2ae1df56ca81d142abafcb8826cbbf79bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7665b2ae1df56ca81d142abafcb8826cbbf79bc/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9037af22d29163246659f4d59291009e0d00f78", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9037af22d29163246659f4d59291009e0d00f78", "html_url": "https://github.com/rust-lang/rust/commit/d9037af22d29163246659f4d59291009e0d00f78"}], "stats": {"total": 16, "additions": 5, "deletions": 11}, "files": [{"sha": "fdbe6f45ac6387bc610d408f335a22e6ea4c0e58", "filename": "src/boot/me/trans.ml", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a7665b2ae1df56ca81d142abafcb8826cbbf79bc/src%2Fboot%2Fme%2Ftrans.ml", "raw_url": "https://github.com/rust-lang/rust/raw/a7665b2ae1df56ca81d142abafcb8826cbbf79bc/src%2Fboot%2Fme%2Ftrans.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fme%2Ftrans.ml?ref=a7665b2ae1df56ca81d142abafcb8826cbbf79bc", "patch": "@@ -1615,12 +1615,13 @@ let trans_visitor\n           (get_element_ptr_dyn ty_params (deref cell)\n              Abi.box_rc_slot_field_body)\n       in\n+      let body_ty = simplified_ty ty in\n       let vr = next_vreg_cell Il.voidptr_t in\n         lea vr body_mem;\n-        note_drop_step ty \"in free-glue, calling drop-glue on body\";\n+        note_drop_step body_ty \"in free-glue, calling drop-glue on body\";\n         trace_word cx.ctxt_sess.Session.sess_trace_drop vr;\n         trans_call_simple_static_glue\n-          (get_drop_glue ty curr_iso) ty_params vr;\n+          (get_drop_glue body_ty curr_iso) ty_params vr;\n         note_drop_step ty \"back in free-glue, calling free\";\n         trans_free cell is_gc;\n         trace_str cx.ctxt_sess.Session.sess_trace_drop\n@@ -2525,15 +2526,8 @@ let trans_visitor\n \n             | MEM_interior when type_is_structured ty ->\n                 note_drop_step ty \"in structured-interior path of drop_ty\";\n-                (iflog (fun _ ->\n-                          annotate (\"drop interior memory \" ^\n-                                      (Fmt.fmt_to_str Ast.fmt_ty ty))));\n-                let (mem, _) = need_mem_cell cell in\n-                let vr = next_vreg_cell Il.voidptr_t in\n-                  lea vr mem;\n-                  trans_call_simple_static_glue\n-                    (get_drop_glue ty curr_iso)\n-                    ty_params vr\n+                iter_ty_parts ty_params cell ty\n+                  (drop_ty ty_params) curr_iso\n \n             | MEM_interior ->\n                 note_drop_step ty \"in simple-interior path of drop_ty\";"}]}