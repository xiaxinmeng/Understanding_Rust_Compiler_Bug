{"sha": "9f53cec1da6ae9ed8735e28fca09837a0cef7667", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmNTNjZWMxZGE2YWU5ZWQ4NzM1ZTI4ZmNhMDk4MzdhMGNlZjc2Njc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-03-25T17:41:46Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-03-25T18:35:46Z"}, "message": "Cleanup memory usage stats", "tree": {"sha": "6b60bb49f5b7468cf3165cc74472309e9c6a92b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b60bb49f5b7468cf3165cc74472309e9c6a92b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f53cec1da6ae9ed8735e28fca09837a0cef7667", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f53cec1da6ae9ed8735e28fca09837a0cef7667", "html_url": "https://github.com/rust-lang/rust/commit/9f53cec1da6ae9ed8735e28fca09837a0cef7667", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f53cec1da6ae9ed8735e28fca09837a0cef7667/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d38d4dc9445de783d5efbc72fbdceaa094f23c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d38d4dc9445de783d5efbc72fbdceaa094f23c3", "html_url": "https://github.com/rust-lang/rust/commit/3d38d4dc9445de783d5efbc72fbdceaa094f23c3"}], "stats": {"total": 27, "additions": 16, "deletions": 11}, "files": [{"sha": "ec931b34fe87314bae30dd0ced2291ed00e84403", "filename": "crates/ra_hir/src/db.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fdb.rs?ref=9f53cec1da6ae9ed8735e28fca09837a0cef7667", "patch": "@@ -10,15 +10,16 @@ pub use hir_def::db::{\n     TraitDataQuery, TypeAliasDataQuery, UnionDataQuery,\n };\n pub use hir_expand::db::{\n-    AstDatabase, AstDatabaseStorage, AstIdMapQuery, InternMacroQuery, MacroArgQuery, MacroDefQuery,\n-    MacroExpandQuery, ParseMacroQuery,\n+    AstDatabase, AstDatabaseStorage, AstIdMapQuery, InternEagerExpansionQuery, InternMacroQuery,\n+    MacroArgQuery, MacroDefQuery, MacroExpandQuery, ParseMacroQuery,\n };\n pub use hir_ty::db::{\n     AssociatedTyDataQuery, AssociatedTyValueQuery, CallableItemSignatureQuery, FieldTypesQuery,\n     GenericDefaultsQuery, GenericPredicatesForParamQuery, GenericPredicatesQuery, HirDatabase,\n     HirDatabaseStorage, ImplDatumQuery, ImplSelfTyQuery, ImplTraitQuery, ImplsForTraitQuery,\n     ImplsInCrateQuery, InferQueryQuery, InternAssocTyValueQuery, InternChalkImplQuery,\n-    InternTypeCtorQuery, StructDatumQuery, TraitDatumQuery, TraitSolveQuery, TyQuery, ValueTyQuery,\n+    InternTypeCtorQuery, InternTypeParamIdQuery, StructDatumQuery, TraitDatumQuery,\n+    TraitSolveQuery, TyQuery, ValueTyQuery,\n };\n \n #[test]"}, {"sha": "5dc7395f5e8048b2962444d4873b3dd07c4ae1b0", "filename": "crates/ra_hir_def/src/db.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir_def%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir_def%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fdb.rs?ref=9f53cec1da6ae9ed8735e28fca09837a0cef7667", "patch": "@@ -48,6 +48,7 @@ pub trait DefDatabase: InternDatabase + AstDatabase + Upcast<dyn AstDatabase> {\n     fn raw_items(&self, file_id: HirFileId) -> Arc<RawItems>;\n \n     #[salsa::invoke(crate_def_map_wait)]\n+    #[salsa::transparent]\n     fn crate_def_map(&self, krate: CrateId) -> Arc<CrateDefMap>;\n \n     #[salsa::invoke(CrateDefMap::crate_def_map_query)]\n@@ -109,12 +110,6 @@ pub trait DefDatabase: InternDatabase + AstDatabase + Upcast<dyn AstDatabase> {\n     fn documentation(&self, def: AttrDefId) -> Option<Documentation>;\n }\n \n-// impl<T: DefDatabase> Upcast<dyn AstDatabase> for T {\n-//     fn upcast(&self) -> &dyn AstDatabase {\n-//         &*self\n-//     }\n-// }\n-\n fn crate_def_map_wait(db: &impl DefDatabase, krate: CrateId) -> Arc<CrateDefMap> {\n     let _p = profile(\"crate_def_map:wait\");\n     db.crate_def_map_query(krate)"}, {"sha": "1462b053f0cd9681b4cc8eba78229604d368ebed", "filename": "crates/ra_hir_ty/src/db.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir_ty%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_hir_ty%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fdb.rs?ref=9f53cec1da6ae9ed8735e28fca09837a0cef7667", "patch": "@@ -22,6 +22,7 @@ use hir_expand::name::Name;\n #[salsa::requires(salsa::Database)]\n pub trait HirDatabase: DefDatabase + Upcast<dyn DefDatabase> {\n     #[salsa::invoke(infer_wait)]\n+    #[salsa::transparent]\n     fn infer(&self, def: DefWithBodyId) -> Arc<InferenceResult>;\n \n     #[salsa::invoke(crate::infer::infer_query)]"}, {"sha": "8446ef88e8c58ff78d0d47a658a9ce89e25535a0", "filename": "crates/ra_ide_db/src/change.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_ide_db%2Fsrc%2Fchange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f53cec1da6ae9ed8735e28fca09837a0cef7667/crates%2Fra_ide_db%2Fsrc%2Fchange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fchange.rs?ref=9f53cec1da6ae9ed8735e28fca09837a0cef7667", "patch": "@@ -311,6 +311,7 @@ impl RootDatabase {\n             hir::db::MacroDefQuery\n             hir::db::ParseMacroQuery\n             hir::db::MacroExpandQuery\n+            hir::db::InternEagerExpansionQuery\n \n             // DefDatabase\n             hir::db::RawItemsQuery\n@@ -359,14 +360,21 @@ impl RootDatabase {\n             hir::db::ImplsInCrateQuery\n             hir::db::ImplsForTraitQuery\n             hir::db::InternTypeCtorQuery\n+            hir::db::InternTypeParamIdQuery\n             hir::db::InternChalkImplQuery\n             hir::db::InternAssocTyValueQuery\n             hir::db::AssociatedTyDataQuery\n-            hir::db::AssociatedTyValueQuery\n-            hir::db::TraitSolveQuery\n             hir::db::TraitDatumQuery\n             hir::db::StructDatumQuery\n             hir::db::ImplDatumQuery\n+            hir::db::AssociatedTyValueQuery\n+            hir::db::TraitSolveQuery\n+\n+            // SymbolsDatabase\n+            crate::symbol_index::FileSymbolsQuery\n+\n+            // LineIndexDatabase\n+            crate::LineIndexQuery\n         ];\n         acc.sort_by_key(|it| std::cmp::Reverse(it.1));\n         acc"}]}