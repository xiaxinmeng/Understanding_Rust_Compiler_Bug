{"sha": "337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzN2FmNWVmN2EzMTg1NWZkN2Y2ZDZiNzdjOWU1MmQ2ZDc0N2MzNTA=", "commit": {"author": {"name": "Christoph Schmidler", "email": "c.schmidler@gmail.com", "date": "2019-12-12T16:23:14Z"}, "committer": {"name": "Christoph Schmidler", "email": "c.schmidler@gmail.com", "date": "2020-03-05T07:09:52Z"}, "message": "Prepare const_limit feature gate and attribute", "tree": {"sha": "336c013d30a7e338a35ac597f406b0c45f104a23", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/336c013d30a7e338a35ac597f406b0c45f104a23"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "html_url": "https://github.com/rust-lang/rust/commit/337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/comments", "author": {"login": "TheSamsa", "id": 13667299, "node_id": "MDQ6VXNlcjEzNjY3Mjk5", "avatar_url": "https://avatars.githubusercontent.com/u/13667299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheSamsa", "html_url": "https://github.com/TheSamsa", "followers_url": "https://api.github.com/users/TheSamsa/followers", "following_url": "https://api.github.com/users/TheSamsa/following{/other_user}", "gists_url": "https://api.github.com/users/TheSamsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheSamsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheSamsa/subscriptions", "organizations_url": "https://api.github.com/users/TheSamsa/orgs", "repos_url": "https://api.github.com/users/TheSamsa/repos", "events_url": "https://api.github.com/users/TheSamsa/events{/privacy}", "received_events_url": "https://api.github.com/users/TheSamsa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TheSamsa", "id": 13667299, "node_id": "MDQ6VXNlcjEzNjY3Mjk5", "avatar_url": "https://avatars.githubusercontent.com/u/13667299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheSamsa", "html_url": "https://github.com/TheSamsa", "followers_url": "https://api.github.com/users/TheSamsa/followers", "following_url": "https://api.github.com/users/TheSamsa/following{/other_user}", "gists_url": "https://api.github.com/users/TheSamsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheSamsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheSamsa/subscriptions", "organizations_url": "https://api.github.com/users/TheSamsa/orgs", "repos_url": "https://api.github.com/users/TheSamsa/repos", "events_url": "https://api.github.com/users/TheSamsa/events{/privacy}", "received_events_url": "https://api.github.com/users/TheSamsa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75cf41afb468152611212271bae026948cd3ba46", "url": "https://api.github.com/repos/rust-lang/rust/commits/75cf41afb468152611212271bae026948cd3ba46", "html_url": "https://github.com/rust-lang/rust/commit/75cf41afb468152611212271bae026948cd3ba46"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "2fc5963dc6e0bdfb4bacc7b1ae3d1abf56fa5d6e", "filename": "src/doc/unstable-book/src/language-features/const-limit.md", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fconst-limit.md", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fconst-limit.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fconst-limit.md?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -0,0 +1,7 @@\n+# `const_limit`\n+\n+The tracking issue for this feature is: [#67217]\n+\n+[#57563]: https://github.com/rust-lang/rust/issues/67217\n+\n+The `const_limit` allows someone to limit the evaluation steps the CTFE undertakes to evaluate a `const fn`.\n\\ No newline at end of file"}, {"sha": "a831d99d4ed009bae1c88951df5052f992038aee", "filename": "src/librustc/middle/limits.rs", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc%2Fmiddle%2Flimits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc%2Fmiddle%2Flimits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flimits.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -1,4 +1,4 @@\n-// Recursion limit.\n+// Registering limits, recursion_limit, type_length_limit and const_limit\n //\n // There are various parts of the compiler that must impose arbitrary limits\n // on how deeply they recurse to prevent stack overflow. Users can override\n@@ -16,6 +16,7 @@ use rustc_data_structures::sync::Once;\n pub fn update_limits(sess: &Session, krate: &ast::Crate) {\n     update_limit(sess, krate, &sess.recursion_limit, sym::recursion_limit, 128);\n     update_limit(sess, krate, &sess.type_length_limit, sym::type_length_limit, 1048576);\n+    update_limit(sess, krate, &sess.const_limit, sym::const_limit, 128);\n }\n \n fn update_limit(", "previous_filename": "src/librustc/middle/recursion_limit.rs"}, {"sha": "2f9394cd566fb8c20907efdbc98625b36ebd1f7f", "filename": "src/librustc_feature/active.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_feature%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_feature%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_feature%2Factive.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -532,6 +532,9 @@ declare_features! (\n     /// Allows using `&mut` in constant functions.\n     (active, const_mut_refs, \"1.41.0\", Some(57349), None),\n \n+    // Allows limiting the evaluation steps of const expressions\n+    (active, const_limit, \"1.41.0\", Some(67217), None),\n+\n     /// Allows the use of `loop` and `while` in constants.\n     (active, const_loop, \"1.41.0\", Some(52000), None),\n "}, {"sha": "2b79f6bd942b0a949fbc67c6d4d2a3d7d920e061", "filename": "src/librustc_feature/builtin_attrs.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_feature%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_feature%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_feature%2Fbuiltin_attrs.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -239,6 +239,10 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n     // Limits:\n     ungated!(recursion_limit, CrateLevel, template!(NameValueStr: \"N\")),\n     ungated!(type_length_limit, CrateLevel, template!(NameValueStr: \"N\")),\n+    gated!(\n+        const_limit, CrateLevel, template!(NameValueStr: \"N\"), const_limit,\n+        experimental!(const_limit)\n+    ),\n \n     // Entry point:\n     ungated!(main, Normal, template!(Word)),"}, {"sha": "a8879f00c802ac84928d85f0b6b7b02da1bc3e60", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -88,6 +88,9 @@ pub struct Session {\n     /// The maximum length of types during monomorphization.\n     pub type_length_limit: Once<usize>,\n \n+    /// The maximum blocks a const expression can evaluate.\n+    pub const_limit: Once<usize>,\n+\n     /// Map from imported macro spans (which consist of\n     /// the localized span for the macro body) to the\n     /// macro name and definition span in the source crate.\n@@ -1053,6 +1056,7 @@ fn build_session_(\n         features: Once::new(),\n         recursion_limit: Once::new(),\n         type_length_limit: Once::new(),\n+        const_limit: Once::new(),\n         imported_macro_spans: OneThread::new(RefCell::new(FxHashMap::default())),\n         incr_comp_session: OneThread::new(RefCell::new(IncrCompSession::NotInitialized)),\n         cgu_reuse_tracker,"}, {"sha": "e92e2fc1d43f2c5eefdc5955bd90ad8d00dad412", "filename": "src/librustc_span/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_span%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Flibrustc_span%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fsymbol.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -208,6 +208,7 @@ symbols! {\n         console,\n         const_compare_raw_pointers,\n         const_constructor,\n+        const_limit,\n         const_extern_fn,\n         const_fn,\n         const_fn_union,"}, {"sha": "11d2b6af25d25555c09bc051f69aa0d8980daa21", "filename": "src/test/ui/consts/const_limit/feature-gate-const_limit.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.rs?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -0,0 +1,12 @@\n+#![const_limit=\"1\"]\n+//~^ ERROR the `#[const_limit]` attribute is an experimental feature [E0658]\n+\n+const CONSTANT: usize = limit();\n+\n+fn main() {}\n+\n+const fn limit() -> usize {\n+    let x = 42;\n+\n+    x * 42\n+}"}, {"sha": "db248994b477925a849451a65d3b69202494ad06", "filename": "src/test/ui/consts/const_limit/feature-gate-const_limit.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/337af5ef7a31855fd7f6d6b77c9e52d6d747c350/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst_limit%2Ffeature-gate-const_limit.stderr?ref=337af5ef7a31855fd7f6d6b77c9e52d6d747c350", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: the `#[const_limit]` attribute is an experimental feature\n+  --> $DIR/feature-gate-const_limit.rs:1:1\n+   |\n+LL | #![const_limit=\"1\"]\n+   | ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/67217\n+   = help: add `#![feature(const_limit)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}