{"sha": "12f28f6276bbf1d1a19a553c7352bcb974361247", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyZjI4ZjYyNzZiYmYxZDFhMTlhNTUzYzczNTJiY2I5NzQzNjEyNDc=", "commit": {"author": {"name": "Roberto Vidal", "email": "vidal.roberto.j@gmail.com", "date": "2019-04-15T19:41:27Z"}, "committer": {"name": "Roberto Vidal", "email": "vidal.roberto.j@gmail.com", "date": "2019-04-16T20:07:33Z"}, "message": "Adds \"restart server\" command", "tree": {"sha": "a3d72ba73e95c80ff24c59d5f546bf8baa0378f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a3d72ba73e95c80ff24c59d5f546bf8baa0378f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12f28f6276bbf1d1a19a553c7352bcb974361247", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12f28f6276bbf1d1a19a553c7352bcb974361247", "html_url": "https://github.com/rust-lang/rust/commit/12f28f6276bbf1d1a19a553c7352bcb974361247", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12f28f6276bbf1d1a19a553c7352bcb974361247/comments", "author": {"login": "jrvidal", "id": 1636604, "node_id": "MDQ6VXNlcjE2MzY2MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1636604?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrvidal", "html_url": "https://github.com/jrvidal", "followers_url": "https://api.github.com/users/jrvidal/followers", "following_url": "https://api.github.com/users/jrvidal/following{/other_user}", "gists_url": "https://api.github.com/users/jrvidal/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrvidal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrvidal/subscriptions", "organizations_url": "https://api.github.com/users/jrvidal/orgs", "repos_url": "https://api.github.com/users/jrvidal/repos", "events_url": "https://api.github.com/users/jrvidal/events{/privacy}", "received_events_url": "https://api.github.com/users/jrvidal/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jrvidal", "id": 1636604, "node_id": "MDQ6VXNlcjE2MzY2MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1636604?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrvidal", "html_url": "https://github.com/jrvidal", "followers_url": "https://api.github.com/users/jrvidal/followers", "following_url": "https://api.github.com/users/jrvidal/following{/other_user}", "gists_url": "https://api.github.com/users/jrvidal/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrvidal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrvidal/subscriptions", "organizations_url": "https://api.github.com/users/jrvidal/orgs", "repos_url": "https://api.github.com/users/jrvidal/repos", "events_url": "https://api.github.com/users/jrvidal/events{/privacy}", "received_events_url": "https://api.github.com/users/jrvidal/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "546d9be2a7bf7b3942c125f922a01321aea6ad26", "url": "https://api.github.com/repos/rust-lang/rust/commits/546d9be2a7bf7b3942c125f922a01321aea6ad26", "html_url": "https://github.com/rust-lang/rust/commit/546d9be2a7bf7b3942c125f922a01321aea6ad26"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "c5fe5b83a0940cf609b26cd31f3277cbc39b52e7", "filename": "crates/gen_lsp_server/src/stdio.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/12f28f6276bbf1d1a19a553c7352bcb974361247/crates%2Fgen_lsp_server%2Fsrc%2Fstdio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12f28f6276bbf1d1a19a553c7352bcb974361247/crates%2Fgen_lsp_server%2Fsrc%2Fstdio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fgen_lsp_server%2Fsrc%2Fstdio.rs?ref=12f28f6276bbf1d1a19a553c7352bcb974361247", "patch": "@@ -37,11 +37,9 @@ pub struct Threads {\n }\n \n impl Threads {\n-    pub fn join(self) -> Result<()> {\n-        match self.reader.join() {\n-            Ok(r) => r?,\n-            Err(_) => bail!(\"reader panicked\"),\n-        }\n+    pub fn exit(self) -> Result<()> {\n+        // We can't rely on stdin being closed\n+        drop(self.reader);\n         match self.writer.join() {\n             Ok(r) => r,\n             Err(_) => bail!(\"writer panicked\"),"}, {"sha": "6b1274a3b2a4682a271a0c54fd9da217b1c03a09", "filename": "crates/ra_lsp_server/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/12f28f6276bbf1d1a19a553c7352bcb974361247/crates%2Fra_lsp_server%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12f28f6276bbf1d1a19a553c7352bcb974361247/crates%2Fra_lsp_server%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain.rs?ref=12f28f6276bbf1d1a19a553c7352bcb974361247", "patch": "@@ -54,7 +54,7 @@ fn main_inner() -> Result<()> {\n         ra_lsp_server::main_loop(workspace_roots, opts, r, s)\n     })?;\n     log::info!(\"shutting down IO...\");\n-    threads.join()?;\n+    threads.exit()?;\n     log::info!(\"... IO is down\");\n     Ok(())\n }"}, {"sha": "a0454191a15cb0197583cb95603856347dcc130c", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/12f28f6276bbf1d1a19a553c7352bcb974361247/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/12f28f6276bbf1d1a19a553c7352bcb974361247/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=12f28f6276bbf1d1a19a553c7352bcb974361247", "patch": "@@ -114,6 +114,11 @@\n                 \"command\": \"rust-analyzer.collectGarbage\",\n                 \"title\": \"Run garbage collection\",\n                 \"category\": \"Rust Analyzer\"\n+            },\n+            {\n+                \"command\": \"rust-analyzer.reload\",\n+                \"title\": \"Restart server\",\n+                \"category\": \"Rust Analyzer\"\n             }\n         ],\n         \"keybindings\": ["}, {"sha": "db67bc7e3a94322d4fe7441c46c561ae96314be6", "filename": "editors/code/src/extension.ts", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/12f28f6276bbf1d1a19a553c7352bcb974361247/editors%2Fcode%2Fsrc%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/12f28f6276bbf1d1a19a553c7352bcb974361247/editors%2Fcode%2Fsrc%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fextension.ts?ref=12f28f6276bbf1d1a19a553c7352bcb974361247", "patch": "@@ -120,11 +120,16 @@ export function activate(context: vscode.ExtensionContext) {\n         context.subscriptions\n     );\n \n+    const startServer = () => Server.start(allNotifications);\n+    const reloadCommand = () => reloadServer(startServer);\n+\n+    vscode.commands.registerCommand('rust-analyzer.reload', reloadCommand);\n+\n     // Executing `cargo watch` provides us with inline diagnostics on save\n     interactivelyStartCargoWatch(context);\n \n     // Start the language server, finally!\n-    Server.start(allNotifications);\n+    startServer();\n }\n \n export function deactivate(): Thenable<void> {\n@@ -133,3 +138,12 @@ export function deactivate(): Thenable<void> {\n     }\n     return Server.client.stop();\n }\n+\n+\n+async function reloadServer(startServer: () => void) {\n+    if (Server.client != null) {\n+        vscode.window.showInformationMessage('Reloading rust-analyzer...');\n+        await Server.client.stop();\n+        startServer();\n+    }\n+}\n\\ No newline at end of file"}]}