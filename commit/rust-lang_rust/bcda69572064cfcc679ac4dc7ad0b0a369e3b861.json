{"sha": "bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjZGE2OTU3MjA2NGNmY2M2NzlhYzRkYzdhZDBiMGEzNjllM2I4NjE=", "commit": {"author": {"name": "Basile Desloges", "email": "basile.desloges@gmail.com", "date": "2017-09-28T14:44:23Z"}, "committer": {"name": "Basile Desloges", "email": "basile.desloges@gmail.com", "date": "2017-09-29T13:41:26Z"}, "message": "mir-borrowck: Move span_label calls for `cannot_assign_to_borrowed()` inside `borrowck_errors.rs`", "tree": {"sha": "8c518049c17e70229e378bd4f28619e6315e380e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c518049c17e70229e378bd4f28619e6315e380e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "html_url": "https://github.com/rust-lang/rust/commit/bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/comments", "author": {"login": "zilbuz", "id": 434964, "node_id": "MDQ6VXNlcjQzNDk2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/434964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zilbuz", "html_url": "https://github.com/zilbuz", "followers_url": "https://api.github.com/users/zilbuz/followers", "following_url": "https://api.github.com/users/zilbuz/following{/other_user}", "gists_url": "https://api.github.com/users/zilbuz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zilbuz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zilbuz/subscriptions", "organizations_url": "https://api.github.com/users/zilbuz/orgs", "repos_url": "https://api.github.com/users/zilbuz/repos", "events_url": "https://api.github.com/users/zilbuz/events{/privacy}", "received_events_url": "https://api.github.com/users/zilbuz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zilbuz", "id": 434964, "node_id": "MDQ6VXNlcjQzNDk2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/434964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zilbuz", "html_url": "https://github.com/zilbuz", "followers_url": "https://api.github.com/users/zilbuz/followers", "following_url": "https://api.github.com/users/zilbuz/following{/other_user}", "gists_url": "https://api.github.com/users/zilbuz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zilbuz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zilbuz/subscriptions", "organizations_url": "https://api.github.com/users/zilbuz/orgs", "repos_url": "https://api.github.com/users/zilbuz/repos", "events_url": "https://api.github.com/users/zilbuz/events{/privacy}", "received_events_url": "https://api.github.com/users/zilbuz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d514263ce3b136775f6e8ec4b94cc1073d16c892", "url": "https://api.github.com/repos/rust-lang/rust/commits/d514263ce3b136775f6e8ec4b94cc1073d16c892", "html_url": "https://github.com/rust-lang/rust/commit/d514263ce3b136775f6e8ec4b94cc1073d16c892"}], "stats": {"total": 27, "additions": 10, "deletions": 17}, "files": [{"sha": "0036a74c861dfe94d8c086238320cbc472375086", "filename": "src/librustc_borrowck/borrowck/check_loans.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs?ref=bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "patch": "@@ -865,13 +865,7 @@ impl<'a, 'tcx> CheckLoanCtxt<'a, 'tcx> {\n                                    loan_path: &LoanPath<'tcx>,\n                                    loan: &Loan) {\n         self.bccx.cannot_assign_to_borrowed(\n-            span, &self.bccx.loan_path_to_string(loan_path), Origin::Ast)\n-            .span_label(loan.span,\n-                       format!(\"borrow of `{}` occurs here\",\n-                               self.bccx.loan_path_to_string(loan_path)))\n-            .span_label(span,\n-                       format!(\"assignment to borrowed `{}` occurs here\",\n-                               self.bccx.loan_path_to_string(loan_path)))\n+            span, loan.span, &self.bccx.loan_path_to_string(loan_path), Origin::Ast)\n             .emit();\n     }\n }"}, {"sha": "d2ab00a46c79b9be993c5ca8a022fb3052614fa1", "filename": "src/librustc_mir/borrow_check.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_mir%2Fborrow_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_mir%2Fborrow_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check.rs?ref=bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "patch": "@@ -991,14 +991,8 @@ impl<'c, 'b, 'a: 'b+'c, 'gcx, 'tcx: 'a> MirBorrowckCtxt<'c, 'b, 'a, 'gcx, 'tcx>\n                                            _: Context,\n                                            (lvalue, span): (&Lvalue, Span),\n                                            loan: &BorrowData) {\n-        let describe_lvalue = self.describe_lvalue(lvalue);\n-        let borrow_span = self.retrieve_borrow_span(loan);\n-\n         let mut err = self.tcx.cannot_assign_to_borrowed(\n-            span, &self.describe_lvalue(lvalue), Origin::Mir);\n-\n-        err.span_label(borrow_span, format!(\"borrow of `{}` occurs here\", describe_lvalue));\n-        err.span_label(span, format!(\"assignment to borrowed `{}` occurs here\", describe_lvalue));\n+            span, self.retrieve_borrow_span(loan), &self.describe_lvalue(lvalue), Origin::Mir);\n \n         err.emit();\n     }"}, {"sha": "7aec361e892c09b9c26541e344d5cc05c5e4455b", "filename": "src/librustc_mir/util/borrowck_errors.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bcda69572064cfcc679ac4dc7ad0b0a369e3b861/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fborrowck_errors.rs?ref=bcda69572064cfcc679ac4dc7ad0b0a369e3b861", "patch": "@@ -140,12 +140,17 @@ pub trait BorrowckErrors {\n                          desc_new, msg_new, kind_new, noun_old, kind_old, msg_old, OGN=o)\n     }\n \n-    fn cannot_assign_to_borrowed(&self, span: Span, desc: &str, o: Origin)\n+    fn cannot_assign_to_borrowed(&self, span: Span, borrow_span: Span, desc: &str, o: Origin)\n                                  -> DiagnosticBuilder\n     {\n-        struct_span_err!(self, span, E0506,\n+        let mut err = struct_span_err!(self, span, E0506,\n                          \"cannot assign to `{}` because it is borrowed{OGN}\",\n-                         desc, OGN=o)\n+                         desc, OGN=o);\n+\n+        err.span_label(borrow_span, format!(\"borrow of `{}` occurs here\", desc));\n+        err.span_label(span, format!(\"assignment to borrowed `{}` occurs here\", desc));\n+\n+        err\n     }\n \n     fn cannot_move_into_closure(&self, span: Span, desc: &str, o: Origin)"}]}