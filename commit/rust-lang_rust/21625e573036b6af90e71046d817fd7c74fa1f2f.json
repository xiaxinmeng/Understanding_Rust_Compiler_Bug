{"sha": "21625e573036b6af90e71046d817fd7c74fa1f2f", "node_id": "C_kwDOAAsO6NoAKDIxNjI1ZTU3MzAzNmI2YWY5MGU3MTA0NmQ4MTdmZDdjNzRmYTFmMmY", "commit": {"author": {"name": "Martin Kr\u00f6ning", "email": "mkroening@posteo.net", "date": "2022-06-01T22:16:00Z"}, "committer": {"name": "Martin Kr\u00f6ning", "email": "mkroening@posteo.net", "date": "2022-06-23T09:20:52Z"}, "message": "Session object: Set OS/ABI\n\nThis adapts LLVM's behavior of MCELFObjectTargetWriter::getOSABI [1].\n\n[1]: https://github.com/llvm/llvm-project/blob/8c8a2679a20f621994fa904bcfc68775e7345edc/llvm/include/llvm/MC/MCELFObjectWriter.h#L72-L86", "tree": {"sha": "73533a5966c2751b794eabe8500bb959934e5b7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/73533a5966c2751b794eabe8500bb959934e5b7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21625e573036b6af90e71046d817fd7c74fa1f2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21625e573036b6af90e71046d817fd7c74fa1f2f", "html_url": "https://github.com/rust-lang/rust/commit/21625e573036b6af90e71046d817fd7c74fa1f2f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21625e573036b6af90e71046d817fd7c74fa1f2f/comments", "author": {"login": "mkroening", "id": 28776973, "node_id": "MDQ6VXNlcjI4Nzc2OTcz", "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkroening", "html_url": "https://github.com/mkroening", "followers_url": "https://api.github.com/users/mkroening/followers", "following_url": "https://api.github.com/users/mkroening/following{/other_user}", "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions", "organizations_url": "https://api.github.com/users/mkroening/orgs", "repos_url": "https://api.github.com/users/mkroening/repos", "events_url": "https://api.github.com/users/mkroening/events{/privacy}", "received_events_url": "https://api.github.com/users/mkroening/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mkroening", "id": 28776973, "node_id": "MDQ6VXNlcjI4Nzc2OTcz", "avatar_url": "https://avatars.githubusercontent.com/u/28776973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkroening", "html_url": "https://github.com/mkroening", "followers_url": "https://api.github.com/users/mkroening/followers", "following_url": "https://api.github.com/users/mkroening/following{/other_user}", "gists_url": "https://api.github.com/users/mkroening/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkroening/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkroening/subscriptions", "organizations_url": "https://api.github.com/users/mkroening/orgs", "repos_url": "https://api.github.com/users/mkroening/repos", "events_url": "https://api.github.com/users/mkroening/events{/privacy}", "received_events_url": "https://api.github.com/users/mkroening/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7d12b4eec92b403909e4ae743fbb77e59ce3994", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7d12b4eec92b403909e4ae743fbb77e59ce3994", "html_url": "https://github.com/rust-lang/rust/commit/f7d12b4eec92b403909e4ae743fbb77e59ce3994"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "35819572fb9afd5f809f41bd140adf8d95542131", "filename": "Cargo.lock", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/21625e573036b6af90e71046d817fd7c74fa1f2f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/21625e573036b6af90e71046d817fd7c74fa1f2f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=21625e573036b6af90e71046d817fd7c74fa1f2f", "patch": "@@ -1688,6 +1688,7 @@ version = \"0.12.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"8c21d40587b92fa6a6c6e3c1bdbf87d75511db5672f9c93175574b3a00df1758\"\n dependencies = [\n+ \"ahash\",\n  \"compiler_builtins\",\n  \"rustc-std-workspace-alloc\",\n  \"rustc-std-workspace-core\",\n@@ -2539,6 +2540,18 @@ dependencies = [\n  \"memchr\",\n ]\n \n+[[package]]\n+name = \"object\"\n+version = \"0.29.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"21158b2c33aa6d4561f1c0a6ea283ca92bc54802a93b263e910746d679a7eb53\"\n+dependencies = [\n+ \"crc32fast\",\n+ \"hashbrown 0.12.0\",\n+ \"indexmap\",\n+ \"memchr\",\n+]\n+\n [[package]]\n name = \"odht\"\n version = \"0.3.1\"\n@@ -3664,7 +3677,7 @@ dependencies = [\n  \"itertools\",\n  \"jobserver\",\n  \"libc\",\n- \"object 0.28.4\",\n+ \"object 0.29.0\",\n  \"pathdiff\",\n  \"regex\",\n  \"rustc_apfloat\","}, {"sha": "8a3464286a4d066c9f03278468b71ca27ed282a9", "filename": "compiler/rustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/21625e573036b6af90e71046d817fd7c74fa1f2f/compiler%2Frustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/21625e573036b6af90e71046d817fd7c74fa1f2f/compiler%2Frustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2FCargo.toml?ref=21625e573036b6af90e71046d817fd7c74fa1f2f", "patch": "@@ -41,6 +41,6 @@ rustc_target = { path = \"../rustc_target\" }\n rustc_session = { path = \"../rustc_session\" }\n \n [dependencies.object]\n-version = \"0.28.4\"\n+version = \"0.29.0\"\n default-features = false\n features = [\"read_core\", \"elf\", \"macho\", \"pe\", \"unaligned\", \"archive\", \"write\"]"}, {"sha": "3dd607adee501107a4d434d0003aeb5d11680339", "filename": "compiler/rustc_codegen_ssa/src/back/metadata.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/21625e573036b6af90e71046d817fd7c74fa1f2f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21625e573036b6af90e71046d817fd7c74fa1f2f/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs?ref=21625e573036b6af90e71046d817fd7c74fa1f2f", "patch": "@@ -171,7 +171,15 @@ pub(crate) fn create_object_file(sess: &Session) -> Option<write::Object<'static\n         }\n         _ => 0,\n     };\n-    file.flags = FileFlags::Elf { e_flags };\n+    // adapted from LLVM's `MCELFObjectTargetWriter::getOSABI`\n+    let os_abi = match sess.target.options.os.as_ref() {\n+        \"hermit\" => elf::ELFOSABI_STANDALONE,\n+        \"freebsd\" => elf::ELFOSABI_FREEBSD,\n+        \"solaris\" => elf::ELFOSABI_SOLARIS,\n+        _ => elf::ELFOSABI_NONE,\n+    };\n+    let abi_version = 0;\n+    file.flags = FileFlags::Elf { os_abi, abi_version, e_flags };\n     Some(file)\n }\n "}]}