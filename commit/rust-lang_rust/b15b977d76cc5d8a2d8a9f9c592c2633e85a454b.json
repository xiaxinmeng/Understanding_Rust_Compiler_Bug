{"sha": "b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxNWI5NzdkNzZjYzVkOGEyZDhhOWY5YzU5MmMyNjMzZTg1YTQ1NGI=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-12-22T09:26:51Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-12-22T09:26:51Z"}, "message": "Fix `map_clone` false positive\n\nDon't lint when the item type is not a reference. `copied` only applies\nto references.", "tree": {"sha": "4e47ea9aa864223595d9516b4f01a4d189bce6f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e47ea9aa864223595d9516b4f01a4d189bce6f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "html_url": "https://github.com/rust-lang/rust/commit/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/comments", "author": null, "committer": null, "parents": [{"sha": "cfb332005845883f2abb50fe183fc91221bad9d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfb332005845883f2abb50fe183fc91221bad9d1", "html_url": "https://github.com/rust-lang/rust/commit/cfb332005845883f2abb50fe183fc91221bad9d1"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "7931fabf8d7183031a418d19e607ee8d231621a1", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "patch": "@@ -69,8 +69,10 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MapClone {\n                     hir::PatKind::Binding(hir::BindingAnnotation::Unannotated, .., name, None) => {\n                         match closure_expr.kind {\n                             hir::ExprKind::Unary(hir::UnOp::UnDeref, ref inner) => {\n-                                if ident_eq(name, inner) && !cx.tables.expr_ty(inner).is_box() {\n-                                    lint(cx, e.span, args[0].span, true);\n+                                if ident_eq(name, inner) {\n+                                    if let ty::Ref(..) = cx.tables.expr_ty(inner).kind {\n+                                        lint(cx, e.span, args[0].span, true);\n+                                    }\n                                 }\n                             },\n                             hir::ExprKind::MethodCall(ref method, _, ref obj) => {"}, {"sha": "5e6b3fad41ce08584b46cf93bb5d92c280e4a9a9", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "patch": "@@ -23,4 +23,14 @@ fn main() {\n \n     // Issue #498\n     let _ = std::env::args();\n+\n+    // Issue #4824 item types that aren't references\n+    {\n+        use std::rc::Rc;\n+\n+        let o: Option<Rc<u32>> = Some(Rc::new(0_u32));\n+        let _: Option<u32> = o.map(|x| *x);\n+        let v: Vec<Rc<u32>> = vec![Rc::new(0_u32)];\n+        let _: Vec<u32> = v.into_iter().map(|x| *x).collect();\n+    }\n }"}, {"sha": "2fe078b2752663fd5dcf45e559a1eec475ac2596", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b15b977d76cc5d8a2d8a9f9c592c2633e85a454b/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=b15b977d76cc5d8a2d8a9f9c592c2633e85a454b", "patch": "@@ -23,4 +23,14 @@ fn main() {\n \n     // Issue #498\n     let _ = std::env::args().map(|v| v.clone());\n+\n+    // Issue #4824 item types that aren't references\n+    {\n+        use std::rc::Rc;\n+\n+        let o: Option<Rc<u32>> = Some(Rc::new(0_u32));\n+        let _: Option<u32> = o.map(|x| *x);\n+        let v: Vec<Rc<u32>> = vec![Rc::new(0_u32)];\n+        let _: Vec<u32> = v.into_iter().map(|x| *x).collect();\n+    }\n }"}]}