{"sha": "8413d4769f46cee7a6a4a6d9962d540b33d1af91", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0MTNkNDc2OWY0NmNlZTdhNmE0YTZkOTk2MmQ1NDBiMzNkMWFmOTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-29T12:40:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-29T12:40:26Z"}, "message": "auto merge of #8085 : mrordinaire/rust/percent-p, r=huonw\n\npull request for #8011", "tree": {"sha": "cfd95f59adc88a90fe363df26604ea084957fc5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfd95f59adc88a90fe363df26604ea084957fc5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8413d4769f46cee7a6a4a6d9962d540b33d1af91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8413d4769f46cee7a6a4a6d9962d540b33d1af91", "html_url": "https://github.com/rust-lang/rust/commit/8413d4769f46cee7a6a4a6d9962d540b33d1af91", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8413d4769f46cee7a6a4a6d9962d540b33d1af91/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27812ea5e025ed36dc80379b86bb249b33c528a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/27812ea5e025ed36dc80379b86bb249b33c528a2", "html_url": "https://github.com/rust-lang/rust/commit/27812ea5e025ed36dc80379b86bb249b33c528a2"}, {"sha": "79f1052b19cb43aad5f47a4e1110206a7c0143f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/79f1052b19cb43aad5f47a4e1110206a7c0143f6", "html_url": "https://github.com/rust-lang/rust/commit/79f1052b19cb43aad5f47a4e1110206a7c0143f6"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "1a136bbaa3774c95e7084a1e92a3ea5045b7f7cb", "filename": "src/libstd/unstable/extfmt.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Flibstd%2Funstable%2Fextfmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Flibstd%2Funstable%2Fextfmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fextfmt.rs?ref=8413d4769f46cee7a6a4a6d9962d540b33d1af91", "patch": "@@ -114,6 +114,7 @@ pub mod ct {\n         TyHex(Caseness),\n         TyOctal,\n         TyFloat,\n+        TyPointer,\n         TyPoly,\n     }\n \n@@ -325,6 +326,7 @@ pub mod ct {\n             't' => TyBits,\n             'o' => TyOctal,\n             'f' => TyFloat,\n+            'p' => TyPointer,\n             '?' => TyPoly,\n             _ => err(fmt!(\"unknown type in conversion: %c\", s.char_at(i)))\n         };\n@@ -434,6 +436,7 @@ pub mod ct {\n         assert!(test(\"t\", TyBits));\n         assert!(test(\"x\", TyHex(CaseLower)));\n         assert!(test(\"X\", TyHex(CaseUpper)));\n+        assert!(test(\"p\", TyPointer));\n         assert!(test(\"?\", TyPoly));\n     }\n \n@@ -573,6 +576,10 @@ pub mod rt {\n         } else { None };\n         pad(cv, s, head, PadFloat, buf);\n     }\n+    pub fn conv_pointer<T>(cv: Conv, ptr: *T, buf: &mut ~str) {\n+        let s = ~\"0x\" + uint_to_str_prec(ptr as uint, 16, 1u);\n+        pad(cv, s, None, PadNozero, buf);\n+    }\n     pub fn conv_poly<T>(cv: Conv, v: &T, buf: &mut ~str) {\n         let s = sys::log_str(v);\n         conv_str(cv, s, buf);"}, {"sha": "855cf47111ae9fb59a21632f4610ba5cb6fda069", "filename": "src/libsyntax/ext/fmt.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Flibsyntax%2Fext%2Ffmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Flibsyntax%2Fext%2Ffmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ffmt.rs?ref=8413d4769f46cee7a6a4a6d9962d540b33d1af91", "patch": "@@ -191,6 +191,7 @@ fn pieces_to_expr(cx: @ExtCtxt, sp: span,\n             TyChar => (\"char\", arg),\n             TyBits | TyOctal | TyHex(_) | TyInt(Unsigned) => (\"uint\", arg),\n             TyFloat => (\"float\", arg),\n+            TyPointer => (\"pointer\", arg),\n             TyPoly => (\"poly\", cx.expr_addr_of(sp, arg))\n         };\n         return make_conv_call(cx, arg.span, name, cnv, actual_arg,\n@@ -242,6 +243,7 @@ fn pieces_to_expr(cx: @ExtCtxt, sp: span,\n           },\n           TyOctal => debug!(\"type: octal\"),\n           TyFloat => debug!(\"type: float\"),\n+          TyPointer => debug!(\"type: pointer\"),\n           TyPoly => debug!(\"type: poly\")\n         }\n     }"}, {"sha": "513bc078e7f91db2346b5f7ee1e2038f263dd712", "filename": "src/test/run-pass/syntax-extension-fmt.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8413d4769f46cee7a6a4a6d9962d540b33d1af91/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsyntax-extension-fmt.rs?ref=8413d4769f46cee7a6a4a6d9962d540b33d1af91", "patch": "@@ -32,6 +32,7 @@ pub fn main() {\n     part6();\n     percent();\n     more_floats();\n+    pointer();\n }\n \n fn part1() {\n@@ -263,3 +264,13 @@ fn more_floats() {\n     assert_eq!(~\"7.0000\", fmt!(\"%.4f\", 6.999999999));\n     assert_eq!(~\"3.141590000\", fmt!(\"%.9f\", 3.14159));\n }\n+\n+fn pointer() {\n+    for 10.times {\n+        let x: uint = ::std::rand::random();\n+        assert_eq!(fmt!(\"%p\", x as *uint), fmt!(\"0x%x\", x));\n+    }\n+\n+    let i = &1;\n+    assert_eq!(fmt!(\"%p\", i), fmt!(\"0x%x\", i as *uint as uint));\n+}"}]}