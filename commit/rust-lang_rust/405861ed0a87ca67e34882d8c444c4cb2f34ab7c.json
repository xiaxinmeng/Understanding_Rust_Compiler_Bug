{"sha": "405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwNTg2MWVkMGE4N2NhNjdlMzQ4ODJkOGM0NDRjNGNiMmYzNGFiN2M=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2014-04-27T07:52:36Z"}, "committer": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2014-04-28T02:45:30Z"}, "message": "test: Fix run-make on windows", "tree": {"sha": "aff8800ae28dcbd6dd55257fc4f3637a8a521875", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aff8800ae28dcbd6dd55257fc4f3637a8a521875"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "html_url": "https://github.com/rust-lang/rust/commit/405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1efb668aaab923434b5b406b78afe5f6c0852ac7", "url": "https://api.github.com/repos/rust-lang/rust/commits/1efb668aaab923434b5b406b78afe5f6c0852ac7", "html_url": "https://github.com/rust-lang/rust/commit/1efb668aaab923434b5b406b78afe5f6c0852ac7"}], "stats": {"total": 153, "additions": 131, "deletions": 22}, "files": [{"sha": "7646113560bbb07a8e71cd1a929a41f6e1cda54b", "filename": "src/etc/maketest.py", "status": "modified", "additions": 37, "deletions": 10, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Fetc%2Fmaketest.py", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Fetc%2Fmaketest.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmaketest.py?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -12,26 +12,53 @@\n import os\n import sys\n \n-# FIXME #12303 these tests are broken on windows\n-if os.name == 'nt':\n-    print 'ignoring make tests on windows'\n-    sys.exit(0)\n+# msys1/msys2 automatically converts `/abs/path1:/abs/path2` into\n+# `c:\\real\\abs\\path1;c:\\real\\abs\\path2` (semicolons) if shell thinks\n+# the value is list of paths.\n+# this causes great confusion and error: shell and Makefile doesn't like\n+# windows paths so it is really error-prone. revert it for peace.\n+def normalize_path(v):\n+    # c:\\path -> /c/path\n+    if ':\\\\' in v:\n+        v = '/' + v.replace(':\\\\', '/')\n+    v = v.replace('\\\\', '/')\n+    return v\n+\n+\n+def putenv(name, value):\n+    if os.name == 'nt':\n+        value = normalize_path(value)\n+    os.putenv(name, value)\n+\n \n make = sys.argv[2]\n-os.putenv('RUSTC', os.path.abspath(sys.argv[3]))\n-os.putenv('TMPDIR', os.path.abspath(sys.argv[4]))\n-os.putenv('CC', sys.argv[5])\n-os.putenv('RUSTDOC', os.path.abspath(sys.argv[6]))\n+putenv('RUSTC', os.path.abspath(sys.argv[3]))\n+putenv('TMPDIR', os.path.abspath(sys.argv[4]))\n+putenv('CC', sys.argv[5])\n+putenv('RUSTDOC', os.path.abspath(sys.argv[6]))\n filt = sys.argv[7]\n ldpath = sys.argv[8]\n if ldpath != '':\n-    os.putenv(ldpath.split('=')[0], ldpath.split('=')[1])\n+    name = ldpath.split('=')[0]\n+    value = ldpath.split('=')[1]\n+    if os.name == 'nt' and name != 'PATH':\n+        value = \":\".join(normalize_path(v) for v in value.split(\";\"))\n+    os.putenv(name, value)\n \n if not filt in sys.argv[1]:\n     sys.exit(0)\n print('maketest: ' + os.path.basename(os.path.dirname(sys.argv[1])))\n \n-proc = subprocess.Popen([make, '-C', sys.argv[1]],\n+path = sys.argv[1]\n+if path[-1] == '/':\n+    # msys1 has a bug that `make` fails to include `../tools.mk` (parent dir)\n+    # if `-C path` option is given and `path` is absolute directory with\n+    # trailing slash (`c:/path/to/test/`).\n+    # the easist workaround is to remove the slash (`c:/path/to/test`).\n+    # msys2 seems to fix this problem.\n+    path = path[:-1]\n+\n+proc = subprocess.Popen([make, '-C', path],\n                         stdout = subprocess.PIPE,\n                         stderr = subprocess.PIPE)\n out, err = proc.communicate()"}, {"sha": "7312a65c81238cebb2b8858321d3eb4d85468ee0", "filename": "src/test/run-make/c-link-to-rust-staticlib/Makefile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fc-link-to-rust-staticlib%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,10 +1,12 @@\n -include ../tools.mk\n \n+ifndef IS_WINDOWS\n ifneq ($(shell uname),Darwin)\n \tEXTRAFLAGS := -lm -lrt -ldl -lpthread\n endif\n+endif\n \n-# FIXME\n+# FIXME: ignore freebsd\n ifneq ($(shell uname),FreeBSD)\n all:\n \t$(RUSTC) foo.rs"}, {"sha": "efa6dfe981bb6badc5c7cc67089d750322198e4d", "filename": "src/test/run-make/dep-info-custom/Makefile", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fdep-info-custom%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fdep-info-custom%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdep-info-custom%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,7 +1,9 @@\n -include ../tools.mk\n \n-# FIXME\n+# FIXME: ignore freebsd/windows\n+# (windows: see `../dep-info/Makefile`)\n ifneq ($(shell uname),FreeBSD)\n+ifndef IS_WINDOWS\n all:\n \t$(RUSTC) --dep-info $(TMPDIR)/custom-deps-file.d --crate-type=lib lib.rs\n \tsleep 1\n@@ -16,3 +18,8 @@ else\n all:\n \n endif\n+\n+else\n+all:\n+\n+endif"}, {"sha": "6835ef34b0b2031ed653cf20bc1511ad4328fc5f", "filename": "src/test/run-make/dep-info/Makefile", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fdep-info%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fdep-info%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fdep-info%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,6 +1,11 @@\n -include ../tools.mk\n \n+# FIXME: ignore freebsd/windows\n+# on windows `rustc --dep-info` produces Makefile dependency with\n+# windows native paths (e.g. `c:\\path\\to\\libfoo.a`)\n+# but msys make seems to fail to recognize such paths, so test fails.\n ifneq ($(shell uname),FreeBSD)\n+ifndef IS_WINDOWS\n all:\n \t$(RUSTC) --dep-info --crate-type=lib lib.rs\n \tsleep 2\n@@ -16,3 +21,8 @@ else\n all:\n \n endif\n+\n+else\n+all:\n+\n+endif"}, {"sha": "85b8d0e2dd82a62de798237d43116d064fab1a39", "filename": "src/test/run-make/lto-smoke-c/Makefile", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Flto-smoke-c%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Flto-smoke-c%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Flto-smoke-c%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,5 +1,8 @@\n -include ../tools.mk\n \n+ifdef IS_WINDOWS\n+\tEXTRAFLAGS :=\n+else\n ifeq ($(shell uname),Darwin)\n else\n ifeq ($(shell uname),FreeBSD)\n@@ -8,6 +11,7 @@ else\n \tEXTRAFLAGS := -lm -lrt -ldl -lpthread\n endif\n endif\n+endif\n \n # Apparently older versions of GCC segfault if -g is passed...\n CC := $(CC:-g=)"}, {"sha": "60a7f067476b0fba25839e29e2a38968d1d7b3e1", "filename": "src/test/run-make/no-intermediate-extras/foo.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fno-intermediate-extras%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fno-intermediate-extras%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fno-intermediate-extras%2Ffoo.rs?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// FIXME #13793\n+#[test]\n+fn test_dummy() {\n+}"}, {"sha": "a3c58a6bf17fe276b66c179dae13366e7f1e4106", "filename": "src/test/run-make/obey-crate-type-flag/Makefile", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fobey-crate-type-flag%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fobey-crate-type-flag%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fobey-crate-type-flag%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -7,7 +7,7 @@\n # fail if an rlib was built\n all:\n \t$(RUSTC) test.rs\n-\trm $(TMPDIR)/libtest*.rlib\n-\trm $(TMPDIR)/libtest*\n+\trm $(TMPDIR)/$(call RLIB_GLOB,test)\n+\trm $(TMPDIR)/$(call DYLIB_GLOB,test)\n \t$(RUSTC) --crate-type dylib test.rs\n-\trm $(TMPDIR)/libtest*.rlib && exit 1 || exit 0\n+\trm $(TMPDIR)/$(call RLIB_GLOB,test) && exit 1 || exit 0"}, {"sha": "5a309cddeb184b0f3326bb992b3e10b8f9458acd", "filename": "src/test/run-make/output-type-permutations/Makefile", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Foutput-type-permutations%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Foutput-type-permutations%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Foutput-type-permutations%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -6,13 +6,13 @@ all:\n \trm $(TMPDIR)/$(call DYLIB_GLOB,bar)\n \trm $(TMPDIR)/$(call STATICLIB_GLOB,bar)\n \t$(RUSTC) foo.rs --crate-type=bin\n-\trm $(TMPDIR)/bar\n+\trm $(TMPDIR)/$(call BIN,bar)\n \t$(RUSTC) foo.rs --emit=asm,ir,bc,obj,link\n \trm $(TMPDIR)/bar.ll\n \trm $(TMPDIR)/bar.bc\n \trm $(TMPDIR)/bar.s\n \trm $(TMPDIR)/bar.o\n-\trm $(TMPDIR)/bar\n+\trm $(TMPDIR)/$(call BIN,bar)\n \t$(RUSTC) foo.rs --emit=asm,ir,bc,obj,link --crate-type=staticlib\n \trm $(TMPDIR)/bar.ll\n \trm $(TMPDIR)/bar.s\n@@ -27,15 +27,15 @@ all:\n \t$(RUSTC) foo.rs --emit=obj -o $(TMPDIR)/foo\n \trm $(TMPDIR)/foo\n \t$(RUSTC) foo.rs --emit=link -o $(TMPDIR)/foo\n-\trm $(TMPDIR)/foo\n+\trm $(TMPDIR)/$(call BIN,foo)\n \t$(RUSTC) foo.rs --crate-type=rlib -o $(TMPDIR)/foo\n \trm $(TMPDIR)/foo\n \t$(RUSTC) foo.rs --crate-type=dylib -o $(TMPDIR)/foo\n-\trm $(TMPDIR)/foo\n+\trm $(TMPDIR)/$(call BIN,foo)  # FIXME 13794\n \t$(RUSTC) foo.rs --crate-type=staticlib -o $(TMPDIR)/foo\n \trm $(TMPDIR)/foo\n \t$(RUSTC) foo.rs --crate-type=bin -o $(TMPDIR)/foo\n-\trm $(TMPDIR)/foo\n+\trm $(TMPDIR)/$(call BIN,foo)\n \tmv $(TMPDIR)/bar.bc $(TMPDIR)/foo.bc\n \t$(RUSTC) foo.rs --emit=bc,link --crate-type=rlib\n \tcmp $(TMPDIR)/foo.bc $(TMPDIR)/bar.bc"}, {"sha": "a6e219873dfd28af4a5b42b269723e4752b37e17", "filename": "src/test/run-make/prune-link-args/Makefile", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fprune-link-args%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,6 +1,11 @@\n -include ../tools.mk\n+ifdef IS_WINDOWS\n+# ignore windows\n+RUSTC_FLAGS =\n+else\n # Notice the space in the end, this emulates the output of pkg-config\n RUSTC_FLAGS = -C link-args=\"-lc \"\n+endif\n \n all:\n \t$(RUSTC) $(RUSTC_FLAGS) empty.rs"}, {"sha": "b67c1f66dd954a04f5556e8eb87e31544ff0f65c", "filename": "src/test/run-make/rustdoc-hidden-line/Makefile", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Frustdoc-hidden-line%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Frustdoc-hidden-line%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-hidden-line%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,7 +1,15 @@\n -include ../tools.mk\n \n+# FIXME ignore windows\n+ifndef IS_WINDOWS\n+\n all:\n \t$(RUSTDOC) --test foo.rs\n \t$(RUSTDOC) -w html -o $(TMPDIR)/doc foo.rs\n \tcp verify.sh $(TMPDIR)\n \t$(call RUN,verify.sh) $(TMPDIR)\n+\n+else\n+all:\n+\n+endif"}, {"sha": "9eb2c135230062ab418df7290b07331d0ab8576c", "filename": "src/test/run-make/symlinked-libraries/Makefile", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fsymlinked-libraries%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fsymlinked-libraries%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymlinked-libraries%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,7 +1,15 @@\n -include ../tools.mk\n \n+# ignore windows: `ln` is actually `cp` on msys.\n+ifndef IS_WINDOWS\n+\n all:\n \t$(RUSTC) foo.rs\n \tmkdir -p $(TMPDIR)/other\n \tln -nsf $(TMPDIR)/$(call DYLIB_GLOB,foo) $(TMPDIR)/other\n \t$(RUSTC) bar.rs -L $(TMPDIR)/other\n+\n+else\n+all:\n+\n+endif"}, {"sha": "90274cdb3e7aab3eca9673368a48d8eea3dabb67", "filename": "src/test/run-make/tools.mk", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Ftools.mk?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -10,21 +10,37 @@ FAILS = $(TMPDIR)/$(1) && exit 1 || exit 0\n RLIB_GLOB = lib$(1)*.rlib\n STATICLIB = $(TMPDIR)/lib$(1).a\n STATICLIB_GLOB = lib$(1)*.a\n+BIN = $(1)\n \n-ifeq ($(shell uname),Darwin)\n+UNAME = $(shell uname)\n+ifneq (,$(findstring MINGW,$(UNAME)))\n+IS_WINDOWS=1\n+endif\n+\n+ifeq ($(UNAME),Darwin)\n DYLIB_GLOB = lib$(1)*.dylib\n DYLIB = $(TMPDIR)/lib$(1).dylib\n else\n+ifdef IS_WINDOWS\n+DYLIB_GLOB = $(1)*.dll\n+DYLIB = $(TMPDIR)/$(1).dll\n+BIN = $(1).exe\n+export PATH := $(PATH):$(LD_LIBRARY_PATH)\n+else\n DYLIB_GLOB = lib$(1)*.so\n DYLIB = $(TMPDIR)/lib$(1).so\n endif\n+endif\n \n %.a: %.o\n \tar crus $@ $<\n %.dylib: %.o\n \t$(CC) -dynamiclib -Wl,-dylib -o $@ $<\n %.so: %.o\n \t$(CC) -o $@ $< -shared\n+%.dll: lib%.o\n+\t$(CC) -o $@ $< -shared\n+\n $(TMPDIR)/lib%.o: %.c\n \t$(CC) -c -o $@ $<\n "}, {"sha": "529bfc24a400ac688a3995fc4b069cab6fcf0963", "filename": "src/test/run-make/unicode-input/Makefile", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Funicode-input%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Funicode-input%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Funicode-input%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -1,5 +1,8 @@\n -include ../tools.mk\n \n+# FIXME ignore windows\n+ifndef IS_WINDOWS\n+\n all:\n \t# check that we don't ICE on unicode input, issue #11178\n \t$(RUSTC) multiple_files.rs\n@@ -9,3 +12,8 @@ all:\n \t# correct length. issue #8706\n \t$(RUSTC) span_length.rs\n \t$(call RUN,span_length) \"$(RUSTC)\" \"$(TMPDIR)\"\n+\n+else\n+all:\n+\n+endif"}, {"sha": "debd89d9929b75784bf89d99ae547e876acca937", "filename": "src/test/run-make/weird-output-filenames/Makefile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fweird-output-filenames%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/405861ed0a87ca67e34882d8c444c4cb2f34ab7c/src%2Ftest%2Frun-make%2Fweird-output-filenames%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fweird-output-filenames%2FMakefile?ref=405861ed0a87ca67e34882d8c444c4cb2f34ab7c", "patch": "@@ -6,4 +6,4 @@ all:\n \t$(RUSTC) foo.rs -o $(TMPDIR)/.foo.bar\n \trm $(TMPDIR)/.foo.bar\n \t$(RUSTC) foo.rs -o $(TMPDIR)/+foo+bar\n-\trm $(TMPDIR)/+foo+bar\n+\trm $(TMPDIR)/$(call BIN,+foo+bar)"}]}