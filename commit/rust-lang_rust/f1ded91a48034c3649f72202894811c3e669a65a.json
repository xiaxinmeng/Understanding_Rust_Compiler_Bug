{"sha": "f1ded91a48034c3649f72202894811c3e669a65a", "node_id": "C_kwDOAAsO6NoAKGYxZGVkOTFhNDgwMzRjMzY0OWY3MjIwMjg5NDgxMWMzZTY2OWE2NWE", "commit": {"author": {"name": "Gimbles", "email": "93856041+gimbles@users.noreply.github.com", "date": "2023-04-07T17:20:03Z"}, "committer": {"name": "Gimbles", "email": "93856041+gimbles@users.noreply.github.com", "date": "2023-04-08T05:54:24Z"}, "message": "rm box_items\n\nfix in plugin.md\n\nfmt", "tree": {"sha": "b4b6765561ac5dd3571c3390d7c22d8b962f4995", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4b6765561ac5dd3571c3390d7c22d8b962f4995"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1ded91a48034c3649f72202894811c3e669a65a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1ded91a48034c3649f72202894811c3e669a65a", "html_url": "https://github.com/rust-lang/rust/commit/f1ded91a48034c3649f72202894811c3e669a65a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1ded91a48034c3649f72202894811c3e669a65a/comments", "author": {"login": "gimbles", "id": 93856041, "node_id": "U_kgDOBZghKQ", "avatar_url": "https://avatars.githubusercontent.com/u/93856041?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gimbles", "html_url": "https://github.com/gimbles", "followers_url": "https://api.github.com/users/gimbles/followers", "following_url": "https://api.github.com/users/gimbles/following{/other_user}", "gists_url": "https://api.github.com/users/gimbles/gists{/gist_id}", "starred_url": "https://api.github.com/users/gimbles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gimbles/subscriptions", "organizations_url": "https://api.github.com/users/gimbles/orgs", "repos_url": "https://api.github.com/users/gimbles/repos", "events_url": "https://api.github.com/users/gimbles/events{/privacy}", "received_events_url": "https://api.github.com/users/gimbles/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gimbles", "id": 93856041, "node_id": "U_kgDOBZghKQ", "avatar_url": "https://avatars.githubusercontent.com/u/93856041?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gimbles", "html_url": "https://github.com/gimbles", "followers_url": "https://api.github.com/users/gimbles/followers", "following_url": "https://api.github.com/users/gimbles/following{/other_user}", "gists_url": "https://api.github.com/users/gimbles/gists{/gist_id}", "starred_url": "https://api.github.com/users/gimbles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gimbles/subscriptions", "organizations_url": "https://api.github.com/users/gimbles/orgs", "repos_url": "https://api.github.com/users/gimbles/repos", "events_url": "https://api.github.com/users/gimbles/events{/privacy}", "received_events_url": "https://api.github.com/users/gimbles/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94524020ea12f7947275063b65f8b7d705be073e", "url": "https://api.github.com/repos/rust-lang/rust/commits/94524020ea12f7947275063b65f8b7d705be073e", "html_url": "https://github.com/rust-lang/rust/commit/94524020ea12f7947275063b65f8b7d705be073e"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "6adb3506e646a17ceee8e507824966129cdff65e", "filename": "src/doc/unstable-book/src/language-features/lang-items.md", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f1ded91a48034c3649f72202894811c3e669a65a/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md", "raw_url": "https://github.com/rust-lang/rust/raw/f1ded91a48034c3649f72202894811c3e669a65a/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Flang-items.md?ref=f1ded91a48034c3649f72202894811c3e669a65a", "patch": "@@ -16,18 +16,26 @@ and one for deallocation. A freestanding program that uses the `Box`\n sugar for dynamic allocations via `malloc` and `free`:\n \n ```rust,ignore (libc-is-finicky)\n-#![feature(lang_items, box_syntax, start, libc, core_intrinsics, rustc_private)]\n+#![feature(lang_items, start, libc, core_intrinsics, rustc_private, rustc_attrs)]\n #![no_std]\n use core::intrinsics;\n use core::panic::PanicInfo;\n+use core::ptr::NonNull;\n \n extern crate libc;\n \n-struct Unique<T>(*mut T);\n+struct Unique<T>(NonNull<T>);\n \n #[lang = \"owned_box\"]\n pub struct Box<T>(Unique<T>);\n \n+impl<T> Box<T> {\n+    pub fn new(x: T) -> Self {\n+        #[rustc_box]\n+        Box::new(x)\n+    }\n+}\n+\n #[lang = \"exchange_malloc\"]\n unsafe fn allocate(size: usize, _align: usize) -> *mut u8 {\n     let p = libc::malloc(size as libc::size_t) as *mut u8;\n@@ -47,13 +55,13 @@ unsafe fn box_free<T: ?Sized>(ptr: *mut T) {\n \n #[start]\n fn main(_argc: isize, _argv: *const *const u8) -> isize {\n-    let _x = box 1;\n+    let _x = Box::new(1);\n \n     0\n }\n \n #[lang = \"eh_personality\"] extern fn rust_eh_personality() {}\n-#[lang = \"panic_impl\"] extern fn rust_begin_panic(info: &PanicInfo) -> ! { unsafe { intrinsics::abort() } }\n+#[lang = \"panic_impl\"] extern fn rust_begin_panic(_info: &PanicInfo) -> ! { intrinsics::abort() }\n #[no_mangle] pub extern fn rust_eh_register_frames () {}\n #[no_mangle] pub extern fn rust_eh_unregister_frames () {}\n ```"}, {"sha": "1fade6ce95b89516d4b456fda9b5635390e966ce", "filename": "src/doc/unstable-book/src/language-features/plugin.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f1ded91a48034c3649f72202894811c3e669a65a/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md", "raw_url": "https://github.com/rust-lang/rust/raw/f1ded91a48034c3649f72202894811c3e669a65a/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fplugin.md?ref=f1ded91a48034c3649f72202894811c3e669a65a", "patch": "@@ -37,7 +37,7 @@ additional checks for code style, safety, etc. Now let's write a plugin\n that warns about any item named `lintme`.\n \n ```rust,ignore (requires-stage-2)\n-#![feature(box_syntax, rustc_private)]\n+#![feature(rustc_private)]\n \n extern crate rustc_ast;\n \n@@ -68,7 +68,7 @@ impl EarlyLintPass for Pass {\n #[no_mangle]\n fn __rustc_plugin_registrar(reg: &mut Registry) {\n     reg.lint_store.register_lints(&[&TEST_LINT]);\n-    reg.lint_store.register_early_pass(|| box Pass);\n+    reg.lint_store.register_early_pass(|| Box::new(Pass));\n }\n ```\n "}]}