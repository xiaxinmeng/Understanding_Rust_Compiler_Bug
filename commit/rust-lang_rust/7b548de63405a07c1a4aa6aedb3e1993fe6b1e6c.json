{"sha": "7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiNTQ4ZGU2MzQwNWEwN2MxYTRhYTZhZWRiM2UxOTkzZmU2YjFlNmM=", "commit": {"author": {"name": "Jeremy A. Kolb", "email": "jkolb@ara.com", "date": "2019-01-23T22:46:14Z"}, "committer": {"name": "Jeremy A. Kolb", "email": "jkolb@ara.com", "date": "2019-01-23T22:46:14Z"}, "message": "Add a bunch of new documentation to completions", "tree": {"sha": "2b9a86431dd1b8ee4298f35bc991ddd0803016fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b9a86431dd1b8ee4298f35bc991ddd0803016fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "html_url": "https://github.com/rust-lang/rust/commit/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/comments", "author": {"login": "kjeremy", "id": 4325700, "node_id": "MDQ6VXNlcjQzMjU3MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4325700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kjeremy", "html_url": "https://github.com/kjeremy", "followers_url": "https://api.github.com/users/kjeremy/followers", "following_url": "https://api.github.com/users/kjeremy/following{/other_user}", "gists_url": "https://api.github.com/users/kjeremy/gists{/gist_id}", "starred_url": "https://api.github.com/users/kjeremy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kjeremy/subscriptions", "organizations_url": "https://api.github.com/users/kjeremy/orgs", "repos_url": "https://api.github.com/users/kjeremy/repos", "events_url": "https://api.github.com/users/kjeremy/events{/privacy}", "received_events_url": "https://api.github.com/users/kjeremy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kjeremy", "id": 4325700, "node_id": "MDQ6VXNlcjQzMjU3MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4325700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kjeremy", "html_url": "https://github.com/kjeremy", "followers_url": "https://api.github.com/users/kjeremy/followers", "following_url": "https://api.github.com/users/kjeremy/following{/other_user}", "gists_url": "https://api.github.com/users/kjeremy/gists{/gist_id}", "starred_url": "https://api.github.com/users/kjeremy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kjeremy/subscriptions", "organizations_url": "https://api.github.com/users/kjeremy/orgs", "repos_url": "https://api.github.com/users/kjeremy/repos", "events_url": "https://api.github.com/users/kjeremy/events{/privacy}", "received_events_url": "https://api.github.com/users/kjeremy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "576625f0a1c6e54075d173db7e691d75077ca677", "url": "https://api.github.com/repos/rust-lang/rust/commits/576625f0a1c6e54075d173db7e691d75077ca677", "html_url": "https://github.com/rust-lang/rust/commit/576625f0a1c6e54075d173db7e691d75077ca677"}], "stats": {"total": 74, "additions": 54, "deletions": 20}, "files": [{"sha": "3ff07bd60c7cfb78de97134fcb8a15cd99774247", "filename": "crates/ra_hir/src/code_model_api.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model_api.rs?ref=7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "patch": "@@ -394,6 +394,12 @@ impl Const {\n     }\n }\n \n+impl Docs for Const {\n+    fn docs(&self, db: &impl HirDatabase) -> Option<Documentation> {\n+        docs_from_ast(&*self.source(db).1)\n+    }\n+}\n+\n #[derive(Debug, Clone, PartialEq, Eq, Hash)]\n pub struct Static {\n     pub(crate) def_id: DefId,\n@@ -409,6 +415,12 @@ impl Static {\n     }\n }\n \n+impl Docs for Static {\n+    fn docs(&self, db: &impl HirDatabase) -> Option<Documentation> {\n+        docs_from_ast(&*self.source(db).1)\n+    }\n+}\n+\n #[derive(Debug, Clone, PartialEq, Eq, Hash)]\n pub struct Trait {\n     pub(crate) def_id: DefId,\n@@ -428,6 +440,12 @@ impl Trait {\n     }\n }\n \n+impl Docs for Trait {\n+    fn docs(&self, db: &impl HirDatabase) -> Option<Documentation> {\n+        docs_from_ast(&*self.source(db).1)\n+    }\n+}\n+\n #[derive(Debug, Clone, PartialEq, Eq, Hash)]\n pub struct Type {\n     pub(crate) def_id: DefId,\n@@ -446,3 +464,9 @@ impl Type {\n         db.generic_params(self.def_id)\n     }\n }\n+\n+impl Docs for Type {\n+    fn docs(&self, db: &impl HirDatabase) -> Option<Documentation> {\n+        docs_from_ast(&*self.source(db).1)\n+    }\n+}"}, {"sha": "18c151932a87780f806832c0c8857534aba86b3e", "filename": "crates/ra_ide_api/src/completion/completion_item.rs", "status": "modified", "additions": 16, "deletions": 14, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "patch": "@@ -210,42 +210,44 @@ impl Builder {\n         resolution: &hir::Resolution,\n     ) -> Builder {\n         let resolved = resolution.def_id.map(|d| d.resolve(ctx.db));\n-        let kind = match resolved {\n+        let (kind, docs) = match resolved {\n             PerNs {\n                 types: Some(hir::Def::Module(..)),\n                 ..\n-            } => CompletionItemKind::Module,\n+            } => (CompletionItemKind::Module, None),\n             PerNs {\n-                types: Some(hir::Def::Struct(..)),\n+                types: Some(hir::Def::Struct(s)),\n                 ..\n-            } => CompletionItemKind::Struct,\n+            } => (CompletionItemKind::Struct, s.docs(ctx.db)),\n             PerNs {\n-                types: Some(hir::Def::Enum(..)),\n+                types: Some(hir::Def::Enum(e)),\n                 ..\n-            } => CompletionItemKind::Enum,\n+            } => (CompletionItemKind::Enum, e.docs(ctx.db)),\n             PerNs {\n-                types: Some(hir::Def::Trait(..)),\n+                types: Some(hir::Def::Trait(t)),\n                 ..\n-            } => CompletionItemKind::Trait,\n+            } => (CompletionItemKind::Trait, t.docs(ctx.db)),\n             PerNs {\n-                types: Some(hir::Def::Type(..)),\n+                types: Some(hir::Def::Type(t)),\n                 ..\n-            } => CompletionItemKind::TypeAlias,\n+            } => (CompletionItemKind::TypeAlias, t.docs(ctx.db)),\n             PerNs {\n-                values: Some(hir::Def::Const(..)),\n+                values: Some(hir::Def::Const(c)),\n                 ..\n-            } => CompletionItemKind::Const,\n+            } => (CompletionItemKind::Const, c.docs(ctx.db)),\n             PerNs {\n-                values: Some(hir::Def::Static(..)),\n+                values: Some(hir::Def::Static(s)),\n                 ..\n-            } => CompletionItemKind::Static,\n+            } => (CompletionItemKind::Static, s.docs(ctx.db)),\n             PerNs {\n                 values: Some(hir::Def::Function(function)),\n                 ..\n             } => return self.from_function(ctx, function),\n             _ => return self,\n         };\n         self.kind = Some(kind);\n+        self.documentation = docs;\n+\n         self\n     }\n "}, {"sha": "9779541b3997bb282eb632c1d9b5cb5b706b02c6", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__reference_completion.snap", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__reference_completion.snap", "raw_url": "https://github.com/rust-lang/rust/raw/7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__reference_completion.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__reference_completion.snap?ref=7b548de63405a07c1a4aa6aedb3e1993fe6b1e6c", "patch": "@@ -1,6 +1,6 @@\n ---\n-created: \"2019-01-22T14:45:00.717917+00:00\"\n-creator: insta@0.4.0\n+created: \"2019-01-23T21:14:09.186661600+00:00\"\n+creator: insta@0.5.1\n expression: kind_completions\n source: \"crates\\\\ra_ide_api\\\\src\\\\completion\\\\completion_item.rs\"\n ---\n@@ -12,11 +12,15 @@ source: \"crates\\\\ra_ide_api\\\\src\\\\completion\\\\completion_item.rs\"\n             EnumVariant\n         ),\n         detail: None,\n-        documentation: None,\n+        documentation: Some(\n+            Documentation(\n+                \"This is foo\"\n+            )\n+        ),\n         lookup: None,\n         insert_text: None,\n         insert_text_format: PlainText,\n-        source_range: [47; 47),\n+        source_range: [109; 109),\n         text_edit: None\n     },\n     CompletionItem {\n@@ -26,11 +30,15 @@ source: \"crates\\\\ra_ide_api\\\\src\\\\completion\\\\completion_item.rs\"\n             EnumVariant\n         ),\n         detail: None,\n-        documentation: None,\n+        documentation: Some(\n+            Documentation(\n+                \"Use when we need an `i32`\"\n+            )\n+        ),\n         lookup: None,\n         insert_text: None,\n         insert_text_format: PlainText,\n-        source_range: [47; 47),\n+        source_range: [109; 109),\n         text_edit: None\n     }\n ]"}]}