{"sha": "160bc68cae213dc204037880c529125442557205", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2MGJjNjhjYWUyMTNkYzIwNDAzNzg4MGM1MjkxMjU0NDI1NTcyMDU=", "commit": {"author": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-05-30T23:59:51Z"}, "committer": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-05-31T03:57:16Z"}, "message": "Move the test to `src/main.rs`", "tree": {"sha": "718a7f6a90e5b3c1478b3a5c4b21e3da46d7d206", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/718a7f6a90e5b3c1478b3a5c4b21e3da46d7d206"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/160bc68cae213dc204037880c529125442557205", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIsEABYIADMWIQRJ2jPMDdiQ+U4U42Z0+n/VuNoUuAUCYLRenBUceWQtaHVhbmdA\nb3V0bG9vay5jb20ACgkQdPp/1bjaFLji2gEA1K43mn4dYvkJMh+J2SYQUMt/bVPw\nw9s5lZ9lHMOXIssA/1KASUSfdzGDY+E0sa8w9kGPdXTY7U3EdtMgrMea1IUH\n=NmlS\n-----END PGP SIGNATURE-----", "payload": "tree 718a7f6a90e5b3c1478b3a5c4b21e3da46d7d206\nparent 45832d4031df76120bd8b7787c8c715a32b52653\nauthor hyd-dev <yd-huang@outlook.com> 1622419191 +0800\ncommitter hyd-dev <yd-huang@outlook.com> 1622433436 +0800\n\nMove the test to `src/main.rs`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/160bc68cae213dc204037880c529125442557205", "html_url": "https://github.com/rust-lang/rust/commit/160bc68cae213dc204037880c529125442557205", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/160bc68cae213dc204037880c529125442557205/comments", "author": null, "committer": null, "parents": [{"sha": "45832d4031df76120bd8b7787c8c715a32b52653", "url": "https://api.github.com/repos/rust-lang/rust/commits/45832d4031df76120bd8b7787c8c715a32b52653", "html_url": "https://github.com/rust-lang/rust/commit/45832d4031df76120bd8b7787c8c715a32b52653"}], "stats": {"total": 65, "additions": 33, "deletions": 32}, "files": [{"sha": "6d9158c54ef4d9c91af1134848ead1e20dffe334", "filename": "test-cargo-miri/src/lib.rs", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Flib.rs?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,21 +1,6 @@\n-extern crate exported_symbol;\n-\n /// Doc-test test\n /// ```rust\n /// assert!(cargo_miri_test::make_true());\n-/// // Repeat calls to make sure the `Instance` cache is not broken.\n-/// for _ in 0..3 {\n-///     extern \"Rust\" {\n-///         fn exported_symbol() -> i32;\n-///         fn make_true() -> bool;\n-///     }\n-///     assert_eq!(unsafe { exported_symbol() }, 123456);\n-///     assert!(unsafe { make_true() });\n-/// }\n-/// ```\n-/// ```compile_fail\n-/// // Make sure `exported_symbol_dep` is not a direct dependency for doctests.\n-/// use exported_symbol_dep;\n /// ```\n /// ```rust,no_run\n /// assert!(!cargo_miri_test::make_true());"}, {"sha": "a5669ef3087c53a4df47884a6e5cce4c45d784f8", "filename": "test-cargo-miri/src/main.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Fmain.rs?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -57,4 +57,20 @@ mod test {\n         assert_ne!(x as usize, y);\n         assert_ne!(y as u128, z);\n     }\n+\n+    #[test]\n+    fn exported_symbol() {\n+        extern crate cargo_miri_test;\n+        extern crate exported_symbol;\n+        // Test calling exported symbols in (transitive) dependencies.\n+        // Repeat calls to make sure the `Instance` cache is not broken.\n+        for _ in 0..3 {\n+            extern \"Rust\" {\n+                fn exported_symbol() -> i32;\n+                fn make_true() -> bool;\n+            }\n+            assert_eq!(unsafe { exported_symbol() }, 123456);\n+            assert!(unsafe { make_true() });\n+        }\n+    }\n }"}, {"sha": "62cfd1d37a172afeec43fb124857f8db0de97864", "filename": "test-cargo-miri/test.bin-target.stdout.ref", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.bin-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.bin-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.bin-target.stdout.ref?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,6 +1,7 @@\n \n-running 1 test\n+running 2 tests\n+test test::exported_symbol ... ok\n test test::rng ... ok\n \n-test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n+test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n "}, {"sha": "aa4a5839b14534b946212edbf50c18746fbbc3e1", "filename": "test-cargo-miri/test.cross-target.stdout.ref", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.cross-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.cross-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.cross-target.stdout.ref?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,7 +1,7 @@\n \n-running 1 test\n-.\n-test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n+running 2 tests\n+..\n+test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n \n imported main\n "}, {"sha": "6c7d284a84ac8e8a0f36802597be0a7900e00b29", "filename": "test-cargo-miri/test.default.stdout.ref", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.default.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.default.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.default.stdout.ref?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,7 +1,7 @@\n \n-running 1 test\n-.\n-test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n+running 2 tests\n+..\n+test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n \n imported main\n \n@@ -10,11 +10,10 @@ running 7 tests\n test result: ok. 6 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out\n \n \n-running 4 tests\n-test src/lib.rs - make_true (line 16) ... ok\n-test src/lib.rs - make_true (line 20) ... ok\n-test src/lib.rs - make_true (line 23) ... ok\n-test src/lib.rs - make_true (line 4) ... ok\n+running 3 tests\n+test src/lib.rs - make_true (line 2) ... ok\n+test src/lib.rs - make_true (line 5) ... ok\n+test src/lib.rs - make_true (line 8) ... ok\n \n-test result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in $TIME\n+test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in $TIME\n "}, {"sha": "b38aac9aa868dea75a90df3509e8afd0207c3100", "filename": "test-cargo-miri/test.filter.cross-target.stdout.ref", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.filter.cross-target.stdout.ref?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,7 +1,7 @@\n \n running 0 tests\n \n-test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out\n+test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out\n \n imported main\n "}, {"sha": "6b26e17ff8bb9b5cf2d72852a462bb0925684ded", "filename": "test-cargo-miri/test.filter.stdout.ref", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.filter.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/160bc68cae213dc204037880c529125442557205/test-cargo-miri%2Ftest.filter.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.filter.stdout.ref?ref=160bc68cae213dc204037880c529125442557205", "patch": "@@ -1,7 +1,7 @@\n \n running 0 tests\n \n-test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out\n+test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out\n \n imported main\n \n@@ -13,5 +13,5 @@ test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 6 filtered out\n \n running 0 tests\n \n-test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 4 filtered out; finished in $TIME\n+test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 3 filtered out; finished in $TIME\n "}]}