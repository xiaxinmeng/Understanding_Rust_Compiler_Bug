{"sha": "539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzOTI0MmEwN2IxNWVjOTVhYTE5NmJmYTRjMThmNmE4YjAxYjhlY2I=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-03-31T23:37:29Z"}, "committer": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-01T00:53:46Z"}, "message": "Add a suggestion when using a type alias instead of trait alias", "tree": {"sha": "3cdc1a1dc97c48527b0bdc70e7cff79da9d54790", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3cdc1a1dc97c48527b0bdc70e7cff79da9d54790"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "html_url": "https://github.com/rust-lang/rust/commit/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5029ac0ab372aec515db2e718da6d7787f3d122", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5029ac0ab372aec515db2e718da6d7787f3d122", "html_url": "https://github.com/rust-lang/rust/commit/a5029ac0ab372aec515db2e718da6d7787f3d122"}], "stats": {"total": 78, "additions": 61, "deletions": 17}, "files": [{"sha": "0314de9ebbe5dab979ad8f7f0e63e63a589d2099", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -928,7 +928,14 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                     let msg = \"you might have meant to use `#![feature(trait_alias)]` instead of a \\\n                                `type` alias\";\n                     if let Some(span) = self.def_span(def_id) {\n-                        err.span_help(span, msg);\n+                        if let Ok(snip) = self.r.session.source_map().span_to_snippet(span) {\n+                            // The span contains a type alias so we should be able to\n+                            // replace `type` with `trait`.\n+                            let snip = snip.replacen(\"type\", \"trait\", 1);\n+                            err.span_suggestion(span, msg, snip, Applicability::MaybeIncorrect);\n+                        } else {\n+                            err.span_help(span, msg);\n+                        }\n                     } else {\n                         err.help(msg);\n                     }"}, {"sha": "aff51ee9e2f541514975efbd1175be5e2b24b67a", "filename": "src/test/ui/codemap_tests/two_files.stderr", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fcodemap_tests%2Ftwo_files.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fcodemap_tests%2Ftwo_files.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodemap_tests%2Ftwo_files.stderr?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -5,10 +5,9 @@ LL | impl Bar for Baz { }\n    |      ^^^ type aliases cannot be used as traits\n    |\n help: you might have meant to use `#![feature(trait_alias)]` instead of a `type` alias\n-  --> $DIR/two_files_data.rs:5:1\n    |\n-LL | type Bar = dyn Foo;\n-   | ^^^^^^^^^^^^^^^^^^^\n+LL | trait Bar = dyn Foo;\n+   |\n \n error: aborting due to previous error\n "}, {"sha": "6fc61cae84339961affc8a8340dfebb45fb7af02", "filename": "src/test/ui/resolve/issue-3907.stderr", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Fissue-3907.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Fissue-3907.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fissue-3907.stderr?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -5,10 +5,9 @@ LL | impl Foo for S {\n    |      ^^^ type aliases cannot be used as traits\n    |\n help: you might have meant to use `#![feature(trait_alias)]` instead of a `type` alias\n-  --> $DIR/issue-3907.rs:5:1\n    |\n-LL | type Foo = dyn issue_3907::Foo;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | trait Foo = dyn issue_3907::Foo;\n+   |\n help: consider importing this trait instead\n    |\n LL | use issue_3907::Foo;"}, {"sha": "a8aa50b7c3ab2247e8d64fa1e72dbeb921e95b26", "filename": "src/test/ui/resolve/issue-5035.stderr", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Fissue-5035.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Fissue-5035.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fissue-5035.stderr?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -11,16 +11,16 @@ LL | trait I {}\n    | ------- similarly named trait `I` defined here\n LL | type K = dyn I;\n LL | impl K for isize {}\n-   |      ^\n-   |      |\n-   |      type aliases cannot be used as traits\n-   |      help: a trait with a similar name exists: `I`\n+   |      ^ type aliases cannot be used as traits\n    |\n help: you might have meant to use `#![feature(trait_alias)]` instead of a `type` alias\n-  --> $DIR/issue-5035.rs:2:1\n    |\n-LL | type K = dyn I;\n-   | ^^^^^^^^^^^^^^^\n+LL | trait K = dyn I;\n+   |\n+help: a trait with a similar name exists\n+   |\n+LL | impl I for isize {}\n+   |      ^\n \n error: aborting due to 2 previous errors\n "}, {"sha": "8addc0303fb915aab5b859e12a47b7b93094ca02", "filename": "src/test/ui/resolve/unboxed-closure-sugar-nonexistent-trait.stderr", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Funboxed-closure-sugar-nonexistent-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Fresolve%2Funboxed-closure-sugar-nonexistent-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Funboxed-closure-sugar-nonexistent-trait.stderr?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -11,10 +11,9 @@ LL | fn g<F:Typedef(isize) -> isize>(x: F) {}\n    |        ^^^^^^^^^^^^^^^^^^^^^^^ type aliases cannot be used as traits\n    |\n help: you might have meant to use `#![feature(trait_alias)]` instead of a `type` alias\n-  --> $DIR/unboxed-closure-sugar-nonexistent-trait.rs:4:1\n    |\n-LL | type Typedef = isize;\n-   | ^^^^^^^^^^^^^^^^^^^^^\n+LL | trait Typedef = isize;\n+   |\n \n error: aborting due to 2 previous errors\n "}, {"sha": "8a94abaeb07441243a24539757cabac3ea9806dd", "filename": "src/test/ui/traits/alias/suggest-trait-alias-instead-of-type.fixed", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.fixed?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -0,0 +1,13 @@\n+// Regression test of #43913.\n+\n+// run-rustfix\n+\n+#![feature(trait_alias)]\n+#![allow(bare_trait_objects, dead_code)]\n+\n+trait Strings = Iterator<Item=String>;\n+\n+struct Struct<S: Strings>(S);\n+//~^ ERROR: expected trait, found type alias `Strings`\n+\n+fn main() {}"}, {"sha": "40c678c281f4c65e4da28abb96f9b917becbde78", "filename": "src/test/ui/traits/alias/suggest-trait-alias-instead-of-type.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.rs?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -0,0 +1,13 @@\n+// Regression test of #43913.\n+\n+// run-rustfix\n+\n+#![feature(trait_alias)]\n+#![allow(bare_trait_objects, dead_code)]\n+\n+type Strings = Iterator<Item=String>;\n+\n+struct Struct<S: Strings>(S);\n+//~^ ERROR: expected trait, found type alias `Strings`\n+\n+fn main() {}"}, {"sha": "6e03eeada499c46d864f9597bafb9d8581c5d042", "filename": "src/test/ui/traits/alias/suggest-trait-alias-instead-of-type.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/539242a07b15ec95aa196bfa4c18f6a8b01b8ecb/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Falias%2Fsuggest-trait-alias-instead-of-type.stderr?ref=539242a07b15ec95aa196bfa4c18f6a8b01b8ecb", "patch": "@@ -0,0 +1,14 @@\n+error[E0404]: expected trait, found type alias `Strings`\n+  --> $DIR/suggest-trait-alias-instead-of-type.rs:10:18\n+   |\n+LL | struct Struct<S: Strings>(S);\n+   |                  ^^^^^^^ type aliases cannot be used as traits\n+   |\n+help: you might have meant to use `#![feature(trait_alias)]` instead of a `type` alias\n+   |\n+LL | trait Strings = Iterator<Item=String>;\n+   |\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0404`."}]}