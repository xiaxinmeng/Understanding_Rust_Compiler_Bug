{"sha": "8374ab6d65e887b1458d1de517dbf59b8c542ea4", "node_id": "C_kwDOAAsO6NoAKDgzNzRhYjZkNjVlODg3YjE0NThkMWRlNTE3ZGJmNTliOGM1NDJlYTQ", "commit": {"author": {"name": "Samrat Man Singh", "email": "samratmansingh@gmail.com", "date": "2020-05-07T05:23:44Z"}, "committer": {"name": "Michael Holloway", "email": "mdh@mdholloway.org", "date": "2022-07-19T02:28:17Z"}, "message": "Don't add attribute to allow unused-qualifications to derive impl's\n\nCurrently `#![forbid(unused_qualifications)]` is incompatible with all\nderive's because we add `#[allow(unused_qualifications)]` in all\ngenerated impl's.", "tree": {"sha": "7d09800a0396549fd80757bb10455e88cb2e4174", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d09800a0396549fd80757bb10455e88cb2e4174"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8374ab6d65e887b1458d1de517dbf59b8c542ea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8374ab6d65e887b1458d1de517dbf59b8c542ea4", "html_url": "https://github.com/rust-lang/rust/commit/8374ab6d65e887b1458d1de517dbf59b8c542ea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8374ab6d65e887b1458d1de517dbf59b8c542ea4/comments", "author": {"login": "samrat", "id": 480806, "node_id": "MDQ6VXNlcjQ4MDgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/480806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samrat", "html_url": "https://github.com/samrat", "followers_url": "https://api.github.com/users/samrat/followers", "following_url": "https://api.github.com/users/samrat/following{/other_user}", "gists_url": "https://api.github.com/users/samrat/gists{/gist_id}", "starred_url": "https://api.github.com/users/samrat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samrat/subscriptions", "organizations_url": "https://api.github.com/users/samrat/orgs", "repos_url": "https://api.github.com/users/samrat/repos", "events_url": "https://api.github.com/users/samrat/events{/privacy}", "received_events_url": "https://api.github.com/users/samrat/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mdholloway", "id": 6295242, "node_id": "MDQ6VXNlcjYyOTUyNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/6295242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mdholloway", "html_url": "https://github.com/mdholloway", "followers_url": "https://api.github.com/users/mdholloway/followers", "following_url": "https://api.github.com/users/mdholloway/following{/other_user}", "gists_url": "https://api.github.com/users/mdholloway/gists{/gist_id}", "starred_url": "https://api.github.com/users/mdholloway/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mdholloway/subscriptions", "organizations_url": "https://api.github.com/users/mdholloway/orgs", "repos_url": "https://api.github.com/users/mdholloway/repos", "events_url": "https://api.github.com/users/mdholloway/events{/privacy}", "received_events_url": "https://api.github.com/users/mdholloway/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed9173276a176126150b4c684a4262a135ce51ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed9173276a176126150b4c684a4262a135ce51ef", "html_url": "https://github.com/rust-lang/rust/commit/ed9173276a176126150b4c684a4262a135ce51ef"}], "stats": {"total": 48, "additions": 39, "deletions": 9}, "files": [{"sha": "735017aa5a850f9d3ec9690aab3e029b7bfba649", "filename": "compiler/rustc_builtin_macros/src/deriving/generic/mod.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8374ab6d65e887b1458d1de517dbf59b8c542ea4/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8374ab6d65e887b1458d1de517dbf59b8c542ea4/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs?ref=8374ab6d65e887b1458d1de517dbf59b8c542ea4", "patch": "@@ -727,16 +727,8 @@ impl<'a> TraitDef<'a> {\n \n         let attr = cx.attribute(cx.meta_word(self.span, sym::automatically_derived));\n         let opt_trait_ref = Some(trait_ref);\n-        let unused_qual = {\n-            let word = rustc_ast::attr::mk_nested_word_item(Ident::new(\n-                sym::unused_qualifications,\n-                self.span,\n-            ));\n-            let list = rustc_ast::attr::mk_list_item(Ident::new(sym::allow, self.span), vec![word]);\n-            cx.attribute(list)\n-        };\n \n-        let mut a = vec![attr, unused_qual];\n+        let mut a = vec![attr];\n         a.extend(self.attributes.iter().cloned());\n \n         cx.item("}, {"sha": "9d0e3068aed73a41dd9c89df2e42a09735d9396d", "filename": "src/test/ui/lint/auxiliary/add-impl.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/8374ab6d65e887b1458d1de517dbf59b8c542ea4/src%2Ftest%2Fui%2Flint%2Fauxiliary%2Fadd-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8374ab6d65e887b1458d1de517dbf59b8c542ea4/src%2Ftest%2Fui%2Flint%2Fauxiliary%2Fadd-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fauxiliary%2Fadd-impl.rs?ref=8374ab6d65e887b1458d1de517dbf59b8c542ea4", "patch": "@@ -0,0 +1,22 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_derive(AddImpl)]\n+// Unnecessary qualification `bar::foo`\n+// https://github.com/rust-lang/rust/issues/71898\n+pub fn derive(input: TokenStream) -> TokenStream {\n+    \"impl B {\n+            fn foo(&self) { use bar::foo; bar::foo() }\n+        }\n+\n+        fn foo() {}\n+\n+        mod bar { pub fn foo() {} }\n+    \".parse().unwrap()\n+}"}, {"sha": "c2efbf507fec88c06f79091a0d6c2f781bbd7698", "filename": "src/test/ui/lint/unused-qualification-in-derive-expansion.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/8374ab6d65e887b1458d1de517dbf59b8c542ea4/src%2Ftest%2Fui%2Flint%2Funused-qualification-in-derive-expansion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8374ab6d65e887b1458d1de517dbf59b8c542ea4/src%2Ftest%2Fui%2Flint%2Funused-qualification-in-derive-expansion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused-qualification-in-derive-expansion.rs?ref=8374ab6d65e887b1458d1de517dbf59b8c542ea4", "patch": "@@ -0,0 +1,16 @@\n+// run-pass\n+// aux-build:add-impl.rs\n+\n+#![forbid(unused_qualifications)]\n+\n+#[macro_use]\n+extern crate add_impl;\n+\n+#[derive(AddImpl)]\n+struct B;\n+\n+fn main() {\n+    B.foo();\n+    foo();\n+    bar::foo();\n+}"}]}