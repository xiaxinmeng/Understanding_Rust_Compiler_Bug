{"sha": "f368a1805934f2a5da99b9b47692577d0699f33e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzNjhhMTgwNTkzNGYyYTVkYTk5YjliNDc2OTI1NzdkMDY5OWYzM2U=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2015-10-03T00:38:22Z"}, "committer": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2015-10-03T00:38:22Z"}, "message": "Rollup merge of #28736 - nagisa:rustdocjsfix, r=alexcrichton", "tree": {"sha": "8614886f7ab6b23f2a8443b73e2addcdfd962d85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8614886f7ab6b23f2a8443b73e2addcdfd962d85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f368a1805934f2a5da99b9b47692577d0699f33e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f368a1805934f2a5da99b9b47692577d0699f33e", "html_url": "https://github.com/rust-lang/rust/commit/f368a1805934f2a5da99b9b47692577d0699f33e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f368a1805934f2a5da99b9b47692577d0699f33e/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfb26033af68949646081429040db606a044db22", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfb26033af68949646081429040db606a044db22", "html_url": "https://github.com/rust-lang/rust/commit/bfb26033af68949646081429040db606a044db22"}, {"sha": "f38bc2c45763f773c9373634dbbe58cc36bf8704", "url": "https://api.github.com/repos/rust-lang/rust/commits/f38bc2c45763f773c9373634dbbe58cc36bf8704", "html_url": "https://github.com/rust-lang/rust/commit/f38bc2c45763f773c9373634dbbe58cc36bf8704"}], "stats": {"total": 30, "additions": 18, "deletions": 12}, "files": [{"sha": "5a6d76168322402f27d991b96a67fa1dacb8ecd2", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 12, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f368a1805934f2a5da99b9b47692577d0699f33e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/f368a1805934f2a5da99b9b47692577d0699f33e/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=f368a1805934f2a5da99b9b47692577d0699f33e", "patch": "@@ -133,7 +133,7 @@\n     $(document).on(\"keypress\", handleShortcut);\n     $(document).on(\"keydown\", handleShortcut);\n     $(document).on(\"click\", function(ev) {\n-        if (!$(e.target).closest(\"#help > div\").length) {\n+        if (!$(ev.target).closest(\"#help > div\").length) {\n             $(\"#help\").addClass(\"hidden\");\n             $(\"body\").removeClass(\"blur\");\n         }\n@@ -515,23 +515,20 @@\n                 var $active = $results.filter('.highlighted');\n \n                 if (e.which === 38) { // up\n-                    e.preventDefault();\n                     if (!$active.length || !$active.prev()) {\n                         return;\n                     }\n \n                     $active.prev().addClass('highlighted');\n                     $active.removeClass('highlighted');\n                 } else if (e.which === 40) { // down\n-                    e.preventDefault();\n                     if (!$active.length) {\n                         $results.first().addClass('highlighted');\n                     } else if ($active.next().length) {\n                         $active.next().addClass('highlighted');\n                         $active.removeClass('highlighted');\n                     }\n                 } else if (e.which === 13) { // return\n-                    e.preventDefault();\n                     if ($active.length) {\n                         document.location.href = $active.find('a').prop('href');\n                     }\n@@ -722,20 +719,29 @@\n         }\n \n         function startSearch() {\n-\n-            $(\".search-input\").on(\"keyup\",function() {\n+            var searchTimeout;\n+            $(\".search-input\").on(\"keyup input\",function() {\n+                clearTimeout(searchTimeout);\n                 if ($(this).val().length === 0) {\n                     window.history.replaceState(\"\", \"std - Rust\", \"?search=\");\n                     $('#main.content').removeClass('hidden');\n                     $('#search.content').addClass('hidden');\n+                } else {\n+                    searchTimeout = setTimeout(search, 500);\n                 }\n             });\n-\n-            var keyUpTimeout;\n-            $('.do-search').on('click', search);\n-            $('.search-input').on('keyup', function() {\n-                clearTimeout(keyUpTimeout);\n-                keyUpTimeout = setTimeout(search, 500);\n+            $('.search-form').on('submit', function(e){\n+                e.preventDefault();\n+                clearTimeout(searchTimeout);\n+                search();\n+            });\n+            $('.search-input').on('change paste', function(e) {\n+                // Do NOT e.preventDefault() here. It will prevent pasting.\n+                clearTimeout(searchTimeout);\n+                // zero-timeout necessary here because at the time of event handler execution the\n+                // pasted content is not in the input field yet. Shouldn\u2019t make any difference for\n+                // change, though.\n+                setTimeout(search, 0);\n             });\n \n             // Push and pop states are used to add search results to the browser"}]}