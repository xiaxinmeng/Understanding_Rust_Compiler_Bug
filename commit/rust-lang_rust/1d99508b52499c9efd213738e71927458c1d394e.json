{"sha": "1d99508b52499c9efd213738e71927458c1d394e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkOTk1MDhiNTI0OTljOWVmZDIxMzczOGU3MTkyNzQ1OGMxZDM5NGU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-06T07:02:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-06T07:02:06Z"}, "message": "Auto merge of #84468 - iladin:iladin/fix-84467, r=petrochenkov\n\nFix#84467 linker_args with --target=sparcv9-sun-solaris\n\nTrying to cross-compile for sparcv9-sun-solaris\ngetting a error message for -zignore\n\nIntroduced when -z -ignore was seperated here\n22d0ab0\n\nNo formatting done\n\nReproduce\n\n``` bash\nrustup target add sparcv9-sun-solaris\ncargo new --bin hello && cd hello && cargo run --target=sparcv9-sun-solaris\n```\n\nconfig.toml\n\n[target.sparcv9-sun-solaris]\nlinker = \"gcc\"", "tree": {"sha": "c6038c10d28b76b941cb339b8491f5e9c273b757", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6038c10d28b76b941cb339b8491f5e9c273b757"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d99508b52499c9efd213738e71927458c1d394e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d99508b52499c9efd213738e71927458c1d394e", "html_url": "https://github.com/rust-lang/rust/commit/1d99508b52499c9efd213738e71927458c1d394e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d99508b52499c9efd213738e71927458c1d394e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d620ae10709ca3669cda89db8b29afcd9accc188", "url": "https://api.github.com/repos/rust-lang/rust/commits/d620ae10709ca3669cda89db8b29afcd9accc188", "html_url": "https://github.com/rust-lang/rust/commit/d620ae10709ca3669cda89db8b29afcd9accc188"}, {"sha": "fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "html_url": "https://github.com/rust-lang/rust/commit/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "8ba124a1fa88c789271ddbd2c32af2b0c7b05c27", "filename": "compiler/rustc_codegen_ssa/src/back/linker.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1d99508b52499c9efd213738e71927458c1d394e/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d99508b52499c9efd213738e71927458c1d394e/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs?ref=1d99508b52499c9efd213738e71927458c1d394e", "patch": "@@ -432,8 +432,6 @@ impl<'a> Linker for GccLinker<'a> {\n         // insert it here.\n         if self.sess.target.is_like_osx {\n             self.linker_arg(\"-dead_strip\");\n-        } else if self.sess.target.is_like_solaris {\n-            self.linker_arg(\"-zignore\");\n \n         // If we're building a dylib, we don't use --gc-sections because LLVM\n         // has already done the best it can do, and we also don't want to\n@@ -655,6 +653,10 @@ impl<'a> Linker for GccLinker<'a> {\n     fn add_as_needed(&mut self) {\n         if self.sess.target.linker_is_gnu {\n             self.linker_arg(\"--as-needed\");\n+        } else if self.sess.target.is_like_solaris {\n+            // -z ignore is the Solaris equivalent to the GNU ld --as-needed option\n+            self.linker_arg(\"-z\");\n+            self.linker_arg(\"ignore\");\n         }\n     }\n }"}]}