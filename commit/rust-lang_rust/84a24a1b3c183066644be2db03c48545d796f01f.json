{"sha": "84a24a1b3c183066644be2db03c48545d796f01f", "node_id": "C_kwDOAAsO6NoAKDg0YTI0YTFiM2MxODMwNjY2NDRiZTJkYjAzYzQ4NTQ1ZDc5NmYwMWY", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-07-20T01:16:32Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-08-04T14:26:51Z"}, "message": "Unroll while_capturing_lifetimes into lower_opaque_impl_trait", "tree": {"sha": "479c8d1bea6bee49322d1e494fb9663a50f2efad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/479c8d1bea6bee49322d1e494fb9663a50f2efad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84a24a1b3c183066644be2db03c48545d796f01f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmLr1ysACgkQgTGiTgx5\n7699ew//QEgqublT2jN+L2yeKqe70veXBZM3RINHQV1fYgTtdUuhP3auoPWrztIH\n0vagAj/kzoXDZ2Jbs3y48xd6F27Qk8yhNtbiky/WEQWMf+1rjhc2wqrZcmLos5uD\nJm8+Ooz9dVRvsoWmZxwaGsbXb6Snr0JR92+4805vv8NEP2c+9dhSoRHSki/6It6T\n7d2TpyP/BiM4IsJBbOoFIhJIcqcQSBPI2/q2GOwrV6E4K4PBOmQaBRAocK+u5psX\nSRnPZxXp6GHm8lEHDMmb1NYSwGG7VI6qmgwOOkW7pt2r+Oyq1bHPGGtns6Hv8ooo\n3hXlKi1d2VKDUv9duQEPcy6aCzGJgiKWxq/GND4g7U/i3WJb/1Wm9jKqs1qnN/Yb\novPLScJi7ovOQyMVRY/iveONbMmn3/CPQKCZ3NCYd2MhpZ4tspXQTWL8i75/hFw/\n9X0uS8gEV4N/YMX8rbeILBBuyiTc3LPDWW2hAGJANZ5boPx5fJV71moueACcgLZB\nL+exiikn59MyJ+RMs/wkjg+Q+vq1nL5N6ulZIoYI63Ff2csF6lGTYwQQMB6X+js/\nGkbqbdZKL+jCrDbCWHF8UaxdME0Wlp0SKuqqQaabwbRYe+ZtuhDSObsKgh4D34Cq\nGIRUpOXph6lUreYK2b98bfGonJ0X5ETxmSTofvyPXLxQ+j+9M4M=\n=HZyl\n-----END PGP SIGNATURE-----", "payload": "tree 479c8d1bea6bee49322d1e494fb9663a50f2efad\nparent 0f11a0cd2482f6c8cf2e4eb00242214172835c36\nauthor Santiago Pastorino <spastorino@gmail.com> 1658279792 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1659623211 -0300\n\nUnroll while_capturing_lifetimes into lower_opaque_impl_trait\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84a24a1b3c183066644be2db03c48545d796f01f", "html_url": "https://github.com/rust-lang/rust/commit/84a24a1b3c183066644be2db03c48545d796f01f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84a24a1b3c183066644be2db03c48545d796f01f/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f11a0cd2482f6c8cf2e4eb00242214172835c36", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f11a0cd2482f6c8cf2e4eb00242214172835c36", "html_url": "https://github.com/rust-lang/rust/commit/0f11a0cd2482f6c8cf2e4eb00242214172835c36"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "72e0466761a059ac4d2b13f1b5348e824072901b", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/84a24a1b3c183066644be2db03c48545d796f01f/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84a24a1b3c183066644be2db03c48545d796f01f/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=84a24a1b3c183066644be2db03c48545d796f01f", "patch": "@@ -1376,11 +1376,21 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n             let hir_bounds = if origin == hir::OpaqueTyOrigin::TyAlias {\n                 lower_bounds(lctx)\n             } else {\n-                lctx.while_capturing_lifetimes(\n-                    opaque_ty_def_id,\n-                    &mut collected_lifetimes,\n-                    lower_bounds,\n-                )\n+                let lifetime_stash = std::mem::replace(\n+                    &mut lctx.captured_lifetimes,\n+                    Some(LifetimeCaptureContext {\n+                        parent_def_id: opaque_ty_def_id,\n+                        captures: std::mem::take(&mut collected_lifetimes),\n+                        binders_to_ignore: Default::default(),\n+                    }),\n+                );\n+\n+                let ret = lower_bounds(lctx);\n+\n+                let ctxt = std::mem::replace(&mut lctx.captured_lifetimes, lifetime_stash).unwrap();\n+                collected_lifetimes = ctxt.captures;\n+\n+                ret\n             };\n             debug!(?collected_lifetimes);\n "}]}