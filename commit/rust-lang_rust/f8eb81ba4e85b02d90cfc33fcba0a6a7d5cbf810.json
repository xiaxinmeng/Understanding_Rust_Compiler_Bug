{"sha": "f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4ZWI4MWJhNGU4NWIwMmQ5MGNmYzMzZmNiYTBhNmE3ZDVjYmY4MTA=", "commit": {"author": {"name": "MaulingMonkey", "email": "git@maulingmonkey.com", "date": "2020-06-25T02:28:12Z"}, "committer": {"name": "MaulingMonkey", "email": "git@maulingmonkey.com", "date": "2020-06-25T02:28:12Z"}, "message": "Modify type names on MSVC to make tuples .natvis compatible.\n\n- Mangles (T0, T1) as tuple<T0, T1>, possibly unblocking rust-lang/rust#70052 \"Update hashbrown to 0.8.0\"\n- Prettifies Rust tuples similar to VS2017's std::tuple\n- Improves debuginfo test coverage", "tree": {"sha": "44bfb6a6e00309ba576b916693b2f3b0679e433d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44bfb6a6e00309ba576b916693b2f3b0679e433d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "html_url": "https://github.com/rust-lang/rust/commit/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/comments", "author": {"login": "MaulingMonkey", "id": 75894, "node_id": "MDQ6VXNlcjc1ODk0", "avatar_url": "https://avatars.githubusercontent.com/u/75894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaulingMonkey", "html_url": "https://github.com/MaulingMonkey", "followers_url": "https://api.github.com/users/MaulingMonkey/followers", "following_url": "https://api.github.com/users/MaulingMonkey/following{/other_user}", "gists_url": "https://api.github.com/users/MaulingMonkey/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaulingMonkey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaulingMonkey/subscriptions", "organizations_url": "https://api.github.com/users/MaulingMonkey/orgs", "repos_url": "https://api.github.com/users/MaulingMonkey/repos", "events_url": "https://api.github.com/users/MaulingMonkey/events{/privacy}", "received_events_url": "https://api.github.com/users/MaulingMonkey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MaulingMonkey", "id": 75894, "node_id": "MDQ6VXNlcjc1ODk0", "avatar_url": "https://avatars.githubusercontent.com/u/75894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaulingMonkey", "html_url": "https://github.com/MaulingMonkey", "followers_url": "https://api.github.com/users/MaulingMonkey/followers", "following_url": "https://api.github.com/users/MaulingMonkey/following{/other_user}", "gists_url": "https://api.github.com/users/MaulingMonkey/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaulingMonkey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaulingMonkey/subscriptions", "organizations_url": "https://api.github.com/users/MaulingMonkey/orgs", "repos_url": "https://api.github.com/users/MaulingMonkey/repos", "events_url": "https://api.github.com/users/MaulingMonkey/events{/privacy}", "received_events_url": "https://api.github.com/users/MaulingMonkey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67100f61e62a86f2bf9e38552ee138e231eddc74", "url": "https://api.github.com/repos/rust-lang/rust/commits/67100f61e62a86f2bf9e38552ee138e231eddc74", "html_url": "https://github.com/rust-lang/rust/commit/67100f61e62a86f2bf9e38552ee138e231eddc74"}], "stats": {"total": 247, "additions": 245, "deletions": 2}, "files": [{"sha": "874550da8b0c97b196d1371af91879ca54c39b74", "filename": "src/etc/natvis/intrinsic.natvis", "status": "modified", "additions": 124, "deletions": 0, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Fetc%2Fnatvis%2Fintrinsic.natvis", "raw_url": "https://github.com/rust-lang/rust/raw/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Fetc%2Fnatvis%2Fintrinsic.natvis", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fnatvis%2Fintrinsic.natvis?ref=f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "patch": "@@ -21,4 +21,128 @@\n       </ArrayItems>\n     </Expand>\n   </Type>\n+  <Type Name=\"tuple&lt;&gt;\">\n+    <DisplayString>()</DisplayString>\n+  </Type>\n+  <Type Name=\"tuple&lt;*&gt;\">\n+    <DisplayString>({__0})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*&gt;\">\n+    <DisplayString>({__0}, {__1})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5}, {__6})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+      <Item Name=\"[6]\">__6</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5}, {__6}, {__7})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+      <Item Name=\"[6]\">__6</Item>\n+      <Item Name=\"[7]\">__7</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5}, {__6}, {__7}, {__8})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+      <Item Name=\"[6]\">__6</Item>\n+      <Item Name=\"[7]\">__7</Item>\n+      <Item Name=\"[8]\">__8</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5}, {__6}, {__7}, {__8}, {__9})</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+      <Item Name=\"[6]\">__6</Item>\n+      <Item Name=\"[7]\">__7</Item>\n+      <Item Name=\"[8]\">__8</Item>\n+      <Item Name=\"[9]\">__9</Item>\n+    </Expand>\n+  </Type>\n+  <Type Name=\"tuple&lt;*,*,*,*,*,*,*,*,*,*,*&gt;\">\n+    <DisplayString>({__0}, {__1}, {__2}, {__3}, {__4}, {__5}, {__6}, {__7}, {__8}, {__9}, ...)</DisplayString>\n+    <Expand>\n+      <Item Name=\"[0]\">__0</Item>\n+      <Item Name=\"[1]\">__1</Item>\n+      <Item Name=\"[2]\">__2</Item>\n+      <Item Name=\"[3]\">__3</Item>\n+      <Item Name=\"[4]\">__4</Item>\n+      <Item Name=\"[5]\">__5</Item>\n+      <Item Name=\"[6]\">__6</Item>\n+      <Item Name=\"[7]\">__7</Item>\n+      <Item Name=\"[8]\">__8</Item>\n+      <Item Name=\"[9]\">__9</Item>\n+      <Synthetic Name=\"[...]\"><DisplayString>...</DisplayString></Synthetic>\n+    </Expand>\n+  </Type>\n </AutoVisualizer>"}, {"sha": "20d440433cbb0bc4f5b27bc3f4490aabadecd39f", "filename": "src/librustc_codegen_ssa/debuginfo/type_names.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs?ref=f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "patch": "@@ -47,7 +47,12 @@ pub fn push_debuginfo_type_name<'tcx>(\n             push_type_params(tcx, substs, output, visited);\n         }\n         ty::Tuple(component_types) => {\n-            output.push('(');\n+            if cpp_like_names {\n+                output.push_str(\"tuple<\");\n+            } else {\n+                output.push('(');\n+            }\n+\n             for component_type in component_types {\n                 push_debuginfo_type_name(tcx, component_type.expect_ty(), true, output, visited);\n                 output.push_str(\", \");\n@@ -56,7 +61,12 @@ pub fn push_debuginfo_type_name<'tcx>(\n                 output.pop();\n                 output.pop();\n             }\n-            output.push(')');\n+\n+            if cpp_like_names {\n+                output.push('>');\n+            } else {\n+                output.push(')');\n+            }\n         }\n         ty::RawPtr(ty::TypeAndMut { ty: inner_type, mutbl }) => {\n             if !cpp_like_names {"}, {"sha": "b7fcfeef090aa590dc4e41c63a68ba840323a14c", "filename": "src/test/debuginfo/simple-tuple.rs", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Ftest%2Fdebuginfo%2Fsimple-tuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Ftest%2Fdebuginfo%2Fsimple-tuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fsimple-tuple.rs?ref=f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "patch": "@@ -123,6 +123,48 @@\n // lldbg-check:[...]$6 = { 0 = 15 1 = 16 }\n // lldbr-check:((i32, i16)) paddingAtEnd = { 0 = 15 1 = 16 }\n \n+\n+// === CDB TESTS ==================================================================================\n+\n+// cdb-command: g\n+\n+// cdb-command:dx noPadding8,d\n+// cdb-check:noPadding8,d [...]: (-100, 100) [Type: tuple<i8, u8>]\n+// cdb-check:[...][0]              : -100 [Type: [...]]\n+// cdb-check:[...][1]              : 100 [Type: [...]]\n+// cdb-command:dx noPadding16,d\n+// cdb-check:noPadding16,d [...]: (0, 1, 2) [Type: tuple<i16, i16, u16>]\n+// cdb-check:[...][0]              : 0 [Type: [...]]\n+// cdb-check:[...][1]              : 1 [Type: [...]]\n+// cdb-check:[...][2]              : 2 [Type: [...]]\n+// cdb-command:dx noPadding32,d\n+// cdb-check:noPadding32,d [...]: (3, 4.5[...], 5) [Type: tuple<i32, f32, u32>]\n+// cdb-check:[...][0]              : 3 [Type: [...]]\n+// cdb-check:[...][1]              : 4.5[...] [Type: [...]]\n+// cdb-check:[...][2]              : 5 [Type: [...]]\n+// cdb-command:dx noPadding64,d\n+// cdb-check:noPadding64,d [...]: (6, 7.5[...], 8) [Type: tuple<i64, f64, u64>]\n+// cdb-check:[...][0]              : 6 [Type: [...]]\n+// cdb-check:[...][1]              : 7.500000 [Type: [...]]\n+// cdb-check:[...][2]              : 8 [Type: [...]]\n+\n+// cdb-command:dx internalPadding1,d\n+// cdb-check:internalPadding1,d [...]: (9, 10) [Type: tuple<i16, i32>]\n+// cdb-check:[...][0]              : 9 [Type: short]\n+// cdb-check:[...][1]              : 10 [Type: int]\n+// cdb-command:dx internalPadding2,d\n+// cdb-check:internalPadding2,d [...]: (11, 12, 13, 14) [Type: tuple<i16, i32, u32, u64>]\n+// cdb-check:[...][0]              : 11 [Type: [...]]\n+// cdb-check:[...][1]              : 12 [Type: [...]]\n+// cdb-check:[...][2]              : 13 [Type: [...]]\n+// cdb-check:[...][3]              : 14 [Type: [...]]\n+\n+// cdb-command:dx paddingAtEnd,d\n+// cdb-check:paddingAtEnd,d [...]: (15, 16) [Type: tuple<i32, i16>]\n+// cdb-check:[...][0]              : 15 [Type: [...]]\n+// cdb-check:[...][1]              : 16 [Type: [...]]\n+\n+\n #![allow(unused_variables)]\n #![allow(dead_code)]\n #![feature(omit_gdb_pretty_printer_section)]"}, {"sha": "0447d8e9ddeb0d8d1caf255cf497b54d5de39cea", "filename": "src/test/debuginfo/tuple-in-tuple.rs", "status": "modified", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Ftest%2Fdebuginfo%2Ftuple-in-tuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810/src%2Ftest%2Fdebuginfo%2Ftuple-in-tuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Ftuple-in-tuple.rs?ref=f8eb81ba4e85b02d90cfc33fcba0a6a7d5cbf810", "patch": "@@ -59,6 +59,73 @@\n // lldbg-check:[...]$6 = { 0 = { 0 = 21 1 = 22 } 1 = 23 }\n // lldbr-check:(((i32, i16), i32)) padding_at_end2 = { 0 = { 0 = 21 1 = 22 } 1 = 23 }\n \n+\n+// === CDB TESTS ==================================================================================\n+\n+// cdb-command: g\n+\n+// cdb-command:dx no_padding1,d\n+// cdb-check:no_padding1,d [...]: ((0, 1), 2, 3) [Type: tuple<tuple<u32, u32>, u32, u32>]\n+// cdb-check:[...][0]              : (0, 1) [Type: tuple<u32, u32>]\n+// cdb-check:[...][1]              : 2 [Type: [...]]\n+// cdb-check:[...][2]              : 3 [Type: [...]]\n+// cdb-command:dx no_padding1.__0,d\n+// cdb-check:no_padding1.__0,d [...]: (0, 1) [Type: tuple<u32, u32>]\n+// cdb-check:[...][0]              : 0 [Type: [...]]\n+// cdb-check:[...][1]              : 1 [Type: [...]]\n+// cdb-command:dx no_padding2,d\n+// cdb-check:no_padding2,d [...]: (4, (5, 6), 7) [Type: tuple<u32, tuple<u32, u32>, u32>]\n+// cdb-check:[...][0]              : 4 [Type: [...]]\n+// cdb-check:[...][1]              : (5, 6) [Type: tuple<u32, u32>]\n+// cdb-check:[...][2]              : 7 [Type: [...]]\n+// cdb-command:dx no_padding2.__1,d\n+// cdb-check:no_padding2.__1,d [...]: (5, 6) [Type: tuple<u32, u32>]\n+// cdb-check:[...][0]              : 5 [Type: [...]]\n+// cdb-check:[...][1]              : 6 [Type: [...]]\n+// cdb-command:dx no_padding3,d\n+// cdb-check:no_padding3,d [...]: (8, 9, (10, 11)) [Type: tuple<u32, u32, tuple<u32, u32>>]\n+// cdb-check:[...][0]              : 8 [Type: [...]]\n+// cdb-check:[...][1]              : 9 [Type: [...]]\n+// cdb-check:[...][2]              : (10, 11) [Type: tuple<u32, u32>]\n+// cdb-command:dx no_padding3.__2,d\n+// cdb-check:no_padding3.__2,d [...]: (10, 11) [Type: tuple<u32, u32>]\n+// cdb-check:[...][0]              : 10 [Type: [...]]\n+// cdb-check:[...][1]              : 11 [Type: [...]]\n+\n+// cdb-command:dx internal_padding1,d\n+// cdb-check:internal_padding1,d [...]: (12, (13, 14)) [Type: tuple<i16, tuple<i32, i32>>]\n+// cdb-check:[...][0]              : 12 [Type: [...]]\n+// cdb-check:[...][1]              : (13, 14) [Type: tuple<i32, i32>]\n+// cdb-command:dx internal_padding1.__1,d\n+// cdb-check:internal_padding1.__1,d [...]: (13, 14) [Type: tuple<i32, i32>]\n+// cdb-check:[...][0]              : 13 [Type: [...]]\n+// cdb-check:[...][1]              : 14 [Type: [...]]\n+// cdb-command:dx internal_padding2,d\n+// cdb-check:internal_padding2,d [...]: (15, (16, 17)) [Type: tuple<i16, tuple<i16, i32>>]\n+// cdb-check:[...][0]              : 15 [Type: [...]]\n+// cdb-check:[...][1]              : (16, 17) [Type: tuple<i16, i32>]\n+// cdb-command:dx internal_padding2.__1,d\n+// cdb-check:internal_padding2.__1,d [...]: (16, 17) [Type: tuple<i16, i32>]\n+// cdb-check:[...][0]              : 16 [Type: [...]]\n+// cdb-check:[...][1]              : 17 [Type: [...]]\n+\n+// cdb-command:dx padding_at_end1,d\n+// cdb-check:padding_at_end1,d [...]: (18, (19, 20)) [Type: tuple<i32, tuple<i32, i16>>]\n+// cdb-check:[...][0]              : 18 [Type: [...]]\n+// cdb-check:[...][1]              : (19, 20) [Type: tuple<i32, i16>]\n+// cdb-command:dx padding_at_end1.__1,d\n+// cdb-check:padding_at_end1.__1,d [...][Type: tuple<i32, i16>]\n+// cdb-check:[...][0]              : 19 [Type: [...]]\n+// cdb-check:[...][1]              : 20 [Type: [...]]\n+// cdb-command:dx padding_at_end2,d\n+// cdb-check:padding_at_end2,d [...]: ((21, 22), 23) [Type: tuple<tuple<i32, i16>, i32>]\n+// cdb-check:[...][0]              : (21, 22) [Type: tuple<i32, i16>]\n+// cdb-check:[...][1]              : 23 [Type: [...]]\n+// cdb-command:dx padding_at_end2.__0,d\n+// cdb-check:padding_at_end2.__0,d [...]: (21, 22) [Type: tuple<i32, i16>]\n+// cdb-check:[...][0]              : 21 [Type: [...]]\n+// cdb-check:[...][1]              : 22 [Type: [...]]\n+\n #![allow(unused_variables)]\n #![feature(omit_gdb_pretty_printer_section)]\n #![omit_gdb_pretty_printer_section]"}]}