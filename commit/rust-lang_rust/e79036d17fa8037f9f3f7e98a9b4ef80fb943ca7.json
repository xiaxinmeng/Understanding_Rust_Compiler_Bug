{"sha": "e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3OTAzNmQxN2ZhODAzN2Y5ZjNmN2U5OGE5YjRlZjgwZmI5NDNjYTc=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-09-26T10:00:53Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-09-26T15:55:52Z"}, "message": "hir: Disallow `target_feature` on constants\n\nThis commit fixes an ICE when `target_feature` is applied to constants.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "492cb5988b2bf2eda8a4b08d8ecd742742f477f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/492cb5988b2bf2eda8a4b08d8ecd742742f477f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl2M34kACgkQJZLnbIc4\nH9naEg//RJG+zQ0tCgHCaoREx1Y6dN26HIOFaXE0u0PSXhbF0atd4xbjs8iOKlDE\nEF2LXU40qBYibeHPAnoJdP2hhsSoS4j68dG6h9ecJo4uOYXpuGVAiT3COlr7p4Bl\nwGXkq0YLfXSdY5N4nE3Rk4Y9D2Ytg8ueS/fktca0gdmcSu98RHOcAFgjz+nQMjCK\nUnkuPFp9ZLu9G/DVGgdU3ilGxYxqnRXlr00by89o3rPDo6CaSoJBuZlMTFQV5BO/\nmigIz2OPJWm8R2G3vrmhV9RW5S5VRqyCH9jVpYAw8SXBUL9QMoYJJC8aRUb58npS\nuRVkspKoKiac8WHnnaok7JHxA5s30azXOnktrXjRz8nc/PLDqHBYsZp+ctGAv1NB\ncGVZSMMRRUD8C5dFSCHF73aRnGZKOEEyZy0YZHG61r/vIHF9LFSBaNMeTFTZJeFa\nHuryAE9YpO+EHPfdrNOy9dNpVcvFnSllPfCpZ8Db1Epa7rrDqr2UW0YEZvu2dLdQ\nKPXDrBHCVS+PB4mMOUmO1+oXPOm9D/qkgNeK9pN16dEkn5vzBw/ZhSVT14ks1ON1\nJCqK+4Wvs3EX+24MI9lEXVXt4WWkeQdchD3p9PaQ+MkEczoNE3NRZOgVDOXYkvtw\nJVHNQKsjS06uRXG9w1oMLlqWMMfUt824krS5J3/+82Acg4DshW8=\n=2ejU\n-----END PGP SIGNATURE-----", "payload": "tree 492cb5988b2bf2eda8a4b08d8ecd742742f477f0\nparent 37538aa1365d1f8a10770a7d15c95b3167c8db57\nauthor David Wood <david@davidtw.co> 1569492053 +0100\ncommitter David Wood <david@davidtw.co> 1569513352 +0100\n\nhir: Disallow `target_feature` on constants\n\nThis commit fixes an ICE when `target_feature` is applied to constants.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "html_url": "https://github.com/rust-lang/rust/commit/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37538aa1365d1f8a10770a7d15c95b3167c8db57", "url": "https://api.github.com/repos/rust-lang/rust/commits/37538aa1365d1f8a10770a7d15c95b3167c8db57", "html_url": "https://github.com/rust-lang/rust/commit/37538aa1365d1f8a10770a7d15c95b3167c8db57"}], "stats": {"total": 275, "additions": 204, "deletions": 71}, "files": [{"sha": "283ab0103ec089be29c8cf545bfb61b854dbb7c0", "filename": "src/librustc/hir/check_attr.rs", "status": "modified", "additions": 52, "deletions": 20, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Flibrustc%2Fhir%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Flibrustc%2Fhir%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fcheck_attr.rs?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -93,70 +93,102 @@ struct CheckAttrVisitor<'tcx> {\n impl CheckAttrVisitor<'tcx> {\n     /// Checks any attribute.\n     fn check_attributes(&self, item: &hir::Item, target: Target) {\n-        if target == Target::Fn || target == Target::Const {\n-            self.tcx.codegen_fn_attrs(self.tcx.hir().local_def_id(item.hir_id));\n-        } else if let Some(a) = item.attrs.iter().find(|a| a.check_name(sym::target_feature)) {\n-            self.tcx.sess.struct_span_err(a.span, \"attribute should be applied to a function\")\n-                .span_label(item.span, \"not a function\")\n-                .emit();\n-        }\n-\n+        let mut is_valid = true;\n         for attr in &item.attrs {\n-            if attr.check_name(sym::inline) {\n+            is_valid &= if attr.check_name(sym::inline) {\n                 self.check_inline(attr, &item.span, target)\n             } else if attr.check_name(sym::non_exhaustive) {\n                 self.check_non_exhaustive(attr, item, target)\n             } else if attr.check_name(sym::marker) {\n                 self.check_marker(attr, item, target)\n-            }\n+            } else if attr.check_name(sym::target_feature) {\n+                self.check_target_feature(attr, item, target)\n+            } else {\n+                true\n+            };\n+        }\n+\n+        if !is_valid {\n+            return;\n+        }\n+\n+        if target == Target::Fn || target == Target::Const {\n+            self.tcx.codegen_fn_attrs(self.tcx.hir().local_def_id(item.hir_id));\n         }\n \n         self.check_repr(item, target);\n         self.check_used(item, target);\n     }\n \n-    /// Checks if an `#[inline]` is applied to a function or a closure.\n-    fn check_inline(&self, attr: &hir::Attribute, span: &Span, target: Target) {\n+    /// Checks if an `#[inline]` is applied to a function or a closure. Returns `true` if valid.\n+    fn check_inline(&self, attr: &hir::Attribute, span: &Span, target: Target) -> bool {\n         if target != Target::Fn && target != Target::Closure {\n             struct_span_err!(self.tcx.sess,\n                              attr.span,\n                              E0518,\n                              \"attribute should be applied to function or closure\")\n                 .span_label(*span, \"not a function or closure\")\n                 .emit();\n+            false\n+        } else {\n+            true\n         }\n     }\n \n-    /// Checks if the `#[non_exhaustive]` attribute on an `item` is valid.\n-    fn check_non_exhaustive(&self, attr: &hir::Attribute, item: &hir::Item, target: Target) {\n+    /// Checks if the `#[non_exhaustive]` attribute on an `item` is valid. Returns `true` if valid.\n+    fn check_non_exhaustive(\n+        &self,\n+        attr: &hir::Attribute,\n+        item: &hir::Item,\n+        target: Target,\n+    ) -> bool {\n         match target {\n-            Target::Struct | Target::Enum => { /* Valid */ },\n+            Target::Struct | Target::Enum => true,\n             _ => {\n                 struct_span_err!(self.tcx.sess,\n                                  attr.span,\n                                  E0701,\n                                  \"attribute can only be applied to a struct or enum\")\n                     .span_label(item.span, \"not a struct or enum\")\n                     .emit();\n-                return;\n+                false\n             }\n         }\n     }\n \n-    /// Checks if the `#[marker]` attribute on an `item` is valid.\n-    fn check_marker(&self, attr: &hir::Attribute, item: &hir::Item, target: Target) {\n+    /// Checks if the `#[marker]` attribute on an `item` is valid. Returns `true` if valid.\n+    fn check_marker(&self, attr: &hir::Attribute, item: &hir::Item, target: Target) -> bool {\n         match target {\n-            Target::Trait => { /* Valid */ },\n+            Target::Trait => true,\n             _ => {\n                 self.tcx.sess\n                     .struct_span_err(attr.span, \"attribute can only be applied to a trait\")\n                     .span_label(item.span, \"not a trait\")\n                     .emit();\n-                return;\n+                false\n             }\n         }\n     }\n \n+    /// Checks if the `#[target_feature]` attribute on `item` is valid. Returns `true` if valid.\n+    fn check_target_feature(\n+        &self,\n+        attr: &hir::Attribute,\n+        item: &hir::Item,\n+        target: Target,\n+    ) -> bool {\n+        match target {\n+            Target::Fn => true,\n+            _ => {\n+                self.tcx.sess\n+                    .struct_span_err(attr.span, \"attribute should be applied to a function\")\n+                    .span_label(item.span, \"not a function\")\n+                    .emit();\n+                false\n+            },\n+        }\n+    }\n+\n     /// Checks if the `#[repr]` attributes on `item` are valid.\n     fn check_repr(&self, item: &hir::Item, target: Target) {\n         // Extract the names of all repr hints, e.g., [foo, bar, align] for:"}, {"sha": "ae044eb843bd95659b07f0ca3eefac9288070a20", "filename": "src/test/ui/attributes/multiple-invalid.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.rs?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -0,0 +1,10 @@\n+// This test checks that all expected errors occur when there are multiple invalid attributes\n+// on an item.\n+\n+#[inline]\n+//~^ ERROR attribute should be applied to function or closure [E0518]\n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+const FOO: u8 = 0;\n+\n+fn main() { }"}, {"sha": "9bd29f15dbcca9d660159e5795ee0e32deb7bcbc", "filename": "src/test/ui/attributes/multiple-invalid.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fmultiple-invalid.stderr?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -0,0 +1,21 @@\n+error[E0518]: attribute should be applied to function or closure\n+  --> $DIR/multiple-invalid.rs:4:1\n+   |\n+LL | #[inline]\n+   | ^^^^^^^^^\n+...\n+LL | const FOO: u8 = 0;\n+   | ------------------ not a function or closure\n+\n+error: attribute should be applied to a function\n+  --> $DIR/multiple-invalid.rs:6:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | const FOO: u8 = 0;\n+   | ------------------ not a function\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0518`."}, {"sha": "47ca5a5ca478c5c0a3a30604712f36a40c2c3c86", "filename": "src/test/ui/target-feature-wrong.stderr", "status": "removed", "additions": 0, "deletions": 50, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/37538aa1365d1f8a10770a7d15c95b3167c8db57/src%2Ftest%2Fui%2Ftarget-feature-wrong.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/37538aa1365d1f8a10770a7d15c95b3167c8db57/src%2Ftest%2Fui%2Ftarget-feature-wrong.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature-wrong.stderr?ref=37538aa1365d1f8a10770a7d15c95b3167c8db57", "patch": "@@ -1,50 +0,0 @@\n-error: malformed `target_feature` attribute input\n-  --> $DIR/target-feature-wrong.rs:16:1\n-   |\n-LL | #[target_feature = \"+sse2\"]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: must be of the form: `#[target_feature(enable = \"name\")]`\n-\n-error: the feature named `foo` is not valid for this target\n-  --> $DIR/target-feature-wrong.rs:18:18\n-   |\n-LL | #[target_feature(enable = \"foo\")]\n-   |                  ^^^^^^^^^^^^^^ `foo` is not valid for this target\n-\n-error: malformed `target_feature` attribute input\n-  --> $DIR/target-feature-wrong.rs:21:18\n-   |\n-LL | #[target_feature(bar)]\n-   |                  ^^^ help: must be of the form: `enable = \"..\"`\n-\n-error: malformed `target_feature` attribute input\n-  --> $DIR/target-feature-wrong.rs:23:18\n-   |\n-LL | #[target_feature(disable = \"baz\")]\n-   |                  ^^^^^^^^^^^^^^^ help: must be of the form: `enable = \"..\"`\n-\n-error: `#[target_feature(..)]` can only be applied to `unsafe` functions\n-  --> $DIR/target-feature-wrong.rs:27:1\n-   |\n-LL | #[target_feature(enable = \"sse2\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ can only be applied to `unsafe` functions\n-...\n-LL | fn bar() {}\n-   | ----------- not an `unsafe` function\n-\n-error: attribute should be applied to a function\n-  --> $DIR/target-feature-wrong.rs:33:1\n-   |\n-LL | #[target_feature(enable = \"sse2\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-LL |\n-LL | mod another {}\n-   | -------------- not a function\n-\n-error: cannot use `#[inline(always)]` with `#[target_feature]`\n-  --> $DIR/target-feature-wrong.rs:38:1\n-   |\n-LL | #[inline(always)]\n-   | ^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 7 previous errors\n-"}, {"sha": "bc7f7caa1076663e66b98ec01872da0c4e11e034", "filename": "src/test/ui/target-feature/gate.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.rs?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "previous_filename": "src/test/ui/target-feature-gate.rs"}, {"sha": "05dbc6e90adc8a054ed5d06133324132402632ec", "filename": "src/test/ui/target-feature/gate.stderr", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature%2Fgate.stderr?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -1,5 +1,5 @@\n error[E0658]: the target feature `avx512bw` is currently unstable\n-  --> $DIR/target-feature-gate.rs:30:18\n+  --> $DIR/gate.rs:30:18\n    |\n LL | #[target_feature(enable = \"avx512bw\")]\n    |                  ^^^^^^^^^^^^^^^^^^^", "previous_filename": "src/test/ui/target-feature-gate.stderr"}, {"sha": "46680336632f905459f4bba3585bf55b180462a9", "filename": "src/test/ui/target-feature/invalid-attribute.rs", "status": "renamed", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.rs?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -35,6 +35,31 @@ fn bar() {}\n mod another {}\n //~^ NOTE not a function\n \n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+const FOO: usize = 7;\n+//~^ NOTE not a function\n+\n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+struct Foo;\n+//~^ NOTE not a function\n+\n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+enum Bar { }\n+//~^ NOTE not a function\n+\n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+union Qux { f1: u16, f2: u16 }\n+//~^ NOTE not a function\n+\n+#[target_feature(enable = \"sse2\")]\n+//~^ ERROR attribute should be applied to a function\n+trait Baz { }\n+//~^ NOTE not a function\n+\n #[inline(always)]\n //~^ ERROR: cannot use `#[inline(always)]`\n #[target_feature(enable = \"sse2\")]", "previous_filename": "src/test/ui/target-feature-wrong.rs"}, {"sha": "abfe5dd219770c4ed7db515e1a2c0cfeec42a61a", "filename": "src/test/ui/target-feature/invalid-attribute.stderr", "status": "added", "additions": 95, "deletions": 0, "changes": 95, "blob_url": "https://github.com/rust-lang/rust/blob/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature%2Finvalid-attribute.stderr?ref=e79036d17fa8037f9f3f7e98a9b4ef80fb943ca7", "patch": "@@ -0,0 +1,95 @@\n+error: malformed `target_feature` attribute input\n+  --> $DIR/invalid-attribute.rs:16:1\n+   |\n+LL | #[target_feature = \"+sse2\"]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: must be of the form: `#[target_feature(enable = \"name\")]`\n+\n+error: the feature named `foo` is not valid for this target\n+  --> $DIR/invalid-attribute.rs:18:18\n+   |\n+LL | #[target_feature(enable = \"foo\")]\n+   |                  ^^^^^^^^^^^^^^ `foo` is not valid for this target\n+\n+error: malformed `target_feature` attribute input\n+  --> $DIR/invalid-attribute.rs:21:18\n+   |\n+LL | #[target_feature(bar)]\n+   |                  ^^^ help: must be of the form: `enable = \"..\"`\n+\n+error: malformed `target_feature` attribute input\n+  --> $DIR/invalid-attribute.rs:23:18\n+   |\n+LL | #[target_feature(disable = \"baz\")]\n+   |                  ^^^^^^^^^^^^^^^ help: must be of the form: `enable = \"..\"`\n+\n+error: `#[target_feature(..)]` can only be applied to `unsafe` functions\n+  --> $DIR/invalid-attribute.rs:27:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ can only be applied to `unsafe` functions\n+...\n+LL | fn bar() {}\n+   | ----------- not an `unsafe` function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:33:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | mod another {}\n+   | -------------- not a function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:38:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | const FOO: usize = 7;\n+   | --------------------- not a function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:43:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | struct Foo;\n+   | ----------- not a function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:48:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | enum Bar { }\n+   | ------------ not a function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:53:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | union Qux { f1: u16, f2: u16 }\n+   | ------------------------------ not a function\n+\n+error: attribute should be applied to a function\n+  --> $DIR/invalid-attribute.rs:58:1\n+   |\n+LL | #[target_feature(enable = \"sse2\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL | trait Baz { }\n+   | ------------- not a function\n+\n+error: cannot use `#[inline(always)]` with `#[target_feature]`\n+  --> $DIR/invalid-attribute.rs:63:1\n+   |\n+LL | #[inline(always)]\n+   | ^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 12 previous errors\n+"}]}