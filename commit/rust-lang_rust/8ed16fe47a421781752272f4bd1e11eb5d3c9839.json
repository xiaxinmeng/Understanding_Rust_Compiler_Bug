{"sha": "8ed16fe47a421781752272f4bd1e11eb5d3c9839", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlZDE2ZmU0N2E0MjE3ODE3NTIyNzJmNGJkMWUxMWViNWQzYzk4Mzk=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-12-29T16:05:15Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-12-30T09:15:40Z"}, "message": "Requires tools to test-pass if the corresponding submodule is updated.\n\nIf a PR intends to update a tool but its test has failed, abort the merge\nregardless of current channel. This should help the tool maintainers if the\nupdate turns out to be failing due to changes in latest master.", "tree": {"sha": "bbf87b56b6bf49e87f0e92fd8e97347a77097007", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbf87b56b6bf49e87f0e92fd8e97347a77097007"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ed16fe47a421781752272f4bd1e11eb5d3c9839", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlpHWT0ACgkQ/vbIBR0O\nATyNfxAAtuov28DlYNHuyCv/YeovD3r+pHLBrowu/RswMZglSGQz5Zm29KcZxo/9\nqIn2umWHyiNfmQfel8ZqTUkvtM5zBVofeYbztwn5QTB2S/UilBfvB7XNrJJ7Vz6n\n7eHMEGZYAl+9CPVGkB3qy6IwO6/TPXcU3LCZCPCK1ONaX8+jEv/ZkrPMimKja9G6\nGHCH9isFGTHueRKFfqMFa0cKSYp/lEdivQ0jp2eX5DvXyb0ArkSaRvLyZk/mP5Cy\nVEBxxp6bJyNkeHFSDFYqhPzlSdEDJw4rjVszafc/Q5o479mgZ8bDvMFZUC0sZoyj\nechukuVSSfflpx31uzKg2kesD+bcrbrkWRHDdmOgrzxOEpoKV6tpZnJXD6/aYKfD\nbaT678bFhAhrL6jESXzYCMQ7asvi7sApeK5wnAH4orh8vyFcfazx5O89biUw5Vbt\nb43+ZL9WaD0OyVapivSXrxjcyyCLX+GIlRL+6rBiBKc/MWA7Tgf4zFmugv15zZJT\nyG6ixuyJq9uY8YU6+r08MEeP/PxtJCVrgAQWQLPuPQQ4ErXOeqUtkel2Vr01h2Jc\nZM4Ri6UY0OkW/QtMe+8u6RHdLyhcrtkAUNDBF0KcPSZG51MiaJc0+ezixiHOq1Q4\ny6I/0d8IaOuuJgJIPPASgjYPyNQiVXxgfQEeBWtic9C0IzGisDU=\n=K+Z4\n-----END PGP SIGNATURE-----", "payload": "tree bbf87b56b6bf49e87f0e92fd8e97347a77097007\nparent 35681fbc76142856a3475691c042ddec8dec31c5\nauthor kennytm <kennytm@gmail.com> 1514563515 +0800\ncommitter kennytm <kennytm@gmail.com> 1514625340 +0800\n\nRequires tools to test-pass if the corresponding submodule is updated.\n\nIf a PR intends to update a tool but its test has failed, abort the merge\nregardless of current channel. This should help the tool maintainers if the\nupdate turns out to be failing due to changes in latest master.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ed16fe47a421781752272f4bd1e11eb5d3c9839", "html_url": "https://github.com/rust-lang/rust/commit/8ed16fe47a421781752272f4bd1e11eb5d3c9839", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ed16fe47a421781752272f4bd1e11eb5d3c9839/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35681fbc76142856a3475691c042ddec8dec31c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/35681fbc76142856a3475691c042ddec8dec31c5", "html_url": "https://github.com/rust-lang/rust/commit/35681fbc76142856a3475691c042ddec8dec31c5"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "d955c3ac3c3976aebc1e69c2adaa9ae545296432", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8ed16fe47a421781752272f4bd1e11eb5d3c9839/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/8ed16fe47a421781752272f4bd1e11eb5d3c9839/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=8ed16fe47a421781752272f4bd1e11eb5d3c9839", "patch": "@@ -5,7 +5,7 @@ services:\n   - docker\n \n git:\n-  depth: 1\n+  depth: 2\n   submodules: false\n \n matrix:"}, {"sha": "1a186c080ce0d7a9aa74ae2090e1a8a46b327e95", "filename": "appveyor.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8ed16fe47a421781752272f4bd1e11eb5d3c9839/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/8ed16fe47a421781752272f4bd1e11eb5d3c9839/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=8ed16fe47a421781752272f4bd1e11eb5d3c9839", "patch": "@@ -96,7 +96,7 @@ environment:\n matrix:\n   fast_finish: true\n \n-clone_depth: 1\n+clone_depth: 2\n build: false\n \n install:"}, {"sha": "b9268fe62ed06b44825711aa1f6742fcb2f4fa51", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/8ed16fe47a421781752272f4bd1e11eb5d3c9839/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/8ed16fe47a421781752272f4bd1e11eb5d3c9839/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=8ed16fe47a421781752272f4bd1e11eb5d3c9839", "patch": "@@ -16,6 +16,7 @@ X_PY=\"$1\"\n TOOLSTATE_FILE=\"$(realpath $2)\"\n OS=\"$3\"\n COMMIT=\"$(git rev-parse HEAD)\"\n+CHANGED_FILES=\"$(git diff --name-status HEAD HEAD^)\"\n \n touch \"$TOOLSTATE_FILE\"\n \n@@ -29,7 +30,28 @@ set -e\n \n cat \"$TOOLSTATE_FILE\"\n \n-if [ \"$RUST_RELEASE_CHANNEL\" = nightly ]; then\n+# If this PR is intended to update one of these tools, do not let the build pass\n+# when they do not test-pass.\n+for TOOL in rls rustfmt miri clippy; do\n+    echo \"Verifying status of $TOOL...\"\n+    if echo \"$CHANGED_FILES\" | grep -q \"^M[[:blank:]]src/tools/$TOOL$\"; then\n+        echo \"This PR updated 'src/tools/$TOOL', verifying if status is 'test-pass'...\"\n+        if grep -vq '\"'\"$TOOL\"'[^\"]*\":\"test-pass\"' \"$TOOLSTATE_FILE\"; then\n+            echo\n+            echo \"\u26a0\ufe0f We detected that this PR updated '$TOOL', but its tests failed.\"\n+            echo\n+            echo \"If you do intend to update '$TOOL', please check the error messages above and\"\n+            echo \"commit another update.\"\n+            echo\n+            echo \"If you do NOT intend to update '$TOOL', please ensure you did not accidentally\"\n+            echo \"change the submodule at 'src/tools/$TOOL'. You may ask your reviewer for the\"\n+            echo \"proper steps.\"\n+            exit 3\n+        fi\n+    fi\n+done\n+\n+if [ \"$RUST_RELEASE_CHANNEL\" = nightly -a -n \"${TOOLSTATE_REPO_ACCESS_TOKEN+is_set}\" ]; then\n     . \"$(dirname $0)/repo.sh\"\n     MESSAGE_FILE=$(mktemp -t msg.XXXXXX)\n     echo \"($OS CI update)\" > \"$MESSAGE_FILE\""}]}