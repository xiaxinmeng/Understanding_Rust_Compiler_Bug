{"sha": "b9bf29019d1dd733d45bae8aed986ecd330565bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5YmYyOTAxOWQxZGQ3MzNkNDViYWU4YWVkOTg2ZWNkMzMwNTY1YmM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-04-01T12:32:04Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-04-01T12:32:04Z"}, "message": "Move config to config.rs", "tree": {"sha": "2da502e16ecd5c6f1e6655b6bcb37db892a536cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2da502e16ecd5c6f1e6655b6bcb37db892a536cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9bf29019d1dd733d45bae8aed986ecd330565bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9bf29019d1dd733d45bae8aed986ecd330565bc", "html_url": "https://github.com/rust-lang/rust/commit/b9bf29019d1dd733d45bae8aed986ecd330565bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9bf29019d1dd733d45bae8aed986ecd330565bc/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ac966899853f03ab572ccd2cee8bf5b2a66aaea", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ac966899853f03ab572ccd2cee8bf5b2a66aaea", "html_url": "https://github.com/rust-lang/rust/commit/6ac966899853f03ab572ccd2cee8bf5b2a66aaea"}], "stats": {"total": 149, "additions": 77, "deletions": 72}, "files": [{"sha": "fb7895ce078523b0d24e4c87ff29d6a0b2519e0f", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=b9bf29019d1dd733d45bae8aed986ecd330565bc", "patch": "@@ -9,9 +9,77 @@\n \n use rustc_hash::FxHashMap;\n \n+use lsp_types::TextDocumentClientCapabilities;\n+use ra_flycheck::FlycheckConfig;\n+use ra_ide::InlayHintsConfig;\n use ra_project_model::CargoFeatures;\n use serde::{Deserialize, Deserializer};\n \n+#[derive(Debug, Clone)]\n+pub struct Config {\n+    pub publish_decorations: bool,\n+    pub supports_location_link: bool,\n+    pub line_folding_only: bool,\n+    pub inlay_hints: InlayHintsConfig,\n+    pub rustfmt: RustfmtConfig,\n+    pub check: Option<FlycheckConfig>,\n+    pub vscode_lldb: bool,\n+    pub proc_macro_srv: Option<String>,\n+}\n+\n+#[derive(Debug, Clone)]\n+pub enum RustfmtConfig {\n+    Rustfmt {\n+        extra_args: Vec<String>,\n+    },\n+    #[allow(unused)]\n+    CustomCommand {\n+        command: String,\n+        args: Vec<String>,\n+    },\n+}\n+\n+impl Default for RustfmtConfig {\n+    fn default() -> Self {\n+        RustfmtConfig::Rustfmt { extra_args: Vec::new() }\n+    }\n+}\n+\n+pub(crate) fn get_config(\n+    config: &ServerConfig,\n+    text_document_caps: Option<&TextDocumentClientCapabilities>,\n+) -> Config {\n+    Config {\n+        publish_decorations: config.publish_decorations,\n+        supports_location_link: text_document_caps\n+            .and_then(|it| it.definition)\n+            .and_then(|it| it.link_support)\n+            .unwrap_or(false),\n+        line_folding_only: text_document_caps\n+            .and_then(|it| it.folding_range.as_ref())\n+            .and_then(|it| it.line_folding_only)\n+            .unwrap_or(false),\n+        inlay_hints: InlayHintsConfig {\n+            type_hints: config.inlay_hints_type,\n+            parameter_hints: config.inlay_hints_parameter,\n+            chaining_hints: config.inlay_hints_chaining,\n+            max_length: config.inlay_hints_max_length,\n+        },\n+        check: if config.cargo_watch_enable {\n+            Some(FlycheckConfig::CargoCommand {\n+                command: config.cargo_watch_command.clone(),\n+                all_targets: config.cargo_watch_all_targets,\n+                extra_args: config.cargo_watch_args.clone(),\n+            })\n+        } else {\n+            None\n+        },\n+        rustfmt: RustfmtConfig::Rustfmt { extra_args: config.rustfmt_args.clone() },\n+        vscode_lldb: config.vscode_lldb,\n+        proc_macro_srv: None, // FIXME: get this from config\n+    }\n+}\n+\n /// Client provided initialization options\n #[derive(Deserialize, Clone, Debug, PartialEq, Eq)]\n #[serde(rename_all = \"camelCase\", default)]"}, {"sha": "de40e2ac2c8345190385d0ae82c4f8a930559b76", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 4, "deletions": 38, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=b9bf29019d1dd733d45bae8aed986ecd330565bc", "patch": "@@ -21,8 +21,8 @@ use lsp_types::{\n     WorkDoneProgressBegin, WorkDoneProgressCreateParams, WorkDoneProgressEnd,\n     WorkDoneProgressReport,\n };\n-use ra_flycheck::{url_from_path_with_drive_lowercasing, CheckTask, FlycheckConfig};\n-use ra_ide::{Canceled, FileId, InlayHintsConfig, LibraryData, SourceRootId};\n+use ra_flycheck::{url_from_path_with_drive_lowercasing, CheckTask};\n+use ra_ide::{Canceled, FileId, LibraryData, SourceRootId};\n use ra_prof::profile;\n use ra_vfs::{VfsFile, VfsTask, Watch};\n use relative_path::RelativePathBuf;\n@@ -31,14 +31,15 @@ use serde::{de::DeserializeOwned, Serialize};\n use threadpool::ThreadPool;\n \n use crate::{\n+    config::get_config,\n     diagnostics::DiagnosticTask,\n     feature_flags::FeatureFlags,\n     main_loop::{\n         pending_requests::{PendingRequest, PendingRequests},\n         subscriptions::Subscriptions,\n     },\n     req,\n-    world::{Config, RustfmtConfig, WorldSnapshot, WorldState},\n+    world::{WorldSnapshot, WorldState},\n     Result, ServerConfig,\n };\n use req::ConfigurationParams;\n@@ -81,41 +82,6 @@ fn get_feature_flags(config: &ServerConfig, connection: &Connection) -> FeatureF\n     ff\n }\n \n-fn get_config(\n-    config: &ServerConfig,\n-    text_document_caps: Option<&TextDocumentClientCapabilities>,\n-) -> Config {\n-    Config {\n-        publish_decorations: config.publish_decorations,\n-        supports_location_link: text_document_caps\n-            .and_then(|it| it.definition)\n-            .and_then(|it| it.link_support)\n-            .unwrap_or(false),\n-        line_folding_only: text_document_caps\n-            .and_then(|it| it.folding_range.as_ref())\n-            .and_then(|it| it.line_folding_only)\n-            .unwrap_or(false),\n-        inlay_hints: InlayHintsConfig {\n-            type_hints: config.inlay_hints_type,\n-            parameter_hints: config.inlay_hints_parameter,\n-            chaining_hints: config.inlay_hints_chaining,\n-            max_length: config.inlay_hints_max_length,\n-        },\n-        check: if config.cargo_watch_enable {\n-            Some(FlycheckConfig::CargoCommand {\n-                command: config.cargo_watch_command.clone(),\n-                all_targets: config.cargo_watch_all_targets,\n-                extra_args: config.cargo_watch_args.clone(),\n-            })\n-        } else {\n-            None\n-        },\n-        rustfmt: RustfmtConfig::Rustfmt { extra_args: config.rustfmt_args.clone() },\n-        vscode_lldb: config.vscode_lldb,\n-        proc_macro_srv: None, // FIXME: get this from config\n-    }\n-}\n-\n pub fn main_loop(\n     ws_roots: Vec<PathBuf>,\n     client_caps: ClientCapabilities,"}, {"sha": "bb99b38a8e7fc208848bc3d7a4a2962d7f3def6a", "filename": "crates/rust-analyzer/src/main_loop/handlers.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=b9bf29019d1dd733d45bae8aed986ecd330565bc", "patch": "@@ -31,6 +31,7 @@ use stdx::format_to;\n \n use crate::{\n     cargo_target_spec::CargoTargetSpec,\n+    config::RustfmtConfig,\n     conv::{\n         to_call_hierarchy_item, to_location, Conv, ConvWith, FoldConvCtx, MapConvWith, TryConvWith,\n         TryConvWithToVec,\n@@ -39,7 +40,7 @@ use crate::{\n     from_json,\n     req::{self, Decoration, InlayHint, InlayHintsParams},\n     semantic_tokens::SemanticTokensBuilder,\n-    world::{RustfmtConfig, WorldSnapshot},\n+    world::WorldSnapshot,\n     LspError, Result,\n };\n "}, {"sha": "124de4d8ec751c0382177c2c8020e96764a44264", "filename": "crates/rust-analyzer/src/world.rs", "status": "modified", "additions": 3, "deletions": 33, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fworld.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9bf29019d1dd733d45bae8aed986ecd330565bc/crates%2Frust-analyzer%2Fsrc%2Fworld.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fworld.rs?ref=b9bf29019d1dd733d45bae8aed986ecd330565bc", "patch": "@@ -11,17 +11,17 @@ use std::{\n use crossbeam_channel::{unbounded, Receiver};\n use lsp_types::Url;\n use parking_lot::RwLock;\n-use ra_flycheck::{url_from_path_with_drive_lowercasing, Flycheck, FlycheckConfig};\n+use ra_flycheck::{url_from_path_with_drive_lowercasing, Flycheck};\n use ra_ide::{\n-    Analysis, AnalysisChange, AnalysisHost, CrateGraph, FileId, InlayHintsConfig, LibraryData,\n-    SourceRootId,\n+    Analysis, AnalysisChange, AnalysisHost, CrateGraph, FileId, LibraryData, SourceRootId,\n };\n use ra_project_model::{get_rustc_cfg_options, ProcMacroClient, ProjectWorkspace};\n use ra_vfs::{LineEndings, RootEntry, Vfs, VfsChange, VfsFile, VfsRoot, VfsTask, Watch};\n use relative_path::RelativePathBuf;\n use stdx::format_to;\n \n use crate::{\n+    config::Config,\n     diagnostics::{CheckFixes, DiagnosticCollection},\n     feature_flags::FeatureFlags,\n     main_loop::pending_requests::{CompletedRequest, LatestRequests},\n@@ -51,36 +51,6 @@ fn create_flycheck(workspaces: &[ProjectWorkspace], config: &Config) -> Option<F\n         })\n }\n \n-#[derive(Debug, Clone)]\n-pub struct Config {\n-    pub publish_decorations: bool,\n-    pub supports_location_link: bool,\n-    pub line_folding_only: bool,\n-    pub inlay_hints: InlayHintsConfig,\n-    pub rustfmt: RustfmtConfig,\n-    pub check: Option<FlycheckConfig>,\n-    pub vscode_lldb: bool,\n-    pub proc_macro_srv: Option<String>,\n-}\n-\n-#[derive(Debug, Clone)]\n-pub enum RustfmtConfig {\n-    Rustfmt {\n-        extra_args: Vec<String>,\n-    },\n-    #[allow(unused)]\n-    CustomCommand {\n-        command: String,\n-        args: Vec<String>,\n-    },\n-}\n-\n-impl Default for RustfmtConfig {\n-    fn default() -> Self {\n-        RustfmtConfig::Rustfmt { extra_args: Vec::new() }\n-    }\n-}\n-\n /// `WorldState` is the primary mutable state of the language server\n ///\n /// The most interesting components are `vfs`, which stores a consistent"}]}