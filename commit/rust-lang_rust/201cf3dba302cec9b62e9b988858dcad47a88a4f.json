{"sha": "201cf3dba302cec9b62e9b988858dcad47a88a4f", "node_id": "C_kwDOAAsO6NoAKDIwMWNmM2RiYTMwMmNlYzliNjJlOWI5ODg4NThkY2FkNDdhODhhNGY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-06T10:08:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-06T10:08:08Z"}, "message": "Auto merge of #95723 - SparrowLii:const_goto, r=fee1-dead\n\nenhance `ConstGoto` mir-opt by moving up `StorageDead` statements\n\nFrom the `FIXME` in the implementation of `ConstGoto` miropt. We can move `StorageDead` statements up to the predecessor. This can expand the scope of application of this opt.", "tree": {"sha": "e6f34f148456e716f6b68a5a48c6c94995731fce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6f34f148456e716f6b68a5a48c6c94995731fce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/201cf3dba302cec9b62e9b988858dcad47a88a4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/201cf3dba302cec9b62e9b988858dcad47a88a4f", "html_url": "https://github.com/rust-lang/rust/commit/201cf3dba302cec9b62e9b988858dcad47a88a4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/201cf3dba302cec9b62e9b988858dcad47a88a4f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce1a8131c6cf6973ff5ce2be2b7500232efbdd5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce1a8131c6cf6973ff5ce2be2b7500232efbdd5f", "html_url": "https://github.com/rust-lang/rust/commit/ce1a8131c6cf6973ff5ce2be2b7500232efbdd5f"}, {"sha": "a91b3477689324eef5b585fba9a4e6c9bdf1cca3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a91b3477689324eef5b585fba9a4e6c9bdf1cca3", "html_url": "https://github.com/rust-lang/rust/commit/a91b3477689324eef5b585fba9a4e6c9bdf1cca3"}], "stats": {"total": 294, "additions": 167, "deletions": 127}, "files": [{"sha": "5acf939f06bf68b5d725479ab7e0c277738f3ba7", "filename": "compiler/rustc_mir_transform/src/const_goto.rs", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/201cf3dba302cec9b62e9b988858dcad47a88a4f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_goto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/201cf3dba302cec9b62e9b988858dcad47a88a4f/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_goto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_goto.rs?ref=201cf3dba302cec9b62e9b988858dcad47a88a4f", "patch": "@@ -39,7 +39,9 @@ impl<'tcx> MirPass<'tcx> for ConstGoto {\n         opt_finder.visit_body(body);\n         let should_simplify = !opt_finder.optimizations.is_empty();\n         for opt in opt_finder.optimizations {\n-            let terminator = body.basic_blocks_mut()[opt.bb_with_goto].terminator_mut();\n+            let block = &mut body.basic_blocks_mut()[opt.bb_with_goto];\n+            block.statements.extend(opt.stmts_move_up);\n+            let terminator = block.terminator_mut();\n             let new_goto = TerminatorKind::Goto { target: opt.target_to_use_in_goto };\n             debug!(\"SUCCESS: replacing `{:?}` with `{:?}`\", terminator.kind, new_goto);\n             terminator.kind = new_goto;\n@@ -68,12 +70,15 @@ impl<'tcx> Visitor<'tcx> for ConstGotoOptimizationFinder<'_, 'tcx> {\n                 // Now check that the target of this Goto switches on this place.\n                 let target_bb = &self.body.basic_blocks()[target];\n \n-                // FIXME(simonvandel): We are conservative here when we don't allow\n-                // any statements in the target basic block.\n-                // This could probably be relaxed to allow `StorageDead`s which could be\n-                // copied to the predecessor of this block.\n-                if !target_bb.statements.is_empty() {\n-                    None?\n+                // The `StorageDead(..)` statement does not affect the functionality of mir.\n+                // We can move this part of the statement up to the predecessor.\n+                let mut stmts_move_up = Vec::new();\n+                for stmt in &target_bb.statements {\n+                    if let StatementKind::StorageDead(..) = stmt.kind {\n+                        stmts_move_up.push(stmt.clone())\n+                    } else {\n+                        None?;\n+                    }\n                 }\n \n                 let target_bb_terminator = target_bb.terminator();\n@@ -87,6 +92,7 @@ impl<'tcx> Visitor<'tcx> for ConstGotoOptimizationFinder<'_, 'tcx> {\n                     self.optimizations.push(OptimizationToApply {\n                         bb_with_goto: location.block,\n                         target_to_use_in_goto,\n+                        stmts_move_up,\n                     });\n                 }\n             }\n@@ -97,14 +103,15 @@ impl<'tcx> Visitor<'tcx> for ConstGotoOptimizationFinder<'_, 'tcx> {\n     }\n }\n \n-struct OptimizationToApply {\n+struct OptimizationToApply<'tcx> {\n     bb_with_goto: BasicBlock,\n     target_to_use_in_goto: BasicBlock,\n+    stmts_move_up: Vec<Statement<'tcx>>,\n }\n \n pub struct ConstGotoOptimizationFinder<'a, 'tcx> {\n     tcx: TyCtxt<'tcx>,\n     body: &'a Body<'tcx>,\n     param_env: ParamEnv<'tcx>,\n-    optimizations: Vec<OptimizationToApply>,\n+    optimizations: Vec<OptimizationToApply<'tcx>>,\n }"}, {"sha": "aee7e22a60f7c50aabfb2b8ecb406ed408c942e7", "filename": "src/test/mir-opt/const_goto_storage.match_nested_if.ConstGoto.diff", "status": "added", "additions": 102, "deletions": 0, "changes": 102, "blob_url": "https://github.com/rust-lang/rust/blob/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.match_nested_if.ConstGoto.diff", "raw_url": "https://github.com/rust-lang/rust/raw/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.match_nested_if.ConstGoto.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.match_nested_if.ConstGoto.diff?ref=201cf3dba302cec9b62e9b988858dcad47a88a4f", "patch": "@@ -0,0 +1,102 @@\n+- // MIR for `match_nested_if` before ConstGoto\n++ // MIR for `match_nested_if` after ConstGoto\n+  \n+  fn match_nested_if() -> bool {\n+      let mut _0: bool;                    // return place in scope 0 at $DIR/const_goto_storage.rs:2:25: 2:29\n+      let _1: bool;                        // in scope 0 at $DIR/const_goto_storage.rs:3:9: 3:12\n+-     let mut _2: ();                      // in scope 0 at $DIR/const_goto_storage.rs:3:21: 3:23\n+-     let mut _3: bool;                    // in scope 0 at $DIR/const_goto_storage.rs:4:15: 8:10\n+-     let mut _4: bool;                    // in scope 0 at $DIR/const_goto_storage.rs:4:18: 4:76\n+-     let mut _5: bool;                    // in scope 0 at $DIR/const_goto_storage.rs:4:21: 4:52\n+-     let mut _6: bool;                    // in scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n++     let mut _2: bool;                    // in scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n+      scope 1 {\n+          debug val => _1;                 // in scope 1 at $DIR/const_goto_storage.rs:3:9: 3:12\n+      }\n+  \n+      bb0: {\n+          StorageLive(_1);                 // scope 0 at $DIR/const_goto_storage.rs:3:9: 3:12\n+-         StorageLive(_2);                 // scope 0 at $DIR/const_goto_storage.rs:3:21: 3:23\n+-         StorageLive(_3);                 // scope 0 at $DIR/const_goto_storage.rs:4:15: 8:10\n+-         StorageLive(_4);                 // scope 0 at $DIR/const_goto_storage.rs:4:18: 4:76\n+-         StorageLive(_5);                 // scope 0 at $DIR/const_goto_storage.rs:4:21: 4:52\n+-         StorageLive(_6);                 // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n+-         _6 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n+-         switchInt(move _6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n++         StorageLive(_2);                 // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n++         _2 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n++         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/const_goto_storage.rs:4:24: 4:28\n+      }\n+  \n+      bb1: {\n+-         _5 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:4:31: 4:35\n+-         goto -> bb3;                     // scope 0 at $DIR/const_goto_storage.rs:4:21: 4:52\n+-     }\n+- \n+-     bb2: {\n+-         _5 = const false;                // scope 0 at $DIR/const_goto_storage.rs:4:45: 4:50\n+-         goto -> bb3;                     // scope 0 at $DIR/const_goto_storage.rs:4:21: 4:52\n+-     }\n+- \n+-     bb3: {\n+-         StorageDead(_6);                 // scope 0 at $DIR/const_goto_storage.rs:4:51: 4:52\n+-         switchInt(move _5) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/const_goto_storage.rs:4:21: 4:52\n+-     }\n+- \n+-     bb4: {\n+-         _4 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:4:55: 4:59\n+-         goto -> bb6;                     // scope 0 at $DIR/const_goto_storage.rs:4:18: 4:76\n+-     }\n+- \n+-     bb5: {\n+-         _4 = const false;                // scope 0 at $DIR/const_goto_storage.rs:4:69: 4:74\n+-         goto -> bb6;                     // scope 0 at $DIR/const_goto_storage.rs:4:18: 4:76\n+-     }\n+- \n+-     bb6: {\n+-         StorageDead(_5);                 // scope 0 at $DIR/const_goto_storage.rs:4:75: 4:76\n+-         switchInt(move _4) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/const_goto_storage.rs:4:18: 4:76\n+-     }\n+- \n+-     bb7: {\n+-         _3 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:5:13: 5:17\n+-         goto -> bb9;                     // scope 0 at $DIR/const_goto_storage.rs:4:15: 8:10\n+-     }\n+- \n+-     bb8: {\n+-         _3 = const false;                // scope 0 at $DIR/const_goto_storage.rs:7:13: 7:18\n+-         goto -> bb9;                     // scope 0 at $DIR/const_goto_storage.rs:4:15: 8:10\n+-     }\n+- \n+-     bb9: {\n+-         switchInt(move _3) -> [false: bb11, otherwise: bb10]; // scope 0 at $DIR/const_goto_storage.rs:4:15: 8:10\n+-     }\n+- \n+-     bb10: {\n+-         StorageDead(_4);                 // scope 0 at $DIR/const_goto_storage.rs:8:9: 8:10\n+-         StorageDead(_3);                 // scope 0 at $DIR/const_goto_storage.rs:8:9: 8:10\n++         StorageDead(_2);                 // scope 0 at $DIR/const_goto_storage.rs:4:51: 4:52\n+          _1 = const true;                 // scope 0 at $DIR/const_goto_storage.rs:10:17: 10:21\n+-         goto -> bb12;                    // scope 0 at $DIR/const_goto_storage.rs:10:17: 10:21\n++         goto -> bb3;                     // scope 0 at $DIR/const_goto_storage.rs:10:17: 10:21\n+      }\n+  \n+-     bb11: {\n+-         StorageDead(_4);                 // scope 0 at $DIR/const_goto_storage.rs:8:9: 8:10\n+-         StorageDead(_3);                 // scope 0 at $DIR/const_goto_storage.rs:8:9: 8:10\n++     bb2: {\n++         StorageDead(_2);                 // scope 0 at $DIR/const_goto_storage.rs:4:51: 4:52\n+          _1 = const false;                // scope 0 at $DIR/const_goto_storage.rs:12:14: 12:19\n+-         goto -> bb12;                    // scope 0 at $DIR/const_goto_storage.rs:12:14: 12:19\n++         goto -> bb3;                     // scope 0 at $DIR/const_goto_storage.rs:12:14: 12:19\n+      }\n+  \n+-     bb12: {\n+-         StorageDead(_2);                 // scope 0 at $DIR/const_goto_storage.rs:13:6: 13:7\n++     bb3: {\n+          _0 = _1;                         // scope 1 at $DIR/const_goto_storage.rs:14:5: 14:8\n+          StorageDead(_1);                 // scope 0 at $DIR/const_goto_storage.rs:15:1: 15:2\n+          return;                          // scope 0 at $DIR/const_goto_storage.rs:15:2: 15:2\n+      }\n+  }\n+  "}, {"sha": "4ef68e7e1faf0e38fc9acb882272abc4a10cf149", "filename": "src/test/mir-opt/const_goto_storage.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_goto_storage.rs?ref=201cf3dba302cec9b62e9b988858dcad47a88a4f", "patch": "@@ -0,0 +1,19 @@\n+// EMIT_MIR const_goto_storage.match_nested_if.ConstGoto.diff\n+fn match_nested_if() -> bool {\n+    let val = match () {\n+        () if if if if true { true } else { false } { true } else { false } {\n+            true\n+        } else {\n+            false\n+        } =>\n+            {\n+                true\n+            }\n+        _ => false,\n+    };\n+    val\n+}\n+\n+fn main() {\n+    let _ = match_nested_if();\n+}"}, {"sha": "2dfb2e1af0d63ca224d47dff8f2b7a4fb5630ab1", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 15, "deletions": 59, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff?ref=201cf3dba302cec9b62e9b988858dcad47a88a4f", "patch": "@@ -4,80 +4,36 @@\n   fn match_nested_if() -> bool {\n       let mut _0: bool;                    // return place in scope 0 at $DIR/matches_reduce_branches.rs:39:25: 39:29\n       let _1: bool;                        // in scope 0 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n-      let mut _2: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-      let mut _3: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-      let mut _4: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+     let mut _5: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+     let mut _6: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+     let mut _7: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n+      let mut _2: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n++     let mut _3: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n       scope 1 {\n           debug val => _1;                 // in scope 1 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n       }\n   \n       bb0: {\n           StorageLive(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n-          StorageLive(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-          StorageLive(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-          StorageLive(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n--         switchInt(move _4) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          StorageLive(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          _2 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n -     }\n - \n -     bb1: {\n--         _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:31: 41:35\n--         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb2: {\n--         _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:45: 41:50\n--         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb3: {\n-+         StorageLive(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+         _5 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+         _3 = Ne(_5, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:41:45: 41:50\n-+         StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-          StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n--         switchInt(move _3) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb4: {\n--         _2 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:55: 41:59\n--         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb5: {\n--         _2 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:69: 41:74\n--         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb6: {\n-+         StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+         _6 = move _3;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+         _2 = Ne(_6, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:41:69: 41:74\n-+         StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:75: 41:76\n--         switchInt(move _2) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb7: {\n-+         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-+         _7 = move _2;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:45:9: 45:10\n++         StorageLive(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n++         _3 = move _2;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n -         _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n--         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n -     }\n - \n--     bb8: {\n--         StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:45:9: 45:10\n+-     bb2: {\n+-         StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n -         _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n--         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n -     }\n - \n--     bb9: {\n-+         _1 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n-+         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n+-     bb3: {\n++         _1 = Ne(_3, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n++         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n           _0 = _1;                         // scope 1 at $DIR/matches_reduce_branches.rs:51:5: 51:8\n           StorageDead(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:52:1: 52:2\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:52:2: 52:2"}, {"sha": "2dfb2e1af0d63ca224d47dff8f2b7a4fb5630ab1", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 15, "deletions": 59, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/201cf3dba302cec9b62e9b988858dcad47a88a4f/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff?ref=201cf3dba302cec9b62e9b988858dcad47a88a4f", "patch": "@@ -4,80 +4,36 @@\n   fn match_nested_if() -> bool {\n       let mut _0: bool;                    // return place in scope 0 at $DIR/matches_reduce_branches.rs:39:25: 39:29\n       let _1: bool;                        // in scope 0 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n-      let mut _2: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-      let mut _3: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-      let mut _4: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+     let mut _5: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+     let mut _6: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+     let mut _7: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n+      let mut _2: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n++     let mut _3: bool;                    // in scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n       scope 1 {\n           debug val => _1;                 // in scope 1 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n       }\n   \n       bb0: {\n           StorageLive(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:9: 40:12\n-          StorageLive(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-          StorageLive(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-          StorageLive(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n--         switchInt(move _4) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          StorageLive(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          _2 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+-         switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n -     }\n - \n -     bb1: {\n--         _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:31: 41:35\n--         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb2: {\n--         _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:45: 41:50\n--         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb3: {\n-+         StorageLive(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+         _5 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-+         _3 = Ne(_5, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:41:45: 41:50\n-+         StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n-          StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n--         switchInt(move _3) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n--     }\n-- \n--     bb4: {\n--         _2 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:41:55: 41:59\n--         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb5: {\n--         _2 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:69: 41:74\n--         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb6: {\n-+         StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+         _6 = move _3;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-+         _2 = Ne(_6, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:41:69: 41:74\n-+         StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:21: 41:52\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:75: 41:76\n--         switchInt(move _2) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n--     }\n-- \n--     bb7: {\n-+         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-+         _7 = move _2;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n-          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:45:9: 45:10\n++         StorageLive(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n++         _3 = move _2;                    // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n+          StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n -         _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n--         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:47:13: 47:17\n -     }\n - \n--     bb8: {\n--         StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:45:9: 45:10\n+-     bb2: {\n+-         StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:51: 41:52\n -         _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n--         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n -     }\n - \n--     bb9: {\n-+         _1 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n-+         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:18: 41:76\n+-     bb3: {\n++         _1 = Ne(_3, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:49:14: 49:19\n++         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:41:24: 41:28\n           _0 = _1;                         // scope 1 at $DIR/matches_reduce_branches.rs:51:5: 51:8\n           StorageDead(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:52:1: 52:2\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:52:2: 52:2"}]}