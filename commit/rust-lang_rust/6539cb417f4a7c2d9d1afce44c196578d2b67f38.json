{"sha": "6539cb417f4a7c2d9d1afce44c196578d2b67f38", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1MzljYjQxN2Y0YTdjMmQ5ZDFhZmNlNDRjMTk2NTc4ZDJiNjdmMzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-06T16:42:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-06T16:42:43Z"}, "message": "auto merge of #20618 : alexcrichton/rust/less-warn, r=brson\n\nThis warning has been around in the compiler for quite some time now, but the\r\nreal place for a warning like this, if it should exist, is in Cargo, not in the\r\ncompiler itself. It's a first-class feature of Cargo that multiple versions of a\r\ncrate can be compiled into the same executable, and we shouldn't be warning\r\nabout our first-class features.", "tree": {"sha": "18d88eaca98109cb6a246f63c1a85d4875f03d48", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18d88eaca98109cb6a246f63c1a85d4875f03d48"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6539cb417f4a7c2d9d1afce44c196578d2b67f38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6539cb417f4a7c2d9d1afce44c196578d2b67f38", "html_url": "https://github.com/rust-lang/rust/commit/6539cb417f4a7c2d9d1afce44c196578d2b67f38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6539cb417f4a7c2d9d1afce44c196578d2b67f38/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8efd9901b628d687d11a4d0ccc153553b38ada49", "url": "https://api.github.com/repos/rust-lang/rust/commits/8efd9901b628d687d11a4d0ccc153553b38ada49", "html_url": "https://github.com/rust-lang/rust/commit/8efd9901b628d687d11a4d0ccc153553b38ada49"}, {"sha": "9d0b3c9fc91dbde74f7cafc85377432447c0d364", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d0b3c9fc91dbde74f7cafc85377432447c0d364", "html_url": "https://github.com/rust-lang/rust/commit/9d0b3c9fc91dbde74f7cafc85377432447c0d364"}], "stats": {"total": 62, "additions": 1, "deletions": 61}, "files": [{"sha": "b44520e28527b8e5c9e6772b54101fed0bed6a56", "filename": "src/librustc/metadata/creader.rs", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/6539cb417f4a7c2d9d1afce44c196578d2b67f38/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6539cb417f4a7c2d9d1afce44c196578d2b67f38/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fcreader.rs?ref=6539cb417f4a7c2d9d1afce44c196578d2b67f38", "patch": "@@ -20,16 +20,13 @@ use metadata::cstore::{CStore, CrateSource, MetadataBlob};\n use metadata::decoder;\n use metadata::loader;\n use metadata::loader::CratePaths;\n-use util::nodemap::FnvHashMap;\n \n use std::rc::Rc;\n-use std::collections::hash_map::Entry::{Occupied, Vacant};\n use syntax::ast;\n use syntax::abi;\n use syntax::attr;\n use syntax::attr::AttrMetaMethods;\n use syntax::codemap::{Span, mk_sp};\n-use syntax::diagnostic::SpanHandler;\n use syntax::parse;\n use syntax::parse::token::InternedString;\n use syntax::parse::token;\n@@ -67,27 +64,6 @@ fn dump_crates(cstore: &CStore) {\n     })\n }\n \n-fn warn_if_multiple_versions(diag: &SpanHandler, cstore: &CStore) {\n-    let mut map = FnvHashMap::new();\n-    cstore.iter_crate_data(|cnum, data| {\n-        match map.entry(&data.name()) {\n-            Vacant(entry) => { entry.insert(vec![cnum]); },\n-            Occupied(mut entry) => { entry.get_mut().push(cnum); },\n-        }\n-    });\n-\n-    for (name, dupes) in map.into_iter() {\n-        if dupes.len() == 1 { continue }\n-        diag.handler().warn(\n-            format!(\"using multiple versions of crate `{}`\", name)[]);\n-        for dupe in dupes.into_iter() {\n-            let data = cstore.get_crate_data(dupe);\n-            diag.span_note(data.span, \"used here\");\n-            loader::note_crate_name(diag, data.name()[]);\n-        }\n-    }\n-}\n-\n fn should_link(i: &ast::ViewItem) -> bool {\n     !attr::contains_name(i.attrs[], \"no_link\")\n }\n@@ -188,7 +164,6 @@ impl<'a> CrateReader<'a> {\n         if log_enabled!(log::DEBUG) {\n             dump_crates(&self.sess.cstore);\n         }\n-        warn_if_multiple_versions(self.sess.diagnostic(), &self.sess.cstore);\n \n         for &(ref name, kind) in self.sess.opts.libs.iter() {\n             register_native_lib(self.sess, None, name.clone(), kind);"}, {"sha": "b84e930757b251c8495f2dc01973f04468b25404", "filename": "src/test/run-make/extern-diff-internal-name/Makefile", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6539cb417f4a7c2d9d1afce44c196578d2b67f38/src%2Ftest%2Frun-make%2Fextern-diff-internal-name%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6539cb417f4a7c2d9d1afce44c196578d2b67f38/src%2Ftest%2Frun-make%2Fextern-diff-internal-name%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fextern-diff-internal-name%2FMakefile?ref=6539cb417f4a7c2d9d1afce44c196578d2b67f38", "patch": "@@ -2,5 +2,4 @@\n \n all:\n \t$(RUSTC) lib.rs\n-\t$(RUSTC) test.rs --extern foo=$(TMPDIR)/libbar.rlib 2>&1 | \\\n-\t\t{ ! grep \"using multiple versions of crate\"; }\n+\t$(RUSTC) test.rs --extern foo=$(TMPDIR)/libbar.rlib"}, {"sha": "e60c16ae0f6b8e8af8a828628f72ad051b22dd74", "filename": "src/test/run-make/multiple-versions/Makefile", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmultiple-versions%2FMakefile?ref=8efd9901b628d687d11a4d0ccc153553b38ada49", "patch": "@@ -1,9 +0,0 @@\n--include ../tools.mk\n-\n-all:\n-\t$(RUSTC) foo.rs -C metadata=a -C extra-filename=-1 --crate-type=rlib\n-\t$(RUSTC) foo.rs -C metadata=b -C extra-filename=-2 --crate-type=rlib\n-\t$(RUSTC) bar.rs \\\n-\t\t--extern foo1=$(TMPDIR)/libfoo-1.rlib \\\n-\t\t--extern foo2=$(TMPDIR)/libfoo-2.rlib \\\n-\t\t2>&1 | grep \"using multiple versions of crate .foo.\""}, {"sha": "262193a08100aaff74244605393b531a70f3a041", "filename": "src/test/run-make/multiple-versions/bar.rs", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmultiple-versions%2Fbar.rs?ref=8efd9901b628d687d11a4d0ccc153553b38ada49", "patch": "@@ -1,14 +0,0 @@\n-// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-extern crate foo1;\n-extern crate foo2;\n-\n-fn main() {}"}, {"sha": "2661b1f4eb49b7a93d03ca34e2563991eb2e37c3", "filename": "src/test/run-make/multiple-versions/foo.rs", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8efd9901b628d687d11a4d0ccc153553b38ada49/src%2Ftest%2Frun-make%2Fmultiple-versions%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fmultiple-versions%2Ffoo.rs?ref=8efd9901b628d687d11a4d0ccc153553b38ada49", "patch": "@@ -1,11 +0,0 @@\n-// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-pub fn foo() {}"}]}