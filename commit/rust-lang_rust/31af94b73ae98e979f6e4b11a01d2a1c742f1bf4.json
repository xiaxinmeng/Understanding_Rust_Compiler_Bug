{"sha": "31af94b73ae98e979f6e4b11a01d2a1c742f1bf4", "node_id": "C_kwDOAAsO6NoAKDMxYWY5NGI3M2FlOThlOTc5ZjZlNGIxMWEwMWQyYTFjNzQyZjFiZjQ", "commit": {"author": {"name": "Dezhi Wu", "email": "wu543065657@163.com", "date": "2021-10-26T12:55:58Z"}, "committer": {"name": "Dezhi Wu", "email": "wu543065657@163.com", "date": "2021-10-26T12:59:48Z"}, "message": "perf: avoid allocating by just slicing.\n\nSigned-off-by: Dezhi Wu <wu543065657@163.com>", "tree": {"sha": "f3bf9be636505f3e38f87a6ce8ffe67e88fa597c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f3bf9be636505f3e38f87a6ce8ffe67e88fa597c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4", "html_url": "https://github.com/rust-lang/rust/commit/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4/comments", "author": {"login": "dzvon", "id": 3402811, "node_id": "MDQ6VXNlcjM0MDI4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3402811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzvon", "html_url": "https://github.com/dzvon", "followers_url": "https://api.github.com/users/dzvon/followers", "following_url": "https://api.github.com/users/dzvon/following{/other_user}", "gists_url": "https://api.github.com/users/dzvon/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzvon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzvon/subscriptions", "organizations_url": "https://api.github.com/users/dzvon/orgs", "repos_url": "https://api.github.com/users/dzvon/repos", "events_url": "https://api.github.com/users/dzvon/events{/privacy}", "received_events_url": "https://api.github.com/users/dzvon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dzvon", "id": 3402811, "node_id": "MDQ6VXNlcjM0MDI4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3402811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzvon", "html_url": "https://github.com/dzvon", "followers_url": "https://api.github.com/users/dzvon/followers", "following_url": "https://api.github.com/users/dzvon/following{/other_user}", "gists_url": "https://api.github.com/users/dzvon/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzvon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzvon/subscriptions", "organizations_url": "https://api.github.com/users/dzvon/orgs", "repos_url": "https://api.github.com/users/dzvon/repos", "events_url": "https://api.github.com/users/dzvon/events{/privacy}", "received_events_url": "https://api.github.com/users/dzvon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7b9cd5e678ca824f0b12d0b8c44107587ffd051", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7b9cd5e678ca824f0b12d0b8c44107587ffd051", "html_url": "https://github.com/rust-lang/rust/commit/b7b9cd5e678ca824f0b12d0b8c44107587ffd051"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "59c904f86e7ed0acc3827b0b7a768d004cf448a7", "filename": "crates/rust-analyzer/src/markdown.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4/crates%2Frust-analyzer%2Fsrc%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31af94b73ae98e979f6e4b11a01d2a1c742f1bf4/crates%2Frust-analyzer%2Fsrc%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmarkdown.rs?ref=31af94b73ae98e979f6e4b11a01d2a1c742f1bf4", "patch": "@@ -1,6 +1,4 @@\n //! Transforms markdown\n-use std::borrow::Cow;\n-\n use ide_db::helpers::rust_doc::is_rust_fence;\n \n const RUSTDOC_FENCE: &str = \"```\";\n@@ -10,9 +8,8 @@ pub(crate) fn format_docs(src: &str) -> String {\n     let mut in_code_block = false;\n     let mut is_rust = false;\n \n-    for line in src.lines() {\n-        let mut line = Cow::from(line);\n-        if in_code_block && is_rust && code_line_ignored_by_rustdoc(&line) {\n+    for mut line in src.lines() {\n+        if in_code_block && is_rust && code_line_ignored_by_rustdoc(line) {\n             continue;\n         }\n \n@@ -23,15 +20,15 @@ pub(crate) fn format_docs(src: &str) -> String {\n                 is_rust = is_rust_fence(header);\n \n                 if is_rust {\n-                    line = Cow::Borrowed(\"```rust\");\n+                    line = \"```rust\";\n                 }\n             }\n         }\n \n         if in_code_block {\n-            let trimmed = line.trim();\n+            let trimmed = line.trim_start();\n             if trimmed.starts_with(\"##\") {\n-                line = Cow::Owned(line.replacen(\"##\", \"#\", 1));\n+                line = &trimmed[1..];\n             }\n         }\n "}]}