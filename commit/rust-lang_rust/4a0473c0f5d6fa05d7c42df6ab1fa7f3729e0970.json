{"sha": "4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "node_id": "C_kwDOAAsO6NoAKDRhMDQ3M2MwZjVkNmZhMDVkN2M0MmRmNmFiMWZhN2YzNzI5ZTA5NzA", "commit": {"author": {"name": "ouz-a", "email": "oguz.agcayazi@gmail.com", "date": "2022-07-25T12:45:36Z"}, "committer": {"name": "ouz-a", "email": "oguz.agcayazi@gmail.com", "date": "2022-07-25T12:45:36Z"}, "message": "Bubble up obligations", "tree": {"sha": "54d5271070c3ae7a57c184bdb4054efa9213d02c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54d5271070c3ae7a57c184bdb4054efa9213d02c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "html_url": "https://github.com/rust-lang/rust/commit/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/comments", "author": {"login": "ouz-a", "id": 90461915, "node_id": "MDQ6VXNlcjkwNDYxOTE1", "avatar_url": "https://avatars.githubusercontent.com/u/90461915?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ouz-a", "html_url": "https://github.com/ouz-a", "followers_url": "https://api.github.com/users/ouz-a/followers", "following_url": "https://api.github.com/users/ouz-a/following{/other_user}", "gists_url": "https://api.github.com/users/ouz-a/gists{/gist_id}", "starred_url": "https://api.github.com/users/ouz-a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ouz-a/subscriptions", "organizations_url": "https://api.github.com/users/ouz-a/orgs", "repos_url": "https://api.github.com/users/ouz-a/repos", "events_url": "https://api.github.com/users/ouz-a/events{/privacy}", "received_events_url": "https://api.github.com/users/ouz-a/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ouz-a", "id": 90461915, "node_id": "MDQ6VXNlcjkwNDYxOTE1", "avatar_url": "https://avatars.githubusercontent.com/u/90461915?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ouz-a", "html_url": "https://github.com/ouz-a", "followers_url": "https://api.github.com/users/ouz-a/followers", "following_url": "https://api.github.com/users/ouz-a/following{/other_user}", "gists_url": "https://api.github.com/users/ouz-a/gists{/gist_id}", "starred_url": "https://api.github.com/users/ouz-a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ouz-a/subscriptions", "organizations_url": "https://api.github.com/users/ouz-a/orgs", "repos_url": "https://api.github.com/users/ouz-a/repos", "events_url": "https://api.github.com/users/ouz-a/events{/privacy}", "received_events_url": "https://api.github.com/users/ouz-a/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64dc377a103c0d377b3e60e08d29f69fcf7ba2c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/64dc377a103c0d377b3e60e08d29f69fcf7ba2c5", "html_url": "https://github.com/rust-lang/rust/commit/64dc377a103c0d377b3e60e08d29f69fcf7ba2c5"}], "stats": {"total": 21, "additions": 13, "deletions": 8}, "files": [{"sha": "c8f12c876c020ff41598b7685e4ce452d5b4a16c", "filename": "compiler/rustc_traits/src/evaluate_obligation.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs?ref=4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "patch": "@@ -1,4 +1,4 @@\n-use rustc_infer::infer::TyCtxtInferExt;\n+use rustc_infer::infer::{DefiningAnchor, TyCtxtInferExt};\n use rustc_middle::ty::query::Providers;\n use rustc_middle::ty::{ParamEnvAnd, TyCtxt};\n use rustc_span::source_map::DUMMY_SP;\n@@ -16,7 +16,7 @@ fn evaluate_obligation<'tcx>(\n     canonical_goal: CanonicalPredicateGoal<'tcx>,\n ) -> Result<EvaluationResult, OverflowError> {\n     debug!(\"evaluate_obligation(canonical_goal={:#?})\", canonical_goal);\n-    tcx.infer_ctxt().enter_with_canonical(\n+    tcx.infer_ctxt().with_opaque_type_inference(DefiningAnchor::Bubble).enter_with_canonical(\n         DUMMY_SP,\n         &canonical_goal,\n         |ref infcx, goal, _canonical_inference_vars| {"}, {"sha": "108a4c2e02d6bd55a3212eefbf393dd55ffa81b3", "filename": "compiler/rustc_traits/src/type_op.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs?ref=4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "patch": "@@ -2,7 +2,7 @@ use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n use rustc_infer::infer::at::ToTrace;\n use rustc_infer::infer::canonical::{Canonical, QueryResponse};\n-use rustc_infer::infer::{InferCtxt, TyCtxtInferExt};\n+use rustc_infer::infer::{DefiningAnchor, InferCtxt, TyCtxtInferExt};\n use rustc_infer::traits::TraitEngineExt as _;\n use rustc_middle::ty::query::Providers;\n use rustc_middle::ty::subst::{GenericArg, Subst, UserSelfTy, UserSubsts};\n@@ -258,10 +258,13 @@ fn type_op_prove_predicate<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     canonicalized: Canonical<'tcx, ParamEnvAnd<'tcx, ProvePredicate<'tcx>>>,\n ) -> Result<&'tcx Canonical<'tcx, QueryResponse<'tcx, ()>>, NoSolution> {\n-    tcx.infer_ctxt().enter_canonical_trait_query(&canonicalized, |infcx, fulfill_cx, key| {\n-        type_op_prove_predicate_with_cause(infcx, fulfill_cx, key, ObligationCause::dummy());\n-        Ok(())\n-    })\n+    tcx.infer_ctxt().with_opaque_type_inference(DefiningAnchor::Bubble).enter_canonical_trait_query(\n+        &canonicalized,\n+        |infcx, fulfill_cx, key| {\n+            type_op_prove_predicate_with_cause(infcx, fulfill_cx, key, ObligationCause::dummy());\n+            Ok(())\n+        },\n+    )\n }\n \n /// The core of the `type_op_prove_predicate` query: for diagnostics purposes in NLL HRTB errors,"}, {"sha": "d20b1cc6d851bb135b3dd00fd87cc535e20c9141", "filename": "src/test/ui/type-alias-impl-trait/issue-53398-cyclic-types.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr?ref=4a0473c0f5d6fa05d7c42df6ab1fa7f3729e0970", "patch": "@@ -1,8 +1,10 @@\n-error[E0275]: overflow evaluating the requirement `<fn() -> Foo {foo} as FnOnce<()>>::Output == fn() -> Foo {foo}`\n+error[E0275]: overflow evaluating the requirement `fn() -> Foo {foo}: Sized`\n   --> $DIR/issue-53398-cyclic-types.rs:5:13\n    |\n LL | fn foo() -> Foo {\n    |             ^^^\n+   |\n+   = help: consider increasing the recursion limit by adding a `#![recursion_limit = \"256\"]` attribute to your crate (`issue_53398_cyclic_types`)\n \n error: aborting due to previous error\n "}]}