{"sha": "9700c95ced0abb3047ace17afe9aba0086679a76", "node_id": "C_kwDOAAsO6NoAKDk3MDBjOTVjZWQwYWJiMzA0N2FjZTE3YWZlOWFiYTAwODY2NzlhNzY", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-08-22T11:44:07Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-08-23T12:05:55Z"}, "message": "Make doc comment highlight injection configurable", "tree": {"sha": "ecfcafc295b28971ea36110b44556d8ce3feea49", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecfcafc295b28971ea36110b44556d8ce3feea49"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9700c95ced0abb3047ace17afe9aba0086679a76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9700c95ced0abb3047ace17afe9aba0086679a76", "html_url": "https://github.com/rust-lang/rust/commit/9700c95ced0abb3047ace17afe9aba0086679a76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9700c95ced0abb3047ace17afe9aba0086679a76/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9a201873b828b64dd276df42b3dbd263682392b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a201873b828b64dd276df42b3dbd263682392b7", "html_url": "https://github.com/rust-lang/rust/commit/9a201873b828b64dd276df42b3dbd263682392b7"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "1804dc722897e4e5167ae61db730e102329a0c45", "filename": "crates/ide/src/syntax_highlighting.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs?ref=9700c95ced0abb3047ace17afe9aba0086679a76", "patch": "@@ -38,11 +38,19 @@ pub struct HlRange {\n \n #[derive(Copy, Clone, Debug, PartialEq, Eq)]\n pub struct HighlightConfig {\n+    /// Whether to highlight strings\n     pub strings: bool,\n+    /// Whether to highlight punctuation\n     pub punctuation: bool,\n+    /// Whether to specialize punctuation highlights\n     pub specialize_punctuation: bool,\n-    pub specialize_operator: bool,\n+    /// Whether to highlight operator\n     pub operator: bool,\n+    /// Whether to specialize operator highlights\n+    pub specialize_operator: bool,\n+    /// Whether to inject highlights into doc comments\n+    pub inject_doc_comment: bool,\n+    /// Whether to highlight unresolved things be their syntax\n     pub syntactic_name_ref_highlighting: bool,\n }\n \n@@ -325,9 +333,11 @@ fn traverse(\n             Enter(it) => it,\n             Leave(NodeOrToken::Token(_)) => continue,\n             Leave(NodeOrToken::Node(node)) => {\n-                // Doc comment highlighting injection, we do this when leaving the node\n-                // so that we overwrite the highlighting of the doc comment itself.\n-                inject::doc_comment(hl, sema, config, file_id, &node);\n+                if config.inject_doc_comment {\n+                    // Doc comment highlighting injection, we do this when leaving the node\n+                    // so that we overwrite the highlighting of the doc comment itself.\n+                    inject::doc_comment(hl, sema, config, file_id, &node);\n+                }\n                 continue;\n             }\n         };"}, {"sha": "832f19b1c8ac007134332e660b2594d4f43a7235", "filename": "crates/ide/src/syntax_highlighting/html.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs?ref=9700c95ced0abb3047ace17afe9aba0086679a76", "patch": "@@ -31,6 +31,7 @@ pub(crate) fn highlight_as_html(db: &RootDatabase, file_id: FileId, rainbow: boo\n             specialize_punctuation: true,\n             specialize_operator: true,\n             operator: true,\n+            inject_doc_comment: true,\n             syntactic_name_ref_highlighting: false,\n         },\n         file_id,"}, {"sha": "3d086935f07ceb70e5c6ce01708cca8fcb55319d", "filename": "crates/ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=9700c95ced0abb3047ace17afe9aba0086679a76", "patch": "@@ -12,6 +12,7 @@ const HL_CONFIG: HighlightConfig = HighlightConfig {\n     specialize_punctuation: true,\n     specialize_operator: true,\n     operator: true,\n+    inject_doc_comment: true,\n     syntactic_name_ref_highlighting: false,\n };\n "}, {"sha": "a3a4f9f3f139e665a2160d29b94e2a7b033c1b4a", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9700c95ced0abb3047ace17afe9aba0086679a76/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=9700c95ced0abb3047ace17afe9aba0086679a76", "patch": "@@ -411,6 +411,11 @@ config_data! {\n         /// When enabled, rust-analyzer will emit special token types for operator tokens instead\n         /// of the generic `operator` token type.\n         semanticHighlighting_operator_specialization_enable: bool = \"false\",\n+        /// Inject additional highlighting into doc comments.\n+        ///\n+        /// When enabled, rust-analyzer will highlight rust source in doc comments as well as intra\n+        /// doc links.\n+        semanticHighlighting_doc_comment_inject_enable: bool = \"true\",\n \n         /// Show full signature of the callable. Only shows parameters if disabled.\n         signatureInfo_detail: SignatureDetail                           = \"\\\"full\\\"\",\n@@ -1200,6 +1205,7 @@ impl Config {\n                 .semanticHighlighting_punctuation_specialization_enable,\n             operator: self.data.semanticHighlighting_operator_enable,\n             specialize_operator: self.data.semanticHighlighting_operator_specialization_enable,\n+            inject_doc_comment: self.data.semanticHighlighting_doc_comment_inject_enable,\n             syntactic_name_ref_highlighting: false,\n         }\n     }"}]}