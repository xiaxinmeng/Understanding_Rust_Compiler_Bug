{"sha": "f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0MWY3NWZlNTNiNzA1ZDQzNjNlOTFiOGY2NmZkNTFlMmIyZjlmYjU=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-09-16T03:22:03Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-09-16T03:23:06Z"}, "message": "Added more predicates in trans\n\nAdded the non_ty_var predicate (soon to be used)\nAdded a check in get_res_dtor (will be necessary for a future change\nto type_of_fn)\nRemoved a gratuitous ret", "tree": {"sha": "8c59e4541b73fc39d3c084ad1b9b2a441a717865", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c59e4541b73fc39d3c084ad1b9b2a441a717865"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5", "html_url": "https://github.com/rust-lang/rust/commit/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "059952da5b18e475b6018c1d58e3b5099c57fdba", "url": "https://api.github.com/repos/rust-lang/rust/commits/059952da5b18e475b6018c1d58e3b5099c57fdba", "html_url": "https://github.com/rust-lang/rust/commit/059952da5b18e475b6018c1d58e3b5099c57fdba"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "32d0266c7e90537fdc614b976898c29c68bc9e97", "filename": "src/comp/middle/trans_common.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5/src%2Fcomp%2Fmiddle%2Ftrans_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5/src%2Fcomp%2Fmiddle%2Ftrans_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_common.rs?ref=f41f75fe53b705d4363e91b8f66fd51e2b2f9fb5", "patch": "@@ -335,9 +335,12 @@ fn get_res_dtor(ccx: @crate_ctxt, sp: span, did: ast::def_id, inner_t: ty::t)\n     }\n \n     let params = csearch::get_type_param_count(ccx.sess.get_cstore(), did);\n+    let nil_res = ty::mk_nil(ccx.tcx);\n+    // FIXME: Silly check -- mk_nil should have a postcondition\n+    check non_ty_var(ccx, nil_res);\n     let f_t = type_of_fn(ccx, sp, ast::proto_fn, false, false,\n                          [{mode: ast::by_ref, ty: inner_t}],\n-                         ty::mk_nil(ccx.tcx), params);\n+                         nil_res, params);\n     ret trans::get_extern_const(ccx.externs, ccx.llmod,\n                                 csearch::get_symbol(ccx.sess.get_cstore(),\n                                                     did),\n@@ -412,7 +415,7 @@ fn extend_path(cx: @local_ctxt, name: str) -> @local_ctxt {\n }\n \n fn rslt(bcx: @block_ctxt, val: ValueRef) -> result {\n-    ret {bcx: bcx, val: val};\n+    {bcx: bcx, val: val}\n }\n \n fn ty_str(tn: type_names, t: TypeRef) -> str {\n@@ -843,6 +846,17 @@ pure fn type_has_static_size(cx: @crate_ctxt, t: ty::t) -> bool {\n     !ty::type_has_dynamic_size(cx.tcx, t)\n }\n \n+pure fn non_ty_var(cx: @crate_ctxt, t: ty::t) -> bool {\n+    // Not obviously referentially transparent, but\n+    // type interner shouldn't be changing at this point.\n+    // FIXME: how to make that clearer?\n+    let st = unchecked { ty::struct(cx.tcx, t) };\n+    alt st {\n+      ty::ty_var(_) { false }\n+      _          { true }\n+    }\n+}\n+\n //\n // Local Variables:\n // mode: rust"}]}