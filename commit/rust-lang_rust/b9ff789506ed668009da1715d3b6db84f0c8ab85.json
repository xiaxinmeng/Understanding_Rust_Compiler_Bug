{"sha": "b9ff789506ed668009da1715d3b6db84f0c8ab85", "node_id": "C_kwDOAAsO6NoAKGI5ZmY3ODk1MDZlZDY2ODAwOWRhMTcxNWQzYjZkYjg0ZjBjOGFiODU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-10-04T16:26:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-04T16:26:38Z"}, "message": "Rollup merge of #102241 - jyn514:manifest-json-docs, r=Mark-Simulacrum\n\nPackage `rust-docs-json` into nightly components (take 3)\n\n`dist` creates a `rust-docs-json.tar.xz` tarfile. But build-manifest expected it to be named `rust-docs-json-preview.tar.xz`. Change build-manifest to allow the name without the `-preview` suffix.\n\nI haven't actually tested this :( build-manifest is a pain to run locally.", "tree": {"sha": "6af5db29782ff78e2d299f14a5621ceacb62642d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6af5db29782ff78e2d299f14a5621ceacb62642d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9ff789506ed668009da1715d3b6db84f0c8ab85", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjPF6+CRBK7hj4Ov3rIwAAIPMIAFD9SUMJB3xwtTw5g9i1TwA9\nJs5NaVIJTlvTxk0UXtXCfujSRQYGerSVyWdrkHNtnhCNPGUuTgPtI+njhB3Jxodx\nUcElVn8Mb66Uo0IP6yiwVAMEZyO6mHHrwElHuVSjYg7oiJJgNClx8tAqUuIaxpMM\nXh9YEFqxZdsg2kaDGhFBJtWt81w37LVYJrlHjO5r+t/72uOFa9UKdsXTjmhhezl0\npjGUhf/FhrQEvY0WgI3Lh1img9So5TIklmV5GmRsVAbgiqCCkPVsVCXb0FYddfuN\nr4n2qeE+3TBl9QddcEiMI5xYvgKNmcl65PecqmrEJZzDS22alEi9UigurYR6LYU=\n=gY84\n-----END PGP SIGNATURE-----\n", "payload": "tree 6af5db29782ff78e2d299f14a5621ceacb62642d\nparent 02cd79afb8080fce8c8ce35533c54d8ecf8f390e\nparent d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1664900798 +0200\ncommitter GitHub <noreply@github.com> 1664900798 +0200\n\nRollup merge of #102241 - jyn514:manifest-json-docs, r=Mark-Simulacrum\n\nPackage `rust-docs-json` into nightly components (take 3)\n\n`dist` creates a `rust-docs-json.tar.xz` tarfile. But build-manifest expected it to be named `rust-docs-json-preview.tar.xz`. Change build-manifest to allow the name without the `-preview` suffix.\n\nI haven't actually tested this :( build-manifest is a pain to run locally.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9ff789506ed668009da1715d3b6db84f0c8ab85", "html_url": "https://github.com/rust-lang/rust/commit/b9ff789506ed668009da1715d3b6db84f0c8ab85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9ff789506ed668009da1715d3b6db84f0c8ab85/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02cd79afb8080fce8c8ce35533c54d8ecf8f390e", "url": "https://api.github.com/repos/rust-lang/rust/commits/02cd79afb8080fce8c8ce35533c54d8ecf8f390e", "html_url": "https://github.com/rust-lang/rust/commit/02cd79afb8080fce8c8ce35533c54d8ecf8f390e"}, {"sha": "d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e", "html_url": "https://github.com/rust-lang/rust/commit/d44e14225ab00e164aa9ea9e8d9e1bee40f96b3e"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "7eb8f8bbb30ed9f38c6188a0437aa68a1ec9ff9a", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=b9ff789506ed668009da1715d3b6db84f0c8ab85", "patch": "@@ -1367,6 +1367,7 @@ impl Step for Extended {\n         }\n \n         add_component!(\"rust-docs\" => Docs { host: target });\n+        add_component!(\"rust-json-docs\" => JsonDocs { host: target });\n         add_component!(\"rust-demangler\"=> RustDemangler { compiler, target });\n         add_component!(\"cargo\" => Cargo { compiler, target });\n         add_component!(\"rustfmt\" => Rustfmt { compiler, target });"}, {"sha": "b0006cb90bdd6f9b26591599c31afc5889585591", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=b9ff789506ed668009da1715d3b6db84f0c8ab85", "patch": "@@ -193,6 +193,12 @@ macro_rules! t {\n             Err(e) => panic!(\"{} failed with {}\", stringify!($e), e),\n         }\n     };\n+    ($e:expr, $extra:expr) => {\n+        match $e {\n+            Ok(e) => e,\n+            Err(e) => panic!(\"{} failed with {}: {}\", stringify!($e), e, $extra),\n+        }\n+    };\n }\n \n struct Builder {\n@@ -437,7 +443,7 @@ impl Builder {\n             host_component(\"rustfmt-preview\"),\n             host_component(\"llvm-tools-preview\"),\n             host_component(\"rust-analysis\"),\n-            host_component(\"rust-docs-json\"),\n+            host_component(\"rust-docs-json-preview\"),\n         ]);\n \n         extensions.extend(\n@@ -584,7 +590,7 @@ impl Builder {\n         self.shipped_files.insert(name.clone());\n \n         let dst = self.output.join(name);\n-        t!(fs::write(&dst, contents));\n+        t!(fs::write(&dst, contents), format!(\"failed to create manifest {}\", dst.display()));\n     }\n \n     fn write_shipped_files(&self, path: &Path) {"}, {"sha": "0186194a41f5550797930cd0f8a9aef46312ec43", "filename": "src/tools/build-manifest/src/versions.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9ff789506ed668009da1715d3b6db84f0c8ab85/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fversions.rs?ref=b9ff789506ed668009da1715d3b6db84f0c8ab85", "patch": "@@ -20,6 +20,7 @@ pub(crate) enum PkgType {\n     Rustfmt,\n     LlvmTools,\n     Miri,\n+    JsonDocs,\n     Other(String),\n }\n \n@@ -36,6 +37,7 @@ impl PkgType {\n             \"rustfmt\" | \"rustfmt-preview\" => PkgType::Rustfmt,\n             \"llvm-tools\" | \"llvm-tools-preview\" => PkgType::LlvmTools,\n             \"miri\" | \"miri-preview\" => PkgType::Miri,\n+            \"rust-docs-json\" | \"rust-docs-json-preview\" => PkgType::JsonDocs,\n             other => PkgType::Other(other.into()),\n         }\n     }\n@@ -53,6 +55,7 @@ impl PkgType {\n             PkgType::Rustfmt => \"rustfmt\",\n             PkgType::LlvmTools => \"llvm-tools\",\n             PkgType::Miri => \"miri\",\n+            PkgType::JsonDocs => \"rust-docs-json\",\n             PkgType::Other(component) => component,\n         }\n     }\n@@ -72,6 +75,7 @@ impl PkgType {\n             PkgType::Rust => true,\n             PkgType::RustSrc => true,\n             PkgType::Rustc => true,\n+            PkgType::JsonDocs => true,\n             PkgType::Other(_) => true,\n         }\n     }\n@@ -113,6 +117,9 @@ impl Versions {\n             Some(version) => Ok(version.clone()),\n             None => {\n                 let version_info = self.load_version_from_tarball(package)?;\n+                if *package == PkgType::Rust && version_info.version.is_none() {\n+                    panic!(\"missing version info for toolchain\");\n+                }\n                 self.versions.insert(package.clone(), version_info.clone());\n                 Ok(version_info)\n             }\n@@ -127,6 +134,7 @@ impl Versions {\n             Ok(file) => file,\n             Err(err) if err.kind() == std::io::ErrorKind::NotFound => {\n                 // Missing tarballs do not return an error, but return empty data.\n+                println!(\"warning: missing tarball {}\", tarball.display());\n                 return Ok(VersionInfo::default());\n             }\n             Err(err) => return Err(err.into()),"}]}