{"sha": "26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2YzYxYzdlNDliMTczYzhhZTdjNTRjM2E0YzkwYjYwY2Q5ZjcxYjg=", "commit": {"author": {"name": "Takayuki Nakata", "email": "f.seasons017@gmail.com", "date": "2020-11-25T08:07:50Z"}, "committer": {"name": "Takayuki Nakata", "email": "f.seasons017@gmail.com", "date": "2020-12-11T14:07:52Z"}, "message": "Fix FP of `manual_range_contains` in `const fn`", "tree": {"sha": "c19a27689d1f9de372bd2142c97f67b59b68e240", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c19a27689d1f9de372bd2142c97f67b59b68e240"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "html_url": "https://github.com/rust-lang/rust/commit/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/comments", "author": {"login": "giraffate", "id": 17407489, "node_id": "MDQ6VXNlcjE3NDA3NDg5", "avatar_url": "https://avatars.githubusercontent.com/u/17407489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giraffate", "html_url": "https://github.com/giraffate", "followers_url": "https://api.github.com/users/giraffate/followers", "following_url": "https://api.github.com/users/giraffate/following{/other_user}", "gists_url": "https://api.github.com/users/giraffate/gists{/gist_id}", "starred_url": "https://api.github.com/users/giraffate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giraffate/subscriptions", "organizations_url": "https://api.github.com/users/giraffate/orgs", "repos_url": "https://api.github.com/users/giraffate/repos", "events_url": "https://api.github.com/users/giraffate/events{/privacy}", "received_events_url": "https://api.github.com/users/giraffate/received_events", "type": "User", "site_admin": false}, "committer": {"login": "giraffate", "id": 17407489, "node_id": "MDQ6VXNlcjE3NDA3NDg5", "avatar_url": "https://avatars.githubusercontent.com/u/17407489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giraffate", "html_url": "https://github.com/giraffate", "followers_url": "https://api.github.com/users/giraffate/followers", "following_url": "https://api.github.com/users/giraffate/following{/other_user}", "gists_url": "https://api.github.com/users/giraffate/gists{/gist_id}", "starred_url": "https://api.github.com/users/giraffate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giraffate/subscriptions", "organizations_url": "https://api.github.com/users/giraffate/orgs", "repos_url": "https://api.github.com/users/giraffate/repos", "events_url": "https://api.github.com/users/giraffate/events{/privacy}", "received_events_url": "https://api.github.com/users/giraffate/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27fd6ed58145a6cf9789ef82deb3be8182c92915", "url": "https://api.github.com/repos/rust-lang/rust/commits/27fd6ed58145a6cf9789ef82deb3be8182c92915", "html_url": "https://github.com/rust-lang/rust/commit/27fd6ed58145a6cf9789ef82deb3be8182c92915"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "3e454eecd970e37b85dfb0d150f13e3715b5d136", "filename": "clippy_lints/src/ranges.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/clippy_lints%2Fsrc%2Franges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/clippy_lints%2Fsrc%2Franges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Franges.rs?ref=26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "patch": "@@ -14,7 +14,7 @@ use std::cmp::Ordering;\n \n use crate::utils::sugg::Sugg;\n use crate::utils::{\n-    get_parent_expr, is_integer_const, meets_msrv, single_segment_path, snippet, snippet_opt,\n+    get_parent_expr, in_constant, is_integer_const, meets_msrv, single_segment_path, snippet, snippet_opt,\n     snippet_with_applicability, span_lint, span_lint_and_sugg, span_lint_and_then,\n };\n use crate::utils::{higher, SpanlessEq};\n@@ -190,7 +190,7 @@ impl<'tcx> LateLintPass<'tcx> for Ranges {\n             },\n             ExprKind::Binary(ref op, ref l, ref r) => {\n                 if meets_msrv(self.msrv.as_ref(), &MANUAL_RANGE_CONTAINS_MSRV) {\n-                    check_possible_range_contains(cx, op.node, l, r, expr.span);\n+                    check_possible_range_contains(cx, op.node, l, r, expr);\n                 }\n             },\n             _ => {},\n@@ -203,7 +203,12 @@ impl<'tcx> LateLintPass<'tcx> for Ranges {\n     extract_msrv_attr!(LateContext);\n }\n \n-fn check_possible_range_contains(cx: &LateContext<'_>, op: BinOpKind, l: &Expr<'_>, r: &Expr<'_>, span: Span) {\n+fn check_possible_range_contains(cx: &LateContext<'_>, op: BinOpKind, l: &Expr<'_>, r: &Expr<'_>, expr: &Expr<'_>) {\n+    if in_constant(cx, expr.hir_id) {\n+        return;\n+    }\n+\n+    let span = expr.span;\n     let combine_and = match op {\n         BinOpKind::And | BinOpKind::BitAnd => true,\n         BinOpKind::Or | BinOpKind::BitOr => false,"}, {"sha": "47c974e614b91e80bda1fd3b46dfe11a92b240f9", "filename": "tests/ui/range_contains.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/tests%2Fui%2Frange_contains.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/tests%2Fui%2Frange_contains.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frange_contains.fixed?ref=26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "patch": "@@ -44,3 +44,8 @@ fn main() {\n     (0. ..1.).contains(&y);\n     !(0. ..=1.).contains(&y);\n }\n+\n+// Fix #6373\n+pub const fn in_range(a: i32) -> bool {\n+    3 <= a && a <= 20\n+}"}, {"sha": "835deced5e4cba34a443debfc104ce0ac21b8635", "filename": "tests/ui/range_contains.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/tests%2Fui%2Frange_contains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8/tests%2Fui%2Frange_contains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frange_contains.rs?ref=26c61c7e49b173c8ae7c54c3a4c90b60cd9f71b8", "patch": "@@ -44,3 +44,8 @@ fn main() {\n     y >= 0. && y < 1.;\n     y < 0. || y > 1.;\n }\n+\n+// Fix #6373\n+pub const fn in_range(a: i32) -> bool {\n+    3 <= a && a <= 20\n+}"}]}