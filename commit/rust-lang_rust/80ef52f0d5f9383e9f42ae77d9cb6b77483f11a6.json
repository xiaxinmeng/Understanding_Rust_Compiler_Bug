{"sha": "80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwZWY1MmYwZDVmOTM4M2U5ZjQyYWU3N2Q5Y2I2Yjc3NDgzZjExYTY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-06-28T18:00:04Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-06-28T18:00:04Z"}, "message": "Make sure to join the child", "tree": {"sha": "ed2947cb9bff2f8d2d9b23b843dae38b7e4045d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed2947cb9bff2f8d2d9b23b843dae38b7e4045d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6", "html_url": "https://github.com/rust-lang/rust/commit/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "117cf0b85bc8022a939fe43054f64aaa35117dd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/117cf0b85bc8022a939fe43054f64aaa35117dd9", "html_url": "https://github.com/rust-lang/rust/commit/117cf0b85bc8022a939fe43054f64aaa35117dd9"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "9335098ff09725b3baf1f7e4a0321ebe0b95e716", "filename": "crates/flycheck/src/lib.rs", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6/crates%2Fflycheck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6/crates%2Fflycheck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fflycheck%2Fsrc%2Flib.rs?ref=80ef52f0d5f9383e9f42ae77d9cb6b77483f11a6", "patch": "@@ -5,8 +5,9 @@\n use std::{\n     fmt,\n     io::{self, BufReader},\n+    ops,\n     path::PathBuf,\n-    process::{Command, Stdio},\n+    process::{self, Command, Stdio},\n     time::Duration,\n };\n \n@@ -236,8 +237,9 @@ fn run_cargo(\n     mut command: Command,\n     on_message: &mut dyn FnMut(cargo_metadata::Message) -> bool,\n ) -> io::Result<()> {\n-    let mut child =\n+    let child =\n         command.stdout(Stdio::piped()).stderr(Stdio::null()).stdin(Stdio::null()).spawn()?;\n+    let mut child = ChildKiller(child);\n \n     // We manually read a line at a time, instead of using serde's\n     // stream deserializers, because the deserializer cannot recover\n@@ -283,3 +285,24 @@ fn run_cargo(\n \n     Ok(())\n }\n+\n+struct ChildKiller(process::Child);\n+\n+impl ops::Deref for ChildKiller {\n+    type Target = process::Child;\n+    fn deref(&self) -> &process::Child {\n+        &self.0\n+    }\n+}\n+\n+impl ops::DerefMut for ChildKiller {\n+    fn deref_mut(&mut self) -> &mut process::Child {\n+        &mut self.0\n+    }\n+}\n+\n+impl Drop for ChildKiller {\n+    fn drop(&mut self) {\n+        let _ = self.0.kill();\n+    }\n+}"}]}