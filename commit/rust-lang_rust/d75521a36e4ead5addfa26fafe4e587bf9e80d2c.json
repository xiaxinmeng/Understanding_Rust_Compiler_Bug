{"sha": "d75521a36e4ead5addfa26fafe4e587bf9e80d2c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3NTUyMWEzNmU0ZWFkNWFkZGZhMjZmYWZlNGU1ODdiZjllODBkMmM=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-05-26T04:30:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-26T04:30:59Z"}, "message": "Rollup merge of #85590 - jam1garner:tool-bootstrap-su-fix, r=Mark-Simulacrum\n\nFix bootstrap using host exe suffix for cargo\n\nWhen attempting to cross compile rustc (for example, from Linux to Windows) and tell it to build cargo/tools, the following error occurs:\n\n```\nthread 'main' panicked at 'src.symlink_metadata() failed with No such file or directory (os error 2)', src/bootstrap/lib.rs:1196:24\n```\n\nRelevant part of stack trace:\n<details>\n\n```\n   2: bootstrap::Build::copy\n             at ./src/bootstrap/lib.rs:1196:24\n   3: <bootstrap::tool::ToolBuild as bootstrap::builder::Step>::run\n             at ./src/bootstrap/tool.rs:220:13\n```\n</details>\n\nIf I add `-vvv` (which seemed to be the recommended course for debugging a similar issue according to [zulip logs](https://zulip-archive.rust-lang.org/182449tcompilerhelp/19655failedtobootstrap.html)), it shows:\n\n```\nCopy \".../rust/build/x86_64-unknown-linux-gnu/stage2-tools/x86_64-pc-windows-gnu/release/cargo\" to \".../rust/build/x86_64-unknown-linux-gnu/stage2-tools-bin/cargo\"\n```\nand when taking a look at the contents of `build/x86_64-unknown-linux-gnu/stage2-tools/x86_64-pc-windows-gnu/release` it contains `cargo.exe`, but no `cargo`.\n\nI tried to study the surrounding code to make sure this was the intended behavior and while I can't be 100% certain, it does seem that using the exe suffix for the `compiler.host` target instead of the `target` target won't have the desired behavior when cross-compiling to/from Windows.", "tree": {"sha": "5493a9aa5b2a0057d736110ec6042e2cd84c20f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5493a9aa5b2a0057d736110ec6042e2cd84c20f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d75521a36e4ead5addfa26fafe4e587bf9e80d2c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgrc8ECRBK7hj4Ov3rIwAAoykIAAdI24PfQwGf3eHO/OTdermh\nhDS8c1JOtbrBLj9wcrWeS+GYKMNOekbc6+Crv+NRyzf8SKziu0eK2clYNpofZ1ay\nh9aPy7G6/xHTQ8c3Owf9t0MrSjJ0SSXhgHl27Yc0yx045M6+pHtFhzQBdGdxx3SB\nHi+tqF/1vzTGLxemsQRJqt+ACeQb0Fqk+BmpfO4VJIAOSuppxDh7a68epydwqAHy\njE2Lx5kTyR3xhpargTYHXG5I3xnD23kDuUAqlAnln+bll1DZ8CTSDhTo/pUQZnbV\nWYu8KXs1ZpTphS0MX8z33lTbuMDwsOslYk9YiCxIF9jPC2r+hzqVYQJLabyPh3M=\n=/qgh\n-----END PGP SIGNATURE-----\n", "payload": "tree 5493a9aa5b2a0057d736110ec6042e2cd84c20f1\nparent ae6a1a7043ce68e75cbc740dcdca792057df1555\nparent 903e369c831d52726a5292f847e384622189d9a0\nauthor Yuki Okushi <jtitor@2k36.org> 1622003459 +0900\ncommitter GitHub <noreply@github.com> 1622003459 +0900\n\nRollup merge of #85590 - jam1garner:tool-bootstrap-su-fix, r=Mark-Simulacrum\n\nFix bootstrap using host exe suffix for cargo\n\nWhen attempting to cross compile rustc (for example, from Linux to Windows) and tell it to build cargo/tools, the following error occurs:\n\n```\nthread 'main' panicked at 'src.symlink_metadata() failed with No such file or directory (os error 2)', src/bootstrap/lib.rs:1196:24\n```\n\nRelevant part of stack trace:\n<details>\n\n```\n   2: bootstrap::Build::copy\n             at ./src/bootstrap/lib.rs:1196:24\n   3: <bootstrap::tool::ToolBuild as bootstrap::builder::Step>::run\n             at ./src/bootstrap/tool.rs:220:13\n```\n</details>\n\nIf I add `-vvv` (which seemed to be the recommended course for debugging a similar issue according to [zulip logs](https://zulip-archive.rust-lang.org/182449tcompilerhelp/19655failedtobootstrap.html)), it shows:\n\n```\nCopy \".../rust/build/x86_64-unknown-linux-gnu/stage2-tools/x86_64-pc-windows-gnu/release/cargo\" to \".../rust/build/x86_64-unknown-linux-gnu/stage2-tools-bin/cargo\"\n```\nand when taking a look at the contents of `build/x86_64-unknown-linux-gnu/stage2-tools/x86_64-pc-windows-gnu/release` it contains `cargo.exe`, but no `cargo`.\n\nI tried to study the surrounding code to make sure this was the intended behavior and while I can't be 100% certain, it does seem that using the exe suffix for the `compiler.host` target instead of the `target` target won't have the desired behavior when cross-compiling to/from Windows.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d75521a36e4ead5addfa26fafe4e587bf9e80d2c", "html_url": "https://github.com/rust-lang/rust/commit/d75521a36e4ead5addfa26fafe4e587bf9e80d2c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d75521a36e4ead5addfa26fafe4e587bf9e80d2c/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae6a1a7043ce68e75cbc740dcdca792057df1555", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae6a1a7043ce68e75cbc740dcdca792057df1555", "html_url": "https://github.com/rust-lang/rust/commit/ae6a1a7043ce68e75cbc740dcdca792057df1555"}, {"sha": "903e369c831d52726a5292f847e384622189d9a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/903e369c831d52726a5292f847e384622189d9a0", "html_url": "https://github.com/rust-lang/rust/commit/903e369c831d52726a5292f847e384622189d9a0"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "64e4be6863a62f824d2bf87ca2ddd2fdf93770c0", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d75521a36e4ead5addfa26fafe4e587bf9e80d2c/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d75521a36e4ead5addfa26fafe4e587bf9e80d2c/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=d75521a36e4ead5addfa26fafe4e587bf9e80d2c", "patch": "@@ -217,9 +217,8 @@ impl Step for ToolBuild {\n             if tool == \"tidy\" {\n                 tool = \"rust-tidy\";\n             }\n-            let cargo_out =\n-                builder.cargo_out(compiler, self.mode, target).join(exe(tool, compiler.host));\n-            let bin = builder.tools_dir(compiler).join(exe(tool, compiler.host));\n+            let cargo_out = builder.cargo_out(compiler, self.mode, target).join(exe(tool, target));\n+            let bin = builder.tools_dir(compiler).join(exe(tool, target));\n             builder.copy(&cargo_out, &bin);\n             Some(bin)\n         }"}]}