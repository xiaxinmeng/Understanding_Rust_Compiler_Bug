{"sha": "fad1b9c3ba98f2018a33de523b241be622d32c0c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhZDFiOWMzYmE5OGYyMDE4YTMzZGU1MjNiMjQxYmU2MjJkMzJjMGM=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-07-04T01:33:16Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-07-04T01:45:47Z"}, "message": "Make x.py less verbose on failures\n\n- Don't print the exact command run by rustbuild unless `--verbose` is set.\n  This is almost always unhelpful, since it's just cargo with a lot of\n  arguments.\n- Don't print \"Build completed unsuccessfully\" unless --verbose is set.\n  You can already tell the build failed by the errors above, and the\n  time isn't particularly helpful.\n- Don't print the full path to bootstrap. This is useless to everyone,\n  even including when working on x.py itself. You can still opt-in to\n  this being shown with `--verbose`, since it will throw an exception.\n\nBefore:\n\n```\nerror[E0432]: unresolved import `x`\n   --> library/std/src/lib.rs:343:5\n    |\n343 | use x;\n    |     ^ no external crate `x`\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0432`.\nerror: could not compile `std`\n\nTo learn more, run the command again with --verbose.\ncommand did not execute successfully: \"/home/joshua/rustc4/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\" \"check\" \"--target\" \"x86_64-unknown-linux-gnu\" \"-Zbinary-dep-depinfo\" \"-j\" \"8\" \"--release\" \"--features\" \"panic-unwind backtrace\" \"--manifest-path\" \"/home/joshua/rustc4/library/test/Cargo.toml\" \"--message-format\" \"json-render-diagnostics\"\nexpected success, got: exit status: 101\nfailed to run: /home/joshua/rustc4/build/bootstrap/debug/bootstrap check\nBuild completed unsuccessfully in 0:00:13\n```\n\nAfter:\n\n```\nerror[E0432]: unresolved import `x`\n   --> library/std/src/lib.rs:343:5\n    |\n343 | use x;\n    |     ^ no external crate `x`\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0432`.\nerror: could not compile `std`\n\nTo learn more, run the command again with --verbose.\n```", "tree": {"sha": "6ff387110c935c831d1074382200660d32a65057", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ff387110c935c831d1074382200660d32a65057"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fad1b9c3ba98f2018a33de523b241be622d32c0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fad1b9c3ba98f2018a33de523b241be622d32c0c", "html_url": "https://github.com/rust-lang/rust/commit/fad1b9c3ba98f2018a33de523b241be622d32c0c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fad1b9c3ba98f2018a33de523b241be622d32c0c/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96859dbaf6229f131fbd427a32aaa95d4f9cb132", "url": "https://api.github.com/repos/rust-lang/rust/commits/96859dbaf6229f131fbd427a32aaa95d4f9cb132", "html_url": "https://github.com/rust-lang/rust/commit/96859dbaf6229f131fbd427a32aaa95d4f9cb132"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "f9904cb610d2d6e3157abee34161498afd36cabf", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fad1b9c3ba98f2018a33de523b241be622d32c0c/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/fad1b9c3ba98f2018a33de523b241be622d32c0c/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=fad1b9c3ba98f2018a33de523b241be622d32c0c", "patch": "@@ -138,7 +138,7 @@ def unpack(tarball, tarball_suffix, dst, verbose=False, match=None):\n     shutil.rmtree(os.path.join(dst, fname))\n \n \n-def run(args, verbose=False, exception=False, **kwargs):\n+def run(args, verbose=False, exception=False, is_bootstrap=False, **kwargs):\n     \"\"\"Run a child program in a new process\"\"\"\n     if verbose:\n         print(\"running: \" + ' '.join(args))\n@@ -151,7 +151,14 @@ def run(args, verbose=False, exception=False, **kwargs):\n         err = \"failed to run: \" + ' '.join(args)\n         if verbose or exception:\n             raise RuntimeError(err)\n-        sys.exit(err)\n+        # For most failures, we definitely do want to print this error, or the user will have no\n+        # idea what went wrong. But when we've successfully built bootstrap and it failed, it will\n+        # have already printed an error above, so there's no need to print the exact command we're\n+        # running.\n+        if is_bootstrap:\n+            sys.exit(1)\n+        else:\n+            sys.exit(err)\n \n \n def require(cmd, exit=True):\n@@ -1170,7 +1177,7 @@ def bootstrap(help_triggered):\n         env[\"BOOTSTRAP_CONFIG\"] = toml_path\n     if build.rustc_commit is not None:\n         env[\"BOOTSTRAP_DOWNLOAD_RUSTC\"] = '1'\n-    run(args, env=env, verbose=build.verbose)\n+    run(args, env=env, verbose=build.verbose, is_bootstrap=True)\n \n \n def main():"}, {"sha": "1fae4bee732c01248a5a708e506afb37348f3a89", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fad1b9c3ba98f2018a33de523b241be622d32c0c/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fad1b9c3ba98f2018a33de523b241be622d32c0c/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=fad1b9c3ba98f2018a33de523b241be622d32c0c", "patch": "@@ -1366,7 +1366,7 @@ pub fn stream_cargo(\n \n     // Make sure Cargo actually succeeded after we read all of its stdout.\n     let status = t!(child.wait());\n-    if !status.success() {\n+    if builder.is_verbose() && !status.success() {\n         eprintln!(\n             \"command did not execute successfully: {:?}\\n\\\n                   expected success, got: {}\","}]}