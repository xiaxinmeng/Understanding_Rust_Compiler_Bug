{"sha": "42370610ce03c1bb5893d9e29c2c215482e8d8ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyMzcwNjEwY2UwM2MxYmI1ODkzZDllMjljMmMyMTU0ODJlOGQ4Y2E=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-04T19:28:47Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-04T19:28:47Z"}, "message": "Restore assists tests", "tree": {"sha": "2a0e5598eb5f13187294effe89818d7c5327d71c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a0e5598eb5f13187294effe89818d7c5327d71c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42370610ce03c1bb5893d9e29c2c215482e8d8ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42370610ce03c1bb5893d9e29c2c215482e8d8ca", "html_url": "https://github.com/rust-lang/rust/commit/42370610ce03c1bb5893d9e29c2c215482e8d8ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42370610ce03c1bb5893d9e29c2c215482e8d8ca/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74d827bb8001952f90c85fca3d064fe3096009bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/74d827bb8001952f90c85fca3d064fe3096009bd", "html_url": "https://github.com/rust-lang/rust/commit/74d827bb8001952f90c85fca3d064fe3096009bd"}], "stats": {"total": 54, "additions": 50, "deletions": 4}, "files": [{"sha": "a8f8446cb637455120290576f9f4262c9ebb73c3", "filename": "crates/ra_assists/src/doc_tests.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Fdoc_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Fdoc_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fdoc_tests.rs?ref=42370610ce03c1bb5893d9e29c2c215482e8d8ca", "patch": "@@ -5,10 +5,11 @@\n \n mod generated;\n \n-use hir::mock::TestDB;\n use ra_db::{fixture::WithFixture, FileRange};\n use test_utils::{assert_eq_text, extract_range_or_offset};\n \n+use crate::test_db::TestDB;\n+\n fn check(assist_id: &str, before: &str, after: &str) {\n     let (selection, before) = extract_range_or_offset(before);\n     let (db, file_id) = TestDB::with_single_file(&before);"}, {"sha": "39c1c283f47527463658ed1ee75cc3a2ed2a8992", "filename": "crates/ra_assists/src/lib.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Flib.rs?ref=42370610ce03c1bb5893d9e29c2c215482e8d8ca", "patch": "@@ -9,6 +9,8 @@ mod assist_ctx;\n mod marks;\n #[cfg(test)]\n mod doc_tests;\n+#[cfg(test)]\n+mod test_db;\n \n use hir::db::HirDatabase;\n use ra_db::FileRange;\n@@ -146,12 +148,11 @@ mod assists {\n \n #[cfg(test)]\n mod helpers {\n-    use hir::mock::TestDB;\n     use ra_db::{fixture::WithFixture, FileRange};\n     use ra_syntax::TextRange;\n     use test_utils::{add_cursor, assert_eq_text, extract_offset, extract_range};\n \n-    use crate::{Assist, AssistCtx};\n+    use crate::{test_db::TestDB, Assist, AssistCtx};\n \n     pub(crate) fn check_assist(\n         assist: fn(AssistCtx<TestDB>) -> Option<Assist>,\n@@ -268,11 +269,12 @@ mod helpers {\n \n #[cfg(test)]\n mod tests {\n-    use hir::mock::TestDB;\n     use ra_db::{fixture::WithFixture, FileRange};\n     use ra_syntax::TextRange;\n     use test_utils::{extract_offset, extract_range};\n \n+    use crate::test_db::TestDB;\n+\n     #[test]\n     fn assist_order_field_struct() {\n         let before = \"struct Foo { <|>bar: u32 }\";"}, {"sha": "7b196561abe95ed49a9f91aa7ab0e4462d0a76a9", "filename": "crates/ra_assists/src/test_db.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Ftest_db.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42370610ce03c1bb5893d9e29c2c215482e8d8ca/crates%2Fra_assists%2Fsrc%2Ftest_db.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Ftest_db.rs?ref=42370610ce03c1bb5893d9e29c2c215482e8d8ca", "patch": "@@ -0,0 +1,43 @@\n+use std::sync::Arc;\n+\n+use ra_db::{salsa, CrateId, FileId, FileLoader, FileLoaderDelegate, RelativePath};\n+\n+#[salsa::database(\n+    ra_db::SourceDatabaseExtStorage,\n+    ra_db::SourceDatabaseStorage,\n+    hir::db::InternDatabaseStorage,\n+    hir::db::AstDatabaseStorage,\n+    hir::db::DefDatabaseStorage,\n+    hir::db::DefDatabase2Storage,\n+    hir::db::HirDatabaseStorage\n+)]\n+#[derive(Debug, Default)]\n+pub struct TestDB {\n+    runtime: salsa::Runtime<TestDB>,\n+}\n+\n+impl salsa::Database for TestDB {\n+    fn salsa_runtime(&self) -> &salsa::Runtime<Self> {\n+        &self.runtime\n+    }\n+}\n+\n+impl std::panic::RefUnwindSafe for TestDB {}\n+\n+impl FileLoader for TestDB {\n+    fn file_text(&self, file_id: FileId) -> Arc<String> {\n+        FileLoaderDelegate(self).file_text(file_id)\n+    }\n+    fn resolve_relative_path(\n+        &self,\n+        anchor: FileId,\n+        relative_path: &RelativePath,\n+    ) -> Option<FileId> {\n+        FileLoaderDelegate(self).resolve_relative_path(anchor, relative_path)\n+    }\n+    fn relevant_crates(&self, file_id: FileId) -> Arc<Vec<CrateId>> {\n+        FileLoaderDelegate(self).relevant_crates(file_id)\n+    }\n+}\n+\n+impl hir::debug::HirDebugHelper for TestDB {}"}]}