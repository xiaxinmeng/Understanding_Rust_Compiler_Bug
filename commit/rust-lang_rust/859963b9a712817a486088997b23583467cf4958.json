{"sha": "859963b9a712817a486088997b23583467cf4958", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1OTk2M2I5YTcxMjgxN2E0ODYwODg5OTdiMjM1ODM0NjdjZjQ5NTg=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-08-09T18:02:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-09T18:02:02Z"}, "message": "Merge #5694\n\n5694: Format docs in to_proto::markup_content r=jonas-schievink a=JmPotato\n\nSigned-off-by: JmPotato <ghzpotato@gmail.com>\r\n\r\nClose #5442 \r\n\r\nRemoving # was handled in rust_analyzer::markdown::format_docs(). However, this function is no longer called in rust_analyzer::handlers::handle_hover() since commit e8bb153 (PR #5273). This pr add this formatting function back.\n\nCo-authored-by: JmPotato <ghzpotato@gmail.com>", "tree": {"sha": "da6482eef637293beff5dd010134bf06b24c4360", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da6482eef637293beff5dd010134bf06b24c4360"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/859963b9a712817a486088997b23583467cf4958", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfMDoaCRBK7hj4Ov3rIwAAdHIIAAw0NftQByPRefWJ9GlJk7gd\n5N7CudGD0HiSJTEjxb2pEg07q1XdT0XWDEAL3xC1ThGfv9Yw4b0NNpZBF8x0VKbC\n+fNV2bFftObcVZPcObcvG4Ubg8pdpnd2HAHkKed95+N5nnlIz3/ObW/nGHk05rD/\nDHw7cYzLFneWvLk7bO02yzlvcuSUNG4vgNFam5aim+b9h/SFvKxyNce0fq3lchWQ\nv78HFjmLSQ9kpAPmO4S2X84j5CCs80V+oUmhOAFnHuZSg5yxvMgK1TJLgLe/mqRR\nceLjBx7lVq1BIuXLUiH2J1htWgDIu9HkAbtoQvnxYPo4alfO5+C4Bt7s7chnXME=\n=6GtF\n-----END PGP SIGNATURE-----\n", "payload": "tree da6482eef637293beff5dd010134bf06b24c4360\nparent 8a57afe5a4bfab40072a83f7dc4ca560bf860919\nparent 3f2bc813d3b91fbf8a0007eb11c192061571873b\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1596996122 +0000\ncommitter GitHub <noreply@github.com> 1596996122 +0000\n\nMerge #5694\n\n5694: Format docs in to_proto::markup_content r=jonas-schievink a=JmPotato\n\nSigned-off-by: JmPotato <ghzpotato@gmail.com>\r\n\r\nClose #5442 \r\n\r\nRemoving # was handled in rust_analyzer::markdown::format_docs(). However, this function is no longer called in rust_analyzer::handlers::handle_hover() since commit e8bb153 (PR #5273). This pr add this formatting function back.\n\nCo-authored-by: JmPotato <ghzpotato@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/859963b9a712817a486088997b23583467cf4958", "html_url": "https://github.com/rust-lang/rust/commit/859963b9a712817a486088997b23583467cf4958", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/859963b9a712817a486088997b23583467cf4958/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a57afe5a4bfab40072a83f7dc4ca560bf860919", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a57afe5a4bfab40072a83f7dc4ca560bf860919", "html_url": "https://github.com/rust-lang/rust/commit/8a57afe5a4bfab40072a83f7dc4ca560bf860919"}, {"sha": "3f2bc813d3b91fbf8a0007eb11c192061571873b", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f2bc813d3b91fbf8a0007eb11c192061571873b", "html_url": "https://github.com/rust-lang/rust/commit/3f2bc813d3b91fbf8a0007eb11c192061571873b"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "385e3e64e39550b15f599f48170aad35196ce639", "filename": "crates/ra_ide/src/hover.rs", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/859963b9a712817a486088997b23583467cf4958/crates%2Fra_ide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/859963b9a712817a486088997b23583467cf4958/crates%2Fra_ide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fhover.rs?ref=859963b9a712817a486088997b23583467cf4958", "patch": "@@ -508,6 +508,37 @@ fn main() { }\n         );\n     }\n \n+    #[test]\n+    fn hover_shows_fn_doc() {\n+        check(\n+            r#\"\n+/// # Example\n+/// ```\n+/// # use std::path::Path;\n+/// #\n+/// foo(Path::new(\"hello, world!\"))\n+/// ```\n+pub fn foo<|>(_: &Path) {}\n+\n+fn main() { }\n+\"#,\n+            expect![[r#\"\n+                *foo*\n+                ```rust\n+                pub fn foo(_: &Path)\n+                ```\n+                ___\n+\n+                # Example\n+                ```\n+                # use std::path::Path;\n+                #\n+                foo(Path::new(\"hello, world!\"))\n+                ```\n+            \"#]],\n+        );\n+    }\n+\n     #[test]\n     fn hover_shows_struct_field_info() {\n         // Hovering over the field when instantiating"}, {"sha": "27460db78cc28c8344dc9e2e07cac767a0ff6f50", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/859963b9a712817a486088997b23583467cf4958/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/859963b9a712817a486088997b23583467cf4958/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=859963b9a712817a486088997b23583467cf4958", "patch": "@@ -755,7 +755,8 @@ pub(crate) fn runnable(\n }\n \n pub(crate) fn markup_content(markup: Markup) -> lsp_types::MarkupContent {\n-    lsp_types::MarkupContent { kind: lsp_types::MarkupKind::Markdown, value: markup.into() }\n+    let value = crate::markdown::format_docs(markup.as_str());\n+    lsp_types::MarkupContent { kind: lsp_types::MarkupKind::Markdown, value }\n }\n \n #[cfg(test)]"}]}