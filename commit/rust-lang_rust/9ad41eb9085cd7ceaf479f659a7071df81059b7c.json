{"sha": "9ad41eb9085cd7ceaf479f659a7071df81059b7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhZDQxZWI5MDg1Y2Q3Y2VhZjQ3OWY2NTlhNzA3MWRmODEwNTliN2M=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-22T11:42:53Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-22T11:42:53Z"}, "message": "Setup global allocator in the correct crate\n\nIt worked before, but was roundabout", "tree": {"sha": "6dfcadbf3b6a333777f22f54db773118bf1916d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6dfcadbf3b6a333777f22f54db773118bf1916d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ad41eb9085cd7ceaf479f659a7071df81059b7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ad41eb9085cd7ceaf479f659a7071df81059b7c", "html_url": "https://github.com/rust-lang/rust/commit/9ad41eb9085cd7ceaf479f659a7071df81059b7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ad41eb9085cd7ceaf479f659a7071df81059b7c/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "deed44a472edaf11d35fa98c7e68a288f8dfe93f", "url": "https://api.github.com/repos/rust-lang/rust/commits/deed44a472edaf11d35fa98c7e68a288f8dfe93f", "html_url": "https://github.com/rust-lang/rust/commit/deed44a472edaf11d35fa98c7e68a288f8dfe93f"}], "stats": {"total": 16, "additions": 6, "deletions": 10}, "files": [{"sha": "280d974327c18a8d1b7fcab781452367c4c0f28f", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ad41eb9085cd7ceaf479f659a7071df81059b7c/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/9ad41eb9085cd7ceaf479f659a7071df81059b7c/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=9ad41eb9085cd7ceaf479f659a7071df81059b7c", "patch": "@@ -1137,7 +1137,6 @@ dependencies = [\n  \"backtrace\",\n  \"cfg-if\",\n  \"libc\",\n- \"mimalloc\",\n  \"once_cell\",\n  \"ra_arena\",\n ]\n@@ -1362,6 +1361,7 @@ dependencies = [\n  \"log\",\n  \"lsp-server\",\n  \"lsp-types\",\n+ \"mimalloc\",\n  \"parking_lot\",\n  \"pico-args\",\n  \"ra_cfg\","}, {"sha": "6c214501e4aa693a0266db7f7e1632d415674144", "filename": "crates/ra_prof/Cargo.toml", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Fra_prof%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Fra_prof%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_prof%2FCargo.toml?ref=9ad41eb9085cd7ceaf479f659a7071df81059b7c", "patch": "@@ -13,7 +13,6 @@ doctest = false\n ra_arena = { path = \"../ra_arena\" }\n once_cell = \"1.3.1\"\n backtrace = { version = \"0.3.44\", optional = true }\n-mimalloc = { version = \"0.1.19\", default-features = false, optional = true }\n cfg-if = \"0.1.10\"\n libc = \"0.2.73\"\n \n@@ -22,5 +21,4 @@ cpu_profiler = []\n \n # Uncomment to enable for the whole crate graph\n # default = [ \"backtrace\" ]\n-# default = [ \"mimalloc\" ]\n # default = [ \"cpu_profiler\" ]"}, {"sha": "ba5609703a6e4f66a6d23537f41d78249890ef2f", "filename": "crates/ra_prof/src/lib.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Fra_prof%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Fra_prof%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_prof%2Fsrc%2Flib.rs?ref=9ad41eb9085cd7ceaf479f659a7071df81059b7c", "patch": "@@ -13,10 +13,6 @@ pub use crate::{\n     memory_usage::{Bytes, MemoryUsage},\n };\n \n-#[cfg(all(feature = \"mimalloc\"))]\n-#[global_allocator]\n-static ALLOC: mimalloc::MiMalloc = mimalloc::MiMalloc;\n-\n /// Prints backtrace to stderr, useful for debugging.\n #[cfg(feature = \"backtrace\")]\n pub fn print_backtrace() {"}, {"sha": "023c104d16da8941b13baf36d75fb3e09830af8b", "filename": "crates/rust-analyzer/Cargo.toml", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Frust-analyzer%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Frust-analyzer%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2FCargo.toml?ref=9ad41eb9085cd7ceaf479f659a7071df81059b7c", "patch": "@@ -29,6 +29,7 @@ serde = { version = \"1.0.106\", features = [\"derive\"] }\n serde_json = \"1.0.48\"\n threadpool = \"1.7.1\"\n rayon = \"1.3.1\"\n+mimalloc = { version = \"0.1.19\", default-features = false, optional = true }\n \n stdx = { path = \"../stdx\" }\n \n@@ -62,6 +63,3 @@ expect = { path = \"../expect\" }\n test_utils = { path = \"../test_utils\" }\n mbe = { path = \"../ra_mbe\", package = \"ra_mbe\" }\n tt = { path = \"../ra_tt\", package = \"ra_tt\" }\n-\n-[features]\n-mimalloc = [ \"ra_prof/mimalloc\" ]"}, {"sha": "a473c916515f2dde35bee29b7b321b2941e51c21", "filename": "crates/rust-analyzer/src/bin/main.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ad41eb9085cd7ceaf479f659a7071df81059b7c/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs?ref=9ad41eb9085cd7ceaf479f659a7071df81059b7c", "patch": "@@ -16,6 +16,10 @@ use vfs::AbsPathBuf;\n \n use crate::args::HelpPrinted;\n \n+#[cfg(all(feature = \"mimalloc\"))]\n+#[global_allocator]\n+static ALLOC: mimalloc::MiMalloc = mimalloc::MiMalloc;\n+\n fn main() -> Result<()> {\n     setup_logging()?;\n     let args = match args::Args::parse()? {"}]}