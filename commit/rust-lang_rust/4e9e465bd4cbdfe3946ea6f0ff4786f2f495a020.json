{"sha": "4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020", "node_id": "C_kwDOAAsO6NoAKDRlOWU0NjViZDRjYmRmZTM5NDZlYTZmMGZmNDc4NmYyZjQ5NWEwMjA", "commit": {"author": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-26T10:57:27Z"}, "committer": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-26T10:57:27Z"}, "message": "std: disconnect senders before discarding messages", "tree": {"sha": "f91ebb9106ab37d79dd2e52d6f060a7129794364", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f91ebb9106ab37d79dd2e52d6f060a7129794364"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020", "html_url": "https://github.com/rust-lang/rust/commit/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020/comments", "author": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "642a3247462a582ee97abea1c06c3fabac3bcb3f", "url": "https://api.github.com/repos/rust-lang/rust/commits/642a3247462a582ee97abea1c06c3fabac3bcb3f", "html_url": "https://github.com/rust-lang/rust/commit/642a3247462a582ee97abea1c06c3fabac3bcb3f"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "fb893695a9a58ed9988db131d48512a75d1e76e2", "filename": "library/std/src/sync/mpmc/array.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020/library%2Fstd%2Fsrc%2Fsync%2Fmpmc%2Farray.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020/library%2Fstd%2Fsrc%2Fsync%2Fmpmc%2Farray.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsync%2Fmpmc%2Farray.rs?ref=4e9e465bd4cbdfe3946ea6f0ff4786f2f495a020", "patch": "@@ -464,14 +464,15 @@ impl<T> Channel<T> {\n     /// ordering or stronger.\n     pub(crate) unsafe fn disconnect_receivers(&self) -> bool {\n         let tail = self.tail.fetch_or(self.mark_bit, Ordering::SeqCst);\n-        self.discard_all_messages(tail);\n-\n-        if tail & self.mark_bit == 0 {\n+        let disconnected = if tail & self.mark_bit == 0 {\n             self.senders.disconnect();\n             true\n         } else {\n             false\n-        }\n+        };\n+\n+        self.discard_all_messages(tail);\n+        disconnected\n     }\n \n     /// Discards all messages."}]}