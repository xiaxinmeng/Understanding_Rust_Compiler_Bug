{"sha": "c222479c6feb036e5e5198e068aa9824d855ffa4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyMjI0NzljNmZlYjAzNmU1ZTUxOThlMDY4YWE5ODI0ZDg1NWZmYTQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-09-28T02:28:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-09-28T02:28:25Z"}, "message": "Auto merge of #54547 - AstralSorcerer:issue-54028, r=eddyb\n\nRely only on base alignment and offset for computing field alignment\n\nFix #54028\nr? @eddyb", "tree": {"sha": "bfab0be84ee73109ef5277104676941e5b064712", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bfab0be84ee73109ef5277104676941e5b064712"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c222479c6feb036e5e5198e068aa9824d855ffa4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c222479c6feb036e5e5198e068aa9824d855ffa4", "html_url": "https://github.com/rust-lang/rust/commit/c222479c6feb036e5e5198e068aa9824d855ffa4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c222479c6feb036e5e5198e068aa9824d855ffa4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d52cbce6db83e4fc2d8706b4e4b9c7da76cbcf8", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d52cbce6db83e4fc2d8706b4e4b9c7da76cbcf8", "html_url": "https://github.com/rust-lang/rust/commit/7d52cbce6db83e4fc2d8706b4e4b9c7da76cbcf8"}, {"sha": "06b8c3ee5b52dc849259655578afca70cb32dda3", "url": "https://api.github.com/repos/rust-lang/rust/commits/06b8c3ee5b52dc849259655578afca70cb32dda3", "html_url": "https://github.com/rust-lang/rust/commit/06b8c3ee5b52dc849259655578afca70cb32dda3"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "e7b6f5908a4d16a2c4fa9780d53bd5abbcd9d5ff", "filename": "src/librustc_codegen_llvm/mir/place.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c222479c6feb036e5e5198e068aa9824d855ffa4/src%2Flibrustc_codegen_llvm%2Fmir%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c222479c6feb036e5e5198e068aa9824d855ffa4/src%2Flibrustc_codegen_llvm%2Fmir%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fmir%2Fplace.rs?ref=c222479c6feb036e5e5198e068aa9824d855ffa4", "patch": "@@ -173,10 +173,7 @@ impl PlaceRef<'ll, 'tcx> {\n         let cx = bx.cx;\n         let field = self.layout.field(cx, ix);\n         let offset = self.layout.fields.offset(ix);\n-        let effective_field_align = self.align\n-            .min(self.layout.align)\n-            .min(field.align)\n-            .restrict_for_offset(offset);\n+        let effective_field_align = self.align.restrict_for_offset(offset);\n \n         let simple = || {\n             // Unions and newtypes only use an offset of 0."}, {"sha": "887c43c6761e86bbc739f0525c2912561c18dae9", "filename": "src/test/codegen/align-struct.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c222479c6feb036e5e5198e068aa9824d855ffa4/src%2Ftest%2Fcodegen%2Falign-struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c222479c6feb036e5e5198e068aa9824d855ffa4/src%2Ftest%2Fcodegen%2Falign-struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Falign-struct.rs?ref=c222479c6feb036e5e5198e068aa9824d855ffa4", "patch": "@@ -48,6 +48,16 @@ pub fn align64(i : i32) -> Align64 {\n     a64\n }\n \n+// For issue 54028: make sure that we are specifying the correct alignment for fields of aligned\n+// structs\n+// CHECK-LABEL: @align64_load\n+#[no_mangle]\n+pub fn align64_load(a: Align64) -> i32 {\n+// CHECK: [[FIELD:%.*]] = bitcast %Align64* %{{.*}} to i32*\n+// CHECK: {{%.*}} = load i32, i32* [[FIELD]], align 64\n+    a.0\n+}\n+\n // CHECK-LABEL: @nested64\n #[no_mangle]\n pub fn nested64(a: Align64, b: i32, c: i32, d: i8) -> Nested64 {"}]}