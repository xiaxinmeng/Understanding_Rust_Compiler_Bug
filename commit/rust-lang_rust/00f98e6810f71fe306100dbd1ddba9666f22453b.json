{"sha": "00f98e6810f71fe306100dbd1ddba9666f22453b", "node_id": "C_kwDOAAsO6NoAKDAwZjk4ZTY4MTBmNzFmZTMwNjEwMGRiZDFkZGJhOTY2NmYyMjQ1M2I", "commit": {"author": {"name": "Alex Huang", "email": "huangalex409@gmail.com", "date": "2023-03-03T22:27:29Z"}, "committer": {"name": "Alex Huang", "email": "huangalex409@gmail.com", "date": "2023-03-03T22:27:29Z"}, "message": "./configure script should only show blocks (and associated comments) where it is not default", "tree": {"sha": "8a0baf00c7a1937ecc86019505401418e5fc794e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a0baf00c7a1937ecc86019505401418e5fc794e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00f98e6810f71fe306100dbd1ddba9666f22453b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00f98e6810f71fe306100dbd1ddba9666f22453b", "html_url": "https://github.com/rust-lang/rust/commit/00f98e6810f71fe306100dbd1ddba9666f22453b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00f98e6810f71fe306100dbd1ddba9666f22453b/comments", "author": {"login": "Teapot4195", "id": 75273023, "node_id": "MDQ6VXNlcjc1MjczMDIz", "avatar_url": "https://avatars.githubusercontent.com/u/75273023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Teapot4195", "html_url": "https://github.com/Teapot4195", "followers_url": "https://api.github.com/users/Teapot4195/followers", "following_url": "https://api.github.com/users/Teapot4195/following{/other_user}", "gists_url": "https://api.github.com/users/Teapot4195/gists{/gist_id}", "starred_url": "https://api.github.com/users/Teapot4195/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Teapot4195/subscriptions", "organizations_url": "https://api.github.com/users/Teapot4195/orgs", "repos_url": "https://api.github.com/users/Teapot4195/repos", "events_url": "https://api.github.com/users/Teapot4195/events{/privacy}", "received_events_url": "https://api.github.com/users/Teapot4195/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Teapot4195", "id": 75273023, "node_id": "MDQ6VXNlcjc1MjczMDIz", "avatar_url": "https://avatars.githubusercontent.com/u/75273023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Teapot4195", "html_url": "https://github.com/Teapot4195", "followers_url": "https://api.github.com/users/Teapot4195/followers", "following_url": "https://api.github.com/users/Teapot4195/following{/other_user}", "gists_url": "https://api.github.com/users/Teapot4195/gists{/gist_id}", "starred_url": "https://api.github.com/users/Teapot4195/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Teapot4195/subscriptions", "organizations_url": "https://api.github.com/users/Teapot4195/orgs", "repos_url": "https://api.github.com/users/Teapot4195/repos", "events_url": "https://api.github.com/users/Teapot4195/events{/privacy}", "received_events_url": "https://api.github.com/users/Teapot4195/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f77bfb7336f21bfe6a5fb5f7358d4406e2597289", "url": "https://api.github.com/repos/rust-lang/rust/commits/f77bfb7336f21bfe6a5fb5f7358d4406e2597289", "html_url": "https://github.com/rust-lang/rust/commit/f77bfb7336f21bfe6a5fb5f7358d4406e2597289"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "3aaeb09d4c005dd1a59336f4dbce81cc8e0c7759", "filename": "config.toml.example", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/00f98e6810f71fe306100dbd1ddba9666f22453b/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/00f98e6810f71fe306100dbd1ddba9666f22453b/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=00f98e6810f71fe306100dbd1ddba9666f22453b", "patch": "@@ -164,6 +164,7 @@ changelog-seen = 2\n # General build configuration options\n # =============================================================================\n [build]\n+\n # The default stage to use for the `check` subcommand\n #check-stage = 0\n "}, {"sha": "573d864600d6489e359cbbcf95caccc5b6045c64", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/00f98e6810f71fe306100dbd1ddba9666f22453b/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/00f98e6810f71fe306100dbd1ddba9666f22453b/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=00f98e6810f71fe306100dbd1ddba9666f22453b", "patch": "@@ -486,6 +486,22 @@ def configure_top_level_key(lines, top_level_key, value):\n     else:\n         configure_section(sections[section_key], section_config)\n \n+def write_uncommented(target, f):\n+    block = []\n+    is_comment = True\n+\n+    for line in target:\n+        block.append(line)\n+        if len(line) == 0:\n+            if not is_comment:\n+                for l in block:\n+                    f.write(l + \"\\n\")\n+            block = []\n+            is_comment = True\n+            continue\n+        is_comment = is_comment and line.startswith('#')\n+    return f\n+\n # Now that we've built up our `config.toml`, write it all out in the same\n # order that we read it in.\n p(\"\")\n@@ -494,11 +510,9 @@ def configure_top_level_key(lines, top_level_key, value):\n     for section in section_order:\n         if section == 'target':\n             for target in targets:\n-                for line in targets[target]:\n-                    f.write(line + \"\\n\")\n+                f = write_uncommented(targets[target], f)\n         else:\n-            for line in sections[section]:\n-                f.write(line + \"\\n\")\n+            f = write_uncommented(sections[section], f)\n \n with bootstrap.output('Makefile') as f:\n     contents = os.path.join(rust_dir, 'src', 'bootstrap', 'mk', 'Makefile.in')"}]}