{"sha": "a2774354eee5453aab476aab68feaa520884e25b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyNzc0MzU0ZWVlNTQ1M2FhYjQ3NmFhYjY4ZmVhYTUyMDg4NGUyNWI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-13T05:03:18Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-13T11:20:51Z"}, "message": "Rollup merge of #55879 - Xanewok:dont-panic-with-globs, r=nrc\n\nsave-analysis: Don't panic for macro-generated use globs\n\nFollow-up to https://github.com/rust-lang/rust/commit/c2bb7cadf24e82b80f403c09e800fe5fad504caf - as before, ignore the use globs in macro expansions.\n\nFixes https://github.com/rust-lang-nursery/rls/issues/1117.\nCloses #55480.\n\nr? @nrc", "tree": {"sha": "fc471ca4b25a5d457b5e483af54183c4538a220e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc471ca4b25a5d457b5e483af54183c4538a220e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a2774354eee5453aab476aab68feaa520884e25b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlvqs5MACgkQ/vbIBR0O\nATwSbQ//RTxUjgKZ6wqNnKrMTcElaQRsN8FrP9i12lRRwfI6ClP+1tRBKnWU3r/U\neNVVNSovoHcVpukafb0K2vu5HtKzn7eJDe1cnvJ3H0Q0seNEjmBBrIGJrnyDKb3s\n4ijyi3xS3Net6/iHHC+4BZzFfP9F4cRqHC+xka2DcaQLmrY+tXXHAMVob3WsaJav\nOLZVpHt/Sg4mhjUBZjS46ivy5UWiPQzkMy3XG2kB6jCNlMK6jmRsj9yN4XiQ1oSL\nMg4TH+Pdj4U235Pxeemjw67UyFt33R1myEOjB+atZWOSNqM2sFT5pJudZxnzRC0N\nEVT3Ucf2IiRJ6x936WNIYn6u3DnpdLFasONvH4ERFNV/747k5Q0O7yvrxBe0Tdrr\neXy6qQEskCdauMIqwXw9g2K5yMARLCz1JPcldq31ca53syQF7Lv6to1ivAyjRwgh\nxN0Y6oL/GjNDftu0qvjGPcXt11OrffIyxfk7M+0R1p24l20MrcHiil+tID8BHOe9\n4SocfaMJmYqJErRiHXjK+rQ68/w/58FtaFPFsZAzuA6fh/iUiv5rye7TrQC24TP9\nWHtcxBfuZHAP4TLawRcWsOPOurjET8d9yRw8nbf+LzCZ6yQPBK9IqSnLfNSrFdLe\nYtIMYLBofwhVlyHYZzZkAvM4HLbEVmRtc2z4BN8MSw8UVOVNP1w=\n=/jMX\n-----END PGP SIGNATURE-----", "payload": "tree fc471ca4b25a5d457b5e483af54183c4538a220e\nparent 5134d9cc183e2b285b3c72b4d5a40065c480d341\nparent 04cc0d651e8b40dffbcd3865c1e2c2cfc1663911\nauthor kennytm <kennytm@gmail.com> 1542085398 +0800\ncommitter kennytm <kennytm@gmail.com> 1542108051 +0800\n\nRollup merge of #55879 - Xanewok:dont-panic-with-globs, r=nrc\n\nsave-analysis: Don't panic for macro-generated use globs\n\nFollow-up to https://github.com/rust-lang/rust/commit/c2bb7cadf24e82b80f403c09e800fe5fad504caf - as before, ignore the use globs in macro expansions.\n\nFixes https://github.com/rust-lang-nursery/rls/issues/1117.\nCloses #55480.\n\nr? @nrc\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a2774354eee5453aab476aab68feaa520884e25b", "html_url": "https://github.com/rust-lang/rust/commit/a2774354eee5453aab476aab68feaa520884e25b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a2774354eee5453aab476aab68feaa520884e25b/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5134d9cc183e2b285b3c72b4d5a40065c480d341", "url": "https://api.github.com/repos/rust-lang/rust/commits/5134d9cc183e2b285b3c72b4d5a40065c480d341", "html_url": "https://github.com/rust-lang/rust/commit/5134d9cc183e2b285b3c72b4d5a40065c480d341"}, {"sha": "04cc0d651e8b40dffbcd3865c1e2c2cfc1663911", "url": "https://api.github.com/repos/rust-lang/rust/commits/04cc0d651e8b40dffbcd3865c1e2c2cfc1663911", "html_url": "https://github.com/rust-lang/rust/commit/04cc0d651e8b40dffbcd3865c1e2c2cfc1663911"}], "stats": {"total": 34, "additions": 19, "deletions": 15}, "files": [{"sha": "0c0f50c1fd70907fee7e855b88f8cc90b499649a", "filename": "src/librustc_save_analysis/dump_visitor.rs", "status": "modified", "additions": 19, "deletions": 15, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/a2774354eee5453aab476aab68feaa520884e25b/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a2774354eee5453aab476aab68feaa520884e25b/src%2Flibrustc_save_analysis%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fdump_visitor.rs?ref=a2774354eee5453aab476aab68feaa520884e25b", "patch": "@@ -1254,21 +1254,25 @@ impl<'l, 'tcx: 'l, 'll, O: DumpOutput + 'll> DumpVisitor<'l, 'tcx, 'll, O> {\n                     Vec::new()\n                 };\n \n-                let sub_span =\n-                    self.span.sub_span_of_token(use_tree.span, token::BinOp(token::Star));\n-                if !self.span.filter_generated(use_tree.span) {\n-                    let span =\n-                        self.span_from_span(sub_span.expect(\"No span found for use glob\"));\n-                    self.dumper.import(&access, Import {\n-                        kind: ImportKind::GlobUse,\n-                        ref_id: None,\n-                        span,\n-                        alias_span: None,\n-                        name: \"*\".to_owned(),\n-                        value: names.join(\", \"),\n-                        parent,\n-                    });\n-                    self.write_sub_paths(&path);\n+                // Otherwise it's a span with wrong macro expansion info, which\n+                // we don't want to track anyway, since it's probably macro-internal `use`\n+                if let Some(sub_span) =\n+                    self.span.sub_span_of_token(use_tree.span, token::BinOp(token::Star))\n+                {\n+                    if !self.span.filter_generated(use_tree.span) {\n+                        let span = self.span_from_span(sub_span);\n+\n+                        self.dumper.import(&access, Import {\n+                            kind: ImportKind::GlobUse,\n+                            ref_id: None,\n+                            span,\n+                            alias_span: None,\n+                            name: \"*\".to_owned(),\n+                            value: names.join(\", \"),\n+                            parent,\n+                        });\n+                        self.write_sub_paths(&path);\n+                    }\n                 }\n             }\n             ast::UseTreeKind::Nested(ref nested_items) => {"}]}