{"sha": "5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZjNmODM1OWZjM2I2OTg4ZjAwOWE1Y2E3ZWJkNzMzNjU2NWNhOTI=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2017-08-25T10:39:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-08-25T10:39:53Z"}, "message": "Merge pull request #1989 from Frederick888/fix-1988\n\nTry to fix #1988", "tree": {"sha": "a496f8881ec48c5be9f48c5791802667cbd0da16", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a496f8881ec48c5be9f48c5791802667cbd0da16"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "html_url": "https://github.com/rust-lang/rust/commit/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c38cf1e2a167ef3fc427e8d1b0880e70d91c8e24", "url": "https://api.github.com/repos/rust-lang/rust/commits/c38cf1e2a167ef3fc427e8d1b0880e70d91c8e24", "html_url": "https://github.com/rust-lang/rust/commit/c38cf1e2a167ef3fc427e8d1b0880e70d91c8e24"}, {"sha": "bec2c68ebcb66a800d0015b2babc4f935ee96fa9", "url": "https://api.github.com/repos/rust-lang/rust/commits/bec2c68ebcb66a800d0015b2babc4f935ee96fa9", "html_url": "https://github.com/rust-lang/rust/commit/bec2c68ebcb66a800d0015b2babc4f935ee96fa9"}], "stats": {"total": 110, "additions": 53, "deletions": 57}, "files": [{"sha": "58ded1b337257b3e60eabc34628a6e71afca8b5b", "filename": "CHANGELOG.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -1,11 +1,12 @@\n # Change Log\n All notable changes to this project will be documented in this file.\n \n-* New lint: [`naive_bytecount`]\n \n ## 0.0.154\n+* Update to *rustc 1.21.0-nightly (2c0558f63 2017-08-24)*\n * Fix [`use_self`] triggering inside derives\n * Add support for linting an entire workspace with `cargo clippy --all`\n+* New lint: [`naive_bytecount`]\n \n ## 0.0.153\n * Update to *rustc 1.21.0-nightly (8c303ed87 2017-08-20)*"}, {"sha": "914d453ebf8441a0616b4671fe0ac1666c1c975b", "filename": "Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -1,6 +1,6 @@\n [package]\n name = \"clippy\"\n-version = \"0.0.153\"\n+version = \"0.0.154\"\n authors = [\n \t\"Manish Goregaokar <manishsmail@gmail.com>\",\n \t\"Andre Bogus <bogusandre@gmail.com>\",\n@@ -31,7 +31,7 @@ path = \"src/main.rs\"\n \n [dependencies]\n # begin automatic update\n-clippy_lints = { version = \"0.0.153\", path = \"clippy_lints\" }\n+clippy_lints = { version = \"0.0.154\", path = \"clippy_lints\" }\n # end automatic update\n cargo_metadata = \"0.2\"\n "}, {"sha": "8cdbbaaecf5a37ebc1e30455268846040d58ed88", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -1,7 +1,7 @@\n [package]\n name = \"clippy_lints\"\n # begin automatic update\n-version = \"0.0.153\"\n+version = \"0.0.154\"\n # end automatic update\n authors = [\n \t\"Manish Goregaokar <manishsmail@gmail.com>\","}, {"sha": "4cb386471c9cb95ada9278c30f225ff92cf2060f", "filename": "clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 19, "deletions": 21, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flifetimes.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -104,14 +104,14 @@ fn check_fn_inner<'a, 'tcx>(\n     for typ in &generics.ty_params {\n         for bound in &typ.bounds {\n             if let TraitTyParamBound(ref trait_ref, _) = *bound {\n-                let bounds = trait_ref\n+                let bounds = &trait_ref\n                     .trait_ref\n                     .path\n                     .segments\n                     .last()\n                     .expect(\"a path must have at least one segment\")\n                     .parameters\n-                    .lifetimes();\n+                    .lifetimes;\n                 for bound in bounds {\n                     if bound.name != \"'static\" && !bound.is_elided() {\n                         return;\n@@ -282,25 +282,23 @@ impl<'v, 't> RefVisitor<'v, 't> {\n \n     fn collect_anonymous_lifetimes(&mut self, qpath: &QPath, ty: &Ty) {\n         let last_path_segment = &last_path_segment(qpath).parameters;\n-        if let AngleBracketedParameters(ref params) = *last_path_segment {\n-            if params.lifetimes.is_empty() {\n-                let hir_id = self.cx.tcx.hir.node_to_hir_id(ty.id);\n-                match self.cx.tables.qpath_def(qpath, hir_id) {\n-                    Def::TyAlias(def_id) |\n-                    Def::Struct(def_id) => {\n-                        let generics = self.cx.tcx.generics_of(def_id);\n-                        for _ in generics.regions.as_slice() {\n-                            self.record(&None);\n-                        }\n-                    },\n-                    Def::Trait(def_id) => {\n-                        let trait_def = self.cx.tcx.trait_def(def_id);\n-                        for _ in &self.cx.tcx.generics_of(trait_def.def_id).regions {\n-                            self.record(&None);\n-                        }\n-                    },\n-                    _ => (),\n-                }\n+        if !last_path_segment.parenthesized && last_path_segment.lifetimes.is_empty() {\n+            let hir_id = self.cx.tcx.hir.node_to_hir_id(ty.id);\n+            match self.cx.tables.qpath_def(qpath, hir_id) {\n+                Def::TyAlias(def_id) |\n+                Def::Struct(def_id) => {\n+                    let generics = self.cx.tcx.generics_of(def_id);\n+                    for _ in generics.regions.as_slice() {\n+                        self.record(&None);\n+                    }\n+                },\n+                Def::Trait(def_id) => {\n+                    let trait_def = self.cx.tcx.trait_def(def_id);\n+                    for _ in &self.cx.tcx.generics_of(trait_def.def_id).regions {\n+                        self.record(&None);\n+                    }\n+                },\n+                _ => (),\n             }\n         }\n     }"}, {"sha": "8d28789e73792d643970e5c8dbc6783eaa2738f0", "filename": "clippy_lints/src/methods.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -1464,11 +1464,11 @@ fn is_as_ref_or_mut_trait(ty: &hir::Ty, self_ty: &hir::Ty, generics: &hir::Gener\n                         let path = &ptr.trait_ref.path;\n                         match_path(path, name) &&\n                             path.segments.last().map_or(false, |s| {\n-                                if let hir::PathParameters::AngleBracketedParameters(ref data) = s.parameters {\n-                                    data.types.len() == 1 &&\n-                                        (is_self_ty(&data.types[0]) || is_ty(&*data.types[0], self_ty))\n-                                } else {\n+                                if s.parameters.parenthesized {\n                                     false\n+                                } else {\n+                                    s.parameters.types.len() == 1 &&\n+                                        (is_self_ty(&s.parameters.types[0]) || is_ty(&*s.parameters.types[0], self_ty))\n                                 }\n                             })\n                     } else {"}, {"sha": "15ebe648500088f6d625d92e98e08dde36e10a74", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -147,7 +147,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n                         let TyPath(QPath::Resolved(_, ref path)) = input.node,\n                         let Some(elem_ty) = path.segments.iter()\n                             .find(|seg| seg.name == \"Vec\")\n-                            .map(|ps| ps.parameters.types()[0]),\n+                            .map(|ps| &ps.parameters.types[0]),\n                     ], {\n                         let slice_ty = format!(\"&[{}]\", snippet(cx, elem_ty.span, \"_\"));\n                         db.span_suggestion(input.span,"}, {"sha": "83e212c36d151822fad17310988655c980797278", "filename": "clippy_lints/src/transmute.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Ftransmute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Ftransmute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -208,8 +208,8 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Transmute {\n fn get_type_snippet(cx: &LateContext, path: &QPath, to_rty: Ty) -> String {\n     let seg = last_path_segment(path);\n     if_let_chain!{[\n-        let PathParameters::AngleBracketedParameters(ref ang) = seg.parameters,\n-        let Some(to_ty) = ang.types.get(1),\n+        !seg.parameters.parenthesized,\n+        let Some(to_ty) = seg.parameters.types.get(1),\n         let TyRptr(_, ref to_ty) = to_ty.node,\n     ], {\n         return snippet(cx, to_ty.ty.span, &to_rty.to_string()).to_string();"}, {"sha": "db962ad56f3894a3cdd1cd9d6dc1b2bc62c2c3ea", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -155,8 +155,8 @@ fn check_ty(cx: &LateContext, ast_ty: &hir::Ty, is_local: bool) {\n                 if Some(def_id) == cx.tcx.lang_items.owned_box() {\n                     let last = last_path_segment(qpath);\n                     if_let_chain! {[\n-                        let PathParameters::AngleBracketedParameters(ref ag) = last.parameters,\n-                        let Some(vec) = ag.types.get(0),\n+                        !last.parameters.parenthesized,\n+                        let Some(vec) = last.parameters.types.get(0),\n                         let TyPath(ref qpath) = vec.node,\n                         let Some(did) = opt_def_id(cx.tables.qpath_def(qpath, cx.tcx.hir.node_to_hir_id(vec.id))),\n                         match_def_path(cx.tcx, did, &paths::VEC),\n@@ -182,18 +182,18 @@ fn check_ty(cx: &LateContext, ast_ty: &hir::Ty, is_local: bool) {\n             match *qpath {\n                 QPath::Resolved(Some(ref ty), ref p) => {\n                     check_ty(cx, ty, is_local);\n-                    for ty in p.segments.iter().flat_map(|seg| seg.parameters.types()) {\n+                    for ty in p.segments.iter().flat_map(|seg| seg.parameters.types.iter()) {\n                         check_ty(cx, ty, is_local);\n                     }\n                 },\n                 QPath::Resolved(None, ref p) => {\n-                    for ty in p.segments.iter().flat_map(|seg| seg.parameters.types()) {\n+                    for ty in p.segments.iter().flat_map(|seg| seg.parameters.types.iter()) {\n                         check_ty(cx, ty, is_local);\n                     }\n                 },\n                 QPath::TypeRelative(ref ty, ref seg) => {\n                     check_ty(cx, ty, is_local);\n-                    for ty in seg.parameters.types() {\n+                    for ty in seg.parameters.types.iter() {\n                         check_ty(cx, ty, is_local);\n                     }\n                 },\n@@ -209,8 +209,8 @@ fn check_ty(cx: &LateContext, ast_ty: &hir::Ty, is_local: bool) {\n                         Some(def_id) == cx.tcx.lang_items.owned_box(),\n                         let QPath::Resolved(None, ref path) = *qpath,\n                         let [ref bx] = *path.segments,\n-                        let PathParameters::AngleBracketedParameters(ref ab_data) = bx.parameters,\n-                        let [ref inner] = *ab_data.types\n+                        !bx.parameters.parenthesized,\n+                        let [ref inner] = *bx.parameters.types\n                     ], {\n                         if is_any_trait(inner) {\n                             // Ignore `Box<Any>` types, see #1884 for details."}, {"sha": "fffeb3bb69955b86ef18496a1d82f388b92effcf", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -56,16 +56,16 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for UseSelf {\n         if_let_chain!([\n             let ItemImpl(.., ref item_type, ref refs) = item.node,\n             let Ty_::TyPath(QPath::Resolved(_, ref item_path)) = item_type.node,\n-            let PathParameters::AngleBracketedParameters(ref param_data)\n-              = item_path.segments.last().expect(SEGMENTS_MSG).parameters,\n-            param_data.lifetimes.len() == 0,\n         ], {\n-            let visitor = &mut UseSelfVisitor {\n-                item_path: item_path,\n-                cx: cx,\n-            };\n-            for impl_item_ref in refs {\n-                visitor.visit_impl_item(cx.tcx.hir.impl_item(impl_item_ref.id));\n+            let parameters = &item_path.segments.last().expect(SEGMENTS_MSG).parameters;\n+            if !parameters.parenthesized && parameters.lifetimes.len() == 0 {\n+                let visitor = &mut UseSelfVisitor {\n+                    item_path: item_path,\n+                    cx: cx,\n+                };\n+                for impl_item_ref in refs {\n+                    visitor.visit_impl_item(cx.tcx.hir.impl_item(impl_item_ref.id));\n+                }\n             }\n         })\n     }"}, {"sha": "4890bb81dc3beeb8a9edcd1aec3cf9a8dc88a04d", "filename": "clippy_lints/src/utils/hir_utils.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cf3f8359fc3b6988f009a5ca7ebd7336565ca92/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs?ref=5cf3f8359fc3b6988f009a5ca7ebd7336565ca92", "patch": "@@ -195,18 +195,15 @@ impl<'a, 'tcx: 'a> SpanlessEq<'a, 'tcx> {\n     }\n \n     fn eq_path_parameters(&self, left: &PathParameters, right: &PathParameters) -> bool {\n-        match (left, right) {\n-            (&AngleBracketedParameters(ref left), &AngleBracketedParameters(ref right)) => {\n+        if !(left.parenthesized || right.parenthesized) {\n                 over(&left.lifetimes, &right.lifetimes, |l, r| self.eq_lifetime(l, r)) &&\n                     over(&left.types, &right.types, |l, r| self.eq_ty(l, r)) &&\n                     over(&left.bindings, &right.bindings, |l, r| self.eq_type_binding(l, r))\n-            },\n-            (&ParenthesizedParameters(ref left), &ParenthesizedParameters(ref right)) => {\n-                over(&left.inputs, &right.inputs, |l, r| self.eq_ty(l, r)) &&\n-                    both(&left.output, &right.output, |l, r| self.eq_ty(l, r))\n-            },\n-            (&AngleBracketedParameters(_), &ParenthesizedParameters(_)) |\n-            (&ParenthesizedParameters(_), &AngleBracketedParameters(_)) => false,\n+        } else if left.parenthesized && right.parenthesized {\n+                over(left.inputs(), right.inputs(), |l, r| self.eq_ty(l, r)) &&\n+                    both(&Some(&left.bindings[0].ty), &Some(&right.bindings[0].ty), |l, r| self.eq_ty(l, r))\n+        } else {\n+            false\n         }\n     }\n "}]}