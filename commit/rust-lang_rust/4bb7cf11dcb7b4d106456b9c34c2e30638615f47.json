{"sha": "4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiYjdjZjExZGNiN2I0ZDEwNjQ1NmI5YzM0YzJlMzA2Mzg2MTVmNDc=", "commit": {"author": {"name": "Florian Hartwig", "email": "florian.j.hartwig@gmail.com", "date": "2015-11-27T16:52:29Z"}, "committer": {"name": "Florian Hartwig", "email": "florian.j.hartwig@gmail.com", "date": "2015-11-27T16:52:29Z"}, "message": "Introduce max_suggestion_distance function to avoid duplicating the heuristic", "tree": {"sha": "d320dc1ef0bcee20a04f840de932f01ae079fb4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d320dc1ef0bcee20a04f840de932f01ae079fb4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "html_url": "https://github.com/rust-lang/rust/commit/4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/comments", "author": {"login": "fhartwig", "id": 83271, "node_id": "MDQ6VXNlcjgzMjcx", "avatar_url": "https://avatars.githubusercontent.com/u/83271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fhartwig", "html_url": "https://github.com/fhartwig", "followers_url": "https://api.github.com/users/fhartwig/followers", "following_url": "https://api.github.com/users/fhartwig/following{/other_user}", "gists_url": "https://api.github.com/users/fhartwig/gists{/gist_id}", "starred_url": "https://api.github.com/users/fhartwig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fhartwig/subscriptions", "organizations_url": "https://api.github.com/users/fhartwig/orgs", "repos_url": "https://api.github.com/users/fhartwig/repos", "events_url": "https://api.github.com/users/fhartwig/events{/privacy}", "received_events_url": "https://api.github.com/users/fhartwig/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fhartwig", "id": 83271, "node_id": "MDQ6VXNlcjgzMjcx", "avatar_url": "https://avatars.githubusercontent.com/u/83271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fhartwig", "html_url": "https://github.com/fhartwig", "followers_url": "https://api.github.com/users/fhartwig/followers", "following_url": "https://api.github.com/users/fhartwig/following{/other_user}", "gists_url": "https://api.github.com/users/fhartwig/gists{/gist_id}", "starred_url": "https://api.github.com/users/fhartwig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fhartwig/subscriptions", "organizations_url": "https://api.github.com/users/fhartwig/orgs", "repos_url": "https://api.github.com/users/fhartwig/repos", "events_url": "https://api.github.com/users/fhartwig/events{/privacy}", "received_events_url": "https://api.github.com/users/fhartwig/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ba657cad5f0fdeebfc3637f2cbc31af24e944f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ba657cad5f0fdeebfc3637f2cbc31af24e944f7", "html_url": "https://github.com/rust-lang/rust/commit/9ba657cad5f0fdeebfc3637f2cbc31af24e944f7"}], "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "b5a8d5a13fe0e7a31fa33af74b4e2da6f65e210a", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "patch": "@@ -72,7 +72,7 @@ use syntax::ext::mtwt;\n use syntax::parse::token::{self, special_names, special_idents};\n use syntax::ptr::P;\n use syntax::codemap::{self, Span, Pos};\n-use syntax::util::lev_distance::lev_distance;\n+use syntax::util::lev_distance::{lev_distance, max_suggestion_distance};\n \n use rustc_front::intravisit::{self, FnKind, Visitor};\n use rustc_front::hir;\n@@ -3384,11 +3384,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             }\n         }\n \n-        // As a loose rule to avoid obviously incorrect suggestions, clamp the\n-        // maximum edit distance we will accept for a suggestion to one third of\n-        // the typo'd name's length.\n-        let max_distance = std::cmp::max(name.len(), 3) / 3;\n-\n+        let max_distance = max_suggestion_distance(name);\n         if !values.is_empty() && values[smallest] <= max_distance && name != &maybes[smallest][..] {\n \n             SuggestionType::Function(maybes[smallest].to_string())"}, {"sha": "cf6881ab65051449ed8958aebf71879bb25ab710", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "patch": "@@ -24,7 +24,7 @@ use parse::token;\n use parse::token::{InternedString, intern, str_to_ident};\n use ptr::P;\n use util::small_vector::SmallVector;\n-use util::lev_distance::lev_distance;\n+use util::lev_distance::{lev_distance, max_suggestion_distance};\n use ext::mtwt;\n use fold::Folder;\n \n@@ -779,10 +779,8 @@ impl<'a> ExtCtxt<'a> {\n     }\n \n     pub fn suggest_macro_name(&mut self, name: &str, span: Span) {\n-        use std::cmp::max;\n-\n         let mut min: Option<(Name, usize)> = None;\n-        let max_dist = max(name.len() / 3, 1);\n+        let max_dist = max_suggestion_distance(name);\n         for macro_name in self.syntax_env.names.iter() {\n             let dist = lev_distance(name, &macro_name.as_str());\n             if dist <= max_dist && (min.is_none() || min.unwrap().1 > dist) {"}, {"sha": "9bf96311122e0e3c51a891ec349afedc2012cbfe", "filename": "src/libsyntax/util/lev_distance.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibsyntax%2Futil%2Flev_distance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bb7cf11dcb7b4d106456b9c34c2e30638615f47/src%2Flibsyntax%2Futil%2Flev_distance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Futil%2Flev_distance.rs?ref=4bb7cf11dcb7b4d106456b9c34c2e30638615f47", "patch": "@@ -41,6 +41,14 @@ pub fn lev_distance(me: &str, t: &str) -> usize {\n     dcol[t_last + 1]\n }\n \n+pub fn max_suggestion_distance(name: &str) -> usize {\n+    use std::cmp::max;\n+    // As a loose rule to avoid obviously incorrect suggestions, clamp the\n+    // maximum edit distance we will accept for a suggestion to one third of\n+    // the typo'd name's length.\n+    max(name.len(), 3) / 3\n+}\n+\n #[test]\n fn test_lev_distance() {\n     use std::char::{ from_u32, MAX };"}]}