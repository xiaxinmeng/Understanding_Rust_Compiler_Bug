{"sha": "c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "node_id": "C_kwDOAAsO6NoAKGMzZGRjYTZkNGEzY2MzNjMzNzEwMTY4NWYxMDBlMGNhOWM1ZTk2MjY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-25T04:51:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-25T04:51:13Z"}, "message": "Rollup merge of #93251 - jsha:theme-radio, r=GuillaumeGomez\n\nrustdoc settings: use radio buttons for theme\n\nThis reduces the number of clicks required to change theme.\n\nAlso, simplify the UI a bit (remove setting grouping), and add a \"Back\" link close to the settings icon.\n\nDemo: https://rustdoc.crud.net/jsha/theme-radio/settings.html\n\nr? ``@GuillaumeGomez``\n\nNew:\n\n![image](https://user-images.githubusercontent.com/220205/150702647-4826d525-54fa-439a-b24c-6d5bca6f95bf.png)\n\nOld:\n\n![image](https://user-images.githubusercontent.com/220205/150702669-6a4214ed-1dab-4fee-b1aa-59acfce3dbca.png)", "tree": {"sha": "2e2ac332284b49f7c761978fc31539323e0ffd59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e2ac332284b49f7c761978fc31539323e0ffd59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh74HBCRBK7hj4Ov3rIwAAvKYIAIJlfygCuWBhDanIxZGTf9Gg\n/PsU2hNPzqi0+rLtE7LsKKOVklSqkXt5hKnyiNpku8oK48z+CuIEYdAm36JUt5N6\n/eoX6Urg3zhYqX964GQFi32sRuD7+p8rMT/GC9nY7KBDUCuWZKuEy0njOYXPYyfk\nw9EvjaG1a9KuvAC47Cfid7dVuoCE5arjlvkR7CaFFF7V6R/Y7h8thksqVT5wZyZH\nbhXOyv2z4368t85hWtLz7xc/T20UFlrzKcQKoyAhXm1HYDxhODzSzPEvBSVPwmMX\nBMK/VTS3xim06qNKFr2mDKIHpaIEzH73c5PZL9z5bIoeybjXt5fcEzt/6GqJqHw=\n=oIQ+\n-----END PGP SIGNATURE-----\n", "payload": "tree 2e2ac332284b49f7c761978fc31539323e0ffd59\nparent 3d6f276ca71060a189fdbcb61b93750c2cb8c5a7\nparent 11b17c6c04c027f10dad1ed3c6af571d56bb0a94\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1643086273 +0100\ncommitter GitHub <noreply@github.com> 1643086273 +0100\n\nRollup merge of #93251 - jsha:theme-radio, r=GuillaumeGomez\n\nrustdoc settings: use radio buttons for theme\n\nThis reduces the number of clicks required to change theme.\n\nAlso, simplify the UI a bit (remove setting grouping), and add a \"Back\" link close to the settings icon.\n\nDemo: https://rustdoc.crud.net/jsha/theme-radio/settings.html\n\nr? ``@GuillaumeGomez``\n\nNew:\n\n![image](https://user-images.githubusercontent.com/220205/150702647-4826d525-54fa-439a-b24c-6d5bca6f95bf.png)\n\nOld:\n\n![image](https://user-images.githubusercontent.com/220205/150702669-6a4214ed-1dab-4fee-b1aa-59acfce3dbca.png)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "html_url": "https://github.com/rust-lang/rust/commit/c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d6f276ca71060a189fdbcb61b93750c2cb8c5a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d6f276ca71060a189fdbcb61b93750c2cb8c5a7", "html_url": "https://github.com/rust-lang/rust/commit/3d6f276ca71060a189fdbcb61b93750c2cb8c5a7"}, {"sha": "11b17c6c04c027f10dad1ed3c6af571d56bb0a94", "url": "https://api.github.com/repos/rust-lang/rust/commits/11b17c6c04c027f10dad1ed3c6af571d56bb0a94", "html_url": "https://github.com/rust-lang/rust/commit/11b17c6c04c027f10dad1ed3c6af571d56bb0a94"}], "stats": {"total": 128, "additions": 78, "deletions": 50}, "files": [{"sha": "32e4a82918421cb83d34d43dd0c497ab50f7cf6e", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 35, "deletions": 40, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "patch": "@@ -376,25 +376,21 @@ impl Setting {\n                 description,\n             ),\n             Setting::Select { js_data_name, description, default_value, ref options } => format!(\n-                \"<div class=\\\"setting-line\\\">\\\n-                     <div>{}</div>\\\n-                     <label class=\\\"select-wrapper\\\">\\\n-                         <select id=\\\"{}\\\" autocomplete=\\\"off\\\">{}</select>\\\n-                         <img src=\\\"{}down-arrow{}.svg\\\" alt=\\\"Select item\\\">\\\n-                     </label>\\\n-                 </div>\",\n-                description,\n+                \"<div class=\\\"setting-line\\\"><div class=\\\"radio-line\\\" id=\\\"{}\\\"><span class=\\\"setting-name\\\">{}</span>{}</div></div>\",\n                 js_data_name,\n+                description,\n                 options\n                     .iter()\n                     .map(|opt| format!(\n-                        \"<option value=\\\"{name}\\\" {}>{name}</option>\",\n-                        if opt == default_value { \"selected\" } else { \"\" },\n+                        \"<label for=\\\"{js_data_name}-{name}\\\" class=\\\"choice\\\">\n+                           <input type=\\\"radio\\\" name=\\\"{js_data_name}\\\" id=\\\"{js_data_name}-{name}\\\" value=\\\"{name}\\\" {checked}>\\\n+                           {name}\\\n+                         </label>\",\n+                        js_data_name = js_data_name,\n                         name = opt,\n+                        checked = if opt == default_value { \"checked\" } else { \"\" },\n                     ))\n                     .collect::<String>(),\n-                root_path,\n-                suffix,\n             ),\n         }\n     }\n@@ -418,31 +414,25 @@ impl<T: Into<Setting>> From<(&'static str, Vec<T>)> for Setting {\n fn settings(root_path: &str, suffix: &str, theme_names: Vec<String>) -> Result<String, Error> {\n     // (id, explanation, default value)\n     let settings: &[Setting] = &[\n-        (\n-            \"Theme preferences\",\n-            vec![\n-                Setting::from((\"use-system-theme\", \"Use system theme\", true)),\n-                Setting::Select {\n-                    js_data_name: \"theme\",\n-                    description: \"Theme\",\n-                    default_value: \"light\",\n-                    options: theme_names.clone(),\n-                },\n-                Setting::Select {\n-                    js_data_name: \"preferred-dark-theme\",\n-                    description: \"Preferred dark theme\",\n-                    default_value: \"dark\",\n-                    options: theme_names.clone(),\n-                },\n-                Setting::Select {\n-                    js_data_name: \"preferred-light-theme\",\n-                    description: \"Preferred light theme\",\n-                    default_value: \"light\",\n-                    options: theme_names,\n-                },\n-            ],\n-        )\n-            .into(),\n+        Setting::from((\"use-system-theme\", \"Use system theme\", true)),\n+        Setting::Select {\n+            js_data_name: \"theme\",\n+            description: \"Theme\",\n+            default_value: \"light\",\n+            options: theme_names.clone(),\n+        },\n+        Setting::Select {\n+            js_data_name: \"preferred-light-theme\",\n+            description: \"Preferred light theme\",\n+            default_value: \"light\",\n+            options: theme_names.clone(),\n+        },\n+        Setting::Select {\n+            js_data_name: \"preferred-dark-theme\",\n+            description: \"Preferred dark theme\",\n+            default_value: \"dark\",\n+            options: theme_names,\n+        },\n         (\"auto-hide-large-items\", \"Auto-hide item contents for large items.\", true).into(),\n         (\"auto-hide-method-docs\", \"Auto-hide item methods' documentation\", false).into(),\n         (\"auto-hide-trait-implementations\", \"Auto-hide trait implementation documentation\", false)\n@@ -454,9 +444,14 @@ fn settings(root_path: &str, suffix: &str, theme_names: Vec<String>) -> Result<S\n     ];\n \n     Ok(format!(\n-        \"<h1 class=\\\"fqn\\\">\\\n-            <span class=\\\"in-band\\\">Rustdoc settings</span>\\\n-        </h1>\\\n+        \"<div class=\\\"main-heading\\\">\n+            <h1 class=\\\"fqn\\\">\\\n+                <span class=\\\"in-band\\\">Rustdoc settings</span>\\\n+            </h1>\\\n+            <span class=\\\"out-of-band\\\">\\\n+            <a id=\\\"back\\\" href=\\\"javascript:void(0)\\\">Back</a>\\\n+            </span>\\\n+        </div>\\\n         <div class=\\\"settings\\\">{}</div>\\\n         <link rel=\\\"stylesheet\\\" href=\\\"{root_path}settings{suffix}.css\\\">\\\n         <script src=\\\"{root_path}settings{suffix}.js\\\"></script>\","}, {"sha": "932000487b0a8098ffc24003f6f706b7a3fe254c", "filename": "src/librustdoc/html/static/css/settings.css", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "raw_url": "https://github.com/rust-lang/rust/raw/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css?ref=c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "patch": "@@ -17,6 +17,30 @@\n \tborder-bottom: 1px solid;\n }\n \n+.setting-line .radio-line {\n+\tdisplay: flex;\n+\tflex-wrap: wrap;\n+}\n+\n+.setting-line .radio-line > * {\n+\tpadding: 0.3em;\n+}\n+\n+.setting-line .radio-line .setting-name {\n+\tflex-grow: 1;\n+}\n+\n+.setting-line .radio-line input {\n+\tmargin-right: 0.3em;\n+}\n+\n+.radio-line .choice {\n+\tborder-radius: 0.1em;\n+\tborder: 1px solid;\n+\tmargin-left: 0.5em;\n+\tmin-width: 3.5em;\n+}\n+\n .toggle {\n \tposition: relative;\n \tdisplay: inline-block;"}, {"sha": "47a8fcdfd5ecf29c5f7f6223a8691debc0b7928a", "filename": "src/librustdoc/html/static/js/settings.js", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "raw_url": "https://github.com/rust-lang/rust/raw/c3ddca6d4a3cc36337101685f100e0ca9c5e9626/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js?ref=c3ddca6d4a3cc36337101685f100e0ca9c5e9626", "patch": "@@ -33,19 +33,15 @@\n     }\n \n     function showLightAndDark() {\n-        addClass(document.getElementById(\"theme\").parentElement.parentElement, \"hidden\");\n-        removeClass(document.getElementById(\"preferred-light-theme\").parentElement.parentElement,\n-            \"hidden\");\n-        removeClass(document.getElementById(\"preferred-dark-theme\").parentElement.parentElement,\n-            \"hidden\");\n+        addClass(document.getElementById(\"theme\").parentElement, \"hidden\");\n+        removeClass(document.getElementById(\"preferred-light-theme\").parentElement, \"hidden\");\n+        removeClass(document.getElementById(\"preferred-dark-theme\").parentElement, \"hidden\");\n     }\n \n     function hideLightAndDark() {\n-        addClass(document.getElementById(\"preferred-light-theme\").parentElement.parentElement,\n-            \"hidden\");\n-        addClass(document.getElementById(\"preferred-dark-theme\").parentElement.parentElement,\n-            \"hidden\");\n-        removeClass(document.getElementById(\"theme\").parentElement.parentElement, \"hidden\");\n+        addClass(document.getElementById(\"preferred-light-theme\").parentElement, \"hidden\");\n+        addClass(document.getElementById(\"preferred-dark-theme\").parentElement, \"hidden\");\n+        removeClass(document.getElementById(\"theme\").parentElement, \"hidden\");\n     }\n \n     function updateLightAndDark() {\n@@ -82,6 +78,19 @@\n                 changeSetting(this.id, this.value);\n             };\n         });\n+        onEachLazy(document.querySelectorAll(\"input[type=\\\"radio\\\"]\"), function(elem) {\n+            const settingId = elem.name;\n+            const settingValue = getSettingValue(settingId);\n+            if (settingValue !== null && settingValue !== \"null\") {\n+                elem.checked = settingValue === elem.value;\n+            }\n+            elem.addEventListener(\"change\", function(ev) {\n+                changeSetting(ev.target.name, ev.target.value);\n+            });\n+        });\n+        document.getElementById(\"back\").addEventListener(\"click\", function() {\n+            history.back();\n+        });\n     }\n \n     window.addEventListener(\"DOMContentLoaded\", setEvents);"}]}