{"sha": "5e80e0cbf415219bb4fb483a24bd8cc03836d315", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlODBlMGNiZjQxNTIxOWJiNGZiNDgzYTI0YmQ4Y2MwMzgzNmQzMTU=", "commit": {"author": {"name": "Flaper Fesp", "email": "flaper87@gmail.com", "date": "2013-08-20T00:10:53Z"}, "committer": {"name": "Flaper Fesp", "email": "flaper87@gmail.com", "date": "2013-08-26T22:37:08Z"}, "message": "Decrement unkillable counter before failing", "tree": {"sha": "2582b5b5aefcc2854b1f77ae32361d7c252ced63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2582b5b5aefcc2854b1f77ae32361d7c252ced63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e80e0cbf415219bb4fb483a24bd8cc03836d315", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e80e0cbf415219bb4fb483a24bd8cc03836d315", "html_url": "https://github.com/rust-lang/rust/commit/5e80e0cbf415219bb4fb483a24bd8cc03836d315", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e80e0cbf415219bb4fb483a24bd8cc03836d315/comments", "author": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fc4045d789ed752c49b9368a2cc9a1cd8c341d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fc4045d789ed752c49b9368a2cc9a1cd8c341d5", "html_url": "https://github.com/rust-lang/rust/commit/5fc4045d789ed752c49b9368a2cc9a1cd8c341d5"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "94df621ce766626b81062d603fc0c48c1a68d66d", "filename": "src/libstd/rt/kill.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5e80e0cbf415219bb4fb483a24bd8cc03836d315/src%2Flibstd%2Frt%2Fkill.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e80e0cbf415219bb4fb483a24bd8cc03836d315/src%2Flibstd%2Frt%2Fkill.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Fkill.rs?ref=5e80e0cbf415219bb4fb483a24bd8cc03836d315", "patch": "@@ -648,7 +648,9 @@ impl Death {\n     #[inline]\n     pub fn allow_kill(&mut self, already_failing: bool) {\n         if self.unkillable == 0 {\n-            fail!(\"illegal call of rekillable\");\n+            // we need to decrement the counter before failing.\n+            self.unkillable -= 1;\n+            fail!(\"Cannot enter a rekillable() block without a surrounding unkillable()\");\n         }\n         self.unkillable -= 1;\n         if self.unkillable == 0 {"}, {"sha": "74e1af540c0a92fbeb72aac90a62aa2c2a3d90d3", "filename": "src/libstd/task/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5e80e0cbf415219bb4fb483a24bd8cc03836d315/src%2Flibstd%2Ftask%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e80e0cbf415219bb4fb483a24bd8cc03836d315/src%2Flibstd%2Ftask%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftask%2Fmod.rs?ref=5e80e0cbf415219bb4fb483a24bd8cc03836d315", "patch": "@@ -651,8 +651,8 @@ fn test_kill_unkillable_task() {\n     }\n }\n \n-#[ignore(reason = \"linked failure\")]\n #[test]\n+#[ignore(cfg(windows))]\n fn test_kill_rekillable_task() {\n     use rt::test::*;\n \n@@ -672,8 +672,8 @@ fn test_kill_rekillable_task() {\n }\n \n #[test]\n-#[ignore(cfg(windows))]\n #[should_fail]\n+#[ignore(cfg(windows))]\n fn test_rekillable_not_nested() {\n     do rekillable {\n         // This should fail before"}]}