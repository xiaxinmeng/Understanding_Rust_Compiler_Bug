{"sha": "be2075c6614532b6b58bef455c3ff89ecf2ef625", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlMjA3NWM2NjE0NTMyYjZiNThiZWY0NTVjM2ZmODllY2YyZWY2MjU=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2018-10-24T10:19:47Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2018-10-24T10:19:47Z"}, "message": "This is a regression test for #54478.\n\nI confirmed that it fails on:\nrustdoc 1.30.0-beta.12 (96a229824 2018-10-04)\nand passes on:\nrustdoc 1.31.0-nightly (f99911a4a 2018-10-23)", "tree": {"sha": "8e473a5b35f9442b301836717e1511a9b6e30701", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e473a5b35f9442b301836717e1511a9b6e30701"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be2075c6614532b6b58bef455c3ff89ecf2ef625", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be2075c6614532b6b58bef455c3ff89ecf2ef625", "html_url": "https://github.com/rust-lang/rust/commit/be2075c6614532b6b58bef455c3ff89ecf2ef625", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be2075c6614532b6b58bef455c3ff89ecf2ef625/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f99911a4a0bead7dd1f9ef2f90442844434cc391", "url": "https://api.github.com/repos/rust-lang/rust/commits/f99911a4a0bead7dd1f9ef2f90442844434cc391", "html_url": "https://github.com/rust-lang/rust/commit/f99911a4a0bead7dd1f9ef2f90442844434cc391"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "4811f363bc97a388a395941cae7248ce9a5a12f3", "filename": "src/test/rustdoc/issue-54478-demo-allocator.rs", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/be2075c6614532b6b58bef455c3ff89ecf2ef625/src%2Ftest%2Frustdoc%2Fissue-54478-demo-allocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be2075c6614532b6b58bef455c3ff89ecf2ef625/src%2Ftest%2Frustdoc%2Fissue-54478-demo-allocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-54478-demo-allocator.rs?ref=be2075c6614532b6b58bef455c3ff89ecf2ef625", "patch": "@@ -0,0 +1,42 @@\n+// Issue #54478: regression test showing that we can demonstrate\n+// `#[global_allocator]` in code blocks built by `rustdoc`.\n+//\n+// ## Background\n+//\n+// Changes in lang-item visibility injected failures that were only\n+// exposed when compiling with `-C prefer-dynamic`. But `rustdoc` used\n+// `-C prefer-dynamic` (and had done so for years, for reasons we did\n+// not document at that time).\n+//\n+// Rather than try to revise the visbility semanics, we instead\n+// decided to change `rustdoc` to behave more like the compiler's\n+// default setting, by leaving off `-C prefer-dynamic`.\n+\n+// compile-flags:--test\n+\n+//! This is a doc comment\n+//!\n+//! ```rust\n+//! use std::alloc::*;\n+//!\n+//! #[global_allocator]\n+//! static ALLOC: A = A;\n+//!\n+//! static mut HIT: bool = false;\n+//!\n+//! struct A;\n+//!\n+//! unsafe impl GlobalAlloc for A {\n+//!     unsafe fn alloc(&self, layout: Layout) -> *mut u8 {\n+//!         HIT = true;\n+//!         System.alloc(layout)\n+//!     }\n+//!     unsafe fn dealloc(&self, ptr: *mut u8, layout: Layout) {\n+//!         System.dealloc(ptr, layout);\n+//!     }\n+//! }\n+//!\n+//! fn main() {\n+//!     assert!(unsafe { HIT });\n+//! }\n+//! ```"}]}