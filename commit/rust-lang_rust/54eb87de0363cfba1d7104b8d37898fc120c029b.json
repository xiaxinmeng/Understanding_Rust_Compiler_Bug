{"sha": "54eb87de0363cfba1d7104b8d37898fc120c029b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0ZWI4N2RlMDM2M2NmYmExZDcxMDRiOGQzNzg5OGZjMTIwYzAyOWI=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-01-07T17:08:34Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-01-07T17:08:34Z"}, "message": "Refactor out JodChild", "tree": {"sha": "938b927241824bda341d3699e24132d23aa7cde8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/938b927241824bda341d3699e24132d23aa7cde8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54eb87de0363cfba1d7104b8d37898fc120c029b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54eb87de0363cfba1d7104b8d37898fc120c029b", "html_url": "https://github.com/rust-lang/rust/commit/54eb87de0363cfba1d7104b8d37898fc120c029b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54eb87de0363cfba1d7104b8d37898fc120c029b/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1347b7fa4cdc2064ac1cb4a686f10890b9235893", "url": "https://api.github.com/repos/rust-lang/rust/commits/1347b7fa4cdc2064ac1cb4a686f10890b9235893", "html_url": "https://github.com/rust-lang/rust/commit/1347b7fa4cdc2064ac1cb4a686f10890b9235893"}], "stats": {"total": 48, "additions": 25, "deletions": 23}, "files": [{"sha": "57383491a7fb9c14585faeb74f163414d98aabbe", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54eb87de0363cfba1d7104b8d37898fc120c029b/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/54eb87de0363cfba1d7104b8d37898fc120c029b/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=54eb87de0363cfba1d7104b8d37898fc120c029b", "patch": "@@ -427,6 +427,7 @@ dependencies = [\n  \"jod-thread\",\n  \"log\",\n  \"serde_json\",\n+ \"stdx\",\n  \"toolchain\",\n ]\n "}, {"sha": "1bad64a1be120fc8dbb093facc0d4278971e5c0f", "filename": "crates/flycheck/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fflycheck%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fflycheck%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fflycheck%2FCargo.toml?ref=54eb87de0363cfba1d7104b8d37898fc120c029b", "patch": "@@ -17,3 +17,4 @@ serde_json = \"1.0.48\"\n jod-thread = \"0.1.1\"\n \n toolchain = { path = \"../toolchain\", version = \"0.0.0\" }\n+stdx = { path = \"../stdx\", version = \"0.0.0\"  }"}, {"sha": "4388e8c673587dc65beb16c3492410f0efb16f65", "filename": "crates/flycheck/src/lib.rs", "status": "modified", "additions": 1, "deletions": 22, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fflycheck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fflycheck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fflycheck%2Fsrc%2Flib.rs?ref=54eb87de0363cfba1d7104b8d37898fc120c029b", "patch": "@@ -5,13 +5,13 @@\n use std::{\n     fmt,\n     io::{self, BufReader},\n-    ops,\n     path::PathBuf,\n     process::{self, Command, Stdio},\n     time::Duration,\n };\n \n use crossbeam_channel::{never, select, unbounded, Receiver, Sender};\n+use stdx::JodChild;\n \n pub use cargo_metadata::diagnostic::{\n     Applicability, Diagnostic, DiagnosticCode, DiagnosticLevel, DiagnosticSpan,\n@@ -323,24 +323,3 @@ impl CargoActor {\n         Ok(read_at_least_one_message)\n     }\n }\n-\n-struct JodChild(process::Child);\n-\n-impl ops::Deref for JodChild {\n-    type Target = process::Child;\n-    fn deref(&self) -> &process::Child {\n-        &self.0\n-    }\n-}\n-\n-impl ops::DerefMut for JodChild {\n-    fn deref_mut(&mut self) -> &mut process::Child {\n-        &mut self.0\n-    }\n-}\n-\n-impl Drop for JodChild {\n-    fn drop(&mut self) {\n-        let _ = self.0.kill();\n-    }\n-}"}, {"sha": "5332edb09cec09beada4d351112726c233499f03", "filename": "crates/stdx/src/lib.rs", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fstdx%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54eb87de0363cfba1d7104b8d37898fc120c029b/crates%2Fstdx%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fstdx%2Fsrc%2Flib.rs?ref=54eb87de0363cfba1d7104b8d37898fc120c029b", "patch": "@@ -1,5 +1,5 @@\n //! Missing batteries for standard libraries.\n-use std::time::Instant;\n+use std::{ops, process, time::Instant};\n \n mod macros;\n pub mod panic_context;\n@@ -147,6 +147,27 @@ where\n     left\n }\n \n+pub struct JodChild(pub process::Child);\n+\n+impl ops::Deref for JodChild {\n+    type Target = process::Child;\n+    fn deref(&self) -> &process::Child {\n+        &self.0\n+    }\n+}\n+\n+impl ops::DerefMut for JodChild {\n+    fn deref_mut(&mut self) -> &mut process::Child {\n+        &mut self.0\n+    }\n+}\n+\n+impl Drop for JodChild {\n+    fn drop(&mut self) {\n+        let _ = self.0.kill();\n+    }\n+}\n+\n #[cfg(test)]\n mod tests {\n     use super::*;"}]}