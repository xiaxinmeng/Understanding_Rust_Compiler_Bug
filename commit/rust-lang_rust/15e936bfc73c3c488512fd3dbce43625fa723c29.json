{"sha": "15e936bfc73c3c488512fd3dbce43625fa723c29", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1ZTkzNmJmYzczYzNjNDg4NTEyZmQzZGJjZTQzNjI1ZmE3MjNjMjk=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-03T21:29:08Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-03T21:59:55Z"}, "message": "Preserve the layout of comment after return type", "tree": {"sha": "33222af7a4cdc0010f10c15fd0133fc205265b35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33222af7a4cdc0010f10c15fd0133fc205265b35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/15e936bfc73c3c488512fd3dbce43625fa723c29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/15e936bfc73c3c488512fd3dbce43625fa723c29", "html_url": "https://github.com/rust-lang/rust/commit/15e936bfc73c3c488512fd3dbce43625fa723c29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/15e936bfc73c3c488512fd3dbce43625fa723c29/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5650411d643d6ec3ec145d044ae549d73134e029", "url": "https://api.github.com/repos/rust-lang/rust/commits/5650411d643d6ec3ec145d044ae549d73134e029", "html_url": "https://github.com/rust-lang/rust/commit/5650411d643d6ec3ec145d044ae549d73134e029"}], "stats": {"total": 57, "additions": 53, "deletions": 4}, "files": [{"sha": "f76ae1c1a4b7c8a319e7376b18f233a987ab61a9", "filename": "src/items.rs", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/15e936bfc73c3c488512fd3dbce43625fa723c29/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15e936bfc73c3c488512fd3dbce43625fa723c29/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=15e936bfc73c3c488512fd3dbce43625fa723c29", "patch": "@@ -259,10 +259,11 @@ impl<'a> FmtVisitor<'a> {\n                                                                          has_body,\n                                                                          true));\n \n-        if self.config.fn_brace_style() != BraceStyle::AlwaysNextLine && !result.contains('\\n') {\n-            newline_brace = false;\n-        } else if force_newline_brace {\n+        if force_newline_brace {\n             newline_brace = true;\n+        } else if self.config.fn_brace_style() != BraceStyle::AlwaysNextLine &&\n+                  !result.contains('\\n') {\n+            newline_brace = false;\n         }\n \n         // Prepare for the function body by possibly adding a newline and\n@@ -1757,10 +1758,25 @@ fn rewrite_fn_base(context: &RewriteContext,\n         if where_clause.predicates.is_empty() {\n             let snippet_hi = span.hi;\n             let snippet = context.snippet(mk_sp(snippet_lo, snippet_hi));\n+            // Try to preserve the layout of the original snippet.\n+            let original_starts_with_newline =\n+                snippet\n+                    .find(|c| c != ' ')\n+                    .map_or(false, |i| snippet[i..].starts_with('\\n'));\n+            let original_ends_with_newline = snippet\n+                .rfind(|c| c != ' ')\n+                .map_or(false, |i| snippet[i..].ends_with('\\n'));\n             let snippet = snippet.trim();\n             if !snippet.is_empty() {\n-                result.push(' ');\n+                result.push(if original_starts_with_newline {\n+                                '\\n'\n+                            } else {\n+                                ' '\n+                            });\n                 result.push_str(snippet);\n+                if original_ends_with_newline {\n+                    force_new_line_for_brace = true;\n+                }\n             }\n         } else {\n             // FIXME it would be nice to catch comments between the return type"}, {"sha": "1245bcd057ca50e9e39c8e92b63b3759b3466764", "filename": "tests/target/issue-1113.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/15e936bfc73c3c488512fd3dbce43625fa723c29/tests%2Ftarget%2Fissue-1113.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15e936bfc73c3c488512fd3dbce43625fa723c29/tests%2Ftarget%2Fissue-1113.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-1113.rs?ref=15e936bfc73c3c488512fd3dbce43625fa723c29", "patch": "@@ -0,0 +1,33 @@\n+pub fn foo() -> fmt::Result\n+//pub fn writeStringToken\n+{\n+    panic!()\n+}\n+\n+pub fn foo() -> fmt::Result // pub fn writeStringToken\n+{\n+    panic!()\n+}\n+\n+pub fn foo() -> fmt::Result /* pub fn writeStringToken */ {\n+    panic!()\n+}\n+\n+pub fn foo() -> fmt::Result\n+/* pub fn writeStringToken */ {\n+    panic!()\n+}\n+\n+pub fn foo() -> fmt::Result\n+/* pub fn writeStringToken */\n+{\n+    panic!()\n+}\n+\n+pub fn foo() -> fmt::Result /*\n+                             *\n+                             *\n+                             */\n+{\n+    panic!()\n+}"}]}