{"sha": "20df0e949133fc7bb45b5a630b78f24720e55fe5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwZGYwZTk0OTEzM2ZjN2JiNDViNWE2MzBiNzhmMjQ3MjBlNTVmZTU=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-03-16T13:41:48Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-06-12T11:04:33Z"}, "message": "Add `-Z span_free_rvalues`.\n\nThis is solely a hack to make comparing test output plausible; it\nmakes closures print as [closure@node_id] instead of\n[closure@span-with-host-path] in debug printouts.", "tree": {"sha": "d2c65e4a8514d145fb28617ac9e32a912c2acdd6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2c65e4a8514d145fb28617ac9e32a912c2acdd6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20df0e949133fc7bb45b5a630b78f24720e55fe5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20df0e949133fc7bb45b5a630b78f24720e55fe5", "html_url": "https://github.com/rust-lang/rust/commit/20df0e949133fc7bb45b5a630b78f24720e55fe5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20df0e949133fc7bb45b5a630b78f24720e55fe5/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54eeef14a380ca026dc378e6927655fb08f64736", "url": "https://api.github.com/repos/rust-lang/rust/commits/54eeef14a380ca026dc378e6927655fb08f64736", "html_url": "https://github.com/rust-lang/rust/commit/54eeef14a380ca026dc378e6927655fb08f64736"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "2b2d96351f6c9a62b22752ac914396976dce63ca", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=20df0e949133fc7bb45b5a630b78f24720e55fe5", "patch": "@@ -1224,7 +1224,11 @@ impl<'tcx> Debug for Rvalue<'tcx> {\n \n                     AggregateKind::Closure(def_id, _) => ty::tls::with(|tcx| {\n                         if let Some(node_id) = tcx.hir.as_local_node_id(def_id) {\n-                            let name = format!(\"[closure@{:?}]\", tcx.hir.span(node_id));\n+                            let name = if tcx.sess.opts.debugging_opts.span_free_formats {\n+                                format!(\"[closure@{:?}]\", node_id)\n+                            } else {\n+                                format!(\"[closure@{:?}]\", tcx.hir.span(node_id))\n+                            };\n                             let mut struct_fmt = fmt.debug_struct(&name);\n \n                             tcx.with_freevars(node_id, |freevars| {"}, {"sha": "99435ccf929c05b617d33447ec9c8d5aae4146d3", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=20df0e949133fc7bb45b5a630b78f24720e55fe5", "patch": "@@ -893,6 +893,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n          DB_OPTIONS, db_type_desc, dbsetters,\n     verbose: bool = (false, parse_bool, [UNTRACKED],\n         \"in general, enable more debug printouts\"),\n+    span_free_formats: bool = (false, parse_bool, [UNTRACKED],\n+        \"when debug-printing compiler state, do not include spans\"), // o/w tests have closure@path\n     time_passes: bool = (false, parse_bool, [UNTRACKED],\n         \"measure time of each rustc pass\"),\n     count_llvm_insns: bool = (false, parse_bool,"}, {"sha": "39f8a1d81b8822442b70b57febbffd6c57a3d9b4", "filename": "src/librustc/util/ppaux.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Futil%2Fppaux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20df0e949133fc7bb45b5a630b78f24720e55fe5/src%2Flibrustc%2Futil%2Fppaux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fppaux.rs?ref=20df0e949133fc7bb45b5a630b78f24720e55fe5", "patch": "@@ -789,7 +789,11 @@ impl<'tcx> fmt::Display for ty::TypeVariants<'tcx> {\n                 write!(f, \"[closure\")?;\n \n                 if let Some(node_id) = tcx.hir.as_local_node_id(did) {\n-                    write!(f, \"@{:?}\", tcx.hir.span(node_id))?;\n+                    if tcx.sess.opts.debugging_opts.span_free_formats {\n+                        write!(f, \"@{:?}\", node_id)?;\n+                    } else {\n+                        write!(f, \"@{:?}\", tcx.hir.span(node_id))?;\n+                    }\n                     let mut sep = \" \";\n                     tcx.with_freevars(node_id, |freevars| {\n                         for (freevar, upvar_ty) in freevars.iter().zip(upvar_tys) {"}]}