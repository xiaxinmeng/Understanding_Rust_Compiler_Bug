{"sha": "39245400c53db98b2c4cb90cf712b282d8425d66", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5MjQ1NDAwYzUzZGI5OGIyYzRjYjkwY2Y3MTJiMjgyZDg0MjVkNjY=", "commit": {"author": {"name": "Bastian Kauschke", "email": "bastian_kauschke@hotmail.de", "date": "2020-09-09T07:43:18Z"}, "committer": {"name": "Bastian Kauschke", "email": "bastian_kauschke@hotmail.de", "date": "2020-09-21T10:09:08Z"}, "message": "fix InterpCx resolve", "tree": {"sha": "3c69f270dab335e04f159889832d3e4793c32ff5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c69f270dab335e04f159889832d3e4793c32ff5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39245400c53db98b2c4cb90cf712b282d8425d66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39245400c53db98b2c4cb90cf712b282d8425d66", "html_url": "https://github.com/rust-lang/rust/commit/39245400c53db98b2c4cb90cf712b282d8425d66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39245400c53db98b2c4cb90cf712b282d8425d66/comments", "author": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a409a233e02b1864d1b76495a1f946bb56c7aeb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/a409a233e02b1864d1b76495a1f946bb56c7aeb2", "html_url": "https://github.com/rust-lang/rust/commit/a409a233e02b1864d1b76495a1f946bb56c7aeb2"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "f97096984fa9bb5d26269f782c7bccf9642f4bf9", "filename": "compiler/rustc_mir/src/interpret/eval_context.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Feval_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Feval_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Feval_context.rs?ref=39245400c53db98b2c4cb90cf712b282d8425d66", "patch": "@@ -482,13 +482,13 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n     /// The `substs` are assumed to already be in our interpreter \"universe\" (param_env).\n     pub(super) fn resolve(\n         &self,\n-        def_id: DefId,\n+        def: ty::WithOptConstParam<DefId>,\n         substs: SubstsRef<'tcx>,\n     ) -> InterpResult<'tcx, ty::Instance<'tcx>> {\n-        trace!(\"resolve: {:?}, {:#?}\", def_id, substs);\n+        trace!(\"resolve: {:?}, {:#?}\", def, substs);\n         trace!(\"param_env: {:#?}\", self.param_env);\n         trace!(\"substs: {:#?}\", substs);\n-        match ty::Instance::resolve(*self.tcx, self.param_env, def_id, substs) {\n+        match ty::Instance::resolve_opt_const_arg(*self.tcx, self.param_env, def, substs) {\n             Ok(Some(instance)) => Ok(instance),\n             Ok(None) => throw_inval!(TooGeneric),\n "}, {"sha": "9fcbd60d4a3ba80846f75e4a2d220bee06f0e853", "filename": "compiler/rustc_mir/src/interpret/operand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Foperand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Foperand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Foperand.rs?ref=39245400c53db98b2c4cb90cf712b282d8425d66", "patch": "@@ -552,7 +552,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n             ty::ConstKind::Param(_) => throw_inval!(TooGeneric),\n             ty::ConstKind::Error(_) => throw_inval!(TypeckError(ErrorReported)),\n             ty::ConstKind::Unevaluated(def, substs, promoted) => {\n-                let instance = self.resolve(def.did, substs)?;\n+                let instance = self.resolve(def, substs)?;\n                 return Ok(self.eval_to_allocation(GlobalId { instance, promoted })?.into());\n             }\n             ty::ConstKind::Infer(..)"}, {"sha": "b789cb76e9f85e58366796c37ece66c3c05a0ce7", "filename": "compiler/rustc_mir/src/interpret/terminator.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fterminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39245400c53db98b2c4cb90cf712b282d8425d66/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fterminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fterminator.rs?ref=39245400c53db98b2c4cb90cf712b282d8425d66", "patch": "@@ -64,7 +64,12 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                     }\n                     ty::FnDef(def_id, substs) => {\n                         let sig = func.layout.ty.fn_sig(*self.tcx);\n-                        (FnVal::Instance(self.resolve(def_id, substs)?), sig.abi())\n+                        (\n+                            FnVal::Instance(\n+                                self.resolve(ty::WithOptConstParam::unknown(def_id), substs)?,\n+                            ),\n+                            sig.abi(),\n+                        )\n                     }\n                     _ => span_bug!(\n                         terminator.source_info.span,"}]}