{"sha": "1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE0NzdmMzQ4NTgyZWU2YTU1ZWNiOWZjMDBlMWNkNWMxNGY1YzNjOTA=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2018-05-06T12:05:41Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2018-05-06T12:05:41Z"}, "message": "Fixes compilation for rust nightly 2018-05-05\n\nCloses #2725", "tree": {"sha": "e9b3b8eb61011a2f8c6591b57e9eb4e1f62aca69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9b3b8eb61011a2f8c6591b57e9eb4e1f62aca69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "html_url": "https://github.com/rust-lang/rust/commit/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/comments", "author": null, "committer": null, "parents": [{"sha": "66165c680003645b4eb6aec2eb250ea8aa22a837", "url": "https://api.github.com/repos/rust-lang/rust/commits/66165c680003645b4eb6aec2eb250ea8aa22a837", "html_url": "https://github.com/rust-lang/rust/commit/66165c680003645b4eb6aec2eb250ea8aa22a837"}], "stats": {"total": 58, "additions": 29, "deletions": 29}, "files": [{"sha": "795ef2f99252386939ccd9df66c0015e2d6d4d5e", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "patch": "@@ -3,7 +3,7 @@ use rustc::hir::intravisit as visit;\n use rustc::hir::map::Node::{NodeExpr, NodeStmt};\n use rustc::lint::*;\n use rustc::middle::expr_use_visitor::*;\n-use rustc::middle::mem_categorization::{cmt, Categorization};\n+use rustc::middle::mem_categorization::{cmt_, Categorization};\n use rustc::ty::{self, Ty};\n use rustc::ty::layout::LayoutOf;\n use rustc::util::nodemap::NodeSet;\n@@ -86,16 +86,16 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n }\n \n impl<'a, 'tcx> Delegate<'tcx> for EscapeDelegate<'a, 'tcx> {\n-    fn consume(&mut self, _: NodeId, _: Span, cmt: cmt<'tcx>, mode: ConsumeMode) {\n+    fn consume(&mut self, _: NodeId, _: Span, cmt: &cmt_<'tcx>, mode: ConsumeMode) {\n         if let Categorization::Local(lid) = cmt.cat {\n             if let Move(DirectRefMove) = mode {\n                 // moved out or in. clearly can't be localized\n                 self.set.remove(&lid);\n             }\n         }\n     }\n-    fn matched_pat(&mut self, _: &Pat, _: cmt<'tcx>, _: MatchMode) {}\n-    fn consume_pat(&mut self, consume_pat: &Pat, cmt: cmt<'tcx>, _: ConsumeMode) {\n+    fn matched_pat(&mut self, _: &Pat, _: &cmt_<'tcx>, _: MatchMode) {}\n+    fn consume_pat(&mut self, consume_pat: &Pat, cmt: &cmt_<'tcx>, _: ConsumeMode) {\n         let map = &self.cx.tcx.hir;\n         if map.is_argument(consume_pat.id) {\n             // Skip closure arguments\n@@ -135,7 +135,7 @@ impl<'a, 'tcx> Delegate<'tcx> for EscapeDelegate<'a, 'tcx> {\n             }\n         }\n     }\n-    fn borrow(&mut self, _: NodeId, _: Span, cmt: cmt<'tcx>, _: ty::Region, _: ty::BorrowKind, loan_cause: LoanCause) {\n+    fn borrow(&mut self, _: NodeId, _: Span, cmt: &cmt_<'tcx>, _: ty::Region, _: ty::BorrowKind, loan_cause: LoanCause) {\n         if let Categorization::Local(lid) = cmt.cat {\n             match loan_cause {\n                 // x.foo()\n@@ -157,7 +157,7 @@ impl<'a, 'tcx> Delegate<'tcx> for EscapeDelegate<'a, 'tcx> {\n         }\n     }\n     fn decl_without_init(&mut self, _: NodeId, _: Span) {}\n-    fn mutate(&mut self, _: NodeId, _: Span, _: cmt<'tcx>, _: MutateMode) {}\n+    fn mutate(&mut self, _: NodeId, _: Span, _: &cmt_<'tcx>, _: MutateMode) {}\n }\n \n impl<'a, 'tcx> EscapeDelegate<'a, 'tcx> {"}, {"sha": "df5e4b885bcef1a68e78164159b3ef1000a70fe2", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "patch": "@@ -10,7 +10,7 @@ use rustc::middle::region;\n // use rustc::middle::region::CodeExtent;\n use rustc::middle::expr_use_visitor::*;\n use rustc::middle::mem_categorization::Categorization;\n-use rustc::middle::mem_categorization::cmt;\n+use rustc::middle::mem_categorization::cmt_;\n use rustc::ty::{self, Ty};\n use rustc::ty::subst::Subst;\n use std::collections::{HashMap, HashSet};\n@@ -1412,13 +1412,13 @@ struct MutatePairDelegate {\n }\n \n impl<'tcx> Delegate<'tcx> for MutatePairDelegate {\n-    fn consume(&mut self, _: NodeId, _: Span, _: cmt<'tcx>, _: ConsumeMode) {}\n+    fn consume(&mut self, _: NodeId, _: Span, _: &cmt_<'tcx>, _: ConsumeMode) {}\n \n-    fn matched_pat(&mut self, _: &Pat, _: cmt<'tcx>, _: MatchMode) {}\n+    fn matched_pat(&mut self, _: &Pat, _: &cmt_<'tcx>, _: MatchMode) {}\n \n-    fn consume_pat(&mut self, _: &Pat, _: cmt<'tcx>, _: ConsumeMode) {}\n+    fn consume_pat(&mut self, _: &Pat, _: &cmt_<'tcx>, _: ConsumeMode) {}\n \n-    fn borrow(&mut self, _: NodeId, sp: Span, cmt: cmt<'tcx>, _: ty::Region, bk: ty::BorrowKind, _: LoanCause) {\n+    fn borrow(&mut self, _: NodeId, sp: Span, cmt: &cmt_<'tcx>, _: ty::Region, bk: ty::BorrowKind, _: LoanCause) {\n         if let ty::BorrowKind::MutBorrow = bk {\n             if let Categorization::Local(id) = cmt.cat {\n                 if Some(id) == self.node_id_low {\n@@ -1431,7 +1431,7 @@ impl<'tcx> Delegate<'tcx> for MutatePairDelegate {\n         }\n     }\n \n-    fn mutate(&mut self, _: NodeId, sp: Span, cmt: cmt<'tcx>, _: MutateMode) {\n+    fn mutate(&mut self, _: NodeId, sp: Span, cmt: &cmt_<'tcx>, _: MutateMode) {\n         if let Categorization::Local(id) = cmt.cat {\n             if Some(id) == self.node_id_low {\n                 self.span_low = Some(sp)\n@@ -2255,19 +2255,19 @@ impl<'tcx> MutVarsDelegate {\n \n \n impl<'tcx> Delegate<'tcx> for MutVarsDelegate {\n-    fn consume(&mut self, _: NodeId, _: Span, _: cmt<'tcx>, _: ConsumeMode) {}\n+    fn consume(&mut self, _: NodeId, _: Span, _: &cmt_<'tcx>, _: ConsumeMode) {}\n \n-    fn matched_pat(&mut self, _: &Pat, _: cmt<'tcx>, _: MatchMode) {}\n+    fn matched_pat(&mut self, _: &Pat, _: &cmt_<'tcx>, _: MatchMode) {}\n \n-    fn consume_pat(&mut self, _: &Pat, _: cmt<'tcx>, _: ConsumeMode) {}\n+    fn consume_pat(&mut self, _: &Pat, _: &cmt_<'tcx>, _: ConsumeMode) {}\n \n-    fn borrow(&mut self, _: NodeId, _: Span, cmt: cmt<'tcx>, _: ty::Region, bk: ty::BorrowKind, _: LoanCause) {\n+    fn borrow(&mut self, _: NodeId, _: Span, cmt: &cmt_<'tcx>, _: ty::Region, bk: ty::BorrowKind, _: LoanCause) {\n         if let ty::BorrowKind::MutBorrow = bk {\n             self.update(&cmt.cat)\n         }\n     }\n \n-    fn mutate(&mut self, _: NodeId, _: Span, cmt: cmt<'tcx>, _: MutateMode) {\n+    fn mutate(&mut self, _: NodeId, _: Span, cmt: &cmt_<'tcx>, _: MutateMode) {\n         self.update(&cmt.cat)\n     }\n "}, {"sha": "d2836ffc2d6d31bcbc060fc9b6ef09829cfff710", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=1477f348582ee6a55ecb9fc00e1cd5c14f5c3c90", "patch": "@@ -308,15 +308,15 @@ impl<'a, 'tcx> MovedVariablesCtxt<'a, 'tcx> {\n         }\n     }\n \n-    fn move_common(&mut self, _consume_id: NodeId, _span: Span, cmt: mc::cmt<'tcx>) {\n+    fn move_common(&mut self, _consume_id: NodeId, _span: Span, cmt: &mc::cmt_<'tcx>) {\n         let cmt = unwrap_downcast_or_interior(cmt);\n \n         if let mc::Categorization::Local(vid) = cmt.cat {\n             self.moved_vars.insert(vid);\n         }\n     }\n \n-    fn non_moving_pat(&mut self, matched_pat: &Pat, cmt: mc::cmt<'tcx>) {\n+    fn non_moving_pat(&mut self, matched_pat: &Pat, cmt: &mc::cmt_<'tcx>) {\n         let cmt = unwrap_downcast_or_interior(cmt);\n \n         if let mc::Categorization::Local(vid) = cmt.cat {\n@@ -367,41 +367,41 @@ impl<'a, 'tcx> MovedVariablesCtxt<'a, 'tcx> {\n }\n \n impl<'a, 'tcx> euv::Delegate<'tcx> for MovedVariablesCtxt<'a, 'tcx> {\n-    fn consume(&mut self, consume_id: NodeId, consume_span: Span, cmt: mc::cmt<'tcx>, mode: euv::ConsumeMode) {\n+    fn consume(&mut self, consume_id: NodeId, consume_span: Span, cmt: &mc::cmt_<'tcx>, mode: euv::ConsumeMode) {\n         if let euv::ConsumeMode::Move(_) = mode {\n             self.move_common(consume_id, consume_span, cmt);\n         }\n     }\n \n-    fn matched_pat(&mut self, matched_pat: &Pat, cmt: mc::cmt<'tcx>, mode: euv::MatchMode) {\n+    fn matched_pat(&mut self, matched_pat: &Pat, cmt: &mc::cmt_<'tcx>, mode: euv::MatchMode) {\n         if let euv::MatchMode::MovingMatch = mode {\n             self.move_common(matched_pat.id, matched_pat.span, cmt);\n         } else {\n             self.non_moving_pat(matched_pat, cmt);\n         }\n     }\n \n-    fn consume_pat(&mut self, consume_pat: &Pat, cmt: mc::cmt<'tcx>, mode: euv::ConsumeMode) {\n+    fn consume_pat(&mut self, consume_pat: &Pat, cmt: &mc::cmt_<'tcx>, mode: euv::ConsumeMode) {\n         if let euv::ConsumeMode::Move(_) = mode {\n             self.move_common(consume_pat.id, consume_pat.span, cmt);\n         }\n     }\n \n-    fn borrow(&mut self, _: NodeId, _: Span, _: mc::cmt<'tcx>, _: ty::Region, _: ty::BorrowKind, _: euv::LoanCause) {}\n+    fn borrow(&mut self, _: NodeId, _: Span, _: &mc::cmt_<'tcx>, _: ty::Region, _: ty::BorrowKind, _: euv::LoanCause) {}\n \n-    fn mutate(&mut self, _: NodeId, _: Span, _: mc::cmt<'tcx>, _: euv::MutateMode) {}\n+    fn mutate(&mut self, _: NodeId, _: Span, _: &mc::cmt_<'tcx>, _: euv::MutateMode) {}\n \n     fn decl_without_init(&mut self, _: NodeId, _: Span) {}\n }\n \n \n-fn unwrap_downcast_or_interior(mut cmt: mc::cmt) -> mc::cmt {\n+fn unwrap_downcast_or_interior<'a, 'tcx>(mut cmt: &'a mc::cmt_<'tcx>) -> mc::cmt_<'tcx> {\n     loop {\n-        match cmt.cat.clone() {\n-            mc::Categorization::Downcast(c, _) | mc::Categorization::Interior(c, _) => {\n+        match cmt.cat {\n+            mc::Categorization::Downcast(ref c, _) | mc::Categorization::Interior(ref c, _) => {\n                 cmt = c;\n             },\n-            _ => return cmt,\n+            _ => return (*cmt).clone(),\n         }\n-    }\n+    };\n }"}]}