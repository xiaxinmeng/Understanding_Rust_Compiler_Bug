{"sha": "33d351972ad9c43bc30e87edd2765de9a4898629", "node_id": "C_kwDOAAsO6NoAKDMzZDM1MTk3MmFkOWM0M2JjMzBlODdlZGQyNzY1ZGU5YTQ4OTg2Mjk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-03T14:20:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-03T14:20:32Z"}, "message": "Auto merge of #102610 - dawnofmidnight:git-commit-hash, r=Mark-Simulacrum\n\nre-add git-commit-hash file to tarballs\n\nrust-lang/rust#100557 removed the `git-commit-hash` file and replaced it with `git-commit-info`. However, build-manifest relies on the `git-commit-hash` file being present, so this adds it back.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "d5e59cc94b920c030ada12d533f3dd180f891978", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d5e59cc94b920c030ada12d533f3dd180f891978"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33d351972ad9c43bc30e87edd2765de9a4898629", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33d351972ad9c43bc30e87edd2765de9a4898629", "html_url": "https://github.com/rust-lang/rust/commit/33d351972ad9c43bc30e87edd2765de9a4898629", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33d351972ad9c43bc30e87edd2765de9a4898629/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f47e9af824a2c13873af6b898f2d65a36d029466", "url": "https://api.github.com/repos/rust-lang/rust/commits/f47e9af824a2c13873af6b898f2d65a36d029466", "html_url": "https://github.com/rust-lang/rust/commit/f47e9af824a2c13873af6b898f2d65a36d029466"}, {"sha": "5c908c642b799ca8d7bdc774eaed5caad3027215", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c908c642b799ca8d7bdc774eaed5caad3027215", "html_url": "https://github.com/rust-lang/rust/commit/5c908c642b799ca8d7bdc774eaed5caad3027215"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "258352a21a4ad76a2bc4582b4ed5dba919b64700", "filename": "src/bootstrap/channel.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Fchannel.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Fchannel.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fchannel.rs?ref=33d351972ad9c43bc30e87edd2765de9a4898629", "patch": "@@ -150,3 +150,8 @@ pub fn write_commit_info_file(root: &Path, info: &Info) {\n     let commit_info = format!(\"{}\\n{}\\n{}\\n\", info.sha, info.short_sha, info.commit_date);\n     t!(fs::write(root.join(\"git-commit-info\"), &commit_info));\n }\n+\n+/// Write the commit hash to the `git-commit-hash` file given the project root.\n+pub fn write_commit_hash_file(root: &Path, sha: &str) {\n+    t!(fs::write(root.join(\"git-commit-hash\"), sha));\n+}"}, {"sha": "de945398c58b6d9d45407a3b92e6f1111a6bdf92", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=33d351972ad9c43bc30e87edd2765de9a4898629", "patch": "@@ -920,6 +920,7 @@ impl Step for PlainSourceTarball {\n         // Create the version file\n         builder.create(&plain_dst_src.join(\"version\"), &builder.rust_version());\n         if let Some(info) = builder.rust_info.info() {\n+            channel::write_commit_hash_file(&plain_dst_src, &info.sha);\n             channel::write_commit_info_file(&plain_dst_src, info);\n         }\n "}, {"sha": "d999b6c150333617352b7995fd2c16b1420ed236", "filename": "src/bootstrap/tarball.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Ftarball.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33d351972ad9c43bc30e87edd2765de9a4898629/src%2Fbootstrap%2Ftarball.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftarball.rs?ref=33d351972ad9c43bc30e87edd2765de9a4898629", "patch": "@@ -299,6 +299,7 @@ impl<'a> Tarball<'a> {\n         t!(std::fs::create_dir_all(&self.overlay_dir));\n         self.builder.create(&self.overlay_dir.join(\"version\"), &self.overlay.version(self.builder));\n         if let Some(info) = self.builder.rust_info.info() {\n+            channel::write_commit_hash_file(&self.overlay_dir, &info.sha);\n             channel::write_commit_info_file(&self.overlay_dir, info);\n         }\n         for file in self.overlay.legal_and_readme() {"}]}