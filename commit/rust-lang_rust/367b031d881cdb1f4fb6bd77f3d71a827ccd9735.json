{"sha": "367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2N2IwMzFkODgxY2RiMWY0ZmI2YmQ3N2YzZDcxYTgyN2NjZDk3MzU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-06-07T14:38:29Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-06-07T14:40:30Z"}, "message": "Clarify when we run steps with ONLY_HOSTS", "tree": {"sha": "d49bd4854552991dc9a63ec73107790426986cf9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d49bd4854552991dc9a63ec73107790426986cf9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "html_url": "https://github.com/rust-lang/rust/commit/367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/367b031d881cdb1f4fb6bd77f3d71a827ccd9735/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1c60d292e2dd2deff7084208274f9a02f750d43", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1c60d292e2dd2deff7084208274f9a02f750d43", "html_url": "https://github.com/rust-lang/rust/commit/c1c60d292e2dd2deff7084208274f9a02f750d43"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "2281a45e014a9cb0d89ddb4004bc8ae01c274076", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/367b031d881cdb1f4fb6bd77f3d71a827ccd9735/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/367b031d881cdb1f4fb6bd77f3d71a827ccd9735/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "patch": "@@ -59,7 +59,7 @@ pub trait Step: 'static + Clone + Debug + PartialEq + Eq + Hash {\n \n     const DEFAULT: bool = false;\n \n-    /// Run this rule for all hosts without cross compiling.\n+    /// If true, then this rule should be skipped if --target was specified, but --host was not\n     const ONLY_HOSTS: bool = false;\n \n     /// Primary function to execute this rule. Can call `builder.ensure()`\n@@ -163,7 +163,7 @@ impl StepDescription {\n \n         // Determine the targets participating in this rule.\n         let targets = if self.only_hosts {\n-            if !builder.config.run_host_only {\n+            if builder.config.skip_only_host_steps {\n                 return; // don't run anything\n             } else {\n                 &builder.hosts\n@@ -1338,7 +1338,7 @@ mod __test {\n         let mut config = Config::default_opts();\n         // don't save toolstates\n         config.save_toolstates = None;\n-        config.run_host_only = true;\n+        config.skip_only_host_steps = false;\n         config.dry_run = true;\n         // try to avoid spurious failures in dist where we create/delete each others file\n         let dir = config.out.join(\"tmp-rustbuild-tests\").join(\n@@ -1583,7 +1583,7 @@ mod __test {\n     #[test]\n     fn dist_with_target_flag() {\n         let mut config = configure(&[\"B\"], &[\"C\"]);\n-        config.run_host_only = false; // as-if --target=C was passed\n+        config.skip_only_host_steps = true; // as-if --target=C was passed\n         let build = Build::new(config);\n         let mut builder = Builder::new(&build);\n         builder.run_step_descriptions(&Builder::get_step_descriptions(Kind::Dist), &[]);\n@@ -1831,7 +1831,7 @@ mod __test {\n     #[test]\n     fn build_with_target_flag() {\n         let mut config = configure(&[\"B\"], &[\"C\"]);\n-        config.run_host_only = false;\n+        config.skip_only_host_steps = true;\n         let build = Build::new(config);\n         let mut builder = Builder::new(&build);\n         builder.run_step_descriptions(&Builder::get_step_descriptions(Kind::Build), &[]);"}, {"sha": "66f504ea924e9b880b525ea47409d29db868286e", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/367b031d881cdb1f4fb6bd77f3d71a827ccd9735/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/367b031d881cdb1f4fb6bd77f3d71a827ccd9735/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=367b031d881cdb1f4fb6bd77f3d71a827ccd9735", "patch": "@@ -51,7 +51,7 @@ pub struct Config {\n     pub test_compare_mode: bool,\n     pub llvm_libunwind: bool,\n \n-    pub run_host_only: bool,\n+    pub skip_only_host_steps: bool,\n \n     pub on_fail: Option<String>,\n     pub stage: Option<u32>,\n@@ -416,7 +416,9 @@ impl Config {\n         }\n \n         // If --target was specified but --host wasn't specified, don't run any host-only tests.\n-        config.run_host_only = !(flags.host.is_empty() && !flags.target.is_empty());\n+        let has_hosts = !flags.host.is_empty();\n+        let has_targets = !flags.target.is_empty();\n+        config.skip_only_host_steps = !has_hosts && has_targets;\n \n         let toml = file.map(|file| {\n             let contents = t!(fs::read_to_string(&file));"}]}