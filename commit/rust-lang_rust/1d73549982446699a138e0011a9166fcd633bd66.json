{"sha": "1d73549982446699a138e0011a9166fcd633bd66", "node_id": "C_kwDOAAsO6NoAKDFkNzM1NDk5ODI0NDY2OTlhMTM4ZTAwMTFhOTE2NmZjZDYzM2JkNjY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-04-26T16:51:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-26T16:51:42Z"}, "message": "Rollup merge of #110798 - ozkanonur:rustdoc-unused-extern-crates, r=jyn514\n\npass `unused_extern_crates` in `librustdoc::doctest::make_test`\n\nblocker for https://github.com/rust-lang/rust/pull/106621", "tree": {"sha": "a0688212d3866f14ed23d8cd1993faf8da8988ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0688212d3866f14ed23d8cd1993faf8da8988ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d73549982446699a138e0011a9166fcd633bd66", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkSVaeCRBK7hj4Ov3rIwAAxm8IABHWCjt3D7Nu1HHHJSfb9cEj\nWqE6MscQ3mcCnSiJey3XI4h4eVlKiDmxettQaQQZaBG5qORclDXtxedIk40l7fDm\nGb+tLgBb0C9dVQvP2eys8RPdWUVRKNEOLS/iCGVZpER+aeDBHPfT4QHXhkYK1hgv\nBOICrUj5nfstgkQA+bAWHgiUUFTD1ZQX4e/cSb2L0aOACElb+jXOk4NdLIAZC9I8\nnG9o48PF7IksLyD2q1XbE84clHxTPzGU4N91OziVkcc6o2Snc7o6UQ1L3tmIlFTD\nZGug67oe5b9UZg2aU7VhIpo3UTL24BvNKXeIVQfKcvhA9u8CSwEQCBBYBGhF/Wk=\n=FuaJ\n-----END PGP SIGNATURE-----\n", "payload": "tree a0688212d3866f14ed23d8cd1993faf8da8988ef\nparent 66a5ac0199095359f68e20e490ef144842c31a01\nparent f56b6d0b12009fb1e124de0a5ccdf956816225a6\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1682527902 +0200\ncommitter GitHub <noreply@github.com> 1682527902 +0200\n\nRollup merge of #110798 - ozkanonur:rustdoc-unused-extern-crates, r=jyn514\n\npass `unused_extern_crates` in `librustdoc::doctest::make_test`\n\nblocker for https://github.com/rust-lang/rust/pull/106621\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d73549982446699a138e0011a9166fcd633bd66", "html_url": "https://github.com/rust-lang/rust/commit/1d73549982446699a138e0011a9166fcd633bd66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d73549982446699a138e0011a9166fcd633bd66/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66a5ac0199095359f68e20e490ef144842c31a01", "url": "https://api.github.com/repos/rust-lang/rust/commits/66a5ac0199095359f68e20e490ef144842c31a01", "html_url": "https://github.com/rust-lang/rust/commit/66a5ac0199095359f68e20e490ef144842c31a01"}, {"sha": "f56b6d0b12009fb1e124de0a5ccdf956816225a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/f56b6d0b12009fb1e124de0a5ccdf956816225a6", "html_url": "https://github.com/rust-lang/rust/commit/f56b6d0b12009fb1e124de0a5ccdf956816225a6"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "d71098ad89da06f70b8ca05eb41dc32ab1e0e3db", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1d73549982446699a138e0011a9166fcd633bd66/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d73549982446699a138e0011a9166fcd633bd66/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=1d73549982446699a138e0011a9166fcd633bd66", "patch": "@@ -679,6 +679,10 @@ pub(crate) fn make_test(\n             // parse the source, but only has false positives, not false\n             // negatives.\n             if s.contains(crate_name) {\n+                // rustdoc implicitly inserts an `extern crate` item for the own crate\n+                // which may be unused, so we need to allow the lint.\n+                prog.push_str(&format!(\"#[allow(unused_extern_crates)]\\n\"));\n+\n                 prog.push_str(&format!(\"extern crate r#{crate_name};\\n\"));\n                 line_offset += 1;\n             }"}, {"sha": "a30fe28f94f99a674579e1a1b7e9dc395a5c7cdf", "filename": "src/librustdoc/doctest/tests.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1d73549982446699a138e0011a9166fcd633bd66/src%2Flibrustdoc%2Fdoctest%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d73549982446699a138e0011a9166fcd633bd66/src%2Flibrustdoc%2Fdoctest%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest%2Ftests.rs?ref=1d73549982446699a138e0011a9166fcd633bd66", "patch": "@@ -38,6 +38,7 @@ fn make_test_crate_name() {\n     let input = \"use asdf::qwop;\n assert_eq!(2+2, 4);\";\n     let expected = \"#![allow(unused)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -128,6 +129,7 @@ fn make_test_opts_attrs() {\n     let input = \"use asdf::qwop;\n assert_eq!(2+2, 4);\";\n     let expected = \"#![feature(sick_rad)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -141,6 +143,7 @@ assert_eq!(2+2, 4);\n     opts.attrs.push(\"feature(hella_dope)\".to_string());\n     let expected = \"#![feature(sick_rad)]\n #![feature(hella_dope)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -236,6 +239,7 @@ assert_eq!(asdf::foo, 4);\";\n \n     let expected = \"#![allow(unused)]\n extern crate hella_qwop;\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n assert_eq!(asdf::foo, 4);"}, {"sha": "2542ed657c1a78ed94ab56ba1889cd95b29da5f8", "filename": "tests/rustdoc/playground-arg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d73549982446699a138e0011a9166fcd633bd66/tests%2Frustdoc%2Fplayground-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d73549982446699a138e0011a9166fcd633bd66/tests%2Frustdoc%2Fplayground-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fplayground-arg.rs?ref=1d73549982446699a138e0011a9166fcd633bd66", "patch": "@@ -10,4 +10,4 @@\n pub fn dummy() {}\n \n // ensure that `extern crate foo;` was inserted into code snips automatically:\n-// @matches foo/index.html '//a[@class=\"test-arrow\"][@href=\"https://example.com/?code=%23!%5Ballow(unused)%5D%0Aextern+crate+r%23foo;%0Afn+main()+%7B%0Ause+foo::dummy;%0Adummy();%0A%7D&edition=2015\"]' \"Run\"\n+// @matches foo/index.html '//a[@class=\"test-arrow\"][@href=\"https://example.com/?code=%23!%5Ballow(unused)%5D%0A%23%5Ballow(unused_extern_crates)%5D%0Aextern+crate+r%23foo;%0Afn+main()+%7B%0Ause+foo::dummy;%0Adummy();%0A%7D&edition=2015\"]' \"Run\""}]}