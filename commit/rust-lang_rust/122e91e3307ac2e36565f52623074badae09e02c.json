{"sha": "122e91e3307ac2e36565f52623074badae09e02c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyMmU5MWUzMzA3YWMyZTM2NTY1ZjUyNjIzMDc0YmFkYWUwOWUwMmM=", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-03T09:25:27Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-09T05:21:32Z"}, "message": "do not require lang item", "tree": {"sha": "c088795e77f24da29966cd8ffea2c4c422d0bf42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c088795e77f24da29966cd8ffea2c4c422d0bf42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/122e91e3307ac2e36565f52623074badae09e02c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEQ7Fl7qPq2YcWF1dqAn35M4hird0FAmE5mdwACgkQAn35M4hi\nrd1KHxAAhmuRfqYXGZTahSQgN/jUfN3ICVPV7znKC6THTeUxypdffqWow5F49Faq\nk+4Id3boebjuG8QI/Lr0y2AaSWFpQTJEy4hbm6kMQAML94xmwugIbQNAdxT9qBXu\nQa8PdqS03J7rWUZBC1IBrw3dEsF4BPCh87HoFZE8McKm53cp9BH0iNHnQPo+wvyU\nwYdO39w6XVrCU99NtteKpcHx456sXSRF0F7KIrSlb9Mp3NL45N9qmK7NU00v468m\nfEFazEZ/6sSiCcbxpiwEktH4y/KQSyrld8sZQdX37YOTQ857pFHxWDzvZiZufVrv\n4DO1AthALIEMm/ccWA3oqps50MFMdKGbAKRi+3T2okK4rk2JHuTGNjcG0A25TGYy\nKbpyZkeN3sPlaOaAOqnAdAaf4MEHwW1MQnS+BRD9ZMWXVjjMPypHfuG1DHgFXbol\n1bKagouKJD6PWU9FIthc0TWZaCwOGjVQ+V5Y1bwwDsijtm1V8AHePF5oAaqWLlAd\nCmYlQv29S3s3t5Eem0S7tf3kJgz2JwTcDfQaxZT7KuBwRUYFjUv2hcggQ2feXocW\nb9AFCSPhrDAfqJBk+NmyoRkCQHAbaKY+FVmDOpYqxIuC5dHT2zOD2IlU3Fxkr3s0\nqcXsEx86SA0acCTGNwDGmkrZlcB0KEZhJtkXsX6dA3+7/rZk/Lk=\n=exH5\n-----END PGP SIGNATURE-----", "payload": "tree c088795e77f24da29966cd8ffea2c4c422d0bf42\nparent 82117289f2ac8623348725ae20e68b28331508a1\nauthor Deadbeef <ent3rm4n@gmail.com> 1630661127 +0000\ncommitter Deadbeef <ent3rm4n@gmail.com> 1631164892 +0000\n\ndo not require lang item\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/122e91e3307ac2e36565f52623074badae09e02c", "html_url": "https://github.com/rust-lang/rust/commit/122e91e3307ac2e36565f52623074badae09e02c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/122e91e3307ac2e36565f52623074badae09e02c/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82117289f2ac8623348725ae20e68b28331508a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/82117289f2ac8623348725ae20e68b28331508a1", "html_url": "https://github.com/rust-lang/rust/commit/82117289f2ac8623348725ae20e68b28331508a1"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "c6f786ca53890d8b8b2b93e4fbc45f949dfb04bb", "filename": "compiler/rustc_const_eval/src/transform/check_consts/qualifs.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/122e91e3307ac2e36565f52623074badae09e02c/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fqualifs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/122e91e3307ac2e36565f52623074badae09e02c/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fqualifs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fqualifs.rs?ref=122e91e3307ac2e36565f52623074badae09e02c", "patch": "@@ -112,8 +112,15 @@ impl Qualif for NeedsNonConstDrop {\n     }\n \n     fn in_any_value_of_ty(cx: &ConstCx<'_, 'tcx>, ty: Ty<'tcx>) -> bool {\n+        let drop_trait = if let Some(did) = cx.tcx.lang_items().drop_trait() {\n+            did\n+        } else {\n+            // there is no way to define a type that needs non-const drop\n+            // without having the lang item present.\n+            return false;\n+        };\n         let trait_ref = ty::TraitRef {\n-            def_id: cx.tcx.require_lang_item(hir::LangItem::Drop, None),\n+            def_id: drop_trait,\n             substs: cx.tcx.mk_substs_trait(ty, &[]),\n         };\n         let obligation = Obligation::new("}]}