{"sha": "9ba473f86f900bf5a5009bf0695b6d9618df83ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliYTQ3M2Y4NmY5MDBiZjVhNTAwOWJmMDY5NWI2ZDk2MThkZjgzY2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-24T05:36:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-24T05:36:50Z"}, "message": "auto merge of #10578 : luqmana/rust/mingw64, r=alexcrichton\n\nWith these changes I was able to cross compile for windows from a linux box. (Using the mingw-w64 package on Debian Testing).\r\n\r\nFixed a bug where the `target_family` cfg would be wrong when targeting something with a different value than the host. (i.e windows -> unix or unix -> windows).\r\n\r\nAlso, removed `LIBUV_FLAGS` in `mk/rt.mk` because of the redundancy between it and `CFG_GCCISH_CFLAGS_(target)`.\r\n\r\nAfter this we can create a snapshot and migrate to mingw64 instead of mingw32.", "tree": {"sha": "0f932b1e3733324c06e3972fa1432bf5dbd052cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f932b1e3733324c06e3972fa1432bf5dbd052cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ba473f86f900bf5a5009bf0695b6d9618df83ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ba473f86f900bf5a5009bf0695b6d9618df83ca", "html_url": "https://github.com/rust-lang/rust/commit/9ba473f86f900bf5a5009bf0695b6d9618df83ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ba473f86f900bf5a5009bf0695b6d9618df83ca/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33375a31e884043961b374ab7c654e4cd9e98527", "url": "https://api.github.com/repos/rust-lang/rust/commits/33375a31e884043961b374ab7c654e4cd9e98527", "html_url": "https://github.com/rust-lang/rust/commit/33375a31e884043961b374ab7c654e4cd9e98527"}, {"sha": "ae5a13d64321e49b8a35c120d7f2fa0d5578d8fa", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae5a13d64321e49b8a35c120d7f2fa0d5578d8fa", "html_url": "https://github.com/rust-lang/rust/commit/ae5a13d64321e49b8a35c120d7f2fa0d5578d8fa"}], "stats": {"total": 140, "additions": 89, "deletions": 51}, "files": [{"sha": "bc2536cce4834874c7b1f383c23f74cc8876daca", "filename": "mk/platform.mk", "status": "modified", "additions": 66, "deletions": 21, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/9ba473f86f900bf5a5009bf0695b6d9618df83ca/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9ba473f86f900bf5a5009bf0695b6d9618df83ca/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=9ba473f86f900bf5a5009bf0695b6d9618df83ca", "patch": "@@ -300,12 +300,14 @@ CFG_LDPATH_arm-linux-androideabi :=\n CFG_RUN_arm-linux-androideabi=\n CFG_RUN_TARG_arm-linux-androideabi=\n RUSTC_FLAGS_arm-linux-androideabi :=--android-cross-path=$(CFG_ANDROID_CROSS_PATH)\n+RUSTC_CROSS_FLAGS_arm-linux-androideabi :=--android-cross-path=$(CFG_ANDROID_CROSS_PATH)\n \n # arm-unknown-linux-gnueabihf configuration\n-CC_arm-unknown-linux-gnueabihf=arm-linux-gnueabihf-gcc\n-CXX_arm-unknown-linux-gnueabihf=arm-linux-gnueabihf-g++\n-CPP_arm-unknown-linux-gnueabihf=arm-linux-gnueabihf-gcc -E\n-AR_arm-unknown-linux-gnueabihf=arm-linux-gnueabihf-ar\n+CROSS_PREFIX_arm-unknown-linux-gnueabihf=arm-linux-gnueabihf-\n+CC_arm-unknown-linux-gnueabihf=gcc\n+CXX_arm-unknown-linux-gnueabihf=g++\n+CPP_arm-unknown-linux-gnueabihf=gcc -E\n+AR_arm-unknown-linux-gnueabihf=ar\n CFG_LIB_NAME_arm-unknown-linux-gnueabihf=lib$(1).so\n CFG_STATIC_LIB_NAME_arm-unknown-linux-gnueabihf=lib$(1).a\n CFG_LIB_GLOB_arm-unknown-linux-gnueabihf=lib$(1)-*.so\n@@ -324,15 +326,17 @@ CFG_WINDOWSY_arm-unknown-linux-gnueabihf :=\n CFG_UNIXY_arm-unknown-linux-gnueabihf := 1\n CFG_PATH_MUNGE_arm-unknown-linux-gnueabihf := true\n CFG_LDPATH_arm-unknown-linux-gnueabihf :=\n-CFG_RUN_arm-unknown-linux-gnueabihf=\n-CFG_RUN_TARG_arm-unknown-linux-gnueabihf=\n-RUSTC_FLAGS_arm-unknown-linux-gnueabihf := --linker=$(CC_arm-unknown-linux-gnueabihf)\n+CFG_RUN_arm-unknown-linux-gnueabihf=$(2)\n+CFG_RUN_TARG_arm-unknown-linux-gnueabihf=$(call CFG_RUN_arm-unknown-linux-gnueabihf,,$(2))\n+RUSTC_FLAGS_arm-unknown-linux-gnueabihf :=\n+RUSTC_CROSS_FLAGS_arm-unknown-linux-gnueabihf := --linker=$(CROSS_PREFIX_arm-unknown-linux-gnueabihf)$(CXX_arm-unknown-linux-gnueabihf)\n \n # arm-unknown-linux-gnueabi configuration\n-CC_arm-unknown-linux-gnueabi=arm-linux-gnueabi-gcc\n-CXX_arm-unknown-linux-gnueabi=arm-linux-gnueabi-g++\n-CPP_arm-unknown-linux-gnueabi=arm-linux-gnueabi-gcc -E\n-AR_arm-unknown-linux-gnueabi=arm-linux-gnueabi-ar\n+CROSS_PREFIX_arm-unknown-linux-gnueabi=arm-linux-gnueabi-\n+CC_arm-unknown-linux-gnueabi=gcc\n+CXX_arm-unknown-linux-gnueabi=g++\n+CPP_arm-unknown-linux-gnueabi=gcc -E\n+AR_arm-unknown-linux-gnueabi=ar\n CFG_LIB_NAME_arm-unknown-linux-gnueabi=lib$(1).so\n CFG_STATIC_LIB_NAME_arm-unknown-linux-gnueabi=lib$(1).a\n CFG_LIB_GLOB_arm-unknown-linux-gnueabi=lib$(1)-*.so\n@@ -351,9 +355,10 @@ CFG_WINDOWSY_arm-unknown-linux-gnueabi :=\n CFG_UNIXY_arm-unknown-linux-gnueabi := 1\n CFG_PATH_MUNGE_arm-unknown-linux-gnueabi := true\n CFG_LDPATH_arm-unknown-linux-gnueabi :=\n-CFG_RUN_arm-unknown-linux-gnueabi=\n-CFG_RUN_TARG_arm-unknown-linux-gnueabi=\n-RUSTC_FLAGS_arm-unknown-linux-gnueabi := --linker=$(CC_arm-unknown-linux-gnueabi)\n+CFG_RUN_arm-unknown-linux-gnueabi=$(2)\n+CFG_RUN_TARG_arm-unknown-linux-gnueabi=$(call CFG_RUN_arm-unknown-linux-gnueabi,,$(2))\n+RUSTC_FLAGS_arm-unknown-linux-gnueabi :=\n+RUSTC_CROSS_FLAGS_arm-unknown-linux-gnueabi := --linker=$(CROSS_PREFIX_arm-unknown-linux-gnueabi)$(CXX_arm-unknown-linux-gnueabi)\n \n # mips-unknown-linux-gnu configuration\n CC_mips-unknown-linux-gnu=mips-linux-gnu-gcc\n@@ -399,7 +404,7 @@ CFG_GCCISH_PRE_LIB_FLAGS_i686-pc-mingw32 :=\n CFG_GCCISH_POST_LIB_FLAGS_i686-pc-mingw32 :=\n CFG_DEF_SUFFIX_i686-pc-mingw32 := .mingw32.def\n CFG_INSTALL_NAME_i686-pc-mingw32 =\n-CFG_LIBUV_LINK_FLAGS_i686-pc-mingw32 := -lWs2_32 -lpsapi -liphlpapi\n+CFG_LIBUV_LINK_FLAGS_i686-pc-mingw32 := -lws2_32 -lpsapi -liphlpapi\n CFG_LLVM_BUILD_ENV_i686-pc-mingw32 := CPATH=$(CFG_SRC_DIR)src/etc/mingw-fix-include\n CFG_EXE_SUFFIX_i686-pc-mingw32 := .exe\n CFG_WINDOWSY_i686-pc-mingw32 := 1\n@@ -437,31 +442,61 @@ CFG_LDPATH_i586-mingw32msvc :=\n CFG_RUN_i586-mingw32msvc=\n CFG_RUN_TARG_i586-mingw32msvc=\n \n+# i686-w64-mingw32 configuration\n+CROSS_PREFIX_i686-w64-mingw32=i686-w64-mingw32-\n+CC_i686-w64-mingw32=gcc\n+CXX_i686-w64-mingw32=g++\n+CPP_i686-w64-mingw32=gcc -E\n+AR_i686-w64-mingw32=ar\n+CFG_LIB_NAME_i686-w64-mingw32=$(1).dll\n+CFG_STATIC_LIB_NAME_i686-w64-mingw32=$(1).lib\n+CFG_LIB_GLOB_i686-w64-mingw32=$(1)-*.dll\n+CFG_LIB_DSYM_GLOB_i686-w64-mingw32=$(1)-*.dylib.dSYM\n+CFG_GCCISH_CFLAGS_i686-w64-mingw32 := -Wall -Werror -g -m32 -D_WIN32_WINNT=0x0600\n+CFG_GCCISH_CXXFLAGS_i686-w64-mingw32 := -fno-rtti\n+CFG_GCCISH_LINK_FLAGS_i686-w64-mingw32 := -shared -g -m32\n+CFG_GCCISH_DEF_FLAG_i686-w64-mingw32 :=\n+CFG_GCCISH_PRE_LIB_FLAGS_i686-w64-mingw32 :=\n+CFG_GCCISH_POST_LIB_FLAGS_i686-w64-mingw32 :=\n+CFG_DEF_SUFFIX_i686-w64-mingw32 := .mingw32.def\n+CFG_INSTALL_NAME_i686-w64-mingw32 =\n+CFG_LIBUV_LINK_FLAGS_i686-w64-mingw32 := -lws2_32 -lpsapi -liphlpapi\n+CFG_EXE_SUFFIX_i686-w64-mingw32 := .exe\n+CFG_WINDOWSY_i686-w64-mingw32 := 1\n+CFG_UNIXY_i686-w64-mingw32 :=\n+CFG_PATH_MUNGE_i686-w64-mingw32 :=\n+CFG_LDPATH_i686-w64-mingw32 :=$(CFG_LDPATH_i686-w64-mingw32):$(PATH)\n+CFG_RUN_i686-w64-mingw32=PATH=\"$(CFG_LDPATH_i686-w64-mingw32):$(1)\" $(2)\n+CFG_RUN_TARG_i686-w64-mingw32=$(call CFG_RUN_i686-w64-mingw32,$(HLIB$(1)_H_$(CFG_BUILD)),$(2))\n+RUSTC_CROSS_FLAGS_i686-w64-mingw32 := --linker=$(CROSS_PREFIX_i686-w64-mingw32)$(CXX_i686-w64-mingw32)\n+\n # x86_64-w64-mingw32 configuration\n-CC_x86_64-w64-mingw32=$(CC)\n-CXX_x86_64-w64-mingw32=$(CXX)\n-CPP_x86_64-w64-mingw32=$(CPP)\n-AR_x86_64-w64-mingw32=$(AR)\n+CROSS_PREFIX_x86_64-w64-mingw32=x86_64-w64-mingw32-\n+CC_x86_64-w64-mingw32=gcc\n+CXX_x86_64-w64-mingw32=g++\n+CPP_x86_64-w64-mingw32=gcc -E\n+AR_x86_64-w64-mingw32=ar\n CFG_LIB_NAME_x86_64-w64-mingw32=$(1).dll\n CFG_STATIC_LIB_NAME_x86_64-w64-mingw32=$(1).lib\n CFG_LIB_GLOB_x86_64-w64-mingw32=$(1)-*.dll\n CFG_LIB_DSYM_GLOB_x86_64-w64-mingw32=$(1)-*.dylib.dSYM\n CFG_GCCISH_CFLAGS_x86_64-w64-mingw32 := -Wall -Werror -g -m64 -D_WIN32_WINNT=0x0600\n CFG_GCCISH_CXXFLAGS_x86_64-w64-mingw32 := -fno-rtti\n-CFG_GCCISH_LINK_FLAGS_x86_64-w64-mingw32 := -shared -fPIC -g -m64\n+CFG_GCCISH_LINK_FLAGS_x86_64-w64-mingw32 := -shared -g -m64\n CFG_GCCISH_DEF_FLAG_x86_64-w64-mingw32 :=\n CFG_GCCISH_PRE_LIB_FLAGS_x86_64-w64-mingw32 :=\n CFG_GCCISH_POST_LIB_FLAGS_x86_64-w64-mingw32 :=\n CFG_DEF_SUFFIX_x86_64-w64-mingw32 := .mingw32.def\n CFG_INSTALL_NAME_x86_64-w64-mingw32 =\n-CFG_LIBUV_LINK_FLAGS_x86_64-w64-mingw32 := -lWs2_32 -lpsapi -liphlpapi\n+CFG_LIBUV_LINK_FLAGS_x86_64-w64-mingw32 := -lws2_32 -lpsapi -liphlpapi\n CFG_EXE_SUFFIX_x86_64-w64-mingw32 := .exe\n CFG_WINDOWSY_x86_64-w64-mingw32 := 1\n CFG_UNIXY_x86_64-w64-mingw32 :=\n CFG_PATH_MUNGE_x86_64-w64-mingw32 :=\n CFG_LDPATH_x86_64-w64-mingw32 :=$(CFG_LDPATH_x86_64-w64-mingw32):$(PATH)\n CFG_RUN_x86_64-w64-mingw32=PATH=\"$(CFG_LDPATH_x86_64-w64-mingw32):$(1)\" $(2)\n CFG_RUN_TARG_x86_64-w64-mingw32=$(call CFG_RUN_x86_64-w64-mingw32,$(HLIB$(1)_H_$(CFG_BUILD)),$(2))\n+RUSTC_CROSS_FLAGS_x86_64-w64-mingw32 := --linker=$(CROSS_PREFIX_x86_64-w64-mingw32)$(CXX_x86_64-w64-mingw32)\n \n # x86_64-unknown-freebsd configuration\n CC_x86_64-unknown-freebsd=$(CC)\n@@ -499,6 +534,16 @@ ifdef CFG_CCACHE_BASEDIR\n endif\n \n define CFG_MAKE_TOOLCHAIN\n+  # Prepend the tools with their prefix if cross compiling\n+  ifneq ($(CFG_BUILD),$(1))\n+\tCC_$(1)=$(CROSS_PREFIX_$(1))$(CC_$(1))\n+\tCXX_$(1)=$(CROSS_PREFIX_$(1))$(CXX_$(1))\n+\tCPP_$(1)=$(CROSS_PREFIX_$(1))$(CPP_$(1))\n+\tAR_$(1)=$(CROSS_PREFIX_$(1))$(AR_$(1))\n+\n+\tRUSTC_FLAGS_$(1)=$(RUSTC_CROSS_FLAGS_$(1))\n+  endif\n+\n   CFG_COMPILE_C_$(1) = $$(CC_$(1))  \\\n         $$(CFG_GCCISH_CFLAGS)      \\\n         $$(CFG_GCCISH_CFLAGS_$(1)) \\"}, {"sha": "cc22d5781a6a2dd8e8013e9f63120726667f340c", "filename": "mk/rt.mk", "status": "modified", "additions": 8, "deletions": 20, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/9ba473f86f900bf5a5009bf0695b6d9618df83ca/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9ba473f86f900bf5a5009bf0695b6d9618df83ca/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=9ba473f86f900bf5a5009bf0695b6d9618df83ca", "patch": "@@ -23,23 +23,6 @@\n # fit the experimental data (i.e., I was able to get the system\n # working under these assumptions).\n \n-# Hack for passing flags into LIBUV, see below.\n-LIBUV_FLAGS_i386 = -m32 -fPIC -I$(S)src/etc/mingw-fix-include\n-LIBUV_FLAGS_x86_64 = -m64 -fPIC\n-ifeq ($(OSTYPE_$(1)), linux-androideabi)\n-LIBUV_FLAGS_arm = -fPIC -DANDROID -std=gnu99\n-else ifeq ($(OSTYPE_$(1)), apple-darwin)\n-  ifeq ($(HOST_$(1)), arm)\n-    IOS_SDK := $(shell xcrun --show-sdk-path -sdk iphoneos 2>/dev/null)\n-    LIBUV_FLAGS_arm := -fPIC -std=gnu99 -I$(IOS_SDK)/usr/include -I$(IOS_SDK)/usr/include/c++/4.2.1\n-  else\n-    LIBUV_FLAGS_arm := -fPIC -std=gnu99\n-  endif\n-else\n-LIBUV_FLAGS_arm = -fPIC -std=gnu99\n-endif\n-LIBUV_FLAGS_mips = -fPIC -mips32r2 -msoft-float -mabi=32\n-\n # when we're doing a snapshot build, we intentionally degrade as many\n # features in libuv and the runtime as possible, to ease portability.\n \n@@ -209,6 +192,9 @@ LIBUV_LIB_$(1) := $$(RT_OUTPUT_DIR_$(1))/libuv/$$(LIBUV_NAME_$(1))\n \n LIBUV_MAKEFILE_$(1) := $$(CFG_BUILD_DIR)$$(RT_OUTPUT_DIR_$(1))/libuv/Makefile\n \n+# libuv triggers a few warnings on some platforms\n+LIBUV_CFLAGS_$(1) := $(subst -Werror,,$(CFG_GCCISH_CFLAGS_$(1)))\n+\n $$(LIBUV_MAKEFILE_$(1)): $$(LIBUV_DEPS)\n \t(cd $(S)src/libuv/ && \\\n \t $$(CFG_PYTHON) ./gyp_uv.py -f make -Dtarget_arch=$$(LIBUV_ARCH_$(1)) \\\n@@ -222,15 +208,17 @@ $$(LIBUV_MAKEFILE_$(1)): $$(LIBUV_DEPS)\n ifdef CFG_WINDOWSY_$(1)\n $$(LIBUV_LIB_$(1)): $$(LIBUV_DEPS)\n \t$$(Q)$$(MAKE) -C $$(S)src/libuv -f Makefile.mingw \\\n-\t\tCC=\"$$(CC) $$(CFG_GCCISH_CFLAGS) $$(LIBUV_FLAGS_$$(HOST_$(1))) $$(SNAP_DEFINES)\" \\\n+\t\tLDFLAGS=\"$$(CFG_GCCISH_LINK_FLAGS_$(1))\" \\\n+\t\tCC=\"$$(CC_$(1)) $$(LIBUV_CFLAGS_$(1)) $$(SNAP_DEFINES)\" \\\n+\t\tCXX=\"$$(CXX_$(1))\" \\\n \t\tAR=\"$$(AR_$(1))\" \\\n \t\tV=$$(VERBOSE)\n \t$$(Q)cp $$(S)src/libuv/libuv.a $$@\n else\n $$(LIBUV_LIB_$(1)): $$(LIBUV_DEPS) $$(LIBUV_MAKEFILE_$(1))\n \t$$(Q)$$(MAKE) -C $$(@D) \\\n-\t\tCFLAGS=\"$$(CFG_GCCISH_CFLAGS) $$(LIBUV_FLAGS_$$(HOST_$(1))) $$(SNAP_DEFINES)\" \\\n-\t\tLDFLAGS=\"$$(CFG_GCCISH_LINK_FLAGS) $$(LIBUV_FLAGS_$$(HOST_$(1)))\" \\\n+\t\tCFLAGS=\"$$(LIBUV_CFLAGS_$(1)) $$(SNAP_DEFINES)\" \\\n+\t\tLDFLAGS=\"$$(CFG_GCCISH_LINK_FLAGS_$(1))\" \\\n \t\tCC=\"$$(CC_$(1))\" \\\n \t\tCXX=\"$$(CXX_$(1))\" \\\n \t\tAR=\"$$(AR_$(1))\" \\"}, {"sha": "0a2894acb665708ec49c870043f1b896cb2e760f", "filename": "src/librustc/driver/driver.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Flibrustc%2Fdriver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Flibrustc%2Fdriver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fdriver.rs?ref=9ba473f86f900bf5a5009bf0695b6d9618df83ca", "patch": "@@ -85,11 +85,16 @@ pub fn default_configuration(sess: Session) ->\n         abi::Mips =>   (@\"big\",    @\"mips\",   @\"32\")\n     };\n \n+    let fam = match sess.targ_cfg.os {\n+        abi::OsWin32 => @\"windows\",\n+        _ => @\"unix\"\n+    };\n+\n     let mk = attr::mk_name_value_item_str;\n     return ~[ // Target bindings.\n-         attr::mk_word_item(os::FAMILY.to_managed()),\n+         attr::mk_word_item(fam),\n          mk(@\"target_os\", tos),\n-         mk(@\"target_family\", os::FAMILY.to_managed()),\n+         mk(@\"target_family\", fam),\n          mk(@\"target_arch\", arch),\n          mk(@\"target_endian\", end),\n          mk(@\"target_word_size\", wordsz),"}, {"sha": "3917efe9ca823966c48b0469faa9b2e9b0ba8511", "filename": "src/librustuv/uvll.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Flibrustuv%2Fuvll.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Flibrustuv%2Fuvll.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustuv%2Fuvll.rs?ref=9ba473f86f900bf5a5009bf0695b6d9618df83ca", "patch": "@@ -724,5 +724,5 @@ extern {\n extern {}\n \n #[cfg(target_os = \"win32\")]\n-#[link_args = \"-lWs2_32 -lpsapi -liphlpapi\"]\n+#[link_args = \"-lws2_32 -lpsapi -liphlpapi\"]\n extern {}"}, {"sha": "9740fdea82c962081437896c939ab722a54b6697", "filename": "src/rt/rust_upcall.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Frt%2Frust_upcall.c", "raw_url": "https://github.com/rust-lang/rust/raw/9ba473f86f900bf5a5009bf0695b6d9618df83ca/src%2Frt%2Frust_upcall.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.c?ref=9ba473f86f900bf5a5009bf0695b6d9618df83ca", "patch": "@@ -25,14 +25,14 @@ typedef int _Unwind_Action;\n struct _Unwind_Context;\n struct _Unwind_Exception;\n \n-#ifdef __SEH__\n-#  define PERSONALITY_FUNC __gxx_personality_seh0\n+#if __USING_SJLJ_EXCEPTIONS__\n+#   define PERSONALITY_FUNC __gxx_personality_sj0\n #else\n-#  ifdef __USING_SJLJ_EXCEPTIONS__\n-#    define PERSONALITY_FUNC __gxx_personality_sjlj\n-#  else\n-#    define PERSONALITY_FUNC __gxx_personality_v0\n-#  endif\n+#   ifdef __SEH__\n+#       define PERSONALITY_FUNC __gxx_personality_seh0\n+#   else\n+#       define PERSONALITY_FUNC __gxx_personality_v0\n+#   endif\n #endif\n \n _Unwind_Reason_Code"}]}