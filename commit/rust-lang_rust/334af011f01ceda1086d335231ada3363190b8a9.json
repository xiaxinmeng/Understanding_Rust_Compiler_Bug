{"sha": "334af011f01ceda1086d335231ada3363190b8a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzNGFmMDExZjAxY2VkYTEwODZkMzM1MjMxYWRhMzM2MzE5MGI4YTk=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-02-14T11:34:18Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-02-15T01:45:54Z"}, "message": "mk: Improve build system help commands", "tree": {"sha": "370156b5d57de914336dac6591160f675f930bb9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/370156b5d57de914336dac6591160f675f930bb9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/334af011f01ceda1086d335231ada3363190b8a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/334af011f01ceda1086d335231ada3363190b8a9", "html_url": "https://github.com/rust-lang/rust/commit/334af011f01ceda1086d335231ada3363190b8a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/334af011f01ceda1086d335231ada3363190b8a9/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab17f445fe999bf7edf22d09b16ac7b7fd1155be", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab17f445fe999bf7edf22d09b16ac7b7fd1155be", "html_url": "https://github.com/rust-lang/rust/commit/ab17f445fe999bf7edf22d09b16ac7b7fd1155be"}], "stats": {"total": 140, "additions": 103, "deletions": 37}, "files": [{"sha": "f83ddf76eefa4454d0b5e4dae4b3b11b78165b7b", "filename": "Makefile.in", "status": "modified", "additions": 82, "deletions": 34, "changes": 116, "blob_url": "https://github.com/rust-lang/rust/blob/334af011f01ceda1086d335231ada3363190b8a9/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/334af011f01ceda1086d335231ada3363190b8a9/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=334af011f01ceda1086d335231ada3363190b8a9", "patch": "@@ -8,55 +8,100 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n-# <help>\n+# <help> \\(^o^)/\n #\n-# # The Rust Build System\n+# Greetings, adventurer! The Rust Build System is at your service.\n+#\n+# Whether you want a genuine copy of `rustc`, access to the latest and\n+# most authoritative Rust documentation, or even to investigate the\n+# most intimate workings of the compiler itself, you've come to the\n+# right place. Let's see what's on the menu.\n+#\n+# First, start with one of these build targets:\n+#\n+#   * all - The default. Builds a complete, bootstrapped compiler.\n+#           `rustc` will be in `${target-triple}/stage2/bin/`. Run it\n+#           directly from the build directory if you like. This also\n+#           comes with docs in `doc/`.\n+#\n+#   * check - Run the complete test suite\n+#\n+#   * install - Install Rust. Note that installation is not necessary\n+#               to use the compiler.\n+#\n+#   * uninstall - Uninstall the binaries\n+#\n+# For hot tips on working with The Rust Build System, just:\n+#\n+#     type `make hot-tips`\n+#\n+# Otherwise\n+#\n+#     type `make`\n+#\n+# </help>\n+#\n+# <hottips>\n+#\n+# # The Rust Build System Tip Line\n+#\n+# There are a bazillion different targets you might want to build. Here\n+# are a few ideas.\n #\n-# Start with these these build targets:\n-#\n-# * all - The default rule. Builds a complete stage2 compiler, std,\n-#           and extra for all hosts and targets\n-# * docs - Generate HTML documentation for the std and extra libraries\n-#            from source code comments\n-# * rustc - The stage 2 compiler for the build platform with standard\n-#             and extra libraries\n-# * install\n-# * uninstall\n-# * check - Run tests\n-# * check-stage1-$(crate) - Run tests for a crate, e.g. `check-stage1-std`\n-# * check-stage1-rpass - Run the language tests\n-# * check-docs - Run the doc tests\n+#   * docs - Build gobs of HTML documentation and put it into `doc/`\n+#   * check-$(crate) - Test a crate, e.g. `check-std`\n+#   * check-ref - Run the language reference tests\n+#   * check-docs - Test the documentation examples\n+#\n+# TODO: Lots more\n #\n # Then mix in some of these environment variables to harness the\n-# ultimate power of Rust Build System.\n-#\n-# * `VERBOSE=1` - Print all commands. Use this to see what's going on.\n-# * `RUSTFLAGS=...` - Add compiler flags to all `rustc` invocations\n-# * `CFG_ENABLE_VALGRIND=1` - Run tests under valgrind\n-# * `VALGRIND_COMPILE=1` - Run the compiler itself under valgrind\n-#                          (may require `CFG_ENABLE_VALGRIND`)\n-# * `NO_REBUILD=1` - Don't rebootstrap when testing std\n-#                    (and possibly other crates)\n-# * `NO_MKFILE_DEPS=1` - Don rebuild for modified .mk files\n-# * `SAVE_TEMPS=1` - Use `--save-temps` flag on all `rustc` invocations\n-# * `ASM_COMMENTS=1` - Use `-Z asm-comments`\n-# * `TIME_PASSES=1` - Use `-Z time-passes`\n-# * `TIME_LLVM_PASSES=1` - Use `-Z time-llvm-passes`\n-# * `TRACE=1` - Use `-Z trace`\n+# ultimate power of The Rust Build System.\n+#\n+#   * `VERBOSE=1` - Print all commands. Use this to see what's going on.\n+#   * `RUSTFLAGS=...` - Add compiler flags to all `rustc` invocations\n+#\n+#   * `TESTNAME=...` - Specify the name of tests to run\n+#   * `CHECK_IGNORED=1` - Run normally-ignored tests\n+#   * `NO_BENCH=1` - Don't run crate benchmarks (disable `--bench` flag)\n+#\n+#   * `CFG_ENABLE_VALGRIND=1` - Run tests under valgrind\n+#   * `VALGRIND_COMPILE=1` - Run the compiler itself under valgrind\n+#                            (may require `CFG_ENABLE_VALGRIND`)\n+#\n+#   * `NO_REBUILD=1` - Don't rebootstrap when testing std\n+#                      (and possibly other crates)\n+#   * `NO_MKFILE_DEPS=1` - Don rebuild for modified .mk files\n+#\n+#   * `SAVE_TEMPS=1` - Use `--save-temps` flag on all `rustc` invocations\n+#   * `ASM_COMMENTS=1` - Use `-Z asm-comments`\n+#   * `TIME_PASSES=1` - Use `-Z time-passes`\n+#   * `TIME_LLVM_PASSES=1` - Use `-Z time-llvm-passes`\n+#   * `TRACE=1` - Use `-Z trace`\n #\n # This is hardly all there is to know of The Rust Build System's\n-# mysteries. Your journey continues on the wiki[1][2].\n+# mysteries. The tale continues on the wiki[1][2].\n #\n # [1]: https://github.com/mozilla/rust/wiki/Note-build-system\n # [2]: https://github.com/mozilla/rust/wiki/Note-testsuite\n #\n-# </help>\n+# Unless you feel like getting your hands dirty, then:\n+#\n+#     don't type `make nitty-gritty`\n+#\n+# </hottips>\n+#\n+# <nittygritty>\n+#\n+# # The Rust Build System\n+#\n+# Gosh I wish there was something useful here (TODO).\n #\n # # An (old) explanation of how the build is structured:\n #\n # *Note: Hey, like, this is probably inaccurate, and is definitely\n # an outdated and insufficient explanation of the remarkable\n-# and discomfiting Rust Build System.*\n+# Rust Build System.*\n #\n # There are multiple build stages (0-3) needed to verify that the\n # compiler is properly self-hosting. Each stage is divided between\n@@ -99,6 +144,9 @@\n # will just link against the libraries in the target lib directory.\n #\n # Admittedly this is a little convoluted.\n+#\n+# </nittygritty>\n+#\n \n ######################################################################\n # Primary rules"}, {"sha": "60d7efc7ac8bfd65e8471fb15811a350bc05eef5", "filename": "configure", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/334af011f01ceda1086d335231ada3363190b8a9/configure", "raw_url": "https://github.com/rust-lang/rust/raw/334af011f01ceda1086d335231ada3363190b8a9/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=334af011f01ceda1086d335231ada3363190b8a9", "patch": "@@ -1103,3 +1103,5 @@ rm -f config.tmp\n touch config.stamp\n \n step_msg \"complete\"\n+msg \"type \\`make help\\`\"\n+msg"}, {"sha": "c42b7b4757ad8d4f5f087d270c1f45dd676c9ebd", "filename": "mk/main.mk", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/334af011f01ceda1086d335231ada3363190b8a9/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/334af011f01ceda1086d335231ada3363190b8a9/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=334af011f01ceda1086d335231ada3363190b8a9", "patch": "@@ -428,8 +428,20 @@ ALL_TARGET_RULES = $(foreach target,$(CFG_TARGET), \\\n \n all: $(ALL_TARGET_RULES) $(GENERATED) docs\n \n-help:\n-# Show the comments from Makefile.in as \"help\"\n+######################################################################\n+# Build system documentation\n+######################################################################\n+\n+# $(1) is the name of the doc <section> in Makefile.in\n # pick everything between tags | remove first line | remove last line\n # | remove extra (?) line | strip leading `#` from lines\n-\t$(Q)awk '/<help>/,/<\\/help>/' $(S)/Makefile.in | sed '1d' | sed '$$d' | sed 's/^# \\?//'\n+SHOW_DOCS = $(Q)awk '/$(1)/,/<\\/$(1)>/' $(S)/Makefile.in | sed '1d' | sed '$$d' | sed 's/^\\# \\?//'\n+\n+help:\n+\t$(call SHOW_DOCS,help)\n+\n+hot-tips:\n+\t$(call SHOW_DOCS,hottips)\n+\n+nitty-gritty:\n+\t$(call SHOW_DOCS,nittygritty)"}, {"sha": "049b41ab204d7951326c462b1c0adf0115595e7a", "filename": "mk/tests.mk", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/334af011f01ceda1086d335231ada3363190b8a9/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/334af011f01ceda1086d335231ada3363190b8a9/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=334af011f01ceda1086d335231ada3363190b8a9", "patch": "@@ -190,6 +190,10 @@ check-lite: cleantestlibs cleantmptestlogs \\\n \tcheck-stage2-rfail check-stage2-cfail check-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n+check-ref: cleantestlibs cleantmptestlogs check-stage2-rpass \\\n+\tcheck-stage2-rfail check-stage2-cfail check-stage2-rmake\n+\t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n+\n .PHONY: cleantmptestlogs cleantestlibs\n \n cleantmptestlogs:"}]}