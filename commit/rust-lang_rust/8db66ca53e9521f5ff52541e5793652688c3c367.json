{"sha": "8db66ca53e9521f5ff52541e5793652688c3c367", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkYjY2Y2E1M2U5NTIxZjVmZjUyNTQxZTU3OTM2NTI2ODhjM2MzNjc=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-01-26T17:54:09Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-01-26T17:54:09Z"}, "message": "use `SOURCE_DATE_EPOCH` for man page time if set", "tree": {"sha": "22cf76afb86532d65107583b4a1db135425aaadd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/22cf76afb86532d65107583b4a1db135425aaadd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8db66ca53e9521f5ff52541e5793652688c3c367", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAlxMnuMWHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdKVMB/45/VnWIPnlIC7iS6cCDYDppVnh\nXSIZNMtmxGMFEOWPYT4zhCK2ju2doJupZkHQv75CsRypb+OP9F+odlcu2TNPGUOq\nEFlh2kEptNHutyvqiQp0ThjRNTsuUrzUC0edYXsBQOo7sY/G7gsLE1OoajO7GXRo\nXXXVRwD/qq09Cnkg+mpiXyLGTATTAr9e9qseRD2nLgAAvczn4gwX9Rle9XjF2AgA\nhuJf6GRj7JLl+87WI8tMCCfnplQP3z0AFsVly3qVPngY/3Nr46zKvc36OrxMDmwB\n0TSGSSax+sN9ttbtMoSwkCPNfD6vM/FVn5lMfSRCXvgZfj0HfAjpQhErF7Oy\n=1q62\n-----END PGP SIGNATURE-----", "payload": "tree 22cf76afb86532d65107583b4a1db135425aaadd\nparent 9df043b543bb9bc3e50bc243811c58d52a3aefea\nauthor Andy Russell <arussell123@gmail.com> 1548525249 -0500\ncommitter Andy Russell <arussell123@gmail.com> 1548525249 -0500\n\nuse `SOURCE_DATE_EPOCH` for man page time if set\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8db66ca53e9521f5ff52541e5793652688c3c367", "html_url": "https://github.com/rust-lang/rust/commit/8db66ca53e9521f5ff52541e5793652688c3c367", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8db66ca53e9521f5ff52541e5793652688c3c367/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9df043b543bb9bc3e50bc243811c58d52a3aefea", "url": "https://api.github.com/repos/rust-lang/rust/commits/9df043b543bb9bc3e50bc243811c58d52a3aefea", "html_url": "https://github.com/rust-lang/rust/commit/9df043b543bb9bc3e50bc243811c58d52a3aefea"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "c41df3209c8ffb66d5a1a5b89022445e4432427f", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/8db66ca53e9521f5ff52541e5793652688c3c367/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8db66ca53e9521f5ff52541e5793652688c3c367/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=8db66ca53e9521f5ff52541e5793652688c3c367", "patch": "@@ -23,7 +23,7 @@ use crate::builder::{Builder, RunConfig, ShouldRun, Step};\n use crate::compile;\n use crate::tool::{self, Tool};\n use crate::cache::{INTERNER, Interned};\n-use time;\n+use time::{self, Timespec};\n \n pub fn pkgname(builder: &Builder, component: &str) -> String {\n     if component == \"cargo\" {\n@@ -528,7 +528,19 @@ impl Step for Rustc {\n             t!(fs::create_dir_all(image.join(\"share/man/man1\")));\n             let man_src = builder.src.join(\"src/doc/man\");\n             let man_dst = image.join(\"share/man/man1\");\n-            let month_year = t!(time::strftime(\"%B %Y\", &time::now()));\n+\n+            // Reproducible builds: If SOURCE_DATE_EPOCH is set, use that as the time.\n+            let time = env::var(\"SOURCE_DATE_EPOCH\")\n+                .map(|timestamp| {\n+                    let epoch = timestamp.parse().map_err(|err| {\n+                        format!(\"could not parse SOURCE_DATE_EPOCH: {}\", err)\n+                    }).unwrap();\n+\n+                    time::at(Timespec::new(epoch, 0))\n+                })\n+                .unwrap_or_else(|_| time::now());\n+\n+            let month_year = t!(time::strftime(\"%B %Y\", &time));\n             // don't use our `bootstrap::util::{copy, cp_r}`, because those try\n             // to hardlink, and we don't want to edit the source templates\n             for file_entry in builder.read_dir(&man_src) {"}]}