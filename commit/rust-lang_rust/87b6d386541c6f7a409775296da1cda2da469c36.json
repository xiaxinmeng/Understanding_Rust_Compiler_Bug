{"sha": "87b6d386541c6f7a409775296da1cda2da469c36", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3YjZkMzg2NTQxYzZmN2E0MDk3NzUyOTZkYTFjZGEyZGE0NjljMzY=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2016-10-30T05:57:23Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2016-11-11T00:22:03Z"}, "message": "Don't hint to add lifetime on trait impl\n\nDon't provide hint to add lifetime on impl items that implement a trait.\n\n```rust\nuse std::str::FromStr;\n\npub struct Foo<'a> {\n    field: &'a str,\n}\n\nimpl<'a> FromStr for Foo<'a> {\n    type Err = ();\n    fn from_str(path: &str) -> Result<Self, ()> {\n        Ok(Foo { field: path })\n    }\n}\n```\n\nwould give the following hint:\n\n```nocode\nhelp: consider using an explicit lifetime parameter as shown: fn from_str(path: &'a str) -> Result<Self, ()>\n  --> <anon>:9:5\n   |\n9  |     fn from_str(path: &str) -> Result<Self, ()> {\n   |     ^\n```\n\nwhich is never correct, since then there will be a lifetime mismatch\nbetween the impl and the trait.\n\nRemove this hint for impl items that implement a trait.", "tree": {"sha": "e1fe4c5a2a392ca5b74d9c358a20927ab73a297a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1fe4c5a2a392ca5b74d9c358a20927ab73a297a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87b6d386541c6f7a409775296da1cda2da469c36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87b6d386541c6f7a409775296da1cda2da469c36", "html_url": "https://github.com/rust-lang/rust/commit/87b6d386541c6f7a409775296da1cda2da469c36", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87b6d386541c6f7a409775296da1cda2da469c36/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da2ce2276873242a101f205537e7ce297d68f8dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/da2ce2276873242a101f205537e7ce297d68f8dd", "html_url": "https://github.com/rust-lang/rust/commit/da2ce2276873242a101f205537e7ce297d68f8dd"}], "stats": {"total": 87, "additions": 71, "deletions": 16}, "files": [{"sha": "75334a517fb3bd3ef7c29d94a8bc1fb4c201aee0", "filename": "src/librustc/infer/error_reporting.rs", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/87b6d386541c6f7a409775296da1cda2da469c36/src%2Flibrustc%2Finfer%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b6d386541c6f7a409775296da1cda2da469c36/src%2Flibrustc%2Finfer%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting.rs?ref=87b6d386541c6f7a409775296da1cda2da469c36", "patch": "@@ -1052,21 +1052,28 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                     match item.node {\n                         hir::ItemFn(ref fn_decl, unsafety, constness, _, ref gen, _) => {\n                             Some((fn_decl, gen, unsafety, constness, item.name, item.span))\n-                        },\n-                        _ => None\n+                        }\n+                        _ => None,\n                     }\n                 }\n                 ast_map::NodeImplItem(item) => {\n-                    match item.node {\n-                        hir::ImplItemKind::Method(ref sig, _) => {\n-                            Some((&sig.decl,\n-                                  &sig.generics,\n-                                  sig.unsafety,\n-                                  sig.constness,\n-                                  item.name,\n-                                  item.span))\n+                    let id = self.tcx.map.get_parent(item.id);\n+                    if let Some(ast_map::NodeItem(parent_scope)) = self.tcx.map.find(id) {\n+                        if let hir::ItemImpl(_, _, _, None, _, _) = parent_scope.node {\n+                            // this impl scope implements a trait, do not recomend\n+                            // using explicit lifetimes (#37363)\n+                            return;\n                         }\n-                        _ => None,\n+                    }\n+                    if let hir::ImplItemKind::Method(ref sig, _) = item.node {\n+                        Some((&sig.decl,\n+                              &sig.generics,\n+                              sig.unsafety,\n+                              sig.constness,\n+                              item.name,\n+                              item.span))\n+                    } else {\n+                        None\n                     }\n                 },\n                 ast_map::NodeTraitItem(item) => {\n@@ -1079,12 +1086,12 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                                   item.name,\n                                   item.span))\n                         }\n-                        _ => None\n+                        _ => None,\n                     }\n                 }\n-                _ => None\n+                _ => None,\n             },\n-            None => None\n+            None => None,\n         };\n         let (fn_decl, generics, unsafety, constness, name, span)\n                                     = node_inner.expect(\"expect item fn\");"}, {"sha": "4323929e2e37a7cc07827fa3cccbde3cb06d72dd", "filename": "src/test/compile-fail/lifetime-inference-give-expl-lifetime-param.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fcompile-fail%2Flifetime-inference-give-expl-lifetime-param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fcompile-fail%2Flifetime-inference-give-expl-lifetime-param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flifetime-inference-give-expl-lifetime-param.rs?ref=87b6d386541c6f7a409775296da1cda2da469c36", "patch": "@@ -49,8 +49,6 @@ struct Baz<'x> {\n \n impl<'a> Baz<'a> {\n     fn baz2<'b>(&self, x: &isize) -> (&'b isize, &'b isize) {\n-        //~^ HELP consider using an explicit lifetime parameter as shown: fn baz2<'b>(&self, x: &'\n-        // FIXME #35038: The above suggestion is different on Linux and Mac.\n         (self.bar, x) //~ ERROR E0312\n         //~^ ERROR E0312\n     }"}, {"sha": "603f55af465f47f8c6b23f6592659a79b02a2c15", "filename": "src/test/ui/lifetimes/consider-using-explicit-lifetime.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.rs?ref=87b6d386541c6f7a409775296da1cda2da469c36", "patch": "@@ -0,0 +1,28 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::str::FromStr;\n+\n+pub struct Foo<'a> {\n+    field: &'a str,\n+}\n+\n+impl<'a> Foo<'a> {\n+    fn bar(path: &str) -> Result<Self, ()> {\n+        Ok(Foo { field: path })\n+    }\n+}\n+\n+impl<'a> FromStr for Foo<'a> {\n+    type Err = ();\n+    fn from_str(path: &str) -> Result<Self, ()> {\n+        Ok(Foo { field: path })\n+    }\n+}"}, {"sha": "353e251369a10092e3b54fb3895025f33927f847", "filename": "src/test/ui/lifetimes/consider-using-explicit-lifetime.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87b6d386541c6f7a409775296da1cda2da469c36/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fconsider-using-explicit-lifetime.stderr?ref=87b6d386541c6f7a409775296da1cda2da469c36", "patch": "@@ -0,0 +1,22 @@\n+error: main function not found\n+\n+error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements\n+  --> $DIR/consider-using-explicit-lifetime.rs:19:12\n+   |\n+19 |         Ok(Foo { field: path })\n+   |            ^^^\n+\n+error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements\n+  --> $DIR/consider-using-explicit-lifetime.rs:26:12\n+   |\n+26 |         Ok(Foo { field: path })\n+   |            ^^^\n+   |\n+help: consider using an explicit lifetime parameter as shown: fn from_str(path: &'a str) -> Result<Self, ()>\n+  --> $DIR/consider-using-explicit-lifetime.rs:25:5\n+   |\n+25 |     fn from_str(path: &str) -> Result<Self, ()> {\n+   |     ^\n+\n+error: aborting due to 2 previous errors\n+"}]}