{"sha": "c0c3b37255423b3547614d74311c4193c0717b56", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwYzNiMzcyNTU0MjNiMzU0NzYxNGQ3NDMxMWM0MTkzYzA3MTdiNTY=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-09T19:55:51Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-09T20:37:30Z"}, "message": "Fix another crash found when analyzing rustc", "tree": {"sha": "1727ab1e847dff6142d7b596793a8be4417b5aa0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1727ab1e847dff6142d7b596793a8be4417b5aa0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0c3b37255423b3547614d74311c4193c0717b56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0c3b37255423b3547614d74311c4193c0717b56", "html_url": "https://github.com/rust-lang/rust/commit/c0c3b37255423b3547614d74311c4193c0717b56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0c3b37255423b3547614d74311c4193c0717b56/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1afc933530a87bd0cc7b25726c9a7fff3f3e007", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1afc933530a87bd0cc7b25726c9a7fff3f3e007", "html_url": "https://github.com/rust-lang/rust/commit/f1afc933530a87bd0cc7b25726c9a7fff3f3e007"}], "stats": {"total": 45, "additions": 38, "deletions": 7}, "files": [{"sha": "b30e11abb73d2846a31f96a3c479127fb8d38fe0", "filename": "crates/ra_hir/src/expr.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fexpr.rs?ref=c0c3b37255423b3547614d74311c4193c0717b56", "patch": "@@ -831,18 +831,18 @@ impl ExprCollector {\n                     p.field_pat_list().expect(\"every struct should have a field list\");\n                 let mut fields: Vec<_> = field_pat_list\n                     .bind_pats()\n-                    .map(|bind_pat| {\n+                    .filter_map(|bind_pat| {\n                         let ast_pat = ast::Pat::cast(bind_pat.syntax()).expect(\"bind pat is a pat\");\n                         let pat = self.collect_pat(ast_pat);\n-                        let name = bind_pat.name().expect(\"bind pat has a name\").as_name();\n-                        FieldPat { name, pat }\n+                        let name = bind_pat.name()?.as_name();\n+                        Some(FieldPat { name, pat })\n                     })\n                     .collect();\n-                let iter = field_pat_list.field_pats().map(|f| {\n-                    let ast_pat = f.pat().expect(\"field pat always contains a pattern\");\n+                let iter = field_pat_list.field_pats().filter_map(|f| {\n+                    let ast_pat = f.pat()?;\n                     let pat = self.collect_pat(ast_pat);\n-                    let name = f.name().expect(\"field pats always have a name\").as_name();\n-                    FieldPat { name, pat }\n+                    let name = f.name()?.as_name();\n+                    Some(FieldPat { name, pat })\n                 });\n                 fields.extend(iter);\n "}, {"sha": "fb31883ce8a63c8c628edc6dc3907eb07f821611", "filename": "crates/ra_hir/src/ty/snapshots/tests__infer_std_crash_4.snap", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_std_crash_4.snap", "raw_url": "https://github.com/rust-lang/rust/raw/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_std_crash_4.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_std_crash_4.snap?ref=c0c3b37255423b3547614d74311c4193c0717b56", "patch": "@@ -0,0 +1,16 @@\n+---\n+created: \"2019-02-09T19:55:39.712470520Z\"\n+creator: insta@0.6.1\n+source: crates/ra_hir/src/ty/tests.rs\n+expression: \"&result\"\n+---\n+[25; 110) '{     ...   } }': ()\n+[31; 108) 'match ...     }': ()\n+[37; 42) '*self': [unknown]\n+[38; 42) 'self': [unknown]\n+[53; 95) 'Borrow...), ..}': [unknown]\n+[74; 77) 'box': [unknown]\n+[78; 87) 'Primitive': [unknown]\n+[88; 89) 'p': [unknown]\n+[99; 101) '{}': ()\n+"}, {"sha": "e088df97c408d5e6fcf613d2847018db962487df", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0c3b37255423b3547614d74311c4193c0717b56/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=c0c3b37255423b3547614d74311c4193c0717b56", "patch": "@@ -678,6 +678,21 @@ pub fn compute() {\n     );\n }\n \n+#[test]\n+fn infer_std_crash_4() {\n+    // taken from rustc\n+    check_inference(\n+        \"infer_std_crash_4\",\n+        r#\"\n+pub fn primitive_type() {\n+    match *self {\n+        BorrowedRef { type_: box Primitive(p), ..} => {},\n+    }\n+}\n+\"#,\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.parse(file_id);"}]}