{"sha": "225d74f2115e858b3df640acace5729c3ac1ff81", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyNWQ3NGYyMTE1ZTg1OGIzZGY2NDBhY2FjZTU3MjljM2FjMWZmODE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-04-19T00:51:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-04-19T00:51:51Z"}, "message": "auto merge of #5914 : catamorphism/rust/copy-cops, r=catamorphism", "tree": {"sha": "d8db93e91d3e76f747f4bf8689f3c0dbfa2a041d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8db93e91d3e76f747f4bf8689f3c0dbfa2a041d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/225d74f2115e858b3df640acace5729c3ac1ff81", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/225d74f2115e858b3df640acace5729c3ac1ff81", "html_url": "https://github.com/rust-lang/rust/commit/225d74f2115e858b3df640acace5729c3ac1ff81", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/225d74f2115e858b3df640acace5729c3ac1ff81/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df9cc2eb6632c08e655723f92ae6e5e36dfbba4f", "url": "https://api.github.com/repos/rust-lang/rust/commits/df9cc2eb6632c08e655723f92ae6e5e36dfbba4f", "html_url": "https://github.com/rust-lang/rust/commit/df9cc2eb6632c08e655723f92ae6e5e36dfbba4f"}, {"sha": "3d43af15d8ddb497e5aa76cb1ae0530198c63f96", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d43af15d8ddb497e5aa76cb1ae0530198c63f96", "html_url": "https://github.com/rust-lang/rust/commit/3d43af15d8ddb497e5aa76cb1ae0530198c63f96"}], "stats": {"total": 92, "additions": 46, "deletions": 46}, "files": [{"sha": "8794dae117811351fae53a3b24fa453b7e936eea", "filename": "src/librustc/back/link.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Flink.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -153,9 +153,9 @@ pub mod jit {\n                     code: entry,\n                     env: ptr::null()\n                 };\n-                let func: &fn(++argv: ~[~str]) = cast::transmute(closure);\n+                let func: &fn(++argv: ~[@~str]) = cast::transmute(closure);\n \n-                func(~[/*bad*/copy sess.opts.binary]);\n+                func(~[sess.opts.binary]);\n             }\n         }\n     }"}, {"sha": "355bc13766648177f189b5700f234ed09cbd9182", "filename": "src/librustc/driver/driver.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fdriver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fdriver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fdriver.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -62,7 +62,7 @@ pub fn source_name(input: input) -> ~str {\n     }\n }\n \n-pub fn default_configuration(sess: Session, +argv0: ~str, input: input) ->\n+pub fn default_configuration(sess: Session, argv0: @~str, input: input) ->\n    ast::crate_cfg {\n     let libc = match sess.targ_cfg.os {\n       session::os_win32 => ~\"msvcrt.dll\",\n@@ -101,7 +101,7 @@ pub fn default_configuration(sess: Session, +argv0: ~str, input: input) ->\n          mk(@~\"target_word_size\", @wordsz),\n          mk(@~\"target_libc\", @libc),\n          // Build bindings.\n-         mk(@~\"build_compiler\", @argv0),\n+         mk(@~\"build_compiler\", argv0),\n          mk(@~\"build_input\", @source_name(input))];\n }\n \n@@ -114,7 +114,7 @@ pub fn append_configuration(+cfg: ast::crate_cfg, +name: ~str)\n     }\n }\n \n-pub fn build_configuration(sess: Session, +argv0: ~str, input: input) ->\n+pub fn build_configuration(sess: Session, argv0: @~str, input: input) ->\n    ast::crate_cfg {\n     // Combine the configuration requested by the session (command line) with\n     // some default and generated configuration items\n@@ -523,7 +523,7 @@ pub fn host_triple() -> ~str {\n         };\n }\n \n-pub fn build_session_options(+binary: ~str,\n+pub fn build_session_options(binary: @~str,\n                              matches: &getopts::Matches,\n                              demitter: diagnostic::Emitter)\n                           -> @session::options {\n@@ -898,9 +898,9 @@ mod test {\n                              getopts::fail_str(f))\n             };\n         let sessopts = build_session_options(\n-            ~\"rustc\", matches, diagnostic::emit);\n+            @~\"rustc\", matches, diagnostic::emit);\n         let sess = build_session(sessopts, diagnostic::emit);\n-        let cfg = build_configuration(sess, ~\"whatever\", str_input(~\"\"));\n+        let cfg = build_configuration(sess, @~\"whatever\", str_input(~\"\"));\n         assert!((attr::contains_name(cfg, ~\"test\")));\n     }\n \n@@ -917,9 +917,9 @@ mod test {\n               }\n             };\n         let sessopts = build_session_options(\n-            ~\"rustc\", matches, diagnostic::emit);\n+            @~\"rustc\", matches, diagnostic::emit);\n         let sess = build_session(sessopts, diagnostic::emit);\n-        let cfg = build_configuration(sess, ~\"whatever\", str_input(~\"\"));\n+        let cfg = build_configuration(sess, @~\"whatever\", str_input(~\"\"));\n         let test_items = attr::find_meta_items_by_name(cfg, ~\"test\");\n         assert!((vec::len(test_items) == 1u));\n     }"}, {"sha": "6171ebd8610e456a131b0c38f6e7cffd09549218", "filename": "src/librustc/driver/session.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fsession.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -131,7 +131,7 @@ pub struct options {\n     // will be added to the crate AST node.  This should not be used for\n     // anything except building the full crate config prior to parsing.\n     cfg: ast::crate_cfg,\n-    binary: ~str,\n+    binary: @~str,\n     test: bool,\n     parse_only: bool,\n     no_trans: bool,\n@@ -303,7 +303,7 @@ pub fn basic_options() -> @options {\n         maybe_sysroot: None,\n         target_triple: host_triple(),\n         cfg: ~[],\n-        binary: ~\"rustc\",\n+        binary: @~\"rustc\",\n         test: false,\n         parse_only: false,\n         no_trans: false,"}, {"sha": "cec9a95671e4319cb02b08bd713b2b1a234f7549", "filename": "src/librustc/middle/trans/common.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -184,7 +184,7 @@ pub struct CrateContext {\n      monomorphized: @mut HashMap<mono_id, ValueRef>,\n      monomorphizing: @mut HashMap<ast::def_id, uint>,\n      // Cache computed type parameter uses (see type_use.rs)\n-     type_use_cache: @mut HashMap<ast::def_id, ~[type_use::type_uses]>,\n+     type_use_cache: @mut HashMap<ast::def_id, @~[type_use::type_uses]>,\n      // Cache generated vtables\n      vtables: @mut HashMap<mono_id, ValueRef>,\n      // Cache of constant strings,"}, {"sha": "c6ade350e0bbac9eb8aabc2cb97a72d5020f4094", "filename": "src/librustc/middle/trans/monomorphize.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fmonomorphize.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -342,7 +342,7 @@ pub fn make_mono_id(ccx: @CrateContext,\n                     substs: &[ty::t],\n                     vtables: Option<typeck::vtable_res>,\n                     impl_did_opt: Option<ast::def_id>,\n-                    +param_uses: Option<~[type_use::type_uses]>) -> mono_id {\n+                    param_uses: Option<@~[type_use::type_uses]>) -> mono_id {\n     let precise_param_ids = match vtables {\n       Some(vts) => {\n         let item_ty = ty::lookup_item_type(ccx.tcx, item);\n@@ -353,12 +353,12 @@ pub fn make_mono_id(ccx: @CrateContext,\n                 match *bound {\n                   ty::bound_trait(_) => {\n                     v.push(meth::vtable_id(ccx, /*bad*/copy vts[i]));\n-                    i += 1u;\n+                    i += 1;\n                   }\n                   _ => ()\n                 }\n             }\n-            (*subst, if v.len() > 0u { Some(v) } else { None })\n+            (*subst, if !v.is_empty() { Some(v) } else { None })\n         })\n       }\n       None => {\n@@ -367,7 +367,7 @@ pub fn make_mono_id(ccx: @CrateContext,\n     };\n     let param_ids = match param_uses {\n       Some(ref uses) => {\n-        vec::map2(precise_param_ids, *uses, |id, uses| {\n+        vec::map2(precise_param_ids, **uses, |id, uses| {\n             if ccx.sess.no_monomorphic_collapse() {\n                 match copy *id {\n                     (a, b) => mono_precise(a, b)\n@@ -377,7 +377,7 @@ pub fn make_mono_id(ccx: @CrateContext,\n                     // XXX: Bad copy.\n                     (a, copy b@Some(_)) => mono_precise(a, b),\n                     (subst, None) => {\n-                        if *uses == 0u {\n+                        if *uses == 0 {\n                             mono_any\n                         } else if *uses == type_use::use_repr &&\n                             !ty::type_needs_drop(ccx.tcx, subst)"}, {"sha": "4094c597bbbefc2f7bad4466ad2e3679d6971988", "filename": "src/librustc/middle/trans/type_use.rs", "status": "modified", "additions": 14, "deletions": 13, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -47,19 +47,19 @@ use syntax::ast_util;\n use syntax::visit;\n \n pub type type_uses = uint; // Bitmask\n-pub static use_repr: uint = 1u;   /* Dependency on size/alignment/mode and\n+pub static use_repr: uint = 1;   /* Dependency on size/alignment/mode and\n                                      take/drop glue */\n-pub static use_tydesc: uint = 2u; /* Takes the tydesc, or compares */\n+pub static use_tydesc: uint = 2; /* Takes the tydesc, or compares */\n \n pub struct Context {\n     ccx: @CrateContext,\n     uses: @mut ~[type_uses]\n }\n \n pub fn type_uses_for(ccx: @CrateContext, fn_id: def_id, n_tps: uint)\n-    -> ~[type_uses] {\n+    -> @~[type_uses] {\n     match ccx.type_use_cache.find(&fn_id) {\n-      Some(uses) => return /*bad*/ copy *uses,\n+      Some(uses) => return *uses,\n       None => ()\n     }\n \n@@ -70,11 +70,11 @@ pub fn type_uses_for(ccx: @CrateContext, fn_id: def_id, n_tps: uint)\n     };\n \n     // Conservatively assume full use for recursive loops\n-    ccx.type_use_cache.insert(fn_id, vec::from_elem(n_tps, 3u));\n+    ccx.type_use_cache.insert(fn_id, @vec::from_elem(n_tps, 3u));\n \n     let cx = Context {\n         ccx: ccx,\n-        uses: @mut vec::from_elem(n_tps, 0u)\n+        uses: @mut vec::from_elem(n_tps, 0)\n     };\n     match ty::get(ty::lookup_item_type(cx.ccx.tcx, fn_id).ty).sty {\n         ty::ty_bare_fn(ty::BareFnTy {sig: ref sig, _}) |\n@@ -92,8 +92,9 @@ pub fn type_uses_for(ccx: @CrateContext, fn_id: def_id, n_tps: uint)\n     }\n \n     if fn_id_loc.crate != local_crate {\n-        let uses = copy *cx.uses;\n-        ccx.type_use_cache.insert(fn_id, copy uses);\n+        let Context { uses: @uses, _ } = cx;\n+        let uses = @uses; // mutability\n+        ccx.type_use_cache.insert(fn_id, uses);\n         return uses;\n     }\n     let map_node = match ccx.tcx.items.find(&fn_id_loc.node) {\n@@ -179,9 +180,9 @@ pub fn type_uses_for(ccx: @CrateContext, fn_id: def_id, n_tps: uint)\n                                 ccx.tcx.sess.parse_sess.interner)));\n       }\n     }\n-    // XXX: Bad copies, use @vec instead?\n-    let uses = copy *cx.uses;\n-    ccx.type_use_cache.insert(fn_id, copy uses);\n+    let Context { uses: @uses, _ } = cx;\n+    let uses = @uses; // mutability\n+    ccx.type_use_cache.insert(fn_id, uses);\n     uses\n }\n \n@@ -253,7 +254,7 @@ pub fn mark_for_method_call(cx: Context, e_id: node_id, callee_id: node_id) {\n                 //               before stage2\n                 let ts = /*bad*/ copy **ts;\n                 let type_uses = type_uses_for(cx.ccx, did, ts.len());\n-                for vec::each2(type_uses, ts) |uses, subst| {\n+                for vec::each2(*type_uses, ts) |uses, subst| {\n                     type_needs(cx, *uses, *subst)\n                 }\n             }\n@@ -302,7 +303,7 @@ pub fn mark_for_expr(cx: Context, e: @expr) {\n             let ts = copy **ts;\n             let id = ast_util::def_id_of_def(*cx.ccx.tcx.def_map.get(&e.id));\n             let uses_for_ts = type_uses_for(cx.ccx, id, ts.len());\n-            for vec::each2(uses_for_ts, ts) |uses, subst| {\n+            for vec::each2(*uses_for_ts, ts) |uses, subst| {\n                 type_needs(cx, *uses, *subst)\n             }\n         }"}, {"sha": "845f0e2c522a44ff6296ae6b7759043dcb823a11", "filename": "src/librustc/rustc.rc", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Frustc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustc%2Frustc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Frustc.rc?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -206,9 +206,9 @@ pub fn run_compiler(args: &~[~str], demitter: diagnostic::Emitter) {\n     ::core::logging::console_off();\n \n     let mut args = /*bad*/copy *args;\n-    let binary = args.shift();\n+    let binary = @args.shift();\n \n-    if args.is_empty() { usage(binary); return; }\n+    if args.is_empty() { usage(*binary); return; }\n \n     let matches =\n         &match getopts::groups::getopts(args, optgroups()) {\n@@ -219,7 +219,7 @@ pub fn run_compiler(args: &~[~str], demitter: diagnostic::Emitter) {\n         };\n \n     if opt_present(matches, ~\"h\") || opt_present(matches, ~\"help\") {\n-        usage(binary);\n+        usage(*binary);\n         return;\n     }\n \n@@ -236,7 +236,7 @@ pub fn run_compiler(args: &~[~str], demitter: diagnostic::Emitter) {\n     }\n \n     if opt_present(matches, ~\"v\") || opt_present(matches, ~\"version\") {\n-        version(binary);\n+        version(*binary);\n         return;\n     }\n     let input = match vec::len(matches.free) {\n@@ -253,8 +253,7 @@ pub fn run_compiler(args: &~[~str], demitter: diagnostic::Emitter) {\n       _ => early_error(demitter, ~\"multiple input filenames provided\")\n     };\n \n-    // XXX: Bad copy.\n-    let sopts = build_session_options(copy binary, matches, demitter);\n+    let sopts = build_session_options(binary, matches, demitter);\n     let sess = build_session(sopts, demitter);\n     let odir = getopts::opt_maybe_str(matches, ~\"out-dir\");\n     let odir = odir.map(|o| Path(*o));"}, {"sha": "6c759e935b9313bda5ffc5e45c3c7614a04022d1", "filename": "src/librustdoc/parse.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustdoc%2Fparse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustdoc%2Fparse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fparse.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -39,5 +39,5 @@ pub fn from_str_sess(sess: session::Session, source: ~str) -> @ast::crate {\n }\n \n fn cfg(sess: session::Session, input: driver::input) -> ast::crate_cfg {\n-    driver::build_configuration(sess, ~\"rustdoc\", input)\n+    driver::build_configuration(sess, @~\"rustdoc\", input)\n }"}, {"sha": "e14a6e0e7409e91a441ee9967f2a20d3eaa09ce8", "filename": "src/librusti/rusti.rc", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrusti%2Frusti.rc", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrusti%2Frusti.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrusti%2Frusti.rc?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -127,7 +127,7 @@ fn record(repl: Repl, blk: @ast::blk, intr: @token::ident_interner) -> Repl {\n fn run(repl: Repl, input: ~str) -> Repl {\n     let options = @session::options {\n         crate_type: session::unknown_crate,\n-        binary: repl.binary,\n+        binary: @repl.binary,\n         addl_lib_search_paths: repl.lib_search_paths.map(|p| Path(*p)),\n         jit: true,\n         .. *session::basic_options()\n@@ -146,7 +146,7 @@ fn run(repl: Repl, input: ~str) -> Repl {\n \n     debug!(\"building driver configuration\");\n     let cfg = driver::build_configuration(sess,\n-                                          repl.binary,\n+                                          @repl.binary,\n                                           wrapped);\n \n     let outputs = driver::build_output_filenames(wrapped, &None, &None, sess);\n@@ -191,14 +191,14 @@ fn compile_crate(src_filename: ~str, binary: ~str) -> Option<bool> {\n     match do task::try {\n         let src_path = Path(src_filename);\n         let options = @session::options {\n-            binary: binary,\n+            binary: @binary,\n             addl_lib_search_paths: ~[os::getcwd()],\n             .. *session::basic_options()\n         };\n         let input = driver::file_input(src_path);\n         let sess = driver::build_session(options, diagnostic::emit);\n         *sess.building_library = true;\n-        let cfg = driver::build_configuration(sess, binary, input);\n+        let cfg = driver::build_configuration(sess, @binary, input);\n         let outputs = driver::build_output_filenames(\n             input, &None, &None, sess);\n         // If the library already exists and is newer than the source"}, {"sha": "76d145cb2b726210e02228dc895552d6cca5428c", "filename": "src/librustpkg/rustpkg.rc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustpkg%2Frustpkg.rc", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustpkg%2Frustpkg.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Frustpkg.rc?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -76,13 +76,13 @@ impl PkgScript {\n         // Build the rustc session data structures to pass\n         // to the compiler\n         let options = @session::options {\n-            binary: binary,\n+            binary: @binary,\n             crate_type: session::bin_crate,\n             .. *session::basic_options()\n         };\n         let input = driver::file_input(script);\n         let sess = driver::build_session(options, diagnostic::emit);\n-        let cfg = driver::build_configuration(sess, binary, input);\n+        let cfg = driver::build_configuration(sess, @binary, input);\n         let (crate, _) = driver::compile_upto(sess, cfg, input,\n                                               driver::cu_parse, None);\n         let work_dir = dest_dir(id);"}, {"sha": "7581329f1fc69a9d3bdc8d40587441fb275fb51a", "filename": "src/librustpkg/util.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustpkg%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/225d74f2115e858b3df640acace5729c3ac1ff81/src%2Flibrustpkg%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Futil.rs?ref=225d74f2115e858b3df640acace5729c3ac1ff81", "patch": "@@ -478,7 +478,7 @@ pub fn compile_input(sysroot: Option<Path>,\n         test: test,\n         maybe_sysroot: sysroot,\n         addl_lib_search_paths: ~[copy *out_dir],\n-        .. *driver::build_session_options(binary, &matches, diagnostic::emit)\n+        .. *driver::build_session_options(@binary, &matches, diagnostic::emit)\n     };\n     let mut crate_cfg = options.cfg;\n \n@@ -518,7 +518,7 @@ pub fn compile_crate_from_input(input: driver::input,\n     debug!(\"Calling build_output_filenames with %?\", build_dir_opt);\n     let outputs = driver::build_output_filenames(input, &build_dir_opt, &Some(out_file), sess);\n     debug!(\"Outputs are %? and output type = %?\", outputs, sess.opts.output_type);\n-    let cfg = driver::build_configuration(sess, binary, input);\n+    let cfg = driver::build_configuration(sess, @binary, input);\n     match crate_opt {\n         Some(c) => {\n             debug!(\"Calling compile_rest, outputs = %?\", outputs);"}]}