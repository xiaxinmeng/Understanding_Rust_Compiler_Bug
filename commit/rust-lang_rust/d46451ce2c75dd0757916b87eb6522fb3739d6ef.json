{"sha": "d46451ce2c75dd0757916b87eb6522fb3739d6ef", "node_id": "C_kwDOAAsO6NoAKGQ0NjQ1MWNlMmM3NWRkMDc1NzkxNmI4N2ViNjUyMmZiMzczOWQ2ZWY", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-14T04:06:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-14T04:06:50Z"}, "message": "Rollup merge of #100431 - compiler-errors:enum-ctor-variant-stab, r=estebank\n\nEnum variant ctor inherits the stability of the enum variant\n\nFixes #100399\nFixes #100420\n\nContext #71481 for why enum variants don't need stability", "tree": {"sha": "ca3da9228f8b406fd2de97716df5b57d995742be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca3da9228f8b406fd2de97716df5b57d995742be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d46451ce2c75dd0757916b87eb6522fb3739d6ef", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi+HTaCRBK7hj4Ov3rIwAAPTAIAKArEpEbKU9D2beXeyhDw1u4\nn26uXTJb5vrIAYQOIBN/sAJQC4HMP4NeBWl2WEZ69Sq4fVGCNc3UQtshqWy5uBpu\nwri49YyAys+ON1Pu4ny85+GWu9E7D+MCCFnwteRZvf75AF3nodKc6EhXGxbHvm+d\nxOuMndNPMxUfWRfkJXPY2cOeEEXs6DfTi79kKiYTRlDsWmWmQF3DqhmdkOjbze3E\nq2On1QuEQZji19ZNeHPZhfbLUtYJsQ+nhe/JuxOFy88O5mNH6MYtSkgDKJPTKzAd\nKfGqIkwZypyjhoGA3wGjz26TnRlbepCSSvjq2iJdKT4fNwQ7Ce+GbWCccYIjt3Q=\n=rCjf\n-----END PGP SIGNATURE-----\n", "payload": "tree ca3da9228f8b406fd2de97716df5b57d995742be\nparent e248c7f9ae1e6604767c9842be58d577e5890a7b\nparent 6925f4101b426c66abe20e8acdddf8c20fd1e87c\nauthor Michael Goulet <michael@errs.io> 1660450010 -0700\ncommitter GitHub <noreply@github.com> 1660450010 -0700\n\nRollup merge of #100431 - compiler-errors:enum-ctor-variant-stab, r=estebank\n\nEnum variant ctor inherits the stability of the enum variant\n\nFixes #100399\nFixes #100420\n\nContext #71481 for why enum variants don't need stability\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d46451ce2c75dd0757916b87eb6522fb3739d6ef", "html_url": "https://github.com/rust-lang/rust/commit/d46451ce2c75dd0757916b87eb6522fb3739d6ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d46451ce2c75dd0757916b87eb6522fb3739d6ef/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e248c7f9ae1e6604767c9842be58d577e5890a7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e248c7f9ae1e6604767c9842be58d577e5890a7b", "html_url": "https://github.com/rust-lang/rust/commit/e248c7f9ae1e6604767c9842be58d577e5890a7b"}, {"sha": "6925f4101b426c66abe20e8acdddf8c20fd1e87c", "url": "https://api.github.com/repos/rust-lang/rust/commits/6925f4101b426c66abe20e8acdddf8c20fd1e87c", "html_url": "https://github.com/rust-lang/rust/commit/6925f4101b426c66abe20e8acdddf8c20fd1e87c"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "f884e04a9511254977a3a96cf40142e8129f98ed", "filename": "compiler/rustc_passes/src/stability.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d46451ce2c75dd0757916b87eb6522fb3739d6ef/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d46451ce2c75dd0757916b87eb6522fb3739d6ef/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fstability.rs?ref=d46451ce2c75dd0757916b87eb6522fb3739d6ef", "patch": "@@ -460,7 +460,7 @@ impl<'a, 'tcx> Visitor<'tcx> for Annotator<'a, 'tcx> {\n                         AnnotationKind::Required,\n                         InheritDeprecation::Yes,\n                         InheritConstStability::No,\n-                        InheritStability::No,\n+                        InheritStability::Yes,\n                         |_| {},\n                     );\n                 }\n@@ -600,6 +600,9 @@ impl<'tcx> Visitor<'tcx> for MissingStabilityAnnotations<'tcx> {\n \n     fn visit_variant(&mut self, var: &'tcx Variant<'tcx>) {\n         self.check_missing_stability(self.tcx.hir().local_def_id(var.id), var.span);\n+        if let Some(ctor_hir_id) = var.data.ctor_hir_id() {\n+            self.check_missing_stability(self.tcx.hir().local_def_id(ctor_hir_id), var.span);\n+        }\n         intravisit::walk_variant(self, var);\n     }\n "}, {"sha": "74c6023d7fbbd97d0de51e297fe58d641890cd90", "filename": "src/test/ui/stability-attribute/auxiliary/ctor-stability.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d46451ce2c75dd0757916b87eb6522fb3739d6ef/src%2Ftest%2Fui%2Fstability-attribute%2Fauxiliary%2Fctor-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d46451ce2c75dd0757916b87eb6522fb3739d6ef/src%2Ftest%2Fui%2Fstability-attribute%2Fauxiliary%2Fctor-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fauxiliary%2Fctor-stability.rs?ref=d46451ce2c75dd0757916b87eb6522fb3739d6ef", "patch": "@@ -0,0 +1,8 @@\n+#![crate_type = \"lib\"]\n+#![feature(staged_api)]\n+#![stable(feature = \"none\", since = \"1.0\")]\n+\n+#[stable(feature = \"none\", since = \"1.0\")]\n+pub enum Foo {\n+    A,\n+}"}, {"sha": "fcab0cb109940a8fed1fe66be4774be1298e598e", "filename": "src/test/ui/stability-attribute/ctor-stability.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d46451ce2c75dd0757916b87eb6522fb3739d6ef/src%2Ftest%2Fui%2Fstability-attribute%2Fctor-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d46451ce2c75dd0757916b87eb6522fb3739d6ef/src%2Ftest%2Fui%2Fstability-attribute%2Fctor-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fctor-stability.rs?ref=d46451ce2c75dd0757916b87eb6522fb3739d6ef", "patch": "@@ -0,0 +1,8 @@\n+// aux-build:ctor-stability.rs\n+// check-pass\n+\n+extern crate ctor_stability;\n+\n+fn main() {\n+    let _ = ctor_stability::Foo::A;\n+}"}]}