{"sha": "852dea89b2289fe101f2bbd807c0abdd09902e08", "node_id": "C_kwDOAAsO6NoAKDg1MmRlYTg5YjIyODlmZTEwMWYyYmJkODA3YzBhYmRkMDk5MDJlMDg", "commit": {"author": {"name": "Alik Aslanyan", "email": "inline0@protonmail.com", "date": "2021-12-21T18:31:23Z"}, "committer": {"name": "Alik Aslanyan", "email": "inline0@protonmail.com", "date": "2021-12-21T18:40:21Z"}, "message": "Remove ArenaCacheSelector for visible_parent_map query.\nOptimize visible_parent_map to use LRC to prevent unnecessary cloning", "tree": {"sha": "9f6ef5d98a06a6dd7292f3bd7215e30f0912a056", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f6ef5d98a06a6dd7292f3bd7215e30f0912a056"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/852dea89b2289fe101f2bbd807c0abdd09902e08", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJLBAABCAA1FiEEeY134/OQL6hN3y4Jf+b9XVvEzPYFAmHCH5YXHGlubGluZTBA\ncHJvdG9ubWFpbC5jb20ACgkQf+b9XVvEzPYvkhAAyL/cUnrje9IRJAM2R1+zB1bs\nTEtizEf5AQN2yWTKwfK6DMUs+bQtEWmY9rtl/Y7XoTvXCRepcAVz824KHyyZFekz\nqgobNviNOMeP2XVa5904qofr3ugHXV72+mLJVQthKccLyjNV7o16S0o941JaXXfm\nQ6pT2YfnM2FfitmHOF3ZZsSqxqPFbR7hpfZm+7O1Xc9clkEKuWYiEgFX4VDkXuEu\nvdDMY8lRKLkHox/n+WsYeto12yeG/HqTf89mReKmah/9s4GbjICx6ZELCxviPWAl\nevVKCHuFURgtSIGMmoI3QHK/lzv1Sgo/Uh3/H1D9Dje4I4jD397jQw/XlVPR5zSw\n3Tph5ai0KxF1nWuXHy6zX8HdUknm6WiDhv+V2s8BcpjCbRy/6fAfMDMlRvD4Ur3I\nwtbI/vsjGTaSnnFLEujGEsYjVKhII8/dOtnWi4qx/e4Zy2Pbnf+RelP8F+d5bIR9\nwXI9ijrUdSXlB1xmE+GcBhWcRzeNiC6BQW5sLutopOGw/Z7ztBwIMiJlt5hbs99T\neAnoG7EbXDMnMrMH/CTDZCXwPFfPPKfJ2cNz40jXcWLkhrNV7HiX2PNa4nX8iZOr\nCTDkxLZlkZWRjMuRdyH237arBYHw0mdesquOrRAi0NwOOpQO5jDyB745raIjnECV\n718BLF9Y7NU7UyO/Pmw=\n=q0nX\n-----END PGP SIGNATURE-----", "payload": "tree 9f6ef5d98a06a6dd7292f3bd7215e30f0912a056\nparent 8ad3c1dd1d47f9ce7dfdf4a14c70c67e1790b0f5\nauthor Alik Aslanyan <inline0@protonmail.com> 1640111483 +0400\ncommitter Alik Aslanyan <inline0@protonmail.com> 1640112021 +0400\n\nRemove ArenaCacheSelector for visible_parent_map query.\nOptimize visible_parent_map to use LRC to prevent unnecessary cloning\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/852dea89b2289fe101f2bbd807c0abdd09902e08", "html_url": "https://github.com/rust-lang/rust/commit/852dea89b2289fe101f2bbd807c0abdd09902e08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/852dea89b2289fe101f2bbd807c0abdd09902e08/comments", "author": {"login": "In-line", "id": 19331496, "node_id": "MDQ6VXNlcjE5MzMxNDk2", "avatar_url": "https://avatars.githubusercontent.com/u/19331496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/In-line", "html_url": "https://github.com/In-line", "followers_url": "https://api.github.com/users/In-line/followers", "following_url": "https://api.github.com/users/In-line/following{/other_user}", "gists_url": "https://api.github.com/users/In-line/gists{/gist_id}", "starred_url": "https://api.github.com/users/In-line/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/In-line/subscriptions", "organizations_url": "https://api.github.com/users/In-line/orgs", "repos_url": "https://api.github.com/users/In-line/repos", "events_url": "https://api.github.com/users/In-line/events{/privacy}", "received_events_url": "https://api.github.com/users/In-line/received_events", "type": "User", "site_admin": false}, "committer": {"login": "In-line", "id": 19331496, "node_id": "MDQ6VXNlcjE5MzMxNDk2", "avatar_url": "https://avatars.githubusercontent.com/u/19331496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/In-line", "html_url": "https://github.com/In-line", "followers_url": "https://api.github.com/users/In-line/followers", "following_url": "https://api.github.com/users/In-line/following{/other_user}", "gists_url": "https://api.github.com/users/In-line/gists{/gist_id}", "starred_url": "https://api.github.com/users/In-line/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/In-line/subscriptions", "organizations_url": "https://api.github.com/users/In-line/orgs", "repos_url": "https://api.github.com/users/In-line/repos", "events_url": "https://api.github.com/users/In-line/events{/privacy}", "received_events_url": "https://api.github.com/users/In-line/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ad3c1dd1d47f9ce7dfdf4a14c70c67e1790b0f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ad3c1dd1d47f9ce7dfdf4a14c70c67e1790b0f5", "html_url": "https://github.com/rust-lang/rust/commit/8ad3c1dd1d47f9ce7dfdf4a14c70c67e1790b0f5"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "3f3b83cf795717ed00fe76adda11e599a595e46e", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/852dea89b2289fe101f2bbd807c0abdd09902e08/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/852dea89b2289fe101f2bbd807c0abdd09902e08/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=852dea89b2289fe101f2bbd807c0abdd09902e08", "patch": "@@ -360,7 +360,7 @@ pub fn provide(providers: &mut Providers) {\n                 visible_parent_map.entry(child).or_insert(parent);\n             }\n \n-            visible_parent_map\n+            Lrc::new(visible_parent_map)\n         },\n \n         dependency_formats: |tcx, ()| Lrc::new(crate::dependency_format::calculate(tcx)),"}, {"sha": "81602dc9d61c4caf58e2a78bbe8205ee8f030cf8", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/852dea89b2289fe101f2bbd807c0abdd09902e08/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/852dea89b2289fe101f2bbd807c0abdd09902e08/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=852dea89b2289fe101f2bbd807c0abdd09902e08", "patch": "@@ -1552,8 +1552,7 @@ rustc_queries! {\n         desc { \"calculating the missing lang items in a crate\" }\n         separate_provide_extern\n     }\n-    query visible_parent_map(_: ()) -> DefIdMap<DefId> {\n-        storage(ArenaCacheSelector<'tcx>)\n+    query visible_parent_map(_: ()) -> Lrc<DefIdMap<DefId>> {\n         desc { \"calculating the visible parent map\" }\n     }\n     query trimmed_def_paths(_: ()) -> FxHashMap<DefId, Symbol> {"}]}