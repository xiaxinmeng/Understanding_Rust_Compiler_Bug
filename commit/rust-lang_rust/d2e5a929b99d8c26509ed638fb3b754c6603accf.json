{"sha": "d2e5a929b99d8c26509ed638fb3b754c6603accf", "node_id": "C_kwDOAAsO6NoAKGQyZTVhOTI5Yjk5ZDhjMjY1MDllZDYzOGZiM2I3NTRjNjYwM2FjY2Y", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-08T03:21:49Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-10T23:43:46Z"}, "message": "use subdiagnostic for message", "tree": {"sha": "b1562007a389059bf6441c553515f03abc2ad889", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1562007a389059bf6441c553515f03abc2ad889"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2e5a929b99d8c26509ed638fb3b754c6603accf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2e5a929b99d8c26509ed638fb3b754c6603accf", "html_url": "https://github.com/rust-lang/rust/commit/d2e5a929b99d8c26509ed638fb3b754c6603accf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2e5a929b99d8c26509ed638fb3b754c6603accf/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a973e2abc2aaca790980032cc839183ef01d2c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a973e2abc2aaca790980032cc839183ef01d2c1", "html_url": "https://github.com/rust-lang/rust/commit/2a973e2abc2aaca790980032cc839183ef01d2c1"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "8d506a3ea8bbc64ee4d9c2cc23cd2a423e1eea8c", "filename": "compiler/rustc_error_messages/locales/en-US/expand.ftl", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fexpand.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fexpand.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fexpand.ftl?ref=d2e5a929b99d8c26509ed638fb3b754c6603accf", "patch": "@@ -0,0 +1,5 @@\n+expand-explain-doc-comment-outer =\n+    outer doc comments expand to `#[doc = \"...\"]`, which is what this macro attempted to match\n+\n+expand-explain-doc-comment-inner =\n+    inner doc comments expand to `#![doc = \"...\"]`, which is what this macro attempted to match"}, {"sha": "d16171cb162d6e45b4e9f189bf6e431ae665434a", "filename": "compiler/rustc_error_messages/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs?ref=d2e5a929b99d8c26509ed638fb3b754c6603accf", "patch": "@@ -33,11 +33,12 @@ pub use unic_langid::{langid, LanguageIdentifier};\n fluent_messages! {\n     borrowck => \"../locales/en-US/borrowck.ftl\",\n     builtin_macros => \"../locales/en-US/builtin_macros.ftl\",\n+    const_eval => \"../locales/en-US/const_eval.ftl\",\n+    expand => \"../locales/en-US/expand.ftl\",\n     lint => \"../locales/en-US/lint.ftl\",\n     parser => \"../locales/en-US/parser.ftl\",\n     privacy => \"../locales/en-US/privacy.ftl\",\n     typeck => \"../locales/en-US/typeck.ftl\",\n-    const_eval => \"../locales/en-US/const_eval.ftl\",\n }\n \n pub use fluent_generated::{self as fluent, DEFAULT_LOCALE_RESOURCES};"}, {"sha": "3e9ddd6aec075419e0d220bf6367605e32936585", "filename": "compiler/rustc_expand/src/mbe/macro_rules.rs", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2e5a929b99d8c26509ed638fb3b754c6603accf/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs?ref=d2e5a929b99d8c26509ed638fb3b754c6603accf", "patch": "@@ -594,16 +594,30 @@ pub fn compile_declarative_macro(\n     (mk_syn_ext(expander), rule_spans)\n }\n \n+#[derive(SessionSubdiagnostic)]\n+enum ExplainDocComment {\n+    #[label(expand::explain_doc_comment_inner)]\n+    Inner {\n+        #[primary_span]\n+        span: Span,\n+    },\n+    #[label(expand::explain_doc_comment_outer)]\n+    Outer {\n+        #[primary_span]\n+        span: Span,\n+    },\n+}\n+\n fn annotate_doc_comment(\n     err: &mut DiagnosticBuilder<'_, ErrorGuaranteed>,\n     sm: &SourceMap,\n     span: Span,\n ) {\n     if let Ok(src) = sm.span_to_snippet(span) {\n         if src.starts_with(\"///\") || src.starts_with(\"/**\") {\n-            err.span_label(span, \"outer doc comments expand to `#[doc = \\\"...\\\"]`, which is what this macro attempted to match\");\n+            err.subdiagnostic(ExplainDocComment::Outer { span });\n         } else if src.starts_with(\"//!\") || src.starts_with(\"/*!\") {\n-            err.span_label(span, \"inner doc comments expand to `#![doc = \\\"...\\\"]`, which is what this macro attempted to match\");\n+            err.subdiagnostic(ExplainDocComment::Inner { span });\n         }\n     }\n }"}]}