{"sha": "0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "node_id": "C_kwDOAAsO6NoAKDBhMDNkMWM5Y2FmZGUwYWRhMTliNGZhYjBmM2Q2ODkyY2IxNTRmZDg", "commit": {"author": {"name": "Collin Baker", "email": "collinbaker@chromium.org", "date": "2023-01-12T10:36:04Z"}, "committer": {"name": "Collin Baker", "email": "collinbaker@chromium.org", "date": "2023-01-12T10:36:04Z"}, "message": "Allow setting CFG_DISABLE_UNSTABLE_FEATURES to 0\n\nTwo locations check whether this build-time environment variable is\ndefined. Allowing it to be explicitly disabled with a \"0\" value is\nuseful, especially for integrating with external build systems.", "tree": {"sha": "a475f71e82b96fcf8da27f358d04fa91a0d2c769", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a475f71e82b96fcf8da27f358d04fa91a0d2c769"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "html_url": "https://github.com/rust-lang/rust/commit/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8/comments", "author": {"login": "chbaker0", "id": 6291976, "node_id": "MDQ6VXNlcjYyOTE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6291976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chbaker0", "html_url": "https://github.com/chbaker0", "followers_url": "https://api.github.com/users/chbaker0/followers", "following_url": "https://api.github.com/users/chbaker0/following{/other_user}", "gists_url": "https://api.github.com/users/chbaker0/gists{/gist_id}", "starred_url": "https://api.github.com/users/chbaker0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chbaker0/subscriptions", "organizations_url": "https://api.github.com/users/chbaker0/orgs", "repos_url": "https://api.github.com/users/chbaker0/repos", "events_url": "https://api.github.com/users/chbaker0/events{/privacy}", "received_events_url": "https://api.github.com/users/chbaker0/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chbaker0", "id": 6291976, "node_id": "MDQ6VXNlcjYyOTE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6291976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chbaker0", "html_url": "https://github.com/chbaker0", "followers_url": "https://api.github.com/users/chbaker0/followers", "following_url": "https://api.github.com/users/chbaker0/following{/other_user}", "gists_url": "https://api.github.com/users/chbaker0/gists{/gist_id}", "starred_url": "https://api.github.com/users/chbaker0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chbaker0/subscriptions", "organizations_url": "https://api.github.com/users/chbaker0/orgs", "repos_url": "https://api.github.com/users/chbaker0/repos", "events_url": "https://api.github.com/users/chbaker0/events{/privacy}", "received_events_url": "https://api.github.com/users/chbaker0/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4887cb18dc2ef5b1bf3fc50ce6c267fde085032b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4887cb18dc2ef5b1bf3fc50ce6c267fde085032b", "html_url": "https://github.com/rust-lang/rust/commit/4887cb18dc2ef5b1bf3fc50ce6c267fde085032b"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "93d16716346915119dcf3213c27728293e73e20a", "filename": "compiler/rustc_feature/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8/compiler%2Frustc_feature%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8/compiler%2Frustc_feature%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Flib.rs?ref=0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "patch": "@@ -83,7 +83,8 @@ impl UnstableFeatures {\n     /// Otherwise, only `RUSTC_BOOTSTRAP=1` will work.\n     pub fn from_environment(krate: Option<&str>) -> Self {\n         // `true` if this is a feature-staged build, i.e., on the beta or stable channel.\n-        let disable_unstable_features = option_env!(\"CFG_DISABLE_UNSTABLE_FEATURES\").is_some();\n+        let disable_unstable_features =\n+            option_env!(\"CFG_DISABLE_UNSTABLE_FEATURES\").map(|s| s != \"0\").unwrap_or(false);\n         // Returns whether `krate` should be counted as unstable\n         let is_unstable_crate = |var: &str| {\n             krate.map_or(false, |name| var.split(',').any(|new_krate| new_krate == name))"}, {"sha": "9d22ebbee873bab9b680fd37e9fde055e932c3c6", "filename": "library/test/src/cli.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8/library%2Ftest%2Fsrc%2Fcli.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8/library%2Ftest%2Fsrc%2Fcli.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fcli.rs?ref=0a03d1c9cafde0ada19b4fab0f3d6892cb154fd8", "patch": "@@ -309,7 +309,8 @@ fn parse_opts_impl(matches: getopts::Matches) -> OptRes {\n // FIXME: Copied from librustc_ast until linkage errors are resolved. Issue #47566\n fn is_nightly() -> bool {\n     // Whether this is a feature-staged build, i.e., on the beta or stable channel\n-    let disable_unstable_features = option_env!(\"CFG_DISABLE_UNSTABLE_FEATURES\").is_some();\n+    let disable_unstable_features =\n+        option_env!(\"CFG_DISABLE_UNSTABLE_FEATURES\").map(|s| s != \"0\").unwrap_or(false);\n     // Whether we should enable unstable features for bootstrapping\n     let bootstrap = env::var(\"RUSTC_BOOTSTRAP\").is_ok();\n "}]}