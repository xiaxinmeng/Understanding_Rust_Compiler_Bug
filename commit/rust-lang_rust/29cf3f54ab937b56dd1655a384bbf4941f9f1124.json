{"sha": "29cf3f54ab937b56dd1655a384bbf4941f9f1124", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5Y2YzZjU0YWI5MzdiNTZkZDE2NTVhMzg0YmJmNDk0MWY5ZjExMjQ=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2019-04-29T12:38:25Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2019-04-29T12:38:25Z"}, "message": "compiletest: Make LLVM's bin directory available to run-make-fulldeps tests.", "tree": {"sha": "e057194f567808bc112e3fa3594f787e3c16d04d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e057194f567808bc112e3fa3594f787e3c16d04d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29cf3f54ab937b56dd1655a384bbf4941f9f1124", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29cf3f54ab937b56dd1655a384bbf4941f9f1124", "html_url": "https://github.com/rust-lang/rust/commit/29cf3f54ab937b56dd1655a384bbf4941f9f1124", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29cf3f54ab937b56dd1655a384bbf4941f9f1124/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4dc3b99b27623dc142998d9009f64bcf48b9c7b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/4dc3b99b27623dc142998d9009f64bcf48b9c7b2", "html_url": "https://github.com/rust-lang/rust/commit/4dc3b99b27623dc142998d9009f64bcf48b9c7b2"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "8082e2468c522884da7b93e2b1ab60f75139fa04", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=29cf3f54ab937b56dd1655a384bbf4941f9f1124", "patch": "@@ -1231,6 +1231,13 @@ impl Step for Compiletest {\n                 if let Some(ar) = builder.ar(target) {\n                     cmd.arg(\"--ar\").arg(ar);\n                 }\n+\n+                // The llvm/bin directory contains many useful cross-platform\n+                // tools. Pass the path to run-make tests so they can use them.\n+                let llvm_bin_path = llvm_config.parent()\n+                    .expect(\"Expected llvm-config to be contained in directory\");\n+                assert!(llvm_bin_path.is_dir());\n+                cmd.arg(\"--llvm-bin-dir\").arg(llvm_bin_path);\n             }\n         }\n "}, {"sha": "4699dee1716a9ac690bdccc662adb628dfaa27ef", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=29cf3f54ab937b56dd1655a384bbf4941f9f1124", "patch": "@@ -144,6 +144,9 @@ pub struct Config {\n     /// The LLVM `FileCheck` binary path.\n     pub llvm_filecheck: Option<PathBuf>,\n \n+    /// Path to LLVM's bin directory.\n+    pub llvm_bin_dir: Option<PathBuf>,\n+\n     /// The valgrind path.\n     pub valgrind_path: Option<String>,\n "}, {"sha": "dc5d1b9a853efd62011c206225c8270e1232bf6b", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=29cf3f54ab937b56dd1655a384bbf4941f9f1124", "patch": "@@ -221,6 +221,7 @@ pub fn parse_config(args: Vec<String>) -> Config {\n             \"LIST\",\n         )\n         .reqopt(\"\", \"llvm-cxxflags\", \"C++ flags for LLVM\", \"FLAGS\")\n+        .optopt(\"\", \"llvm-bin-dir\", \"Path to LLVM's `bin` directory\", \"PATH\")\n         .optopt(\"\", \"nodejs\", \"the name of nodejs\", \"PATH\")\n         .optopt(\n             \"\",\n@@ -306,7 +307,8 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         valgrind_path: matches.opt_str(\"valgrind-path\"),\n         force_valgrind: matches.opt_present(\"force-valgrind\"),\n         run_clang_based_tests_with: matches.opt_str(\"run-clang-based-tests-with\"),\n-        llvm_filecheck: matches.opt_str(\"llvm-filecheck\").map(|s| PathBuf::from(&s)),\n+        llvm_filecheck: matches.opt_str(\"llvm-filecheck\").map(PathBuf::from),\n+        llvm_bin_dir: matches.opt_str(\"llvm-bin-dir\").map(PathBuf::from),\n         src_base,\n         build_base: opt_path(matches, \"build-base\"),\n         stage_id: matches.opt_str(\"stage-id\").unwrap(),"}, {"sha": "42f9cdb7886fd5eeee66e4b5cb8d993b2bc63566", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29cf3f54ab937b56dd1655a384bbf4941f9f1124/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=29cf3f54ab937b56dd1655a384bbf4941f9f1124", "patch": "@@ -2695,6 +2695,10 @@ impl<'test> TestCx<'test> {\n             cmd.env(\"LLVM_FILECHECK\", filecheck);\n         }\n \n+        if let Some(ref llvm_bin_dir) = self.config.llvm_bin_dir {\n+            cmd.env(\"LLVM_BIN_DIR\", llvm_bin_dir);\n+        }\n+\n         // We don't want RUSTFLAGS set from the outside to interfere with\n         // compiler flags set in the test cases:\n         cmd.env_remove(\"RUSTFLAGS\");"}]}