{"sha": "d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ1YzMwMGIxZjJlOWE2ZjdmMDViMmZhNTFjYTJiNGQwMTFkMjg5ZjQ=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-01T03:51:35Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-02T16:38:07Z"}, "message": "Report that `doc(plugins)` doesn't work using diagnostics instead of `println!`\n\nThis also adds a test for the output and fixes `rustc_attr` to properly\nknow that `plugins` is a valid attribute.", "tree": {"sha": "c0c371de2ebc85a92b6f6f4ef37cef9e40ff6129", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0c371de2ebc85a92b6f6f4ef37cef9e40ff6129"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "html_url": "https://github.com/rust-lang/rust/commit/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44c2794976986677c4f5524f63562d02e0e53d57", "url": "https://api.github.com/repos/rust-lang/rust/commits/44c2794976986677c4f5524f63562d02e0e53d57", "html_url": "https://github.com/rust-lang/rust/commit/44c2794976986677c4f5524f63562d02e0e53d57"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "d0ab0d657d9e5d5aa70abadd6f7c525827dbb59c", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "patch": "@@ -559,7 +559,8 @@ impl CheckAttrVisitor<'tcx> {\n                             sym::masked,\n                             sym::no_default_passes, // deprecated\n                             sym::no_inline,\n-                            sym::passes, // deprecated\n+                            sym::passes,  // deprecated\n+                            sym::plugins, // removed, but rustdoc warns about it itself\n                             sym::primitive,\n                             sym::spotlight,\n                             sym::test,"}, {"sha": "19821c3ccefd258fc063b496f22d32dc0a1b6ff5", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "patch": "@@ -572,6 +572,8 @@ crate fn run_global_ctxt(\n \n         if name == \"no_default_passes\" {\n             msg.help(\"you may want to use `#![doc(document_private_items)]`\");\n+        } else if name.starts_with(\"plugins\") {\n+            msg.warn(\"`#![doc(plugins = \\\"...\\\")]` no longer functions; see CVE-2018-1000622 <https://nvd.nist.gov/vuln/detail/CVE-2018-1000622>\");\n         }\n \n         msg.emit();\n@@ -618,10 +620,6 @@ crate fn run_global_ctxt(\n                 }\n                 sym::plugins => {\n                     report_deprecated_attr(\"plugins = \\\"...\\\"\", diag, attr.span());\n-                    eprintln!(\n-                        \"WARNING: `#![doc(plugins = \\\"...\\\")]` \\\n-                         no longer functions; see CVE-2018-1000622\"\n-                    );\n                     continue;\n                 }\n                 _ => continue,"}, {"sha": "5febc5eb9cd543221f6836b897d332f06005ca48", "filename": "src/test/rustdoc-ui/deprecated-attrs.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.rs?ref=d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "patch": "@@ -11,3 +11,7 @@\n //~| NOTE see issue #44136\n //~| WARNING ignoring unknown pass\n //~| NOTE `collapse-docs` pass was removed\n+#![doc(plugins = \"xxx\")]\n+//~^ WARNING attribute is deprecated\n+//~| NOTE see issue #44136\n+//~| WARNING no longer functions; see CVE"}, {"sha": "b855cedf5223e246222b2e3a35baa02dd21e97e7", "filename": "src/test/rustdoc-ui/deprecated-attrs.stderr", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr?ref=d5c300b1f2e9a6f7f05b2fa51ca2b4d011d289f4", "patch": "@@ -29,5 +29,14 @@ LL | #![doc(passes = \"collapse-docs unindent-comments\")]\n    |\n    = note: the `collapse-docs` pass was removed in #80261 <https://github.com/rust-lang/rust/pull/80261>\n \n-warning: 4 warnings emitted\n+warning: the `#![doc(plugins = \"...\")]` attribute is deprecated\n+  --> $DIR/deprecated-attrs.rs:14:8\n+   |\n+LL | #![doc(plugins = \"xxx\")]\n+   |        ^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #44136 <https://github.com/rust-lang/rust/issues/44136> for more information\n+   = warning: `#![doc(plugins = \"...\")]` no longer functions; see CVE-2018-1000622 <https://nvd.nist.gov/vuln/detail/CVE-2018-1000622>\n+\n+warning: 5 warnings emitted\n "}]}