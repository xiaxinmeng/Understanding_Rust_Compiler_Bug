{"sha": "ef97764dcc45493eebe0332acf4b2410583af5e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmOTc3NjRkY2M0NTQ5M2VlYmUwMzMyYWNmNGIyNDEwNTgzYWY1ZTQ=", "commit": {"author": {"name": "Yusuke Tanaka", "email": "yusuktan@maguro.dev", "date": "2021-02-10T14:57:56Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-03-02T09:37:30Z"}, "message": "Move wrong_transmute to its own module", "tree": {"sha": "955573fabfe86b4d0a8e2c6206ab1f7633052053", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/955573fabfe86b4d0a8e2c6206ab1f7633052053"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef97764dcc45493eebe0332acf4b2410583af5e4", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmA+B1oACgkQHKDfKvWd\naKUyrhAArqBYZ3P8IhK+4NOnshxWwTVW7wHHDfD7LV/QLBwmeoFrHaBnFcDudFUN\niEw7GcLF8qnoJYYaZgnRLiNHNaNEelSTrW0fEFR5+wVLIZqQL/cp9GrS3XAwJN2k\nfUKi7gmkIOChXqGd5uL0ilMearLeDZNSiEhyB+Sx3Sb+8lZcLitr3mN6nzQy6Lc7\nrX2vxFGJ+hIFLVhJPNRops0I/MILSrgaqgag/UzuEsXqPSxdWR/GaH/3943iA2iP\niidwdqPFoPgI1XCcK1kY/RWzY7ino6wxk/tBPCdzNhhUR1MDgaRGo6x4buo662wu\nScnTQoz2L/jXEdeIWIWtDHJ+KkKCaB/BLrSmRNEcWJM9VO8u36mdZGgzehQDRTR5\n619jeoPbTjohsAkmZApBF+zZs5mzftbhNB3O+d7T7sGZpaj24dGo0GpHlydP+n5q\nJPGEZpJz5UUsianCY4NiDQ4a9/+w+1vXTsks7Jz2DImSn0072EI2muuvhDZXXWg+\nGS7AlW5DaBzlIvpFtO4O3Yw6ng/uxgM+HD8r5x3ryHLdo9iuq4KtKW86+npfavRj\nYff4PxRbX4++x5KXxPaTS4ISYMWCzMVP8kKL/Tooowzjswn5XGb5F7ee18GKyeAg\nsG7Dc/0lGrjRyhTSnApc6g0mYh3WcJNayaSnvFZ7dn/z+BTTrck=\n=flN9\n-----END PGP SIGNATURE-----", "payload": "tree 955573fabfe86b4d0a8e2c6206ab1f7633052053\nparent 0d7dd00860e5a2b8b7c7a34daaa5553ff2e542f3\nauthor Yusuke Tanaka <yusuktan@maguro.dev> 1612969076 +0900\ncommitter flip1995 <philipp.krones@embecosm.com> 1614677850 +0100\n\nMove wrong_transmute to its own module\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef97764dcc45493eebe0332acf4b2410583af5e4", "html_url": "https://github.com/rust-lang/rust/commit/ef97764dcc45493eebe0332acf4b2410583af5e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef97764dcc45493eebe0332acf4b2410583af5e4/comments", "author": {"login": "magurotuna", "id": 23649474, "node_id": "MDQ6VXNlcjIzNjQ5NDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23649474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magurotuna", "html_url": "https://github.com/magurotuna", "followers_url": "https://api.github.com/users/magurotuna/followers", "following_url": "https://api.github.com/users/magurotuna/following{/other_user}", "gists_url": "https://api.github.com/users/magurotuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/magurotuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magurotuna/subscriptions", "organizations_url": "https://api.github.com/users/magurotuna/orgs", "repos_url": "https://api.github.com/users/magurotuna/repos", "events_url": "https://api.github.com/users/magurotuna/events{/privacy}", "received_events_url": "https://api.github.com/users/magurotuna/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d7dd00860e5a2b8b7c7a34daaa5553ff2e542f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d7dd00860e5a2b8b7c7a34daaa5553ff2e542f3", "html_url": "https://github.com/rust-lang/rust/commit/0d7dd00860e5a2b8b7c7a34daaa5553ff2e542f3"}], "stats": {"total": 34, "additions": 28, "deletions": 6}, "files": [{"sha": "09e0fe257a5ee571c15ade2caee539f054715587", "filename": "clippy_lints/src/transmute/mod.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ef97764dcc45493eebe0332acf4b2410583af5e4/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef97764dcc45493eebe0332acf4b2410583af5e4/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs?ref=ef97764dcc45493eebe0332acf4b2410583af5e4", "patch": "@@ -1,5 +1,6 @@\n mod useless_transmute;\n mod utils;\n+mod wrong_transmute;\n \n use utils::*;\n \n@@ -350,14 +351,12 @@ impl<'tcx> LateLintPass<'tcx> for Transmute {\n                 if triggered {\n                     return;\n                 }\n+                let triggered = wrong_transmute::check(cx, e, from_ty, to_ty);\n+                if triggered {\n+                    return;\n+                }\n \n                 match (&from_ty.kind(), &to_ty.kind()) {\n-                    (ty::Float(_) | ty::Char, ty::Ref(..) | ty::RawPtr(_)) => span_lint(\n-                        cx,\n-                        WRONG_TRANSMUTE,\n-                        e.span,\n-                        &format!(\"transmute from a `{}` to a pointer\", from_ty),\n-                    ),\n                     (ty::RawPtr(from_ptr), _) if from_ptr.ty == to_ty => span_lint(\n                         cx,\n                         CROSSPOINTER_TRANSMUTE,"}, {"sha": "d2d3f0a9c8902b18c82f6cb21cc8e4bb15362871", "filename": "clippy_lints/src/transmute/wrong_transmute.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/ef97764dcc45493eebe0332acf4b2410583af5e4/clippy_lints%2Fsrc%2Ftransmute%2Fwrong_transmute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef97764dcc45493eebe0332acf4b2410583af5e4/clippy_lints%2Fsrc%2Ftransmute%2Fwrong_transmute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Fwrong_transmute.rs?ref=ef97764dcc45493eebe0332acf4b2410583af5e4", "patch": "@@ -0,0 +1,23 @@\n+use super::WRONG_TRANSMUTE;\n+use crate::utils::span_lint;\n+use rustc_hir::Expr;\n+use rustc_lint::LateContext;\n+use rustc_middle::ty;\n+use rustc_middle::ty::Ty;\n+\n+/// Checks for `wrong_transmute` lint.\n+/// Returns `true` if it's triggered, otherwise returns `false`.\n+pub(super) fn check<'tcx>(cx: &LateContext<'tcx>, e: &'tcx Expr<'_>, from_ty: Ty<'tcx>, to_ty: Ty<'tcx>) -> bool {\n+    match (&from_ty.kind(), &to_ty.kind()) {\n+        (ty::Float(_) | ty::Char, ty::Ref(..) | ty::RawPtr(_)) => {\n+            span_lint(\n+                cx,\n+                WRONG_TRANSMUTE,\n+                e.span,\n+                &format!(\"transmute from a `{}` to a pointer\", from_ty),\n+            );\n+            true\n+        },\n+        _ => false,\n+    }\n+}"}]}