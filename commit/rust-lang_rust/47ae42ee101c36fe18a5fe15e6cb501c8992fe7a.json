{"sha": "47ae42ee101c36fe18a5fe15e6cb501c8992fe7a", "node_id": "C_kwDOAAsO6NoAKDQ3YWU0MmVlMTAxYzM2ZmUxOGE1ZmUxNWU2Y2I1MDFjODk5MmZlN2E", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-04-01T22:14:18Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-04-01T22:14:18Z"}, "message": "Only create graphviz nodes for reachable MIR bb's", "tree": {"sha": "63fc6738ab6064bd8c8569af00f8d714ab84f95b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/63fc6738ab6064bd8c8569af00f8d714ab84f95b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a", "html_url": "https://github.com/rust-lang/rust/commit/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9535c0b7d64290b27c4a116262402cd12f77833", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9535c0b7d64290b27c4a116262402cd12f77833", "html_url": "https://github.com/rust-lang/rust/commit/b9535c0b7d64290b27c4a116262402cd12f77833"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "c188105eae89f44e716e532773fc20a19b13b59d", "filename": "compiler/rustc_mir_dataflow/src/framework/graphviz.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47ae42ee101c36fe18a5fe15e6cb501c8992fe7a/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fframework%2Fgraphviz.rs?ref=47ae42ee101c36fe18a5fe15e6cb501c8992fe7a", "patch": "@@ -6,6 +6,7 @@ use std::{io, ops, str};\n \n use regex::Regex;\n use rustc_graphviz as dot;\n+use rustc_index::bit_set::BitSet;\n use rustc_middle::mir::graphviz_safe_def_name;\n use rustc_middle::mir::{self, BasicBlock, Body, Location};\n \n@@ -34,14 +35,16 @@ where\n     body: &'a Body<'tcx>,\n     results: &'a Results<'tcx, A>,\n     style: OutputStyle,\n+    reachable: BitSet<BasicBlock>,\n }\n \n impl<'a, 'tcx, A> Formatter<'a, 'tcx, A>\n where\n     A: Analysis<'tcx>,\n {\n     pub fn new(body: &'a Body<'tcx>, results: &'a Results<'tcx, A>, style: OutputStyle) -> Self {\n-        Formatter { body, results, style }\n+        let reachable = mir::traversal::reachable_as_bitset(body);\n+        Formatter { body, results, style, reachable }\n     }\n }\n \n@@ -108,7 +111,12 @@ where\n     type Edge = CfgEdge;\n \n     fn nodes(&self) -> dot::Nodes<'_, Self::Node> {\n-        self.body.basic_blocks.indices().collect::<Vec<_>>().into()\n+        self.body\n+            .basic_blocks\n+            .indices()\n+            .filter(|&idx| self.reachable.contains(idx))\n+            .collect::<Vec<_>>()\n+            .into()\n     }\n \n     fn edges(&self) -> dot::Edges<'_, Self::Edge> {"}]}