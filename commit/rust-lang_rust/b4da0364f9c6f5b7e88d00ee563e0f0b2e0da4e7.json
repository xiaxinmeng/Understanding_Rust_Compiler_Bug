{"sha": "b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0ZGEwMzY0ZjljNmY1YjdlODhkMDBlZTU2M2UwZjBiMmUwZGE0ZTc=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-05-22T00:32:12Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-05-22T00:32:12Z"}, "message": "Merge pull request #2413 from erickt/master\n\na couple misc changes", "tree": {"sha": "8048dedaa27ede964ba72a4b9b16cacf25a2c4f9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8048dedaa27ede964ba72a4b9b16cacf25a2c4f9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "html_url": "https://github.com/rust-lang/rust/commit/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d8cffa9918d4a28ca852c47cb48875e29bbe6bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d8cffa9918d4a28ca852c47cb48875e29bbe6bc", "html_url": "https://github.com/rust-lang/rust/commit/6d8cffa9918d4a28ca852c47cb48875e29bbe6bc"}, {"sha": "24cfe29a8a4f4fe4dba16191508e44f98d92ed7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/24cfe29a8a4f4fe4dba16191508e44f98d92ed7f", "html_url": "https://github.com/rust-lang/rust/commit/24cfe29a8a4f4fe4dba16191508e44f98d92ed7f"}], "stats": {"total": 51, "additions": 42, "deletions": 9}, "files": [{"sha": "aeb272d6b26eda2e3cda7266d15ee3dbdcd96ca8", "filename": "src/cargo/cargo.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Fcargo%2Fcargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Fcargo%2Fcargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcargo%2Fcargo.rs?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -18,13 +18,7 @@ import vec;\n import std::getopts;\n import getopts::{optflag, optopt, opt_present};\n \n-enum _src {\n-    /* Break cycles in package <-> source */\n-    _source(source),\n-}\n-\n type package = {\n-//    source: _src,\n     name: str,\n     uuid: str,\n     url: str,\n@@ -293,7 +287,6 @@ fn load_one_source_package(&src: source, p: map::hashmap<str, json::json>) {\n     };\n \n     vec::grow(src.packages, 1u, {\n-        // source: _source(src),\n         name: name,\n         uuid: uuid,\n         url: url,"}, {"sha": "e210ab0944c418ae8f384905a49a6488310bf2a5", "filename": "src/libcore/io.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibcore%2Fio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibcore%2Fio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fio.rs?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -161,6 +161,24 @@ impl reader_util for reader {\n         while !self.eof() { buf += self.read_bytes(2048u); }\n         buf\n     }\n+\n+    fn each_byte(it: fn(int) -> bool) {\n+        while !self.eof() {\n+            if !it(self.read_byte()) { break; }\n+        }\n+    }\n+\n+    fn each_char(it: fn(char) -> bool) {\n+        while !self.eof() {\n+            if !it(self.read_char()) { break; }\n+        }\n+    }\n+\n+    fn each_line(it: fn(str) -> bool) {\n+        while !self.eof() {\n+            if !it(self.read_line()) { break; }\n+        }\n+    }\n }\n \n // Reader implementations"}, {"sha": "3f62c6764ed229d8a22d74073bdf7bd3b80fafcf", "filename": "src/libstd/sha1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibstd%2Fsha1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibstd%2Fsha1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsha1.rs?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -1,7 +1,7 @@\n #[doc =\"\n An implementation of the SHA-1 cryptographic hash.\n \n-First create a `sha1` object using the `mk_sha1` constructor, then\n+First create a `sha1` object using the `sha1` constructor, then\n feed it input using the `input` or `input_str` methods, which may be\n called any number of times.\n "}, {"sha": "2c7902c63e9d9bf2f7d21265d30f76a45b553bce", "filename": "src/libstd/time.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibstd%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Flibstd%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftime.rs?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -7,6 +7,7 @@ export\n     get_time,\n     precise_time_ns,\n     precise_time_s,\n+    tzset,\n     tm,\n     empty_tm,\n     now,\n@@ -20,6 +21,7 @@ native mod rustrt {\n     fn get_time(&sec: i64, &nsec: i32);\n     fn precise_time_ns(&ns: u64);\n \n+    fn rust_tzset();\n     // FIXME: The i64 values can be passed by-val when #2064 is fixed.\n     fn rust_gmtime(&&sec: i64, &&nsec: i32, &&result: tm);\n     fn rust_localtime(&&sec: i64, &&nsec: i32, &&result: tm);\n@@ -59,6 +61,10 @@ fn precise_time_s() -> float {\n     ret (precise_time_ns() as float) / 1000000000.;\n }\n \n+fn tzset() {\n+    rustrt::rust_tzset();\n+}\n+\n type tm = {\n     tm_sec: i32, // seconds after the minute [0-60]\n     tm_min: i32, // minutes after the hour [0-59]\n@@ -869,6 +875,7 @@ mod tests {\n     #[test]\n     fn test_at_utc() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -890,10 +897,13 @@ mod tests {\n     #[test]\n     fn test_at() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let local = at(time);\n \n+        #error(\"time_at: %?\", local);\n+\n         assert local.tm_sec == 30_i32;\n         assert local.tm_min == 31_i32;\n         assert local.tm_hour == 15_i32;\n@@ -916,6 +926,7 @@ mod tests {\n     #[test]\n     fn test_to_timespec() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -927,6 +938,7 @@ mod tests {\n     #[test]\n     fn test_conversions() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -943,6 +955,7 @@ mod tests {\n     #[test]\n     fn test_strptime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         alt strptime(\"\", \"\") {\n           ok(tm) {\n@@ -1088,18 +1101,22 @@ mod tests {\n     #[test]\n     fn test_ctime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc   = at_utc(time);\n         let local = at(time);\n \n+        #error(\"test_ctime: %? %?\", utc.ctime(), local.ctime());\n+\n         assert utc.ctime()   == \"Fri Feb 13 23:31:30 2009\";\n         assert local.ctime() == \"Fri Feb 13 15:31:30 2009\";\n     }\n \n     #[test]\n     fn test_strftime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);"}, {"sha": "aa7597f6a26a10be6af7640eea758fa6cc8249e7", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -529,6 +529,11 @@ struct tm* LOCALTIME(const time_t *clock, tm *result) {\n #define TIMEGM(result) timegm(result)\n #endif\n \n+extern \"C\" CDECL void\n+rust_tzset() {\n+    TZSET();\n+}\n+\n extern \"C\" CDECL void\n rust_gmtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n     tm tm;\n@@ -541,7 +546,6 @@ rust_gmtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n extern \"C\" CDECL void\n rust_localtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n     tm tm;\n-    TZSET();\n     time_t s = *sec;\n     LOCALTIME(&s, &tm);\n "}, {"sha": "6cf024a7dee537872e4adcb347466b790d101363", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=b4da0364f9c6f5b7e88d00ee563e0f0b2e0da4e7", "patch": "@@ -12,6 +12,7 @@ debug_abi_2\n get_port_id\n get_task_id\n get_time\n+rust_tzset\n rust_gmtime\n rust_localtime\n rust_timegm"}]}