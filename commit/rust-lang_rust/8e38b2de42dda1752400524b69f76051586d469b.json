{"sha": "8e38b2de42dda1752400524b69f76051586d469b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlMzhiMmRlNDJkZGExNzUyNDAwNTI0YjY5Zjc2MDUxNTg2ZDQ2OWI=", "commit": {"author": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-19T08:39:19Z"}, "committer": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-20T13:43:59Z"}, "message": "rustbuild: package src only once for build triple", "tree": {"sha": "5d8ce3f64e64a6a64e87bb3a75b50cdeee19416c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d8ce3f64e64a6a64e87bb3a75b50cdeee19416c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e38b2de42dda1752400524b69f76051586d469b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYWTWfAAoJEDhUS04t5/q57E0P/1U9NFB/Wobo7ThROUeW8Jl4\n+UfIeQGv2WkZ+ogZJZvW7RaIXCf9DarRe4uHfVY+bJztw/NAT96Ya35MpzPiqzkq\n61UBJ44Mdx3T9yUiXd2gcVGYGu2N7OEECyqSiSdW7vg4mmRGhGbiBiQHyEH7CQP0\n4u7rvVh2t47eqTS3eoT2pBrWE73DnSCzoNthJeUCZhXaA+xUBTFXAcnEDe19f3ww\nUL3Dj5cnj7bsiQbJV+yhtWvT6s+YIrck32EKU7e3dz5hCrkQ0QXpNdP25H5QOGgK\nqG1P36c3Lq5pwGePjSYyL+sppf6ix8T8/ptJFy7xVc+0YA0y8nQhdwACxKYmWcZq\n6hP3ULA1E3aeaQoodC1CA6pZlg5JsdHlPsSMkK51H3/eB/wnWGD1fOy7zhGgEvxM\nxM3lRTQSw6ZE94qGXi5JY/z8pxb8Sq9YitRiPoAv6y1Z6EodnCKPj3bhoESZ8uXR\nb0ES0yHUDKssrxM100u41MVBwbA6CPnNf1FlEMMcc5svYHT7ERR+7XOmmf/J7/Mv\npQEJ3CHBPyo4aV4qIHU3N3LXoTUUf5xBoRyndrhgPny42mGwoqCcNKYEiY1oVnex\nCHQhske4NvTrQDhLsaBrfHgdStluM1qR0CC2fuXyo3Xk3Ma5lVmGeBUquf7DlNBO\nr+j8MIp+647zG55je7ae\n=dHY2\n-----END PGP SIGNATURE-----", "payload": "tree 5d8ce3f64e64a6a64e87bb3a75b50cdeee19416c\nparent 46d74eac236c7b58c848a471d81f9d5c59362513\nauthor Wang Xuerui <git@xen0n.name> 1482136759 +0800\ncommitter Wang Xuerui <git@xen0n.name> 1482241439 +0800\n\nrustbuild: package src only once for build triple\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e38b2de42dda1752400524b69f76051586d469b", "html_url": "https://github.com/rust-lang/rust/commit/8e38b2de42dda1752400524b69f76051586d469b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e38b2de42dda1752400524b69f76051586d469b/comments", "author": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46d74eac236c7b58c848a471d81f9d5c59362513", "url": "https://api.github.com/repos/rust-lang/rust/commits/46d74eac236c7b58c848a471d81f9d5c59362513", "html_url": "https://github.com/rust-lang/rust/commit/46d74eac236c7b58c848a471d81f9d5c59362513"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "6e3174ed2f6d00cc6939c9f61f96414fe9634dd2", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8e38b2de42dda1752400524b69f76051586d469b/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e38b2de42dda1752400524b69f76051586d469b/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=8e38b2de42dda1752400524b69f76051586d469b", "patch": "@@ -346,8 +346,14 @@ pub fn analysis(build: &Build, compiler: &Compiler, target: &str) {\n }\n \n /// Creates the `rust-src` installer component and the plain source tarball\n-pub fn rust_src(build: &Build) {\n+pub fn rust_src(build: &Build, host: &str) {\n     println!(\"Dist src\");\n+\n+    if host != build.config.build {\n+        println!(\"\\tskipping, not a build host\");\n+        return\n+    }\n+\n     let plain_name = format!(\"rustc-{}-src\", package_vers(build));\n     let name = format!(\"rust-src-{}\", package_vers(build));\n     let image = tmpdir(build).join(format!(\"{}-image\", name));"}, {"sha": "719fb82a56dcedda3d0bce32ed18970bacc6aadc", "filename": "src/bootstrap/step.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8e38b2de42dda1752400524b69f76051586d469b/src%2Fbootstrap%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e38b2de42dda1752400524b69f76051586d469b/src%2Fbootstrap%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fstep.rs?ref=8e38b2de42dda1752400524b69f76051586d469b", "patch": "@@ -499,7 +499,7 @@ pub fn build_rules(build: &Build) -> Rules {\n     rules.dist(\"dist-src\", \"src\")\n          .default(true)\n          .host(true)\n-         .run(move |_| dist::rust_src(build));\n+         .run(move |s| dist::rust_src(build, s.target));\n     rules.dist(\"dist-docs\", \"src/doc\")\n          .default(true)\n          .dep(|s| s.name(\"default:doc\"))"}]}