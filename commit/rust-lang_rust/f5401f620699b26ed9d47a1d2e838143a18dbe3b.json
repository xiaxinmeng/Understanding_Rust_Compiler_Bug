{"sha": "f5401f620699b26ed9d47a1d2e838143a18dbe3b", "node_id": "C_kwDOAAsO6NoAKGY1NDAxZjYyMDY5OWIyNmVkOWQ0N2ExZDJlODM4MTQzYTE4ZGJlM2I", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-24T06:55:02Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-24T06:55:02Z"}, "message": "Auto merge of #14175 - jmviz:openDocs-context-menu, r=lnicola\n\nadd openDocs command to context menu in VS Code extension\n\nThis adds the `openDocs` command to the VS Code context menu. I believe there are probably many user who are unaware of this command existing in the rust analyzer extension, and that this should enhance the discoverability of the command. Additionally, even if people are aware of this capability, it's helpful to have this in the context menu anyway; for example, one might forget the name of the command, or the keybinding they have assigned to it. I think that opening docs is a common enough action to warrant the extra line added to the context menu.\n\nThis makes a few other small changes as well. There are two minor style changes to increase style consistency. First, it changes the titles of the two commands that the rust analyzer extension will contribute to the context menu to title case. All standard VS Code commands that appear in the context menu are in title case. Second, it shortens the title of the `openDocs` command from `Open docs under cursor` to `Open Docs`. The implicit assumption in the standard VS Code context menu command titles is that the action applies to the symbol under the cursor: `Go to Definition`, `Find All References`, etc. Note that since these are changes to the command titles, rather than the command names themselves, these changes will not break any users' existing keybindings for these commands.\n\nSecond, this adds further restrictions to the `where` clauses of the two commands that the rust analyzer extension will contribute to the context menu, so that the two commands will appear in the context menu only when in a Rust project **and** within a Rust file. Say you have a Python or bash script inside your Rust project. Having these commands appear in the context menu when you right click a symbol in such a non-Rust file is extraneous and potentially confusing.\n\n![demonstration](https://user-images.githubusercontent.com/6609145/219976062-b46ab21b-5753-48f5-a1da-562566cae71c.gif)", "tree": {"sha": "152e2e82e9067a89c1a379c066d76f04bf0c48fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/152e2e82e9067a89c1a379c066d76f04bf0c48fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5401f620699b26ed9d47a1d2e838143a18dbe3b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5401f620699b26ed9d47a1d2e838143a18dbe3b", "html_url": "https://github.com/rust-lang/rust/commit/f5401f620699b26ed9d47a1d2e838143a18dbe3b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5401f620699b26ed9d47a1d2e838143a18dbe3b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27239fbb58a115915ffc1ce65ededc951eb00fd2", "url": "https://api.github.com/repos/rust-lang/rust/commits/27239fbb58a115915ffc1ce65ededc951eb00fd2", "html_url": "https://github.com/rust-lang/rust/commit/27239fbb58a115915ffc1ce65ededc951eb00fd2"}, {"sha": "dd92e4a507f2783507f3a37b94c3a80d48def3d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd92e4a507f2783507f3a37b94c3a80d48def3d3", "html_url": "https://github.com/rust-lang/rust/commit/dd92e4a507f2783507f3a37b94c3a80d48def3d3"}], "stats": {"total": 31, "additions": 23, "deletions": 8}, "files": [{"sha": "339bb28180221c24cb28b6bc4dd55784034b2228", "filename": "crates/ide/src/doc_links.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f5401f620699b26ed9d47a1d2e838143a18dbe3b/crates%2Fide%2Fsrc%2Fdoc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5401f620699b26ed9d47a1d2e838143a18dbe3b/crates%2Fide%2Fsrc%2Fdoc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdoc_links.rs?ref=f5401f620699b26ed9d47a1d2e838143a18dbe3b", "patch": "@@ -107,7 +107,18 @@ pub(crate) fn remove_links(markdown: &str) -> String {\n     out\n }\n \n-/// Retrieve a link to documentation for the given symbol.\n+// Feature: Open Docs\n+//\n+// Retrieve a link to documentation for the given symbol.\n+//\n+// The simplest way to use this feature is via the context menu. Right-click on\n+// the selected item. The context menu opens. Select **Open Docs**.\n+//\n+// |===\n+// | Editor  | Action Name\n+//\n+// | VS Code | **rust-analyzer: Open Docs**\n+// |===\n pub(crate) fn external_docs(\n     db: &RootDatabase,\n     position: &FilePosition,"}, {"sha": "af53adee898af8b724822b919cc4c50157066a51", "filename": "crates/ide/src/runnables.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f5401f620699b26ed9d47a1d2e838143a18dbe3b/crates%2Fide%2Fsrc%2Frunnables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5401f620699b26ed9d47a1d2e838143a18dbe3b/crates%2Fide%2Fsrc%2Frunnables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frunnables.rs?ref=f5401f620699b26ed9d47a1d2e838143a18dbe3b", "patch": "@@ -195,14 +195,13 @@ pub(crate) fn runnables(db: &RootDatabase, file_id: FileId) -> Vec<Runnable> {\n //\n // Provides a sneak peek of all tests where the current item is used.\n //\n-// The simplest way to use this feature is via the context menu:\n-//  - Right-click on the selected item. The context menu opens.\n-//  - Select **Peek related tests**\n+// The simplest way to use this feature is via the context menu. Right-click on\n+// the selected item. The context menu opens. Select **Peek Related Tests**.\n //\n // |===\n // | Editor  | Action Name\n //\n-// | VS Code | **rust-analyzer: Peek related tests**\n+// | VS Code | **rust-analyzer: Peek Related Tests**\n // |===\n pub(crate) fn related_tests(\n     db: &RootDatabase,"}, {"sha": "631f31c17ea64c518b730738daf0df2f4dedb34f", "filename": "editors/code/package.json", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f5401f620699b26ed9d47a1d2e838143a18dbe3b/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/f5401f620699b26ed9d47a1d2e838143a18dbe3b/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=f5401f620699b26ed9d47a1d2e838143a18dbe3b", "patch": "@@ -226,7 +226,7 @@\n             },\n             {\n                 \"command\": \"rust-analyzer.openDocs\",\n-                \"title\": \"Open docs under cursor\",\n+                \"title\": \"Open Docs\",\n                 \"category\": \"rust-analyzer\"\n             },\n             {\n@@ -236,7 +236,7 @@\n             },\n             {\n                 \"command\": \"rust-analyzer.peekTests\",\n-                \"title\": \"Peek related tests\",\n+                \"title\": \"Peek Related Tests\",\n                 \"category\": \"rust-analyzer\"\n             },\n             {\n@@ -1869,8 +1869,13 @@\n             \"editor/context\": [\n                 {\n                     \"command\": \"rust-analyzer.peekTests\",\n-                    \"when\": \"inRustProject\",\n+                    \"when\": \"inRustProject && editorTextFocus && editorLangId == rust\",\n                     \"group\": \"navigation@1000\"\n+                },\n+                {\n+                    \"command\": \"rust-analyzer.openDocs\",\n+                    \"when\": \"inRustProject && editorTextFocus && editorLangId == rust\",\n+                    \"group\": \"navigation@1001\"\n                 }\n             ]\n         },"}]}