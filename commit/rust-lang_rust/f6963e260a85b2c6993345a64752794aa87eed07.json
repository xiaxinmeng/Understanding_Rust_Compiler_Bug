{"sha": "f6963e260a85b2c6993345a64752794aa87eed07", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2OTYzZTI2MGE4NWIyYzY5OTMzNDVhNjQ3NTI3OTRhYTg3ZWVkMDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-09T05:26:29Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-09T05:26:29Z"}, "message": "auto merge of #11369 : kvark/rust/master, r=huonw\n\n-Fixed Gc::clone to not require a Clone implementation for T\r\n-Implemented Gc::ptr_eq to match Rc::ptr_eq, added a test for that", "tree": {"sha": "6845367a3ededaf70649126f77ae2a8b03f244db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6845367a3ededaf70649126f77ae2a8b03f244db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6963e260a85b2c6993345a64752794aa87eed07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6963e260a85b2c6993345a64752794aa87eed07", "html_url": "https://github.com/rust-lang/rust/commit/f6963e260a85b2c6993345a64752794aa87eed07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6963e260a85b2c6993345a64752794aa87eed07/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7613b15fdbbb9bf770a2c731f4135886b0ff3cf0", "url": "https://api.github.com/repos/rust-lang/rust/commits/7613b15fdbbb9bf770a2c731f4135886b0ff3cf0", "html_url": "https://github.com/rust-lang/rust/commit/7613b15fdbbb9bf770a2c731f4135886b0ff3cf0"}, {"sha": "5da166314f71804c2c54abcb1a91ccac7866908b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5da166314f71804c2c54abcb1a91ccac7866908b", "html_url": "https://github.com/rust-lang/rust/commit/5da166314f71804c2c54abcb1a91ccac7866908b"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "1b53c70a9a1f27276fe93453ebb2287ebd2cd963", "filename": "src/libstd/gc.rs", "status": "modified", "additions": 25, "deletions": 3, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f6963e260a85b2c6993345a64752794aa87eed07/src%2Flibstd%2Fgc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6963e260a85b2c6993345a64752794aa87eed07/src%2Flibstd%2Fgc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fgc.rs?ref=f6963e260a85b2c6993345a64752794aa87eed07", "patch": "@@ -18,10 +18,10 @@ collector is task-local so `Gc<T>` is not sendable.\n \n use kinds::Send;\n use clone::{Clone, DeepClone};\n+use managed;\n \n /// Immutable garbage-collected pointer type\n #[no_send]\n-#[deriving(Clone)]\n pub struct Gc<T> {\n     priv ptr: @T\n }\n@@ -32,14 +32,26 @@ impl<T: 'static> Gc<T> {\n     pub fn new(value: T) -> Gc<T> {\n         Gc { ptr: @value }\n     }\n-}\n \n-impl<T: 'static> Gc<T> {\n     /// Borrow the value contained in the garbage-collected box\n     #[inline]\n     pub fn borrow<'r>(&'r self) -> &'r T {\n         &*self.ptr\n     }\n+\n+    /// Determine if two garbage-collected boxes point to the same object\n+    #[inline]\n+    pub fn ptr_eq(&self, other: &Gc<T>) -> bool {\n+        managed::ptr_eq(self.ptr, other.ptr)\n+    }\n+}\n+\n+impl<T> Clone for Gc<T> {\n+    /// Clone the pointer only\n+    #[inline]\n+    fn clone(&self) -> Gc<T> {\n+        Gc{ ptr: self.ptr }\n+    }\n }\n \n /// The `Send` bound restricts this to acyclic graphs where it is well-defined.\n@@ -92,6 +104,16 @@ mod tests {\n         assert_eq!(*y.borrow(), 5);\n     }\n \n+    #[test]\n+    fn test_ptr_eq() {\n+        let x = Gc::new(5);\n+        let y = x.clone();\n+        let z = Gc::new(7);\n+        assert!(x.ptr_eq(&x));\n+        assert!(x.ptr_eq(&y));\n+        assert!(!x.ptr_eq(&z));\n+    }\n+\n     #[test]\n     fn test_destructor() {\n         let x = Gc::new(~5);"}]}