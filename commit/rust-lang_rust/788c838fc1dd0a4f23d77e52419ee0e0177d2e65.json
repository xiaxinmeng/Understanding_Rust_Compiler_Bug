{"sha": "788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4OGM4MzhmYzFkZDBhNGYyM2Q3N2U1MjQxOWVlMGUwMTc3ZDJlNjU=", "commit": {"author": {"name": "Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-02T07:18:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-02T07:18:09Z"}, "message": "Merge pull request #3248 from phansch/fix_ice_2831\n\nFix 'impossible case reached' ICE", "tree": {"sha": "9876805fadffae7cd58ef67320671bc9bf9eb874", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9876805fadffae7cd58ef67320671bc9bf9eb874"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbsxuxCRBK7hj4Ov3rIwAAdHIIAJoVCUEfi/8eTewL1AfRxqOd\nGBTFXMV5fqpIPPSExkO29QKmtGqV8fgciGgV92kcjCVweFXFImQh5BeJk36Bmuut\nGfyUxnNdSjID/kCYBcuwr3tk8omKyLoI/YeyaHjqk2JdS+Ug8d8r5sSxbrYsSkuR\nsFuwHinVf9SOTod8dF8KRhEsWe8t4g9kNHW0aguHNfvxOZ8Yeo0sW1TRaGcOG+hb\nLfX8Mqc9oiePQ/nuVXR0IWWdxZ6+TRG2Zm5PiLUX0MPyiLnff54TctRNg0kpUIB+\nO6IRj3Jj7rM5FtWswlcU78fpR+a+s4uiUvYqHdQQ07QFx+tEfZMB8HNMlV3qh6Q=\n=yZFR\n-----END PGP SIGNATURE-----\n", "payload": "tree 9876805fadffae7cd58ef67320671bc9bf9eb874\nparent 5f9af5f69c81367e32deae49e5c200826bab0954\nparent eb5f146f1492cce356883905865f4bb9fc97d8ba\nauthor Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer <github35764891676564198441@oli-obk.de> 1538464689 +0200\ncommitter GitHub <noreply@github.com> 1538464689 +0200\n\nMerge pull request #3248 from phansch/fix_ice_2831\n\nFix 'impossible case reached' ICE"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "html_url": "https://github.com/rust-lang/rust/commit/788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f9af5f69c81367e32deae49e5c200826bab0954", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f9af5f69c81367e32deae49e5c200826bab0954", "html_url": "https://github.com/rust-lang/rust/commit/5f9af5f69c81367e32deae49e5c200826bab0954"}, {"sha": "eb5f146f1492cce356883905865f4bb9fc97d8ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb5f146f1492cce356883905865f4bb9fc97d8ba", "html_url": "https://github.com/rust-lang/rust/commit/eb5f146f1492cce356883905865f4bb9fc97d8ba"}], "stats": {"total": 33, "additions": 27, "deletions": 6}, "files": [{"sha": "73d59d7a33c91a1bce044449a0fb46c6b07931f4", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "patch": "@@ -174,15 +174,14 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n                 (\n                     preds.iter().any(|t| t.def_id() == borrow_trait),\n                     !preds.is_empty() && preds.iter().all(|t| {\n+                        let ty_params = &t.skip_binder().trait_ref.substs.iter().skip(1)\n+                            .cloned()\n+                            .collect::<Vec<_>>();\n                         implements_trait(\n                             cx,\n                             cx.tcx.mk_imm_ref(&RegionKind::ReErased, ty),\n                             t.def_id(),\n-                            &t.skip_binder()\n-                                .input_types()\n-                                .skip(1)\n-                                .map(|ty| ty.into())\n-                                .collect::<Vec<_>>(),\n+                            ty_params\n                         )\n                     }),\n                 )"}, {"sha": "31ad96942d66e9820d53bb4d9957d013d9ffb6c7", "filename": "tests/ui/needless_pass_by_value.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/tests%2Fui%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/tests%2Fui%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_pass_by_value.rs?ref=788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "patch": "@@ -134,4 +134,14 @@ fn test_destructure_copy(x: CopyWrapper, y: CopyWrapper, z: CopyWrapper) {\n     println!(\"{}\", t);\n }\n \n+// The following 3 lines should not cause an ICE. See #2831\n+trait Bar<'a, A> {}\n+impl<'b, T> Bar<'b, T> for T {}\n+fn some_fun<'b, S: Bar<'b, ()>>(_item: S) {}\n+\n+// Also this should not cause an ICE. See #2831\n+trait Club<'a, A> {}\n+impl<T> Club<'static, T> for T {}\n+fn more_fun(_item: impl Club<'static, i32>) {}\n+\n fn main() {}"}, {"sha": "0d4a35363fba7db78604980ea8efcb2872ad01ed", "filename": "tests/ui/needless_pass_by_value.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/tests%2Fui%2Fneedless_pass_by_value.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/788c838fc1dd0a4f23d77e52419ee0e0177d2e65/tests%2Fui%2Fneedless_pass_by_value.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_pass_by_value.stderr?ref=788c838fc1dd0a4f23d77e52419ee0e0177d2e65", "patch": "@@ -184,5 +184,17 @@ help: consider taking a reference instead\n 129 |     let CopyWrapper(s) = *z; // moved\n     |\n \n-error: aborting due to 20 previous errors\n+error: this argument is passed by value, but not consumed in the function body\n+   --> $DIR/needless_pass_by_value.rs:140:40\n+    |\n+140 | fn some_fun<'b, S: Bar<'b, ()>>(_item: S) {}\n+    |                                        ^ help: consider taking a reference instead: `&S`\n+\n+error: this argument is passed by value, but not consumed in the function body\n+   --> $DIR/needless_pass_by_value.rs:145:20\n+    |\n+145 | fn more_fun(_item: impl Club<'static, i32>) {}\n+    |                    ^^^^^^^^^^^^^^^^^^^^^^^ help: consider taking a reference instead: `&impl Club<'static, i32>`\n+\n+error: aborting due to 22 previous errors\n "}]}