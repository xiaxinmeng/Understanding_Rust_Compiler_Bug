{"sha": "c67566ac27b7f578596cb4cc9811d04fdc2eb8e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2NzU2NmFjMjdiN2Y1Nzg1OTZjYjRjYzk4MTFkMDRmZGMyZWI4ZTQ=", "commit": {"author": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2018-06-29T21:13:40Z"}, "committer": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2018-06-29T21:13:40Z"}, "message": "rename the llvm-tools component to llvm-tools-preview and tweak its image", "tree": {"sha": "fc22993a86fdab5ecf3865f56c9ecb167f76d233", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc22993a86fdab5ecf3865f56c9ecb167f76d233"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4", "html_url": "https://github.com/rust-lang/rust/commit/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4/comments", "author": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "committer": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fdcd3aa389aa92879f576c55e429015667143c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fdcd3aa389aa92879f576c55e429015667143c3", "html_url": "https://github.com/rust-lang/rust/commit/5fdcd3aa389aa92879f576c55e429015667143c3"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "b5f34cdf336db67a18e38438d6a06e752c2f7d6c", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c67566ac27b7f578596cb4cc9811d04fdc2eb8e4/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=c67566ac27b7f578596cb4cc9811d04fdc2eb8e4", "patch": "@@ -1787,15 +1787,18 @@ impl Step for LlvmTools {\n         let tmp = tmpdir(builder);\n         let image = tmp.join(\"llvm-tools-image\");\n         drop(fs::remove_dir_all(&image));\n-        t!(fs::create_dir_all(&image.join(\"bin\")));\n \n         // Prepare the image directory\n+        let bindir = builder\n+            .llvm_out(target)\n+            .join(\"bin\");\n+        let dst = image.join(\"lib/rustlib\")\n+            .join(target)\n+            .join(\"bin\");\n+        t!(fs::create_dir_all(&dst));\n         for tool in LLVM_TOOLS {\n-            let exe = builder\n-                .llvm_out(target)\n-                .join(\"bin\")\n-                .join(exe(tool, &target));\n-            builder.install(&exe, &image.join(\"bin\"), 0o755);\n+            let exe = bindir.join(exe(tool, &target));\n+            builder.install(&exe, &dst, 0o755);\n         }\n \n         // Prepare the overlay\n@@ -1818,7 +1821,7 @@ impl Step for LlvmTools {\n             .arg(\"--non-installed-overlay\").arg(&overlay)\n             .arg(format!(\"--package-name={}-{}\", name, target))\n             .arg(\"--legacy-manifest-dirs=rustlib,cargo\")\n-            .arg(\"--component-name=llvm-tools\");\n+            .arg(\"--component-name=llvm-tools-preview\");\n \n \n         builder.run(&mut cmd);"}]}