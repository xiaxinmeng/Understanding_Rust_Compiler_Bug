{"sha": "693df63c7d51aca2bb405a0574717a5d02fd8158", "node_id": "C_kwDOAAsO6NoAKDY5M2RmNjNjN2Q1MWFjYTJiYjQwNWEwNTc0NzE3YTVkMDJmZDgxNTg", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2021-11-01T04:12:43Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2021-11-01T04:12:43Z"}, "message": "Ensure `match_overlapping_arms` warns on first", "tree": {"sha": "41cdea30523719dd4358347d0f15eaafbbdfd977", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41cdea30523719dd4358347d0f15eaafbbdfd977"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/693df63c7d51aca2bb405a0574717a5d02fd8158", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/693df63c7d51aca2bb405a0574717a5d02fd8158", "html_url": "https://github.com/rust-lang/rust/commit/693df63c7d51aca2bb405a0574717a5d02fd8158", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/693df63c7d51aca2bb405a0574717a5d02fd8158/comments", "author": null, "committer": null, "parents": [{"sha": "c3d45775c438c57450317ccc859d3af10ce08972", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3d45775c438c57450317ccc859d3af10ce08972", "html_url": "https://github.com/rust-lang/rust/commit/c3d45775c438c57450317ccc859d3af10ce08972"}], "stats": {"total": 36, "additions": 32, "deletions": 4}, "files": [{"sha": "b552e3fc7afe074dd6469de9ff6444ee17c30d8d", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/693df63c7d51aca2bb405a0574717a5d02fd8158/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/693df63c7d51aca2bb405a0574717a5d02fd8158/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=693df63c7d51aca2bb405a0574717a5d02fd8158", "patch": "@@ -1761,10 +1761,17 @@ where\n         match value {\n             Kind::Start(_, r) => started.push(r),\n             Kind::End(_, er) => {\n-                if let Some(sr) = started.pop() {\n-                    if sr != er {\n-                        return Some((er, sr));\n+                let mut overlap = None;\n+\n+                while let Some(sr) = started.pop() {\n+                    if sr == er {\n+                        break;\n                     }\n+                    overlap = Some(sr);\n+                }\n+\n+                if let Some(sr) = overlap {\n+                    return Some((er, sr));\n                 }\n             },\n         }"}, {"sha": "2f85e63571351cf2023b88e3de3d05e2695d0b21", "filename": "tests/ui/match_overlapping_arm.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/693df63c7d51aca2bb405a0574717a5d02fd8158/tests%2Fui%2Fmatch_overlapping_arm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/693df63c7d51aca2bb405a0574717a5d02fd8158/tests%2Fui%2Fmatch_overlapping_arm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_overlapping_arm.rs?ref=693df63c7d51aca2bb405a0574717a5d02fd8158", "patch": "@@ -116,6 +116,15 @@ fn overlapping() {\n         _ => (),\n     }\n \n+    // Only warn about the first if there are multiple overlaps\n+    match 42u128 {\n+        0..=0x0000_0000_0000_00ff => (),\n+        0..=0x0000_0000_0000_ffff => (),\n+        0..=0x0000_0000_ffff_ffff => (),\n+        0..=0xffff_ffff_ffff_ffff => (),\n+        _ => (),\n+    }\n+\n     if let None = Some(42) {\n         // nothing\n     } else if let None = Some(42) {"}, {"sha": "b81bb1ecfae024fb1201f4ff83ae45222c4b4e3d", "filename": "tests/ui/match_overlapping_arm.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/693df63c7d51aca2bb405a0574717a5d02fd8158/tests%2Fui%2Fmatch_overlapping_arm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/693df63c7d51aca2bb405a0574717a5d02fd8158/tests%2Fui%2Fmatch_overlapping_arm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_overlapping_arm.stderr?ref=693df63c7d51aca2bb405a0574717a5d02fd8158", "patch": "@@ -83,5 +83,17 @@ note: overlaps with this\n LL |         21..=40 => (),\n    |         ^^^^^^^\n \n-error: aborting due to 7 previous errors\n+error: some ranges overlap\n+  --> $DIR/match_overlapping_arm.rs:121:9\n+   |\n+LL |         0..=0x0000_0000_0000_00ff => (),\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: overlaps with this\n+  --> $DIR/match_overlapping_arm.rs:122:9\n+   |\n+LL |         0..=0x0000_0000_0000_ffff => (),\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 8 previous errors\n "}]}