{"sha": "02fe30971ef397bcff3460a9aaf175e0810c2c90", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAyZmUzMDk3MWVmMzk3YmNmZjM0NjBhOWFhZjE3NWUwODEwYzJjOTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-05T09:35:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-05T09:35:17Z"}, "message": "Auto merge of #75888 - GuillaumeGomez:trait-impl-assoc-const-doc-alias, r=ollie27\n\nAdd check for doc alias on assoc const in trait impl\n\nFixes #73721.\n\nr? @ollie27", "tree": {"sha": "b6a3fc425642f8a041d6611779445efca45ab48b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6a3fc425642f8a041d6611779445efca45ab48b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/02fe30971ef397bcff3460a9aaf175e0810c2c90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/02fe30971ef397bcff3460a9aaf175e0810c2c90", "html_url": "https://github.com/rust-lang/rust/commit/02fe30971ef397bcff3460a9aaf175e0810c2c90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/02fe30971ef397bcff3460a9aaf175e0810c2c90/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3364780d2cfddfe329f62a3ec138fd4f9a60e27", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3364780d2cfddfe329f62a3ec138fd4f9a60e27", "html_url": "https://github.com/rust-lang/rust/commit/c3364780d2cfddfe329f62a3ec138fd4f9a60e27"}, {"sha": "b61eab5d514af27009769373360b57dd55036a23", "url": "https://api.github.com/repos/rust-lang/rust/commits/b61eab5d514af27009769373360b57dd55036a23", "html_url": "https://github.com/rust-lang/rust/commit/b61eab5d514af27009769373360b57dd55036a23"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "392070839dc2a8eead3676e431de81e48b0ad021", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/02fe30971ef397bcff3460a9aaf175e0810c2c90/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02fe30971ef397bcff3460a9aaf175e0810c2c90/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=02fe30971ef397bcff3460a9aaf175e0810c2c90", "patch": "@@ -250,13 +250,23 @@ impl CheckAttrVisitor<'tcx> {\n                                     None\n                                 }\n                             }\n+                            Target::AssocConst => {\n+                                let parent_hir_id = self.tcx.hir().get_parent_item(hir_id);\n+                                let containing_item = self.tcx.hir().expect_item(parent_hir_id);\n+                                // We can't link to trait impl's consts.\n+                                let err = \"associated constant in trait implementation block\";\n+                                match containing_item.kind {\n+                                    ItemKind::Impl { of_trait: Some(_), .. } => Some(err),\n+                                    _ => None,\n+                                }\n+                            }\n                             _ => None,\n                         } {\n                             self.tcx\n                                 .sess\n                                 .struct_span_err(\n                                     meta.span(),\n-                                    &format!(\"`#[doc(alias = \\\"...\\\")]` isn't allowed on {}\", err,),\n+                                    &format!(\"`#[doc(alias = \\\"...\\\")]` isn't allowed on {}\", err),\n                                 )\n                                 .emit();\n                         }"}, {"sha": "73e23c152f268c665f50a9bf6317bf58e88d6531", "filename": "src/test/rustdoc-ui/doc-alias-assoc-const.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/02fe30971ef397bcff3460a9aaf175e0810c2c90/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02fe30971ef397bcff3460a9aaf175e0810c2c90/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.rs?ref=02fe30971ef397bcff3460a9aaf175e0810c2c90", "patch": "@@ -0,0 +1,22 @@\n+#![feature(doc_alias)]\n+#![feature(trait_alias)]\n+\n+pub struct Foo;\n+\n+pub trait Bar {\n+    const BAZ: u8;\n+}\n+\n+impl Bar for Foo {\n+    #[doc(alias = \"CONST_BAZ\")] //~ ERROR\n+    const BAZ: u8 = 0;\n+}\n+\n+impl Foo {\n+    #[doc(alias = \"CONST_FOO\")] // ok!\n+    pub const FOO: u8 = 0;\n+\n+    pub fn bar() -> u8 {\n+        Self::FOO\n+    }\n+}"}, {"sha": "3c64548cc204dc2f6fca01f7ed9528925d81d34c", "filename": "src/test/rustdoc-ui/doc-alias-assoc-const.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/02fe30971ef397bcff3460a9aaf175e0810c2c90/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/02fe30971ef397bcff3460a9aaf175e0810c2c90/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-alias-assoc-const.stderr?ref=02fe30971ef397bcff3460a9aaf175e0810c2c90", "patch": "@@ -0,0 +1,8 @@\n+error: `#[doc(alias = \"...\")]` isn't allowed on associated constant in trait implementation block\n+  --> $DIR/doc-alias-assoc-const.rs:11:11\n+   |\n+LL |     #[doc(alias = \"CONST_BAZ\")]\n+   |           ^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}