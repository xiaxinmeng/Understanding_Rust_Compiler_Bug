{"sha": "2fe58b9a6a8fca04b1c2493389b186778e05e68a", "node_id": "C_kwDOAAsO6NoAKDJmZTU4YjlhNmE4ZmNhMDRiMWMyNDkzMzg5YjE4Njc3OGUwNWU2OGE", "commit": {"author": {"name": "Abdur-Rahmaan Janhangeer", "email": "cryptolabour@gmail.com", "date": "2022-05-06T07:25:51Z"}, "committer": {"name": "Abdur-Rahmaan Janhangeer", "email": "cryptolabour@gmail.com", "date": "2023-01-22T10:53:17Z"}, "message": "fix maintainer validation message\nfix remove token check for maintainers\nfix: rm validate_maintainers function", "tree": {"sha": "1f3364096e187daf8d619a7f4f0352f461a3e57d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1f3364096e187daf8d619a7f4f0352f461a3e57d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2fe58b9a6a8fca04b1c2493389b186778e05e68a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2fe58b9a6a8fca04b1c2493389b186778e05e68a", "html_url": "https://github.com/rust-lang/rust/commit/2fe58b9a6a8fca04b1c2493389b186778e05e68a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2fe58b9a6a8fca04b1c2493389b186778e05e68a/comments", "author": {"login": "Abdur-rahmaanJ", "id": 22630684, "node_id": "MDQ6VXNlcjIyNjMwNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/22630684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Abdur-rahmaanJ", "html_url": "https://github.com/Abdur-rahmaanJ", "followers_url": "https://api.github.com/users/Abdur-rahmaanJ/followers", "following_url": "https://api.github.com/users/Abdur-rahmaanJ/following{/other_user}", "gists_url": "https://api.github.com/users/Abdur-rahmaanJ/gists{/gist_id}", "starred_url": "https://api.github.com/users/Abdur-rahmaanJ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Abdur-rahmaanJ/subscriptions", "organizations_url": "https://api.github.com/users/Abdur-rahmaanJ/orgs", "repos_url": "https://api.github.com/users/Abdur-rahmaanJ/repos", "events_url": "https://api.github.com/users/Abdur-rahmaanJ/events{/privacy}", "received_events_url": "https://api.github.com/users/Abdur-rahmaanJ/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Abdur-rahmaanJ", "id": 22630684, "node_id": "MDQ6VXNlcjIyNjMwNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/22630684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Abdur-rahmaanJ", "html_url": "https://github.com/Abdur-rahmaanJ", "followers_url": "https://api.github.com/users/Abdur-rahmaanJ/followers", "following_url": "https://api.github.com/users/Abdur-rahmaanJ/following{/other_user}", "gists_url": "https://api.github.com/users/Abdur-rahmaanJ/gists{/gist_id}", "starred_url": "https://api.github.com/users/Abdur-rahmaanJ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Abdur-rahmaanJ/subscriptions", "organizations_url": "https://api.github.com/users/Abdur-rahmaanJ/orgs", "repos_url": "https://api.github.com/users/Abdur-rahmaanJ/repos", "events_url": "https://api.github.com/users/Abdur-rahmaanJ/events{/privacy}", "received_events_url": "https://api.github.com/users/Abdur-rahmaanJ/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9714e139ffb25f3b96b28110ae81677c8c1a7cf2", "url": "https://api.github.com/repos/rust-lang/rust/commits/9714e139ffb25f3b96b28110ae81677c8c1a7cf2", "html_url": "https://github.com/rust-lang/rust/commit/9714e139ffb25f3b96b28110ae81677c8c1a7cf2"}], "stats": {"total": 67, "additions": 0, "deletions": 67}, "files": [{"sha": "0b06f5e3623e31ac7ce3a892fecaaac3065e96fa", "filename": "src/ci/docker/host-x86_64/mingw-check/validate-toolstate.sh", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2fe58b9a6a8fca04b1c2493389b186778e05e68a/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-toolstate.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2fe58b9a6a8fca04b1c2493389b186778e05e68a/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-toolstate.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-toolstate.sh?ref=2fe58b9a6a8fca04b1c2493389b186778e05e68a", "patch": "@@ -9,11 +9,5 @@ git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git\n cd rust-toolstate\n python3 \"../../src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \\\n     \"$(git log --format=%s -n1 HEAD)\" \"\" \"\"\n-# Only check maintainers if this build is supposed to publish toolstate.\n-# Builds that are not supposed to publish don't have the access token.\n-if [ -n \"${TOOLSTATE_PUBLISH+is_set}\" ]; then\n-  TOOLSTATE_VALIDATE_MAINTAINERS_REPO=rust-lang/rust python3 \\\n-      \"../../src/tools/publish_toolstate.py\"\n-fi\n cd ..\n rm -rf rust-toolstate"}, {"sha": "db01b9cf25878065a74cb78fef423e406ea32694", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 0, "deletions": 61, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/2fe58b9a6a8fca04b1c2493389b186778e05e68a/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/2fe58b9a6a8fca04b1c2493389b186778e05e68a/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=2fe58b9a6a8fca04b1c2493389b186778e05e68a", "patch": "@@ -77,52 +77,6 @@ def load_json_from_response(resp):\n         print(\"Refusing to decode \" + str(type(content)) + \" to str\")\n     return json.loads(content_str)\n \n-def validate_maintainers(repo, github_token):\n-    # type: (str, str) -> None\n-    '''Ensure all maintainers are assignable on a GitHub repo'''\n-    next_link_re = re.compile(r'<([^>]+)>; rel=\"next\"')\n-\n-    # Load the list of assignable people in the GitHub repo\n-    assignable = [] # type: typing.List[str]\n-    url = 'https://api.github.com/repos/' \\\n-        + '%s/collaborators?per_page=100' % repo # type: typing.Optional[str]\n-    while url is not None:\n-        response = urllib2.urlopen(urllib2.Request(url, headers={\n-            'Authorization': 'token ' + github_token,\n-            # Properly load nested teams.\n-            'Accept': 'application/vnd.github.hellcat-preview+json',\n-        }))\n-        assignable.extend(user['login'] for user in load_json_from_response(response))\n-        # Load the next page if available\n-        url = None\n-        link_header = response.headers.get('Link')\n-        if link_header:\n-            matches = next_link_re.match(link_header)\n-            if matches is not None:\n-                url = matches.group(1)\n-\n-    errors = False\n-    for tool, maintainers in MAINTAINERS.items():\n-        for maintainer in maintainers:\n-            if maintainer not in assignable:\n-                errors = True\n-                print(\n-                    \"error: %s maintainer @%s is not assignable in the %s repo\"\n-                    % (tool, maintainer, repo),\n-                )\n-\n-    if errors:\n-        print()\n-        print(\"  To be assignable, a person needs to be explicitly listed as a\")\n-        print(\"  collaborator in the repository settings. The simple way to\")\n-        print(\"  fix this is to ask someone with 'admin' privileges on the repo\")\n-        print(\"  to add the person or whole team as a collaborator with 'read'\")\n-        print(\"  privileges. Those privileges don't grant any extra permissions\")\n-        print(\"  so it's safe to apply them.\")\n-        print()\n-        print(\"The build will fail due to this.\")\n-        exit(1)\n-\n \n def read_current_status(current_commit, path):\n     # type: (str, str) -> typing.Mapping[str, typing.Any]\n@@ -295,21 +249,6 @@ def update_latest(\n try:\n     if __name__ != '__main__':\n         exit(0)\n-    repo = os.environ.get('TOOLSTATE_VALIDATE_MAINTAINERS_REPO')\n-    if repo:\n-        github_token = os.environ.get('TOOLSTATE_REPO_ACCESS_TOKEN')\n-        if github_token:\n-            # FIXME: This is currently broken. Starting on 2021-09-15, GitHub\n-            # seems to have changed it so that to list the collaborators\n-            # requires admin permissions. I think this will probably just need\n-            # to be removed since we are probably not going to use an admin\n-            # token, and I don't see another way to do this.\n-            print('maintainer validation disabled')\n-            # validate_maintainers(repo, github_token)\n-        else:\n-            print('skipping toolstate maintainers validation since no GitHub token is present')\n-        # When validating maintainers don't run the full script.\n-        exit(0)\n \n     cur_commit = sys.argv[1]\n     cur_datetime = datetime.datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%SZ')"}]}