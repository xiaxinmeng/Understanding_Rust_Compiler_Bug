{"sha": "3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlNDlhZGE3NTI4YmY2NjRiMmNjYzg1MTZhOWVmN2QyMTg0OWE3MGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-01-17T09:22:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-01-17T09:22:22Z"}, "message": "Auto merge of #47035 - acfoltzer:dep-info-tweak, r=alexcrichton\n\nRemove dep-info files as targets in themselves\n\nIf you ask `rustc` to `--emit dep-info`, the resulting dependency file contains a rule for producing the dependency file itself. This differs from the output of `gcc -MD` or `clang -MD`, which only includes dependency rules for the object files produced.\n\nTools like Ninja often consume and delete dependency files as soon as they\u2019re produced for performance reasons, particularly on Windows. In the case of `rustc` output, though, the recently-deleted dependency file is cached by Ninja as a target, and therefore triggers a rebuild every time.\n\nThis very small patch removes the dep-info file from the list of output filenames, so it matches the behavior of gcc and clang.", "tree": {"sha": "a4795cd8c82d743c3241066798bc2ee9bfe031c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4795cd8c82d743c3241066798bc2ee9bfe031c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "html_url": "https://github.com/rust-lang/rust/commit/3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e49ada7528bf664b2ccc8516a9ef7d21849a70b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da569fa9ddf8369a9809184d43c600dc06bd4b4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/da569fa9ddf8369a9809184d43c600dc06bd4b4d", "html_url": "https://github.com/rust-lang/rust/commit/da569fa9ddf8369a9809184d43c600dc06bd4b4d"}, {"sha": "8c09d29d04dabc96a3ae88d914e3b54220952943", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c09d29d04dabc96a3ae88d914e3b54220952943", "html_url": "https://github.com/rust-lang/rust/commit/8c09d29d04dabc96a3ae88d914e3b54220952943"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "eb1a84b9dc720eda842640e08b4bed66e75a94f8", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3e49ada7528bf664b2ccc8516a9ef7d21849a70b/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e49ada7528bf664b2ccc8516a9ef7d21849a70b/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "patch": "@@ -1236,6 +1236,9 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n          overriding the default for the current target\"),\n     human_readable_cgu_names: bool = (false, parse_bool, [TRACKED],\n         \"generate human-readable, predictable names for codegen units\"),\n+    dep_info_omit_d_target: bool = (false, parse_bool, [TRACKED],\n+        \"in dep-info output, omit targets for tracking dependencies of the dep-info files \\\n+         themselves\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "f7e35ba0081e46300d3d88f7e1193f1db65b5725", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3e49ada7528bf664b2ccc8516a9ef7d21849a70b/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e49ada7528bf664b2ccc8516a9ef7d21849a70b/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=3e49ada7528bf664b2ccc8516a9ef7d21849a70b", "patch": "@@ -1162,6 +1162,9 @@ fn write_out_deps(sess: &Session, outputs: &OutputFilenames, crate_name: &str) {\n                     out_filenames.push(p);\n                 }\n             }\n+            OutputType::DepInfo if sess.opts.debugging_opts.dep_info_omit_d_target => {\n+                // Don't add the dep-info output when omitting it from dep-info targets\n+            }\n             _ => {\n                 out_filenames.push(file);\n             }"}]}