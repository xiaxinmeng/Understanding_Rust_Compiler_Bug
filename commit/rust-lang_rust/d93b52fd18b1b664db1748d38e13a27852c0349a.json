{"sha": "d93b52fd18b1b664db1748d38e13a27852c0349a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5M2I1MmZkMThiMWI2NjRkYjE3NDhkMzhlMTNhMjc4NTJjMDM0OWE=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-03T23:38:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-03T23:38:52Z"}, "message": "Rollup merge of #62287 - petrhosek:libunwind-link-attribute, r=tmandry\n\nUse link attributes on extern \"C\" blocks with llvm-libuwind\n\nWhen llvm-libunwind feature is enabled, we need to use link attribute on\nextern \"C\" blocks to make sure that symbols provided by LLVM's libunwind\nthat's built as part of Rust's libunwind crate are re-exported.\n\nThis addresses issue #62088.", "tree": {"sha": "c2d70170d1a543460a6537bff3295adecbff32c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2d70170d1a543460a6537bff3295adecbff32c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d93b52fd18b1b664db1748d38e13a27852c0349a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdHTyMCRBK7hj4Ov3rIwAAdHIIAA8HbiLI9+rHbDvXvJkG89Iz\n+1k/Zmty4BX1ygBN1EWa9V6SEpgNGHcukw3+4kROPGgekMRGB9Mr2/YvC3bH/5KJ\nb6DuJZNwua5uypUxx96N8XyoIkdevvWuS70uYsyqzrfj25gEpMoVFA6wvCOagsds\nZC9b0b9dmnsXtoelkHHGoRK1lAnjeOvvlT0ToJOMqRRU9R+m/5yA9fImSoKpoIyF\n16C5Zl9uHxyuiEqoKpUaWAw8SXTBiJGmfgFE0jWJS0+CWhw+qgnaoQzeRFJ+y4Qx\nhG8vyrN8naC0YEXykPYaTLYdZhkToIgUkRHGkqxiy/Dq51v7zWiyfDkW2YByQ1U=\n=W8TU\n-----END PGP SIGNATURE-----\n", "payload": "tree c2d70170d1a543460a6537bff3295adecbff32c9\nparent d7e42cc61c122c24a2503d7deebdaf00cb2aea23\nparent 8d2f80bab308b7abe62fc6d817f12f21e66bfa53\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1562197132 +0200\ncommitter GitHub <noreply@github.com> 1562197132 +0200\n\nRollup merge of #62287 - petrhosek:libunwind-link-attribute, r=tmandry\n\nUse link attributes on extern \"C\" blocks with llvm-libuwind\n\nWhen llvm-libunwind feature is enabled, we need to use link attribute on\nextern \"C\" blocks to make sure that symbols provided by LLVM's libunwind\nthat's built as part of Rust's libunwind crate are re-exported.\n\nThis addresses issue #62088.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d93b52fd18b1b664db1748d38e13a27852c0349a", "html_url": "https://github.com/rust-lang/rust/commit/d93b52fd18b1b664db1748d38e13a27852c0349a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d93b52fd18b1b664db1748d38e13a27852c0349a/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7e42cc61c122c24a2503d7deebdaf00cb2aea23", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7e42cc61c122c24a2503d7deebdaf00cb2aea23", "html_url": "https://github.com/rust-lang/rust/commit/d7e42cc61c122c24a2503d7deebdaf00cb2aea23"}, {"sha": "8d2f80bab308b7abe62fc6d817f12f21e66bfa53", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d2f80bab308b7abe62fc6d817f12f21e66bfa53", "html_url": "https://github.com/rust-lang/rust/commit/8d2f80bab308b7abe62fc6d817f12f21e66bfa53"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "e92c68f5b0c5736f974d57f640f2bdc16ae48895", "filename": "src/libunwind/build.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d93b52fd18b1b664db1748d38e13a27852c0349a/src%2Flibunwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d93b52fd18b1b664db1748d38e13a27852c0349a/src%2Flibunwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Fbuild.rs?ref=d93b52fd18b1b664db1748d38e13a27852c0349a", "patch": "@@ -4,11 +4,13 @@ fn main() {\n     println!(\"cargo:rerun-if-changed=build.rs\");\n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n \n-    if cfg!(feature = \"llvm-libunwind\") &&\n+    // FIXME: the not(bootstrap) part is needed because of the issue addressed by #62286,\n+    // and could be removed once that change is in beta.\n+    if cfg!(all(not(bootstrap), feature = \"llvm-libunwind\")) &&\n         (target.contains(\"linux\") ||\n          target.contains(\"fuchsia\")) {\n         // Build the unwinding from libunwind C/C++ source code.\n-        #[cfg(feature = \"llvm-libunwind\")]\n+        #[cfg(all(not(bootstrap), feature = \"llvm-libunwind\"))]\n         llvm_libunwind::compile();\n     } else if target.contains(\"linux\") {\n         if target.contains(\"musl\") {\n@@ -42,7 +44,7 @@ fn main() {\n     }\n }\n \n-#[cfg(feature = \"llvm-libunwind\")]\n+#[cfg(all(not(bootstrap), feature = \"llvm-libunwind\"))]\n mod llvm_libunwind {\n     use std::env;\n     use std::path::Path;"}, {"sha": "7e640897af70559fbd6db9f526b4f64f9d4459a6", "filename": "src/libunwind/libunwind.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d93b52fd18b1b664db1748d38e13a27852c0349a/src%2Flibunwind%2Flibunwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d93b52fd18b1b664db1748d38e13a27852c0349a/src%2Flibunwind%2Flibunwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2Flibunwind.rs?ref=d93b52fd18b1b664db1748d38e13a27852c0349a", "patch": "@@ -67,6 +67,8 @@ pub enum _Unwind_Context {}\n \n pub type _Unwind_Exception_Cleanup_Fn = extern \"C\" fn(unwind_code: _Unwind_Reason_Code,\n                                                       exception: *mut _Unwind_Exception);\n+#[cfg_attr(all(not(bootstrap), feature = \"llvm-libunwind\"),\n+           link(name = \"unwind\", kind = \"static\"))]\n extern \"C\" {\n     #[unwind(allowed)]\n     pub fn _Unwind_Resume(exception: *mut _Unwind_Exception) -> !;\n@@ -91,6 +93,8 @@ if #[cfg(all(any(target_os = \"ios\", target_os = \"netbsd\", not(target_arch = \"arm\n     }\n     pub use _Unwind_Action::*;\n \n+    #[cfg_attr(all(not(bootstrap), feature = \"llvm-libunwind\"),\n+               link(name = \"unwind\", kind = \"static\"))]\n     extern \"C\" {\n         pub fn _Unwind_GetGR(ctx: *mut _Unwind_Context, reg_index: c_int) -> _Unwind_Word;\n         pub fn _Unwind_SetGR(ctx: *mut _Unwind_Context, reg_index: c_int, value: _Unwind_Word);\n@@ -144,6 +148,8 @@ if #[cfg(all(any(target_os = \"ios\", target_os = \"netbsd\", not(target_arch = \"arm\n     pub const UNWIND_POINTER_REG: c_int = 12;\n     pub const UNWIND_IP_REG: c_int = 15;\n \n+    #[cfg_attr(all(not(bootstrap), feature = \"llvm-libunwind\"),\n+               link(name = \"unwind\", kind = \"static\"))]\n     extern \"C\" {\n         fn _Unwind_VRS_Get(ctx: *mut _Unwind_Context,\n                            regclass: _Unwind_VRS_RegClass,\n@@ -206,6 +212,8 @@ if #[cfg(all(any(target_os = \"ios\", target_os = \"netbsd\", not(target_arch = \"arm\n cfg_if::cfg_if! {\n if #[cfg(not(all(target_os = \"ios\", target_arch = \"arm\")))] {\n     // Not 32-bit iOS\n+    #[cfg_attr(all(not(bootstrap), feature = \"llvm-libunwind\"),\n+               link(name = \"unwind\", kind = \"static\"))]\n     extern \"C\" {\n         #[unwind(allowed)]\n         pub fn _Unwind_RaiseException(exception: *mut _Unwind_Exception) -> _Unwind_Reason_Code;\n@@ -215,6 +223,8 @@ if #[cfg(not(all(target_os = \"ios\", target_arch = \"arm\")))] {\n     }\n } else {\n     // 32-bit iOS uses SjLj and does not provide _Unwind_Backtrace()\n+    #[cfg_attr(all(not(bootstrap), feature = \"llvm-libunwind\"),\n+               link(name = \"unwind\", kind = \"static\"))]\n     extern \"C\" {\n         #[unwind(allowed)]\n         pub fn _Unwind_SjLj_RaiseException(e: *mut _Unwind_Exception) -> _Unwind_Reason_Code;"}]}