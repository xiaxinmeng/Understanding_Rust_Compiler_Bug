{"sha": "f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzMGYxOGY1YzMyZThjOTk2NDA0ODlkNTZlNGE5ZTllMTEwMGIxMGY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-01-12T18:26:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-12T18:26:26Z"}, "message": "Rollup merge of #47282 - malbarbo:i586-musl, r=alexcrichton\n\nAdd i586-unknown-linux-musl target", "tree": {"sha": "ed72e2477210967b5ae7530ea5f2f3f89fd6074c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed72e2477210967b5ae7530ea5f2f3f89fd6074c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "html_url": "https://github.com/rust-lang/rust/commit/f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ac0888ad2dc9d21613ac3673a9702d2ace65e35", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ac0888ad2dc9d21613ac3673a9702d2ace65e35", "html_url": "https://github.com/rust-lang/rust/commit/6ac0888ad2dc9d21613ac3673a9702d2ace65e35"}, {"sha": "882cd3cf0b662bbdd3c79e0f5ae34bb119c2d4aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/882cd3cf0b662bbdd3c79e0f5ae34bb119c2d4aa", "html_url": "https://github.com/rust-lang/rust/commit/882cd3cf0b662bbdd3c79e0f5ae34bb119c2d4aa"}], "stats": {"total": 52, "additions": 41, "deletions": 11}, "files": [{"sha": "6e242b74894c5dd66715f904683287ba94338b69", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -126,7 +126,7 @@ matrix:\n       if: branch = auto\n     - env: IMAGE=dist-armv7-linux DEPLOY=1\n       if: branch = auto\n-    - env: IMAGE=dist-i586-gnu-i686-musl DEPLOY=1\n+    - env: IMAGE=dist-i586-gnu-i586-i686-musl DEPLOY=1\n       if: branch = auto\n     - env: IMAGE=dist-i686-freebsd DEPLOY=1\n       if: branch = auto"}, {"sha": "aa9fe459e88c996abd961515514529ac19a1e7ad", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -108,6 +108,8 @@ def v(*args):\n   \"MUSL root installation directory (deprecated)\")\n v(\"musl-root-x86_64\", \"target.x86_64-unknown-linux-musl.musl-root\",\n   \"x86_64-unknown-linux-musl install directory\")\n+v(\"musl-root-i586\", \"target.i586-unknown-linux-musl.musl-root\",\n+  \"i586-unknown-linux-musl install directory\")\n v(\"musl-root-i686\", \"target.i686-unknown-linux-musl.musl-root\",\n   \"i686-unknown-linux-musl install directory\")\n v(\"musl-root-arm\", \"target.arm-unknown-linux-musleabi.musl-root\","}, {"sha": "ba8cf3a8e2eb597844e202e5563937646c758f80", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -429,6 +429,8 @@ impl Step for Openssl {\n             \"arm-unknown-linux-gnueabihf\" => \"linux-armv4\",\n             \"armv7-linux-androideabi\" => \"android-armv7\",\n             \"armv7-unknown-linux-gnueabihf\" => \"linux-armv4\",\n+            \"i586-unknown-linux-gnu\" => \"linux-elf\",\n+            \"i586-unknown-linux-musl\" => \"linux-elf\",\n             \"i686-apple-darwin\" => \"darwin-i386-cc\",\n             \"i686-linux-android\" => \"android-x86\",\n             \"i686-unknown-freebsd\" => \"BSD-x86-elf\","}, {"sha": "4c9d4b3ba78ed673be8a75cab6d5ada6ea0b1d00", "filename": "src/ci/docker/dist-i586-gnu-i586-i686-musl/Dockerfile", "status": "renamed", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fci%2Fdocker%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fci%2Fdocker%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -21,13 +21,17 @@ COPY scripts/musl.sh /build/\n RUN CC=gcc CFLAGS=\"-m32 -fPIC -Wa,-mrelax-relocations=no\" \\\n     CXX=g++ CXXFLAGS=\"-m32 -Wa,-mrelax-relocations=no\" \\\n     bash musl.sh i686 --target=i686 && \\\n+    CC=gcc CFLAGS=\"-march=pentium -m32 -fPIC -Wa,-mrelax-relocations=no\" \\\n+    CXX=g++ CXXFLAGS=\"-march=pentium -m32 -Wa,-mrelax-relocations=no\" \\\n+    bash musl.sh i586 --target=i586 && \\\n     rm -rf /build\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n ENV RUST_CONFIGURE_ARGS \\\n       --target=i686-unknown-linux-musl,i586-unknown-linux-gnu \\\n+      --musl-root-i586=/musl-i586 \\\n       --musl-root-i686=/musl-i686 \\\n       --enable-extended\n \n@@ -38,12 +42,13 @@ ENV RUST_CONFIGURE_ARGS \\\n # See: https://github.com/rust-lang/rust/issues/34978\n ENV CFLAGS_i686_unknown_linux_musl=-Wa,-mrelax-relocations=no\n ENV CFLAGS_i586_unknown_linux_gnu=-Wa,-mrelax-relocations=no\n+# FIXME remove -Wl,-melf_i386 after cc is updated to include\n+#       https://github.com/alexcrichton/cc-rs/pull/281\n+ENV CFLAGS_i586_unknown_linux_musl=\"-Wa,-mrelax-relocations=no -Wl,-melf_i386\"\n+\n+ENV TARGETS=i586-unknown-linux-gnu\n+ENV TARGETS=$TARGETS,i686-unknown-linux-musl\n \n ENV SCRIPT \\\n-      python2.7 ../x.py test \\\n-          --target i686-unknown-linux-musl \\\n-          --target i586-unknown-linux-gnu \\\n-          && \\\n-      python2.7 ../x.py dist \\\n-          --target i686-unknown-linux-musl \\\n-          --target i586-unknown-linux-gnu\n+      python2.7 ../x.py test --target $TARGETS && \\\n+      python2.7 ../x.py dist --target $TARGETS,i586-unknown-linux-musl", "previous_filename": "src/ci/docker/dist-i586-gnu-i686-musl/Dockerfile"}, {"sha": "e63f1a6f9e5a5042959c54558775a34032e0a89e", "filename": "src/ci/docker/scripts/musl.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -39,7 +39,7 @@ fi\n \n cd $MUSL\n ./configure --disable-shared --prefix=/musl-$TAG $@\n-if [ \"$TAG\" = \"i686\" ]; then\n+if [ \"$TAG\" = \"i586\" -o \"$TAG\" = \"i686\" ]; then\n   hide_output make -j$(nproc) AR=ar RANLIB=ranlib\n else\n   hide_output make -j$(nproc)"}, {"sha": "416eacf475b5c987a423bdcf411e866f6ff8f26a", "filename": "src/librustc_back/target/i586_unknown_linux_musl.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Flibrustc_back%2Ftarget%2Fi586_unknown_linux_musl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Flibrustc_back%2Ftarget%2Fi586_unknown_linux_musl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fi586_unknown_linux_musl.rs?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use target::TargetResult;\n+\n+pub fn target() -> TargetResult {\n+    let mut base = super::i686_unknown_linux_musl::target()?;\n+    base.options.cpu = \"pentium\".to_string();\n+    base.llvm_target = \"i586-unknown-linux-musl\".to_string();\n+    Ok(base)\n+}"}, {"sha": "7b2e4558174d2ebb5b36876289f3f68719c4c8fb", "filename": "src/librustc_back/target/mod.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fmod.rs?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -147,6 +147,7 @@ supported_targets! {\n     (\"powerpc64-unknown-linux-gnu\", powerpc64_unknown_linux_gnu),\n     (\"powerpc64le-unknown-linux-gnu\", powerpc64le_unknown_linux_gnu),\n     (\"s390x-unknown-linux-gnu\", s390x_unknown_linux_gnu),\n+    (\"sparc64-unknown-linux-gnu\", sparc64_unknown_linux_gnu),\n     (\"arm-unknown-linux-gnueabi\", arm_unknown_linux_gnueabi),\n     (\"arm-unknown-linux-gnueabihf\", arm_unknown_linux_gnueabihf),\n     (\"arm-unknown-linux-musleabi\", arm_unknown_linux_musleabi),\n@@ -156,16 +157,17 @@ supported_targets! {\n     (\"armv7-unknown-linux-gnueabihf\", armv7_unknown_linux_gnueabihf),\n     (\"armv7-unknown-linux-musleabihf\", armv7_unknown_linux_musleabihf),\n     (\"aarch64-unknown-linux-gnu\", aarch64_unknown_linux_gnu),\n+\n     (\"aarch64-unknown-linux-musl\", aarch64_unknown_linux_musl),\n     (\"x86_64-unknown-linux-musl\", x86_64_unknown_linux_musl),\n     (\"i686-unknown-linux-musl\", i686_unknown_linux_musl),\n+    (\"i586-unknown-linux-musl\", i586_unknown_linux_musl),\n     (\"mips-unknown-linux-musl\", mips_unknown_linux_musl),\n     (\"mipsel-unknown-linux-musl\", mipsel_unknown_linux_musl),\n+\n     (\"mips-unknown-linux-uclibc\", mips_unknown_linux_uclibc),\n     (\"mipsel-unknown-linux-uclibc\", mipsel_unknown_linux_uclibc),\n \n-    (\"sparc64-unknown-linux-gnu\", sparc64_unknown_linux_gnu),\n-\n     (\"i686-linux-android\", i686_linux_android),\n     (\"x86_64-linux-android\", x86_64_linux_android),\n     (\"arm-linux-androideabi\", arm_linux_androideabi),"}, {"sha": "4113f8fd124c7090344189eb1d02176b827d772b", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f30f18f5c32e8c99640489d56e4a9e9e1100b10f/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=f30f18f5c32e8c99640489d56e4a9e9e1100b10f", "patch": "@@ -67,6 +67,7 @@ static TARGETS: &'static [&'static str] = &[\n     \"i386-apple-ios\",\n     \"i586-pc-windows-msvc\",\n     \"i586-unknown-linux-gnu\",\n+    \"i586-unknown-linux-musl\",\n     \"i686-apple-darwin\",\n     \"i686-linux-android\",\n     \"i686-pc-windows-gnu\","}]}