{"sha": "93014467f83435d4721616f9b5e4417fc01623aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzMDE0NDY3ZjgzNDM1ZDQ3MjE2MTZmOWI1ZTQ0MTdmYzAxNjIzYWE=", "commit": {"author": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2017-01-06T02:55:43Z"}, "committer": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2017-02-04T18:51:11Z"}, "message": "note lint group set on command line triggering individual lint\n\nPreviously, the note/message for the source of a lint being the command\nline unconditionally named the individual lint, even if the actual\ncommand specified a lint group (e.g., `-D warnings`); here, we take note\nof the actual command options so we can be more specific.\n\nThis remains in the matter of #36846.", "tree": {"sha": "4c96e47549ddc16d61d9c8e73f87104cb2c3b30e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c96e47549ddc16d61d9c8e73f87104cb2c3b30e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93014467f83435d4721616f9b5e4417fc01623aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93014467f83435d4721616f9b5e4417fc01623aa", "html_url": "https://github.com/rust-lang/rust/commit/93014467f83435d4721616f9b5e4417fc01623aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93014467f83435d4721616f9b5e4417fc01623aa/comments", "author": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "65b05541432c1fe7b75fb2dd3b020f933f3b5f4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/65b05541432c1fe7b75fb2dd3b020f933f3b5f4b", "html_url": "https://github.com/rust-lang/rust/commit/65b05541432c1fe7b75fb2dd3b020f933f3b5f4b"}], "stats": {"total": 121, "additions": 110, "deletions": 11}, "files": [{"sha": "28600e3ab8eb84b25925d3f8365e70643f5f678a", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 19, "deletions": 9, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -43,6 +43,7 @@ use std::fmt;\n use std::ops::Deref;\n use syntax::attr;\n use syntax::ast;\n+use syntax::symbol::Symbol;\n use syntax_pos::{MultiSpan, Span};\n use errors::{self, Diagnostic, DiagnosticBuilder};\n use hir;\n@@ -300,8 +301,9 @@ impl LintStore {\n             check_lint_name_cmdline(sess, self,\n                                     &lint_name[..], level);\n \n+            let lint_flag_val = Symbol::intern(&lint_name);\n             match self.find_lint(&lint_name[..], sess, None) {\n-                Ok(lint_id) => self.set_level(lint_id, (level, CommandLine)),\n+                Ok(lint_id) => self.set_level(lint_id, (level, CommandLine(lint_flag_val))),\n                 Err(FindLintError::Removed) => { }\n                 Err(_) => {\n                     match self.lint_groups.iter().map(|(&x, pair)| (x, pair.0.clone()))\n@@ -311,7 +313,7 @@ impl LintStore {\n                         Some(v) => {\n                             v.iter()\n                              .map(|lint_id: &LintId|\n-                                     self.set_level(*lint_id, (level, CommandLine)))\n+                                     self.set_level(*lint_id, (level, CommandLine(lint_flag_val))))\n                              .collect::<Vec<()>>();\n                         }\n                         None => {\n@@ -470,12 +472,20 @@ pub fn raw_struct_lint<'a, S>(sess: &'a Session,\n         Default => {\n             err.note(&format!(\"#[{}({})] on by default\", level.as_str(), name));\n         },\n-        CommandLine => {\n-            err.note(&format!(\"[-{} {}]\",\n-                              match level {\n-                                  Warn => 'W', Deny => 'D', Forbid => 'F',\n-                                  Allow => bug!()\n-                              }, name.replace(\"_\", \"-\")));\n+        CommandLine(lint_flag_val) => {\n+            let flag = match level {\n+                Warn => \"-W\", Deny => \"-D\", Forbid => \"-F\",\n+                Allow => bug!(\"earlier conditional return should handle Allow case\")\n+            };\n+            let hyphen_case_lint_name = name.replace(\"_\", \"-\");\n+            if lint_flag_val.as_str().deref() == name {\n+                err.note(&format!(\"requested on the command line with `{} {}`\",\n+                                  flag, hyphen_case_lint_name));\n+            } else {\n+                let hyphen_case_flag_val = lint_flag_val.as_str().replace(\"_\", \"-\");\n+                err.note(&format!(\"`{} {}` implies `{} {}`\",\n+                                  flag, hyphen_case_flag_val, flag, hyphen_case_lint_name));\n+            }\n         },\n         Node(lint_attr_name, src) => {\n             def = Some(src);\n@@ -671,7 +681,7 @@ pub trait LintContext<'tcx>: Sized {\n                             diag_builder.span_label(forbid_source_span,\n                                                     &format!(\"`forbid` level set here\"))\n                         },\n-                        LintSource::CommandLine => {\n+                        LintSource::CommandLine(_) => {\n                             diag_builder.note(\"`forbid` lint level was set on command line\")\n                         }\n                     }.emit()"}, {"sha": "e9f603db15d6214b538c29a71a5aa55454641997", "filename": "src/librustc/lint/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Flibrustc%2Flint%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Flibrustc%2Flint%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fmod.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -38,6 +38,7 @@ use std::ascii::AsciiExt;\n use syntax_pos::Span;\n use syntax::visit as ast_visit;\n use syntax::ast;\n+use syntax::symbol::Symbol;\n \n pub use lint::context::{LateContext, EarlyContext, LintContext, LintStore,\n                         raw_emit_lint, check_crate, check_ast_crate, gather_attrs,\n@@ -341,7 +342,7 @@ pub enum LintSource {\n     Node(ast::Name, Span),\n \n     /// Lint level was set by a command-line flag.\n-    CommandLine,\n+    CommandLine(Symbol),\n }\n \n pub type LevelSource = (Level, LintSource);"}, {"sha": "0e68ff752e5a9876769844624525e55dda0fe82c", "filename": "src/test/compile-fail/lint-output-format-2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fcompile-fail%2Flint-output-format-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fcompile-fail%2Flint-output-format-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-output-format-2.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -13,7 +13,7 @@\n \n #![feature(foo)]\n //~^ ERROR unused or unknown feature\n-//~| NOTE [-F unused-features]\n+//~| NOTE requested on the command line with `-F unused-features`\n \n #![feature(test_feature)]\n "}, {"sha": "cdb9684933d9b14fa02fc22ca0527f43a385c6c5", "filename": "src/test/ui/lint/command-line-lint-group-allow.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-allow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-allow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-allow.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -A bad-style\n+\n+fn main() {\n+    let _InappropriateCamelCasing = true;\n+}"}, {"sha": "1248601c1e44a37863ed1e0796716682ca35e219", "filename": "src/test/ui/lint/command-line-lint-group-deny.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -D bad-style\n+\n+fn main() {\n+    let _InappropriateCamelCasing = true;\n+}"}, {"sha": "eafbf944dea97cb3570f3d9aee089bd8a9f58689", "filename": "src/test/ui/lint/command-line-lint-group-deny.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-deny.stderr?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,10 @@\n+error: variable `_InappropriateCamelCasing` should have a snake case name such as `_inappropriate_camel_casing`\n+  --> $DIR/command-line-lint-group-deny.rs:14:9\n+   |\n+14 |     let _InappropriateCamelCasing = true;\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D bad-style` implies `-D non-snake-case`\n+\n+error: aborting due to previous error\n+"}, {"sha": "ae16db44864c98f85c3ea55440bb2fe32877de85", "filename": "src/test/ui/lint/command-line-lint-group-forbid.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -F bad-style\n+\n+fn main() {\n+    let _InappropriateCamelCasing = true;\n+}"}, {"sha": "0cf896060a27f7fc5bdf30173f47075c5909aeeb", "filename": "src/test/ui/lint/command-line-lint-group-forbid.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-forbid.stderr?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,10 @@\n+error: variable `_InappropriateCamelCasing` should have a snake case name such as `_inappropriate_camel_casing`\n+  --> $DIR/command-line-lint-group-forbid.rs:14:9\n+   |\n+14 |     let _InappropriateCamelCasing = true;\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-F bad-style` implies `-F non-snake-case`\n+\n+error: aborting due to previous error\n+"}, {"sha": "7d65c802788bf1a006bb1b598d5891a2c4f5bd76", "filename": "src/test/ui/lint/command-line-lint-group-warn.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.rs?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -W bad-style\n+\n+fn main() {\n+    let _InappropriateCamelCasing = true;\n+}"}, {"sha": "4ffbff6cdb7ec26904afaf84cd38ea73d0230d6e", "filename": "src/test/ui/lint/command-line-lint-group-warn.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93014467f83435d4721616f9b5e4417fc01623aa/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fcommand-line-lint-group-warn.stderr?ref=93014467f83435d4721616f9b5e4417fc01623aa", "patch": "@@ -0,0 +1,8 @@\n+warning: variable `_InappropriateCamelCasing` should have a snake case name such as `_inappropriate_camel_casing`\n+  --> $DIR/command-line-lint-group-warn.rs:14:9\n+   |\n+14 |     let _InappropriateCamelCasing = true;\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-W bad-style` implies `-W non-snake-case`\n+"}]}