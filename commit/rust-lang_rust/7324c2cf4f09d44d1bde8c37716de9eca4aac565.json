{"sha": "7324c2cf4f09d44d1bde8c37716de9eca4aac565", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczMjRjMmNmNGYwOWQ0NGQxYmRlOGMzNzcxNmRlOWVjYTRhYWM1NjU=", "commit": {"author": {"name": "Keegan McAllister", "email": "kmcallister@mozilla.com", "date": "2015-01-23T19:58:49Z"}, "committer": {"name": "Keegan McAllister", "email": "kmcallister@mozilla.com", "date": "2015-02-07T05:36:07Z"}, "message": "sync: Expose PoisonError::new", "tree": {"sha": "88bada94ec96351665e485f69053f9a3d0ba9b68", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88bada94ec96351665e485f69053f9a3d0ba9b68"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7324c2cf4f09d44d1bde8c37716de9eca4aac565", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7324c2cf4f09d44d1bde8c37716de9eca4aac565", "html_url": "https://github.com/rust-lang/rust/commit/7324c2cf4f09d44d1bde8c37716de9eca4aac565", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7324c2cf4f09d44d1bde8c37716de9eca4aac565/comments", "author": {"login": "kmcallister", "id": 444997, "node_id": "MDQ6VXNlcjQ0NDk5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmcallister", "html_url": "https://github.com/kmcallister", "followers_url": "https://api.github.com/users/kmcallister/followers", "following_url": "https://api.github.com/users/kmcallister/following{/other_user}", "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions", "organizations_url": "https://api.github.com/users/kmcallister/orgs", "repos_url": "https://api.github.com/users/kmcallister/repos", "events_url": "https://api.github.com/users/kmcallister/events{/privacy}", "received_events_url": "https://api.github.com/users/kmcallister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kmcallister", "id": 444997, "node_id": "MDQ6VXNlcjQ0NDk5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmcallister", "html_url": "https://github.com/kmcallister", "followers_url": "https://api.github.com/users/kmcallister/followers", "following_url": "https://api.github.com/users/kmcallister/following{/other_user}", "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions", "organizations_url": "https://api.github.com/users/kmcallister/orgs", "repos_url": "https://api.github.com/users/kmcallister/repos", "events_url": "https://api.github.com/users/kmcallister/events{/privacy}", "received_events_url": "https://api.github.com/users/kmcallister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96c3a13680d521387007e2f6575483c24561ecb3", "url": "https://api.github.com/repos/rust-lang/rust/commits/96c3a13680d521387007e2f6575483c24561ecb3", "html_url": "https://github.com/rust-lang/rust/commit/96c3a13680d521387007e2f6575483c24561ecb3"}], "stats": {"total": 26, "additions": 14, "deletions": 12}, "files": [{"sha": "d4d722cab3d929288aaea0d17989036cf21592f2", "filename": "src/libstd/sync/condvar.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7324c2cf4f09d44d1bde8c37716de9eca4aac565/src%2Flibstd%2Fsync%2Fcondvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7324c2cf4f09d44d1bde8c37716de9eca4aac565/src%2Flibstd%2Fsync%2Fcondvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fcondvar.rs?ref=7324c2cf4f09d44d1bde8c37716de9eca4aac565", "patch": "@@ -16,7 +16,7 @@ use sys::time::SteadyTime;\n use sys_common::condvar as sys;\n use sys_common::mutex as sys_mutex;\n use time::Duration;\n-use sync::{mutex, MutexGuard};\n+use sync::{mutex, MutexGuard, PoisonError};\n \n /// A Condition Variable\n ///\n@@ -228,7 +228,7 @@ impl StaticCondvar {\n             mutex::guard_poison(&guard).get()\n         };\n         if poisoned {\n-            Err(poison::new_poison_error(guard))\n+            Err(PoisonError::new(guard))\n         } else {\n             Ok(guard)\n         }\n@@ -249,7 +249,7 @@ impl StaticCondvar {\n             (mutex::guard_poison(&guard).get(), success)\n         };\n         if poisoned {\n-            Err(poison::new_poison_error((guard, success)))\n+            Err(PoisonError::new((guard, success)))\n         } else {\n             Ok((guard, success))\n         }\n@@ -276,23 +276,23 @@ impl StaticCondvar {\n         while !f(guard_result\n                     .as_mut()\n                     .map(|g| &mut **g)\n-                    .map_err(|e| poison::new_poison_error(&mut **e.get_mut()))) {\n+                    .map_err(|e| PoisonError::new(&mut **e.get_mut()))) {\n             let now = SteadyTime::now();\n             let consumed = &now - &start;\n             let guard = guard_result.unwrap_or_else(|e| e.into_inner());\n             let (new_guard_result, no_timeout) = match self.wait_timeout(guard, dur - consumed) {\n                 Ok((new_guard, no_timeout)) => (Ok(new_guard), no_timeout),\n                 Err(err) => {\n                     let (new_guard, no_timeout) = err.into_inner();\n-                    (Err(poison::new_poison_error(new_guard)), no_timeout)\n+                    (Err(PoisonError::new(new_guard)), no_timeout)\n                 }\n             };\n             guard_result = new_guard_result;\n             if !no_timeout {\n                 let result = f(guard_result\n                                     .as_mut()\n                                     .map(|g| &mut **g)\n-                                    .map_err(|e| poison::new_poison_error(&mut **e.get_mut())));\n+                                    .map_err(|e| PoisonError::new(&mut **e.get_mut())));\n                 return poison::map_result(guard_result, |g| (g, result));\n             }\n         }"}, {"sha": "a93bd31f5ae38ab58d59ad9569807ca33d747729", "filename": "src/libstd/sync/poison.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7324c2cf4f09d44d1bde8c37716de9eca4aac565/src%2Flibstd%2Fsync%2Fpoison.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7324c2cf4f09d44d1bde8c37716de9eca4aac565/src%2Flibstd%2Fsync%2Fpoison.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fpoison.rs?ref=7324c2cf4f09d44d1bde8c37716de9eca4aac565", "patch": "@@ -23,7 +23,7 @@ impl Flag {\n     pub fn borrow(&self) -> LockResult<Guard> {\n         let ret = Guard { panicking: Thread::panicking() };\n         if unsafe { *self.failed.get() } {\n-            Err(new_poison_error(ret))\n+            Err(PoisonError::new(ret))\n         } else {\n             Ok(ret)\n         }\n@@ -110,6 +110,12 @@ impl<T> Error for PoisonError<T> {\n }\n \n impl<T> PoisonError<T> {\n+    /// Create a `PoisonError`.\n+    #[unstable(feature = \"std_misc\")]\n+    pub fn new(guard: T) -> PoisonError<T> {\n+        PoisonError { guard: guard }\n+    }\n+\n     /// Consumes this error indicating that a lock is poisoned, returning the\n     /// underlying guard to allow access regardless.\n     #[unstable(feature = \"std_misc\")]\n@@ -171,15 +177,11 @@ impl<T> Error for TryLockError<T> {\n     }\n }\n \n-pub fn new_poison_error<T>(guard: T) -> PoisonError<T> {\n-    PoisonError { guard: guard }\n-}\n-\n pub fn map_result<T, U, F>(result: LockResult<T>, f: F)\n                            -> LockResult<U>\n                            where F: FnOnce(T) -> U {\n     match result {\n         Ok(t) => Ok(f(t)),\n-        Err(PoisonError { guard }) => Err(new_poison_error(f(guard)))\n+        Err(PoisonError { guard }) => Err(PoisonError::new(f(guard)))\n     }\n }"}]}