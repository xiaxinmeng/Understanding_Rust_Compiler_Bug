{"sha": "eef383fa00be7565123f62e2dddd325e10e3ec21", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlZjM4M2ZhMDBiZTc1NjUxMjNmNjJlMmRkZGQzMjVlMTBlM2VjMjE=", "commit": {"author": {"name": "\u00d6mer Sinan A\u011facan", "email": "omeragacan@gmail.com", "date": "2021-01-15T12:51:32Z"}, "committer": {"name": "\u00d6mer Sinan A\u011facan", "email": "omeragacan@gmail.com", "date": "2021-01-16T03:55:29Z"}, "message": "doctest: Reset errors before dropping the parse session\n\nThe first parse is to collect whether the code contains macros, has\n`main`, and uses other crates. In that pass we ignore errors as those\nwill be reported when the test file is actually built.\n\nFor that we need to reset errors in the `Diagnostic` otherwise when\ndropping it unhandled errors will be reported as compiler bugs.\n\nFixes #80992", "tree": {"sha": "111cf20a65ef46a0e9e291db2b00158c1ceb4da3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/111cf20a65ef46a0e9e291db2b00158c1ceb4da3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eef383fa00be7565123f62e2dddd325e10e3ec21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eef383fa00be7565123f62e2dddd325e10e3ec21", "html_url": "https://github.com/rust-lang/rust/commit/eef383fa00be7565123f62e2dddd325e10e3ec21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eef383fa00be7565123f62e2dddd325e10e3ec21/comments", "author": {"login": "osa1", "id": 448274, "node_id": "MDQ6VXNlcjQ0ODI3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/448274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osa1", "html_url": "https://github.com/osa1", "followers_url": "https://api.github.com/users/osa1/followers", "following_url": "https://api.github.com/users/osa1/following{/other_user}", "gists_url": "https://api.github.com/users/osa1/gists{/gist_id}", "starred_url": "https://api.github.com/users/osa1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osa1/subscriptions", "organizations_url": "https://api.github.com/users/osa1/orgs", "repos_url": "https://api.github.com/users/osa1/repos", "events_url": "https://api.github.com/users/osa1/events{/privacy}", "received_events_url": "https://api.github.com/users/osa1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "osa1", "id": 448274, "node_id": "MDQ6VXNlcjQ0ODI3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/448274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osa1", "html_url": "https://github.com/osa1", "followers_url": "https://api.github.com/users/osa1/followers", "following_url": "https://api.github.com/users/osa1/following{/other_user}", "gists_url": "https://api.github.com/users/osa1/gists{/gist_id}", "starred_url": "https://api.github.com/users/osa1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osa1/subscriptions", "organizations_url": "https://api.github.com/users/osa1/orgs", "repos_url": "https://api.github.com/users/osa1/repos", "events_url": "https://api.github.com/users/osa1/events{/privacy}", "received_events_url": "https://api.github.com/users/osa1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c869d34ae2d87d21db9892d4dc088639bcbe041", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c869d34ae2d87d21db9892d4dc088639bcbe041", "html_url": "https://github.com/rust-lang/rust/commit/6c869d34ae2d87d21db9892d4dc088639bcbe041"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "3de97f2dd2e59375b817e02bf8aa5dbcdec900c8", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/eef383fa00be7565123f62e2dddd325e10e3ec21/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eef383fa00be7565123f62e2dddd325e10e3ec21/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=eef383fa00be7565123f62e2dddd325e10e3ec21", "patch": "@@ -500,6 +500,12 @@ crate fn make_test(\n                 }\n             }\n \n+            // Reset errors so that they won't be reported as compiler bugs when dropping the\n+            // handler. Any errors in the tests will be reported when the test file is compiled,\n+            // Note that we still need to cancel the errors above otherwise `DiagnosticBuilder`\n+            // will panic on drop.\n+            sess.span_diagnostic.reset_err_count();\n+\n             (found_main, found_extern_crate, found_macro)\n         })\n     });"}]}