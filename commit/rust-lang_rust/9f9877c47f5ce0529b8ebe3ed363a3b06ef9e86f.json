{"sha": "9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmOTg3N2M0N2Y1Y2UwNTI5YjhlYmUzZWQzNjNhM2IwNmVmOWU4NmY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-31T19:12:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-31T19:12:00Z"}, "message": "Auto merge of #5662 - ebroto:cargo_tests_invalid_crate, r=flip1995\n\ncargo-ui tests: check that <dir>/src exists before processing test\n\nI forgot that I had fixed this in a PR I closed some days ago (#5643).\n\nBefore this change, cargo UI tests could fail when switching between branches if the previous branch had a test that the current branch does not have. The directory is not removed when switching because an ignored `Cargo.lock` file exists, and the code was trying to reach `$DIR/src` unconditionally.\n\nThis change will just skip a directory that has no `src` subdirectory.\n\nchangelog: none", "tree": {"sha": "25c7dd3a57324ae14017eedaf124f977fbecb6c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25c7dd3a57324ae14017eedaf124f977fbecb6c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f", "html_url": "https://github.com/rust-lang/rust/commit/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fdcb13edb4026d1058c793a553f1798c044870c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fdcb13edb4026d1058c793a553f1798c044870c", "html_url": "https://github.com/rust-lang/rust/commit/9fdcb13edb4026d1058c793a553f1798c044870c"}, {"sha": "14e9100543166e48acd0ea00233249d2cddf09c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/14e9100543166e48acd0ea00233249d2cddf09c2", "html_url": "https://github.com/rust-lang/rust/commit/14e9100543166e48acd0ea00233249d2cddf09c2"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "194354b291fdab97ade070c0a84badc3c846233b", "filename": "tests/compile-test.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=9f9877c47f5ce0529b8ebe3ed363a3b06ef9e86f", "patch": "@@ -181,8 +181,15 @@ fn run_ui_cargo(config: &mut compiletest::Config) {\n                 }\n \n                 let src_path = case.path().join(\"src\");\n-                env::set_current_dir(&src_path)?;\n \n+                // When switching between branches, if the previous branch had a test\n+                // that the current branch does not have, the directory is not removed\n+                // because an ignored Cargo.lock file exists.\n+                if !src_path.exists() {\n+                    continue;\n+                }\n+\n+                env::set_current_dir(&src_path)?;\n                 for file in fs::read_dir(&src_path)? {\n                     let file = file?;\n                     if file.file_type()?.is_dir() {"}]}