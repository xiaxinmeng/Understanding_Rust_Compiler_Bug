{"sha": "0d34fe42f724ba094b8d131f869c716204450e5c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkMzRmZTQyZjcyNGJhMDk0YjhkMTMxZjg2OWM3MTYyMDQ0NTBlNWM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-09-09T15:04:28Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-09-09T15:04:28Z"}, "message": "Unify escape usage", "tree": {"sha": "597e247e7785c35ef08128e024d629ad1bb09602", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/597e247e7785c35ef08128e024d629ad1bb09602"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0d34fe42f724ba094b8d131f869c716204450e5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0d34fe42f724ba094b8d131f869c716204450e5c", "html_url": "https://github.com/rust-lang/rust/commit/0d34fe42f724ba094b8d131f869c716204450e5c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0d34fe42f724ba094b8d131f869c716204450e5c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b5f9b2e973e438fc1726a2d164d046acd80b170", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b5f9b2e973e438fc1726a2d164d046acd80b170", "html_url": "https://github.com/rust-lang/rust/commit/6b5f9b2e973e438fc1726a2d164d046acd80b170"}], "stats": {"total": 47, "additions": 29, "deletions": 18}, "files": [{"sha": "ef2c6d877bfc66b18b25df60f8df464b83e6a628", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 29, "deletions": 18, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/0d34fe42f724ba094b8d131f869c716204450e5c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/0d34fe42f724ba094b8d131f869c716204450e5c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=0d34fe42f724ba094b8d131f869c716204450e5c", "patch": "@@ -39,6 +39,14 @@ if (!DOMTokenList.prototype.remove) {\n     };\n }\n \n+function getSearchInput() {\n+    return document.getElementsByClassName(\"search-input\")[0];\n+}\n+\n+function getSearchElement() {\n+    return document.getElementById(\"search\");\n+}\n+\n (function() {\n     \"use strict\";\n \n@@ -71,7 +79,7 @@ if (!DOMTokenList.prototype.remove) {\n                      \"derive\",\n                      \"traitalias\"];\n \n-    var search_input = document.getElementsByClassName(\"search-input\")[0];\n+    var search_input = getSearchInput();\n \n     // On the search screen, so you remain on the last tab you opened.\n     //\n@@ -158,7 +166,7 @@ if (!DOMTokenList.prototype.remove) {\n         // If we're in mobile mode, we should add the sidebar in any case.\n         hideSidebar();\n         var elem;\n-        var search = document.getElementById(\"search\");\n+        var search = getSearchElement();\n         var i, from, to, match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n         if (match) {\n             from = parseInt(match[1], 10);\n@@ -250,7 +258,12 @@ if (!DOMTokenList.prototype.remove) {\n         return String.fromCharCode(c);\n     }\n \n+    function getHelpElement() {\n+        return document.getElementById(\"help\");\n+    }\n+\n     function displayHelp(display, ev, help) {\n+        var help = help ? help : getHelpElement();\n         if (display === true) {\n             if (hasClass(help, \"hidden\")) {\n                 ev.preventDefault();\n@@ -264,9 +277,10 @@ if (!DOMTokenList.prototype.remove) {\n         }\n     }\n \n-    function handleEscape(ev, help) {\n+    function handleEscape(ev) {\n+        var help = getHelpElement();\n+        var search = getSearchElement();\n         hideModal();\n-        var search = document.getElementById(\"search\");\n         if (hasClass(help, \"hidden\") === false) {\n             displayHelp(false, ev, help);\n         } else if (hasClass(search, \"hidden\") === false) {\n@@ -284,22 +298,21 @@ if (!DOMTokenList.prototype.remove) {\n             return;\n         }\n \n-        var help = document.getElementById(\"help\");\n         if (document.activeElement.tagName === \"INPUT\") {\n             switch (getVirtualKey(ev)) {\n             case \"Escape\":\n-                handleEscape(ev, help);\n+                handleEscape(ev);\n                 break;\n             }\n         } else {\n             switch (getVirtualKey(ev)) {\n             case \"Escape\":\n-                handleEscape(ev, help);\n+                handleEscape(ev);\n                 break;\n \n             case \"s\":\n             case \"S\":\n-                displayHelp(false, ev, help);\n+                displayHelp(false, ev);\n                 hideModal();\n                 ev.preventDefault();\n                 focusSearchBar();\n@@ -314,7 +327,7 @@ if (!DOMTokenList.prototype.remove) {\n             case \"?\":\n                 if (ev.shiftKey) {\n                     hideModal();\n-                    displayHelp(true, ev, help);\n+                    displayHelp(true, ev);\n                 }\n                 break;\n             }\n@@ -1285,9 +1298,7 @@ if (!DOMTokenList.prototype.remove) {\n                 } else if (e.which === 16) { // shift\n                     // Does nothing, it's just to avoid losing \"focus\" on the highlighted element.\n                 } else if (e.which === 27) { // escape\n-                    removeClass(actives[currentTab][0], \"highlighted\");\n-                    search_input.value = \"\";\n-                    defocusSearchBar();\n+                    handleEscape(e);\n                 } else if (actives[currentTab].length > 0) {\n                     removeClass(actives[currentTab][0], \"highlighted\");\n                 }\n@@ -1438,7 +1449,7 @@ if (!DOMTokenList.prototype.remove) {\n                 ret_others[0] + ret_in_args[0] + ret_returned[0] + \"</div>\";\n \n             addClass(main, \"hidden\");\n-            var search = document.getElementById(\"search\");\n+            var search = getSearchElement();\n             removeClass(search, \"hidden\");\n             search.innerHTML = output;\n             var tds = search.getElementsByTagName(\"td\");\n@@ -1648,7 +1659,7 @@ if (!DOMTokenList.prototype.remove) {\n                     if (hasClass(main, \"content\")) {\n                         removeClass(main, \"hidden\");\n                     }\n-                    var search_c = document.getElementById(\"search\");\n+                    var search_c = getSearchElement();\n                     if (hasClass(search_c, \"content\")) {\n                         addClass(search_c, \"hidden\");\n                     }\n@@ -1695,7 +1706,7 @@ if (!DOMTokenList.prototype.remove) {\n                         if (hasClass(main, \"content\")) {\n                             removeClass(main, \"hidden\");\n                         }\n-                        var search_c = document.getElementById(\"search\");\n+                        var search_c = getSearchElement();\n                         if (hasClass(search_c, \"content\")) {\n                             addClass(search_c, \"hidden\");\n                         }\n@@ -2464,7 +2475,7 @@ if (!DOMTokenList.prototype.remove) {\n     var params = getQueryStringParams();\n     if (params && params.search) {\n         addClass(main, \"hidden\");\n-        var search = document.getElementById(\"search\");\n+        var search = getSearchElement();\n         removeClass(search, \"hidden\");\n         search.innerHTML = \"<h3 style=\\\"text-align: center;\\\">Loading search results...</h3>\";\n     }\n@@ -2549,10 +2560,10 @@ if (!DOMTokenList.prototype.remove) {\n \n // Sets the focus on the search bar at the top of the page\n function focusSearchBar() {\n-    document.getElementsByClassName(\"search-input\")[0].focus();\n+    getSearchInput().focus();\n }\n \n // Removes the focus from the search bar\n function defocusSearchBar() {\n-    document.getElementsByClassName(\"search-input\")[0].blur();\n+    getSearchInput().blur();\n }"}]}