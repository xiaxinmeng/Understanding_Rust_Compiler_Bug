{"sha": "4640615ce740766cf57b014722603b0bd0fffec2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2NDA2MTVjZTc0MDc2NmNmNTdiMDE0NzIyNjAzYjBiZDBmZmZlYzI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-23T10:40:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-23T10:40:08Z"}, "message": "Auto merge of #49372 - Phlosioneer:inherent-impl-default-error-message, r=nagisa\n\nBetter error message when trying to write default impls\n\nPreviously, if you tried to write this (using the specialization\nfeature flag):\n\ndefault impl PartialEq<MyType> {\n...\n}\n\nThe compiler would give you the mysterious warning \"inherent impls\ncannot be default\". What it really means is that you're trying to\nwrite an impl for a Structure or *Trait Object*, and that cannot\nbe \"default\". However, one of the ways to encounter this error\n(as shown by the above example) is when you forget to write \"for\nMyType\".\n\nThis PR adds a help message that reads \"maybe missing a `for`\nkeyword?\" This is useful, actionable advice that will help any user\nidentify their mistake, and doesn't get in the way or mislead any\nuser that really meant to use the \"default\" keyword for this weird\npurpose. In particular, this help message will be useful for any\nusers who don't know the \"inherent impl\" terminology, and/or users\nwho forget that inherent impls CAN be written for traits (they apply\nto the trait objects). Both of these are somewhat confusing, seldom-\nused concepts; a one-line error message without any error number for\nlonger explanation is NOT the place to introduce these ideas.\n\nI wasn't quite sure what grammar / wording to use. I'm open to suggestions. CC @rust-lang/docs (I hope I'm doing that notation right)\n\n(Apparently not. :( )", "tree": {"sha": "945945b82e395774cfcbba89ad86f7729bddf04c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/945945b82e395774cfcbba89ad86f7729bddf04c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4640615ce740766cf57b014722603b0bd0fffec2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4640615ce740766cf57b014722603b0bd0fffec2", "html_url": "https://github.com/rust-lang/rust/commit/4640615ce740766cf57b014722603b0bd0fffec2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4640615ce740766cf57b014722603b0bd0fffec2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fac3ca9c4e4ba3d27a9ffb29b78f7656d15e160", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fac3ca9c4e4ba3d27a9ffb29b78f7656d15e160", "html_url": "https://github.com/rust-lang/rust/commit/1fac3ca9c4e4ba3d27a9ffb29b78f7656d15e160"}, {"sha": "c61e641ed6462fb3a74b033a5db96f877256a021", "url": "https://api.github.com/repos/rust-lang/rust/commits/c61e641ed6462fb3a74b033a5db96f877256a021", "html_url": "https://github.com/rust-lang/rust/commit/c61e641ed6462fb3a74b033a5db96f877256a021"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "6708640379a54d2157a5f5adaba426a4d35c1d76", "filename": "src/librustc_passes/ast_validation.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4640615ce740766cf57b014722603b0bd0fffec2/src%2Flibrustc_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4640615ce740766cf57b014722603b0bd0fffec2/src%2Flibrustc_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Fast_validation.rs?ref=4640615ce740766cf57b014722603b0bd0fffec2", "patch": "@@ -273,7 +273,9 @@ impl<'a> Visitor<'a> for AstValidator<'a> {\n                     self.err_handler().span_err(item.span, \"inherent impls cannot be negative\");\n                 }\n                 if defaultness == Defaultness::Default {\n-                    self.err_handler().span_err(item.span, \"inherent impls cannot be default\");\n+                    self.err_handler()\n+                        .struct_span_err(item.span, \"inherent impls cannot be default\")\n+                        .note(\"only trait implementations may be annotated with default\").emit();\n                 }\n             }\n             ItemKind::ForeignMod(..) => {"}]}