{"sha": "569f0330d8e88aca3fabdfcb9b2dded9177002ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2OWYwMzMwZDhlODhhY2EzZmFiZGZjYjliMmRkZWQ5MTc3MDAyY2U=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-04T11:01:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-04T11:01:04Z"}, "message": "Rollup merge of #82315 - jsha:font-display-swap, r=GuillaumeGomez\n\nImprove page load performance in rustdoc\n\nAdd an explicit height to icons (which already had an explicit width) to allow browsers to lay out the page more accurately before the icons have been loaded. https://web.dev/optimize-cls/.\n\nAdd min-width: 115px to the crate search dropdown. When the HTML first loads, this dropdown includes only the text \"All crates.\" Later, JS loads the items underneath it, some of which are wider. That causes the dropdown to get wider, causing a distracting reflow. This sets a min-width based on the size that the dropdown eventually becomes based on the crates on doc.rust-lang.org, reducing page movement during load.\n\nAdd font-display: swap. Per https://web.dev/font-display/, this prevents \"flash of invisible text\" during load by using a system font until the custom font is available. I've noticed this flash of invisible text occasionally when reading Rust docs. Note that users without cached fonts will see text, and then see it reflow. For `docs.rust-lang.org`, [setting caching headers will help a lot](https://github.com/rust-lang/simpleinfra/issues/62).\n\nGenerated output at https://jacob.hoffman-andrews.com/rust/flow-improvements/std/string/struct.String.html.", "tree": {"sha": "d2d94b182227ff2b5e1b5f8b1250068906bcbafa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2d94b182227ff2b5e1b5f8b1250068906bcbafa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/569f0330d8e88aca3fabdfcb9b2dded9177002ce", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgQL3xCRBK7hj4Ov3rIwAAdHIIAAbvRpw6Z7M8LoBTTQZ8PSr1\nKIvLrzMq8PDk+VjANUZJiBGHULlIjfh64Qtw41tU8R5vDALNIAgS/RmlWRsWCG+C\nB3R2YoOiBDa7v3hWNN4qIWJidy8zaPFsD8fhug3bw2z+a2HToYsf9d7ifWOdmPSf\nfmPoJsmTB3ENsag5W4IHaZdqzt8wHFkrYGnJqwnUsbPj9oQ8B8Nd7L8dc1XGJ+mO\nV2WbsOVnG7XBkaMbBnLpnex4+F47VGjsgvPjTS/Q72bSsoEsJ3kzizXN0JSvxhr9\nxyczLJQ4KFMWx7zM5IqfN/KfNpTNV2AjeEuia8uk/tjQgcQ56n/JDLqnr4u0JlY=\n=oRX3\n-----END PGP SIGNATURE-----\n", "payload": "tree d2d94b182227ff2b5e1b5f8b1250068906bcbafa\nparent 36b7bef1cb0fb9d989f6c6e5ae9f001dea1b6a14\nparent f9cfe1583b18052bc5f42d92e8973e18ba404b19\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1614855664 +0900\ncommitter GitHub <noreply@github.com> 1614855664 +0900\n\nRollup merge of #82315 - jsha:font-display-swap, r=GuillaumeGomez\n\nImprove page load performance in rustdoc\n\nAdd an explicit height to icons (which already had an explicit width) to allow browsers to lay out the page more accurately before the icons have been loaded. https://web.dev/optimize-cls/.\n\nAdd min-width: 115px to the crate search dropdown. When the HTML first loads, this dropdown includes only the text \"All crates.\" Later, JS loads the items underneath it, some of which are wider. That causes the dropdown to get wider, causing a distracting reflow. This sets a min-width based on the size that the dropdown eventually becomes based on the crates on doc.rust-lang.org, reducing page movement during load.\n\nAdd font-display: swap. Per https://web.dev/font-display/, this prevents \"flash of invisible text\" during load by using a system font until the custom font is available. I've noticed this flash of invisible text occasionally when reading Rust docs. Note that users without cached fonts will see text, and then see it reflow. For `docs.rust-lang.org`, [setting caching headers will help a lot](https://github.com/rust-lang/simpleinfra/issues/62).\n\nGenerated output at https://jacob.hoffman-andrews.com/rust/flow-improvements/std/string/struct.String.html.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/569f0330d8e88aca3fabdfcb9b2dded9177002ce", "html_url": "https://github.com/rust-lang/rust/commit/569f0330d8e88aca3fabdfcb9b2dded9177002ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/569f0330d8e88aca3fabdfcb9b2dded9177002ce/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36b7bef1cb0fb9d989f6c6e5ae9f001dea1b6a14", "url": "https://api.github.com/repos/rust-lang/rust/commits/36b7bef1cb0fb9d989f6c6e5ae9f001dea1b6a14", "html_url": "https://github.com/rust-lang/rust/commit/36b7bef1cb0fb9d989f6c6e5ae9f001dea1b6a14"}, {"sha": "f9cfe1583b18052bc5f42d92e8973e18ba404b19", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9cfe1583b18052bc5f42d92e8973e18ba404b19", "html_url": "https://github.com/rust-lang/rust/commit/f9cfe1583b18052bc5f42d92e8973e18ba404b19"}], "stats": {"total": 24, "additions": 19, "deletions": 5}, "files": [{"sha": "ff18e1a8f51ccb008be5f7da63524f24214cfe7b", "filename": "src/doc/rust.css", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Fdoc%2Frust.css", "raw_url": "https://github.com/rust-lang/rust/raw/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Fdoc%2Frust.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frust.css?ref=569f0330d8e88aca3fabdfcb9b2dded9177002ce", "patch": "@@ -3,30 +3,35 @@\n \tfont-style: normal;\n \tfont-weight: 400;\n \tsrc: local('Fira Sans'), url(\"FiraSans-Regular.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Fira Sans';\n \tfont-style: normal;\n \tfont-weight: 500;\n \tsrc: local('Fira Sans Medium'), url(\"FiraSans-Medium.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Serif Pro';\n \tfont-style: normal;\n \tfont-weight: 400;\n \tsrc: local('Source Serif Pro'), url(\"SourceSerifPro-Regular.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Serif Pro';\n \tfont-style: italic;\n \tfont-weight: 400;\n \tsrc: url(\"SourceSerifPro-It.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Serif Pro';\n \tfont-style: normal;\n \tfont-weight: 700;\n \tsrc: local('Source Serif Pro Bold'), url(\"SourceSerifPro-Bold.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Code Pro';\n@@ -35,6 +40,7 @@\n \t/* Avoid using locally installed font because bad versions are in circulation:\n \t * see https://github.com/rust-lang/rust/issues/24355 */\n \tsrc: url(\"SourceCodePro-Regular.woff\") format('woff');\n+\tfont-display: swap;\n }\n \n *:not(body) {"}, {"sha": "ab65c71d7d1af16f6063e04f01ef96d832b5c828", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=569f0330d8e88aca3fabdfcb9b2dded9177002ce", "patch": "@@ -83,7 +83,7 @@ crate fn render<T: Print, S: Print>(\n     <div class=\\\"theme-picker\\\">\\\n         <button id=\\\"theme-picker\\\" aria-label=\\\"Pick another theme!\\\" aria-haspopup=\\\"menu\\\">\\\n             <img src=\\\"{static_root_path}brush{suffix}.svg\\\" \\\n-                 width=\\\"18\\\" \\\n+                 width=\\\"18\\\" height=\\\"18\\\" \\\n                  alt=\\\"Pick another theme!\\\">\\\n         </button>\\\n         <div id=\\\"theme-choices\\\" role=\\\"menu\\\"></div>\\\n@@ -103,7 +103,7 @@ crate fn render<T: Print, S: Print>(\n                 <button type=\\\"button\\\" class=\\\"help-button\\\">?</button>\n                 <a id=\\\"settings-menu\\\" href=\\\"{root_path}settings.html\\\">\\\n                     <img src=\\\"{static_root_path}wheel{suffix}.svg\\\" \\\n-                         width=\\\"18\\\" \\\n+                         width=\\\"18\\\" height=\\\"18\\\" \\\n                          alt=\\\"Change settings\\\">\\\n                 </a>\\\n             </div>\\"}, {"sha": "94c231cb33a8b1f7ac17484f29d299d4238fd855", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/569f0330d8e88aca3fabdfcb9b2dded9177002ce/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=569f0330d8e88aca3fabdfcb9b2dded9177002ce", "patch": "@@ -6,6 +6,7 @@\n \tsrc: local('Fira Sans'),\n \t\turl(\"FiraSans-Regular.woff2\") format(\"woff2\"),\n \t\turl(\"FiraSans-Regular.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Fira Sans';\n@@ -14,6 +15,7 @@\n \tsrc: local('Fira Sans Medium'),\n \t\turl(\"FiraSans-Medium.woff2\") format(\"woff2\"),\n \t\turl(\"FiraSans-Medium.woff\") format('woff');\n+\tfont-display: swap;\n }\n \n /* See SourceSerifPro-LICENSE.txt for the Source Serif Pro license. */\n@@ -22,18 +24,21 @@\n \tfont-style: normal;\n \tfont-weight: 400;\n \tsrc: local('Source Serif Pro'), url(\"SourceSerifPro-Regular.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Serif Pro';\n \tfont-style: italic;\n \tfont-weight: 400;\n \tsrc: local('Source Serif Pro Italic'), url(\"SourceSerifPro-It.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Serif Pro';\n \tfont-style: normal;\n \tfont-weight: 700;\n \tsrc: local('Source Serif Pro Bold'), url(\"SourceSerifPro-Bold.ttf.woff\") format('woff');\n+\tfont-display: swap;\n }\n \n /* See SourceCodePro-LICENSE.txt for the Source Code Pro license. */\n@@ -44,12 +49,14 @@\n \t/* Avoid using locally installed font because bad versions are in circulation:\n \t * see https://github.com/rust-lang/rust/issues/24355 */\n \tsrc: url(\"SourceCodePro-Regular.woff\") format('woff');\n+\tfont-display: swap;\n }\n @font-face {\n \tfont-family: 'Source Code Pro';\n \tfont-style: normal;\n \tfont-weight: 600;\n \tsrc: url(\"SourceCodePro-Semibold.woff\") format('woff');\n+\tfont-display: swap;\n }\n \n * {\n@@ -129,7 +136,7 @@ h1, h2, h3, h4,\n #source-sidebar, #sidebar-toggle,\n /* This selector is for the items listed in the \"all items\" page. */\n #main > ul.docblock > li > a {\n-\tfont-family: \"Fira Sans\", sans-serif;\n+\tfont-family: \"Fira Sans\", Arial;\n }\n \n .content ul.crate a.crate {\n@@ -475,7 +482,7 @@ h4 > code, h3 > code, .invisible > code {\n }\n #main > .since {\n \ttop: inherit;\n-\tfont-family: \"Fira Sans\", sans-serif;\n+\tfont-family: \"Fira Sans\", Arial;\n }\n \n .content table:not(.table-display) {\n@@ -684,6 +691,7 @@ a {\n \twidth: calc(100% - 63px);\n }\n #crate-search {\n+\tmin-width: 115px;\n \tmargin-top: 5px;\n \tpadding: 6px;\n \tpadding-right: 19px;\n@@ -1293,7 +1301,7 @@ h4 > .notable-traits {\n \n .help-button {\n \tright: 30px;\n-\tfont-family: \"Fira Sans\",sans-serif;\n+\tfont-family: \"Fira Sans\", Arial;\n \ttext-align: center;\n \tfont-size: 17px;\n }"}]}