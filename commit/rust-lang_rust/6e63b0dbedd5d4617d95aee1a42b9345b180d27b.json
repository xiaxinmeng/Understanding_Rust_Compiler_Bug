{"sha": "6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlNjNiMGRiZWRkNWQ0NjE3ZDk1YWVlMWE0MmI5MzQ1YjE4MGQyN2I=", "commit": {"author": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2018-08-02T03:30:04Z"}, "committer": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2018-08-02T04:58:25Z"}, "message": "`Applicability`-ify librustc_lint\n\nAndrew Chin recently pointed out (rust-lang/cargo#5846) that it's\nsurprising that `cargo fix` (now shipping with Cargo itself!) doesn't\nfix very common lint warnings, which is as good of a reminder as any\nthat we should finish #50723.", "tree": {"sha": "04388093e4b862c7616c815a139a5fc830662cd4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04388093e4b862c7616c815a139a5fc830662cd4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "html_url": "https://github.com/rust-lang/rust/commit/6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/comments", "author": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d9405fb6caa5eac18e5a28685e4f30dcbde6d45", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d9405fb6caa5eac18e5a28685e4f30dcbde6d45", "html_url": "https://github.com/rust-lang/rust/commit/1d9405fb6caa5eac18e5a28685e4f30dcbde6d45"}], "stats": {"total": 76, "additions": 57, "deletions": 19}, "files": [{"sha": "be04b326da94c782c2dff877a9a1241178203e5b", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 40, "deletions": 11, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "patch": "@@ -84,7 +84,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for WhileTrue {\n                         let msg = \"denote infinite loops with `loop { ... }`\";\n                         let condition_span = cx.tcx.sess.codemap().def_span(e.span);\n                         let mut err = cx.struct_span_lint(WHILE_TRUE, condition_span, msg);\n-                        err.span_suggestion_short(condition_span, \"use `loop`\", \"loop\".to_owned());\n+                        err.span_suggestion_short_with_applicability(\n+                            condition_span,\n+                            \"use `loop`\",\n+                            \"loop\".to_owned(),\n+                            Applicability::MachineApplicable\n+                        );\n                         err.emit();\n                     }\n                 }\n@@ -191,7 +196,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NonShorthandFieldPatterns {\n                                      fieldpat.span,\n                                      &format!(\"the `{}:` in this pattern is redundant\", ident));\n                         let subspan = cx.tcx.sess.codemap().span_through_char(fieldpat.span, ':');\n-                        err.span_suggestion_short(subspan, \"remove this\", ident.to_string());\n+                        err.span_suggestion_short_with_applicability(\n+                            subspan,\n+                            \"remove this\",\n+                            ident.to_string(),\n+                            Applicability::MachineApplicable\n+                        );\n                         err.emit();\n                     }\n                 }\n@@ -708,10 +718,11 @@ impl EarlyLintPass for BadRepr {\n                         | \"i8\" | \"i16\" | \"i32\" | \"i64\" | \"i128\" | \"isize\" => {\n                             // if the literal could have been a valid `repr` arg,\n                             // suggest the correct syntax\n-                            warn.span_suggestion(\n+                            warn.span_suggestion_with_applicability(\n                                 attr.span,\n                                 \"give `repr` a hint\",\n                                 repr_str(&lit.as_str()),\n+                                Applicability::MachineApplicable\n                             );\n                             suggested = true;\n                         }\n@@ -779,7 +790,12 @@ impl EarlyLintPass for DeprecatedAttr {\n                     let msg = format!(\"use of deprecated attribute `{}`: {}. See {}\",\n                                       name, reason, link);\n                     let mut err = cx.struct_span_lint(DEPRECATED, attr.span, &msg);\n-                    err.span_suggestion_short(attr.span, \"remove this attribute\", \"\".to_owned());\n+                    err.span_suggestion_short_with_applicability(\n+                        attr.span,\n+                        \"remove this attribute\",\n+                        \"\".to_owned(),\n+                        Applicability::MachineApplicable\n+                    );\n                     err.emit();\n                 }\n                 return;\n@@ -1201,7 +1217,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for InvalidNoMangleItems {\n                 }\n             };\n             if let Some(replacement) = suggestion {\n-                err.span_suggestion(vis.span, \"try making it public\", replacement);\n+                err.span_suggestion_with_applicability(\n+                    vis.span,\n+                    \"try making it public\",\n+                    replacement,\n+                    Applicability::MachineApplicable\n+                );\n             }\n         };\n \n@@ -1225,9 +1246,14 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for InvalidNoMangleItems {\n                                                                   it.span,\n                                                                   \"functions generic over \\\n                                                                    types must be mangled\");\n-                                err.span_suggestion_short(no_mangle_attr.span,\n-                                                          \"remove this attribute\",\n-                                                          \"\".to_owned());\n+                                err.span_suggestion_short_with_applicability(\n+                                    no_mangle_attr.span,\n+                                    \"remove this attribute\",\n+                                    \"\".to_owned(),\n+                                    // Use of `#[no_mangle]` suggests FFI intent; correct\n+                                    // fix may be to monomorphize source by hand\n+                                    Applicability::MaybeIncorrect\n+                                );\n                                 err.emit();\n                                 break;\n                             }\n@@ -1257,9 +1283,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for InvalidNoMangleItems {\n                         .unwrap_or(0) as u32;\n                     // `const` is 5 chars\n                     let const_span = it.span.with_hi(BytePos(it.span.lo().0 + start + 5));\n-                    err.span_suggestion(const_span,\n-                                        \"try a static value\",\n-                                        \"pub static\".to_owned());\n+                    err.span_suggestion_with_applicability(\n+                        const_span,\n+                        \"try a static value\",\n+                        \"pub static\".to_owned(),\n+                        Applicability::MachineApplicable\n+                    );\n                     err.emit();\n                 }\n             }"}, {"sha": "4dc66fb812144d884476b0d5ef354824caee9ae9", "filename": "src/librustc_lint/types.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Ftypes.rs?ref=6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "patch": "@@ -22,6 +22,7 @@ use std::cmp;\n use std::{i8, i16, i32, i64, u8, u16, u32, u64, f32, f64};\n \n use syntax::{ast, attr};\n+use syntax::errors::Applicability;\n use rustc_target::spec::abi::Abi;\n use syntax_pos::Span;\n use syntax::codemap;\n@@ -143,9 +144,12 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for TypeLimits {\n                                                              OVERFLOWING_LITERALS,\n                                                              parent_expr.span,\n                                                              \"only u8 can be cast into char\");\n-                                        err.span_suggestion(parent_expr.span,\n-                                                            &\"use a char literal instead\",\n-                                                            format!(\"'\\\\u{{{:X}}}'\", lit_val));\n+                                        err.span_suggestion_with_applicability(\n+                                            parent_expr.span,\n+                                            &\"use a char literal instead\",\n+                                            format!(\"'\\\\u{{{:X}}}'\", lit_val),\n+                                            Applicability::MachineApplicable\n+                                        );\n                                         err.emit();\n                                         return\n                                     }\n@@ -398,10 +402,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for TypeLimits {\n             {\n                 if let Some(pos) = repr_str.chars().position(|c| c == 'i' || c == 'u') {\n                     let (sans_suffix, _) = repr_str.split_at(pos);\n-                    err.span_suggestion(\n+                    err.span_suggestion_with_applicability(\n                         expr.span,\n                         &format!(\"consider using `{}` instead\", sugg_ty),\n                         format!(\"{}{}\", sans_suffix, sugg_ty),\n+                        Applicability::MachineApplicable\n                     );\n                 } else {\n                     err.help(&format!(\"consider using `{}` instead\", sugg_ty));"}, {"sha": "2b8540ea3861a25761de61597d1cae79f8ebefc6", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "patch": "@@ -17,6 +17,7 @@ use lint::{LintPass, EarlyLintPass, LateLintPass};\n \n use syntax::ast;\n use syntax::attr;\n+use syntax::errors::Applicability;\n use syntax::feature_gate::{BUILTIN_ATTRIBUTES, AttributeType};\n use syntax::print::pprust;\n use syntax::symbol::keywords;\n@@ -303,9 +304,12 @@ impl UnusedParens {\n                             _ => false,\n                         }\n                     }).to_owned();\n-                err.span_suggestion_short(value.span,\n-                                          \"remove these parentheses\",\n-                                          parens_removed);\n+                err.span_suggestion_short_with_applicability(\n+                    value.span,\n+                    \"remove these parentheses\",\n+                    parens_removed,\n+                    Applicability::MachineApplicable\n+                );\n                 err.emit();\n             }\n         }"}, {"sha": "2a9bd2948ffeb4fbe96302fe80957a6d4ddf7632", "filename": "src/test/ui/lint/unused_parens_json_suggestion.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Ftest%2Fui%2Flint%2Funused_parens_json_suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6e63b0dbedd5d4617d95aee1a42b9345b180d27b/src%2Ftest%2Fui%2Flint%2Funused_parens_json_suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused_parens_json_suggestion.stderr?ref=6e63b0dbedd5d4617d95aee1a42b9345b180d27b", "patch": "@@ -82,7 +82,7 @@\n           ],\n           \"label\": null,\n           \"suggested_replacement\": \"1 / (2 + 3)\",\n-          \"suggestion_applicability\": \"Unspecified\",\n+          \"suggestion_applicability\": \"MachineApplicable\",\n           \"expansion\": null\n         }\n       ],"}]}