{"sha": "fcee9506602829a2ed8505c0ba657d12b972e7ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjZWU5NTA2NjAyODI5YTJlZDg1MDVjMGJhNjU3ZDEyYjk3MmU3YWU=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2017-10-02T23:29:03Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2017-10-09T14:56:17Z"}, "message": "let rustdoc print the crate version into docs", "tree": {"sha": "cce6c27579e57527d3597fc8f5253afa0aec3ec4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cce6c27579e57527d3597fc8f5253afa0aec3ec4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fcee9506602829a2ed8505c0ba657d12b972e7ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fcee9506602829a2ed8505c0ba657d12b972e7ae", "html_url": "https://github.com/rust-lang/rust/commit/fcee9506602829a2ed8505c0ba657d12b972e7ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fcee9506602829a2ed8505c0ba657d12b972e7ae/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1db1144277abbf1ffc14d4e9a143cf87d1ef6d41", "url": "https://api.github.com/repos/rust-lang/rust/commits/1db1144277abbf1ffc14d4e9a143cf87d1ef6d41", "html_url": "https://github.com/rust-lang/rust/commit/1db1144277abbf1ffc14d4e9a143cf87d1ef6d41"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "6cf8ea3c57dd0911fe820837c526312a38f37544", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=fcee9506602829a2ed8505c0ba657d12b972e7ae", "patch": "@@ -112,6 +112,7 @@ impl<T: Clean<U>, U> Clean<Vec<U>> for P<[T]> {\n #[derive(Clone, Debug)]\n pub struct Crate {\n     pub name: String,\n+    pub version: Option<String>,\n     pub src: PathBuf,\n     pub module: Option<Item>,\n     pub externs: Vec<(CrateNum, ExternalCrate)>,\n@@ -183,6 +184,7 @@ impl<'a, 'tcx> Clean<Crate> for visit_ast::RustdocVisitor<'a, 'tcx> {\n \n         Crate {\n             name,\n+            version: None,\n             src,\n             module: Some(module),\n             externs,"}, {"sha": "9bc94eff14223925e0fd8fa9ca581795654f20b4", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=fcee9506602829a2ed8505c0ba657d12b972e7ae", "patch": "@@ -256,6 +256,9 @@ pub struct Cache {\n     // the access levels from crateanalysis.\n     pub access_levels: Arc<AccessLevels<DefId>>,\n \n+    /// The version of the crate being documented, if given fron the `--crate-version` flag.\n+    pub crate_version: Option<String>,\n+\n     // Private fields only used when initially crawling a crate to build a cache\n \n     stack: Vec<String>,\n@@ -534,6 +537,7 @@ pub fn run(mut krate: clean::Crate,\n         primitive_locations: FxHashMap(),\n         stripped_mod: false,\n         access_levels: krate.access_levels.clone(),\n+        crate_version: krate.version.take(),\n         orphan_impl_items: Vec::new(),\n         traits: mem::replace(&mut krate.external_traits, FxHashMap()),\n         deref_trait_did,\n@@ -3422,6 +3426,16 @@ impl<'a> fmt::Display for Sidebar<'a> {\n             write!(fmt, \"{}\", it.name.as_ref().unwrap())?;\n             write!(fmt, \"</p>\")?;\n \n+            if it.is_crate() {\n+                if let Some(ref version) = cache().crate_version {\n+                    write!(fmt,\n+                           \"<div class='block version'>\\\n+                            <p>Version {}</p>\\\n+                            </div>\",\n+                           version)?;\n+                }\n+            }\n+\n             match it.inner {\n                 clean::StructItem(ref s) => sidebar_struct(fmt, it, s)?,\n                 clean::TraitItem(ref t) => sidebar_trait(fmt, it, t)?,"}, {"sha": "61a3902098ffa6eab4c6139143f19e747880fbd7", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=fcee9506602829a2ed8505c0ba657d12b972e7ae", "patch": "@@ -203,6 +203,15 @@ nav.sub {\n \tword-wrap: break-word;\n }\n \n+.sidebar .version {\n+\tfont-size: 15px;\n+\ttext-align: center;\n+\tborder-bottom: #DDDDDD 1px solid;\n+\toverflow-wrap: break-word;\n+\tword-wrap: break-word; /* deprecated */\n+\tword-break: break-word; /* Chrome, non-standard */\n+}\n+\n .location:empty {\n \tborder: none;\n }"}, {"sha": "f8bf00ad73fcca1fb9fc417e80978d6a47e1e619", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=fcee9506602829a2ed8505c0ba657d12b972e7ae", "patch": "@@ -243,6 +243,9 @@ pub fn opts() -> Vec<RustcOptGroup> {\n         unstable(\"display-warnings\", |o| {\n             o.optflag(\"\", \"display-warnings\", \"to print code warnings when testing doc\")\n         }),\n+        unstable(\"crate-version\", |o| {\n+            o.optopt(\"\", \"crate-version\", \"crate version to print into documentation\", \"VERSION\")\n+        }),\n     ]\n }\n \n@@ -460,6 +463,7 @@ where R: 'static + Send, F: 'static + Send + FnOnce(Output) -> R {\n     let triple = matches.opt_str(\"target\");\n     let maybe_sysroot = matches.opt_str(\"sysroot\").map(PathBuf::from);\n     let crate_name = matches.opt_str(\"crate-name\");\n+    let crate_version = matches.opt_str(\"crate-version\");\n     let plugin_path = matches.opt_str(\"plugin-path\");\n \n     let cr = PathBuf::from(cratefile);\n@@ -484,6 +488,8 @@ where R: 'static + Send, F: 'static + Send + FnOnce(Output) -> R {\n             krate.name = name\n         }\n \n+        krate.version = crate_version;\n+\n         // Process all of the crate attributes, extracting plugin metadata along\n         // with the passes which we are supposed to run.\n         for attr in krate.module.as_ref().unwrap().attrs.lists(\"doc\") {"}, {"sha": "07ab5ceedfa028dc068b3d692d76e000fde12e06", "filename": "src/test/rustdoc/crate-version.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Ftest%2Frustdoc%2Fcrate-version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fcee9506602829a2ed8505c0ba657d12b972e7ae/src%2Ftest%2Frustdoc%2Fcrate-version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fcrate-version.rs?ref=fcee9506602829a2ed8505c0ba657d12b972e7ae", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: --crate-version=1.3.37 -Z unstable-options\n+\n+// @has 'crate_version/index.html' '//div[@class=\"block version\"]/p' 'Version 1.3.37'"}]}