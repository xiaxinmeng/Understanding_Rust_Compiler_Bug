{"sha": "a4ba088ef839de00cf97a905083be19c212c8a9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0YmEwODhlZjgzOWRlMDBjZjk3YTkwNTA4M2JlMTljMjEyYzhhOWM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-05-22T18:40:46Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-05-31T04:23:34Z"}, "message": "build: Add USE_SNAPSHOT_STDLIB. Set to 1", "tree": {"sha": "1f90c0e1bea80edcd1234fc7a46837f507a070e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1f90c0e1bea80edcd1234fc7a46837f507a070e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4ba088ef839de00cf97a905083be19c212c8a9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4ba088ef839de00cf97a905083be19c212c8a9c", "html_url": "https://github.com/rust-lang/rust/commit/a4ba088ef839de00cf97a905083be19c212c8a9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4ba088ef839de00cf97a905083be19c212c8a9c/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1523298bc73b2ef9141163daae1f71d5908ade10", "url": "https://api.github.com/repos/rust-lang/rust/commits/1523298bc73b2ef9141163daae1f71d5908ade10", "html_url": "https://github.com/rust-lang/rust/commit/1523298bc73b2ef9141163daae1f71d5908ade10"}], "stats": {"total": 43, "additions": 36, "deletions": 7}, "files": [{"sha": "3d208a088ae4ad9ce5e249e589566ad5a19300a1", "filename": "mk/target.mk", "status": "modified", "additions": 36, "deletions": 7, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/a4ba088ef839de00cf97a905083be19c212c8a9c/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/a4ba088ef839de00cf97a905083be19c212c8a9c/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=a4ba088ef839de00cf97a905083be19c212c8a9c", "patch": "@@ -10,6 +10,7 @@\n # (resp. corelib) from the working directory.\n USE_SNAPSHOT_RUNTIME=1\n USE_SNAPSHOT_CORELIB=1\n+USE_SNAPSHOT_STDLIB=1\n \n define TARGET_STAGE_N\n \n@@ -18,13 +19,6 @@ $$(TLIB$(1)_T_$(2)_H_$(3))/libmorestack.a: \\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_STDLIB): \\\n-\t\t$$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n-\t        $$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_CORELIB) \\\n-\t\t$$(TSREQ$(1)_T_$(2)_H_$(3))\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)_T_$(2)_H_$(3)) -o $$@ $$< && touch $$@\n-\n $$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_RUSTLLVM): \\\n \t\trustllvm/$(2)/$$(CFG_RUSTLLVM)\n \t@$$(call E, cp: $$@)\n@@ -116,6 +110,30 @@ $$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_CORELIB): \\\n \n endef\n \n+define TARGET_STDLIB_FROM_SNAPSHOT\n+\n+$$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_STDLIB): \\\n+\t\t$$(HLIB$(1)_H_$(3))/$$(CFG_STDLIB) \\\n+\t\t$$(STDLIB_INPUTS) \\\n+\t\t$$(TSREQ$(1)_T_$(2)_H_$(3))\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+\t$$(Q)cp $$(HLIB$(1)_H_$(3))/$$(STDLIB_GLOB) \\\n+\t\t$$(TLIB$(1)_T_$(2)_H_$(3))\n+\n+endef\n+\n+define TARGET_STDLIB_FROM_WD\n+\n+$$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_STDLIB): \\\n+\t\t$$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n+\t        $$(TLIB$(1)_T_$(2)_H_$(3))/$$(CFG_CORELIB) \\\n+\t\t$$(TSREQ$(1)_T_$(2)_H_$(3))\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)_T_$(2)_H_$(3)) -o $$@ $$< && touch $$@\n+\n+endef\n+\n # In principle, each host can build each target:\n $(foreach source,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n  $(foreach target,$(CFG_TARGET_TRIPLES),\t\t\t\\\n@@ -142,6 +160,14 @@ else\n \t\t$(eval $(call TARGET_CORELIB_FROM_WD,0,$(src),$(src))))\n endif\n \n+ifeq ($(USE_SNAPSHOT_STDLIB),1)\n+    $(foreach src,$(CFG_HOST_TRIPLE),\\\n+\t\t$(eval $(call TARGET_STDLIB_FROM_SNAPSHOT,0,$(src),$(src))))\n+else\n+    $(foreach src,$(CFG_HOST_TRIPLE),\\\n+\t\t$(eval $(call TARGET_STDLIB_FROM_WD,0,$(src),$(src))))\n+endif\n+\n # Non-host triples build the stage0 runtime from the working directory\n $(foreach source,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n  $(foreach target,$(NON_HOST_TRIPLES),\t\t\t\t\\\n@@ -158,5 +184,8 @@ $(foreach source,$(CFG_TARGET_TRIPLES),\t\t\t\t\\\n   $(eval $(call TARGET_CORELIB_FROM_WD,1,$(target),$(source)))\t\\\n   $(eval $(call TARGET_CORELIB_FROM_WD,2,$(target),$(source)))\t\\\n   $(eval $(call TARGET_CORELIB_FROM_WD,3,$(target),$(source)))\t\\\n+  $(eval $(call TARGET_STDLIB_FROM_WD,1,$(target),$(source)))\t\\\n+  $(eval $(call TARGET_STDLIB_FROM_WD,2,$(target),$(source)))\t\\\n+  $(eval $(call TARGET_STDLIB_FROM_WD,3,$(target),$(source)))\t\\\n ))\n "}]}