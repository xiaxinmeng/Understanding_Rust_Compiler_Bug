{"sha": "5671a7611924fef91cc69d6a394412f4e990e4e4", "node_id": "C_kwDOAAsO6NoAKDU2NzFhNzYxMTkyNGZlZjkxY2M2OWQ2YTM5NDQxMmY0ZTk5MGU0ZTQ", "commit": {"author": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-09-13T21:41:07Z"}, "committer": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-09-13T22:16:19Z"}, "message": "Update partial-drop-partial-reinit.rs", "tree": {"sha": "a17b27b1b6d1d5e14f6933a435dae5bdfce69835", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a17b27b1b6d1d5e14f6933a435dae5bdfce69835"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5671a7611924fef91cc69d6a394412f4e990e4e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5671a7611924fef91cc69d6a394412f4e990e4e4", "html_url": "https://github.com/rust-lang/rust/commit/5671a7611924fef91cc69d6a394412f4e990e4e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5671a7611924fef91cc69d6a394412f4e990e4e4/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b950ae44e08c549029368f95d0af833ca1e92016", "url": "https://api.github.com/repos/rust-lang/rust/commits/b950ae44e08c549029368f95d0af833ca1e92016", "html_url": "https://github.com/rust-lang/rust/commit/b950ae44e08c549029368f95d0af833ca1e92016"}], "stats": {"total": 52, "additions": 45, "deletions": 7}, "files": [{"sha": "17b4ef7bdc671705abd27ca37e8423cb94878cc2", "filename": "src/test/ui/async-await/partial-drop-partial-reinit.drop_tracking.stderr", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.drop_tracking.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.drop_tracking.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.drop_tracking.stderr?ref=5671a7611924fef91cc69d6a394412f4e990e4e4", "patch": "@@ -0,0 +1,35 @@\n+error[E0277]: `NotSend` cannot be sent between threads safely\n+  --> $DIR/partial-drop-partial-reinit.rs:9:16\n+   |\n+LL |     gimme_send(foo());\n+   |     ---------- ^^^^^ `NotSend` cannot be sent between threads safely\n+   |     |\n+   |     required by a bound introduced by this call\n+...\n+LL | async fn foo() {\n+   |                - within this `impl Future<Output = ()>`\n+   |\n+   = help: within `impl Future<Output = ()>`, the trait `Send` is not implemented for `NotSend`\n+   = note: required because it appears within the type `(NotSend,)`\n+   = note: required because it captures the following types: `ResumeTy`, `(NotSend,)`, `()`, `impl Future<Output = ()>`\n+note: required because it's used within this `async fn` body\n+  --> $DIR/partial-drop-partial-reinit.rs:31:16\n+   |\n+LL |   async fn foo() {\n+   |  ________________^\n+LL | |\n+LL | |\n+LL | |     let mut x = (NotSend {},);\n+...  |\n+LL | |     bar().await;\n+LL | | }\n+   | |_^\n+note: required by a bound in `gimme_send`\n+  --> $DIR/partial-drop-partial-reinit.rs:17:18\n+   |\n+LL | fn gimme_send<T: Send>(t: T) {\n+   |                  ^^^^ required by this bound in `gimme_send`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "34d8a159f1064bf05c1e448b9be5303830be108f", "filename": "src/test/ui/async-await/partial-drop-partial-reinit.no_drop_tracking.stderr", "status": "renamed", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.no_drop_tracking.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.no_drop_tracking.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.no_drop_tracking.stderr?ref=5671a7611924fef91cc69d6a394412f4e990e4e4", "patch": "@@ -1,5 +1,5 @@\n error[E0277]: `NotSend` cannot be sent between threads safely\n-  --> $DIR/partial-drop-partial-reinit.rs:6:16\n+  --> $DIR/partial-drop-partial-reinit.rs:9:16\n    |\n LL |     gimme_send(foo());\n    |     ---------- ^^^^^ `NotSend` cannot be sent between threads safely\n@@ -13,7 +13,7 @@ LL | async fn foo() {\n    = note: required because it appears within the type `(NotSend,)`\n    = note: required because it captures the following types: `ResumeTy`, `(NotSend,)`, `impl Future<Output = ()>`, `()`\n note: required because it's used within this `async fn` body\n-  --> $DIR/partial-drop-partial-reinit.rs:28:16\n+  --> $DIR/partial-drop-partial-reinit.rs:31:16\n    |\n LL |   async fn foo() {\n    |  ________________^\n@@ -25,7 +25,7 @@ LL | |     bar().await;\n LL | | }\n    | |_^\n note: required by a bound in `gimme_send`\n-  --> $DIR/partial-drop-partial-reinit.rs:14:18\n+  --> $DIR/partial-drop-partial-reinit.rs:17:18\n    |\n LL | fn gimme_send<T: Send>(t: T) {\n    |                  ^^^^ required by this bound in `gimme_send`", "previous_filename": "src/test/ui/async-await/partial-drop-partial-reinit.stderr"}, {"sha": "7d097e72fb49d4d99ee370a87bd65347b7bcb5eb", "filename": "src/test/ui/async-await/partial-drop-partial-reinit.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5671a7611924fef91cc69d6a394412f4e990e4e4/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fpartial-drop-partial-reinit.rs?ref=5671a7611924fef91cc69d6a394412f4e990e4e4", "patch": "@@ -1,4 +1,7 @@\n // edition:2021\n+// revisions: no_drop_tracking drop_tracking\n+// [drop_tracking] compile-flags: -Zdrop-tracking=yes\n+// [no_drop_tracking] compile-flags: -Zdrop-tracking=no\n #![feature(negative_impls)]\n #![allow(unused)]\n \n@@ -12,8 +15,8 @@ fn main() {\n }\n \n fn gimme_send<T: Send>(t: T) {\n-//~^ NOTE required by this bound\n-//~| NOTE required by a bound\n+    //~^ NOTE required by this bound\n+    //~| NOTE required by a bound\n     drop(t);\n }\n \n@@ -26,8 +29,8 @@ impl Drop for NotSend {\n impl !Send for NotSend {}\n \n async fn foo() {\n-//~^ NOTE used within this `async fn` body\n-//~| NOTE within this `impl Future\n+    //~^ NOTE used within this `async fn` body\n+    //~| NOTE within this `impl Future\n     let mut x = (NotSend {},);\n     drop(x.0);\n     x.0 = NotSend {};"}]}