{"sha": "3d39379f9c1541e6642c89a839d1bfd0538d8a00", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkMzkzNzlmOWMxNTQxZTY2NDJjODlhODM5ZDFiZmQwNTM4ZDhhMDA=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-10-06T12:49:26Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-10-06T12:49:26Z"}, "message": "Move is_argument check into mutate", "tree": {"sha": "a412995c7588caf85c5e2bff6231d7fb3088c3f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a412995c7588caf85c5e2bff6231d7fb3088c3f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d39379f9c1541e6642c89a839d1bfd0538d8a00", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl2Z4tYACgkQaTCGhp1Q\nZjdPdBAAiqsU/ety2HxDYw39xbmlN26Au6FPxm2lBRli/jfzFQyb/Luta7HyXafn\npB4RKXhhWQSR2QOvk8DKPrDuI3VzvPalbHrkde8VHXdWRimhNl4iCikDVM4vmtIn\nPPZAhu3uICDzJBLRH+7Pfxihna/Db+DFqCwDd2aR9McW7TI/UMUMwiLCClg8xQKO\n28H+pFPJJN9opr0kHMyf4rCRv0L3rrBqW+N9n24YoiMG8zwswkoudJIeTBW8zWV5\nBoR/B7mmb4D6kNO0mqqSKOw/EynTxPCfqO4j3YQsUNb9t4A1tqZZbVNMy0g0U+Fy\nfGsu6WHxK3hKYlWAPin5MItUqaeFT5TX+5b39PvkoCt/cuw0jmdyHRqouBP68Kqm\n5yGBbP0fTLdADzTZIicU8N8CwEJwxnQ7w1P3eDvOBoLpeFSJ9Iafr7z9rKC1IJvq\ntay4eOuyVx690BGUZ4FSdgZMAVaJ9d4pF2xP/hqiGavgPCf+u4eMqLtDMPT6RVR4\nEeuI9M5v7fHWXEyDNXA9krNTdcCVv39TeOzGtfgVazE1JKpduJruUHHBAva/kFtU\ncMhmTAHmCkO3gB+6GLeeWovXPYTZtgBPQ9mS/7dRSg3P7aFR8ecoCWzwY+CwFxS+\nVRWdrn7FOTyP7hcV2J6d8nIadSuhykQrbG6vRswXrJagx839C6E=\n=W3sU\n-----END PGP SIGNATURE-----", "payload": "tree a412995c7588caf85c5e2bff6231d7fb3088c3f5\nparent 3aa531c194c4a73ec3238726544cb249b0fbc9ff\nauthor flip1995 <hello@philkrones.com> 1570366166 +0200\ncommitter flip1995 <hello@philkrones.com> 1570366166 +0200\n\nMove is_argument check into mutate\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d39379f9c1541e6642c89a839d1bfd0538d8a00", "html_url": "https://github.com/rust-lang/rust/commit/3d39379f9c1541e6642c89a839d1bfd0538d8a00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d39379f9c1541e6642c89a839d1bfd0538d8a00/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3aa531c194c4a73ec3238726544cb249b0fbc9ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/3aa531c194c4a73ec3238726544cb249b0fbc9ff", "html_url": "https://github.com/rust-lang/rust/commit/3aa531c194c4a73ec3238726544cb249b0fbc9ff"}], "stats": {"total": 44, "additions": 31, "deletions": 13}, "files": [{"sha": "bb6e0e5c51c2812b68fcf13cecc32be8a2f4068f", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 15, "deletions": 13, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/3d39379f9c1541e6642c89a839d1bfd0538d8a00/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d39379f9c1541e6642c89a839d1bfd0538d8a00/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=3d39379f9c1541e6642c89a839d1bfd0538d8a00", "patch": "@@ -113,18 +113,6 @@ impl<'a, 'tcx> Delegate<'tcx> for EscapeDelegate<'a, 'tcx> {\n             }\n         }\n         let map = &self.cx.tcx.hir();\n-        if is_argument(map, cmt.hir_id) {\n-            // Skip closure arguments\n-            let parent_id = map.get_parent_node(cmt.hir_id);\n-            if let Some(Node::Expr(..)) = map.find(map.get_parent_node(parent_id)) {\n-                return;\n-            }\n-\n-            if is_non_trait_box(cmt.ty) && !self.is_large_box(cmt.ty) {\n-                self.set.insert(cmt.hir_id);\n-            }\n-            return;\n-        }\n         if let Categorization::Local(lid) = cmt.cat {\n             if let Some(Node::Binding(_)) = map.find(cmt.hir_id) {\n                 if self.set.contains(&lid) {\n@@ -143,7 +131,21 @@ impl<'a, 'tcx> Delegate<'tcx> for EscapeDelegate<'a, 'tcx> {\n         }\n     }\n \n-    fn mutate(&mut self, _: &cmt_<'tcx>) {}\n+    fn mutate(&mut self, cmt: &cmt_<'tcx>) {\n+        let map = &self.cx.tcx.hir();\n+        if is_argument(map, cmt.hir_id) {\n+            // Skip closure arguments\n+            let parent_id = map.get_parent_node(cmt.hir_id);\n+            if let Some(Node::Expr(..)) = map.find(map.get_parent_node(parent_id)) {\n+                return;\n+            }\n+\n+            if is_non_trait_box(cmt.ty) && !self.is_large_box(cmt.ty) {\n+                self.set.insert(cmt.hir_id);\n+            }\n+            return;\n+        }\n+    }\n }\n \n impl<'a, 'tcx> EscapeDelegate<'a, 'tcx> {"}, {"sha": "19342fe1be742b5f041b76492cfb1a6cc85429a3", "filename": "tests/ui/escape_analysis.stderr", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3d39379f9c1541e6642c89a839d1bfd0538d8a00/tests%2Fui%2Fescape_analysis.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3d39379f9c1541e6642c89a839d1bfd0538d8a00/tests%2Fui%2Fescape_analysis.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fescape_analysis.stderr?ref=3d39379f9c1541e6642c89a839d1bfd0538d8a00", "patch": "@@ -0,0 +1,16 @@\n+error: local variable doesn't need to be boxed here\n+  --> $DIR/escape_analysis.rs:39:13\n+   |\n+LL | fn warn_arg(x: Box<A>) {\n+   |             ^\n+   |\n+   = note: `-D clippy::boxed-local` implied by `-D warnings`\n+\n+error: local variable doesn't need to be boxed here\n+  --> $DIR/escape_analysis.rs:130:12\n+   |\n+LL | pub fn new(_needs_name: Box<PeekableSeekable<&()>>) -> () {}\n+   |            ^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}