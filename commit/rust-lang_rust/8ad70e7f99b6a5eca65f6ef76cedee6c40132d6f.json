{"sha": "8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "node_id": "C_kwDOAAsO6NoAKDhhZDcwZTdmOTliNmE1ZWNhNjVmNmVmNzZjZWRlZTZjNDAxMzJkNmY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-24T11:33:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-24T11:33:41Z"}, "message": "Auto merge of #14866 - AndreasBackx:feature/doc-comments-markdown, r=Veykril\n\n[editors/code] add markdown syntax highlighting to doc comments\n\n_This is a continuation of https://github.com/microsoft/vscode/pull/169956 and https://github.com/dustypomerleau/rust-syntax/pull/37 (that repo is no longer maintained: https://github.com/dustypomerleau/rust-syntax/issues/39#issuecomment-1427339029). The VS Code team seemed to prefer this being inside of an extension._\n\nThis adds Markdown highlighting to doc comment lines and blocks. Currently it is thus regarded both as a comment and as Markdown which leads to normally foreground text being in the colour of the comment and the rest highlighted like Markdown or its own embedded languages in code blocks.\n\n![image](https://github.com/rust-lang/rust-analyzer/assets/1593486/c84f2e83-faea-47ca-853d-3728a07b2b66)\n\n![image](https://github.com/rust-lang/rust-analyzer/assets/1593486/f4191425-32cd-451c-ae3a-29a0970ce7a2)\n\nBlock comments are supported, but currently not when there is a `*` at the start of the line:\n![image](https://github.com/rust-lang/rust-analyzer/assets/1593486/ce3b58d5-9dca-4376-bffe-4f5a54acbe37)\n![image](https://github.com/rust-lang/rust-analyzer/assets/1593486/b73a5ee6-a178-4aef-a0e4-3d75e4e7d8e5)\n\nI'm not entirely sure if I can easily fix this, I'd need to find a way to make the content ignore the `*`. Though I'm unsure if it's important as there are [conventions against using block comments](\nhttps://rust-lang.github.io/rfcs/1574-more-api-documentation-conventions.html#use-line-comments) and using them without `*` does work. All of this TextMate grammar is so hard to find documentation on that _honestly_ I'd just not want to support this considering the effort.\n\nLet me know what everyone thinks of this being in rust-analyzer. I've personally found it hard to write large amounts of Rust documentation due to the lack of Markdown syntax highlighting.\n\nAlso, thank you `@adenine-dev` as well for making this available in the interim and your enthousiasm. Wanted to get this PR out sooner, but life gets in the way.", "tree": {"sha": "623a01f583cdd8788a81925b45eed7b0cfdf40fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/623a01f583cdd8788a81925b45eed7b0cfdf40fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "html_url": "https://github.com/rust-lang/rust/commit/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2df56cadcb3496c8e076c91c3518cf55df4d7de1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2df56cadcb3496c8e076c91c3518cf55df4d7de1", "html_url": "https://github.com/rust-lang/rust/commit/2df56cadcb3496c8e076c91c3518cf55df4d7de1"}, {"sha": "09f624721cf1ea250aff6b76b465dfbc5c64bc56", "url": "https://api.github.com/repos/rust-lang/rust/commits/09f624721cf1ea250aff6b76b465dfbc5c64bc56", "html_url": "https://github.com/rust-lang/rust/commit/09f624721cf1ea250aff6b76b465dfbc5c64bc56"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "96d63b42393aafe294062e020acd34caf0ecb20f", "filename": "editors/code/package.json", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "patch": "@@ -1562,6 +1562,16 @@\n                 \"language\": \"ra_syntax_tree\",\n                 \"scopeName\": \"source.ra_syntax_tree\",\n                 \"path\": \"ra_syntax_tree.tmGrammar.json\"\n+            },\n+            {\n+                \"scopeName\": \"rustdoc.markdown.injection\",\n+                \"path\": \"rustdoc.markdown.injection.tmGrammar.json\",\n+                \"injectTo\": [\n+                    \"source.rust\"\n+                ],\n+                \"embeddedLanguages\": {\n+                    \"meta.embedded.block.markdown\": \"text.html.markdown\"\n+                }\n             }\n         ],\n         \"problemMatchers\": ["}, {"sha": "3ee49bff31efab0765d8b5d6db666101541e6ac1", "filename": "editors/code/rustdoc.markdown.injection.tmGrammar.json", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f/editors%2Fcode%2Frustdoc.markdown.injection.tmGrammar.json", "raw_url": "https://github.com/rust-lang/rust/raw/8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f/editors%2Fcode%2Frustdoc.markdown.injection.tmGrammar.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Frustdoc.markdown.injection.tmGrammar.json?ref=8ad70e7f99b6a5eca65f6ef76cedee6c40132d6f", "patch": "@@ -0,0 +1,36 @@\n+{\n+    \"scopeName\": \"rustdoc.markdown.injection\",\n+    \"injectionSelector\": \"L:source.rust\",\n+    \"patterns\": [\n+        {\n+            \"include\": \"#doc-comment-line\"\n+        },\n+        {\n+            \"include\": \"#doc-comment-block\"\n+        }\n+    ],\n+    \"repository\": {\n+        \"doc-comment-line\": {\n+            \"name\": \"comment.line.documentation.rust\",\n+            \"begin\": \"^\\\\s*//(/|!)\",\n+            \"while\": \"^\\\\s*//(/|!)\",\n+            \"contentName\": \"meta.embedded.block.markdown\",\n+            \"patterns\": [\n+                {\n+                    \"include\": \"text.html.markdown\"\n+                }\n+            ]\n+        },\n+        \"doc-comment-block\": {\n+            \"name\": \"comment.block.documentation.rust\",\n+            \"begin\": \"/\\\\*(\\\\*|!)\",\n+            \"end\": \"\\\\s*\\\\*/\",\n+            \"contentName\": \"meta.embedded.block.markdown\",\n+            \"patterns\": [\n+                {\n+                    \"include\": \"text.html.markdown\"\n+                }\n+            ]\n+        }\n+    }\n+}"}]}