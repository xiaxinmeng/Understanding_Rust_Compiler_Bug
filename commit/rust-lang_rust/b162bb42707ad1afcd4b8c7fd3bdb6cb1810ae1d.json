{"sha": "b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "node_id": "C_kwDOAAsO6NoAKGIxNjJiYjQyNzA3YWQxYWZjZDRiOGM3ZmQzYmRiNmNiMTgxMGFlMWQ", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2022-11-22T21:40:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-22T21:40:22Z"}, "message": "Rollup merge of #102293 - ecnelises:aix.initial, r=davidtwco\n\nAdd powerpc64-ibm-aix as Tier-3 target\n\nThis is part of the effort mentioned in https://github.com/rust-lang/compiler-team/issues/553.\n\nA reference to these options are definitions from [clang](https://github.com/llvm/llvm-project/blob/ad6fe32032a6229e0c40510e9bed419a01c695b3/clang/lib/Basic/Targets/PPC.h#L414-L448) and [llvm](https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/PowerPC/PPCTargetMachine.cpp).\n\nAIX has a system `ld` but [its options and behaviors](https://www.ibm.com/docs/en/aix/7.3?topic=l-ld-command) are different from GNU ld. Thanks to ``@bzEq`` for contributing the linking args.", "tree": {"sha": "fe9a0b3d373e1e1ee90c6a681d2d82357334a3c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe9a0b3d373e1e1ee90c6a681d2d82357334a3c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjfUHGCRBK7hj4Ov3rIwAALakIABDD07+0e/6jP0JJcbniRxrq\n3dzFOcxnlT2DGvFOANBWo54DgRaMMqIdCmP2MgVUAxR+6I9NTuyqZ+QCbUN/aCZs\n0yXdXO6iaKrqA88UUiT/Js4K6ybRZZr1s0ZFtPZbTyVFO5H3gPs12OT0StherNRl\nIREjQHbsCtQJvc63QL7Ae+NZBTMGD7ZcrrqlYd9+VPNsU7W4zDTabKVrUG/P9Wxv\n/IKlmt44kwsTQCc0XDQ2qzq0cAUG2ZUXDA8hLe33e7sy/MvfjW6tYGU2tW4DBsXa\nXSn9FGmXgMSujCJpC4QJ8PayqOzKnORgQjaNwHyE0FRoUa1Gi2xg26doWcWXndI=\n=smfN\n-----END PGP SIGNATURE-----\n", "payload": "tree fe9a0b3d373e1e1ee90c6a681d2d82357334a3c2\nparent 2f506e6dd4eb4a3727aab8ba6349e80e3383dca9\nparent aef3d938e42bec121304b6c51ad67446c6e171a3\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1669153222 +0900\ncommitter GitHub <noreply@github.com> 1669153222 +0900\n\nRollup merge of #102293 - ecnelises:aix.initial, r=davidtwco\n\nAdd powerpc64-ibm-aix as Tier-3 target\n\nThis is part of the effort mentioned in https://github.com/rust-lang/compiler-team/issues/553.\n\nA reference to these options are definitions from [clang](https://github.com/llvm/llvm-project/blob/ad6fe32032a6229e0c40510e9bed419a01c695b3/clang/lib/Basic/Targets/PPC.h#L414-L448) and [llvm](https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/PowerPC/PPCTargetMachine.cpp).\n\nAIX has a system `ld` but [its options and behaviors](https://www.ibm.com/docs/en/aix/7.3?topic=l-ld-command) are different from GNU ld. Thanks to ``@bzEq`` for contributing the linking args.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "html_url": "https://github.com/rust-lang/rust/commit/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2f506e6dd4eb4a3727aab8ba6349e80e3383dca9", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f506e6dd4eb4a3727aab8ba6349e80e3383dca9", "html_url": "https://github.com/rust-lang/rust/commit/2f506e6dd4eb4a3727aab8ba6349e80e3383dca9"}, {"sha": "aef3d938e42bec121304b6c51ad67446c6e171a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/aef3d938e42bec121304b6c51ad67446c6e171a3", "html_url": "https://github.com/rust-lang/rust/commit/aef3d938e42bec121304b6c51ad67446c6e171a3"}], "stats": {"total": 66, "additions": 65, "deletions": 1}, "files": [{"sha": "c71c4ba2cc9020d6b15d0b57b2fed2b974d1605a", "filename": "compiler/rustc_target/src/spec/aix_base.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Faix_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Faix_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Faix_base.rs?ref=b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "patch": "@@ -0,0 +1,32 @@\n+use crate::abi::Endian;\n+use crate::spec::{crt_objects, cvs, Cc, CodeModel, LinkOutputKind, LinkerFlavor, TargetOptions};\n+\n+pub fn opts() -> TargetOptions {\n+    TargetOptions {\n+        abi: \"vec-extabi\".into(),\n+        code_model: Some(CodeModel::Small),\n+        cpu: \"pwr7\".into(),\n+        os: \"aix\".into(),\n+        vendor: \"ibm\".into(),\n+        dynamic_linking: true,\n+        endian: Endian::Big,\n+        executables: true,\n+        archive_format: \"aix_big\".into(),\n+        families: cvs![\"unix\"],\n+        has_rpath: false,\n+        has_thread_local: true,\n+        crt_static_respected: true,\n+        linker_flavor: LinkerFlavor::Unix(Cc::No),\n+        linker: Some(\"ld\".into()),\n+        eh_frame_header: false,\n+        is_like_aix: true,\n+        default_dwarf_version: 3,\n+        function_sections: true,\n+        pre_link_objects: crt_objects::new(&[\n+            (LinkOutputKind::DynamicNoPicExe, &[\"/usr/lib/crt0_64.o\", \"/usr/lib/crti_64.o\"]),\n+            (LinkOutputKind::DynamicPicExe, &[\"/usr/lib/crt0_64.o\", \"/usr/lib/crti_64.o\"]),\n+        ]),\n+        dll_suffix: \".a\".into(),\n+        ..Default::default()\n+    }\n+}"}, {"sha": "c633ef1e76193d94485f1525382ad5c1d27a1992", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "patch": "@@ -58,6 +58,7 @@ use rustc_macros::HashStable_Generic;\n pub mod abi;\n pub mod crt_objects;\n \n+mod aix_base;\n mod android_base;\n mod apple_base;\n mod avr_gnu_base;\n@@ -1027,6 +1028,7 @@ supported_targets! {\n     (\"powerpc-unknown-linux-gnu\", powerpc_unknown_linux_gnu),\n     (\"powerpc-unknown-linux-gnuspe\", powerpc_unknown_linux_gnuspe),\n     (\"powerpc-unknown-linux-musl\", powerpc_unknown_linux_musl),\n+    (\"powerpc64-ibm-aix\", powerpc64_ibm_aix),\n     (\"powerpc64-unknown-linux-gnu\", powerpc64_unknown_linux_gnu),\n     (\"powerpc64-unknown-linux-musl\", powerpc64_unknown_linux_musl),\n     (\"powerpc64le-unknown-linux-gnu\", powerpc64le_unknown_linux_gnu),\n@@ -1454,6 +1456,9 @@ pub struct TargetOptions {\n     pub families: StaticCow<[StaticCow<str>]>,\n     /// Whether the target toolchain's ABI supports returning small structs as an integer.\n     pub abi_return_struct_as_int: bool,\n+    /// Whether the target toolchain is like AIX's. Linker options on AIX are special and it uses\n+    /// XCOFF as binary format. Defaults to false.\n+    pub is_like_aix: bool,\n     /// Whether the target toolchain is like macOS's. Only useful for compiling against iOS/macOS,\n     /// in particular running dsymutil and some other stuff like `-dead_strip`. Defaults to false.\n     /// Also indiates whether to use Apple-specific ABI changes, such as extending function\n@@ -1817,6 +1822,7 @@ impl Default for TargetOptions {\n             staticlib_suffix: \".a\".into(),\n             families: cvs![],\n             abi_return_struct_as_int: false,\n+            is_like_aix: false,\n             is_like_osx: false,\n             is_like_solaris: false,\n             is_like_windows: false,\n@@ -2488,6 +2494,7 @@ impl Target {\n         key!(staticlib_suffix);\n         key!(families, TargetFamilies);\n         key!(abi_return_struct_as_int, bool);\n+        key!(is_like_aix, bool);\n         key!(is_like_osx, bool);\n         key!(is_like_solaris, bool);\n         key!(is_like_windows, bool);\n@@ -2741,6 +2748,7 @@ impl ToJson for Target {\n         target_option_val!(staticlib_suffix);\n         target_option_val!(families, \"target-family\");\n         target_option_val!(abi_return_struct_as_int);\n+        target_option_val!(is_like_aix);\n         target_option_val!(is_like_osx);\n         target_option_val!(is_like_solaris);\n         target_option_val!(is_like_windows);"}, {"sha": "e3eb9bccd5ed78d5001471c83cec143a3586d02c", "filename": "compiler/rustc_target/src/spec/powerpc64_ibm_aix.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fpowerpc64_ibm_aix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/compiler%2Frustc_target%2Fsrc%2Fspec%2Fpowerpc64_ibm_aix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fpowerpc64_ibm_aix.rs?ref=b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "patch": "@@ -0,0 +1,23 @@\n+use crate::spec::{Cc, LinkerFlavor, Target};\n+\n+pub fn target() -> Target {\n+    let mut base = super::aix_base::opts();\n+    base.max_atomic_width = Some(64);\n+    base.add_pre_link_args(\n+        LinkerFlavor::Unix(Cc::No),\n+        &[\n+            \"-b64\".into(),\n+            \"-bpT:0x100000000\".into(),\n+            \"-bpD:0x110000000\".into(),\n+            \"-bcdtors:all:0:s\".into(),\n+        ],\n+    );\n+\n+    Target {\n+        llvm_target: \"powerpc64-ibm-aix\".into(),\n+        pointer_width: 64,\n+        data_layout: \"E-m:a-i64:64-n32:64-S128-v256:256:256-v512:512:512\".into(),\n+        arch: \"powerpc64\".into(),\n+        options: base,\n+    }\n+}"}, {"sha": "27e911c6be5a25a8082490822d3a8e92e97bd7fa", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "patch": "@@ -283,6 +283,7 @@ target | std | host | notes\n `powerpc64-wrs-vxworks` | ? |  |\n `powerpc64le-unknown-linux-musl` | ? |  |\n [`powerpc64-unknown-openbsd`](platform-support/openbsd.md) | \u2713 | \u2713 | OpenBSD/powerpc64\n+`powerpc64-ibm-aix` | ? |  | 64-bit AIX (7.2 and newer)\n `riscv32gc-unknown-linux-gnu` |   |   | RISC-V Linux (kernel 5.4, glibc 2.33)\n `riscv32gc-unknown-linux-musl` |   |   | RISC-V Linux (kernel 5.4, musl + RISCV32 support patches)\n `riscv32im-unknown-none-elf` | * |  | Bare RISC-V (RV32IM ISA)"}, {"sha": "29ececea5d3941ea4f61099ef1deb17155bcc425", "filename": "src/test/ui/check-cfg/well-known-values.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr?ref=b162bb42707ad1afcd4b8c7fd3bdb6cb1810ae1d", "patch": "@@ -6,7 +6,7 @@ LL | #[cfg(target_os = \"linuz\")]\n    |                   |\n    |                   help: did you mean: `\"linux\"`\n    |\n-   = note: expected values for `target_os` are: android, cuda, dragonfly, emscripten, espidf, freebsd, fuchsia, haiku, hermit, horizon, illumos, ios, l4re, linux, macos, netbsd, none, nto, openbsd, psp, redox, solaris, solid_asp3, tvos, uefi, unknown, vxworks, wasi, watchos, windows, xous\n+   = note: expected values for `target_os` are: aix, android, cuda, dragonfly, emscripten, espidf, freebsd, fuchsia, haiku, hermit, horizon, illumos, ios, l4re, linux, macos, netbsd, none, nto, openbsd, psp, redox, solaris, solid_asp3, tvos, uefi, unknown, vxworks, wasi, watchos, windows, xous\n    = note: `#[warn(unexpected_cfgs)]` on by default\n \n warning: unexpected `cfg` condition value"}]}