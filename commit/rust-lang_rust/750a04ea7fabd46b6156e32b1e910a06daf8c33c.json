{"sha": "750a04ea7fabd46b6156e32b1e910a06daf8c33c", "node_id": "C_kwDOAAsO6NoAKDc1MGEwNGVhN2ZhYmQ0NmI2MTU2ZTMyYjFlOTEwYTA2ZGFmOGMzM2M", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-08-09T19:39:02Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2022-08-09T19:39:02Z"}, "message": "Add docs for get_remapped_def_id", "tree": {"sha": "753b1d7ae68d0ee3d81b0279c115a48474b52c35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/753b1d7ae68d0ee3d81b0279c115a48474b52c35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/750a04ea7fabd46b6156e32b1e910a06daf8c33c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmLyt9YACgkQgTGiTgx5\n768dDhAAh5D6CY6Pcrj+Q7bMqKdxZSHnqZ8wlI+IyveGY08acK7pZyl5oODCI4rn\nhifxxXX5Dzv3VyZDu6OsnYQ/DF/uBQxPapbONvuXf6A2j3QaQQTi8YdoHspeB5tF\nVmVjs/fK5BPjnA/PR2TDhEQgoJbp/UG3t+ZYhjWU5K+9wMySM+zVQNhNO/GzFzsF\nEAE8N66I67nK62pF4a0g0XRRnIW96CW/DWUiGgVkMo6E+peeme3qClOwKigEXvHR\nJEbvfk5k2bk7zw+4QMeaWWth9QxA5jnGnwNp2o4h1dnzJJ5kQS8pIXKau7/qQTjY\nm3PcgQx+powfXYH9yNdXf1HlhRRj8Bm1sLSPyLFVgRbyLwm3gI6l1+66mHcbP6Xc\n6ToMaUvF5bWRU69dSSNBI8JHIxrOx2VtVUXLwTz2YELwSIzZEOu9P82w2oXBQavQ\nN6SW9CHn7VitvyS8Mt/cZk/obuZXkSheuCnKTU3ij4/fW/NW2EdWpnVjmdwNLgCL\nMSCPlJoP3aki+E8AA7MuZKPU8HTyNAEp+EuqmPIlLCBR2iX/fus1J18NdKIE/XtT\nFANDRjtE714I6dqQuh3x9srQQCCg5njcS/v+3YMx1g18osKoKs2vyZyuhPag0uXZ\n6lo6jHbUT5szPIiXf5AsFLpFelr7coKgS3w9PqN4Uu4VjqNjopk=\n=pJhw\n-----END PGP SIGNATURE-----", "payload": "tree 753b1d7ae68d0ee3d81b0279c115a48474b52c35\nparent 457ff7c56cedbf67e7716d88762595ed73d75077\nauthor Santiago Pastorino <spastorino@gmail.com> 1660073942 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1660073942 -0300\n\nAdd docs for get_remapped_def_id\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/750a04ea7fabd46b6156e32b1e910a06daf8c33c", "html_url": "https://github.com/rust-lang/rust/commit/750a04ea7fabd46b6156e32b1e910a06daf8c33c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/750a04ea7fabd46b6156e32b1e910a06daf8c33c/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "457ff7c56cedbf67e7716d88762595ed73d75077", "url": "https://api.github.com/repos/rust-lang/rust/commits/457ff7c56cedbf67e7716d88762595ed73d75077", "html_url": "https://github.com/rust-lang/rust/commit/457ff7c56cedbf67e7716d88762595ed73d75077"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "38d30d0ffdedbfa8c286be6a95e5c7420b20a7a3", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/750a04ea7fabd46b6156e32b1e910a06daf8c33c/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/750a04ea7fabd46b6156e32b1e910a06daf8c33c/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=750a04ea7fabd46b6156e32b1e910a06daf8c33c", "patch": "@@ -220,6 +220,19 @@ impl ResolverAstLoweringExt for ResolverAstLowering {\n     }\n \n     fn get_remapped_def_id(&self, mut local_def_id: LocalDefId) -> LocalDefId {\n+        // `generics_def_id_map` is a stack of mappings. As we go deeper in impl traits nesting we\n+        // push new mappings so we need to try first the latest mappings, hence `iter().rev()`.\n+        //\n+        // Consider:\n+        //\n+        // `fn test<'a, 'b>() -> impl Trait<&'a u8, Ty = impl Sized + 'b> {}`\n+        //\n+        // We would end with a generics_def_id_map like:\n+        //\n+        // `[[fn#'b -> impl_trait#'b], [fn#'b -> impl_sized#'b]]`\n+        //\n+        // for the opaque type generated on `impl Sized + 'b`, We want the result to be:\n+        // impl_sized#'b, so iterating forward is the wrong thing to do.\n         for map in self.generics_def_id_map.iter().rev() {\n             if let Some(r) = map.get(&local_def_id) {\n                 debug!(\"def_id_remapper: remapping from `{local_def_id:?}` to `{r:?}`\");"}]}