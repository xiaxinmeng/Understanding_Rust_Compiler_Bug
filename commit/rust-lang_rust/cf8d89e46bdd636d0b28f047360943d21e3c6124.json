{"sha": "cf8d89e46bdd636d0b28f047360943d21e3c6124", "node_id": "C_kwDOAAsO6NoAKGNmOGQ4OWU0NmJkZDYzNmQwYjI4ZjA0NzM2MDk0M2QyMWUzYzYxMjQ", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-12-17T22:43:26Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-12-17T22:43:26Z"}, "message": "Add a command to clear flycheck diagnostics", "tree": {"sha": "02295c9ef6f926055c3a0fb58bbb82416fa5ca7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/02295c9ef6f926055c3a0fb58bbb82416fa5ca7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf8d89e46bdd636d0b28f047360943d21e3c6124", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf8d89e46bdd636d0b28f047360943d21e3c6124", "html_url": "https://github.com/rust-lang/rust/commit/cf8d89e46bdd636d0b28f047360943d21e3c6124", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf8d89e46bdd636d0b28f047360943d21e3c6124/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8ddde27f9c37ba23b4eaab24759e2c1459e8ad4", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8ddde27f9c37ba23b4eaab24759e2c1459e8ad4", "html_url": "https://github.com/rust-lang/rust/commit/d8ddde27f9c37ba23b4eaab24759e2c1459e8ad4"}], "stats": {"total": 66, "additions": 64, "deletions": 2}, "files": [{"sha": "65620b4209b4080113f819b540ba00e6321b10b2", "filename": "crates/rust-analyzer/src/lsp_ext.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -144,6 +144,13 @@ impl Notification for RunFlycheck {\n     const METHOD: &'static str = \"rust-analyzer/runFlycheck\";\n }\n \n+pub enum ClearFlycheck {}\n+\n+impl Notification for ClearFlycheck {\n+    type Params = ();\n+    const METHOD: &'static str = \"rust-analyzer/clearFlycheck\";\n+}\n+\n #[derive(Deserialize, Serialize, Debug)]\n #[serde(rename_all = \"camelCase\")]\n pub struct RunFlycheckParams {"}, {"sha": "47776f734b0daad48a5fca8417c1c194cbd03c9d", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -861,6 +861,10 @@ impl GlobalState {\n                 }\n                 Ok(())\n             })?\n+            .on::<lsp_ext::ClearFlycheck>(|this, ()| {\n+                this.diagnostics.clear_check_all();\n+                Ok(())\n+            })?\n             .on::<lsp_ext::RunFlycheck>(|this, params| {\n                 if let Some(text_document) = params.text_document {\n                     if let Ok(vfs_path) = from_proto::vfs_path(&text_document.uri) {"}, {"sha": "1bbb4c2323c00d6ea0470ffd8d9009daa22b54ab", "filename": "docs/dev/lsp-extensions.md", "status": "modified", "additions": 40, "deletions": 1, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/docs%2Fdev%2Flsp-extensions.md", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/docs%2Fdev%2Flsp-extensions.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Flsp-extensions.md?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -1,5 +1,5 @@\n <!---\n-lsp_ext.rs hash: 1cb29d3afa36e743\n+lsp_ext.rs hash: 45bd7985265725c5\n \n If you need to change the above hash to make the test pass, please check if you\n need to adjust this doc as well and ping this issue:\n@@ -459,6 +459,45 @@ Note that this functionality is intended primarily to inform the end user about\n In particular, it's valid for the client to completely ignore this extension.\n Clients are discouraged from but are allowed to use the `health` status to decide if it's worth sending a request to the server.\n \n+### Controlling Flycheck\n+\n+The flycheck/checkOnSave feature can be controlled via notifications sent by the client to the server.\n+\n+**Method:** `rust-analyzer/runFlycheck`\n+\n+**Notification:**\n+\n+```typescript\n+interface RunFlycheckParams {\n+    /// The text document whose cargo workspace flycheck process should be started.\n+    /// If the document is null or does not belong to a cargo workspace all flycheck processes will be started.\n+    textDocument: lc.TextDocumentIdentifier | null;\n+}\n+```\n+\n+Triggers the flycheck processes.\n+\n+\n+**Method:** `rust-analyzer/clearFlycheck`\n+\n+**Notification:**\n+\n+```typescript\n+interface ClearFlycheckParams {}\n+```\n+\n+Clears the flycheck diagnostics.\n+\n+**Method:** `rust-analyzer/cancelFlycheck`\n+\n+**Notification:**\n+\n+```typescript\n+interface CancelFlycheckParams {}\n+```\n+\n+Cancels all running flycheck processes.\n+\n ## Syntax Tree\n \n **Method:** `rust-analyzer/syntaxTree`"}, {"sha": "f9b0e28dadb7d43a4a5192df208df39b03bee947", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -251,6 +251,11 @@\n                 \"command\": \"rust-analyzer.runFlycheck\",\n                 \"title\": \"Run flycheck\",\n                 \"category\": \"rust-analyzer\"\n+            },\n+            {\n+                \"command\": \"rust-analyzer.clearFlycheck\",\n+                \"title\": \"Clear flycheck diagnostics\",\n+                \"category\": \"rust-analyzer\"\n             }\n         ],\n         \"keybindings\": ["}, {"sha": "cb4e13e2c6043587afd7c713f2e720c8fd273b87", "filename": "editors/code/src/commands.ts", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Fcommands.ts", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Fcommands.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands.ts?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -792,6 +792,12 @@ export function cancelFlycheck(ctx: CtxInit): Cmd {\n     };\n }\n \n+export function clearFlycheck(ctx: CtxInit): Cmd {\n+    return async () => {\n+        await ctx.client.sendNotification(ra.clearFlycheck);\n+    };\n+}\n+\n export function runFlycheck(ctx: CtxInit): Cmd {\n     return async () => {\n         const editor = ctx.activeRustEditor;"}, {"sha": "29349cc20f5b096dabbf94c84cb52e7bada2d509", "filename": "editors/code/src/lsp_ext.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Flsp_ext.ts", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Flsp_ext.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Flsp_ext.ts?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -80,7 +80,7 @@ export const relatedTests = new lc.RequestType<lc.TextDocumentPositionParams, Te\n );\n \n export const cancelFlycheck = new lc.NotificationType0(\"rust-analyzer/cancelFlycheck\");\n-\n+export const clearFlycheck = new lc.NotificationType0(\"rust-analyzer/clearFlycheck\");\n export const runFlycheck = new lc.NotificationType<{\n     textDocument: lc.TextDocumentIdentifier | null;\n }>(\"rust-analyzer/runFlycheck\");"}, {"sha": "9a9667b2cd20f0fae8928d260649bf41e8d0d876", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/cf8d89e46bdd636d0b28f047360943d21e3c6124/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=cf8d89e46bdd636d0b28f047360943d21e3c6124", "patch": "@@ -150,6 +150,7 @@ function createCommands(): Record<string, CommandFactory> {\n         moveItemUp: { enabled: commands.moveItemUp },\n         moveItemDown: { enabled: commands.moveItemDown },\n         cancelFlycheck: { enabled: commands.cancelFlycheck },\n+        clearFlycheck: { enabled: commands.clearFlycheck },\n         runFlycheck: { enabled: commands.runFlycheck },\n         ssr: { enabled: commands.ssr },\n         serverVersion: { enabled: commands.serverVersion },"}]}