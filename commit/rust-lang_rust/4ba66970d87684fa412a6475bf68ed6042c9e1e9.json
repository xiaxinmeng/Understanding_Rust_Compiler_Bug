{"sha": "4ba66970d87684fa412a6475bf68ed6042c9e1e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiYTY2OTcwZDg3Njg0ZmE0MTJhNjQ3NWJmNjhlZDYwNDJjOWUxZTk=", "commit": {"author": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2020-06-16T19:32:13Z"}, "committer": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2020-06-20T18:12:43Z"}, "message": "Make suggestion machine-applicable", "tree": {"sha": "8e2ef57643442a270f1636d584e50659993ca794", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e2ef57643442a270f1636d584e50659993ca794"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4ba66970d87684fa412a6475bf68ed6042c9e1e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4ba66970d87684fa412a6475bf68ed6042c9e1e9", "html_url": "https://github.com/rust-lang/rust/commit/4ba66970d87684fa412a6475bf68ed6042c9e1e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4ba66970d87684fa412a6475bf68ed6042c9e1e9/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f4dfc61e847c5a587aaf09635643034ec900ace8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4dfc61e847c5a587aaf09635643034ec900ace8", "html_url": "https://github.com/rust-lang/rust/commit/f4dfc61e847c5a587aaf09635643034ec900ace8"}], "stats": {"total": 60, "additions": 48, "deletions": 12}, "files": [{"sha": "7e5eca29aeada0352be0555bb12bcbe05113400a", "filename": "src/librustc_builtin_macros/asm.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Flibrustc_builtin_macros%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Flibrustc_builtin_macros%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_builtin_macros%2Fasm.rs?ref=4ba66970d87684fa412a6475bf68ed6042c9e1e9", "patch": "@@ -288,7 +288,12 @@ fn err_duplicate_option<'a>(p: &mut Parser<'a>, symbol: Symbol, span: Span) {\n         .sess\n         .span_diagnostic\n         .struct_span_err(span, &format!(\"the `{}` option was already provided\", symbol));\n-    err.span_suggestion(span, \"remove this option\", String::new(), Applicability::Unspecified);\n+    err.span_suggestion(\n+        span,\n+        \"remove this option\",\n+        String::new(),\n+        Applicability::MachineApplicable,\n+    );\n     err.emit();\n }\n \n@@ -301,7 +306,11 @@ fn try_set_option<'a>(\n     if !args.options.contains(option) {\n         args.options |= option;\n     } else {\n-        err_duplicate_option(p, symbol, p.prev_token.span);\n+        let mut span = p.prev_token.span;\n+        if p.look_ahead(0, |t| t == &token::Comma) {\n+            span = span.to(p.token.span);\n+        }\n+        err_duplicate_option(p, symbol, span);\n     }\n }\n "}, {"sha": "f4672a50fd0f44838eb3ae48a08f75ec5316ec27", "filename": "src/test/ui/asm/duplicate-options.fixed", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.fixed?ref=4ba66970d87684fa412a6475bf68ed6042c9e1e9", "patch": "@@ -0,0 +1,26 @@\n+// only-x86_64\n+// run-rustfix\n+\n+#![feature(asm)]\n+\n+fn main() {\n+    unsafe {\n+        asm!(\"\", options(nomem, ));\n+        //~^ ERROR the `nomem` option was already provided\n+        asm!(\"\", options(att_syntax, ));\n+        //~^ ERROR the `att_syntax` option was already provided\n+        asm!(\"\", options(nostack, att_syntax), options());\n+        //~^ ERROR the `nostack` option was already provided\n+        asm!(\"\", options(nostack, ), options(), options());\n+        //~^ ERROR the `nostack` option was already provided\n+        //~| ERROR the `nostack` option was already provided\n+        //~| ERROR the `nostack` option was already provided\n+        asm!(\n+            \"\",\n+            options(nomem, noreturn),\n+            options(att_syntax, ), //~ ERROR the `noreturn` option was already provided\n+            options( nostack), //~ ERROR the `nomem` option was already provided\n+            options(), //~ ERROR the `noreturn` option was already provided\n+        );\n+    }\n+}"}, {"sha": "80292d7521a9a4f7f812495003241d8bbb34d32a", "filename": "src/test/ui/asm/duplicate-options.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.rs?ref=4ba66970d87684fa412a6475bf68ed6042c9e1e9", "patch": "@@ -1,4 +1,5 @@\n // only-x86_64\n+// run-rustfix\n \n #![feature(asm)]\n "}, {"sha": "46a966ddc8606a584f97a539d42e08e0641814c3", "filename": "src/test/ui/asm/duplicate-options.stderr", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4ba66970d87684fa412a6475bf68ed6042c9e1e9/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fduplicate-options.stderr?ref=4ba66970d87684fa412a6475bf68ed6042c9e1e9", "patch": "@@ -1,53 +1,53 @@\n error: the `nomem` option was already provided\n-  --> $DIR/duplicate-options.rs:7:33\n+  --> $DIR/duplicate-options.rs:8:33\n    |\n LL |         asm!(\"\", options(nomem, nomem));\n    |                                 ^^^^^ help: remove this option\n \n error: the `att_syntax` option was already provided\n-  --> $DIR/duplicate-options.rs:9:38\n+  --> $DIR/duplicate-options.rs:10:38\n    |\n LL |         asm!(\"\", options(att_syntax, att_syntax));\n    |                                      ^^^^^^^^^^ help: remove this option\n \n error: the `nostack` option was already provided\n-  --> $DIR/duplicate-options.rs:11:56\n+  --> $DIR/duplicate-options.rs:12:56\n    |\n LL |         asm!(\"\", options(nostack, att_syntax), options(nostack));\n    |                                                        ^^^^^^^ help: remove this option\n \n error: the `nostack` option was already provided\n-  --> $DIR/duplicate-options.rs:13:35\n+  --> $DIR/duplicate-options.rs:14:35\n    |\n LL |         asm!(\"\", options(nostack, nostack), options(nostack), options(nostack));\n    |                                   ^^^^^^^ help: remove this option\n \n error: the `nostack` option was already provided\n-  --> $DIR/duplicate-options.rs:13:53\n+  --> $DIR/duplicate-options.rs:14:53\n    |\n LL |         asm!(\"\", options(nostack, nostack), options(nostack), options(nostack));\n    |                                                     ^^^^^^^ help: remove this option\n \n error: the `nostack` option was already provided\n-  --> $DIR/duplicate-options.rs:13:71\n+  --> $DIR/duplicate-options.rs:14:71\n    |\n LL |         asm!(\"\", options(nostack, nostack), options(nostack), options(nostack));\n    |                                                                       ^^^^^^^ help: remove this option\n \n error: the `noreturn` option was already provided\n-  --> $DIR/duplicate-options.rs:20:33\n+  --> $DIR/duplicate-options.rs:21:33\n    |\n LL |             options(att_syntax, noreturn),\n    |                                 ^^^^^^^^ help: remove this option\n \n error: the `nomem` option was already provided\n-  --> $DIR/duplicate-options.rs:21:21\n+  --> $DIR/duplicate-options.rs:22:21\n    |\n LL |             options(nomem, nostack),\n-   |                     ^^^^^ help: remove this option\n+   |                     ^^^^^^ help: remove this option\n \n error: the `noreturn` option was already provided\n-  --> $DIR/duplicate-options.rs:22:21\n+  --> $DIR/duplicate-options.rs:23:21\n    |\n LL |             options(noreturn),\n    |                     ^^^^^^^^ help: remove this option"}]}