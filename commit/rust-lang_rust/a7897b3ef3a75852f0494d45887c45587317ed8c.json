{"sha": "a7897b3ef3a75852f0494d45887c45587317ed8c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3ODk3YjNlZjNhNzU4NTJmMDQ5NGQ0NTg4N2M0NTU4NzMxN2VkOGM=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2012-07-09T21:58:02Z"}, "committer": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2012-07-10T23:33:21Z"}, "message": "Eliminate some obsolete upcalls.", "tree": {"sha": "f6450863c410d6d86e902bd238bbae5c04487c69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6450863c410d6d86e902bd238bbae5c04487c69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7897b3ef3a75852f0494d45887c45587317ed8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7897b3ef3a75852f0494d45887c45587317ed8c", "html_url": "https://github.com/rust-lang/rust/commit/a7897b3ef3a75852f0494d45887c45587317ed8c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7897b3ef3a75852f0494d45887c45587317ed8c/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "260f73ed85cdf1421ee1b1d241b3cca438a4ac44", "url": "https://api.github.com/repos/rust-lang/rust/commits/260f73ed85cdf1421ee1b1d241b3cca438a4ac44", "html_url": "https://github.com/rust-lang/rust/commit/260f73ed85cdf1421ee1b1d241b3cca438a4ac44"}], "stats": {"total": 64, "additions": 0, "deletions": 64}, "files": [{"sha": "cae5ce45b54974a3c8174aaff7246f196894d1b5", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 0, "deletions": 53, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=a7897b3ef3a75852f0494d45887c45587317ed8c", "patch": "@@ -335,59 +335,6 @@ upcall_str_new_shared(const char *cstr, size_t len) {\n }\n \n \n-struct s_vec_grow_args {\n-    rust_task *task;\n-    rust_vec_box** vp;\n-    size_t new_sz;\n-};\n-\n-extern \"C\" CDECL void\n-upcall_s_vec_grow(s_vec_grow_args *args) {\n-    rust_task *task = args->task;\n-    LOG_UPCALL_ENTRY(task);\n-    reserve_vec(task, args->vp, args->new_sz);\n-    (*args->vp)->body.fill = args->new_sz;\n-}\n-\n-extern \"C\" CDECL void\n-upcall_vec_grow(rust_vec_box** vp, size_t new_sz) {\n-    rust_task *task = rust_get_current_task();\n-    s_vec_grow_args args = {task, vp, new_sz};\n-    UPCALL_SWITCH_STACK(task, &args, upcall_s_vec_grow);\n-}\n-\n-struct s_str_concat_args {\n-    rust_task *task;\n-    rust_vec_box* lhs;\n-    rust_vec_box* rhs;\n-    rust_vec_box* retval;\n-};\n-\n-extern \"C\" CDECL void\n-upcall_s_str_concat(s_str_concat_args *args) {\n-    rust_vec *lhs = &args->lhs->body;\n-    rust_vec *rhs = &args->rhs->body;\n-    rust_task *task = args->task;\n-    size_t fill = lhs->fill + rhs->fill - 1;\n-    rust_vec_box* v = (rust_vec_box*)\n-        task->kernel->malloc(fill + sizeof(rust_vec_box),\n-                             \"str_concat\");\n-    v->header.td = args->lhs->header.td;\n-    v->body.fill = v->body.alloc = fill;\n-    memmove(&v->body.data[0], &lhs->data[0], lhs->fill - 1);\n-    memmove(&v->body.data[lhs->fill - 1], &rhs->data[0], rhs->fill);\n-    args->retval = v;\n-}\n-\n-extern \"C\" CDECL rust_vec_box*\n-upcall_str_concat(rust_vec_box* lhs, rust_vec_box* rhs) {\n-    rust_task *task = rust_get_current_task();\n-    s_str_concat_args args = {task, lhs, rhs, 0};\n-    UPCALL_SWITCH_STACK(task, &args, upcall_s_str_concat);\n-    return args.retval;\n-}\n-\n-\n extern \"C\" _Unwind_Reason_Code\n __gxx_personality_v0(int version,\n                      _Unwind_Action actions,"}, {"sha": "c413628c82abd19134fde831fa0c981bc4193648", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=a7897b3ef3a75852f0494d45887c45587317ed8c", "patch": "@@ -76,11 +76,8 @@ upcall_validate_box\n upcall_log_type\n upcall_malloc\n upcall_rust_personality\n-upcall_vec_grow\n-upcall_str_new\n upcall_str_new_uniq\n upcall_str_new_shared\n-upcall_str_concat\n upcall_call_shim_on_c_stack\n upcall_call_shim_on_rust_stack\n upcall_new_stack"}, {"sha": "e95f7e39af46a1d905998dab93e29e27c65c60a7", "filename": "src/rustc/back/upcall.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frustc%2Fback%2Fupcall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7897b3ef3a75852f0494d45887c45587317ed8c/src%2Frustc%2Fback%2Fupcall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fback%2Fupcall.rs?ref=a7897b3ef3a75852f0494d45887c45587317ed8c", "patch": "@@ -16,10 +16,8 @@ type upcalls =\n      exchange_free: ValueRef,\n      validate_box: ValueRef,\n      mark: ValueRef,\n-     vec_grow: ValueRef,\n      str_new_uniq: ValueRef,\n      str_new_shared: ValueRef,\n-     str_concat: ValueRef,\n      cmp_type: ValueRef,\n      log_type: ValueRef,\n      alloc_c_stack: ValueRef,\n@@ -71,18 +69,12 @@ fn declare_upcalls(targ_cfg: @session::config,\n               nothrow(dv(\"validate_box\", ~[T_ptr(T_i8())])),\n           mark:\n               d(\"mark\", ~[T_ptr(T_i8())], int_t),\n-          vec_grow:\n-              nothrow(dv(\"vec_grow\", ~[T_ptr(T_ptr(T_i8())), int_t])),\n           str_new_uniq:\n               nothrow(d(\"str_new_uniq\", ~[T_ptr(T_i8()), int_t],\n                         T_ptr(T_i8()))),\n           str_new_shared:\n               nothrow(d(\"str_new_shared\", ~[T_ptr(T_i8()), int_t],\n                         T_ptr(T_i8()))),\n-          str_concat:\n-              nothrow(d(\"str_concat\", ~[T_ptr(T_i8()),\n-                                       T_ptr(T_i8())],\n-                        T_ptr(T_i8()))),\n           cmp_type:\n               dv(\"cmp_type\",\n                  ~[T_ptr(T_i1()), T_ptr(tydesc_type),"}]}