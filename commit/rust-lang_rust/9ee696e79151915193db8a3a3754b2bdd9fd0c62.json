{"sha": "9ee696e79151915193db8a3a3754b2bdd9fd0c62", "node_id": "C_kwDOAAsO6NoAKDllZTY5NmU3OTE1MTkxNTE5M2RiOGEzYTM3NTRiMmJkZDlmZDBjNjI", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-10-04T23:53:00Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-10-04T23:53:00Z"}, "message": "Make rustdoc not highlight `->` and `=>` as operators\n\nIt was marking them up as `<span class=\"op\">=</span><span class=\"op\">&gt;</span>`,\nwhich is bloaty and wrong.", "tree": {"sha": "40e6228de812cf0d7e72cb612350c0899f45f0a7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/40e6228de812cf0d7e72cb612350c0899f45f0a7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ee696e79151915193db8a3a3754b2bdd9fd0c62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ee696e79151915193db8a3a3754b2bdd9fd0c62", "html_url": "https://github.com/rust-lang/rust/commit/9ee696e79151915193db8a3a3754b2bdd9fd0c62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ee696e79151915193db8a3a3754b2bdd9fd0c62/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "html_url": "https://github.com/rust-lang/rust/commit/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3"}], "stats": {"total": 31, "additions": 25, "deletions": 6}, "files": [{"sha": "8ed69962875a62b6c05b0ee7ad3e3a6e4fd95b9a", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 21, "deletions": 2, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=9ee696e79151915193db8a3a3754b2bdd9fd0c62", "patch": "@@ -435,15 +435,34 @@ impl<'a> Classifier<'a> {\n                 _ => Class::RefKeyWord,\n             },\n \n-            // Operators.\n+            // These can either be operators, or arrows.\n+            TokenKind::Eq => match lookahead {\n+                Some(TokenKind::Eq) => {\n+                    self.next();\n+                    sink(Highlight::Token { text: \"==\", class: Some(Class::Op) });\n+                    return;\n+                }\n+                Some(TokenKind::Gt) => {\n+                    self.next();\n+                    sink(Highlight::Token { text: \"=>\", class: None });\n+                    return;\n+                }\n+                _ => Class::Op,\n+            },\n+            TokenKind::Minus if lookahead == Some(TokenKind::Gt) => {\n+                self.next();\n+                sink(Highlight::Token { text: \"->\", class: None });\n+                return;\n+            }\n+\n+            // Other operators.\n             TokenKind::Minus\n             | TokenKind::Plus\n             | TokenKind::Or\n             | TokenKind::Slash\n             | TokenKind::Caret\n             | TokenKind::Percent\n             | TokenKind::Bang\n-            | TokenKind::Eq\n             | TokenKind::Lt\n             | TokenKind::Gt => Class::Op,\n "}, {"sha": "22e650af7e22b1a977928c540adadda782a27c92", "filename": "src/librustdoc/html/highlight/fixtures/sample.html", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html", "raw_url": "https://github.com/rust-lang/rust/raw/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html?ref=9ee696e79151915193db8a3a3754b2bdd9fd0c62", "patch": "@@ -13,7 +13,7 @@\n <span class=\"kw\">use</span> <span class=\"ident\">std::path</span>::{<span class=\"ident\">Path</span>, <span class=\"ident\">PathBuf</span>};\n \n <span class=\"attribute\">#[<span class=\"ident\">cfg</span>(<span class=\"ident\">target_os</span> <span class=\"op\">=</span> <span class=\"string\">&quot;linux&quot;</span>)]</span>\n-<span class=\"kw\">fn</span> <span class=\"ident\">main</span>() {\n+<span class=\"kw\">fn</span> <span class=\"ident\">main</span>() -&gt; () {\n     <span class=\"kw\">let</span> <span class=\"ident\">foo</span> <span class=\"op\">=</span> <span class=\"bool-val\">true</span> <span class=\"op\">&amp;&amp;</span> <span class=\"bool-val\">false</span> <span class=\"op\">|</span><span class=\"op\">|</span> <span class=\"bool-val\">true</span>;\n     <span class=\"kw\">let</span> <span class=\"kw\">_</span>: <span class=\"kw-2\">*</span><span class=\"kw\">const</span> () <span class=\"op\">=</span> <span class=\"number\">0</span>;\n     <span class=\"kw\">let</span> <span class=\"kw\">_</span> <span class=\"op\">=</span> <span class=\"kw-2\">&amp;</span><span class=\"ident\">foo</span>;\n@@ -27,11 +27,11 @@\n     <span class=\"kw\">let</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">s</span> <span class=\"op\">=</span> <span class=\"ident\">String::new</span>();\n \n     <span class=\"kw\">match</span> <span class=\"kw-2\">&amp;</span><span class=\"ident\">s</span> {\n-        <span class=\"kw-2\">ref</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">x</span> <span class=\"op\">=</span><span class=\"op\">&gt;</span> {}\n+        <span class=\"kw-2\">ref</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">x</span> =&gt; {}\n     }\n }\n \n <span class=\"macro\">macro_rules!</span> <span class=\"ident\">bar</span> {\n-    (<span class=\"macro-nonterminal\">$</span><span class=\"macro-nonterminal\">foo</span>:<span class=\"ident\">tt</span>) <span class=\"op\">=</span><span class=\"op\">&gt;</span> {};\n+    (<span class=\"macro-nonterminal\">$</span><span class=\"macro-nonterminal\">foo</span>:<span class=\"ident\">tt</span>) =&gt; {};\n }\n </code></pre>"}, {"sha": "fbfdc6767337ccbff158e57265a3409ca53dc847", "filename": "src/librustdoc/html/highlight/fixtures/sample.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ee696e79151915193db8a3a3754b2bdd9fd0c62/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.rs?ref=9ee696e79151915193db8a3a3754b2bdd9fd0c62", "patch": "@@ -3,7 +3,7 @@\n use std::path::{Path, PathBuf};\n \n #[cfg(target_os = \"linux\")]\n-fn main() {\n+fn main() -> () {\n     let foo = true && false || true;\n     let _: *const () = 0;\n     let _ = &foo;"}]}