{"sha": "ebd33522d701c03f816f49d2e1a05d1d1078ded9", "node_id": "C_kwDOAAsO6NoAKGViZDMzNTIyZDcwMWMwM2Y4MTZmNDlkMmUxYTA1ZDFkMTA3OGRlZDk", "commit": {"author": {"name": "Albert Larsan", "email": "74931857+albertlarsan68@users.noreply.github.com", "date": "2023-01-11T18:25:33Z"}, "committer": {"name": "Albert Larsan", "email": "74931857+albertlarsan68@users.noreply.github.com", "date": "2023-01-11T18:25:33Z"}, "message": "Deny having src/test exisiting in tidy", "tree": {"sha": "bda41248156f82f0db7becdc97a5e63d0ab636e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bda41248156f82f0db7becdc97a5e63d0ab636e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebd33522d701c03f816f49d2e1a05d1d1078ded9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEECtuvMkQcAKCG3qpZknCbiLuPE+oFAmO+/zoACgkQknCbiLuP\nE+q91RAAvAUDtvfDJuwdDBrUSIDPjpyYkEg2eui580SJG4Rda/VgjCU/8XmtZPPd\nnTobXKG1mnJAoyasjTmGFBCPYcwsGisFZLOOJV5S3BzS9LrRSJ/qJFpBiyjob3Jj\nvt+rS70BiJX9Vxw6V7wcuhHfE4ejnRkrk2MCq0u2gUPcfXiranxTFWqZyK3e7E/y\nphip8uIlfEg7YuoPCE3eAS4jr/a6uQy0HJjMU8EDUkYP8CpHcuJkF7IcaDAOiSR0\n7BDPwbCX4T50swlQCmtAScEj3v0CEb+1mwraeDYzsUm3l6FxV74QfTvf6x+nXjU7\n4RoVgFtME0wYk7FqqWfulsrmn1Gr7YAl5s/NOSpLFLetfZVvNQMPjzISVWEv68ez\nnTkds/JVDmMjTk4ytwrsd9mYmlyA+5mHA4DCHrVj/iVatzjRVKD3s+XIPRASgyNd\nXSb6d8lcIMeMgPGJAmhk6leYRcYUrJGT6tJBUYHLrcBuq68JLQLZWJ8L99UYtk2W\nPMC5lwjnZA6v+OiJKVeRnX/3bHpoSQjXPlTfY2jrk/67uA9VGylHyfcCU3Msb9x1\n3vrU653vD5E49o0IeNVG/cKDFgpIdLimpluA7KQW2S0GdYbEyYMiONZyJjekwZly\nRQXbkDGqw605wXimJocc33MkginbO14KnfuptGqZ7ENslvWaLGA=\n=2TSs\n-----END PGP SIGNATURE-----", "payload": "tree bda41248156f82f0db7becdc97a5e63d0ab636e6\nparent b22c152958eade17a71d899b29a2d39bcc77aa48\nauthor Albert Larsan <74931857+albertlarsan68@users.noreply.github.com> 1673461533 +0000\ncommitter Albert Larsan <74931857+albertlarsan68@users.noreply.github.com> 1673461533 +0000\n\nDeny having src/test exisiting in tidy\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebd33522d701c03f816f49d2e1a05d1d1078ded9", "html_url": "https://github.com/rust-lang/rust/commit/ebd33522d701c03f816f49d2e1a05d1d1078ded9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebd33522d701c03f816f49d2e1a05d1d1078ded9/comments", "author": {"login": "albertlarsan68", "id": 74931857, "node_id": "MDQ6VXNlcjc0OTMxODU3", "avatar_url": "https://avatars.githubusercontent.com/u/74931857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertlarsan68", "html_url": "https://github.com/albertlarsan68", "followers_url": "https://api.github.com/users/albertlarsan68/followers", "following_url": "https://api.github.com/users/albertlarsan68/following{/other_user}", "gists_url": "https://api.github.com/users/albertlarsan68/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertlarsan68/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertlarsan68/subscriptions", "organizations_url": "https://api.github.com/users/albertlarsan68/orgs", "repos_url": "https://api.github.com/users/albertlarsan68/repos", "events_url": "https://api.github.com/users/albertlarsan68/events{/privacy}", "received_events_url": "https://api.github.com/users/albertlarsan68/received_events", "type": "User", "site_admin": false}, "committer": {"login": "albertlarsan68", "id": 74931857, "node_id": "MDQ6VXNlcjc0OTMxODU3", "avatar_url": "https://avatars.githubusercontent.com/u/74931857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertlarsan68", "html_url": "https://github.com/albertlarsan68", "followers_url": "https://api.github.com/users/albertlarsan68/followers", "following_url": "https://api.github.com/users/albertlarsan68/following{/other_user}", "gists_url": "https://api.github.com/users/albertlarsan68/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertlarsan68/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertlarsan68/subscriptions", "organizations_url": "https://api.github.com/users/albertlarsan68/orgs", "repos_url": "https://api.github.com/users/albertlarsan68/repos", "events_url": "https://api.github.com/users/albertlarsan68/events{/privacy}", "received_events_url": "https://api.github.com/users/albertlarsan68/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b22c152958eade17a71d899b29a2d39bcc77aa48", "url": "https://api.github.com/repos/rust-lang/rust/commits/b22c152958eade17a71d899b29a2d39bcc77aa48", "html_url": "https://github.com/rust-lang/rust/commit/b22c152958eade17a71d899b29a2d39bcc77aa48"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "1eb146989e4f89ee892065fcd261ca2d8b9f7f65", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=ebd33522d701c03f816f49d2e1a05d1d1078ded9", "patch": "@@ -64,6 +64,7 @@ pub mod pal;\n pub mod primitive_docs;\n pub mod style;\n pub mod target_specific_tests;\n+pub mod tests_placement;\n pub mod ui_tests;\n pub mod unit_tests;\n pub mod unstable_book;"}, {"sha": "79441cda64c054ac314516f227aa5462bd07f7e8", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=ebd33522d701c03f816f49d2e1a05d1d1078ded9", "patch": "@@ -76,6 +76,7 @@ fn main() {\n         check!(extdeps, &root_path);\n \n         // Checks over tests.\n+        check!(tests_placement, &root_path);\n         check!(debug_artifacts, &tests_path);\n         check!(ui_tests, &tests_path);\n         check!(mir_opt_tests, &tests_path, bless);"}, {"sha": "9d0057df8bcd85f09ea4eeede8ee98db18c458a6", "filename": "src/tools/tidy/src/tests_placement.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Ftests_placement.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebd33522d701c03f816f49d2e1a05d1d1078ded9/src%2Ftools%2Ftidy%2Fsrc%2Ftests_placement.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ftests_placement.rs?ref=ebd33522d701c03f816f49d2e1a05d1d1078ded9", "patch": "@@ -0,0 +1,15 @@\n+use std::path::Path;\n+\n+const FORBIDDEN_PATH: &str = \"src/test\";\n+const ALLOWED_PATH: &str = \"tests\";\n+\n+pub fn check(root_path: impl AsRef<Path>, bad: &mut bool) {\n+    if root_path.as_ref().join(FORBIDDEN_PATH).exists() {\n+        tidy_error!(\n+            bad,\n+            \"Tests have been moved, please move them from {} to {}\",\n+            root_path.as_ref().join(FORBIDDEN_PATH).display(),\n+            root_path.as_ref().join(ALLOWED_PATH).display()\n+        )\n+    }\n+}"}]}