{"sha": "03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzZWE2YmNiZmZkNGFlM2FjNTI4OWZmN2Q0MzQ0NTBjMjE5MTg2YTg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-02T20:35:51Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-03T09:26:40Z"}, "message": "use LocalPtr in navigation target", "tree": {"sha": "882401790c66b34e447c31920eb7e6e3c11efc4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/882401790c66b34e447c31920eb7e6e3c11efc4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "html_url": "https://github.com/rust-lang/rust/commit/03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "267a89bca2b606faafacfe69db7fda1ef27bb39f", "url": "https://api.github.com/repos/rust-lang/rust/commits/267a89bca2b606faafacfe69db7fda1ef27bb39f", "html_url": "https://github.com/rust-lang/rust/commit/267a89bca2b606faafacfe69db7fda1ef27bb39f"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "b812c3441029852468eae4dfa6df4d455259c10f", "filename": "crates/ra_analysis/src/imp.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fimp.rs?ref=03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "patch": "@@ -121,6 +121,7 @@ impl db::RootDatabase {\n             name: decl_name.text(),\n             range: decl_name.syntax().range(),\n             kind: MODULE,\n+            ptr: None,\n         }])\n     }\n     /// Returns `Vec` for the same reason as `parent_module`\n@@ -158,6 +159,7 @@ impl db::RootDatabase {\n                         name: entry.name().to_string().into(),\n                         range: entry.ptr().range(),\n                         kind: NAME,\n+                        ptr: None,\n                     });\n                     return Ok(Some(rr));\n                 };\n@@ -185,6 +187,7 @@ impl db::RootDatabase {\n                             name,\n                             range: TextRange::offset_len(0.into(), 0.into()),\n                             kind: MODULE,\n+                            ptr: None,\n                         };\n                         rr.resolves_to.push(symbol);\n                         return Ok(Some(rr));"}, {"sha": "343fd28bb8ec602727346fc539e3702929a6cd68", "filename": "crates/ra_analysis/src/lib.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Flib.rs?ref=03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "patch": "@@ -41,7 +41,7 @@ pub use ra_editor::{\n pub use hir::FnSignatureInfo;\n \n pub use ra_db::{\n-    Canceled, Cancelable, FilePosition, FileRange,\n+    Canceled, Cancelable, FilePosition, FileRange, LocalSyntaxPtr,\n     CrateGraph, CrateId, SourceRootId, FileId, SyntaxDatabase, FilesDatabase\n };\n \n@@ -225,6 +225,8 @@ pub struct NavigationTarget {\n     name: SmolStr,\n     kind: SyntaxKind,\n     range: TextRange,\n+    // Should be DefId ideally\n+    ptr: Option<LocalSyntaxPtr>,\n }\n \n impl NavigationTarget {\n@@ -234,6 +236,7 @@ impl NavigationTarget {\n             kind: symbol.ptr.kind(),\n             file_id,\n             range: symbol.ptr.range(),\n+            ptr: Some(symbol.ptr.clone()),\n         }\n     }\n     pub fn name(&self) -> &SmolStr {"}, {"sha": "bcf29d29cac3f24169bdb6cd7826a8ee51ee137e", "filename": "crates/ra_analysis/tests/tests.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Ftests%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_analysis%2Ftests%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Ftests%2Ftests.rs?ref=03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "patch": "@@ -25,7 +25,7 @@ fn approximate_resolve_works_in_items() {\n     assert_eq_dbg(\n         r#\"ReferenceResolution {\n             reference_range: [23; 26),\n-            resolves_to: [NavigationTarget { file_id: FileId(1), symbol: FileSymbol { name: \"Foo\", node_range: [0; 11), kind: STRUCT_DEF } }]\n+            resolves_to: [NavigationTarget { file_id: FileId(1), name: \"Foo\", kind: STRUCT_DEF, range: [0; 11), ptr: Some(LocalSyntaxPtr { range: [0; 11), kind: STRUCT_DEF }) }]\n         }\"#,\n         &symbols,\n     );\n@@ -46,7 +46,7 @@ fn test_resolve_module() {\n     assert_eq_dbg(\n         r#\"ReferenceResolution {\n             reference_range: [4; 7),\n-            resolves_to: [NavigationTarget { file_id: FileId(2), symbol: FileSymbol { name: \"foo\", node_range: [0; 0), kind: MODULE } }]\n+            resolves_to: [NavigationTarget { file_id: FileId(2), name: \"foo\", kind: MODULE, range: [0; 0), ptr: None }]\n         }\"#,\n         &symbols,\n     );\n@@ -64,7 +64,7 @@ fn test_resolve_module() {\n     assert_eq_dbg(\n         r#\"ReferenceResolution {\n             reference_range: [4; 7),\n-            resolves_to: [NavigationTarget { file_id: FileId(2), symbol: FileSymbol { name: \"foo\", node_range: [0; 0), kind: MODULE } }]\n+            resolves_to: [NavigationTarget { file_id: FileId(2), name: \"foo\", kind: MODULE, range: [0; 0), ptr: None }]\n         }\"#,\n         &symbols,\n     );\n@@ -107,7 +107,7 @@ fn test_resolve_parent_module() {\n     );\n     let symbols = analysis.parent_module(pos).unwrap();\n     assert_eq_dbg(\n-        r#\"[NavigationTarget { file_id: FileId(1), symbol: FileSymbol { name: \"foo\", node_range: [4; 7), kind: MODULE } }]\"#,\n+        r#\"[NavigationTarget { file_id: FileId(1), name: \"foo\", kind: MODULE, range: [4; 7), ptr: None }]\"#,\n         &symbols,\n     );\n }\n@@ -126,7 +126,7 @@ fn test_resolve_parent_module_for_inline() {\n     );\n     let symbols = analysis.parent_module(pos).unwrap();\n     assert_eq_dbg(\n-        r#\"[NavigationTarget { file_id: FileId(1), symbol: FileSymbol { name: \"bar\", node_range: [18; 21), kind: MODULE } }]\"#,\n+        r#\"[NavigationTarget { file_id: FileId(1), name: \"bar\", kind: MODULE, range: [18; 21), ptr: None }]\"#,\n         &symbols,\n     );\n }"}, {"sha": "b5792f3b81f1eb63328a7e52b896634d43c4a40a", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03ea6bcbffd4ae3ac5289ff7d434450c219186a8/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=03ea6bcbffd4ae3ac5289ff7d434450c219186a8", "patch": "@@ -190,7 +190,7 @@ pub fn handle_workspace_symbol(\n         let mut res = Vec::new();\n         for nav in world.analysis().symbol_search(query)? {\n             let info = SymbolInformation {\n-                name: nav.name().into(),\n+                name: nav.name().to_string(),\n                 kind: nav.kind().conv(),\n                 location: nav.try_conv_with(world)?,\n                 container_name: None,"}]}