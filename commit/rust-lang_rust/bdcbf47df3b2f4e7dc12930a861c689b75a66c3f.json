{"sha": "bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "node_id": "C_kwDOAAsO6NoAKGJkY2JmNDdkZjNiMmY0ZTdkYzEyOTMwYTg2MWM2ODliNzVhNjZjM2Y", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-01-13T16:34:43Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-01-13T16:34:43Z"}, "message": "Improve readme and build system help message", "tree": {"sha": "31bb25766dd11e09b08aa36d901bcd1b86fa6ef5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/31bb25766dd11e09b08aa36d901bcd1b86fa6ef5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "html_url": "https://github.com/rust-lang/rust/commit/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a27253289b4340a464206ea52534ef07e017efe", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a27253289b4340a464206ea52534ef07e017efe", "html_url": "https://github.com/rust-lang/rust/commit/3a27253289b4340a464206ea52534ef07e017efe"}], "stats": {"total": 71, "additions": 40, "deletions": 31}, "files": [{"sha": "b87a9dc51e8d0f3f956e5fc69acb701a2c8e1ad3", "filename": "Readme.md", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/Readme.md", "raw_url": "https://github.com/rust-lang/rust/raw/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/Readme.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Readme.md?ref=bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "patch": "@@ -8,9 +8,9 @@ If not please open an issue.\n ## Building and testing\n \n ```bash\n-$ git clone https://github.com/bjorn3/rustc_codegen_cranelift.git\n+$ git clone https://github.com/bjorn3/rustc_codegen_cranelift\n $ cd rustc_codegen_cranelift\n-$ ./y.rs prepare # download and patch sysroot src and install hyperfine for benchmarking\n+$ ./y.rs prepare\n $ ./y.rs build\n ```\n \n@@ -20,13 +20,12 @@ To run the test suite replace the last command with:\n $ ./test.sh\n ```\n \n-This will implicitly build cg_clif too. Both `y.rs build` and `test.sh` accept a `--debug` argument to\n-build in debug mode.\n+For more docs on how to build and test see [build_system/usage.txt](build_system/usage.txt) or the help message of `./y.rs`.\n \n-Alternatively you can download a pre built version from [GHA]. It is listed in the artifacts section\n+Alternatively you can download a pre built version from [Github Actions]. It is listed in the artifacts section\n of workflow runs. Unfortunately due to GHA restrictions you need to be logged in to access it.\n \n-[GHA]: https://github.com/bjorn3/rustc_codegen_cranelift/actions?query=branch%3Amaster+event%3Apush+is%3Asuccess\n+[Github Actions]: https://github.com/bjorn3/rustc_codegen_cranelift/actions?query=branch%3Amaster+event%3Apush+is%3Asuccess\n \n ## Usage\n "}, {"sha": "d1932549ee675c5cae550c5363c17fe9f83b4998", "filename": "build_system/mod.rs", "status": "modified", "additions": 1, "deletions": 25, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/build_system%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/build_system%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fmod.rs?ref=bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "patch": "@@ -15,32 +15,8 @@ mod rustc_info;\n mod tests;\n mod utils;\n \n-const USAGE: &str = r#\"The build system of cg_clif.\n-\n-USAGE:\n-    ./y.rs prepare [--out-dir DIR]\n-    ./y.rs build [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n-    ./y.rs test [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n-    ./y.rs bench [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n-\n-OPTIONS:\n-    --sysroot none|clif|llvm\n-            Which sysroot libraries to use:\n-            `none` will not include any standard library in the sysroot.\n-            `clif` will build the standard library using Cranelift.\n-            `llvm` will use the pre-compiled standard library of rustc which is compiled with LLVM.\n-\n-    --out-dir DIR\n-            Specify the directory in which the download, build and dist directories are stored.\n-            By default this is the working directory.\n-\n-    --no-unstable-features\n-            fSome features are not yet ready for production usage. This option will disable these\n-            features. This includes the JIT mode and inline assembly support.\n-\"#;\n-\n fn usage() {\n-    eprintln!(\"{USAGE}\");\n+    eprintln!(\"{}\", include_str!(\"usage.txt\"));\n }\n \n macro_rules! arg_error {"}, {"sha": "9185255155426790001802a0034374e20a9450bf", "filename": "build_system/usage.txt", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/build_system%2Fusage.txt", "raw_url": "https://github.com/rust-lang/rust/raw/bdcbf47df3b2f4e7dc12930a861c689b75a66c3f/build_system%2Fusage.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fusage.txt?ref=bdcbf47df3b2f4e7dc12930a861c689b75a66c3f", "patch": "@@ -0,0 +1,34 @@\n+The build system of cg_clif.\n+\n+USAGE:\n+    ./y.rs prepare [--out-dir DIR]\n+    ./y.rs build [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n+    ./y.rs test [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n+    ./y.rs bench [--debug] [--sysroot none|clif|llvm] [--out-dir DIR] [--no-unstable-features]\n+\n+OPTIONS:\n+    --debug\n+            Build cg_clif and the standard library in debug mode rather than release mode.\n+            Warning: An unoptimized cg_clif is very slow.\n+\n+    --sysroot none|clif|llvm\n+            Which sysroot libraries to use:\n+            `none` will not include any standard library in the sysroot.\n+            `clif` will build the standard library using Cranelift.\n+            `llvm` will use the pre-compiled standard library of rustc which is compiled with LLVM.\n+\n+    --out-dir DIR\n+            Specify the directory in which the download, build and dist directories are stored.\n+            By default this is the working directory.\n+\n+    --no-unstable-features\n+            Some features are not yet ready for production usage. This option will disable these\n+            features. This includes the JIT mode and inline assembly support.\n+\n+REQUIREMENTS:\n+    * Rustup: The build system has a hard coded dependency on rustup to install the right nightly\n+      version and make sure it is used where necessary.\n+    * Git: `./y.rs prepare` uses git for applying patches and on Windows for downloading test repos.\n+    * Curl and tar (non-Windows only): Used by `./y.rs prepare` to download a single commit for\n+      repos. Git will be used to clone the whole repo when using Windows.\n+    * [Hyperfine](https://github.com/sharkdp/hyperfine/): Used for benchmarking with `./y.rs bench`."}]}