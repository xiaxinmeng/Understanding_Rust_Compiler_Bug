{"sha": "7e072199a6e650698c2f5f1e1053b20d48be43d3", "node_id": "C_kwDOAAsO6NoAKDdlMDcyMTk5YTZlNjUwNjk4YzJmNWYxZTEwNTNiMjBkNDhiZTQzZDM", "commit": {"author": {"name": "Lukas Bergdoll", "email": "lukas.bergdoll@gmail.com", "date": "2023-02-10T17:00:31Z"}, "committer": {"name": "Lukas Bergdoll", "email": "lukas.bergdoll@gmail.com", "date": "2023-02-10T17:05:12Z"}, "message": "Speedup heapsort by 1.5x by making it branchless\n\n`slice::sort_unstable` will fall back to heapsort if it repeatedly fails to find\na good pivot. By making the core child update code branchless it is much faster.\nOn Zen3 sorting 10k `u64` and forcing the sort to pick heapsort, results in:\n\n455us -> 278us", "tree": {"sha": "9d943637e7fcd5d0175a734b7fde1e763679c7cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9d943637e7fcd5d0175a734b7fde1e763679c7cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e072199a6e650698c2f5f1e1053b20d48be43d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e072199a6e650698c2f5f1e1053b20d48be43d3", "html_url": "https://github.com/rust-lang/rust/commit/7e072199a6e650698c2f5f1e1053b20d48be43d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e072199a6e650698c2f5f1e1053b20d48be43d3/comments", "author": {"login": "Voultapher", "id": 6864584, "node_id": "MDQ6VXNlcjY4NjQ1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6864584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Voultapher", "html_url": "https://github.com/Voultapher", "followers_url": "https://api.github.com/users/Voultapher/followers", "following_url": "https://api.github.com/users/Voultapher/following{/other_user}", "gists_url": "https://api.github.com/users/Voultapher/gists{/gist_id}", "starred_url": "https://api.github.com/users/Voultapher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Voultapher/subscriptions", "organizations_url": "https://api.github.com/users/Voultapher/orgs", "repos_url": "https://api.github.com/users/Voultapher/repos", "events_url": "https://api.github.com/users/Voultapher/events{/privacy}", "received_events_url": "https://api.github.com/users/Voultapher/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Voultapher", "id": 6864584, "node_id": "MDQ6VXNlcjY4NjQ1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6864584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Voultapher", "html_url": "https://github.com/Voultapher", "followers_url": "https://api.github.com/users/Voultapher/followers", "following_url": "https://api.github.com/users/Voultapher/following{/other_user}", "gists_url": "https://api.github.com/users/Voultapher/gists{/gist_id}", "starred_url": "https://api.github.com/users/Voultapher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Voultapher/subscriptions", "organizations_url": "https://api.github.com/users/Voultapher/orgs", "repos_url": "https://api.github.com/users/Voultapher/repos", "events_url": "https://api.github.com/users/Voultapher/events{/privacy}", "received_events_url": "https://api.github.com/users/Voultapher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1ac43a9b9a8250d858705b0796dfed6186e18db", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1ac43a9b9a8250d858705b0796dfed6186e18db", "html_url": "https://github.com/rust-lang/rust/commit/d1ac43a9b9a8250d858705b0796dfed6186e18db"}], "stats": {"total": 4, "additions": 1, "deletions": 3}, "files": [{"sha": "990540f55f53d80fba1aead1774a9089feeb7eee", "filename": "library/core/src/slice/sort.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7e072199a6e650698c2f5f1e1053b20d48be43d3/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e072199a6e650698c2f5f1e1053b20d48be43d3/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fslice%2Fsort.rs?ref=7e072199a6e650698c2f5f1e1053b20d48be43d3", "patch": "@@ -198,9 +198,7 @@ where\n             }\n \n             // Choose the greater child.\n-            if child + 1 < v.len() && is_less(&v[child], &v[child + 1]) {\n-                child += 1;\n-            }\n+            child += (child + 1 < v.len() && is_less(&v[child], &v[child + 1])) as usize;\n \n             // Stop if the invariant holds at `node`.\n             if !is_less(&v[node], &v[child]) {"}]}