{"sha": "f93cbf617000673e5ad2fc0fd0eff0c9ea229314", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5M2NiZjYxNzAwMDY3M2U1YWQyZmMwZmQwZWZmMGM5ZWEyMjkzMTQ=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2018-12-22T11:41:17Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2018-12-22T11:41:17Z"}, "message": "Short-circuit DefIdForest::intersection()\n\nIf the forest is already empty, there is no point in intersecting\nfurther.\n\nAlso handle the first element separately, so we don't compute an\nunnecessary intersection between the full forest and the first\nelement, which is always equal to the first element.", "tree": {"sha": "2203ea7ef4dd841e3f60c9e3872f77e1e87584af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2203ea7ef4dd841e3f60c9e3872f77e1e87584af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f93cbf617000673e5ad2fc0fd0eff0c9ea229314", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f93cbf617000673e5ad2fc0fd0eff0c9ea229314", "html_url": "https://github.com/rust-lang/rust/commit/f93cbf617000673e5ad2fc0fd0eff0c9ea229314", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f93cbf617000673e5ad2fc0fd0eff0c9ea229314/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9689ada83891f63164bf117af35cc0abc37daaf1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9689ada83891f63164bf117af35cc0abc37daaf1", "html_url": "https://github.com/rust-lang/rust/commit/9689ada83891f63164bf117af35cc0abc37daaf1"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "af2185205a33df38c449fb0f838953c99c0ab9f3", "filename": "src/librustc/ty/inhabitedness/def_id_forest.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f93cbf617000673e5ad2fc0fd0eff0c9ea229314/src%2Flibrustc%2Fty%2Finhabitedness%2Fdef_id_forest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f93cbf617000673e5ad2fc0fd0eff0c9ea229314/src%2Flibrustc%2Fty%2Finhabitedness%2Fdef_id_forest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Finhabitedness%2Fdef_id_forest.rs?ref=f93cbf617000673e5ad2fc0fd0eff0c9ea229314", "patch": "@@ -74,10 +74,21 @@ impl<'a, 'gcx, 'tcx> DefIdForest {\n                            iter: I) -> DefIdForest\n             where I: IntoIterator<Item=DefIdForest>\n     {\n-        let mut ret = DefIdForest::full(tcx);\n+        let mut iter = iter.into_iter();\n+        let mut ret = if let Some(first) = iter.next() {\n+            first\n+        } else {\n+            return DefIdForest::full(tcx);\n+        };\n+\n         let mut next_ret = SmallVec::new();\n         let mut old_ret: SmallVec<[DefId; 1]> = SmallVec::new();\n         for next_forest in iter {\n+            // No need to continue if the intersection is already empty.\n+            if ret.is_empty() {\n+                break;\n+            }\n+\n             for id in ret.root_ids.drain() {\n                 if next_forest.contains(tcx, id) {\n                     next_ret.push(id);"}]}