{"sha": "122c6fedf4929c262e73158f156c2446c4b8bb84", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyMmM2ZmVkZjQ5MjljMjYyZTczMTU4ZjE1NmMyNDQ2YzRiOGJiODQ=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-29T19:56:59Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-29T20:58:17Z"}, "message": "Stop emitting error in `qualify_consts` if promotion fails", "tree": {"sha": "48aa0d0a457a232de656bb4ac05a09124cb8a41f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48aa0d0a457a232de656bb4ac05a09124cb8a41f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/122c6fedf4929c262e73158f156c2446c4b8bb84", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/122c6fedf4929c262e73158f156c2446c4b8bb84", "html_url": "https://github.com/rust-lang/rust/commit/122c6fedf4929c262e73158f156c2446c4b8bb84", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/122c6fedf4929c262e73158f156c2446c4b8bb84/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46b68b009ba64330f6ad503a1882a7df637b1a86", "url": "https://api.github.com/repos/rust-lang/rust/commits/46b68b009ba64330f6ad503a1882a7df637b1a86", "html_url": "https://github.com/rust-lang/rust/commit/46b68b009ba64330f6ad503a1882a7df637b1a86"}], "stats": {"total": 14, "additions": 3, "deletions": 11}, "files": [{"sha": "49805dfc026f3e60e52a6e5ef2effbca92ec809e", "filename": "src/librustc_mir/transform/qualify_consts.rs", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/122c6fedf4929c262e73158f156c2446c4b8bb84/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/122c6fedf4929c262e73158f156c2446c4b8bb84/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs?ref=122c6fedf4929c262e73158f156c2446c4b8bb84", "patch": "@@ -1599,20 +1599,12 @@ impl<'a, 'tcx> Visitor<'tcx> for Checker<'a, 'tcx> {\n                     // This is not a problem, because the argument explicitly\n                     // requests constness, in contrast to regular promotion\n                     // which happens even without the user requesting it.\n-                    // We can error out with a hard error if the argument is not\n-                    // constant here.\n+                    //\n+                    // `promote_consts` is responsible for emitting the error if\n+                    // the argument is not promotable.\n                     if !IsNotPromotable::in_operand(self, arg) {\n                         debug!(\"visit_terminator_kind: candidate={:?}\", candidate);\n                         self.promotion_candidates.push(candidate);\n-                    } else {\n-                        if is_shuffle {\n-                            span_err!(self.tcx.sess, self.span, E0526,\n-                                      \"shuffle indices are not constant\");\n-                        } else {\n-                            self.tcx.sess.span_err(self.span,\n-                                &format!(\"argument {} is required to be a constant\",\n-                                         i + 1));\n-                        }\n                     }\n                 }\n             }"}]}