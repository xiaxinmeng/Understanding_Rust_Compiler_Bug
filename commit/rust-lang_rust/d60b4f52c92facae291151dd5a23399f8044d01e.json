{"sha": "d60b4f52c92facae291151dd5a23399f8044d01e", "node_id": "C_kwDOAAsO6NoAKGQ2MGI0ZjUyYzkyZmFjYWUyOTExNTFkZDVhMjMzOTlmODA0NGQwMWU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-06T17:52:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-06T17:52:47Z"}, "message": "Auto merge of #95454 - randomicon00:fix95444, r=wesleywiser\n\nFixing #95444 by only displaying passes that take more than 5 millise\u2026\n\nAs discussed in #95444, I have added the code to test and only display prints that are greater than 5 milliseconds.\n\nr? `@jyn514`", "tree": {"sha": "840e698453edcedb23f76ea7d8ad9bf964e526d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/840e698453edcedb23f76ea7d8ad9bf964e526d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d60b4f52c92facae291151dd5a23399f8044d01e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d60b4f52c92facae291151dd5a23399f8044d01e", "html_url": "https://github.com/rust-lang/rust/commit/d60b4f52c92facae291151dd5a23399f8044d01e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d60b4f52c92facae291151dd5a23399f8044d01e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e209e85e39b4851c3ec122a45ddeabe318b2d522", "url": "https://api.github.com/repos/rust-lang/rust/commits/e209e85e39b4851c3ec122a45ddeabe318b2d522", "html_url": "https://github.com/rust-lang/rust/commit/e209e85e39b4851c3ec122a45ddeabe318b2d522"}, {"sha": "e79ba76ec462031c9d5fa2130bc631600bc6d875", "url": "https://api.github.com/repos/rust-lang/rust/commits/e79ba76ec462031c9d5fa2130bc631600bc6d875", "html_url": "https://github.com/rust-lang/rust/commit/e79ba76ec462031c9d5fa2130bc631600bc6d875"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "bf7924a81fffc8190b42560486f7038d7ef4b531", "filename": "compiler/rustc_data_structures/src/profiling.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d60b4f52c92facae291151dd5a23399f8044d01e/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d60b4f52c92facae291151dd5a23399f8044d01e/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs?ref=d60b4f52c92facae291151dd5a23399f8044d01e", "patch": "@@ -737,11 +737,30 @@ impl Drop for VerboseTimingGuard<'_> {\n     fn drop(&mut self) {\n         if let Some((start_time, start_rss, ref message)) = self.start_and_message {\n             let end_rss = get_resident_set_size();\n-            print_time_passes_entry(&message, start_time.elapsed(), start_rss, end_rss);\n+            let dur = start_time.elapsed();\n+\n+            if should_print_passes(dur, start_rss, end_rss) {\n+                print_time_passes_entry(&message, dur, start_rss, end_rss);\n+            }\n         }\n     }\n }\n \n+fn should_print_passes(dur: Duration, start_rss: Option<usize>, end_rss: Option<usize>) -> bool {\n+    if dur.as_millis() > 5 {\n+        return true;\n+    }\n+\n+    if let (Some(start_rss), Some(end_rss)) = (start_rss, end_rss) {\n+        let change_rss = end_rss.abs_diff(start_rss);\n+        if change_rss > 0 {\n+            return true;\n+        }\n+    }\n+\n+    false\n+}\n+\n pub fn print_time_passes_entry(\n     what: &str,\n     dur: Duration,"}]}