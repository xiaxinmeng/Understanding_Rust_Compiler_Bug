{"sha": "2c94c4964aa6242098f97ca3421a750a763567b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjOTRjNDk2NGFhNjI0MjA5OGY5N2NhMzQyMWE3NTBhNzYzNTY3YjQ=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2020-12-23T01:15:30Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2020-12-23T01:15:44Z"}, "message": "Parse const effect block", "tree": {"sha": "2474ee18f391cffd027b5ebdce7ddb5c7e43e8c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2474ee18f391cffd027b5ebdce7ddb5c7e43e8c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c94c4964aa6242098f97ca3421a750a763567b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c94c4964aa6242098f97ca3421a750a763567b4", "html_url": "https://github.com/rust-lang/rust/commit/2c94c4964aa6242098f97ca3421a750a763567b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c94c4964aa6242098f97ca3421a750a763567b4/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03a9bbacf2a82faaecc269c1d97dea392f4f9874", "url": "https://api.github.com/repos/rust-lang/rust/commits/03a9bbacf2a82faaecc269c1d97dea392f4f9874", "html_url": "https://github.com/rust-lang/rust/commit/03a9bbacf2a82faaecc269c1d97dea392f4f9874"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "c7a3556a775092960a18e3b1aa8b45f4482102ad", "filename": "crates/parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=2c94c4964aa6242098f97ca3421a750a763567b4", "patch": "@@ -46,6 +46,7 @@ pub(super) const ATOM_EXPR_FIRST: TokenSet =\n         T![continue],\n         T![async],\n         T![try],\n+        T![const],\n         T![loop],\n         T![for],\n         LIFETIME_IDENT,\n@@ -115,6 +116,14 @@ pub(super) fn atom_expr(p: &mut Parser, r: Restrictions) -> Option<(CompletedMar\n             block_expr(p);\n             m.complete(p, EFFECT_EXPR)\n         }\n+        // test const_block\n+        // fn f() { const { } }\n+        T![const] if la == T!['{'] => {\n+            let m = p.start();\n+            p.bump(T![const]);\n+            block_expr(p);\n+            m.complete(p, EFFECT_EXPR)\n+        }\n         T!['{'] => {\n             // test for_range_from\n             // fn foo() {"}, {"sha": "72b73f89174d60faf249cffe52dfe50b38b4e78c", "filename": "crates/parser/src/grammar/items.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs?ref=2c94c4964aa6242098f97ca3421a750a763567b4", "patch": "@@ -96,7 +96,10 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n     let mut has_mods = false;\n \n     // modifiers\n-    has_mods |= p.eat(T![const]);\n+    if p.at(T![const]) && p.nth(1) != T!['{'] {\n+        p.eat(T![const]);\n+        has_mods = true;\n+    }\n \n     // test_err async_without_semicolon\n     // fn foo() { let _ = async {} }\n@@ -167,7 +170,7 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n             m.complete(p, TRAIT);\n         }\n \n-        T![const] => {\n+        T![const] if p.nth(1) != T!['{'] => {\n             consts::konst(p, m);\n         }\n "}, {"sha": "d5d2c8fe3069eb70967407c30461762d6811e9cc", "filename": "crates/syntax/test_data/parser/inline/ok/0157_const_block.rast", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rast", "raw_url": "https://github.com/rust-lang/rust/raw/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rast?ref=2c94c4964aa6242098f97ca3421a750a763567b4", "patch": "@@ -0,0 +1,23 @@\n+SOURCE_FILE@0..21\n+  FN@0..20\n+    FN_KW@0..2 \"fn\"\n+    WHITESPACE@2..3 \" \"\n+    NAME@3..4\n+      IDENT@3..4 \"f\"\n+    PARAM_LIST@4..6\n+      L_PAREN@4..5 \"(\"\n+      R_PAREN@5..6 \")\"\n+    WHITESPACE@6..7 \" \"\n+    BLOCK_EXPR@7..20\n+      L_CURLY@7..8 \"{\"\n+      WHITESPACE@8..9 \" \"\n+      EFFECT_EXPR@9..18\n+        CONST_KW@9..14 \"const\"\n+        WHITESPACE@14..15 \" \"\n+        BLOCK_EXPR@15..18\n+          L_CURLY@15..16 \"{\"\n+          WHITESPACE@16..17 \" \"\n+          R_CURLY@17..18 \"}\"\n+      WHITESPACE@18..19 \" \"\n+      R_CURLY@19..20 \"}\"\n+  WHITESPACE@20..21 \"\\n\""}, {"sha": "a2e3565a321f2f583859c8f1a8f961cbd982e000", "filename": "crates/syntax/test_data/parser/inline/ok/0157_const_block.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c94c4964aa6242098f97ca3421a750a763567b4/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0157_const_block.rs?ref=2c94c4964aa6242098f97ca3421a750a763567b4", "patch": "@@ -0,0 +1 @@\n+fn f() { const { } }"}]}