{"sha": "a938725ef715b90d0494529142ba8a3264f8e5db", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5Mzg3MjVlZjcxNWI5MGQwNDk0NTI5MTQyYmE4YTMyNjRmOGU1ZGI=", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2020-12-30T22:56:51Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2021-01-17T17:51:02Z"}, "message": "Don't use posix_spawn_file_actions_addchdir_np on macOS.", "tree": {"sha": "90235a5b8b819185ccfcb0a06f6f2fb31cf91434", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90235a5b8b819185ccfcb0a06f6f2fb31cf91434"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a938725ef715b90d0494529142ba8a3264f8e5db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a938725ef715b90d0494529142ba8a3264f8e5db", "html_url": "https://github.com/rust-lang/rust/commit/a938725ef715b90d0494529142ba8a3264f8e5db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a938725ef715b90d0494529142ba8a3264f8e5db/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d3818152d8ab5649d2e5cc6d7851ed7c03055fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d3818152d8ab5649d2e5cc6d7851ed7c03055fe", "html_url": "https://github.com/rust-lang/rust/commit/7d3818152d8ab5649d2e5cc6d7851ed7c03055fe"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "ddcb404c60ebc0ba08c765f898438e2892d10fe1", "filename": "library/std/src/sys/unix/process/process_unix.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a938725ef715b90d0494529142ba8a3264f8e5db/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a938725ef715b90d0494529142ba8a3264f8e5db/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs?ref=a938725ef715b90d0494529142ba8a3264f8e5db", "patch": "@@ -314,10 +314,20 @@ impl Command {\n             ) -> libc::c_int\n         }\n         let addchdir = match self.get_cwd() {\n-            Some(cwd) => match posix_spawn_file_actions_addchdir_np.get() {\n-                Some(f) => Some((f, cwd)),\n-                None => return Ok(None),\n-            },\n+            Some(cwd) => {\n+                if cfg!(target_os = \"macos\") {\n+                    // There is a bug in macOS where a relative executable\n+                    // path like \"../myprogram\" will cause `posix_spawn` to\n+                    // successfully launch the program, but erroneously return\n+                    // ENOENT when used with posix_spawn_file_actions_addchdir_np\n+                    // which was introduced in macOS 10.15.\n+                    return Ok(None);\n+                }\n+                match posix_spawn_file_actions_addchdir_np.get() {\n+                    Some(f) => Some((f, cwd)),\n+                    None => return Ok(None),\n+                }\n+            }\n             None => None,\n         };\n "}]}