{"sha": "5d78485a81c06a621f607f3e772add628c892b13", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkNzg0ODVhODFjMDZhNjIxZjYwN2YzZTc3MmFkZDYyOGM4OTJiMTM=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-12-28T20:32:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-12-28T20:32:04Z"}, "message": "Merge pull request #1406 from theemathas/double-parens\n\nAdd double_parens lint", "tree": {"sha": "cdc8ddd4df8de5d156c408d8cc8f8bfc3a449a69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cdc8ddd4df8de5d156c408d8cc8f8bfc3a449a69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d78485a81c06a621f607f3e772add628c892b13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d78485a81c06a621f607f3e772add628c892b13", "html_url": "https://github.com/rust-lang/rust/commit/5d78485a81c06a621f607f3e772add628c892b13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d78485a81c06a621f607f3e772add628c892b13/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96d2483b0907f40382be83e374cb428e2b2c26c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/96d2483b0907f40382be83e374cb428e2b2c26c7", "html_url": "https://github.com/rust-lang/rust/commit/96d2483b0907f40382be83e374cb428e2b2c26c7"}, {"sha": "7034d169e5e04f8cd13c3bbc5a83127add0f85f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/7034d169e5e04f8cd13c3bbc5a83127add0f85f8", "html_url": "https://github.com/rust-lang/rust/commit/7034d169e5e04f8cd13c3bbc5a83127add0f85f8"}], "stats": {"total": 126, "additions": 122, "deletions": 4}, "files": [{"sha": "7eb5df200f069e1ace6a26b3487d024f5991ced2", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -268,6 +268,7 @@ All notable changes to this project will be documented in this file.\n [`diverging_sub_expression`]: https://github.com/Manishearth/rust-clippy/wiki#diverging_sub_expression\n [`doc_markdown`]: https://github.com/Manishearth/rust-clippy/wiki#doc_markdown\n [`double_neg`]: https://github.com/Manishearth/rust-clippy/wiki#double_neg\n+[`double_parens`]: https://github.com/Manishearth/rust-clippy/wiki#double_parens\n [`drop_ref`]: https://github.com/Manishearth/rust-clippy/wiki#drop_ref\n [`duplicate_underscore_argument`]: https://github.com/Manishearth/rust-clippy/wiki#duplicate_underscore_argument\n [`empty_loop`]: https://github.com/Manishearth/rust-clippy/wiki#empty_loop"}, {"sha": "94017cd53c68663b6f902adc61e92c2c57b21a5f", "filename": "README.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -179,7 +179,7 @@ transparently:\n \n ## Lints\n \n-There are 180 lints included in this crate:\n+There are 181 lints included in this crate:\n \n name                                                                                                                   | default | triggers on\n -----------------------------------------------------------------------------------------------------------------------|---------|----------------------------------------------------------------------------------------------------------------------------------\n@@ -216,6 +216,7 @@ name\n [diverging_sub_expression](https://github.com/Manishearth/rust-clippy/wiki#diverging_sub_expression)                   | warn    | whether an expression contains a diverging sub expression\n [doc_markdown](https://github.com/Manishearth/rust-clippy/wiki#doc_markdown)                                           | warn    | presence of `_`, `::` or camel-case outside backticks in documentation\n [double_neg](https://github.com/Manishearth/rust-clippy/wiki#double_neg)                                               | warn    | `--x`, which is a double negation of `x` and not a pre-decrement as in C/C++\n+[double_parens](https://github.com/Manishearth/rust-clippy/wiki#double_parens)                                         | warn    | Warn on unnecessary double parentheses\n [drop_ref](https://github.com/Manishearth/rust-clippy/wiki#drop_ref)                                                   | warn    | calls to `std::mem::drop` with a reference instead of an owned value\n [duplicate_underscore_argument](https://github.com/Manishearth/rust-clippy/wiki#duplicate_underscore_argument)         | warn    | function arguments having names which only differ by an underscore\n [empty_loop](https://github.com/Manishearth/rust-clippy/wiki#empty_loop)                                               | warn    | empty `loop {}`, which should block or sleep"}, {"sha": "a5b469d9c6c909ae5e36fea107c3e0f68754de66", "filename": "clippy_lints/src/double_parens.rs", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/clippy_lints%2Fsrc%2Fdouble_parens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/clippy_lints%2Fsrc%2Fdouble_parens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdouble_parens.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -0,0 +1,62 @@\n+use syntax::ast::*;\n+use rustc::lint::{EarlyContext, LintContext, LintArray, LintPass, EarlyLintPass};\n+\n+/// **What it does:** Checks for unnecessary double parentheses.\n+///\n+/// **Why is this bad?** This makes code harder to read and might indicate a\n+/// mistake.\n+///\n+/// **Known problems:** None.\n+///\n+/// **Example:**\n+/// ```rust\n+/// ((0))\n+/// foo((0))\n+/// ((1, 2))\n+/// ```\n+declare_lint! {\n+    pub DOUBLE_PARENS, Warn,\n+    \"Warn on unnecessary double parentheses\"\n+}\n+\n+#[derive(Copy, Clone)]\n+pub struct DoubleParens;\n+\n+impl LintPass for DoubleParens {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(DOUBLE_PARENS)\n+    }\n+}\n+\n+impl EarlyLintPass for DoubleParens {\n+    fn check_expr(&mut self, cx: &EarlyContext, expr: &Expr) {\n+        match expr.node {\n+            ExprKind::Paren(ref in_paren) => {\n+                match in_paren.node {\n+                    ExprKind::Paren(_) |\n+                    ExprKind::Tup(_) => {\n+                        cx.span_lint(DOUBLE_PARENS, expr.span, \"Consider removing unnecessary double parentheses\");\n+                    },\n+                    _ => {},\n+                }\n+            },\n+            ExprKind::Call(_, ref params) => {\n+                if params.len() == 1 {\n+                    let param = &params[0];\n+                    if let ExprKind::Paren(_) = param.node {\n+                        cx.span_lint(DOUBLE_PARENS, param.span, \"Consider removing unnecessary double parentheses\");\n+                    }\n+                }\n+            },\n+            ExprKind::MethodCall(_, _, ref params) => {\n+                if params.len() == 2 {\n+                    let param = &params[1];\n+                    if let ExprKind::Paren(_) = param.node {\n+                        cx.span_lint(DOUBLE_PARENS, param.span, \"Consider removing unnecessary double parentheses\");\n+                    }\n+                }\n+            },\n+            _ => {},\n+        }\n+    }\n+}"}, {"sha": "ac92d5ec97bc5ce1ae9b4bcb1439b028050ae37e", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -69,6 +69,7 @@ pub mod copies;\n pub mod cyclomatic_complexity;\n pub mod derive;\n pub mod doc;\n+pub mod double_parens;\n pub mod drop_ref;\n pub mod entry;\n pub mod enum_clike;\n@@ -283,6 +284,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry) {\n     reg.register_late_lint_pass(box if_let_redundant_pattern_matching::Pass);\n     reg.register_late_lint_pass(box partialeq_ne_impl::Pass);\n     reg.register_early_lint_pass(box reference::Pass);\n+    reg.register_early_lint_pass(box double_parens::DoubleParens);\n \n     reg.register_lint_group(\"clippy_restrictions\", vec![\n         arithmetic::FLOAT_ARITHMETIC,\n@@ -355,6 +357,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry) {\n         derive::DERIVE_HASH_XOR_EQ,\n         derive::EXPL_IMPL_CLONE_ON_COPY,\n         doc::DOC_MARKDOWN,\n+        double_parens::DOUBLE_PARENS,\n         drop_ref::DROP_REF,\n         entry::MAP_ENTRY,\n         enum_clike::ENUM_CLIKE_UNPORTABLE_VARIANT,"}, {"sha": "2e415d7232dff72cd69e42f719d2dd2490f9363d", "filename": "tests/compile-fail/double_parens.rs", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Fdouble_parens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Fdouble_parens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fdouble_parens.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -0,0 +1,51 @@\n+#![feature(plugin)]\n+#![plugin(clippy)]\n+\n+#![deny(double_parens)]\n+#![allow(dead_code)]\n+\n+fn dummy_fn<T>(_: T) {}\n+\n+struct DummyStruct;\n+\n+impl DummyStruct {\n+    fn dummy_method<T>(self, _: T) {}\n+}\n+\n+fn simple_double_parens() -> i32 {\n+    ((0)) //~ERROR Consider removing unnecessary double parentheses\n+}\n+\n+fn fn_double_parens() {\n+    dummy_fn((0)); //~ERROR Consider removing unnecessary double parentheses\n+}\n+\n+fn method_double_parens(x: DummyStruct) {\n+    x.dummy_method((0)); //~ERROR Consider removing unnecessary double parentheses\n+}\n+\n+fn tuple_double_parens() -> (i32, i32) {\n+    ((1, 2)) //~ERROR Consider removing unnecessary double parentheses\n+}\n+\n+fn unit_double_parens() {\n+    (()) //~ERROR Consider removing unnecessary double parentheses\n+}\n+\n+fn fn_tuple_ok() {\n+    dummy_fn((1, 2));\n+}\n+\n+fn method_tuple_ok(x: DummyStruct) {\n+    x.dummy_method((1, 2));\n+}\n+\n+fn fn_unit_ok() {\n+    dummy_fn(());\n+}\n+\n+fn method_unit_ok(x: DummyStruct) {\n+    x.dummy_method(());\n+}\n+\n+fn main() {}"}, {"sha": "0ec86157d808c8eccf8336650fca3f745636b3b6", "filename": "tests/compile-fail/eq_op.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Feq_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Feq_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Feq_op.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -2,7 +2,7 @@\n #![plugin(clippy)]\n \n #[deny(eq_op)]\n-#[allow(identity_op)]\n+#[allow(identity_op, double_parens)]\n #[allow(no_effect, unused_variables, unnecessary_operation)]\n #[deny(nonminimal_bool)]\n fn main() {"}, {"sha": "6a0b5e927cf7897ec48b47bce99eaab2236b4c2d", "filename": "tests/compile-fail/identity_op.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Fidentity_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Fidentity_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fidentity_op.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -5,7 +5,7 @@ const ONE : i64 = 1;\n const NEG_ONE : i64 = -1;\n const ZERO : i64 = 0;\n \n-#[allow(eq_op, no_effect, unnecessary_operation)]\n+#[allow(eq_op, no_effect, unnecessary_operation, double_parens)]\n #[deny(identity_op)]\n fn main() {\n     let x = 0;"}, {"sha": "789425e71fe41ed56dfc998043bd511f2111620f", "filename": "tests/compile-fail/reference.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Freference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d78485a81c06a621f607f3e772add628c892b13/tests%2Fcompile-fail%2Freference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Freference.rs?ref=5d78485a81c06a621f607f3e772add628c892b13", "patch": "@@ -9,7 +9,7 @@ fn get_reference(n : &usize) -> &usize {\n     n\n }\n \n-#[allow(many_single_char_names)]\n+#[allow(many_single_char_names, double_parens)]\n #[allow(unused_variables)]\n #[deny(deref_addrof)]\n fn main() {"}]}