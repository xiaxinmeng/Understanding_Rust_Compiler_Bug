{"sha": "52b563b28361d49eb455725f319500f7afa362d9", "node_id": "C_kwDOAAsO6NoAKDUyYjU2M2IyODM2MWQ0OWViNDU1NzI1ZjMxOTUwMGY3YWZhMzYyZDk", "commit": {"author": {"name": "Tianyi Song", "email": "42670338+tysg@users.noreply.github.com", "date": "2022-03-27T13:48:15Z"}, "committer": {"name": "Tianyi Song", "email": "42670338+tysg@users.noreply.github.com", "date": "2022-03-27T13:49:38Z"}, "message": "Emit lint when rhs is negative", "tree": {"sha": "a6c4657659f251dcfb0c969a9810430f45f0bbba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6c4657659f251dcfb0c969a9810430f45f0bbba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52b563b28361d49eb455725f319500f7afa362d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52b563b28361d49eb455725f319500f7afa362d9", "html_url": "https://github.com/rust-lang/rust/commit/52b563b28361d49eb455725f319500f7afa362d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52b563b28361d49eb455725f319500f7afa362d9/comments", "author": {"login": "tysg", "id": 42670338, "node_id": "MDQ6VXNlcjQyNjcwMzM4", "avatar_url": "https://avatars.githubusercontent.com/u/42670338?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tysg", "html_url": "https://github.com/tysg", "followers_url": "https://api.github.com/users/tysg/followers", "following_url": "https://api.github.com/users/tysg/following{/other_user}", "gists_url": "https://api.github.com/users/tysg/gists{/gist_id}", "starred_url": "https://api.github.com/users/tysg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tysg/subscriptions", "organizations_url": "https://api.github.com/users/tysg/orgs", "repos_url": "https://api.github.com/users/tysg/repos", "events_url": "https://api.github.com/users/tysg/events{/privacy}", "received_events_url": "https://api.github.com/users/tysg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tysg", "id": 42670338, "node_id": "MDQ6VXNlcjQyNjcwMzM4", "avatar_url": "https://avatars.githubusercontent.com/u/42670338?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tysg", "html_url": "https://github.com/tysg", "followers_url": "https://api.github.com/users/tysg/followers", "following_url": "https://api.github.com/users/tysg/following{/other_user}", "gists_url": "https://api.github.com/users/tysg/gists{/gist_id}", "starred_url": "https://api.github.com/users/tysg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tysg/subscriptions", "organizations_url": "https://api.github.com/users/tysg/orgs", "repos_url": "https://api.github.com/users/tysg/repos", "events_url": "https://api.github.com/users/tysg/events{/privacy}", "received_events_url": "https://api.github.com/users/tysg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a944ccb67745106a434b9708d010a156acda4d21", "url": "https://api.github.com/repos/rust-lang/rust/commits/a944ccb67745106a434b9708d010a156acda4d21", "html_url": "https://github.com/rust-lang/rust/commit/a944ccb67745106a434b9708d010a156acda4d21"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "4d6bef89bea7f09cbbfa8f618b4d26b871e371b6", "filename": "clippy_lints/src/identity_op.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/52b563b28361d49eb455725f319500f7afa362d9/clippy_lints%2Fsrc%2Fidentity_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52b563b28361d49eb455725f319500f7afa362d9/clippy_lints%2Fsrc%2Fidentity_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fidentity_op.rs?ref=52b563b28361d49eb455725f319500f7afa362d9", "patch": "@@ -54,7 +54,7 @@ impl<'tcx> LateLintPass<'tcx> for IdentityOp {\n                     check(cx, left, -1, e.span, right.span);\n                     check(cx, right, -1, e.span, left.span);\n                 },\n-                BinOpKind::Rem => check_modulo(cx, left, right, e.span, left.span),\n+                BinOpKind::Rem => check_remainder(cx, left, right, e.span, left.span),\n                 _ => (),\n             }\n         }\n@@ -71,11 +71,11 @@ fn is_allowed(cx: &LateContext<'_>, cmp: BinOp, left: &Expr<'_>, right: &Expr<'_\n             && constant_simple(cx, cx.typeck_results(), left) == Some(Constant::Int(1)))\n }\n \n-fn check_modulo(cx: &LateContext<'_>, left: &Expr<'_>, right: &Expr<'_>, span: Span, arg: Span) {\n+fn check_remainder(cx: &LateContext<'_>, left: &Expr<'_>, right: &Expr<'_>, span: Span, arg: Span) {\n     let lhs_const = constant_full_int(cx, cx.typeck_results(), left);\n     let rhs_const = constant_full_int(cx, cx.typeck_results(), right);\n     if match (lhs_const, rhs_const) {\n-        (Some(FullInt::S(lv)), Some(FullInt::S(rv))) => lv.abs() < rv,\n+        (Some(FullInt::S(lv)), Some(FullInt::S(rv))) => lv.abs() < rv.abs(),\n         (Some(FullInt::U(lv)), Some(FullInt::U(rv))) => lv < rv,\n         _ => return,\n     } {"}, {"sha": "edc3fe1aec13a556fa0c8c2121a1639553c57952", "filename": "tests/ui/identity_op.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/52b563b28361d49eb455725f319500f7afa362d9/tests%2Fui%2Fidentity_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52b563b28361d49eb455725f319500f7afa362d9/tests%2Fui%2Fidentity_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fidentity_op.rs?ref=52b563b28361d49eb455725f319500f7afa362d9", "patch": "@@ -69,7 +69,10 @@ fn main() {\n \n     2 % 3;\n     -2 % 3;\n+    2 % -3 + x;\n+    -2 % -3 + x;\n     x + 1 % 3;\n     (x + 1) % 3; // no error\n     4 % 3; // no error\n+    4 % -3; // no error\n }"}, {"sha": "706f01a3dd6c403b245ca8568cdb624def8f943a", "filename": "tests/ui/identity_op.stderr", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/52b563b28361d49eb455725f319500f7afa362d9/tests%2Fui%2Fidentity_op.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/52b563b28361d49eb455725f319500f7afa362d9/tests%2Fui%2Fidentity_op.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fidentity_op.stderr?ref=52b563b28361d49eb455725f319500f7afa362d9", "patch": "@@ -90,11 +90,23 @@ error: the operation is ineffective. Consider reducing it to `-2`\n LL |     -2 % 3;\n    |     ^^^^^^\n \n+error: the operation is ineffective. Consider reducing it to `2`\n+  --> $DIR/identity_op.rs:72:5\n+   |\n+LL |     2 % -3 + x;\n+   |     ^^^^^^\n+\n+error: the operation is ineffective. Consider reducing it to `-2`\n+  --> $DIR/identity_op.rs:73:5\n+   |\n+LL |     -2 % -3 + x;\n+   |     ^^^^^^^\n+\n error: the operation is ineffective. Consider reducing it to `1`\n-  --> $DIR/identity_op.rs:72:9\n+  --> $DIR/identity_op.rs:74:9\n    |\n LL |     x + 1 % 3;\n    |         ^^^^^\n \n-error: aborting due to 16 previous errors\n+error: aborting due to 18 previous errors\n "}]}