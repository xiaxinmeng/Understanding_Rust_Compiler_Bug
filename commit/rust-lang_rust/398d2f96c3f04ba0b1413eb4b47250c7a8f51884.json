{"sha": "398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5OGQyZjk2YzNmMDRiYTBiMTQxM2ViNGI0NzI1MGM3YThmNTE4ODQ=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-01-01T16:00:40Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2021-01-09T18:11:52Z"}, "message": "Add support for edition 2021.", "tree": {"sha": "3d3d42dc89dd07e5bee82557c6cb91123e5da859", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d3d42dc89dd07e5bee82557c6cb91123e5da859"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "html_url": "https://github.com/rust-lang/rust/commit/398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8e0d00377a77a721c2bae4cf64ce3d5bfcccc42", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8e0d00377a77a721c2bae4cf64ce3d5bfcccc42", "html_url": "https://github.com/rust-lang/rust/commit/d8e0d00377a77a721c2bae4cf64ce3d5bfcccc42"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "e9035c6ff24ddde60e616e12431daa0bb3704112", "filename": "Configurations.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/Configurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/Configurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Configurations.md?ref=398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "patch": "@@ -497,8 +497,8 @@ Don't reformat anything\n \n Specifies which edition is used by the parser.\n \n-- **Default value**: `2015`\n-- **Possible values**: `2015`, `2018`\n+- **Default value**: `\"2015\"`\n+- **Possible values**: `\"2015\"`, `\"2018\"`, `\"2021\"`\n - **Stable**: Yes\n \n Rustfmt is able to pick up the edition used by reading the `Cargo.toml` file if executed"}, {"sha": "e7a6c414354357599ee7f11983c1e6879ef323bc", "filename": "src/config/options.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fconfig%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fconfig%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig%2Foptions.rs?ref=398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "patch": "@@ -388,6 +388,10 @@ pub enum Edition {\n     #[doc_hint = \"2018\"]\n     /// Edition 2018.\n     Edition2018,\n+    #[value = \"2021\"]\n+    #[doc_hint = \"2021\"]\n+    /// Edition 2021.\n+    Edition2021,\n }\n \n impl Default for Edition {\n@@ -396,15 +400,22 @@ impl Default for Edition {\n     }\n }\n \n-impl Edition {\n-    pub(crate) fn to_libsyntax_pos_edition(self) -> rustc_span::edition::Edition {\n-        match self {\n-            Edition::Edition2015 => rustc_span::edition::Edition::Edition2015,\n-            Edition::Edition2018 => rustc_span::edition::Edition::Edition2018,\n+impl From<Edition> for rustc_span::edition::Edition {\n+    fn from(edition: Edition) -> Self {\n+        match edition {\n+            Edition::Edition2015 => Self::Edition2015,\n+            Edition::Edition2018 => Self::Edition2018,\n+            Edition::Edition2021 => Self::Edition2021,\n         }\n     }\n }\n \n+impl PartialOrd for Edition {\n+    fn partial_cmp(&self, other: &Edition) -> Option<std::cmp::Ordering> {\n+        rustc_span::edition::Edition::partial_cmp(&(*self).into(), &(*other).into())\n+    }\n+}\n+\n /// Controls how rustfmt should handle leading pipes on match arms.\n #[config_type]\n pub enum MatchArmLeadingPipe {"}, {"sha": "289e58cf693f0a01707800b69ce17fbc650a9b8c", "filename": "src/formatting.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fformatting.rs?ref=398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "patch": "@@ -34,7 +34,7 @@ impl<'b, T: Write + 'b> Session<'b, T> {\n             return Err(ErrorKind::VersionMismatch);\n         }\n \n-        rustc_span::with_session_globals(self.config.edition().to_libsyntax_pos_edition(), || {\n+        rustc_span::with_session_globals(self.config.edition().into(), || {\n             if self.config.disable_all_formatting() {\n                 // When the input is from stdin, echo back the input.\n                 if let Input::Text(ref buf) = input {"}, {"sha": "d7082d50f88ad700d3f549e164a82230eaefb30a", "filename": "src/imports.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/398d2f96c3f04ba0b1413eb4b47250c7a8f51884/src%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fimports.rs?ref=398d2f96c3f04ba0b1413eb4b47250c7a8f51884", "patch": "@@ -331,7 +331,7 @@ impl UseTree {\n         };\n \n         let leading_modsep =\n-            context.config.edition() == Edition::Edition2018 && a.prefix.is_global();\n+            context.config.edition() >= Edition::Edition2018 && a.prefix.is_global();\n \n         let mut modsep = leading_modsep;\n "}]}