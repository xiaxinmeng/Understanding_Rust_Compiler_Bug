{"sha": "ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlNDVkNTRhNGUxNGM4YWU4MDliMGI2YzMxMTEyNjBhM2YzOWJhNDA=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-07-01T08:48:32Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-07-01T10:39:57Z"}, "message": "Move autoderefed_ty to ty.rs and rename it type_autoderef.", "tree": {"sha": "aca2b653665b3568da1da2354d6265d8a3f40213", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aca2b653665b3568da1da2354d6265d8a3f40213"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "html_url": "https://github.com/rust-lang/rust/commit/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4465aca5ab22447dde52a4a7083d6e3d29e56e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4465aca5ab22447dde52a4a7083d6e3d29e56e2", "html_url": "https://github.com/rust-lang/rust/commit/b4465aca5ab22447dde52a4a7083d6e3d29e56e2"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "89b147bd4736d3f7bdb40887a63c1e6d3af84539", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 3, "deletions": 14, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "patch": "@@ -3367,7 +3367,7 @@ fn trans_compare(&@block_ctxt cx0, ast::binop op, &ty::t t0, ValueRef lhs0,\n     auto rhs_r = autoderef(cx, rhs0, t0);\n     auto rhs = rhs_r.val;\n     cx = rhs_r.bcx;\n-    auto t = autoderefed_ty(cx.fcx.lcx.ccx, t0);\n+    auto t = ty::type_autoderef(cx.fcx.lcx.ccx.tcx, t0);\n     // Determine the operation we need.\n     // FIXME: Use or-patterns when we have them.\n \n@@ -4126,17 +4126,6 @@ fn autoderef(&@block_ctxt cx, ValueRef v, &ty::t t) -> result {\n     ret rslt(cx, v1);\n }\n \n-fn autoderefed_ty(&@crate_ctxt ccx, &ty::t t) -> ty::t {\n-    let ty::t t1 = t;\n-    while (true) {\n-        alt (ty::struct(ccx.tcx, t1)) {\n-            case (ty::ty_box(?mt)) { t1 = mt.ty; }\n-            case (_) { break; }\n-        }\n-    }\n-    ret t1;\n-}\n-\n fn trans_binary(&@block_ctxt cx, ast::binop op, &@ast::expr a, &@ast::expr b)\n    -> result {\n \n@@ -4199,7 +4188,7 @@ fn trans_binary(&@block_ctxt cx, ast::binop op, &@ast::expr a, &@ast::expr b)\n             auto rhty = ty::expr_ty(cx.fcx.lcx.ccx.tcx, b);\n             rhs = autoderef(rhs.bcx, rhs.val, rhty);\n             ret trans_eager_binop(rhs.bcx, op,\n-                                  autoderefed_ty(cx.fcx.lcx.ccx, lhty),\n+                                  ty::type_autoderef(cx.fcx.lcx.ccx.tcx,lhty),\n                                   lhs.val, rhs.val);\n         }\n     }\n@@ -4910,7 +4899,7 @@ fn trans_path(&@block_ctxt cx, &ast::path p, ast::node_id id) -> lval_result {\n fn trans_field(&@block_ctxt cx, &span sp, ValueRef v, &ty::t t0,\n                &ast::ident field, ast::node_id id) -> lval_result {\n     auto r = autoderef(cx, v, t0);\n-    auto t = autoderefed_ty(cx.fcx.lcx.ccx, t0);\n+    auto t = ty::type_autoderef(cx.fcx.lcx.ccx.tcx, t0);\n     alt (ty::struct(cx.fcx.lcx.ccx.tcx, t)) {\n         case (ty::ty_tup(_)) {\n             let uint ix = ty::field_num(cx.fcx.lcx.ccx.sess, sp, field);"}, {"sha": "a1f006c64ccc58794a2ef13be300b6c6fa2562f8", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee45d54a4e14c8ae809b0b6c3111260a3f39ba40/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=ee45d54a4e14c8ae809b0b6c3111260a3f39ba40", "patch": "@@ -176,6 +176,7 @@ export type_is_copyable;\n export type_is_tup_like;\n export type_is_str;\n export type_owns_heap_mem;\n+export type_autoderef;\n export type_param;\n export def_to_str;\n export unify;\n@@ -1281,6 +1282,17 @@ fn type_param(&ctxt cx, &t ty) -> option::t[uint] {\n     ret none[uint];\n }\n \n+fn type_autoderef(&ctxt cx, &ty::t t) -> ty::t {\n+    let ty::t t1 = t;\n+    while (true) {\n+        alt (struct(cx, t1)) {\n+            case (ty::ty_box(?mt)) { t1 = mt.ty; }\n+            case (_) { break; }\n+        }\n+    }\n+    ret t1;\n+}\n+\n fn def_to_str(&ast::def_id did) -> str { ret #fmt(\"%d:%d\", did._0, did._1); }\n \n "}]}