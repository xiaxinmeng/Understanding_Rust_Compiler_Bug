{"sha": "45568bdaf7898e29d6a7a721c9a1937fbb2dba55", "node_id": "C_kwDOAAsO6NoAKDQ1NTY4YmRhZjc4OThlMjlkNmE3YTcyMWM5YTE5MzdmYmIyZGJhNTU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-20T17:32:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-20T17:32:12Z"}, "message": "Rollup merge of #100693 - scottmcm:new-llvm15-nops, r=Mark-Simulacrum\n\nAdd LLVM15-specific codegen test for `try`/`?`s that now optimize away\n\nThese still generated a bunch of code back in Rust 1.63 (<https://rust.godbolt.org/z/z31P8h6rz>), but with LLVM 15 merged they no longer do \ud83c\udf89", "tree": {"sha": "a15da88b2ab6fb37b5f4f10235b1d92656f45993", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a15da88b2ab6fb37b5f4f10235b1d92656f45993"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/45568bdaf7898e29d6a7a721c9a1937fbb2dba55", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjARqcCRBK7hj4Ov3rIwAASQgIAK8lQXnzGdyYAVDOwXmffyVw\nI+Edub54bVNGi8XHLjoymvobEkiYyF2PdVukDC4sLCMVtET4E/4tDp+oyY2ZS7U5\n7lVz1WwIf98/joN8SKVJYqs8XKC+e9DNFSUIljXMoYppHzNdUfCdauoV3xH/HO/i\nWAj9l7yNj5vOCZPGBYsTaxYtMkmbreotWJekXZUBA4p2OrDNHFxPnZL4retEUkvl\n9Jsx4rRsRTxnfvucO+YCDOSJuPcBmL8nNbkLR8+5DIgNc6AJuWDdcJ9WZDwavqbY\n++i8oZALwSAK+gfjHmpf/IHOOxStuR58ymYay44LCCAiusNNcr6MWD+US/hB42g=\n=F0/v\n-----END PGP SIGNATURE-----\n", "payload": "tree a15da88b2ab6fb37b5f4f10235b1d92656f45993\nparent 51769af6ea04a823c94b9374ee0058ae3ac4c4e4\nparent 5145c970871e2dbe37228280fe34decd8c26ea4e\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1661016732 +0200\ncommitter GitHub <noreply@github.com> 1661016732 +0200\n\nRollup merge of #100693 - scottmcm:new-llvm15-nops, r=Mark-Simulacrum\n\nAdd LLVM15-specific codegen test for `try`/`?`s that now optimize away\n\nThese still generated a bunch of code back in Rust 1.63 (<https://rust.godbolt.org/z/z31P8h6rz>), but with LLVM 15 merged they no longer do \ud83c\udf89\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/45568bdaf7898e29d6a7a721c9a1937fbb2dba55", "html_url": "https://github.com/rust-lang/rust/commit/45568bdaf7898e29d6a7a721c9a1937fbb2dba55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/45568bdaf7898e29d6a7a721c9a1937fbb2dba55/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51769af6ea04a823c94b9374ee0058ae3ac4c4e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/51769af6ea04a823c94b9374ee0058ae3ac4c4e4", "html_url": "https://github.com/rust-lang/rust/commit/51769af6ea04a823c94b9374ee0058ae3ac4c4e4"}, {"sha": "5145c970871e2dbe37228280fe34decd8c26ea4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5145c970871e2dbe37228280fe34decd8c26ea4e", "html_url": "https://github.com/rust-lang/rust/commit/5145c970871e2dbe37228280fe34decd8c26ea4e"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "d239387768e6b9fec95d21dc86b0fad4908b0e0d", "filename": "src/test/codegen/try_question_mark_nop.rs", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/45568bdaf7898e29d6a7a721c9a1937fbb2dba55/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45568bdaf7898e29d6a7a721c9a1937fbb2dba55/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs?ref=45568bdaf7898e29d6a7a721c9a1937fbb2dba55", "patch": "@@ -0,0 +1,54 @@\n+// min-llvm-version: 15.0\n+// compile-flags: -O -Z merge-functions=disabled --edition=2021\n+// only-x86_64\n+\n+#![crate_type = \"lib\"]\n+#![feature(try_blocks)]\n+\n+// These are now NOPs in LLVM 15, presumably thanks to nikic's change mentioned in\n+// <https://github.com/rust-lang/rust/issues/85133#issuecomment-1072168354>.\n+// Unfortunately, as of 2022-08-17 they're not yet nops for `u64`s nor `Option`.\n+\n+use std::ops::ControlFlow::{self, Continue, Break};\n+\n+// CHECK-LABEL: @result_nop_match_32\n+#[no_mangle]\n+pub fn result_nop_match_32(x: Result<i32, u32>) -> Result<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    match x {\n+        Ok(x) => Ok(x),\n+        Err(x) => Err(x),\n+    }\n+}\n+\n+// CHECK-LABEL: @result_nop_traits_32\n+#[no_mangle]\n+pub fn result_nop_traits_32(x: Result<i32, u32>) -> Result<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    try {\n+        x?\n+    }\n+}\n+\n+// CHECK-LABEL: @control_flow_nop_match_32\n+#[no_mangle]\n+pub fn control_flow_nop_match_32(x: ControlFlow<i32, u32>) -> ControlFlow<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    match x {\n+        Continue(x) => Continue(x),\n+        Break(x) => Break(x),\n+    }\n+}\n+\n+// CHECK-LABEL: @control_flow_nop_traits_32\n+#[no_mangle]\n+pub fn control_flow_nop_traits_32(x: ControlFlow<i32, u32>) -> ControlFlow<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    try {\n+        x?\n+    }\n+}"}]}