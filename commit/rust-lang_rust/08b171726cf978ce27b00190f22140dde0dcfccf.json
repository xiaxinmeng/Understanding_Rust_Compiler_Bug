{"sha": "08b171726cf978ce27b00190f22140dde0dcfccf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4YjE3MTcyNmNmOTc4Y2UyN2IwMDE5MGYyMjE0MGRkZTBkY2ZjY2Y=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-12-01T10:50:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-01T10:50:10Z"}, "message": "Rollup merge of #79184 - nanguye2496:nanguye2496/fix_slice_and_str_type_name, r=varkor\n\nStop adding '*' at the end of slice and str typenames for MSVC case\n\nWhen computing debug info for MSVC debuggers, Rust compiler emits C++ style type names for compatibility with .natvis visualizers. All Ref types are treated as equivalences of C++ pointers in this process, and, as a result, their type names end with a '\\*'. Since Slice and Str are treated as Ref by the compiler, their type names also end with a '\\*'. This causes the .natvis engine for WinDbg fails to display data of Slice and Str objects. We addressed this problem simply by removing the '*' at the end of type names for Slice and Str types.\n\nDebug info in WinDbg before the fix:\n![image](https://user-images.githubusercontent.com/74681961/99594120-9a4dcf80-29a7-11eb-8cce-aedaf1da6d21.png)\n\nDebug info in WinDbg after the fix:\n![image](https://user-images.githubusercontent.com/74681961/99597173-717c0900-29ac-11eb-861e-98143a9177cf.png)\n\nThis change has also been tested with debuggers for Visual Studio, VS Code C++ and VS Code LLDB to make sure that it does not affect the behavior of other kinds of debugger.", "tree": {"sha": "8680adba01c90174a047a950bb6aeb8a87e0b33f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8680adba01c90174a047a950bb6aeb8a87e0b33f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08b171726cf978ce27b00190f22140dde0dcfccf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfxh/iCRBK7hj4Ov3rIwAAdHIIAGmCMvmLFL4PGygjq7o2KDK8\nMnCbFlP+Kr62P+nHLwgtvlGYAjcoHIrTTO3BRjlLQFnDDVwgmd/ZxJ3jnkQC3FPJ\nLLQg0Z3iGP7aF1pwGBSthRjjemKxZGckR6XRBBuF8to/kr1aMvdRfTXGBB8peT1C\n0NODv+nO8E/pYTwDcMw7nvtQeQHNokeQggZaKjJ762J9wnseOsWAPusETf92e+Cy\nTKbP05YTSKs3gcqX/02KCRE/Y3hx19b06BzLSuxzZZFWa/bxSRvkB67G4F4YenF9\n/vq4QK/3olYqFHbHXFssGTguz5M6j6c/WzUy2K3GlCb+wpKELY7IcStFFlekOfA=\n=9OGG\n-----END PGP SIGNATURE-----\n", "payload": "tree 8680adba01c90174a047a950bb6aeb8a87e0b33f\nparent b565fe241e9a3a29d725468fdf8da65622665444\nparent 36e6aa0aa686049736810d7444c1bfca8e14d38d\nauthor Mara Bos <m-ou.se@m-ou.se> 1606819810 +0000\ncommitter GitHub <noreply@github.com> 1606819810 +0000\n\nRollup merge of #79184 - nanguye2496:nanguye2496/fix_slice_and_str_type_name, r=varkor\n\nStop adding '*' at the end of slice and str typenames for MSVC case\n\nWhen computing debug info for MSVC debuggers, Rust compiler emits C++ style type names for compatibility with .natvis visualizers. All Ref types are treated as equivalences of C++ pointers in this process, and, as a result, their type names end with a '\\*'. Since Slice and Str are treated as Ref by the compiler, their type names also end with a '\\*'. This causes the .natvis engine for WinDbg fails to display data of Slice and Str objects. We addressed this problem simply by removing the '*' at the end of type names for Slice and Str types.\n\nDebug info in WinDbg before the fix:\n![image](https://user-images.githubusercontent.com/74681961/99594120-9a4dcf80-29a7-11eb-8cce-aedaf1da6d21.png)\n\nDebug info in WinDbg after the fix:\n![image](https://user-images.githubusercontent.com/74681961/99597173-717c0900-29ac-11eb-861e-98143a9177cf.png)\n\nThis change has also been tested with debuggers for Visual Studio, VS Code C++ and VS Code LLDB to make sure that it does not affect the behavior of other kinds of debugger.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08b171726cf978ce27b00190f22140dde0dcfccf", "html_url": "https://github.com/rust-lang/rust/commit/08b171726cf978ce27b00190f22140dde0dcfccf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08b171726cf978ce27b00190f22140dde0dcfccf/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b565fe241e9a3a29d725468fdf8da65622665444", "url": "https://api.github.com/repos/rust-lang/rust/commits/b565fe241e9a3a29d725468fdf8da65622665444", "html_url": "https://github.com/rust-lang/rust/commit/b565fe241e9a3a29d725468fdf8da65622665444"}, {"sha": "36e6aa0aa686049736810d7444c1bfca8e14d38d", "url": "https://api.github.com/repos/rust-lang/rust/commits/36e6aa0aa686049736810d7444c1bfca8e14d38d", "html_url": "https://github.com/rust-lang/rust/commit/36e6aa0aa686049736810d7444c1bfca8e14d38d"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "d1bbf74307c6bd1f7b8dbff0783e1f1ced5dfab6", "filename": "compiler/rustc_codegen_ssa/src/debuginfo/type_names.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/08b171726cf978ce27b00190f22140dde0dcfccf/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08b171726cf978ce27b00190f22140dde0dcfccf/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs?ref=08b171726cf978ce27b00190f22140dde0dcfccf", "patch": "@@ -94,7 +94,14 @@ pub fn push_debuginfo_type_name<'tcx>(\n             push_debuginfo_type_name(tcx, inner_type, true, output, visited);\n \n             if cpp_like_names {\n-                output.push('*');\n+                // Slices and `&str` are treated like C++ pointers when computing debug\n+                // info for MSVC debugger. However, adding '*' at the end of these types' names\n+                // causes the .natvis engine for WinDbg to fail to display their data, so we opt these\n+                // types out to aid debugging in MSVC.\n+                match *inner_type.kind() {\n+                    ty::Slice(_) | ty::Str => {}\n+                    _ => output.push('*'),\n+                }\n             }\n         }\n         ty::Array(inner_type, len) => {"}]}