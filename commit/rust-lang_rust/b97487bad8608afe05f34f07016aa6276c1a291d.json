{"sha": "b97487bad8608afe05f34f07016aa6276c1a291d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NzQ4N2JhZDg2MDhhZmUwNWYzNGYwNzAxNmFhNjI3NmMxYTI5MWQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-05-30T13:36:42Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-05-30T13:36:42Z"}, "message": "Add check for doc alias attribute format", "tree": {"sha": "9f2558d5d94925b2776ba8c81720ad0b3a9a6fac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f2558d5d94925b2776ba8c81720ad0b3a9a6fac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b97487bad8608afe05f34f07016aa6276c1a291d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b97487bad8608afe05f34f07016aa6276c1a291d", "html_url": "https://github.com/rust-lang/rust/commit/b97487bad8608afe05f34f07016aa6276c1a291d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b97487bad8608afe05f34f07016aa6276c1a291d/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "698c5c6d95218735afebdada8a518ab66e0e9213", "url": "https://api.github.com/repos/rust-lang/rust/commits/698c5c6d95218735afebdada8a518ab66e0e9213", "html_url": "https://github.com/rust-lang/rust/commit/698c5c6d95218735afebdada8a518ab66e0e9213"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "4f99476ebfa556d557ab1d77d38ab3f3e4ef537d", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/b97487bad8608afe05f34f07016aa6276c1a291d/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b97487bad8608afe05f34f07016aa6276c1a291d/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=b97487bad8608afe05f34f07016aa6276c1a291d", "patch": "@@ -481,6 +481,33 @@ impl Attributes {\n         })\n     }\n \n+    /// Enforce the format of attributes inside `#[doc(...)]`.\n+    pub fn check_doc_attributes(\n+        diagnostic: &::rustc_errors::Handler,\n+        mi: &ast::MetaItem,\n+    ) -> Option<(String, String)> {\n+        mi.meta_item_list().and_then(|list| {\n+            for meta in list {\n+                if meta.check_name(sym::alias) {\n+                    if !meta.is_value_str()\n+                        || meta\n+                            .value_str()\n+                            .map(|s| s.to_string())\n+                            .unwrap_or_else(String::new)\n+                            .is_empty()\n+                    {\n+                        diagnostic.span_err(\n+                            meta.span(),\n+                            \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+                        );\n+                    }\n+                }\n+            }\n+\n+            None\n+        })\n+    }\n+\n     pub fn has_doc_flag(&self, flag: Symbol) -> bool {\n         for attr in &self.other_attrs {\n             if !attr.check_name(sym::doc) {\n@@ -524,6 +551,7 @@ impl Attributes {\n                 } else {\n                     if attr.check_name(sym::doc) {\n                         if let Some(mi) = attr.meta() {\n+                            Attributes::check_doc_attributes(&diagnostic, &mi);\n                             if let Some(cfg_mi) = Attributes::extract_cfg(&mi) {\n                                 // Extracted #[doc(cfg(...))]\n                                 match Cfg::parse(cfg_mi) {"}]}