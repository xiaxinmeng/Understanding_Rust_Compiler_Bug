{"sha": "61d9231ff2604a0467987042d9ebf9ff9ea739b5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxZDkyMzFmZjI2MDRhMDQ2Nzk4NzA0MmQ5ZWJmOWZmOWVhNzM5YjU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-15T13:48:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-15T13:48:53Z"}, "message": "Auto merge of #69168 - brainlock:test-textrel-regression, r=Mark-Simulacrum,tmandry\n\nadd regression test for issue #68794\n\nThis is a minimal regression test for the issue #68794: \"TEXTREL in\ni686\", which was fixed with e86019c4a0968a1e393cdd0731649168624a88b8.\n\nThe test links a minimal rust static library into a shared library, and\nchecks that the linker didn't have to add the TEXTREL flag.", "tree": {"sha": "a14cc2fd8d25a18ab6f5351ea53d3a73023429d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a14cc2fd8d25a18ab6f5351ea53d3a73023429d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61d9231ff2604a0467987042d9ebf9ff9ea739b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61d9231ff2604a0467987042d9ebf9ff9ea739b5", "html_url": "https://github.com/rust-lang/rust/commit/61d9231ff2604a0467987042d9ebf9ff9ea739b5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61d9231ff2604a0467987042d9ebf9ff9ea739b5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbef35309d10bed2f09cd55b3e9ea980a58c62aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbef35309d10bed2f09cd55b3e9ea980a58c62aa", "html_url": "https://github.com/rust-lang/rust/commit/dbef35309d10bed2f09cd55b3e9ea980a58c62aa"}, {"sha": "ea2ffda44e0c38854dbe63c786a194dd35559545", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea2ffda44e0c38854dbe63c786a194dd35559545", "html_url": "https://github.com/rust-lang/rust/commit/ea2ffda44e0c38854dbe63c786a194dd35559545"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "2f16ad3285994be2b55c6134069d893f04227f07", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/Makefile", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2FMakefile?ref=61d9231ff2604a0467987042d9ebf9ff9ea739b5", "patch": "@@ -0,0 +1,17 @@\n+# Regression test for issue #68794\n+#\n+# Verify that no text relocations are accidentally introduced by linking a\n+# minimal rust staticlib.\n+#\n+# The test links a rust static library into a shared library, and checks that\n+# the linker doesn't have to flag the resulting file as containing TEXTRELs.\n+\n+-include ../tools.mk\n+\n+# only-linux\n+\n+all:\n+\t$(RUSTC) foo.rs\n+\t$(CC) bar.c $(call STATICLIB,foo) -fPIC -shared -o $(call DYLIB,bar) \\\n+\t\t$(EXTRACFLAGS) $(EXTRACXXFLAGS)\n+\treadelf -d $(call DYLIB,bar) | grep TEXTREL; test $$? -eq 1"}, {"sha": "bb4036b06e13b79a32ec78ae04db97590f54b2cc", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/bar.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c", "raw_url": "https://github.com/rust-lang/rust/raw/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Fbar.c?ref=61d9231ff2604a0467987042d9ebf9ff9ea739b5", "patch": "@@ -0,0 +1,6 @@\n+void foo();\n+\n+int main() {\n+    foo();\n+    return 0;\n+}"}, {"sha": "a3e865b638ed44fa2f7a17f1d540ef029e6cc2c3", "filename": "src/test/run-make-fulldeps/issue-68794-textrel-on-minimal-lib/foo.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61d9231ff2604a0467987042d9ebf9ff9ea739b5/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-68794-textrel-on-minimal-lib%2Ffoo.rs?ref=61d9231ff2604a0467987042d9ebf9ff9ea739b5", "patch": "@@ -0,0 +1,8 @@\n+#![crate_type = \"staticlib\"]\n+\n+#[no_mangle]\n+pub extern \"C\" fn foo(x: u32) {\n+    // using the println! makes it so that enough code from the standard\n+    // library is included (see issue #68794)\n+    println!(\"foo: {}\", x);\n+}"}]}