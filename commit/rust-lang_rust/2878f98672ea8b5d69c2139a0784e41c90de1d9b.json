{"sha": "2878f98672ea8b5d69c2139a0784e41c90de1d9b", "node_id": "C_kwDOAAsO6NoAKDI4NzhmOTg2NzJlYThiNWQ2OWMyMTM5YTA3ODRlNDFjOTBkZTFkOWI", "commit": {"author": {"name": "yungkneez", "email": "brendonfederko@outlook.com", "date": "2022-04-27T00:01:40Z"}, "committer": {"name": "yungkneez", "email": "brendonfederko@outlook.com", "date": "2022-05-02T00:36:39Z"}, "message": "Initialize rust-analyzer submodule on bootstrap", "tree": {"sha": "f0d0c6c37fe0209d4a3d79cf26b9a86ac10a4480", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f0d0c6c37fe0209d4a3d79cf26b9a86ac10a4480"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2878f98672ea8b5d69c2139a0784e41c90de1d9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2878f98672ea8b5d69c2139a0784e41c90de1d9b", "html_url": "https://github.com/rust-lang/rust/commit/2878f98672ea8b5d69c2139a0784e41c90de1d9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2878f98672ea8b5d69c2139a0784e41c90de1d9b/comments", "author": {"login": "yungkneez", "id": 58558962, "node_id": "MDQ6VXNlcjU4NTU4OTYy", "avatar_url": "https://avatars.githubusercontent.com/u/58558962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yungkneez", "html_url": "https://github.com/yungkneez", "followers_url": "https://api.github.com/users/yungkneez/followers", "following_url": "https://api.github.com/users/yungkneez/following{/other_user}", "gists_url": "https://api.github.com/users/yungkneez/gists{/gist_id}", "starred_url": "https://api.github.com/users/yungkneez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yungkneez/subscriptions", "organizations_url": "https://api.github.com/users/yungkneez/orgs", "repos_url": "https://api.github.com/users/yungkneez/repos", "events_url": "https://api.github.com/users/yungkneez/events{/privacy}", "received_events_url": "https://api.github.com/users/yungkneez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yungkneez", "id": 58558962, "node_id": "MDQ6VXNlcjU4NTU4OTYy", "avatar_url": "https://avatars.githubusercontent.com/u/58558962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yungkneez", "html_url": "https://github.com/yungkneez", "followers_url": "https://api.github.com/users/yungkneez/followers", "following_url": "https://api.github.com/users/yungkneez/following{/other_user}", "gists_url": "https://api.github.com/users/yungkneez/gists{/gist_id}", "starred_url": "https://api.github.com/users/yungkneez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yungkneez/subscriptions", "organizations_url": "https://api.github.com/users/yungkneez/orgs", "repos_url": "https://api.github.com/users/yungkneez/repos", "events_url": "https://api.github.com/users/yungkneez/events{/privacy}", "received_events_url": "https://api.github.com/users/yungkneez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "082e4ca49770ebc9cb0ee616f3726a67471be8cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/082e4ca49770ebc9cb0ee616f3726a67471be8cb", "html_url": "https://github.com/rust-lang/rust/commit/082e4ca49770ebc9cb0ee616f3726a67471be8cb"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "b94335b16a2d2464f9cf5dfd949bc48d02641426", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2878f98672ea8b5d69c2139a0784e41c90de1d9b/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/2878f98672ea8b5d69c2139a0784e41c90de1d9b/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=2878f98672ea8b5d69c2139a0784e41c90de1d9b", "patch": "@@ -1147,6 +1147,10 @@ def update_submodules(self):\n             \"library/backtrace\",\n             \"library/stdarch\"\n         ]\n+        # If build.vendor is set in config.toml, we must update rust-analyzer also.\n+        # Otherwise, the bootstrap will fail (#96456).\n+        if self.use_vendored_sources:\n+            submodules.append(\"src/tools/rust-analyzer\")\n         filtered_submodules = []\n         submodules_names = []\n         for module in submodules:"}, {"sha": "f47398d45d478793aa2149d095c35d39ab22017e", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2878f98672ea8b5d69c2139a0784e41c90de1d9b/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2878f98672ea8b5d69c2139a0784e41c90de1d9b/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=2878f98672ea8b5d69c2139a0784e41c90de1d9b", "patch": "@@ -609,14 +609,19 @@ impl Build {\n     /// This avoids contributors checking in a submodule change by accident.\n     pub fn maybe_update_submodules(&self) {\n         // WARNING: keep this in sync with the submodules hard-coded in bootstrap.py\n-        const BOOTSTRAP_SUBMODULES: &[&str] = &[\n+        let mut bootstrap_submodules: Vec<&str> = vec![\n             \"src/tools/rust-installer\",\n             \"src/tools/cargo\",\n             \"src/tools/rls\",\n             \"src/tools/miri\",\n             \"library/backtrace\",\n             \"library/stdarch\",\n         ];\n+        // As in bootstrap.py, we include `rust-analyzer` if `build.vendor` was set in\n+        // `config.toml`.\n+        if self.config.vendor {\n+            bootstrap_submodules.push(\"src/tools/rust-analyzer\");\n+        }\n         // Avoid running git when there isn't a git checkout.\n         if !self.config.submodules(&self.rust_info) {\n             return;\n@@ -632,7 +637,7 @@ impl Build {\n             // Sample output: `submodule.src/rust-installer.path src/tools/rust-installer`\n             let submodule = Path::new(line.splitn(2, ' ').nth(1).unwrap());\n             // avoid updating submodules twice\n-            if !BOOTSTRAP_SUBMODULES.iter().any(|&p| Path::new(p) == submodule)\n+            if !bootstrap_submodules.iter().any(|&p| Path::new(p) == submodule)\n                 && channel::GitInfo::new(false, submodule).is_git()\n             {\n                 self.update_submodule(submodule);"}]}