{"sha": "e2921d510dca1def06896bf64afc4d80aa73c608", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyOTIxZDUxMGRjYTFkZWYwNjg5NmJmNjRhZmM0ZDgwYWE3M2M2MDg=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-04-06T22:36:29Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-04-06T22:36:29Z"}, "message": "Use crate name/disambiguator instead of SVH for debuginfo typeid.", "tree": {"sha": "7f1bebcbfbc8f5c2c5357af753fa0d420734a4c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f1bebcbfbc8f5c2c5357af753fa0d420734a4c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e2921d510dca1def06896bf64afc4d80aa73c608", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e2921d510dca1def06896bf64afc4d80aa73c608", "html_url": "https://github.com/rust-lang/rust/commit/e2921d510dca1def06896bf64afc4d80aa73c608", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e2921d510dca1def06896bf64afc4d80aa73c608/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655", "url": "https://api.github.com/repos/rust-lang/rust/commits/943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655", "html_url": "https://github.com/rust-lang/rust/commit/943ec3bdfc9ba28e94b6d00a2b53fb2cd8b21655"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "475509495e4f03ed65321d711b4493a0b6d730d8", "filename": "src/librustc_trans/debuginfo/metadata.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e2921d510dca1def06896bf64afc4d80aa73c608/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e2921d510dca1def06896bf64afc4d80aa73c608/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fdebuginfo%2Fmetadata.rs?ref=e2921d510dca1def06896bf64afc4d80aa73c608", "patch": "@@ -324,7 +324,7 @@ impl<'tcx> TypeMap<'tcx> {\n                                             output: &mut String) {\n             // First, find out the 'real' def_id of the type. Items inlined from\n             // other crates have to be mapped back to their source.\n-            let source_def_id = if let Some(node_id) = cx.tcx().map.as_local_node_id(def_id) {\n+            let def_id = if let Some(node_id) = cx.tcx().map.as_local_node_id(def_id) {\n                 match cx.external_srcs().borrow().get(&node_id).cloned() {\n                     Some(source_def_id) => {\n                         // The given def_id identifies the inlined copy of a\n@@ -337,19 +337,21 @@ impl<'tcx> TypeMap<'tcx> {\n                 def_id\n             };\n \n-            // Get the crate hash as first part of the identifier.\n-            let crate_hash = if source_def_id.is_local() {\n-                cx.link_meta().crate_hash.clone()\n+            // Get the crate name/disambiguator as first part of the identifier.\n+            let crate_name = if def_id.is_local() {\n+                cx.tcx().crate_name.clone()\n             } else {\n-                cx.sess().cstore.crate_hash(source_def_id.krate)\n+                cx.sess().cstore.original_crate_name(def_id.krate)\n             };\n+            let crate_disambiguator = cx.tcx().crate_disambiguator(def_id.krate);\n \n-            output.push_str(crate_hash.as_str());\n+            output.push_str(&crate_name[..]);\n             output.push_str(\"/\");\n+            output.push_str(&crate_disambiguator[..]);\n+            output.push_str(\"/\");\n+            // Add the def-index as the second part\n             output.push_str(&format!(\"{:x}\", def_id.index.as_usize()));\n \n-            // Maybe check that there is no self type here.\n-\n             let tps = substs.types.get_slice(subst::TypeSpace);\n             if !tps.is_empty() {\n                 output.push('<');"}]}