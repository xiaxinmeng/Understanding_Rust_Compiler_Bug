{"sha": "09310947be113f4ccae0f6c5a24f6ddf4b611a72", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5MzEwOTQ3YmUxMTNmNGNjYWUwZjZjNWEyNGY2ZGRmNGI2MTFhNzI=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2018-06-21T13:37:35Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2018-06-21T15:00:32Z"}, "message": "Support future deprecation for rustc_deprecated", "tree": {"sha": "7cd48a2d7fc93c5dc6e8ecb54afd3b4a7b5a476b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cd48a2d7fc93c5dc6e8ecb54afd3b4a7b5a476b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09310947be113f4ccae0f6c5a24f6ddf4b611a72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09310947be113f4ccae0f6c5a24f6ddf4b611a72", "html_url": "https://github.com/rust-lang/rust/commit/09310947be113f4ccae0f6c5a24f6ddf4b611a72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09310947be113f4ccae0f6c5a24f6ddf4b611a72/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cca43a7f977963ee497ca091fbdf3cea95abdf47", "url": "https://api.github.com/repos/rust-lang/rust/commits/cca43a7f977963ee497ca091fbdf3cea95abdf47", "html_url": "https://github.com/rust-lang/rust/commit/cca43a7f977963ee497ca091fbdf3cea95abdf47"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "4cdc9fdddbf80b1176de05bdd44b9a26ab91315a", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=09310947be113f4ccae0f6c5a24f6ddf4b611a72", "patch": "@@ -614,10 +614,12 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         debug!(\"stability: \\\n                 inspecting def_id={:?} span={:?} of stability={:?}\", def_id, span, stability);\n \n-        if let Some(&Stability{rustc_depr: Some(attr::RustcDeprecation { reason, .. }), ..})\n+        if let Some(&Stability{rustc_depr: Some(attr::RustcDeprecation { reason, since }), ..})\n                 = stability {\n             if let Some(id) = id {\n-                lint_deprecated(def_id, id, Some(reason));\n+                if deprecation_in_effect(&since.as_str()) {\n+                    lint_deprecated(def_id, id, Some(reason));\n+                }\n             }\n         }\n "}, {"sha": "07e80b61cd0a69cc764a016b88c15c940a9efe3d", "filename": "src/test/compile-fail/auxiliary/lint_stability.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fauxiliary%2Flint_stability.rs?ref=09310947be113f4ccae0f6c5a24f6ddf4b611a72", "patch": "@@ -7,6 +7,7 @@\n // <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n+\n #![crate_name=\"lint_stability\"]\n #![crate_type = \"lib\"]\n #![feature(staged_api)]\n@@ -20,6 +21,10 @@ pub fn deprecated() {}\n #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n pub fn deprecated_text() {}\n \n+#[stable(feature = \"test_feature\", since = \"1.0.0\")]\n+#[rustc_deprecated(since = \"99.99.99\", reason = \"text\")]\n+pub fn deprecated_future() {}\n+\n #[unstable(feature = \"test_feature\", issue = \"0\")]\n #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n pub fn deprecated_unstable() {}"}, {"sha": "bd390108bd8f3c40468fc1e122bae926a345f8c3", "filename": "src/test/compile-fail/lint-stability.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Ftest%2Fcompile-fail%2Flint-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09310947be113f4ccae0f6c5a24f6ddf4b611a72/src%2Ftest%2Fcompile-fail%2Flint-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-stability.rs?ref=09310947be113f4ccae0f6c5a24f6ddf4b611a72", "patch": "@@ -50,6 +50,8 @@ mod cross_crate {\n         <Foo>::trait_deprecated_text(&foo);\n         <Foo as Trait>::trait_deprecated_text(&foo);\n \n+        deprecated_future(); // Fine; no error.\n+\n         deprecated_unstable();\n         //~^ ERROR use of unstable library feature\n         Trait::trait_deprecated_unstable(&foo);\n@@ -218,6 +220,10 @@ mod this_crate {\n     #[rustc_deprecated(since = \"1.0.0\", reason = \"text\")]\n     pub fn deprecated_text() {}\n \n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_deprecated(since = \"99.99.99\", reason = \"text\")]\n+    pub fn deprecated_future() {}\n+\n     #[unstable(feature = \"test_feature\", issue = \"0\")]\n     pub fn unstable() {}\n     #[unstable(feature = \"test_feature\", reason = \"text\", issue = \"0\")]\n@@ -338,6 +344,8 @@ mod this_crate {\n         <Foo>::trait_deprecated_text(&foo);\n         <Foo as Trait>::trait_deprecated_text(&foo);\n \n+        deprecated_future();\n+\n         unstable();\n         foo.method_unstable();\n         Foo::method_unstable(&foo);"}]}