{"sha": "0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2NTFkMjc5MGM3MDI0ZDFiNDUwYjZiMTdlMzRiYzhmZmRiNTFhMzM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-04-05T21:51:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-04-05T21:51:32Z"}, "message": "auto merge of #13260 : pnkfelix/rust/fsk-fix-13247, r=alexcrichton\n\nFix #13247.\r\n\r\nr? @alexcrichton  (or anyone else, really).", "tree": {"sha": "c27057b09058766e5b9ce67eae29c16ecca2ab17", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c27057b09058766e5b9ce67eae29c16ecca2ab17"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "html_url": "https://github.com/rust-lang/rust/commit/0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0651d2790c7024d1b450b6b17e34bc8ffdb51a33/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2b2bbb62893b9655f65cb2813eaaba4f2e742dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2b2bbb62893b9655f65cb2813eaaba4f2e742dd", "html_url": "https://github.com/rust-lang/rust/commit/b2b2bbb62893b9655f65cb2813eaaba4f2e742dd"}, {"sha": "4edf7b8c3478365a3c327d7fe340447f9d328d37", "url": "https://api.github.com/repos/rust-lang/rust/commits/4edf7b8c3478365a3c327d7fe340447f9d328d37", "html_url": "https://github.com/rust-lang/rust/commit/4edf7b8c3478365a3c327d7fe340447f9d328d37"}], "stats": {"total": 47, "additions": 39, "deletions": 8}, "files": [{"sha": "c766b6c143b3f17cf662f0f90204ea6e9dea4759", "filename": "mk/tests.mk", "status": "modified", "additions": 36, "deletions": 8, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/0651d2790c7024d1b450b6b17e34bc8ffdb51a33/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0651d2790c7024d1b450b6b17e34bc8ffdb51a33/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "patch": "@@ -370,8 +370,6 @@ $(foreach host,$(CFG_HOST), \\\n define DEF_TEST_CRATE_RULES\n check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n \n-check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n-\n $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$(3)/stage$(1)/test/$(4)test-$(2)$$(X_$(2))\n \t@$$(call E, run: $$<)\n@@ -503,6 +501,10 @@ CTEST_BUILD_BASE_codegen = codegen\n CTEST_MODE_codegen = codegen\n CTEST_RUNTOOL_codegen = $(CTEST_RUNTOOL)\n \n+# CTEST_DISABLE_$(TEST_GROUP), if set, will cause the test group to be\n+# disabled and the associated message to be printed as a warning\n+# during attempts to run those tests.\n+\n ifeq ($(CFG_GDB),)\n CTEST_DISABLE_debuginfo = \"no gdb found\"\n endif\n@@ -515,6 +517,14 @@ ifeq ($(CFG_OSTYPE),apple-darwin)\n CTEST_DISABLE_debuginfo = \"gdb on darwing needs root\"\n endif\n \n+# CTEST_DISABLE_NONSELFHOST_$(TEST_GROUP), if set, will cause that\n+# test group to be disabled *unless* the target is able to build a\n+# compiler (i.e. when the target triple is in the set of of host\n+# triples).  The associated message will be printed as a warning\n+# during attempts to run those tests.\n+\n+CTEST_DISABLE_NONSELFHOST_rpass-full = \"run-pass-full suite is unavailable when cross-compiling.\"\n+\n define DEF_CTEST_VARS\n \n # All the per-stage build rules you might want to call from the\n@@ -560,7 +570,7 @@ CTEST_COMMON_ARGS$(1)-T-$(2)-H-$(3) :=\t\t\t\t\t\t\\\n         $$(CTEST_TESTARGS)\n \n CTEST_DEPS_rpass_$(1)-T-$(2)-H-$(3) = $$(RPASS_TESTS)\n-CTEST_DEPS_rpass_full_$(1)-T-$(2)-H-$(3) = $$(RPASS_FULL_TESTS) $$(TLIBRUSTC_DEFAULT$(1)_T_$(2)_H_$(3))\n+CTEST_DEPS_rpass-full_$(1)-T-$(2)-H-$(3) = $$(RPASS_FULL_TESTS) $$(CSREQ$(1)_T_$(2)_H_$(3))\n CTEST_DEPS_rfail_$(1)-T-$(2)-H-$(3) = $$(RFAIL_TESTS)\n CTEST_DEPS_cfail_$(1)-T-$(2)-H-$(3) = $$(CFAIL_TESTS)\n CTEST_DEPS_bench_$(1)-T-$(2)-H-$(3) = $$(BENCH_TESTS)\n@@ -587,8 +597,28 @@ CTEST_ARGS$(1)-T-$(2)-H-$(3)-$(4) := \\\n \n check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n \n-ifeq ($$(CTEST_DISABLE_$(4)),)\n+# CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4)\n+# Goal: leave this variable as empty string if we should run the test.\n+# Otherwise, set it to the reason we are not running the test.\n+# (Encoded as a separate variable because GNU make does not have a\n+# good way to express OR on ifeq commands)\n \n+ifneq ($$(CTEST_DISABLE_$(4)),)\n+# Test suite is disabled for all configured targets.\n+CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4) := $$(CTEST_DISABLE_$(4))\n+else\n+# else, check if non-self-hosted target (i.e. target not-in hosts) ...\n+ifeq ($$(findstring $(2),$$(CFG_HOST)),)\n+# ... if so, then check if this test suite is disabled for non-selfhosts.\n+ifneq ($$(CTEST_DISABLE_NONSELFHOST_$(4)),)\n+# Test suite is disabled for this target.\n+CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4) := $$(CTEST_DISABLE_NONSELFHOST_$(4))\n+endif\n+endif\n+# Neither DISABLE nor DISABLE_NONSELFHOST is set ==> okay, run the test.\n+endif\n+\n+ifeq ($$(CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4)),)\n $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n                 $$(CTEST_DEPS_$(4)_$(1)-T-$(2)-H-$(3))\n@@ -600,11 +630,9 @@ $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \n else\n \n-$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n-\t\t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n-                $$(CTEST_DEPS_$(4)_$(1)-T-$(2)-H-$(3))\n+$$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)):\n \t@$$(call E, run $(4) [$(2)]: $$<)\n-\t@$$(call E, warning: tests disabled: $$(CTEST_DISABLE_$(4)))\n+\t@$$(call E, warning: tests disabled: $$(CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4)))\n \ttouch $$@\n \n endif"}, {"sha": "d2499ea33bdd6de3a059039cf18961b74b950958", "filename": "src/compiletest/compiletest.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0651d2790c7024d1b450b6b17e34bc8ffdb51a33/src%2Fcompiletest%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0651d2790c7024d1b450b6b17e34bc8ffdb51a33/src%2Fcompiletest%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcompiletest.rs?ref=0651d2790c7024d1b450b6b17e34bc8ffdb51a33", "patch": "@@ -11,6 +11,9 @@\n #![crate_type = \"bin\"]\n #![feature(phase)]\n \n+// we use our own (green) start below; do not link in libnative; issue #13247.\n+#![no_start]\n+\n #![allow(non_camel_case_types)]\n #![deny(warnings)]\n "}]}