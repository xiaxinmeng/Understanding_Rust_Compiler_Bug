{"sha": "73702d5e39e812d2e9ad22221462c266c963dd43", "node_id": "C_kwDOAAsO6NoAKDczNzAyZDVlMzllODEyZDJlOWFkMjIyMjE0NjJjMjY2Yzk2M2RkNDM", "commit": {"author": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-04-10T11:52:36Z"}, "committer": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-04-10T11:56:31Z"}, "message": "Turn off the alignment check pass, remove the panic test for it\n\nThe panic test is now counted as an error test; we encounter a Terminate\nterminator, and emit an interpreter error, as opposed to just\nterminating due to a panic. So this test should have broken with\nhttps://github.com/rust-lang/rust/pull/102906 but wasn't because the Miri\ntest suite is currently broken in rust-lang/rust:\n https://github.com/rust-lang/rust/issues/110102", "tree": {"sha": "07dc10ebd53eb23ed6d232fc23008fe9cbf45664", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/07dc10ebd53eb23ed6d232fc23008fe9cbf45664"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73702d5e39e812d2e9ad22221462c266c963dd43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73702d5e39e812d2e9ad22221462c266c963dd43", "html_url": "https://github.com/rust-lang/rust/commit/73702d5e39e812d2e9ad22221462c266c963dd43", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73702d5e39e812d2e9ad22221462c266c963dd43/comments", "author": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6efdf4d1309f8047bc439a4810888c715e2df480", "url": "https://api.github.com/repos/rust-lang/rust/commits/6efdf4d1309f8047bc439a4810888c715e2df480", "html_url": "https://github.com/rust-lang/rust/commit/6efdf4d1309f8047bc439a4810888c715e2df480"}], "stats": {"total": 14, "additions": 3, "deletions": 11}, "files": [{"sha": "5c8aba6d441f4a444ad9d5a0147db5c72beaf20c", "filename": "src/tools/miri/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/73702d5e39e812d2e9ad22221462c266c963dd43/src%2Ftools%2Fmiri%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73702d5e39e812d2e9ad22221462c266c963dd43/src%2Ftools%2Fmiri%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Flib.rs?ref=73702d5e39e812d2e9ad22221462c266c963dd43", "patch": "@@ -124,10 +124,13 @@ pub use crate::tag_gc::{EvalContextExt as _, VisitTags};\n \n /// Insert rustc arguments at the beginning of the argument list that Miri wants to be\n /// set per default, for maximal validation power.\n+/// Also disable the MIR pass that inserts an alignment check on every pointer dereference. Miri\n+/// does that too, and with a better error message.\n pub const MIRI_DEFAULT_ARGS: &[&str] = &[\n     \"--cfg=miri\",\n     \"-Zalways-encode-mir\",\n     \"-Zextra-const-ub-checks\",\n     \"-Zmir-emit-retag\",\n     \"-Zmir-opt-level=0\",\n+    \"-Zmir-enable-passes=-CheckAlignment\",\n ];"}, {"sha": "68aa19a88db0997832c3d7c3a6fbd085d2a83a9a", "filename": "src/tools/miri/tests/panic/alignment-assertion.rs", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6efdf4d1309f8047bc439a4810888c715e2df480/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6efdf4d1309f8047bc439a4810888c715e2df480/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.rs?ref=6efdf4d1309f8047bc439a4810888c715e2df480", "patch": "@@ -1,9 +0,0 @@\n-//@compile-flags: -Zmiri-disable-alignment-check -Cdebug-assertions=yes\n-\n-fn main() {\n-    let mut x = [0u32; 2];\n-    let ptr: *mut u8 = x.as_mut_ptr().cast::<u8>();\n-    unsafe {\n-        *(ptr.add(1).cast::<u32>()) = 42;\n-    }\n-}"}, {"sha": "26cf51b0cd2e3d45a00b4b5a4b10aeb390dd32bb", "filename": "src/tools/miri/tests/panic/alignment-assertion.stderr", "status": "removed", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6efdf4d1309f8047bc439a4810888c715e2df480/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6efdf4d1309f8047bc439a4810888c715e2df480/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpanic%2Falignment-assertion.stderr?ref=6efdf4d1309f8047bc439a4810888c715e2df480", "patch": "@@ -1,2 +0,0 @@\n-thread 'main' panicked at 'misaligned pointer dereference: address must be a multiple of 0x4 but is $HEX', $DIR/alignment-assertion.rs:LL:CC\n-note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}]}