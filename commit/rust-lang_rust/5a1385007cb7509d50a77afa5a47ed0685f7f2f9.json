{"sha": "5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhMTM4NTAwN2NiNzUwOWQ1MGE3N2FmYTVhNDdlZDA2ODVmN2YyZjk=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-25T20:32:49Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-25T20:32:49Z"}, "message": "Fix type inference of binops on int/float variables\n\nFixes #651.", "tree": {"sha": "c996152aa889c1ef7c6af18ae88f328a2ba2c5fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c996152aa889c1ef7c6af18ae88f328a2ba2c5fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "html_url": "https://github.com/rust-lang/rust/commit/5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03fc615ead78ecf126632220104fa4de3414eb7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/03fc615ead78ecf126632220104fa4de3414eb7f", "html_url": "https://github.com/rust-lang/rust/commit/03fc615ead78ecf126632220104fa4de3414eb7f"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "179ebddeec9ab9f4c8915860f1fe2eceae816994", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "patch": "@@ -790,7 +790,10 @@ fn binary_op_return_ty(op: BinaryOp, rhs_ty: Ty) -> Ty {\n         | BinaryOp::BitwiseAnd\n         | BinaryOp::BitwiseOr\n         | BinaryOp::BitwiseXor => match rhs_ty {\n-            Ty::Int(..) | Ty::Float(..) => rhs_ty,\n+            Ty::Int(..)\n+            | Ty::Float(..)\n+            | Ty::Infer(InferTy::IntVar(..))\n+            | Ty::Infer(InferTy::FloatVar(..)) => rhs_ty,\n             _ => Ty::Unknown,\n         },\n         BinaryOp::RangeRightOpen | BinaryOp::RangeRightClosed => Ty::Unknown,"}, {"sha": "d23d3f139261586a4556e2ff0b1363e47bf0bbcc", "filename": "crates/ra_hir/src/ty/snapshots/tests__bug_651.snap", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap", "raw_url": "https://github.com/rust-lang/rust/raw/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap?ref=5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "patch": "@@ -0,0 +1,13 @@\n+---\n+created: \"2019-01-25T20:31:47.275112244+00:00\"\n+creator: insta@0.5.2\n+expression: \"&result\"\n+source: crates/ra_hir/src/ty/tests.rs\n+---\n+[11; 41) '{     ...+ y; }': ()\n+[21; 22) 'y': i32\n+[25; 27) '92': i32\n+[33; 34) '1': i32\n+[33; 38) '1 + y': i32\n+[37; 38) 'y': i32\n+"}, {"sha": "389bdaf23725cd3fe4a6ab7f2ed9fc0da1bc3779", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a1385007cb7509d50a77afa5a47ed0685f7f2f9/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "patch": "@@ -532,6 +532,19 @@ fn test() {\n     );\n }\n \n+#[test]\n+fn bug_651() {\n+    check_inference(\n+        \"bug_651\",\n+        r#\"\n+fn quux() {\n+    let y = 92;\n+    1 + y;\n+}\n+\"#,\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.source_file(file_id);"}]}