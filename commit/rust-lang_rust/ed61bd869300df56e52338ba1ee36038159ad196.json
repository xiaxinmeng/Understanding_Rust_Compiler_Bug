{"sha": "ed61bd869300df56e52338ba1ee36038159ad196", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkNjFiZDg2OTMwMGRmNTZlNTIzMzhiYTFlZTM2MDM4MTU5YWQxOTY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-06T23:29:17Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-06T23:29:17Z"}, "message": "rollup merge of #20652: vhbit/thread-key-type\n\nThis is a manual merge of #20627 and #20634 to avoid conflicts in rollup and also avoid one roundtrip. I've leave copyright to original author.  If this one is moved to rollup original PR could be closed. cc @mneumann\n\n@alexcrichton r?\n\nBoth FreeBSD and DragonFly define pthread_key_t as int, while Linux\ndefines it as uint. As pthread_key_t is used as an opaque type and\nstorage size of both int and uint are the same, this is rather a\ncosmetic change.\n\niOS uses ulong (as OS X) so difference is critical on 64bit platforms.", "tree": {"sha": "eae74dea46df0bcb5783fde35edac35afaca44e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eae74dea46df0bcb5783fde35edac35afaca44e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed61bd869300df56e52338ba1ee36038159ad196", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed61bd869300df56e52338ba1ee36038159ad196", "html_url": "https://github.com/rust-lang/rust/commit/ed61bd869300df56e52338ba1ee36038159ad196", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed61bd869300df56e52338ba1ee36038159ad196/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acc5d7914a5e287d0783f63dd316c3a25b976544", "url": "https://api.github.com/repos/rust-lang/rust/commits/acc5d7914a5e287d0783f63dd316c3a25b976544", "html_url": "https://github.com/rust-lang/rust/commit/acc5d7914a5e287d0783f63dd316c3a25b976544"}, {"sha": "134eb0e26f6c2d89b852995295d364614d6b7299", "url": "https://api.github.com/repos/rust-lang/rust/commits/134eb0e26f6c2d89b852995295d364614d6b7299", "html_url": "https://github.com/rust-lang/rust/commit/134eb0e26f6c2d89b852995295d364614d6b7299"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "ea1e9c261fecfbb4279c3e228d5f3512d62b16f5", "filename": "src/libstd/sys/unix/thread_local.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ed61bd869300df56e52338ba1ee36038159ad196/src%2Flibstd%2Fsys%2Funix%2Fthread_local.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed61bd869300df56e52338ba1ee36038159ad196/src%2Flibstd%2Fsys%2Funix%2Fthread_local.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fthread_local.rs?ref=ed61bd869300df56e52338ba1ee36038159ad196", "patch": "@@ -37,10 +37,18 @@ pub unsafe fn destroy(key: Key) {\n     debug_assert_eq!(r, 0);\n }\n \n-#[cfg(target_os = \"macos\")]\n+#[cfg(any(target_os = \"macos\",\n+          target_os = \"ios\"))]\n type pthread_key_t = ::libc::c_ulong;\n \n-#[cfg(not(target_os = \"macos\"))]\n+#[cfg(any(target_os = \"freebsd\",\n+          target_os = \"dragonfly\"))]\n+type pthread_key_t = ::libc::c_int;\n+\n+#[cfg(not(any(target_os = \"macos\",\n+              target_os = \"ios\",\n+              target_os = \"freebsd\",\n+              target_os = \"dragonfly\")))]\n type pthread_key_t = ::libc::c_uint;\n \n extern {"}]}