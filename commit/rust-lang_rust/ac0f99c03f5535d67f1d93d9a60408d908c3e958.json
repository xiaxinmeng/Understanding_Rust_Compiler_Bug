{"sha": "ac0f99c03f5535d67f1d93d9a60408d908c3e958", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjMGY5OWMwM2Y1NTM1ZDY3ZjFkOTNkOWE2MDQwOGQ5MDhjM2U5NTg=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-04-24T18:23:57Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-04-25T07:01:32Z"}, "message": "Some JS improvements", "tree": {"sha": "4cd2546e9ffcbe25619efe488228800558034343", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4cd2546e9ffcbe25619efe488228800558034343"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac0f99c03f5535d67f1d93d9a60408d908c3e958", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac0f99c03f5535d67f1d93d9a60408d908c3e958", "html_url": "https://github.com/rust-lang/rust/commit/ac0f99c03f5535d67f1d93d9a60408d908c3e958", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac0f99c03f5535d67f1d93d9a60408d908c3e958/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "38e251ba37231f3471a20a13f503b191ed25a499", "url": "https://api.github.com/repos/rust-lang/rust/commits/38e251ba37231f3471a20a13f503b191ed25a499", "html_url": "https://github.com/rust-lang/rust/commit/38e251ba37231f3471a20a13f503b191ed25a499"}], "stats": {"total": 56, "additions": 24, "deletions": 32}, "files": [{"sha": "58a57f43d374580a495876cc7348adc86610fea4", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 24, "deletions": 32, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/ac0f99c03f5535d67f1d93d9a60408d908c3e958/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/ac0f99c03f5535d67f1d93d9a60408d908c3e958/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=ac0f99c03f5535d67f1d93d9a60408d908c3e958", "patch": "@@ -40,6 +40,8 @@\n                      \"union\",\n                      \"foreigntype\"];\n \n+    var search_input = document.getElementsByClassName('search-input')[0];\n+\n     // On the search screen, so you remain on the last tab you opened.\n     //\n     // 0 for \"In Names\"\n@@ -411,8 +413,8 @@\n         // but only if the input bar is empty. This avoid the obnoxious issue\n         // where you start trying to do a search, and the index loads, and\n         // suddenly your search is gone!\n-        if (document.getElementsByClassName(\"search-input\")[0].value === \"\") {\n-            document.getElementsByClassName(\"search-input\")[0].value = params.search || '';\n+        if (search_input.value === \"\") {\n+            search_input.value = params.search || '';\n         }\n \n         /**\n@@ -1118,7 +1120,6 @@\n                 });\n             });\n \n-            var search_input = document.getElementsByClassName('search-input')[0];\n             search_input.onkeydown = function(e) {\n                 // \"actives\" references the currently highlighted item in each search tab.\n                 // Each array in \"actives\" represents a tab.\n@@ -1169,7 +1170,7 @@\n                     // Does nothing, it's just to avoid losing \"focus\" on the highlighted element.\n                 } else if (e.which === 27) { // escape\n                     removeClass(actives[currentTab][0], 'highlighted');\n-                    document.getElementsByClassName('search-input')[0].value = '';\n+                    search_input.value = '';\n                     defocusSearchBar();\n                 } else if (actives[currentTab].length > 0) {\n                     removeClass(actives[currentTab][0], 'highlighted');\n@@ -1206,7 +1207,6 @@\n                         return;\n                     }\n \n-                    console.log(item);\n                     shown.push(id_ty);\n                     name = item.name;\n                     type = itemTypes[item.ty];\n@@ -1268,7 +1268,7 @@\n         }\n \n         function showResults(results) {\n-            var output, query = getQuery(document.getElementsByClassName('search-input')[0].value);\n+            var output, query = getQuery(search_input.value);\n \n             currentResults = query.id;\n             output = '<h1>Results for ' + escape(query.query) +\n@@ -1375,14 +1375,13 @@\n \n         function search(e) {\n             var params = getQueryStringParams();\n-            var search_input = document.getElementsByClassName('search-input')[0];\n             var query = getQuery(search_input.value.trim());\n \n             if (e) {\n                 e.preventDefault();\n             }\n \n-            if (!query.query || query.id === currentResults) {\n+            if (query.query.length === 0 || query.id === currentResults) {\n                 if (query.query.length > 0) {\n                     putBackSearch(search_input);\n                 }\n@@ -1468,9 +1467,6 @@\n         function startSearch() {\n             var searchTimeout;\n             var callback = function() {\n-                var search_input = document.getElementsByClassName('search-input');\n-                if (search_input.length < 1) { return; }\n-                search_input = search_input[0];\n                 clearTimeout(searchTimeout);\n                 if (search_input.value.length === 0) {\n                     if (browserSupportsHistoryApi()) {\n@@ -1488,7 +1484,6 @@\n                     searchTimeout = setTimeout(search, 500);\n                 }\n             };\n-            var search_input = document.getElementsByClassName(\"search-input\")[0];\n             search_input.onkeyup = callback;\n             search_input.oninput = callback;\n             document.getElementsByClassName(\"search-form\")[0].onsubmit = function(e) {\n@@ -1538,9 +1533,9 @@\n                     // nothing there, which lets you really go back to a\n                     // previous state with nothing in the bar.\n                     if (params.search) {\n-                        document.getElementsByClassName('search-input')[0].value = params.search;\n+                        search_input.value = params.search;\n                     } else {\n-                        document.getElementsByClassName('search-input')[0].value = '';\n+                        search_input.value = '';\n                     }\n                     // Some browsers fire 'onpopstate' for every page load\n                     // (Chrome), while others fire the event only when actually\n@@ -1950,28 +1945,14 @@\n         return wrapper;\n     }\n \n-    onEach(document.getElementById('main').getElementsByClassName('docblock'), function(e) {\n-        if (e.parentNode.id === \"main\") {\n-            var otherMessage;\n-            if (hasClass(e, \"type-decl\")) {\n-                otherMessage = '&nbsp;Show&nbsp;type&nbsp;declaration';\n-            }\n-            e.parentNode.insertBefore(createToggle(otherMessage), e);\n-            if (otherMessage && getCurrentValue('rustdoc-item-declarations') !== \"false\") {\n-                collapseDocs(e.previousSibling.childNodes[0], \"toggle\");\n-            }\n-        }\n-    });\n-\n     onEach(document.getElementsByClassName('docblock'), function(e) {\n         if (hasClass(e, 'autohide')) {\n             var wrap = e.previousElementSibling;\n             if (wrap && hasClass(wrap, 'toggle-wrapper')) {\n                 var toggle = wrap.childNodes[0];\n+                var extra = false;\n                 if (e.childNodes[0].tagName === 'H3') {\n-                    onEach(toggle.getElementsByClassName('toggle-label'), function(i_e) {\n-                        i_e.innerHTML = \" Show \" + e.childNodes[0].innerHTML;\n-                    });\n+                    extra = true;\n                 }\n                 e.style.display = 'none';\n                 addClass(wrap, 'collapsed');\n@@ -1980,9 +1961,22 @@\n                 });\n                 onEach(toggle.getElementsByClassName('toggle-label'), function(e) {\n                     e.style.display = 'inline-block';\n+                    if (extra === true) {\n+                        i_e.innerHTML = \" Show \" + e.childNodes[0].innerHTML;\n+                    }\n                 });\n             }\n         }\n+        if (e.parentNode.id === \"main\") {\n+            var otherMessage;\n+            if (hasClass(e, \"type-decl\")) {\n+                otherMessage = '&nbsp;Show&nbsp;type&nbsp;declaration';\n+            }\n+            e.parentNode.insertBefore(createToggle(otherMessage), e);\n+            if (otherMessage && getCurrentValue('rustdoc-item-declarations') !== \"false\") {\n+                collapseDocs(e.previousSibling.childNodes[0], \"toggle\");\n+            }\n+        }\n     })\n \n     autoCollapseAllImpls(getPageId());\n@@ -2088,8 +2082,6 @@\n         }\n     }\n \n-    var search_input = document.getElementsByClassName(\"search-input\")[0];\n-\n     if (search_input) {\n         search_input.onfocus = function() {\n             putBackSearch(this);"}]}