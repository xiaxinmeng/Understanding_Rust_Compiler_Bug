{"sha": "e6cde9f2a4f5e4d9e20686f29344461eacae3eba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2Y2RlOWYyYTRmNWU0ZDllMjA2ODZmMjkzNDQ0NjFlYWNhZTNlYmE=", "commit": {"author": {"name": "Mike Lubinets", "email": "lubinetsm@yandex.ru", "date": "2017-05-11T13:48:25Z"}, "committer": {"name": "Mike Lubinets", "email": "lubinetsm@yandex.ru", "date": "2017-05-11T20:20:09Z"}, "message": "Number of filtered out tests in tests summary\nCloses #31905", "tree": {"sha": "4c542714c528bee96e98715d6dba0f41c1132940", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c542714c528bee96e98715d6dba0f41c1132940"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e6cde9f2a4f5e4d9e20686f29344461eacae3eba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e6cde9f2a4f5e4d9e20686f29344461eacae3eba", "html_url": "https://github.com/rust-lang/rust/commit/e6cde9f2a4f5e4d9e20686f29344461eacae3eba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e6cde9f2a4f5e4d9e20686f29344461eacae3eba/comments", "author": {"login": "mersinvald", "id": 8722061, "node_id": "MDQ6VXNlcjg3MjIwNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/8722061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mersinvald", "html_url": "https://github.com/mersinvald", "followers_url": "https://api.github.com/users/mersinvald/followers", "following_url": "https://api.github.com/users/mersinvald/following{/other_user}", "gists_url": "https://api.github.com/users/mersinvald/gists{/gist_id}", "starred_url": "https://api.github.com/users/mersinvald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mersinvald/subscriptions", "organizations_url": "https://api.github.com/users/mersinvald/orgs", "repos_url": "https://api.github.com/users/mersinvald/repos", "events_url": "https://api.github.com/users/mersinvald/events{/privacy}", "received_events_url": "https://api.github.com/users/mersinvald/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mersinvald", "id": 8722061, "node_id": "MDQ6VXNlcjg3MjIwNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/8722061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mersinvald", "html_url": "https://github.com/mersinvald", "followers_url": "https://api.github.com/users/mersinvald/followers", "following_url": "https://api.github.com/users/mersinvald/following{/other_user}", "gists_url": "https://api.github.com/users/mersinvald/gists{/gist_id}", "starred_url": "https://api.github.com/users/mersinvald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mersinvald/subscriptions", "organizations_url": "https://api.github.com/users/mersinvald/orgs", "repos_url": "https://api.github.com/users/mersinvald/repos", "events_url": "https://api.github.com/users/mersinvald/events{/privacy}", "received_events_url": "https://api.github.com/users/mersinvald/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb8d51c2ebe8d89c9cdcf06a9383d6e974efc5b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb8d51c2ebe8d89c9cdcf06a9383d6e974efc5b6", "html_url": "https://github.com/rust-lang/rust/commit/bb8d51c2ebe8d89c9cdcf06a9383d6e974efc5b6"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "ef048ac8ca355f9ea0e43f3bc5c1cb9774de0fb4", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e6cde9f2a4f5e4d9e20686f29344461eacae3eba/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6cde9f2a4f5e4d9e20686f29344461eacae3eba/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=e6cde9f2a4f5e4d9e20686f29344461eacae3eba", "patch": "@@ -542,6 +542,7 @@ struct ConsoleTestState<T> {\n     passed: usize,\n     failed: usize,\n     ignored: usize,\n+    filtered_out: usize,\n     measured: usize,\n     metrics: MetricMap,\n     failures: Vec<(TestDesc, Vec<u8>)>,\n@@ -570,6 +571,7 @@ impl<T: Write> ConsoleTestState<T> {\n             passed: 0,\n             failed: 0,\n             ignored: 0,\n+            filtered_out: 0,\n             measured: 0,\n             metrics: MetricMap::new(),\n             failures: Vec::new(),\n@@ -775,11 +777,12 @@ impl<T: Write> ConsoleTestState<T> {\n         } else {\n             self.write_pretty(\"FAILED\", term::color::RED)?;\n         }\n-        let s = format!(\". {} passed; {} failed; {} ignored; {} measured\\n\\n\",\n+        let s = format!(\". {} passed; {} failed; {} ignored; {} measured; {} filtered out\\n\\n\",\n                         self.passed,\n                         self.failed,\n                         self.ignored,\n-                        self.measured);\n+                        self.measured,\n+                        self.filtered_out);\n         self.write_plain(&s)?;\n         return Ok(success);\n     }\n@@ -875,6 +878,7 @@ pub fn run_tests_console(opts: &TestOpts, tests: Vec<TestDescAndFn>) -> io::Resu\n     fn callback<T: Write>(event: &TestEvent, st: &mut ConsoleTestState<T>) -> io::Result<()> {\n         match (*event).clone() {\n             TeFiltered(ref filtered_tests) => st.write_run_start(filtered_tests.len()),\n+            TeFilteredOut(filtered_out) => Ok(st.filtered_out = filtered_out),\n             TeWait(ref test, padding) => st.write_test_start(test, padding),\n             TeTimeout(ref test) => st.write_timeout(test),\n             TeResult(test, result, stdout) => {\n@@ -957,6 +961,7 @@ fn should_sort_failures_before_printing_them() {\n         passed: 0,\n         failed: 0,\n         ignored: 0,\n+        filtered_out: 0,\n         measured: 0,\n         max_name_len: 10,\n         metrics: MetricMap::new(),\n@@ -1017,6 +1022,7 @@ pub enum TestEvent {\n     TeWait(TestDesc, NamePadding),\n     TeResult(TestDesc, TestResult, Vec<u8>),\n     TeTimeout(TestDesc),\n+    TeFilteredOut(usize),\n }\n \n pub type MonitorMsg = (TestDesc, TestResult, Vec<u8>);\n@@ -1028,11 +1034,16 @@ pub fn run_tests<F>(opts: &TestOpts, tests: Vec<TestDescAndFn>, mut callback: F)\n     use std::collections::HashMap;\n     use std::sync::mpsc::RecvTimeoutError;\n \n+    let tests_len = tests.len();\n+\n     let mut filtered_tests = filter_tests(opts, tests);\n     if !opts.bench_benchmarks {\n         filtered_tests = convert_benchmarks_to_tests(filtered_tests);\n     }\n \n+    let filtered_out = tests_len - filtered_tests.len();\n+    callback(TeFilteredOut(filtered_out))?;\n+\n     let filtered_descs = filtered_tests.iter()\n                                        .map(|t| t.desc.clone())\n                                        .collect();"}]}