{"sha": "1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjOWQwNDRjMDVkMDhmOGQ1ZDhiYjc2MzMzMjlmYWNjMjVhYWUwZWI=", "commit": {"author": {"name": "Michael Smith", "email": "michael@spinda.net", "date": "2017-08-19T18:51:24Z"}, "committer": {"name": "Michael Smith", "email": "michael@spinda.net", "date": "2017-08-19T22:09:10Z"}, "message": "Add attributes_on_same_line_as_{field,variant}", "tree": {"sha": "fa600be7dce60fb31bb88b1ce23e058aa92b619d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa600be7dce60fb31bb88b1ce23e058aa92b619d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZmLcJAAoJEIZFvfV06PdVL9AP/2JNAJRfuMEctXKzEUTpATn9\nSV/e5wMO7Wf8tHAzfmmEajyx8BwrzzqtaHyLxBQwnWkhPWW9LyCwzrGZzPraCDQL\nhcqlw8+nfE1FWF3l5e/V7swmZ3J/sngENXjAowNvq42zCqEJxPSzj+pCltQu0o3Q\nKFS/wrLH7gsepbkXldlYqDYwncURoocZ8MV66/SwBjQ7CXCo5Q9aRs00q7NunhUh\nAtkWAw02L84C4rHybl6YV+2tPPSPMRVJWDQzaNjTkKxMgL6njDa9nmRZddsFSzVw\nRvt8ntrVQncgVBIBL7LNLGmYos5TLR6HIhTVmWENneBdNFEXo6D9XpCb+cx9Y8n2\nsuS8SP1L/rxGzVtzlRQZMkGvsY+xA4+KxyjzMbpio91xXJ4lLsKIGwZtVxQffzFb\nfPQvxP3+5X9+S1KpPhWVhesdaDFbLCcPisFWN8Xj2DBu6vxv17Rjrpw7AU/NtL7E\n3di+TI9Hm8ycnD9A0HChDC5NnUYvPvPY3I3qU54DIyj8Oi0kh99+RQCT8gpYdHWB\nT/edJ6XjlpLck3JM4+YVmfcClgKG05cqZPn5EV8NO66lZ1O/ZMwb3Xwp6IoSkfIH\ni/x1zRVNajFZeVqBrIohP2AxucBGQl/cdc8upSp5Ps+p/UahDDFWEA1uk2BdVaCh\nTyvvyKBOZkuuQpVsni2/\n=h/pv\n-----END PGP SIGNATURE-----", "payload": "tree fa600be7dce60fb31bb88b1ce23e058aa92b619d\nparent c166004e6da83e4c90459bf96e95574c065ee306\nauthor Michael Smith <michael@spinda.net> 1503168684 -0700\ncommitter Michael Smith <michael@spinda.net> 1503180550 -0700\n\nAdd attributes_on_same_line_as_{field,variant}\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "html_url": "https://github.com/rust-lang/rust/commit/1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/comments", "author": {"login": "spinda", "id": 7958605, "node_id": "MDQ6VXNlcjc5NTg2MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7958605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spinda", "html_url": "https://github.com/spinda", "followers_url": "https://api.github.com/users/spinda/followers", "following_url": "https://api.github.com/users/spinda/following{/other_user}", "gists_url": "https://api.github.com/users/spinda/gists{/gist_id}", "starred_url": "https://api.github.com/users/spinda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spinda/subscriptions", "organizations_url": "https://api.github.com/users/spinda/orgs", "repos_url": "https://api.github.com/users/spinda/repos", "events_url": "https://api.github.com/users/spinda/events{/privacy}", "received_events_url": "https://api.github.com/users/spinda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spinda", "id": 7958605, "node_id": "MDQ6VXNlcjc5NTg2MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7958605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spinda", "html_url": "https://github.com/spinda", "followers_url": "https://api.github.com/users/spinda/followers", "following_url": "https://api.github.com/users/spinda/following{/other_user}", "gists_url": "https://api.github.com/users/spinda/gists{/gist_id}", "starred_url": "https://api.github.com/users/spinda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spinda/subscriptions", "organizations_url": "https://api.github.com/users/spinda/orgs", "repos_url": "https://api.github.com/users/spinda/repos", "events_url": "https://api.github.com/users/spinda/events{/privacy}", "received_events_url": "https://api.github.com/users/spinda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c166004e6da83e4c90459bf96e95574c065ee306", "url": "https://api.github.com/repos/rust-lang/rust/commits/c166004e6da83e4c90459bf96e95574c065ee306", "html_url": "https://github.com/rust-lang/rust/commit/c166004e6da83e4c90459bf96e95574c065ee306"}], "stats": {"total": 161, "additions": 155, "deletions": 6}, "files": [{"sha": "f796635794014a2a07a1eb37304ed99cdc68c8b0", "filename": "Configurations.md", "status": "modified", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/Configurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/Configurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Configurations.md?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -100,6 +100,66 @@ let lorem = vec![\"ipsum\", \"dolor\", \"sit\", \"amet\", \"consectetur\", \"adipiscing\", \"\n #### Lines longer than `array_width`:\n See [`array_layout`](#array_layout).\n \n+## `attributes_on_same_line_as_field`\n+\n+Try to put attributes on the same line as fields\n+\n+- **Default value**: `true`\n+- **Possible values**: `true`, `false`\n+\n+#### `true`\n+\n+```rust\n+struct Lorem {\n+    #[serde(rename = \"Ipsum\")] ipsum: usize,\n+    #[serde(rename = \"Dolor\")] dolor: usize,\n+    #[serde(rename = \"Amet\")] amet: usize,\n+}\n+```\n+\n+#### `false`\n+\n+```rust\n+struct Lorem {\n+    #[serde(rename = \"Ipsum\")]\n+    ipsum: usize,\n+    #[serde(rename = \"Dolor\")]\n+    dolor: usize,\n+    #[serde(rename = \"Amet\")]\n+    amet: usize,\n+}\n+```\n+\n+## `attributes_on_same_line_as_variant`\n+\n+Try to put attributes on the same line as variants\n+\n+- **Default value**: `true`\n+- **Possible values**: `true`, `false`\n+\n+#### `true`\n+\n+```rust\n+enum Lorem {\n+    #[serde(skip_serializing)] Ipsum,\n+    #[serde(skip_serializing)] Dolor,\n+    #[serde(skip_serializing)] Amet,\n+}\n+```\n+\n+#### `false`\n+\n+```rust\n+enum Lorem {\n+    #[serde(skip_serializing)]\n+    Ipsum,\n+    #[serde(skip_serializing)]\n+    Dolor,\n+    #[serde(skip_serializing)]\n+    Amet,\n+}\n+```\n+\n ## `chain_indent`\n \n Indentation of chain"}, {"sha": "f3e4c462893192e88484ac3d5be8efb8a8782756", "filename": "src/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -609,6 +609,10 @@ create_config! {\n                                              threshold.\";\n     remove_blank_lines_at_start_or_end_of_block: bool, true,\n         \"Remove blank lines at start or end of a block\";\n+    attributes_on_same_line_as_field: bool, true,\n+        \"Try to put attributes on the same line as fields.\";\n+    attributes_on_same_line_as_variant: bool, true,\n+        \"Try to put attributes on the same line as variants in enum declarations.\";\n }\n \n #[cfg(test)]"}, {"sha": "156bab05c9c2f15225e6541f07e93784f139c982", "filename": "src/items.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -548,13 +548,16 @@ impl<'a> FmtVisitor<'a> {\n             },\n         };\n \n+        let attrs_extendable = attrs_str.is_empty() ||\n+            (context.config.attributes_on_same_line_as_variant() &&\n+                is_attributes_extendable(&attrs_str));\n         combine_strs_with_missing_comments(\n             &context,\n             &attrs_str,\n             &variant_body,\n             span,\n             shape,\n-            is_attributes_extendable(&attrs_str),\n+            attrs_extendable,\n         )\n     }\n }\n@@ -1413,6 +1416,8 @@ pub fn rewrite_struct_field(\n     let prefix = try_opt!(rewrite_struct_field_prefix(context, field));\n \n     let attrs_str = try_opt!(field.attrs.rewrite(context, shape));\n+    let attrs_extendable = attrs_str.is_empty() ||\n+        (context.config.attributes_on_same_line_as_field() && is_attributes_extendable(&attrs_str));\n     let missing_span = if field.attrs.is_empty() {\n         mk_sp(field.span.lo, field.span.lo)\n     } else {\n@@ -1430,17 +1435,15 @@ pub fn rewrite_struct_field(\n         &prefix,\n         missing_span,\n         shape,\n-        is_attributes_extendable(&attrs_str),\n+        attrs_extendable,\n     ));\n     let overhead = last_line_width(&attr_prefix);\n     let lhs_offset = lhs_max_width.checked_sub(overhead).unwrap_or(0);\n     for _ in 0..lhs_offset {\n         spacing.push(' ');\n     }\n     // In this extreme case we will be missing a space betweeen an attribute and a field.\n-    if prefix.is_empty() && !attrs_str.is_empty() && is_attributes_extendable(&attrs_str) &&\n-        spacing.is_empty()\n-    {\n+    if prefix.is_empty() && !attrs_str.is_empty() && attrs_extendable && spacing.is_empty() {\n         spacing.push(' ');\n     }\n     let ty_rewritten = rewrite_struct_field_type(context, overhead, field, &spacing, shape);\n@@ -1488,7 +1491,7 @@ pub fn rewrite_struct_field(\n         &field_str,\n         missing_span,\n         shape,\n-        is_attributes_extendable(&attrs_str),\n+        attrs_extendable,\n     )\n }\n "}, {"sha": "ba63fd5caa027381f2f47476cac4f6677be62e6b", "filename": "tests/source/configs-attributes_on_same_line_as_field-false.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-false.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_field: false\n+// Option to place attributes on the same line as fields where possible\n+\n+struct Lorem {\n+    #[ serde(rename = \"Ipsum\") ]\n+    ipsum: usize,\n+    #[ serde(rename = \"Dolor\") ]\n+    dolor: usize,\n+    #[ serde(rename = \"Amet\") ]\n+    amet: usize,\n+}"}, {"sha": "3258c754e5018815219edf5a30496045bdaef21f", "filename": "tests/source/configs-attributes_on_same_line_as_field-true.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-true.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-true.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_field-true.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_field: true\n+// Option to place attributes on the same line as fields where possible\n+\n+struct Lorem {\n+    #[ serde(rename = \"Ipsum\") ]\n+    ipsum: usize,\n+    #[ serde(rename = \"Dolor\") ]\n+    dolor: usize,\n+    #[ serde(rename = \"Amet\") ]\n+    amet: usize,\n+}"}, {"sha": "d3456b7087cc5b412800943a608eb332eac3155e", "filename": "tests/source/configs-attributes_on_same_line_as_variant-false.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-false.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_variant: false\n+// Option to place attributes on the same line as variants where possible\n+\n+enum Lorem {\n+    #[ serde(skip_serializing) ]\n+    Ipsum,\n+    #[ serde(skip_serializing) ]\n+    Dolor,\n+    #[ serde(skip_serializing) ]\n+    Amet,\n+}"}, {"sha": "0f7d98f200ac0f45d71333bdca288798e8df6265", "filename": "tests/source/configs-attributes_on_same_line_as_variant-true.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-true.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-true.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-attributes_on_same_line_as_variant-true.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_variant: true\n+// Option to place attributes on the same line as variants where possible\n+\n+enum Lorem {\n+    #[ serde(skip_serializing) ]\n+    Ipsum,\n+    #[ serde(skip_serializing) ]\n+    Dolor,\n+    #[ serde(skip_serializing) ]\n+    Amet,\n+}"}, {"sha": "7cb074d13a91bd49544df7628b93ed484efceeff", "filename": "tests/target/configs-attributes_on_same_line_as_field-false.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-false.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_field: false\n+// Option to place attributes on the same line as fields where possible\n+\n+struct Lorem {\n+    #[serde(rename = \"Ipsum\")]\n+    ipsum: usize,\n+    #[serde(rename = \"Dolor\")]\n+    dolor: usize,\n+    #[serde(rename = \"Amet\")]\n+    amet: usize,\n+}"}, {"sha": "3261fa24ea05df8ad81fa718a452bea4064c6fa7", "filename": "tests/target/configs-attributes_on_same_line_as_field-true.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-true.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-true.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_field-true.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,8 @@\n+// rustfmt-attributes_on_same_line_as_field: true\n+// Option to place attributes on the same line as fields where possible\n+\n+struct Lorem {\n+    #[serde(rename = \"Ipsum\")] ipsum: usize,\n+    #[serde(rename = \"Dolor\")] dolor: usize,\n+    #[serde(rename = \"Amet\")] amet: usize,\n+}"}, {"sha": "3442a10915a540ae699a39ce14d93c5e90ef012d", "filename": "tests/target/configs-attributes_on_same_line_as_variant-false.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-false.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-attributes_on_same_line_as_variant: false\n+// Option to place attributes on the same line as variants where possible\n+\n+enum Lorem {\n+    #[serde(skip_serializing)]\n+    Ipsum,\n+    #[serde(skip_serializing)]\n+    Dolor,\n+    #[serde(skip_serializing)]\n+    Amet,\n+}"}, {"sha": "0bced842c7585d0f6dd03ed41d5631a453ff73c5", "filename": "tests/target/configs-attributes_on_same_line_as_variant-true.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-true.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9d044c05d08f8d5d8bb7633329facc25aae0eb/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-true.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-attributes_on_same_line_as_variant-true.rs?ref=1c9d044c05d08f8d5d8bb7633329facc25aae0eb", "patch": "@@ -0,0 +1,8 @@\n+// rustfmt-attributes_on_same_line_as_variant: true\n+// Option to place attributes on the same line as variants where possible\n+\n+enum Lorem {\n+    #[serde(skip_serializing)] Ipsum,\n+    #[serde(skip_serializing)] Dolor,\n+    #[serde(skip_serializing)] Amet,\n+}"}]}