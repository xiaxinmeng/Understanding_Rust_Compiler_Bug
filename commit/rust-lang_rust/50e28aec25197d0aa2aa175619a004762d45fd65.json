{"sha": "50e28aec25197d0aa2aa175619a004762d45fd65", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwZTI4YWVjMjUxOTdkMGFhMmFhMTc1NjE5YTAwNDc2MmQ0NWZkNjU=", "commit": {"author": {"name": "ivan770", "email": "leshenko.ivan770@gmail.com", "date": "2021-03-26T14:04:53Z"}, "committer": {"name": "ivan770", "email": "leshenko.ivan770@gmail.com", "date": "2021-03-26T14:04:53Z"}, "message": "Ignore main functions not in root module", "tree": {"sha": "3fa135e7a9bd7ec6a94bad3118e5308fbe639f57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3fa135e7a9bd7ec6a94bad3118e5308fbe639f57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50e28aec25197d0aa2aa175619a004762d45fd65", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEEcPkYW+t8+2SKgl5T2MS9WuTZzE0FAmBd6gYACgkQ2MS9WuTZ\nzE0KKgf/WpIS+n5rL5EL0F/kCKOiXU7kYN4/5ECrwUujOrnYySkKCTvUEWtKhod0\nOMfKymY57zHP1KCajf2epfhIkolI7d9SZ3QshbiMeoMKAJrBdAelgA35GBuKRSkh\nEbiHKVQkZVk6fYqueDefS5o7WjDayntrSmA5s93v8o0tZeFlBLoe3rfC2iIUVAZQ\n+/sSb94a8PgFcRMqViTLhU5N5U5E2bTLV/6J1h7nWkmsdTtb7P+MEZ8ehd180eHf\nU1LBfjJAlDGot1AbLVFbMldkvke0VCNWBpwfDY/uZLqPQwO3OF+KcFl8jO0lNAsv\nGFPUBXp+C8qY0/UFsa2/fb4LaTbPUg==\n=TSQ8\n-----END PGP SIGNATURE-----", "payload": "tree 3fa135e7a9bd7ec6a94bad3118e5308fbe639f57\nparent 4cb3ecce3ff2573c8473733b2538b32cd899b686\nauthor ivan770 <leshenko.ivan770@gmail.com> 1616767493 +0200\ncommitter ivan770 <leshenko.ivan770@gmail.com> 1616767493 +0200\n\nIgnore main functions not in root module\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50e28aec25197d0aa2aa175619a004762d45fd65", "html_url": "https://github.com/rust-lang/rust/commit/50e28aec25197d0aa2aa175619a004762d45fd65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50e28aec25197d0aa2aa175619a004762d45fd65/comments", "author": {"login": "ivan770", "id": 14003886, "node_id": "MDQ6VXNlcjE0MDAzODg2", "avatar_url": "https://avatars.githubusercontent.com/u/14003886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ivan770", "html_url": "https://github.com/ivan770", "followers_url": "https://api.github.com/users/ivan770/followers", "following_url": "https://api.github.com/users/ivan770/following{/other_user}", "gists_url": "https://api.github.com/users/ivan770/gists{/gist_id}", "starred_url": "https://api.github.com/users/ivan770/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ivan770/subscriptions", "organizations_url": "https://api.github.com/users/ivan770/orgs", "repos_url": "https://api.github.com/users/ivan770/repos", "events_url": "https://api.github.com/users/ivan770/events{/privacy}", "received_events_url": "https://api.github.com/users/ivan770/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ivan770", "id": 14003886, "node_id": "MDQ6VXNlcjE0MDAzODg2", "avatar_url": "https://avatars.githubusercontent.com/u/14003886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ivan770", "html_url": "https://github.com/ivan770", "followers_url": "https://api.github.com/users/ivan770/followers", "following_url": "https://api.github.com/users/ivan770/following{/other_user}", "gists_url": "https://api.github.com/users/ivan770/gists{/gist_id}", "starred_url": "https://api.github.com/users/ivan770/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ivan770/subscriptions", "organizations_url": "https://api.github.com/users/ivan770/orgs", "repos_url": "https://api.github.com/users/ivan770/repos", "events_url": "https://api.github.com/users/ivan770/events{/privacy}", "received_events_url": "https://api.github.com/users/ivan770/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4cb3ecce3ff2573c8473733b2538b32cd899b686", "url": "https://api.github.com/repos/rust-lang/rust/commits/4cb3ecce3ff2573c8473733b2538b32cd899b686", "html_url": "https://github.com/rust-lang/rust/commit/4cb3ecce3ff2573c8473733b2538b32cd899b686"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "7e4c5a07820fa99e14cdf5b8dd22f5bf75b28789", "filename": "crates/ide/src/runnables.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/50e28aec25197d0aa2aa175619a004762d45fd65/crates%2Fide%2Fsrc%2Frunnables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e28aec25197d0aa2aa175619a004762d45fd65/crates%2Fide%2Fsrc%2Frunnables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frunnables.rs?ref=50e28aec25197d0aa2aa175619a004762d45fd65", "patch": "@@ -226,7 +226,9 @@ pub(crate) fn runnable_fn(sema: &Semantics<RootDatabase>, def: hir::Function) ->\n     let func = def.source(sema.db)?;\n     let name_string = def.name(sema.db).to_string();\n \n-    let kind = if name_string == \"main\" {\n+    let root = def.krate(sema.db)?.root_module(sema.db);\n+\n+    let kind = if name_string == \"main\" && def.module(sema.db) == root {\n         RunnableKind::Bin\n     } else {\n         let canonical_path = {\n@@ -444,6 +446,10 @@ fn test_foo() {}\n \n #[bench]\n fn bench() {}\n+\n+mod not_a_root {\n+    fn main() {}\n+}\n \"#,\n             &[&BIN, &TEST, &TEST, &BENCH],\n             expect![[r#\""}]}