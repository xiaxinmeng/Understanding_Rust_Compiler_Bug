{"sha": "29793e7de978c9f0fa2d46bad624fc49d2506b11", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5NzkzZTdkZTk3OGM5ZjBmYTJkNDZiYWQ2MjRmYzQ5ZDI1MDZiMTE=", "commit": {"author": {"name": "Florian Diebold", "email": "florian.diebold@freiheit.com", "date": "2018-12-06T20:26:23Z"}, "committer": {"name": "Florian Diebold", "email": "florian.diebold@freiheit.com", "date": "2018-12-06T20:32:15Z"}, "message": "Add test for code actions", "tree": {"sha": "513b56d0c4757f37fa318b964ac1f630e246680b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/513b56d0c4757f37fa318b964ac1f630e246680b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29793e7de978c9f0fa2d46bad624fc49d2506b11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29793e7de978c9f0fa2d46bad624fc49d2506b11", "html_url": "https://github.com/rust-lang/rust/commit/29793e7de978c9f0fa2d46bad624fc49d2506b11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29793e7de978c9f0fa2d46bad624fc49d2506b11/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1dfd06fc8aadd5d621112716fe0e59aed5dfc767", "url": "https://api.github.com/repos/rust-lang/rust/commits/1dfd06fc8aadd5d621112716fe0e59aed5dfc767", "html_url": "https://github.com/rust-lang/rust/commit/1dfd06fc8aadd5d621112716fe0e59aed5dfc767"}], "stats": {"total": 61, "additions": 60, "deletions": 1}, "files": [{"sha": "26f5e3f200a809decc210d6cc73e45a3a54d93ff", "filename": "crates/ra_lsp_server/tests/heavy_tests/main.rs", "status": "modified", "additions": 60, "deletions": 1, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/29793e7de978c9f0fa2d46bad624fc49d2506b11/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29793e7de978c9f0fa2d46bad624fc49d2506b11/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Ftests%2Fheavy_tests%2Fmain.rs?ref=29793e7de978c9f0fa2d46bad624fc49d2506b11", "patch": "@@ -2,7 +2,9 @@ mod support;\n \n use serde_json::json;\n \n-use ra_lsp_server::req::{Runnables, RunnablesParams};\n+use ra_lsp_server::req::{Runnables, RunnablesParams, CodeActionRequest, CodeActionParams};\n+\n+use languageserver_types::{Position, Range, CodeActionContext};\n \n use crate::support::project;\n \n@@ -116,3 +118,60 @@ fn test_eggs() {}\n         ])\n     );\n }\n+\n+#[test]\n+fn test_missing_module_code_action() {\n+    let server = project(\n+        r#\"\n+//- Cargo.toml\n+[package]\n+name = \"foo\"\n+version = \"0.0.0\"\n+\n+//- src/lib.rs\n+mod bar;\n+\n+fn main() {}\n+\"#,\n+    );\n+    server.wait_for_feedback(\"workspace loaded\");\n+    let empty_context = || CodeActionContext {\n+        diagnostics: Vec::new(),\n+        only: None,\n+    };\n+    server.request::<CodeActionRequest>(\n+        CodeActionParams {\n+            text_document: server.doc_id(\"src/lib.rs\"),\n+            range: Range::new(Position::new(0, 0), Position::new(0, 7)),\n+            context: empty_context(),\n+        },\n+        json!([\n+            {\n+              \"arguments\": [\n+                {\n+                  \"cursorPosition\": null,\n+                  \"fileSystemEdits\": [\n+                    {\n+                        \"type\": \"createFile\",\n+                        \"uri\": \"file:///[..]/src/bar.rs\"\n+                    }\n+                  ],\n+                  \"label\": \"create module\",\n+                  \"sourceFileEdits\": []\n+                }\n+              ],\n+              \"command\": \"ra-lsp.applySourceChange\",\n+              \"title\": \"create module\"\n+            }\n+        ]),\n+    );\n+\n+    server.request::<CodeActionRequest>(\n+        CodeActionParams {\n+            text_document: server.doc_id(\"src/lib.rs\"),\n+            range: Range::new(Position::new(2, 0), Position::new(2, 7)),\n+            context: empty_context(),\n+        },\n+        json!([]),\n+    );\n+}"}]}