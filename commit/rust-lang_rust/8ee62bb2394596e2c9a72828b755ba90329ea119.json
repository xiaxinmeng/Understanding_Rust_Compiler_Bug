{"sha": "8ee62bb2394596e2c9a72828b755ba90329ea119", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlZTYyYmIyMzk0NTk2ZTJjOWE3MjgyOGI3NTViYTkwMzI5ZWExMTk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-11-30T22:31:04Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-11-30T22:31:04Z"}, "message": "ci: Only run compare-mode tests on one builder\n\nThe run-pass test suite currently takes 30 minutes on Windows, and\nthat appears to be roughly split between two 15 minute runs of the test\nsuite: one without NLL and one with NLL. In discussion on Discord the\nplatform coverage of the NLL compare mode may not necessarily be worth\nit, so this commit removes the NLL compare mode from tests by default,\nand then reenables it on only one builder.", "tree": {"sha": "538024063407f41d7843d4320e7edfe7df27c08b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/538024063407f41d7843d4320e7edfe7df27c08b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ee62bb2394596e2c9a72828b755ba90329ea119", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ee62bb2394596e2c9a72828b755ba90329ea119", "html_url": "https://github.com/rust-lang/rust/commit/8ee62bb2394596e2c9a72828b755ba90329ea119", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ee62bb2394596e2c9a72828b755ba90329ea119/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d09466ceb1374bd0ff1c490bfd50133b8ca67558", "url": "https://api.github.com/repos/rust-lang/rust/commits/d09466ceb1374bd0ff1c490bfd50133b8ca67558", "html_url": "https://github.com/rust-lang/rust/commit/d09466ceb1374bd0ff1c490bfd50133b8ca67558"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "f75e220de47e7c1c043afe6dcef3f7b8972ac4ff", "filename": "config.toml.example", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8ee62bb2394596e2c9a72828b755ba90329ea119/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/8ee62bb2394596e2c9a72828b755ba90329ea119/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=8ee62bb2394596e2c9a72828b755ba90329ea119", "patch": "@@ -400,6 +400,11 @@\n # override the default allocator for rustc and LLVM.\n #jemalloc = false\n \n+# Run tests in various test suites with the \"nll compare mode\" in addition to\n+# running the tests in normal mode. Largely only used on CI and during local\n+# development of NLL\n+#test-compare-mode = false\n+\n # =============================================================================\n # Options for specific targets\n #"}, {"sha": "8fc2d5787cb4b85a716d6b105cbf749aa3ed1d52", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=8ee62bb2394596e2c9a72828b755ba90329ea119", "patch": "@@ -58,6 +58,7 @@ pub struct Config {\n     pub ignore_git: bool,\n     pub exclude: Vec<PathBuf>,\n     pub rustc_error_format: Option<String>,\n+    pub test_compare_mode: bool,\n \n     pub run_host_only: bool,\n \n@@ -326,6 +327,7 @@ struct Rust {\n     verify_llvm_ir: Option<bool>,\n     remap_debuginfo: Option<bool>,\n     jemalloc: Option<bool>,\n+    test_compare_mode: Option<bool>,\n }\n \n /// TOML representation of how each build target is configured.\n@@ -540,6 +542,7 @@ impl Config {\n             set(&mut config.codegen_tests, rust.codegen_tests);\n             set(&mut config.rust_rpath, rust.rpath);\n             set(&mut config.jemalloc, rust.jemalloc);\n+            set(&mut config.test_compare_mode, rust.test_compare_mode);\n             set(&mut config.backtrace, rust.backtrace);\n             set(&mut config.channel, rust.channel.clone());\n             set(&mut config.rust_dist_src, rust.dist_src);"}, {"sha": "da827356800e96ed76a04f846a1d16057923a3c9", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=8ee62bb2394596e2c9a72828b755ba90329ea119", "patch": "@@ -1022,7 +1022,13 @@ impl Step for Compiletest {\n             cmd.arg(\"--bless\");\n         }\n \n-        let compare_mode = builder.config.cmd.compare_mode().or(self.compare_mode);\n+        let compare_mode = builder.config.cmd.compare_mode().or_else(|| {\n+            if builder.config.test_compare_mode {\n+                self.compare_mode\n+            } else {\n+                None\n+            }\n+        });\n \n         if let Some(ref nodejs) = builder.config.nodejs {\n             cmd.arg(\"--nodejs\").arg(nodejs);"}, {"sha": "b0780fdf32a5926a56ec95668367d5aa9f5b670b", "filename": "src/ci/docker/x86_64-gnu-nopt/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/8ee62bb2394596e2c9a72828b755ba90329ea119/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile?ref=8ee62bb2394596e2c9a72828b755ba90329ea119", "patch": "@@ -16,5 +16,7 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --disable-optimize-tests\n+ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu \\\n+  --disable-optimize-tests \\\n+  --set rust.test-compare-mode\n ENV RUST_CHECK_TARGET check"}]}