{"sha": "330c9c6c3592496462dbf9aa716a37e048b00172", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMGM5YzZjMzU5MjQ5NjQ2MmRiZjlhYTcxNmEzN2UwNDhiMDAxNzI=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-03-06T18:42:50Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-06T23:13:28Z"}, "message": "Make _str.bytes use _vec.init_fn. Remove FIXME.", "tree": {"sha": "97b2e94088ee5aa094da2e83d6ccda0aaa071f17", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97b2e94088ee5aa094da2e83d6ccda0aaa071f17"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/330c9c6c3592496462dbf9aa716a37e048b00172", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/330c9c6c3592496462dbf9aa716a37e048b00172", "html_url": "https://github.com/rust-lang/rust/commit/330c9c6c3592496462dbf9aa716a37e048b00172", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/330c9c6c3592496462dbf9aa716a37e048b00172/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "138c55a69d44371e4de04ed538c787dec46a7200", "url": "https://api.github.com/repos/rust-lang/rust/commits/138c55a69d44371e4de04ed538c787dec46a7200", "html_url": "https://github.com/rust-lang/rust/commit/138c55a69d44371e4de04ed538c787dec46a7200"}], "stats": {"total": 21, "additions": 3, "deletions": 18}, "files": [{"sha": "0e0e7650943bf0b1723269349cff834eb5d7cb2f", "filename": "src/lib/_str.rs", "status": "modified", "additions": 3, "deletions": 18, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/330c9c6c3592496462dbf9aa716a37e048b00172/src%2Flib%2F_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/330c9c6c3592496462dbf9aa716a37e048b00172/src%2Flib%2F_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2F_str.rs?ref=330c9c6c3592496462dbf9aa716a37e048b00172", "patch": "@@ -96,25 +96,10 @@ fn buf(str s) -> sbuf {\n }\n \n fn bytes(str s) -> vec[u8] {\n-    /* FIXME (issue #58):\n-     * Should be...\n-     *\n-     *  fn ith(str s, uint i) -> u8 {\n-     *      ret s.(i);\n-     *  }\n-     *  ret _vec.init_fn[u8](bind ith(s, _), byte_len(s));\n-     *\n-     * but we do not correctly decrement refcount of s when\n-     * the binding dies, so we have to do this manually.\n-     */\n-    let uint n = _str.byte_len(s);\n-    let vec[u8] v = _vec.alloc[u8](n);\n-    let uint i = 0u;\n-    while (i < n) {\n-        v += vec(s.(i));\n-        i += 1u;\n+    fn ith(str s, uint i) -> u8 {\n+        ret s.(i);\n     }\n-    ret v;\n+    ret _vec.init_fn[u8](bind ith(s, _), byte_len(s));\n }\n \n fn from_bytes(vec[u8] v) : is_utf8(v) -> str {"}]}