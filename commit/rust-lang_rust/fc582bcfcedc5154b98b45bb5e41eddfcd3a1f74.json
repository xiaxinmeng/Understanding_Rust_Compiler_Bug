{"sha": "fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjNTgyYmNmY2VkYzUxNTRiOThiNDViYjVlNDFlZGRmY2QzYTFmNzQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-01-14T20:56:31Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-01-14T20:56:31Z"}, "message": "Merge remote-tracking branch 'mneumann/f-serialize'", "tree": {"sha": "bd42e7dac410c924c8f22db56536f7ce6f07df1b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd42e7dac410c924c8f22db56536f7ce6f07df1b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "html_url": "https://github.com/rust-lang/rust/commit/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76bcfe8025249c787cba04f2fb035f4915db0a36", "url": "https://api.github.com/repos/rust-lang/rust/commits/76bcfe8025249c787cba04f2fb035f4915db0a36", "html_url": "https://github.com/rust-lang/rust/commit/76bcfe8025249c787cba04f2fb035f4915db0a36"}, {"sha": "2b6c456bf648e5a7b408b550649d409378e39539", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b6c456bf648e5a7b408b550649d409378e39539", "html_url": "https://github.com/rust-lang/rust/commit/2b6c456bf648e5a7b408b550649d409378e39539"}], "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "dc379cec21b59f5ed977b470e73a025522274136", "filename": "src/libstd/ebml.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Febml.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Febml.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Febml.rs?ref=fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "patch": "@@ -379,7 +379,7 @@ pub mod reader {\n             f()\n         }\n \n-        fn read_struct<T>(&self, name: &str, f: fn() -> T) -> T {\n+        fn read_struct<T>(&self, name: &str, _len: uint, f: fn() -> T) -> T {\n             debug!(\"read_struct(name=%s)\", name);\n             f()\n         }\n@@ -658,7 +658,7 @@ pub mod writer {\n         }\n \n         fn emit_rec(&self, f: fn()) { f() }\n-        fn emit_struct(&self, _name: &str, f: fn()) { f() }\n+        fn emit_struct(&self, _name: &str, _len: uint, f: fn()) { f() }\n         fn emit_field(&self, name: &str, _idx: uint, f: fn()) {\n             self._emit_label(name);\n             f()"}, {"sha": "0dea73981db56e5ae994bf27cc12c230c131c415", "filename": "src/libstd/json.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fjson.rs?ref=fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "patch": "@@ -157,7 +157,7 @@ pub impl Encoder: serialize::Encoder {\n         f();\n         self.wr.write_char('}');\n     }\n-    fn emit_struct(&self, _name: &str, f: fn()) {\n+    fn emit_struct(&self, _name: &str, _len: uint, f: fn()) {\n         self.wr.write_char('{');\n         f();\n         self.wr.write_char('}');\n@@ -270,7 +270,7 @@ pub impl PrettyEncoder: serialize::Encoder {\n         self.indent -= 2;\n         self.wr.write_char('}');\n     }\n-    fn emit_struct(&self, _name: &str, f: fn()) {\n+    fn emit_struct(&self, _name: &str, _len: uint, f: fn()) {\n         self.emit_rec(f)\n     }\n     fn emit_field(&self, name: &str, idx: uint, f: fn()) {\n@@ -870,7 +870,7 @@ pub impl Decoder: serialize::Decoder {\n         move value\n     }\n \n-    fn read_struct<T>(&self, _name: &str, f: fn() -> T) -> T {\n+    fn read_struct<T>(&self, _name: &str, _len: uint, f: fn() -> T) -> T {\n         debug!(\"read_struct()\");\n         let value = f();\n         self.pop();"}, {"sha": "d07c29d624ce54c131c0ce35f10010925bf636df", "filename": "src/libstd/prettyprint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fprettyprint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fprettyprint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprettyprint.rs?ref=fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "patch": "@@ -162,7 +162,7 @@ pub impl Serializer: serialize::Encoder {\n         self.wr.write_str(~\"}\");\n     }\n \n-    fn emit_struct(&self, name: &str, f: fn()) {\n+    fn emit_struct(&self, name: &str, _len: uint, f: fn()) {\n         self.wr.write_str(fmt!(\"%s {\", name));\n         f();\n         self.wr.write_str(~\"}\");"}, {"sha": "708df015dae49969138bf48d117389f8abdd2186", "filename": "src/libstd/serialize.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fserialize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibstd%2Fserialize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fserialize.rs?ref=fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "patch": "@@ -58,7 +58,7 @@ pub trait Encoder {\n     fn emit_vec_elt(&self, idx: uint, f: fn());\n \n     fn emit_rec(&self, f: fn());\n-    fn emit_struct(&self, name: &str, f: fn());\n+    fn emit_struct(&self, name: &str, _len: uint, f: fn());\n     fn emit_field(&self, f_name: &str, f_idx: uint, f: fn());\n \n     fn emit_tup(&self, len: uint, f: fn());\n@@ -99,7 +99,7 @@ pub trait Decoder {\n     fn read_vec_elt<T>(&self, idx: uint, f: fn() -> T) -> T;\n \n     fn read_rec<T>(&self, f: fn() -> T) -> T;\n-    fn read_struct<T>(&self, name: &str, f: fn() -> T) -> T;\n+    fn read_struct<T>(&self, name: &str, _len: uint, f: fn() -> T) -> T;\n     fn read_field<T>(&self, name: &str, idx: uint, f: fn() -> T) -> T;\n \n     fn read_tup<T>(&self, sz: uint, f: fn() -> T) -> T;"}, {"sha": "4afd2e1f7f8fb101420ac50c84b3e8d0477110ac", "filename": "src/libsyntax/ext/auto_encode.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fauto_encode.rs?ref=fc582bcfcedc5154b98b45bb5e41eddfcd3a1f74", "patch": "@@ -25,15 +25,15 @@ would generate two implementations like:\n \n     impl<S: Encoder> node_id: Encodable<S> {\n         fn encode(s: &S) {\n-            do s.emit_struct(\"Node\") {\n+            do s.emit_struct(\"Node\", 1) {\n                 s.emit_field(\"id\", 0, || s.emit_uint(self))\n             }\n         }\n     }\n \n     impl<D: Decoder> node_id: Decodable {\n         static fn decode(d: &D) -> Node {\n-            do d.read_struct(\"Node\") {\n+            do d.read_struct(\"Node\", 1) {\n                 Node {\n                     id: d.read_field(~\"x\", 0, || decode(d))\n                 }\n@@ -709,6 +709,7 @@ fn mk_struct_ser_impl(\n         ),\n         ~[\n             cx.lit_str(span, @cx.str_of(ident)),\n+            cx.lit_uint(span, vec::len(fields)),\n             cx.lambda_stmts(span, fields),\n         ]\n     );\n@@ -735,6 +736,7 @@ fn mk_struct_deser_impl(\n         ),\n         ~[\n             cx.lit_str(span, @cx.str_of(ident)),\n+            cx.lit_uint(span, vec::len(fields)),\n             cx.lambda_expr(\n                 cx.expr(\n                     span,"}]}