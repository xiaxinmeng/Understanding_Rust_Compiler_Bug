{"sha": "998daf36b9b71549af6606fac8a30c39c21d9218", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OGRhZjM2YjliNzE1NDlhZjY2MDZmYWM4YTMwYzM5YzIxZDkyMTg=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-02-13T20:28:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-13T20:28:00Z"}, "message": "Rollup merge of #68938 - Areredify:gat_lifetime_shadowing, r=estebank\n\nfix lifetime shadowing check in GATs\n\ncloses #67512", "tree": {"sha": "e3be7173f7c1fc7f13ab5e3c8360134ef345ef73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3be7173f7c1fc7f13ab5e3c8360134ef345ef73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/998daf36b9b71549af6606fac8a30c39c21d9218", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeRbFQCRBK7hj4Ov3rIwAAdHIIADoRnU3ZwndrkzaOKf6nXP93\n9/zzrKYQCsTOQ7p2bLT7giQaK+H+8AfK5/ruYbQON9Py+7aqqw3fQMNNEe/H7uDE\n3CPiCFfDaV2NgQ+gBg8NiUb9SNrDf0CB7AVn/Hm2UHttNvX1s7JVFm2XRCeQvRSw\nuT1oQMdxexTRyGS9ctOwumw79zHl7K/AJ70WdgrRf1PmrBic+gDhflLHpizCMsGu\nfXMdnhxF7G/nBZrIOAqiDfahM/YUr5vnjaWG7l2f/mRtz8qiX31svwm89nYvRafI\netvA2pElmc4ryr8/i+VUxpt+3BYhfjsL7uIkWUJFlKMIYs7BoRogSe0LgzHHO5k=\n=lGdS\n-----END PGP SIGNATURE-----\n", "payload": "tree e3be7173f7c1fc7f13ab5e3c8360134ef345ef73\nparent 89f5dcfb4316891fafb34d211b7bebc4cf8638d0\nparent 953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c\nauthor Dylan DPC <dylan.dpc@gmail.com> 1581625680 +0100\ncommitter GitHub <noreply@github.com> 1581625680 +0100\n\nRollup merge of #68938 - Areredify:gat_lifetime_shadowing, r=estebank\n\nfix lifetime shadowing check in GATs\n\ncloses #67512\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/998daf36b9b71549af6606fac8a30c39c21d9218", "html_url": "https://github.com/rust-lang/rust/commit/998daf36b9b71549af6606fac8a30c39c21d9218", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/998daf36b9b71549af6606fac8a30c39c21d9218/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89f5dcfb4316891fafb34d211b7bebc4cf8638d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/89f5dcfb4316891fafb34d211b7bebc4cf8638d0", "html_url": "https://github.com/rust-lang/rust/commit/89f5dcfb4316891fafb34d211b7bebc4cf8638d0"}, {"sha": "953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "url": "https://api.github.com/repos/rust-lang/rust/commits/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "html_url": "https://github.com/rust-lang/rust/commit/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c"}], "stats": {"total": 31, "additions": 25, "deletions": 6}, "files": [{"sha": "5bc5222f9fc15666e479f38be15802fb9668df32", "filename": "src/librustc_resolve/lifetimes.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Flibrustc_resolve%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Flibrustc_resolve%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flifetimes.rs?ref=998daf36b9b71549af6606fac8a30c39c21d9218", "patch": "@@ -747,7 +747,8 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     track_lifetime_uses: true,\n                     opaque_type_parent: true,\n                 };\n-                self.with(scope, |_old_scope, this| {\n+                self.with(scope, |old_scope, this| {\n+                    this.check_lifetime_params(old_scope, &generics.params);\n                     this.visit_generics(generics);\n                     for bound in bounds {\n                         this.visit_param_bound(bound);\n@@ -804,7 +805,8 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     track_lifetime_uses: true,\n                     opaque_type_parent: true,\n                 };\n-                self.with(scope, |_old_scope, this| {\n+                self.with(scope, |old_scope, this| {\n+                    this.check_lifetime_params(old_scope, &generics.params);\n                     this.visit_generics(generics);\n                     this.visit_ty(ty);\n                 });"}, {"sha": "5c308948bd3f87d2574713b0a53362618442172a", "filename": "src/test/ui/generic-associated-types/shadowing.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs?ref=998daf36b9b71549af6606fac8a30c39c21d9218", "patch": "@@ -2,17 +2,17 @@\n #![feature(generic_associated_types)]\n \n trait Shadow<'a> {\n-    //FIXME(#44265): The lifetime parameter shadowing should cause an error.\n     type Bar<'a>;\n+    //~^ ERROR lifetime name `'a` shadows a lifetime name that is already in scope\n }\n \n trait NoShadow<'a> {\n     type Bar<'b>; // OK\n }\n \n impl<'a> NoShadow<'a> for &'a u32 {\n-    //FIXME(#44265): The lifetime parameter shadowing should cause an error.\n     type Bar<'a> = i32;\n+    //~^ ERROR lifetime name `'a` shadows a lifetime name that is already in scope\n }\n \n trait ShadowT<T> {"}, {"sha": "2d9a0d6fceb2dbaf6754faa28268dae58531980f", "filename": "src/test/ui/generic-associated-types/shadowing.stderr", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/998daf36b9b71549af6606fac8a30c39c21d9218/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr?ref=998daf36b9b71549af6606fac8a30c39c21d9218", "patch": "@@ -14,6 +14,22 @@ LL | impl<T> NoShadowT<T> for Option<T> {\n LL |     type Bar<T> = i32;\n    |              ^ already used\n \n+error[E0496]: lifetime name `'a` shadows a lifetime name that is already in scope\n+  --> $DIR/shadowing.rs:5:14\n+   |\n+LL | trait Shadow<'a> {\n+   |              -- first declared here\n+LL |     type Bar<'a>;\n+   |              ^^ lifetime 'a already in scope\n+\n+error[E0496]: lifetime name `'a` shadows a lifetime name that is already in scope\n+  --> $DIR/shadowing.rs:14:14\n+   |\n+LL | impl<'a> NoShadow<'a> for &'a u32 {\n+   |      -- first declared here\n+LL |     type Bar<'a> = i32;\n+   |              ^^ lifetime 'a already in scope\n+\n error: type-generic associated types are not yet implemented\n   --> $DIR/shadowing.rs:19:5\n    |\n@@ -30,6 +46,7 @@ LL |     type Bar<U>; // OK\n    |\n    = note: for more information, see issue #44265 <https://github.com/rust-lang/rust/issues/44265> for more information\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 6 previous errors\n \n-For more information about this error, try `rustc --explain E0403`.\n+Some errors have detailed explanations: E0403, E0496.\n+For more information about an error, try `rustc --explain E0403`."}]}