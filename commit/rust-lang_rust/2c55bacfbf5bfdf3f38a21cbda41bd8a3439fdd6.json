{"sha": "2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjNTViYWNmYmY1YmZkZjNmMzhhMjFjYmRhNDFiZDhhMzQzOWZkZDY=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-04-07T11:07:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-07T11:07:11Z"}, "message": "Rollup merge of #83634 - JohnTitor:proc-macro-ice, r=varkor\n\nDo not emit the advanced diagnostics on macros\n\nFixes #83510", "tree": {"sha": "4a766d352410194e3de77e1172e42182d84ae7be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a766d352410194e3de77e1172e42182d84ae7be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgbZJfCRBK7hj4Ov3rIwAAdHIIADT9JHZlahdr07X/xqFYxsrh\n52NdCHqHtP6talkAc8wRScriEa2Hvu7yYuVnSOeayirVd+QYvtGZRj5483qVJjWQ\n90WtXZgpAeLcFIXQxMKYaTQHoQrJrnjTDSqFkpfP5WZLZQWjgiQE0uOYPLMWOK2m\nvO79RtJvlHZJZd7AJvaZ7wNKwqYjAe5qmffYuA0WVWmsxCOJ9V5mnRCZtVfMTB+d\nw/Tr9AWweMNEAH2FwgtyMw3HCfOm/Cf8AaPjB+HAD76S1taWYsGq8Dwk4RQWWACz\nNLxsWtIIC9AMbUqj/zZJayeJveaYYsld2FKCY7c57orDiteIm1Ixa7hXSn70NQ4=\n=KhGs\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a766d352410194e3de77e1172e42182d84ae7be\nparent 505846ec07c1303369358a1c3358c7d7ee0ca12e\nparent 960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2\nauthor Dylan DPC <dylan.dpc@gmail.com> 1617793631 +0200\ncommitter GitHub <noreply@github.com> 1617793631 +0200\n\nRollup merge of #83634 - JohnTitor:proc-macro-ice, r=varkor\n\nDo not emit the advanced diagnostics on macros\n\nFixes #83510\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "html_url": "https://github.com/rust-lang/rust/commit/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "505846ec07c1303369358a1c3358c7d7ee0ca12e", "url": "https://api.github.com/repos/rust-lang/rust/commits/505846ec07c1303369358a1c3358c7d7ee0ca12e", "html_url": "https://github.com/rust-lang/rust/commit/505846ec07c1303369358a1c3358c7d7ee0ca12e"}, {"sha": "960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "html_url": "https://github.com/rust-lang/rust/commit/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2"}], "stats": {"total": 72, "additions": 71, "deletions": 1}, "files": [{"sha": "6fae6921fc9b2342a2e19ed3bbc38c539992b18f", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "patch": "@@ -456,12 +456,14 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             }\n         }\n \n+        let is_macro = base_span.from_expansion() && base_span.desugaring_kind().is_none();\n         if !self.type_ascription_suggestion(&mut err, base_span) {\n             let mut fallback = false;\n             if let (\n                 PathSource::Trait(AliasPossibility::Maybe),\n                 Some(Res::Def(DefKind::Struct | DefKind::Enum | DefKind::Union, _)),\n-            ) = (source, res)\n+                false,\n+            ) = (source, res, is_macro)\n             {\n                 if let Some(bounds @ [_, .., _]) = self.diagnostic_metadata.current_trait_object {\n                     fallback = true;"}, {"sha": "1d6ef3914a91b0bee564d5dd8cd4158892711667", "filename": "src/test/ui/proc-macro/auxiliary/issue-83510.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs?ref=2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "patch": "@@ -0,0 +1,19 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro]\n+pub fn dance_like_you_want_to_ice(_: TokenStream) -> TokenStream {\n+    r#\"\n+    impl Foo {\n+        type Bar = Box<()> + Baz;\n+    }\n+    \"#\n+    .parse()\n+    .unwrap()\n+}"}, {"sha": "2b1aec4df0be3eb734af6133d468dd846b1548af", "filename": "src/test/ui/proc-macro/issue-83510.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs?ref=2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "patch": "@@ -0,0 +1,11 @@\n+// aux-build: issue-83510.rs\n+\n+extern crate issue_83510;\n+\n+issue_83510::dance_like_you_want_to_ice!();\n+//~^ ERROR: cannot find type `Foo` in this scope\n+//~| ERROR: expected trait, found struct `Box`\n+//~| ERROR: cannot find trait `Baz` in this scope\n+//~| ERROR: inherent associated types are unstable\n+\n+fn main() {}"}, {"sha": "e0803550906db248c463ebe0f7405211297f3f0d", "filename": "src/test/ui/proc-macro/issue-83510.stderr", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr?ref=2c55bacfbf5bfdf3f38a21cbda41bd8a3439fdd6", "patch": "@@ -0,0 +1,38 @@\n+error[E0412]: cannot find type `Foo` in this scope\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in this scope\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0404]: expected trait, found struct `Box`\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not a trait\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0405]: cannot find trait `Baz` in this scope\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in this scope\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0658]: inherent associated types are unstable\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #8995 <https://github.com/rust-lang/rust/issues/8995> for more information\n+   = help: add `#![feature(inherent_associated_types)]` to the crate attributes to enable\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to 4 previous errors\n+\n+Some errors have detailed explanations: E0404, E0405, E0412, E0658.\n+For more information about an error, try `rustc --explain E0404`."}]}