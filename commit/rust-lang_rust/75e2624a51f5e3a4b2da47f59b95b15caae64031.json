{"sha": "75e2624a51f5e3a4b2da47f59b95b15caae64031", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1ZTI2MjRhNTFmNWUzYTRiMmRhNDdmNTliOTViMTVjYWFlNjQwMzE=", "commit": {"author": {"name": "Tim Neumann", "email": "mail@timnn.me", "date": "2016-08-04T13:06:26Z"}, "committer": {"name": "Tim Neumann", "email": "mail@timnn.me", "date": "2016-08-04T19:59:35Z"}, "message": "track current_item in Deprecated lint pass", "tree": {"sha": "d730b38fad9db5feb1873a2f2dbcab6de2911696", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d730b38fad9db5feb1873a2f2dbcab6de2911696"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75e2624a51f5e3a4b2da47f59b95b15caae64031", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75e2624a51f5e3a4b2da47f59b95b15caae64031", "html_url": "https://github.com/rust-lang/rust/commit/75e2624a51f5e3a4b2da47f59b95b15caae64031", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75e2624a51f5e3a4b2da47f59b95b15caae64031/comments", "author": {"login": "TimNN", "id": 1178249, "node_id": "MDQ6VXNlcjExNzgyNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimNN", "html_url": "https://github.com/TimNN", "followers_url": "https://api.github.com/users/TimNN/followers", "following_url": "https://api.github.com/users/TimNN/following{/other_user}", "gists_url": "https://api.github.com/users/TimNN/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimNN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimNN/subscriptions", "organizations_url": "https://api.github.com/users/TimNN/orgs", "repos_url": "https://api.github.com/users/TimNN/repos", "events_url": "https://api.github.com/users/TimNN/events{/privacy}", "received_events_url": "https://api.github.com/users/TimNN/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TimNN", "id": 1178249, "node_id": "MDQ6VXNlcjExNzgyNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimNN", "html_url": "https://github.com/TimNN", "followers_url": "https://api.github.com/users/TimNN/followers", "following_url": "https://api.github.com/users/TimNN/following{/other_user}", "gists_url": "https://api.github.com/users/TimNN/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimNN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimNN/subscriptions", "organizations_url": "https://api.github.com/users/TimNN/orgs", "repos_url": "https://api.github.com/users/TimNN/repos", "events_url": "https://api.github.com/users/TimNN/events{/privacy}", "received_events_url": "https://api.github.com/users/TimNN/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ef1e7e0efe7129edbf06a699abaa6563e8cfc9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ef1e7e0efe7129edbf06a699abaa6563e8cfc9e", "html_url": "https://github.com/rust-lang/rust/commit/5ef1e7e0efe7129edbf06a699abaa6563e8cfc9e"}], "stats": {"total": 59, "additions": 56, "deletions": 3}, "files": [{"sha": "ac33fb610c56641ad5aab02852da54e24da82160", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 55, "deletions": 2, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/75e2624a51f5e3a4b2da47f59b95b15caae64031/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e2624a51f5e3a4b2da47f59b95b15caae64031/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=75e2624a51f5e3a4b2da47f59b95b15caae64031", "patch": "@@ -567,10 +567,21 @@ declare_lint! {\n }\n \n /// Checks for use of items with `#[deprecated]` or `#[rustc_deprecated]` attributes\n-#[derive(Copy, Clone)]\n-pub struct Deprecated;\n+#[derive(Clone)]\n+pub struct Deprecated {\n+    /// Tracks the `NodeId` of the current item.\n+    ///\n+    /// This is required since not all node ids are present in the hir map.\n+    current_item: ast::NodeId,\n+}\n \n impl Deprecated {\n+    pub fn new() -> Deprecated {\n+        Deprecated {\n+            current_item: ast::CRATE_NODE_ID,\n+        }\n+    }\n+\n     fn lint(&self, cx: &LateContext, _id: DefId, span: Span,\n             stability: &Option<&attr::Stability>, deprecation: &Option<attr::Deprecation>) {\n         // Deprecated attributes apply in-crate and cross-crate.\n@@ -591,6 +602,19 @@ impl Deprecated {\n             cx.span_lint(lint, span, &msg);\n         }\n     }\n+\n+    fn push_item(&mut self, item_id: ast::NodeId) {\n+        self.current_item = item_id;\n+    }\n+\n+    fn item_post(&mut self, cx: &LateContext, item_id: ast::NodeId) {\n+        assert_eq!(self.current_item, item_id);\n+        self.current_item = cx.tcx.map.get_parent(item_id);\n+    }\n+\n+    fn parent_def(&self, cx: &LateContext) -> DefId {\n+        cx.tcx.map.local_def_id(self.current_item)\n+    }\n }\n \n impl LintPass for Deprecated {\n@@ -601,11 +625,16 @@ impl LintPass for Deprecated {\n \n impl LateLintPass for Deprecated {\n     fn check_item(&mut self, cx: &LateContext, item: &hir::Item) {\n+        self.push_item(item.id);\n         stability::check_item(cx.tcx, item, false,\n                               &mut |id, sp, stab, depr|\n                                 self.lint(cx, id, sp, &stab, &depr));\n     }\n \n+    fn check_item_post(&mut self, cx: &LateContext, item: &hir::Item) {\n+        self.item_post(cx, item.id);\n+    }\n+\n     fn check_expr(&mut self, cx: &LateContext, e: &hir::Expr) {\n         stability::check_expr(cx.tcx, e,\n                               &mut |id, sp, stab, depr|\n@@ -629,6 +658,30 @@ impl LateLintPass for Deprecated {\n                              &mut |id, sp, stab, depr|\n                                 self.lint(cx, id, sp, &stab, &depr));\n     }\n+\n+    fn check_impl_item(&mut self, _: &LateContext, item: &hir::ImplItem) {\n+        self.push_item(item.id);\n+    }\n+\n+    fn check_impl_item_post(&mut self, cx: &LateContext, item: &hir::ImplItem) {\n+        self.item_post(cx, item.id);\n+    }\n+\n+    fn check_trait_item(&mut self, _: &LateContext, item: &hir::TraitItem) {\n+        self.push_item(item.id);\n+    }\n+\n+    fn check_trait_item_post(&mut self, cx: &LateContext, item: &hir::TraitItem) {\n+        self.item_post(cx, item.id);\n+    }\n+\n+    fn check_foreign_item(&mut self, _: &LateContext, item: &hir::ForeignItem) {\n+        self.push_item(item.id);\n+    }\n+\n+    fn check_foreign_item_post(&mut self, cx: &LateContext, item: &hir::ForeignItem) {\n+        self.item_post(cx, item.id);\n+    }\n }\n \n declare_lint! {"}, {"sha": "43376dfd8c2a0ec6dac298f4ba802f5d4caa84d8", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/75e2624a51f5e3a4b2da47f59b95b15caae64031/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e2624a51f5e3a4b2da47f59b95b15caae64031/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=75e2624a51f5e3a4b2da47f59b95b15caae64031", "patch": "@@ -124,7 +124,6 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n                  UnusedAllocation,\n                  MissingCopyImplementations,\n                  UnstableFeatures,\n-                 Deprecated,\n                  UnconditionalRecursion,\n                  InvalidNoMangleItems,\n                  PluginAsLibrary,\n@@ -133,6 +132,7 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n                  );\n \n     add_builtin_with_new!(sess,\n+                          Deprecated,\n                           TypeLimits,\n                           MissingDoc,\n                           MissingDebugImplementations,"}]}