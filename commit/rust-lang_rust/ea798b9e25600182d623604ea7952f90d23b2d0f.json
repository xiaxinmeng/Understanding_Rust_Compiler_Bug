{"sha": "ea798b9e25600182d623604ea7952f90d23b2d0f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhNzk4YjllMjU2MDAxODJkNjIzNjA0ZWE3OTUyZjkwZDIzYjJkMGY=", "commit": {"author": {"name": "William Throwe", "email": "wtt6@cornell.edu", "date": "2015-11-16T23:35:17Z"}, "committer": {"name": "William Throwe", "email": "wtt6@cornell.edu", "date": "2015-11-16T23:55:07Z"}, "message": "Fix --libdir installs\n\nRather than modifying the installer to disable directory rewriting,\nthis patch modifies the directory structure passed to the installer so\nthat the rewriting gives the correct results.  This means that if a\nnon-standard --libdir is passed to configure then the same --libdir\noption (relative to the --prefix) must be passed to the install\nscript.  In the `make install` case this is handled automatically.\nBinary distributions are generally generated using the default\n--libdir and then have paths optionally rewritten by the installer,\nwhich should continue to work.\n\nThis has the advantage of not complicating the installer interface\nintended for end-user use.\n\nFixes #29561", "tree": {"sha": "dec6b5a47c93163fdd569fc0364eda698ba5b5ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dec6b5a47c93163fdd569fc0364eda698ba5b5ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea798b9e25600182d623604ea7952f90d23b2d0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea798b9e25600182d623604ea7952f90d23b2d0f", "html_url": "https://github.com/rust-lang/rust/commit/ea798b9e25600182d623604ea7952f90d23b2d0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea798b9e25600182d623604ea7952f90d23b2d0f/comments", "author": {"login": "wthrowe", "id": 867117, "node_id": "MDQ6VXNlcjg2NzExNw==", "avatar_url": "https://avatars.githubusercontent.com/u/867117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wthrowe", "html_url": "https://github.com/wthrowe", "followers_url": "https://api.github.com/users/wthrowe/followers", "following_url": "https://api.github.com/users/wthrowe/following{/other_user}", "gists_url": "https://api.github.com/users/wthrowe/gists{/gist_id}", "starred_url": "https://api.github.com/users/wthrowe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wthrowe/subscriptions", "organizations_url": "https://api.github.com/users/wthrowe/orgs", "repos_url": "https://api.github.com/users/wthrowe/repos", "events_url": "https://api.github.com/users/wthrowe/events{/privacy}", "received_events_url": "https://api.github.com/users/wthrowe/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wthrowe", "id": 867117, "node_id": "MDQ6VXNlcjg2NzExNw==", "avatar_url": "https://avatars.githubusercontent.com/u/867117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wthrowe", "html_url": "https://github.com/wthrowe", "followers_url": "https://api.github.com/users/wthrowe/followers", "following_url": "https://api.github.com/users/wthrowe/following{/other_user}", "gists_url": "https://api.github.com/users/wthrowe/gists{/gist_id}", "starred_url": "https://api.github.com/users/wthrowe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wthrowe/subscriptions", "organizations_url": "https://api.github.com/users/wthrowe/orgs", "repos_url": "https://api.github.com/users/wthrowe/repos", "events_url": "https://api.github.com/users/wthrowe/events{/privacy}", "received_events_url": "https://api.github.com/users/wthrowe/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af5d9d65e781d587414b266fb2e5815ed85f0bd3", "url": "https://api.github.com/repos/rust-lang/rust/commits/af5d9d65e781d587414b266fb2e5815ed85f0bd3", "html_url": "https://github.com/rust-lang/rust/commit/af5d9d65e781d587414b266fb2e5815ed85f0bd3"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "87a445000ada4cc617df2def665a60a935394838", "filename": "mk/prepare.mk", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ea798b9e25600182d623604ea7952f90d23b2d0f/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/ea798b9e25600182d623604ea7952f90d23b2d0f/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=ea798b9e25600182d623604ea7952f90d23b2d0f", "patch": "@@ -104,6 +104,11 @@ prepare-host-tool-$(1)-$(2)-$(3)-$(4): prepare-maybe-clean-$(4) \\\n         $$(call PREPARE_MAN,$(1).1),),)\n endef\n \n+# Libraries are compiled using the --libdir provided to configure, but\n+# we store them in the tarball using just \"lib\" so that the install\n+# script can then rewrite them back to the correct path.\n+PREPARE_TAR_LIB_DIR = $(patsubst $(CFG_LIBDIR_RELATIVE)%,lib%,$(1))\n+\n # For host libraries only install dylibs, not rlibs since the host libs are only\n # used to support rustc and rustc uses dynamic linking\n #\n@@ -115,7 +120,7 @@ define DEF_PREPARE_HOST_LIB\n prepare-host-lib-$(1)-$(2)-$(3)-$(4): \\\n \tPREPARE_WORKING_SOURCE_LIB_DIR=$$(HLIB$(2)_H_$(3))\n prepare-host-lib-$(1)-$(2)-$(3)-$(4): \\\n-\tPREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(HLIB_RELATIVE$(2)_H_$(3))\n+\tPREPARE_WORKING_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(call PREPARE_TAR_LIB_DIR,$$(HLIB_RELATIVE$(2)_H_$(3)))\n prepare-host-lib-$(1)-$(2)-$(3)-$(4): prepare-maybe-clean-$(4) \\\n                                  $$(foreach dep,$$(RUST_DEPS_$(1)),prepare-host-lib-$$(dep)-$(2)-$(3)-$(4)) \\\n                                  $$(HLIB$(2)_H_$(3))/stamp.$(1) \\\n@@ -195,7 +200,7 @@ define DEF_PREPARE\n \n prepare-base-$(1)-%: PREPARE_SOURCE_MAN_DIR=$$(S)/man\n prepare-base-$(1)-%: PREPARE_DEST_BIN_DIR=$$(PREPARE_DEST_DIR)/bin\n-prepare-base-$(1)-%: PREPARE_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(CFG_LIBDIR_RELATIVE)\n+prepare-base-$(1)-%: PREPARE_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(call PREPARE_TAR_LIB_DIR,$$(CFG_LIBDIR_RELATIVE))\n prepare-base-$(1)-%: PREPARE_DEST_MAN_DIR=$$(PREPARE_DEST_DIR)/share/man/man1\n \n prepare-base-$(1)-target: prepare-target-$(1)"}]}