{"sha": "308b5585f37ccc71d58f9afc43c573ce02b339d0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwOGI1NTg1ZjM3Y2NjNzFkNThmOWFmYzQzYzU3M2NlMDJiMzM5ZDA=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-08-09T04:17:15Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-08-10T18:44:09Z"}, "message": "Detect JS-style `===` and `!==` and recover\n\nFix #75312.", "tree": {"sha": "ec488ba62842173ea129ba5088257b1ec2803c07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec488ba62842173ea129ba5088257b1ec2803c07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/308b5585f37ccc71d58f9afc43c573ce02b339d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/308b5585f37ccc71d58f9afc43c573ce02b339d0", "html_url": "https://github.com/rust-lang/rust/commit/308b5585f37ccc71d58f9afc43c573ce02b339d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/308b5585f37ccc71d58f9afc43c573ce02b339d0/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18f3be7704a4ec7976fcd1272c728974243d29bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/18f3be7704a4ec7976fcd1272c728974243d29bd", "html_url": "https://github.com/rust-lang/rust/commit/18f3be7704a4ec7976fcd1272c728974243d29bd"}], "stats": {"total": 66, "additions": 66, "deletions": 0}, "files": [{"sha": "81e0c0382f8c2a819550c7ff9dcce8213150d53f", "filename": "src/librustc_parse/parser/expr.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Flibrustc_parse%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Flibrustc_parse%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fparser%2Fexpr.rs?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -195,6 +195,29 @@ impl<'a> Parser<'a> {\n                     return Ok(expr);\n                 }\n             }\n+\n+            if (op.node == AssocOp::Equal || op.node == AssocOp::NotEqual)\n+                && self.token.kind == token::Eq\n+                && self.prev_token.span.hi() == self.token.span.lo()\n+            {\n+                // Look for JS' `===` and `!==` and recover \ud83d\ude07\n+                let sp = op.span.to(self.token.span);\n+                let sugg = match op.node {\n+                    AssocOp::Equal => \"==\",\n+                    AssocOp::NotEqual => \"!=\",\n+                    _ => unreachable!(),\n+                };\n+                self.struct_span_err(sp, &format!(\"invalid comparison operator `{}=`\", sugg))\n+                    .span_suggestion_short(\n+                        sp,\n+                        &format!(\"`{s}=` is not a valid comparison operator, use `{s}`\", s = sugg),\n+                        sugg.to_string(),\n+                        Applicability::MachineApplicable,\n+                    )\n+                    .emit();\n+                self.bump();\n+            }\n+\n             let op = op.node;\n             // Special cases:\n             if op == AssocOp::As {"}, {"sha": "b24d256481c56058c93f7d13b831527317ba31b4", "filename": "src/test/ui/suggestions/js-style-comparison-op-separate-eq-token.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.rs", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.rs?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    if 1 == = 1 { //~ ERROR expected expression\n+        println!(\"yup!\");\n+    }\n+}"}, {"sha": "6adefe3de371e8a87b6d5619c8cbe440625b41cd", "filename": "src/test/ui/suggestions/js-style-comparison-op-separate-eq-token.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op-separate-eq-token.stderr?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -0,0 +1,8 @@\n+error: expected expression, found `=`\n+  --> $DIR/js-style-comparison-op-separate-eq-token.rs:2:13\n+   |\n+LL |     if 1 == = 1 {\n+   |             ^ expected expression\n+\n+error: aborting due to previous error\n+"}, {"sha": "f7e977b918d7dc4b7b545d0e46f8f8e0e6bb10e1", "filename": "src/test/ui/suggestions/js-style-comparison-op.fixed", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.fixed?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -0,0 +1,8 @@\n+// run-rustfix\n+fn main() {\n+    if 1 == 1 { //~ ERROR invalid comparison operator `===`\n+        println!(\"yup!\");\n+    } else if 1 != 1 { //~ ERROR invalid comparison operator `!==`\n+        println!(\"nope!\");\n+    }\n+}"}, {"sha": "c89c1052ed92a471bb69f0afc4d22003b2946c35", "filename": "src/test/ui/suggestions/js-style-comparison-op.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.rs?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -0,0 +1,8 @@\n+// run-rustfix\n+fn main() {\n+    if 1 === 1 { //~ ERROR invalid comparison operator `===`\n+        println!(\"yup!\");\n+    } else if 1 !== 1 { //~ ERROR invalid comparison operator `!==`\n+        println!(\"nope!\");\n+    }\n+}"}, {"sha": "33f7a0844fd2754907cbb9b537ba7fc594e419a9", "filename": "src/test/ui/suggestions/js-style-comparison-op.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/308b5585f37ccc71d58f9afc43c573ce02b339d0/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fjs-style-comparison-op.stderr?ref=308b5585f37ccc71d58f9afc43c573ce02b339d0", "patch": "@@ -0,0 +1,14 @@\n+error: invalid comparison operator `===`\n+  --> $DIR/js-style-comparison-op.rs:3:10\n+   |\n+LL |     if 1 === 1 {\n+   |          ^^^ help: `===` is not a valid comparison operator, use `==`\n+\n+error: invalid comparison operator `!==`\n+  --> $DIR/js-style-comparison-op.rs:5:17\n+   |\n+LL |     } else if 1 !== 1 {\n+   |                 ^^^ help: `!==` is not a valid comparison operator, use `!=`\n+\n+error: aborting due to 2 previous errors\n+"}]}