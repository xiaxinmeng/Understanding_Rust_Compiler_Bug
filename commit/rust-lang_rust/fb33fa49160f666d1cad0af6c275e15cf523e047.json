{"sha": "fb33fa49160f666d1cad0af6c275e15cf523e047", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiMzNmYTQ5MTYwZjY2NmQxY2FkMGFmNmMyNzVlMTVjZjUyM2UwNDc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-11-23T17:31:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-11-23T17:31:54Z"}, "message": "Rollup merge of #56091 - wesleywiser:fix_self_profiler_json, r=petrochenkov\n\nFix json output in the self-profiler\n\nFix missing ',' array element separators and convert NaN's to 0.\n\ncc @Mark-Simulacrum", "tree": {"sha": "c21ed634f74908748a92ff4ca870530858cfec52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c21ed634f74908748a92ff4ca870530858cfec52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb33fa49160f666d1cad0af6c275e15cf523e047", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb+DmLCRBK7hj4Ov3rIwAAdHIIAJn36YweWYVM8ySy0OM2KlYP\nSA/UvHC5ELMuLxgv8EzRIfSS6UywrZQndHRiZky8voQl4vwT6EsojjNUOksh0zDw\n5X0jQOir6iXunyvl10TPfYixutfe/s15W/Iw7VstPXjq6JJesqVk7ARNVH7zIPBR\ndUFc+Y7oaw3RZt9UKj7YOTImZNWGzi1UYO40gpvnnDJnXcfnrhCNVJhpw7IB3/xv\nWOTXAybdE8FMisQe2XkPdUultnzAEzmvJd8eliUd8qCGQF6HzDT533U0Dp5K9+O0\nSjBfICAinpi1pLr05YvWq/pizSC6tMLfkpK71H9gVtTnQjj/Eh5obm6i1ep/oPA=\n=rTB8\n-----END PGP SIGNATURE-----\n", "payload": "tree c21ed634f74908748a92ff4ca870530858cfec52\nparent 1b707f78f5fa7f4658f8f7e7af0a6715fdfa1519\nparent c7dc868ed7b2899f585fa64ede938e665f965067\nauthor kennytm <kennytm@gmail.com> 1542994314 +0800\ncommitter GitHub <noreply@github.com> 1542994314 +0800\n\nRollup merge of #56091 - wesleywiser:fix_self_profiler_json, r=petrochenkov\n\nFix json output in the self-profiler\n\nFix missing ',' array element separators and convert NaN's to 0.\n\ncc @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb33fa49160f666d1cad0af6c275e15cf523e047", "html_url": "https://github.com/rust-lang/rust/commit/fb33fa49160f666d1cad0af6c275e15cf523e047", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb33fa49160f666d1cad0af6c275e15cf523e047/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b707f78f5fa7f4658f8f7e7af0a6715fdfa1519", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b707f78f5fa7f4658f8f7e7af0a6715fdfa1519", "html_url": "https://github.com/rust-lang/rust/commit/1b707f78f5fa7f4658f8f7e7af0a6715fdfa1519"}, {"sha": "c7dc868ed7b2899f585fa64ede938e665f965067", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7dc868ed7b2899f585fa64ede938e665f965067", "html_url": "https://github.com/rust-lang/rust/commit/c7dc868ed7b2899f585fa64ede938e665f965067"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "dfd3f2ee184cebd87cb0490e06783bed66178cec", "filename": "src/librustc/util/profiling.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/fb33fa49160f666d1cad0af6c275e15cf523e047/src%2Flibrustc%2Futil%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb33fa49160f666d1cad0af6c275e15cf523e047/src%2Flibrustc%2Futil%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fprofiling.rs?ref=fb33fa49160f666d1cad0af6c275e15cf523e047", "patch": "@@ -93,16 +93,27 @@ macro_rules! define_categories {\n                 $(\n                     let (hits, total) = self.query_counts.$name;\n \n+                    //normalize hits to 0%\n+                    let hit_percent =\n+                        if total > 0 {\n+                            ((hits as f32) / (total as f32)) * 100.0\n+                        } else {\n+                            0.0\n+                        };\n+\n                     json.push_str(&format!(\n                         \"{{ \\\"category\\\": {}, \\\"time_ms\\\": {},\n-                            \\\"query_count\\\": {}, \\\"query_hits\\\": {} }}\",\n+                            \\\"query_count\\\": {}, \\\"query_hits\\\": {} }},\",\n                         stringify!($name),\n                         self.times.$name / 1_000_000,\n                         total,\n-                        format!(\"{:.2}\", (((hits as f32) / (total as f32)) * 100.0))\n+                        format!(\"{:.2}\", hit_percent)\n                     ));\n                 )*\n \n+                //remove the trailing ',' character\n+                json.pop();\n+\n                 json.push(']');\n \n                 json"}]}