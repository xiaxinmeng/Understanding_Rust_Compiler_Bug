{"sha": "1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "node_id": "C_kwDOAAsO6NoAKDE0MzNiMjk3OWIzYjUxYjQwZGYzMWY5YmY1YWVjYTVmMzFlYTY2ODU", "commit": {"author": {"name": "Nikita Popov", "email": "npopov@redhat.com", "date": "2022-07-27T13:07:58Z"}, "committer": {"name": "Nikita Popov", "email": "npopov@redhat.com", "date": "2022-07-27T14:37:36Z"}, "message": "Make CFI tests opaque pointers compatible", "tree": {"sha": "9a3cb61be4581577a3f450e793e4fb7fe815c00e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a3cb61be4581577a3f450e793e4fb7fe815c00e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "html_url": "https://github.com/rust-lang/rust/commit/1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1433b2979b3b51b40df31f9bf5aeca5f31ea6685/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6f0e358d6fc811b02b9162d275217b5ac389ab6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6f0e358d6fc811b02b9162d275217b5ac389ab6", "html_url": "https://github.com/rust-lang/rust/commit/e6f0e358d6fc811b02b9162d275217b5ac389ab6"}], "stats": {"total": 13, "additions": 6, "deletions": 7}, "files": [{"sha": "8be5186de9e773781e950955272cefc85d29a2ce", "filename": "src/test/codegen/sanitizer-cfi-emit-type-checks.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1433b2979b3b51b40df31f9bf5aeca5f31ea6685/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-checks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1433b2979b3b51b40df31f9bf5aeca5f31ea6685/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-checks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-checks.rs?ref=1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "patch": "@@ -8,11 +8,10 @@\n pub fn foo(f: fn(i32) -> i32, arg: i32) -> i32 {\n     // CHECK-LABEL: define{{.*}}foo{{.*}}!type !{{[0-9]+}}\n     // CHECK:       start:\n-    // CHECK-NEXT:  %0 = bitcast i32 (i32)* %f to i8*\n-    // CHECK-NEXT:  %1 = call i1 @llvm.type.test(i8* %0, metadata !\"{{[[:print:]]+}}\")\n-    // CHECK-NEXT:  br i1 %1, label %type_test.pass, label %type_test.fail\n+    // CHECK:       [[TT:%.+]] = call i1 @llvm.type.test({{i8\\*|ptr}} {{%f|%0}}, metadata !\"{{[[:print:]]+}}\")\n+    // CHECK-NEXT:  br i1 [[TT]], label %type_test.pass, label %type_test.fail\n     // CHECK:       type_test.pass:\n-    // CHECK-NEXT:  %2 = call i32 %f(i32 %arg)\n+    // CHECK-NEXT:  {{%.+}} = call i32 %f(i32 %arg)\n     // CHECK-NEXT:  br label %bb1\n     // CHECK:       type_test.fail:\n     // CHECK-NEXT:  call void @llvm.trap()"}, {"sha": "bafc4c6592f52c9d7cfe6ab307f34d83fef78956", "filename": "src/test/codegen/sanitizer-cfi-emit-type-metadata-itanium-cxx-abi.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1433b2979b3b51b40df31f9bf5aeca5f31ea6685/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-metadata-itanium-cxx-abi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1433b2979b3b51b40df31f9bf5aeca5f31ea6685/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-metadata-itanium-cxx-abi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsanitizer-cfi-emit-type-metadata-itanium-cxx-abi.rs?ref=1433b2979b3b51b40df31f9bf5aeca5f31ea6685", "patch": "@@ -8,21 +8,21 @@\n pub fn foo(f: fn(i32) -> i32, arg: i32) -> i32 {\n     // CHECK-LABEL: define{{.*}}foo\n     // CHECK-SAME: {{.*}}!type ![[TYPE1:[0-9]+]]\n-    // CHECK:       %1 = call i1 @llvm.type.test(i8* %0, metadata !\"_ZTSFu3i32S_E\")\n+    // CHECK:       call i1 @llvm.type.test({{i8\\*|ptr}} {{%f|%0}}, metadata !\"_ZTSFu3i32S_E\")\n     f(arg)\n }\n \n pub fn bar(f: fn(i32, i32) -> i32, arg1: i32, arg2: i32) -> i32 {\n     // CHECK-LABEL: define{{.*}}bar\n     // CHECK-SAME: {{.*}}!type ![[TYPE2:[0-9]+]]\n-    // CHECK:       %1 = call i1 @llvm.type.test(i8* %0, metadata !\"_ZTSFu3i32S_S_E\")\n+    // CHECK:       call i1 @llvm.type.test({{i8\\*|ptr}} {{%f|%0}}, metadata !\"_ZTSFu3i32S_S_E\")\n     f(arg1, arg2)\n }\n \n pub fn baz(f: fn(i32, i32, i32) -> i32, arg1: i32, arg2: i32, arg3: i32) -> i32 {\n     // CHECK-LABEL: define{{.*}}baz\n     // CHECK-SAME: {{.*}}!type ![[TYPE3:[0-9]+]]\n-    // CHECK:       %1 = call i1 @llvm.type.test(i8* %0, metadata !\"_ZTSFu3i32S_S_S_E\")\n+    // CHECK:       call i1 @llvm.type.test({{i8\\*|ptr}} {{%f|%0}}, metadata !\"_ZTSFu3i32S_S_S_E\")\n     f(arg1, arg2, arg3)\n }\n "}]}