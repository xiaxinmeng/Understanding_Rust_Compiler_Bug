{"sha": "3fda7086cc810ce3003b91f74eb1c17e9f016319", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmZGE3MDg2Y2M4MTBjZTMwMDNiOTFmNzRlYjFjMTdlOWYwMTYzMTk=", "commit": {"author": {"name": "Wesley Wiser", "email": "wesleywiser@microsoft.com", "date": "2021-07-28T15:40:53Z"}, "committer": {"name": "Wesley Wiser", "email": "wesleywiser@microsoft.com", "date": "2021-07-29T17:51:27Z"}, "message": "Add regression test", "tree": {"sha": "4bcb198afbda358830e2c7fc01215737a2fff7b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bcb198afbda358830e2c7fc01215737a2fff7b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3fda7086cc810ce3003b91f74eb1c17e9f016319", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3fda7086cc810ce3003b91f74eb1c17e9f016319", "html_url": "https://github.com/rust-lang/rust/commit/3fda7086cc810ce3003b91f74eb1c17e9f016319", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3fda7086cc810ce3003b91f74eb1c17e9f016319/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eba3228b2a9875d268ff3990903d04e19f6cdb0c", "url": "https://api.github.com/repos/rust-lang/rust/commits/eba3228b2a9875d268ff3990903d04e19f6cdb0c", "html_url": "https://github.com/rust-lang/rust/commit/eba3228b2a9875d268ff3990903d04e19f6cdb0c"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "eae3f861519a083de3b1f37963de53a8ec485e68", "filename": "src/test/ui/panics/panic-short-backtrace-windows-x86_64.rs", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/3fda7086cc810ce3003b91f74eb1c17e9f016319/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fda7086cc810ce3003b91f74eb1c17e9f016319/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.rs?ref=3fda7086cc810ce3003b91f74eb1c17e9f016319", "patch": "@@ -0,0 +1,44 @@\n+// Regression test for #87481: short backtrace formatting cut off the entire stack trace.\n+\n+// Codegen-units is specified here so that we can replicate a typical rustc invocation which\n+// is not normally limited to 1 CGU. This is important so that the `__rust_begin_short_backtrace`\n+// and `__rust_end_short_backtrace` symbols are not marked internal to the CGU and thus will be\n+// named in the symbol table.\n+// compile-flags: -O -Ccodegen-units=8\n+\n+// run-fail\n+// check-run-results\n+// exec-env:RUST_BACKTRACE=1\n+\n+// Backtraces are pretty broken in general on i686-pc-windows-msvc (#62897).\n+// only-x86_64-pc-windows-msvc\n+\n+fn main() {\n+    a();\n+}\n+\n+// Make these no_mangle so dbghelp.dll can figure out the symbol names.\n+\n+#[no_mangle]\n+#[inline(never)]\n+fn a() {\n+    b();\n+}\n+\n+#[no_mangle]\n+#[inline(never)]\n+fn b() {\n+    c();\n+}\n+\n+#[no_mangle]\n+#[inline(never)]\n+fn c() {\n+    d();\n+}\n+\n+#[no_mangle]\n+#[inline(never)]\n+fn d() {\n+    panic!(\"d was called\");\n+}"}, {"sha": "f855346532fcebd1498f2e2e95783af14d5649cc", "filename": "src/test/ui/panics/panic-short-backtrace-windows-x86_64.run.stderr", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3fda7086cc810ce3003b91f74eb1c17e9f016319/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3fda7086cc810ce3003b91f74eb1c17e9f016319/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Fpanic-short-backtrace-windows-x86_64.run.stderr?ref=3fda7086cc810ce3003b91f74eb1c17e9f016319", "patch": "@@ -0,0 +1,3 @@\n+thread 'main' panicked at 'd was called', $DIR/panic-short-backtrace-windows-x86_64.rs:43:5\n+stack backtrace:\n+note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace."}]}