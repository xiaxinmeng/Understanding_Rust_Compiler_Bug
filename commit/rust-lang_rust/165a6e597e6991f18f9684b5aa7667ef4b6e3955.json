{"sha": "165a6e597e6991f18f9684b5aa7667ef4b6e3955", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2NWE2ZTU5N2U2OTkxZjE4Zjk2ODRiNWFhNzY2N2VmNGI2ZTM5NTU=", "commit": {"author": {"name": "Yuto Kawamura", "email": "kawamuray.dadada@gmail.com", "date": "2020-08-05T11:30:06Z"}, "committer": {"name": "Yuto Kawamura", "email": "kawamuray.dadada@gmail.com", "date": "2020-08-05T11:30:06Z"}, "message": "Fix wasi::fs::OpenOptions to imply write when append is on", "tree": {"sha": "3966d7fbe292db50270c4f764363ed06183eb96d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3966d7fbe292db50270c4f764363ed06183eb96d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/165a6e597e6991f18f9684b5aa7667ef4b6e3955", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/165a6e597e6991f18f9684b5aa7667ef4b6e3955", "html_url": "https://github.com/rust-lang/rust/commit/165a6e597e6991f18f9684b5aa7667ef4b6e3955", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/165a6e597e6991f18f9684b5aa7667ef4b6e3955/comments", "author": {"login": "kawamuray", "id": 2255161, "node_id": "MDQ6VXNlcjIyNTUxNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2255161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kawamuray", "html_url": "https://github.com/kawamuray", "followers_url": "https://api.github.com/users/kawamuray/followers", "following_url": "https://api.github.com/users/kawamuray/following{/other_user}", "gists_url": "https://api.github.com/users/kawamuray/gists{/gist_id}", "starred_url": "https://api.github.com/users/kawamuray/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kawamuray/subscriptions", "organizations_url": "https://api.github.com/users/kawamuray/orgs", "repos_url": "https://api.github.com/users/kawamuray/repos", "events_url": "https://api.github.com/users/kawamuray/events{/privacy}", "received_events_url": "https://api.github.com/users/kawamuray/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kawamuray", "id": 2255161, "node_id": "MDQ6VXNlcjIyNTUxNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2255161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kawamuray", "html_url": "https://github.com/kawamuray", "followers_url": "https://api.github.com/users/kawamuray/followers", "following_url": "https://api.github.com/users/kawamuray/following{/other_user}", "gists_url": "https://api.github.com/users/kawamuray/gists{/gist_id}", "starred_url": "https://api.github.com/users/kawamuray/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kawamuray/subscriptions", "organizations_url": "https://api.github.com/users/kawamuray/orgs", "repos_url": "https://api.github.com/users/kawamuray/repos", "events_url": "https://api.github.com/users/kawamuray/events{/privacy}", "received_events_url": "https://api.github.com/users/kawamuray/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f8ff84b510e3ff04865cfdd5ef95e677227e0c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f8ff84b510e3ff04865cfdd5ef95e677227e0c8", "html_url": "https://github.com/rust-lang/rust/commit/7f8ff84b510e3ff04865cfdd5ef95e677227e0c8"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "8408756f1b3be1cca5bff0c8e8dc031d7163895e", "filename": "library/std/src/sys/wasi/fs.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/165a6e597e6991f18f9684b5aa7667ef4b6e3955/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/165a6e597e6991f18f9684b5aa7667ef4b6e3955/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Ffs.rs?ref=165a6e597e6991f18f9684b5aa7667ef4b6e3955", "patch": "@@ -46,6 +46,7 @@ pub struct DirEntry {\n pub struct OpenOptions {\n     read: bool,\n     write: bool,\n+    append: bool,\n     dirflags: wasi::Lookupflags,\n     fdflags: wasi::Fdflags,\n     oflags: wasi::Oflags,\n@@ -270,8 +271,9 @@ impl OpenOptions {\n         }\n     }\n \n-    pub fn append(&mut self, set: bool) {\n-        self.fdflag(wasi::FDFLAGS_APPEND, set);\n+    pub fn append(&mut self, append: bool) {\n+        self.append = append;\n+        self.fdflag(wasi::FDFLAGS_APPEND, append);\n     }\n \n     pub fn dsync(&mut self, set: bool) {\n@@ -321,7 +323,7 @@ impl OpenOptions {\n             base |= wasi::RIGHTS_FD_READ;\n             base |= wasi::RIGHTS_FD_READDIR;\n         }\n-        if self.write {\n+        if self.write || self.append {\n             base |= wasi::RIGHTS_FD_WRITE;\n             base |= wasi::RIGHTS_FD_DATASYNC;\n             base |= wasi::RIGHTS_FD_ALLOCATE;"}]}