{"sha": "e6503995abafd30175fdf490a4c38f5187d64931", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2NTAzOTk1YWJhZmQzMDE3NWZkZjQ5MGE0YzM4ZjUxODdkNjQ5MzE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-13T06:10:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-13T06:10:15Z"}, "message": "auto merge of #7096 : huonw/rust/invalid-null-str, r=thestinger\n\nA slice of a 'static str is still 'static, but doesn't necessarily\r\nhave the null terminator.", "tree": {"sha": "040dda7a184cf48b8a42b8a381f3b86d96103bf9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/040dda7a184cf48b8a42b8a381f3b86d96103bf9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e6503995abafd30175fdf490a4c38f5187d64931", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e6503995abafd30175fdf490a4c38f5187d64931", "html_url": "https://github.com/rust-lang/rust/commit/e6503995abafd30175fdf490a4c38f5187d64931", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e6503995abafd30175fdf490a4c38f5187d64931/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9355330c1e8fa376ffb5ebee4aebed2c318d37d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/9355330c1e8fa376ffb5ebee4aebed2c318d37d6", "html_url": "https://github.com/rust-lang/rust/commit/9355330c1e8fa376ffb5ebee4aebed2c318d37d6"}, {"sha": "abadece3ba2dba032fa7752e88fcf58289c240ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/abadece3ba2dba032fa7752e88fcf58289c240ac", "html_url": "https://github.com/rust-lang/rust/commit/abadece3ba2dba032fa7752e88fcf58289c240ac"}], "stats": {"total": 39, "additions": 22, "deletions": 17}, "files": [{"sha": "164c57d9645898ca9ad92902f5ce88dedd02c60e", "filename": "src/libstd/str.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e6503995abafd30175fdf490a4c38f5187d64931/src%2Flibstd%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6503995abafd30175fdf490a4c38f5187d64931/src%2Flibstd%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstr.rs?ref=e6503995abafd30175fdf490a4c38f5187d64931", "patch": "@@ -1953,18 +1953,6 @@ impl NullTerminatedStr for @str {\n         slice\n     }\n }\n-// static strings are the only slices guaranteed to a nul-terminator\n-impl NullTerminatedStr for &'static str {\n-    /**\n-     * Work with the byte buffer of a string as a byte slice.\n-     *\n-     * The byte slice does include the null terminator.\n-     */\n-    #[inline]\n-    fn as_bytes_with_null(&self) -> &'static [u8] {\n-        unsafe { ::cast::transmute(*self) }\n-    }\n-}\n \n #[allow(missing_doc)]\n pub trait OwnedStr {\n@@ -2925,10 +2913,6 @@ mod tests {\n             109, 0\n         ];\n \n-        assert_eq!(\"\".as_bytes_with_null(), &[0]);\n-        assert_eq!(\"abc\".as_bytes_with_null(), &['a' as u8, 'b' as u8, 'c' as u8, 0]);\n-        assert_eq!(\"\u0e28\u0e44\u0e17\u0e22\u4e2d\u534eVi\u1ec7t Nam\".as_bytes_with_null(), v);\n-\n         let s1 = @\"\";\n         let s2 = @\"abc\";\n         let s3 = @\"\u0e28\u0e44\u0e17\u0e22\u4e2d\u534eVi\u1ec7t Nam\";"}, {"sha": "9e90541baabdafad8102e63c85cf5a3c135e060d", "filename": "src/test/bench/shootout-fasta-redux.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e6503995abafd30175fdf490a4c38f5187d64931/src%2Ftest%2Fbench%2Fshootout-fasta-redux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6503995abafd30175fdf490a4c38f5187d64931/src%2Ftest%2Fbench%2Fshootout-fasta-redux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fshootout-fasta-redux.rs?ref=e6503995abafd30175fdf490a4c38f5187d64931", "patch": "@@ -93,7 +93,7 @@ impl RepeatFasta {\n             let stdout = self.stdout;\n             let alu_len = self.alu.len();\n             let mut buf = vec::from_elem(alu_len + LINE_LEN, 0u8);\n-            let alu: &[u8] = self.alu.as_bytes_with_null();\n+            let alu: &[u8] = self.alu.as_bytes();\n \n             copy_memory(buf, alu, alu_len);\n             copy_memory(vec::mut_slice(buf, alu_len, buf.len()),"}, {"sha": "3cfaa57d540f350a8aa4786ec1a337d834507248", "filename": "src/test/compile-fail/static-slice-not-null-terminated.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e6503995abafd30175fdf490a4c38f5187d64931/src%2Ftest%2Fcompile-fail%2Fstatic-slice-not-null-terminated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6503995abafd30175fdf490a4c38f5187d64931/src%2Ftest%2Fcompile-fail%2Fstatic-slice-not-null-terminated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstatic-slice-not-null-terminated.rs?ref=e6503995abafd30175fdf490a4c38f5187d64931", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let _ = (~\"foo\").as_bytes_with_null();\n+    let _ = (@\"foo\").as_bytes_with_null();\n+\n+    // a plain static slice is null terminated, but such a slice can\n+    // be sliced shorter (i.e. become non-null terminated) and still\n+    // have the static lifetime\n+    let foo: &'static str = \"foo\";\n+    let _ = foo.as_bytes_with_null();\n+     //~^ ERROR does not implement any method in scope named `as_bytes_with_null`\n+}"}]}