{"sha": "cad050b002ff36c65b68833fcd90824eceee1993", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhZDA1MGIwMDJmZjM2YzY1YjY4ODMzZmNkOTA4MjRlY2VlZTE5OTM=", "commit": {"author": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2020-09-17T16:27:49Z"}, "committer": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2020-09-19T13:29:09Z"}, "message": "Add regression test showcasing miscompilation", "tree": {"sha": "fd856d0ed2262362912b23ed3ec8495a60a26fa0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd856d0ed2262362912b23ed3ec8495a60a26fa0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cad050b002ff36c65b68833fcd90824eceee1993", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cad050b002ff36c65b68833fcd90824eceee1993", "html_url": "https://github.com/rust-lang/rust/commit/cad050b002ff36c65b68833fcd90824eceee1993", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cad050b002ff36c65b68833fcd90824eceee1993/comments", "author": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fd702d2919fe23eeaf59574040d0b29853d44289", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd702d2919fe23eeaf59574040d0b29853d44289", "html_url": "https://github.com/rust-lang/rust/commit/fd702d2919fe23eeaf59574040d0b29853d44289"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "63139285209b6b07477ab9d6500c026ff2164f3f", "filename": "src/test/mir-opt/76803_regression.encode.SimplifyBranchSame.diff", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/cad050b002ff36c65b68833fcd90824eceee1993/src%2Ftest%2Fmir-opt%2F76803_regression.encode.SimplifyBranchSame.diff", "raw_url": "https://github.com/rust-lang/rust/raw/cad050b002ff36c65b68833fcd90824eceee1993/src%2Ftest%2Fmir-opt%2F76803_regression.encode.SimplifyBranchSame.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2F76803_regression.encode.SimplifyBranchSame.diff?ref=cad050b002ff36c65b68833fcd90824eceee1993", "patch": "@@ -0,0 +1,30 @@\n+- // MIR for `encode` before SimplifyBranchSame\n++ // MIR for `encode` after SimplifyBranchSame\n+  \n+  fn encode(_1: Type) -> Type {\n+      debug v => _1;                       // in scope 0 at $DIR/76803_regression.rs:10:15: 10:16\n+      let mut _0: Type;                    // return place in scope 0 at $DIR/76803_regression.rs:10:27: 10:31\n+      let mut _2: isize;                   // in scope 0 at $DIR/76803_regression.rs:12:9: 12:16\n+  \n+      bb0: {\n+          _2 = discriminant(_1);           // scope 0 at $DIR/76803_regression.rs:12:9: 12:16\n+-         switchInt(move _2) -> [0_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/76803_regression.rs:12:9: 12:16\n++         goto -> bb1;                     // scope 0 at $DIR/76803_regression.rs:12:9: 12:16\n+      }\n+  \n+      bb1: {\n+          _0 = move _1;                    // scope 0 at $DIR/76803_regression.rs:13:14: 13:15\n+-         goto -> bb3;                     // scope 0 at $DIR/76803_regression.rs:11:5: 14:6\n++         goto -> bb2;                     // scope 0 at $DIR/76803_regression.rs:11:5: 14:6\n+      }\n+  \n+      bb2: {\n+-         discriminant(_0) = 1;            // scope 0 at $DIR/76803_regression.rs:12:20: 12:27\n+-         goto -> bb3;                     // scope 0 at $DIR/76803_regression.rs:11:5: 14:6\n+-     }\n+- \n+-     bb3: {\n+          return;                          // scope 0 at $DIR/76803_regression.rs:15:2: 15:2\n+      }\n+  }\n+  "}, {"sha": "05dc3c97841099c6ff1741fcf55d5504eca1229a", "filename": "src/test/mir-opt/76803_regression.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cad050b002ff36c65b68833fcd90824eceee1993/src%2Ftest%2Fmir-opt%2F76803_regression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cad050b002ff36c65b68833fcd90824eceee1993/src%2Ftest%2Fmir-opt%2F76803_regression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2F76803_regression.rs?ref=cad050b002ff36c65b68833fcd90824eceee1993", "patch": "@@ -0,0 +1,19 @@\n+// compile-flags: -Z mir-opt-level=1\n+// EMIT_MIR 76803_regression.encode.SimplifyBranchSame.diff\n+\n+#[derive(Debug, Eq, PartialEq)]\n+pub enum Type {\n+    A,\n+    B,\n+}\n+\n+pub fn encode(v: Type) -> Type {\n+    match v {\n+        Type::A => Type::B,\n+        _ => v,\n+    }\n+}\n+\n+fn main() {\n+    assert_eq!(Type::B, encode(Type::A));\n+}"}]}