{"sha": "3a34c96086e88466e350100af874f07b387a7620", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhMzRjOTYwODZlODg0NjZlMzUwMTAwYWY4NzRmMDdiMzg3YTc2MjA=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-09-06T01:32:01Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-09-06T01:35:30Z"}, "message": "Add a lint pass for structural records\n\nCloses #3322", "tree": {"sha": "a7e2bcfe2c5dedc569bcddedf7488e704cf0ad1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7e2bcfe2c5dedc569bcddedf7488e704cf0ad1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a34c96086e88466e350100af874f07b387a7620", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a34c96086e88466e350100af874f07b387a7620", "html_url": "https://github.com/rust-lang/rust/commit/3a34c96086e88466e350100af874f07b387a7620", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a34c96086e88466e350100af874f07b387a7620/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a852e0da0503b3abcc2dd0b0858f64e3f4dc6b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a852e0da0503b3abcc2dd0b0858f64e3f4dc6b0", "html_url": "https://github.com/rust-lang/rust/commit/0a852e0da0503b3abcc2dd0b0858f64e3f4dc6b0"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "e38ba74fecfa7586d4c1c94e354233d7ff86e287", "filename": "src/rustc/middle/lint.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3a34c96086e88466e350100af874f07b387a7620/src%2Frustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a34c96086e88466e350100af874f07b387a7620/src%2Frustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Flint.rs?ref=3a34c96086e88466e350100af874f07b387a7620", "patch": "@@ -53,6 +53,7 @@ enum lint {\n     deprecated_mode,\n     deprecated_pattern,\n     non_camel_case_types,\n+    structural_records,\n \n     managed_heap_memory,\n     owned_heap_memory,\n@@ -171,6 +172,11 @@ fn get_lint_dict() -> lint_dict {\n            desc: ~\"use of any (~ type or @ type) heap memory\",\n            default: allow}),\n \n+        (~\"structural_records\",\n+         @{lint: structural_records,\n+           desc: ~\"use of any structural records\",\n+           default: allow}),\n+\n         /* FIXME(#3266)--make liveness warnings lintable\n         (~\"unused_variable\",\n          @{lint: unused_variable,\n@@ -380,6 +386,7 @@ fn check_item(i: @ast::item, cx: ty::ctxt) {\n     check_item_path_statement(cx, i);\n     check_item_non_camel_case_types(cx, i);\n     check_item_heap(cx, i);\n+    check_item_structural_records(cx, i);\n }\n \n // Take a visitor, and modify it so that it will not proceed past subitems.\n@@ -413,6 +420,23 @@ fn check_item_while_true(cx: ty::ctxt, it: @ast::item) {\n     visit::visit_item(it, (), visit);\n }\n \n+fn check_item_structural_records(cx: ty::ctxt, it: @ast::item) {\n+    let visit = item_stopping_visitor(visit::mk_simple_visitor(@{\n+        visit_expr: fn@(e: @ast::expr) {\n+           match e.node {\n+             ast::expr_rec(*) =>\n+                 cx.sess.span_lint(\n+                                structural_records, e.id, it.id,\n+                                e.span,\n+                                ~\"structural records are deprecated\"),\n+               _ => ()\n+           }\n+        },\n+        .. *visit::default_simple_visitor()\n+    }));\n+    visit::visit_item(it, (), visit);\n+}\n+\n fn check_item_ctypes(cx: ty::ctxt, it: @ast::item) {\n \n     fn check_foreign_fn(cx: ty::ctxt, fn_id: ast::node_id,"}, {"sha": "f06f842993fc2be3ae891d3f5ccda6ed8b8bfac0", "filename": "src/test/run-pass/lint-structural-records.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3a34c96086e88466e350100af874f07b387a7620/src%2Ftest%2Frun-pass%2Flint-structural-records.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a34c96086e88466e350100af874f07b387a7620/src%2Ftest%2Frun-pass%2Flint-structural-records.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flint-structural-records.rs?ref=3a34c96086e88466e350100af874f07b387a7620", "patch": "@@ -0,0 +1,4 @@\n+#[warn(structural_records)];\n+fn main() {\n+    let _foo = {x:5};\n+}\n\\ No newline at end of file"}]}