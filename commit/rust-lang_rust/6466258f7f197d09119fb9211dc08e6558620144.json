{"sha": "6466258f7f197d09119fb9211dc08e6558620144", "node_id": "C_kwDOAAsO6NoAKDY0NjYyNThmN2YxOTdkMDkxMTlmYjkyMTFkYzA4ZTY1NTg2MjAxNDQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-13T19:00:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-13T19:00:24Z"}, "message": "Auto merge of #9474 - c410-f3r:arith, r=llogiq\n\n[arithmetic-side-effects] More non-overflowing ops\n\n* Adding or Subtracting 0\n* Division and Module of anything other than 0\n* Multiplying 1 or 0\n\nchangelog: [arithmetic-side-effects] More non-overflowing operations", "tree": {"sha": "48960c5415ce44a87a0c14274e74acaeeca549b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48960c5415ce44a87a0c14274e74acaeeca549b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6466258f7f197d09119fb9211dc08e6558620144", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6466258f7f197d09119fb9211dc08e6558620144", "html_url": "https://github.com/rust-lang/rust/commit/6466258f7f197d09119fb9211dc08e6558620144", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6466258f7f197d09119fb9211dc08e6558620144/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "556415870d68d1f69ac884a07838b99e9a2aa73c", "url": "https://api.github.com/repos/rust-lang/rust/commits/556415870d68d1f69ac884a07838b99e9a2aa73c", "html_url": "https://github.com/rust-lang/rust/commit/556415870d68d1f69ac884a07838b99e9a2aa73c"}, {"sha": "611c905482d407581c104ba9d331d612f6f56461", "url": "https://api.github.com/repos/rust-lang/rust/commits/611c905482d407581c104ba9d331d612f6f56461", "html_url": "https://github.com/rust-lang/rust/commit/611c905482d407581c104ba9d331d612f6f56461"}], "stats": {"total": 80, "additions": 72, "deletions": 8}, "files": [{"sha": "21c2b76439bf7ab69b070debb4009f77a89d0639", "filename": "clippy_lints/src/operators/arithmetic_side_effects.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6466258f7f197d09119fb9211dc08e6558620144/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6466258f7f197d09119fb9211dc08e6558620144/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs?ref=6466258f7f197d09119fb9211dc08e6558620144", "patch": "@@ -48,9 +48,21 @@ impl ArithmeticSideEffects {\n         if !Self::is_literal_integer(rhs, rhs_refs) {\n             return false;\n         }\n-        if let hir::BinOpKind::Div | hir::BinOpKind::Mul = op.node\n+        if let hir::BinOpKind::Add | hir::BinOpKind::Sub = op.node\n             && let hir::ExprKind::Lit(ref lit) = rhs.kind\n-            && let ast::LitKind::Int(1, _) = lit.node\n+            && let ast::LitKind::Int(0, _) = lit.node\n+        {\n+            return true;\n+        }\n+        if let hir::BinOpKind::Div | hir::BinOpKind::Rem = op.node\n+            && let hir::ExprKind::Lit(ref lit) = rhs.kind\n+            && !matches!(lit.node, ast::LitKind::Int(0, _))\n+        {\n+            return true;\n+        }\n+        if let hir::BinOpKind::Mul = op.node\n+            && let hir::ExprKind::Lit(ref lit) = rhs.kind\n+            && let ast::LitKind::Int(0 | 1, _) = lit.node\n         {\n             return true;\n         }"}, {"sha": "a51c2514283e01687c8a5666949d941178ad7372", "filename": "tests/ui/arithmetic_side_effects.rs", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6466258f7f197d09119fb9211dc08e6558620144/tests%2Fui%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6466258f7f197d09119fb9211dc08e6558620144/tests%2Fui%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.rs?ref=6466258f7f197d09119fb9211dc08e6558620144", "patch": "@@ -1,4 +1,8 @@\n-#![allow(clippy::assign_op_pattern, clippy::unnecessary_owned_empty_strings)]\n+#![allow(\n+    clippy::assign_op_pattern,\n+    unconditional_panic,\n+    clippy::unnecessary_owned_empty_strings\n+)]\n #![feature(inline_const, saturating_int_impl)]\n #![warn(clippy::arithmetic_side_effects)]\n \n@@ -41,8 +45,12 @@ pub fn non_overflowing_ops() {\n     let _ = const { 1 + 1 };\n \n     let mut _a = 1;\n+    _a += 0;\n+    _a -= 0;\n+    _a /= 99;\n+    _a %= 99;\n+    _a *= 0;\n     _a *= 1;\n-    _a /= 1;\n }\n \n #[rustfmt::skip]\n@@ -52,6 +60,14 @@ pub fn overflowing_ops() {\n     let mut _b = 1; _b = _b + 1;\n \n     let mut _c = 1; _c = 1 + _c;\n+\n+    let mut _a = 1;\n+    _a += 1;\n+    _a -= 1;\n+    _a /= 0;\n+    _a %= 0;\n+    _a *= 2;\n+    _a *= 3;\n }\n \n fn main() {}"}, {"sha": "6652a1f8ca8d45fe8fca6eeabf5ae3e279481617", "filename": "tests/ui/arithmetic_side_effects.stderr", "status": "modified", "additions": 40, "deletions": 4, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/6466258f7f197d09119fb9211dc08e6558620144/tests%2Fui%2Farithmetic_side_effects.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6466258f7f197d09119fb9211dc08e6558620144/tests%2Fui%2Farithmetic_side_effects.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.stderr?ref=6466258f7f197d09119fb9211dc08e6558620144", "patch": "@@ -1,22 +1,58 @@\n error: arithmetic detected\n-  --> $DIR/arithmetic_side_effects.rs:50:21\n+  --> $DIR/arithmetic_side_effects.rs:58:21\n    |\n LL |     let mut _a = 1; _a += 1;\n    |                     ^^^^^^^\n    |\n    = note: `-D clippy::arithmetic-side-effects` implied by `-D warnings`\n \n error: arithmetic detected\n-  --> $DIR/arithmetic_side_effects.rs:52:26\n+  --> $DIR/arithmetic_side_effects.rs:60:26\n    |\n LL |     let mut _b = 1; _b = _b + 1;\n    |                          ^^^^^^\n \n error: arithmetic detected\n-  --> $DIR/arithmetic_side_effects.rs:54:26\n+  --> $DIR/arithmetic_side_effects.rs:62:26\n    |\n LL |     let mut _c = 1; _c = 1 + _c;\n    |                          ^^^^^^\n \n-error: aborting due to 3 previous errors\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:65:5\n+   |\n+LL |     _a += 1;\n+   |     ^^^^^^^\n+\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:66:5\n+   |\n+LL |     _a -= 1;\n+   |     ^^^^^^^\n+\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:67:5\n+   |\n+LL |     _a /= 0;\n+   |     ^^^^^^^\n+\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:68:5\n+   |\n+LL |     _a %= 0;\n+   |     ^^^^^^^\n+\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:69:5\n+   |\n+LL |     _a *= 2;\n+   |     ^^^^^^^\n+\n+error: arithmetic detected\n+  --> $DIR/arithmetic_side_effects.rs:70:5\n+   |\n+LL |     _a *= 3;\n+   |     ^^^^^^^\n+\n+error: aborting due to 9 previous errors\n "}]}