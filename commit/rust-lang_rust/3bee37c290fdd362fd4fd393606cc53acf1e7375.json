{"sha": "3bee37c290fdd362fd4fd393606cc53acf1e7375", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiZWUzN2MyOTBmZGQzNjJmZDRmZDM5MzYwNmNjNTNhY2YxZTczNzU=", "commit": {"author": {"name": "Maarten de Vries", "email": "maarten@de-vri.es", "date": "2020-10-31T13:20:18Z"}, "committer": {"name": "Maarten de Vries", "email": "maarten@de-vri.es", "date": "2020-11-06T13:17:48Z"}, "message": "Disable accept4 on Android.", "tree": {"sha": "fc8cff5a24a029b70d5bae41e2bf2d6019ccb90d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc8cff5a24a029b70d5bae41e2bf2d6019ccb90d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3bee37c290fdd362fd4fd393606cc53acf1e7375", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3bee37c290fdd362fd4fd393606cc53acf1e7375", "html_url": "https://github.com/rust-lang/rust/commit/3bee37c290fdd362fd4fd393606cc53acf1e7375", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3bee37c290fdd362fd4fd393606cc53acf1e7375/comments", "author": {"login": "de-vri-es", "id": 786213, "node_id": "MDQ6VXNlcjc4NjIxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/786213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/de-vri-es", "html_url": "https://github.com/de-vri-es", "followers_url": "https://api.github.com/users/de-vri-es/followers", "following_url": "https://api.github.com/users/de-vri-es/following{/other_user}", "gists_url": "https://api.github.com/users/de-vri-es/gists{/gist_id}", "starred_url": "https://api.github.com/users/de-vri-es/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/de-vri-es/subscriptions", "organizations_url": "https://api.github.com/users/de-vri-es/orgs", "repos_url": "https://api.github.com/users/de-vri-es/repos", "events_url": "https://api.github.com/users/de-vri-es/events{/privacy}", "received_events_url": "https://api.github.com/users/de-vri-es/received_events", "type": "User", "site_admin": false}, "committer": {"login": "de-vri-es", "id": 786213, "node_id": "MDQ6VXNlcjc4NjIxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/786213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/de-vri-es", "html_url": "https://github.com/de-vri-es", "followers_url": "https://api.github.com/users/de-vri-es/followers", "following_url": "https://api.github.com/users/de-vri-es/following{/other_user}", "gists_url": "https://api.github.com/users/de-vri-es/gists{/gist_id}", "starred_url": "https://api.github.com/users/de-vri-es/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/de-vri-es/subscriptions", "organizations_url": "https://api.github.com/users/de-vri-es/orgs", "repos_url": "https://api.github.com/users/de-vri-es/repos", "events_url": "https://api.github.com/users/de-vri-es/events{/privacy}", "received_events_url": "https://api.github.com/users/de-vri-es/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59c6ae615e5547610c3348b466a45ff2a5b3d935", "url": "https://api.github.com/repos/rust-lang/rust/commits/59c6ae615e5547610c3348b466a45ff2a5b3d935", "html_url": "https://github.com/rust-lang/rust/commit/59c6ae615e5547610c3348b466a45ff2a5b3d935"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "378d690f8bfd7d5cfa42a5550a6f182ae85cfed6", "filename": "library/std/src/sys/unix/net.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3bee37c290fdd362fd4fd393606cc53acf1e7375/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bee37c290fdd362fd4fd393606cc53acf1e7375/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fnet.rs?ref=3bee37c290fdd362fd4fd393606cc53acf1e7375", "patch": "@@ -195,7 +195,6 @@ impl Socket {\n         // glibc 2.10 and musl 0.9.5.\n         cfg_if::cfg_if! {\n             if #[cfg(any(\n-                target_os = \"android\",\n                 target_os = \"dragonfly\",\n                 target_os = \"freebsd\",\n                 target_os = \"illumos\",\n@@ -207,6 +206,13 @@ impl Socket {\n                     libc::accept4(self.0.raw(), storage, len, libc::SOCK_CLOEXEC)\n                 })?;\n                 Ok(Socket(FileDesc::new(fd)))\n+            // While the Android kernel supports the syscall,\n+            // it is not included in all versions of Android's libc.\n+            } else if #[cfg(target_os = \"android\")] {\n+                let fd = cvt_r(|| unsafe {\n+                    libc::syscall(libc::SYS_accept4, self.0.raw(), storage, len, libc::SOCK_CLOEXEC)\n+                })?;\n+                Ok(Socket(FileDesc::new(fd as c_int)))\n             } else {\n                 let fd = cvt_r(|| unsafe { libc::accept(self.0.raw(), storage, len) })?;\n                 let fd = FileDesc::new(fd);"}]}