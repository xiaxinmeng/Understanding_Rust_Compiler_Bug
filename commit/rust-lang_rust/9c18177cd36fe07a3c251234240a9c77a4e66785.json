{"sha": "9c18177cd36fe07a3c251234240a9c77a4e66785", "node_id": "C_kwDOAAsO6NoAKDljMTgxNzdjZDM2ZmUwN2EzYzI1MTIzNDI0MGE5Yzc3YTRlNjY3ODU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-26T23:23:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-26T23:23:31Z"}, "message": "Auto merge of #1902 - camelid:r-a, r=RalfJung\n\nAdd instructions for using rust-analyzer for Miri development\n\nr? `@RalfJung`", "tree": {"sha": "cefac5628e110f87241d4917188ccf6b5de8022b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cefac5628e110f87241d4917188ccf6b5de8022b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c18177cd36fe07a3c251234240a9c77a4e66785", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c18177cd36fe07a3c251234240a9c77a4e66785", "html_url": "https://github.com/rust-lang/rust/commit/9c18177cd36fe07a3c251234240a9c77a4e66785", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c18177cd36fe07a3c251234240a9c77a4e66785/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04e5c78c3ffe14e218032d1038fc9d0b993bf4d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/04e5c78c3ffe14e218032d1038fc9d0b993bf4d9", "html_url": "https://github.com/rust-lang/rust/commit/04e5c78c3ffe14e218032d1038fc9d0b993bf4d9"}, {"sha": "141bf38f23d2737bde70a38a23bbe90fa062c450", "url": "https://api.github.com/repos/rust-lang/rust/commits/141bf38f23d2737bde70a38a23bbe90fa062c450", "html_url": "https://github.com/rust-lang/rust/commit/141bf38f23d2737bde70a38a23bbe90fa062c450"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "caed6e3226d85f750e9c70bece7ad63a5410ed6a", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/9c18177cd36fe07a3c251234240a9c77a4e66785/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/9c18177cd36fe07a3c251234240a9c77a4e66785/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=9c18177cd36fe07a3c251234240a9c77a4e66785", "patch": "@@ -107,6 +107,41 @@ There's a test for the cargo wrapper in the `test-cargo-miri` directory; run\n `./run-test.py` in there to execute it. Like `./miri test`, this respects the\n `MIRI_TEST_TARGET` environment variable to execute the test for another target.\n \n+## Configuring `rust-analyzer`\n+\n+To configure `rust-analyzer` and VS Code for working on Miri, save the following\n+to `.vscode/settings.json` in your local Miri clone:\n+\n+```json\n+{\n+    \"rust-analyzer.checkOnSave.overrideCommand\": [\n+        \"./miri\",\n+        \"check\",\n+        \"--message-format=json\"\n+    ],\n+    \"rust-analyzer.rustfmt.extraArgs\": [\n+        \"+nightly\"\n+    ],\n+    \"rust-analyzer.rustcSource\": \"discover\",\n+    \"rust-analyzer.linkedProjects\": [\n+        \"./Cargo.toml\",\n+        \"./cargo-miri/Cargo.toml\"\n+    ]\n+}\n+```\n+\n+> #### Note\n+>\n+> If you are [building Miri with a locally built rustc][], set\n+> `rust-analyzer.rustcSource` to the relative path from your Miri clone to the\n+> root `Cargo.toml` of the locally built rustc. For example, the path might look\n+> like `../rust/Cargo.toml`.\n+\n+See the rustc-dev-guide's docs on [\"Configuring `rust-analyzer` for `rustc`\"][rdg-r-a]\n+for more information about configuring VS Code and `rust-analyzer`.\n+\n+[rdg-r-a]: https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc\n+\n ## Advanced topic: other build environments\n \n We described above the simplest way to get a working build environment for Miri,\n@@ -132,6 +167,8 @@ rustc. This avoids blocking all Miri development on landing a big PR.\n \n ### Building Miri with a locally built rustc\n \n+[building Miri with a locally built rustc]: #building-miri-with-a-locally-built-rustc\n+\n A big part of the Miri driver lives in rustc, so working on Miri will sometimes\n require using a locally built rustc. The bug you want to fix may actually be on\n the rustc side, or you just need to get more detailed trace of the execution"}]}