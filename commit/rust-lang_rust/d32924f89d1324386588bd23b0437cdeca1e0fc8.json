{"sha": "d32924f89d1324386588bd23b0437cdeca1e0fc8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzMjkyNGY4OWQxMzI0Mzg2NTg4YmQyM2IwNDM3Y2RlY2ExZTBmYzg=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-03-08T20:00:03Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-03-08T22:48:08Z"}, "message": "Check if output is immediate value", "tree": {"sha": "1477262a6b21101bc690def180b0de58b3344836", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1477262a6b21101bc690def180b0de58b3344836"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d32924f89d1324386588bd23b0437cdeca1e0fc8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEXmatGLoofN5+9u4rsJhshcDi2qEFAl5ldigACgkQsJhshcDi\n2qF7Hg/+JbXoiY1EdXJ51XdvKPmchEwhWn6QeOenk8ssVbe5ueJNAj+u4ewBsfcz\n9J0J/EQe3mGGBQ/l1i6pBStie2B6yYqFYaasmGVl647TSymIMYKKR6YE7RLsTsRt\ngukDvEVL5965UawCjLpAbcCqXDjOV+0QOeSIGrXCNcJhPEYDRwpBwZ2tP/5aBZnj\nSXuadJsKkZJl57iIWr8x/b66FnOUpUxdsvhAErC2roof6toV0Wdn935wh6Z+b/+Q\njhw4NSz6cSK3BoPj0Nsm/hrtBOenjQjkE2IAhRnkACT0jmuGMiYu5/RcFe6eSDKb\n8DfXinpI66zKJCdq86EFkUHJEhiuuVpLxDosn0qkx6bdwjVZVKgsrvskh1pdS6q3\nI08IlX0N07769QulghUZQ9ryczjr8cVuEF0/6GZjRKcEVHbaG6SowxO79BIjzN0B\nT/qwJqf8JjfRKhNlxiOVGBQWd8ha81V+ddMeRChX7RO7nUH0xlRgLb2Jw9KR3CAo\nP+gncfvpf1Emuzj/JHC6NulQxdGxRLg8efFYJe8oNXZodqLh6Snx0GiEO4WLebEy\nwi2joDtYpE2ucTzIm3PG+x2W+wLo5BfST7hn4cquCAHh3xZ5SB9CotmXJD5rDyLg\ngAstv+1GL0dUKbI0GQ5w2+fHyImv1T0ye8FhQdCiGF+GjeXMlhY=\n=ENi9\n-----END PGP SIGNATURE-----", "payload": "tree 1477262a6b21101bc690def180b0de58b3344836\nparent 1d5241c96208ca7d925442b1a5fa45ad18717a6f\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1583697603 +0900\ncommitter Yuki Okushi <huyuumi.dev@gmail.com> 1583707688 +0900\n\nCheck if output is immediate value\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d32924f89d1324386588bd23b0437cdeca1e0fc8", "html_url": "https://github.com/rust-lang/rust/commit/d32924f89d1324386588bd23b0437cdeca1e0fc8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d32924f89d1324386588bd23b0437cdeca1e0fc8/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d5241c96208ca7d925442b1a5fa45ad18717a6f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d5241c96208ca7d925442b1a5fa45ad18717a6f", "html_url": "https://github.com/rust-lang/rust/commit/1d5241c96208ca7d925442b1a5fa45ad18717a6f"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "7975a70ab269c9d40ff0bcb69c8c9156a7b08e8c", "filename": "src/librustc_codegen_llvm/asm.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Flibrustc_codegen_llvm%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Flibrustc_codegen_llvm%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fasm.rs?ref=d32924f89d1324386588bd23b0437cdeca1e0fc8", "patch": "@@ -29,11 +29,17 @@ impl AsmBuilderMethods<'tcx> for Builder<'a, 'll, 'tcx> {\n         let mut indirect_outputs = vec![];\n         for (i, (out, &place)) in ia.outputs.iter().zip(&outputs).enumerate() {\n             if out.is_rw {\n-                inputs.push(self.load_operand(place).immediate());\n+                let operand = self.load_operand(place);\n+                if let OperandValue::Immediate(_) = operand.val {\n+                    inputs.push(operand.immediate());\n+                }\n                 ext_constraints.push(i.to_string());\n             }\n             if out.is_indirect {\n-                indirect_outputs.push(self.load_operand(place).immediate());\n+                let operand = self.load_operand(place);\n+                if let OperandValue::Immediate(_) = operand.val {\n+                    indirect_outputs.push(operand.immediate());\n+                }\n             } else {\n                 output_types.push(place.layout.llvm_type(self.cx()));\n             }"}, {"sha": "105dadd5fd373f420bd7fd441c4fac80b095028f", "filename": "src/test/ui/asm/issue-62046.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-62046.rs?ref=d32924f89d1324386588bd23b0437cdeca1e0fc8", "patch": "@@ -0,0 +1,11 @@\n+// build-fail\n+// ignore-emscripten no asm! support\n+\n+#![feature(asm)]\n+\n+fn main() {\n+    unsafe {\n+        asm!(\"nop\" : \"+r\"(\"r15\"));\n+        //~^ malformed inline assembly\n+    }\n+}"}, {"sha": "a38a300548d4836dca4104fefdce751a41458d16", "filename": "src/test/ui/asm/issue-62046.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d32924f89d1324386588bd23b0437cdeca1e0fc8/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-62046.stderr?ref=d32924f89d1324386588bd23b0437cdeca1e0fc8", "patch": "@@ -0,0 +1,11 @@\n+error[E0668]: malformed inline assembly\n+  --> $DIR/issue-62046.rs:8:9\n+   |\n+LL |         asm!(\"nop\" : \"+r\"(\"r15\"));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0668`."}]}