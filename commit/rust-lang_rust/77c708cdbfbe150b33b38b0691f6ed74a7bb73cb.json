{"sha": "77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3YzcwOGNkYmZiZTE1MGIzM2IzOGIwNjkxZjZlZDc0YTdiYjczY2I=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-07-07T19:25:09Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-07-07T19:25:09Z"}, "message": "Implement --lib --static.", "tree": {"sha": "88636607e2c887d7811f96014625216486c66a80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88636607e2c887d7811f96014625216486c66a80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "html_url": "https://github.com/rust-lang/rust/commit/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb/comments", "author": null, "committer": null, "parents": [{"sha": "b13527735e5977d544eff498469cda9d9c4511de", "url": "https://api.github.com/repos/rust-lang/rust/commits/b13527735e5977d544eff498469cda9d9c4511de", "html_url": "https://github.com/rust-lang/rust/commit/b13527735e5977d544eff498469cda9d9c4511de"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "db9d858db0416d36027624b1b0025c62e562811b", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "patch": "@@ -283,6 +283,7 @@ fn build_target_config() -> @session::config {\n fn build_session_options(str binary, getopts::match match, str binary_dir) ->\n    @session::options {\n     auto library = opt_present(match, \"lib\");\n+    auto static = opt_present(match, \"static\");\n     auto library_search_paths = [binary_dir + \"/lib\"];\n     library_search_paths += getopts::opt_strs(match, \"L\");\n     auto output_type =\n@@ -332,6 +333,7 @@ fn build_session_options(str binary, getopts::match match, str binary_dir) ->\n     auto test = opt_present(match, \"test\");\n     let @session::options sopts =\n         @rec(library=library,\n+             static=static,\n              optimize=opt_level,\n              debuginfo=debuginfo,\n              verify=verify,\n@@ -455,13 +457,10 @@ fn main(vec[str] args) {\n \n             saved_out_filename = ofile;\n             auto temp_filename;\n-            alt (sopts.output_type) {\n-                case (link::output_type_exe) {\n-                    // FIXME: what about --lib?\n-\n-                    temp_filename = ofile + \".o\";\n-                }\n-                case (_) { temp_filename = ofile; }\n+            if (sopts.output_type == link::output_type_exe && !sopts.static) {\n+                temp_filename = ofile + \".o\";\n+            } else {\n+                temp_filename = ofile;\n             }\n             compile_input(sess, cfg, ifile, temp_filename);\n         }\n@@ -471,7 +470,7 @@ fn main(vec[str] args) {\n     // gcc to link the object file with some libs\n     //\n     // TODO: Factor this out of main.\n-    if (sopts.output_type != link::output_type_exe) {\n+    if (sopts.output_type != link::output_type_exe || sopts.static) {\n         ret;\n     }\n "}, {"sha": "f4022d4de6ae63c8e0774a873bcf7116f17ad7fb", "filename": "src/comp/driver/session.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb/src%2Fcomp%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77c708cdbfbe150b33b38b0691f6ed74a7bb73cb/src%2Fcomp%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Fsession.rs?ref=77c708cdbfbe150b33b38b0691f6ed74a7bb73cb", "patch": "@@ -24,6 +24,7 @@ type config =\n \n type options =\n     rec(bool library,\n+        bool static,\n         uint optimize,\n         bool debuginfo,\n         bool verify,"}]}