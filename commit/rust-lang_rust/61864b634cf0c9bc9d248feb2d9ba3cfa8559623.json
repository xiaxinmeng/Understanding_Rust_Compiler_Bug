{"sha": "61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "node_id": "C_kwDOAAsO6NoAKDYxODY0YjYzNGNmMGM5YmM5ZDI0OGZlYjJkOWJhM2NmYTg1NTk2MjM", "commit": {"author": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2022-02-10T18:52:01Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2022-02-10T18:52:08Z"}, "message": "Clippy: Fix botstrap fallout", "tree": {"sha": "9c3306cf249dbb05c307b514226d22999c37b107", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c3306cf249dbb05c307b514226d22999c37b107"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "html_url": "https://github.com/rust-lang/rust/commit/61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61864b634cf0c9bc9d248feb2d9ba3cfa8559623/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "611d0398143acef24bc6029810828791a2475b9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/611d0398143acef24bc6029810828791a2475b9e", "html_url": "https://github.com/rust-lang/rust/commit/611d0398143acef24bc6029810828791a2475b9e"}], "stats": {"total": 45, "additions": 24, "deletions": 21}, "files": [{"sha": "5c45012ef0686c12bc2e9b5bdbb38bab033b7184", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61864b634cf0c9bc9d248feb2d9ba3cfa8559623/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61864b634cf0c9bc9d248feb2d9ba3cfa8559623/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "patch": "@@ -5,7 +5,6 @@\n #![feature(control_flow_enum)]\n #![feature(drain_filter)]\n #![feature(iter_intersperse)]\n-#![feature(let_chains)]\n #![feature(let_else)]\n #![feature(once_cell)]\n #![feature(rustc_private)]\n@@ -19,7 +18,7 @@\n // warn on rustc internal lints\n #![warn(rustc::internal)]\n // Disable this rustc lint for now, as it was also done in rustc\n-#![allow(rustc::potential_query_instability)]\n+#![cfg_attr(not(bootstrap), allow(rustc::potential_query_instability))]\n \n // FIXME: switch to something more ergonomic here, once available.\n // (Currently there is no way to opt into sysroot crates without `extern crate`.)"}, {"sha": "030d2c23784886c7c7ebd11513970af7a2d226b9", "filename": "clippy_lints/src/transmute/transmute_undefined_repr.rs", "status": "modified", "additions": 23, "deletions": 19, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/61864b634cf0c9bc9d248feb2d9ba3cfa8559623/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_undefined_repr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61864b634cf0c9bc9d248feb2d9ba3cfa8559623/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_undefined_repr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Ftransmute_undefined_repr.rs?ref=61864b634cf0c9bc9d248feb2d9ba3cfa8559623", "patch": "@@ -111,19 +111,21 @@ pub(super) fn check<'tcx>(\n                             from_ty_orig, to_ty_orig\n                         ),\n                         |diag| {\n-                            if let (Some(from_def), Some(to_def)) = (from_ty.ty_adt_def(), to_ty.ty_adt_def())\n-                                && from_def == to_def\n-                            {\n-                                diag.note(&format!(\n-                                    \"two instances of the same generic type (`{}`) may have different layouts\",\n-                                    cx.tcx.item_name(from_def.did)\n-                                ));\n-                            } else {\n-                                if from_ty_orig.peel_refs() != from_ty {\n-                                    diag.note(&format!(\"the contained type `{}` has an undefined layout\", from_ty));\n-                                }\n-                                if to_ty_orig.peel_refs() != to_ty {\n-                                    diag.note(&format!(\"the contained type `{}` has an undefined layout\", to_ty));\n+                            if_chain! {\n+                                if let (Some(from_def), Some(to_def)) = (from_ty.ty_adt_def(), to_ty.ty_adt_def());\n+                                if from_def == to_def;\n+                                then {\n+                                    diag.note(&format!(\n+                                        \"two instances of the same generic type (`{}`) may have different layouts\",\n+                                        cx.tcx.item_name(from_def.did)\n+                                    ));\n+                                } else {\n+                                    if from_ty_orig.peel_refs() != from_ty {\n+                                        diag.note(&format!(\"the contained type `{}` has an undefined layout\", from_ty));\n+                                    }\n+                                    if to_ty_orig.peel_refs() != to_ty {\n+                                        diag.note(&format!(\"the contained type `{}` has an undefined layout\", to_ty));\n+                                    }\n                                 }\n                             }\n                         },\n@@ -279,11 +281,13 @@ fn reduce_ty<'tcx>(cx: &LateContext<'tcx>, mut ty: Ty<'tcx>) -> ReducedTy<'tcx>\n }\n \n fn is_zero_sized_ty<'tcx>(cx: &LateContext<'tcx>, ty: Ty<'tcx>) -> bool {\n-    if let Ok(ty) = cx.tcx.try_normalize_erasing_regions(cx.param_env, ty)\n-        && let Ok(layout) = cx.tcx.layout_of(cx.param_env.and(ty))\n-    {\n-        layout.layout.size.bytes() == 0\n-    } else {\n-        false\n+    if_chain! {\n+        if let Ok(ty) = cx.tcx.try_normalize_erasing_regions(cx.param_env, ty);\n+        if let Ok(layout) = cx.tcx.layout_of(cx.param_env.and(ty));\n+        then {\n+            layout.layout.size.bytes() == 0\n+        } else {\n+            false\n+        }\n     }\n }"}]}