{"sha": "410114b9d243020482689a94f7b254600f4d819e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxMDExNGI5ZDI0MzAyMDQ4MjY4OWE5NGY3YjI1NDYwMGY0ZDgxOWU=", "commit": {"author": {"name": "David Ross", "email": "daboross@daboross.net", "date": "2020-02-02T02:07:26Z"}, "committer": {"name": "David Ross", "email": "daboross@daboross.net", "date": "2020-02-02T02:59:11Z"}, "message": "Add tests for issue 59191", "tree": {"sha": "516a9dec7fb8d6510366f7c33a8f3cbcb5dee713", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/516a9dec7fb8d6510366f7c33a8f3cbcb5dee713"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/410114b9d243020482689a94f7b254600f4d819e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/410114b9d243020482689a94f7b254600f4d819e", "html_url": "https://github.com/rust-lang/rust/commit/410114b9d243020482689a94f7b254600f4d819e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/410114b9d243020482689a94f7b254600f4d819e/comments", "author": {"login": "daboross", "id": 1152146, "node_id": "MDQ6VXNlcjExNTIxNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1152146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daboross", "html_url": "https://github.com/daboross", "followers_url": "https://api.github.com/users/daboross/followers", "following_url": "https://api.github.com/users/daboross/following{/other_user}", "gists_url": "https://api.github.com/users/daboross/gists{/gist_id}", "starred_url": "https://api.github.com/users/daboross/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daboross/subscriptions", "organizations_url": "https://api.github.com/users/daboross/orgs", "repos_url": "https://api.github.com/users/daboross/repos", "events_url": "https://api.github.com/users/daboross/events{/privacy}", "received_events_url": "https://api.github.com/users/daboross/received_events", "type": "User", "site_admin": false}, "committer": {"login": "daboross", "id": 1152146, "node_id": "MDQ6VXNlcjExNTIxNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1152146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daboross", "html_url": "https://github.com/daboross", "followers_url": "https://api.github.com/users/daboross/followers", "following_url": "https://api.github.com/users/daboross/following{/other_user}", "gists_url": "https://api.github.com/users/daboross/gists{/gist_id}", "starred_url": "https://api.github.com/users/daboross/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daboross/subscriptions", "organizations_url": "https://api.github.com/users/daboross/orgs", "repos_url": "https://api.github.com/users/daboross/repos", "events_url": "https://api.github.com/users/daboross/events{/privacy}", "received_events_url": "https://api.github.com/users/daboross/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "276734d6a4997088b6d2e7416f5d4c07b4c8acf5", "url": "https://api.github.com/repos/rust-lang/rust/commits/276734d6a4997088b6d2e7416f5d4c07b4c8acf5", "html_url": "https://github.com/rust-lang/rust/commit/276734d6a4997088b6d2e7416f5d4c07b4c8acf5"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "d9ee77067ecb7d713bdbc4e242b40fb3b996533e", "filename": "src/test/ui/proc-macro/auxiliary/issue-59191.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-59191.rs", "raw_url": "https://github.com/rust-lang/rust/raw/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-59191.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-59191.rs?ref=410114b9d243020482689a94f7b254600f4d819e", "patch": "@@ -0,0 +1,16 @@\n+// edition:2018\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_attribute]\n+pub fn no_main(_attrs: TokenStream, _input: TokenStream) -> TokenStream {\n+    let new_krate = r#\"\n+        fn main() {}\n+    \"#;\n+    new_krate.parse().unwrap()\n+}"}, {"sha": "039878af56eb651dfd3967bd4ffe8ae06d73b13f", "filename": "src/test/ui/proc-macro/issue-59191-replace-root-with-fn.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.rs?ref=410114b9d243020482689a94f7b254600f4d819e", "patch": "@@ -0,0 +1,7 @@\n+// edition:2018\n+// aux-crate:issue_59191=issue-59191.rs\n+// Test that using a macro to replace the entire crate tree with a non-'mod' item errors out nicely.\n+// `issue_59191::no_main` replaces whatever's passed in with `fn main() {}`.\n+#![feature(custom_inner_attributes)]\n+#![issue_59191::no_main]\n+//~^ ERROR expected crate top-level item to be a module after macro expansion, found a function"}, {"sha": "1bda86551d418b59f2a11a2466d7351b62816ce6", "filename": "src/test/ui/proc-macro/issue-59191-replace-root-with-fn.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/410114b9d243020482689a94f7b254600f4d819e/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-59191-replace-root-with-fn.stderr?ref=410114b9d243020482689a94f7b254600f4d819e", "patch": "@@ -0,0 +1,8 @@\n+error: expected crate top-level item to be a module after macro expansion, found a function\n+  --> $DIR/issue-59191-replace-root-with-fn.rs:6:1\n+   |\n+LL | #![issue_59191::no_main]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}