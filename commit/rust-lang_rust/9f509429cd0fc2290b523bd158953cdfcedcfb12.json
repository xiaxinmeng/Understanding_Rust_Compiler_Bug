{"sha": "9f509429cd0fc2290b523bd158953cdfcedcfb12", "node_id": "C_kwDOAAsO6NoAKDlmNTA5NDI5Y2QwZmMyMjkwYjUyM2JkMTU4OTUzY2RmY2VkY2ZiMTI", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2023-06-16T11:43:55Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2023-06-16T11:43:55Z"}, "message": "Unify history interactions in search", "tree": {"sha": "a17aa2cbac3448a7428911c3e66829c0b0d3a6c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a17aa2cbac3448a7428911c3e66829c0b0d3a6c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f509429cd0fc2290b523bd158953cdfcedcfb12", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f509429cd0fc2290b523bd158953cdfcedcfb12", "html_url": "https://github.com/rust-lang/rust/commit/9f509429cd0fc2290b523bd158953cdfcedcfb12", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f509429cd0fc2290b523bd158953cdfcedcfb12/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0966f3202d1e811cd3aa35ac876b61a211b4819a", "url": "https://api.github.com/repos/rust-lang/rust/commits/0966f3202d1e811cd3aa35ac876b61a211b4819a", "html_url": "https://github.com/rust-lang/rust/commit/0966f3202d1e811cd3aa35ac876b61a211b4819a"}], "stats": {"total": 29, "additions": 14, "deletions": 15}, "files": [{"sha": "180d93b790abd30c75c811282129980d928edab9", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/9f509429cd0fc2290b523bd158953cdfcedcfb12/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/9f509429cd0fc2290b523bd158953cdfcedcfb12/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=9f509429cd0fc2290b523bd158953cdfcedcfb12", "patch": "@@ -2160,6 +2160,18 @@ function initSearch(rawSearchIndex) {\n         printTab(currentTab);\n     }\n \n+    function updateSearchHistory(url) {\n+        if (!browserSupportsHistoryApi()) {\n+            return;\n+        }\n+        const params = searchState.getQueryStringParams();\n+        if (!history.state && !params.search) {\n+            history.pushState(null, \"\", url);\n+        } else {\n+            history.replaceState(null, \"\", url);\n+        }\n+    }\n+\n     /**\n      * Perform a search based on the current state of the search input element\n      * and display the results.\n@@ -2196,15 +2208,7 @@ function initSearch(rawSearchIndex) {\n \n         // Because searching is incremental by character, only the most\n         // recent search query is added to the browser history.\n-        if (browserSupportsHistoryApi()) {\n-            const newURL = buildUrl(query.original, filterCrates);\n-\n-            if (!history.state && !params.search) {\n-                history.pushState(null, \"\", newURL);\n-            } else {\n-                history.replaceState(null, \"\", newURL);\n-            }\n-        }\n+        updateSearchHistory(buildUrl(query.original, filterCrates));\n \n         showResults(\n             execQuery(query, searchWords, filterCrates, window.currentCrate),\n@@ -2670,13 +2674,8 @@ function initSearch(rawSearchIndex) {\n     function updateCrate(ev) {\n         if (ev.target.value === \"all crates\") {\n             // If we don't remove it from the URL, it'll be picked up again by the search.\n-            const params = searchState.getQueryStringParams();\n             const query = searchState.input.value.trim();\n-            if (!history.state && !params.search) {\n-                history.pushState(null, \"\", buildUrl(query, null));\n-            } else {\n-                history.replaceState(null, \"\", buildUrl(query, null));\n-            }\n+            updateSearchHistory(buildUrl(query, null));\n         }\n         // In case you \"cut\" the entry from the search input, then change the crate filter\n         // before paste back the previous search, you get the old search results without"}]}