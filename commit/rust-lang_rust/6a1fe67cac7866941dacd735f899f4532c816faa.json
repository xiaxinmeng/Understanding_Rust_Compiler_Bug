{"sha": "6a1fe67cac7866941dacd735f899f4532c816faa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhMWZlNjdjYWM3ODY2OTQxZGFjZDczNWY4OTlmNDUzMmM4MTZmYWE=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-11-27T21:28:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-11-27T21:28:50Z"}, "message": "Rollup merge of #66777 - GuillaumeGomez:tidy-err-codes, r=Mark-Simulacrum\n\nPut back tidy check on error codes\n\nI just realized that the tidy checks were not run anymore on the error code long explanations. This add it back.\n\ncc @Dylan-DPC\nr? @Mark-Simulacrum", "tree": {"sha": "49ed6058a00e2c4031a2cf4492cf1f58780ff30d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49ed6058a00e2c4031a2cf4492cf1f58780ff30d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a1fe67cac7866941dacd735f899f4532c816faa", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd3uqSCRBK7hj4Ov3rIwAAdHIIAApOX99WxYi7iSKxV7/v+eyp\nhzvc3XcU85YRVJ/MS+gCzFqTzaqbo8T9wYGC6evTsgeB3ydmcwCFWjNuaVfyqFPm\nR8HSiJRg9iynIqeyEhWmIpr9bZY6+FtvGfZ2z8PftOrA9QRbdY4n8ywfia050fN2\nR/nt2Q/JzaHWL3T3Se2pWw0zyOn+h62vZ9D1UKYOjJOn1xsGSlSjEBvYsf/dUveb\nAFljiVQZRdEAbxLXSJYCGsAb8ZB+fXIamdKpj3dbwROLzaD6pgr4t9Xnz9ZZWTY0\nzawGB6yQ8BjPEtD9fgHHIsdtsA9NR8Zp2PYG5LN1Jq9oD2NOoL4qkaax8ZN39Vg=\n=jx13\n-----END PGP SIGNATURE-----\n", "payload": "tree 49ed6058a00e2c4031a2cf4492cf1f58780ff30d\nparent ae49770918af86a3eac0471461190ce40545ac30\nparent 5bb70c14be426e4fac6f5aadf46a564cc23c5267\nauthor Tyler Mandry <tmandry@gmail.com> 1574890130 -0600\ncommitter GitHub <noreply@github.com> 1574890130 -0600\n\nRollup merge of #66777 - GuillaumeGomez:tidy-err-codes, r=Mark-Simulacrum\n\nPut back tidy check on error codes\n\nI just realized that the tidy checks were not run anymore on the error code long explanations. This add it back.\n\ncc @Dylan-DPC\nr? @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a1fe67cac7866941dacd735f899f4532c816faa", "html_url": "https://github.com/rust-lang/rust/commit/6a1fe67cac7866941dacd735f899f4532c816faa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a1fe67cac7866941dacd735f899f4532c816faa/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae49770918af86a3eac0471461190ce40545ac30", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae49770918af86a3eac0471461190ce40545ac30", "html_url": "https://github.com/rust-lang/rust/commit/ae49770918af86a3eac0471461190ce40545ac30"}, {"sha": "5bb70c14be426e4fac6f5aadf46a564cc23c5267", "url": "https://api.github.com/repos/rust-lang/rust/commits/5bb70c14be426e4fac6f5aadf46a564cc23c5267", "html_url": "https://github.com/rust-lang/rust/commit/5bb70c14be426e4fac6f5aadf46a564cc23c5267"}], "stats": {"total": 50, "additions": 28, "deletions": 22}, "files": [{"sha": "021a0219d13e2b60b8e79b49f3fb37132dc6789b", "filename": "src/librustc_error_codes/error_codes/E0015.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0015.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0015.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0015.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -1,4 +1,5 @@\n-A constant item was initialized with something that is not a constant expression.\n+A constant item was initialized with something that is not a constant\n+expression.\n \n Erroneous code example:\n "}, {"sha": "bfe0d21f3129b227862af561c5f66dd025638c7b", "filename": "src/librustc_error_codes/error_codes/E0107.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0107.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0107.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0107.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -25,4 +25,3 @@ fn main() {\n                     //        expected 0, found 1\n }\n ```\n-"}, {"sha": "397979e564105f51da7f12e5cde05e805ab6c0a9", "filename": "src/librustc_error_codes/error_codes/E0369.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0369.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0369.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0369.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -26,4 +26,3 @@ left and may require reallocation. This requires ownership of the string\n on the left. If something should be added to a string literal, move the\n literal to the heap by allocating it with `to_owned()` like in\n `\"Your text\".to_owned()`.\n-"}, {"sha": "201107c05a02c32642db633cf4f107bdc29aab3a", "filename": "src/librustc_error_codes/error_codes/E0404.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0404.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0404.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0404.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -41,4 +41,3 @@ trait Foo {\n \n fn bar<T: Foo>(t: T) {} // ok!\n ```\n-"}, {"sha": "385079d403d59be277a285625120c7442b77ce0a", "filename": "src/librustc_error_codes/error_codes/E0458.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0458.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0458.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0458.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -10,4 +10,3 @@ Please specify a valid \"kind\" value, from one of the following:\n * static\n * dylib\n * framework\n-"}, {"sha": "65cdf90036adeb044aaf7486539dbad5136e86f7", "filename": "src/librustc_error_codes/error_codes/E0633.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0633.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0633.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0633.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -21,4 +21,3 @@ The `#[unwind]` attribute should be used as follows:\n \n NB. The default behavior here is \"allowed\", but this is unspecified\n and likely to change in the future.\n-"}, {"sha": "a39d2be4f8f86bc61bf797d87a5d3f7ae673b1f6", "filename": "src/librustc_error_codes/error_codes/E0635.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0635.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0635.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0635.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -5,4 +5,3 @@ Erroneous code example:\n ```compile_fail,E0635\n #![feature(nonexistent_rust_feature)] // error: unknown feature\n ```\n-"}, {"sha": "57cf72db5568928dd43d4f5b5cc6e149dfd0c495", "filename": "src/librustc_error_codes/error_codes/E0636.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0636.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0636.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0636.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -7,4 +7,3 @@ Erroneous code example:\n #![feature(rust1)]\n #![feature(rust1)] // error: the feature `rust1` has already been declared\n ```\n-"}, {"sha": "e2110042c7e8dd99288aafd36c06643379e03d0f", "filename": "src/librustc_error_codes/error_codes/E0641.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0641.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0641.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0641.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -16,4 +16,4 @@ let a = &(String::from(\"Hello world!\")) as *const _; // Ok\n let b = 0 as *const i32; // Ok\n \n let c: *const i32 = 0 as *const _; // Ok\n-```\n\\ No newline at end of file\n+```"}, {"sha": "7a653bd2264fd4eb07145aa27ad8cb018fb123f2", "filename": "src/librustc_error_codes/error_codes/E0644.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0644.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -27,4 +27,3 @@ closure call itself by capturing a `&Fn()` object or `fn()` pointer\n that refers to itself. That is permitting, since the closure would be\n invoking itself via a virtual call, and hence does not directly\n reference its own *type*.\n-"}, {"sha": "d379b8a2384c675ece632d056a724438c3a5dc47", "filename": "src/librustc_error_codes/error_codes/E0706.md", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0706.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0706.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0706.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -1,4 +1,4 @@\n- `async fn`s are not yet supported in traits in Rust.\n+`async fn`s are not yet supported in traits in Rust.\n \n Erroneous code example:\n \n@@ -10,7 +10,8 @@ trait T {\n }\n ```\n \n-`async fn`s return an `impl Future`, making the following two examples equivalent:\n+`async fn`s return an `impl Future`, making the following two examples\n+equivalent:\n \n ```edition2018,ignore (example-of-desugaring-equivalence)\n async fn foo() -> User {\n@@ -23,8 +24,8 @@ fn foo(&self) -> impl Future<Output = User> + '_ {\n ```\n \n But when it comes to supporting this in traits, there are [a few implementation\n-issues][async-is-hard]. One of them is returning `impl Trait` in traits is not supported,\n-as it would require [Generic Associated Types] to be supported:\n+issues][async-is-hard]. One of them is returning `impl Trait` in traits is not\n+supported, as it would require [Generic Associated Types] to be supported:\n \n ```edition2018,ignore (example-of-desugaring-equivalence)\n impl MyDatabase {\n@@ -40,13 +41,14 @@ impl MyDatabase {\n }\n ```\n \n-Until these issues are resolved, you can use the [`async-trait` crate], allowing you to use\n-`async fn` in traits by desugaring to \"boxed futures\"\n+Until these issues are resolved, you can use the [`async-trait` crate], allowing\n+you to use `async fn` in traits by desugaring to \"boxed futures\"\n (`Pin<Box<dyn Future + Send + 'async>>`).\n \n-Note that using these trait methods will result in a heap allocation per-function-call. This is not\n-a significant cost for the vast majority of applications, but should be considered when deciding\n-whether to use this functionality in the public API of a low-level function that is expected to be\n+Note that using these trait methods will result in a heap allocation\n+per-function-call. This is not a significant cost for the vast majority of\n+applications, but should be considered when deciding whether to use this\n+functionality in the public API of a low-level function that is expected to be\n called millions of times a second.\n \n You might be interested in visiting the [async book] for further information."}, {"sha": "39bebdcd3750e1f324c8e822a7c8290cda61a72a", "filename": "src/librustc_error_codes/error_codes/E0745.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0745.md", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Flibrustc_error_codes%2Ferror_codes%2FE0745.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_error_codes%2Ferror_codes%2FE0745.md?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -11,7 +11,7 @@ fn temp_address() {\n \n To avoid the error, first bind the temporary to a named local variable.\n \n-```ignore\n+```ignore (not yet implemented)\n # #![feature(raw_ref_op)]\n fn temp_address() {\n     let val = 2;"}, {"sha": "20636c86e1e96fd70006c5622624f98bef68a34f", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a1fe67cac7866941dacd735f899f4532c816faa/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=6a1fe67cac7866941dacd735f899f4532c816faa", "patch": "@@ -141,17 +141,28 @@ pub fn check(path: &Path, bad: &mut bool) {\n     super::walk(path, &mut super::filter_dirs, &mut |entry, contents| {\n         let file = entry.path();\n         let filename = file.file_name().unwrap().to_string_lossy();\n-        let extensions = [\".rs\", \".py\", \".js\", \".sh\", \".c\", \".cpp\", \".h\"];\n+        let extensions = [\".rs\", \".py\", \".js\", \".sh\", \".c\", \".cpp\", \".h\", \".md\"];\n         if extensions.iter().all(|e| !filename.ends_with(e)) ||\n            filename.starts_with(\".#\") {\n             return\n         }\n \n+        if filename.ends_with(\".md\") &&\n+           file.parent()\n+               .unwrap()\n+               .file_name()\n+               .unwrap()\n+               .to_string_lossy() != \"error_codes\" {\n+            // We don't want to check all \".md\" files (almost of of them aren't compliant\n+            // currently), just the long error code explanation ones.\n+            return;\n+        }\n+\n         if contents.is_empty() {\n             tidy_error!(bad, \"{}: empty file\", file.display());\n         }\n \n-        let max_columns = if filename == \"error_codes.rs\" {\n+        let max_columns = if filename == \"error_codes.rs\" || filename.ends_with(\".md\") {\n             ERROR_CODE_COLS\n         } else {\n             COLS"}]}