{"sha": "40e340e9fb58c1260a922f9eaafe88dd49868545", "node_id": "C_kwDOAAsO6NoAKDQwZTM0MGU5ZmI1OGMxMjYwYTkyMmY5ZWFhZmU4OGRkNDk4Njg1NDU", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-10-28T13:57:40Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-10-28T14:24:56Z"}, "message": "test most sync primitives on Windows", "tree": {"sha": "d7ba6ea603bdd22401c57768cb13b57535e925d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7ba6ea603bdd22401c57768cb13b57535e925d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40e340e9fb58c1260a922f9eaafe88dd49868545", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40e340e9fb58c1260a922f9eaafe88dd49868545", "html_url": "https://github.com/rust-lang/rust/commit/40e340e9fb58c1260a922f9eaafe88dd49868545", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40e340e9fb58c1260a922f9eaafe88dd49868545/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f99d011f2fc7712c0eb6109f3484d51a3ea1478", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f99d011f2fc7712c0eb6109f3484d51a3ea1478", "html_url": "https://github.com/rust-lang/rust/commit/8f99d011f2fc7712c0eb6109f3484d51a3ea1478"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "b1518a49fbb1b8b6e158d4a081aedf8722498a26", "filename": "src/tools/miri/tests/pass/concurrency/sync.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/40e340e9fb58c1260a922f9eaafe88dd49868545/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fconcurrency%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40e340e9fb58c1260a922f9eaafe88dd49868545/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fconcurrency%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fconcurrency%2Fsync.rs?ref=40e340e9fb58c1260a922f9eaafe88dd49868545", "patch": "@@ -1,4 +1,3 @@\n-//@ignore-target-windows: Condvars on Windows are not supported yet.\n //@compile-flags: -Zmiri-disable-isolation -Zmiri-strict-provenance\n \n use std::sync::{Arc, Barrier, Condvar, Mutex, Once, RwLock};\n@@ -225,14 +224,26 @@ fn park_unpark() {\n }\n \n fn main() {\n-    check_barriers();\n-    check_conditional_variables_notify_one();\n-    check_conditional_variables_timed_wait_timeout();\n-    check_conditional_variables_timed_wait_notimeout();\n     check_mutex();\n     check_rwlock_write();\n     check_rwlock_read_no_deadlock();\n     check_once();\n     park_timeout();\n     park_unpark();\n+\n+    if !cfg!(windows) {\n+        // ignore-target-windows: Condvars on Windows are not supported yet\n+        check_barriers();\n+        check_conditional_variables_notify_one();\n+        check_conditional_variables_timed_wait_timeout();\n+        check_conditional_variables_timed_wait_notimeout();\n+    } else {\n+        // We need to fake the same output...\n+        for _ in 0..10 {\n+            println!(\"before wait\");\n+        }\n+        for _ in 0..10 {\n+            println!(\"after wait\");\n+        }\n+    }\n }"}]}