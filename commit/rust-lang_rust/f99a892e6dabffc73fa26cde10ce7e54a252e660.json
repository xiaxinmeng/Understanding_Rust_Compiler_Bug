{"sha": "f99a892e6dabffc73fa26cde10ce7e54a252e660", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5OWE4OTJlNmRhYmZmYzczZmEyNmNkZTEwY2U3ZTU0YTI1MmU2NjA=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-06-08T04:26:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-08T04:26:35Z"}, "message": "Rollup merge of #86095 - GuillaumeGomez:search-description-codeblock, r=jsha\n\nSearch description codeblock\n\nThe codeblocks are not displayed correctly:\n\n![Screenshot from 2021-06-07 11-11-53](https://user-images.githubusercontent.com/3050060/120991915-5fb05680-c782-11eb-9b32-973a64b1f631.png)\n\nThis PR interprets the HTML correctly (and still prevent invalid HTML because of how it inserts it):\n\n![Screenshot from 2021-06-07 11-12-00](https://user-images.githubusercontent.com/3050060/120991919-6048ed00-c782-11eb-8ac5-c3aa6508bc8b.png)\n\nr? ```@jsha```", "tree": {"sha": "c98e226caa7e1ecae1299564c0717066a0aefe86", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c98e226caa7e1ecae1299564c0717066a0aefe86"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f99a892e6dabffc73fa26cde10ce7e54a252e660", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgvvF7CRBK7hj4Ov3rIwAAvTUIAKeCUh+Hrpk/jyLrNwMcFLBO\nnvNbuSSjmRrtEBs2mwFkMhrxYta4mDeo2Pflvb0n/IbDnDukzvJTru0Ngi5hRkny\nis4rATmsLdwaTzR8QxvvQCJHaSh5ejyE3aZnOUsv9Fy/yrR0HNo/3S1KD21zYeAx\nVsHGtGlsfyfxvYSMn5pvVKUyIEgDri9WJZUn5aZ/YFP2zd4v65OQY/EM+OzOLGVO\nKbMSQrdc6zDMaxPlSqQd+r8h2R0MVLVp7CZ3Srf2kGpezCWTPWgzLE13KoDnBZ8e\nN+7ucQ6d7tWOUN4iixrUiNox51XZPKEZ5LAij4tx4BBuzbSJ1vMG5ptnWRmIC3E=\n=xIcN\n-----END PGP SIGNATURE-----\n", "payload": "tree c98e226caa7e1ecae1299564c0717066a0aefe86\nparent e062121f036e632a2d4a698270dbf3accae919ee\nparent 314ef592e284b16d4cb1764cec79cd5f0e0d0171\nauthor Yuki Okushi <jtitor@2k36.org> 1623126395 +0900\ncommitter GitHub <noreply@github.com> 1623126395 +0900\n\nRollup merge of #86095 - GuillaumeGomez:search-description-codeblock, r=jsha\n\nSearch description codeblock\n\nThe codeblocks are not displayed correctly:\n\n![Screenshot from 2021-06-07 11-11-53](https://user-images.githubusercontent.com/3050060/120991915-5fb05680-c782-11eb-9b32-973a64b1f631.png)\n\nThis PR interprets the HTML correctly (and still prevent invalid HTML because of how it inserts it):\n\n![Screenshot from 2021-06-07 11-12-00](https://user-images.githubusercontent.com/3050060/120991919-6048ed00-c782-11eb-8ac5-c3aa6508bc8b.png)\n\nr? ```@jsha```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f99a892e6dabffc73fa26cde10ce7e54a252e660", "html_url": "https://github.com/rust-lang/rust/commit/f99a892e6dabffc73fa26cde10ce7e54a252e660", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f99a892e6dabffc73fa26cde10ce7e54a252e660/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e062121f036e632a2d4a698270dbf3accae919ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/e062121f036e632a2d4a698270dbf3accae919ee", "html_url": "https://github.com/rust-lang/rust/commit/e062121f036e632a2d4a698270dbf3accae919ee"}, {"sha": "314ef592e284b16d4cb1764cec79cd5f0e0d0171", "url": "https://api.github.com/repos/rust-lang/rust/commits/314ef592e284b16d4cb1764cec79cd5f0e0d0171", "html_url": "https://github.com/rust-lang/rust/commit/314ef592e284b16d4cb1764cec79cd5f0e0d0171"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "35be246b5bf2e52b40a501750c4ba70922a7f2aa", "filename": "src/librustdoc/html/static/search.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f99a892e6dabffc73fa26cde10ce7e54a252e660/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/f99a892e6dabffc73fa26cde10ce7e54a252e660/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js?ref=f99a892e6dabffc73fa26cde10ce7e54a252e660", "patch": "@@ -1024,7 +1024,7 @@ window.initSearch = function(rawSearchIndex) {\n                 var description = document.createElement(\"div\");\n                 description.className = \"desc\";\n                 var spanDesc = document.createElement(\"span\");\n-                spanDesc.innerText = item.desc + \"\\u00A0\";\n+                spanDesc.insertAdjacentHTML(\"beforeend\", item.desc);\n \n                 description.appendChild(spanDesc);\n                 wrapper.appendChild(description);"}, {"sha": "a50d03cf4891248c607b3a906426b08a3195e525", "filename": "src/test/rustdoc-gui/search-result-description.goml", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f99a892e6dabffc73fa26cde10ce7e54a252e660/src%2Ftest%2Frustdoc-gui%2Fsearch-result-description.goml", "raw_url": "https://github.com/rust-lang/rust/raw/f99a892e6dabffc73fa26cde10ce7e54a252e660/src%2Ftest%2Frustdoc-gui%2Fsearch-result-description.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-description.goml?ref=f99a892e6dabffc73fa26cde10ce7e54a252e660", "patch": "@@ -0,0 +1,5 @@\n+// This test is to ensure that the codeblocks are correctly rendered in the search results.\n+goto: file://|DOC_PATH|/test_docs/index.html?search=some_more_function\n+// Waiting for the search results to appear...\n+wait-for: \"#titles\"\n+assert: (\".search-results .desc code\", \"format!\")"}]}