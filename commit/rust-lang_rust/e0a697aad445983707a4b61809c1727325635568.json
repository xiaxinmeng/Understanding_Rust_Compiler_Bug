{"sha": "e0a697aad445983707a4b61809c1727325635568", "node_id": "C_kwDOAAsO6NoAKGUwYTY5N2FhZDQ0NTk4MzcwN2E0YjYxODA5YzE3MjczMjU2MzU1Njg", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-03-21T14:50:05Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-03-25T20:32:16Z"}, "message": "Replace wait-for instructions for rustdoc GUI tests with wait-for-css", "tree": {"sha": "b334ae8c78662884324a17f0151529c2ecf7dd8f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b334ae8c78662884324a17f0151529c2ecf7dd8f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e0a697aad445983707a4b61809c1727325635568", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e0a697aad445983707a4b61809c1727325635568", "html_url": "https://github.com/rust-lang/rust/commit/e0a697aad445983707a4b61809c1727325635568", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e0a697aad445983707a4b61809c1727325635568/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98d51960c4c187fd169bbf7bcb66f228f6d39017", "url": "https://api.github.com/repos/rust-lang/rust/commits/98d51960c4c187fd169bbf7bcb66f228f6d39017", "html_url": "https://github.com/rust-lang/rust/commit/98d51960c4c187fd169bbf7bcb66f228f6d39017"}], "stats": {"total": 55, "additions": 19, "deletions": 36}, "files": [{"sha": "90f0b087a1b8d7198b47849c3366dd561566447f", "filename": "src/test/rustdoc-gui/default-settings.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fdefault-settings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fdefault-settings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fdefault-settings.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -4,5 +4,5 @@\n // check.\n goto: file://|DOC_PATH|/settings/index.html\n // Wait a bit to be sure the default theme is applied.\n-wait-for: 1000\n-assert-css: (\"body\", {\"background-color\": \"rgb(15, 20, 25)\"})\n+// If the theme isn't applied, the command will time out.\n+wait-for-css: (\"body\", {\"background-color\": \"rgb(15, 20, 25)\"})"}, {"sha": "aca8390dfb3d5d914605fc3182fbd6f26babfd90", "filename": "src/test/rustdoc-gui/search-filter.goml", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -24,11 +24,9 @@ assert-property: (\"#crate-search\", {\"value\": \"lib2\"})\n // Now we check that leaving the search results and putting them back keeps the\n // crate filtering.\n press-key: \"Escape\"\n-wait-for: 100\n-assert-css: (\"#main-content\", {\"display\": \"block\"})\n+wait-for-css: (\"#main-content\", {\"display\": \"block\"})\n focus: \".search-input\"\n-wait-for: 100\n-assert-css: (\"#main-content\", {\"display\": \"none\"})\n+wait-for-css: (\"#main-content\", {\"display\": \"none\"})\n // We check that there is no more \"test_docs\" appearing.\n assert-false: \"#results .externcrate\"\n assert-property: (\"#crate-search\", {\"value\": \"lib2\"})"}, {"sha": "255470a3e35904d9353cdbd20e305d52e60e3864", "filename": "src/test/rustdoc-gui/search-result-go-to-first.goml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsearch-result-go-to-first.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsearch-result-go-to-first.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-go-to-first.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -16,5 +16,4 @@ assert-css: (\"#main-content\", {\"display\": \"none\"})\n // Now we can check that the feature is working as expected!\n goto: file://|DOC_PATH|/test_docs/index.html?search=struct%3AFoo&go_to_first=true\n // Waiting for the page to load...\n-wait-for: 500\n-assert-text: (\".fqn .in-band\", \"Struct test_docs::Foo\")\n+wait-for-text: (\".fqn .in-band\", \"Struct test_docs::Foo\")"}, {"sha": "377ee9c6eeff3a9389ad0f85cbe2e7f8553b495a", "filename": "src/test/rustdoc-gui/sidebar-source-code-display.goml", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -5,8 +5,7 @@ goto: file://|DOC_PATH|/src/test_docs/lib.rs.html\n assert-false: \"#sidebar-toggle\"\n // For some reason, we need to wait a bit here because it seems like the transition on opacity\n // is being applied whereas it can't be reproduced in a browser...\n-wait-for: 500\n-assert-css: (\".sidebar > *\", {\"visibility\": \"hidden\", \"opacity\": 0})\n+wait-for-css: (\".sidebar > *\", {\"visibility\": \"hidden\", \"opacity\": 0})\n \n // Let's retry with javascript enabled.\n javascript: true\n@@ -17,6 +16,5 @@ assert-css: (\".sidebar > *:not(#sidebar-toggle)\", {\"visibility\": \"hidden\", \"opac\n // Let's expand the sidebar now.\n click: \"#sidebar-toggle\"\n // Because of the transition CSS, better wait a second before checking.\n-wait-for: 1000\n-assert-css: (\"#sidebar-toggle\", {\"visibility\": \"visible\", \"opacity\": 1})\n+wait-for-css: (\"#sidebar-toggle\", {\"visibility\": \"visible\", \"opacity\": 1})\n assert-css: (\".sidebar > *:not(#sidebar-toggle)\", {\"visibility\": \"visible\", \"opacity\": 1})"}, {"sha": "8b4a8bd40dd7e7ba930975448377862ab3f8ba03", "filename": "src/test/rustdoc-gui/sidebar-source-code.goml", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -7,16 +7,13 @@ size: (1100, 800)\n assert-css: (\"nav.sidebar\", {\"width\": \"50px\"})\n // We now click on the button to expand the sidebar.\n click: (10, 10)\n-// We wait for the sidebar to be expanded (there is a 0.5s animation).\n-wait-for: 600\n-assert-css: (\"nav.sidebar.expanded\", {\"width\": \"300px\"})\n+// We wait for the sidebar to be expanded.\n+wait-for-css: (\"nav.sidebar.expanded\", {\"width\": \"300px\"})\n assert-css: (\"nav.sidebar.expanded a\", {\"font-size\": \"14px\"})\n // We collapse the sidebar.\n click: (10, 10)\n-// We wait for the sidebar to be collapsed (there is a 0.5s animation).\n-wait-for: 600\n // We ensure that the class has been removed.\n-assert-false: \"nav.sidebar.expanded\"\n+wait-for: \"nav.sidebar:not(.expanded)\"\n assert: \"nav.sidebar\"\n \n // We now switch to mobile mode."}, {"sha": "333391ba27970505c7141a8cbf31e491511c5e7e", "filename": "src/test/rustdoc-gui/theme-change.goml", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftheme-change.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -2,26 +2,21 @@\n goto: file://|DOC_PATH|/test_docs/index.html\n click: \"#theme-picker\"\n click: \"#theme-choices > button:first-child\"\n-wait-for: 500\n // should be the ayu theme so let's check the color\n-assert-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n click: \"#theme-choices > button:last-child\"\n-wait-for: 500\n // should be the light theme so let's check the color\n-assert-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n \n goto: file://|DOC_PATH|/settings.html\n click: \"#theme-light\"\n-wait-for: 500\n-assert-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n \n click: \"#theme-dark\"\n-wait-for: 500\n-assert-css: (\"body\", { \"background-color\": \"rgb(53, 53, 53)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(53, 53, 53)\" })\n assert-local-storage: { \"rustdoc-theme\": \"dark\" }\n \n click: \"#theme-ayu\"\n-wait-for: 500\n-assert-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(15, 20, 25)\" })\n assert-local-storage: { \"rustdoc-theme\": \"ayu\" }"}, {"sha": "3b66c85d8dad283e5c1d2fe94b7ac8417449b65c", "filename": "src/test/rustdoc-gui/theme-in-history.goml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftheme-in-history.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftheme-in-history.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftheme-in-history.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -12,8 +12,7 @@ click: \"#settings-menu\"\n wait-for: \".settings\"\n // We change the theme to \"light\".\n click: \"#theme-light\"\n-wait-for: 250\n-assert-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n+wait-for-css: (\"body\", { \"background-color\": \"rgb(255, 255, 255)\" })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n \n // We go back in history."}, {"sha": "63962b576df473dc3b9c4f626da92a77347c902a", "filename": "src/test/rustdoc-gui/toggle-docs.goml", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "raw_url": "https://github.com/rust-lang/rust/raw/e0a697aad445983707a4b61809c1727325635568/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml?ref=e0a697aad445983707a4b61809c1727325635568", "patch": "@@ -8,9 +8,8 @@ wait-for: 50\n assert-attribute-false: (\"#main-content > details.top-doc\", {\"open\": \"\"})\n assert-text: (\"#toggle-all-docs\", \"[+]\")\n click: \"#toggle-all-docs\"\n-wait-for: 50\n // Not collapsed anymore so the \"open\" attribute should be back.\n-assert-attribute: (\"#main-content > details.top-doc\", {\"open\": \"\"})\n+wait-for-attribute: (\"#main-content > details.top-doc\", {\"open\": \"\"})\n assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n \n // Check that it works on non-module pages as well.\n@@ -27,8 +26,7 @@ assert-attribute-false: (\n \n // We collapse them all.\n click: \"#toggle-all-docs\"\n-wait-for: 50\n-assert-text: (\"#toggle-all-docs\", \"[+]\")\n+wait-for-text: (\"#toggle-all-docs\", \"[+]\")\n // We check that all <details> are collapsed (except for the impl block ones).\n assert-attribute-false: (\"details.rustdoc-toggle:not(.implementors-toggle)\", {\"open\": \"\"}, ALL)\n assert-attribute: (\"#implementations-list > details.implementors-toggle\", {\"open\": \"\"})\n@@ -40,6 +38,5 @@ assert-attribute-false: (\n )\n // We open them all again.\n click: \"#toggle-all-docs\"\n-wait-for: 50\n-assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n+wait-for-text: (\"#toggle-all-docs\", \"[\u2212]\")\n assert-attribute: (\"details.rustdoc-toggle\", {\"open\": \"\"}, ALL)"}]}