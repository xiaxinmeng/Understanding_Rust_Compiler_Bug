{"sha": "a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwM2ZiZmUyZmYzZTdkZDAzYWY0MmQzMzdiMTE1NTJlNzgyZTJkYzQ=", "commit": {"author": {"name": "Anton Golov", "email": "jesyspa@gmail.com", "date": "2021-07-31T18:35:37Z"}, "committer": {"name": "Anton Golov", "email": "jesyspa@gmail.com", "date": "2021-08-11T09:35:08Z"}, "message": "Warn when an escaped newline skips multiple lines", "tree": {"sha": "504e4d7aa5d4ab00343a3125d8e02bbcaaf071cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/504e4d7aa5d4ab00343a3125d8e02bbcaaf071cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "html_url": "https://github.com/rust-lang/rust/commit/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/comments", "author": {"login": "jesyspa", "id": 543293, "node_id": "MDQ6VXNlcjU0MzI5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/543293?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesyspa", "html_url": "https://github.com/jesyspa", "followers_url": "https://api.github.com/users/jesyspa/followers", "following_url": "https://api.github.com/users/jesyspa/following{/other_user}", "gists_url": "https://api.github.com/users/jesyspa/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesyspa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesyspa/subscriptions", "organizations_url": "https://api.github.com/users/jesyspa/orgs", "repos_url": "https://api.github.com/users/jesyspa/repos", "events_url": "https://api.github.com/users/jesyspa/events{/privacy}", "received_events_url": "https://api.github.com/users/jesyspa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jesyspa", "id": 543293, "node_id": "MDQ6VXNlcjU0MzI5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/543293?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesyspa", "html_url": "https://github.com/jesyspa", "followers_url": "https://api.github.com/users/jesyspa/followers", "following_url": "https://api.github.com/users/jesyspa/following{/other_user}", "gists_url": "https://api.github.com/users/jesyspa/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesyspa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesyspa/subscriptions", "organizations_url": "https://api.github.com/users/jesyspa/orgs", "repos_url": "https://api.github.com/users/jesyspa/repos", "events_url": "https://api.github.com/users/jesyspa/events{/privacy}", "received_events_url": "https://api.github.com/users/jesyspa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d488de82f30fd1dcb0220d57498638596622394e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d488de82f30fd1dcb0220d57498638596622394e", "html_url": "https://github.com/rust-lang/rust/commit/d488de82f30fd1dcb0220d57498638596622394e"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "6550eed39583c50d7787f2f1567ee004c5e44bb7", "filename": "compiler/rustc_lexer/src/unescape.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_lexer%2Fsrc%2Funescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_lexer%2Fsrc%2Funescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lexer%2Fsrc%2Funescape.rs?ref=a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "patch": "@@ -60,13 +60,17 @@ pub enum EscapeError {\n     /// After a line ending with '\\', the next line contains whitespace\n     /// characters that are not skipped.\n     UnskippedWhitespaceWarning,\n+\n+    /// After a line ending with '\\', multiple lines are skipped.\n+    MultipleSkippedLinesWarning,\n }\n \n impl EscapeError {\n     /// Returns true for actual errors, as opposed to warnings.\n     pub fn is_fatal(&self) -> bool {\n         match self {\n             EscapeError::UnskippedWhitespaceWarning => false,\n+            EscapeError::MultipleSkippedLinesWarning => false,\n             _ => true,\n         }\n     }\n@@ -320,6 +324,11 @@ where\n             .bytes()\n             .position(|b| b != b' ' && b != b'\\t' && b != b'\\n' && b != b'\\r')\n             .unwrap_or(str.len());\n+        if str[1..first_non_space].contains('\\n') {\n+            // The +1 accounts for the escaping slash.\n+            let end = start + first_non_space + 1;\n+            callback(start..end, Err(EscapeError::MultipleSkippedLinesWarning));\n+        }\n         let tail = &str[first_non_space..];\n         if let Some(c) = tail.chars().nth(0) {\n             // For error reporting, we would like the span to contain the character that was not"}, {"sha": "fa61554afde6c5d16c87b462e0ca802b15a7e0a7", "filename": "compiler/rustc_lexer/src/unescape/tests.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_lexer%2Fsrc%2Funescape%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_lexer%2Fsrc%2Funescape%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lexer%2Fsrc%2Funescape%2Ftests.rs?ref=a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "patch": "@@ -106,6 +106,10 @@ fn test_unescape_str_warn() {\n         assert_eq!(unescaped, expected);\n     }\n \n+    // Check we can handle escaped newlines at the end of a file.\n+    check(\"\\\\\\n\", &[]);\n+    check(\"\\\\\\n \", &[]);\n+\n     check(\n         \"\\\\\\n \\u{a0} x\",\n         &[\n@@ -115,6 +119,7 @@ fn test_unescape_str_warn() {\n             (6..7, Ok('x')),\n         ],\n     );\n+    check(\"\\\\\\n  \\n  x\", &[(0..7, Err(EscapeError::MultipleSkippedLinesWarning)), (7..8, Ok('x'))]);\n }\n \n #[test]"}, {"sha": "aa6b424ce2b57ec167c85c7086471cc3165d62ec", "filename": "compiler/rustc_parse/src/lexer/unescape_error_reporting.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03fbfe2ff3e7dd03af42d337b11552e782e2dc4/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flexer%2Funescape_error_reporting.rs?ref=a03fbfe2ff3e7dd03af42d337b11552e782e2dc4", "patch": "@@ -280,6 +280,11 @@ pub(crate) fn emit_unescape_error(\n                 format!(\"non-ASCII whitespace symbol '{}' is not skipped\", c.escape_unicode());\n             handler.struct_span_warn(span, &msg).span_label(char_span, &msg).emit();\n         }\n+        EscapeError::MultipleSkippedLinesWarning => {\n+            let msg = \"multiple lines skipped by escaped newline\";\n+            let bottom_msg = \"skipping everything up to and including this point\";\n+            handler.struct_span_warn(span, msg).span_label(span, bottom_msg).emit();\n+        }\n     }\n }\n "}]}