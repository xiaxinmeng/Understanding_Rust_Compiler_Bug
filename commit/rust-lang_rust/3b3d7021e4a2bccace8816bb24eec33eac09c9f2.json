{"sha": "3b3d7021e4a2bccace8816bb24eec33eac09c9f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiM2Q3MDIxZTRhMmJjY2FjZTg4MTZiYjI0ZWVjMzNlYWMwOWM5ZjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-25T20:01:32Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-26T17:17:03Z"}, "message": "Add test for #13259. Closes #13259 and #14742", "tree": {"sha": "ac28ac0674f39528c2ce53ced6fc8faa616a4e4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac28ac0674f39528c2ce53ced6fc8faa616a4e4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b3d7021e4a2bccace8816bb24eec33eac09c9f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b3d7021e4a2bccace8816bb24eec33eac09c9f2", "html_url": "https://github.com/rust-lang/rust/commit/3b3d7021e4a2bccace8816bb24eec33eac09c9f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b3d7021e4a2bccace8816bb24eec33eac09c9f2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a52eaaa996a7edeb699a756f755ad4b8c23dc9df", "url": "https://api.github.com/repos/rust-lang/rust/commits/a52eaaa996a7edeb699a756f755ad4b8c23dc9df", "html_url": "https://github.com/rust-lang/rust/commit/a52eaaa996a7edeb699a756f755ad4b8c23dc9df"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "94953730df896c4a1bbb9d770b65a6d0eba28c64", "filename": "src/test/run-pass/issue-13259-windows-tcb-trash.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/3b3d7021e4a2bccace8816bb24eec33eac09c9f2/src%2Ftest%2Frun-pass%2Fissue-13259-windows-tcb-trash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b3d7021e4a2bccace8816bb24eec33eac09c9f2/src%2Ftest%2Frun-pass%2Fissue-13259-windows-tcb-trash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-13259-windows-tcb-trash.rs?ref=3b3d7021e4a2bccace8816bb24eec33eac09c9f2", "patch": "@@ -0,0 +1,28 @@\n+extern crate libc;\n+use libc::{c_void, LPVOID, DWORD};\n+use libc::types::os::arch::extra::LPWSTR;\n+\n+extern \"system\" {\n+    fn FormatMessageW(flags: DWORD,\n+                      lpSrc: LPVOID,\n+                      msgId: DWORD,\n+                      langId: DWORD,\n+                      buf: LPWSTR,\n+                      nsize: DWORD,\n+                      args: *const c_void)\n+                      -> DWORD;\n+}\n+\n+fn test() {\n+    let mut buf: [u16, ..50] = [0, ..50];\n+    let ret = unsafe {\n+        FormatMessageW(0x1000, 0 as *mut c_void, 1, 0x400,\n+                       buf.as_mut_ptr(), buf.len() as u32, 0 as *const c_void)\n+    };\n+    // On some 32-bit Windowses (Win7-8 at least) this will fail with segmented\n+    // stacks taking control of pvArbitrary\n+    assert!(ret != 0);\n+}\n+fn main() {\n+    test()\n+}\n\\ No newline at end of file"}]}