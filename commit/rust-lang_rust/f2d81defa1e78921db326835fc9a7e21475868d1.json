{"sha": "f2d81defa1e78921db326835fc9a7e21475868d1", "node_id": "C_kwDOAAsO6NoAKGYyZDgxZGVmYTFlNzg5MjFkYjMyNjgzNWZjOWE3ZTIxNDc1ODY4ZDE", "commit": {"author": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2022-12-01T07:16:57Z"}, "committer": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2023-05-05T23:05:04Z"}, "message": "Add additional test case for repr(packed) allowing union abi opt to kick in.", "tree": {"sha": "a95bc5582659a698cabe69974647b691c964e2c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a95bc5582659a698cabe69974647b691c964e2c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2d81defa1e78921db326835fc9a7e21475868d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2d81defa1e78921db326835fc9a7e21475868d1", "html_url": "https://github.com/rust-lang/rust/commit/f2d81defa1e78921db326835fc9a7e21475868d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2d81defa1e78921db326835fc9a7e21475868d1/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5ab3a06d2a7a16f8774ea0b3c2455465b0962a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5ab3a06d2a7a16f8774ea0b3c2455465b0962a9", "html_url": "https://github.com/rust-lang/rust/commit/d5ab3a06d2a7a16f8774ea0b3c2455465b0962a9"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "46171880a6fe169d60a706e7d588430400a04452", "filename": "tests/ui/layout/debug.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f2d81defa1e78921db326835fc9a7e21475868d1/tests%2Fui%2Flayout%2Fdebug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2d81defa1e78921db326835fc9a7e21475868d1/tests%2Fui%2Flayout%2Fdebug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flayout%2Fdebug.rs?ref=f2d81defa1e78921db326835fc9a7e21475868d1", "patch": "@@ -56,6 +56,10 @@ union P3 { x: F32x4 } //~ ERROR: layout_of\n #[repr(packed(1))]\n union P4 { x: E } //~ ERROR: layout_of\n \n+#[rustc_layout(debug)]\n+#[repr(packed(1))]\n+union P5 { zst: [u16; 0], byte: u8 } //~ ERROR: layout_of\n+\n #[rustc_layout(debug)]\n type X = std::mem::MaybeUninit<u8>; //~ ERROR: layout_of\n "}, {"sha": "b9fa1b299e9697aece36003f632dd1f15c657b0c", "filename": "tests/ui/layout/debug.stderr", "status": "modified", "additions": 29, "deletions": 2, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/f2d81defa1e78921db326835fc9a7e21475868d1/tests%2Fui%2Flayout%2Fdebug.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f2d81defa1e78921db326835fc9a7e21475868d1/tests%2Fui%2Flayout%2Fdebug.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flayout%2Fdebug.stderr?ref=f2d81defa1e78921db326835fc9a7e21475868d1", "patch": "@@ -461,6 +461,33 @@ error: layout_of(P4) = Layout {\n LL | union P4 { x: E }\n    | ^^^^^^^^\n \n+error: layout_of(P5) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Scalar(\n+               Union {\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+               },\n+           ),\n+           fields: Union(\n+               2,\n+           ),\n+           largest_niche: None,\n+           variants: Single {\n+               index: 0,\n+           },\n+       }\n+  --> $DIR/debug.rs:61:1\n+   |\n+LL | union P5 { zst: [u16; 0], byte: u8 }\n+   | ^^^^^^^^\n+\n error: layout_of(std::mem::MaybeUninit<u8>) = Layout {\n            size: Size(1 bytes),\n            align: AbiAndPrefAlign {\n@@ -483,10 +510,10 @@ error: layout_of(std::mem::MaybeUninit<u8>) = Layout {\n                index: 0,\n            },\n        }\n-  --> $DIR/debug.rs:60:1\n+  --> $DIR/debug.rs:64:1\n    |\n LL | type X = std::mem::MaybeUninit<u8>;\n    | ^^^^^^\n \n-error: aborting due to 13 previous errors\n+error: aborting due to 14 previous errors\n "}]}