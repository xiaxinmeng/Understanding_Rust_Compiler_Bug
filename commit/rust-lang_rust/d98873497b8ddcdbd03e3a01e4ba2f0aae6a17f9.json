{"sha": "d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "node_id": "C_kwDOAAsO6NoAKGQ5ODg3MzQ5N2I4ZGRjZGJkMDNlM2EwMWU0YmEyZjBhYWU2YTE3Zjk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-28T15:21:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-28T15:21:32Z"}, "message": "Auto merge of #10418 - Jarcho:finish_dogfood, r=flip1995\n\nRun dogfood to completion\n\nRun dogfood on all packages before failing the test. Failing early is painful on lints which trigger on multiple crates.\n\nchangelog: None", "tree": {"sha": "0c6c7d7d915b6b6a7f95cbdabc49b539095c56de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c6c7d7d915b6b6a7f95cbdabc49b539095c56de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "html_url": "https://github.com/rust-lang/rust/commit/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a11ad739013ef7e0bfe5bf7f60690bed441af24", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a11ad739013ef7e0bfe5bf7f60690bed441af24", "html_url": "https://github.com/rust-lang/rust/commit/1a11ad739013ef7e0bfe5bf7f60690bed441af24"}, {"sha": "69a11007762717d88701453bab64fcd24e08ac14", "url": "https://api.github.com/repos/rust-lang/rust/commits/69a11007762717d88701453bab64fcd24e08ac14", "html_url": "https://github.com/rust-lang/rust/commit/69a11007762717d88701453bab64fcd24e08ac14"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "9643c2c970704a35dd343193a01807755dc9a8ae", "filename": "tests/dogfood.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=d98873497b8ddcdbd03e3a01e4ba2f0aae6a17f9", "patch": "@@ -7,6 +7,7 @@\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]\n #![warn(rust_2018_idioms, unused_lifetimes)]\n \n+use itertools::Itertools;\n use std::path::PathBuf;\n use std::process::Command;\n use test_utils::IS_RUSTC_TEST_SUITE;\n@@ -19,17 +20,27 @@ fn dogfood_clippy() {\n         return;\n     }\n \n+    let mut failed_packages = Vec::new();\n+\n     // \"\" is the root package\n-    for package in &[\n+    for package in [\n         \"\",\n         \"clippy_dev\",\n         \"clippy_lints\",\n         \"clippy_utils\",\n         \"lintcheck\",\n         \"rustc_tools_util\",\n     ] {\n-        run_clippy_for_package(package, &[\"-D\", \"clippy::all\", \"-D\", \"clippy::pedantic\"]);\n+        if !run_clippy_for_package(package, &[\"-D\", \"clippy::all\", \"-D\", \"clippy::pedantic\"]) {\n+            failed_packages.push(if package.is_empty() { \"root\" } else { package });\n+        }\n     }\n+\n+    assert!(\n+        !failed_packages.is_empty(),\n+        \"Dogfood failed for packages `{}`\",\n+        failed_packages.iter().format(\", \"),\n+    )\n }\n \n #[test]\n@@ -71,7 +82,7 @@ fn run_metadata_collection_lint() {\n     run_clippy_for_package(\"clippy_lints\", &[\"-A\", \"unfulfilled_lint_expectations\"]);\n }\n \n-fn run_clippy_for_package(project: &str, args: &[&str]) {\n+fn run_clippy_for_package(project: &str, args: &[&str]) -> bool {\n     let root_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n \n     let mut command = Command::new(&*test_utils::CARGO_CLIPPY_PATH);\n@@ -107,5 +118,5 @@ fn run_clippy_for_package(project: &str, args: &[&str]) {\n     println!(\"stdout: {}\", String::from_utf8_lossy(&output.stdout));\n     println!(\"stderr: {}\", String::from_utf8_lossy(&output.stderr));\n \n-    assert!(output.status.success());\n+    output.status.success()\n }"}]}