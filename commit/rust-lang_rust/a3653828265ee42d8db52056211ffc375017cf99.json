{"sha": "a3653828265ee42d8db52056211ffc375017cf99", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzNjUzODI4MjY1ZWU0MmQ4ZGI1MjA1NjIxMWZmYzM3NTAxN2NmOTk=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-04T06:35:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-04T06:35:51Z"}, "message": "Rollup merge of #52969 - Keruspe:local_rebuild, r=alexcrichton\n\nrustbuild: fix local_rebuild\n\nIf we detect a local rebuild (e.g. bootstrap compiler is the same version as target compiler), we set stage to 1.\nWhen trying to build e.g. UnstableBook, we use Mode::ToolBootstrap and stage is 1.\nJust allow Mode::ToolBootstrap and stagge != 0 if we are in a local_rebuild\n\nThis fixes building current master using current beta (as master hasn't yet been bumped to 1.30).\nThis should be backported to beta too, as currently we cannot build beta using itself because of that.\n\nr? @alexcrichton", "tree": {"sha": "e85639df63487609aa2ee91ce490fe34c29297d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e85639df63487609aa2ee91ce490fe34c29297d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3653828265ee42d8db52056211ffc375017cf99", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbZUlICRBK7hj4Ov3rIwAAdHIIABcsAzmOeW/tM8+JZIa/xrCl\n5BTAp9gZOQjz5n7Ynt1Igxzu2/3MGylI1Rgp1mMHx5nSCqmIVkjDxEJlk0T1hTL8\nxLFOg4aMauoRekMzmNTRzJKwo9JD5TYqadWvMOFRiXCD1YTU5lyxNaF1MMFMFFr3\n6cVyP2tfBbOQZFHEE7cJkUQcEENqk3YAT7M8vX8CWpWz7J+UYuYEuTYGZHLgl7Xe\n/BBstzHNLZVdL8DEUeLxC5vkRn0U7t2EtJ5V3nkT+dPDkQDoH8qHdpA+65rnd0Mp\nrJ5q/dR2CotSNobjFmBdv2qk/zloK9ejNXpQr05n7i7DcCnKisbTgzQA0Z7SFLs=\n=dEp9\n-----END PGP SIGNATURE-----\n", "payload": "tree e85639df63487609aa2ee91ce490fe34c29297d0\nparent e82dab7c0eba73ce701e810748bce03502f2c4cb\nparent 66a47182d10542b68773d8a1cb9230a4918a5068\nauthor kennytm <kennytm@gmail.com> 1533364551 +0800\ncommitter GitHub <noreply@github.com> 1533364551 +0800\n\nRollup merge of #52969 - Keruspe:local_rebuild, r=alexcrichton\n\nrustbuild: fix local_rebuild\n\nIf we detect a local rebuild (e.g. bootstrap compiler is the same version as target compiler), we set stage to 1.\nWhen trying to build e.g. UnstableBook, we use Mode::ToolBootstrap and stage is 1.\nJust allow Mode::ToolBootstrap and stagge != 0 if we are in a local_rebuild\n\nThis fixes building current master using current beta (as master hasn't yet been bumped to 1.30).\nThis should be backported to beta too, as currently we cannot build beta using itself because of that.\n\nr? @alexcrichton\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3653828265ee42d8db52056211ffc375017cf99", "html_url": "https://github.com/rust-lang/rust/commit/a3653828265ee42d8db52056211ffc375017cf99", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3653828265ee42d8db52056211ffc375017cf99/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e82dab7c0eba73ce701e810748bce03502f2c4cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e82dab7c0eba73ce701e810748bce03502f2c4cb", "html_url": "https://github.com/rust-lang/rust/commit/e82dab7c0eba73ce701e810748bce03502f2c4cb"}, {"sha": "66a47182d10542b68773d8a1cb9230a4918a5068", "url": "https://api.github.com/repos/rust-lang/rust/commits/66a47182d10542b68773d8a1cb9230a4918a5068", "html_url": "https://github.com/rust-lang/rust/commit/66a47182d10542b68773d8a1cb9230a4918a5068"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "dc0b0aaf0bb3c894802f18be4d2e21e94b11a57c", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a3653828265ee42d8db52056211ffc375017cf99/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3653828265ee42d8db52056211ffc375017cf99/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=a3653828265ee42d8db52056211ffc375017cf99", "patch": "@@ -777,7 +777,7 @@ impl<'a> Builder<'a> {\n         // compiler, but for tools we just use the precompiled libraries that\n         // we've downloaded\n         let use_snapshot = mode == Mode::ToolBootstrap;\n-        assert!(!use_snapshot || stage == 0);\n+        assert!(!use_snapshot || stage == 0 || self.local_rebuild);\n \n         let maybe_sysroot = self.sysroot(compiler);\n         let sysroot = if use_snapshot {"}]}