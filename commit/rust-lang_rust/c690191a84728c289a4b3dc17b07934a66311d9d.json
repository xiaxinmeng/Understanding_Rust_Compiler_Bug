{"sha": "c690191a84728c289a4b3dc17b07934a66311d9d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2OTAxOTFhODQ3MjhjMjg5YTRiM2RjMTdiMDc5MzRhNjYzMTFkOWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-06-11T02:52:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-06-11T02:52:05Z"}, "message": "auto merge of #14777 : alexcrichton/rust/issue-14747, r=huonw\n\nWhen generating documentation, rustdoc has the ability to generate relative\r\nlinks within the current distribution of crates to one another. To do this, it\r\nmust recognize when a crate's documentation is in the same output directory. The\r\ncurrent threshold for \"local documentation for crate X being available\" is\r\nwhether the directory \"doc/X\" exists.\r\n\r\nThis change modifies the build system to have new dependencies for each\r\ndirectory of upstream crates for a rustdoc invocation. This will ensure that\r\nwhen building documentation that all the crates in the standard distribution are\r\nguaranteed to have relative links to one another.\r\n\r\nThis change is prompted by guaranteeing that offline docs always work with one\r\nanother. Before this change, races could mean that some docs were built before\r\nothers, and hence may have http links when relative links would suffice.\r\n\r\nCloses #14747", "tree": {"sha": "ac026b547e0ac89559763163860ec07b895fcd98", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac026b547e0ac89559763163860ec07b895fcd98"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c690191a84728c289a4b3dc17b07934a66311d9d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c690191a84728c289a4b3dc17b07934a66311d9d", "html_url": "https://github.com/rust-lang/rust/commit/c690191a84728c289a4b3dc17b07934a66311d9d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c690191a84728c289a4b3dc17b07934a66311d9d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f92a8facf90b40a483032cedb98decc8c41bde51", "url": "https://api.github.com/repos/rust-lang/rust/commits/f92a8facf90b40a483032cedb98decc8c41bde51", "html_url": "https://github.com/rust-lang/rust/commit/f92a8facf90b40a483032cedb98decc8c41bde51"}, {"sha": "992a2db1fc64987c0c68c66e74bff81468b6f7b8", "url": "https://api.github.com/repos/rust-lang/rust/commits/992a2db1fc64987c0c68c66e74bff81468b6f7b8", "html_url": "https://github.com/rust-lang/rust/commit/992a2db1fc64987c0c68c66e74bff81468b6f7b8"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "575ecec9d92d3109314fc0f69f564af63e834470", "filename": "mk/docs.mk", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c690191a84728c289a4b3dc17b07934a66311d9d/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/c690191a84728c289a4b3dc17b07934a66311d9d/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=c690191a84728c289a4b3dc17b07934a66311d9d", "patch": "@@ -273,14 +273,18 @@ LIB_DOC_DEP_$(1) = \\\n \t$$(RSINPUTS_$(1)) \\\n \t$$(RUSTDOC_EXE) \\\n \t$$(foreach dep,$$(RUST_DEPS_$(1)), \\\n-\t\t$$(TLIB2_T_$(CFG_BUILD)_H_$(CFG_BUILD))/stamp.$$(dep))\n+\t\t$$(TLIB2_T_$(CFG_BUILD)_H_$(CFG_BUILD))/stamp.$$(dep) \\\n+\t\tdoc/$$(dep)/)\n else\n LIB_DOC_DEP_$(1) = $$(CRATEFILE_$(1)) $$(RSINPUTS_$(1))\n endif\n \n+doc/$(1)/:\n+\t$$(Q)mkdir -p $$@\n+\n $(2) += doc/$(1)/index.html\n doc/$(1)/index.html: CFG_COMPILER_HOST_TRIPLE = $(CFG_TARGET)\n-doc/$(1)/index.html: $$(LIB_DOC_DEP_$(1))\n+doc/$(1)/index.html: $$(LIB_DOC_DEP_$(1)) doc/$(1)/\n \t@$$(call E, rustdoc $$@)\n \t$$(Q)$$(RUSTDOC) --cfg dox --cfg stage2 $$<\n endef"}]}