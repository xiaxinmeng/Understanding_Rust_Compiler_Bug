{"sha": "ca1c13a8968e95ab9eff4c692fed2a57e0308342", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhMWMxM2E4OTY4ZTk1YWI5ZWZmNGM2OTJmZWQyYTU3ZTAzMDgzNDI=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-06-25T09:02:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-06-25T09:02:24Z"}, "message": "Merge pull request #2804 from Mike-Baker/mb-strip-vert-in-match-arms\n\nStrip leading `|` in match arm patterns", "tree": {"sha": "4c1f4df6fe0f488a3d7025b3b5ebe8cbe5996d96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c1f4df6fe0f488a3d7025b3b5ebe8cbe5996d96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca1c13a8968e95ab9eff4c692fed2a57e0308342", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbMK+gCRBK7hj4Ov3rIwAAdHIIAGb+X0FJ44OGukbiArxqlLBR\npjORSAg5ICvnMGTNAl/4sGYaHra8qqx32ZkrOzVxf2ODJggO/Pzjuv4c4cJuVbCi\naXkoySgsL/D0FmSlXQx9Ls4ky0UbL9YyRCF1UUCv72GpnHL2BzBb+uEV77Jil6cd\np8xu78Brxr+O7epGk+w5fLIKgQjBoPE6yb2gyax1c3KK1EzscBOtfqojpeCDTA6M\ntbPBvAKjIWIAF8LFZCPFprnKfq4RawUPjaZK9lqxaLzRcmOVZcOysiZV2HkN/Woc\nmXK5s5HNvL0atf8ksoezMaiNNZUBsEONdasN5LEGmVug1NtZ5eF5GJ0ivDo0AKQ=\n=9Glc\n-----END PGP SIGNATURE-----\n", "payload": "tree 4c1f4df6fe0f488a3d7025b3b5ebe8cbe5996d96\nparent 0877517eb214dced599c41292571de9abc9dd6ca\nparent 1d4b988414e48f16c1aa44a79e6f4b11d929bb76\nauthor Nick Cameron <nrc@ncameron.org> 1529917344 +1200\ncommitter GitHub <noreply@github.com> 1529917344 +1200\n\nMerge pull request #2804 from Mike-Baker/mb-strip-vert-in-match-arms\n\nStrip leading `|` in match arm patterns"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca1c13a8968e95ab9eff4c692fed2a57e0308342", "html_url": "https://github.com/rust-lang/rust/commit/ca1c13a8968e95ab9eff4c692fed2a57e0308342", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca1c13a8968e95ab9eff4c692fed2a57e0308342/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0877517eb214dced599c41292571de9abc9dd6ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/0877517eb214dced599c41292571de9abc9dd6ca", "html_url": "https://github.com/rust-lang/rust/commit/0877517eb214dced599c41292571de9abc9dd6ca"}, {"sha": "1d4b988414e48f16c1aa44a79e6f4b11d929bb76", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d4b988414e48f16c1aa44a79e6f4b11d929bb76", "html_url": "https://github.com/rust-lang/rust/commit/1d4b988414e48f16c1aa44a79e6f4b11d929bb76"}], "stats": {"total": 93, "additions": 47, "deletions": 46}, "files": [{"sha": "d46b19be7234c12cc88e7c8776f0f1d5e276e072", "filename": "src/matches.rs", "status": "modified", "additions": 15, "deletions": 25, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/ca1c13a8968e95ab9eff4c692fed2a57e0308342/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca1c13a8968e95ab9eff4c692fed2a57e0308342/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=ca1c13a8968e95ab9eff4c692fed2a57e0308342", "patch": "@@ -68,7 +68,7 @@ impl<'a> Spanned for ArmWrapper<'a> {\n \n impl<'a> Rewrite for ArmWrapper<'a> {\n     fn rewrite(&self, context: &RewriteContext, shape: Shape) -> Option<String> {\n-        rewrite_match_arm(context, self.arm, shape, self.is_last, self.beginning_vert)\n+        rewrite_match_arm(context, self.arm, shape, self.is_last)\n     }\n }\n \n@@ -236,7 +236,6 @@ fn rewrite_match_arm(\n     arm: &ast::Arm,\n     shape: Shape,\n     is_last: bool,\n-    beginning_vert: Option<BytePos>,\n ) -> Option<String> {\n     let (missing_span, attrs_str) = if !arm.attrs.is_empty() {\n         if contains_skip(&arm.attrs) {\n@@ -256,22 +255,18 @@ fn rewrite_match_arm(\n     } else {\n         (mk_sp(arm.span().lo(), arm.span().lo()), String::new())\n     };\n-    let pats_str = rewrite_match_pattern(\n-        context,\n-        &ptr_vec_to_ref_vec(&arm.pats),\n-        &arm.guard,\n-        beginning_vert.is_some(),\n-        shape,\n-    ).and_then(|pats_str| {\n-        combine_strs_with_missing_comments(\n-            context,\n-            &attrs_str,\n-            &pats_str,\n-            missing_span,\n-            shape,\n-            false,\n-        )\n-    })?;\n+    let pats_str =\n+        rewrite_match_pattern(context, &ptr_vec_to_ref_vec(&arm.pats), &arm.guard, shape)\n+            .and_then(|pats_str| {\n+                combine_strs_with_missing_comments(\n+                    context,\n+                    &attrs_str,\n+                    &pats_str,\n+                    missing_span,\n+                    shape,\n+                    false,\n+                )\n+            })?;\n     rewrite_match_body(\n         context,\n         &arm.body,\n@@ -286,22 +281,17 @@ fn rewrite_match_pattern(\n     context: &RewriteContext,\n     pats: &[&ast::Pat],\n     guard: &Option<ptr::P<ast::Expr>>,\n-    has_beginning_vert: bool,\n     shape: Shape,\n ) -> Option<String> {\n     // Patterns\n     // 5 = ` => {`\n-    // 2 = `| `\n-    let pat_shape = shape\n-        .sub_width(5)?\n-        .offset_left(if has_beginning_vert { 2 } else { 0 })?;\n+    let pat_shape = shape.sub_width(5)?;\n     let pats_str = rewrite_multiple_patterns(context, pats, pat_shape)?;\n-    let beginning_vert = if has_beginning_vert { \"| \" } else { \"\" };\n \n     // Guard\n     let guard_str = rewrite_guard(context, guard, shape, trimmed_last_line_width(&pats_str))?;\n \n-    Some(format!(\"{}{}{}\", beginning_vert, pats_str, guard_str))\n+    Some(format!(\"{}{}\", pats_str, guard_str))\n }\n \n // (extend, body)"}, {"sha": "244d0b45f258492d674faa8f90e1797596163999", "filename": "tests/source/match.rs", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/ca1c13a8968e95ab9eff4c692fed2a57e0308342/tests%2Fsource%2Fmatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca1c13a8968e95ab9eff4c692fed2a57e0308342/tests%2Fsource%2Fmatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fmatch.rs?ref=ca1c13a8968e95ab9eff4c692fed2a57e0308342", "patch": "@@ -452,17 +452,6 @@ fn issue_2152() {\n     }\n }\n \n-// #2462\n-// Preserve a `|` at the beginning of a match arm.\n-fn match_with_beginning_vert() {\n-    let x = Foo::A;\n-    match x {\n-        | Foo::A\n-        | Foo::B => println!(\"AB\"),\n-        | Foo::C => println!(\"C\"),\n-    }\n-}\n-\n // #2376\n // Preserve block around expressions with condition.\n fn issue_2376() {\n@@ -485,3 +474,20 @@ fn issue_2376() {\n         }\n     }\n }\n+\n+// #2621\n+// Strip leading `|` in match arm patterns\n+fn issue_2621() {\n+    let x = Foo::A;\n+    match x {\n+        Foo::A => println!(\"No vert single condition\"),\n+        Foo::B | Foo::C => println!(\"Center vert two conditions\"),\n+        | Foo::D => println!(\"Preceding vert single condition\"),\n+        | Foo::E\n+        | Foo::F => println!(\"Preceding vert over two lines\"),\n+        Foo::G |\n+        Foo::H => println!(\"Trailing vert over two lines\"),\n+        // Comment on its own line\n+        | Foo::I => println!(\"With comment\"), // Comment after line\n+    }\n+}"}, {"sha": "be1ecb49535ce8cccd22463a6cb01b6974c87fd5", "filename": "tests/target/match.rs", "status": "modified", "additions": 15, "deletions": 10, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ca1c13a8968e95ab9eff4c692fed2a57e0308342/tests%2Ftarget%2Fmatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca1c13a8968e95ab9eff4c692fed2a57e0308342/tests%2Ftarget%2Fmatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fmatch.rs?ref=ca1c13a8968e95ab9eff4c692fed2a57e0308342", "patch": "@@ -481,16 +481,6 @@ fn issue_2152() {\n     }\n }\n \n-// #2462\n-// Preserve a `|` at the beginning of a match arm.\n-fn match_with_beginning_vert() {\n-    let x = Foo::A;\n-    match x {\n-        | Foo::A | Foo::B => println!(\"AB\"),\n-        | Foo::C => println!(\"C\"),\n-    }\n-}\n-\n // #2376\n // Preserve block around expressions with condition.\n fn issue_2376() {\n@@ -513,3 +503,18 @@ fn issue_2376() {\n         }\n     }\n }\n+\n+// #2621\n+// Strip leading `|` in match arm patterns\n+fn issue_2621() {\n+    let x = Foo::A;\n+    match x {\n+        Foo::A => println!(\"No vert single condition\"),\n+        Foo::B | Foo::C => println!(\"Center vert two conditions\"),\n+        Foo::D => println!(\"Preceding vert single condition\"),\n+        Foo::E | Foo::F => println!(\"Preceding vert over two lines\"),\n+        Foo::G | Foo::H => println!(\"Trailing vert over two lines\"),\n+        // Comment on its own line\n+        Foo::I => println!(\"With comment\"), // Comment after line\n+    }\n+}"}]}