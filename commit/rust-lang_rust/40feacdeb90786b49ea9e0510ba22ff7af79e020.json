{"sha": "40feacdeb90786b49ea9e0510ba22ff7af79e020", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwZmVhY2RlYjkwNzg2YjQ5ZWE5ZTA1MTBiYTIyZmY3YWY3OWUwMjA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-31T18:09:43Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-31T20:23:30Z"}, "message": "split macros across crates", "tree": {"sha": "294162ffb99480a5f150b9718675a954a4ac0f0a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/294162ffb99480a5f150b9718675a954a4ac0f0a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40feacdeb90786b49ea9e0510ba22ff7af79e020", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40feacdeb90786b49ea9e0510ba22ff7af79e020", "html_url": "https://github.com/rust-lang/rust/commit/40feacdeb90786b49ea9e0510ba22ff7af79e020", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40feacdeb90786b49ea9e0510ba22ff7af79e020/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad80a0c551458de7d27a98d182d7f559de04f291", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad80a0c551458de7d27a98d182d7f559de04f291", "html_url": "https://github.com/rust-lang/rust/commit/ad80a0c551458de7d27a98d182d7f559de04f291"}], "stats": {"total": 86, "additions": 57, "deletions": 29}, "files": [{"sha": "426f4af2727832d8b9753cd8864f7bb7119904bc", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -940,8 +940,9 @@ dependencies = [\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ra_arena 0.1.0\",\n  \"ra_db 0.1.0\",\n- \"ra_macros 0.1.0\",\n+ \"ra_mbe 0.1.0\",\n  \"ra_syntax 0.1.0\",\n+ \"ra_tt 0.1.0\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n@@ -1019,9 +1020,10 @@ dependencies = [\n ]\n \n [[package]]\n-name = \"ra_macros\"\n+name = \"ra_mbe\"\n version = \"0.1.0\"\n dependencies = [\n+ \"ra_tt 0.1.0\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"smol_str 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -1052,6 +1054,14 @@ dependencies = [\n  \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"ra_tt\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"smol_str 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"ra_vfs\"\n version = \"0.1.0\""}, {"sha": "4309a05d6b1d5e145a9dc7b4104d27c0c3ddd17e", "filename": "crates/ra_hir/Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_hir%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_hir%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2FCargo.toml?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -16,7 +16,8 @@ join_to_string = \"0.1.3\"\n ra_syntax = { path = \"../ra_syntax\" }\n ra_arena = { path = \"../ra_arena\" }\n ra_db = { path = \"../ra_db\" }\n-ra_macros = { path = \"../ra_macros\" }\n+mbe = { path = \"../ra_mbe\", package = \"ra_mbe\" }\n+tt = { path = \"../ra_tt\", package = \"ra_tt\" }\n test_utils = { path = \"../test_utils\" }\n \n [dev-dependencies]"}, {"sha": "ffcf1c3f94229526891b0c363cf09ad4e5962ed1", "filename": "crates/ra_hir/src/macros.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_hir%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_hir%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fmacros.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -14,7 +14,6 @@ use ra_syntax::{\n     SyntaxKind::*,\n     ast::{self, NameOwner},\n };\n-use ra_macros::{tt, mbe};\n \n use crate::{HirDatabase, MacroCallId};\n "}, {"sha": "e35a056ccf8c6af0f8777e55625f8da807459b25", "filename": "crates/ra_macros/src/lib.rs", "status": "removed", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ad80a0c551458de7d27a98d182d7f559de04f291/crates%2Fra_macros%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad80a0c551458de7d27a98d182d7f559de04f291/crates%2Fra_macros%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_macros%2Fsrc%2Flib.rs?ref=ad80a0c551458de7d27a98d182d7f559de04f291", "patch": "@@ -1,17 +0,0 @@\n-macro_rules! impl_froms {\n-    ($e:ident: $($v:ident), *) => {\n-        $(\n-            impl From<$v> for $e {\n-                fn from(it: $v) -> $e {\n-                    $e::$v(it)\n-                }\n-            }\n-        )*\n-    }\n-}\n-\n-pub mod tt;\n-pub mod mbe;\n-mod tt_cursor;\n-mod mbe_parser;\n-mod mbe_expander;"}, {"sha": "b7f03cd38125f4153eaee45224a28f5a8d1f9258", "filename": "crates/ra_mbe/Cargo.toml", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2FCargo.toml?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -0,0 +1,10 @@\n+[package]\n+edition = \"2018\"\n+name = \"ra_mbe\"\n+version = \"0.1.0\"\n+authors = [\"Aleksey Kladov <aleksey.kladov@gmail.com>\"]\n+\n+[dependencies]\n+tt = { path = \"../ra_tt\", package = \"ra_tt\" }\n+rustc-hash = \"1.0.0\"\n+smol_str = \"0.1.9\""}, {"sha": "38bf3431a0735ffaf3e6a2cc3f800a2823d630c8", "filename": "crates/ra_mbe/src/lib.rs", "status": "renamed", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Flib.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,6 +1,22 @@\n+macro_rules! impl_froms {\n+    ($e:ident: $($v:ident), *) => {\n+        $(\n+            impl From<$v> for $e {\n+                fn from(it: $v) -> $e {\n+                    $e::$v(it)\n+                }\n+            }\n+        )*\n+    }\n+}\n+\n+mod tt_cursor;\n+mod mbe_parser;\n+mod mbe_expander;\n+\n use smol_str::SmolStr;\n \n-pub(crate) use crate::tt::{Delimiter, Punct};\n+pub use tt::{Delimiter, Punct};\n \n pub use crate::{\n     mbe_parser::parse,", "previous_filename": "crates/ra_macros/src/mbe.rs"}, {"sha": "92ad26889c6c12f614eb64eb6822304b14ce40e8", "filename": "crates/ra_mbe/src/mbe_expander.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,7 +1,7 @@\n use rustc_hash::FxHashMap;\n use smol_str::SmolStr;\n \n-use crate::{mbe, tt, tt_cursor::TtCursor};\n+use crate::{self as mbe, tt_cursor::TtCursor};\n \n pub fn exapnd(rules: &mbe::MacroRules, input: &tt::Subtree) -> Option<tt::Subtree> {\n     rules.rules.iter().find_map(|it| expand_rule(it, input))", "previous_filename": "crates/ra_macros/src/mbe_expander.rs"}, {"sha": "a70ed1d52ec2830d61327454b40bce0eb68e2df6", "filename": "crates/ra_mbe/src/mbe_parser.rs", "status": "renamed", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Fmbe_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Fmbe_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fmbe_parser.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,5 +1,4 @@\n-use crate::{tt, mbe};\n-use crate::tt_cursor::TtCursor;\n+use crate::{self as mbe, tt_cursor::TtCursor};\n \n /// This module parses a raw `tt::TokenStream` into macro-by-example token\n /// stream. This is a *mostly* identify function, expect for handling of\n@@ -43,7 +42,7 @@ fn parse_subtree(tt: &tt::Subtree) -> Option<mbe::Subtree> {\n                     mbe::Leaf::from(mbe::Literal { text: text.clone() }).into()\n                 }\n             },\n-            tt::TokenTree::Subtree(subtree) => parse_subtree(subtree)?.into(),\n+            tt::TokenTree::Subtree(subtree) => parse_subtree(&subtree)?.into(),\n         };\n         token_trees.push(child);\n     }", "previous_filename": "crates/ra_macros/src/mbe_parser.rs"}, {"sha": "30c8eda673e93925c234f1313962308cea2f69b1", "filename": "crates/ra_mbe/src/tt_cursor.rs", "status": "renamed", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,5 +1,3 @@\n-use crate::tt;\n-\n #[derive(Clone)]\n pub(crate) struct TtCursor<'a> {\n     subtree: &'a tt::Subtree,", "previous_filename": "crates/ra_macros/src/tt_cursor.rs"}, {"sha": "357a5c5a33ec6a1364291b94c16687080476f883", "filename": "crates/ra_tt/Cargo.toml", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_tt%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_tt%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tt%2FCargo.toml?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,6 +1,6 @@\n [package]\n edition = \"2018\"\n-name = \"ra_macros\"\n+name = \"ra_tt\"\n version = \"0.1.0\"\n authors = [\"Aleksey Kladov <aleksey.kladov@gmail.com>\"]\n ", "previous_filename": "crates/ra_macros/Cargo.toml"}, {"sha": "d7c3c62bf7c8186bfccb9e8284338c952afd6b92", "filename": "crates/ra_tt/src/lib.rs", "status": "renamed", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_tt%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40feacdeb90786b49ea9e0510ba22ff7af79e020/crates%2Fra_tt%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tt%2Fsrc%2Flib.rs?ref=40feacdeb90786b49ea9e0510ba22ff7af79e020", "patch": "@@ -1,3 +1,15 @@\n+macro_rules! impl_froms {\n+    ($e:ident: $($v:ident), *) => {\n+        $(\n+            impl From<$v> for $e {\n+                fn from(it: $v) -> $e {\n+                    $e::$v(it)\n+                }\n+            }\n+        )*\n+    }\n+}\n+\n use std::fmt;\n \n use smol_str::SmolStr;", "previous_filename": "crates/ra_macros/src/tt.rs"}]}