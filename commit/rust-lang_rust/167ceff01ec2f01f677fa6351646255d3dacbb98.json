{"sha": "167ceff01ec2f01f677fa6351646255d3dacbb98", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2N2NlZmYwMWVjMmYwMWY2NzdmYTYzNTE2NDYyNTVkM2RhY2JiOTg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-08T22:16:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-08T22:16:13Z"}, "message": "Auto merge of #56407 - GuillaumeGomez:missing-docs-reexported-macros, r=varkor\n\ncheck missing docs for reexported macros as well\n\nFixes #56334.", "tree": {"sha": "fa3a3ea838d5da3d10393bff6e8eeec35e428bc8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa3a3ea838d5da3d10393bff6e8eeec35e428bc8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/167ceff01ec2f01f677fa6351646255d3dacbb98", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/167ceff01ec2f01f677fa6351646255d3dacbb98", "html_url": "https://github.com/rust-lang/rust/commit/167ceff01ec2f01f677fa6351646255d3dacbb98", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/167ceff01ec2f01f677fa6351646255d3dacbb98/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d22fa2d87d03d19fdb1359faab9ec5e74eff26b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/d22fa2d87d03d19fdb1359faab9ec5e74eff26b3", "html_url": "https://github.com/rust-lang/rust/commit/d22fa2d87d03d19fdb1359faab9ec5e74eff26b3"}, {"sha": "0b272e740051192344c36f0444d9ef28f2ab31fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b272e740051192344c36f0444d9ef28f2ab31fe", "html_url": "https://github.com/rust-lang/rust/commit/0b272e740051192344c36f0444d9ef28f2ab31fe"}], "stats": {"total": 121, "additions": 100, "deletions": 21}, "files": [{"sha": "b2cafc4cede2e60d00a25ff272ee4c153bf7cd7d", "filename": "src/libcore/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibcore%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibcore%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Flib.rs?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -122,6 +122,8 @@\n #![feature(reverse_bits)]\n #![feature(non_exhaustive)]\n #![feature(structural_match)]\n+#![feature(abi_unadjusted)]\n+#![cfg_attr(not(stage0), feature(adx_target_feature))]\n \n #[prelude_import]\n #[allow(unused)]"}, {"sha": "5678f30dabccd5b98112ece998330c1132daac80", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 29, "deletions": 20, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -297,6 +297,26 @@ pub struct MissingDoc {\n     private_traits: FxHashSet<ast::NodeId>,\n }\n \n+fn has_doc(attr: &ast::Attribute) -> bool {\n+    if !attr.check_name(\"doc\") {\n+        return false;\n+    }\n+\n+    if attr.is_value_str() {\n+        return true;\n+    }\n+\n+    if let Some(list) = attr.meta_item_list() {\n+        for meta in list {\n+            if meta.check_name(\"include\") || meta.check_name(\"hidden\") {\n+                return true;\n+            }\n+        }\n+    }\n+\n+    false\n+}\n+\n impl MissingDoc {\n     pub fn new() -> MissingDoc {\n         MissingDoc {\n@@ -335,26 +355,6 @@ impl MissingDoc {\n             }\n         }\n \n-        fn has_doc(attr: &ast::Attribute) -> bool {\n-            if !attr.check_name(\"doc\") {\n-                return false;\n-            }\n-\n-            if attr.is_value_str() {\n-                return true;\n-            }\n-\n-            if let Some(list) = attr.meta_item_list() {\n-                for meta in list {\n-                    if meta.check_name(\"include\") {\n-                        return true;\n-                    }\n-                }\n-            }\n-\n-            false\n-        }\n-\n         let has_doc = attrs.iter().any(|a| has_doc(a));\n         if !has_doc {\n             cx.span_lint(MISSING_DOCS,\n@@ -389,6 +389,15 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MissingDoc {\n \n     fn check_crate(&mut self, cx: &LateContext, krate: &hir::Crate) {\n         self.check_missing_docs_attrs(cx, None, &krate.attrs, krate.span, \"crate\");\n+\n+        for macro_def in &krate.exported_macros {\n+            let has_doc = macro_def.attrs.iter().any(|a| has_doc(a));\n+            if !has_doc {\n+                cx.span_lint(MISSING_DOCS,\n+                             cx.tcx.sess.source_map().def_span(macro_def.span),\n+                             \"missing documentation for macro\");\n+            }\n+        }\n     }\n \n     fn check_item(&mut self, cx: &LateContext, it: &hir::Item) {"}, {"sha": "b87257188df10c50a1e34cccff76191c838f2769", "filename": "src/libstd/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibstd%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Flibstd%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacros.rs?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -322,6 +322,7 @@ macro_rules! dbg {\n     }\n }\n \n+/// A macro to await on an async call.\n #[macro_export]\n #[unstable(feature = \"await_macro\", issue = \"50547\")]\n #[allow_internal_unstable]"}, {"sha": "269d0ba959f70e9b692e528311c78b8f9601d4af", "filename": "src/stdsimd", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fstdsimd?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -1 +1 @@\n-Subproject commit ddb30221d7985e813b4214d14c2a560ed6ee0991\n+Subproject commit 269d0ba959f70e9b692e528311c78b8f9601d4af"}, {"sha": "910c99314e49bc50a7f9d579c04fc2a055841792", "filename": "src/test/rustdoc-ui/deny-missing-docs-crate.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![deny(missing_docs)] //~ ERROR\n+\n+pub struct Foo; //~ ERROR"}, {"sha": "7f0590e0b229bb829b2639801092d6f530cde945", "filename": "src/test/rustdoc-ui/deny-missing-docs-crate.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -0,0 +1,22 @@\n+error: missing documentation for crate\n+  --> $DIR/deny-missing-docs-crate.rs:11:1\n+   |\n+LL | / #![deny(missing_docs)] //~ ERROR\n+LL | |\n+LL | | pub struct Foo; //~ ERROR\n+   | |_______________^\n+   |\n+note: lint level defined here\n+  --> $DIR/deny-missing-docs-crate.rs:11:9\n+   |\n+LL | #![deny(missing_docs)] //~ ERROR\n+   |         ^^^^^^^^^^^^\n+\n+error: missing documentation for a struct\n+  --> $DIR/deny-missing-docs-crate.rs:13:1\n+   |\n+LL | pub struct Foo; //~ ERROR\n+   | ^^^^^^^^^^^^^^^\n+\n+error: Compilation failed, aborting rustdoc\n+"}, {"sha": "a12fe17e0cb61a287cd385386a05cef50c80db2e", "filename": "src/test/rustdoc-ui/deny-missing-docs-macro.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+//! foo\n+\n+#![deny(missing_docs)]\n+\n+#[macro_export]\n+macro_rules! foo { //~ ERROR\n+    () => {}\n+}"}, {"sha": "686a45030e6ca113add5eac27b94b8bc0b7c6e57", "filename": "src/test/rustdoc-ui/deny-missing-docs-macro.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/167ceff01ec2f01f677fa6351646255d3dacbb98/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr?ref=167ceff01ec2f01f677fa6351646255d3dacbb98", "patch": "@@ -0,0 +1,14 @@\n+error: missing documentation for macro\n+  --> $DIR/deny-missing-docs-macro.rs:16:1\n+   |\n+LL | macro_rules! foo { //~ ERROR\n+   | ^^^^^^^^^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/deny-missing-docs-macro.rs:13:9\n+   |\n+LL | #![deny(missing_docs)]\n+   |         ^^^^^^^^^^^^\n+\n+error: Compilation failed, aborting rustdoc\n+"}]}