{"sha": "f272688bbb1e007126384e8a0474ec1ea64dc481", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyNzI2ODhiYmIxZTAwNzEyNjM4NGU4YTA0NzRlYzFlYTY0ZGM0ODE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-25T22:50:12Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-25T22:50:12Z"}, "message": "Auto merge of #53612 - mark-i-m:anon_param_disallowed_2018, r=petrochenkov\n\nRemove anonymous trait params from 2018 and beyond\n\ncc @Centril @nikomatsakis\ncc #41686 rust-lang/rfcs#2522 #53272\n\nThis PR removes support for anonymous trait parameters syntactically in rust 2018 and onward.\n\nTODO:\n- [x] Add tests", "tree": {"sha": "0336c6ffc3684e6ab57ffbe4fae15e57ea382976", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0336c6ffc3684e6ab57ffbe4fae15e57ea382976"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f272688bbb1e007126384e8a0474ec1ea64dc481", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f272688bbb1e007126384e8a0474ec1ea64dc481", "html_url": "https://github.com/rust-lang/rust/commit/f272688bbb1e007126384e8a0474ec1ea64dc481", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f272688bbb1e007126384e8a0474ec1ea64dc481/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39e6ba82182b264c94bc62a1284d115b50ff1bd3", "url": "https://api.github.com/repos/rust-lang/rust/commits/39e6ba82182b264c94bc62a1284d115b50ff1bd3", "html_url": "https://github.com/rust-lang/rust/commit/39e6ba82182b264c94bc62a1284d115b50ff1bd3"}, {"sha": "b32b6e803b8e7ad1ee2258ef5784af7e4010be4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b32b6e803b8e7ad1ee2258ef5784af7e4010be4b", "html_url": "https://github.com/rust-lang/rust/commit/b32b6e803b8e7ad1ee2258ef5784af7e4010be4b"}], "stats": {"total": 153, "additions": 70, "deletions": 83}, "files": [{"sha": "1695d3a8f96b033cb41cbc8ecb70230766356131", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -1376,7 +1376,13 @@ impl<'a> Parser<'a> {\n                 // This is somewhat dubious; We don't want to allow\n                 // argument names to be left off if there is a\n                 // definition...\n-                p.parse_arg_general(false)\n+\n+                // We don't allow argument names to be left off in edition 2018.\n+                if p.span.edition() >= Edition::Edition2018 {\n+                    p.parse_arg_general(true)\n+                } else {\n+                    p.parse_arg_general(false)\n+                }\n             })?;\n             generics.where_clause = self.parse_where_clause()?;\n "}, {"sha": "5e77aa8fbb923fdf17dcdbc6985e5a947fc2d1a6", "filename": "src/test/ui/anon-params-denied-2018.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-denied-2018.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-denied-2018.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fanon-params-denied-2018.rs?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -0,0 +1,12 @@\n+// Tests that anonymous parameters are a hard error in edition 2018.\n+\n+// edition:2018\n+\n+trait T {\n+    fn foo(i32); //~ expected one of `:` or `@`, found `)`\n+\n+    fn bar_with_default_impl(String, String) {}\n+    //~^ ERROR expected one of `:` or `@`, found `,`\n+}\n+\n+fn main() {}"}, {"sha": "24a1e6ecd932c75dbb940187a96f45b04a5487de", "filename": "src/test/ui/anon-params-denied-2018.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-denied-2018.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-denied-2018.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fanon-params-denied-2018.stderr?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -0,0 +1,14 @@\n+error: expected one of `:` or `@`, found `)`\n+  --> $DIR/anon-params-denied-2018.rs:6:15\n+   |\n+LL |     fn foo(i32); //~ expected one of `:` or `@`, found `)`\n+   |               ^ expected one of `:` or `@` here\n+\n+error: expected one of `:` or `@`, found `,`\n+  --> $DIR/anon-params-denied-2018.rs:8:36\n+   |\n+LL |     fn bar_with_default_impl(String, String) {}\n+   |                                    ^ expected one of `:` or `@` here\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "7eee47dcb5fc7e801eaf89a8c20b28df46f2455e", "filename": "src/test/ui/anon-params-deprecated.fixed", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fanon-params-deprecated.fixed?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -0,0 +1,19 @@\n+#![warn(anonymous_parameters)]\n+// Test for the anonymous_parameters deprecation lint (RFC 1685)\n+\n+// compile-pass\n+// edition:2015\n+// run-rustfix\n+\n+trait T {\n+    fn foo(_: i32); //~ WARNING anonymous parameters are deprecated\n+                 //~| WARNING hard error\n+\n+    fn bar_with_default_impl(_: String, _: String) {}\n+    //~^ WARNING anonymous parameters are deprecated\n+    //~| WARNING hard error\n+    //~| WARNING anonymous parameters are deprecated\n+    //~| WARNING hard error\n+}\n+\n+fn main() {}"}, {"sha": "74de0c0b83407492b1b2840660a1d8a23d27537a", "filename": "src/test/ui/anon-params-deprecated.rs", "status": "modified", "additions": 8, "deletions": 14, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fanon-params-deprecated.rs?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -1,24 +1,18 @@\n-// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#![forbid(anonymous_parameters)]\n+#![warn(anonymous_parameters)]\n // Test for the anonymous_parameters deprecation lint (RFC 1685)\n \n+// compile-pass\n+// edition:2015\n+// run-rustfix\n+\n trait T {\n-    fn foo(i32); //~ ERROR anonymous parameters are deprecated\n+    fn foo(i32); //~ WARNING anonymous parameters are deprecated\n                  //~| WARNING hard error\n \n     fn bar_with_default_impl(String, String) {}\n-    //~^ ERROR anonymous parameters are deprecated\n+    //~^ WARNING anonymous parameters are deprecated\n     //~| WARNING hard error\n-    //~| ERROR anonymous parameters are deprecated\n+    //~| WARNING anonymous parameters are deprecated\n     //~| WARNING hard error\n }\n "}, {"sha": "e1c27ceefa9e07726aaa217b9bfb4cf4e540fcb9", "filename": "src/test/ui/anon-params-deprecated.stderr", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f272688bbb1e007126384e8a0474ec1ea64dc481/src%2Ftest%2Fui%2Fanon-params-deprecated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fanon-params-deprecated.stderr?ref=f272688bbb1e007126384e8a0474ec1ea64dc481", "patch": "@@ -1,34 +1,32 @@\n-error: anonymous parameters are deprecated and will be removed in the next edition.\n-  --> $DIR/anon-params-deprecated.rs:15:12\n+warning: anonymous parameters are deprecated and will be removed in the next edition.\n+  --> $DIR/anon-params-deprecated.rs:9:12\n    |\n-LL |     fn foo(i32); //~ ERROR anonymous parameters are deprecated\n+LL |     fn foo(i32); //~ WARNING anonymous parameters are deprecated\n    |            ^^^ help: Try naming the parameter or explicitly ignoring it: `_: i32`\n    |\n note: lint level defined here\n-  --> $DIR/anon-params-deprecated.rs:11:11\n+  --> $DIR/anon-params-deprecated.rs:1:9\n    |\n-LL | #![forbid(anonymous_parameters)]\n-   |           ^^^^^^^^^^^^^^^^^^^^\n+LL | #![warn(anonymous_parameters)]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n \n-error: anonymous parameters are deprecated and will be removed in the next edition.\n-  --> $DIR/anon-params-deprecated.rs:18:30\n+warning: anonymous parameters are deprecated and will be removed in the next edition.\n+  --> $DIR/anon-params-deprecated.rs:12:30\n    |\n LL |     fn bar_with_default_impl(String, String) {}\n    |                              ^^^^^^ help: Try naming the parameter or explicitly ignoring it: `_: String`\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n \n-error: anonymous parameters are deprecated and will be removed in the next edition.\n-  --> $DIR/anon-params-deprecated.rs:18:38\n+warning: anonymous parameters are deprecated and will be removed in the next edition.\n+  --> $DIR/anon-params-deprecated.rs:12:38\n    |\n LL |     fn bar_with_default_impl(String, String) {}\n    |                                      ^^^^^^ help: Try naming the parameter or explicitly ignoring it: `_: String`\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n \n-error: aborting due to 3 previous errors\n-"}, {"sha": "c4379b496f8d4fd1a112fa70243099799fab93c6", "filename": "src/test/ui/lint/lint-anon-param-edition.fixed", "status": "removed", "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.fixed?ref=39e6ba82182b264c94bc62a1284d115b50ff1bd3", "patch": "@@ -1,23 +0,0 @@\n-// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-// tests that the anonymous_parameters lint is warn-by-default on the 2018 edition\n-\n-// compile-pass\n-// edition:2018\n-// run-rustfix\n-\n-trait Foo {\n-    fn foo(_: u8);\n-    //^ WARN anonymous parameters are deprecated\n-    //| WARN this was previously accepted\n-}\n-\n-fn main() {}"}, {"sha": "13eb5dfd816ab0e18860b4ccb9871e9712c99d6e", "filename": "src/test/ui/lint/lint-anon-param-edition.rs", "status": "removed", "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.rs?ref=39e6ba82182b264c94bc62a1284d115b50ff1bd3", "patch": "@@ -1,23 +0,0 @@\n-// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-// tests that the anonymous_parameters lint is warn-by-default on the 2018 edition\n-\n-// compile-pass\n-// edition:2018\n-// run-rustfix\n-\n-trait Foo {\n-    fn foo(u8);\n-    //^ WARN anonymous parameters are deprecated\n-    //| WARN this was previously accepted\n-}\n-\n-fn main() {}"}, {"sha": "de347770aec77aa7d52ab68716268b7d13675c27", "filename": "src/test/ui/lint/lint-anon-param-edition.stderr", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/39e6ba82182b264c94bc62a1284d115b50ff1bd3/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-anon-param-edition.stderr?ref=39e6ba82182b264c94bc62a1284d115b50ff1bd3", "patch": "@@ -1,10 +0,0 @@\n-warning: anonymous parameters are deprecated and will be removed in the next edition.\n-  --> $DIR/lint-anon-param-edition.rs:18:12\n-   |\n-LL |     fn foo(u8);\n-   |            ^^ help: Try naming the parameter or explicitly ignoring it: `_: u8`\n-   |\n-   = note: #[warn(anonymous_parameters)] on by default\n-   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n-   = note: for more information, see issue #41686 <https://github.com/rust-lang/rust/issues/41686>\n-"}]}