{"sha": "7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxNjlmZTU3ZDY2ZGVkYWQyMWYyZGNmNGM2MTVmZWI5YWI3ZDNmNWE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-09-01T18:09:39Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-09-01T19:24:17Z"}, "message": "Fallback to dladdr-based resolve_symbol if backtrace failed.\n\nThis programs compiled without -g on macOS still provide the resolve to\nactual symbols, instead of `<unknown>` everywhere.", "tree": {"sha": "fd4ba028cbbe25c3909c6af82cdc9b03ef005c65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd4ba028cbbe25c3909c6af82cdc9b03ef005c65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJZqbPhAAoJEP72yAUdDgE8veEQAIy5MTIUxsWF1F4LPP/CzYSR\nTgBcDb9SNXUfD/vxiHXk49DmCnUFeBLPmFuPwZnrcAsbOtPQc0OAEddC8wNNU9dF\nSkWV+yZQcaMEneT3lf1GRdtIblPwtPjsa6X10X3gIpPMm7w3pZlyLhu2v+J5VgQT\nndryy0AUbgOFb4i2ePh/w6qnt9FZQXojTRplU42Cs3ZVEA4oD/vhn8DzbYlURvcr\nTr+vlGdArXxJF8sqNzgAyczn4Ru3Pe8iYy45hcSOekCPO+kYtX5tVTHEVC6cNO6a\ngrRGpy+whvS0jSJfVa4OjRzmgDSD7BLB/VJvrestOp3NVzUZ5pWODP6VDMoHWknn\nhxhdAY4gBSnh9rOM1hcXjYYrxQTILaMSNLWERUBNB26iNfP/uCOsK9LfGyejHWip\nA3mOu3Gq8XHjWJZRuAZV7YPfeZoCAGQYIOdEMQGsJRXXokQSFaWi/HIMV8reDzKZ\nG5xiS6ky0m7oAGjrfghwUIIoSH1p8IxZ6PcYb8TyaNgLCNaskyq3j7QYTLRlORKZ\nQNLwy6rW0Dqd+N+OZGgbi9x3kE0kdB8VPoW8K7gtRX3suCSkLBkCo481wPyoUQ2x\nahz6NyElZDpEPCVu9jIuU7QVkq6dp8n0hAtru36ilgiFoHtYqPOBEw3pIZxQvy/c\njA+HIMYYs5XSx8U2JvTp\n=i0xU\n-----END PGP SIGNATURE-----", "payload": "tree fd4ba028cbbe25c3909c6af82cdc9b03ef005c65\nparent 09f572b7dccb65ba148d42070f65663c947f93a3\nauthor kennytm <kennytm@gmail.com> 1504289379 +0800\ncommitter kennytm <kennytm@gmail.com> 1504293857 +0800\n\nFallback to dladdr-based resolve_symbol if backtrace failed.\n\nThis programs compiled without -g on macOS still provide the resolve to\nactual symbols, instead of `<unknown>` everywhere.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "html_url": "https://github.com/rust-lang/rust/commit/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09f572b7dccb65ba148d42070f65663c947f93a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/09f572b7dccb65ba148d42070f65663c947f93a3", "html_url": "https://github.com/rust-lang/rust/commit/09f572b7dccb65ba148d42070f65663c947f93a3"}], "stats": {"total": 43, "additions": 29, "deletions": 14}, "files": [{"sha": "3a3912af021ce46cba0864cbf39984291b5e14a4", "filename": "src/libstd/sys/unix/backtrace/printing/dladdr.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fdladdr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fdladdr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fdladdr.rs?ref=7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "patch": "@@ -31,14 +31,6 @@ pub fn resolve_symname<F>(frame: Frame,\n     }\n }\n \n-pub fn foreach_symbol_fileline<F>(_symbol_addr: Frame,\n-                                  _f: F,\n-                                  _: &BacktraceContext) -> io::Result<bool>\n-    where F: FnMut(&[u8], libc::c_int) -> io::Result<()>\n-{\n-    Ok(false)\n-}\n-\n #[repr(C)]\n struct Dl_info {\n     dli_fname: *const libc::c_char,"}, {"sha": "8bd2d9eccd82a73db84ee6662d4df33e2af8e192", "filename": "src/libstd/sys/unix/backtrace/printing/mod.rs", "status": "modified", "additions": 29, "deletions": 6, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fbacktrace%2Fprinting%2Fmod.rs?ref=7169fe57d66dedad21f2dcf4c615feb9ab7d3f5a", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2014-2015 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2014-2017 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -8,13 +8,36 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-pub use self::imp::{foreach_symbol_fileline, resolve_symname};\n+mod dladdr;\n+\n+use sys::backtrace::BacktraceContext;\n+use sys_common::backtrace::Frame;\n+use io;\n+\n+#[cfg(target_os = \"emscripten\")]\n+pub use self::dladdr::resolve_symname;\n \n #[cfg(target_os = \"emscripten\")]\n-#[path = \"dladdr.rs\"]\n-mod imp;\n+pub fn foreach_symbol_fileline<F>(_: Frame, _: F, _: &BacktraceContext) -> io::Result<bool>\n+where\n+    F: FnMut(&[u8], ::libc::c_int) -> io::Result<()>\n+{\n+    Ok(false)\n+}\n+\n+#[cfg(not(target_os = \"emscripten\"))]\n+pub use sys_common::gnu::libbacktrace::foreach_symbol_fileline;\n \n #[cfg(not(target_os = \"emscripten\"))]\n-mod imp {\n-    pub use sys_common::gnu::libbacktrace::{foreach_symbol_fileline, resolve_symname};\n+pub fn resolve_symname<F>(frame: Frame, callback: F, bc: &BacktraceContext) -> io::Result<()>\n+where\n+    F: FnOnce(Option<&str>) -> io::Result<()>\n+{\n+    ::sys_common::gnu::libbacktrace::resolve_symname(frame, |symname| {\n+        if symname.is_some() {\n+            callback(symname)\n+        } else {\n+            dladdr::resolve_symname(frame, callback, bc)\n+        }\n+    }, bc)\n }"}]}