{"sha": "aa29364f831c4633613ba7e28cae147e69107d66", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhMjkzNjRmODMxYzQ2MzM2MTNiYTdlMjhjYWUxNDdlNjkxMDdkNjY=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-06-07T17:06:03Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-06-07T17:06:03Z"}, "message": "Reorder CompletionContext fields", "tree": {"sha": "af11d666532cf41e7084dd6f7f21c2cd663c809d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af11d666532cf41e7084dd6f7f21c2cd663c809d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa29364f831c4633613ba7e28cae147e69107d66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa29364f831c4633613ba7e28cae147e69107d66", "html_url": "https://github.com/rust-lang/rust/commit/aa29364f831c4633613ba7e28cae147e69107d66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa29364f831c4633613ba7e28cae147e69107d66/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b6c3eaaeb6b074c7cbe34f25b7736157b13f84a", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b6c3eaaeb6b074c7cbe34f25b7736157b13f84a", "html_url": "https://github.com/rust-lang/rust/commit/8b6c3eaaeb6b074c7cbe34f25b7736157b13f84a"}], "stats": {"total": 33, "additions": 15, "deletions": 18}, "files": [{"sha": "58762a3cd434f7973c941a21f0cbed6c827303bb", "filename": "crates/ide_completion/src/context.rs", "status": "modified", "additions": 14, "deletions": 16, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/aa29364f831c4633613ba7e28cae147e69107d66/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa29364f831c4633613ba7e28cae147e69107d66/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcontext.rs?ref=aa29364f831c4633613ba7e28cae147e69107d66", "patch": "@@ -67,14 +67,13 @@ pub(crate) struct CompletionContext<'a> {\n     pub(super) krate: Option<hir::Crate>,\n     pub(super) expected_name: Option<NameOrNameRef>,\n     pub(super) expected_type: Option<Type>,\n-    pub(super) name_ref_syntax: Option<ast::NameRef>,\n-\n-    pub(super) use_item_syntax: Option<ast::Use>,\n \n     /// The parent function of the cursor position if it exists.\n     pub(super) function_def: Option<ast::Fn>,\n     /// The parent impl of the cursor position if it exists.\n     pub(super) impl_def: Option<ast::Impl>,\n+    pub(super) name_ref_syntax: Option<ast::NameRef>,\n+    pub(super) use_item_syntax: Option<ast::Use>,\n \n     // potentially set if we are completing a lifetime\n     pub(super) lifetime_syntax: Option<ast::Lifetime>,\n@@ -89,13 +88,12 @@ pub(crate) struct CompletionContext<'a> {\n     pub(super) completion_location: Option<ImmediateLocation>,\n     pub(super) prev_sibling: Option<ImmediatePrevSibling>,\n     pub(super) attribute_under_caret: Option<ast::Attr>,\n+    pub(super) previous_token: Option<SyntaxToken>,\n \n     pub(super) path_context: Option<PathCompletionContext>,\n-    /// FIXME: `ActiveParameter` is string-based, which is very very wrong\n     pub(super) active_parameter: Option<ActiveParameter>,\n     pub(super) locals: Vec<(String, Local)>,\n \n-    pub(super) previous_token: Option<SyntaxToken>,\n     pub(super) in_loop_body: bool,\n     pub(super) incomplete_let: bool,\n \n@@ -143,28 +141,28 @@ impl<'a> CompletionContext<'a> {\n             original_token,\n             token,\n             krate,\n-            lifetime_allowed: false,\n             expected_name: None,\n             expected_type: None,\n+            function_def: None,\n+            impl_def: None,\n             name_ref_syntax: None,\n+            use_item_syntax: None,\n             lifetime_syntax: None,\n             lifetime_param_syntax: None,\n-            function_def: None,\n-            use_item_syntax: None,\n-            impl_def: None,\n-            active_parameter: ActiveParameter::at(db, position),\n+            lifetime_allowed: false,\n             is_label_ref: false,\n-            is_param: false,\n             is_pat_or_const: None,\n-            path_context: None,\n-            previous_token: None,\n-            in_loop_body: false,\n+            is_param: false,\n             completion_location: None,\n             prev_sibling: None,\n-            no_completion_required: false,\n-            incomplete_let: false,\n             attribute_under_caret: None,\n+            previous_token: None,\n+            path_context: None,\n+            active_parameter: ActiveParameter::at(db, position),\n             locals,\n+            in_loop_body: false,\n+            incomplete_let: false,\n+            no_completion_required: false,\n         };\n \n         let mut original_file = original_file.syntax().clone();"}, {"sha": "933bcad55b24a77daddbd352ad006138f03fe2e8", "filename": "crates/ide_db/src/call_info.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/aa29364f831c4633613ba7e28cae147e69107d66/crates%2Fide_db%2Fsrc%2Fcall_info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa29364f831c4633613ba7e28cae147e69107d66/crates%2Fide_db%2Fsrc%2Fcall_info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fcall_info.rs?ref=aa29364f831c4633613ba7e28cae147e69107d66", "patch": "@@ -223,9 +223,8 @@ impl FnCallNode {\n                 ast::Expr::PathExpr(path_expr) => path_expr.path()?.segment()?.name_ref()?,\n                 _ => return None,\n             }),\n-\n             FnCallNode::MethodCallExpr(call_expr) => {\n-                call_expr.syntax().children().filter_map(ast::NameRef::cast).next()\n+                call_expr.syntax().children().find_map(ast::NameRef::cast)\n             }\n         }\n     }"}]}