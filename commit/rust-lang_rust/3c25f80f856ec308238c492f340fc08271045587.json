{"sha": "3c25f80f856ec308238c492f340fc08271045587", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjMjVmODBmODU2ZWMzMDgyMzhjNDkyZjM0MGZjMDgyNzEwNDU1ODc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-10-24T09:29:53Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-10-24T12:42:33Z"}, "message": "ci: Move global credentials to web configuration\n\nThis commit moves a number of our encrypted credentials stored in\nconfiguration files in this repository to env vars on the web UI. This\nwill hopefully make it easier to rotate credentials in the future as\nwell as quickly change them if the need arises. (quicker than landing a\nPR that is).\n\nThis also updates the travis deployment process to always use the `aws`\ncommand line tool which we're already installing on Linux and should\nenable us to avoid all `dpl` gem issues as well as have greater control\nover what's going where.", "tree": {"sha": "6c6d4057597aa8144b5dba30c8666f644e045dd1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6c6d4057597aa8144b5dba30c8666f644e045dd1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c25f80f856ec308238c492f340fc08271045587", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c25f80f856ec308238c492f340fc08271045587", "html_url": "https://github.com/rust-lang/rust/commit/3c25f80f856ec308238c492f340fc08271045587", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c25f80f856ec308238c492f340fc08271045587/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f99911a4a0bead7dd1f9ef2f90442844434cc391", "url": "https://api.github.com/repos/rust-lang/rust/commits/f99911a4a0bead7dd1f9ef2f90442844434cc391", "html_url": "https://github.com/rust-lang/rust/commit/f99911a4a0bead7dd1f9ef2f90442844434cc391"}], "stats": {"total": 129, "additions": 24, "deletions": 105}, "files": [{"sha": "990cac4dbe98b04621f14d66473ed8d870867317", "filename": ".travis.yml", "status": "modified", "additions": 20, "deletions": 90, "changes": 110, "blob_url": "https://github.com/rust-lang/rust/blob/3c25f80f856ec308238c492f340fc08271045587/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/3c25f80f856ec308238c492f340fc08271045587/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=3c25f80f856ec308238c492f340fc08271045587", "patch": "@@ -197,23 +197,10 @@ matrix:\n         . src/ci/docker/x86_64-gnu-tools/repo.sh;\n         commit_toolstate_change \"$MESSAGE_FILE\" \"$TRAVIS_BUILD_DIR/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"$MESSAGE_FILE\" \"$TOOLSTATE_REPO_ACCESS_TOKEN\";\n \n-env:\n-  global:\n-    - SCCACHE_BUCKET=rust-lang-ci-sccache2\n-    - SCCACHE_REGION=us-west-1\n-    - AWS_ACCESS_KEY_ID=AKIAJAMV3QAMMA6AXHFQ\n-    # AWS_SECRET_ACCESS_KEY=...\n-    - secure: \"j96XxTVOSUf4s4r4htIxn/fvIa5DWbMgLqWl7r8z2QfgUwscmkMXAwXuFNc7s7bGTpV/+CgDiMFFM6BAFLGKutytIF6oA02s9b+usQYnM0th7YQ2AIgm9GtMTJCJp4AoyfFmh8F2faUICBZlfVLUJ34udHEe35vOklix+0k4WDo=\"\n-    # TOOLSTATE_REPO_ACCESS_TOKEN=...\n-    - secure: \"ESfcXqv4N2VMhqi2iIyw6da9VrsA78I4iR1asouCaq4hzTTrkB4WNRrfURy6xg72gQ4nMhtRJbB0/2jmc9Cu1+g2CzXtyiL223aJ5CKrXdcvbitopQSDfp07dMWm+UED+hNFEanpErKAeU/6FM3A+J+60PMk8MCF1h9tqNRISJw=\"\n-\n before_install:\n-  # We'll use the AWS cli to download/upload cached docker layers, so install\n-  # that here.\n-  - if [ \"$TRAVIS_OS_NAME\" = linux ]; then\n-      pip install --user awscli;\n-      export PATH=$PATH:$HOME/.local/bin;\n-    fi\n+  # We'll use the AWS cli to download/upload cached docker layers as well as\n+  # push our deployments, so download that here.\n+  - pip install --user awscli; export PATH=$PATH:$HOME/.local/bin\n   - mkdir -p $HOME/rustsrc\n   # FIXME(#46924): these two commands are required to enable IPv6,\n   # they shouldn't exist, please revert once more official solutions appeared.\n@@ -276,6 +263,23 @@ after_success:\n       echo \"#### Build successful; Disk usage after running script:\";\n       df -h;\n       du . | sort -nr | head -n100\n+  - >\n+      if [ \"$DEPLOY$DEPLOY_ALT\" == \"1\" ]; then\n+        mkdir -p deploy/$TRAVIS_COMMIT;\n+        if [ \"$TRAVIS_OS_NAME\" == \"osx\" ]; then\n+            rm -rf build/dist/doc &&\n+            cp -r build/dist/* deploy/$TRAVIS_COMMIT;\n+        else\n+            rm -rf obj/build/dist/doc &&\n+            cp -r obj/build/dist/* deploy/$TRAVIS_COMMIT;\n+        fi;\n+        ls -la deploy/$TRAVIS_COMMIT;\n+        deploy_dir=rustc-builds;\n+        if [ \"$DEPLOY_ALT\" == \"1\" ]; then\n+            deploy_dir=rustc-builds-alt;\n+        fi;\n+        travis_retry aws s3 cp --no-progress --recursive --acl public-read ./deploy s3://rust-lang-ci2/$deploy_dir\n+      fi\n \n after_failure:\n   - >\n@@ -322,77 +326,3 @@ after_failure:\n \n notifications:\n   email: false\n-\n-before_deploy:\n-  - mkdir -p deploy/$TRAVIS_COMMIT\n-  - >\n-      if [ \"$TRAVIS_OS_NAME\" == \"osx\" ]; then\n-          rm -rf build/dist/doc &&\n-          cp -r build/dist/* deploy/$TRAVIS_COMMIT;\n-      else\n-          rm -rf obj/build/dist/doc &&\n-          cp -r obj/build/dist/* deploy/$TRAVIS_COMMIT;\n-      fi\n-  - ls -la deploy/$TRAVIS_COMMIT\n-\n-deploy:\n-  - provider: s3\n-    bucket: rust-lang-ci2\n-    skip_cleanup: true\n-    local_dir: deploy\n-    upload_dir: rustc-builds\n-    acl: public_read\n-    region: us-west-1\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: \"kUGd3t7JcVWFESgIlzvsM8viZgCA9Encs3creW0xLJaLSeI1iVjlJK4h/2/nO6y224AFrh/GUfsNr4/4AlxPuYb8OU5oC5Lv+Ff2JiRDYtuNpyQSKAQp+bRYytWMtrmhja91h118Mbm90cUfcLPwkdiINgJNTXhPKg5Cqu3VYn0=\"\n-    on:\n-      branch: auto\n-      condition: $DEPLOY = 1\n-\n-  # this is the same as the above deployment provider except that it uploads to\n-  # a slightly different directory and has a different trigger\n-  - provider: s3\n-    bucket: rust-lang-ci2\n-    skip_cleanup: true\n-    local_dir: deploy\n-    upload_dir: rustc-builds-alt\n-    acl: public_read\n-    region: us-west-1\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: \"kUGd3t7JcVWFESgIlzvsM8viZgCA9Encs3creW0xLJaLSeI1iVjlJK4h/2/nO6y224AFrh/GUfsNr4/4AlxPuYb8OU5oC5Lv+Ff2JiRDYtuNpyQSKAQp+bRYytWMtrmhja91h118Mbm90cUfcLPwkdiINgJNTXhPKg5Cqu3VYn0=\"\n-    on:\n-      branch: auto\n-      condition: $DEPLOY_ALT = 1\n-\n-  # These two providers are the same as the two above, except deploy on the\n-  # try branch. Travis does not appear to provide a way to use \"or\" in these\n-  # conditions.\n-  - provider: s3\n-    bucket: rust-lang-ci2\n-    skip_cleanup: true\n-    local_dir: deploy\n-    upload_dir: rustc-builds\n-    acl: public_read\n-    region: us-west-1\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: \"kUGd3t7JcVWFESgIlzvsM8viZgCA9Encs3creW0xLJaLSeI1iVjlJK4h/2/nO6y224AFrh/GUfsNr4/4AlxPuYb8OU5oC5Lv+Ff2JiRDYtuNpyQSKAQp+bRYytWMtrmhja91h118Mbm90cUfcLPwkdiINgJNTXhPKg5Cqu3VYn0=\"\n-    on:\n-      branch: try\n-      condition: $DEPLOY = 1\n-\n-  - provider: s3\n-    bucket: rust-lang-ci2\n-    skip_cleanup: true\n-    local_dir: deploy\n-    upload_dir: rustc-builds-alt\n-    acl: public_read\n-    region: us-west-1\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: \"kUGd3t7JcVWFESgIlzvsM8viZgCA9Encs3creW0xLJaLSeI1iVjlJK4h/2/nO6y224AFrh/GUfsNr4/4AlxPuYb8OU5oC5Lv+Ff2JiRDYtuNpyQSKAQp+bRYytWMtrmhja91h118Mbm90cUfcLPwkdiINgJNTXhPKg5Cqu3VYn0=\"\n-    on:\n-      branch: try\n-      condition: $DEPLOY_ALT = 1"}, {"sha": "d519993f142882a31024067c0482cedf97ff214f", "filename": "appveyor.yml", "status": "modified", "additions": 4, "deletions": 15, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3c25f80f856ec308238c492f340fc08271045587/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/3c25f80f856ec308238c492f340fc08271045587/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=3c25f80f856ec308238c492f340fc08271045587", "patch": "@@ -1,12 +1,5 @@\n environment:\n-  SCCACHE_BUCKET: rust-lang-ci-sccache2\n-  SCCACHE_REGION: us-west-1\n-  AWS_ACCESS_KEY_ID: AKIAJAMV3QAMMA6AXHFQ\n-  AWS_SECRET_ACCESS_KEY:\n-    secure: 7Y+JiquYedOAgnUU26uL0DPzrxmTtR+qIwG6rNKSuWDffqU3vVZxbGXim9QpTO80\n   SCCACHE_DIGEST: f808afabb4a4eb1d7112bcb3fa6be03b61e93412890c88e177c667eb37f46353d7ec294e559b16f9f4b5e894f2185fe7670a0df15fd064889ecbd80f0c34166c\n-  TOOLSTATE_REPO_ACCESS_TOKEN:\n-    secure: gKGlVktr7iuqCoYSxHxDE9ltLOKU0nYDEuQxvWbNxUIW7ri5ppn8L06jQzN0GGzN\n \n   # By default schannel checks revocation of certificates unlike some other SSL\n   # backends, but we've historically had problems on CI where a revocation\n@@ -235,10 +228,8 @@ before_deploy:\n \n deploy:\n   - provider: S3\n-    skip_cleanup: true\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: tQWIE+DJHjXaV4np/3YeETkEmXngtIuIgAO/LYKQaUshGLgN8cBCFGG3cHx5lKLt\n+    access_key_id: $(AWS_ACCESS_KEY_ID)\n+    secret_access_key: $(AWS_SECRET_ACCESS_KEY)\n     bucket: rust-lang-ci2\n     set_public: true\n     region: us-west-1\n@@ -252,10 +243,8 @@ deploy:\n   # This provider is the same as the one above except that it has a slightly\n   # different upload directory and a slightly different trigger\n   - provider: S3\n-    skip_cleanup: true\n-    access_key_id: AKIAJVBODR3IA4O72THQ\n-    secret_access_key:\n-      secure: tQWIE+DJHjXaV4np/3YeETkEmXngtIuIgAO/LYKQaUshGLgN8cBCFGG3cHx5lKLt\n+    access_key_id: $(AWS_ACCESS_KEY_ID)\n+    secret_access_key: $(AWS_SECRET_ACCESS_KEY)\n     bucket: rust-lang-ci2\n     set_public: true\n     region: us-west-1"}]}