{"sha": "64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0YWUxNWRkZDNmM2NjYTcwMzZhYjJiMmYzYTZiMTMwYjYyYWY0ZGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-04T06:34:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-04T06:34:31Z"}, "message": "Auto merge of #86849 - jyn514:rustdoc-group, r=Manishearth\n\nWarn when `rustdoc::` group is omitted from lint names\n\nWhen rustdoc lints were first made a tool lint, they gave an unconditional warning when you used the original name:\n```\nwarning: lint `broken_intra_doc_links` has been renamed to `rustdoc::broken_intra_doc_links`\n  --> $DIR/renamed-lint-still-applies.rs:2:9\n   |\nLL | #![deny(broken_intra_doc_links)]\n   |         ^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::broken_intra_doc_links`\n   |\n   = note: `#[warn(renamed_and_removed_lints)]` on by default\n```\nThat was reverted in https://github.com/rust-lang/rust/pull/83203 because adding `rustdoc::x` lints would cause the code to break on old versions of the compiler (due to https://github.com/rust-lang/rust/issues/66079#issuecomment-788589193, \"fixed\" in https://github.com/rust-lang/rust/pull/83216 in the sense that you can now opt-in to not breaking on nightly, which is not ideal but `register_tool` is a long way from stabilizing). Since https://github.com/rust-lang/rust/pull/80527 is now on 1.52.0 stable, we can re-enable the warning. For nightly users, they can change immediately and still have their code work on stable; for stable users, they can change their code in 12 weeks and still have it work up to 3 releases back (about 18 weeks). That seems reasonable to me.\n\nr? `@Manishearth` cc `@rust-lang/rustdoc`", "tree": {"sha": "7191489e7b2f2689bec80837cf03ba77ab5db85d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7191489e7b2f2689bec80837cf03ba77ab5db85d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "html_url": "https://github.com/rust-lang/rust/commit/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71a567fae4c282aa5ecb1e6e48f020ade8df23e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/71a567fae4c282aa5ecb1e6e48f020ade8df23e7", "html_url": "https://github.com/rust-lang/rust/commit/71a567fae4c282aa5ecb1e6e48f020ade8df23e7"}, {"sha": "7a774a8537a3ad27d1e4ada7c041c97ad7655c6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a774a8537a3ad27d1e4ada7c041c97ad7655c6d", "html_url": "https://github.com/rust-lang/rust/commit/7a774a8537a3ad27d1e4ada7c041c97ad7655c6d"}], "stats": {"total": 57, "additions": 25, "deletions": 32}, "files": [{"sha": "e7322251f5e445562fc86e58dc62f990273ebb87", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -276,22 +276,6 @@ impl LintStore {\n         }\n     }\n \n-    /// This lint should be available with either the old or the new name.\n-    ///\n-    /// Using the old name will not give a warning.\n-    /// You must register a lint with the new name before calling this function.\n-    #[track_caller]\n-    pub fn register_alias(&mut self, old_name: &str, new_name: &str) {\n-        let target = match self.by_name.get(new_name) {\n-            Some(&Id(lint_id)) => lint_id,\n-            _ => bug!(\"cannot add alias {} for lint {} that does not exist\", old_name, new_name),\n-        };\n-        match self.by_name.insert(old_name.to_string(), Id(target)) {\n-            None | Some(Ignored) => {}\n-            Some(x) => bug!(\"duplicate specification of lint {} (was {:?})\", old_name, x),\n-        }\n-    }\n-\n     /// This lint should give no warning and have no effect.\n     ///\n     /// This is used by rustc to avoid warning about old rustdoc lints before rustdoc registers them as tool lints."}, {"sha": "49d8d7fb7fb8e9eb3c50a90623c399449a6b3876", "filename": "src/librustdoc/lint.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Flibrustdoc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Flibrustdoc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flint.rs?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -193,7 +193,7 @@ crate fn register_lints(_sess: &Session, lint_store: &mut LintStore) {\n     );\n     for lint in &*RUSTDOC_LINTS {\n         let name = lint.name_lower();\n-        lint_store.register_alias(&name.replace(\"rustdoc::\", \"\"), &name);\n+        lint_store.register_renamed(&name.replace(\"rustdoc::\", \"\"), &name);\n     }\n     lint_store\n         .register_renamed(\"intra_doc_link_resolution_failure\", \"rustdoc::broken_intra_doc_links\");"}, {"sha": "a4d3a4b497117b80948337551fbfa18348c4bda8", "filename": "src/test/rustdoc-ui/renamed-lint-still-applies.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -1,7 +1,6 @@\n // compile-args: --crate-type lib\n #![deny(broken_intra_doc_links)]\n-// FIXME: the old names for rustdoc lints should warn by default once `rustdoc::` makes it to the\n-// stable channel.\n+//~^ WARNING renamed to `rustdoc::broken_intra_doc_links`\n //! [x]\n //~^ ERROR unresolved link\n "}, {"sha": "8e2a2cdd7592f773fdf76ace563b8e0621f3c07f", "filename": "src/test/rustdoc-ui/renamed-lint-still-applies.stderr", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -1,13 +1,19 @@\n+warning: lint `broken_intra_doc_links` has been renamed to `rustdoc::broken_intra_doc_links`\n+  --> $DIR/renamed-lint-still-applies.rs:2:9\n+   |\n+LL | #![deny(broken_intra_doc_links)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::broken_intra_doc_links`\n+   |\n+   = note: `#[warn(renamed_and_removed_lints)]` on by default\n+\n warning: lint `rustdoc::non_autolinks` has been renamed to `rustdoc::bare_urls`\n-  --> $DIR/renamed-lint-still-applies.rs:8:9\n+  --> $DIR/renamed-lint-still-applies.rs:7:9\n    |\n LL | #![deny(rustdoc::non_autolinks)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::bare_urls`\n-   |\n-   = note: `#[warn(renamed_and_removed_lints)]` on by default\n \n error: unresolved link to `x`\n-  --> $DIR/renamed-lint-still-applies.rs:5:6\n+  --> $DIR/renamed-lint-still-applies.rs:4:6\n    |\n LL | //! [x]\n    |      ^ no item named `x` in scope\n@@ -17,21 +23,20 @@ note: the lint level is defined here\n    |\n LL | #![deny(broken_intra_doc_links)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n-   = note: `#[deny(rustdoc::broken_intra_doc_links)]` implied by `#[deny(broken_intra_doc_links)]`\n    = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n error: this URL is not a hyperlink\n-  --> $DIR/renamed-lint-still-applies.rs:10:5\n+  --> $DIR/renamed-lint-still-applies.rs:9:5\n    |\n LL | //! http://example.com\n    |     ^^^^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://example.com>`\n    |\n note: the lint level is defined here\n-  --> $DIR/renamed-lint-still-applies.rs:8:9\n+  --> $DIR/renamed-lint-still-applies.rs:7:9\n    |\n LL | #![deny(rustdoc::non_autolinks)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n    = note: bare URLs are not automatically turned into clickable links\n \n-error: aborting due to 2 previous errors; 1 warning emitted\n+error: aborting due to 2 previous errors; 2 warnings emitted\n "}, {"sha": "ddf03dd079f94257fc73f675dbccc08d1502b60c", "filename": "src/test/rustdoc-ui/unknown-renamed-lints.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -14,8 +14,7 @@\n //~^ ERROR renamed to `rustdoc::bare_urls`\n \n #![deny(private_doc_tests)]\n-// FIXME: the old names for rustdoc lints should warn by default once `rustdoc::` makes it to the\n-// stable channel.\n+//~^ ERROR renamed to `rustdoc::private_doc_tests`\n \n #![deny(rustdoc)]\n //~^ ERROR removed: use `rustdoc::all` instead"}, {"sha": "ad814b82352c3fed39f4d6d0e4a5e7f03e6ba8be", "filename": "src/test/rustdoc-ui/unknown-renamed-lints.stderr", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr?ref=64ae15ddd3f3cca7036ab2b2f3a6b130b62af4da", "patch": "@@ -40,19 +40,25 @@ error: lint `rustdoc::non_autolinks` has been renamed to `rustdoc::bare_urls`\n LL | #![deny(rustdoc::non_autolinks)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::bare_urls`\n \n+error: lint `private_doc_tests` has been renamed to `rustdoc::private_doc_tests`\n+  --> $DIR/unknown-renamed-lints.rs:16:9\n+   |\n+LL | #![deny(private_doc_tests)]\n+   |         ^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::private_doc_tests`\n+\n error: lint `rustdoc` has been removed: use `rustdoc::all` instead\n-  --> $DIR/unknown-renamed-lints.rs:20:9\n+  --> $DIR/unknown-renamed-lints.rs:19:9\n    |\n LL | #![deny(rustdoc)]\n    |         ^^^^^^^\n \n error: unknown lint: `rustdoc::intra_doc_link_resolution_failure`\n-  --> $DIR/unknown-renamed-lints.rs:24:9\n+  --> $DIR/unknown-renamed-lints.rs:23:9\n    |\n LL | #![deny(rustdoc::intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: Compilation failed, aborting rustdoc\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 9 previous errors\n "}]}