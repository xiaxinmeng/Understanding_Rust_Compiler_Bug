{"sha": "e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxY2YxNjBlMmEyZmJhNGNmNzYyNWRhYjFhNTJhZjVhZGZjNTM0ZjU=", "commit": {"author": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-09-03T13:34:12Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2018-11-02T18:49:57Z"}, "message": "Add cfg_attr(rustfmt) lint", "tree": {"sha": "aead229feb0d6292071a161c08c18fde959d4434", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aead229feb0d6292071a161c08c18fde959d4434"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE46kBTF5vnyuSPg0W6OiXpYcOQcIFAlvcnFUACgkQ6OiXpYcO\nQcJtbw/+IP9/my/fgudOCpsQYT0lqEyu5xokPtWO3CBrpY3v2sYNE0deDxEBwPlg\nR3GXfiIE+n6eQ7gHfjyVcuA4/iwyE7+HuENevO27RpSoPD8SaQpNkEOxKJ5lOLas\netJmqlBZ3n8xIudaQERhTEj9DGoRWmJlsOtk8bP52jTzrO13unXyEaQNOtQwasj0\n1sUlYpLfD6feJTh/UtOWjMpLal1cM7Z/6poey/tGB3LSYEv+kHRzkOErXJS7uj7I\nOhONUhbd1T/TJ7EN81HUb4FJjTxTlbDstU1syeJKD8qbvW6hXxhk/1VIdkoHGcbL\n0hdXGN8SKIcFRMTzanOAOTGQd3aYsuLOeCjG9UELP+4UM6cEsu6w3DGDY6R2u+t8\njVia/WomnIpMq50A5Ng8RzxT0cURsMtoi0ocdmkl/IGv/lvb52dZlySIsZoPkIDE\n31w4uuGbBYXoWYKcoOwa4Kd4vufrQQ6lXkozjyehJeKlybQFYwgHVxCk7TJsWStJ\nkltyx3vwgv06QzBjw+z8oFnh0wHjeq9OMqS1/1H1SZOcSe8qoka+dfFLFPvkJMct\nWIRjn42KV7cRY1mT3R2kItASd+8xvo5WqkWk4GMKdMZmhPMY9cA6hUvJr42Evw/h\neK2C4q8U3o5zLgkkwredaUvKfpKppJ/Uby1Mksmeps03mxPZd4Y=\n=Xe30\n-----END PGP SIGNATURE-----", "payload": "tree aead229feb0d6292071a161c08c18fde959d4434\nparent dc1e4091546c1416fb031ada9ad8a821c039b732\nauthor flip1995 <9744647+flip1995@users.noreply.github.com> 1535981652 +0200\ncommitter flip1995 <hello@philkrones.com> 1541184597 +0100\n\nAdd cfg_attr(rustfmt) lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "html_url": "https://github.com/rust-lang/rust/commit/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc1e4091546c1416fb031ada9ad8a821c039b732", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc1e4091546c1416fb031ada9ad8a821c039b732", "html_url": "https://github.com/rust-lang/rust/commit/dc1e4091546c1416fb031ada9ad8a821c039b732"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "4ea13f649d7fb381121fd0f494c3d2b503a7fef9", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 31, "deletions": 2, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "patch": "@@ -12,13 +12,13 @@\n \n use crate::reexport::*;\n use crate::utils::{\n-    in_macro, last_line_of_span, match_def_path, opt_def_id, paths, snippet_opt, span_lint,\n+    in_macro, last_line_of_span, match_def_path, opt_def_id, paths, snippet_opt, span_lint, span_lint_and_sugg,\n     span_lint_and_then, without_block_comments,\n };\n use if_chain::if_chain;\n use crate::rustc::hir::*;\n use crate::rustc::lint::{\n-    CheckLintNameResult, LateContext, LateLintPass, LintArray, LintContext, LintPass,\n+    CheckLintNameResult, EarlyContext, EarlyLintPass, LateContext, LateLintPass, LintArray, LintContext, LintPass,\n };\n use crate::rustc::ty::{self, TyCtxt};\n use crate::rustc::{declare_tool_lint, lint_array};\n@@ -169,6 +169,35 @@ declare_clippy_lint! {\n     \"unknown_lints for scoped Clippy lints\"\n }\n \n+/// **What it does:** Checks for `#[cfg_attr(rustfmt, rustfmt_skip)]` and suggests to replace it\n+/// with `#[rustfmt::skip]`.\n+///\n+/// **Why is this bad?** Since tool_attributes (rust-lang/rust#44690) are stable now, they should\n+/// be used instead of the old `cfg_attr(rustfmt)` attribute.\n+///\n+/// **Known problems:** It currently only detects outer attributes. But since it does not really\n+/// makes sense to have `#![cfg_attr(rustfmt, rustfmt_skip)]` as an inner attribute, this should be\n+/// ok.\n+///\n+/// **Example:**\n+///\n+/// Bad:\n+/// ```rust\n+/// #[cfg_attr(rustfmt, rustfmt_skip)]\n+/// fn main() { }\n+/// ```\n+///\n+/// Good:\n+/// ```rust\n+/// #[rustfmt::skip]\n+/// fn main() { }\n+/// ```\n+declare_clippy_lint! {\n+    pub DEPRECATED_CFG_ATTR,\n+    complexity,\n+    \"usage of `cfg_attr(rustfmt)` instead of `tool_attributes`\"\n+}\n+\n #[derive(Copy, Clone)]\n pub struct AttrPass;\n "}, {"sha": "f3fce54f910e65390ae418f6b10312d67f49adfe", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1cf160e2a2fba4cf7625dab1a52af5adfc534f5/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=e1cf160e2a2fba4cf7625dab1a52af5adfc534f5", "patch": "@@ -220,6 +220,7 @@ pub fn register_pre_expansion_lints(session: &rustc::session::Session, store: &m\n     store.register_pre_expansion_pass(Some(session), box non_expressive_names::NonExpressiveNames {\n         single_char_binding_names_threshold: conf.single_char_binding_names_threshold,\n     });\n+    store.register_pre_expansion_pass(Some(session), box attrs::CfgAttrPass);\n }\n \n pub fn read_conf(reg: &rustc_plugin::Registry<'_>) -> Conf {\n@@ -532,6 +533,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n         approx_const::APPROX_CONSTANT,\n         assign_ops::ASSIGN_OP_PATTERN,\n         assign_ops::MISREFACTORED_ASSIGN_OP,\n+        attrs::DEPRECATED_CFG_ATTR,\n         attrs::DEPRECATED_SEMVER,\n         attrs::UNKNOWN_CLIPPY_LINTS,\n         attrs::USELESS_ATTRIBUTE,\n@@ -839,6 +841,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n \n     reg.register_lint_group(\"clippy::complexity\", Some(\"clippy_complexity\"), vec![\n         assign_ops::MISREFACTORED_ASSIGN_OP,\n+        attrs::DEPRECATED_CFG_ATTR,\n         booleans::NONMINIMAL_BOOL,\n         cyclomatic_complexity::CYCLOMATIC_COMPLEXITY,\n         double_comparison::DOUBLE_COMPARISONS,"}]}