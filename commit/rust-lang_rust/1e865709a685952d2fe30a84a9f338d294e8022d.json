{"sha": "1e865709a685952d2fe30a84a9f338d294e8022d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlODY1NzA5YTY4NTk1MmQyZmUzMGE4NGE5ZjMzOGQyOTRlODAyMmQ=", "commit": {"author": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2020-10-04T16:12:20Z"}, "committer": {"name": "Simon Vandel Sillesen", "email": "simon.vandel@gmail.com", "date": "2021-02-21T20:22:04Z"}, "message": "Make MatchBranchSimplification clean up after itself", "tree": {"sha": "b4368f92b88599abb34a375095cdc05e04ac0f65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4368f92b88599abb34a375095cdc05e04ac0f65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e865709a685952d2fe30a84a9f338d294e8022d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e865709a685952d2fe30a84a9f338d294e8022d", "html_url": "https://github.com/rust-lang/rust/commit/1e865709a685952d2fe30a84a9f338d294e8022d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e865709a685952d2fe30a84a9f338d294e8022d/comments", "author": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "simonvandel", "id": 2770647, "node_id": "MDQ6VXNlcjI3NzA2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2770647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonvandel", "html_url": "https://github.com/simonvandel", "followers_url": "https://api.github.com/users/simonvandel/followers", "following_url": "https://api.github.com/users/simonvandel/following{/other_user}", "gists_url": "https://api.github.com/users/simonvandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonvandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonvandel/subscriptions", "organizations_url": "https://api.github.com/users/simonvandel/orgs", "repos_url": "https://api.github.com/users/simonvandel/repos", "events_url": "https://api.github.com/users/simonvandel/events{/privacy}", "received_events_url": "https://api.github.com/users/simonvandel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ccecc4f6bf3ba62b0c8be29791a0857ea742ae6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ccecc4f6bf3ba62b0c8be29791a0857ea742ae6b", "html_url": "https://github.com/rust-lang/rust/commit/ccecc4f6bf3ba62b0c8be29791a0857ea742ae6b"}], "stats": {"total": 479, "additions": 232, "deletions": 247}, "files": [{"sha": "d9b004978e777cffc36c546b1210002d1f6e0329", "filename": "compiler/rustc_mir/src/transform/match_branches.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fmatch_branches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fmatch_branches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fmatch_branches.rs?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -2,6 +2,8 @@ use crate::transform::MirPass;\n use rustc_middle::mir::*;\n use rustc_middle::ty::TyCtxt;\n \n+use super::simplify::simplify_cfg;\n+\n pub struct MatchBranchSimplification;\n \n /// If a source block is found that switches between two blocks that are exactly\n@@ -42,9 +44,11 @@ impl<'tcx> MirPass<'tcx> for MatchBranchSimplification {\n             return;\n         }\n \n-        let param_env = tcx.param_env(body.source.def_id());\n         let def_id = body.source.def_id();\n+        let param_env = tcx.param_env(def_id);\n+        \n         let (bbs, local_decls) = body.basic_blocks_and_local_decls_mut();\n+        let mut should_cleanup = false;\n         'outer: for bb_idx in bbs.indices() {\n             if !tcx.consider_optimizing(|| format!(\"MatchBranchSimplification {:?} \", def_id)) {\n                 continue;\n@@ -159,6 +163,11 @@ impl<'tcx> MirPass<'tcx> for MatchBranchSimplification {\n             from.statements\n                 .push(Statement { source_info, kind: StatementKind::StorageDead(discr_local) });\n             from.terminator_mut().kind = first.terminator().kind.clone();\n+            should_cleanup = true;\n+        }\n+\n+        if should_cleanup {\n+            simplify_cfg(body);\n         }\n     }\n }"}, {"sha": "0f718a720f4ccd26e62c3950cd1a96ab1b46af4a", "filename": "src/test/mir-opt/issues/issue_59352.num_to_digit.PreCodegen.after.mir", "status": "modified", "additions": 33, "deletions": 37, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_59352.num_to_digit.PreCodegen.after.mir", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_59352.num_to_digit.PreCodegen.after.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_59352.num_to_digit.PreCodegen.after.mir?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -3,47 +3,45 @@\n fn num_to_digit(_1: char) -> u32 {\n     debug num => _1;                     // in scope 0 at $DIR/issue-59352.rs:12:21: 12:24\n     let mut _0: u32;                     // return place in scope 0 at $DIR/issue-59352.rs:12:35: 12:38\n-    let mut _2: bool;                    // in scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n-    let mut _3: std::option::Option<u32>; // in scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n-    let mut _4: char;                    // in scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n-    let mut _5: u32;                     // in scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n-    let mut _10: isize;                  // in scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+    let mut _2: std::option::Option<u32>; // in scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n+    let mut _3: char;                    // in scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n+    let mut _4: u32;                     // in scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+    let mut _9: isize;                   // in scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n     scope 1 (inlined char::methods::<impl char>::is_digit) { // at $DIR/issue-59352.rs:14:8: 14:23\n-        debug self => _8;                // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        debug radix => _5;               // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        let mut _6: &std::option::Option<u32>; // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        let _7: std::option::Option<u32>; // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        let mut _8: char;                // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        debug self => _7;                // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        debug radix => _4;               // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        let mut _5: &std::option::Option<u32>; // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        let _6: std::option::Option<u32>; // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        let mut _7: char;                // in scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n         scope 2 (inlined Option::<u32>::is_some) { // at $DIR/issue-59352.rs:14:8: 14:23\n-            debug self => _6;            // in scope 2 at $DIR/issue-59352.rs:14:8: 14:23\n+            debug self => _5;            // in scope 2 at $DIR/issue-59352.rs:14:8: 14:23\n         }\n     }\n     scope 3 (inlined #[track_caller] Option::<u32>::unwrap) { // at $DIR/issue-59352.rs:14:26: 14:50\n-        debug self => _3;                // in scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n-        let mut _9: isize;               // in scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n+        debug self => _2;                // in scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n+        let mut _8: isize;               // in scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n         scope 4 {\n             debug val => _0;             // in scope 4 at $DIR/issue-59352.rs:14:26: 14:50\n         }\n     }\n \n     bb0: {\n-        StorageLive(_2);                 // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n-        _8 = _1;                         // scope 0 at $DIR/issue-59352.rs:14:8: 14:11\n-        StorageLive(_5);                 // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n-        _5 = const 8_u32;                // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+        _7 = _1;                         // scope 0 at $DIR/issue-59352.rs:14:8: 14:11\n+        StorageLive(_4);                 // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+        _4 = const 8_u32;                // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+        StorageLive(_5);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n         StorageLive(_6);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        StorageLive(_7);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        _7 = char::methods::<impl char>::to_digit(move _8, const 8_u32) -> bb5; // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        _6 = char::methods::<impl char>::to_digit(move _7, const 8_u32) -> bb5; // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n                                          // mir::Constant\n                                          // + span: $DIR/issue-59352.rs:14:8: 14:23\n                                          // + literal: Const { ty: fn(char, u32) -> std::option::Option<u32> {std::char::methods::<impl char>::to_digit}, val: Value(Scalar(<ZST>)) }\n     }\n \n     bb1: {\n-        StorageLive(_3);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n-        StorageLive(_4);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n-        _4 = _1;                         // scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n-        _3 = char::methods::<impl char>::to_digit(move _4, const 8_u32) -> bb3; // scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n+        StorageLive(_2);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n+        StorageLive(_3);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n+        _3 = _1;                         // scope 0 at $DIR/issue-59352.rs:14:26: 14:29\n+        _2 = char::methods::<impl char>::to_digit(move _3, const 8_u32) -> bb3; // scope 0 at $DIR/issue-59352.rs:14:26: 14:41\n                                          // mir::Constant\n                                          // + span: $DIR/issue-59352.rs:14:30: 14:38\n                                          // + literal: Const { ty: fn(char, u32) -> std::option::Option<u32> {std::char::methods::<impl char>::to_digit}, val: Value(Scalar(<ZST>)) }\n@@ -55,25 +53,23 @@ fn num_to_digit(_1: char) -> u32 {\n     }\n \n     bb3: {\n-        StorageDead(_4);                 // scope 0 at $DIR/issue-59352.rs:14:40: 14:41\n-        StorageLive(_9);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:50\n-        _9 = discriminant(_3);           // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n-        switchInt(move _9) -> [0_isize: bb6, 1_isize: bb8, otherwise: bb7]; // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n+        StorageDead(_3);                 // scope 0 at $DIR/issue-59352.rs:14:40: 14:41\n+        StorageLive(_8);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:50\n+        _8 = discriminant(_2);           // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n+        switchInt(move _8) -> [0_isize: bb6, 1_isize: bb8, otherwise: bb7]; // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n     }\n \n     bb4: {\n-        StorageDead(_2);                 // scope 0 at $DIR/issue-59352.rs:14:62: 14:63\n         return;                          // scope 0 at $DIR/issue-59352.rs:15:2: 15:2\n     }\n \n     bb5: {\n-        _6 = &_7;                        // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        _10 = discriminant((*_6));       // scope 2 at $DIR/issue-59352.rs:14:8: 14:23\n-        _2 = Eq(_10, const 1_isize);     // scope 2 at $DIR/issue-59352.rs:14:8: 14:23\n+        _5 = &_6;                        // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n+        _9 = discriminant((*_5));        // scope 2 at $DIR/issue-59352.rs:14:8: 14:23\n+        StorageDead(_5);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n         StorageDead(_6);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        StorageDead(_7);                 // scope 1 at $DIR/issue-59352.rs:14:8: 14:23\n-        StorageDead(_5);                 // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n-        switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/issue-59352.rs:14:5: 14:63\n+        StorageDead(_4);                 // scope 0 at $DIR/issue-59352.rs:14:8: 14:23\n+        switchInt(move _9) -> [1_isize: bb1, otherwise: bb2]; // scope 0 at $DIR/issue-59352.rs:14:5: 14:63\n     }\n \n     bb6: {\n@@ -94,9 +90,9 @@ fn num_to_digit(_1: char) -> u32 {\n     }\n \n     bb8: {\n-        _0 = move ((_3 as Some).0: u32); // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n-        StorageDead(_9);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:50\n-        StorageDead(_3);                 // scope 0 at $DIR/issue-59352.rs:14:49: 14:50\n+        _0 = move ((_2 as Some).0: u32); // scope 3 at $DIR/issue-59352.rs:14:26: 14:50\n+        StorageDead(_8);                 // scope 0 at $DIR/issue-59352.rs:14:26: 14:50\n+        StorageDead(_2);                 // scope 0 at $DIR/issue-59352.rs:14:49: 14:50\n         goto -> bb4;                     // scope 0 at $DIR/issue-59352.rs:14:5: 14:63\n     }\n }"}, {"sha": "94a0b9998636472aa7ba5c8c860ad532ca667052", "filename": "src/test/mir-opt/matches_reduce_branches.bar.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 18, "deletions": 21, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.32bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -34,33 +34,30 @@\n           StorageLive(_5);                 // scope 3 at $DIR/matches_reduce_branches.rs:16:9: 16:10\n           StorageLive(_6);                 // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n -         switchInt(_1) -> [7_i32: bb2, otherwise: bb1]; // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n+-     }\n+- \n+-     bb1: {\n+-         _2 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:27:13: 27:21\n+-         _3 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:28:13: 28:22\n+-         _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:29:13: 29:22\n+-         _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:30:13: 30:21\n+-         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n+-     }\n+- \n+-     bb2: {\n+-         _2 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n+-         _3 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n +         StorageLive(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n +         _11 = _1;                        // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n +         _2 = Ne(_11, const 7_i32);       // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n +         _3 = Eq(_11, const 7_i32);       // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n-+         _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:22:13: 22:22\n-+         _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:23:13: 23:21\n-+         StorageDead(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n-+         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n-      }\n-  \n-      bb1: {\n-          _2 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:27:13: 27:21\n-          _3 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:28:13: 28:22\n-          _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:29:13: 29:22\n-          _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:30:13: 30:21\n-          goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n-      }\n-  \n-      bb2: {\n-          _2 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n-          _3 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n           _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:22:13: 22:22\n           _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:23:13: 23:21\n-          goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n-      }\n-  \n-      bb3: {\n+-         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n+-     }\n+- \n+-     bb3: {\n++         StorageDead(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n           StorageDead(_6);                 // scope 4 at $DIR/matches_reduce_branches.rs:33:6: 33:7\n           StorageLive(_7);                 // scope 4 at $DIR/matches_reduce_branches.rs:35:6: 35:7\n           _7 = _2;                         // scope 4 at $DIR/matches_reduce_branches.rs:35:6: 35:7"}, {"sha": "94a0b9998636472aa7ba5c8c860ad532ca667052", "filename": "src/test/mir-opt/matches_reduce_branches.bar.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 18, "deletions": 21, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.bar.MatchBranchSimplification.64bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -34,33 +34,30 @@\n           StorageLive(_5);                 // scope 3 at $DIR/matches_reduce_branches.rs:16:9: 16:10\n           StorageLive(_6);                 // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n -         switchInt(_1) -> [7_i32: bb2, otherwise: bb1]; // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n+-     }\n+- \n+-     bb1: {\n+-         _2 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:27:13: 27:21\n+-         _3 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:28:13: 28:22\n+-         _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:29:13: 29:22\n+-         _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:30:13: 30:21\n+-         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n+-     }\n+- \n+-     bb2: {\n+-         _2 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n+-         _3 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n +         StorageLive(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n +         _11 = _1;                        // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n +         _2 = Ne(_11, const 7_i32);       // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n +         _3 = Eq(_11, const 7_i32);       // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n-+         _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:22:13: 22:22\n-+         _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:23:13: 23:21\n-+         StorageDead(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n-+         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n-      }\n-  \n-      bb1: {\n-          _2 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:27:13: 27:21\n-          _3 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:28:13: 28:22\n-          _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:29:13: 29:22\n-          _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:30:13: 30:21\n-          goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n-      }\n-  \n-      bb2: {\n-          _2 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:20:13: 20:22\n-          _3 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:21:13: 21:21\n           _4 = const false;                // scope 4 at $DIR/matches_reduce_branches.rs:22:13: 22:22\n           _5 = const true;                 // scope 4 at $DIR/matches_reduce_branches.rs:23:13: 23:21\n-          goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n-      }\n-  \n-      bb3: {\n+-         goto -> bb3;                     // scope 4 at $DIR/matches_reduce_branches.rs:18:5: 33:6\n+-     }\n+- \n+-     bb3: {\n++         StorageDead(_11);                // scope 4 at $DIR/matches_reduce_branches.rs:19:9: 19:10\n           StorageDead(_6);                 // scope 4 at $DIR/matches_reduce_branches.rs:33:6: 33:7\n           StorageLive(_7);                 // scope 4 at $DIR/matches_reduce_branches.rs:35:6: 35:7\n           _7 = _2;                         // scope 4 at $DIR/matches_reduce_branches.rs:35:6: 35:7"}, {"sha": "e43ec3de58d2d8ef5d21b5807b68e7133ef947ef", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 19, "deletions": 17, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.32bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -16,29 +16,31 @@\n +         _4 = move _3;                    // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n +         _2 = Eq(_4, const 0_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n +         StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n-+         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n++         switchInt(move _2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n       bb1: {\n-          _2 = const false;                // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-      }\n-  \n-      bb2: {\n-          _2 = const true;                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-      }\n-  \n-      bb3: {\n-          switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n-      }\n-  \n-      bb4: {\n+-         _2 = const false;                // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-         goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-     }\n+- \n+-     bb2: {\n+-         _2 = const true;                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-         goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-     }\n+- \n+-     bb3: {\n+-         switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+-     }\n+- \n+-     bb4: {\n           _0 = const ();                   // scope 0 at $DIR/matches_reduce_branches.rs:9:6: 9:6\n-          goto -> bb5;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+-         goto -> bb5;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n++         goto -> bb2;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n-      bb5: {\n+-     bb5: {\n++     bb2: {\n           StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:9:5: 9:6\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:10:2: 10:2\n       }"}, {"sha": "e43ec3de58d2d8ef5d21b5807b68e7133ef947ef", "filename": "src/test/mir-opt/matches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 19, "deletions": 17, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.foo.MatchBranchSimplification.64bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -16,29 +16,31 @@\n +         _4 = move _3;                    // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n +         _2 = Eq(_4, const 0_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n +         StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n-+         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:22: 7:26\n++         switchInt(move _2) -> [false: bb1, otherwise: bb2]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n       bb1: {\n-          _2 = const false;                // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-      }\n-  \n-      bb2: {\n-          _2 = const true;                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-          goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n-      }\n-  \n-      bb3: {\n-          switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n-      }\n-  \n-      bb4: {\n+-         _2 = const false;                // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-         goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-     }\n+- \n+-     bb2: {\n+-         _2 = const true;                 // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-         goto -> bb3;                     // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n+-     }\n+- \n+-     bb3: {\n+-         switchInt(move _2) -> [false: bb4, otherwise: bb5]; // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+-     }\n+- \n+-     bb4: {\n           _0 = const ();                   // scope 0 at $DIR/matches_reduce_branches.rs:9:6: 9:6\n-          goto -> bb5;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n+-         goto -> bb5;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n++         goto -> bb2;                     // scope 0 at $DIR/matches_reduce_branches.rs:7:5: 9:6\n       }\n   \n-      bb5: {\n+-     bb5: {\n++     bb2: {\n           StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:9:5: 9:6\n           return;                          // scope 0 at $DIR/matches_reduce_branches.rs:10:2: 10:2\n       }"}, {"sha": "68c1161d7845747d90ffd9faaad9a292982fb8e7", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "status": "modified", "additions": 54, "deletions": 59, "changes": 113, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.32bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -26,87 +26,82 @@\n           StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n           _6 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n -         switchInt(move _6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb1: {\n+-         _5 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:30: 40:34\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb2: {\n+-         _5 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb3: {\n +         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _7 = move _6;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _5 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n +         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-+         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb1: {\n-          _5 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:30: 40:34\n-          goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb2: {\n-          _5 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n-          goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb3: {\n           StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:47: 40:48\n -         switchInt(move _5) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb4: {\n+-         _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n+-         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb5: {\n+-         _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n+-         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb6: {\n +         StorageLive(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _8 = move _5;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _4 = Ne(_8, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n +         StorageDead(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-+         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb4: {\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n-          goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb5: {\n-          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n-          goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb6: {\n           StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:67: 40:68\n -         switchInt(move _4) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb7: {\n+-         _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n+-         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb8: {\n+-         _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n+-         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb9: {\n +         StorageLive(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _9 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _3 = Ne(_9, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n +         StorageDead(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb7: {\n-          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n-          goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb8: {\n-          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n-          goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb9: {\n           StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:87: 40:88\n -         switchInt(move _3) -> [false: bb11, otherwise: bb10]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb10: {\n +         StorageLive(_10);                // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _10 = move _3;                   // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+-         _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:92: 40:96\n+-         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n+-     }\n+- \n+-     bb11: {\n+-         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+-         _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n+-         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n+-     }\n+- \n+-     bb12: {\n +         _1 = Ne(_10, const false);       // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n +         StorageDead(_10);                // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb10: {\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n-          _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:92: 40:96\n-          goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n-      }\n-  \n-      bb11: {\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n-          _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n-          goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n-      }\n-  \n-      bb12: {\n           StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:42:6: 42:7\n           _0 = _1;                         // scope 1 at $DIR/matches_reduce_branches.rs:43:5: 43:8\n           StorageDead(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:44:1: 44:2"}, {"sha": "68c1161d7845747d90ffd9faaad9a292982fb8e7", "filename": "src/test/mir-opt/matches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "status": "modified", "additions": 54, "deletions": 59, "changes": 113, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fmatches_reduce_branches.match_nested_if.MatchBranchSimplification.64bit.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -26,87 +26,82 @@\n           StorageLive(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n           _6 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:24: 40:28\n -         switchInt(move _6) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb1: {\n+-         _5 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:30: 40:34\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb2: {\n+-         _5 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n+-         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n+-     }\n+- \n+-     bb3: {\n +         StorageLive(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _7 = move _6;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n +         _5 = Ne(_7, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n +         StorageDead(_7);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-+         goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb1: {\n-          _5 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:30: 40:34\n-          goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb2: {\n-          _5 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:42: 40:47\n-          goto -> bb3;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:21: 40:48\n-      }\n-  \n-      bb3: {\n           StorageDead(_6);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:47: 40:48\n -         switchInt(move _5) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb4: {\n+-         _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n+-         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb5: {\n+-         _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n+-         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n+-     }\n+- \n+-     bb6: {\n +         StorageLive(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _8 = move _5;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n +         _4 = Ne(_8, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n +         StorageDead(_8);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-+         goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb4: {\n-          _4 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:50: 40:54\n-          goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb5: {\n-          _4 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:62: 40:67\n-          goto -> bb6;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:18: 40:68\n-      }\n-  \n-      bb6: {\n           StorageDead(_5);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:67: 40:68\n -         switchInt(move _4) -> [false: bb8, otherwise: bb7]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb7: {\n+-         _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n+-         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb8: {\n+-         _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n+-         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb9: {\n +         StorageLive(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _9 = move _4;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _3 = Ne(_9, const false);        // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n +         StorageDead(_9);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb7: {\n-          _3 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:70: 40:74\n-          goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb8: {\n-          _3 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:40:82: 40:87\n-          goto -> bb9;                     // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb9: {\n           StorageDead(_4);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:87: 40:88\n -         switchInt(move _3) -> [false: bb11, otherwise: bb10]; // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n+-     }\n+- \n+-     bb10: {\n +         StorageLive(_10);                // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n +         _10 = move _3;                   // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+-         _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:92: 40:96\n+-         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n+-     }\n+- \n+-     bb11: {\n+-         StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n+-         _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n+-         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n+-     }\n+- \n+-     bb12: {\n +         _1 = Ne(_10, const false);       // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n +         StorageDead(_10);                // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-+         goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:40:15: 40:88\n-      }\n-  \n-      bb10: {\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n-          _1 = const true;                 // scope 0 at $DIR/matches_reduce_branches.rs:40:92: 40:96\n-          goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n-      }\n-  \n-      bb11: {\n-          StorageDead(_3);                 // scope 0 at $DIR/matches_reduce_branches.rs:40:95: 40:96\n-          _1 = const false;                // scope 0 at $DIR/matches_reduce_branches.rs:41:14: 41:19\n-          goto -> bb12;                    // scope 0 at $DIR/matches_reduce_branches.rs:39:15: 42:6\n-      }\n-  \n-      bb12: {\n           StorageDead(_2);                 // scope 0 at $DIR/matches_reduce_branches.rs:42:6: 42:7\n           _0 = _1;                         // scope 1 at $DIR/matches_reduce_branches.rs:43:5: 43:8\n           StorageDead(_1);                 // scope 0 at $DIR/matches_reduce_branches.rs:44:1: 44:2"}, {"sha": "db9313e7822f1ac6485e3c0b0dd028425f796ec4", "filename": "src/test/mir-opt/not_equal_false.opt.InstCombine.diff", "status": "modified", "additions": 7, "deletions": 15, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fnot_equal_false.opt.InstCombine.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1e865709a685952d2fe30a84a9f338d294e8022d/src%2Ftest%2Fmir-opt%2Fnot_equal_false.opt.InstCombine.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fnot_equal_false.opt.InstCombine.diff?ref=1e865709a685952d2fe30a84a9f338d294e8022d", "patch": "@@ -19,7 +19,7 @@\n           _6 = move _3;                    // scope 0 at $DIR/not_equal_false.rs:4:17: 4:21\n           _2 = Eq(_6, const 0_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_6);                 // scope 0 at $DIR/not_equal_false.rs:4:17: 4:21\n-          goto -> bb4;                     // scope 0 at $DIR/not_equal_false.rs:4:17: 4:21\n+          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n       }\n   \n       bb1: {\n@@ -34,26 +34,18 @@\n           _7 = move _5;                    // scope 0 at $DIR/not_equal_false.rs:4:38: 4:45\n           _4 = Eq(_7, const 1_isize);      // scope 0 at $SRC_DIR/core/src/macros/mod.rs:LL:COL\n           StorageDead(_7);                 // scope 0 at $DIR/not_equal_false.rs:4:38: 4:45\n-          goto -> bb5;                     // scope 0 at $DIR/not_equal_false.rs:4:38: 4:45\n-      }\n-  \n-      bb3: {\n-          StorageDead(_4);                 // scope 0 at $DIR/not_equal_false.rs:4:45: 4:46\n-          StorageDead(_2);                 // scope 0 at $DIR/not_equal_false.rs:4:45: 4:46\n-          return;                          // scope 0 at $DIR/not_equal_false.rs:5:2: 5:2\n-      }\n-  \n-      bb4: {\n-          switchInt(move _2) -> [false: bb2, otherwise: bb1]; // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n-      }\n-  \n-      bb5: {\n           StorageLive(_8);                 // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n           _8 = move _4;                    // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n -         _0 = Ne(_8, const false);        // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n +         _0 = _8;                         // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n           StorageDead(_8);                 // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n           goto -> bb3;                     // scope 0 at $DIR/not_equal_false.rs:4:5: 4:46\n       }\n+  \n+      bb3: {\n+          StorageDead(_4);                 // scope 0 at $DIR/not_equal_false.rs:4:45: 4:46\n+          StorageDead(_2);                 // scope 0 at $DIR/not_equal_false.rs:4:45: 4:46\n+          return;                          // scope 0 at $DIR/not_equal_false.rs:5:2: 5:2\n+      }\n   }\n   "}]}