{"sha": "cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "node_id": "C_kwDOAAsO6NoAKGNjMjg4MTM5MWExZjFlMDFmYWEyZjdmZjIxYTE3MmExNWZiYmFhY2Q", "commit": {"author": {"name": "gimbles", "email": "yusharora@protonmail.com", "date": "2022-12-31T10:02:09Z"}, "committer": {"name": "gimbles", "email": "yusharora@protonmail.com", "date": "2022-12-31T10:02:09Z"}, "message": "Add tidy check for dbg", "tree": {"sha": "4c08e5620cd838f9f4f7a15d231ec912c14b2739", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c08e5620cd838f9f4f7a15d231ec912c14b2739"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "html_url": "https://github.com/rust-lang/rust/commit/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd/comments", "author": null, "committer": null, "parents": [{"sha": "247e44e61d934e1927db0ff557fe17f131a2379c", "url": "https://api.github.com/repos/rust-lang/rust/commits/247e44e61d934e1927db0ff557fe17f131a2379c", "html_url": "https://github.com/rust-lang/rust/commit/247e44e61d934e1927db0ff557fe17f131a2379c"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "fcc5cfafd808d0cc2066366fe12d0c9cb55dbb7c", "filename": "library/std/src/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd/library%2Fstd%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd/library%2Fstd%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fmacros.rs?ref=cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "patch": "@@ -3,6 +3,7 @@\n //! This module contains a set of macros which are exported from the standard\n //! library. Each macro is available for use when linking against the standard\n //! library.\n+// ignore-tidy-dbg\n \n #[doc = include_str!(\"../../core/src/macros/panic.md\")]\n #[macro_export]"}, {"sha": "f409a86db26c0e1269bed716ff1ff03ac986f24c", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "patch": "@@ -15,6 +15,7 @@\n //!\n //! A number of these checks can be opted-out of with various directives of the form:\n //! `// ignore-tidy-CHECK-NAME`.\n+// ignore-tidy-dbg\n \n use crate::walk::{filter_dirs, walk};\n use regex::{Regex, RegexSet};\n@@ -278,6 +279,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n         let mut skip_leading_newlines =\n             contains_ignore_directive(can_contain, &contents, \"leading-newlines\");\n         let mut skip_copyright = contains_ignore_directive(can_contain, &contents, \"copyright\");\n+        let mut skip_dbg = contains_ignore_directive(can_contain, &contents, \"dbg\");\n         let mut leading_new_lines = false;\n         let mut trailing_new_lines = 0;\n         let mut lines = 0;\n@@ -306,6 +308,21 @@ pub fn check(path: &Path, bad: &mut bool) {\n             let mut err = |msg: &str| {\n                 tidy_error!(bad, \"{}:{}: {}\", file.display(), i + 1, msg);\n             };\n+\n+            if trimmed.contains(\"dbg!\")\n+                && !trimmed.starts_with(\"//\")\n+                && !file\n+                    .ancestors()\n+                    .any(|a| a.ends_with(\"src/test\") || a.ends_with(\"library/alloc/tests\"))\n+                && filename != \"tests.rs\"\n+            {\n+                suppressible_tidy_err!(\n+                    err,\n+                    skip_dbg,\n+                    \"`dbg!` macro is intended as a debugging tool. It should not be in version control.\"\n+                )\n+            }\n+\n             if !under_rustfmt\n                 && line.chars().count() > max_columns\n                 && !long_line_is_ok(&extension, is_error_code, max_columns, line)"}]}