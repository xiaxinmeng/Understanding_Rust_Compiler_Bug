{"sha": "9b45874445111b5f79d2888fa37086d1db7e4870", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliNDU4NzQ0NDUxMTFiNWY3OWQyODg4ZmEzNzA4NmQxZGI3ZTQ4NzA=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-08-18T22:02:14Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-09-06T11:27:23Z"}, "message": "plumbing to automatically run MIR for crates where it works;\nthis serves as a poor man's unit test infrastructure until\nMIR is more built up", "tree": {"sha": "b8b71ea3b6d96ff6d1eeaaebd74d3551724cdbc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b8b71ea3b6d96ff6d1eeaaebd74d3551724cdbc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b45874445111b5f79d2888fa37086d1db7e4870", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b45874445111b5f79d2888fa37086d1db7e4870", "html_url": "https://github.com/rust-lang/rust/commit/9b45874445111b5f79d2888fa37086d1db7e4870", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b45874445111b5f79d2888fa37086d1db7e4870/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "faa9ec81b53be2b460caac0e7dcf46e7a41b8f13", "url": "https://api.github.com/repos/rust-lang/rust/commits/faa9ec81b53be2b460caac0e7dcf46e7a41b8f13", "html_url": "https://github.com/rust-lang/rust/commit/faa9ec81b53be2b460caac0e7dcf46e7a41b8f13"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "c0c6161aa2d8730abb2496fdc1a82182bc5b87d8", "filename": "mk/main.mk", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9b45874445111b5f79d2888fa37086d1db7e4870/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9b45874445111b5f79d2888fa37086d1db7e4870/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=9b45874445111b5f79d2888fa37086d1db7e4870", "patch": "@@ -172,6 +172,18 @@ RUST_LIB_FLAGS_ST3 += -C prefer-dynamic\n # by not emitting them.\n RUSTFLAGS_STAGE0 += -Z no-landing-pads\n \n+# Enable MIR to \"always build\" for crates where this works. This is\n+# just temporary while MIR is being actively built up -- it's just a\n+# poor man's unit testing infrastructure. Anyway we only want this for\n+# stage1/stage2.\n+define ADD_MIR_FLAG\n+RUSTFLAGS1_$(1) += -Z always-build-mir\n+RUSTFLAGS2_$(1) += -Z always-build-mir\n+endef\n+$(foreach crate,$(TARGET_CRATES),$(eval $(call ADD_MIR_FLAG,$(crate))))\n+$(foreach crate,$(RUSTC_CRATES),$(eval $(call ADD_MIR_FLAG,$(crate))))\n+$(foreach crate,syntax,$(eval $(call ADD_MIR_FLAG,$(crate))))\n+\n # platform-specific auto-configuration\n include $(CFG_SRC_DIR)mk/platform.mk\n "}, {"sha": "d6fa55bf7f51661429b997992350324cc6f9f586", "filename": "mk/target.mk", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b45874445111b5f79d2888fa37086d1db7e4870/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9b45874445111b5f79d2888fa37086d1db7e4870/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=9b45874445111b5f79d2888fa37086d1db7e4870", "patch": "@@ -93,6 +93,7 @@ $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): \\\n \t\t$$(LLVM_LIBDIR_RUSTFLAGS_$(2)) \\\n \t\t$$(LLVM_STDCPP_RUSTFLAGS_$(2)) \\\n \t\t$$(RUSTFLAGS_$(4)) \\\n+\t\t$$(RUSTFLAGS$(1)_$(4)) \\\n \t\t$$(RUSTFLAGS$(1)_$(4)_T_$(2)) \\\n \t\t--out-dir $$(@D) \\\n \t\t-C extra-filename=-$$(CFG_FILENAME_EXTRA) \\"}]}