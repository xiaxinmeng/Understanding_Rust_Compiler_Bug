{"sha": "04f062f9d4a77bf52a4a431052b79e8e8a7a8e80", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZjA2MmY5ZDRhNzdiZjUyYTRhNDMxMDUyYjc5ZThlOGE3YThlODA=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-27T20:49:33Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-27T20:49:33Z"}, "message": "Fix lurking bug in matching of nil\n\nWhich was somehow made visible by the DPS changes.", "tree": {"sha": "647f592f101d914ac36dcd6c12a74b999d608307", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/647f592f101d914ac36dcd6c12a74b999d608307"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80", "html_url": "https://github.com/rust-lang/rust/commit/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b1b202d302d1e84886360f9c8f146b9562db5f23", "url": "https://api.github.com/repos/rust-lang/rust/commits/b1b202d302d1e84886360f9c8f146b9562db5f23", "html_url": "https://github.com/rust-lang/rust/commit/b1b202d302d1e84886360f9c8f146b9562db5f23"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "e2386f9623cab1e79ba165c2792d71031e7647c1", "filename": "src/comp/middle/trans_alt.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80/src%2Fcomp%2Fmiddle%2Ftrans_alt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f062f9d4a77bf52a4a431052b79e8e8a7a8e80/src%2Fcomp%2Fmiddle%2Ftrans_alt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_alt.rs?ref=04f062f9d4a77bf52a4a431052b79e8e8a7a8e80", "patch": "@@ -444,11 +444,11 @@ fn compile_submatch(bcx: @block_ctxt, m: match, vals: [ValueRef], f: mk_fail,\n             }\n           }\n           lit(l) {\n-            kind =\n-                alt l.node {\n-                  ast::lit_str(_) { compare }\n-                  _ { test_val = Load(bcx, val); switch }\n-                };\n+            kind = alt l.node {\n+              ast::lit_str(_) { compare }\n+              ast::lit_nil. { test_val = Load(bcx, val); compare }\n+              _ { test_val = Load(bcx, val); switch }\n+            };\n           }\n         }\n     }\n@@ -486,7 +486,7 @@ fn compile_submatch(bcx: @block_ctxt, m: match, vals: [ValueRef], f: mk_fail,\n             let t = ty::node_id_to_type(ccx.tcx, pat_id);\n             let eq =\n                 trans::trans_compare(bcx, ast::eq, test_val, t, r.val, t);\n-            let cleanup_cx = trans::trans_block_cleanups(bcx, compare_cx);\n+            let cleanup_cx = trans::trans_block_cleanups(eq.bcx, compare_cx);\n             bcx = new_sub_block_ctxt(bcx, \"compare_next\");\n             CondBr(cleanup_cx, eq.val, opt_cx.llbb, bcx.llbb);\n           }"}]}