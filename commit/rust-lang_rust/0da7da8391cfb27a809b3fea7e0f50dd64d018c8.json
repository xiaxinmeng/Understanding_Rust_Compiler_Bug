{"sha": "0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYTdkYTgzOTFjZmIyN2E4MDliM2ZlYTdlMGY1MGRkNjRkMDE4Yzg=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-01T10:03:19Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-01T10:03:19Z"}, "message": "Align 6-week cycle check with beta promotion instead of stable release.\n\nThe regression check is to make beta promotion easier, so it makes more\nsense to use the Tuesday of the release week (T-2) as the end point of the\nregression prevention, instead of Thursday (T-0). But since the beta\npromotion PR is sent at Tuesday evening at UTC, the protection should\ninclude the whole Tuesday as well, meaning the 6-week cycle will start from\nWednesdays.\n\nThis will also move the start of the regression protection week one day\nearlier.", "tree": {"sha": "caf4f096c637cd762096aae1705859ec6b1f80c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/caf4f096c637cd762096aae1705859ec6b1f80c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlthhWcACgkQ/vbIBR0O\nATzKXA//c9lRQs3Zi/eeRjx27DpXo21uY9XBEL6l10gEE96fp/s9AOGsdQi7xsyx\nzQf+O0rZd5OpSJRfhZW0ZgSc+MGw518Dl2DsaALNDLG/moISgcCFVZ5KmlQfcSHt\nXsLag3F/UyHz9TGva6kIb4o65K0j9jLgAGZDIMFlnp7HZ9sTUGGtgYoCY7SypZhQ\nGaHqoLlx5tdJKmQXRerLNwD1QzGRD2Ts3CReXp8Bf7NOkLeKsCjgdIDhxRQ0gQj8\nytT2HjWUSq3qnsKejqNOqBLScFPC0SXW07WK7KH8YRFqpA8svEcrCE3bed81pH6p\niTxx9INR9zE/KSjSQ6qDus+6iFwcrIuOgGIKfLydwQlVme00FUNBin07Fu/Y0YvQ\nYr5eQXaaZin7NR7jx/au6HQiczPSXE7+tcW3ydGTQdRwiEs4vQa1vqKQSumJS89n\nb2ksanlcfwDvZAS/zf33EyT/KW6TfKHq33qo11V/k+p+QRFTjN3X16M9YdLbOnm7\nzldKVECTegaxjJ6qtPco/GRCYcoJDwEEGh6PgPEkuKDLDz+nUoixUI37ZXYTV59G\nNHCHJY9TLKSxLZRD9leIoxy/nlPDZIEPBfX+EWmhyohCjX/lMF5pjtXnvEWxA/qt\nSeL/OXhjpbUUddOSWsx7oVBbEI5Wm9UcP2kEqAjZRUX8fr0A+hQ=\n=4bZj\n-----END PGP SIGNATURE-----", "payload": "tree caf4f096c637cd762096aae1705859ec6b1f80c4\nparent e94df4acb4c3f42fdc224a7164b63a99240add1e\nauthor kennytm <kennytm@gmail.com> 1533117799 +0800\ncommitter kennytm <kennytm@gmail.com> 1533117799 +0800\n\nAlign 6-week cycle check with beta promotion instead of stable release.\n\nThe regression check is to make beta promotion easier, so it makes more\nsense to use the Tuesday of the release week (T-2) as the end point of the\nregression prevention, instead of Thursday (T-0). But since the beta\npromotion PR is sent at Tuesday evening at UTC, the protection should\ninclude the whole Tuesday as well, meaning the 6-week cycle will start from\nWednesdays.\n\nThis will also move the start of the regression protection week one day\nearlier.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "html_url": "https://github.com/rust-lang/rust/commit/0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0da7da8391cfb27a809b3fea7e0f50dd64d018c8/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e94df4acb4c3f42fdc224a7164b63a99240add1e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e94df4acb4c3f42fdc224a7164b63a99240add1e", "html_url": "https://github.com/rust-lang/rust/commit/e94df4acb4c3f42fdc224a7164b63a99240add1e"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "d876cb7f37a41b91dea2148a05f95818f55bb8ae", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0da7da8391cfb27a809b3fea7e0f50dd64d018c8/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/0da7da8391cfb27a809b3fea7e0f50dd64d018c8/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "patch": "@@ -17,9 +17,11 @@ TOOLSTATE_FILE=\"$(realpath $2)\"\n OS=\"$3\"\n COMMIT=\"$(git rev-parse HEAD)\"\n CHANGED_FILES=\"$(git diff --name-status HEAD HEAD^)\"\n-SIX_WEEK_CYCLE=\"$(( ($(date +%s) / 604800 - 3) % 6 ))\"\n-# ^ 1970 Jan 1st is a Thursday, and our release dates are also on Thursdays,\n-#   thus we could divide by 604800 (7 days in seconds) directly.\n+SIX_WEEK_CYCLE=\"$(( ($(date +%s) / 86400 - 20) % 42 ))\"\n+# ^ Number of days after the last promotion of beta.\n+#   Its value is 41 on the Tuesday where \"Promote master to beta (T-2)\" happens.\n+#   The Wednesday after this has value 0.\n+#   We track this value to prevent regressing tools in the last week of the 6-week cycle.\n \n touch \"$TOOLSTATE_FILE\"\n \n@@ -98,7 +100,7 @@ change_toolstate() {\n     if python2.7 \"$CHECK_NOT\" \"$OS\" \"$TOOLSTATE_FILE\" \"_data/latest.json\" changed; then\n         echo 'Toolstate is not changed. Not updating.'\n     else\n-        if [ $SIX_WEEK_CYCLE -eq 5 ]; then\n+        if [ $SIX_WEEK_CYCLE -ge 35 ]; then\n             python2.7 \"$CHECK_NOT\" \"$OS\" \"$TOOLSTATE_FILE\" \"_data/latest.json\" regressed\n         fi\n         sed -i \"1 a\\\\"}]}