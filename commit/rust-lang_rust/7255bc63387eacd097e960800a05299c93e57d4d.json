{"sha": "7255bc63387eacd097e960800a05299c93e57d4d", "node_id": "C_kwDOAAsO6NoAKDcyNTViYzYzMzg3ZWFjZDA5N2U5NjA4MDBhMDUyOTljOTNlNTdkNGQ", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-05-05T01:59:56Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-05-06T16:16:22Z"}, "message": "Add Windows application manifest to rustc-main", "tree": {"sha": "952d75d64c412014d138b11f2f52de36c27fcc63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/952d75d64c412014d138b11f2f52de36c27fcc63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7255bc63387eacd097e960800a05299c93e57d4d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmJ1SdYACgkQcTRy8vRW\nJ94wLg//UGV9dZ68SauMvAjtgRhgH3imfnHBNC/hTvDR2mYbYI1A1dmoJKWhWLs1\nmiB81hvMjzQ74CyiKbNXJ6G+6pnxj4EYY6VSy1kk8hwfiy6dd/bPZVjuLkeBHq3D\npOVKpsg9B4VkWllE0byPkZeUJQtmfDw44SbvrgRHWH0JVKLX1BdcQkt3sZrn3kLH\nIw3sKGDWmNttp+AsVZudqbdhO8p1YASxYbYoaxO/EovFG1VNCdVXa5YPcOVEYhUu\nY2zkLr0/l1EQLf5woeMkUnNoZKmG9h7OzT9XzgU0GqwPPmkk165sXbJr0nHKt5UI\noLaIrjG/+YdMAZYZDJoIwWpJmWy+/uy9196jDCsw3pfG/0hCXz5j0YkWn+d3X5v6\nk2wl205zS+FFgbp7A5TKLc3DOqxdyNglhplmQNhAsC9pN1fIIrxJBVMgxEdiRxT7\ngLzSxIzhEh2+zRyL3va01rI1Kk1W745QGhy5EEp9IeqACQA3TBfR2pImBchjUwmF\nq3EcrFZDpOp2tW6/bpDuopTASz0WNBob6nxysKj2P76yI4vQg1YMgwWTOxlnXYgn\nDMYosLwCs5PemvhC+gGW9F9FH8bTL69T8Za5olHbV/1KFa52lyGnMUC2COxLiVQz\nlfZmnnwXzddpZChC9t0WVCqAyvuSzSZUNlNRqQq9Um/X2y2FEDc=\n=qWEa\n-----END PGP SIGNATURE-----", "payload": "tree 952d75d64c412014d138b11f2f52de36c27fcc63\nparent 4c60a0ea5b2385d7400df9db1ad04e96f2a4c154\nauthor Chris Denton <christophersdenton@gmail.com> 1651715996 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1651853782 +0100\n\nAdd Windows application manifest to rustc-main\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7255bc63387eacd097e960800a05299c93e57d4d", "html_url": "https://github.com/rust-lang/rust/commit/7255bc63387eacd097e960800a05299c93e57d4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7255bc63387eacd097e960800a05299c93e57d4d/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c60a0ea5b2385d7400df9db1ad04e96f2a4c154", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c60a0ea5b2385d7400df9db1ad04e96f2a4c154", "html_url": "https://github.com/rust-lang/rust/commit/4c60a0ea5b2385d7400df9db1ad04e96f2a4c154"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "b37a2fd4c76d52437fc5b4c76a1ad9528d34831a", "filename": "compiler/rustc/Windows Manifest.xml", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7255bc63387eacd097e960800a05299c93e57d4d/compiler%2Frustc%2FWindows%20Manifest.xml", "raw_url": "https://github.com/rust-lang/rust/raw/7255bc63387eacd097e960800a05299c93e57d4d/compiler%2Frustc%2FWindows%20Manifest.xml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc%2FWindows%20Manifest.xml?ref=7255bc63387eacd097e960800a05299c93e57d4d", "patch": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+<!--\n+This is a Windows application manifest file.\n+See: https://docs.microsoft.com/en-us/windows/win32/sbscs/application-manifests\n+-->\n+<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\" xmlns:asmv3=\"urn:schemas-microsoft-com:asm.v3\">\n+    <!-- Versions rustc supports as compiler hosts -->\n+    <compatibility xmlns=\"urn:schemas-microsoft-com:compatibility.v1\"> \n+        <application> \n+            <!-- Windows 7 --><supportedOS Id=\"{35138b9a-5d96-4fbd-8e2d-a2440225f93a}\"/>\n+            <!-- Windows 8 --><supportedOS Id=\"{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}\"/>\n+            <!-- Windows 8.1 --><supportedOS Id=\"{1f676c76-80e1-4239-95bb-83d0f6d0da78}\"/>\n+            <!-- Windows 10 and 11 --><supportedOS Id=\"{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}\"/>\n+        </application> \n+    </compatibility>\n+    <!-- Use UTF-8 code page -->\n+    <asmv3:application>\n+        <asmv3:windowsSettings xmlns=\"http://schemas.microsoft.com/SMI/2019/WindowsSettings\">\n+            <activeCodePage>UTF-8</activeCodePage>\n+        </asmv3:windowsSettings>\n+    </asmv3:application>\n+    <!-- Remove (most) legacy path limits -->\n+    <asmv3:application>\n+        <asmv3:windowsSettings xmlns:ws2=\"http://schemas.microsoft.com/SMI/2016/WindowsSettings\">\n+            <ws2:longPathAware>true</ws2:longPathAware>\n+        </asmv3:windowsSettings>\n+    </asmv3:application>\n+</assembly>"}, {"sha": "24c06c0ddbf6cb48c692c2e3e90e18b63fdbc6bb", "filename": "compiler/rustc/build.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/7255bc63387eacd097e960800a05299c93e57d4d/compiler%2Frustc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7255bc63387eacd097e960800a05299c93e57d4d/compiler%2Frustc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc%2Fbuild.rs?ref=7255bc63387eacd097e960800a05299c93e57d4d", "patch": "@@ -0,0 +1,24 @@\n+use std::env;\n+\n+fn main() {\n+    let target_os = env::var(\"CARGO_CFG_TARGET_OS\");\n+    let target_env = env::var(\"CARGO_CFG_TARGET_ENV\");\n+    if Ok(\"windows\") == target_os.as_deref() && Ok(\"msvc\") == target_env.as_deref() {\n+        set_windows_exe_options();\n+    }\n+}\n+\n+// Add a manifest file to rustc.exe.\n+fn set_windows_exe_options() {\n+    static WINDOWS_MANIFEST_FILE: &str = \"Windows Manifest.xml\";\n+\n+    let mut manifest = env::current_dir().unwrap();\n+    manifest.push(WINDOWS_MANIFEST_FILE);\n+\n+    println!(\"cargo:rerun-if-changed={}\", WINDOWS_MANIFEST_FILE);\n+    // Embed the Windows application manifest file.\n+    println!(\"cargo:rustc-link-arg-bin=rustc-main=/MANIFEST:EMBED\");\n+    println!(\"cargo:rustc-link-arg-bin=rustc-main=/MANIFESTINPUT:{}\", manifest.to_str().unwrap());\n+    // Turn linker warnings into errors.\n+    println!(\"cargo:rustc-link-arg-bin=rustc-main=/WX\");\n+}"}]}