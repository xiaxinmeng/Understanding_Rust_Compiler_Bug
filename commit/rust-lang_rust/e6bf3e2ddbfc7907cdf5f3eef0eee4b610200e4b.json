{"sha": "e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2YmYzZTJkZGJmYzc5MDdjZGY1ZjNlZWYwZWVlNGI2MTAyMDBlNGI=", "commit": {"author": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2018-05-20T04:43:11Z"}, "committer": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2018-05-20T11:08:25Z"}, "message": "Issue #50636: Improve error diagnostic with missing commas after struct fields.", "tree": {"sha": "e17bbc7d16c16280d6564aee4e1767f36f650563", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e17bbc7d16c16280d6564aee4e1767f36f650563"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "html_url": "https://github.com/rust-lang/rust/commit/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/comments", "author": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c95e1cccc9c248789230a54ecfd87971a04d5c0c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c95e1cccc9c248789230a54ecfd87971a04d5c0c", "html_url": "https://github.com/rust-lang/rust/commit/c95e1cccc9c248789230a54ecfd87971a04d5c0c"}], "stats": {"total": 46, "additions": 43, "deletions": 3}, "files": [{"sha": "013241bd6d622360dcc81e5aa2b3862439da13c7", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "patch": "@@ -5797,9 +5797,18 @@ impl<'a> Parser<'a> {\n                     return Err(err);\n                 }\n             }\n-            _ => return Err(self.span_fatal_help(self.span,\n-                    &format!(\"expected `,`, or `}}`, found `{}`\", self.this_token_to_string()),\n-                    \"struct fields should be separated by commas\")),\n+            _ => {\n+                let sp = self.sess.codemap().next_point(self.prev_span);\n+                let mut err = self.struct_span_err(sp, &format!(\"expected `,`, or `}}`, found `{}`\",\n+                                                                self.this_token_to_string()));\n+                if self.token.is_ident() {\n+                    // This is likely another field; emit the diagnostic and keep going\n+                    err.span_suggestion(sp, \"try adding a comma\", \",\".into());\n+                    err.emit();\n+                } else {\n+                    return Err(err)\n+                }\n+            }\n         }\n         Ok(a_var)\n     }"}, {"sha": "87ae8ab26051a63a2841971d04fb564a63fb401a", "filename": "src/test/ui/struct-missing-comma.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Ftest%2Fui%2Fstruct-missing-comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Ftest%2Fui%2Fstruct-missing-comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstruct-missing-comma.rs?ref=e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -Z parse-only\n+\n+// Issue #50636\n+\n+struct S {\n+    foo: u32 //~ expected `,`, or `}`, found `bar`\n+    //     ~^ HELP try adding a comma: ','\n+    bar: u32\n+}\n+\n+fn main() {\n+    let s = S { foo: 5, bar: 6 };\n+}"}, {"sha": "28283bfb71364e4157bdcfd313b827275bbac2ea", "filename": "src/test/ui/struct-missing-comma.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Ftest%2Fui%2Fstruct-missing-comma.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b/src%2Ftest%2Fui%2Fstruct-missing-comma.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstruct-missing-comma.stderr?ref=e6bf3e2ddbfc7907cdf5f3eef0eee4b610200e4b", "patch": "@@ -0,0 +1,8 @@\n+error: expected `,`, or `}`, found `bar`\n+  --> $DIR/struct-missing-comma.rs:16:13\n+   |\n+LL |     foo: u32 //~ expected `,`, or `}`, found `bar`\n+   |             ^ help: try adding a comma: `,`\n+\n+error: aborting due to previous error\n+"}]}