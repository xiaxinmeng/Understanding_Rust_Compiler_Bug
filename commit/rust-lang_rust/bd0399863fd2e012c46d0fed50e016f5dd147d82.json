{"sha": "bd0399863fd2e012c46d0fed50e016f5dd147d82", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkMDM5OTg2M2ZkMmUwMTJjNDZkMGZlZDUwZTAxNmY1ZGQxNDdkODI=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-03-26T22:54:22Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-03-27T01:03:53Z"}, "message": "Disable some advanced (post glibc-2.3) libuv features when building snaps.", "tree": {"sha": "eb4f479a53d26d067e8383c122b657f336e0857e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb4f479a53d26d067e8383c122b657f336e0857e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd0399863fd2e012c46d0fed50e016f5dd147d82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd0399863fd2e012c46d0fed50e016f5dd147d82", "html_url": "https://github.com/rust-lang/rust/commit/bd0399863fd2e012c46d0fed50e016f5dd147d82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd0399863fd2e012c46d0fed50e016f5dd147d82/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45a709766c60869ebdcad776ef9c9804aee7f506", "url": "https://api.github.com/repos/rust-lang/rust/commits/45a709766c60869ebdcad776ef9c9804aee7f506", "html_url": "https://github.com/rust-lang/rust/commit/45a709766c60869ebdcad776ef9c9804aee7f506"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "c0223070e579a5aa009b23083a13240915ac757e", "filename": "mk/rt.mk", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/bd0399863fd2e012c46d0fed50e016f5dd147d82/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/bd0399863fd2e012c46d0fed50e016f5dd147d82/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=bd0399863fd2e012c46d0fed50e016f5dd147d82", "patch": "@@ -27,6 +27,15 @@\n LIBUV_FLAGS_i386 = -m32 -fPIC\n LIBUV_FLAGS_x86_64 = -m64 -fPIC\n \n+# when we're doing a snapshot build, we intentionally degrade as many\n+# features in libuv and the runtime as possible, to ease portability.\n+\n+SNAP_DEFINES:=\n+ifneq ($(strip $(findstring snap,$(MAKECMDGOALS))),)\n+\tSNAP_DEFINES=-DRUST_SNAPSHOT\n+endif\n+\n+\n define DEF_RUNTIME_TARGETS\n \n ######################################################################\n@@ -107,7 +116,8 @@ RUNTIME_LIBS_$(1) := $$(LIBUV_LIB_$(1))\n \n rt/$(1)/%.o: rt/%.cpp $$(RUNTIME_HDR_$(1)) $$(MKFILE_DEPS)\n \t@$$(call E, compile: $$@)\n-\t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(RUNTIME_INCS_$(1))) $$<\n+\t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(RUNTIME_INCS_$(1)) \\\n+                 $$(SNAP_DEFINES)) $$<\n \n rt/$(1)/%.o: rt/%.S  $$(RUNTIME_HDR_$(1)) $$(MKFILE_DEPS) \\\n                      $$(LLVM_CONFIG_$$(CFG_HOST_TRIPLE))\n@@ -144,7 +154,7 @@ endif\n \n $$(LIBUV_LIB_$(1)): $$(LIBUV_DEPS)\n \t$$(Q)$$(MAKE) -C $$(S)mk/libuv/$$(LIBUV_ARCH_$(1))/$$(LIBUV_OSTYPE_$(1)) \\\n-\t\tCFLAGS=\"$$(LIBUV_FLAGS_$$(HOST_$(1)))\" \\\n+\t\tCFLAGS=\"$$(LIBUV_FLAGS_$$(HOST_$(1))) $$(SNAP_DEFINES)\" \\\n         LDFLAGS=\"$$(LIBUV_FLAGS_$$(HOST_$(1)))\" \\\n \t\tCC=\"$$(CFG_GCCISH_CROSS)$$(CC)\" \\\n \t\tCXX=\"$$(CFG_GCCISH_CROSS)$$(CXX)\" \\"}, {"sha": "1d6aec9d54c7a684ade521f71a4d538a6a88b14f", "filename": "src/libuv", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibuv?ref=bd0399863fd2e012c46d0fed50e016f5dd147d82", "patch": "@@ -1 +1 @@\n-Subproject commit 1170ffba3ac5191930b40c897d4569a9d8a296a3\n+Subproject commit 1d6aec9d54c7a684ade521f71a4d538a6a88b14f"}, {"sha": "313ab74995a338726454c5ce10ef84e29d98a4d3", "filename": "src/rt/rust_run_program.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bd0399863fd2e012c46d0fed50e016f5dd147d82/src%2Frt%2Frust_run_program.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/bd0399863fd2e012c46d0fed50e016f5dd147d82/src%2Frt%2Frust_run_program.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_run_program.cpp?ref=bd0399863fd2e012c46d0fed50e016f5dd147d82", "patch": "@@ -168,7 +168,7 @@ rust_run_program(const char* argv[],\n         *_NSGetEnviron() = (char **)envp;\n     }\n     execvp(argv[0], (char * const *)argv);\n-#elif __FreeBSD__\n+#elif __FreeBSD__ || (defined(__linux__) && defined(RUST_SNAPSHOT))\n     if (envp) { environ = (char **)envp; }\n     execvp(argv[0], (char * const *)argv);\n #else"}]}