{"sha": "a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0ZGM4ZGFlMDJhZDc4NDk5YzBjMTc2MjI3ZWIzOTA3MWUxZDBkZDI=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-09-30T18:56:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-09-30T18:56:09Z"}, "message": "Rollup merge of #77280 - petrochenkov:llvmcomp, r=Mark-Simulacrum\n\nEnsure that all LLVM components requested by tests are available on CI\n\nAddresses https://github.com/rust-lang/rust/pull/75064#issuecomment-667722652\n\nI used an environment variable because passing a command line option all the way from CI to compiletest would be just too much hassle for this task.\nI added a new variable, but any of the already existing ones defined by CI could be used instead.\nr? @Mark-Simulacrum", "tree": {"sha": "9564e2df99aacad034983979fca33ade4260f950", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9564e2df99aacad034983979fca33ade4260f950"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfdNTJCRBK7hj4Ov3rIwAAdHIIACNukO2c3GGB3vgdmDiCE0hX\nJ3shyBSg1dnBaRh/n0c2W40nbUA4FNrP3cvmWEAn8e39f8HchQQS20gtzIAgG+Hw\n62HJKEM5OxPPVvccqlpHTQIWKBKE9GgphlT6Q1KPwvcKqhdoWP8bYB1sWSSY6w2r\noPbAGsyOkncFOASe62Fj0nJHmzy4EfGkwQ3tKmE62liHTvuvUSc7RLuNImNs3OXe\nXmnyo7Rzo0eCSEpM/yGw/FxhslMVT24RZ/su7ibPGIOWdoYG5w/y0xStFumwIrEu\nz0UEdz9LIottxKqAioce+ma3vjGO4a/zHupVKhceOxssYgXgeCgiJuSuTTzAtW8=\n=sx5C\n-----END PGP SIGNATURE-----\n", "payload": "tree 9564e2df99aacad034983979fca33ade4260f950\nparent 7ad03dd91df96335551384f7ca220b20922e2f15\nparent 9340ee4380dcc9b81e0afb1ef5518730b064a78a\nauthor Jonas Schievink <jonasschievink@gmail.com> 1601492169 +0200\ncommitter GitHub <noreply@github.com> 1601492169 +0200\n\nRollup merge of #77280 - petrochenkov:llvmcomp, r=Mark-Simulacrum\n\nEnsure that all LLVM components requested by tests are available on CI\n\nAddresses https://github.com/rust-lang/rust/pull/75064#issuecomment-667722652\n\nI used an environment variable because passing a command line option all the way from CI to compiletest would be just too much hassle for this task.\nI added a new variable, but any of the already existing ones defined by CI could be used instead.\nr? @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "html_url": "https://github.com/rust-lang/rust/commit/a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4dc8dae02ad78499c0c176227eb39071e1d0dd2/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ad03dd91df96335551384f7ca220b20922e2f15", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ad03dd91df96335551384f7ca220b20922e2f15", "html_url": "https://github.com/rust-lang/rust/commit/7ad03dd91df96335551384f7ca220b20922e2f15"}, {"sha": "9340ee4380dcc9b81e0afb1ef5518730b064a78a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9340ee4380dcc9b81e0afb1ef5518730b064a78a", "html_url": "https://github.com/rust-lang/rust/commit/9340ee4380dcc9b81e0afb1ef5518730b064a78a"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "181a7fcb732661cffec9e8c9cf3233470ce922ac", "filename": "src/ci/run.sh", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a4dc8dae02ad78499c0c176227eb39071e1d0dd2/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a4dc8dae02ad78499c0c176227eb39071e1d0dd2/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "patch": "@@ -104,6 +104,8 @@ if [ \"$RUST_RELEASE_CHANNEL\" = \"nightly\" ] || [ \"$DIST_REQUIRE_ALL_TOOLS\" = \"\" ]\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-missing-tools\"\n fi\n \n+export COMPILETEST_NEEDS_ALL_LLVM_COMPONENTS=1\n+\n # Print the date from the local machine and the date from an external source to\n # check for clock drifts. An HTTP URL is used instead of HTTPS since on Azure\n # Pipelines it happened that the certificates were marked as expired."}, {"sha": "59f64e7df0f41a219d23ed8c81d60a9d4ba0663f", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a4dc8dae02ad78499c0c176227eb39071e1d0dd2/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4dc8dae02ad78499c0c176227eb39071e1d0dd2/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=a4dc8dae02ad78499c0c176227eb39071e1d0dd2", "patch": "@@ -208,10 +208,13 @@ impl EarlyProps {\n                 config.parse_name_value_directive(line, \"needs-llvm-components\")\n             {\n                 let components: HashSet<_> = config.llvm_components.split_whitespace().collect();\n-                if !needed_components\n+                if let Some(missing_component) = needed_components\n                     .split_whitespace()\n-                    .all(|needed_component| components.contains(needed_component))\n+                    .find(|needed_component| !components.contains(needed_component))\n                 {\n+                    if env::var_os(\"COMPILETEST_NEEDS_ALL_LLVM_COMPONENTS\").is_some() {\n+                        panic!(\"missing LLVM component: {}\", missing_component);\n+                    }\n                     return true;\n                 }\n             }"}]}