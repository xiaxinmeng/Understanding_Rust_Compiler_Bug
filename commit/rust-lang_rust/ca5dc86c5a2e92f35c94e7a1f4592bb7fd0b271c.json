{"sha": "ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhNWRjODZjNWEyZTkyZjM1Yzk0ZTdhMWY0NTkyYmI3ZmQwYjI3MWM=", "commit": {"author": {"name": "Basile Desloges", "email": "basile.desloges@gmail.com", "date": "2017-10-06T15:26:53Z"}, "committer": {"name": "Basile Desloges", "email": "basile.desloges@gmail.com", "date": "2017-10-06T15:44:50Z"}, "message": "mir-borrowck: Implement end-user output for field of reference, pointer and array", "tree": {"sha": "3120ddc533b0245d62b61d21cc2781796b9a134f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3120ddc533b0245d62b61d21cc2781796b9a134f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "html_url": "https://github.com/rust-lang/rust/commit/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c/comments", "author": {"login": "zilbuz", "id": 434964, "node_id": "MDQ6VXNlcjQzNDk2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/434964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zilbuz", "html_url": "https://github.com/zilbuz", "followers_url": "https://api.github.com/users/zilbuz/followers", "following_url": "https://api.github.com/users/zilbuz/following{/other_user}", "gists_url": "https://api.github.com/users/zilbuz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zilbuz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zilbuz/subscriptions", "organizations_url": "https://api.github.com/users/zilbuz/orgs", "repos_url": "https://api.github.com/users/zilbuz/repos", "events_url": "https://api.github.com/users/zilbuz/events{/privacy}", "received_events_url": "https://api.github.com/users/zilbuz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zilbuz", "id": 434964, "node_id": "MDQ6VXNlcjQzNDk2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/434964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zilbuz", "html_url": "https://github.com/zilbuz", "followers_url": "https://api.github.com/users/zilbuz/followers", "following_url": "https://api.github.com/users/zilbuz/following{/other_user}", "gists_url": "https://api.github.com/users/zilbuz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zilbuz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zilbuz/subscriptions", "organizations_url": "https://api.github.com/users/zilbuz/orgs", "repos_url": "https://api.github.com/users/zilbuz/repos", "events_url": "https://api.github.com/users/zilbuz/events{/privacy}", "received_events_url": "https://api.github.com/users/zilbuz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ce2f3af9379246909d3e0151b956ad428bbc175", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ce2f3af9379246909d3e0151b956ad428bbc175", "html_url": "https://github.com/rust-lang/rust/commit/9ce2f3af9379246909d3e0151b956ad428bbc175"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "eb05a815c7386f5f39f16b2dea1c6725276c1516", "filename": "src/librustc_mir/borrow_check.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c/src%2Flibrustc_mir%2Fborrow_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c/src%2Flibrustc_mir%2Fborrow_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check.rs?ref=ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "patch": "@@ -1160,11 +1160,16 @@ impl<'c, 'b, 'a: 'b+'c, 'gcx, 'tcx: 'a> MirBorrowckCtxt<'c, 'b, 'a, 'gcx, 'tcx>\n                 ty::TyTuple(_, _) => {\n                     format!(\"{}\", field_index)\n                 },\n+                ty::TyRef(_, tnm) | ty::TyRawPtr(tnm) => {\n+                    self.describe_field_from_ty(&tnm.ty, field_index)\n+                },\n+                ty::TyArray(ty, _) => {\n+                    self.describe_field_from_ty(&ty, field_index)\n+                }\n                 _ => {\n                     // Might need a revision when the fields in trait RFC is implemented\n                     // (https://github.com/rust-lang/rfcs/pull/1546)\n-                    bug!(\"Field access unsupported for non-box types that are neither Adt (struct, \\\n-                         enum, union) nor tuples\");\n+                    bug!(\"End-user description not implemented for field access on `{:?}`\", ty.sty);\n                 }\n             }\n         }"}, {"sha": "cff913b17beddd49ce8323dd8254628a9031e520", "filename": "src/test/compile-fail/borrowck/borrowck-describe-lvalue.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c/src%2Ftest%2Fcompile-fail%2Fborrowck%2Fborrowck-describe-lvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c/src%2Ftest%2Fcompile-fail%2Fborrowck%2Fborrowck-describe-lvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck%2Fborrowck-describe-lvalue.rs?ref=ca5dc86c5a2e92f35c94e7a1f4592bb7fd0b271c", "patch": "@@ -276,6 +276,34 @@ fn main() {\n             _ => panic!(\"other case\"),\n         }\n     }\n+    // Field of ref\n+    {\n+        struct Block<'a> {\n+            current: &'a u8,\n+            unrelated: &'a u8,\n+        };\n+\n+        fn bump<'a>(mut block: &mut Block<'a>) {\n+            let x = &mut block;\n+            let p: &'a u8 = &*block.current;\n+            //[mir]~^ ERROR cannot borrow `(*block.current)` as immutable because it is also borrowed as mutable (Mir)\n+            // No errors in AST because of issue rust#38899\n+        }\n+    }\n+    // Field of ptr\n+    {\n+        struct Block2 {\n+            current: *const u8,\n+            unrelated: *const u8,\n+        }\n+\n+        unsafe fn bump2(mut block: *mut Block2) {\n+            let x = &mut block;\n+            let p : *const u8 = &*(*block).current;\n+            //[mir]~^ ERROR cannot borrow `(*block.current)` as immutable because it is also borrowed as mutable (Mir)\n+            // No errors in AST because of issue rust#38899\n+        }\n+    }\n     // Field of index\n     {\n         struct F {x: u32, y: u32};"}]}