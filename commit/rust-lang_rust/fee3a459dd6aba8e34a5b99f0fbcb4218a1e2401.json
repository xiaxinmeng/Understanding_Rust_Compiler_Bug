{"sha": "fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "node_id": "C_kwDOAAsO6NoAKGZlZTNhNDU5ZGQ2YWJhOGUzNGE1Yjk5ZjBmYmNiNDIxOGExZTI0MDE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-05T12:31:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-05T12:31:26Z"}, "message": "Auto merge of #97756 - pietroalbini:pa-remove-azure-pipelines, r=Mark-Simulacrum\n\nRemove Azure Pipelines configuration\n\nThis PR removes the remaining Azure Pipelines configuration, now that we fully removed all the resources on the Azure side of things.", "tree": {"sha": "98e88f503bf4609b1eea99f02ef8ea34be3744ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98e88f503bf4609b1eea99f02ef8ea34be3744ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "html_url": "https://github.com/rust-lang/rust/commit/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "html_url": "https://github.com/rust-lang/rust/commit/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef"}, {"sha": "6523ef41da79f06c883f0572e068251ed4370a1e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6523ef41da79f06c883f0572e068251ed4370a1e", "html_url": "https://github.com/rust-lang/rust/commit/6523ef41da79f06c883f0572e068251ed4370a1e"}], "stats": {"total": 144, "additions": 8, "deletions": 136}, "files": [{"sha": "a7be9978c0bc564cc06ad5f15ecd654937f60c57", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -98,9 +98,6 @@ jobs:\n       - name: install WIX\n         run: src/ci/scripts/install-wix.sh\n         if: success() && !env.SKIP_JOB\n-      - name: ensure the build happens on a partition with enough space\n-        run: src/ci/scripts/symlink-build-dir.sh\n-        if: success() && !env.SKIP_JOB\n       - name: disable git crlf conversion\n         run: src/ci/scripts/disable-git-crlf-conversion.sh\n         if: success() && !env.SKIP_JOB\n@@ -496,9 +493,6 @@ jobs:\n       - name: install WIX\n         run: src/ci/scripts/install-wix.sh\n         if: success() && !env.SKIP_JOB\n-      - name: ensure the build happens on a partition with enough space\n-        run: src/ci/scripts/symlink-build-dir.sh\n-        if: success() && !env.SKIP_JOB\n       - name: disable git crlf conversion\n         run: src/ci/scripts/disable-git-crlf-conversion.sh\n         if: success() && !env.SKIP_JOB\n@@ -609,9 +603,6 @@ jobs:\n       - name: install WIX\n         run: src/ci/scripts/install-wix.sh\n         if: success() && !env.SKIP_JOB\n-      - name: ensure the build happens on a partition with enough space\n-        run: src/ci/scripts/symlink-build-dir.sh\n-        if: success() && !env.SKIP_JOB\n       - name: disable git crlf conversion\n         run: src/ci/scripts/disable-git-crlf-conversion.sh\n         if: success() && !env.SKIP_JOB"}, {"sha": "37c2e9bc35a0db9ba3efc3b679453db8a7089237", "filename": "src/ci/azure-pipelines/auto.yml", "status": "removed", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fazure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fazure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fauto.yml?ref=4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "patch": "@@ -1,26 +0,0 @@\n-#####################################\n-##    READ BEFORE CHANGING THIS    ##\n-#####################################\n-\n-# We're in the process of evaluating GitHub Actions as a possible replacement\n-# for Azure Pipelines, and at the moment the configuration is duplicated\n-# between the two CI providers. Be sure to also change the configuration in\n-# src/ci/github-actions when changing this file.\n-\n-#####################################\n-\n-#\n-# Azure Pipelines \"auto\" branch build for Rust on macOS\n-#\n-\n-pr: none\n-trigger:\n-  - auto\n-\n-jobs:\n-- job: Dummy\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: ubuntu-16.04\n-  steps:\n-  - bash: echo \"We're running this job since bors is still gating on Azure\""}, {"sha": "62bb6f47334123f79f34d6d77bd552ba99ea2900", "filename": "src/ci/azure-pipelines/try.yml", "status": "removed", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fazure-pipelines%2Ftry.yml", "raw_url": "https://github.com/rust-lang/rust/raw/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fazure-pipelines%2Ftry.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Ftry.yml?ref=4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "patch": "@@ -1,22 +0,0 @@\n-#####################################\n-##    READ BEFORE CHANGING THIS    ##\n-#####################################\n-\n-# We're in the process of evaluating GitHub Actions as a possible replacement\n-# for Azure Pipelines, and at the moment the configuration is duplicated\n-# between the two CI providers. Be sure to also change the configuration in\n-# src/ci/github-actions when changing this file.\n-\n-#####################################\n-\n-pr: none\n-trigger:\n-- try\n-\n-jobs:\n-- job: Dummy\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: ubuntu-16.04\n-  steps:\n-  - bash: echo \"We're running this job since bors is still gating on Azure\""}, {"sha": "57832ac2b9594866920b9a39aefb340a3a55e83f", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -161,10 +161,6 @@ x--expand-yaml-anchors--remove:\n         run: src/ci/scripts/install-wix.sh\n         <<: *step\n \n-      - name: ensure the build happens on a partition with enough space\n-        run: src/ci/scripts/symlink-build-dir.sh\n-        <<: *step\n-\n       - name: disable git crlf conversion\n         run: src/ci/scripts/disable-git-crlf-conversion.sh\n         <<: *step"}, {"sha": "ec45d9e8bc613eaef64e1c3791dee461c3dca480", "filename": "src/ci/init_repo.sh", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Finit_repo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Finit_repo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Finit_repo.sh?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -1,9 +1,5 @@\n #!/usr/bin/env bash\n \n-# FIXME(61301): we need to debug spurious failures with this on Windows on\n-# Azure, so let's print more information in the logs.\n-set -x\n-\n set -o errexit\n set -o pipefail\n set -o nounset"}, {"sha": "c50de37c492b422decb2542a70afd7c8fd93f4b1", "filename": "src/ci/scripts/clean-disk.sh", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fscripts%2Fclean-disk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fscripts%2Fclean-disk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fclean-disk.sh?ref=4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "patch": "@@ -1,16 +0,0 @@\n-#!/bin/bash\n-# This script deletes some of the Azure-provided artifacts. We don't use these,\n-# and disk space is at a premium on our builders.\n-\n-set -euo pipefail\n-IFS=$'\\n\\t'\n-\n-source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n-\n-# All the Linux builds happen inside Docker.\n-if isLinux; then\n-    # 6.7GB\n-    sudo rm -rf /opt/ghc\n-    # 16GB\n-    sudo rm -rf /usr/share/dotnet\n-fi"}, {"sha": "6de080a9fde00a8c6e5947325fc4f84e5d45122c", "filename": "src/ci/scripts/disable-git-crlf-conversion.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fdisable-git-crlf-conversion.sh?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -1,6 +1,6 @@\n #!/bin/bash\n # Disable automatic line ending conversion, which is enabled by default on\n-# Azure's Windows image. Having the conversion enabled caused regressions both\n+# GitHub's Windows image. Having the conversion enabled caused regressions both\n # in our test suite (it broke miri tests) and in the ecosystem, since we\n # started shipping install scripts with CRLF endings instead of the old LF.\n #"}, {"sha": "0bc35f932832cfa84a8723791293b26883ea6613", "filename": "src/ci/scripts/setup-environment.sh", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fscripts%2Fsetup-environment.sh", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fscripts%2Fsetup-environment.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fsetup-environment.sh?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -8,21 +8,6 @@ IFS=$'\\n\\t'\n \n source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n \n-# Since matrix variables are readonly in Azure Pipelines, we take\n-# INITIAL_RUST_CONFIGURE_ARGS and establish RUST_CONFIGURE_ARGS\n-# which downstream steps can alter\n-if isAzurePipelines; then\n-    # macOS ships with Bash 3.16, so we cannot use [[ -v FOO ]],\n-    # which was introduced in Bash 4.2\n-    if [[ -z \"${INITIAL_RUST_CONFIGURE_ARGS+x}\" ]]; then\n-        INITIAL_RUST_CONFIG=\"\"\n-        echo \"No initial Rust configure args set\"\n-    else\n-        INITIAL_RUST_CONFIG=\"${INITIAL_RUST_CONFIGURE_ARGS}\"\n-        ciCommandSetEnv RUST_CONFIGURE_ARGS \"${INITIAL_RUST_CONFIG}\"\n-    fi\n-fi\n-\n # Load extra environment variables\n vars=\"${EXTRA_VARIABLES-}\"\n echo \"${vars}\" | jq '' >/dev/null  # Validate JSON and exit on errors"}, {"sha": "23849f7047c546e173c94f3471a5749899ecae3d", "filename": "src/ci/scripts/symlink-build-dir.sh", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "raw_url": "https://github.com/rust-lang/rust/raw/4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh?ref=4322a785cc99ea5fc81dd7f5fc8ba7f7a64b08ef", "patch": "@@ -1,15 +0,0 @@\n-#!/bin/bash\n-# We've had multiple issues with the default disk running out of disk space\n-# during builds, and it looks like other disks mounted in the VMs have more\n-# space available. This script synlinks the build directory to those other\n-# disks, in the CI providers and OSes affected by this.\n-\n-set -euo pipefail\n-IFS=$'\\n\\t'\n-\n-source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n-\n-if isWindows && isAzurePipelines; then\n-    cmd //c \"mkdir c:\\\\MORE_SPACE\"\n-    cmd //c \"mklink /J build c:\\\\MORE_SPACE\"\n-fi"}, {"sha": "8a88c56194c604a3e351d7dbd853d4c13c6f5cfb", "filename": "src/ci/shared.sh", "status": "modified", "additions": 7, "deletions": 24, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fshared.sh", "raw_url": "https://github.com/rust-lang/rust/raw/fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401/src%2Fci%2Fshared.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fshared.sh?ref=fee3a459dd6aba8e34a5b99f0fbcb4218a1e2401", "patch": "@@ -28,11 +28,7 @@ function retry {\n }\n \n function isCI {\n-    [[ \"${CI-false}\" = \"true\" ]] || isAzurePipelines || isGitHubActions\n-}\n-\n-function isAzurePipelines {\n-    [[ \"${TF_BUILD-False}\" = \"True\" ]]\n+    [[ \"${CI-false}\" = \"true\" ]] || isGitHubActions\n }\n \n function isGitHubActions {\n@@ -63,9 +59,7 @@ function isCiBranch {\n     fi\n     name=\"$1\"\n \n-    if isAzurePipelines; then\n-        [[ \"${BUILD_SOURCEBRANCHNAME}\" = \"${name}\" ]]\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         [[ \"${GITHUB_REF}\" = \"refs/heads/${name}\" ]]\n     else\n         echo \"isCiBranch only works inside CI!\"\n@@ -74,10 +68,7 @@ function isCiBranch {\n }\n \n function ciBaseBranch {\n-    if isAzurePipelines; then\n-        echo \"unsupported on Azure Pipelines\"\n-        exit 1\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         echo \"${GITHUB_BASE_REF#refs/heads/}\"\n     else\n         echo \"ciBaseBranch only works inside CI!\"\n@@ -86,9 +77,7 @@ function ciBaseBranch {\n }\n \n function ciCommit {\n-    if isAzurePipelines; then\n-        echo \"${BUILD_SOURCEVERSION}\"\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         echo \"${GITHUB_SHA}\"\n     else\n         echo \"ciCommit only works inside CI!\"\n@@ -97,9 +86,7 @@ function ciCommit {\n }\n \n function ciCheckoutPath {\n-    if isAzurePipelines; then\n-        echo \"${BUILD_SOURCESDIRECTORY}\"\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         echo \"${GITHUB_WORKSPACE}\"\n     else\n         echo \"ciCheckoutPath only works inside CI!\"\n@@ -114,9 +101,7 @@ function ciCommandAddPath {\n     fi\n     path=\"$1\"\n \n-    if isAzurePipelines; then\n-        echo \"##vso[task.prependpath]${path}\"\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         echo \"${path}\" >> \"${GITHUB_PATH}\"\n     else\n         echo \"ciCommandAddPath only works inside CI!\"\n@@ -132,9 +117,7 @@ function ciCommandSetEnv {\n     name=\"$1\"\n     value=\"$2\"\n \n-    if isAzurePipelines; then\n-        echo \"##vso[task.setvariable variable=${name}]${value}\"\n-    elif isGitHubActions; then\n+    if isGitHubActions; then\n         echo \"${name}=${value}\" >> \"${GITHUB_ENV}\"\n     else\n         echo \"ciCommandSetEnv only works inside CI!\""}]}