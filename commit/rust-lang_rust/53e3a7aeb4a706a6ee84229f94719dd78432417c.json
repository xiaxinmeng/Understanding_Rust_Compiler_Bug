{"sha": "53e3a7aeb4a706a6ee84229f94719dd78432417c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzZTNhN2FlYjRhNzA2YTZlZTg0MjI5Zjk0NzE5ZGQ3ODQzMjQxN2M=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-01T15:59:44Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-01T15:59:44Z"}, "message": "Update file structure tests", "tree": {"sha": "8eb82660deaadb100d535b2c4fe0a616441106ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8eb82660deaadb100d535b2c4fe0a616441106ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/53e3a7aeb4a706a6ee84229f94719dd78432417c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/53e3a7aeb4a706a6ee84229f94719dd78432417c", "html_url": "https://github.com/rust-lang/rust/commit/53e3a7aeb4a706a6ee84229f94719dd78432417c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/53e3a7aeb4a706a6ee84229f94719dd78432417c/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "14bf5bb7ee01e89d31d05e1ef08ccde85809fb7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/14bf5bb7ee01e89d31d05e1ef08ccde85809fb7a", "html_url": "https://github.com/rust-lang/rust/commit/14bf5bb7ee01e89d31d05e1ef08ccde85809fb7a"}], "stats": {"total": 428, "additions": 215, "deletions": 213}, "files": [{"sha": "c22a5d17b34b7ad0eb3670d6bb56632bf1aca4b0", "filename": "crates/ra_ide/src/display/structure.rs", "status": "modified", "additions": 215, "deletions": 213, "changes": 428, "blob_url": "https://github.com/rust-lang/rust/blob/53e3a7aeb4a706a6ee84229f94719dd78432417c/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fstructure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/53e3a7aeb4a706a6ee84229f94719dd78432417c/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fstructure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fdisplay%2Fstructure.rs?ref=53e3a7aeb4a706a6ee84229f94719dd78432417c", "patch": "@@ -173,12 +173,19 @@ fn structure_node(node: &SyntaxNode) -> Option<StructureNode> {\n \n #[cfg(test)]\n mod tests {\n+    use expect::{expect, Expect};\n+\n     use super::*;\n-    use insta::assert_debug_snapshot;\n+\n+    fn check(ra_fixture: &str, expect: Expect) {\n+        let file = SourceFile::parse(ra_fixture).ok().unwrap();\n+        let structure = file_structure(&file);\n+        expect.assert_debug_eq(&structure)\n+    }\n \n     #[test]\n     fn test_file_structure() {\n-        let file = SourceFile::parse(\n+        check(\n             r#\"\n struct Foo {\n     x: i32\n@@ -223,216 +230,211 @@ fn obsolete() {}\n #[deprecated(note = \"for awhile\")]\n fn very_obsolete() {}\n \"#,\n-        )\n-        .ok()\n-        .unwrap();\n-        let structure = file_structure(&file);\n-        assert_debug_snapshot!(structure,\n-        @r###\"\n-        [\n-            StructureNode {\n-                parent: None,\n-                label: \"Foo\",\n-                navigation_range: 8..11,\n-                node_range: 1..26,\n-                kind: STRUCT_DEF,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    0,\n-                ),\n-                label: \"x\",\n-                navigation_range: 18..19,\n-                node_range: 18..24,\n-                kind: RECORD_FIELD_DEF,\n-                detail: Some(\n-                    \"i32\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"m\",\n-                navigation_range: 32..33,\n-                node_range: 28..158,\n-                kind: MODULE,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    2,\n-                ),\n-                label: \"bar1\",\n-                navigation_range: 43..47,\n-                node_range: 40..52,\n-                kind: FN_DEF,\n-                detail: Some(\n-                    \"fn()\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    2,\n-                ),\n-                label: \"bar2\",\n-                navigation_range: 60..64,\n-                node_range: 57..81,\n-                kind: FN_DEF,\n-                detail: Some(\n-                    \"fn<T>(t: T) -> T\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    2,\n-                ),\n-                label: \"bar3\",\n-                navigation_range: 89..93,\n-                node_range: 86..156,\n-                kind: FN_DEF,\n-                detail: Some(\n-                    \"fn<A, B>(a: A, b: B) -> Vec< u32 >\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"E\",\n-                navigation_range: 165..166,\n-                node_range: 160..180,\n-                kind: ENUM_DEF,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    6,\n-                ),\n-                label: \"X\",\n-                navigation_range: 169..170,\n-                node_range: 169..170,\n-                kind: ENUM_VARIANT,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: Some(\n-                    6,\n-                ),\n-                label: \"Y\",\n-                navigation_range: 172..173,\n-                node_range: 172..178,\n-                kind: ENUM_VARIANT,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"T\",\n-                navigation_range: 186..187,\n-                node_range: 181..193,\n-                kind: TYPE_ALIAS_DEF,\n-                detail: Some(\n-                    \"()\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"S\",\n-                navigation_range: 201..202,\n-                node_range: 194..213,\n-                kind: STATIC_DEF,\n-                detail: Some(\n-                    \"i32\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"C\",\n-                navigation_range: 220..221,\n-                node_range: 214..232,\n-                kind: CONST_DEF,\n-                detail: Some(\n-                    \"i32\",\n-                ),\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"impl E\",\n-                navigation_range: 239..240,\n-                node_range: 234..243,\n-                kind: IMPL_DEF,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"impl fmt::Debug for E\",\n-                navigation_range: 265..266,\n-                node_range: 245..269,\n-                kind: IMPL_DEF,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"mc\",\n-                navigation_range: 284..286,\n-                node_range: 271..303,\n-                kind: MACRO_CALL,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"mcexp\",\n-                navigation_range: 334..339,\n-                node_range: 305..356,\n-                kind: MACRO_CALL,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"mcexp\",\n-                navigation_range: 387..392,\n-                node_range: 358..409,\n-                kind: MACRO_CALL,\n-                detail: None,\n-                deprecated: false,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"obsolete\",\n-                navigation_range: 428..436,\n-                node_range: 411..441,\n-                kind: FN_DEF,\n-                detail: Some(\n-                    \"fn()\",\n-                ),\n-                deprecated: true,\n-            },\n-            StructureNode {\n-                parent: None,\n-                label: \"very_obsolete\",\n-                navigation_range: 481..494,\n-                node_range: 443..499,\n-                kind: FN_DEF,\n-                detail: Some(\n-                    \"fn()\",\n-                ),\n-                deprecated: true,\n-            },\n-        ]\n-        \"###\n-                );\n+            expect![[r#\"\n+                [\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"Foo\",\n+                        navigation_range: 8..11,\n+                        node_range: 1..26,\n+                        kind: STRUCT_DEF,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            0,\n+                        ),\n+                        label: \"x\",\n+                        navigation_range: 18..19,\n+                        node_range: 18..24,\n+                        kind: RECORD_FIELD_DEF,\n+                        detail: Some(\n+                            \"i32\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"m\",\n+                        navigation_range: 32..33,\n+                        node_range: 28..158,\n+                        kind: MODULE,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            2,\n+                        ),\n+                        label: \"bar1\",\n+                        navigation_range: 43..47,\n+                        node_range: 40..52,\n+                        kind: FN_DEF,\n+                        detail: Some(\n+                            \"fn()\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            2,\n+                        ),\n+                        label: \"bar2\",\n+                        navigation_range: 60..64,\n+                        node_range: 57..81,\n+                        kind: FN_DEF,\n+                        detail: Some(\n+                            \"fn<T>(t: T) -> T\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            2,\n+                        ),\n+                        label: \"bar3\",\n+                        navigation_range: 89..93,\n+                        node_range: 86..156,\n+                        kind: FN_DEF,\n+                        detail: Some(\n+                            \"fn<A, B>(a: A, b: B) -> Vec< u32 >\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"E\",\n+                        navigation_range: 165..166,\n+                        node_range: 160..180,\n+                        kind: ENUM_DEF,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            6,\n+                        ),\n+                        label: \"X\",\n+                        navigation_range: 169..170,\n+                        node_range: 169..170,\n+                        kind: ENUM_VARIANT,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: Some(\n+                            6,\n+                        ),\n+                        label: \"Y\",\n+                        navigation_range: 172..173,\n+                        node_range: 172..178,\n+                        kind: ENUM_VARIANT,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"T\",\n+                        navigation_range: 186..187,\n+                        node_range: 181..193,\n+                        kind: TYPE_ALIAS_DEF,\n+                        detail: Some(\n+                            \"()\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"S\",\n+                        navigation_range: 201..202,\n+                        node_range: 194..213,\n+                        kind: STATIC_DEF,\n+                        detail: Some(\n+                            \"i32\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"C\",\n+                        navigation_range: 220..221,\n+                        node_range: 214..232,\n+                        kind: CONST_DEF,\n+                        detail: Some(\n+                            \"i32\",\n+                        ),\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"impl E\",\n+                        navigation_range: 239..240,\n+                        node_range: 234..243,\n+                        kind: IMPL_DEF,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"impl fmt::Debug for E\",\n+                        navigation_range: 265..266,\n+                        node_range: 245..269,\n+                        kind: IMPL_DEF,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"mc\",\n+                        navigation_range: 284..286,\n+                        node_range: 271..303,\n+                        kind: MACRO_CALL,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"mcexp\",\n+                        navigation_range: 334..339,\n+                        node_range: 305..356,\n+                        kind: MACRO_CALL,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"mcexp\",\n+                        navigation_range: 387..392,\n+                        node_range: 358..409,\n+                        kind: MACRO_CALL,\n+                        detail: None,\n+                        deprecated: false,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"obsolete\",\n+                        navigation_range: 428..436,\n+                        node_range: 411..441,\n+                        kind: FN_DEF,\n+                        detail: Some(\n+                            \"fn()\",\n+                        ),\n+                        deprecated: true,\n+                    },\n+                    StructureNode {\n+                        parent: None,\n+                        label: \"very_obsolete\",\n+                        navigation_range: 481..494,\n+                        node_range: 443..499,\n+                        kind: FN_DEF,\n+                        detail: Some(\n+                            \"fn()\",\n+                        ),\n+                        deprecated: true,\n+                    },\n+                ]\n+            \"#]],\n+        );\n     }\n }"}]}