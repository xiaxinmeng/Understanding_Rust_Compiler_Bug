{"sha": "c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "node_id": "C_kwDOAAsO6NoAKGMyNmI1MTBkYmNjYTZiOGEzZTdlYzRjNGY5N2RlZjE2MTVlNmNkNjQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-20T09:49:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-20T09:49:34Z"}, "message": "Auto merge of #2681 - RalfJung:seed, r=oli-obk\n\nmake miri-seed a regular integer, and also set layout-seed in many-seeds\n\nThis makes the seed format consistent between `-Zlayout-seed` and `-Zmiri-seed`.", "tree": {"sha": "37a8fc7431dfd5454237fc514c3e76d93cc4eb6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/37a8fc7431dfd5454237fc514c3e76d93cc4eb6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "html_url": "https://github.com/rust-lang/rust/commit/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a9e5e8e81959195ff5671d5af20097745381477", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a9e5e8e81959195ff5671d5af20097745381477", "html_url": "https://github.com/rust-lang/rust/commit/0a9e5e8e81959195ff5671d5af20097745381477"}, {"sha": "772d521616f09470dadd65c609273267fa576e4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/772d521616f09470dadd65c609273267fa576e4d", "html_url": "https://github.com/rust-lang/rust/commit/772d521616f09470dadd65c609273267fa576e4d"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "dac0a9820b90e35350de14929acdc6449feb4da2", "filename": "src/tools/miri/README.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2FREADME.md?ref=c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "patch": "@@ -195,7 +195,7 @@ randomness that is used to determine allocation base addresses. The following\n snippet calls Miri in a loop with different values for the seed:\n \n ```\n-for SEED in $({ echo obase=16; seq 0 255; } | bc); do\n+for SEED in $(seq 0 255); do\n   echo \"Trying seed: $SEED\"\n   MIRIFLAGS=-Zmiri-seed=$SEED cargo miri test || { echo \"Failing seed: $SEED\"; break; };\n done\n@@ -303,7 +303,7 @@ environment variable. We first document the most relevant and most commonly used\n   tell what it is doing when a program just keeps running. You can customize how frequently the\n   report is printed via `-Zmiri-report-progress=<blocks>`, which prints the report every N basic\n   blocks.\n-* `-Zmiri-seed=<hex>` configures the seed of the RNG that Miri uses to resolve non-determinism. This\n+* `-Zmiri-seed=<num>` configures the seed of the RNG that Miri uses to resolve non-determinism. This\n   RNG is used to pick base addresses for allocations, to determine preemption and failure of\n   `compare_exchange_weak`, and to control store buffering for weak memory emulation. When isolation\n   is enabled (the default), this is also used to emulate system entropy. The default seed is 0. You"}, {"sha": "38d36898768e18c12f185a9e6966dcd86b55dd7f", "filename": "src/tools/miri/miri", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Fmiri", "raw_url": "https://github.com/rust-lang/rust/raw/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Fmiri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fmiri?ref=c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "patch": "@@ -174,9 +174,9 @@ rustc-push)\n     fi\n     ;;\n many-seeds)\n-    for SEED in $({ echo obase=16; seq 0 255; } | bc); do\n+    for SEED in $(seq 0 255); do\n         echo \"Trying seed: $SEED\"\n-        MIRIFLAGS=\"$MIRIFLAGS -Zmiri-seed=$SEED\" $@ || { echo \"Failing seed: $SEED\"; break; }\n+        MIRIFLAGS=\"$MIRIFLAGS -Zlayout-seed=$SEED -Zmiri-seed=$SEED\" $@ || { echo \"Failing seed: $SEED\"; break; }\n     done\n     exit 0\n     ;;"}, {"sha": "ffe89921d98665219644fab5baa94bedb051c23b", "filename": "src/tools/miri/src/bin/miri.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Fsrc%2Fbin%2Fmiri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Fsrc%2Fbin%2Fmiri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Fbin%2Fmiri.rs?ref=c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "patch": "@@ -394,10 +394,9 @@ fn main() {\n             if miri_config.seed.is_some() {\n                 show_error!(\"Cannot specify -Zmiri-seed multiple times!\");\n             }\n-            let seed = u64::from_str_radix(param, 16)\n-                        .unwrap_or_else(|_| show_error!(\n-                            \"-Zmiri-seed should only contain valid hex digits [0-9a-fA-F] and must fit into a u64 (max 16 characters)\"\n-                        ));\n+            let seed = param.parse::<u64>().unwrap_or_else(|_| {\n+                show_error!(\"-Zmiri-seed must be an integer that fits into u64\")\n+            });\n             miri_config.seed = Some(seed);\n         } else if let Some(_param) = arg.strip_prefix(\"-Zmiri-env-exclude=\") {\n             show_error!("}, {"sha": "46b3afa70e5b0fd0e3fd89f5f7d47cd358a9fdbf", "filename": "src/tools/miri/test-cargo-miri/run-test.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Frun-test.py?ref=c26b510dbcca6b8a3e7ec4c4f97def1615e6cd64", "patch": "@@ -133,7 +133,7 @@ def test_cargo_miri_test():\n     test(\"`cargo miri test`\",\n         cargo_miri(\"test\"),\n         default_ref, \"test.stderr-empty.ref\",\n-        env={'MIRIFLAGS': \"-Zmiri-permissive-provenance -Zmiri-seed=feed\"},\n+        env={'MIRIFLAGS': \"-Zmiri-permissive-provenance -Zmiri-seed=4242\"},\n     )\n     test(\"`cargo miri test` (no isolation, no doctests)\",\n         cargo_miri(\"test\") + [\"--bins\", \"--tests\"], # no `--lib`, we disabled that in `Cargo.toml`"}]}