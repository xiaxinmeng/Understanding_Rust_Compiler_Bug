{"sha": "58eb22fdae6847eb292754e466da7922c03fc0e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4ZWIyMmZkYWU2ODQ3ZWIyOTI3NTRlNDY2ZGE3OTIyYzAzZmMwZTQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-26T11:37:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-26T11:37:55Z"}, "message": "Rollup merge of #61077 - nnethercote:tweak-prefill, r=petrochenkov\n\nDon't arena-allocate static symbols.\n\nIt's just a waste of memory. This also gets rid of the special case for\n\"\".\n\nr? @petrochenkov", "tree": {"sha": "c5bcd4a9a6bbadd398da00e1483b2578ead4d82c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c5bcd4a9a6bbadd398da00e1483b2578ead4d82c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58eb22fdae6847eb292754e466da7922c03fc0e4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJc6nqTCRBK7hj4Ov3rIwAAdHIIAAkKaLf0ka8oC87TFSb0wALp\nPzKoinY/w5chZwAbKQpcCpJwP24fZ51afPLB42EZt/bVrUO7eSgqt++c+VZ1AP49\nRW3di1W3xAY80c2unSwiTfgXtaisWeOzMApRxNBp5KGVVeP+ZYqGAjXA36TT0v62\nQlxUxK0mJjh8/u4bf4nCY4V4zl9KDupPiX/3K+Vbuz0p3Zs1w51dvckyLbceeehi\nt2PoA1GY0NvCYHVCVwPNuWHE4W6lDSIeH3HF/9AmHorQRkpObcgxmanGSjbIh8/j\n4PX33AlhHck7jlJevKSS6VUZyppUxRkR090sooq7CA3UDi9ivg3ops1bE/zIc4g=\n=bVNC\n-----END PGP SIGNATURE-----\n", "payload": "tree c5bcd4a9a6bbadd398da00e1483b2578ead4d82c\nparent 2268d9923bcb34a6c921d285cca7fa3dba857c02\nparent e396f992558746689e1d562c5a6bb0b92bf70b93\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1558870675 +0200\ncommitter GitHub <noreply@github.com> 1558870675 +0200\n\nRollup merge of #61077 - nnethercote:tweak-prefill, r=petrochenkov\n\nDon't arena-allocate static symbols.\n\nIt's just a waste of memory. This also gets rid of the special case for\n\"\".\n\nr? @petrochenkov\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58eb22fdae6847eb292754e466da7922c03fc0e4", "html_url": "https://github.com/rust-lang/rust/commit/58eb22fdae6847eb292754e466da7922c03fc0e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58eb22fdae6847eb292754e466da7922c03fc0e4/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2268d9923bcb34a6c921d285cca7fa3dba857c02", "url": "https://api.github.com/repos/rust-lang/rust/commits/2268d9923bcb34a6c921d285cca7fa3dba857c02", "html_url": "https://github.com/rust-lang/rust/commit/2268d9923bcb34a6c921d285cca7fa3dba857c02"}, {"sha": "e396f992558746689e1d562c5a6bb0b92bf70b93", "url": "https://api.github.com/repos/rust-lang/rust/commits/e396f992558746689e1d562c5a6bb0b92bf70b93", "html_url": "https://github.com/rust-lang/rust/commit/e396f992558746689e1d562c5a6bb0b92bf70b93"}], "stats": {"total": 19, "additions": 6, "deletions": 13}, "files": [{"sha": "26422e891c53643846c5a095479022c6113982d5", "filename": "src/libsyntax_pos/symbol.rs", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/58eb22fdae6847eb292754e466da7922c03fc0e4/src%2Flibsyntax_pos%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58eb22fdae6847eb292754e466da7922c03fc0e4/src%2Flibsyntax_pos%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Fsymbol.rs?ref=58eb22fdae6847eb292754e466da7922c03fc0e4", "patch": "@@ -866,20 +866,13 @@ pub struct Interner {\n }\n \n impl Interner {\n-    fn prefill(init: &[&str]) -> Self {\n-        let mut this = Interner::default();\n-        this.names.reserve(init.len());\n-        this.strings.reserve(init.len());\n-\n-        // We can't allocate empty strings in the arena, so handle this here.\n-        assert!(kw::Invalid.as_u32() == 0 && init[0].is_empty());\n-        this.names.insert(\"\", kw::Invalid);\n-        this.strings.push(\"\");\n-\n-        for string in &init[1..] {\n-            this.intern(string);\n+    fn prefill(init: &[&'static str]) -> Self {\n+        let symbols = (0 .. init.len() as u32).map(Symbol::new);\n+        Interner {\n+            strings: init.to_vec(),\n+            names: init.iter().copied().zip(symbols).collect(),\n+            ..Default::default()\n         }\n-        this\n     }\n \n     pub fn intern(&mut self, string: &str) -> Symbol {"}]}