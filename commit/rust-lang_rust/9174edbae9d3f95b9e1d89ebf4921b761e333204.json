{"sha": "9174edbae9d3f95b9e1d89ebf4921b761e333204", "node_id": "C_kwDOAAsO6NoAKDkxNzRlZGJhZTlkM2Y5NWI5ZTFkODllYmY0OTIxYjc2MWUzMzMyMDQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-19T02:20:15Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-19T03:45:47Z"}, "message": "Delay overlap errors if errors are involved", "tree": {"sha": "3f90e0512dfb108e581d8f1c5cc2c9920869a34f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f90e0512dfb108e581d8f1c5cc2c9920869a34f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9174edbae9d3f95b9e1d89ebf4921b761e333204", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9174edbae9d3f95b9e1d89ebf4921b761e333204", "html_url": "https://github.com/rust-lang/rust/commit/9174edbae9d3f95b9e1d89ebf4921b761e333204", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9174edbae9d3f95b9e1d89ebf4921b761e333204/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "322c7b6269f0a2147b85f4cc38006afca22a0d31", "url": "https://api.github.com/repos/rust-lang/rust/commits/322c7b6269f0a2147b85f4cc38006afca22a0d31", "html_url": "https://github.com/rust-lang/rust/commit/322c7b6269f0a2147b85f4cc38006afca22a0d31"}], "stats": {"total": 23, "additions": 15, "deletions": 8}, "files": [{"sha": "8546bbe52dcc39d369520f97958284dfc79f7225", "filename": "compiler/rustc_trait_selection/src/traits/specialize/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9174edbae9d3f95b9e1d89ebf4921b761e333204/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9174edbae9d3f95b9e1d89ebf4921b761e333204/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fspecialize%2Fmod.rs?ref=9174edbae9d3f95b9e1d89ebf4921b761e333204", "patch": "@@ -22,7 +22,7 @@ use crate::traits::{\n use rustc_data_structures::fx::FxIndexSet;\n use rustc_errors::{error_code, DelayDm, Diagnostic};\n use rustc_hir::def_id::{DefId, LocalDefId};\n-use rustc_middle::ty::{self, ImplSubject, Ty, TyCtxt};\n+use rustc_middle::ty::{self, ImplSubject, Ty, TyCtxt, TypeVisitableExt};\n use rustc_middle::ty::{InternalSubsts, SubstsRef};\n use rustc_session::lint::builtin::COHERENCE_LEAK_CHECK;\n use rustc_session::lint::builtin::ORDER_DEPENDENT_TRAIT_OBJECTS;\n@@ -350,6 +350,10 @@ fn report_conflicting_impls<'tcx>(\n         impl_span: Span,\n         err: &mut Diagnostic,\n     ) {\n+        if (overlap.trait_ref, overlap.self_ty).references_error() {\n+            err.downgrade_to_delayed_bug();\n+        }\n+\n         match tcx.span_of_impl(overlap.with_impl) {\n             Ok(span) => {\n                 err.span_label(span, \"first implementation here\");"}, {"sha": "5fd7c647c253111888d7059dfe31f9c626f26fe0", "filename": "tests/ui/specialization/min_specialization/bad-const-wf-doesnt-specialize.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9174edbae9d3f95b9e1d89ebf4921b761e333204/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9174edbae9d3f95b9e1d89ebf4921b761e333204/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.rs?ref=9174edbae9d3f95b9e1d89ebf4921b761e333204", "patch": "@@ -6,7 +6,7 @@\n struct S<const L: usize>;\n \n impl<const N: i32> Copy for S<N> {}\n+//~^ ERROR the constant `N` is not of type `usize`\n impl<const M: usize> Copy for S<M> {}\n-//~^ ERROR conflicting implementations of trait `Copy` for type `S<[const error]>`\n \n fn main() {}"}, {"sha": "6d7028c5e7088e18cbf060cfae64233e3be8c857", "filename": "tests/ui/specialization/min_specialization/bad-const-wf-doesnt-specialize.stderr", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9174edbae9d3f95b9e1d89ebf4921b761e333204/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9174edbae9d3f95b9e1d89ebf4921b761e333204/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fspecialization%2Fmin_specialization%2Fbad-const-wf-doesnt-specialize.stderr?ref=9174edbae9d3f95b9e1d89ebf4921b761e333204", "patch": "@@ -1,11 +1,14 @@\n-error[E0119]: conflicting implementations of trait `Copy` for type `S<[const error]>`\n-  --> $DIR/bad-const-wf-doesnt-specialize.rs:9:1\n+error: the constant `N` is not of type `usize`\n+  --> $DIR/bad-const-wf-doesnt-specialize.rs:8:29\n    |\n LL | impl<const N: i32> Copy for S<N> {}\n-   | -------------------------------- first implementation here\n-LL | impl<const M: usize> Copy for S<M> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `S<[const error]>`\n+   |                             ^^^^\n+   |\n+note: required by a bound in `S`\n+  --> $DIR/bad-const-wf-doesnt-specialize.rs:6:10\n+   |\n+LL | struct S<const L: usize>;\n+   |          ^^^^^^^^^^^^^^ required by this bound in `S`\n \n error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0119`."}]}