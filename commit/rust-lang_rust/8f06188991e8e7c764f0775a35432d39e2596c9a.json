{"sha": "8f06188991e8e7c764f0775a35432d39e2596c9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmMDYxODg5OTFlOGU3Yzc2NGYwNzc1YTM1NDMyZDM5ZTI1OTZjOWE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-22T01:46:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-22T01:46:13Z"}, "message": "Auto merge of #60053 - Xanewok:serde-save-analysis, r=nrc\n\nsave-analysis: Use serde instead of libserialize to dump JSON data\n\nThis breaks the save-analysis infrastructure (which also includes `rls-{analysis, data, span}` crates) from depending on rustc_serialize and so we can start moving them to being supported on stable without implementing `Decodable` et al. by hand for data structures defined there.\n\nNotable benefits:\n- we drop the awkward raw byte `PathBuf` [serialization](https://gist.github.com/Xanewok/f4fe8564d0dc0c3ab1dbc244279ff895) (until now (de)serialized as `&[u8]`)\n- [faster](https://github.com/serde-rs/json-benchmark) (hopefully noticeable for inner crate dependencies for the RLS workloads)\n- we can easily explore the binary serialization backend (which we planned to do for save-analysis anyway)\n\n~This should be merged together with an update to RLS (https://github.com/rust-lang/rls/pull/1435), which technically could be included right now because we can use the bundled `rls-analysis` here directly, however I'd prefer to publish this to crates.io first (https://github.com/rust-lang/rls/pull/1434, cc @nrc) and use the published version, instead.~\nIncludes https://github.com/rust-lang/rls/pull/1436.\n\n@matklad @nikomatsakis This is also important for the potential RLS 1.0 - 2.0 bridge we talked about on Zulip today", "tree": {"sha": "d83913db9c06ec4346475fd6dbd74596a759b6e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d83913db9c06ec4346475fd6dbd74596a759b6e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f06188991e8e7c764f0775a35432d39e2596c9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f06188991e8e7c764f0775a35432d39e2596c9a", "html_url": "https://github.com/rust-lang/rust/commit/8f06188991e8e7c764f0775a35432d39e2596c9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f06188991e8e7c764f0775a35432d39e2596c9a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "247b505099ce96b0fbf686249ff410a893793ed7", "url": "https://api.github.com/repos/rust-lang/rust/commits/247b505099ce96b0fbf686249ff410a893793ed7", "html_url": "https://github.com/rust-lang/rust/commit/247b505099ce96b0fbf686249ff410a893793ed7"}, {"sha": "2dccaa77f877077e2338251471911e0ff8e2f526", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dccaa77f877077e2338251471911e0ff8e2f526", "html_url": "https://github.com/rust-lang/rust/commit/2dccaa77f877077e2338251471911e0ff8e2f526"}], "stats": {"total": 87, "additions": 43, "deletions": 44}, "files": [{"sha": "4c493b25fd9293cd3cc94fa39890bf0961599633", "filename": "Cargo.lock", "status": "modified", "additions": 29, "deletions": 32, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/8f06188991e8e7c764f0775a35432d39e2596c9a/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/8f06188991e8e7c764f0775a35432d39e2596c9a/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -1367,7 +1367,7 @@ dependencies = [\n \n [[package]]\n name = \"lsp-types\"\n-version = \"0.55.4\"\n+version = \"0.57.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2029,7 +2029,7 @@ dependencies = [\n \n [[package]]\n name = \"racer\"\n-version = \"2.1.21\"\n+version = \"2.1.22\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2039,7 +2039,7 @@ dependencies = [\n  \"humantime 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-ap-syntax 407.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -2221,7 +2221,7 @@ dependencies = [\n \n [[package]]\n name = \"rls\"\n-version = \"1.35.0\"\n+version = \"1.36.0\"\n dependencies = [\n  \"cargo 0.37.0\",\n  \"cargo_metadata 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2238,19 +2238,19 @@ dependencies = [\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lsp-codec 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"lsp-types 0.55.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"lsp-types 0.57.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 1.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ordslice 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"racer 2.1.21 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"racer 2.1.22 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rand 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rayon 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"regex 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-analysis 0.16.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-analysis 0.17.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rls-blacklist 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-data 0.18.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-data 0.19.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rls-rustc 0.6.0\",\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-vfs 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-vfs 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-workspace-hack 1.0.0\",\n  \"rustc_tools_util 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2270,17 +2270,18 @@ dependencies = [\n \n [[package]]\n name = \"rls-analysis\"\n-version = \"0.16.12\"\n+version = \"0.17.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"derive-new 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"fst 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"json 0.11.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-data 0.18.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-data 0.19.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.82 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde_json 1.0.33 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -2290,13 +2291,11 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"rls-data\"\n-version = \"0.18.2\"\n+version = \"0.19.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde 1.0.82 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive 1.0.81 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -2305,21 +2304,19 @@ version = \"0.6.0\"\n \n [[package]]\n name = \"rls-span\"\n-version = \"0.4.1\"\n+version = \"0.5.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde 1.0.82 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"serde_derive 1.0.81 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"rls-vfs\"\n-version = \"0.7.0\"\n+version = \"0.8.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -2930,14 +2927,14 @@ name = \"rustc_save_analysis\"\n version = \"0.0.0\"\n dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-data 0.18.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-data 0.19.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n- \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_codegen_utils 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n  \"rustc_target 0.0.0\",\n  \"rustc_typeck 0.0.0\",\n+ \"serde_json 1.0.33 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"syntax 0.0.0\",\n  \"syntax_pos 0.0.0\",\n ]\n@@ -4125,7 +4122,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c84ec4b527950aa83a329754b01dbe3f58361d1c5efacd1f6d68c494d08a17c6\"\n \"checksum log_settings 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"19af41f0565d7c19b2058153ad0b42d4d5ce89ec4dbf06ed6741114a8b63e7cd\"\n \"checksum lsp-codec 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"169d737ad89cf8ddd82d1804d9122f54568c49377665157277cc90d747b1d31a\"\n-\"checksum lsp-types 0.55.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6392b5843615b8a2adeebe87b83fdd29567c0870baba3407a67e6dbfee4712f8\"\n+\"checksum lsp-types 0.57.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d220de1fbbb12b60df17898272579c22329375fc4baa960402fbd17cf0cdd165\"\n \"checksum lzma-sys 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d1eaa027402541975218bb0eec67d6b0412f6233af96e0d096d31dbdfd22e614\"\n \"checksum mac 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c41e0c4fef86961ac6d6f8a82609f55f31b05e4fce149ac5710e439df7619ba4\"\n \"checksum macro-utils 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f2c4deaccc2ead6a28c16c0ba82f07d52b6475397415ce40876e559b0b0ea510\"\n@@ -4191,7 +4188,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum quine-mc_cluskey 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"07589615d719a60c8dd8a4622e7946465dfef20d1a428f969e3443e7386d5f45\"\n \"checksum quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7a6e920b65c65f10b2ae65c831a81a073a89edd28c7cce89475bff467ab4167a\"\n \"checksum quote 0.6.10 (registry+https://github.com/rust-lang/crates.io-index)\" = \"53fa22a1994bd0f9372d7a816207d8a2677ad0325b073f5c5332760f0fb62b5c\"\n-\"checksum racer 2.1.21 (registry+https://github.com/rust-lang/crates.io-index)\" = \"37c88638777cc178684cf648ca0e1dad56646ce105b8593dfe665c436300adc3\"\n+\"checksum racer 2.1.22 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1e4323343f25bc372dc9293ac6b5cd3034b32784af1e7de9366b4db71466d8c7\"\n \"checksum rand 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8356f47b32624fef5b3301c1be97e5944ecdd595409cc5da11d05f211db6cfbd\"\n \"checksum rand 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ae9d223d52ae411a33cf7e54ec6034ec165df296ccd23533d671a28252b6f66a\"\n \"checksum rand_chacha 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"771b009e3a508cb67e8823dda454aaa5368c7bc1c16829fb77d3e980440dd34a\"\n@@ -4210,11 +4207,11 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum regex-syntax 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7d707a4fa2637f2dca2ef9fd02225ec7661fe01a53623c1e6515b6916511f7a7\"\n \"checksum regex-syntax 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4e47a2ed29da7a9e1960e1639e7a982e6edc6d49be308a3b02daf511504a16d1\"\n \"checksum remove_dir_all 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3488ba1b9a2084d38645c4c08276a1752dcbf2c7130d74f1569681ad5d2799c5\"\n-\"checksum rls-analysis 0.16.12 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ae18d8ad01dec3b2014f4d7ae3c607d7adbcff79e5d3b48ea42ea71c10d43a71\"\n+\"checksum rls-analysis 0.17.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d53d49a28f75da9d02790d9256fecf6c0481e0871374326023c7a33131295579\"\n \"checksum rls-blacklist 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b8ce1fdac03e138c4617ff87b194e1ff57a39bb985a044ccbd8673d30701e411\"\n-\"checksum rls-data 0.18.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5f80b84551b32e26affaf7f12374913b5061730c0dcd185d9e8fa5a15e36e65c\"\n-\"checksum rls-span 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"33d66f1d6c6ccd5c98029f162544131698f6ebb61d8c697681cac409dcd08805\"\n-\"checksum rls-vfs 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"72d56425bd5aa86d9d4372b76f0381d3b4bda9c0220e71956c9fcc929f45c1f1\"\n+\"checksum rls-data 0.19.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"76c72ea97e045be5f6290bb157ebdc5ee9f2b093831ff72adfaf59025cf5c491\"\n+\"checksum rls-span 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f1cb4694410d8d2ce43ccff3682f1c782158a018d5a9a92185675677f7533eb3\"\n+\"checksum rls-vfs 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ce4b57b25b4330ed5ec14028fc02141e083ddafda327e7eb598dc0569c8c83c9\"\n \"checksum rustc-ap-arena 407.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"5aab2fb5e5becf1c9183f6c63b8714817a3e780a20b4fe6b3920751c98a18225\"\n \"checksum rustc-ap-graphviz 407.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0235ff613d4f96176ea56748010b5d8e978605cc47856ba9bb5372f4f38e9c03\"\n \"checksum rustc-ap-rustc_cratesio_shim 407.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"63e04a90b0dd8597da83633961698c61a2948f50c9d4b9a71e8afafc0ba0f158\""}, {"sha": "767c726b761f22af17ae5b0bc2f10c64b789c268", "filename": "src/librustc_save_analysis/Cargo.toml", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2FCargo.toml?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -16,9 +16,8 @@ rustc_data_structures = { path = \"../librustc_data_structures\" }\n rustc_codegen_utils = { path = \"../librustc_codegen_utils\" }\n rustc_target = { path = \"../librustc_target\" }\n rustc_typeck = { path = \"../librustc_typeck\" }\n+serde_json = \"1\"\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n-rls-data = \"0.18.1\"\n-rls-span = \"0.4\"\n-# FIXME(#40527) should move rustc serialize out of tree\n-rustc-serialize = \"0.3\"\n+rls-data = \"0.19\"\n+rls-span = \"0.5\""}, {"sha": "82b78369e1339ea7552164559bfd663ab097fed8", "filename": "src/librustc_save_analysis/json_dumper.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2Fjson_dumper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2Fjson_dumper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Fjson_dumper.rs?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -1,7 +1,5 @@\n use std::io::Write;\n \n-use rustc_serialize::json::as_json;\n-\n use rls_data::config::Config;\n use rls_data::{self, Analysis, CompilationOptions, CratePreludeData, Def, DefKind, Impl, Import,\n                MacroRef, Ref, RefKind, Relation};\n@@ -31,8 +29,8 @@ pub struct WriteOutput<'b, W: Write> {\n \n impl<'b, W: Write> DumpOutput for WriteOutput<'b, W> {\n     fn dump(&mut self, result: &Analysis) {\n-        if write!(self.output, \"{}\", as_json(&result)).is_err() {\n-            error!(\"Error writing output\");\n+        if let Err(e) = serde_json::to_writer(self.output.by_ref(), result) {\n+            error!(\"Can't serialize save-analysis: {:?}\", e);\n         }\n     }\n }"}, {"sha": "c173d51fd4014ea80f284ee876353a56fb6fdfcc", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -1141,10 +1141,15 @@ fn find_config(supplied: Option<Config>) -> Config {\n     if let Some(config) = supplied {\n         return config;\n     }\n+\n     match env::var_os(\"RUST_SAVE_ANALYSIS_CONFIG\") {\n-        Some(config_string) => rustc_serialize::json::decode(config_string.to_str().unwrap())\n-            .expect(\"Could not deserialize save-analysis config\"),\n         None => Config::default(),\n+        Some(config) => config.to_str()\n+            .ok_or(())\n+            .map_err(|_| error!(\"`RUST_SAVE_ANALYSIS_CONFIG` isn't UTF-8\"))\n+            .and_then(|cfg|  serde_json::from_str(cfg)\n+                .map_err(|_| error!(\"Could not deserialize save-analysis config\"))\n+            ).unwrap_or_default()\n     }\n }\n "}, {"sha": "18b845eeecb447a49fe699bf5f288413892fa5e3", "filename": "src/test/run-pass-fulldeps/newtype_index.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Ftest%2Frun-pass-fulldeps%2Fnewtype_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f06188991e8e7c764f0775a35432d39e2596c9a/src%2Ftest%2Frun-pass-fulldeps%2Fnewtype_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fnewtype_index.rs?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -1,7 +1,7 @@\n #![feature(rustc_attrs, rustc_private, step_trait)]\n \n #[macro_use] extern crate rustc_data_structures;\n-extern crate rustc_serialize;\n+extern crate serialize as rustc_serialize;\n \n use rustc_data_structures::indexed_vec::Idx;\n "}, {"sha": "20e32686df573fc44ac1052bf3e6982b0da27cfc", "filename": "src/tools/rls", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frls?ref=8f06188991e8e7c764f0775a35432d39e2596c9a", "patch": "@@ -1 +1 @@\n-Subproject commit b202e14dbf53949d05822e680ee5166b33468853\n+Subproject commit 20e32686df573fc44ac1052bf3e6982b0da27cfc"}]}