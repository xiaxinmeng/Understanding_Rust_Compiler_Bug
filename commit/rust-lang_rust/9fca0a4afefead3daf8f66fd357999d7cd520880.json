{"sha": "9fca0a4afefead3daf8f66fd357999d7cd520880", "node_id": "C_kwDOAAsO6NoAKDlmY2EwYTRhZmVmZWFkM2RhZjhmNjZmZDM1Nzk5OWQ3Y2Q1MjA4ODA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-10T10:25:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-10T10:25:20Z"}, "message": "Auto merge of #14316 - HKalbasi:master, r=HKalbasi\n\nFix stack overflow when derefrencing `&!`\n\nfix #14310", "tree": {"sha": "addf812aed5394caf570b51f982f2112f5eaa2b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/addf812aed5394caf570b51f982f2112f5eaa2b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fca0a4afefead3daf8f66fd357999d7cd520880", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fca0a4afefead3daf8f66fd357999d7cd520880", "html_url": "https://github.com/rust-lang/rust/commit/9fca0a4afefead3daf8f66fd357999d7cd520880", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fca0a4afefead3daf8f66fd357999d7cd520880/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "070f8f8578c5d68364c2950bec5c8b33db35800a", "url": "https://api.github.com/repos/rust-lang/rust/commits/070f8f8578c5d68364c2950bec5c8b33db35800a", "html_url": "https://github.com/rust-lang/rust/commit/070f8f8578c5d68364c2950bec5c8b33db35800a"}, {"sha": "a980b562a7b9035f00a67330afb95224f1196184", "url": "https://api.github.com/repos/rust-lang/rust/commits/a980b562a7b9035f00a67330afb95224f1196184", "html_url": "https://github.com/rust-lang/rust/commit/a980b562a7b9035f00a67330afb95224f1196184"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "6a29e8ce52e62bfbd75f91ac2e52f0d8bd7374d3", "filename": "crates/hir-ty/src/consteval/tests.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fconsteval%2Ftests.rs?ref=9fca0a4afefead3daf8f66fd357999d7cd520880", "patch": "@@ -146,6 +146,22 @@ fn reference_autoderef() {\n     \"#,\n         3,\n     );\n+    check_number(\n+        r#\"\n+    struct Foo<T> { x: T }\n+    impl<T> Foo<T> {\n+        fn foo(&mut self) -> T { self.x }\n+    }\n+    fn f(i: &mut &mut Foo<Foo<i32>>) -> i32 {\n+        ((**i).x).foo()\n+    }\n+    fn g(i: Foo<Foo<i32>>) -> i32 {\n+        i.x.foo()\n+    }\n+    const GOAL: i32 = f(&mut &mut Foo { x: Foo { x: 3 } }) + g(Foo { x: Foo { x: 5 } });\n+    \"#,\n+        8,\n+    );\n }\n \n #[test]"}, {"sha": "435a914088bcf5313376db47a42900d565a4c65f", "filename": "crates/hir-ty/src/mir/lower.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower.rs?ref=9fca0a4afefead3daf8f66fd357999d7cd520880", "patch": "@@ -637,7 +637,7 @@ impl MirLowerCtx<'_> {\n             }\n             Expr::Box { .. } => not_supported!(\"box expression\"),\n             Expr::Field { .. } | Expr::Index { .. } | Expr::UnaryOp { op: hir_def::expr::UnaryOp::Deref, .. } => {\n-                let Some((p, current)) = self.lower_expr_as_place(current, expr_id, true)? else {\n+                let Some((p, current)) = self.lower_expr_as_place_without_adjust(current, expr_id, true)? else {\n                     return Ok(None);\n                 };\n                 self.push_assignment(current, place, Operand::Copy(p).into(), expr_id.into());"}, {"sha": "fe8147dcd3e7af51f5865289ebabe903023b45af", "filename": "crates/hir-ty/src/mir/lower/as_place.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fmir%2Flower%2Fas_place.rs?ref=9fca0a4afefead3daf8f66fd357999d7cd520880", "patch": "@@ -110,7 +110,7 @@ impl MirLowerCtx<'_> {\n         }\n     }\n \n-    fn lower_expr_as_place_without_adjust(\n+    pub(super) fn lower_expr_as_place_without_adjust(\n         &mut self,\n         current: BasicBlockId,\n         expr_id: ExprId,"}, {"sha": "84189a5d560f97b9291ad471a2ef4e735100ad65", "filename": "crates/ide-diagnostics/src/handlers/mutability_errors.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fca0a4afefead3daf8f66fd357999d7cd520880/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmutability_errors.rs?ref=9fca0a4afefead3daf8f66fd357999d7cd520880", "patch": "@@ -336,6 +336,18 @@ fn main() {\n         );\n     }\n \n+    #[test]\n+    fn regression_14310() {\n+        check_diagnostics(\n+            r#\"\n+            fn clone(mut i: &!) -> ! {\n+                   //^^^^^ \ud83d\udca1 weak: variable does not need to be mutable\n+                *i\n+            }\n+        \"#,\n+        );\n+    }\n+\n     #[test]\n     fn match_bindings() {\n         check_diagnostics("}]}