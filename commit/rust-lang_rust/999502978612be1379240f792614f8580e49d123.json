{"sha": "999502978612be1379240f792614f8580e49d123", "node_id": "C_kwDOAAsO6NoAKDk5OTUwMjk3ODYxMmJlMTM3OTI0MGY3OTI2MTRmODU4MGU0OWQxMjM", "commit": {"author": {"name": "Chris Wailes", "email": "chriswailes@google.com", "date": "2022-09-13T23:06:07Z"}, "committer": {"name": "Chris Wailes", "email": "chriswailes@google.com", "date": "2022-09-16T20:08:44Z"}, "message": "Remove the allow-list for dynamic linking of LLVM tools\n\nThis commit removes an allow-list for the dynamic linking of the LLVM\ntools and instead relies on the builder's linking preference only.", "tree": {"sha": "90dcf550c40c85ad6a4e78b4d82430887f7b8cea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90dcf550c40c85ad6a4e78b4d82430887f7b8cea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/999502978612be1379240f792614f8580e49d123", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/999502978612be1379240f792614f8580e49d123", "html_url": "https://github.com/rust-lang/rust/commit/999502978612be1379240f792614f8580e49d123", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/999502978612be1379240f792614f8580e49d123/comments", "author": {"login": "chriswailes", "id": 530751, "node_id": "MDQ6VXNlcjUzMDc1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/530751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chriswailes", "html_url": "https://github.com/chriswailes", "followers_url": "https://api.github.com/users/chriswailes/followers", "following_url": "https://api.github.com/users/chriswailes/following{/other_user}", "gists_url": "https://api.github.com/users/chriswailes/gists{/gist_id}", "starred_url": "https://api.github.com/users/chriswailes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chriswailes/subscriptions", "organizations_url": "https://api.github.com/users/chriswailes/orgs", "repos_url": "https://api.github.com/users/chriswailes/repos", "events_url": "https://api.github.com/users/chriswailes/events{/privacy}", "received_events_url": "https://api.github.com/users/chriswailes/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chriswailes", "id": 530751, "node_id": "MDQ6VXNlcjUzMDc1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/530751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chriswailes", "html_url": "https://github.com/chriswailes", "followers_url": "https://api.github.com/users/chriswailes/followers", "following_url": "https://api.github.com/users/chriswailes/following{/other_user}", "gists_url": "https://api.github.com/users/chriswailes/gists{/gist_id}", "starred_url": "https://api.github.com/users/chriswailes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chriswailes/subscriptions", "organizations_url": "https://api.github.com/users/chriswailes/orgs", "repos_url": "https://api.github.com/users/chriswailes/repos", "events_url": "https://api.github.com/users/chriswailes/events{/privacy}", "received_events_url": "https://api.github.com/users/chriswailes/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54f20bbb8a7aeab93da17c0019c1aaa10329245a", "url": "https://api.github.com/repos/rust-lang/rust/commits/54f20bbb8a7aeab93da17c0019c1aaa10329245a", "html_url": "https://github.com/rust-lang/rust/commit/54f20bbb8a7aeab93da17c0019c1aaa10329245a"}], "stats": {"total": 15, "additions": 3, "deletions": 12}, "files": [{"sha": "fade44ecb158b7314e9322365854d4396a94c144", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/999502978612be1379240f792614f8580e49d123/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999502978612be1379240f792614f8580e49d123/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=999502978612be1379240f792614f8580e49d123", "patch": "@@ -1307,10 +1307,6 @@ impl Build {\n         self.package_vers(&self.version)\n     }\n \n-    fn llvm_link_tools_dynamically(&self, target: TargetSelection) -> bool {\n-        target.contains(\"linux-gnu\") || target.contains(\"apple-darwin\")\n-    }\n-\n     /// Returns the `version` string associated with this compiler for Rust\n     /// itself.\n     ///"}, {"sha": "d6ee6d489cf04ce87646364ef3b22cbadabb195e", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/999502978612be1379240f792614f8580e49d123/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999502978612be1379240f792614f8580e49d123/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=999502978612be1379240f792614f8580e49d123", "patch": "@@ -423,12 +423,7 @@ impl Step for Llvm {\n         // which saves both memory during parallel links and overall disk space\n         // for the tools. We don't do this on every platform as it doesn't work\n         // equally well everywhere.\n-        //\n-        // If we're not linking rustc to a dynamic LLVM, though, then don't link\n-        // tools to it.\n-        let llvm_link_shared =\n-            builder.llvm_link_tools_dynamically(target) && builder.llvm_link_shared();\n-        if llvm_link_shared {\n+        if builder.llvm_link_shared() {\n             cfg.define(\"LLVM_LINK_LLVM_DYLIB\", \"ON\");\n         }\n \n@@ -553,7 +548,7 @@ impl Step for Llvm {\n         // libLLVM.dylib will be built. However, llvm-config will still look\n         // for a versioned path like libLLVM-14.dylib. Manually create a symbolic\n         // link to make llvm-config happy.\n-        if llvm_link_shared && target.contains(\"apple-darwin\") {\n+        if builder.llvm_link_shared() && target.contains(\"apple-darwin\") {\n             let mut cmd = Command::new(&build_llvm_config);\n             let version = output(cmd.arg(\"--version\"));\n             let major = version.split('.').next().unwrap();"}, {"sha": "7826fd514093e255cb789106d0a74095cbbba358", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/999502978612be1379240f792614f8580e49d123/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/999502978612be1379240f792614f8580e49d123/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=999502978612be1379240f792614f8580e49d123", "patch": "@@ -286,7 +286,7 @@ jobs:\n \n           - name: x86_64-gnu-llvm-13\n             <<: *job-linux-xl\n-            \n+\n           - name: x86_64-gnu-tools\n             env:\n               CI_ONLY_WHEN_SUBMODULES_CHANGED: 1"}]}