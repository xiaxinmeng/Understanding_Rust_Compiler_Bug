{"sha": "5a1e531176bf6dab75e6c33cc30be6c5bb3ff345", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhMWU1MzExNzZiZjZkYWI3NWU2YzMzY2MzMGJlNmM1YmIzZmYzNDU=", "commit": {"author": {"name": "Steffen Lyngbaek", "email": "steffenlyngbaek@gmail.com", "date": "2020-03-14T05:06:49Z"}, "committer": {"name": "Steffen Lyngbaek", "email": "steffenlyngbaek@gmail.com", "date": "2020-03-14T05:06:49Z"}, "message": "Fix broken tests\n\n- Properly wait for workspace loading to be done", "tree": {"sha": "c9518b092460e04825c855aa3c6f1b614481abab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c9518b092460e04825c855aa3c6f1b614481abab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345", "html_url": "https://github.com/rust-lang/rust/commit/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345/comments", "author": {"login": "slyngbaek", "id": 1216902, "node_id": "MDQ6VXNlcjEyMTY5MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1216902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slyngbaek", "html_url": "https://github.com/slyngbaek", "followers_url": "https://api.github.com/users/slyngbaek/followers", "following_url": "https://api.github.com/users/slyngbaek/following{/other_user}", "gists_url": "https://api.github.com/users/slyngbaek/gists{/gist_id}", "starred_url": "https://api.github.com/users/slyngbaek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slyngbaek/subscriptions", "organizations_url": "https://api.github.com/users/slyngbaek/orgs", "repos_url": "https://api.github.com/users/slyngbaek/repos", "events_url": "https://api.github.com/users/slyngbaek/events{/privacy}", "received_events_url": "https://api.github.com/users/slyngbaek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "slyngbaek", "id": 1216902, "node_id": "MDQ6VXNlcjEyMTY5MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1216902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slyngbaek", "html_url": "https://github.com/slyngbaek", "followers_url": "https://api.github.com/users/slyngbaek/followers", "following_url": "https://api.github.com/users/slyngbaek/following{/other_user}", "gists_url": "https://api.github.com/users/slyngbaek/gists{/gist_id}", "starred_url": "https://api.github.com/users/slyngbaek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slyngbaek/subscriptions", "organizations_url": "https://api.github.com/users/slyngbaek/orgs", "repos_url": "https://api.github.com/users/slyngbaek/repos", "events_url": "https://api.github.com/users/slyngbaek/events{/privacy}", "received_events_url": "https://api.github.com/users/slyngbaek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0b58fd1fa93bf8d9c201e891528be1b1cc54512", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0b58fd1fa93bf8d9c201e891528be1b1cc54512", "html_url": "https://github.com/rust-lang/rust/commit/f0b58fd1fa93bf8d9c201e891528be1b1cc54512"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "1d7062bdf299bc2218d14667abc0e5890139449f", "filename": "crates/rust-analyzer/tests/heavy_tests/support.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345/crates%2Frust-analyzer%2Ftests%2Fheavy_tests%2Fsupport.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a1e531176bf6dab75e6c33cc30be6c5bb3ff345/crates%2Frust-analyzer%2Ftests%2Fheavy_tests%2Fsupport.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Ftests%2Fheavy_tests%2Fsupport.rs?ref=5a1e531176bf6dab75e6c33cc30be6c5bb3ff345", "patch": "@@ -12,13 +12,14 @@ use lsp_types::{\n     notification::{DidOpenTextDocument, Exit},\n     request::Shutdown,\n     ClientCapabilities, DidOpenTextDocumentParams, GotoCapability, TextDocumentClientCapabilities,\n-    TextDocumentIdentifier, TextDocumentItem, Url,\n+    TextDocumentIdentifier, TextDocumentItem, Url, WorkDoneProgress,\n };\n use serde::Serialize;\n use serde_json::{to_string_pretty, Value};\n use tempfile::TempDir;\n use test_utils::{find_mismatch, parse_fixture};\n \n+use req::{ProgressParams, ProgressParamsValue};\n use rust_analyzer::{main_loop, req, ServerConfig};\n \n pub struct Project<'a> {\n@@ -201,10 +202,14 @@ impl Server {\n     }\n     pub fn wait_until_workspace_is_loaded(&self) {\n         self.wait_for_message_cond(1, &|msg: &Message| match msg {\n-            Message::Notification(n) if n.method == \"window/showMessage\" => {\n-                let msg =\n-                    n.clone().extract::<req::ShowMessageParams>(\"window/showMessage\").unwrap();\n-                msg.message.starts_with(\"workspace loaded\")\n+            Message::Notification(n) if n.method == \"$/progress\" => {\n+                match n.clone().extract::<ProgressParams>(\"$/progress\").unwrap() {\n+                    ProgressParams {\n+                        token: req::ProgressToken::String(ref token),\n+                        value: ProgressParamsValue::WorkDone(WorkDoneProgress::End(_)),\n+                    } if token == \"rustAnalyzer/startup\" => true,\n+                    _ => false,\n+                }\n             }\n             _ => false,\n         })"}]}