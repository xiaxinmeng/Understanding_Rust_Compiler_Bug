{"sha": "9553fea23a8e04162684ec0679b1ca05e61159cb", "node_id": "C_kwDOAAsO6NoAKDk1NTNmZWEyM2E4ZTA0MTYyNjg0ZWMwNjc5YjFjYTA1ZTYxMTU5Y2I", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2022-11-11T17:12:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-11T17:12:29Z"}, "message": "Rollup merge of #102215 - alexcrichton:wasm-link-whole-archive, r=estebank\n\nImplement the `+whole-archive` modifier for `wasm-ld`\n\nThis implements the `Linker::{link_whole_staticlib,link_whole_rlib}` methods for the `WasmLd` linker used on wasm targets. Previously these methods were noops since I think historically `wasm-ld` did not have support for `--whole-archive` but nowadays it does, so the flags are passed through.", "tree": {"sha": "5225a12afa93e53ceeb6df4695b5a4eb810fcd4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5225a12afa93e53ceeb6df4695b5a4eb810fcd4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9553fea23a8e04162684ec0679b1ca05e61159cb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjboJ9CRBK7hj4Ov3rIwAANSsIAFlFuqEp5SxK8n3gQU65gV/M\nQp3urjIteKclS5dTKCIZTzeF7Yymcq4pW+V9y91Gjh00rkRsQ+0bafySVC0TEtni\nWajjPc35mvdhXjKZUltxT8+Ho1p7aKuzGAF4/7kC8vS5PmPEd3Tu6Xl6NMqNYpGg\nFekRHvFGNDqKemENpOaIbpeu4aoWHnkmtSRnQozvOk1b8ELidRtxT/JxdYuiICYm\nlFC1xA8GUNgDlkdhR+4Ss32p2dCYBMWr9OW2xvfT+bmyrOqNivfgvLAJnpQq35yW\nQ7ulK2QlYX2Lc7HN+0YItNG3/xUV83p0MXxsLKx/fTwH73g/0OGDxKWGFVKhzqA=\n=HKYG\n-----END PGP SIGNATURE-----\n", "payload": "tree 5225a12afa93e53ceeb6df4695b5a4eb810fcd4e\nparent 76ce198128c136cf908a4dfb1146489ae4ae7db3\nparent 6630c146f213088dff0d4ebd8dad90591544c169\nauthor Manish Goregaokar <manishsmail@gmail.com> 1668186749 -0500\ncommitter GitHub <noreply@github.com> 1668186749 -0500\n\nRollup merge of #102215 - alexcrichton:wasm-link-whole-archive, r=estebank\n\nImplement the `+whole-archive` modifier for `wasm-ld`\n\nThis implements the `Linker::{link_whole_staticlib,link_whole_rlib}` methods for the `WasmLd` linker used on wasm targets. Previously these methods were noops since I think historically `wasm-ld` did not have support for `--whole-archive` but nowadays it does, so the flags are passed through.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9553fea23a8e04162684ec0679b1ca05e61159cb", "html_url": "https://github.com/rust-lang/rust/commit/9553fea23a8e04162684ec0679b1ca05e61159cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9553fea23a8e04162684ec0679b1ca05e61159cb/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76ce198128c136cf908a4dfb1146489ae4ae7db3", "url": "https://api.github.com/repos/rust-lang/rust/commits/76ce198128c136cf908a4dfb1146489ae4ae7db3", "html_url": "https://github.com/rust-lang/rust/commit/76ce198128c136cf908a4dfb1146489ae4ae7db3"}, {"sha": "6630c146f213088dff0d4ebd8dad90591544c169", "url": "https://api.github.com/repos/rust-lang/rust/commits/6630c146f213088dff0d4ebd8dad90591544c169", "html_url": "https://github.com/rust-lang/rust/commit/6630c146f213088dff0d4ebd8dad90591544c169"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "7f0c2861f7e29014de16da9d8817dc50a7c8c6c6", "filename": "compiler/rustc_codegen_ssa/src/back/linker.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9553fea23a8e04162684ec0679b1ca05e61159cb/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9553fea23a8e04162684ec0679b1ca05e61159cb/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs?ref=9553fea23a8e04162684ec0679b1ca05e61159cb", "patch": "@@ -1260,11 +1260,11 @@ impl<'a> Linker for WasmLd<'a> {\n     }\n \n     fn link_whole_staticlib(&mut self, lib: &str, _verbatim: bool, _search_path: &[PathBuf]) {\n-        self.cmd.arg(\"-l\").arg(lib);\n+        self.cmd.arg(\"--whole-archive\").arg(\"-l\").arg(lib).arg(\"--no-whole-archive\");\n     }\n \n     fn link_whole_rlib(&mut self, lib: &Path) {\n-        self.cmd.arg(lib);\n+        self.cmd.arg(\"--whole-archive\").arg(lib).arg(\"--no-whole-archive\");\n     }\n \n     fn gc_sections(&mut self, _keep_metadata: bool) {"}]}