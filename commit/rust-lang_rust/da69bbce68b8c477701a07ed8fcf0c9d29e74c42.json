{"sha": "da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhNjliYmNlNjhiOGM0Nzc3MDFhMDdlZDhmY2YwYzlkMjllNzRjNDI=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-30T14:40:42Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-30T18:54:51Z"}, "message": "also reset anon-param-mode for `fn()` types", "tree": {"sha": "deec498df7324beb3ef538f7b63276d37c556587", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/deec498df7324beb3ef538f7b63276d37c556587"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "html_url": "https://github.com/rust-lang/rust/commit/da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da69bbce68b8c477701a07ed8fcf0c9d29e74c42/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9acb351f5756b58b053ca9b834664da971ac52f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/9acb351f5756b58b053ca9b834664da971ac52f2", "html_url": "https://github.com/rust-lang/rust/commit/9acb351f5756b58b053ca9b834664da971ac52f2"}], "stats": {"total": 52, "additions": 41, "deletions": 11}, "files": [{"sha": "6dd339ccdcc6bc0a7a370e369f1d231d023af990", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/da69bbce68b8c477701a07ed8fcf0c9d29e74c42/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da69bbce68b8c477701a07ed8fcf0c9d29e74c42/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "patch": "@@ -1033,17 +1033,22 @@ impl<'a> LoweringContext<'a> {\n                     _ => None,\n                 }),\n                 |this| {\n-                    hir::TyBareFn(P(hir::BareFnTy {\n-                        generic_params: this.lower_generic_params(\n-                            &f.generic_params,\n-                            &NodeMap(),\n-                            ImplTraitContext::Disallowed,\n-                        ),\n-                        unsafety: this.lower_unsafety(f.unsafety),\n-                        abi: f.abi,\n-                        decl: this.lower_fn_decl(&f.decl, None, false),\n-                        arg_names: this.lower_fn_args_to_names(&f.decl),\n-                    }))\n+                    this.with_anonymous_lifetime_mode(\n+                        AnonymousLifetimeMode::PassThrough,\n+                        |this| {\n+                            hir::TyBareFn(P(hir::BareFnTy {\n+                                generic_params: this.lower_generic_params(\n+                                    &f.generic_params,\n+                                    &NodeMap(),\n+                                    ImplTraitContext::Disallowed,\n+                                ),\n+                                unsafety: this.lower_unsafety(f.unsafety),\n+                                abi: f.abi,\n+                                decl: this.lower_fn_decl(&f.decl, None, false),\n+                                arg_names: this.lower_fn_args_to_names(&f.decl),\n+                            }))\n+                        },\n+                    )\n                 },\n             ),\n             TyKind::Never => hir::TyNever,"}, {"sha": "4a76d683d6e5033de72cef177c0e62674f5be8b1", "filename": "src/test/ui/rust-2018/issue-51008-1.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/da69bbce68b8c477701a07ed8fcf0c9d29e74c42/src%2Ftest%2Fui%2Frust-2018%2Fissue-51008-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da69bbce68b8c477701a07ed8fcf0c9d29e74c42/src%2Ftest%2Fui%2Frust-2018%2Fissue-51008-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fissue-51008-1.rs?ref=da69bbce68b8c477701a07ed8fcf0c9d29e74c42", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Regression test for #51008 -- the anonymous lifetime in `&i32` was\n+// being incorrectly considered part of the \"elided lifetimes\" from\n+// the impl.\n+//\n+// run-pass\n+\n+#![feature(rust_2018_preview)]\n+\n+trait A {\n+\n+}\n+\n+impl<F> A for F where F: PartialEq<fn(&i32)> { }\n+\n+fn main() {}"}]}