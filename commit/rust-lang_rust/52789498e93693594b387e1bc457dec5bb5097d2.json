{"sha": "52789498e93693594b387e1bc457dec5bb5097d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyNzg5NDk4ZTkzNjkzNTk0YjM4N2UxYmM0NTdkZWM1YmI1MDk3ZDI=", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-04-13T21:59:54Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2021-04-13T21:59:54Z"}, "message": "Split search.js from search-index.js.", "tree": {"sha": "04a847b4fb8abc82a9532ce3c4a9f28ab52126f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04a847b4fb8abc82a9532ce3c4a9f28ab52126f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52789498e93693594b387e1bc457dec5bb5097d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52789498e93693594b387e1bc457dec5bb5097d2", "html_url": "https://github.com/rust-lang/rust/commit/52789498e93693594b387e1bc457dec5bb5097d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52789498e93693594b387e1bc457dec5bb5097d2/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11f854db4fd100abda22662c26871a5f890c79d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/11f854db4fd100abda22662c26871a5f890c79d1", "html_url": "https://github.com/rust-lang/rust/commit/11f854db4fd100abda22662c26871a5f890c79d1"}], "stats": {"total": 21, "additions": 12, "deletions": 9}, "files": [{"sha": "2ab10d5e6aa4d7a2a1c8ab4154f7dbc76f485620", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=52789498e93693594b387e1bc457dec5bb5097d2", "patch": "@@ -113,7 +113,8 @@ crate fn render<T: Print, S: Print>(\n     <section class=\\\"footer\\\"></section>\\\n     {after_content}\\\n     <div id=\\\"rustdoc-vars\\\" data-root-path=\\\"{root_path}\\\" data-current-crate=\\\"{krate}\\\" \\\n-       data-search-js=\\\"{root_path}search-index{suffix}.js\\\"></div>\n+       data-search-index-js=\\\"{root_path}search-index{suffix}.js\\\" \\\n+       data-search-js=\\\"{root_path}search{suffix}.js\\\"></div>\n     <script src=\\\"{static_root_path}main{suffix}.js\\\"></script>\\\n     {extra_scripts}\\\n </body>\\"}, {"sha": "7a9d337d9638fc6b102de72eeaf3ef73235bed9b", "filename": "src/librustdoc/html/render/write_shared.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs?ref=52789498e93693594b387e1bc457dec5bb5097d2", "patch": "@@ -223,6 +223,7 @@ pub(super) fn write_shared(\n             &format!(\" = {}\", serde_json::to_string(&themes).unwrap()),\n         ),\n     )?;\n+    write_minify(\"search.js\", static_files::SEARCH_JS)?;\n     write_minify(\"settings.js\", static_files::SETTINGS_JS)?;\n     if cx.shared.include_sources {\n         write_minify(\"source-script.js\", static_files::sidebar::SOURCE_SCRIPT)?;\n@@ -408,8 +409,9 @@ pub(super) fn write_shared(\n     // with rustdoc running in parallel.\n     all_indexes.sort();\n     write_crate(\"search-index.js\", &|| {\n-        let v = static_files::SEARCH_JS\n-            .replace(r#\"\"SEARCH_INDEX_PLACEHOLDER\": {}\"#, &all_indexes.join(\",\\\\\\n\"));\n+        let mut v = String::from(\"var searchIndex = JSON.parse('{\\\\\\n\");\n+        v.push_str(&all_indexes.join(\",\\\\\\n\"));\n+        v.push_str(\"\\\\\\n}');\\nif (window.initSearch) {window.initSearch(searchIndex)};\");\n         Ok(v.into_bytes())\n     })?;\n "}, {"sha": "0162a6155870250af26f7d6debe39c344c9b1f47", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=52789498e93693594b387e1bc457dec5bb5097d2", "patch": "@@ -43,6 +43,7 @@ if (!DOMTokenList.prototype.remove) {\n         window.rootPath = rustdocVars.attributes[\"data-root-path\"].value;\n         window.currentCrate = rustdocVars.attributes[\"data-current-crate\"].value;\n         window.searchJS = rustdocVars.attributes[\"data-search-js\"].value;\n+        window.searchIndexJS = rustdocVars.attributes[\"data-search-index-js\"].value;\n     }\n     var sidebarVars = document.getElementById(\"sidebar-vars\");\n     if (sidebarVars) {\n@@ -247,6 +248,7 @@ function hideThemeButtonState() {\n             if (!searchLoaded) {\n                 searchLoaded = true;\n                 loadScript(window.searchJS);\n+                loadScript(window.searchIndexJS);\n             }\n         }\n "}, {"sha": "538c811c710971b2d840a631ba06a36026d41ace", "filename": "src/librustdoc/html/static/search.js", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/52789498e93693594b387e1bc457dec5bb5097d2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js?ref=52789498e93693594b387e1bc457dec5bb5097d2", "patch": "@@ -1,8 +1,4 @@\n (function() {\n-var searchIndex = JSON.parse('{\\\n-\"SEARCH_INDEX_PLACEHOLDER\": {}\\\n-}');\n-\n // This mapping table should match the discriminants of\n // `rustdoc::html::item_type::ItemType` type in Rust.\n var itemTypes = [\"mod\",\n@@ -104,7 +100,7 @@ function levenshtein(s1, s2) {\n     return s1_len + s2_len;\n }\n \n-function initSearch(rawSearchIndex) {\n+window.initSearch = function(rawSearchIndex) {\n     var MAX_LEV_DISTANCE = 3;\n     var MAX_RESULTS = 200;\n     var GENERICS_DATA = 1;\n@@ -1509,6 +1505,8 @@ function initSearch(rawSearchIndex) {\n     }\n };\n \n+if (window.searchIndex !== undefined) {\n+  initSearch(window.searchIndex);\n+}\n \n-initSearch(searchIndex);\n })();"}]}