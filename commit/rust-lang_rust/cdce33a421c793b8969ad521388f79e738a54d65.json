{"sha": "cdce33a421c793b8969ad521388f79e738a54d65", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkY2UzM2E0MjFjNzkzYjg5NjlhZDUyMTM4OGY3OWU3MzhhNTRkNjU=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-07-16T01:52:08Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-07-16T16:33:54Z"}, "message": "Add configure and make machinery to activate perf metrics and ratchets.", "tree": {"sha": "6bc70f53708a5d9dbab967896edd53b0a77f859f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6bc70f53708a5d9dbab967896edd53b0a77f859f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cdce33a421c793b8969ad521388f79e738a54d65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cdce33a421c793b8969ad521388f79e738a54d65", "html_url": "https://github.com/rust-lang/rust/commit/cdce33a421c793b8969ad521388f79e738a54d65", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cdce33a421c793b8969ad521388f79e738a54d65/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc4c89c10a02abda1c2c83b7fcde756c84913e5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc4c89c10a02abda1c2c83b7fcde756c84913e5f", "html_url": "https://github.com/rust-lang/rust/commit/bc4c89c10a02abda1c2c83b7fcde756c84913e5f"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "7138c395513ccd4407ccd77a4737c0c8450088df", "filename": "configure", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cdce33a421c793b8969ad521388f79e738a54d65/configure", "raw_url": "https://github.com/rust-lang/rust/raw/cdce33a421c793b8969ad521388f79e738a54d65/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=cdce33a421c793b8969ad521388f79e738a54d65", "patch": "@@ -372,6 +372,7 @@ opt optimize 1 \"build optimized rust code\"\n opt optimize-cxx 1 \"build optimized C++ code\"\n opt optimize-llvm 1 \"build optimized LLVM\"\n opt debug 0 \"build with extra debug fun\"\n+opt ratchet-bench 0 \"ratchet benchmarks\"\n opt fast-make 0 \"use .gitmodules as timestamp for submodule deps\"\n opt manage-submodules 1 \"let the build manage the git submodules\"\n opt mingw-cross 0 \"cross-compile for win32 using mingw\""}, {"sha": "625e2ea14619ec319678cc3f2b6ae1ed35a11a4a", "filename": "mk/tests.mk", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cdce33a421c793b8969ad521388f79e738a54d65/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/cdce33a421c793b8969ad521388f79e738a54d65/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=cdce33a421c793b8969ad521388f79e738a54d65", "patch": "@@ -60,6 +60,21 @@ endif\n TEST_LOG_FILE=tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n TEST_OK_FILE=tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).ok\n \n+TEST_RATCHET_FILE=tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4)-metrics.json\n+TEST_RATCHET_NOISE_PERCENT=10.0\n+\n+# Whether to ratchet or merely save benchmarks\n+ifdef CFG_RATCHET_BENCH\n+CRATE_TEST_BENCH_ARGS=\\\n+  --test --bench \\\n+  --ratchet-metrics $(call TEST_RATCHET_FILE,$(1),$(2),$(3),$(4)) \\\n+  --ratchet-noise-percent $(TEST_RATCHET_NOISE_PERCENT)\n+else\n+CRATE_TEST_BENCH_ARGS=\\\n+  --test --bench \\\n+  --save-metrics $(call TEST_RATCHET_FILE,$(1),$(2),$(3),$(4))\n+endif\n+\n define DEF_TARGET_COMMANDS\n \n ifdef CFG_UNIXY_$(1)\n@@ -359,11 +374,14 @@ $(foreach host,$(CFG_HOST_TRIPLES), \\\n define DEF_TEST_CRATE_RULES\n check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n \n+check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4))\n+\n $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$(3)/stage$(1)/test/$(4)test-$(2)$$(X_$(2))\n \t@$$(call E, run: $$<)\n \t$$(Q)$$(call CFG_RUN_TEST_$(2),$$<,$(2),$(3)) $$(TESTARGS)\t\\\n \t--logfile $$(call TEST_LOG_FILE,$(1),$(2),$(3),$(4)) \\\n+\t$$(call CRATE_TEST_BENCH_ARGS,$(1),$(2),$(3),$(4)) \\\n \t&& touch $$@\n endef\n \n@@ -552,6 +570,7 @@ CTEST_ARGS$(1)-T-$(2)-H-$(3)-$(4) := \\\n         $$(CTEST_COMMON_ARGS$(1)-T-$(2)-H-$(3))\t\\\n         --src-base $$(S)src/test/$$(CTEST_SRC_BASE_$(4))/ \\\n         --build-base $(3)/test/$$(CTEST_BUILD_BASE_$(4))/ \\\n+        --ratchet-metrics $(call TEST_RATCHET_FILE,$(1),$(2),$(3),$(4)) \\\n         --mode $$(CTEST_MODE_$(4)) \\\n \t$$(CTEST_RUNTOOL_$(4))\n "}]}