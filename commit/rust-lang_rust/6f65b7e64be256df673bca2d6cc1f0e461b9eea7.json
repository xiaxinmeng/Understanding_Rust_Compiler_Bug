{"sha": "6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "node_id": "C_kwDOAAsO6NoAKDZmNjViN2U2NGJlMjU2ZGY2NzNiY2EyZDZjYzFmMGU0NjFiOWVlYTc", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-06T11:09:39Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-06T11:09:39Z"}, "message": "suggest adding a missing zero to a floating point number", "tree": {"sha": "d640057cb65dcd338e86993ee3722d356948ad94", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d640057cb65dcd338e86993ee3722d356948ad94"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "html_url": "https://github.com/rust-lang/rust/commit/6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b8cf49c51833ee5d27ae2e8e179337dbb9f14d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b8cf49c51833ee5d27ae2e8e179337dbb9f14d7", "html_url": "https://github.com/rust-lang/rust/commit/5b8cf49c51833ee5d27ae2e8e179337dbb9f14d7"}], "stats": {"total": 73, "additions": 70, "deletions": 3}, "files": [{"sha": "a79257f0f5ebec46d425076f2057fa8dba4b0219", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "patch": "@@ -2162,14 +2162,31 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         } else if !expr_t.is_primitive_ty() {\n             self.ban_nonexisting_field(field, base, expr, expr_t);\n         } else {\n-            type_error_struct!(\n+            let field_name = field.to_string();\n+            let mut err = type_error_struct!(\n                 self.tcx().sess,\n                 field.span,\n                 expr_t,\n                 E0610,\n                 \"`{expr_t}` is a primitive type and therefore doesn't have fields\",\n-            )\n-            .emit();\n+            );\n+            if expr_t.is_integral()\n+                && (field_name\n+                    .strip_prefix('e')\n+                    .or_else(|| field_name.strip_prefix('E'))\n+                    .map(|prefix| prefix.chars().all(|c| c.is_numeric()))\n+                    .unwrap_or_default()\n+                    || field.name == sym::f32\n+                    || field.name == sym::f64)\n+            {\n+                err.span_suggestion_verbose(\n+                    field.span.shrink_to_lo(),\n+                    \"If the number is meant to be a floating point number, consider adding a `0` after the period\",\n+                    '0',\n+                    Applicability::MaybeIncorrect,\n+                );\n+            }\n+            err.emit();\n         }\n \n         self.tcx().ty_error()"}, {"sha": "01d3769c1f3b7b3432d99f067106bd37d29135d1", "filename": "src/test/ui/typeck/suggest-adding-missing-zero-to-floating-point-number.fixed", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.fixed?ref=6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "patch": "@@ -0,0 +1,7 @@\n+// run-rustfix\n+\n+fn main() {\n+    2.0e1; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+    2.0f32; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+    2.0f64; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+}"}, {"sha": "c2cbd5d518907eb769c5255f28ebccdb06a24dfa", "filename": "src/test/ui/typeck/suggest-adding-missing-zero-to-floating-point-number.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.rs?ref=6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "patch": "@@ -0,0 +1,7 @@\n+// run-rustfix\n+\n+fn main() {\n+    2.e1; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+    2.f32; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+    2.f64; //~ERROR `{integer}` is a primitive type and therefore doesn't have fields\n+}"}, {"sha": "042f9c727cc72a0ac6434c83f3816bd58f71de76", "filename": "src/test/ui/typeck/suggest-adding-missing-zero-to-floating-point-number.stderr", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6f65b7e64be256df673bca2d6cc1f0e461b9eea7/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fsuggest-adding-missing-zero-to-floating-point-number.stderr?ref=6f65b7e64be256df673bca2d6cc1f0e461b9eea7", "patch": "@@ -0,0 +1,36 @@\n+error[E0610]: `{integer}` is a primitive type and therefore doesn't have fields\n+  --> $DIR/suggest-adding-missing-zero-to-floating-point-number.rs:4:7\n+   |\n+LL |     2.e1;\n+   |       ^^\n+   |\n+help: If the number is meant to be a floating point number, consider adding a `0` after the period\n+   |\n+LL |     2.0e1;\n+   |       +\n+\n+error[E0610]: `{integer}` is a primitive type and therefore doesn't have fields\n+  --> $DIR/suggest-adding-missing-zero-to-floating-point-number.rs:5:7\n+   |\n+LL |     2.f32;\n+   |       ^^^\n+   |\n+help: If the number is meant to be a floating point number, consider adding a `0` after the period\n+   |\n+LL |     2.0f32;\n+   |       +\n+\n+error[E0610]: `{integer}` is a primitive type and therefore doesn't have fields\n+  --> $DIR/suggest-adding-missing-zero-to-floating-point-number.rs:6:7\n+   |\n+LL |     2.f64;\n+   |       ^^^\n+   |\n+help: If the number is meant to be a floating point number, consider adding a `0` after the period\n+   |\n+LL |     2.0f64;\n+   |       +\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0610`."}]}