{"sha": "46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2YThkY2VmNWM5ZTRkZTBkNDEyYzZhYzNjNDc2NWNiNGFlZjRmN2Y=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-04-22T01:34:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-22T01:34:07Z"}, "message": "Rollup merge of #71372 - ayushmishra2005:shebang_stripping, r=estebank\n\nFix #! (shebang) stripping account space issue\n\n #70528", "tree": {"sha": "03c82ba6efbedbca8c5ea2f63e030f1735cab92d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/03c82ba6efbedbca8c5ea2f63e030f1735cab92d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJen58PCRBK7hj4Ov3rIwAAdHIIAJpvt5AvY9eRusCUXahVTLSq\nAsIhyYMzxnqJtvVF8u6ZanjSlOCHCAWvr49uPe+kRpuDVAto1LZLpW5QLoxCiJuI\nz1Wxc9Y0LVx9UmY/TeSIFyMYi1EcSrvfl79obyv9pHsuu1AVUNZgxKxoJQUyfc+c\ndNIR4tB9CfkzGbpnL125+HkbrhHgDCrGgvYNBwocSNusMC1evkqMvYCR+u6XXsen\nqVvtPMDHv+moW+LV6v4gryTz0fi/s9zRe2UW/A6lE1gwZxaNVjQgy1pPAJralqtU\nar+imQsG5icuGiVGksDu6Absu/axi6tSbSky6iGOYBztABLBBkjqzLZQscQznsM=\n=4Y5O\n-----END PGP SIGNATURE-----\n", "payload": "tree 03c82ba6efbedbca8c5ea2f63e030f1735cab92d\nparent f28e3873c55eb4bdcfc496e1f300b97aeb0d189c\nparent 1b362cd1d5f09f0031b2ce1b161152422a397a67\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1587519247 +0900\ncommitter GitHub <noreply@github.com> 1587519247 +0900\n\nRollup merge of #71372 - ayushmishra2005:shebang_stripping, r=estebank\n\nFix #! (shebang) stripping account space issue\n\n #70528\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "html_url": "https://github.com/rust-lang/rust/commit/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f28e3873c55eb4bdcfc496e1f300b97aeb0d189c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f28e3873c55eb4bdcfc496e1f300b97aeb0d189c", "html_url": "https://github.com/rust-lang/rust/commit/f28e3873c55eb4bdcfc496e1f300b97aeb0d189c"}, {"sha": "1b362cd1d5f09f0031b2ce1b161152422a397a67", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b362cd1d5f09f0031b2ce1b161152422a397a67", "html_url": "https://github.com/rust-lang/rust/commit/1b362cd1d5f09f0031b2ce1b161152422a397a67"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "be85a34bd395a5842e40441203169d56960f6511", "filename": "src/librustc_lexer/src/lib.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f/src%2Flibrustc_lexer%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f/src%2Flibrustc_lexer%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lexer%2Fsrc%2Flib.rs?ref=46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "patch": "@@ -236,12 +236,17 @@ pub enum Base {\n /// (e.g. \"#![deny(missing_docs)]\").\n pub fn strip_shebang(input: &str) -> Option<usize> {\n     debug_assert!(!input.is_empty());\n-    if !input.starts_with(\"#!\") || input.starts_with(\"#![\") {\n+    let s: &str = &remove_whitespace(input);\n+    if !s.starts_with(\"#!\") || s.starts_with(\"#![\") {\n         return None;\n     }\n     Some(input.find('\\n').unwrap_or(input.len()))\n }\n \n+fn remove_whitespace(s: &str) -> String {\n+    s.chars().filter(|c| !c.is_whitespace()).collect()\n+}\n+\n /// Parses the first token from the provided input string.\n pub fn first_token(input: &str) -> Token {\n     debug_assert!(!input.is_empty());"}, {"sha": "065e8f3f646fb7184ad0ebc8c4ce017f24e394b9", "filename": "src/librustc_lexer/src/tests.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lexer%2Fsrc%2Ftests.rs?ref=46a8dcef5c9e4de0d412c6ac3c4765cb4aef4f7f", "patch": "@@ -145,4 +145,22 @@ mod tests {\n             }),\n         );\n     }\n+\n+    #[test]\n+    fn test_valid_shebang() {\n+        // https://github.com/rust-lang/rust/issues/70528\n+        let input = \"#!/usr/bin/rustrun\";\n+        let actual = strip_shebang(input);\n+        let expected: Option<usize> = Some(18);\n+        assert_eq!(expected, actual);\n+    }\n+\n+    #[test]\n+    fn test_invalid_shebang_valid_rust_syntax() {\n+        // https://github.com/rust-lang/rust/issues/70528\n+        let input = \"#!    [bad_attribute]\";\n+        let actual = strip_shebang(input);\n+        let expected: Option<usize> = None;\n+        assert_eq!(expected, actual);\n+    }\n }"}]}