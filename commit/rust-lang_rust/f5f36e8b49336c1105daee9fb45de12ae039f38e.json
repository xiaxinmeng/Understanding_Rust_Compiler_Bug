{"sha": "f5f36e8b49336c1105daee9fb45de12ae039f38e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1ZjM2ZThiNDkzMzZjMTEwNWRhZWU5ZmI0NWRlMTJhZTAzOWYzOGU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T21:19:26Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T21:44:09Z"}, "message": "rt: Allow console logging to be turned off", "tree": {"sha": "45b3c36841a28ca885964689553f3f8911074675", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45b3c36841a28ca885964689553f3f8911074675"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5f36e8b49336c1105daee9fb45de12ae039f38e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5f36e8b49336c1105daee9fb45de12ae039f38e", "html_url": "https://github.com/rust-lang/rust/commit/f5f36e8b49336c1105daee9fb45de12ae039f38e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5f36e8b49336c1105daee9fb45de12ae039f38e/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7150643588dac57db2292d98fc03ab11b2675758", "url": "https://api.github.com/repos/rust-lang/rust/commits/7150643588dac57db2292d98fc03ab11b2675758", "html_url": "https://github.com/rust-lang/rust/commit/7150643588dac57db2292d98fc03ab11b2675758"}], "stats": {"total": 47, "additions": 46, "deletions": 1}, "files": [{"sha": "4bf51da214bfcaa64b09e0122be2d89a961caf33", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=f5f36e8b49336c1105daee9fb45de12ae039f38e", "patch": "@@ -567,6 +567,21 @@ rust_set_exit_status(intptr_t code) {\n     task->kernel->set_exit_status((int)code);\n }\n \n+extern void log_console_on();\n+\n+extern \"C\" CDECL void\n+rust_log_console_on() {\n+    log_console_on();\n+}\n+\n+extern void log_console_off(rust_env *env);\n+\n+extern \"C\" CDECL void\n+rust_log_console_off() {\n+    rust_task *task = rust_scheduler::get_task();\n+    log_console_off(task->kernel->env);\n+}\n+\n //\n // Local Variables:\n // mode: C++"}, {"sha": "7119a64d2b879729ec569c774004d26aae3abf09", "filename": "src/rt/rust_log.cpp", "status": "modified", "additions": 29, "deletions": 1, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frust_log.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frust_log.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_log.cpp?ref=f5f36e8b49336c1105daee9fb45de12ae039f38e", "patch": "@@ -13,6 +13,32 @@\n  * Synchronizes access to the underlying logging mechanism.\n  */\n static lock_and_signal _log_lock;\n+/**\n+ * Indicates whether we are outputing to the console.\n+ * Protected by _log_lock;\n+ */\n+static bool _log_to_console = true;\n+\n+/*\n+ * Request that console logging be turned on.\n+ */\n+void\n+log_console_on() {\n+    scoped_lock with(_log_lock);\n+    _log_to_console = true;\n+}\n+\n+/*\n+ * Request that console logging be turned off. Can be\n+ * overridden by the environment.\n+ */\n+void\n+log_console_off(rust_env *env) {\n+    scoped_lock with(_log_lock);\n+    if (env->logspec == NULL) {\n+        _log_to_console = false;\n+    }\n+}\n \n rust_log::rust_log(rust_srv *srv, rust_scheduler *sched) :\n     _srv(srv),\n@@ -71,7 +97,9 @@ rust_log::trace_ln(char *prefix, char *message) {\n     _log_lock.lock();\n     append_string(buffer, \"%s\", prefix);\n     append_string(buffer, \"%s\", message);\n-    _srv->log(buffer);\n+    if (_log_to_console) {\n+        _srv->log(buffer);\n+    }\n     _log_lock.unlock();\n }\n "}, {"sha": "745e4c6e34b76873d6eb14b2a9bd44013b626626", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/f5f36e8b49336c1105daee9fb45de12ae039f38e/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=f5f36e8b49336c1105daee9fb45de12ae039f38e", "patch": "@@ -36,6 +36,8 @@ rust_get_stdout\n rust_get_stderr\n rust_str_push\n rust_list_files\n+rust_log_console_on\n+rust_log_console_off\n rust_port_detach\n rust_port_size\n rust_process_wait"}]}