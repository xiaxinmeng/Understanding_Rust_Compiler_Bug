{"sha": "d208e1943bd94f0646dbb6fdc1a14d1973bf63a5", "node_id": "C_kwDOAAsO6NoAKGQyMDhlMTk0M2JkOTRmMDY0NmRiYjZmZGMxYTE0ZDE5NzNiZjYzYTU", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2021-11-01T21:16:25Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2021-11-10T16:35:42Z"}, "message": "Fix a crash with wasm64 in LLVM\n\nThis commit works around a crash in LLVM when the\n`-generate-arange-section` argument is passed to LLVM. An LLVM bug is\nopened for this and the code in question is also set to continue passing\nthis flag with LLVM 14, assuming that this is fixed by the time LLVM 14\ncomes out. Otherwise this should work around debuginfo crashes on LLVM\n13.", "tree": {"sha": "3b0c75edf1d6f4712cbfd1dd16baea1a786772c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b0c75edf1d6f4712cbfd1dd16baea1a786772c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5", "html_url": "https://github.com/rust-lang/rust/commit/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "caa9e4a2d0feaee53df67677a190edab95c996af", "url": "https://api.github.com/repos/rust-lang/rust/commits/caa9e4a2d0feaee53df67677a190edab95c996af", "html_url": "https://github.com/rust-lang/rust/commit/caa9e4a2d0feaee53df67677a190edab95c996af"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "35a3d21036a14d1aaa7622f6f04ea50f76a97bfb", "filename": "compiler/rustc_codegen_llvm/src/llvm_util.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d208e1943bd94f0646dbb6fdc1a14d1973bf63a5/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs?ref=d208e1943bd94f0646dbb6fdc1a14d1973bf63a5", "patch": "@@ -75,7 +75,15 @@ unsafe fn configure_llvm(sess: &Session) {\n         if sess.print_llvm_passes() {\n             add(\"-debug-pass=Structure\", false);\n         }\n-        if !sess.opts.debugging_opts.no_generate_arange_section {\n+        if !sess.opts.debugging_opts.no_generate_arange_section\n+            // FIXME: An LLVM bug [1] means that if this option is enabled for\n+            // wasm64 then LLVM will crash when generating debuginfo. Assuming\n+            // that this gets fixed in LLVM 14 this condition here is a\n+            // workaround to work with versions of LLVM 13 and prior.\n+            //\n+            // [1]: https://bugs.llvm.org/show_bug.cgi?id=52376\n+            && (sess.target.arch != \"wasm64\" || llvm_util::get_version() >= (14, 0, 0))\n+        {\n             add(\"-generate-arange-section\", false);\n         }\n "}]}