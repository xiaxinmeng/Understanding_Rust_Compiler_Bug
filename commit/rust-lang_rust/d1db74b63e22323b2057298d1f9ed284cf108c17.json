{"sha": "d1db74b63e22323b2057298d1f9ed284cf108c17", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxZGI3NGI2M2UyMjMyM2IyMDU3Mjk4ZDFmOWVkMjg0Y2YxMDhjMTc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-04-20T15:35:03Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-04-26T13:58:50Z"}, "message": "appveyor: Upgrade to gcc for mingw 6.3.0\n\nThis commit sort of brings back #40777 by upgrading back to 6.3.0. While\ninvestigating #40546 it was discovered that 6.3.0 appears to not spurious\nfail in the same way that 6.2.0 does (which we're currently using). The\nworkaround for #40184 contained in #40777 did not work so this commit also\ncontains a different workaround for the gdb issue. We will not download the\n6.2.0 version of gdb and use that instead of the default version that comes with\n6.3.0.\n\nI'm going to optimistically say...\n\nCloses #40546", "tree": {"sha": "87bb2ffb0ad7577bbf5297bbdae5cd85c0d03df8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87bb2ffb0ad7577bbf5297bbdae5cd85c0d03df8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d1db74b63e22323b2057298d1f9ed284cf108c17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d1db74b63e22323b2057298d1f9ed284cf108c17", "html_url": "https://github.com/rust-lang/rust/commit/d1db74b63e22323b2057298d1f9ed284cf108c17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d1db74b63e22323b2057298d1f9ed284cf108c17/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b4c911581099e247a68b3a8adc782d778f5190b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b4c911581099e247a68b3a8adc782d778f5190b", "html_url": "https://github.com/rust-lang/rust/commit/2b4c911581099e247a68b3a8adc782d778f5190b"}], "stats": {"total": 28, "additions": 24, "deletions": 4}, "files": [{"sha": "c662ba03602549485ff48ffb57c802f9e08b67fd", "filename": "appveyor.yml", "status": "modified", "additions": 24, "deletions": 4, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/d1db74b63e22323b2057298d1f9ed284cf108c17/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d1db74b63e22323b2057298d1f9ed284cf108c17/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=d1db74b63e22323b2057298d1f9ed284cf108c17", "patch": "@@ -35,13 +35,13 @@ environment:\n     RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-ninja\n     SCRIPT: python x.py test\n     MINGW_URL: https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror\n-    MINGW_ARCHIVE: i686-6.2.0-release-posix-dwarf-rt_v5-rev1.7z\n+    MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n     MINGW_DIR: mingw32\n   - MSYS_BITS: 64\n     SCRIPT: python x.py test\n     RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-ninja\n     MINGW_URL: https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror\n-    MINGW_ARCHIVE: x86_64-6.2.0-release-posix-seh-rt_v5-rev1.7z\n+    MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n     MINGW_DIR: mingw64\n \n   # 32/64 bit MSVC and GNU deployment\n@@ -60,14 +60,14 @@ environment:\n     RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-extended --enable-ninja\n     SCRIPT: python x.py dist\n     MINGW_URL: https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror\n-    MINGW_ARCHIVE: i686-6.2.0-release-posix-dwarf-rt_v5-rev1.7z\n+    MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n     MINGW_DIR: mingw32\n     DEPLOY: 1\n   - MSYS_BITS: 64\n     SCRIPT: python x.py dist\n     RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-extended --enable-ninja\n     MINGW_URL: https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror\n-    MINGW_ARCHIVE: x86_64-6.2.0-release-posix-seh-rt_v5-rev1.7z\n+    MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n     MINGW_DIR: mingw64\n     DEPLOY: 1\n \n@@ -96,6 +96,26 @@ install:\n   - if defined MINGW_URL 7z x -y %MINGW_ARCHIVE% > nul\n   - if defined MINGW_URL set PATH=%CD%\\%MINGW_DIR%\\bin;C:\\msys64\\usr\\bin;%PATH%\n \n+  # Here we do a pretty heinous thing which is to mangle the MinGW installation\n+  # we just had above. Currently, as of this writing, we're using MinGW-w64\n+  # builds of gcc, and that's currently at 6.3.0. We use 6.3.0 as it appears to\n+  # be the first version which contains a fix for #40546, builds randomly\n+  # failing during LLVM due to ar.exe/ranlib.exe failures.\n+  #\n+  # Unfortunately, though, 6.3.0 *also* is the first version of MinGW-w64 builds\n+  # to contain a regression in gdb (#40184). As a result if we were to use the\n+  # gdb provided (7.11.1) then we would fail all debuginfo tests.\n+  #\n+  # In order to fix spurious failures (pretty high priority) we use 6.3.0. To\n+  # avoid disabling gdb tests we download an *old* version of gdb, specifically\n+  # that found inside the 6.2.0 distribution. We then overwrite the 6.3.0 gdb\n+  # with the 6.2.0 gdb to get tests passing.\n+  #\n+  # Note that we don't literally overwrite the gdb.exe binary because it appears\n+  # to just use gdborig.exe, so that's the binary we deal with instead.\n+  - if defined MINGW_URL appveyor-retry appveyor DownloadFile %MINGW_URL%/2017-04-20-%MSYS_BITS%bit-gdborig.exe\n+  - if defined MINGW_URL mv 2017-04-20-%MSYS_BITS%bit-gdborig.exe %MINGW_DIR%\\bin\\gdborig.exe\n+\n   # Otherwise pull in the MinGW installed on appveyor\n   - if NOT defined MINGW_URL set PATH=C:\\msys64\\mingw%MSYS_BITS%\\bin;C:\\msys64\\usr\\bin;%PATH%\n "}]}