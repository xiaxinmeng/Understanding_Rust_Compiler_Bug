{"sha": "84f7991bf4152f4f17f5a5f30405220bf9513a4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0Zjc5OTFiZjQxNTJmNGYxN2Y1YTVmMzA0MDUyMjBiZjk1MTNhNGI=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2020-08-14T01:00:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-14T01:00:15Z"}, "message": "Rollup merge of #75462 - Mark-Simulacrum:clean-queries, r=petrochenkov\n\nRemove unused tcx parameter\n\nWe shouldn't need access to a query context when storing already computed values.", "tree": {"sha": "8f7bb3bcabca3795fced05ab941df89112fa436c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f7bb3bcabca3795fced05ab941df89112fa436c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84f7991bf4152f4f17f5a5f30405220bf9513a4b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfNeIfCRBK7hj4Ov3rIwAAdHIIAAWUq5A6j+ajNmFTL9OimDHm\n1ZqOfwBofqsByDtp0oC0bdtu7GoTQ8AmNR2srdbwVusabg8xTQUqjWheiNj/zqXy\n6IjJFKUADqUuCncZWDXbzxDvkntoKo4sz/KWpXcpFc6lX5ZRtUMtl5TJFuAv4N0g\nbJZWpXbUFkq7UFBFnGt4v+EeOpUSxUahd5+kl79WR1BDVEEWTvaBsH4G5h32gk9n\n7WXTku8sWJDs64OJSOD3SzVv+/HoggyhO9lulXbac08vsM5DNqGneZVwsh2enBxf\nuhS57ju3+v+WRBGPGRajxEJPgFRDWxMxJEvxExn5wReCrDJ02iVYB9TbfYQe8HM=\n=GVeF\n-----END PGP SIGNATURE-----\n", "payload": "tree 8f7bb3bcabca3795fced05ab941df89112fa436c\nparent c76259a937318192d9ed47bd8f7ab1a49a175f23\nparent bff104d4db7ce785dc931a58d88d1dea891efecb\nauthor Tyler Mandry <tmandry@gmail.com> 1597366815 -0700\ncommitter GitHub <noreply@github.com> 1597366815 -0700\n\nRollup merge of #75462 - Mark-Simulacrum:clean-queries, r=petrochenkov\n\nRemove unused tcx parameter\n\nWe shouldn't need access to a query context when storing already computed values.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84f7991bf4152f4f17f5a5f30405220bf9513a4b", "html_url": "https://github.com/rust-lang/rust/commit/84f7991bf4152f4f17f5a5f30405220bf9513a4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84f7991bf4152f4f17f5a5f30405220bf9513a4b/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c76259a937318192d9ed47bd8f7ab1a49a175f23", "url": "https://api.github.com/repos/rust-lang/rust/commits/c76259a937318192d9ed47bd8f7ab1a49a175f23", "html_url": "https://github.com/rust-lang/rust/commit/c76259a937318192d9ed47bd8f7ab1a49a175f23"}, {"sha": "bff104d4db7ce785dc931a58d88d1dea891efecb", "url": "https://api.github.com/repos/rust-lang/rust/commits/bff104d4db7ce785dc931a58d88d1dea891efecb", "html_url": "https://github.com/rust-lang/rust/commit/bff104d4db7ce785dc931a58d88d1dea891efecb"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "1839e1af45eeff7d004dc1bacc5efbacec42a89e", "filename": "src/librustc_query_system/query/caches.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/84f7991bf4152f4f17f5a5f30405220bf9513a4b/src%2Flibrustc_query_system%2Fquery%2Fcaches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84f7991bf4152f4f17f5a5f30405220bf9513a4b/src%2Flibrustc_query_system%2Fquery%2Fcaches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fquery%2Fcaches.rs?ref=84f7991bf4152f4f17f5a5f30405220bf9513a4b", "patch": "@@ -43,9 +43,8 @@ pub trait QueryCache: QueryStorage {\n         OnHit: FnOnce(&Self::Stored, DepNodeIndex) -> R,\n         OnMiss: FnOnce(Self::Key, QueryLookup<'_, CTX, Self::Key, Self::Sharded>) -> R;\n \n-    fn complete<CTX: QueryContext>(\n+    fn complete(\n         &self,\n-        tcx: CTX,\n         lock_sharded_storage: &mut Self::Sharded,\n         key: Self::Key,\n         value: Self::Value,\n@@ -112,9 +111,8 @@ impl<K: Eq + Hash, V: Clone> QueryCache for DefaultCache<K, V> {\n     }\n \n     #[inline]\n-    fn complete<CTX: QueryContext>(\n+    fn complete(\n         &self,\n-        _: CTX,\n         lock_sharded_storage: &mut Self::Sharded,\n         key: K,\n         value: V,\n@@ -195,9 +193,8 @@ impl<'tcx, K: Eq + Hash, V: 'tcx> QueryCache for ArenaCache<'tcx, K, V> {\n     }\n \n     #[inline]\n-    fn complete<CTX: QueryContext>(\n+    fn complete(\n         &self,\n-        _: CTX,\n         lock_sharded_storage: &mut Self::Sharded,\n         key: K,\n         value: V,"}, {"sha": "ae042cc808126bec5a2085fd74399789368d412a", "filename": "src/librustc_query_system/query/plumbing.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/84f7991bf4152f4f17f5a5f30405220bf9513a4b/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84f7991bf4152f4f17f5a5f30405220bf9513a4b/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs?ref=84f7991bf4152f4f17f5a5f30405220bf9513a4b", "patch": "@@ -264,7 +264,7 @@ where\n     /// Completes the query by updating the query cache with the `result`,\n     /// signals the waiter and forgets the JobOwner, so it won't poison the query\n     #[inline(always)]\n-    fn complete(self, tcx: CTX, result: C::Value, dep_node_index: DepNodeIndex) -> C::Stored {\n+    fn complete(self, result: C::Value, dep_node_index: DepNodeIndex) -> C::Stored {\n         // We can move out of `self` here because we `mem::forget` it below\n         let key = unsafe { ptr::read(&self.key) };\n         let state = self.state;\n@@ -278,7 +278,7 @@ where\n                 QueryResult::Started(job) => job,\n                 QueryResult::Poisoned => panic!(),\n             };\n-            let result = state.cache.complete(tcx, &mut lock.cache, key, result, dep_node_index);\n+            let result = state.cache.complete(&mut lock.cache, key, result, dep_node_index);\n             (job, result)\n         };\n \n@@ -432,7 +432,7 @@ where\n             tcx.store_diagnostics_for_anon_node(dep_node_index, diagnostics);\n         }\n \n-        return job.complete(tcx, result, dep_node_index);\n+        return job.complete(result, dep_node_index);\n     }\n \n     let dep_node = query.to_dep_node(tcx, &key);\n@@ -458,7 +458,7 @@ where\n             })\n         });\n         if let Some((result, dep_node_index)) = loaded {\n-            return job.complete(tcx, result, dep_node_index);\n+            return job.complete(result, dep_node_index);\n         }\n     }\n \n@@ -609,7 +609,7 @@ where\n         }\n     }\n \n-    let result = job.complete(tcx, result, dep_node_index);\n+    let result = job.complete(result, dep_node_index);\n \n     (result, dep_node_index)\n }"}]}