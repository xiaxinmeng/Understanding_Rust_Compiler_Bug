{"sha": "fe2566777dae60b21fbea9173e6f31881da78ffb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlMjU2Njc3N2RhZTYwYjIxZmJlYTkxNzNlNmYzMTg4MWRhNzhmZmI=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-08-23T02:20:08Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-08-23T02:20:42Z"}, "message": "Use swap_remove in pipes::select(). Close #3219.", "tree": {"sha": "af324807ba6a3b1e451b6ae45299709bed106106", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af324807ba6a3b1e451b6ae45299709bed106106"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe2566777dae60b21fbea9173e6f31881da78ffb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe2566777dae60b21fbea9173e6f31881da78ffb", "html_url": "https://github.com/rust-lang/rust/commit/fe2566777dae60b21fbea9173e6f31881da78ffb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe2566777dae60b21fbea9173e6f31881da78ffb/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "20773f33f522ac7686e0ac7271332646e9944938", "url": "https://api.github.com/repos/rust-lang/rust/commits/20773f33f522ac7686e0ac7271332646e9944938", "html_url": "https://github.com/rust-lang/rust/commit/20773f33f522ac7686e0ac7271332646e9944938"}], "stats": {"total": 32, "additions": 9, "deletions": 23}, "files": [{"sha": "2a7dbd61f9c1d48a624ee1c1adc70084fc871485", "filename": "src/libcore/pipes.rs", "status": "modified", "additions": 8, "deletions": 23, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/fe2566777dae60b21fbea9173e6f31881da78ffb/src%2Flibcore%2Fpipes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe2566777dae60b21fbea9173e6f31881da78ffb/src%2Flibcore%2Fpipes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fpipes.rs?ref=fe2566777dae60b21fbea9173e6f31881da78ffb", "patch": "@@ -666,12 +666,10 @@ fn select2<A: send, Ab: send, B: send, Bb: send>(\n {\n     let i = wait_many([a.header(), b.header()]/_);\n \n-    unsafe {\n-        match i {\n-          0 => Left((try_recv(a), b)),\n-          1 => Right((a, try_recv(b))),\n-          _ => fail ~\"select2 return an invalid packet\"\n-        }\n+    match i {\n+      0 => Left((try_recv(a), b)),\n+      1 => Right((a, try_recv(b))),\n+      _ => fail ~\"select2 return an invalid packet\"\n     }\n }\n \n@@ -706,17 +704,9 @@ fn select<T: send, Tb: send>(+endpoints: ~[recv_packet_buffered<T, Tb>])\n     -> (uint, option<T>, ~[recv_packet_buffered<T, Tb>])\n {\n     let ready = wait_many(endpoints.map(|p| p.header()));\n-    let mut remaining = ~[];\n-    let mut result = none;\n-    do vec::consume(endpoints) |i, p| {\n-        if i == ready {\n-            result = try_recv(p);\n-        }\n-        else {\n-            vec::push(remaining, p);\n-        }\n-    }\n-\n+    let mut remaining = endpoints;\n+    let port = vec::swap_remove(remaining, ready);\n+    let result = try_recv(port);\n     (ready, result, remaining)\n }\n \n@@ -1054,12 +1044,7 @@ struct PortSet<T: send> : recv<T> {\n                 }\n                 none => {\n                     // Remove this port.\n-                    let mut ports_ = ~[];\n-                    ports <-> ports_;\n-                    vec::consume(ports_,\n-                                 |j, x| if i != j {\n-                                     vec::push(ports, x)\n-                                 });\n+                    let _ = vec::swap_remove(ports, i);\n                 }\n             }\n         }"}, {"sha": "daf36b21e6f53cb3ca4ad993010233e7c4e43211", "filename": "src/libcore/vec.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe2566777dae60b21fbea9173e6f31881da78ffb/src%2Flibcore%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe2566777dae60b21fbea9173e6f31881da78ffb/src%2Flibcore%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fvec.rs?ref=fe2566777dae60b21fbea9173e6f31881da78ffb", "patch": "@@ -36,6 +36,7 @@ export rsplitn;\n export shift;\n export unshift;\n export pop;\n+export swap_remove;\n export push, push_all, push_all_move;\n export grow;\n export grow_fn;"}]}