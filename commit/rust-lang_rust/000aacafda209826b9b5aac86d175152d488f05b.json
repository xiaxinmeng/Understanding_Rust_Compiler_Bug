{"sha": "000aacafda209826b9b5aac86d175152d488f05b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwMGFhY2FmZGEyMDk4MjZiOWI1YWFjODZkMTc1MTUyZDQ4OGYwNWI=", "commit": {"author": {"name": "gfreezy", "email": "gfreezy@gmail.com", "date": "2018-12-23T15:50:11Z"}, "committer": {"name": "gfreezy", "email": "gfreezy@gmail.com", "date": "2018-12-23T15:50:11Z"}, "message": "resolved #324: remove unnecessary braces in use statement.", "tree": {"sha": "63a65fe01d798d1a5dc1e039e38ce23bb46f139e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/63a65fe01d798d1a5dc1e039e38ce23bb46f139e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/000aacafda209826b9b5aac86d175152d488f05b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/000aacafda209826b9b5aac86d175152d488f05b", "html_url": "https://github.com/rust-lang/rust/commit/000aacafda209826b9b5aac86d175152d488f05b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/000aacafda209826b9b5aac86d175152d488f05b/comments", "author": {"login": "gfreezy", "id": 510012, "node_id": "MDQ6VXNlcjUxMDAxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/510012?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gfreezy", "html_url": "https://github.com/gfreezy", "followers_url": "https://api.github.com/users/gfreezy/followers", "following_url": "https://api.github.com/users/gfreezy/following{/other_user}", "gists_url": "https://api.github.com/users/gfreezy/gists{/gist_id}", "starred_url": "https://api.github.com/users/gfreezy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gfreezy/subscriptions", "organizations_url": "https://api.github.com/users/gfreezy/orgs", "repos_url": "https://api.github.com/users/gfreezy/repos", "events_url": "https://api.github.com/users/gfreezy/events{/privacy}", "received_events_url": "https://api.github.com/users/gfreezy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gfreezy", "id": 510012, "node_id": "MDQ6VXNlcjUxMDAxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/510012?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gfreezy", "html_url": "https://github.com/gfreezy", "followers_url": "https://api.github.com/users/gfreezy/followers", "following_url": "https://api.github.com/users/gfreezy/following{/other_user}", "gists_url": "https://api.github.com/users/gfreezy/gists{/gist_id}", "starred_url": "https://api.github.com/users/gfreezy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gfreezy/subscriptions", "organizations_url": "https://api.github.com/users/gfreezy/orgs", "repos_url": "https://api.github.com/users/gfreezy/repos", "events_url": "https://api.github.com/users/gfreezy/events{/privacy}", "received_events_url": "https://api.github.com/users/gfreezy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d77520fde3c953968beb09a3da80a0e7b17bbc04", "url": "https://api.github.com/repos/rust-lang/rust/commits/d77520fde3c953968beb09a3da80a0e7b17bbc04", "html_url": "https://github.com/rust-lang/rust/commit/d77520fde3c953968beb09a3da80a0e7b17bbc04"}], "stats": {"total": 55, "additions": 53, "deletions": 2}, "files": [{"sha": "48676f2e8b015149c7f3eb0f2cf6b3e461f6ff84", "filename": "crates/ra_editor/src/lib.rs", "status": "modified", "additions": 53, "deletions": 2, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/000aacafda209826b9b5aac86d175152d488f05b/crates%2Fra_editor%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/000aacafda209826b9b5aac86d175152d488f05b/crates%2Fra_editor%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Flib.rs?ref=000aacafda209826b9b5aac86d175152d488f05b", "patch": "@@ -31,10 +31,17 @@ pub struct HighlightedRange {\n     pub tag: &'static str,\n }\n \n+#[derive(Debug, Copy, Clone)]\n+pub enum Severity {\n+    Error,\n+    Warning\n+}\n+\n #[derive(Debug)]\n pub struct Diagnostic {\n     pub range: TextRange,\n     pub msg: String,\n+    pub severity: Severity,\n }\n \n #[derive(Debug)]\n@@ -97,13 +104,36 @@ pub fn diagnostics(file: &SourceFileNode) -> Vec<Diagnostic> {\n         }\n     }\n \n-    file.errors()\n+    let mut errors: Vec<Diagnostic> = file.errors()\n         .into_iter()\n         .map(|err| Diagnostic {\n             range: location_to_range(err.location()),\n             msg: format!(\"Syntax Error: {}\", err),\n+            severity: Severity::Error,\n         })\n-        .collect()\n+        .collect();\n+\n+    let warnings = check_unnecessary_braces_in_use_statement(file);\n+\n+    errors.extend(warnings);\n+    errors\n+}\n+\n+fn check_unnecessary_braces_in_use_statement(file: &SourceFileNode) -> Vec<Diagnostic> {\n+    let mut diagnostics = Vec::new();\n+    for node in file.syntax().descendants() {\n+        if let Some(use_tree_list) = ast::UseTreeList::cast(node) {\n+            if use_tree_list.use_trees().count() <= 1 {\n+                diagnostics.push(Diagnostic {\n+                    range: use_tree_list.syntax().range(),\n+                    msg: format!(\"Unnecessary braces in use statement\"),\n+                    severity: Severity::Warning,\n+                })\n+            }\n+        }\n+    }\n+\n+    diagnostics\n }\n \n pub fn syntax_tree(file: &SourceFileNode) -> String {\n@@ -204,4 +234,25 @@ fn test_foo() {}\n \n         do_check(\"struct Foo { a: i32, }<|>\", \"struct Foo <|>{ a: i32, }\");\n     }\n+\n+    #[test]\n+    fn test_check_unnecessary_braces_in_use_statement() {\n+        let file = SourceFileNode::parse(\n+            r#\"\n+use a;\n+use {b};\n+use a::{c};\n+use a::{c, d::e};\n+use a::{c, d::{e}};\n+fn main() {}\n+\"#,\n+        );\n+        let diagnostics = check_unnecessary_braces_in_use_statement(&file);\n+        assert_eq_dbg(\n+            r#\"[Diagnostic { range: [12; 15), msg: \"Unnecessary braces in use statement\", severity: Warning },\n+                Diagnostic { range: [24; 27), msg: \"Unnecessary braces in use statement\", severity: Warning },\n+                Diagnostic { range: [61; 64), msg: \"Unnecessary braces in use statement\", severity: Warning }]\"#,\n+            &diagnostics,\n+        )\n+    }\n }"}]}