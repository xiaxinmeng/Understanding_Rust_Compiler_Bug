{"sha": "43d26b1f35401c9341154192db000db456ee5ca2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQzZDI2YjFmMzU0MDFjOTM0MTE1NDE5MmRiMDAwZGI0NTZlZTVjYTI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-29T01:22:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-29T01:22:04Z"}, "message": "Auto merge of #57006 - GuillaumeGomez:no-crate-filter, r=QuietMisdreavus\n\nAdd no-crate filter option on rustdoc\n\n@onur asked me about it so here it is!\n\nr? @QuietMisdreavus", "tree": {"sha": "a48df1c81765c10012451af6768ee0a166a3d254", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a48df1c81765c10012451af6768ee0a166a3d254"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/43d26b1f35401c9341154192db000db456ee5ca2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/43d26b1f35401c9341154192db000db456ee5ca2", "html_url": "https://github.com/rust-lang/rust/commit/43d26b1f35401c9341154192db000db456ee5ca2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/43d26b1f35401c9341154192db000db456ee5ca2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9e3edb74bb52d3d60d48dc956319c68f7f2805c", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9e3edb74bb52d3d60d48dc956319c68f7f2805c", "html_url": "https://github.com/rust-lang/rust/commit/d9e3edb74bb52d3d60d48dc956319c68f7f2805c"}, {"sha": "dbcf68951c564f946ab0021c7699ea1a4bf861d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbcf68951c564f946ab0021c7699ea1a4bf861d0", "html_url": "https://github.com/rust-lang/rust/commit/dbcf68951c564f946ab0021c7699ea1a4bf861d0"}], "stats": {"total": 97, "additions": 78, "deletions": 19}, "files": [{"sha": "d99136802514d5c7f6cd56c4cc7d5e32bcdaef34", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -185,6 +185,9 @@ pub struct RenderOptions {\n     /// If present, playground URL to use in the \"Run\" button added to code samples generated from\n     /// standalone Markdown files. If not present, `playground_url` is used.\n     pub markdown_playground_url: Option<String>,\n+    /// If false, the `select` element to have search filtering by crates on rendered docs\n+    /// won't be generated.\n+    pub generate_search_filter: bool,\n }\n \n impl Options {\n@@ -427,6 +430,7 @@ impl Options {\n         let crate_version = matches.opt_str(\"crate-version\");\n         let enable_index_page = matches.opt_present(\"enable-index-page\") || index_page.is_some();\n         let static_root_path = matches.opt_str(\"static-root-path\");\n+        let generate_search_filter = !matches.opt_present(\"disable-per-crate-search\");\n \n         let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n \n@@ -469,6 +473,7 @@ impl Options {\n                 markdown_no_toc,\n                 markdown_css,\n                 markdown_playground_url,\n+                generate_search_filter,\n             }\n         })\n     }"}, {"sha": "987cec6fbfa962f9a106e543941154a8cd49b20e", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 17, "deletions": 8, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -25,10 +25,15 @@ pub struct Page<'a> {\n }\n \n pub fn render<T: fmt::Display, S: fmt::Display>(\n-    dst: &mut dyn io::Write, layout: &Layout, page: &Page, sidebar: &S, t: &T,\n-    css_file_extension: bool, themes: &[PathBuf])\n-    -> io::Result<()>\n-{\n+    dst: &mut dyn io::Write,\n+    layout: &Layout,\n+    page: &Page,\n+    sidebar: &S,\n+    t: &T,\n+    css_file_extension: bool,\n+    themes: &[PathBuf],\n+    generate_search_filter: bool,\n+) -> io::Result<()> {\n     let static_root_path = page.static_root_path.unwrap_or(page.root_path);\n     write!(dst,\n \"<!DOCTYPE html>\\\n@@ -81,10 +86,7 @@ pub fn render<T: fmt::Display, S: fmt::Display>(\n     <nav class=\\\"sub\\\">\\\n         <form class=\\\"search-form js-only\\\">\\\n             <div class=\\\"search-container\\\">\\\n-                <div>\\\n-                    <select id=\\\"crate-search\\\">\\\n-                        <option value=\\\"All crates\\\">All crates</option>\\\n-                    </select>\\\n+                <div>{filter_crates}\\\n                     <input class=\\\"search-input\\\" name=\\\"search\\\" \\\n                            autocomplete=\\\"off\\\" \\\n                            spellcheck=\\\"false\\\" \\\n@@ -214,6 +216,13 @@ pub fn render<T: fmt::Display, S: fmt::Display>(\n                 root_path=page.root_path,\n                 extra_script=e)\n     }).collect::<String>(),\n+    filter_crates=if generate_search_filter {\n+        \"<select id=\\\"crate-search\\\">\\\n+            <option value=\\\"All crates\\\">All crates</option>\\\n+        </select>\"\n+    } else {\n+        \"\"\n+    },\n     )\n }\n "}, {"sha": "184d5b24d6e12cadd2c933d342cf0a33cf5b9957", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -133,6 +133,9 @@ struct SharedContext {\n     /// Optional path string to be used to load static files on output pages. If not set, uses\n     /// combinations of `../` to reach the documentation root.\n     pub static_root_path: Option<String>,\n+    /// If false, the `select` element to have search filtering by crates on rendered docs\n+    /// won't be generated.\n+    pub generate_search_filter: bool,\n }\n \n impl SharedContext {\n@@ -500,6 +503,7 @@ pub fn run(mut krate: clean::Crate,\n         extern_html_root_urls,\n         resource_suffix,\n         static_root_path,\n+        generate_search_filter,\n         ..\n     } = options;\n \n@@ -528,6 +532,7 @@ pub fn run(mut krate: clean::Crate,\n         themes,\n         resource_suffix,\n         static_root_path,\n+        generate_search_filter,\n     };\n \n     // If user passed in `--playground-url` arg, we fill in crate name here\n@@ -1099,7 +1104,8 @@ themePicker.onblur = handleThemeButtonsBlur;\n             try_err!(layout::render(&mut w, &cx.shared.layout,\n                                     &page, &(\"\"), &content,\n                                     cx.shared.css_file_extension.is_some(),\n-                                    &cx.shared.themes), &dst);\n+                                    &cx.shared.themes,\n+                                    cx.shared.generate_search_filter), &dst);\n             try_err!(w.flush(), &dst);\n         }\n     }\n@@ -1372,7 +1378,8 @@ impl<'a> SourceCollector<'a> {\n         layout::render(&mut w, &self.scx.layout,\n                        &page, &(\"\"), &Source(contents),\n                        self.scx.css_file_extension.is_some(),\n-                       &self.scx.themes)?;\n+                       &self.scx.themes,\n+                       self.scx.generate_search_filter)?;\n         w.flush()?;\n         self.scx.local_sources.insert(p.clone(), href);\n         Ok(())\n@@ -1974,7 +1981,8 @@ impl Context {\n         try_err!(layout::render(&mut w, &self.shared.layout,\n                                 &page, &sidebar, &all,\n                                 self.shared.css_file_extension.is_some(),\n-                                &self.shared.themes),\n+                                &self.shared.themes,\n+                                self.shared.generate_search_filter),\n                  &final_file);\n \n         // Generating settings page.\n@@ -1994,7 +2002,8 @@ impl Context {\n         try_err!(layout::render(&mut w, &layout,\n                                 &page, &sidebar, &settings,\n                                 self.shared.css_file_extension.is_some(),\n-                                &themes),\n+                                &themes,\n+                                self.shared.generate_search_filter),\n                  &settings_file);\n \n         Ok(())\n@@ -2055,7 +2064,8 @@ impl Context {\n                            &Sidebar{ cx: self, item: it },\n                            &Item{ cx: self, item: it },\n                            self.shared.css_file_extension.is_some(),\n-                           &self.shared.themes)?;\n+                           &self.shared.themes,\n+                           self.shared.generate_search_filter)?;\n         } else {\n             let mut url = self.root_path();\n             if let Some(&(ref names, ty)) = cache().paths.get(&it.def_id) {"}, {"sha": "75b0f5df0d8b3667b04791dd0791afc5a2f8f70f", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -2422,9 +2422,11 @@ if (!DOMTokenList.prototype.remove) {\n             return;\n         }\n         var crates_text = [];\n-        for (var crate in crates) {\n-            if (crates.hasOwnProperty(crate)) {\n-                crates_text.push(crate);\n+        if (crates.length > 1) {\n+            for (var crate in crates) {\n+                if (crates.hasOwnProperty(crate)) {\n+                    crates_text.push(crate);\n+                }\n             }\n         }\n         crates_text.sort(function(a, b) {"}, {"sha": "2cc0b5e30b89321b14868df96891a61ef73daf10", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -649,7 +649,7 @@ a {\n \tbox-sizing: border-box !important;\n \toutline: none;\n \tborder: none;\n-\tborder-radius: 0 1px 1px 0;\n+\tborder-radius: 1px;\n \tmargin-top: 5px;\n \tpadding: 10px 16px;\n \tfont-size: 17px;\n@@ -659,6 +659,10 @@ a {\n \twidth: 100%;\n }\n \n+#crate-search + .search-input {\n+\tborder-radius: 0 1px 1px 0;\n+}\n+\n .search-input:focus {\n \tborder-radius: 2px;\n \tborder: 0;"}, {"sha": "1390be700634dc322a08d717c52ca360d5993703", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -182,14 +182,18 @@ a.test-arrow {\n \n .search-input {\n \tcolor: #111;\n-\tbox-shadow: 1px 0 0 1px #000, 0 0 0 2px transparent;\n+\tbox-shadow: 0 0 0 1px #000, 0 0 0 2px transparent;\n \tbackground-color: #f0f0f0;\n }\n \n .search-input:focus {\n \tborder-color: #008dfd;\n }\n \n+#crate-search + .search-input {\n+\tbox-shadow: 1px 0 0 1px #000, 0 0 0 2px transparent;\n+}\n+\n .stab.unstable { background: #FFF5D6; border-color: #FFC600; color: #404040; }\n .stab.internal { background: #FFB9B3; border-color: #B71C1C; color: #404040; }\n .stab.deprecated { background: #F3DFFF; border-color: #7F0087;  color: #404040; }"}, {"sha": "2b04dd2388d456ff07e5a4691ea294bd013f9c35", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -183,14 +183,18 @@ a.test-arrow {\n \n .search-input {\n \tcolor: #555;\n-\tbox-shadow: 1px 0 0 1px #e0e0e0, 0 0 0 2px transparent;\n+\tbox-shadow: 0 0 0 1px #e0e0e0, 0 0 0 2px transparent;\n \tbackground-color: white;\n }\n \n .search-input:focus {\n \tborder-color: #66afe9;\n }\n \n+#crate-search + .search-input {\n+\tbox-shadow: 1px 0 0 1px #e0e0e0, 0 0 0 2px transparent;\n+}\n+\n .stab.unstable { background: #FFF5D6; border-color: #FFC600; }\n .stab.internal { background: #FFB9B3; border-color: #B71C1C; }\n .stab.deprecated { background: #F3DFFF; border-color: #7F0087; }"}, {"sha": "67d512ed71d3711f890f9f1f01d53dc59c8e6129", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -336,6 +336,11 @@ fn opts() -> Vec<RustcOptGroup> {\n                       If not set, uses combinations of '../' to reach the documentation root.\",\n                      \"PATH\")\n         }),\n+        unstable(\"disable-per-crate-search\", |o| {\n+            o.optflag(\"\",\n+                      \"disable-per-crate-search\",\n+                      \"disables generating the crate selector on the search box\")\n+        }),\n     ]\n }\n "}, {"sha": "e49ce9e088ec65bb9fb50ee4f0a9d409444b4674", "filename": "src/test/rustdoc/no-crate-filter.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/43d26b1f35401c9341154192db000db456ee5ca2/src%2Ftest%2Frustdoc%2Fno-crate-filter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43d26b1f35401c9341154192db000db456ee5ca2/src%2Ftest%2Frustdoc%2Fno-crate-filter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fno-crate-filter.rs?ref=43d26b1f35401c9341154192db000db456ee5ca2", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"foo\"]\n+\n+// compile-flags: -Z unstable-options --disable-per-crate-search\n+\n+// @!has 'foo/struct.Foo.html' '//*[id=\"crate-search\"]'\n+pub struct Foo;"}]}