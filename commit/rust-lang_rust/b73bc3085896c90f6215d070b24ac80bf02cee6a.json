{"sha": "b73bc3085896c90f6215d070b24ac80bf02cee6a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3M2JjMzA4NTg5NmM5MGY2MjE1ZDA3MGIyNGFjODBiZjAyY2VlNmE=", "commit": {"author": {"name": "Chris Peterson", "email": "cpeterson@mozilla.com", "date": "2012-02-18T09:32:52Z"}, "committer": {"name": "Chris Peterson", "email": "cpeterson@mozilla.com", "date": "2012-02-18T09:32:52Z"}, "message": "std: Add tests for time module\n\nTested on OSX and Windows.", "tree": {"sha": "8d35f2607beaceefd6389918d9a605b546717f2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d35f2607beaceefd6389918d9a605b546717f2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b73bc3085896c90f6215d070b24ac80bf02cee6a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b73bc3085896c90f6215d070b24ac80bf02cee6a", "html_url": "https://github.com/rust-lang/rust/commit/b73bc3085896c90f6215d070b24ac80bf02cee6a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b73bc3085896c90f6215d070b24ac80bf02cee6a/comments", "author": {"login": "cpeterso", "id": 629193, "node_id": "MDQ6VXNlcjYyOTE5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/629193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpeterso", "html_url": "https://github.com/cpeterso", "followers_url": "https://api.github.com/users/cpeterso/followers", "following_url": "https://api.github.com/users/cpeterso/following{/other_user}", "gists_url": "https://api.github.com/users/cpeterso/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpeterso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpeterso/subscriptions", "organizations_url": "https://api.github.com/users/cpeterso/orgs", "repos_url": "https://api.github.com/users/cpeterso/repos", "events_url": "https://api.github.com/users/cpeterso/events{/privacy}", "received_events_url": "https://api.github.com/users/cpeterso/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cpeterso", "id": 629193, "node_id": "MDQ6VXNlcjYyOTE5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/629193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpeterso", "html_url": "https://github.com/cpeterso", "followers_url": "https://api.github.com/users/cpeterso/followers", "following_url": "https://api.github.com/users/cpeterso/following{/other_user}", "gists_url": "https://api.github.com/users/cpeterso/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpeterso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpeterso/subscriptions", "organizations_url": "https://api.github.com/users/cpeterso/orgs", "repos_url": "https://api.github.com/users/cpeterso/repos", "events_url": "https://api.github.com/users/cpeterso/events{/privacy}", "received_events_url": "https://api.github.com/users/cpeterso/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "105b5f0be8364ae99d2ce0c7641fcfd16afabbad", "url": "https://api.github.com/repos/rust-lang/rust/commits/105b5f0be8364ae99d2ce0c7641fcfd16afabbad", "html_url": "https://github.com/rust-lang/rust/commit/105b5f0be8364ae99d2ce0c7641fcfd16afabbad"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "ba2d6da44326bf6e3439893687edb6dffb1cb1be", "filename": "src/libstd/time.rs", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/b73bc3085896c90f6215d070b24ac80bf02cee6a/src%2Flibstd%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b73bc3085896c90f6215d070b24ac80bf02cee6a/src%2Flibstd%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftime.rs?ref=b73bc3085896c90f6215d070b24ac80bf02cee6a", "patch": "@@ -45,3 +45,50 @@ in seconds since an unspecified epoch.\n fn precise_time_s() -> float {\n     ret (precise_time_ns() as float) / 1000000000.;\n }\n+\n+#[cfg(test)]\n+mod tests {\n+    import task;\n+\n+    #[test]\n+    fn test_get_time() {\n+        const some_recent_date: u32 = 1325376000u32; // 2012-01-01T00:00:00Z\n+        const some_future_date: u32 = 1577836800u32; // 2020-01-01T00:00:00Z\n+\n+        let tv1 = get_time();\n+        log(debug, \"tv1=\" + uint::str(tv1.sec as uint) + \" sec + \"\n+                   + uint::str(tv1.usec as uint) + \" usec\");\n+\n+        assert tv1.sec > some_recent_date;\n+        assert tv1.usec < 1000000u32;\n+\n+        let tv2 = get_time();\n+        log(debug, \"tv2=\" + uint::str(tv2.sec as uint) + \" sec + \"\n+                   + uint::str(tv2.usec as uint) + \" usec\");\n+\n+        assert tv2.sec >= tv1.sec;\n+        assert tv2.sec < some_future_date;\n+        assert tv2.usec < 1000000u32;\n+        if tv2.sec == tv1.sec {\n+            assert tv2.usec >= tv1.usec;\n+        }\n+    }\n+\n+    #[test]\n+    fn test_precise_time() {\n+        let s0 = precise_time_s();\n+        let ns1 = precise_time_ns();\n+\n+        log(debug, \"s0=\" + float::to_str(s0, 9u) + \" sec\");\n+        assert s0 > 0.;\n+        let ns0 = (s0 * 1000000000.) as u64;\n+        log(debug, \"ns0=\" + u64::str(ns0) + \" ns\");\n+\n+        log(debug, \"ns1=\" + u64::str(ns1) + \" ns\");\n+        assert ns1 >= ns0;\n+\n+        let ns2 = precise_time_ns();\n+        log(debug, \"ns2=\" + u64::str(ns2) + \" ns\");\n+        assert ns2 >= ns1;\n+    }\n+}"}]}