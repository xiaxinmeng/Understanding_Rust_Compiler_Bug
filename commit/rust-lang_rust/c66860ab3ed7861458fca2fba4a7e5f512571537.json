{"sha": "c66860ab3ed7861458fca2fba4a7e5f512571537", "node_id": "C_kwDOAAsO6NoAKGM2Njg2MGFiM2VkNzg2MTQ1OGZjYTJmYmE0YTdlNWY1MTI1NzE1Mzc", "commit": {"author": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-09-10T10:33:23Z"}, "committer": {"name": "beetrees", "email": "b@beetr.ee", "date": "2022-10-01T02:23:08Z"}, "message": "`SetFileTime` doesn't allow setting the file time to `0xFFFF_FFFF_FFFF_FFFF`", "tree": {"sha": "4e2ef1133e471b26f2a4f3f3856811c5611663ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e2ef1133e471b26f2a4f3f3856811c5611663ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c66860ab3ed7861458fca2fba4a7e5f512571537", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQT9oej+Slbzs/bk2IuHkb11QZHr1gUCYzekjAAKCRCHkb11QZHr\n1ueIAP95I/bXKT9P6DE+jt2g9hORp8D5FhU5ZelujlGS3RiaIgEAnulnJqNmNT8L\nx/3utXjDNfdc7rW609E1RW+dyAi9+QA=\n=cjNh\n-----END PGP SIGNATURE-----", "payload": "tree 4e2ef1133e471b26f2a4f3f3856811c5611663ea\nparent 39c0b00cf9e7bf23d90ef7863749590149572ed3\nauthor beetrees <b@beetr.ee> 1662806003 +0100\ncommitter beetrees <b@beetr.ee> 1664590988 +0100\n\n`SetFileTime` doesn't allow setting the file time to `0xFFFF_FFFF_FFFF_FFFF`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c66860ab3ed7861458fca2fba4a7e5f512571537", "html_url": "https://github.com/rust-lang/rust/commit/c66860ab3ed7861458fca2fba4a7e5f512571537", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c66860ab3ed7861458fca2fba4a7e5f512571537/comments", "author": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "committer": {"login": "beetrees", "id": 107947675, "node_id": "U_kgDOBm8mmw", "avatar_url": "https://avatars.githubusercontent.com/u/107947675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beetrees", "html_url": "https://github.com/beetrees", "followers_url": "https://api.github.com/users/beetrees/followers", "following_url": "https://api.github.com/users/beetrees/following{/other_user}", "gists_url": "https://api.github.com/users/beetrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/beetrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beetrees/subscriptions", "organizations_url": "https://api.github.com/users/beetrees/orgs", "repos_url": "https://api.github.com/users/beetrees/repos", "events_url": "https://api.github.com/users/beetrees/events{/privacy}", "received_events_url": "https://api.github.com/users/beetrees/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39c0b00cf9e7bf23d90ef7863749590149572ed3", "url": "https://api.github.com/repos/rust-lang/rust/commits/39c0b00cf9e7bf23d90ef7863749590149572ed3", "html_url": "https://github.com/rust-lang/rust/commit/39c0b00cf9e7bf23d90ef7863749590149572ed3"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "ade00750c959cc2b1b096dc32d4092809b77a955", "filename": "library/std/src/sys/windows/fs.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c66860ab3ed7861458fca2fba4a7e5f512571537/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c66860ab3ed7861458fca2fba4a7e5f512571537/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Ffs.rs?ref=c66860ab3ed7861458fca2fba4a7e5f512571537", "patch": "@@ -572,6 +572,14 @@ impl File {\n                 \"Cannot set file timestamp to 0\",\n             ));\n         }\n+        let is_max =\n+            |t: c::FILETIME| t.dwLowDateTime == c::DWORD::MAX && t.dwHighDateTime == c::DWORD::MAX;\n+        if times.accessed.map_or(false, is_max) || times.modified.map_or(false, is_max) {\n+            return Err(io::const_io_error!(\n+                io::ErrorKind::InvalidInput,\n+                \"Cannot set file timestamp to 0xFFFF_FFFF_FFFF_FFFF\",\n+            ));\n+        }\n         cvt(unsafe {\n             c::SetFileTime(self.as_handle(), None, times.accessed.as_ref(), times.modified.as_ref())\n         })?;"}]}