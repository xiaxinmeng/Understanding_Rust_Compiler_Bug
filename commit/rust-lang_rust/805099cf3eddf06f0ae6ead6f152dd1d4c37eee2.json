{"sha": "805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwNTA5OWNmM2VkZGYwNmYwYWU2ZWFkNmYxNTJkZDFkNGMzN2VlZTI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T22:59:51Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T23:18:53Z"}, "message": "hygiene: Do not treat `Self` ctor as a local variable", "tree": {"sha": "af0ebda0edfdc3405c029a03fff29d9bb84a28d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af0ebda0edfdc3405c029a03fff29d9bb84a28d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "html_url": "https://github.com/rust-lang/rust/commit/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75a369c5b11459baa6bf7734eeb6135998a0a7de", "url": "https://api.github.com/repos/rust-lang/rust/commits/75a369c5b11459baa6bf7734eeb6135998a0a7de", "html_url": "https://github.com/rust-lang/rust/commit/75a369c5b11459baa6bf7734eeb6135998a0a7de"}], "stats": {"total": 37, "additions": 28, "deletions": 9}, "files": [{"sha": "683c9c7c3541807ba088bb3b570c2700ff066065", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "patch": "@@ -2017,16 +2017,14 @@ impl<'a> Resolver<'a> {\n         if ident.name == keywords::Invalid.name() {\n             return Some(LexicalScopeBinding::Def(Def::Err));\n         }\n-        if ns == TypeNS {\n-            ident.span = if ident.name == keywords::SelfUpper.name() {\n-                // FIXME(jseyfried) improve `Self` hygiene\n-                ident.span.with_ctxt(SyntaxContext::empty())\n-            } else {\n-                ident.span.modern()\n-            }\n+        ident.span = if ident.name == keywords::SelfUpper.name() {\n+            // FIXME(jseyfried) improve `Self` hygiene\n+            ident.span.with_ctxt(SyntaxContext::empty())\n+        } else if ns == TypeNS {\n+            ident.span.modern()\n         } else {\n-            ident = ident.modern_and_legacy();\n-        }\n+            ident.span.modern_and_legacy()\n+        };\n \n         // Walk backwards up the ribs in scope.\n         let record_used = record_used_id.is_some();"}, {"sha": "c2a2f28254226a40672eb15e83cf55c55534b982", "filename": "src/test/ui/resolve/issue-57523.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2/src%2Ftest%2Fui%2Fresolve%2Fissue-57523.rs", "raw_url": "https://github.com/rust-lang/rust/raw/805099cf3eddf06f0ae6ead6f152dd1d4c37eee2/src%2Ftest%2Fui%2Fresolve%2Fissue-57523.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fissue-57523.rs?ref=805099cf3eddf06f0ae6ead6f152dd1d4c37eee2", "patch": "@@ -0,0 +1,21 @@\n+// compile-pass\n+\n+struct S(u8);\n+\n+impl S {\n+    fn method1() -> Self {\n+        Self(0)\n+    }\n+}\n+\n+macro_rules! define_method { () => {\n+    impl S {\n+        fn method2() -> Self {\n+            Self(0) // OK\n+        }\n+    }\n+}}\n+\n+define_method!();\n+\n+fn main() {}"}]}