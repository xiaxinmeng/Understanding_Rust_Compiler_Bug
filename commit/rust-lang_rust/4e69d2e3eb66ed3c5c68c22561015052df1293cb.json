{"sha": "4e69d2e3eb66ed3c5c68c22561015052df1293cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlNjlkMmUzZWI2NmVkM2M1YzY4YzIyNTYxMDE1MDUyZGYxMjkzY2I=", "commit": {"author": {"name": "bgermann", "email": "bgermann@users.noreply.github.com", "date": "2017-10-04T23:22:30Z"}, "committer": {"name": "bgermann", "email": "bgermann@users.noreply.github.com", "date": "2017-10-04T23:22:30Z"}, "message": "Merge dist-solaris with cross2 builder", "tree": {"sha": "a0453e6afe4f8ed3bad4d732e224de95e36034b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0453e6afe4f8ed3bad4d732e224de95e36034b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e69d2e3eb66ed3c5c68c22561015052df1293cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e69d2e3eb66ed3c5c68c22561015052df1293cb", "html_url": "https://github.com/rust-lang/rust/commit/4e69d2e3eb66ed3c5c68c22561015052df1293cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e69d2e3eb66ed3c5c68c22561015052df1293cb/comments", "author": {"login": "bgermann", "id": 9329107, "node_id": "MDQ6VXNlcjkzMjkxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9329107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bgermann", "html_url": "https://github.com/bgermann", "followers_url": "https://api.github.com/users/bgermann/followers", "following_url": "https://api.github.com/users/bgermann/following{/other_user}", "gists_url": "https://api.github.com/users/bgermann/gists{/gist_id}", "starred_url": "https://api.github.com/users/bgermann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bgermann/subscriptions", "organizations_url": "https://api.github.com/users/bgermann/orgs", "repos_url": "https://api.github.com/users/bgermann/repos", "events_url": "https://api.github.com/users/bgermann/events{/privacy}", "received_events_url": "https://api.github.com/users/bgermann/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bgermann", "id": 9329107, "node_id": "MDQ6VXNlcjkzMjkxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9329107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bgermann", "html_url": "https://github.com/bgermann", "followers_url": "https://api.github.com/users/bgermann/followers", "following_url": "https://api.github.com/users/bgermann/following{/other_user}", "gists_url": "https://api.github.com/users/bgermann/gists{/gist_id}", "starred_url": "https://api.github.com/users/bgermann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bgermann/subscriptions", "organizations_url": "https://api.github.com/users/bgermann/orgs", "repos_url": "https://api.github.com/users/bgermann/repos", "events_url": "https://api.github.com/users/bgermann/events{/privacy}", "received_events_url": "https://api.github.com/users/bgermann/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a82891ab5cca30515807fb799f9d9f08fa998d08", "url": "https://api.github.com/repos/rust-lang/rust/commits/a82891ab5cca30515807fb799f9d9f08fa998d08", "html_url": "https://github.com/rust-lang/rust/commit/a82891ab5cca30515807fb799f9d9f08fa998d08"}], "stats": {"total": 93, "additions": 30, "deletions": 63}, "files": [{"sha": "139f06ec5704bcfc09f5ea7c40570e6b6406590d", "filename": ".travis.yml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4e69d2e3eb66ed3c5c68c22561015052df1293cb/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/4e69d2e3eb66ed3c5c68c22561015052df1293cb/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=4e69d2e3eb66ed3c5c68c22561015052df1293cb", "patch": "@@ -115,6 +115,8 @@ matrix:\n       if: branch = auto\n     - env: IMAGE=cross DEPLOY=1\n       if: branch = auto\n+    - env: IMAGE=cross2 DEPLOY=1\n+      if: branch = auto\n     - env: IMAGE=dist-aarch64-linux DEPLOY=1\n       if: branch = auto\n     - env: IMAGE=dist-android DEPLOY=1\n@@ -125,8 +127,6 @@ matrix:\n       if: branch = auto\n     - env: IMAGE=dist-armv7-linux DEPLOY=1\n       if: branch = auto\n-    - env: IMAGE=dist-fuchsia DEPLOY=1\n-      if: branch = auto\n     - env: IMAGE=dist-i586-gnu-i686-musl DEPLOY=1\n       if: branch = auto\n     - env: IMAGE=dist-i686-freebsd DEPLOY=1"}, {"sha": "6f8541971911b574adff2e915a76bf3d7a33475f", "filename": "src/ci/docker/cross2/Dockerfile", "status": "modified", "additions": 27, "deletions": 16, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/4e69d2e3eb66ed3c5c68c22561015052df1293cb/src%2Fci%2Fdocker%2Fcross2%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/4e69d2e3eb66ed3c5c68c22561015052df1293cb/src%2Fci%2Fdocker%2Fcross2%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross2%2FDockerfile?ref=4e69d2e3eb66ed3c5c68c22561015052df1293cb", "patch": "@@ -1,27 +1,30 @@\n FROM ubuntu:16.04\n \n-RUN apt-get update && apt-get build-dep -y clang llvm && apt-get install -y \\\n+COPY scripts/cross-apt-packages.sh /scripts/\n+RUN sh /scripts/cross-apt-packages.sh\n+\n+RUN apt-get build-dep -y clang llvm && apt-get install -y --no-install-recommends \\\n   build-essential \\\n-  bzip2 \\\n-  ca-certificates \\\n-  cmake \\\n-  curl \\\n-  file \\\n-  g++ \\\n-  gdb \\\n-  git \\\n   libedit-dev \\\n-  make \\\n+  libgmp-dev \\\n+  libisl-dev \\\n+  libmpc-dev \\\n+  libmpfr-dev \\\n   ninja-build \\\n   nodejs \\\n   python2.7-dev \\\n-  sudo \\\n-  xz-utils \\\n+  software-properties-common \\\n   unzip\n \n+RUN apt-key adv --batch --yes --keyserver keyserver.ubuntu.com --recv-keys 74DA7924C5513486\n+RUN add-apt-repository -y 'deb http://apt.dilos.org/dilos dilos2-testing main'\n+\n WORKDIR /tmp\n-COPY dist-fuchsia/shared.sh dist-fuchsia/build-toolchain.sh /tmp/\n-RUN /tmp/build-toolchain.sh\n+COPY cross2/shared.sh cross2/build-fuchsia-toolchain.sh /tmp/\n+COPY cross2/build-solaris-toolchain.sh /tmp/\n+RUN /tmp/build-fuchsia-toolchain.sh\n+RUN /tmp/build-solaris-toolchain.sh x86_64  amd64   solaris-i386\n+RUN /tmp/build-solaris-toolchain.sh sparcv9 sparcv9 solaris-sparc\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n@@ -32,10 +35,18 @@ ENV \\\n     CXX_x86_64_unknown_fuchsia=x86_64-unknown-fuchsia-clang++ \\\n     AR_aarch64_unknown_fuchsia=aarch64-unknown-fuchsia-ar \\\n     CC_aarch64_unknown_fuchsia=aarch64-unknown-fuchsia-clang \\\n-    CXX_aarch64_unknown_fuchsia=aarch64-unknown-fuchsia-clang++\n+    CXX_aarch64_unknown_fuchsia=aarch64-unknown-fuchsia-clang++ \\\n+    AR_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-ar \\\n+    CC_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-sysroot \\\n+    CXX_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-g++ \\\n+    AR_x86_64_sun_solaris=x86_64-sun-solaris2.11-ar \\\n+    CC_x86_64_sun_solaris=x86_64-sun-solaris2.11-sysroot \\\n+    CXX_x86_64_sun_solaris=x86_64-sun-solaris2.11-g++\n \n ENV TARGETS=x86_64-unknown-fuchsia\n ENV TARGETS=$TARGETS,aarch64-unknown-fuchsia\n+ENV TARGETS=$TARGETS,sparcv9-sun-solaris\n+ENV TARGETS=$TARGETS,x86_64-sun-solaris\n \n ENV RUST_CONFIGURE_ARGS --target=$TARGETS --enable-extended\n-ENV SCRIPT python2.7 ../x.py dist --target $TARGETS\n\\ No newline at end of file\n+ENV SCRIPT python2.7 ../x.py dist --target $TARGETS"}, {"sha": "4ff26b5dfabca007da6ce8ad9128ec4c02abd32d", "filename": "src/ci/docker/cross2/build-solaris-toolchain.sh", "status": "renamed", "additions": 1, "deletions": 16, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4e69d2e3eb66ed3c5c68c22561015052df1293cb/src%2Fci%2Fdocker%2Fcross2%2Fbuild-solaris-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/4e69d2e3eb66ed3c5c68c22561015052df1293cb/src%2Fci%2Fdocker%2Fcross2%2Fbuild-solaris-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross2%2Fbuild-solaris-toolchain.sh?ref=4e69d2e3eb66ed3c5c68c22561015052df1293cb", "patch": "@@ -10,29 +10,14 @@\n # except according to those terms.\n \n set -ex\n+source shared.sh\n \n ARCH=$1\n LIB_ARCH=$2\n APT_ARCH=$3\n BINUTILS=2.28.1\n GCC=6.4.0\n \n-hide_output() {\n-  set +x\n-  on_err=\"\n-echo ERROR: An error was encountered with the build.\n-cat /tmp/build.log\n-exit 1\n-\"\n-  trap \"$on_err\" ERR\n-  bash -c \"while true; do sleep 30; echo \\$(date) - building ...; done\" &\n-  PING_LOOP_PID=$!\n-  $@ &> /tmp/build.log\n-  trap - ERR\n-  kill $PING_LOOP_PID\n-  set -x\n-}\n-\n # First up, build binutils\n mkdir binutils\n cd binutils", "previous_filename": "src/ci/docker/dist-solaris/build-toolchain.sh"}, {"sha": "a60c9956b752865ee8c2771860b00b5f16ac7067", "filename": "src/ci/docker/dist-solaris/Dockerfile", "status": "removed", "additions": 0, "deletions": 29, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/a82891ab5cca30515807fb799f9d9f08fa998d08/src%2Fci%2Fdocker%2Fdist-solaris%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/a82891ab5cca30515807fb799f9d9f08fa998d08/src%2Fci%2Fdocker%2Fdist-solaris%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-solaris%2FDockerfile?ref=a82891ab5cca30515807fb799f9d9f08fa998d08", "patch": "@@ -1,29 +0,0 @@\n-FROM ubuntu:16.04\n-\n-COPY scripts/cross-apt-packages.sh /scripts/\n-RUN sh /scripts/cross-apt-packages.sh\n-\n-RUN apt-get install -y --no-install-recommends \\\n-                    software-properties-common libgmp-dev libmpfr-dev libmpc-dev libisl-dev\n-RUN apt-key adv --batch --yes --keyserver keyserver.ubuntu.com --recv-keys 74DA7924C5513486\n-RUN add-apt-repository -y 'deb http://apt.dilos.org/dilos dilos2-testing main'\n-\n-COPY dist-solaris/build-toolchain.sh /tmp/\n-RUN /tmp/build-toolchain.sh x86_64  amd64   solaris-i386\n-RUN /tmp/build-toolchain.sh sparcv9 sparcv9 solaris-sparc\n-\n-COPY scripts/sccache.sh /scripts/\n-RUN sh /scripts/sccache.sh\n-\n-ENV \\\n-    AR_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-ar      \\\n-    CC_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-sysroot \\\n-    CXX_sparcv9_sun_solaris=sparcv9-sun-solaris2.11-g++    \\\n-    AR_x86_64_sun_solaris=x86_64-sun-solaris2.11-ar        \\\n-    CC_x86_64_sun_solaris=x86_64-sun-solaris2.11-sysroot   \\\n-    CXX_x86_64_sun_solaris=x86_64-sun-solaris2.11-g++\n-\n-ENV TARGETS=sparcv9-sun-solaris,x86_64-sun-solaris\n-\n-ENV RUST_CONFIGURE_ARGS --target=$TARGETS --enable-extended\n-ENV SCRIPT python2.7 ../x.py dist --target $TARGETS"}]}