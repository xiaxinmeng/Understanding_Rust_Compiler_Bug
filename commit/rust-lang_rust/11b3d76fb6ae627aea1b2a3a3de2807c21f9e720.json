{"sha": "11b3d76fb6ae627aea1b2a3a3de2807c21f9e720", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExYjNkNzZmYjZhZTYyN2FlYTFiMmEzYTNkZTI4MDdjMjFmOWU3MjA=", "commit": {"author": {"name": "Robert Knight", "email": "robertknight@gmail.com", "date": "2013-08-13T11:44:16Z"}, "committer": {"name": "Robert Knight", "email": "robertknight@gmail.com", "date": "2013-08-13T12:26:05Z"}, "message": "Add RngUtils::sample() method for reservoir sampling from iterators", "tree": {"sha": "5a8dbccb42a260d24e7918826b6b19f581a2acfa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a8dbccb42a260d24e7918826b6b19f581a2acfa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720", "html_url": "https://github.com/rust-lang/rust/commit/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720/comments", "author": {"login": "robertknight", "id": 2458, "node_id": "MDQ6VXNlcjI0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robertknight", "html_url": "https://github.com/robertknight", "followers_url": "https://api.github.com/users/robertknight/followers", "following_url": "https://api.github.com/users/robertknight/following{/other_user}", "gists_url": "https://api.github.com/users/robertknight/gists{/gist_id}", "starred_url": "https://api.github.com/users/robertknight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robertknight/subscriptions", "organizations_url": "https://api.github.com/users/robertknight/orgs", "repos_url": "https://api.github.com/users/robertknight/repos", "events_url": "https://api.github.com/users/robertknight/events{/privacy}", "received_events_url": "https://api.github.com/users/robertknight/received_events", "type": "User", "site_admin": false}, "committer": {"login": "robertknight", "id": 2458, "node_id": "MDQ6VXNlcjI0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robertknight", "html_url": "https://github.com/robertknight", "followers_url": "https://api.github.com/users/robertknight/followers", "following_url": "https://api.github.com/users/robertknight/following{/other_user}", "gists_url": "https://api.github.com/users/robertknight/gists{/gist_id}", "starred_url": "https://api.github.com/users/robertknight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robertknight/subscriptions", "organizations_url": "https://api.github.com/users/robertknight/orgs", "repos_url": "https://api.github.com/users/robertknight/repos", "events_url": "https://api.github.com/users/robertknight/events{/privacy}", "received_events_url": "https://api.github.com/users/robertknight/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c99b2b932f1da9b1746387d8968476240dadf204", "url": "https://api.github.com/repos/rust-lang/rust/commits/c99b2b932f1da9b1746387d8968476240dadf204", "html_url": "https://github.com/rust-lang/rust/commit/c99b2b932f1da9b1746387d8968476240dadf204"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "83cf777063c6bd8a264f76dfa08ddeadf50081cf", "filename": "src/libstd/rand.rs", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720/src%2Flibstd%2Frand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11b3d76fb6ae627aea1b2a3a3de2807c21f9e720/src%2Flibstd%2Frand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frand.rs?ref=11b3d76fb6ae627aea1b2a3a3de2807c21f9e720", "patch": "@@ -461,6 +461,26 @@ pub trait RngUtil {\n      * ~~~\n      */\n     fn shuffle_mut<T>(&mut self, values: &mut [T]);\n+\n+    /**\n+     * Sample up to `n` values from an iterator.\n+     *\n+     * # Example\n+     *\n+     * ~~~ {.rust}\n+     *\n+     * use std::rand;\n+     * use std::rand::RngUtil;\n+     *\n+     * fn main() {\n+     *     let mut rng = rand::rng();\n+     *     let vals = range(1, 100).to_owned_vec();\n+     *     let sample = rng.sample(vals.iter(), 5);\n+     *     printfln!(sample);\n+     * }\n+     * ~~~\n+     */\n+    fn sample<A, T: Iterator<A>>(&mut self, iter: T, n: uint) -> ~[A];\n }\n \n /// Extension methods for random number generators\n@@ -607,6 +627,23 @@ impl<R: Rng> RngUtil for R {\n             values.swap(i, self.gen_uint_range(0u, i + 1u));\n         }\n     }\n+\n+    /// Randomly sample up to `n` elements from an iterator\n+    fn sample<A, T: Iterator<A>>(&mut self, iter: T, n: uint) -> ~[A] {\n+        let mut reservoir : ~[A] = vec::with_capacity(n);\n+        for (i, elem) in iter.enumerate() {\n+            if i < n {\n+                reservoir.push(elem);\n+                loop\n+            }\n+\n+            let k = self.gen_uint_range(0, i + 1);\n+            if k < reservoir.len() {\n+                reservoir[k] = elem\n+            }\n+        }\n+        reservoir\n+    }\n }\n \n /// Create a random number generator with a default algorithm and seed.\n@@ -914,6 +951,7 @@ pub fn random<T: Rand>() -> T {\n \n #[cfg(test)]\n mod test {\n+    use iterator::{Iterator, range};\n     use option::{Option, Some};\n     use super::*;\n \n@@ -1130,6 +1168,24 @@ mod test {\n             }\n         }\n     }\n+\n+    #[test]\n+    fn test_sample() {\n+        let MIN_VAL = 1;\n+        let MAX_VAL = 100;\n+\n+        let mut r = rng();\n+        let vals = range(MIN_VAL, MAX_VAL).to_owned_vec();\n+        let small_sample = r.sample(vals.iter(), 5);\n+        let large_sample = r.sample(vals.iter(), vals.len() + 5);\n+\n+        assert_eq!(small_sample.len(), 5);\n+        assert_eq!(large_sample.len(), vals.len());\n+\n+        assert!(small_sample.iter().all(|e| {\n+            **e >= MIN_VAL && **e <= MAX_VAL\n+        }));\n+    }\n }\n \n #[cfg(test)]"}]}