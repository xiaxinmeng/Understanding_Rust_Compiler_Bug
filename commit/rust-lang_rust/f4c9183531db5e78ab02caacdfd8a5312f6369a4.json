{"sha": "f4c9183531db5e78ab02caacdfd8a5312f6369a4", "node_id": "C_kwDOAAsO6NoAKGY0YzkxODM1MzFkYjVlNzhhYjAyY2FhY2RmZDhhNTMxMmY2MzY5YTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-18T10:13:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-18T10:13:39Z"}, "message": "Auto merge of #9146 - arieluy:type_params, r=dswij\n\nFix `mismatching_type_param_order` false positive\n\nchangelog: Don't lint `mismatching_type_param_order` on complicated generic params\n\nfixes #8962", "tree": {"sha": "d2fc0b2a4d0176489808497fd3dde49c4f66bcf6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2fc0b2a4d0176489808497fd3dde49c4f66bcf6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4c9183531db5e78ab02caacdfd8a5312f6369a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4c9183531db5e78ab02caacdfd8a5312f6369a4", "html_url": "https://github.com/rust-lang/rust/commit/f4c9183531db5e78ab02caacdfd8a5312f6369a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4c9183531db5e78ab02caacdfd8a5312f6369a4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79a0d234fe9fc27961dc5fb9ff7b4c8806c71438", "url": "https://api.github.com/repos/rust-lang/rust/commits/79a0d234fe9fc27961dc5fb9ff7b4c8806c71438", "html_url": "https://github.com/rust-lang/rust/commit/79a0d234fe9fc27961dc5fb9ff7b4c8806c71438"}, {"sha": "8cf39a8c1908709831ab27937a53a2d6d0278ff6", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cf39a8c1908709831ab27937a53a2d6d0278ff6", "html_url": "https://github.com/rust-lang/rust/commit/8cf39a8c1908709831ab27937a53a2d6d0278ff6"}], "stats": {"total": 28, "additions": 19, "deletions": 9}, "files": [{"sha": "f763e0d24c9444206a8d14b599a411f3067d610e", "filename": "clippy_lints/src/mismatching_type_param_order.rs", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f4c9183531db5e78ab02caacdfd8a5312f6369a4/clippy_lints%2Fsrc%2Fmismatching_type_param_order.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4c9183531db5e78ab02caacdfd8a5312f6369a4/clippy_lints%2Fsrc%2Fmismatching_type_param_order.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmismatching_type_param_order.rs?ref=f4c9183531db5e78ab02caacdfd8a5312f6369a4", "patch": "@@ -18,6 +18,11 @@ declare_clippy_lint! {\n     /// Naming type parameters inconsistently may cause you to refer to the\n     /// wrong type parameter.\n     ///\n+    /// ### Limitations\n+    /// This lint only applies to impl blocks with simple generic params, e.g.\n+    /// `A`. If there is anything more complicated, such as a tuple, it will be\n+    /// ignored.\n+    ///\n     /// ### Example\n     /// ```rust\n     /// struct Foo<A, B> {\n@@ -53,14 +58,15 @@ impl<'tcx> LateLintPass<'tcx> for TypeParamMismatch {\n             if !generic_args.args.is_empty();\n             then {\n                 // get the name and span of the generic parameters in the Impl\n-                let impl_params = generic_args.args.iter()\n-                .filter_map(|p|\n+                let mut impl_params = Vec::new();\n+                for p in generic_args.args.iter() {\n                     match p {\n                         GenericArg::Type(Ty {kind: TyKind::Path(QPath::Resolved(_, path)), ..}) =>\n-                            Some((path.segments[0].ident.to_string(), path.span)),\n-                        _ => None,\n-                    }\n-                );\n+                            impl_params.push((path.segments[0].ident.to_string(), path.span)),\n+                        GenericArg::Type(_) => return,\n+                        _ => (),\n+                    };\n+                }\n \n                 // find the type that the Impl is for\n                 // only lint on struct/enum/union for now\n@@ -83,16 +89,16 @@ impl<'tcx> LateLintPass<'tcx> for TypeParamMismatch {\n                     type_param_names.iter().enumerate().map(|(i, param)| (param, i)).collect();\n \n                 let type_name = segment.ident;\n-                for (i, (impl_param_name, impl_param_span)) in impl_params.enumerate() {\n-                    if mismatch_param_name(i, &impl_param_name, &type_param_names_hashmap) {\n+                for (i, (impl_param_name, impl_param_span)) in impl_params.iter().enumerate() {\n+                    if mismatch_param_name(i, impl_param_name, &type_param_names_hashmap) {\n                         let msg = format!(\"`{}` has a similarly named generic type parameter `{}` in its declaration, but in a different order\",\n                                           type_name, impl_param_name);\n                         let help = format!(\"try `{}`, or a name that does not conflict with `{}`'s generic params\",\n                                            type_param_names[i], type_name);\n                         span_lint_and_help(\n                             cx,\n                             MISMATCHING_TYPE_PARAM_ORDER,\n-                            impl_param_span,\n+                            *impl_param_span,\n                             &msg,\n                             None,\n                             &help"}, {"sha": "8c0da84d8e975a5e160608bf74714d79c7daca84", "filename": "tests/ui/mismatching_type_param_order.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4c9183531db5e78ab02caacdfd8a5312f6369a4/tests%2Fui%2Fmismatching_type_param_order.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4c9183531db5e78ab02caacdfd8a5312f6369a4/tests%2Fui%2Fmismatching_type_param_order.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmismatching_type_param_order.rs?ref=f4c9183531db5e78ab02caacdfd8a5312f6369a4", "patch": "@@ -57,4 +57,8 @@ fn main() {\n         B: Copy,\n     {\n     }\n+\n+    // if the types are complicated, do not lint\n+    impl<K, V, B> Foo<(K, V), B> {}\n+    impl<K, V, A> Foo<(K, V), A> {}\n }"}]}