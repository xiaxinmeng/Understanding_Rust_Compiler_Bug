{"sha": "e195ce654a570606a85ead6cefb36042a206205a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxOTVjZTY1NGE1NzA2MDZhODVlYWQ2Y2VmYjM2MDQyYTIwNjIwNWE=", "commit": {"author": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2019-01-21T15:55:32Z"}, "committer": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2019-01-21T17:41:53Z"}, "message": "Fix some non-determinism in help messages for E0277 errors.\n\nThe diagnostic for this error prints `the following implementations\nwere found` followed by the first N relevant impls, sorted.\n\nThis commit makes the sort happen before slicing,\nso that the set of impls being printed is deterministic\nwhen the input is not.", "tree": {"sha": "80a517b4e0e47f41708b7162d8dae32cc4159aa2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/80a517b4e0e47f41708b7162d8dae32cc4159aa2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e195ce654a570606a85ead6cefb36042a206205a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e195ce654a570606a85ead6cefb36042a206205a", "html_url": "https://github.com/rust-lang/rust/commit/e195ce654a570606a85ead6cefb36042a206205a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e195ce654a570606a85ead6cefb36042a206205a/comments", "author": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9be4c76910e0df7decb33c5d400260f1d8c217a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9be4c76910e0df7decb33c5d400260f1d8c217a1", "html_url": "https://github.com/rust-lang/rust/commit/9be4c76910e0df7decb33c5d400260f1d8c217a1"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "1c92e2da588a0a19caac1dacf3af6ce851ee7f11", "filename": "src/librustc/traits/error_reporting.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e195ce654a570606a85ead6cefb36042a206205a/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e195ce654a570606a85ead6cefb36042a206205a/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Ferror_reporting.rs?ref=e195ce654a570606a85ead6cefb36042a206205a", "patch": "@@ -471,7 +471,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n     }\n \n     fn report_similar_impl_candidates(&self,\n-                                      mut impl_candidates: Vec<ty::TraitRef<'tcx>>,\n+                                      impl_candidates: Vec<ty::TraitRef<'tcx>>,\n                                       err: &mut DiagnosticBuilder<'_>)\n     {\n         if impl_candidates.is_empty() {\n@@ -497,14 +497,18 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n         });\n \n         // Sort impl candidates so that ordering is consistent for UI tests.\n-        let normalized_impl_candidates = &mut impl_candidates[0..end]\n+        let mut normalized_impl_candidates = impl_candidates\n             .iter()\n             .map(normalize)\n             .collect::<Vec<String>>();\n+\n+        // Sort before taking the `..end` range,\n+        // because the ordering of `impl_candidates` may not be deterministic:\n+        // https://github.com/rust-lang/rust/pull/57475#issuecomment-455519507\n         normalized_impl_candidates.sort();\n \n         err.help(&format!(\"the following implementations were found:{}{}\",\n-                          normalized_impl_candidates.join(\"\"),\n+                          normalized_impl_candidates[..end].join(\"\"),\n                           if len > 5 {\n                               format!(\"\\nand {} others\", len - 4)\n                           } else {"}, {"sha": "d6d5ce4d1a7d2b34c5249323e91e2d9123fd338a", "filename": "src/test/ui/did_you_mean/issue-21659-show-relevant-trait-impls-2.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-21659-show-relevant-trait-impls-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-21659-show-relevant-trait-impls-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-21659-show-relevant-trait-impls-2.stderr?ref=e195ce654a570606a85ead6cefb36042a206205a", "patch": "@@ -8,7 +8,7 @@ LL |     f1.foo(1usize);\n              <Bar as Foo<i16>>\n              <Bar as Foo<i32>>\n              <Bar as Foo<i8>>\n-             <Bar as Foo<u8>>\n+             <Bar as Foo<u16>>\n            and 2 others\n \n error: aborting due to previous error"}, {"sha": "3411958be62a93b46600719561ba42521d5678f3", "filename": "src/test/ui/did_you_mean/issue-39802-show-5-trait-impls.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-39802-show-5-trait-impls.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-39802-show-5-trait-impls.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fissue-39802-show-5-trait-impls.stderr?ref=e195ce654a570606a85ead6cefb36042a206205a", "patch": "@@ -40,10 +40,10 @@ LL |     Foo::<i32>::bar(&true); //~ ERROR is not satisfied\n    |     ^^^^^^^^^^^^^^^ the trait `Foo<i32>` is not implemented for `bool`\n    |\n    = help: the following implementations were found:\n+             <bool as Foo<bool>>\n+             <bool as Foo<i8>>\n              <bool as Foo<u16>>\n              <bool as Foo<u32>>\n-             <bool as Foo<u64>>\n-             <bool as Foo<u8>>\n            and 2 others\n note: required by `Foo::bar`\n   --> $DIR/issue-39802-show-5-trait-impls.rs:2:5"}, {"sha": "df8e646280c9a5d8e0092ff03bdee0401fe9339f", "filename": "src/test/ui/try-block/try-block-bad-type.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Ftry-block%2Ftry-block-bad-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e195ce654a570606a85ead6cefb36042a206205a/src%2Ftest%2Fui%2Ftry-block%2Ftry-block-bad-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftry-block%2Ftry-block-bad-type.stderr?ref=e195ce654a570606a85ead6cefb36042a206205a", "patch": "@@ -5,10 +5,10 @@ LL |         Err(\"\")?; //~ ERROR the trait bound `i32: std::convert::From<&str>`\n    |         ^^^^^^^^ the trait `std::convert::From<&str>` is not implemented for `i32`\n    |\n    = help: the following implementations were found:\n+             <i32 as std::convert::From<bool>>\n              <i32 as std::convert::From<core::num::NonZeroI32>>\n              <i32 as std::convert::From<i16>>\n              <i32 as std::convert::From<i8>>\n-             <i32 as std::convert::From<u8>>\n            and 2 others\n    = note: required by `std::convert::From::from`\n "}]}