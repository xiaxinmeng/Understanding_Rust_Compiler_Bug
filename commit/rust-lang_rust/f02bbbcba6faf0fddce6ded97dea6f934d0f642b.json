{"sha": "f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "node_id": "C_kwDOAAsO6NoAKGYwMmJiYmNiYTZmYWYwZmRkY2U2ZGVkOTdkZWE2ZjkzNGQwZjY0MmI", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-07-20T05:59:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-20T05:59:39Z"}, "message": "Rollup merge of #99433 - cjgillot:erase-foreign-sig, r=compiler-errors\n\nErase regions before comparing signatures of foreign fns.\n\nFixes https://github.com/rust-lang/rust/issues/99276\n\nThe version with explicit lifetimes is probably tracked in another bug, but I could not find it.", "tree": {"sha": "a2a2fa2a27cf79a57ea7987dae2bba2cfae1775a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2a2fa2a27cf79a57ea7987dae2bba2cfae1775a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi15nMCRBK7hj4Ov3rIwAAbSIIAG1TjBpAu5pcuOCmjZnC7mCa\nm9Hvi73pEClZe4abRc8qsLUbw6wrQf50VdD5emWag0xdbullVhv1qK+Kw4IgKaLL\nxJV/4yyP92ijSzCdCSRjLxUW+9s8YZ5Qskz6WKuVj2KP/nHPsF7GyAHl0mMjTLBp\ne00C83KOc422ad2XQOGtKS2OTnNEuEqpBNTFzXGx/7QzuYhRwKknGU4iLbZ++T1O\n/rMZ/JHDKvnp4orqzfGJGbE4LlHguQ/iKlUpOBHXluKA5L//FG8eda63yPtAayK3\n91Umi/MQmUkBbJ5ouXp8L/bPf8xmwKEqZ2dChfpipt6PVs7FhbAnacEVoRTplgM=\n=MmgL\n-----END PGP SIGNATURE-----\n", "payload": "tree a2a2fa2a27cf79a57ea7987dae2bba2cfae1775a\nparent 80395679cb123099ef53f94b9d514729720e136c\nparent 0065929599d276ce756a55948e8316615be1e7ec\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1658296779 +0530\ncommitter GitHub <noreply@github.com> 1658296779 +0530\n\nRollup merge of #99433 - cjgillot:erase-foreign-sig, r=compiler-errors\n\nErase regions before comparing signatures of foreign fns.\n\nFixes https://github.com/rust-lang/rust/issues/99276\n\nThe version with explicit lifetimes is probably tracked in another bug, but I could not find it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "html_url": "https://github.com/rust-lang/rust/commit/f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f02bbbcba6faf0fddce6ded97dea6f934d0f642b/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80395679cb123099ef53f94b9d514729720e136c", "url": "https://api.github.com/repos/rust-lang/rust/commits/80395679cb123099ef53f94b9d514729720e136c", "html_url": "https://github.com/rust-lang/rust/commit/80395679cb123099ef53f94b9d514729720e136c"}, {"sha": "0065929599d276ce756a55948e8316615be1e7ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/0065929599d276ce756a55948e8316615be1e7ec", "html_url": "https://github.com/rust-lang/rust/commit/0065929599d276ce756a55948e8316615be1e7ec"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "9e4dc702f0737bec6c37c2ead5936972c20f6a7a", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f02bbbcba6faf0fddce6ded97dea6f934d0f642b/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f02bbbcba6faf0fddce6ded97dea6f934d0f642b/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "patch": "@@ -2858,9 +2858,10 @@ impl ClashingExternDeclarations {\n                             let a_poly_sig = a.fn_sig(tcx);\n                             let b_poly_sig = b.fn_sig(tcx);\n \n-                            // As we don't compare regions, skip_binder is fine.\n-                            let a_sig = a_poly_sig.skip_binder();\n-                            let b_sig = b_poly_sig.skip_binder();\n+                            // We don't compare regions, but leaving bound regions around ICEs, so\n+                            // we erase them.\n+                            let a_sig = tcx.erase_late_bound_regions(a_poly_sig);\n+                            let b_sig = tcx.erase_late_bound_regions(b_poly_sig);\n \n                             (a_sig.abi, a_sig.unsafety, a_sig.c_variadic)\n                                 == (b_sig.abi, b_sig.unsafety, b_sig.c_variadic)"}, {"sha": "fce603c801f2488ccac02ed12b0c50616b9f22f4", "filename": "src/test/ui/foreign/issue-99276-same-type-lifetimes.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f02bbbcba6faf0fddce6ded97dea6f934d0f642b/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f02bbbcba6faf0fddce6ded97dea6f934d0f642b/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fforeign%2Fissue-99276-same-type-lifetimes.rs?ref=f02bbbcba6faf0fddce6ded97dea6f934d0f642b", "patch": "@@ -0,0 +1,24 @@\n+// Check that we do not ICE when structurally comparing types with lifetimes present.\n+// check-pass\n+\n+pub struct Record<'a> {\n+    pub args: &'a [(usize, &'a str)],\n+}\n+\n+mod a {\n+    extern \"Rust\" {\n+        fn foo<'a, 'b>(record: &'a super::Record<'b>);\n+\n+        fn bar<'a, 'b>(record: &'a super::Record<'b>);\n+    }\n+}\n+\n+mod b {\n+    extern \"Rust\" {\n+        fn foo<'a, 'b>(record: &'a super::Record<'b>);\n+\n+        fn bar<'a, 'b>(record: &'a super::Record<'b>);\n+    }\n+}\n+\n+fn main() {}"}]}