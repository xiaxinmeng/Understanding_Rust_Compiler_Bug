{"sha": "543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0M2VmN2YxM2MwM2M0OTVkMzFiNDJkZGUzMmM3ZGRjZTBkMmZiMTU=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-02T12:23:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-02T12:23:18Z"}, "message": "Rollup merge of #82593 - sunfishcode:wasi-docs, r=alexcrichton\n\nTeach rustdoc how to display WASI.\n\nAs a followup to [this comment] in #82420, this patch teaches rustdoc\nhow to display WASI.\n\n[this comment]: https://github.com/rust-lang/rust/pull/82420#issuecomment-784523826\n\nr? `@alexcrichton`", "tree": {"sha": "d7a73ac633b0609e08823f463c2e11f8e22bcda2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7a73ac633b0609e08823f463c2e11f8e22bcda2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgPi42CRBK7hj4Ov3rIwAAdHIIAAK5AVg/tWjZOquXyi7WdeCu\nYo4Oh2a8bWx6ehZaLoIxijEu8Wt8J/W1s0sPvTMWUquSyR/xH0cP0IrlOt225FwE\nHEaoq4kwCykzLOgXt9o4Zbv1uscL1T4cDP+4qUIXB7FvpxKQdj0oAjT5J0FlbkV+\nhgbgXPyz7TQRyejWWE7ssgcMxvA9T1ebsPLHbxLuDkALV7FrGpR5BzynoEUxvoBB\n8GI5MArOWflHLMQy3ps0gpagUulSg/cYiB4+o0ZcRaCeYn7IzaeK+6cDMcWYm06L\nIlOPDfpPsveXosXnUOlTOtoM8cTGdLJmKBogbD2mn9+r02+5j7rOzs9elI3/LyU=\n=Cd/O\n-----END PGP SIGNATURE-----\n", "payload": "tree d7a73ac633b0609e08823f463c2e11f8e22bcda2\nparent 906e53520505acbb3948be594135c60a16b68b81\nparent e27eba339772fd9081ed3f20ec18a7e8ab79fefd\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1614687798 +0900\ncommitter GitHub <noreply@github.com> 1614687798 +0900\n\nRollup merge of #82593 - sunfishcode:wasi-docs, r=alexcrichton\n\nTeach rustdoc how to display WASI.\n\nAs a followup to [this comment] in #82420, this patch teaches rustdoc\nhow to display WASI.\n\n[this comment]: https://github.com/rust-lang/rust/pull/82420#issuecomment-784523826\n\nr? `@alexcrichton`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "html_url": "https://github.com/rust-lang/rust/commit/543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "906e53520505acbb3948be594135c60a16b68b81", "url": "https://api.github.com/repos/rust-lang/rust/commits/906e53520505acbb3948be594135c60a16b68b81", "html_url": "https://github.com/rust-lang/rust/commit/906e53520505acbb3948be594135c60a16b68b81"}, {"sha": "e27eba339772fd9081ed3f20ec18a7e8ab79fefd", "url": "https://api.github.com/repos/rust-lang/rust/commits/e27eba339772fd9081ed3f20ec18a7e8ab79fefd", "html_url": "https://github.com/rust-lang/rust/commit/e27eba339772fd9081ed3f20ec18a7e8ab79fefd"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "02adccef594efe723da52a96d37eb41edf3da500", "filename": "src/librustdoc/clean/cfg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fcfg.rs?ref=543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "patch": "@@ -483,6 +483,7 @@ impl<'a> fmt::Display for Display<'a> {\n                         \"openbsd\" => \"OpenBSD\",\n                         \"redox\" => \"Redox\",\n                         \"solaris\" => \"Solaris\",\n+                        \"wasi\" => \"WASI\",\n                         \"windows\" => \"Windows\",\n                         _ => \"\",\n                     },"}, {"sha": "34b9cbcb6793ab608539ae722ddd8bd7de5dcbd1", "filename": "src/librustdoc/clean/cfg/tests.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fcfg%2Ftests.rs?ref=543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "patch": "@@ -367,6 +367,10 @@ fn test_render_long_html() {\n             name_value_cfg(\"target_os\", \"macos\").render_long_html(),\n             \"This is supported on <strong>macOS</strong> only.\"\n         );\n+        assert_eq!(\n+            name_value_cfg(\"target_os\", \"wasi\").render_long_html(),\n+            \"This is supported on <strong>WASI</strong> only.\"\n+        );\n         assert_eq!(\n             name_value_cfg(\"target_pointer_width\", \"16\").render_long_html(),\n             \"This is supported on <strong>16-bit</strong> only.\""}, {"sha": "89a61a289fdebb5f00a0c0453202523a83828d3f", "filename": "src/test/rustdoc/doc-cfg.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Ftest%2Frustdoc%2Fdoc-cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/543ef7f13c03c495d31b42dde32c7ddce0d2fb15/src%2Ftest%2Frustdoc%2Fdoc-cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fdoc-cfg.rs?ref=543ef7f13c03c495d31b42dde32c7ddce0d2fb15", "patch": "@@ -5,6 +5,8 @@\n // @!has - '//*[@id=\"main\"]/*[@class=\"item-info\"]/*[@class=\"stab portability\"]' ''\n // @has - '//*[@id=\"method.unix_and_arm_only_function\"]' 'fn unix_and_arm_only_function()'\n // @has - '//*[@class=\"stab portability\"]' 'This is supported on Unix and ARM only.'\n+// @has - '//*[@id=\"method.wasi_and_wasm32_only_function\"]' 'fn wasi_and_wasm32_only_function()'\n+// @has - '//*[@class=\"stab portability\"]' 'This is supported on WASI and WebAssembly only.'\n pub struct Portable;\n \n // @has doc_cfg/unix_only/index.html \\\n@@ -37,6 +39,36 @@ pub mod unix_only {\n     }\n }\n \n+// @has doc_cfg/wasi_only/index.html \\\n+//  '//*[@id=\"main\"]/*[@class=\"item-info\"]/*[@class=\"stab portability\"]' \\\n+//  'This is supported on WASI only.'\n+// @matches - '//*[@class=\"module-item\"]//*[@class=\"stab portability\"]' '\\AWebAssembly\\Z'\n+// @count - '//*[@class=\"stab portability\"]' 2\n+#[doc(cfg(target_os = \"wasi\"))]\n+pub mod wasi_only {\n+    // @has doc_cfg/wasi_only/fn.wasi_only_function.html \\\n+    //  '//*[@id=\"main\"]/*[@class=\"item-info\"]/*[@class=\"stab portability\"]' \\\n+    //  'This is supported on WASI only.'\n+    // @count - '//*[@class=\"stab portability\"]' 1\n+    pub fn wasi_only_function() {\n+        content::should::be::irrelevant();\n+    }\n+\n+    // @has doc_cfg/wasi_only/trait.Wasm32Only.html \\\n+    //  '//*[@id=\"main\"]/*[@class=\"item-info\"]/*[@class=\"stab portability\"]' \\\n+    //  'This is supported on WASI and WebAssembly only.'\n+    // @count - '//*[@class=\"stab portability\"]' 1\n+    #[doc(cfg(target_arch = \"wasm32\"))]\n+    pub trait Wasm32Only {\n+        fn wasi_and_wasm32_only_function();\n+    }\n+\n+    #[doc(cfg(target_arch = \"wasm32\"))]\n+    impl Wasm32Only for super::Portable {\n+        fn wasi_and_wasm32_only_function() {}\n+    }\n+}\n+\n // tagging a function with `#[target_feature]` creates a doc(cfg(target_feature)) node for that\n // item as well\n "}]}