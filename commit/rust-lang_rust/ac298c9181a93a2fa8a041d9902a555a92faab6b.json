{"sha": "ac298c9181a93a2fa8a041d9902a555a92faab6b", "node_id": "C_kwDOAAsO6NoAKGFjMjk4YzkxODFhOTNhMmZhOGEwNDFkOTkwMmE1NTVhOTJmYWFiNmI", "commit": {"author": {"name": "Hans Kratz", "email": "hans@appfour.com", "date": "2021-10-14T17:37:26Z"}, "committer": {"name": "Hans Kratz", "email": "hans@appfour.com", "date": "2021-10-15T05:45:27Z"}, "message": "Make `rust.download-ci-llvm=\"if-available\"` work for tier 2 platforms.", "tree": {"sha": "9280a13f12377b6a0d90b970e63ca366eff4059c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9280a13f12377b6a0d90b970e63ca366eff4059c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac298c9181a93a2fa8a041d9902a555a92faab6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac298c9181a93a2fa8a041d9902a555a92faab6b", "html_url": "https://github.com/rust-lang/rust/commit/ac298c9181a93a2fa8a041d9902a555a92faab6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac298c9181a93a2fa8a041d9902a555a92faab6b/comments", "author": {"login": "hkratz", "id": 3736990, "node_id": "MDQ6VXNlcjM3MzY5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3736990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkratz", "html_url": "https://github.com/hkratz", "followers_url": "https://api.github.com/users/hkratz/followers", "following_url": "https://api.github.com/users/hkratz/following{/other_user}", "gists_url": "https://api.github.com/users/hkratz/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkratz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkratz/subscriptions", "organizations_url": "https://api.github.com/users/hkratz/orgs", "repos_url": "https://api.github.com/users/hkratz/repos", "events_url": "https://api.github.com/users/hkratz/events{/privacy}", "received_events_url": "https://api.github.com/users/hkratz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hkratz", "id": 3736990, "node_id": "MDQ6VXNlcjM3MzY5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3736990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkratz", "html_url": "https://github.com/hkratz", "followers_url": "https://api.github.com/users/hkratz/followers", "following_url": "https://api.github.com/users/hkratz/following{/other_user}", "gists_url": "https://api.github.com/users/hkratz/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkratz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkratz/subscriptions", "organizations_url": "https://api.github.com/users/hkratz/orgs", "repos_url": "https://api.github.com/users/hkratz/repos", "events_url": "https://api.github.com/users/hkratz/events{/privacy}", "received_events_url": "https://api.github.com/users/hkratz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c852bc15a058022c9d4175e8ed60da628960800", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c852bc15a058022c9d4175e8ed60da628960800", "html_url": "https://github.com/rust-lang/rust/commit/8c852bc15a058022c9d4175e8ed60da628960800"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "dc1447b4ae4d157e97367faa551432dfa6ba2718", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ac298c9181a93a2fa8a041d9902a555a92faab6b/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/ac298c9181a93a2fa8a041d9902a555a92faab6b/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=ac298c9181a93a2fa8a041d9902a555a92faab6b", "patch": "@@ -492,10 +492,11 @@ def download_toolchain(self, stage0=True, rustc_channel=None):\n \n     def downloading_llvm(self):\n         opt = self.get_toml('download-ci-llvm', 'llvm')\n-        # This is currently all tier 1 targets (since others may not have CI\n-        # artifacts)\n+        # This is currently all tier 1 targets and tier 2 targets with host tools\n+        # (since others may not have CI artifacts)\n         # https://doc.rust-lang.org/rustc/platform-support.html#tier-1\n         supported_platforms = [\n+            # tier 1\n             \"aarch64-unknown-linux-gnu\",\n             \"i686-pc-windows-gnu\",\n             \"i686-pc-windows-msvc\",\n@@ -504,6 +505,26 @@ def downloading_llvm(self):\n             \"x86_64-apple-darwin\",\n             \"x86_64-pc-windows-gnu\",\n             \"x86_64-pc-windows-msvc\",\n+            # tier 2 with host tools\n+            \"aarch64-apple-darwin\",\n+            \"aarch64-pc-windows-msvc\",\n+            \"aarch64-unknown-linux-musl\",\n+            \"arm-unknown-linux-gnueabi\",\n+            \"arm-unknown-linux-gnueabihf\",\n+            \"armv7-unknown-linux-gnueabihf\",\n+            \"mips-unknown-linux-gnu\",\n+            \"mips64-unknown-linux-gnuabi64\",\n+            \"mips64el-unknown-linux-gnuabi64\",\n+            \"mipsel-unknown-linux-gnu\",\n+            \"powerpc-unknown-linux-gnu\",\n+            \"powerpc64-unknown-linux-gnu\",\n+            \"powerpc64le-unknown-linux-gnu\",\n+            \"riscv64gc-unknown-linux-gnu\",\n+            \"s390x-unknown-linux-gnu\",\n+            \"x86_64-unknown-freebsd\",\n+            \"x86_64-unknown-illumos\",\n+            \"x86_64-unknown-linux-musl\",\n+            \"x86_64-unknown-netbsd\",\n         ]\n         return opt == \"true\" \\\n             or (opt == \"if-available\" and self.build in supported_platforms)"}, {"sha": "96fc8b5a35bf4cb9f49a8bf539be00fcd4aaafe3", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ac298c9181a93a2fa8a041d9902a555a92faab6b/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac298c9181a93a2fa8a041d9902a555a92faab6b/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=ac298c9181a93a2fa8a041d9902a555a92faab6b", "patch": "@@ -765,10 +765,12 @@ impl Config {\n             config.llvm_from_ci = match llvm.download_ci_llvm {\n                 Some(StringOrBool::String(s)) => {\n                     assert!(s == \"if-available\", \"unknown option `{}` for download-ci-llvm\", s);\n-                    // This is currently all tier 1 targets (since others may not have CI artifacts)\n+                    // This is currently all tier 1 targets and tier 2 targets with host tools\n+                    // (since others may not have CI artifacts)\n                     // https://doc.rust-lang.org/rustc/platform-support.html#tier-1\n                     // FIXME: this is duplicated in bootstrap.py\n                     let supported_platforms = [\n+                        // tier 1\n                         \"aarch64-unknown-linux-gnu\",\n                         \"i686-pc-windows-gnu\",\n                         \"i686-pc-windows-msvc\",\n@@ -777,6 +779,26 @@ impl Config {\n                         \"x86_64-apple-darwin\",\n                         \"x86_64-pc-windows-gnu\",\n                         \"x86_64-pc-windows-msvc\",\n+                        // tier 2 with host tools\n+                        \"aarch64-apple-darwin\",\n+                        \"aarch64-pc-windows-msvc\",\n+                        \"aarch64-unknown-linux-musl\",\n+                        \"arm-unknown-linux-gnueabi\",\n+                        \"arm-unknown-linux-gnueabihf\",\n+                        \"armv7-unknown-linux-gnueabihf\",\n+                        \"mips-unknown-linux-gnu\",\n+                        \"mips64-unknown-linux-gnuabi64\",\n+                        \"mips64el-unknown-linux-gnuabi64\",\n+                        \"mipsel-unknown-linux-gnu\",\n+                        \"powerpc-unknown-linux-gnu\",\n+                        \"powerpc64-unknown-linux-gnu\",\n+                        \"powerpc64le-unknown-linux-gnu\",\n+                        \"riscv64gc-unknown-linux-gnu\",\n+                        \"s390x-unknown-linux-gnu\",\n+                        \"x86_64-unknown-freebsd\",\n+                        \"x86_64-unknown-illumos\",\n+                        \"x86_64-unknown-linux-musl\",\n+                        \"x86_64-unknown-netbsd\",\n                     ];\n                     supported_platforms.contains(&&*config.build.triple)\n                 }"}]}