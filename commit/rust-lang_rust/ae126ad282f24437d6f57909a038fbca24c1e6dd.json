{"sha": "ae126ad282f24437d6f57909a038fbca24c1e6dd", "node_id": "C_kwDOAAsO6NoAKGFlMTI2YWQyODJmMjQ0MzdkNmY1NzkwOWEwMzhmYmNhMjRjMWU2ZGQ", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-11-21T15:16:02Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-11-23T21:06:22Z"}, "message": "Do not visit attributes in `ItemLowerer`.\n\nBy default, AST visitors visit expressions that appear in key-value attributes.\nThose expressions should not be lowered to HIR, as they do not correspond to actually compiled code.\n\nSince an attribute cannot produce meaningful HIR, just skip them altogether.", "tree": {"sha": "20d6b6bd430108a76b4bf5f5bdae9cbb5c14b6d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20d6b6bd430108a76b4bf5f5bdae9cbb5c14b6d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae126ad282f24437d6f57909a038fbca24c1e6dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae126ad282f24437d6f57909a038fbca24c1e6dd", "html_url": "https://github.com/rust-lang/rust/commit/ae126ad282f24437d6f57909a038fbca24c1e6dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae126ad282f24437d6f57909a038fbca24c1e6dd/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b3cd075bbe309031b418650a9c32baf0b4a3276", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b3cd075bbe309031b418650a9c32baf0b4a3276", "html_url": "https://github.com/rust-lang/rust/commit/7b3cd075bbe309031b418650a9c32baf0b4a3276"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "692f39368243aaa0c52ce0242504c2f81611536d", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ae126ad282f24437d6f57909a038fbca24c1e6dd/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae126ad282f24437d6f57909a038fbca24c1e6dd/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=ae126ad282f24437d6f57909a038fbca24c1e6dd", "patch": "@@ -40,6 +40,11 @@ impl ItemLowerer<'_, '_, '_> {\n }\n \n impl<'a> Visitor<'a> for ItemLowerer<'a, '_, '_> {\n+    fn visit_attribute(&mut self, _: &'a Attribute) {\n+        // We do not want to lower expressions that appear in attributes,\n+        // as they are not accessible to the rest of the HIR.\n+    }\n+\n     fn visit_item(&mut self, item: &'a Item) {\n         let hir_id = self.lctx.with_hir_id_owner(item.id, |lctx| {\n             let node = lctx.without_in_scope_lifetime_defs(|lctx| lctx.lower_item(item));"}, {"sha": "79ec59e4dc01f9e8df854713ec8057f61260c8b5", "filename": "src/test/ui/attributes/issue-90873.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ae126ad282f24437d6f57909a038fbca24c1e6dd/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae126ad282f24437d6f57909a038fbca24c1e6dd/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs?ref=ae126ad282f24437d6f57909a038fbca24c1e6dd", "patch": "@@ -0,0 +1,5 @@\n+#![u=||{static d=||1;}]\n+//~^ unexpected token\n+//~| cannot find attribute `u` in this scope\n+//~| `main` function not found in crate `issue_90873`\n+//~| missing type for `static` item"}, {"sha": "b249be8d0e23ad6eef08eb5f6d1077255b2f48ca", "filename": "src/test/ui/attributes/issue-90873.stderr", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/ae126ad282f24437d6f57909a038fbca24c1e6dd/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ae126ad282f24437d6f57909a038fbca24c1e6dd/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr?ref=ae126ad282f24437d6f57909a038fbca24c1e6dd", "patch": "@@ -0,0 +1,30 @@\n+error: unexpected token: `||\n+           {\n+               static d: _ = || 1;\n+           }`\n+  --> $DIR/issue-90873.rs:1:6\n+   |\n+LL | #![u=||{static d=||1;}]\n+   |      ^^^^^^^^^^^^^^^^^\n+\n+error: cannot find attribute `u` in this scope\n+  --> $DIR/issue-90873.rs:1:4\n+   |\n+LL | #![u=||{static d=||1;}]\n+   |    ^\n+\n+error[E0601]: `main` function not found in crate `issue_90873`\n+  --> $DIR/issue-90873.rs:1:1\n+   |\n+LL | #![u=||{static d=||1;}]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^ consider adding a `main` function to `$DIR/issue-90873.rs`\n+\n+error: missing type for `static` item\n+  --> $DIR/issue-90873.rs:1:16\n+   |\n+LL | #![u=||{static d=||1;}]\n+   |                ^ help: provide a type for the item: `d: <type>`\n+\n+error: aborting due to 4 previous errors\n+\n+For more information about this error, try `rustc --explain E0601`."}]}