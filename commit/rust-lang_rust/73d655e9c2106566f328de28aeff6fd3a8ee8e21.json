{"sha": "73d655e9c2106566f328de28aeff6fd3a8ee8e21", "node_id": "C_kwDOAAsO6NoAKDczZDY1NWU5YzIxMDY1NjZmMzI4ZGUyOGFlZmY2ZmQzYThlZThlMjE", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-10-16T08:38:48Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-10-16T09:34:24Z"}, "message": "remove redundant Send impls for references\n\nalso move them next to the trait they are implementing", "tree": {"sha": "ca86087ce5a6a185ee6491b860e6155afc189ab3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca86087ce5a6a185ee6491b860e6155afc189ab3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73d655e9c2106566f328de28aeff6fd3a8ee8e21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73d655e9c2106566f328de28aeff6fd3a8ee8e21", "html_url": "https://github.com/rust-lang/rust/commit/73d655e9c2106566f328de28aeff6fd3a8ee8e21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73d655e9c2106566f328de28aeff6fd3a8ee8e21/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edabf59ca4646b3fc1a961c26431215001043f6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/edabf59ca4646b3fc1a961c26431215001043f6a", "html_url": "https://github.com/rust-lang/rust/commit/edabf59ca4646b3fc1a961c26431215001043f6a"}], "stats": {"total": 15, "additions": 7, "deletions": 8}, "files": [{"sha": "bb10caee6e2dddd7a5ca9c16a060abe98f0752bc", "filename": "library/core/src/marker.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/73d655e9c2106566f328de28aeff6fd3a8ee8e21/library%2Fcore%2Fsrc%2Fmarker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73d655e9c2106566f328de28aeff6fd3a8ee8e21/library%2Fcore%2Fsrc%2Fmarker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmarker.rs?ref=73d655e9c2106566f328de28aeff6fd3a8ee8e21", "patch": "@@ -44,6 +44,12 @@ impl<T: ?Sized> !Send for *const T {}\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<T: ?Sized> !Send for *mut T {}\n \n+// Most instances arise automatically, but this instance is needed to link up `T: Sync` with\n+// `&T: Send` (and it also removes the unsound default instance `T Send` -> `&T: Send` that would\n+// otherwise exist).\n+#[stable(feature = \"rust1\", since = \"1.0.0\")]\n+unsafe impl<T: Sync + ?Sized> Send for &T {}\n+\n /// Types with a constant size known at compile time.\n ///\n /// All type parameters have an implicit bound of `Sized`. The special syntax\n@@ -680,13 +686,6 @@ pub struct PhantomData<T: ?Sized>;\n \n impls! { PhantomData }\n \n-mod impls {\n-    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    unsafe impl<T: Sync + ?Sized> Send for &T {}\n-    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    unsafe impl<T: Send + ?Sized> Send for &mut T {}\n-}\n-\n /// Compiler-internal trait used to indicate the type of enum discriminants.\n ///\n /// This trait is automatically implemented for every type and does not add any"}, {"sha": "a7b872fe4444aecd4317b3671d8c58125d1a7549", "filename": "src/test/ui/async-await/async-fn-nonsend.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/73d655e9c2106566f328de28aeff6fd3a8ee8e21/src%2Ftest%2Fui%2Fasync-await%2Fasync-fn-nonsend.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/73d655e9c2106566f328de28aeff6fd3a8ee8e21/src%2Ftest%2Fui%2Fasync-await%2Fasync-fn-nonsend.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fasync-fn-nonsend.stderr?ref=73d655e9c2106566f328de28aeff6fd3a8ee8e21", "patch": "@@ -27,7 +27,7 @@ error: future cannot be sent between threads safely\n LL |     assert_send(non_sync_with_method_call());\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^ future returned by `non_sync_with_method_call` is not `Send`\n    |\n-   = help: the trait `Send` is not implemented for `dyn std::fmt::Write`\n+   = help: within `impl Future<Output = ()>`, the trait `Send` is not implemented for `dyn std::fmt::Write`\n note: future is not `Send` as this value is used across an await\n   --> $DIR/async-fn-nonsend.rs:46:14\n    |"}]}