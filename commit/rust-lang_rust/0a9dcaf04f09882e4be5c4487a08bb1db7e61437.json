{"sha": "0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhOWRjYWYwNGYwOTg4MmU0YmU1YzQ0ODdhMDhiYjFkYjdlNjE0Mzc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-03T22:58:06Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-04T09:54:01Z"}, "message": "add warnings for unused lifetime parameters", "tree": {"sha": "fb5a692aadd0ea4359e86a30dfbda89fe122137f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb5a692aadd0ea4359e86a30dfbda89fe122137f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "html_url": "https://github.com/rust-lang/rust/commit/0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aef29a058370f2941bed3fec600a95343554c436", "url": "https://api.github.com/repos/rust-lang/rust/commits/aef29a058370f2941bed3fec600a95343554c436", "html_url": "https://github.com/rust-lang/rust/commit/aef29a058370f2941bed3fec600a95343554c436"}], "stats": {"total": 97, "additions": 95, "deletions": 2}, "files": [{"sha": "0606ecb9bbccd3b2daa02e63590fe17d22da40d8", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -233,7 +233,13 @@ declare_lint! {\n declare_lint! {\n     pub SINGLE_USE_LIFETIME,\n     Allow,\n-   \"detects single use lifetimes\"\n+    \"detects lifetime parameters that are only used once\"\n+}\n+\n+declare_lint! {\n+    pub UNUSED_LIFETIME,\n+    Allow,\n+    \"detects lifetime parameters that are never used\"\n }\n \n declare_lint! {\n@@ -318,6 +324,7 @@ impl LintPass for HardwiredLints {\n             UNUSED_UNSAFE,\n             UNUSED_MUT,\n             SINGLE_USE_LIFETIME,\n+            UNUSED_LIFETIME,\n             TYVAR_BEHIND_RAW_POINTER,\n             ELIDED_LIFETIME_IN_PATH,\n             BARE_TRAIT_OBJECT,"}, {"sha": "49a88323653122f3ee449d64cf07a8d9e2c0efa4", "filename": "src/librustc/middle/resolve_lifetime.rs", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -1358,7 +1358,25 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n                 Some(LifetimeUseSet::Many) => {\n                     debug!(\"Not one use lifetime\");\n                 }\n-                None => {}\n+                None => {\n+                    let node_id = self.tcx.hir.as_local_node_id(*def_id).unwrap();\n+                    if let hir::map::NodeLifetime(hir_lifetime) = self.tcx.hir.get(node_id) {\n+                        let span = hir_lifetime.span;\n+                        let id = hir_lifetime.id;\n+\n+                        self.tcx\n+                            .struct_span_lint_node(\n+                                lint::builtin::UNUSED_LIFETIME,\n+                                id,\n+                                span,\n+                                &format!(\n+                                    \"lifetime parameter `{}` never used\",\n+                                    hir_lifetime.name.name()\n+                                ),\n+                            )\n+                            .emit();\n+                    }\n+                }\n             }\n         }\n     }"}, {"sha": "b71b189833a72d750c3e838d1aaa7be7ca8676e2", "filename": "src/test/ui/single-use-lifetime/zero-uses-in-fn.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.rs?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we DO warn when lifetime name is not used at all.\n+\n+#![deny(unused_lifetime)]\n+#![allow(dead_code)]\n+#![allow(unused_variables)]\n+\n+fn d<'a>() { } //~ ERROR `'a` never used\n+\n+fn main() { }"}, {"sha": "f1cdc6e495aa79b890918a391aea2bea1ec56b29", "filename": "src/test/ui/single-use-lifetime/zero-uses-in-fn.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-fn.stderr?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -0,0 +1,14 @@\n+error: lifetime parameter `'a` never used\n+  --> $DIR/zero-uses-in-fn.rs:17:6\n+   |\n+LL | fn d<'a>() { } //~ ERROR `'a` never used\n+   |      ^^\n+   |\n+note: lint level defined here\n+  --> $DIR/zero-uses-in-fn.rs:13:9\n+   |\n+LL | #![deny(unused_lifetime)]\n+   |         ^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "6a09727015fa264992ec2a967e688f9a707d2949", "filename": "src/test/ui/single-use-lifetime/zero-uses-in-impl.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.rs?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we DO warn when lifetime name is not used at all.\n+\n+#![deny(unused_lifetime)]\n+#![allow(dead_code)]\n+#![allow(unused_variables)]\n+\n+struct Foo { }\n+\n+impl<'a> Foo { } //~ ERROR `'a` never used\n+\n+fn main() { }"}, {"sha": "d2dd26e68a289441e123fd5d0b5e8895e3db3b2f", "filename": "src/test/ui/single-use-lifetime/zero-uses-in-impl.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0a9dcaf04f09882e4be5c4487a08bb1db7e61437/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsingle-use-lifetime%2Fzero-uses-in-impl.stderr?ref=0a9dcaf04f09882e4be5c4487a08bb1db7e61437", "patch": "@@ -0,0 +1,14 @@\n+error: lifetime parameter `'a` never used\n+  --> $DIR/zero-uses-in-impl.rs:19:6\n+   |\n+LL | impl<'a> Foo { } //~ ERROR `'a` never used\n+   |      ^^\n+   |\n+note: lint level defined here\n+  --> $DIR/zero-uses-in-impl.rs:13:9\n+   |\n+LL | #![deny(unused_lifetime)]\n+   |         ^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}