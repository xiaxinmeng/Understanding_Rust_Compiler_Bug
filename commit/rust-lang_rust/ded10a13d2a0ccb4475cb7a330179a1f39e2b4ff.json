{"sha": "ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "node_id": "C_kwDOAAsO6NoAKGRlZDEwYTEzZDJhMGNjYjQ0NzVjYjdhMzMwMTc5YTFmMzllMmI0ZmY", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-11-25T23:10:04Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-11-26T09:08:25Z"}, "message": "will not suggest for postfix operator when can not handle precedences well", "tree": {"sha": "b5d6d45c0c5476df20f017ea4c902b589771a126", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5d6d45c0c5476df20f017ea4c902b589771a126"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "html_url": "https://github.com/rust-lang/rust/commit/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dee85a391f091f314a24fb5a090f2e528f4eb81c", "url": "https://api.github.com/repos/rust-lang/rust/commits/dee85a391f091f314a24fb5a090f2e528f4eb81c", "html_url": "https://github.com/rust-lang/rust/commit/dee85a391f091f314a24fb5a090f2e528f4eb81c"}], "stats": {"total": 54, "additions": 43, "deletions": 11}, "files": [{"sha": "a9555cddb1b43fcd4e90859fd69fc6b718c5dc8c", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "patch": "@@ -1316,7 +1316,11 @@ impl<'a> Parser<'a> {\n                         self.prefix_inc_dec_suggest(base_src, kind, spans).emit(&mut err)\n                     }\n                     UnaryFixity::Post => {\n-                        self.postfix_inc_dec_suggest(base_src, kind, spans).emit(&mut err)\n+                        // won't suggest since we can not handle the precedences\n+                        // for example: `a + b++` has been parsed (a + b)++ and we can not suggest here\n+                        if !matches!(base.kind, ExprKind::Binary(_, _, _)) {\n+                            self.postfix_inc_dec_suggest(base_src, kind, spans).emit(&mut err)\n+                        }\n                     }\n                 }\n             }"}, {"sha": "a006421a975d992391fca0fdeca82abaa6f359ae", "filename": "src/test/ui/parser/issue-104867-inc-dec-2.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.rs?ref=ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "patch": "@@ -16,6 +16,7 @@ fn test3() {\n fn test4() {\n     let mut i = 0;\n     let _ = i + i++; //~ ERROR Rust has no postfix increment operator\n+    // won't suggest since we can not handle the precedences\n }\n \n fn test5() {\n@@ -38,4 +39,14 @@ fn test8() {\n     let _ = i++ + ++i; //~ ERROR Rust has no postfix increment operator\n }\n \n+fn test9() {\n+    let mut i = 0;\n+    let _ = (1 + 2 + i)++; //~ ERROR Rust has no postfix increment operator\n+}\n+\n+fn test10() {\n+    let mut i = 0;\n+    let _ = (i++ + 1) + 2; //~ ERROR Rust has no postfix increment operator\n+}\n+\n fn main() { }"}, {"sha": "4e2d0546851e3a62e3ab62ea6dec029f798403e9", "filename": "src/test/ui/parser/issue-104867-inc-dec-2.stderr", "status": "modified", "additions": 27, "deletions": 10, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-104867-inc-dec-2.stderr?ref=ded10a13d2a0ccb4475cb7a330179a1f39e2b4ff", "patch": "@@ -36,14 +36,9 @@ error: Rust has no postfix increment operator\n    |\n LL |     let _ = i + i++;\n    |                  ^^ not a valid postfix operator\n-   |\n-help: use `+= 1` instead\n-   |\n-LL |     let _ = { let tmp = i + i; i + i += 1; tmp };\n-   |             +++++++++++      ~~~~~~~~~~~~~~~~~~~\n \n error: Rust has no postfix increment operator\n-  --> $DIR/issue-104867-inc-dec-2.rs:23:14\n+  --> $DIR/issue-104867-inc-dec-2.rs:24:14\n    |\n LL |     let _ = i++ + i;\n    |              ^^ not a valid postfix operator\n@@ -54,7 +49,7 @@ LL |     let _ = { let tmp = i; i += 1; tmp } + i;\n    |             +++++++++++  ~~~~~~~~~~~~~~~\n \n error: Rust has no postfix increment operator\n-  --> $DIR/issue-104867-inc-dec-2.rs:28:14\n+  --> $DIR/issue-104867-inc-dec-2.rs:29:14\n    |\n LL |     let _ = i++ + i++;\n    |              ^^ not a valid postfix operator\n@@ -65,7 +60,7 @@ LL |     let _ = { let tmp = i; i += 1; tmp } + i++;\n    |             +++++++++++  ~~~~~~~~~~~~~~~\n \n error: Rust has no prefix increment operator\n-  --> $DIR/issue-104867-inc-dec-2.rs:33:13\n+  --> $DIR/issue-104867-inc-dec-2.rs:34:13\n    |\n LL |     let _ = ++i + i++;\n    |             ^^ not a valid prefix operator\n@@ -76,7 +71,7 @@ LL |     let _ = { i += 1; i } + i++;\n    |             ~   +++++++++\n \n error: Rust has no postfix increment operator\n-  --> $DIR/issue-104867-inc-dec-2.rs:38:14\n+  --> $DIR/issue-104867-inc-dec-2.rs:39:14\n    |\n LL |     let _ = i++ + ++i;\n    |              ^^ not a valid postfix operator\n@@ -86,5 +81,27 @@ help: use `+= 1` instead\n LL |     let _ = { let tmp = i; i += 1; tmp } + ++i;\n    |             +++++++++++  ~~~~~~~~~~~~~~~\n \n-error: aborting due to 8 previous errors\n+error: Rust has no postfix increment operator\n+  --> $DIR/issue-104867-inc-dec-2.rs:44:24\n+   |\n+LL |     let _ = (1 + 2 + i)++;\n+   |                        ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     let _ = { let tmp = (1 + 2 + i); (1 + 2 + i) += 1; tmp };\n+   |             +++++++++++            ~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/issue-104867-inc-dec-2.rs:49:15\n+   |\n+LL |     let _ = (i++ + 1) + 2;\n+   |               ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     let _ = ({ let tmp = i; i += 1; tmp } + 1) + 2;\n+   |              +++++++++++  ~~~~~~~~~~~~~~~\n+\n+error: aborting due to 10 previous errors\n "}]}