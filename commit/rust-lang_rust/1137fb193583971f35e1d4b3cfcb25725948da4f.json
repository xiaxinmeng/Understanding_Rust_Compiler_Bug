{"sha": "1137fb193583971f35e1d4b3cfcb25725948da4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExMzdmYjE5MzU4Mzk3MWYzNWUxZDRiM2NmY2IyNTcyNTk0OGRhNGY=", "commit": {"author": {"name": "Michael Lamparski", "email": "diagonaldevice@gmail.com", "date": "2018-02-07T14:32:26Z"}, "committer": {"name": "Michael Lamparski", "email": "diagonaldevice@gmail.com", "date": "2018-02-07T17:48:21Z"}, "message": "libsyntax/ext: trailing commas in builtin macros\n\nMost notably this changes 'syntax::ext::base::get_single_str_from_tts'\nto accept a trailing comma, and revises the documentation so that this\naspect is not surprising. I made this change under the understanding\nthat this crate is private rustc implementation detail (I hope this is\ncorrect!). After reviewing all call sites, I believe the revised\nsemantics are closer to the intended spirit of the function.", "tree": {"sha": "9cdab0fc2cd3facbad058dddd2125e323ba8dff3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9cdab0fc2cd3facbad058dddd2125e323ba8dff3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1137fb193583971f35e1d4b3cfcb25725948da4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1137fb193583971f35e1d4b3cfcb25725948da4f", "html_url": "https://github.com/rust-lang/rust/commit/1137fb193583971f35e1d4b3cfcb25725948da4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1137fb193583971f35e1d4b3cfcb25725948da4f/comments", "author": {"login": "ExpHP", "id": 1411280, "node_id": "MDQ6VXNlcjE0MTEyODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1411280?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ExpHP", "html_url": "https://github.com/ExpHP", "followers_url": "https://api.github.com/users/ExpHP/followers", "following_url": "https://api.github.com/users/ExpHP/following{/other_user}", "gists_url": "https://api.github.com/users/ExpHP/gists{/gist_id}", "starred_url": "https://api.github.com/users/ExpHP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ExpHP/subscriptions", "organizations_url": "https://api.github.com/users/ExpHP/orgs", "repos_url": "https://api.github.com/users/ExpHP/repos", "events_url": "https://api.github.com/users/ExpHP/events{/privacy}", "received_events_url": "https://api.github.com/users/ExpHP/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ExpHP", "id": 1411280, "node_id": "MDQ6VXNlcjE0MTEyODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1411280?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ExpHP", "html_url": "https://github.com/ExpHP", "followers_url": "https://api.github.com/users/ExpHP/followers", "following_url": "https://api.github.com/users/ExpHP/following{/other_user}", "gists_url": "https://api.github.com/users/ExpHP/gists{/gist_id}", "starred_url": "https://api.github.com/users/ExpHP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ExpHP/subscriptions", "organizations_url": "https://api.github.com/users/ExpHP/orgs", "repos_url": "https://api.github.com/users/ExpHP/repos", "events_url": "https://api.github.com/users/ExpHP/events{/privacy}", "received_events_url": "https://api.github.com/users/ExpHP/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96eed862a08f0ee1d234f4f83419dd46fe58ccef", "url": "https://api.github.com/repos/rust-lang/rust/commits/96eed862a08f0ee1d234f4f83419dd46fe58ccef", "html_url": "https://github.com/rust-lang/rust/commit/96eed862a08f0ee1d234f4f83419dd46fe58ccef"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "520ec942e42886f18df157c653874649b31f0fe2", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1137fb193583971f35e1d4b3cfcb25725948da4f/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1137fb193583971f35e1d4b3cfcb25725948da4f/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=1137fb193583971f35e1d4b3cfcb25725948da4f", "patch": "@@ -890,8 +890,8 @@ pub fn check_zero_tts(cx: &ExtCtxt,\n     }\n }\n \n-/// Extract the string literal from the first token of `tts`. If this\n-/// is not a string literal, emit an error and return None.\n+/// Interpreting `tts` as a comma-separated sequence of expressions,\n+/// expect exactly one string literal, or emit an error and return None.\n pub fn get_single_str_from_tts(cx: &mut ExtCtxt,\n                                sp: Span,\n                                tts: &[tokenstream::TokenTree],\n@@ -903,6 +903,8 @@ pub fn get_single_str_from_tts(cx: &mut ExtCtxt,\n         return None\n     }\n     let ret = panictry!(p.parse_expr());\n+    let _ = p.eat(&token::Comma);\n+\n     if p.token != token::Eof {\n         cx.span_err(sp, &format!(\"{} takes 1 argument\", name));\n     }"}, {"sha": "1eeba9b30b8e24f5a481a2fd3011c47d10e22d77", "filename": "src/libsyntax_ext/cfg.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1137fb193583971f35e1d4b3cfcb25725948da4f/src%2Flibsyntax_ext%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1137fb193583971f35e1d4b3cfcb25725948da4f/src%2Flibsyntax_ext%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fcfg.rs?ref=1137fb193583971f35e1d4b3cfcb25725948da4f", "patch": "@@ -28,6 +28,8 @@ pub fn expand_cfg<'cx>(cx: &mut ExtCtxt,\n     let mut p = cx.new_parser_from_tts(tts);\n     let cfg = panictry!(p.parse_meta_item());\n \n+    let _ = p.eat(&token::Comma);\n+\n     if !p.eat(&token::Eof) {\n         cx.span_err(sp, \"expected 1 cfg-pattern\");\n         return DummyResult::expr(sp);"}]}