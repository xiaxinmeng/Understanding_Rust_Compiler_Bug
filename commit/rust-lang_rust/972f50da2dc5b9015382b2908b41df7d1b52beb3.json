{"sha": "972f50da2dc5b9015382b2908b41df7d1b52beb3", "node_id": "C_kwDOAAsO6NoAKDk3MmY1MGRhMmRjNWI5MDE1MzgyYjI5MDhiNDFkZjdkMWI1MmJlYjM", "commit": {"author": {"name": "Steven Joruk", "email": "steven@joruk.com", "date": "2022-03-11T19:22:49Z"}, "committer": {"name": "Steven Joruk", "email": "steven@joruk.com", "date": "2022-03-11T19:51:35Z"}, "message": "fix: Stop wrapping ConstParam's default values in ConstArg\n\nThis was causing ConstParam::default_val to always return None for block\nexpressions.\n\nCONST_ARG@24..29\n  BLOCK_EXPR@24..29\n    ...", "tree": {"sha": "6e28a5f5953b1b70f300d3bfd53939060351ccde", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e28a5f5953b1b70f300d3bfd53939060351ccde"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/972f50da2dc5b9015382b2908b41df7d1b52beb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/972f50da2dc5b9015382b2908b41df7d1b52beb3", "html_url": "https://github.com/rust-lang/rust/commit/972f50da2dc5b9015382b2908b41df7d1b52beb3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/972f50da2dc5b9015382b2908b41df7d1b52beb3/comments", "author": {"login": "steven-joruk", "id": 1277939, "node_id": "MDQ6VXNlcjEyNzc5Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1277939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steven-joruk", "html_url": "https://github.com/steven-joruk", "followers_url": "https://api.github.com/users/steven-joruk/followers", "following_url": "https://api.github.com/users/steven-joruk/following{/other_user}", "gists_url": "https://api.github.com/users/steven-joruk/gists{/gist_id}", "starred_url": "https://api.github.com/users/steven-joruk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steven-joruk/subscriptions", "organizations_url": "https://api.github.com/users/steven-joruk/orgs", "repos_url": "https://api.github.com/users/steven-joruk/repos", "events_url": "https://api.github.com/users/steven-joruk/events{/privacy}", "received_events_url": "https://api.github.com/users/steven-joruk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steven-joruk", "id": 1277939, "node_id": "MDQ6VXNlcjEyNzc5Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1277939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steven-joruk", "html_url": "https://github.com/steven-joruk", "followers_url": "https://api.github.com/users/steven-joruk/followers", "following_url": "https://api.github.com/users/steven-joruk/following{/other_user}", "gists_url": "https://api.github.com/users/steven-joruk/gists{/gist_id}", "starred_url": "https://api.github.com/users/steven-joruk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steven-joruk/subscriptions", "organizations_url": "https://api.github.com/users/steven-joruk/orgs", "repos_url": "https://api.github.com/users/steven-joruk/repos", "events_url": "https://api.github.com/users/steven-joruk/events{/privacy}", "received_events_url": "https://api.github.com/users/steven-joruk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "224a255c5a7c75efb5567fc38b3772c5dbb094c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/224a255c5a7c75efb5567fc38b3772c5dbb094c4", "html_url": "https://github.com/rust-lang/rust/commit/224a255c5a7c75efb5567fc38b3772c5dbb094c4"}], "stats": {"total": 132, "additions": 82, "deletions": 50}, "files": [{"sha": "bba312009b9390e9edcf629a2d9ce5e89d50b4ce", "filename": "crates/parser/src/grammar/generic_args.rs", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_args.rs?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -72,28 +72,24 @@ fn lifetime_arg(p: &mut Parser) {\n     m.complete(p, LIFETIME_ARG);\n }\n \n-// test const_arg\n-// type T = S<92>;\n-pub(super) fn const_arg(p: &mut Parser) {\n-    let m = p.start();\n+pub(super) fn const_arg_content(p: &mut Parser) {\n+    // The tests in here are really for `const_arg`, which wraps the content\n+    // CONST_ARG.\n     match p.current() {\n         // test const_arg_block\n         // type T = S<{90 + 2}>;\n         T!['{'] => {\n             expressions::block_expr(p);\n-            m.complete(p, CONST_ARG);\n         }\n         // test const_arg_literal\n         // type T = S<\"hello\", 0xdeadbeef>;\n         k if k.is_literal() => {\n             expressions::literal(p);\n-            m.complete(p, CONST_ARG);\n         }\n         // test const_arg_bool_literal\n         // type T = S<true>;\n         T![true] | T![false] => {\n             expressions::literal(p);\n-            m.complete(p, CONST_ARG);\n         }\n         // test const_arg_negative_number\n         // type T = S<-92>;\n@@ -102,19 +98,25 @@ pub(super) fn const_arg(p: &mut Parser) {\n             p.bump(T![-]);\n             expressions::literal(p);\n             lm.complete(p, PREFIX_EXPR);\n-            m.complete(p, CONST_ARG);\n         }\n         // test const_arg_path\n-        // struct S<const N: u32 = u32::MAX>;\n+        // type T = S<u32::MAX>;\n         _ => {\n             let lm = p.start();\n             paths::use_path(p);\n             lm.complete(p, PATH_EXPR);\n-            m.complete(p, CONST_ARG);\n         }\n     }\n }\n \n+// test const_arg\n+// type T = S<92>;\n+pub(super) fn const_arg(p: &mut Parser) {\n+    let m = p.start();\n+    const_arg_content(p);\n+    m.complete(p, CONST_ARG);\n+}\n+\n fn type_arg(p: &mut Parser) {\n     let m = p.start();\n     types::type_(p);"}, {"sha": "1c5af92b874e6fc76f70080f87ccc8b976388e45", "filename": "crates/parser/src/grammar/generic_params.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_params.rs", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_params.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fgeneric_params.rs?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -79,10 +79,13 @@ fn const_param(p: &mut Parser, m: Marker) {\n     }\n \n     if p.at(T![=]) {\n-        // test const_param_defaults\n+        // test const_param_default_literal\n         // struct A<const N: i32 = -1>;\n         p.bump(T![=]);\n-        generic_args::const_arg(p);\n+\n+        // test const_param_default_expression\n+        // struct A<const N: i32 = { 1 }>;\n+        generic_args::const_arg_content(p);\n     }\n \n     m.complete(p, CONST_PARAM);"}, {"sha": "62ddefa5a8d4ff55407dd09e1b990b27e588b334", "filename": "crates/parser/test_data/parser/inline/ok/0188_const_arg_path.rast", "status": "modified", "additions": 25, "deletions": 32, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rast", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rast?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -1,37 +1,30 @@\n SOURCE_FILE\n-  STRUCT\n-    STRUCT_KW \"struct\"\n+  TYPE_ALIAS\n+    TYPE_KW \"type\"\n     WHITESPACE \" \"\n     NAME\n-      IDENT \"S\"\n-    GENERIC_PARAM_LIST\n-      L_ANGLE \"<\"\n-      CONST_PARAM\n-        CONST_KW \"const\"\n-        WHITESPACE \" \"\n-        NAME\n-          IDENT \"N\"\n-        COLON \":\"\n-        WHITESPACE \" \"\n-        PATH_TYPE\n-          PATH\n-            PATH_SEGMENT\n-              NAME_REF\n-                IDENT \"u32\"\n-        WHITESPACE \" \"\n-        EQ \"=\"\n-        WHITESPACE \" \"\n-        CONST_ARG\n-          PATH_EXPR\n-            PATH\n-              PATH\n-                PATH_SEGMENT\n-                  NAME_REF\n-                    IDENT \"u32\"\n-              COLON2 \"::\"\n-              PATH_SEGMENT\n-                NAME_REF\n-                  IDENT \"MAX\"\n-      R_ANGLE \">\"\n+      IDENT \"T\"\n+    WHITESPACE \" \"\n+    EQ \"=\"\n+    WHITESPACE \" \"\n+    PATH_TYPE\n+      PATH\n+        PATH_SEGMENT\n+          NAME_REF\n+            IDENT \"S\"\n+          GENERIC_ARG_LIST\n+            L_ANGLE \"<\"\n+            TYPE_ARG\n+              PATH_TYPE\n+                PATH\n+                  PATH\n+                    PATH_SEGMENT\n+                      NAME_REF\n+                        IDENT \"u32\"\n+                  COLON2 \"::\"\n+                  PATH_SEGMENT\n+                    NAME_REF\n+                      IDENT \"MAX\"\n+            R_ANGLE \">\"\n     SEMICOLON \";\"\n   WHITESPACE \"\\n\""}, {"sha": "1383d0d6d5661c945ce2f4682d61b4e68cdad9cd", "filename": "crates/parser/test_data/parser/inline/ok/0188_const_arg_path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0188_const_arg_path.rs?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -1 +1 @@\n-struct S<const N: u32 = u32::MAX>;\n+type T = S<u32::MAX>;"}, {"sha": "0607ff54fbb7c505a0ba446481e08935cea5189b", "filename": "crates/parser/test_data/parser/inline/ok/0199_const_param_default_expression.rast", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rast", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rast?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -0,0 +1,34 @@\n+SOURCE_FILE\n+  STRUCT\n+    STRUCT_KW \"struct\"\n+    WHITESPACE \" \"\n+    NAME\n+      IDENT \"A\"\n+    GENERIC_PARAM_LIST\n+      L_ANGLE \"<\"\n+      CONST_PARAM\n+        CONST_KW \"const\"\n+        WHITESPACE \" \"\n+        NAME\n+          IDENT \"N\"\n+        COLON \":\"\n+        WHITESPACE \" \"\n+        PATH_TYPE\n+          PATH\n+            PATH_SEGMENT\n+              NAME_REF\n+                IDENT \"i32\"\n+        WHITESPACE \" \"\n+        EQ \"=\"\n+        WHITESPACE \" \"\n+        BLOCK_EXPR\n+          STMT_LIST\n+            L_CURLY \"{\"\n+            WHITESPACE \" \"\n+            LITERAL\n+              INT_NUMBER \"1\"\n+            WHITESPACE \" \"\n+            R_CURLY \"}\"\n+      R_ANGLE \">\"\n+    SEMICOLON \";\"\n+  WHITESPACE \"\\n\""}, {"sha": "551bde0b00862689de7e56015b8505925a1af7d6", "filename": "crates/parser/test_data/parser/inline/ok/0199_const_param_default_expression.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0199_const_param_default_expression.rs?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -0,0 +1 @@\n+struct A<const N: i32 = { 1 }>;"}, {"sha": "8e52313651ce0fb6c6eeb971dcebe206c2ee9c2b", "filename": "crates/parser/test_data/parser/inline/ok/0200_const_param_default_literal.rast", "status": "renamed", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rast", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rast?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "patch": "@@ -21,11 +21,10 @@ SOURCE_FILE\n         WHITESPACE \" \"\n         EQ \"=\"\n         WHITESPACE \" \"\n-        CONST_ARG\n-          PREFIX_EXPR\n-            MINUS \"-\"\n-            LITERAL\n-              INT_NUMBER \"1\"\n+        PREFIX_EXPR\n+          MINUS \"-\"\n+          LITERAL\n+            INT_NUMBER \"1\"\n       R_ANGLE \">\"\n     SEMICOLON \";\"\n   WHITESPACE \"\\n\"", "previous_filename": "crates/parser/test_data/parser/inline/ok/0165_const_param_defaults.rast"}, {"sha": "879ecffa75d3a89e322e5cbae4e74e274392a710", "filename": "crates/parser/test_data/parser/inline/ok/0200_const_param_default_literal.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/972f50da2dc5b9015382b2908b41df7d1b52beb3/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0200_const_param_default_literal.rs?ref=972f50da2dc5b9015382b2908b41df7d1b52beb3", "previous_filename": "crates/parser/test_data/parser/inline/ok/0165_const_param_defaults.rs"}]}