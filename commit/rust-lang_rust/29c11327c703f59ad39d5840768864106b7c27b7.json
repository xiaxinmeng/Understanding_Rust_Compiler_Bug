{"sha": "29c11327c703f59ad39d5840768864106b7c27b7", "node_id": "C_kwDOAAsO6NoAKDI5YzExMzI3YzcwM2Y1OWFkMzlkNTg0MDc2ODg2NDEwNmI3YzI3Yjc", "commit": {"author": {"name": "Nilstrieb", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2023-03-21T21:17:15Z"}, "committer": {"name": "Nilstrieb", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2023-03-21T21:20:09Z"}, "message": "Use `SmallVec` in bitsets\n\nThis doesn't increase their size and means that we don't have to heap\nallocate for small sets.", "tree": {"sha": "b7d504ae217da5ce2cdb3df6b14451416cbe45ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7d504ae217da5ce2cdb3df6b14451416cbe45ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29c11327c703f59ad39d5840768864106b7c27b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29c11327c703f59ad39d5840768864106b7c27b7", "html_url": "https://github.com/rust-lang/rust/commit/29c11327c703f59ad39d5840768864106b7c27b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29c11327c703f59ad39d5840768864106b7c27b7/comments", "author": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66676820eb801473f21006fa64315ce3c42402eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/66676820eb801473f21006fa64315ce3c42402eb", "html_url": "https://github.com/rust-lang/rust/commit/66676820eb801473f21006fa64315ce3c42402eb"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "eba5b3ed882a1073db91a67782f4cf1aafbd3e9f", "filename": "compiler/rustc_index/src/bit_set.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/29c11327c703f59ad39d5840768864106b7c27b7/compiler%2Frustc_index%2Fsrc%2Fbit_set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29c11327c703f59ad39d5840768864106b7c27b7/compiler%2Frustc_index%2Fsrc%2Fbit_set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_index%2Fsrc%2Fbit_set.rs?ref=29c11327c703f59ad39d5840768864106b7c27b7", "patch": "@@ -1,5 +1,6 @@\n use crate::vec::{Idx, IndexVec};\n use arrayvec::ArrayVec;\n+use smallvec::{smallvec, SmallVec};\n use std::fmt;\n use std::iter;\n use std::marker::PhantomData;\n@@ -111,7 +112,7 @@ macro_rules! bit_relations_inherent_impls {\n #[derive(Eq, PartialEq, Hash, Decodable, Encodable)]\n pub struct BitSet<T> {\n     domain_size: usize,\n-    words: Vec<Word>,\n+    words: SmallVec<[Word; 2]>,\n     marker: PhantomData<T>,\n }\n \n@@ -127,14 +128,15 @@ impl<T: Idx> BitSet<T> {\n     #[inline]\n     pub fn new_empty(domain_size: usize) -> BitSet<T> {\n         let num_words = num_words(domain_size);\n-        BitSet { domain_size, words: vec![0; num_words], marker: PhantomData }\n+        BitSet { domain_size, words: smallvec![0; num_words], marker: PhantomData }\n     }\n \n     /// Creates a new, filled bitset with a given `domain_size`.\n     #[inline]\n     pub fn new_filled(domain_size: usize) -> BitSet<T> {\n         let num_words = num_words(domain_size);\n-        let mut result = BitSet { domain_size, words: vec![!0; num_words], marker: PhantomData };\n+        let mut result =\n+            BitSet { domain_size, words: smallvec![!0; num_words], marker: PhantomData };\n         result.clear_excess_bits();\n         result\n     }\n@@ -1571,7 +1573,7 @@ impl<T: Idx> From<BitSet<T>> for GrowableBitSet<T> {\n pub struct BitMatrix<R: Idx, C: Idx> {\n     num_rows: usize,\n     num_columns: usize,\n-    words: Vec<Word>,\n+    words: SmallVec<[Word; 2]>,\n     marker: PhantomData<(R, C)>,\n }\n \n@@ -1584,7 +1586,7 @@ impl<R: Idx, C: Idx> BitMatrix<R, C> {\n         BitMatrix {\n             num_rows,\n             num_columns,\n-            words: vec![0; num_rows * words_per_row],\n+            words: smallvec![0; num_rows * words_per_row],\n             marker: PhantomData,\n         }\n     }"}]}