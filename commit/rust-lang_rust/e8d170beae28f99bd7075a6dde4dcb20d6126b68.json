{"sha": "e8d170beae28f99bd7075a6dde4dcb20d6126b68", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4ZDE3MGJlYWUyOGY5OWJkNzA3NWE2ZGRlNGRjYjIwZDYxMjZiNjg=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-08-12T04:14:08Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-08-12T04:15:26Z"}, "message": "rt: Stub Rust GC metadata printer and Rust GC strategy modules", "tree": {"sha": "9608aa1aaf0c7f5105b33f1e6bd8b4c9b2ae99da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9608aa1aaf0c7f5105b33f1e6bd8b4c9b2ae99da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8d170beae28f99bd7075a6dde4dcb20d6126b68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8d170beae28f99bd7075a6dde4dcb20d6126b68", "html_url": "https://github.com/rust-lang/rust/commit/e8d170beae28f99bd7075a6dde4dcb20d6126b68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8d170beae28f99bd7075a6dde4dcb20d6126b68/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a22f91c9cf4b2a54f05a5d58a23459c0f6fb590", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a22f91c9cf4b2a54f05a5d58a23459c0f6fb590", "html_url": "https://github.com/rust-lang/rust/commit/0a22f91c9cf4b2a54f05a5d58a23459c0f6fb590"}], "stats": {"total": 82, "additions": 81, "deletions": 1}, "files": [{"sha": "af1f7bfbd0fdd075d27cc7c338aa79889398dc93", "filename": "mk/rustllvm.mk", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e8d170beae28f99bd7075a6dde4dcb20d6126b68/mk%2Frustllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/e8d170beae28f99bd7075a6dde4dcb20d6126b68/mk%2Frustllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frustllvm.mk?ref=e8d170beae28f99bd7075a6dde4dcb20d6126b68", "patch": "@@ -2,7 +2,8 @@\n # rustc LLVM-extensions (C++) library variables and rules\n ######################################################################\n \n-RUSTLLVM_OBJS_CS := $(addprefix rustllvm/, RustWrapper.cpp)\n+RUSTLLVM_OBJS_CS := $(addprefix rustllvm/, RustGCMetadataPrinter.cpp \\\n+    RustGCStrategy.cpp RustWrapper.cpp)\n \n RUSTLLVM_DEF := rustllvm/rustllvm$(CFG_DEF_SUFFIX)\n "}, {"sha": "d17d7da170340e3515635e643d65a0fd25d99883", "filename": "src/rustllvm/RustGCMetadataPrinter.cpp", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/e8d170beae28f99bd7075a6dde4dcb20d6126b68/src%2Frustllvm%2FRustGCMetadataPrinter.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e8d170beae28f99bd7075a6dde4dcb20d6126b68/src%2Frustllvm%2FRustGCMetadataPrinter.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustGCMetadataPrinter.cpp?ref=e8d170beae28f99bd7075a6dde4dcb20d6126b68", "patch": "@@ -0,0 +1,45 @@\n+//===-- RustGCPrinter.cpp - Rust garbage collection map printer -----------===//\n+//\n+//                     The LLVM Compiler Infrastructure\n+//\n+// This file is distributed under the University of Illinois Open Source\n+// License. See LICENSE.TXT for details.\n+//\n+//===----------------------------------------------------------------------===//\n+//\n+// This file defines the emitter for the Rust garbage collection stack maps.\n+//\n+//===----------------------------------------------------------------------===//\n+\n+#include \"llvm/CodeGen/GCs.h\"\n+#include \"llvm/CodeGen/AsmPrinter.h\"\n+#include \"llvm/CodeGen/GCMetadataPrinter.h\"\n+#include \"llvm/Module.h\"\n+#include \"llvm/MC/MCAsmInfo.h\"\n+#include \"llvm/MC/MCContext.h\"\n+#include \"llvm/MC/MCSymbol.h\"\n+#include \"llvm/MC/MCStreamer.h\"\n+#include \"llvm/Target/Mangler.h\"\n+#include \"llvm/Target/TargetData.h\"\n+#include \"llvm/Target/TargetLoweringObjectFile.h\"\n+#include \"llvm/Target/TargetMachine.h\"\n+#include \"llvm/ADT/SmallString.h\"\n+#include \"llvm/Support/ErrorHandling.h\"\n+#include \"llvm/Support/FormattedStream.h\"\n+#include <cctype>\n+\n+using namespace llvm;\n+\n+namespace {\n+\n+  class RustGCMetadataPrinter : public GCMetadataPrinter {\n+  public:\n+    void beginAssembly(AsmPrinter &AP) {};\n+    void finishAssembly(AsmPrinter &AP) {};\n+  };\n+\n+}\n+\n+static GCMetadataPrinterRegistry::Add<RustGCMetadataPrinter>\n+Y(\"rust\", \"Rust GC metadata printer\");\n+"}, {"sha": "0c86856939ce2aef49de532cc1064693ab681297", "filename": "src/rustllvm/RustGCStrategy.cpp", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/e8d170beae28f99bd7075a6dde4dcb20d6126b68/src%2Frustllvm%2FRustGCStrategy.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e8d170beae28f99bd7075a6dde4dcb20d6126b68/src%2Frustllvm%2FRustGCStrategy.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustGCStrategy.cpp?ref=e8d170beae28f99bd7075a6dde4dcb20d6126b68", "patch": "@@ -0,0 +1,34 @@\n+//===- RustGCStrategy.cpp - Rust garbage collection strategy ----*- C++ -*-===//\n+//\n+//                     The LLVM Compiler Infrastructure\n+//\n+// This file is distributed under the University of Illinois Open Source\n+// License. See LICENSE.TXT for details.\n+//\n+//===----------------------------------------------------------------------===//\n+//\n+// This file defines the garbage collection strategy for Rust.\n+//\n+//===----------------------------------------------------------------------===//\n+\n+#include \"llvm/CodeGen/GCs.h\"\n+#include \"llvm/CodeGen/GCStrategy.h\"\n+\n+using namespace llvm;\n+\n+namespace {\n+  class RustGCStrategy : public GCStrategy {\n+  public:\n+    RustGCStrategy();\n+  };\n+}\n+\n+static GCRegistry::Add<RustGCStrategy>\n+X(\"rust\", \"Rust GC\");\n+\n+RustGCStrategy::RustGCStrategy() {\n+  NeededSafePoints = 1 << GC::PostCall;\n+  UsesMetadata = true;\n+}\n+\n+"}]}