{"sha": "b9cf26c38acf60fb1d7d88d914a22824b82ed829", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5Y2YyNmMzOGFjZjYwZmIxZDdkODhkOTE0YTIyODI0YjgyZWQ4Mjk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-01-02T00:31:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-01-02T00:31:07Z"}, "message": "Auto merge of #47106 - EdSchouten:compiletest-cloudabi, r=alexcrichton\n\nTiny fixes to make compiletest work for CloudABI cross builds\n\nI'm currently working toward getting a `src/ci/docker` container working to do isolated/automated builds and testing of `x86_64-unknown-cloudabi`. This is working pretty well, but still requires some fixes to `libtest` and `compiletest`. Here is the first set of fixes that I had to apply.", "tree": {"sha": "1086eefa0689dc10d8a9a62972f91603ab9924a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1086eefa0689dc10d8a9a62972f91603ab9924a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9cf26c38acf60fb1d7d88d914a22824b82ed829", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9cf26c38acf60fb1d7d88d914a22824b82ed829", "html_url": "https://github.com/rust-lang/rust/commit/b9cf26c38acf60fb1d7d88d914a22824b82ed829", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9cf26c38acf60fb1d7d88d914a22824b82ed829/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b65f0bedd2f22d9661ecb7092f07746dc2ccfb0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b65f0bedd2f22d9661ecb7092f07746dc2ccfb0d", "html_url": "https://github.com/rust-lang/rust/commit/b65f0bedd2f22d9661ecb7092f07746dc2ccfb0d"}, {"sha": "7b5543d7b6155c4e8dd44e0d7ed17a076db48c60", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b5543d7b6155c4e8dd44e0d7ed17a076db48c60", "html_url": "https://github.com/rust-lang/rust/commit/7b5543d7b6155c4e8dd44e0d7ed17a076db48c60"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "839f697b39cfaf5a089edbb1469d7536dd5cff1b", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=b9cf26c38acf60fb1d7d88d914a22824b82ed829", "patch": "@@ -203,13 +203,6 @@ pub struct TestDesc {\n     pub allow_fail: bool,\n }\n \n-#[derive(Clone)]\n-pub struct TestPaths {\n-    pub file: PathBuf,         // e.g., compile-test/foo/bar/baz.rs\n-    pub base: PathBuf,         // e.g., compile-test, auxiliary\n-    pub relative_dir: PathBuf, // e.g., foo/bar\n-}\n-\n #[derive(Debug)]\n pub struct TestDescAndFn {\n     pub desc: TestDesc,"}, {"sha": "1d8cef05b7dd3408f0e330c0cd529d8f49a89faf", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=b9cf26c38acf60fb1d7d88d914a22824b82ed829", "patch": "@@ -13,7 +13,7 @@ use std::fmt;\n use std::str::FromStr;\n use std::path::PathBuf;\n \n-use test::{ColorConfig, TestPaths};\n+use test::ColorConfig;\n \n #[derive(Clone, Copy, PartialEq, Debug)]\n pub enum Mode {\n@@ -222,6 +222,13 @@ pub struct Config {\n     pub nodejs: Option<String>,\n }\n \n+#[derive(Clone)]\n+pub struct TestPaths {\n+    pub file: PathBuf,         // e.g., compile-test/foo/bar/baz.rs\n+    pub base: PathBuf,         // e.g., compile-test, auxiliary\n+    pub relative_dir: PathBuf, // e.g., foo/bar\n+}\n+\n /// Used by `ui` tests to generate things like `foo.stderr` from `foo.rs`.\n pub fn expected_output_path(testpaths: &TestPaths, revision: Option<&str>, kind: &str) -> PathBuf {\n     assert!(UI_EXTENSIONS.contains(&kind));"}, {"sha": "533aaf9cd27353bf9e0b78eab246f8df8728da72", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=b9cf26c38acf60fb1d7d88d914a22824b82ed829", "patch": "@@ -33,10 +33,10 @@ use std::path::{Path, PathBuf};\n use std::process::Command;\n use filetime::FileTime;\n use getopts::Options;\n-use common::Config;\n+use common::{Config, TestPaths};\n use common::{DebugInfoGdb, DebugInfoLldb, Mode, Pretty};\n use common::{expected_output_path, UI_EXTENSIONS};\n-use test::{ColorConfig, TestPaths};\n+use test::ColorConfig;\n use util::logv;\n \n use self::header::EarlyProps;"}, {"sha": "aceb472ca63198b1b47567e8908585b15ea7a804", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=b9cf26c38acf60fb1d7d88d914a22824b82ed829", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use common::Config;\n+use common::{Config, TestPaths};\n use common::{CompileFail, ParseFail, Pretty, RunFail, RunPass, RunPassValgrind};\n use common::{Codegen, CodegenUnits, DebugInfoGdb, DebugInfoLldb, Rustdoc};\n use common::{Incremental, MirOpt, RunMake, Ui};\n@@ -18,7 +18,6 @@ use errors::{self, Error, ErrorKind};\n use filetime::FileTime;\n use json;\n use header::TestProps;\n-use test::TestPaths;\n use util::logv;\n use regex::Regex;\n "}, {"sha": "3c9dae915b5a28969429cf1a0f67b79e743d84dd", "filename": "src/tools/compiletest/src/util.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9cf26c38acf60fb1d7d88d914a22824b82ed829/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Futil.rs?ref=b9cf26c38acf60fb1d7d88d914a22824b82ed829", "patch": "@@ -15,6 +15,7 @@ use common::Config;\n const OS_TABLE: &'static [(&'static str, &'static str)] = &[\n     (\"android\", \"android\"),\n     (\"bitrig\", \"bitrig\"),\n+    (\"cloudabi\", \"cloudabi\"),\n     (\"darwin\", \"macos\"),\n     (\"dragonfly\", \"dragonfly\"),\n     (\"freebsd\", \"freebsd\"),"}]}