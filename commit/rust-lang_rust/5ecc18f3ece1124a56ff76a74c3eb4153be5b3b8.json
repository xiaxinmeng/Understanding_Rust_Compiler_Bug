{"sha": "5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlY2MxOGYzZWNlMTEyNGE1NmZmNzZhNzRjM2ViNDE1M2JlNWIzYjg=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-11T15:52:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-11T15:52:10Z"}, "message": "Rollup merge of #70937 - mati865:mingw-staticlib-suffix, r=petrochenkov\n\nFix staticlib name for *-pc-windows-gnu targets\n\nFix https://github.com/rust-lang/rust/issues/69904\n\nGuess this will need FCP but opened PR anyway to bring the attention.\n\nIn short Rust has been using wrong `foo.lib` format for static libraries when building for `*-pc-windows-gnu` since version [1.8.0](https://github.com/rust-lang/rust/commit/34b4e66736a0fb65235feadbb5178d42bd09ed67).\n[LD](https://github.com/bminor/binutils-gdb/blob/f4a220077b03af3a1f905b7dc6dc84c0a06d582f/ld/emultempl/pe.em#L2224-L2227) and [LLD](https://github.com/llvm/llvm-project/blob/0605f5fbe755326e3dbc8daa4fc34453b8c5ac0e/lld/MinGW/Driver.cpp#L140-L141) agree in that regard and only accept static libraries with `libfoo.a` format. So the only thing to break here is when somebody added a hack to rename created library to proper format (like [here](https://gitlab.gnome.org/GNOME/librsvg/-/commit/ad86ab8580c8779fc3eb2bee2422bb116919844e#d5b4de16d947214ec306bd57bed1bd23a939b5f9_197_194)).", "tree": {"sha": "81b2b4627905a1c327f1014489ad4367f35dbf26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81b2b4627905a1c327f1014489ad4367f35dbf26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJekeeqCRBK7hj4Ov3rIwAAdHIIADGYO61m/6lAWwX8+nIa3kAl\nj7CbZzC3qXM0YJybNKO7ICX1IHoXfYjWWFgPOrL20IUmb7IZQVDlMmfJIJDPzVp2\nXWLKQzTgRZbM0Fqb9X8SQ4Lv4aSAoxSW/EBUAUUSdUzkn2COL6QdkWfqBUISG/Ee\nXyHXUa6KN4ap1zoEyw4uTVVoDQQIcyHmIZ8k25vkZbWxKAneq2ZGqflckFfBg/qu\nsI/eLpWIe5HeS+bztf+iffjwErqYlHSNJjMyuo8dXJ4bd6q7vTlrgqzjve1Q3YkI\nt4hoYA/56BV+H1RvY5OrF7+LIcbDbML8lUyZGFTTuBK6oKKmkgAVWw+k5GjqXEU=\n=ABMM\n-----END PGP SIGNATURE-----\n", "payload": "tree 81b2b4627905a1c327f1014489ad4367f35dbf26\nparent f9c0ea2862280102bf33e9df81f33b1b7b464e19\nparent b9d9689e78160c5d09ea627bb1a93468e4872ead\nauthor Dylan DPC <dylan.dpc@gmail.com> 1586620330 +0200\ncommitter GitHub <noreply@github.com> 1586620330 +0200\n\nRollup merge of #70937 - mati865:mingw-staticlib-suffix, r=petrochenkov\n\nFix staticlib name for *-pc-windows-gnu targets\n\nFix https://github.com/rust-lang/rust/issues/69904\n\nGuess this will need FCP but opened PR anyway to bring the attention.\n\nIn short Rust has been using wrong `foo.lib` format for static libraries when building for `*-pc-windows-gnu` since version [1.8.0](https://github.com/rust-lang/rust/commit/34b4e66736a0fb65235feadbb5178d42bd09ed67).\n[LD](https://github.com/bminor/binutils-gdb/blob/f4a220077b03af3a1f905b7dc6dc84c0a06d582f/ld/emultempl/pe.em#L2224-L2227) and [LLD](https://github.com/llvm/llvm-project/blob/0605f5fbe755326e3dbc8daa4fc34453b8c5ac0e/lld/MinGW/Driver.cpp#L140-L141) agree in that regard and only accept static libraries with `libfoo.a` format. So the only thing to break here is when somebody added a hack to rename created library to proper format (like [here](https://gitlab.gnome.org/GNOME/librsvg/-/commit/ad86ab8580c8779fc3eb2bee2422bb116919844e#d5b4de16d947214ec306bd57bed1bd23a939b5f9_197_194)).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "html_url": "https://github.com/rust-lang/rust/commit/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9c0ea2862280102bf33e9df81f33b1b7b464e19", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9c0ea2862280102bf33e9df81f33b1b7b464e19", "html_url": "https://github.com/rust-lang/rust/commit/f9c0ea2862280102bf33e9df81f33b1b7b464e19"}, {"sha": "b9d9689e78160c5d09ea627bb1a93468e4872ead", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9d9689e78160c5d09ea627bb1a93468e4872ead", "html_url": "https://github.com/rust-lang/rust/commit/b9d9689e78160c5d09ea627bb1a93468e4872ead"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "39350c1618ab06e7a8299ce85146c792b7c9bd37", "filename": "src/librustc_target/spec/windows_base.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Flibrustc_target%2Fspec%2Fwindows_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Flibrustc_target%2Fspec%2Fwindows_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fwindows_base.rs?ref=5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "patch": "@@ -75,8 +75,8 @@ pub fn opts() -> TargetOptions {\n         dll_prefix: String::new(),\n         dll_suffix: \".dll\".to_string(),\n         exe_suffix: \".exe\".to_string(),\n-        staticlib_prefix: String::new(),\n-        staticlib_suffix: \".lib\".to_string(),\n+        staticlib_prefix: \"lib\".to_string(),\n+        staticlib_suffix: \".a\".to_string(),\n         target_family: Some(\"windows\".to_string()),\n         is_like_windows: true,\n         allows_weak_linkage: false,"}, {"sha": "b6e0cbaf5ddc7557e9fb7fd8ac479dbb15791b7b", "filename": "src/test/run-make-fulldeps/output-type-permutations/Makefile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Ftest%2Frun-make-fulldeps%2Foutput-type-permutations%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Ftest%2Frun-make-fulldeps%2Foutput-type-permutations%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Foutput-type-permutations%2FMakefile?ref=5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "patch": "@@ -78,7 +78,7 @@ all:\n \trm $(TMPDIR)/$(call BIN,foo)\n \t$(RUSTC) foo.rs --crate-type=dylib --emit=link=$(TMPDIR)/$(call BIN,foo)\n \trm $(TMPDIR)/$(call BIN,foo)\n-\trm -f $(TMPDIR)/{lib,}foo.{dll.exp,dll.lib,pdb,dll.a,exe.lib}\n+\trm -f $(TMPDIR)/{lib,}foo.{dll.exp,dll.lib,pdb,dll.a,exe.a}\n \t[ \"$$(ls -1 $(TMPDIR) | wc -l)\" -eq \"0\" ] || (ls -1 $(TMPDIR) && exit 1)\n \n \t$(RUSTC) foo.rs --crate-type=staticlib -o $(TMPDIR)/foo"}, {"sha": "04bf78ed2105be91980aef74951edbe51036dd21", "filename": "src/test/run-make-fulldeps/tools.mk", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk?ref=5ecc18f3ece1124a56ff76a74c3eb4153be5b3b8", "patch": "@@ -44,8 +44,13 @@ RUN = PATH=\"$(PATH):$(TARGET_RPATH_DIR)\" $(RUN_BINFILE)\n FAIL = PATH=\"$(PATH):$(TARGET_RPATH_DIR)\" $(RUN_BINFILE) && exit 1 || exit 0\n DYLIB_GLOB = $(1)*.dll\n DYLIB = $(TMPDIR)/$(1).dll\n+ifdef IS_MSVC\n STATICLIB = $(TMPDIR)/$(1).lib\n STATICLIB_GLOB = $(1)*.lib\n+else\n+STATICLIB = $(TMPDIR)/lib$(1).a\n+STATICLIB_GLOB = lib$(1)*.a\n+endif\n BIN = $(1).exe\n LLVM_FILECHECK := $(shell cygpath -u \"$(LLVM_FILECHECK)\")\n else"}]}