{"sha": "84302717ae9d5245935750ab49693466f761d5f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0MzAyNzE3YWU5ZDUyNDU5MzU3NTBhYjQ5NjkzNDY2Zjc2MWQ1ZjE=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-05-25T01:50:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-05-25T01:50:07Z"}, "message": "Rollup merge of #42177 - est31:master, r=Mark-Simulacrum\n\nRemove some needless // gate-test- comments\n\nAlso, add detection to treat such comments as tidy errors.\nWe also remove the found_lib_feature code because it\nwas just repeating the found_feature code. Originally it\nwas intended to allow for gate-test lines for\nlib features, but apparently nobody missed it.", "tree": {"sha": "a846a86b6d1cd7a8446088a386b046bdeab2ac8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a846a86b6d1cd7a8446088a386b046bdeab2ac8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84302717ae9d5245935750ab49693466f761d5f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84302717ae9d5245935750ab49693466f761d5f1", "html_url": "https://github.com/rust-lang/rust/commit/84302717ae9d5245935750ab49693466f761d5f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84302717ae9d5245935750ab49693466f761d5f1/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca0860df66dc92b85659a0d82c8be5868a46c924", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca0860df66dc92b85659a0d82c8be5868a46c924", "html_url": "https://github.com/rust-lang/rust/commit/ca0860df66dc92b85659a0d82c8be5868a46c924"}, {"sha": "e860655a999ad921eb379d7f220c3e8ad1bcbb54", "url": "https://api.github.com/repos/rust-lang/rust/commits/e860655a999ad921eb379d7f220c3e8ad1bcbb54", "html_url": "https://github.com/rust-lang/rust/commit/e860655a999ad921eb379d7f220c3e8ad1bcbb54"}], "stats": {"total": 34, "additions": 17, "deletions": 17}, "files": [{"sha": "eeede4b8aa13c9ed7826b35fe3ceb63f7ca46c27", "filename": "src/test/compile-fail-fulldeps/proc-macro/feature-gate-proc_macro.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Ffeature-gate-proc_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Ffeature-gate-proc_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fproc-macro%2Ffeature-gate-proc_macro.rs?ref=84302717ae9d5245935750ab49693466f761d5f1", "patch": "@@ -9,7 +9,6 @@\n // except according to those terms.\n \n // aux-build:attr_proc_macro.rs\n-// gate-test-proc_macro\n #![feature(use_extern_macros)]\n \n extern crate attr_proc_macro;\n@@ -21,4 +20,4 @@ struct Foo;\n \n fn main() {\n     let _ = Foo;\n-}\n\\ No newline at end of file\n+}"}, {"sha": "77f61ba47b005ebe9b077ec302f412ba0a2a2e11", "filename": "src/test/compile-fail/feature-gate-global_asm.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftest%2Fcompile-fail%2Ffeature-gate-global_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftest%2Fcompile-fail%2Ffeature-gate-global_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-global_asm.rs?ref=84302717ae9d5245935750ab49693466f761d5f1", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// gate-test-global_asm\n-\n global_asm!(\"\"); //~ ERROR `global_asm!` is not stable\n \n fn main() {}"}, {"sha": "791b8d77e0b907f635782f1d7b33dec9ec09ae83", "filename": "src/tools/tidy/src/features.rs", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84302717ae9d5245935750ab49693466f761d5f1/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs?ref=84302717ae9d5245935750ab49693466f761d5f1", "patch": "@@ -70,7 +70,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n         }\n \n         let filen_underscore = filename.replace(\"-\",\"_\").replace(\".rs\",\"\");\n-        test_filen_gate(&filen_underscore, &mut features);\n+        let filename_is_gate_test = test_filen_gate(&filen_underscore, &mut features);\n \n         contents.truncate(0);\n         t!(t!(File::open(&file), &file).read_to_string(&mut contents));\n@@ -92,17 +92,20 @@ pub fn check(path: &Path, bad: &mut bool) {\n                 },\n                 None => continue,\n             };\n-            let found_feature = features.get_mut(feature_name)\n-                                        .map(|v| { v.has_gate_test = true; () })\n-                                        .is_some();\n-\n-            let found_lib_feature = features.get_mut(feature_name)\n-                                            .map(|v| { v.has_gate_test = true; () })\n-                                            .is_some();\n-\n-            if !(found_feature || found_lib_feature) {\n-                err(&format!(\"gate-test test found referencing a nonexistent feature '{}'\",\n-                             feature_name));\n+            match features.get_mut(feature_name) {\n+                Some(f) => {\n+                    if filename_is_gate_test {\n+                        err(&format!(\"The file is already marked as gate test \\\n+                                      through its name, no need for a \\\n+                                      'gate-test-{}' comment\",\n+                                     feature_name));\n+                    }\n+                    f.has_gate_test = true;\n+                }\n+                None => {\n+                    err(&format!(\"gate-test test found referencing a nonexistent feature '{}'\",\n+                                 feature_name));\n+                }\n             }\n         }\n     });\n@@ -265,4 +268,4 @@ pub fn collect_lib_features(base_src_path: &Path,\n         }\n     });\n     lib_features\n-}\n\\ No newline at end of file\n+}"}]}