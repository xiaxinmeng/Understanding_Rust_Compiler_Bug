{"sha": "f3078d0f44b07a2e47130846f7f3c7f21a09217f", "node_id": "C_kwDOAAsO6NoAKGYzMDc4ZDBmNDRiMDdhMmU0NzEzMDg0NmY3ZjNjN2YyMWEwOTIxN2Y", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-06-24T07:43:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-24T07:43:47Z"}, "message": "Rollup merge of #98394 - Enselic:fixup-rustc_main-renames, r=petrochenkov\n\nFixup missing renames from `#[main]` to `#[rustc_main]`\n\nIn #84217 `#[main]` was removed and replaced with `#[rustc_main]`. In some places the rename was forgotten, which makes the current code confusing, because at first glance it seems that `#[main]` is still around. Perform the renames also in these places.\n\nI noticed this (after first being confused by it) when working on #97802.\n\nr? `@petrochenkov`\n\n(since you reviewed the other PR)", "tree": {"sha": "23b0d8f0e5a42b4ca4bf29a400c1221d1ed69d74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23b0d8f0e5a42b4ca4bf29a400c1221d1ed69d74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3078d0f44b07a2e47130846f7f3c7f21a09217f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJitWszCRBK7hj4Ov3rIwAAN+0IAASl6G3NLDj4t8wDoBVFiHt7\nltQsgBgeCa2mS5Hy4zTPOP2R2+WskUgY3xtwnVsp6yctAiZvDXm9ozvQVhUXJNwr\nM6DOwKkHO/2plRcEioYAMi4uB1tmzAFH3i6uksahTdCN686EYfTa21a8YHp8b2wo\nzbI3LG6buBkXQIEZQGfVINyN/q4oYhOXzbWIkLsdyIckf/81OSoksJ4Sb7WYK+Yb\nM/UNHwwRvXC6gT3LH+OK5im+aju1/+Qbg54/nV0uhKHCKNMyLphgKPEp+jCczetv\nOCQdR3kSn+Zx+vZ1gCpiaoAmy4LqIOGAZL4fb6M6ye4sGO6ST4Wy7pi+1ITXbRI=\n=zP3A\n-----END PGP SIGNATURE-----\n", "payload": "tree 23b0d8f0e5a42b4ca4bf29a400c1221d1ed69d74\nparent 964fc41b8986c3631e85decbadea3f9f40425811\nparent 94477e3323330f531705d6968761e7e8fd6f749e\nauthor Yuki Okushi <jtitor@2k36.org> 1656056627 +0900\ncommitter GitHub <noreply@github.com> 1656056627 +0900\n\nRollup merge of #98394 - Enselic:fixup-rustc_main-renames, r=petrochenkov\n\nFixup missing renames from `#[main]` to `#[rustc_main]`\n\nIn #84217 `#[main]` was removed and replaced with `#[rustc_main]`. In some places the rename was forgotten, which makes the current code confusing, because at first glance it seems that `#[main]` is still around. Perform the renames also in these places.\n\nI noticed this (after first being confused by it) when working on #97802.\n\nr? `@petrochenkov`\n\n(since you reviewed the other PR)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3078d0f44b07a2e47130846f7f3c7f21a09217f", "html_url": "https://github.com/rust-lang/rust/commit/f3078d0f44b07a2e47130846f7f3c7f21a09217f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3078d0f44b07a2e47130846f7f3c7f21a09217f/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "964fc41b8986c3631e85decbadea3f9f40425811", "url": "https://api.github.com/repos/rust-lang/rust/commits/964fc41b8986c3631e85decbadea3f9f40425811", "html_url": "https://github.com/rust-lang/rust/commit/964fc41b8986c3631e85decbadea3f9f40425811"}, {"sha": "94477e3323330f531705d6968761e7e8fd6f749e", "url": "https://api.github.com/repos/rust-lang/rust/commits/94477e3323330f531705d6968761e7e8fd6f749e", "html_url": "https://github.com/rust-lang/rust/commit/94477e3323330f531705d6968761e7e8fd6f749e"}], "stats": {"total": 23, "additions": 12, "deletions": 11}, "files": [{"sha": "3370146193a522839ec368071b341b9596981840", "filename": "compiler/rustc_ast/src/entry.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_ast%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_ast%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fentry.rs?ref=f3078d0f44b07a2e47130846f7f3c7f21a09217f", "patch": "@@ -2,7 +2,7 @@\n pub enum EntryPointType {\n     None,\n     MainNamed,\n-    MainAttr,\n+    RustcMainAttr,\n     Start,\n     OtherMain, // Not an entry point, but some other function named main\n }"}, {"sha": "a08495f7671b05c02584d6d22b36fcd33ea9d3b7", "filename": "compiler/rustc_builtin_macros/src/test_harness.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs?ref=f3078d0f44b07a2e47130846f7f3c7f21a09217f", "patch": "@@ -147,7 +147,7 @@ fn entry_point_type(sess: &Session, item: &ast::Item, depth: usize) -> EntryPoin\n             if sess.contains_name(&item.attrs, sym::start) {\n                 EntryPointType::Start\n             } else if sess.contains_name(&item.attrs, sym::rustc_main) {\n-                EntryPointType::MainAttr\n+                EntryPointType::RustcMainAttr\n             } else if item.ident.name == sym::main {\n                 if depth == 0 {\n                     // This is a top-level function so can be 'main'\n@@ -177,12 +177,12 @@ impl<'a> MutVisitor for EntryPointCleaner<'a> {\n         let item = noop_flat_map_item(i, self).expect_one(\"noop did something\");\n         self.depth -= 1;\n \n-        // Remove any #[main] or #[start] from the AST so it doesn't\n+        // Remove any #[rustc_main] or #[start] from the AST so it doesn't\n         // clash with the one we're going to add, but mark it as\n         // #[allow(dead_code)] to avoid printing warnings.\n         let item = match entry_point_type(self.sess, &item, self.depth) {\n-            EntryPointType::MainNamed | EntryPointType::MainAttr | EntryPointType::Start => item\n-                .map(|ast::Item { id, ident, attrs, kind, vis, span, tokens }| {\n+            EntryPointType::MainNamed | EntryPointType::RustcMainAttr | EntryPointType::Start => {\n+                item.map(|ast::Item { id, ident, attrs, kind, vis, span, tokens }| {\n                     let allow_ident = Ident::new(sym::allow, self.def_site);\n                     let dc_nested =\n                         attr::mk_nested_word_item(Ident::new(sym::dead_code, self.def_site));\n@@ -197,7 +197,8 @@ impl<'a> MutVisitor for EntryPointCleaner<'a> {\n                         .collect();\n \n                     ast::Item { id, ident, attrs, kind, vis, span, tokens }\n-                }),\n+                })\n+            }\n             EntryPointType::None | EntryPointType::OtherMain => item,\n         };\n "}, {"sha": "f9e67310452a70f399d75deadfdcb89c27be54ac", "filename": "compiler/rustc_passes/src/entry.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3078d0f44b07a2e47130846f7f3c7f21a09217f/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fentry.rs?ref=f3078d0f44b07a2e47130846f7f3c7f21a09217f", "patch": "@@ -56,7 +56,7 @@ fn entry_point_type(ctxt: &EntryContext<'_>, id: ItemId, at_root: bool) -> Entry\n     if ctxt.tcx.sess.contains_name(attrs, sym::start) {\n         EntryPointType::Start\n     } else if ctxt.tcx.sess.contains_name(attrs, sym::rustc_main) {\n-        EntryPointType::MainAttr\n+        EntryPointType::RustcMainAttr\n     } else {\n         if let Some(name) = ctxt.tcx.opt_item_name(id.def_id.to_def_id())\n             && name == sym::main {\n@@ -95,21 +95,21 @@ fn find_item(id: ItemId, ctxt: &mut EntryContext<'_>) {\n         EntryPointType::OtherMain => {\n             ctxt.non_main_fns.push(ctxt.tcx.def_span(id.def_id));\n         }\n-        EntryPointType::MainAttr => {\n+        EntryPointType::RustcMainAttr => {\n             if ctxt.attr_main_fn.is_none() {\n                 ctxt.attr_main_fn = Some((id.def_id, ctxt.tcx.def_span(id.def_id.to_def_id())));\n             } else {\n                 struct_span_err!(\n                     ctxt.tcx.sess,\n                     ctxt.tcx.def_span(id.def_id.to_def_id()),\n                     E0137,\n-                    \"multiple functions with a `#[main]` attribute\"\n+                    \"multiple functions with a `#[rustc_main]` attribute\"\n                 )\n                 .span_label(\n                     ctxt.tcx.def_span(id.def_id.to_def_id()),\n-                    \"additional `#[main]` function\",\n+                    \"additional `#[rustc_main]` function\",\n                 )\n-                .span_label(ctxt.attr_main_fn.unwrap().1, \"first `#[main]` function\")\n+                .span_label(ctxt.attr_main_fn.unwrap().1, \"first `#[rustc_main]` function\")\n                 .emit();\n             }\n         }"}]}