{"sha": "e0df2f87b6116133740bec90f341943181d90f1c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwZGYyZjg3YjYxMTYxMzM3NDBiZWM5MGYzNDE5NDMxODFkOTBmMWM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-09-05T12:55:08Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-09-08T19:32:03Z"}, "message": "Create new E0774 code error", "tree": {"sha": "58e5ec65994cfe951f64e343519e76612319e722", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/58e5ec65994cfe951f64e343519e76612319e722"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e0df2f87b6116133740bec90f341943181d90f1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e0df2f87b6116133740bec90f341943181d90f1c", "html_url": "https://github.com/rust-lang/rust/commit/e0df2f87b6116133740bec90f341943181d90f1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e0df2f87b6116133740bec90f341943181d90f1c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02fe30971ef397bcff3460a9aaf175e0810c2c90", "url": "https://api.github.com/repos/rust-lang/rust/commits/02fe30971ef397bcff3460a9aaf175e0810c2c90", "html_url": "https://github.com/rust-lang/rust/commit/02fe30971ef397bcff3460a9aaf175e0810c2c90"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "b0be1bf7e7210cf7992b1ba8dc5aa99a05359f69", "filename": "compiler/rustc_error_codes/src/error_codes.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs?ref=e0df2f87b6116133740bec90f341943181d90f1c", "patch": "@@ -455,6 +455,7 @@ E0769: include_str!(\"./error_codes/E0769.md\"),\n E0770: include_str!(\"./error_codes/E0770.md\"),\n E0771: include_str!(\"./error_codes/E0771.md\"),\n E0773: include_str!(\"./error_codes/E0773.md\"),\n+E0774: include_str!(\"./error_codes/E0774.md\"),\n ;\n //  E0006, // merged with E0005\n //  E0008, // cannot bind by-move into a pattern guard"}, {"sha": "79793ba9d7d3d484e35cb1ea5e068d8d2586b525", "filename": "compiler/rustc_error_codes/src/error_codes/E0774.md", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0774.md", "raw_url": "https://github.com/rust-lang/rust/raw/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0774.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0774.md?ref=e0df2f87b6116133740bec90f341943181d90f1c", "patch": "@@ -0,0 +1,24 @@\n+`derive` was applied on something which is not a struct, a union or an enum.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0774\n+trait Foo {\n+    #[derive(Clone)] // error!\n+    type Bar;\n+}\n+```\n+\n+As said above, the `derive` attribute is only allowed on structs, unions or\n+enums:\n+\n+```\n+#[derive(Clone)] // ok!\n+struct Bar {\n+    field: u32,\n+}\n+```\n+\n+You can find more information about `derive` in the [Rust Book].\n+\n+[Rust Book]: https://doc.rust-lang.org/book/appendix-03-derivable-traits.html"}, {"sha": "ca6f7324ca40fa0f5d515de6355b4e7a262e5be5", "filename": "compiler/rustc_expand/src/expand.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0df2f87b6116133740bec90f341943181d90f1c/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs?ref=e0df2f87b6116133740bec90f341943181d90f1c", "patch": "@@ -529,9 +529,12 @@ impl<'a, 'b> MacroExpander<'a, 'b> {\n     fn error_derive_forbidden_on_non_adt(&self, derives: &[Path], item: &Annotatable) {\n         let attr = self.cx.sess.find_by_name(item.attrs(), sym::derive);\n         let span = attr.map_or(item.span(), |attr| attr.span);\n-        let mut err = self\n-            .cx\n-            .struct_span_err(span, \"`derive` may only be applied to structs, enums and unions\");\n+        let mut err = rustc_errors::struct_span_err!(\n+            self.cx.sess,\n+            span,\n+            E0774,\n+            \"`derive` may only be applied to structs, enums and unions\",\n+        );\n         if let Some(ast::Attribute { style: ast::AttrStyle::Inner, .. }) = attr {\n             let trait_list = derives.iter().map(|t| pprust::path_to_string(t)).collect::<Vec<_>>();\n             let suggestion = format!(\"#[derive({})]\", trait_list.join(\", \"));"}]}