{"sha": "0981b9857ed9a4c840221b089fc5103373c8595f", "node_id": "C_kwDOAAsO6NoAKDA5ODFiOTg1N2VkOWE0Yzg0MDIyMWIwODlmYzUxMDMzNzNjODU5NWY", "commit": {"author": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2022-04-15T17:46:58Z"}, "committer": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2022-04-27T16:37:45Z"}, "message": "compiletest: add support for unused extern notifications\n\nAs generated by --json unused-externs.", "tree": {"sha": "0337e711d6830d854e44d6d8a13911d41e637415", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0337e711d6830d854e44d6d8a13911d41e637415"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0981b9857ed9a4c840221b089fc5103373c8595f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0981b9857ed9a4c840221b089fc5103373c8595f", "html_url": "https://github.com/rust-lang/rust/commit/0981b9857ed9a4c840221b089fc5103373c8595f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0981b9857ed9a4c840221b089fc5103373c8595f/comments", "author": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff18038d750d5b692b4896c338e33ed134fe4ba2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff18038d750d5b692b4896c338e33ed134fe4ba2", "html_url": "https://github.com/rust-lang/rust/commit/ff18038d750d5b692b4896c338e33ed134fe4ba2"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "10726b9842080be4c5e34f9f07f1394c121e7d2e", "filename": "src/tools/compiletest/src/json.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0981b9857ed9a4c840221b089fc5103373c8595f/src%2Ftools%2Fcompiletest%2Fsrc%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0981b9857ed9a4c840221b089fc5103373c8595f/src%2Ftools%2Fcompiletest%2Fsrc%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fjson.rs?ref=0981b9857ed9a4c840221b089fc5103373c8595f", "patch": "@@ -23,6 +23,14 @@ struct ArtifactNotification {\n     artifact: PathBuf,\n }\n \n+#[derive(Deserialize)]\n+struct UnusedExternNotification {\n+    #[allow(dead_code)]\n+    lint_level: String,\n+    #[allow(dead_code)]\n+    unused_extern_names: Vec<String>,\n+}\n+\n #[derive(Deserialize, Clone)]\n struct DiagnosticSpan {\n     file_name: String,\n@@ -113,6 +121,9 @@ pub fn extract_rendered(output: &str) -> String {\n                 } else if serde_json::from_str::<ArtifactNotification>(line).is_ok() {\n                     // Ignore the notification.\n                     None\n+                } else if serde_json::from_str::<UnusedExternNotification>(line).is_ok() {\n+                    // Ignore the notification.\n+                    None\n                 } else {\n                     print!(\n                         \"failed to decode compiler output as json: line: {}\\noutput: {}\","}]}