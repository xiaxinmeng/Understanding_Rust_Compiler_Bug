{"sha": "952f344cdc0bca58d9f6c54dcfbae0890246e886", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1MmYzNDRjZGMwYmNhNThkOWY2YzU0ZGNmYmFlMDg5MDI0NmU4ODY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-18T19:36:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-18T19:36:26Z"}, "message": "Auto merge of #50697 - KiChjang:issue-50461, r=pnkfelix\n\nUse EverInit instead of MaybeInit to determine initialization\n\nFixes #50461.\nFixes #50463.", "tree": {"sha": "0eb2b5a5c90a4750faded1ccaf044cb45e13d17e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0eb2b5a5c90a4750faded1ccaf044cb45e13d17e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/952f344cdc0bca58d9f6c54dcfbae0890246e886", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/952f344cdc0bca58d9f6c54dcfbae0890246e886", "html_url": "https://github.com/rust-lang/rust/commit/952f344cdc0bca58d9f6c54dcfbae0890246e886", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/952f344cdc0bca58d9f6c54dcfbae0890246e886/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a722296b6ec17fecd3f16a7d3f9232b83e5de800", "url": "https://api.github.com/repos/rust-lang/rust/commits/a722296b6ec17fecd3f16a7d3f9232b83e5de800", "html_url": "https://github.com/rust-lang/rust/commit/a722296b6ec17fecd3f16a7d3f9232b83e5de800"}, {"sha": "8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "html_url": "https://github.com/rust-lang/rust/commit/8b24644c42c0b6a0a3a3e561af2049001e82c9a4"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "5d6d4619c5e0520d63e41c982863044bc8c8a1b3", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/952f344cdc0bca58d9f6c54dcfbae0890246e886/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/952f344cdc0bca58d9f6c54dcfbae0890246e886/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=952f344cdc0bca58d9f6c54dcfbae0890246e886", "patch": "@@ -1808,9 +1808,9 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                 }\n             }\n             Reservation(WriteKind::Move)\n+            | Write(WriteKind::Move)\n             | Reservation(WriteKind::StorageDeadOrDrop)\n             | Reservation(WriteKind::MutableBorrow(BorrowKind::Shared))\n-            | Write(WriteKind::Move)\n             | Write(WriteKind::StorageDeadOrDrop)\n             | Write(WriteKind::MutableBorrow(BorrowKind::Shared)) => {\n                 if let Err(_place_err) = self.is_mutable(place, is_local_mutation_allowed) {\n@@ -1849,8 +1849,11 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                     // mutated, then it is justified to be annotated with the `mut`\n                     // keyword, since the mutation may be a possible reassignment.\n                     let mpi = self.move_data.rev_lookup.find_local(*local);\n-                    if flow_state.inits.contains(&mpi) {\n-                        self.used_mut.insert(*local);\n+                    let ii = &self.move_data.init_path_map[mpi];\n+                    for index in ii {\n+                        if flow_state.ever_inits.contains(index) {\n+                            self.used_mut.insert(*local);\n+                        }\n                     }\n                 }\n             }"}, {"sha": "d5cf122bf3b336e4fdeb6a9ec3ebf61f221045ee", "filename": "src/test/run-pass/nll/issue-50461-used-mut-from-moves.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/952f344cdc0bca58d9f6c54dcfbae0890246e886/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs", "raw_url": "https://github.com/rust-lang/rust/raw/952f344cdc0bca58d9f6c54dcfbae0890246e886/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs?ref=952f344cdc0bca58d9f6c54dcfbae0890246e886", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(nll)]\n+#![deny(unused_mut)]\n+\n+struct Foo {\n+    pub value: i32\n+}\n+\n+fn use_foo_mut(mut foo: Foo) {\n+    foo = foo;\n+    println!(\"{}\", foo.value);\n+}\n+\n+fn main() {\n+    use_foo_mut(Foo { value: 413 });\n+}"}]}