{"sha": "f56b6d0b12009fb1e124de0a5ccdf956816225a6", "node_id": "C_kwDOAAsO6NoAKGY1NmI2ZDBiMTIwMDlmYjFlMTI0ZGUwYTVjY2RmOTU2ODE2MjI1YTY", "commit": {"author": {"name": "ozkanonur", "email": "work@onurozkan.dev", "date": "2023-04-25T14:20:58Z"}, "committer": {"name": "ozkanonur", "email": "work@onurozkan.dev", "date": "2023-04-25T14:20:58Z"}, "message": "pass `unused_extern_crates` in `librustdoc::doctest::make_test`\n\nSigned-off-by: ozkanonur <work@onurozkan.dev>", "tree": {"sha": "83a0685ecd8b6fa370ff85c0ec38cc84192adc2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83a0685ecd8b6fa370ff85c0ec38cc84192adc2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f56b6d0b12009fb1e124de0a5ccdf956816225a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f56b6d0b12009fb1e124de0a5ccdf956816225a6", "html_url": "https://github.com/rust-lang/rust/commit/f56b6d0b12009fb1e124de0a5ccdf956816225a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f56b6d0b12009fb1e124de0a5ccdf956816225a6/comments", "author": {"login": "ozkanonur", "id": 39852038, "node_id": "MDQ6VXNlcjM5ODUyMDM4", "avatar_url": "https://avatars.githubusercontent.com/u/39852038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ozkanonur", "html_url": "https://github.com/ozkanonur", "followers_url": "https://api.github.com/users/ozkanonur/followers", "following_url": "https://api.github.com/users/ozkanonur/following{/other_user}", "gists_url": "https://api.github.com/users/ozkanonur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ozkanonur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ozkanonur/subscriptions", "organizations_url": "https://api.github.com/users/ozkanonur/orgs", "repos_url": "https://api.github.com/users/ozkanonur/repos", "events_url": "https://api.github.com/users/ozkanonur/events{/privacy}", "received_events_url": "https://api.github.com/users/ozkanonur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ozkanonur", "id": 39852038, "node_id": "MDQ6VXNlcjM5ODUyMDM4", "avatar_url": "https://avatars.githubusercontent.com/u/39852038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ozkanonur", "html_url": "https://github.com/ozkanonur", "followers_url": "https://api.github.com/users/ozkanonur/followers", "following_url": "https://api.github.com/users/ozkanonur/following{/other_user}", "gists_url": "https://api.github.com/users/ozkanonur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ozkanonur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ozkanonur/subscriptions", "organizations_url": "https://api.github.com/users/ozkanonur/orgs", "repos_url": "https://api.github.com/users/ozkanonur/repos", "events_url": "https://api.github.com/users/ozkanonur/events{/privacy}", "received_events_url": "https://api.github.com/users/ozkanonur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3128fd8ddfde44f09f7c3920c552122f5aec2395", "url": "https://api.github.com/repos/rust-lang/rust/commits/3128fd8ddfde44f09f7c3920c552122f5aec2395", "html_url": "https://github.com/rust-lang/rust/commit/3128fd8ddfde44f09f7c3920c552122f5aec2395"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "d71098ad89da06f70b8ca05eb41dc32ab1e0e3db", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f56b6d0b12009fb1e124de0a5ccdf956816225a6/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f56b6d0b12009fb1e124de0a5ccdf956816225a6/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=f56b6d0b12009fb1e124de0a5ccdf956816225a6", "patch": "@@ -679,6 +679,10 @@ pub(crate) fn make_test(\n             // parse the source, but only has false positives, not false\n             // negatives.\n             if s.contains(crate_name) {\n+                // rustdoc implicitly inserts an `extern crate` item for the own crate\n+                // which may be unused, so we need to allow the lint.\n+                prog.push_str(&format!(\"#[allow(unused_extern_crates)]\\n\"));\n+\n                 prog.push_str(&format!(\"extern crate r#{crate_name};\\n\"));\n                 line_offset += 1;\n             }"}, {"sha": "a30fe28f94f99a674579e1a1b7e9dc395a5c7cdf", "filename": "src/librustdoc/doctest/tests.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f56b6d0b12009fb1e124de0a5ccdf956816225a6/src%2Flibrustdoc%2Fdoctest%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f56b6d0b12009fb1e124de0a5ccdf956816225a6/src%2Flibrustdoc%2Fdoctest%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest%2Ftests.rs?ref=f56b6d0b12009fb1e124de0a5ccdf956816225a6", "patch": "@@ -38,6 +38,7 @@ fn make_test_crate_name() {\n     let input = \"use asdf::qwop;\n assert_eq!(2+2, 4);\";\n     let expected = \"#![allow(unused)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -128,6 +129,7 @@ fn make_test_opts_attrs() {\n     let input = \"use asdf::qwop;\n assert_eq!(2+2, 4);\";\n     let expected = \"#![feature(sick_rad)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -141,6 +143,7 @@ assert_eq!(2+2, 4);\n     opts.attrs.push(\"feature(hella_dope)\".to_string());\n     let expected = \"#![feature(sick_rad)]\n #![feature(hella_dope)]\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n use asdf::qwop;\n@@ -236,6 +239,7 @@ assert_eq!(asdf::foo, 4);\";\n \n     let expected = \"#![allow(unused)]\n extern crate hella_qwop;\n+#[allow(unused_extern_crates)]\n extern crate r#asdf;\n fn main() {\n assert_eq!(asdf::foo, 4);"}, {"sha": "2542ed657c1a78ed94ab56ba1889cd95b29da5f8", "filename": "tests/rustdoc/playground-arg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f56b6d0b12009fb1e124de0a5ccdf956816225a6/tests%2Frustdoc%2Fplayground-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f56b6d0b12009fb1e124de0a5ccdf956816225a6/tests%2Frustdoc%2Fplayground-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fplayground-arg.rs?ref=f56b6d0b12009fb1e124de0a5ccdf956816225a6", "patch": "@@ -10,4 +10,4 @@\n pub fn dummy() {}\n \n // ensure that `extern crate foo;` was inserted into code snips automatically:\n-// @matches foo/index.html '//a[@class=\"test-arrow\"][@href=\"https://example.com/?code=%23!%5Ballow(unused)%5D%0Aextern+crate+r%23foo;%0Afn+main()+%7B%0Ause+foo::dummy;%0Adummy();%0A%7D&edition=2015\"]' \"Run\"\n+// @matches foo/index.html '//a[@class=\"test-arrow\"][@href=\"https://example.com/?code=%23!%5Ballow(unused)%5D%0A%23%5Ballow(unused_extern_crates)%5D%0Aextern+crate+r%23foo;%0Afn+main()+%7B%0Ause+foo::dummy;%0Adummy();%0A%7D&edition=2015\"]' \"Run\""}]}