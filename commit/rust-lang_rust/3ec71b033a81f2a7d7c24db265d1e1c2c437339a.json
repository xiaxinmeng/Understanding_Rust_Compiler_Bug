{"sha": "3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlYzcxYjAzM2E4MWYyYTdkN2MyNGRiMjY1ZDFlMWMyYzQzNzMzOWE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-02T17:30:03Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-02T17:30:03Z"}, "message": "Auto merge of #32598 - alexcrichton:rustbuild-osx, r=aturon\n\nrustbuild: Fix compile on OSX for 10.7\n\nThis commit should help configure our OSX rustbuild builder for targeting 10.7.\nA key part of this is using `libc++` instead of `libstdc++` as apparently it's\nmore filled out and otherwise LLVM's cmake configuration would fail.", "tree": {"sha": "4b14c3469710215dff674b17c33b1518c84c6b04", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b14c3469710215dff674b17c33b1518c84c6b04"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "html_url": "https://github.com/rust-lang/rust/commit/3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1af79cf34e1fd6f38ba256631e2997ca650e490b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1af79cf34e1fd6f38ba256631e2997ca650e490b", "html_url": "https://github.com/rust-lang/rust/commit/1af79cf34e1fd6f38ba256631e2997ca650e490b"}, {"sha": "08ca5d955832ee412250a776ce811c9d6abf2100", "url": "https://api.github.com/repos/rust-lang/rust/commits/08ca5d955832ee412250a776ce811c9d6abf2100", "html_url": "https://github.com/rust-lang/rust/commit/08ca5d955832ee412250a776ce811c9d6abf2100"}], "stats": {"total": 36, "additions": 24, "deletions": 12}, "files": [{"sha": "248bf6cb4ea153f0e32b7dc67131f422a70e6ebc", "filename": "src/bootstrap/build/mod.rs", "status": "modified", "additions": 21, "deletions": 6, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Fbootstrap%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Fbootstrap%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fmod.rs?ref=3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "patch": "@@ -326,7 +326,13 @@ impl Build {\n         if !target.contains(\"msvc\") {\n             cargo.env(format!(\"CC_{}\", target), self.cc(target))\n                  .env(format!(\"AR_{}\", target), self.ar(target))\n-                 .env(format!(\"CFLAGS_{}\", target), self.cflags(target));\n+                 .env(format!(\"CFLAGS_{}\", target), self.cflags(target).join(\" \"));\n+        }\n+\n+        // If we're building for OSX, inform the compiler and the linker that\n+        // we want to build a compiler runnable on 10.7\n+        if target.contains(\"apple-darwin\") {\n+            cargo.env(\"MACOSX_DEPLOYMENT_TARGET\", \"10.7\");\n         }\n \n         // Environment variables *required* needed throughout the build\n@@ -497,11 +503,20 @@ impl Build {\n         self.cc[target].0.path()\n     }\n \n-    fn cflags(&self, target: &str) -> String {\n-        self.cc[target].0.args().iter()\n-            .map(|s| s.to_string_lossy())\n-            .collect::<Vec<_>>()\n-            .join(\" \")\n+    fn cflags(&self, target: &str) -> Vec<String> {\n+        let mut base = self.cc[target].0.args().iter()\n+                           .map(|s| s.to_string_lossy().into_owned())\n+                           .collect::<Vec<_>>();\n+\n+        // If we're compiling on OSX then we add a few unconditional flags\n+        // indicating that we want libc++ (more filled out than libstdc++) and\n+        // we want to compile for 10.7. This way we can ensure that\n+        // LLVM/jemalloc/etc are all properly compiled.\n+        if target.contains(\"apple-darwin\") {\n+            base.push(\"-stdlib=libc++\".into());\n+            base.push(\"-mmacosx-version-min=10.7\".into());\n+        }\n+        return base\n     }\n \n     fn ar(&self, target: &str) -> &Path {"}, {"sha": "bf0494bcd8c8c5a4240ca05579d8837d257b2700", "filename": "src/bootstrap/build/native.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Fbootstrap%2Fbuild%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Fbootstrap%2Fbuild%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fnative.rs?ref=3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "patch": "@@ -86,6 +86,9 @@ pub fn llvm(build: &Build, target: &str) {\n               .define(\"CMAKE_CXX_COMPILER\", build.cxx(target));\n         }\n         cfg.build_arg(\"-j\").build_arg(build.jobs().to_string());\n+\n+        cfg.define(\"CMAKE_C_FLAGS\", build.cflags(target).join(\" \"));\n+        cfg.define(\"CMAKE_CXX_FLAGS\", build.cflags(target).join(\" \"));\n     }\n \n     // FIXME: we don't actually need to build all LLVM tools and all LLVM"}, {"sha": "3f0d5086a17875b8097c13303fc0e62f2a727641", "filename": "src/rustc/Cargo.lock", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Frustc%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/3ec71b033a81f2a7d7c24db265d1e1c2c437339a/src%2Frustc%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2FCargo.lock?ref=3ec71b033a81f2a7d7c24db265d1e1c2c437339a", "patch": "@@ -76,7 +76,6 @@ dependencies = [\n  \"rustc_const_eval 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n  \"rustc_front 0.0.0\",\n- \"rustc_llvm 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n@@ -87,7 +86,6 @@ version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"rustc_front 0.0.0\",\n- \"rustc_llvm 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n@@ -227,10 +225,6 @@ dependencies = [\n [[package]]\n name = \"rustc_platform_intrinsics\"\n version = \"0.0.0\"\n-dependencies = [\n- \"rustc 0.0.0\",\n- \"rustc_llvm 0.0.0\",\n-]\n \n [[package]]\n name = \"rustc_plugin\""}]}