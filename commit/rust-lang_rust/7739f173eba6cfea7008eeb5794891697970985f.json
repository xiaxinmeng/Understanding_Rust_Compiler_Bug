{"sha": "7739f173eba6cfea7008eeb5794891697970985f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3MzlmMTczZWJhNmNmZWE3MDA4ZWViNTc5NDg5MTY5Nzk3MDk4NWY=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-10-06T04:54:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-06T04:54:59Z"}, "message": "Rollup merge of #65100 - csmoe:generator, r=nikomatsakis\n\nReplace GeneratorSubsts with SubstsRef\n\nCloses #42340\nr? @nikomatsakis", "tree": {"sha": "aefdb1a0001c5987fcb68fd2efb93f1575ec88a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aefdb1a0001c5987fcb68fd2efb93f1575ec88a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7739f173eba6cfea7008eeb5794891697970985f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdmXOjCRBK7hj4Ov3rIwAAdHIIAD5pl/olZ1y7/MJslNbEsYeh\nX9nh2CHfQo1tH6oYhQ008D8ZayclDtKxgL2LZbTj166UY0vgTBowKw5KzzhC82JP\n3V3eqWpYvYjUKCG8GYjhMQ2S6saA2YLbqZy5SAnuJEiAwjkOh5mpUctrnkXApdQQ\nff4hrnI6CdngXhwo4IIxyaDJXYQ5ESLVuwNwSL00tOmBueA9A4K5ZdSeicHcQcx/\nnokXGIX5AKODbODw1KUAUMZL59Z+bn3gTf0XUu7McwBqSMuGbJxjQIHMC/PFk0Ut\nDaTxX2eq/av97LqU9sF8ILAwANvtvzcpty3bVghYF0s2Q42X0I3fJW1Xh0LkiAE=\n=VX9W\n-----END PGP SIGNATURE-----\n", "payload": "tree aefdb1a0001c5987fcb68fd2efb93f1575ec88a6\nparent f14d374d3bd8c05983e9882a01068d71c13ba26f\nparent afc0bb9794bfcbc9864a1d195ac34b892727f9e4\nauthor Tyler Mandry <tmandry@gmail.com> 1570337699 -0700\ncommitter GitHub <noreply@github.com> 1570337699 -0700\n\nRollup merge of #65100 - csmoe:generator, r=nikomatsakis\n\nReplace GeneratorSubsts with SubstsRef\n\nCloses #42340\nr? @nikomatsakis\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7739f173eba6cfea7008eeb5794891697970985f", "html_url": "https://github.com/rust-lang/rust/commit/7739f173eba6cfea7008eeb5794891697970985f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7739f173eba6cfea7008eeb5794891697970985f/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f14d374d3bd8c05983e9882a01068d71c13ba26f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f14d374d3bd8c05983e9882a01068d71c13ba26f", "html_url": "https://github.com/rust-lang/rust/commit/f14d374d3bd8c05983e9882a01068d71c13ba26f"}, {"sha": "afc0bb9794bfcbc9864a1d195ac34b892727f9e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/afc0bb9794bfcbc9864a1d195ac34b892727f9e4", "html_url": "https://github.com/rust-lang/rust/commit/afc0bb9794bfcbc9864a1d195ac34b892727f9e4"}], "stats": {"total": 236, "additions": 110, "deletions": 126}, "files": [{"sha": "bd19a002fe8b7bf676e185b527bd5a034eaa574c", "filename": "src/librustc/infer/opaque_types/mod.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fopaque_types%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -733,12 +733,12 @@ where\n                 // Skip lifetime parameters of the enclosing item(s)\n                 // Also skip the witness type, because that has no free regions.\n \n-                for upvar_ty in substs.upvar_tys(def_id, self.tcx) {\n+                for upvar_ty in substs.as_generator().upvar_tys(def_id, self.tcx) {\n                     upvar_ty.visit_with(self);\n                 }\n \n-                substs.return_ty(def_id, self.tcx).visit_with(self);\n-                substs.yield_ty(def_id, self.tcx).visit_with(self);\n+                substs.as_generator().return_ty(def_id, self.tcx).visit_with(self);\n+                substs.as_generator().yield_ty(def_id, self.tcx).visit_with(self);\n             }\n             _ => {\n                 ty.super_visit_with(self);\n@@ -902,7 +902,7 @@ impl TypeFolder<'tcx> for ReverseMapper<'tcx> {\n             ty::Generator(def_id, substs, movability) => {\n                 let generics = self.tcx.generics_of(def_id);\n                 let substs =\n-                    self.tcx.mk_substs(substs.substs.iter().enumerate().map(|(index, &kind)| {\n+                    self.tcx.mk_substs(substs.iter().enumerate().map(|(index, &kind)| {\n                         if index < generics.parent_count {\n                             // Accommodate missing regions in the parent kinds...\n                             self.fold_kind_mapping_missing_regions_to_empty(kind)\n@@ -912,7 +912,7 @@ impl TypeFolder<'tcx> for ReverseMapper<'tcx> {\n                         }\n                     }));\n \n-                self.tcx.mk_generator(def_id, ty::GeneratorSubsts { substs }, movability)\n+                self.tcx.mk_generator(def_id, substs, movability)\n             }\n \n             ty::Param(..) => {"}, {"sha": "2b5212cb7efaa5ca5c095da678a6f079845fd998", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -15,7 +15,7 @@ use crate::ty::layout::VariantIdx;\n use crate::ty::print::{FmtPrinter, Printer};\n use crate::ty::subst::{Subst, SubstsRef};\n use crate::ty::{\n-    self, AdtDef, CanonicalUserTypeAnnotations, GeneratorSubsts, Region, Ty, TyCtxt,\n+    self, AdtDef, CanonicalUserTypeAnnotations, Region, Ty, TyCtxt,\n     UserTypeAnnotationIndex,\n };\n \n@@ -2189,7 +2189,7 @@ pub enum AggregateKind<'tcx> {\n     Adt(&'tcx AdtDef, VariantIdx, SubstsRef<'tcx>, Option<UserTypeAnnotationIndex>, Option<usize>),\n \n     Closure(DefId, SubstsRef<'tcx>),\n-    Generator(DefId, GeneratorSubsts<'tcx>, hir::GeneratorMovability),\n+    Generator(DefId, SubstsRef<'tcx>, hir::GeneratorMovability),\n }\n \n #[derive(Copy, Clone, Debug, PartialEq, Eq, RustcEncodable, RustcDecodable, HashStable)]"}, {"sha": "e87aabf9a0566498cbe1cd615819a20a58c1a2b6", "filename": "src/librustc/mir/tcx.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Ftcx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Ftcx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Ftcx.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -197,7 +197,7 @@ impl<'tcx> Rvalue<'tcx> {\n                 let ty = place.ty(local_decls, tcx).ty;\n                 match ty.kind {\n                     ty::Adt(adt_def, _) => adt_def.repr.discr_type().to_ty(tcx),\n-                    ty::Generator(_, substs, _) => substs.discr_ty(tcx),\n+                    ty::Generator(_, substs, _) => substs.as_generator().discr_ty(tcx),\n                     _ => {\n                         // This can only be `0`, for now, so `u8` will suffice.\n                         tcx.types.u8"}, {"sha": "edc7922f46eec1bb7b84978225a28dd25146b678", "filename": "src/librustc/mir/visit.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fmir%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fvisit.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -1,5 +1,5 @@\n use crate::ty::subst::SubstsRef;\n-use crate::ty::{CanonicalUserTypeAnnotation, GeneratorSubsts, Ty};\n+use crate::ty::{CanonicalUserTypeAnnotation, Ty};\n use crate::mir::*;\n use syntax_pos::Span;\n \n@@ -230,12 +230,6 @@ macro_rules! make_mir_visitor {\n                 self.super_substs(substs);\n             }\n \n-            fn visit_generator_substs(&mut self,\n-                                      substs: & $($mutability)? GeneratorSubsts<'tcx>,\n-                                    _: Location) {\n-                self.super_generator_substs(substs);\n-            }\n-\n             fn visit_local_decl(&mut self,\n                                 local: Local,\n                                 local_decl: & $($mutability)? LocalDecl<'tcx>) {\n@@ -628,7 +622,7 @@ macro_rules! make_mir_visitor {\n                                 generator_substs,\n                                 _movability,\n                             ) => {\n-                                self.visit_generator_substs(generator_substs, location);\n+                                self.visit_substs(generator_substs, location);\n                             }\n                         }\n \n@@ -846,10 +840,6 @@ macro_rules! make_mir_visitor {\n             fn super_substs(&mut self, _substs: & $($mutability)? SubstsRef<'tcx>) {\n             }\n \n-            fn super_generator_substs(&mut self,\n-                                      _substs: & $($mutability)? GeneratorSubsts<'tcx>) {\n-            }\n-\n             // Convenience methods\n \n             fn visit_location(&mut self, body: & $($mutability)? Body<'tcx>, location: Location) {"}, {"sha": "d96330bf0a9b4680b88b16328cea577577d4749b", "filename": "src/librustc/traits/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -610,7 +610,7 @@ pub struct VtableImplData<'tcx, N> {\n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable, HashStable)]\n pub struct VtableGeneratorData<'tcx, N> {\n     pub generator_def_id: DefId,\n-    pub substs: ty::GeneratorSubsts<'tcx>,\n+    pub substs: SubstsRef<'tcx>,\n     /// Nested obligations. This can be non-empty if the generator\n     /// signature contains associated types.\n     pub nested: Vec<N>"}, {"sha": "5b4ec885d7785e23a0976dbc8ee49d8db18ffb05", "filename": "src/librustc/traits/project.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fproject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fproject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fproject.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -1259,7 +1259,7 @@ fn confirm_generator_candidate<'cx, 'tcx>(\n     obligation: &ProjectionTyObligation<'tcx>,\n     vtable: VtableGeneratorData<'tcx, PredicateObligation<'tcx>>,\n ) -> Progress<'tcx> {\n-    let gen_sig = vtable.substs.poly_sig(vtable.generator_def_id, selcx.tcx());\n+    let gen_sig = vtable.substs.as_generator().poly_sig(vtable.generator_def_id, selcx.tcx());\n     let Normalized {\n         value: gen_sig,\n         obligations"}, {"sha": "4ee5700f43fe12cbf35fa36a0e51df0d689dabb4", "filename": "src/librustc/traits/select.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fselect.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -2761,8 +2761,9 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 .collect(),\n \n             ty::Generator(def_id, ref substs, _) => {\n-                let witness = substs.witness(def_id, self.tcx());\n+                let witness = substs.as_generator().witness(def_id, self.tcx());\n                 substs\n+                    .as_generator()\n                     .upvar_tys(def_id, self.tcx())\n                     .chain(iter::once(witness))\n                     .collect()\n@@ -3324,8 +3325,8 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         )?);\n \n         Ok(VtableGeneratorData {\n-            generator_def_id: generator_def_id,\n-            substs: substs.clone(),\n+            generator_def_id,\n+            substs,\n             nested: obligations,\n         })\n     }\n@@ -3911,9 +3912,9 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         &mut self,\n         obligation: &TraitObligation<'tcx>,\n         closure_def_id: DefId,\n-        substs: ty::GeneratorSubsts<'tcx>,\n+        substs: SubstsRef<'tcx>,\n     ) -> ty::PolyTraitRef<'tcx> {\n-        let gen_sig = substs.poly_sig(closure_def_id, self.tcx());\n+        let gen_sig = substs.as_generator().poly_sig(closure_def_id, self.tcx());\n \n         // (1) Feels icky to skip the binder here, but OTOH we know\n         // that the self-type is an generator type and hence is"}, {"sha": "eb380eb12d8e7545e572748c9858eef24cd13441", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -29,7 +29,7 @@ use crate::traits;\n use crate::traits::{Clause, Clauses, GoalKind, Goal, Goals};\n use crate::ty::{self, DefIdTree, Ty, TypeAndMut};\n use crate::ty::{TyS, TyKind, List};\n-use crate::ty::{AdtKind, AdtDef, GeneratorSubsts, Region, Const};\n+use crate::ty::{AdtKind, AdtDef, Region, Const};\n use crate::ty::{PolyFnSig, InferTy, ParamTy, ProjectionTy, ExistentialPredicate, Predicate};\n use crate::ty::RegionKind;\n use crate::ty::{TyVar, TyVid, IntVar, IntVid, FloatVar, FloatVid, ConstVid};\n@@ -2510,7 +2510,7 @@ impl<'tcx> TyCtxt<'tcx> {\n     #[inline]\n     pub fn mk_generator(self,\n                         id: DefId,\n-                        generator_substs: GeneratorSubsts<'tcx>,\n+                        generator_substs: SubstsRef<'tcx>,\n                         movability: hir::GeneratorMovability)\n                         -> Ty<'tcx> {\n         self.mk_ty(Generator(id, generator_substs, movability))"}, {"sha": "4ff5e1a7b8de2615ada83db44d27b8b56e218704", "filename": "src/librustc/ty/flags.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fflags.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -94,7 +94,7 @@ impl FlagComputation {\n             &ty::Generator(_, ref substs, _) => {\n                 self.add_flags(TypeFlags::HAS_TY_CLOSURE);\n                 self.add_flags(TypeFlags::HAS_FREE_LOCAL_NAMES);\n-                self.add_substs(&substs.substs);\n+                self.add_substs(substs);\n             }\n \n             &ty::GeneratorWitness(ref ts) => {"}, {"sha": "93a8341e74628063fdda5cd8144c1d1dfdbc6b2c", "filename": "src/librustc/ty/instance.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Finstance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Finstance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Finstance.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -71,7 +71,7 @@ impl<'tcx> Instance<'tcx> {\n                 ))\n             }\n             ty::Generator(def_id, substs, _) => {\n-                let sig = substs.poly_sig(def_id, tcx);\n+                let sig = substs.as_generator().poly_sig(def_id, tcx);\n \n                 let env_region = ty::ReLateBound(ty::INNERMOST, ty::BrEnv);\n                 let env_ty = tcx.mk_mut_ref(tcx.mk_region(env_region), ty);\n@@ -395,7 +395,7 @@ fn resolve_associated_item<'tcx>(\n         traits::VtableGenerator(generator_data) => {\n             Some(Instance {\n                 def: ty::InstanceDef::Item(generator_data.generator_def_id),\n-                substs: generator_data.substs.substs\n+                substs: generator_data.substs\n             })\n         }\n         traits::VtableClosure(closure_data) => {"}, {"sha": "ce7e1822d9ab5d6bbc09a6a79f795d0045100553", "filename": "src/librustc/ty/layout.rs", "status": "modified", "additions": 9, "deletions": 10, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Flayout.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -1,5 +1,5 @@\n use crate::session::{self, DataTypeKind};\n-use crate::ty::{self, Ty, TyCtxt, TypeFoldable, ReprOptions};\n+use crate::ty::{self, Ty, TyCtxt, TypeFoldable, ReprOptions, subst::SubstsRef};\n \n use syntax::ast::{self, Ident, IntTy, UintTy};\n use syntax::attr;\n@@ -15,7 +15,6 @@ use std::ops::Bound;\n use crate::hir;\n use crate::ich::StableHashingContext;\n use crate::mir::{GeneratorLayout, GeneratorSavedLocal};\n-use crate::ty::GeneratorSubsts;\n use crate::ty::subst::Subst;\n use rustc_index::bit_set::BitSet;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n@@ -671,7 +670,7 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n                 tcx.intern_layout(unit)\n             }\n \n-            ty::Generator(def_id, substs, _) => self.generator_layout(ty, def_id, &substs)?,\n+            ty::Generator(def_id, substs, _) => self.generator_layout(ty, def_id, substs)?,\n \n             ty::Closure(def_id, ref substs) => {\n                 let tys = substs.as_closure().upvar_tys(def_id, tcx);\n@@ -1406,22 +1405,22 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n         &self,\n         ty: Ty<'tcx>,\n         def_id: hir::def_id::DefId,\n-        substs: &GeneratorSubsts<'tcx>,\n+        substs: SubstsRef<'tcx>,\n     ) -> Result<&'tcx LayoutDetails, LayoutError<'tcx>> {\n         use SavedLocalEligibility::*;\n         let tcx = self.tcx;\n \n-        let subst_field = |ty: Ty<'tcx>| { ty.subst(tcx, substs.substs) };\n+        let subst_field = |ty: Ty<'tcx>| { ty.subst(tcx, substs) };\n \n         let info = tcx.generator_layout(def_id);\n         let (ineligible_locals, assignments) = self.generator_saved_local_eligibility(&info);\n \n         // Build a prefix layout, including \"promoting\" all ineligible\n         // locals as part of the prefix. We compute the layout of all of\n         // these fields at once to get optimal packing.\n-        let discr_index = substs.prefix_tys(def_id, tcx).count();\n+        let discr_index = substs.as_generator().prefix_tys(def_id, tcx).count();\n         // FIXME(eddyb) set the correct vaidity range for the discriminant.\n-        let discr_layout = self.layout_of(substs.discr_ty(tcx))?;\n+        let discr_layout = self.layout_of(substs.as_generator().discr_ty(tcx))?;\n         let discr = match &discr_layout.abi {\n             Abi::Scalar(s) => s.clone(),\n             _ => bug!(),\n@@ -1430,7 +1429,7 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n             .map(|local| subst_field(info.field_tys[local]))\n             .map(|ty| tcx.mk_maybe_uninit(ty))\n             .map(|ty| self.layout_of(ty));\n-        let prefix_layouts = substs.prefix_tys(def_id, tcx)\n+        let prefix_layouts = substs.as_generator().prefix_tys(def_id, tcx)\n             .map(|ty| self.layout_of(ty))\n             .chain(iter::once(Ok(discr_layout)))\n             .chain(promoted_layouts)\n@@ -2153,15 +2152,15 @@ where\n             ty::Generator(def_id, ref substs, _) => {\n                 match this.variants {\n                     Variants::Single { index } => {\n-                        substs.state_tys(def_id, tcx)\n+                        substs.as_generator().state_tys(def_id, tcx)\n                             .nth(index.as_usize()).unwrap()\n                             .nth(i).unwrap()\n                     }\n                     Variants::Multiple { ref discr, discr_index, .. } => {\n                         if i == discr_index {\n                             return discr_layout(discr);\n                         }\n-                        substs.prefix_tys(def_id, tcx).nth(i).unwrap()\n+                        substs.as_generator().prefix_tys(def_id, tcx).nth(i).unwrap()\n                     }\n                 }\n             }"}, {"sha": "80e77cdfad0b6ec97f5eaa990f2e3e88bb97eaf1", "filename": "src/librustc/ty/outlives.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Foutlives.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Foutlives.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Foutlives.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -69,7 +69,7 @@ impl<'tcx> TyCtxt<'tcx> {\n \n             ty::Generator(def_id, ref substs, _) => {\n                 // Same as the closure case\n-                for upvar_ty in substs.upvar_tys(def_id, *self) {\n+                for upvar_ty in substs.as_generator().upvar_tys(def_id, *self) {\n                     self.compute_components(upvar_ty, out);\n                 }\n "}, {"sha": "df39d0ccc9eed08eab509f2504669679056ad7c0", "filename": "src/librustc/ty/print/obsolete.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fprint%2Fobsolete.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fprint%2Fobsolete.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fobsolete.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -8,7 +8,7 @@\n use rustc::hir::def_id::DefId;\n use rustc::mir::interpret::ConstValue;\n use rustc::ty::subst::SubstsRef;\n-use rustc::ty::{self, Const, GeneratorSubsts, Instance, Ty, TyCtxt};\n+use rustc::ty::{self, Const, Instance, Ty, TyCtxt};\n use rustc::{bug, hir};\n use std::fmt::Write;\n use std::iter;\n@@ -154,7 +154,7 @@ impl DefPathBasedNames<'tcx> {\n                     self.push_type_name(sig.output(), output, debug);\n                 }\n             }\n-            ty::Generator(def_id, GeneratorSubsts { substs }, _)\n+            ty::Generator(def_id,  substs, _)\n             | ty::Closure(def_id, substs) => {\n                 self.push_def_path(def_id, output);\n                 let generics = self.tcx.generics_of(self.tcx.closure_base_def_id(def_id));"}, {"sha": "732638929963d83fb4dc8bdb09c2c525852ee4b7", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -605,8 +605,8 @@ pub trait PrettyPrinter<'tcx>:\n             }\n             ty::Str => p!(write(\"str\")),\n             ty::Generator(did, substs, movability) => {\n-                let upvar_tys = substs.upvar_tys(did, self.tcx());\n-                let witness = substs.witness(did, self.tcx());\n+                let upvar_tys = substs.as_generator().upvar_tys(did, self.tcx());\n+                let witness = substs.as_generator().witness(did, self.tcx());\n                 if movability == hir::GeneratorMovability::Movable {\n                     p!(write(\"[generator\"));\n                 } else {"}, {"sha": "e27236b47e07f8501557f344457077532ea503c5", "filename": "src/librustc/ty/sty.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsty.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -163,7 +163,7 @@ pub enum TyKind<'tcx> {\n \n     /// The anonymous type of a generator. Used to represent the type of\n     /// `|a| yield a`.\n-    Generator(DefId, GeneratorSubsts<'tcx>, hir::GeneratorMovability),\n+    Generator(DefId, SubstsRef<'tcx>, hir::GeneratorMovability),\n \n     /// A type representin the types stored inside a generator.\n     /// This should only appear in GeneratorInteriors.\n@@ -512,7 +512,7 @@ impl<'tcx> GeneratorSubsts<'tcx> {\n     /// variant indices.\n     #[inline]\n     pub fn discriminants(\n-        &'tcx self,\n+        self,\n         def_id: DefId,\n         tcx: TyCtxt<'tcx>,\n     ) -> impl Iterator<Item = (VariantIdx, Discr<'tcx>)> + Captures<'tcx> {\n@@ -524,7 +524,7 @@ impl<'tcx> GeneratorSubsts<'tcx> {\n     /// Calls `f` with a reference to the name of the enumerator for the given\n     /// variant `v`.\n     #[inline]\n-    pub fn variant_name(&self, v: VariantIdx) -> Cow<'static, str> {\n+    pub fn variant_name(self, v: VariantIdx) -> Cow<'static, str> {\n         match v.as_usize() {\n             Self::UNRESUMED => Cow::from(Self::UNRESUMED_NAME),\n             Self::RETURNED => Cow::from(Self::RETURNED_NAME),\n@@ -570,7 +570,7 @@ impl<'tcx> GeneratorSubsts<'tcx> {\n #[derive(Debug, Copy, Clone)]\n pub enum UpvarSubsts<'tcx> {\n     Closure(SubstsRef<'tcx>),\n-    Generator(GeneratorSubsts<'tcx>),\n+    Generator(SubstsRef<'tcx>),\n }\n \n impl<'tcx> UpvarSubsts<'tcx> {\n@@ -582,7 +582,7 @@ impl<'tcx> UpvarSubsts<'tcx> {\n     ) -> impl Iterator<Item = Ty<'tcx>> + 'tcx {\n         let upvar_kinds = match self {\n             UpvarSubsts::Closure(substs) => substs.as_closure().split(def_id, tcx).upvar_kinds,\n-            UpvarSubsts::Generator(substs) => substs.split(def_id, tcx).upvar_kinds,\n+            UpvarSubsts::Generator(substs) => substs.as_generator().split(def_id, tcx).upvar_kinds,\n         };\n         upvar_kinds.iter().map(|t| {\n             if let GenericArgKind::Type(ty) = t.unpack() {\n@@ -2109,7 +2109,8 @@ impl<'tcx> TyS<'tcx> {\n     pub fn variant_range(&self, tcx: TyCtxt<'tcx>) -> Option<Range<VariantIdx>> {\n         match self.kind {\n             TyKind::Adt(adt, _) => Some(adt.variant_range()),\n-            TyKind::Generator(def_id, substs, _) => Some(substs.variant_range(def_id, tcx)),\n+            TyKind::Generator(def_id, substs, _) =>\n+                Some(substs.as_generator().variant_range(def_id, tcx)),\n             _ => None,\n         }\n     }\n@@ -2126,7 +2127,7 @@ impl<'tcx> TyS<'tcx> {\n         match self.kind {\n             TyKind::Adt(adt, _) => Some(adt.discriminant_for_variant(tcx, variant_index)),\n             TyKind::Generator(def_id, substs, _) =>\n-                Some(substs.discriminant_for_variant(def_id, tcx, variant_index)),\n+                Some(substs.as_generator().discriminant_for_variant(def_id, tcx, variant_index)),\n             _ => None,\n         }\n     }\n@@ -2149,7 +2150,7 @@ impl<'tcx> TyS<'tcx> {\n                 out.extend(substs.regions())\n             }\n             Closure(_, ref substs ) |\n-            Generator(_, GeneratorSubsts { ref substs }, _) => {\n+            Generator(_, ref substs, _) => {\n                 out.extend(substs.regions())\n             }\n             Projection(ref data) | UnnormalizedProjection(ref data) => {"}, {"sha": "7c5daaf14d784588df3dd6bf78ae0ed63aa615be", "filename": "src/librustc/ty/subst.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fsubst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fsubst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsubst.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -5,7 +5,7 @@ use crate::infer::canonical::Canonical;\n use crate::ty::{self, Lift, List, Ty, TyCtxt, InferConst, ParamConst};\n use crate::ty::fold::{TypeFoldable, TypeFolder, TypeVisitor};\n use crate::mir::interpret::ConstValue;\n-use crate::ty::sty::ClosureSubsts;\n+use crate::ty::sty::{ClosureSubsts, GeneratorSubsts};\n \n use rustc_serialize::{self, Encodable, Encoder, Decodable, Decoder};\n use syntax_pos::{Span, DUMMY_SP};\n@@ -194,6 +194,14 @@ impl<'a, 'tcx> InternalSubsts<'tcx> {\n         }\n     }\n \n+    /// Interpret these substitutions as the substitutions of a generator type.\n+    /// Closure substitutions have a particular structure controlled by the\n+    /// compiler that encodes information like the signature and generator kind;\n+    /// see `ty::GeneratorSubsts` struct for more comments.\n+    pub fn as_generator(&'tcx self) -> GeneratorSubsts<'tcx> {\n+        GeneratorSubsts { substs: self }\n+    }\n+\n     /// Creates a `InternalSubsts` that maps each generic parameter to itself.\n     pub fn identity_for_item(tcx: TyCtxt<'tcx>, def_id: DefId) -> SubstsRef<'tcx> {\n         Self::for_item(tcx, def_id, |param, _| {"}, {"sha": "f5b1902e3cc8c5ab0085125d7c51f4c61351db96", "filename": "src/librustc/ty/walk.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fwalk.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc%2Fty%2Fwalk.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fwalk.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -110,12 +110,10 @@ fn push_subtypes<'tcx>(stack: &mut TypeWalkerStack<'tcx>, parent_ty: Ty<'tcx>) {\n         ty::Adt(_, substs) | ty::Opaque(_, substs) => {\n             stack.extend(substs.types().rev());\n         }\n-        ty::Closure(_, ref substs) => {\n+        ty::Closure(_, ref substs)\n+        | ty::Generator(_, ref substs, _) => {\n             stack.extend(substs.types().rev());\n         }\n-        ty::Generator(_, ref substs, _) => {\n-            stack.extend(substs.substs.types().rev());\n-        }\n         ty::GeneratorWitness(ts) => {\n             stack.extend(ts.skip_binder().iter().cloned().rev());\n         }"}, {"sha": "14e4c4adfaa97e159904100fb92168a0c63a4092", "filename": "src/librustc_codegen_llvm/debuginfo/metadata.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -30,7 +30,7 @@ use rustc::ty::Instance;\n use rustc::ty::{self, AdtKind, ParamEnv, Ty, TyCtxt};\n use rustc::ty::layout::{self, Align, Integer, IntegerExt, LayoutOf,\n                         PrimitiveExt, Size, TyLayout, VariantIdx};\n-use rustc::ty::subst::GenericArgKind;\n+use rustc::ty::subst::{GenericArgKind, SubstsRef};\n use rustc::session::config::{self, DebugInfo};\n use rustc::util::nodemap::FxHashMap;\n use rustc_fs_util::path_to_c_string;\n@@ -692,9 +692,10 @@ pub fn type_metadata(\n                                    Some(containing_scope)).finalize(cx)\n         }\n         ty::Generator(def_id, substs,  _) => {\n-            let upvar_tys : Vec<_> = substs.prefix_tys(def_id, cx.tcx).map(|t| {\n-                cx.tcx.normalize_erasing_regions(ParamEnv::reveal_all(), t)\n-            }).collect();\n+            let upvar_tys : Vec<_> = substs\n+                .as_generator().prefix_tys(def_id, cx.tcx).map(|t| {\n+                    cx.tcx.normalize_erasing_regions(ParamEnv::reveal_all(), t)\n+                }).collect();\n             prepare_enum_metadata(cx,\n                                   t,\n                                   def_id,\n@@ -1338,7 +1339,7 @@ impl EnumMemberDescriptionFactory<'ll, 'tcx> {\n                 ty::Adt(adt, _) => VariantInfo::Adt(&adt.variants[index]),\n                 ty::Generator(def_id, substs, _) => {\n                     let generator_layout = cx.tcx.generator_layout(*def_id);\n-                    VariantInfo::Generator(*substs, generator_layout, index)\n+                    VariantInfo::Generator(substs, generator_layout, index)\n                 }\n                 _ => bug!(),\n             }\n@@ -1611,15 +1612,15 @@ enum EnumDiscriminantInfo<'ll> {\n #[derive(Copy, Clone)]\n enum VariantInfo<'tcx> {\n     Adt(&'tcx ty::VariantDef),\n-    Generator(ty::GeneratorSubsts<'tcx>, &'tcx GeneratorLayout<'tcx>, VariantIdx),\n+    Generator(SubstsRef<'tcx>, &'tcx GeneratorLayout<'tcx>, VariantIdx),\n }\n \n impl<'tcx> VariantInfo<'tcx> {\n     fn map_struct_name<R>(&self, f: impl FnOnce(&str) -> R) -> R {\n         match self {\n             VariantInfo::Adt(variant) => f(&variant.ident.as_str()),\n             VariantInfo::Generator(substs, _, variant_index) =>\n-                f(&substs.variant_name(*variant_index)),\n+                f(&substs.as_generator().variant_name(*variant_index)),\n         }\n     }\n \n@@ -1763,9 +1764,10 @@ fn prepare_enum_metadata(\n                 })\n                 .collect(),\n             ty::Generator(_, substs, _) => substs\n+                .as_generator()\n                 .variant_range(enum_def_id, cx.tcx)\n                 .map(|variant_index| {\n-                    let name = SmallCStr::new(&substs.variant_name(variant_index));\n+                    let name = SmallCStr::new(&substs.as_generator().variant_name(variant_index));\n                     unsafe {\n                         Some(llvm::LLVMRustDIBuilderCreateEnumerator(\n                             DIB(cx),"}, {"sha": "d921bbc96adeebeedcab5dfbeab0530ede3ee620", "filename": "src/librustc_codegen_llvm/type_of.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_llvm%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_llvm%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Ftype_of.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -65,7 +65,7 @@ fn uncached_llvm_type<'a, 'tcx>(cx: &CodegenCx<'a, 'tcx>,\n             if let (&ty::Generator(_, substs, _), &layout::Variants::Single { index })\n                  = (&layout.ty.kind, &layout.variants)\n             {\n-                write!(&mut name, \"::{}\", substs.variant_name(index)).unwrap();\n+                write!(&mut name, \"::{}\", substs.as_generator().variant_name(index)).unwrap();\n             }\n             Some(name)\n         }"}, {"sha": "9d2f8b42c704f0d193d82e6e23c788498ac24056", "filename": "src/librustc_codegen_ssa/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -636,7 +636,7 @@ fn arg_local_refs<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>>(\n                         ty::Generator(def_id, substs, _) => (def_id, substs),\n                         _ => bug!(\"generator layout without generator substs\"),\n                     };\n-                    let state_tys = gen_substs.state_tys(def_id, tcx);\n+                    let state_tys = gen_substs.as_generator().state_tys(def_id, tcx);\n \n                     generator_layout.variant_fields.iter()\n                         .zip(state_tys)"}, {"sha": "cf575c54293c76ab690f86c98783088b5c42e189", "filename": "src/librustc_codegen_utils/symbol_names/legacy.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Flegacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Flegacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Flegacy.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -225,7 +225,7 @@ impl Printer<'tcx> for SymbolPrinter<'tcx> {\n             ty::Projection(ty::ProjectionTy { item_def_id: def_id, substs }) |\n             ty::UnnormalizedProjection(ty::ProjectionTy { item_def_id: def_id, substs }) |\n             ty::Closure(def_id, substs) |\n-            ty::Generator(def_id, ty::GeneratorSubsts { substs }, _) => {\n+            ty::Generator(def_id, substs, _) => {\n                 self.print_def_path(def_id, substs)\n             }\n             _ => self.pretty_print_type(ty),"}, {"sha": "55b148fceb2177393101b9524258e9d8da68b64c", "filename": "src/librustc_codegen_utils/symbol_names/v0.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names%2Fv0.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -415,7 +415,7 @@ impl Printer<'tcx> for SymbolMangler<'tcx> {\n             ty::Projection(ty::ProjectionTy { item_def_id: def_id, substs }) |\n             ty::UnnormalizedProjection(ty::ProjectionTy { item_def_id: def_id, substs }) |\n             ty::Closure(def_id, substs) |\n-            ty::Generator(def_id, ty::GeneratorSubsts { substs }, _) => {\n+            ty::Generator(def_id, substs, _) => {\n                 self = self.print_def_path(def_id, substs)?;\n             }\n             ty::Foreign(def_id) => {"}, {"sha": "b105664399a5cbb6bd1ef6ea36adc1048f73388e", "filename": "src/librustc_mir/borrow_check/nll/constraint_generation.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fconstraint_generation.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -12,7 +12,7 @@ use rustc::mir::{\n     SourceInfo, Statement, StatementKind, Terminator, TerminatorKind, UserTypeProjection,\n };\n use rustc::ty::fold::TypeFoldable;\n-use rustc::ty::{self, GeneratorSubsts, RegionVid, Ty};\n+use rustc::ty::{self, RegionVid, Ty};\n use rustc::ty::subst::SubstsRef;\n \n pub(super) fn generate_constraints<'cx, 'tcx>(\n@@ -91,13 +91,6 @@ impl<'cg, 'cx, 'tcx> Visitor<'tcx> for ConstraintGeneration<'cg, 'cx, 'tcx> {\n         self.super_ty(ty);\n     }\n \n-    /// We sometimes have `generator_substs` within an rvalue, or within a\n-    /// call. Make them live at the location where they appear.\n-    fn visit_generator_substs(&mut self, substs: &GeneratorSubsts<'tcx>, location: Location) {\n-        self.add_regular_live_constraint(*substs, location);\n-        self.super_generator_substs(substs);\n-    }\n-\n     fn visit_statement(\n         &mut self,\n         statement: &Statement<'tcx>,"}, {"sha": "88ad1fb1295094a97f35d6f6d97bf4066f0930ef", "filename": "src/librustc_mir/borrow_check/nll/renumber.rs", "status": "modified", "additions": 1, "deletions": 15, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Frenumber.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -1,5 +1,5 @@\n use rustc::ty::subst::SubstsRef;\n-use rustc::ty::{self, GeneratorSubsts, Ty, TypeFoldable};\n+use rustc::ty::{self, Ty, TypeFoldable};\n use rustc::mir::{Location, Body, Promoted};\n use rustc::mir::visit::{MutVisitor, TyContext};\n use rustc::infer::{InferCtxt, NLLRegionVariableOrigin};\n@@ -82,18 +82,4 @@ impl<'a, 'tcx> MutVisitor<'tcx> for NLLVisitor<'a, 'tcx> {\n     fn visit_const(&mut self, constant: &mut &'tcx ty::Const<'tcx>, _location: Location) {\n         *constant = self.renumber_regions(&*constant);\n     }\n-\n-    fn visit_generator_substs(&mut self,\n-                              substs: &mut GeneratorSubsts<'tcx>,\n-                              location: Location) {\n-        debug!(\n-            \"visit_generator_substs(substs={:?}, location={:?})\",\n-            substs,\n-            location,\n-        );\n-\n-        *substs = self.renumber_regions(substs);\n-\n-        debug!(\"visit_generator_substs: substs={:?}\", substs);\n-    }\n }"}, {"sha": "1563a27250eb9e391d148d4a50646eeb2b5ecf8a", "filename": "src/librustc_mir/borrow_check/nll/type_check/mod.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Ftype_check%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -759,13 +759,13 @@ impl<'a, 'b, 'tcx> TypeVerifier<'a, 'b, 'tcx> {\n             PlaceTy { ty, variant_index: Some(variant_index) } => match ty.kind {\n                 ty::Adt(adt_def, substs) => (&adt_def.variants[variant_index], substs),\n                 ty::Generator(def_id, substs, _) => {\n-                    let mut variants = substs.state_tys(def_id, tcx);\n+                    let mut variants = substs.as_generator().state_tys(def_id, tcx);\n                     let mut variant = match variants.nth(variant_index.into()) {\n                         Some(v) => v,\n                         None => {\n                             bug!(\"variant_index of generator out of range: {:?}/{:?}\",\n                                  variant_index,\n-                                 substs.state_tys(def_id, tcx).count())\n+                                 substs.as_generator().state_tys(def_id, tcx).count())\n                         }\n                     };\n                     return match variant.nth(field.index()) {\n@@ -791,10 +791,10 @@ impl<'a, 'b, 'tcx> TypeVerifier<'a, 'b, 'tcx> {\n                 ty::Generator(def_id, substs, _) => {\n                     // Only prefix fields (upvars and current state) are\n                     // accessible without a variant index.\n-                    return match substs.prefix_tys(def_id, tcx).nth(field.index()) {\n+                    return match substs.as_generator().prefix_tys(def_id, tcx).nth(field.index()) {\n                         Some(ty) => Ok(ty),\n                         None => Err(FieldAccessError::OutOfRange {\n-                            field_count: substs.prefix_tys(def_id, tcx).count(),\n+                            field_count: substs.as_generator().prefix_tys(def_id, tcx).count(),\n                         }),\n                     }\n                 }\n@@ -1963,10 +1963,10 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n                 // It doesn't make sense to look at a field beyond the prefix;\n                 // these require a variant index, and are not initialized in\n                 // aggregate rvalues.\n-                match substs.prefix_tys(def_id, tcx).nth(field_index) {\n+                match substs.as_generator().prefix_tys(def_id, tcx).nth(field_index) {\n                     Some(ty) => Ok(ty),\n                     None => Err(FieldAccessError::OutOfRange {\n-                        field_count: substs.prefix_tys(def_id, tcx).count(),\n+                        field_count: substs.as_generator().prefix_tys(def_id, tcx).count(),\n                     }),\n                 }\n             }\n@@ -2541,7 +2541,7 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n             // these extra requirements are basically like where\n             // clauses on the struct.\n             AggregateKind::Closure(def_id, substs)\n-            | AggregateKind::Generator(def_id, ty::GeneratorSubsts { substs }, _) => {\n+            | AggregateKind::Generator(def_id, substs, _) => {\n                 self.prove_closure_bounds(tcx, *def_id, substs, location)\n             }\n "}, {"sha": "5f6951856434e8021bbf7866ec51356fb452ea73", "filename": "src/librustc_mir/borrow_check/nll/universal_regions.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Funiversal_regions.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -19,7 +19,7 @@ use rustc::infer::{InferCtxt, NLLRegionVariableOrigin};\n use rustc::middle::lang_items;\n use rustc::ty::fold::TypeFoldable;\n use rustc::ty::subst::{InternalSubsts, SubstsRef, Subst};\n-use rustc::ty::{self, GeneratorSubsts, RegionVid, Ty, TyCtxt};\n+use rustc::ty::{self, RegionVid, Ty, TyCtxt};\n use rustc::util::nodemap::FxHashMap;\n use rustc_index::vec::{Idx, IndexVec};\n use rustc_errors::DiagnosticBuilder;\n@@ -90,7 +90,7 @@ pub enum DefiningTy<'tcx> {\n     /// The MIR is a generator. The signature is that generators take\n     /// no parameters and return the result of\n     /// `ClosureSubsts::generator_return_ty`.\n-    Generator(DefId, ty::GeneratorSubsts<'tcx>, hir::GeneratorMovability),\n+    Generator(DefId, SubstsRef<'tcx>, hir::GeneratorMovability),\n \n     /// The MIR is a fn item with the given `DefId` and substs. The signature\n     /// of the function can be bound then with the `fn_sig` query.\n@@ -113,7 +113,7 @@ impl<'tcx> DefiningTy<'tcx> {\n                 substs.as_closure().upvar_tys(def_id, tcx)\n             ),\n             DefiningTy::Generator(def_id, substs, _) => {\n-                Either::Right(Either::Left(substs.upvar_tys(def_id, tcx)))\n+                Either::Right(Either::Left(substs.as_generator().upvar_tys(def_id, tcx)))\n             }\n             DefiningTy::FnDef(..) | DefiningTy::Const(..) => {\n                 Either::Right(Either::Right(iter::empty()))\n@@ -334,7 +334,7 @@ impl<'tcx> UniversalRegions<'tcx> {\n                 err.note(&format!(\n                     \"defining type: {:?} with generator substs {:#?}\",\n                     def_id,\n-                    &substs.substs[..]\n+                    &substs[..]\n                 ));\n \n                 // FIXME: As above, we'd like to print out the region\n@@ -470,7 +470,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n \n         let yield_ty = match defining_ty {\n             DefiningTy::Generator(def_id, substs, _) => {\n-                Some(substs.yield_ty(def_id, self.infcx.tcx))\n+                Some(substs.as_generator().yield_ty(def_id, self.infcx.tcx))\n             }\n             _ => None,\n         };\n@@ -549,7 +549,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n         let identity_substs = InternalSubsts::identity_for_item(tcx, closure_base_def_id);\n         let fr_substs = match defining_ty {\n             DefiningTy::Closure(_, ref substs)\n-            | DefiningTy::Generator(_, GeneratorSubsts { ref substs }, _) => {\n+            | DefiningTy::Generator(_, ref substs, _) => {\n                 // In the case of closures, we rely on the fact that\n                 // the first N elements in the ClosureSubsts are\n                 // inherited from the `closure_base_def_id`.\n@@ -612,7 +612,7 @@ impl<'cx, 'tcx> UniversalRegionsBuilder<'cx, 'tcx> {\n \n             DefiningTy::Generator(def_id, substs, movability) => {\n                 assert_eq!(self.mir_def_id, def_id);\n-                let output = substs.return_ty(def_id, tcx);\n+                let output = substs.as_generator().return_ty(def_id, tcx);\n                 let generator_ty = tcx.mk_generator(def_id, substs, movability);\n                 let inputs_and_output = self.infcx.tcx.intern_type_list(&[generator_ty, output]);\n                 ty::Binder::dummy(inputs_and_output)"}, {"sha": "6b6eac5add2fa04f3bcae1368e24853a2891c00c", "filename": "src/librustc_mir/build/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fbuild%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fmod.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -146,7 +146,7 @@ pub fn mir_build(tcx: TyCtxt<'_>, def_id: DefId) -> Body<'_> {\n             let (yield_ty, return_ty) = if body.generator_kind.is_some() {\n                 let gen_sig = match ty.kind {\n                     ty::Generator(gen_def_id, gen_substs, ..) =>\n-                        gen_substs.sig(gen_def_id, tcx),\n+                        gen_substs.as_generator().sig(gen_def_id, tcx),\n                     _ =>\n                         span_bug!(tcx.hir().span(id),\n                                   \"generator w/o generator type: {:?}\", ty),"}, {"sha": "f9200f8c1c04239c87ba03610dee0027ff50f31f", "filename": "src/librustc_mir/interpret/intrinsics/type_name.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Finterpret%2Fintrinsics%2Ftype_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Finterpret%2Fintrinsics%2Ftype_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fintrinsics%2Ftype_name.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -68,8 +68,7 @@ impl<'tcx> Printer<'tcx> for AbsolutePathPrinter<'tcx> {\n             | ty::Projection(ty::ProjectionTy { item_def_id: def_id, substs })\n             | ty::UnnormalizedProjection(ty::ProjectionTy { item_def_id: def_id, substs })\n             | ty::Closure(def_id, substs)\n-            | ty::Generator(def_id, ty::GeneratorSubsts { substs }, _)\n-            => self.print_def_path(def_id, substs),\n+            | ty::Generator(def_id, substs, _) => self.print_def_path(def_id, substs),\n             ty::Foreign(def_id) => self.print_def_path(def_id, &[]),\n \n             ty::GeneratorWitness(_) => {"}, {"sha": "4bdd71f9602ac2b25c336960eda4c49568ed049f", "filename": "src/librustc_mir/interpret/operand.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Finterpret%2Foperand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Finterpret%2Foperand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Foperand.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -664,14 +664,18 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                     bits_discr\n                 };\n                 // Make sure we catch invalid discriminants\n-                let index = match &rval.layout.ty.kind {\n+                let index = match rval.layout.ty.kind {\n                     ty::Adt(adt, _) => adt\n                         .discriminants(self.tcx.tcx)\n                         .find(|(_, var)| var.val == real_discr),\n-                    ty::Generator(def_id, substs, _) => substs\n-                        .discriminants(*def_id, self.tcx.tcx)\n-                        .find(|(_, var)| var.val == real_discr),\n+                    ty::Generator(def_id, substs, _) => {\n+                        let substs = substs.as_generator();\n+                        substs\n+                            .discriminants(def_id, self.tcx.tcx)\n+                            .find(|(_, var)| var.val == real_discr)\n+                    }\n                     _ => bug!(\"tagged layout for non-adt non-generator\"),\n+\n                 }.ok_or_else(\n                     || err_unsup!(InvalidDiscriminant(raw_discr.erase_tag()))\n                 )?;"}, {"sha": "78008e2fcd361c69004d9c619b425a30ff999f14", "filename": "src/librustc_mir/shim.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fshim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Fshim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fshim.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -169,7 +169,7 @@ fn build_drop_shim<'tcx>(tcx: TyCtxt<'tcx>, def_id: DefId, ty: Option<Ty<'tcx>>)\n     // Check if this is a generator, if so, return the drop glue for it\n     if let Some(&ty::TyS { kind: ty::Generator(gen_def_id, substs, _), .. }) = ty {\n         let body = &**tcx.optimized_mir(gen_def_id).generator_drop.as_ref().unwrap();\n-        return body.subst(tcx, substs.substs);\n+        return body.subst(tcx, substs);\n     }\n \n     let substs = if let Some(ty) = ty {"}, {"sha": "a648fadde43bec5c43ebd83746a715cf83bcd513", "filename": "src/librustc_mir/transform/generator.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -1126,6 +1126,7 @@ impl<'tcx> MirPass<'tcx> for StateTransform {\n         // Get the interior types and substs which typeck computed\n         let (upvars, interior, discr_ty, movable) = match gen_ty.kind {\n             ty::Generator(_, substs, movability) => {\n+                let substs = substs.as_generator();\n                 (substs.upvar_tys(def_id, tcx).collect(),\n                  substs.witness(def_id, tcx),\n                  substs.discr_ty(tcx),"}, {"sha": "f7ba6f1ec6993994d8595ab43d4d44721db210f8", "filename": "src/librustc_mir/util/elaborate_drops.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Felaborate_drops.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -798,7 +798,7 @@ where\n             // It effetively only contains upvars until the generator transformation runs.\n             // See librustc_body/transform/generator.rs for more details.\n             ty::Generator(def_id, substs, _) => {\n-                let tys : Vec<_> = substs.upvar_tys(def_id, self.tcx()).collect();\n+                let tys : Vec<_> = substs.as_generator().upvar_tys(def_id, self.tcx()).collect();\n                 self.open_drop_for_tuple(&tys)\n             }\n             ty::Tuple(..) => {"}, {"sha": "88e62db9a10d8aacbda75a3a4f60af3c1ab0a41f", "filename": "src/librustc_traits/dropck_outlives.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_traits%2Fdropck_outlives.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_traits%2Fdropck_outlives.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_traits%2Fdropck_outlives.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -223,7 +223,7 @@ fn dtorck_constraint_for_ty<'tcx>(\n             // *do* incorporate the upvars here.\n \n             let constraint = DtorckConstraint {\n-                outlives: substs.upvar_tys(def_id, tcx).map(|t| t.into()).collect(),\n+                outlives: substs.as_generator().upvar_tys(def_id, tcx).map(|t| t.into()).collect(),\n                 dtorck_types: vec![],\n                 overflows: vec![],\n             };"}, {"sha": "cc5348623fabda0dfdf0eda61c36b30fafc7e935", "filename": "src/librustc_traits/generic_types.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_traits%2Fgeneric_types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_traits%2Fgeneric_types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_traits%2Fgeneric_types.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -73,7 +73,9 @@ crate fn closure(tcx: TyCtxt<'tcx>, def_id: DefId) -> Ty<'tcx> {\n }\n \n crate fn generator(tcx: TyCtxt<'tcx>, def_id: DefId) -> Ty<'tcx> {\n-    tcx.mk_generator(def_id, ty::GeneratorSubsts {\n-        substs: InternalSubsts::bound_vars_for_item(tcx, def_id),\n-    }, hir::GeneratorMovability::Movable)\n+    tcx.mk_generator(\n+        def_id,\n+        InternalSubsts::bound_vars_for_item(tcx, def_id),\n+        hir::GeneratorMovability::Movable\n+    )\n }"}, {"sha": "8b97bf643e9bb9a2ab9f4da7f87dafa5b37572af", "filename": "src/librustc_typeck/check/closure.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7739f173eba6cfea7008eeb5794891697970985f/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fclosure.rs?ref=7739f173eba6cfea7008eeb5794891697970985f", "patch": "@@ -113,21 +113,21 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             }\n         });\n         if let Some(GeneratorTypes { yield_ty, interior, movability }) = generator_types {\n-            let substs = ty::GeneratorSubsts { substs };\n+            let generator_substs = substs.as_generator();\n             self.demand_eqtype(\n                 expr.span,\n                 yield_ty,\n-                substs.yield_ty(expr_def_id, self.tcx),\n+                generator_substs.yield_ty(expr_def_id, self.tcx),\n             );\n             self.demand_eqtype(\n                 expr.span,\n                 liberated_sig.output(),\n-                substs.return_ty(expr_def_id, self.tcx),\n+                generator_substs.return_ty(expr_def_id, self.tcx),\n             );\n             self.demand_eqtype(\n                 expr.span,\n                 interior,\n-                substs.witness(expr_def_id, self.tcx),\n+                generator_substs.witness(expr_def_id, self.tcx),\n             );\n             return self.tcx.mk_generator(expr_def_id, substs, movability);\n         }"}]}