{"sha": "00bda1cafb1086b9669000aed5703f9e6324fbd7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwYmRhMWNhZmIxMDg2Yjk2NjkwMDBhZWQ1NzAzZjllNjMyNGZiZDc=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2020-07-11T16:42:30Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2020-07-12T18:20:31Z"}, "message": "Adapt trait object coercion tests to the status quo", "tree": {"sha": "d73dcf78fa1d10311acd0ccc389707536a2c13b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d73dcf78fa1d10311acd0ccc389707536a2c13b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00bda1cafb1086b9669000aed5703f9e6324fbd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00bda1cafb1086b9669000aed5703f9e6324fbd7", "html_url": "https://github.com/rust-lang/rust/commit/00bda1cafb1086b9669000aed5703f9e6324fbd7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00bda1cafb1086b9669000aed5703f9e6324fbd7/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94f5f69ff4b3185e559339c86f9528b9443ca67d", "url": "https://api.github.com/repos/rust-lang/rust/commits/94f5f69ff4b3185e559339c86f9528b9443ca67d", "html_url": "https://github.com/rust-lang/rust/commit/94f5f69ff4b3185e559339c86f9528b9443ca67d"}], "stats": {"total": 55, "additions": 51, "deletions": 4}, "files": [{"sha": "d7fb6a962e8e9ed07a02b92eb577e6dce58e1d60", "filename": "crates/ra_hir_ty/src/tests/coercion.rs", "status": "modified", "additions": 51, "deletions": 4, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/00bda1cafb1086b9669000aed5703f9e6324fbd7/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00bda1cafb1086b9669000aed5703f9e6324fbd7/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs?ref=00bda1cafb1086b9669000aed5703f9e6324fbd7", "patch": "@@ -662,7 +662,53 @@ fn test() {\n }\n \n #[test]\n-fn coerce_unsize_trait_object() {\n+fn coerce_unsize_trait_object_simple() {\n+    assert_snapshot!(\n+        infer_with_mismatches(r#\"\n+#[lang = \"sized\"]\n+pub trait Sized {}\n+#[lang = \"unsize\"]\n+pub trait Unsize<T> {}\n+#[lang = \"coerce_unsized\"]\n+pub trait CoerceUnsized<T> {}\n+\n+impl<T: Unsize<U>, U> CoerceUnsized<&U> for &T {}\n+\n+trait Foo<T, U> {}\n+trait Bar<U, T, X>: Foo<T, U> {}\n+trait Baz<T, X>: Bar<usize, T, X> {}\n+\n+struct S<T, X>;\n+impl<T, X> Foo<T, usize> for S<T, X> {}\n+impl<T, X> Bar<usize, T, X> for S<T, X> {}\n+impl<T, X> Baz<T, X> for S<T, X> {}\n+\n+fn test() {\n+    let obj: &dyn Baz<i8, i16> = &S;\n+    let obj: &dyn Bar<_, i8, i16> = &S;\n+    let obj: &dyn Foo<i8, _> = &S;\n+}\n+\"#, true),\n+        @r###\"\n+    424..539 '{     ... &S; }': ()\n+    434..437 'obj': &dyn Baz<i8, i16>\n+    459..461 '&S': &S<i8, i16>\n+    460..461 'S': S<i8, i16>\n+    471..474 'obj': &dyn Bar<usize, i8, i16>\n+    499..501 '&S': &S<i8, i16>\n+    500..501 'S': S<i8, i16>\n+    511..514 'obj': &dyn Foo<i8, usize>\n+    534..536 '&S': &S<i8, {unknown}>\n+    535..536 'S': S<i8, {unknown}>\n+    \"###\n+    );\n+}\n+\n+#[test]\n+// The rust reference says this should be possible, but rustc doesn't implement\n+// it. We used to support it, but Chalk doesn't.\n+#[ignore]\n+fn coerce_unsize_trait_object_to_trait_object() {\n     assert_snapshot!(\n         infer_with_mismatches(r#\"\n #[lang = \"sized\"]\n@@ -735,16 +781,17 @@ impl D for S {}\n \n fn test() {\n     let obj: &dyn D = &S;\n-    let obj: &dyn A = obj;\n+    let obj: &dyn A = &S;\n }\n \"#, true),\n         @r###\"\n-    328..384 '{     ...obj; }': ()\n+    328..383 '{     ... &S; }': ()\n     338..341 'obj': &dyn D\n     352..354 '&S': &S\n     353..354 'S': S\n     364..367 'obj': &dyn A\n-    378..381 'obj': &dyn D\n+    378..380 '&S': &S\n+    379..380 'S': S\n     \"###\n     );\n }"}]}