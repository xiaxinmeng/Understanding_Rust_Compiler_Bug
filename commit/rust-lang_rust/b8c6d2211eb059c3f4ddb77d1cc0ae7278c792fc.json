{"sha": "b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "node_id": "C_kwDOAAsO6NoAKGI4YzZkMjIxMWViMDU5YzNmNGRkYjc3ZDFjYzBhZTcyNzhjNzkyZmM", "commit": {"author": {"name": "Michael van Straten", "email": "michael@vanstraten.de", "date": "2023-03-10T20:16:35Z"}, "committer": {"name": "Michael van Straten", "email": "michael@vanstraten.de", "date": "2023-03-10T20:19:25Z"}, "message": "added byte position range for proc_macro::Span", "tree": {"sha": "59ce34444b2463775de5758ae5dc729b553fe129", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59ce34444b2463775de5758ae5dc729b553fe129"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "html_url": "https://github.com/rust-lang/rust/commit/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/comments", "author": {"login": "michaelvanstraten", "id": 50352631, "node_id": "MDQ6VXNlcjUwMzUyNjMx", "avatar_url": "https://avatars.githubusercontent.com/u/50352631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelvanstraten", "html_url": "https://github.com/michaelvanstraten", "followers_url": "https://api.github.com/users/michaelvanstraten/followers", "following_url": "https://api.github.com/users/michaelvanstraten/following{/other_user}", "gists_url": "https://api.github.com/users/michaelvanstraten/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelvanstraten/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelvanstraten/subscriptions", "organizations_url": "https://api.github.com/users/michaelvanstraten/orgs", "repos_url": "https://api.github.com/users/michaelvanstraten/repos", "events_url": "https://api.github.com/users/michaelvanstraten/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelvanstraten/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelvanstraten", "id": 50352631, "node_id": "MDQ6VXNlcjUwMzUyNjMx", "avatar_url": "https://avatars.githubusercontent.com/u/50352631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelvanstraten", "html_url": "https://github.com/michaelvanstraten", "followers_url": "https://api.github.com/users/michaelvanstraten/followers", "following_url": "https://api.github.com/users/michaelvanstraten/following{/other_user}", "gists_url": "https://api.github.com/users/michaelvanstraten/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelvanstraten/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelvanstraten/subscriptions", "organizations_url": "https://api.github.com/users/michaelvanstraten/orgs", "repos_url": "https://api.github.com/users/michaelvanstraten/repos", "events_url": "https://api.github.com/users/michaelvanstraten/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelvanstraten/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35a0961bbc8fba75bb863c7835b39d431ad9fc5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/35a0961bbc8fba75bb863c7835b39d431ad9fc5d", "html_url": "https://github.com/rust-lang/rust/commit/35a0961bbc8fba75bb863c7835b39d431ad9fc5d"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "a4578bd583574b05cf35287ecae7004b430233e6", "filename": "compiler/rustc_expand/src/proc_macro_server.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs?ref=b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "patch": "@@ -18,7 +18,7 @@ use rustc_span::def_id::CrateNum;\n use rustc_span::symbol::{self, sym, Symbol};\n use rustc_span::{BytePos, FileName, Pos, SourceFile, Span};\n use smallvec::{smallvec, SmallVec};\n-use std::ops::Bound;\n+use std::ops::{Bound, Range};\n \n trait FromInternal<T> {\n     fn from_internal(x: T) -> Self;\n@@ -634,6 +634,10 @@ impl server::Span for Rustc<'_, '_> {\n         span.source_callsite()\n     }\n \n+    fn position(&mut self, span: Self::Span) -> Range<u32> {\n+        Range { start: span.lo().0, end: span.lo().0 }\n+    }\n+\n     fn start(&mut self, span: Self::Span) -> LineColumn {\n         let loc = self.sess().source_map().lookup_char_pos(span.lo());\n         LineColumn { line: loc.line, column: loc.col.to_usize() }"}, {"sha": "aedfecf51a50634270375f8b65cd80b25c500c10", "filename": "library/proc_macro/src/bridge/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/library%2Fproc_macro%2Fsrc%2Fbridge%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/library%2Fproc_macro%2Fsrc%2Fbridge%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fproc_macro%2Fsrc%2Fbridge%2Fmod.rs?ref=b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "patch": "@@ -14,6 +14,7 @@ use std::hash::Hash;\n use std::marker;\n use std::mem;\n use std::ops::Bound;\n+use std::ops::Range;\n use std::panic;\n use std::sync::atomic::AtomicUsize;\n use std::sync::Once;\n@@ -93,6 +94,7 @@ macro_rules! with_api {\n                 fn source_file($self: $S::Span) -> $S::SourceFile;\n                 fn parent($self: $S::Span) -> Option<$S::Span>;\n                 fn source($self: $S::Span) -> $S::Span;\n+                fn position($self: $S::Span) -> Range<u32>;\n                 fn start($self: $S::Span) -> LineColumn;\n                 fn end($self: $S::Span) -> LineColumn;\n                 fn before($self: $S::Span) -> $S::Span;\n@@ -293,6 +295,7 @@ mark_noop! {\n     &'_ str,\n     String,\n     u8,\n+    u32,\n     usize,\n     Delimiter,\n     LitKind,\n@@ -519,3 +522,7 @@ pub struct ExpnGlobals<Span> {\n compound_traits!(\n     struct ExpnGlobals<Span> { def_site, call_site, mixed_site }\n );\n+\n+compound_traits!(\n+    struct Range<T> { start, end }\n+);"}, {"sha": "e37015f2c3bc891ba480d22560d232ca5a13b5c6", "filename": "library/proc_macro/src/lib.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/library%2Fproc_macro%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc/library%2Fproc_macro%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fproc_macro%2Fsrc%2Flib.rs?ref=b8c6d2211eb059c3f4ddb77d1cc0ae7278c792fc", "patch": "@@ -44,7 +44,7 @@ mod diagnostic;\n pub use diagnostic::{Diagnostic, Level, MultiSpan};\n \n use std::cmp::Ordering;\n-use std::ops::RangeBounds;\n+use std::ops::{Range, RangeBounds};\n use std::path::PathBuf;\n use std::str::FromStr;\n use std::{error, fmt, iter};\n@@ -488,6 +488,12 @@ impl Span {\n         Span(self.0.source())\n     }\n \n+    /// Returns the spans byte position range in the source file.\n+    #[unstable(feature = \"proc_macro_span\", issue = \"54725\")]\n+    pub fn position(&self) -> Range<u32> {\n+        self.0.position()\n+    }\n+\n     /// Gets the starting line/column in the source file for this span.\n     #[unstable(feature = \"proc_macro_span\", issue = \"54725\")]\n     pub fn start(&self) -> LineColumn {"}]}