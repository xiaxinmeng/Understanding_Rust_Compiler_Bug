{"sha": "90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwYzY2NDcwZjlkODdmZDYxYTlkODBiNmYyOWU1M2U4NWEwYTM0MGU=", "commit": {"author": {"name": "Josh Mcguigan", "email": "joshmcg88@gmail.com", "date": "2020-03-21T15:04:28Z"}, "committer": {"name": "Josh Mcguigan", "email": "joshmcg88@gmail.com", "date": "2020-03-21T16:39:45Z"}, "message": "gen_assists_docs skip hidden files", "tree": {"sha": "f70d3fb1cac9b15ca595876211b0325e0d021fc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f70d3fb1cac9b15ca595876211b0325e0d021fc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "html_url": "https://github.com/rust-lang/rust/commit/90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/comments", "author": {"login": "JoshMcguigan", "id": 22216761, "node_id": "MDQ6VXNlcjIyMjE2NzYx", "avatar_url": "https://avatars.githubusercontent.com/u/22216761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoshMcguigan", "html_url": "https://github.com/JoshMcguigan", "followers_url": "https://api.github.com/users/JoshMcguigan/followers", "following_url": "https://api.github.com/users/JoshMcguigan/following{/other_user}", "gists_url": "https://api.github.com/users/JoshMcguigan/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoshMcguigan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoshMcguigan/subscriptions", "organizations_url": "https://api.github.com/users/JoshMcguigan/orgs", "repos_url": "https://api.github.com/users/JoshMcguigan/repos", "events_url": "https://api.github.com/users/JoshMcguigan/events{/privacy}", "received_events_url": "https://api.github.com/users/JoshMcguigan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JoshMcguigan", "id": 22216761, "node_id": "MDQ6VXNlcjIyMjE2NzYx", "avatar_url": "https://avatars.githubusercontent.com/u/22216761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoshMcguigan", "html_url": "https://github.com/JoshMcguigan", "followers_url": "https://api.github.com/users/JoshMcguigan/followers", "following_url": "https://api.github.com/users/JoshMcguigan/following{/other_user}", "gists_url": "https://api.github.com/users/JoshMcguigan/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoshMcguigan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoshMcguigan/subscriptions", "organizations_url": "https://api.github.com/users/JoshMcguigan/orgs", "repos_url": "https://api.github.com/users/JoshMcguigan/repos", "events_url": "https://api.github.com/users/JoshMcguigan/events{/privacy}", "received_events_url": "https://api.github.com/users/JoshMcguigan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e827bd948ea206328b126345ab8e909978b3b9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e827bd948ea206328b126345ab8e909978b3b9b", "html_url": "https://github.com/rust-lang/rust/commit/5e827bd948ea206328b126345ab8e909978b3b9b"}], "stats": {"total": 47, "additions": 21, "deletions": 26}, "files": [{"sha": "31d606535fb08feb79e8764bc455a9b0f46929c1", "filename": "xtask/src/codegen/gen_assists_docs.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Fsrc%2Fcodegen%2Fgen_assists_docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Fsrc%2Fcodegen%2Fgen_assists_docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fcodegen%2Fgen_assists_docs.rs?ref=90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "patch": "@@ -4,7 +4,7 @@ use std::{fs, path::Path};\n \n use crate::{\n     codegen::{self, extract_comment_blocks_with_empty_lines, Mode},\n-    project_root, Result,\n+    project_root, rust_files, Result,\n };\n \n pub fn generate_assists_docs(mode: Mode) -> Result<()> {\n@@ -46,12 +46,8 @@ fn reveal_hash_comments(text: &str) -> String {\n \n fn collect_assists() -> Result<Vec<Assist>> {\n     let mut res = Vec::new();\n-    for entry in fs::read_dir(project_root().join(codegen::ASSISTS_DIR))? {\n-        let entry = entry?;\n-        let path = entry.path();\n-        if path.is_file() {\n-            collect_file(&mut res, path.as_path())?;\n-        }\n+    for path in rust_files(&project_root().join(codegen::ASSISTS_DIR)) {\n+        collect_file(&mut res, path.as_path())?;\n     }\n     res.sort_by(|lhs, rhs| lhs.id.cmp(&rhs.id));\n     return Ok(res);"}, {"sha": "4f01f84fb4100461df02e1c55103b8af082c90a3", "filename": "xtask/src/lib.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Flib.rs?ref=90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "patch": "@@ -17,6 +17,7 @@ use std::{\n     path::{Path, PathBuf},\n     process::{Command, Stdio},\n };\n+use walkdir::{DirEntry, WalkDir};\n \n use crate::{\n     codegen::Mode,\n@@ -37,6 +38,21 @@ pub fn project_root() -> PathBuf {\n     .to_path_buf()\n }\n \n+pub fn rust_files(path: &Path) -> impl Iterator<Item = PathBuf> {\n+    let iter = WalkDir::new(path);\n+    return iter\n+        .into_iter()\n+        .filter_entry(|e| !is_hidden(e))\n+        .map(|e| e.unwrap())\n+        .filter(|e| !e.file_type().is_dir())\n+        .map(|e| e.into_path())\n+        .filter(|path| path.extension().map(|it| it == \"rs\").unwrap_or(false));\n+\n+    fn is_hidden(entry: &DirEntry) -> bool {\n+        entry.file_name().to_str().map(|s| s.starts_with('.')).unwrap_or(false)\n+    }\n+}\n+\n pub fn run_rustfmt(mode: Mode) -> Result<()> {\n     let _dir = pushd(project_root());\n     ensure_rustfmt()?;"}, {"sha": "80911a68e8b72481a1e5169c6fd83285db912fbe", "filename": "xtask/tests/tidy-tests/main.rs", "status": "modified", "additions": 2, "deletions": 19, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Ftests%2Ftidy-tests%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90c66470f9d87fd61a9d80b6f29e53e85a0a340e/xtask%2Ftests%2Ftidy-tests%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Ftests%2Ftidy-tests%2Fmain.rs?ref=90c66470f9d87fd61a9d80b6f29e53e85a0a340e", "patch": "@@ -5,13 +5,12 @@ use std::{\n     path::{Path, PathBuf},\n };\n \n-use walkdir::{DirEntry, WalkDir};\n-use xtask::{not_bash::fs2, project_root};\n+use xtask::{not_bash::fs2, project_root, rust_files};\n \n #[test]\n fn rust_files_are_tidy() {\n     let mut tidy_docs = TidyDocs::default();\n-    for path in rust_files() {\n+    for path in rust_files(&project_root().join(\"crates\")) {\n         let text = fs2::read_to_string(&path).unwrap();\n         check_todo(&path, &text);\n         check_trailing_ws(&path, &text);\n@@ -142,19 +141,3 @@ fn is_exclude_dir(p: &Path, dirs_to_exclude: &[&str]) -> bool {\n \n     false\n }\n-\n-fn rust_files() -> impl Iterator<Item = PathBuf> {\n-    let crates = project_root().join(\"crates\");\n-    let iter = WalkDir::new(crates);\n-    return iter\n-        .into_iter()\n-        .filter_entry(|e| !is_hidden(e))\n-        .map(|e| e.unwrap())\n-        .filter(|e| !e.file_type().is_dir())\n-        .map(|e| e.into_path())\n-        .filter(|path| path.extension().map(|it| it == \"rs\").unwrap_or(false));\n-\n-    fn is_hidden(entry: &DirEntry) -> bool {\n-        entry.file_name().to_str().map(|s| s.starts_with('.')).unwrap_or(false)\n-    }\n-}"}]}