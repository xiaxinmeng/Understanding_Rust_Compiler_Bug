{"sha": "e45f476d5691a6a0d994eb6f777bbf291348f93e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0NWY0NzZkNTY5MWE2YTBkOTk0ZWI2Zjc3N2JiZjI5MTM0OGY5M2U=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-21T20:42:19Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-21T20:42:19Z"}, "message": "Fix panic trying to get substs on unknown type\n\nFixes #585.", "tree": {"sha": "e786aad9c46072c992c634466e834feb64c856fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e786aad9c46072c992c634466e834feb64c856fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e45f476d5691a6a0d994eb6f777bbf291348f93e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e45f476d5691a6a0d994eb6f777bbf291348f93e", "html_url": "https://github.com/rust-lang/rust/commit/e45f476d5691a6a0d994eb6f777bbf291348f93e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e45f476d5691a6a0d994eb6f777bbf291348f93e/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0d8c86563b72e5414cf10fe16da5e88201447e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0d8c86563b72e5414cf10fe16da5e88201447e2", "html_url": "https://github.com/rust-lang/rust/commit/e0d8c86563b72e5414cf10fe16da5e88201447e2"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "e690ae1582e593f06d6b3c6db170a68301e36c6b", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=e45f476d5691a6a0d994eb6f777bbf291348f93e", "patch": "@@ -1134,7 +1134,7 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n \n         self.unify(&ty, expected);\n \n-        let substs = ty.substs().expect(\"adt should have substs\");\n+        let substs = ty.substs().unwrap_or_else(Substs::empty);\n \n         for (i, &subpat) in subpats.iter().enumerate() {\n             let expected_ty = fields\n@@ -1155,7 +1155,7 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n \n         self.unify(&ty, expected);\n \n-        let substs = ty.substs().expect(\"adt should have substs\");\n+        let substs = ty.substs().unwrap_or_else(Substs::empty);\n \n         for subpat in subpats {\n             let matching_field = fields.iter().find(|field| field.name() == &subpat.name);\n@@ -1403,7 +1403,7 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n                 spread,\n             } => {\n                 let (ty, def_id) = self.resolve_variant(path.as_ref());\n-                let substs = ty.substs().expect(\"adt should have substs\");\n+                let substs = ty.substs().unwrap_or_else(Substs::empty);\n                 for field in fields {\n                     let field_ty = if let Some(def_id) = def_id {\n                         self.db"}, {"sha": "dc9b626dcfb9c0ac6a85035da02b3faa5876e78d", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=e45f476d5691a6a0d994eb6f777bbf291348f93e", "patch": "@@ -521,6 +521,22 @@ fn test(x: X) {\n     );\n }\n \n+#[test]\n+fn bug_585() {\n+    check_inference(\n+        r#\"\n+fn test() {\n+    X {};\n+    match x {\n+        A::B {} => (),\n+        A::Y() => (),\n+    }\n+}\n+\"#,\n+        \"bug_585.txt\",\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.source_file(file_id);"}, {"sha": "627702a382e8ef37de902f729274a2afa3a1babe", "filename": "crates/ra_hir/src/ty/tests/data/bug_585.txt", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fbug_585.txt", "raw_url": "https://github.com/rust-lang/rust/raw/e45f476d5691a6a0d994eb6f777bbf291348f93e/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fbug_585.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fbug_585.txt?ref=e45f476d5691a6a0d994eb6f777bbf291348f93e", "patch": "@@ -0,0 +1,8 @@\n+[11; 89) '{     ...   } }': ()\n+[17; 21) 'X {}': [unknown]\n+[27; 87) 'match ...     }': ()\n+[33; 34) 'x': [unknown]\n+[45; 52) 'A::B {}': [unknown]\n+[56; 58) '()': ()\n+[68; 74) 'A::Y()': [unknown]\n+[78; 80) '()': ()"}]}