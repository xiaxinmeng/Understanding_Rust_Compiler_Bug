{"sha": "8f075ec961bea50074f96d48be851eccd94a065f", "node_id": "C_kwDOAAsO6NoAKDhmMDc1ZWM5NjFiZWE1MDA3NGY5NmQ0OGJlODUxZWNjZDk0YTA2NWY", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2021-10-07T04:37:56Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2021-10-07T04:42:21Z"}, "message": "Revert `update_lints` module list generating code\n\nThis commit reverts the module list generation code to what it was\nbefore the change to `include!` it and generates better output.", "tree": {"sha": "ee294b4ed3f59be06fff32b0ae0b0d35d1490dd9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee294b4ed3f59be06fff32b0ae0b0d35d1490dd9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f075ec961bea50074f96d48be851eccd94a065f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f075ec961bea50074f96d48be851eccd94a065f", "html_url": "https://github.com/rust-lang/rust/commit/8f075ec961bea50074f96d48be851eccd94a065f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f075ec961bea50074f96d48be851eccd94a065f/comments", "author": null, "committer": null, "parents": [{"sha": "11492c75a39b26c19f3e5655d425b2db8a0b4e00", "url": "https://api.github.com/repos/rust-lang/rust/commits/11492c75a39b26c19f3e5655d425b2db8a0b4e00", "html_url": "https://github.com/rust-lang/rust/commit/11492c75a39b26c19f3e5655d425b2db8a0b4e00"}], "stats": {"total": 27, "additions": 10, "deletions": 17}, "files": [{"sha": "10d859988f6f2d55d52ac3cf035397be337aba0d", "filename": "clippy_dev/src/update_lints.rs", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/8f075ec961bea50074f96d48be851eccd94a065f/clippy_dev%2Fsrc%2Fupdate_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f075ec961bea50074f96d48be851eccd94a065f/clippy_dev%2Fsrc%2Fupdate_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fupdate_lints.rs?ref=8f075ec961bea50074f96d48be851eccd94a065f", "patch": "@@ -1,6 +1,6 @@\n use itertools::Itertools;\n use regex::Regex;\n-use std::collections::{BTreeSet, HashMap};\n+use std::collections::HashMap;\n use std::ffi::OsStr;\n use std::fs;\n use std::lazy::SyncLazy;\n@@ -105,7 +105,7 @@ pub fn run(update_mode: UpdateMode) {\n         \"end lints modules\",\n         false,\n         update_mode == UpdateMode::Change,\n-        || vec![gen_modules_list(usable_lints.iter())],\n+        || gen_modules_list(usable_lints.iter()),\n     )\n     .changed;\n \n@@ -262,14 +262,13 @@ fn gen_lint_group_list<'a>(group_name: &str, lints: impl Iterator<Item = &'a Lin\n \n /// Generates the module declarations for `lints`\n #[must_use]\n-fn gen_modules_list<'a>(lints: impl Iterator<Item = &'a Lint>) -> String {\n-    let module_names: BTreeSet<_> = lints.map(|l| &l.module).collect();\n-\n-    let mut output = GENERATED_FILE_COMMENT.to_string();\n-    for name in module_names {\n-        output.push_str(&format!(\"mod {};\\n\", name));\n-    }\n-    output\n+fn gen_modules_list<'a>(lints: impl Iterator<Item = &'a Lint>) -> Vec<String> {\n+    lints\n+        .map(|l| &l.module)\n+        .unique()\n+        .map(|module| format!(\"mod {};\", module))\n+        .sorted()\n+        .collect::<Vec<String>>()\n }\n \n /// Generates the list of lint links at the bottom of the CHANGELOG\n@@ -677,8 +676,7 @@ mod tests {\n             Lint::new(\"should_assert_eq\", \"group1\", \"abc\", None, \"module_name\"),\n             Lint::new(\"incorrect_stuff\", \"group3\", \"abc\", None, \"another_module\"),\n         ];\n-        let expected =\n-            GENERATED_FILE_COMMENT.to_string() + &[\"mod another_module;\", \"mod module_name;\"].join(\"\\n\") + \"\\n\";\n+        let expected = vec![\"mod another_module;\".to_string(), \"mod module_name;\".to_string()];\n         assert_eq!(expected, gen_modules_list(lints.iter()));\n     }\n "}, {"sha": "9fc6a9e0ccca073e30899604d6bf4c0747e2dd87", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8f075ec961bea50074f96d48be851eccd94a065f/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f075ec961bea50074f96d48be851eccd94a065f/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=8f075ec961bea50074f96d48be851eccd94a065f", "patch": "@@ -156,10 +156,6 @@ mod deprecated_lints;\n mod utils;\n \n // begin lints modules, do not remove this comment, it\u2019s used in `update_lints`\n-// This file was generated by `cargo dev update_lints`.\n-// Use that command to update this file and do not edit by hand.\n-// Manual edits will be overwritten.\n-\n mod absurd_extreme_comparisons;\n mod approx_const;\n mod arithmetic;\n@@ -390,7 +386,6 @@ mod wildcard_imports;\n mod write;\n mod zero_div_zero;\n mod zero_sized_map_values;\n-\n // end lints modules, do not remove this comment, it\u2019s used in `update_lints`\n \n pub use crate::utils::conf::Conf;"}]}