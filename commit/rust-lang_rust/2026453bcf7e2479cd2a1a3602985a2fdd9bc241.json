{"sha": "2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMjY0NTNiY2Y3ZTI0NzljZDJhMWEzNjAyOTg1YTJmZGQ5YmMyNDE=", "commit": {"author": {"name": "Bryan Drewery", "email": "bryan@shatow.net", "date": "2018-02-26T18:20:14Z"}, "committer": {"name": "Bryan Drewery", "email": "bryan@shatow.net", "date": "2018-02-26T18:21:52Z"}, "message": "Add specific target option for returning struct as an integer.", "tree": {"sha": "1e4aa531773abbe656097b79cf4a3efee735fd52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e4aa531773abbe656097b79cf4a3efee735fd52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "html_url": "https://github.com/rust-lang/rust/commit/2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/comments", "author": {"login": "bdrewery", "id": 33693, "node_id": "MDQ6VXNlcjMzNjkz", "avatar_url": "https://avatars.githubusercontent.com/u/33693?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bdrewery", "html_url": "https://github.com/bdrewery", "followers_url": "https://api.github.com/users/bdrewery/followers", "following_url": "https://api.github.com/users/bdrewery/following{/other_user}", "gists_url": "https://api.github.com/users/bdrewery/gists{/gist_id}", "starred_url": "https://api.github.com/users/bdrewery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bdrewery/subscriptions", "organizations_url": "https://api.github.com/users/bdrewery/orgs", "repos_url": "https://api.github.com/users/bdrewery/repos", "events_url": "https://api.github.com/users/bdrewery/events{/privacy}", "received_events_url": "https://api.github.com/users/bdrewery/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bdrewery", "id": 33693, "node_id": "MDQ6VXNlcjMzNjkz", "avatar_url": "https://avatars.githubusercontent.com/u/33693?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bdrewery", "html_url": "https://github.com/bdrewery", "followers_url": "https://api.github.com/users/bdrewery/followers", "following_url": "https://api.github.com/users/bdrewery/following{/other_user}", "gists_url": "https://api.github.com/users/bdrewery/gists{/gist_id}", "starred_url": "https://api.github.com/users/bdrewery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bdrewery/subscriptions", "organizations_url": "https://api.github.com/users/bdrewery/orgs", "repos_url": "https://api.github.com/users/bdrewery/repos", "events_url": "https://api.github.com/users/bdrewery/events{/privacy}", "received_events_url": "https://api.github.com/users/bdrewery/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34b45c192f604b3dcb6f99c9d161a074fac45daf", "url": "https://api.github.com/repos/rust-lang/rust/commits/34b45c192f604b3dcb6f99c9d161a074fac45daf", "html_url": "https://github.com/rust-lang/rust/commit/34b45c192f604b3dcb6f99c9d161a074fac45daf"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "72173b62594e9658cd77fa4802f6d154d4ccd44d", "filename": "src/librustc_back/target/apple_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fapple_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fapple_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fapple_base.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -46,6 +46,7 @@ pub fn opts() -> TargetOptions {\n         pre_link_args: LinkArgs::new(),\n         exe_allocation_crate: super::maybe_jemalloc(),\n         has_elf_tls: version >= (10, 7),\n+        abi_return_struct_as_int: true,\n         .. Default::default()\n     }\n }"}, {"sha": "e734817098043b6e41af1e33beb6168a59075301", "filename": "src/librustc_back/target/mod.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fmod.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -343,9 +343,8 @@ pub struct TargetOptions {\n     pub staticlib_suffix: String,\n     /// OS family to use for conditional compilation. Valid options: \"unix\", \"windows\".\n     pub target_family: Option<String>,\n-    /// Whether the target toolchain is like OpenBSD's.\n-    /// Only useful for compiling against OpenBSD, for configuring abi when returning a struct.\n-    pub is_like_openbsd: bool,\n+    /// Whether the target toolchain's ABI supports returning small structs as an integer.\n+    pub abi_return_struct_as_int: bool,\n     /// Whether the target toolchain is like macOS's. Only useful for compiling against iOS/macOS,\n     /// in particular running dsymutil and some other stuff like `-dead_strip`. Defaults to false.\n     pub is_like_osx: bool,\n@@ -501,7 +500,7 @@ impl Default for TargetOptions {\n             staticlib_prefix: \"lib\".to_string(),\n             staticlib_suffix: \".a\".to_string(),\n             target_family: None,\n-            is_like_openbsd: false,\n+            abi_return_struct_as_int: false,\n             is_like_osx: false,\n             is_like_solaris: false,\n             is_like_windows: false,\n@@ -756,7 +755,7 @@ impl Target {\n         key!(staticlib_prefix);\n         key!(staticlib_suffix);\n         key!(target_family, optional);\n-        key!(is_like_openbsd, bool);\n+        key!(abi_return_struct_as_int, bool);\n         key!(is_like_osx, bool);\n         key!(is_like_solaris, bool);\n         key!(is_like_windows, bool);\n@@ -954,7 +953,7 @@ impl ToJson for Target {\n         target_option_val!(staticlib_prefix);\n         target_option_val!(staticlib_suffix);\n         target_option_val!(target_family);\n-        target_option_val!(is_like_openbsd);\n+        target_option_val!(abi_return_struct_as_int);\n         target_option_val!(is_like_osx);\n         target_option_val!(is_like_solaris);\n         target_option_val!(is_like_windows);"}, {"sha": "311e260ee3f34a113f0a5e005e679f6d499da36c", "filename": "src/librustc_back/target/openbsd_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fopenbsd_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fopenbsd_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fopenbsd_base.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -31,7 +31,7 @@ pub fn opts() -> TargetOptions {\n         target_family: Some(\"unix\".to_string()),\n         linker_is_gnu: true,\n         has_rpath: true,\n-        is_like_openbsd: true,\n+        abi_return_struct_as_int: true,\n         pre_link_args: args,\n         position_independent_executables: true,\n         eliminate_frame_pointer: false, // FIXME 43575"}, {"sha": "30038400f6c81ca13785d2aed11334f610e5902f", "filename": "src/librustc_back/target/windows_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -101,6 +101,7 @@ pub fn opts() -> TargetOptions {\n             \"rsend.o\".to_string()\n         ],\n         custom_unwind_resume: true,\n+        abi_return_struct_as_int: true,\n \n         .. Default::default()\n     }"}, {"sha": "e0bf36ee4077e392346cdc87a585f452862735eb", "filename": "src/librustc_back/target/windows_msvc_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fwindows_msvc_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_back%2Ftarget%2Fwindows_msvc_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fwindows_msvc_base.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -34,6 +34,7 @@ pub fn opts() -> TargetOptions {\n         pre_link_args: args,\n         crt_static_allows_dylibs: true,\n         crt_static_respected: true,\n+        abi_return_struct_as_int: true,\n \n         .. Default::default()\n     }"}, {"sha": "b14558448067cc9e67ac6a7a3919bfa12785a43f", "filename": "src/librustc_trans/cabi_x86.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_trans%2Fcabi_x86.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2026453bcf7e2479cd2a1a3602985a2fdd9bc241/src%2Flibrustc_trans%2Fcabi_x86.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fcabi_x86.rs?ref=2026453bcf7e2479cd2a1a3602985a2fdd9bc241", "patch": "@@ -52,8 +52,7 @@ pub fn compute_abi_info<'a, 'tcx>(cx: &CodegenCx<'a, 'tcx>,\n             // http://www.angelcode.com/dev/callconv/callconv.html\n             // Clang's ABI handling is in lib/CodeGen/TargetInfo.cpp\n             let t = &cx.sess().target.target;\n-            if t.options.is_like_osx || t.options.is_like_windows\n-                || t.options.is_like_openbsd {\n+            if t.options.abi_return_struct_as_int {\n                 // According to Clang, everyone but MSVC returns single-element\n                 // float aggregates directly in a floating-point register.\n                 if !t.options.is_like_msvc && is_single_fp_element(cx, fty.ret.layout) {"}]}