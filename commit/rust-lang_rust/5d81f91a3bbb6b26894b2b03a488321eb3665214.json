{"sha": "5d81f91a3bbb6b26894b2b03a488321eb3665214", "node_id": "C_kwDOAAsO6NoAKDVkODFmOTFhM2JiYjZiMjY4OTRiMmIwM2E0ODgzMjFlYjM2NjUyMTQ", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-06-09T10:19:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-09T10:19:56Z"}, "message": "Rollup merge of #97843 - overdrivenpotato:psp-lto, r=michaelwoerister\n\nRelax mipsel-sony-psp's linker script\n\nPreviously, the linker script forcefully kept all `.lib.stub` sections, unnecessarily bloating the binary. Now, the script is LTO and `--gc-sections` friendly.\n\n`--nmagic` was also added to the linker, because page alignment is not required on the PSP. This further reduces binary size.\n\nAccompanying changes for the `psp` crate are found in: https://github.com/overdrivenpotato/rust-psp/pull/118", "tree": {"sha": "db6ee8fcb509802fc3e6d7e7000e9517e8220d4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db6ee8fcb509802fc3e6d7e7000e9517e8220d4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d81f91a3bbb6b26894b2b03a488321eb3665214", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJioclNCRBK7hj4Ov3rIwAApxkIADdl/++ztO5zHkF/4ez8qAe2\nMWKPXI94dqgqXTYhPSi4b7r1RX1JWKoAGT/388RSP0PkUZO5qhbiOCDbJ02XO2V8\ni0+Rysx8PIbcR+xNyhaZK5vo4QYIpPcTMlPzhf8YX5RB7h24q5Jtm2373+mmWHDe\n16ng0z6rLasEeejYPQ9zxw9nHNW5own/aqbRmi2WIdWQPJWHmBxTk5GiZ9KWhdry\nLpOq5hpoGHLaxtpwn3bqmqTwG8+nMiEheelb3iEPyjSJG+I9zJzZwCoGOJaGn6cK\nZrLG1kmo4FP11LMtXR/Zr95opHco7TskpUGVVC76X1zvY9U/+5POXytC/9j0Er0=\n=ty5N\n-----END PGP SIGNATURE-----\n", "payload": "tree db6ee8fcb509802fc3e6d7e7000e9517e8220d4a\nparent fa4f8f144c9b1938afeef5b36834766901c2ba39\nparent 611107af5f870f8f5f1d77b19e8f735be2a1da36\nauthor Yuki Okushi <jtitor@2k36.org> 1654769996 +0900\ncommitter GitHub <noreply@github.com> 1654769996 +0900\n\nRollup merge of #97843 - overdrivenpotato:psp-lto, r=michaelwoerister\n\nRelax mipsel-sony-psp's linker script\n\nPreviously, the linker script forcefully kept all `.lib.stub` sections, unnecessarily bloating the binary. Now, the script is LTO and `--gc-sections` friendly.\n\n`--nmagic` was also added to the linker, because page alignment is not required on the PSP. This further reduces binary size.\n\nAccompanying changes for the `psp` crate are found in: https://github.com/overdrivenpotato/rust-psp/pull/118\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d81f91a3bbb6b26894b2b03a488321eb3665214", "html_url": "https://github.com/rust-lang/rust/commit/5d81f91a3bbb6b26894b2b03a488321eb3665214", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d81f91a3bbb6b26894b2b03a488321eb3665214/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fa4f8f144c9b1938afeef5b36834766901c2ba39", "url": "https://api.github.com/repos/rust-lang/rust/commits/fa4f8f144c9b1938afeef5b36834766901c2ba39", "html_url": "https://github.com/rust-lang/rust/commit/fa4f8f144c9b1938afeef5b36834766901c2ba39"}, {"sha": "611107af5f870f8f5f1d77b19e8f735be2a1da36", "url": "https://api.github.com/repos/rust-lang/rust/commits/611107af5f870f8f5f1d77b19e8f735be2a1da36", "html_url": "https://github.com/rust-lang/rust/commit/611107af5f870f8f5f1d77b19e8f735be2a1da36"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "03e0934ea5ecc26806f0887457596150d11266a8", "filename": "compiler/rustc_target/src/spec/mipsel_sony_psp.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5d81f91a3bbb6b26894b2b03a488321eb3665214/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d81f91a3bbb6b26894b2b03a488321eb3665214/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp.rs?ref=5d81f91a3bbb6b26894b2b03a488321eb3665214", "patch": "@@ -6,7 +6,8 @@ const LINKER_SCRIPT: &str = include_str!(\"./mipsel_sony_psp_linker_script.ld\");\n \n pub fn target() -> Target {\n     let mut pre_link_args = LinkArgs::new();\n-    pre_link_args.insert(LinkerFlavor::Lld(LldFlavor::Ld), vec![\"--emit-relocs\".into()]);\n+    pre_link_args\n+        .insert(LinkerFlavor::Lld(LldFlavor::Ld), vec![\"--emit-relocs\".into(), \"--nmagic\".into()]);\n \n     Target {\n         llvm_target: \"mipsel-sony-psp\".into(),"}, {"sha": "9eb35ad9f5d2e93e34080fbc018c99a9040eb5e9", "filename": "compiler/rustc_target/src/spec/mipsel_sony_psp_linker_script.ld", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5d81f91a3bbb6b26894b2b03a488321eb3665214/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp_linker_script.ld", "raw_url": "https://github.com/rust-lang/rust/raw/5d81f91a3bbb6b26894b2b03a488321eb3665214/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp_linker_script.ld", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmipsel_sony_psp_linker_script.ld?ref=5d81f91a3bbb6b26894b2b03a488321eb3665214", "patch": "@@ -7,14 +7,18 @@ SECTIONS\n   /* Sort stubs for convenient ordering */\n   .sceStub.text : { *(.sceStub.text) *(SORT(.sceStub.text.*)) }\n \n+  /* PSP import library stub sections. Bundles together `.lib.stub.entry.*`\n+   * sections for better `--gc-sections` support. */\n+  .lib.stub.top : { *(.lib.stub.top) }\n+  .lib.stub :     { *(.lib.stub) *(.lib.stub.entry.*) }\n+  .lib.stub.btm : { *(.lib.stub.btm) }\n+\n   /* Keep these sections around, even though they may appear unused to the linker */\n   .lib.ent.top :  { KEEP(*(.lib.ent.top)) }\n   .lib.ent :      { KEEP(*(.lib.ent)) }\n   .lib.ent.btm :  { KEEP(*(.lib.ent.btm)) }\n-  .lib.stub.top : { KEEP(*(.lib.stub.top)) }\n-  .lib.stub :     { KEEP(*(.lib.stub)) }\n-  .lib.stub.btm : { KEEP(*(.lib.stub.btm)) }\n-  .eh_frame_hdr : { KEEP(*(.eh_frame_hdr)) }\n+\n+  .eh_frame_hdr : { *(.eh_frame_hdr) }\n \n   /* Add symbols for LLVM's libunwind */\n   __eh_frame_hdr_start = SIZEOF(.eh_frame_hdr) > 0 ? ADDR(.eh_frame_hdr) : 0;\n@@ -27,8 +31,15 @@ SECTIONS\n   }\n \n   /* These are explicitly listed to avoid being merged into .rodata */\n-  .rodata.sceResident : { *(.rodata.sceResident) }\n+  .rodata.sceResident : { *(.rodata.sceResident) *(.rodata.sceResident.*) }\n   .rodata.sceModuleInfo : { *(.rodata.sceModuleInfo) }\n   /* Sort NIDs for convenient ordering */\n   .rodata.sceNid : { *(.rodata.sceNid) *(SORT(.rodata.sceNid.*)) }\n+\n+  .rodata : { *(.rodata .rodata.*) }\n+  .data : { *(.data .data.*) }\n+  .gcc_except_table : { *(.gcc_except_table .gcc_except_table.*) }\n+  .bss : { *(.bss .bss.*) }\n+\n+  /DISCARD/ : { *(.rel.sceStub.text .MIPS.abiflags .reginfo) }\n }"}]}