{"sha": "47014df79083f837323aa60021b893d2a33a9828", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3MDE0ZGY3OTA4M2Y4MzczMjNhYTYwMDIxYjg5M2QyYTMzYTk4Mjg=", "commit": {"author": {"name": "Kevin Leimkuhler", "email": "kevin@kleimkuhler.com", "date": "2018-10-07T02:48:04Z"}, "committer": {"name": "Kevin Leimkuhler", "email": "kevin@kleimkuhler.com", "date": "2018-10-10T04:10:27Z"}, "message": "Fix Range warning and improve tests", "tree": {"sha": "5c7cad5bf20be8b5247b41853590c8e06efccd46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c7cad5bf20be8b5247b41853590c8e06efccd46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47014df79083f837323aa60021b893d2a33a9828", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47014df79083f837323aa60021b893d2a33a9828", "html_url": "https://github.com/rust-lang/rust/commit/47014df79083f837323aa60021b893d2a33a9828", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47014df79083f837323aa60021b893d2a33a9828/comments", "author": {"login": "kleimkuhler", "id": 4572153, "node_id": "MDQ6VXNlcjQ1NzIxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/4572153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kleimkuhler", "html_url": "https://github.com/kleimkuhler", "followers_url": "https://api.github.com/users/kleimkuhler/followers", "following_url": "https://api.github.com/users/kleimkuhler/following{/other_user}", "gists_url": "https://api.github.com/users/kleimkuhler/gists{/gist_id}", "starred_url": "https://api.github.com/users/kleimkuhler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kleimkuhler/subscriptions", "organizations_url": "https://api.github.com/users/kleimkuhler/orgs", "repos_url": "https://api.github.com/users/kleimkuhler/repos", "events_url": "https://api.github.com/users/kleimkuhler/events{/privacy}", "received_events_url": "https://api.github.com/users/kleimkuhler/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kleimkuhler", "id": 4572153, "node_id": "MDQ6VXNlcjQ1NzIxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/4572153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kleimkuhler", "html_url": "https://github.com/kleimkuhler", "followers_url": "https://api.github.com/users/kleimkuhler/followers", "following_url": "https://api.github.com/users/kleimkuhler/following{/other_user}", "gists_url": "https://api.github.com/users/kleimkuhler/gists{/gist_id}", "starred_url": "https://api.github.com/users/kleimkuhler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kleimkuhler/subscriptions", "organizations_url": "https://api.github.com/users/kleimkuhler/orgs", "repos_url": "https://api.github.com/users/kleimkuhler/repos", "events_url": "https://api.github.com/users/kleimkuhler/events{/privacy}", "received_events_url": "https://api.github.com/users/kleimkuhler/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46b07d670a168e832391bba35d58f823cd00b76d", "url": "https://api.github.com/repos/rust-lang/rust/commits/46b07d670a168e832391bba35d58f823cd00b76d", "html_url": "https://github.com/rust-lang/rust/commit/46b07d670a168e832391bba35d58f823cd00b76d"}], "stats": {"total": 76, "additions": 38, "deletions": 38}, "files": [{"sha": "050e52d2e0cdd827b1932908fa36d62527a09411", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/47014df79083f837323aa60021b893d2a33a9828/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47014df79083f837323aa60021b893d2a33a9828/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=47014df79083f837323aa60021b893d2a33a9828", "patch": "@@ -376,8 +376,12 @@ impl EarlyLintPass for UnusedParens {\n     }\n \n     fn check_pat(&mut self, cx: &EarlyContext, p: &ast::Pat) {\n-        if let ast::PatKind::Paren(_) = p.node {\n-            self.check_unused_parens_pat(cx, &p, \"pattern\");\n+        use ast::PatKind::{Paren, Range};\n+        if let Paren(ref pat) = p.node {\n+            match pat.node {\n+                Range(..) => {}\n+                _ => self.check_unused_parens_pat(cx, &p, \"pattern\")\n+            }\n         }\n     }\n "}, {"sha": "97a2dd59a6209d0332099fca262f65fb4e37cae8", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.rs", "status": "modified", "additions": 17, "deletions": 21, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/47014df79083f837323aa60021b893d2a33a9828/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47014df79083f837323aa60021b893d2a33a9828/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs?ref=47014df79083f837323aa60021b893d2a33a9828", "patch": "@@ -14,29 +14,25 @@\n #![allow(unused_variables)]\n #![warn(unused_parens)]\n \n-struct A {\n-    field: Option<String>,\n-}\n-\n fn main() {\n-    let x = 3;\n-    match x {\n-        (_) => {}     //~ WARNING: unnecessary parentheses around pattern\n-        (y) => {}     //~ WARNING: unnecessary parentheses around pattern\n-        (ref r) => {} //~ WARNING: unnecessary parentheses around pattern\n-        e @ 1...2 | (e @ (3...4)) => {}\n-        //~^ WARNING: unnecessary parentheses around pattern (3 ... 4)\n-        //~^ WARNING: unnecessary parentheses around pattern (e @ _)\n+    match 1 {\n+        (_) => {}         //~ WARNING: unnecessary parentheses around pattern\n+        (y) => {}         //~ WARNING: unnecessary parentheses around pattern\n+        (ref r) => {}     //~ WARNING: unnecessary parentheses around pattern\n+        (e @ 1..=2) => {} //~ WARNING: unnecessary parentheses around outer pattern\n+        (1..=2) => {}     // Non ambiguous range pattern should not warn\n+        e @ (3..=4) => {} // Non ambiguous range pattern should not warn\n+    }\n+\n+    match &1 {\n+        (e @ &(1...2)) => {} //~ WARNING: unnecessary parentheses around outer pattern\n+        &(_) => {}           //~ WARNING: unnecessary parentheses around pattern\n+        e @ &(1...2) => {}   // Ambiguous range pattern should not warn\n+        &(1..=2) => {}       // Ambiguous range pattern should not warn\n     }\n \n-    let field = \"foo\".to_string();\n-    let x: Option<A> = Some(A { field: Some(field) });\n-    match x {\n-        Some(A {\n-            field: (ref a @ Some(_)),\n-            //~^ WARNING: unnecessary parentheses around pattern\n-            ..\n-        }) => {}\n-        _ => {}\n+    match &1 {\n+        e @ &(1...2) | e @ &(3..=4) => {} // Complex ambiguous pattern should not warn\n+        &_ => {}\n     }\n }"}, {"sha": "b76b969fd2b1a8ab1693933076b75d177db00149", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.stderr", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/47014df79083f837323aa60021b893d2a33a9828/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/47014df79083f837323aa60021b893d2a33a9828/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr?ref=47014df79083f837323aa60021b893d2a33a9828", "patch": "@@ -1,7 +1,7 @@\n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:24:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:19:9\n    |\n-LL |         (_) => {}     //~ WARNING: unnecessary parentheses around pattern\n+LL |         (_) => {}         //~ WARNING: unnecessary parentheses around pattern\n    |         ^^^ help: remove these parentheses\n    |\n note: lint level defined here\n@@ -11,32 +11,32 @@ LL | #![warn(unused_parens)]\n    |         ^^^^^^^^^^^^^\n \n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:25:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:20:9\n    |\n-LL |         (y) => {}     //~ WARNING: unnecessary parentheses around pattern\n+LL |         (y) => {}         //~ WARNING: unnecessary parentheses around pattern\n    |         ^^^ help: remove these parentheses\n \n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:26:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:21:9\n    |\n-LL |         (ref r) => {} //~ WARNING: unnecessary parentheses around pattern\n+LL |         (ref r) => {}     //~ WARNING: unnecessary parentheses around pattern\n    |         ^^^^^^^ help: remove these parentheses\n \n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:27:21\n+  --> $DIR/issue-54538-unused-parens-lint.rs:22:9\n    |\n-LL |         e @ 1...2 | (e @ (3...4)) => {}\n-   |                     ^^^^^^^^^^^^^ help: remove these parentheses\n+LL |         (e @ 1..=2) => {} //~ WARNING: unnecessary parentheses around outer pattern\n+   |         ^^^^^^^^^^^ help: remove these parentheses\n \n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:27:26\n+  --> $DIR/issue-54538-unused-parens-lint.rs:28:9\n    |\n-LL |         e @ 1...2 | (e @ (3...4)) => {}\n-   |                          ^^^^^^^ help: remove these parentheses\n+LL |         (e @ &(1...2)) => {} //~ WARNING: unnecessary parentheses around outer pattern\n+   |         ^^^^^^^^^^^^^^ help: remove these parentheses\n \n warning: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:36:20\n+  --> $DIR/issue-54538-unused-parens-lint.rs:29:10\n    |\n-LL |             field: (ref a @ Some(_)),\n-   |                    ^^^^^^^^^^^^^^^^^ help: remove these parentheses\n+LL |         &(_) => {}           //~ WARNING: unnecessary parentheses around pattern\n+   |          ^^^ help: remove these parentheses\n "}]}