{"sha": "09ad0cd362204e3da92cfa6bc8116299516e8275", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5YWQwY2QzNjIyMDRlM2RhOTJjZmE2YmM4MTE2Mjk5NTE2ZTgyNzU=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-09-03T08:44:47Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-09-03T08:44:47Z"}, "message": "add type name to the tydesc\n\nCloses #8926", "tree": {"sha": "35a52432b973a0b18d024e06674f8de8c9bf4ab6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35a52432b973a0b18d024e06674f8de8c9bf4ab6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09ad0cd362204e3da92cfa6bc8116299516e8275", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09ad0cd362204e3da92cfa6bc8116299516e8275", "html_url": "https://github.com/rust-lang/rust/commit/09ad0cd362204e3da92cfa6bc8116299516e8275", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09ad0cd362204e3da92cfa6bc8116299516e8275/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "58decdd7a115f2892d63fa3760fa2125eb784ac8", "url": "https://api.github.com/repos/rust-lang/rust/commits/58decdd7a115f2892d63fa3760fa2125eb784ac8", "html_url": "https://github.com/rust-lang/rust/commit/58decdd7a115f2892d63fa3760fa2125eb784ac8"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "2d5a4b4edb78c44f107bdc11b49c0d8ecc1964cb", "filename": "src/librustc/back/abi.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fback%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fback%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Fabi.rs?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -47,7 +47,8 @@ pub static tydesc_field_drop_glue: uint = 3u;\n pub static tydesc_field_free_glue: uint = 4u;\n pub static tydesc_field_visit_glue: uint = 5u;\n pub static tydesc_field_borrow_offset: uint = 6u;\n-pub static n_tydesc_fields: uint = 7u;\n+pub static tydesc_field_name_offset: uint = 7u;\n+pub static n_tydesc_fields: uint = 8u;\n \n // The two halves of a closure: code and environment.\n pub static fn_field_code: uint = 0u;"}, {"sha": "b619085ee849789fe744c75c1e0364f85aef29d7", "filename": "src/librustc/middle/trans/common.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -56,6 +56,7 @@ pub struct tydesc_info {\n     size: ValueRef,\n     align: ValueRef,\n     borrow_offset: ValueRef,\n+    name: ValueRef,\n     take_glue: Option<ValueRef>,\n     drop_glue: Option<ValueRef>,\n     free_glue: Option<ValueRef>,"}, {"sha": "9856758990a402f54bf5cc7b7184f04312a2a752", "filename": "src/librustc/middle/trans/glue.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -678,12 +678,16 @@ pub fn declare_tydesc(ccx: &mut CrateContext, t: ty::t) -> @mut tydesc_info {\n             llvm::LLVMAddGlobal(ccx.llmod, ccx.tydesc_type.to_ref(), buf)\n         }\n     };\n+\n+    let ty_name = C_estr_slice(ccx, ppaux::ty_to_str(ccx.tcx, t).to_managed());\n+\n     let inf = @mut tydesc_info {\n         ty: t,\n         tydesc: gvar,\n         size: llsize,\n         align: llalign,\n         borrow_offset: borrow_offset,\n+        name: ty_name,\n         take_glue: None,\n         drop_glue: None,\n         free_glue: None,\n@@ -809,14 +813,14 @@ pub fn emit_tydescs(ccx: &mut CrateContext) {\n                                      drop_glue, // drop_glue\n                                      free_glue, // free_glue\n                                      visit_glue, // visit_glue\n-                                     ti.borrow_offset]); // borrow_offset\n+                                     ti.borrow_offset, // borrow_offset\n+                                     ti.name]); // name\n \n         unsafe {\n             let gvar = ti.tydesc;\n             llvm::LLVMSetInitializer(gvar, tydesc);\n             llvm::LLVMSetGlobalConstant(gvar, True);\n             lib::llvm::SetLinkage(gvar, lib::llvm::InternalLinkage);\n-\n         }\n     };\n }"}, {"sha": "281c047641c6bd8a0f4f24381cc2c6c6d19b5d67", "filename": "src/librustc/middle/trans/type_.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_.rs?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -216,8 +216,8 @@ impl Type {\n                      glue_fn_ty, // drop\n                      glue_fn_ty, // free\n                      glue_fn_ty, // visit\n-                     int_ty];    // borrow_offset\n-\n+                     int_ty, // borrow_offset\n+                     Type::struct_([Type::i8p(), Type::int(arch)], false)]; // name\n         tydesc.set_struct_body(elems, false);\n \n         return tydesc;"}, {"sha": "c3791d18b384657d5dadcee6ed981c4cf459eaa1", "filename": "src/libstd/unstable/intrinsics.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibstd%2Funstable%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Flibstd%2Funstable%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fintrinsics.rs?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -66,6 +66,9 @@ pub struct TyDesc {\n     // `U`, but in the case of `@Trait` or `~Trait` objects, the type\n     // `U` is unknown.\n     borrow_offset: uint,\n+\n+    // Name corresponding to the type\n+    name: &'static str\n }\n \n #[lang=\"opaque\"]"}, {"sha": "fe3c946a40b30de69e9a8ebbb973ecf17c0cd4f9", "filename": "src/rt/rust_type.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Frt%2Frust_type.h", "raw_url": "https://github.com/rust-lang/rust/raw/09ad0cd362204e3da92cfa6bc8116299516e8275/src%2Frt%2Frust_type.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_type.h?ref=09ad0cd362204e3da92cfa6bc8116299516e8275", "patch": "@@ -52,6 +52,11 @@ static inline void *box_body(rust_opaque_box *box) {\n     return (void*)(box + 1);\n }\n \n+struct slice {\n+    void *data;\n+    size_t length;\n+};\n+\n struct type_desc {\n     size_t size;\n     size_t align;\n@@ -60,6 +65,7 @@ struct type_desc {\n     glue_fn *free_glue;\n     glue_fn *visit_glue;\n     size_t borrow_offset;\n+    slice name;\n };\n \n #endif"}]}