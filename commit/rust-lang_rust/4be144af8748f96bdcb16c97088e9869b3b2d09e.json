{"sha": "4be144af8748f96bdcb16c97088e9869b3b2d09e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiZTE0NGFmODc0OGY5NmJkY2IxNmM5NzA4OGU5ODY5YjNiMmQwOWU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-07T22:05:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-07T22:05:51Z"}, "message": "Auto merge of #4697 - Licenser:no-exit, r=flip1995\n\nrestriction lint for `std::process::exit`\n\nAddition to #4655 - adds the lint checking for `std::process::exit`\n\nchangelog: add restriction lint for `std::process::exit`", "tree": {"sha": "2f5e86bfc9910ca35e11efadab9abb16e7fff57e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f5e86bfc9910ca35e11efadab9abb16e7fff57e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4be144af8748f96bdcb16c97088e9869b3b2d09e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4be144af8748f96bdcb16c97088e9869b3b2d09e", "html_url": "https://github.com/rust-lang/rust/commit/4be144af8748f96bdcb16c97088e9869b3b2d09e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4be144af8748f96bdcb16c97088e9869b3b2d09e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03806edb76b4eeee8f01d280417840b76bfb70c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/03806edb76b4eeee8f01d280417840b76bfb70c7", "html_url": "https://github.com/rust-lang/rust/commit/03806edb76b4eeee8f01d280417840b76bfb70c7"}, {"sha": "2f1370d64cb62c521ec04999f30ed856b644dccc", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f1370d64cb62c521ec04999f30ed856b644dccc", "html_url": "https://github.com/rust-lang/rust/commit/2f1370d64cb62c521ec04999f30ed856b644dccc"}], "stats": {"total": 120, "additions": 118, "deletions": 2}, "files": [{"sha": "84a3bd491cb829a842872231b0e67b9b77118109", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -996,6 +996,7 @@ Released 2018-09-13\n [`erasing_op`]: https://rust-lang.github.io/rust-clippy/master/index.html#erasing_op\n [`eval_order_dependence`]: https://rust-lang.github.io/rust-clippy/master/index.html#eval_order_dependence\n [`excessive_precision`]: https://rust-lang.github.io/rust-clippy/master/index.html#excessive_precision\n+[`exit`]: https://rust-lang.github.io/rust-clippy/master/index.html#exit\n [`expect_fun_call`]: https://rust-lang.github.io/rust-clippy/master/index.html#expect_fun_call\n [`expl_impl_clone_on_copy`]: https://rust-lang.github.io/rust-clippy/master/index.html#expl_impl_clone_on_copy\n [`explicit_counter_loop`]: https://rust-lang.github.io/rust-clippy/master/index.html#explicit_counter_loop"}, {"sha": "87ef441eadd5971144f6cd79484d14d1f374095c", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -6,7 +6,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 331 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 332 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "7220833b9f233d8dfcbbedef4f16a4b213fb4ad2", "filename": "clippy_lints/src/exit.rs", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Fexit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Fexit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fexit.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,47 @@\n+use crate::utils::{is_entrypoint_fn, match_def_path, paths, qpath_res, span_lint};\n+use if_chain::if_chain;\n+use rustc::hir::{Expr, ExprKind, Item, ItemKind, Node};\n+use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n+use rustc::{declare_lint_pass, declare_tool_lint};\n+\n+declare_clippy_lint! {\n+    /// **What it does:** `exit()`  terminates the program and doesn't provide a\n+    /// stack trace.\n+    ///\n+    /// **Why is this bad?** Ideally a program is terminated by finishing\n+    /// the main function.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    /// ```ignore\n+    /// std::process::exit(0)\n+    /// ```\n+    pub EXIT,\n+    restriction,\n+    \"`std::process::exit` is called, terminating the program\"\n+}\n+\n+declare_lint_pass!(Exit => [EXIT]);\n+\n+impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Exit {\n+    fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, e: &'tcx Expr) {\n+        if_chain! {\n+            if let ExprKind::Call(ref path_expr, ref _args) = e.kind;\n+            if let ExprKind::Path(ref path) = path_expr.kind;\n+            if let Some(def_id) = qpath_res(cx, path, path_expr.hir_id).opt_def_id();\n+            if match_def_path(cx, def_id, &paths::EXIT);\n+            then {\n+                let mut parent = cx.tcx.hir().get_parent_item(e.hir_id);\n+                if let Some(Node::Item(Item{ident, kind: ItemKind::Fn(..), ..})) = cx.tcx.hir().find(parent) {\n+                    // If the next item up is a function we check if it is an entry point\n+                    // and only then emit a linter warning\n+                    let def_id = cx.tcx.hir().local_def_id(parent);\n+                    if !is_entrypoint_fn(cx, def_id) {\n+                        span_lint(cx, EXIT, e.span, \"usage of `process::exit`\");\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "dae1c429b7d5e2b4521d5afef24e2b1546302315", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -188,6 +188,7 @@ pub mod escape;\n pub mod eta_reduction;\n pub mod eval_order_dependence;\n pub mod excessive_precision;\n+pub mod exit;\n pub mod explicit_write;\n pub mod fallible_impl_from;\n pub mod format;\n@@ -501,6 +502,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n         &eval_order_dependence::DIVERGING_SUB_EXPRESSION,\n         &eval_order_dependence::EVAL_ORDER_DEPENDENCE,\n         &excessive_precision::EXCESSIVE_PRECISION,\n+        &exit::EXIT,\n         &explicit_write::EXPLICIT_WRITE,\n         &fallible_impl_from::FALLIBLE_IMPL_FROM,\n         &format::USELESS_FORMAT,\n@@ -941,12 +943,14 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n     store.register_early_pass(move || box enum_variants::EnumVariantNames::new(enum_variant_name_threshold));\n     store.register_late_pass(|| box unused_self::UnusedSelf);\n     store.register_late_pass(|| box mutable_debug_assertion::DebugAssertWithMutCall);\n+    store.register_late_pass(|| box exit::Exit);\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),\n         LintId::of(&arithmetic::INTEGER_ARITHMETIC),\n         LintId::of(&dbg_macro::DBG_MACRO),\n         LintId::of(&else_if_without_else::ELSE_IF_WITHOUT_ELSE),\n+        LintId::of(&exit::EXIT),\n         LintId::of(&implicit_return::IMPLICIT_RETURN),\n         LintId::of(&indexing_slicing::INDEXING_SLICING),\n         LintId::of(&inherent_impl::MULTIPLE_INHERENT_IMPL),"}, {"sha": "042ca4ee7fdc1bc2dd4c69df211e5654d17a61e9", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -27,6 +27,7 @@ pub const DROP: [&str; 3] = [\"core\", \"mem\", \"drop\"];\n pub const DROP_TRAIT: [&str; 4] = [\"core\", \"ops\", \"drop\", \"Drop\"];\n pub const DURATION: [&str; 3] = [\"core\", \"time\", \"Duration\"];\n pub const EARLY_CONTEXT: [&str; 4] = [\"rustc\", \"lint\", \"context\", \"EarlyContext\"];\n+pub const EXIT: [&str; 3] = [\"std\", \"process\", \"exit\"];\n pub const FMT_ARGUMENTS_NEW_V1: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1\"];\n pub const FMT_ARGUMENTS_NEW_V1_FORMATTED: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1_formatted\"];\n pub const FMT_ARGUMENTV1_NEW: [&str; 4] = [\"core\", \"fmt\", \"ArgumentV1\", \"new\"];"}, {"sha": "5c92d69a49931cc19e5f27351bab98642fd00ac3", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -6,7 +6,7 @@ pub use lint::Lint;\n pub use lint::LINT_LEVELS;\n \n // begin lint list, do not remove this comment, it\u2019s used in `update_lints`\n-pub const ALL_LINTS: [Lint; 331] = [\n+pub const ALL_LINTS: [Lint; 332] = [\n     Lint {\n         name: \"absurd_extreme_comparisons\",\n         group: \"correctness\",\n@@ -490,6 +490,13 @@ pub const ALL_LINTS: [Lint; 331] = [\n         deprecation: None,\n         module: \"excessive_precision\",\n     },\n+    Lint {\n+        name: \"exit\",\n+        group: \"restriction\",\n+        desc: \"`std::process::exit` is called, terminating the program\",\n+        deprecation: None,\n+        module: \"exit\",\n+    },\n     Lint {\n         name: \"expect_fun_call\",\n         group: \"perf\","}, {"sha": "4eac6eb74672fac716d1aaf8726855ca8febd918", "filename": "tests/ui/exit1.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit1.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,15 @@\n+#[warn(clippy::exit)]\n+\n+fn not_main() {\n+    if true {\n+        std::process::exit(4);\n+    }\n+}\n+\n+fn main() {\n+    if true {\n+        std::process::exit(2);\n+    };\n+    not_main();\n+    std::process::exit(1);\n+}"}, {"sha": "a8d3956aa27a0639abf44db5d8b6639d261fd918", "filename": "tests/ui/exit1.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit1.stderr?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,10 @@\n+error: usage of `process::exit`\n+  --> $DIR/exit1.rs:5:9\n+   |\n+LL |         std::process::exit(4);\n+   |         ^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::exit` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "4b693ed7083f000e5346722f2f8239e9fbe78c2b", "filename": "tests/ui/exit2.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit2.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,13 @@\n+#[warn(clippy::exit)]\n+\n+fn also_not_main() {\n+    std::process::exit(3);\n+}\n+\n+fn main() {\n+    if true {\n+        std::process::exit(2);\n+    };\n+    also_not_main();\n+    std::process::exit(1);\n+}"}, {"sha": "7263e156a9d26cac356a48178c457de47454a474", "filename": "tests/ui/exit2.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit2.stderr?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,10 @@\n+error: usage of `process::exit`\n+  --> $DIR/exit2.rs:4:5\n+   |\n+LL |     std::process::exit(3);\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::exit` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "9dc0e1015a4f75894763e3c76e434fc7331e4f66", "filename": "tests/ui/exit3.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4be144af8748f96bdcb16c97088e9869b3b2d09e/tests%2Fui%2Fexit3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fexit3.rs?ref=4be144af8748f96bdcb16c97088e9869b3b2d09e", "patch": "@@ -0,0 +1,8 @@\n+#[warn(clippy::exit)]\n+\n+fn main() {\n+    if true {\n+        std::process::exit(2);\n+    };\n+    std::process::exit(1);\n+}"}]}