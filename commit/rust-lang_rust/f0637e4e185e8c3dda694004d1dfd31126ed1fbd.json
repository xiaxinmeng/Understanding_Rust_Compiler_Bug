{"sha": "f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwNjM3ZTRlMTg1ZThjM2RkYTY5NDAwNGQxZGZkMzExMjZlZDFmYmQ=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-02-20T01:00:31Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-02-20T01:00:31Z"}, "message": "Lower condition of `if` expression before it's \"then\" block\n\nFix #82290, fix #82250.", "tree": {"sha": "de8f1bd64394d24f136003f45252145a46eb055c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de8f1bd64394d24f136003f45252145a46eb055c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "html_url": "https://github.com/rust-lang/rust/commit/f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fe989dd768f5dfdb0fc90933f3f74fa4579fefd", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fe989dd768f5dfdb0fc90933f3f74fa4579fefd", "html_url": "https://github.com/rust-lang/rust/commit/8fe989dd768f5dfdb0fc90933f3f74fa4579fefd"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "6d44feec2c4969f6095b557048460a7313e74550", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "patch": "@@ -347,8 +347,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     ) -> hir::ExprKind<'hir> {\n         macro_rules! make_if {\n             ($opt:expr) => {{\n+                let cond = self.lower_expr(cond);\n                 let then_expr = self.lower_block_expr(then);\n-                hir::ExprKind::If(self.lower_expr(cond), self.arena.alloc(then_expr), $opt)\n+                hir::ExprKind::If(cond, self.arena.alloc(then_expr), $opt)\n             }};\n         }\n         if let Some(rslt) = else_opt {"}, {"sha": "67f0274fe7436e9b1acfe6ff9dec4144ea4bddd2", "filename": "src/test/ui/pattern/issue-82290.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.rs?ref=f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "patch": "@@ -0,0 +1,7 @@\n+#![feature(let_chains)] //~ WARN the feature `let_chains` is incomplete\n+\n+fn main() {\n+    if true && let x = 1 { //~ ERROR `let` expressions are not supported here\n+        let _ = x;\n+    }\n+}"}, {"sha": "65ef018dc97374ddc8371b18e3b8a28c8ec432d7", "filename": "src/test/ui/pattern/issue-82290.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f0637e4e185e8c3dda694004d1dfd31126ed1fbd/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fissue-82290.stderr?ref=f0637e4e185e8c3dda694004d1dfd31126ed1fbd", "patch": "@@ -0,0 +1,20 @@\n+error: `let` expressions are not supported here\n+  --> $DIR/issue-82290.rs:4:16\n+   |\n+LL |     if true && let x = 1 {\n+   |                ^^^^^^^^^\n+   |\n+   = note: only supported directly in conditions of `if`- and `while`-expressions\n+   = note: as well as when nested within `&&` and parenthesis in those conditions\n+\n+warning: the feature `let_chains` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/issue-82290.rs:1:12\n+   |\n+LL | #![feature(let_chains)]\n+   |            ^^^^^^^^^^\n+   |\n+   = note: `#[warn(incomplete_features)]` on by default\n+   = note: see issue #53667 <https://github.com/rust-lang/rust/issues/53667> for more information\n+\n+error: aborting due to previous error; 1 warning emitted\n+"}]}