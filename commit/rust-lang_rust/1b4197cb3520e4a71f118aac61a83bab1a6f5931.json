{"sha": "1b4197cb3520e4a71f118aac61a83bab1a6f5931", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiNDE5N2NiMzUyMGU0YTcxZjExOGFhYzYxYTgzYmFiMWE2ZjU5MzE=", "commit": {"author": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2021-04-22T15:30:44Z"}, "committer": {"name": "vsrs", "email": "vit@conrlab.com", "date": "2021-04-22T15:59:03Z"}, "message": "Use explicit rustc commit-hash\n\nRequired for lldb on mac", "tree": {"sha": "15e7b0a8d56b2796b1b3c1d70ad920acd2ad77e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15e7b0a8d56b2796b1b3c1d70ad920acd2ad77e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b4197cb3520e4a71f118aac61a83bab1a6f5931", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b4197cb3520e4a71f118aac61a83bab1a6f5931", "html_url": "https://github.com/rust-lang/rust/commit/1b4197cb3520e4a71f118aac61a83bab1a6f5931", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b4197cb3520e4a71f118aac61a83bab1a6f5931/comments", "author": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vsrs", "id": 62505555, "node_id": "MDQ6VXNlcjYyNTA1NTU1", "avatar_url": "https://avatars.githubusercontent.com/u/62505555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vsrs", "html_url": "https://github.com/vsrs", "followers_url": "https://api.github.com/users/vsrs/followers", "following_url": "https://api.github.com/users/vsrs/following{/other_user}", "gists_url": "https://api.github.com/users/vsrs/gists{/gist_id}", "starred_url": "https://api.github.com/users/vsrs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vsrs/subscriptions", "organizations_url": "https://api.github.com/users/vsrs/orgs", "repos_url": "https://api.github.com/users/vsrs/repos", "events_url": "https://api.github.com/users/vsrs/events{/privacy}", "received_events_url": "https://api.github.com/users/vsrs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ebfe11730191e914dcf20297cdfdac5b7c297fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ebfe11730191e914dcf20297cdfdac5b7c297fc", "html_url": "https://github.com/rust-lang/rust/commit/1ebfe11730191e914dcf20297cdfdac5b7c297fc"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "830980f968c5bb92f69ee41cc13151db9721ae3e", "filename": "editors/code/src/debug.ts", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Fdebug.ts", "raw_url": "https://github.com/rust-lang/rust/raw/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Fdebug.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fdebug.ts?ref=1b4197cb3520e4a71f118aac61a83bab1a6f5931", "patch": "@@ -3,7 +3,7 @@ import * as vscode from 'vscode';\n import * as path from 'path';\n import * as ra from './lsp_ext';\n \n-import { Cargo, getSysroot } from './toolchain';\n+import { Cargo, getRustcId, getSysroot } from './toolchain';\n import { Ctx } from \"./ctx\";\n import { prepareEnv } from \"./run\";\n \n@@ -107,9 +107,11 @@ async function getDebugConfiguration(ctx: Ctx, runnable: ra.Runnable): Promise<v\n     let sourceFileMap = debugOptions.sourceFileMap;\n     if (sourceFileMap === \"auto\") {\n         // let's try to use the default toolchain\n+        const commitHash = await getRustcId(wsFolder);\n         const sysroot = await getSysroot(wsFolder);\n         const rustlib = path.normalize(sysroot + \"/lib/rustlib/src/rust\");\n-        sourceFileMap = { \"/rustc/*\": rustlib };\n+        sourceFileMap = {};\n+        sourceFileMap[`/rustc/${commitHash}/`] = rustlib;\n     }\n \n     const debugConfig = knownEngines[debugEngine.id](runnable, simplifyPath(executable), env, sourceFileMap);"}, {"sha": "68826c478d37248cb5ca0a2123aa1d74932b483c", "filename": "editors/code/src/toolchain.ts", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Ftoolchain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Ftoolchain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Ftoolchain.ts?ref=1b4197cb3520e4a71f118aac61a83bab1a6f5931", "patch": "@@ -129,6 +129,16 @@ export function getSysroot(dir: string): Promise<string> {\n     return execute(`${rustcPath} --print sysroot`, { cwd: dir });\n }\n \n+export async function getRustcId(dir: string): Promise<string> {\n+    const rustcPath = getPathForExecutable(\"rustc\");\n+\n+    // do not memoize the result because the toolchain may change between runs\n+    const data = await execute(`${rustcPath} -V -v`, { cwd: dir });\n+    const rx = /commit-hash:\\s(.*)$/m.compile();\n+\n+    return rx.exec(data)![1];\n+}\n+\n /** Mirrors `toolchain::cargo()` implementation */\n export function cargoPath(): string {\n     return getPathForExecutable(\"cargo\");"}, {"sha": "56e0e439e980e46a87c86ec5a2387ad6adf2d233", "filename": "editors/code/src/util.ts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Futil.ts", "raw_url": "https://github.com/rust-lang/rust/raw/1b4197cb3520e4a71f118aac61a83bab1a6f5931/editors%2Fcode%2Fsrc%2Futil.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Futil.ts?ref=1b4197cb3520e4a71f118aac61a83bab1a6f5931", "patch": "@@ -159,4 +159,4 @@ export function execute(command: string, options: ExecOptions): Promise<string>\n             resolve(stdout.trimEnd());\n         });\n     });\n-}\n\\ No newline at end of file\n+}"}]}