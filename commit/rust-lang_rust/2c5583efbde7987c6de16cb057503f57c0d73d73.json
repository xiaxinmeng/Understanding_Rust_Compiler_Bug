{"sha": "2c5583efbde7987c6de16cb057503f57c0d73d73", "node_id": "C_kwDOAAsO6NoAKDJjNTU4M2VmYmRlNzk4N2M2ZGUxNmNiMDU3NTAzZjU3YzBkNzNkNzM", "commit": {"author": {"name": "gftea", "email": "ckq614@gmail.com", "date": "2023-01-15T17:42:04Z"}, "committer": {"name": "gftea", "email": "ckq614@gmail.com", "date": "2023-01-16T10:09:53Z"}, "message": "check -Z query-dep-graph is enabled if -Z dump-dep-graph (#106736)", "tree": {"sha": "3d886dd25f41ac2fdd71bd60dd0e01f8cc698bec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d886dd25f41ac2fdd71bd60dd0e01f8cc698bec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c5583efbde7987c6de16cb057503f57c0d73d73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c5583efbde7987c6de16cb057503f57c0d73d73", "html_url": "https://github.com/rust-lang/rust/commit/2c5583efbde7987c6de16cb057503f57c0d73d73", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c5583efbde7987c6de16cb057503f57c0d73d73/comments", "author": {"login": "gftea", "id": 1705787, "node_id": "MDQ6VXNlcjE3MDU3ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1705787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gftea", "html_url": "https://github.com/gftea", "followers_url": "https://api.github.com/users/gftea/followers", "following_url": "https://api.github.com/users/gftea/following{/other_user}", "gists_url": "https://api.github.com/users/gftea/gists{/gist_id}", "starred_url": "https://api.github.com/users/gftea/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gftea/subscriptions", "organizations_url": "https://api.github.com/users/gftea/orgs", "repos_url": "https://api.github.com/users/gftea/repos", "events_url": "https://api.github.com/users/gftea/events{/privacy}", "received_events_url": "https://api.github.com/users/gftea/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gftea", "id": 1705787, "node_id": "MDQ6VXNlcjE3MDU3ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1705787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gftea", "html_url": "https://github.com/gftea", "followers_url": "https://api.github.com/users/gftea/followers", "following_url": "https://api.github.com/users/gftea/following{/other_user}", "gists_url": "https://api.github.com/users/gftea/gists{/gist_id}", "starred_url": "https://api.github.com/users/gftea/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gftea/subscriptions", "organizations_url": "https://api.github.com/users/gftea/orgs", "repos_url": "https://api.github.com/users/gftea/repos", "events_url": "https://api.github.com/users/gftea/events{/privacy}", "received_events_url": "https://api.github.com/users/gftea/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d12412c90fbd974b1cf886e42a95c850d9ee45a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/d12412c90fbd974b1cf886e42a95c850d9ee45a1", "html_url": "https://github.com/rust-lang/rust/commit/d12412c90fbd974b1cf886e42a95c850d9ee45a1"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "38aebc81cd6b8cd1a5b95c35fd2a109e67df481f", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2c5583efbde7987c6de16cb057503f57c0d73d73/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c5583efbde7987c6de16cb057503f57c0d73d73/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=2c5583efbde7987c6de16cb057503f57c0d73d73", "patch": "@@ -2459,6 +2459,11 @@ pub fn build_session_options(matches: &getopts::Matches) -> Options {\n \n     let pretty = parse_pretty(&unstable_opts, error_format);\n \n+    // query-dep-graph is required if dump-dep-graph is given #106736\n+    if unstable_opts.dump_dep_graph && !unstable_opts.query_dep_graph {\n+        early_error(error_format, \"can't dump dependency graph without `-Z query-dep-graph`\");\n+    }\n+\n     // Try to find a directory containing the Rust `src`, for more details see\n     // the doc comment on the `real_rust_source_base_dir` field.\n     let tmp_buf;"}, {"sha": "cbc4def0e03aa8f19c32a981d7cfcd711bbe9bc5", "filename": "tests/ui/dep-graph/dep-graph-dump.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2c5583efbde7987c6de16cb057503f57c0d73d73/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c5583efbde7987c6de16cb057503f57c0d73d73/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.rs?ref=2c5583efbde7987c6de16cb057503f57c0d73d73", "patch": "@@ -0,0 +1,6 @@\n+// Test dump-dep-graph requires query-dep-graph enabled\n+\n+// incremental\n+// compile-flags: -Z dump-dep-graph\n+\n+fn main() {}"}, {"sha": "ea44b8bb07509e7e65a8660107bce094436dbbad", "filename": "tests/ui/dep-graph/dep-graph-dump.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2c5583efbde7987c6de16cb057503f57c0d73d73/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2c5583efbde7987c6de16cb057503f57c0d73d73/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdep-graph%2Fdep-graph-dump.stderr?ref=2c5583efbde7987c6de16cb057503f57c0d73d73", "patch": "@@ -0,0 +1,2 @@\n+error: can't dump dependency graph without `-Z query-dep-graph`\n+"}]}