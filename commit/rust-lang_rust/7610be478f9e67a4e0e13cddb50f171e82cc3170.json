{"sha": "7610be478f9e67a4e0e13cddb50f171e82cc3170", "node_id": "C_kwDOAAsO6NoAKDc2MTBiZTQ3OGY5ZTY3YTRlMGUxM2NkZGI1MGYxNzFlODJjYzMxNzA", "commit": {"author": {"name": "Afonso Bordado", "email": "afonsobordado@az8.co", "date": "2022-08-06T20:24:38Z"}, "committer": {"name": "Afonso Bordado", "email": "afonsobordado@az8.co", "date": "2022-08-06T20:24:38Z"}, "message": "Move abi-checker to y.rs test", "tree": {"sha": "d3ba892c1fd9a71ff4b52c162f354ff5d964beb1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d3ba892c1fd9a71ff4b52c162f354ff5d964beb1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7610be478f9e67a4e0e13cddb50f171e82cc3170", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7610be478f9e67a4e0e13cddb50f171e82cc3170", "html_url": "https://github.com/rust-lang/rust/commit/7610be478f9e67a4e0e13cddb50f171e82cc3170", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7610be478f9e67a4e0e13cddb50f171e82cc3170/comments", "author": {"login": "afonso360", "id": 1357143, "node_id": "MDQ6VXNlcjEzNTcxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1357143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/afonso360", "html_url": "https://github.com/afonso360", "followers_url": "https://api.github.com/users/afonso360/followers", "following_url": "https://api.github.com/users/afonso360/following{/other_user}", "gists_url": "https://api.github.com/users/afonso360/gists{/gist_id}", "starred_url": "https://api.github.com/users/afonso360/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/afonso360/subscriptions", "organizations_url": "https://api.github.com/users/afonso360/orgs", "repos_url": "https://api.github.com/users/afonso360/repos", "events_url": "https://api.github.com/users/afonso360/events{/privacy}", "received_events_url": "https://api.github.com/users/afonso360/received_events", "type": "User", "site_admin": false}, "committer": {"login": "afonso360", "id": 1357143, "node_id": "MDQ6VXNlcjEzNTcxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1357143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/afonso360", "html_url": "https://github.com/afonso360", "followers_url": "https://api.github.com/users/afonso360/followers", "following_url": "https://api.github.com/users/afonso360/following{/other_user}", "gists_url": "https://api.github.com/users/afonso360/gists{/gist_id}", "starred_url": "https://api.github.com/users/afonso360/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/afonso360/subscriptions", "organizations_url": "https://api.github.com/users/afonso360/orgs", "repos_url": "https://api.github.com/users/afonso360/repos", "events_url": "https://api.github.com/users/afonso360/events{/privacy}", "received_events_url": "https://api.github.com/users/afonso360/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5ba71a71b79525fdd649624af63fc8770f90835", "url": "https://api.github.com/repos/rust-lang/rust/commits/e5ba71a71b79525fdd649624af63fc8770f90835", "html_url": "https://github.com/rust-lang/rust/commit/e5ba71a71b79525fdd649624af63fc8770f90835"}], "stats": {"total": 35, "additions": 16, "deletions": 19}, "files": [{"sha": "e8897e9ae81454a01145a9b4343f66cafdb00565", "filename": ".github/workflows/main.yml", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7610be478f9e67a4e0e13cddb50f171e82cc3170/.github%2Fworkflows%2Fmain.yml", "raw_url": "https://github.com/rust-lang/rust/raw/7610be478f9e67a4e0e13cddb50f171e82cc3170/.github%2Fworkflows%2Fmain.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmain.yml?ref=7610be478f9e67a4e0e13cddb50f171e82cc3170", "patch": "@@ -105,11 +105,6 @@ jobs:\n \n         ./y.rs test\n \n-\n-    - name: Run abi-checker\n-      if: matrix.env.TARGET_TRIPLE == ''\n-      run: ./y.rs abi-checker\n-\n     - name: Package prebuilt cg_clif\n       run: tar cvfJ cg_clif.tar.xz build\n "}, {"sha": "b6dc0fa69223fac2d781d281118d71471b657575", "filename": "build_system/abi_checker.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7610be478f9e67a4e0e13cddb50f171e82cc3170/build_system%2Fabi_checker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7610be478f9e67a4e0e13cddb50f171e82cc3170/build_system%2Fabi_checker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fabi_checker.rs?ref=7610be478f9e67a4e0e13cddb50f171e82cc3170", "patch": "@@ -1,4 +1,5 @@\n use super::build_sysroot;\n+use super::config;\n use super::utils::spawn_and_wait_with_input;\n use build_system::SysrootKind;\n use std::env;\n@@ -13,10 +14,15 @@ pub(crate) fn run(\n     host_triple: &str,\n     target_triple: &str,\n ) {\n-    assert_eq!(\n-        host_triple, target_triple,\n-        \"abi-checker not supported on cross-compilation scenarios\"\n-    );\n+    if !config::get_bool(\"testsuite.abi-checker\") {\n+        eprintln!(\"[SKIP] abi-checker\");\n+        return;\n+    }\n+\n+    if host_triple != target_triple {\n+        eprintln!(\"[SKIP] abi-checker (cross-compilation not supported)\");\n+        return;\n+    }\n \n     eprintln!(\"Building sysroot for abi-checker\");\n     build_sysroot::build_sysroot("}, {"sha": "c3706dc6f82039cfee03fe18fdb7ef7c3f8c36d6", "filename": "build_system/mod.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7610be478f9e67a4e0e13cddb50f171e82cc3170/build_system%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7610be478f9e67a4e0e13cddb50f171e82cc3170/build_system%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fmod.rs?ref=7610be478f9e67a4e0e13cddb50f171e82cc3170", "patch": "@@ -22,9 +22,6 @@ fn usage() {\n     eprintln!(\n         \"  ./y.rs test [--debug] [--sysroot none|clif|llvm] [--target-dir DIR] [--no-unstable-features]\"\n     );\n-    eprintln!(\n-        \"  ./y.rs abi-checker [--debug] [--sysroot none|clif|llvm] [--target-dir DIR] [--no-unstable-features]\"\n-    );\n }\n \n macro_rules! arg_error {\n@@ -39,7 +36,6 @@ macro_rules! arg_error {\n enum Command {\n     Build,\n     Test,\n-    AbiChecker,\n }\n \n #[derive(Copy, Clone, Debug)]\n@@ -71,7 +67,6 @@ pub fn main() {\n         }\n         Some(\"build\") => Command::Build,\n         Some(\"test\") => Command::Test,\n-        Some(\"abi-checker\") => Command::AbiChecker,\n         Some(flag) if flag.starts_with('-') => arg_error!(\"Expected command found flag {}\", flag),\n         Some(command) => arg_error!(\"Unknown command {}\", command),\n         None => {\n@@ -147,9 +142,8 @@ pub fn main() {\n                 &host_triple,\n                 &target_triple,\n             );\n-        }\n-        Command::Build => {\n-            build_sysroot::build_sysroot(\n+\n+            abi_checker::run(\n                 channel,\n                 sysroot_kind,\n                 &target_dir,\n@@ -158,8 +152,8 @@ pub fn main() {\n                 &target_triple,\n             );\n         }\n-        Command::AbiChecker => {\n-            abi_checker::run(\n+        Command::Build => {\n+            build_sysroot::build_sysroot(\n                 channel,\n                 sysroot_kind,\n                 &target_dir,"}, {"sha": "2264d301d592003b27f679becdeb32e90d583023", "filename": "config.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7610be478f9e67a4e0e13cddb50f171e82cc3170/config.txt", "raw_url": "https://github.com/rust-lang/rust/raw/7610be478f9e67a4e0e13cddb50f171e82cc3170/config.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.txt?ref=7610be478f9e67a4e0e13cddb50f171e82cc3170", "patch": "@@ -48,3 +48,5 @@ test.libcore\n test.regex-shootout-regex-dna\n test.regex\n test.portable-simd\n+\n+testsuite.abi-checker"}]}