{"sha": "d9278f7ff65b3a4798348d2fc68278b25eaae864", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5Mjc4ZjdmZjY1YjNhNDc5ODM0OGQyZmM2ODI3OGIyNWVhYWU4NjQ=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-12-11T14:34:02Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-12-30T13:56:46Z"}, "message": "ci: make publish_toolstate.sh generic over the CI provider", "tree": {"sha": "c969ae3fafb2b4e8dc9c36d50a31a8be91a49fb1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c969ae3fafb2b4e8dc9c36d50a31a8be91a49fb1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d9278f7ff65b3a4798348d2fc68278b25eaae864", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl4KAh4ACgkQPgar6Auq\n8ZzHUg/9F4k3GN+awx3DoKkNsx4PksjT2Nwi6c/Ho7o1Ma5BX2Es/Fi9UUrkvx6Z\ndemwpUnkQVpOUH5i61iU5OP/He/PJrBAUH+KszsZ/BXLt/VDuogc2785OFu11imh\n0Ziqo/wpVAAXTGmdIqWdF5RR63UpmZvlKbxv67KvjFUEMgoFP33rXwf8+E4RgyBI\n/evJ8eVKx8mZ2Vp2AW1GqGhvQt9KMhiMrMbjaTmaImg3AKcmCy0Ad2C7lJGxW0/W\n35VNmrQ9k5W67rQMgOlyBxfF5ne/zeQalRhVHtXHunyzvh7RnyCXSkcZRU4Lylft\nPQ3PKv8p5HqGaxIqVgRHN26/JkiQ7fSCUQHcsLOyXJzvs/raLfDr2XgIKFYeKIgY\n8RsihO1OO02ZUnZUPJh9+vh/1TfhEjfTIM6iY1vOuZS0O2c7TmNGVmksQPt/ZaLT\n11RxVfinuyVMIFuN9B1g3lpfreGgefKPnJg1i6pxPOd8j6Oc+CwFLi58qR9rxG8T\n6AqbSXuDYwum0UKP4ayFrxA2K8o5T7eS4nMj6FhCR3+QFrA5PFdnBJYN0stDW0Qu\nzX1QcSPsQrfA3WNRizKsPph9MdM36TlJaFCLYG4M3NwKBmIqS3aJa31D8RbYEi0p\nHnlv3TMdXxRvbs4aOOw+6IkmraaM69dGlasbXUQqeWMD5zXt2t8=\n=DVXx\n-----END PGP SIGNATURE-----", "payload": "tree c969ae3fafb2b4e8dc9c36d50a31a8be91a49fb1\nparent 580ac0b4f1c6f9cf76f6edafdaf9806437770aff\nauthor Pietro Albini <pietro@pietroalbini.org> 1576074842 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1577714206 +0100\n\nci: make publish_toolstate.sh generic over the CI provider\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d9278f7ff65b3a4798348d2fc68278b25eaae864", "html_url": "https://github.com/rust-lang/rust/commit/d9278f7ff65b3a4798348d2fc68278b25eaae864", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d9278f7ff65b3a4798348d2fc68278b25eaae864/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "580ac0b4f1c6f9cf76f6edafdaf9806437770aff", "url": "https://api.github.com/repos/rust-lang/rust/commits/580ac0b4f1c6f9cf76f6edafdaf9806437770aff", "html_url": "https://github.com/rust-lang/rust/commit/580ac0b4f1c6f9cf76f6edafdaf9806437770aff"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "fb828477f98b76e6baaea12f6e911d3baeb5e3b8", "filename": "src/ci/publish_toolstate.sh", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d9278f7ff65b3a4798348d2fc68278b25eaae864/src%2Fci%2Fpublish_toolstate.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d9278f7ff65b3a4798348d2fc68278b25eaae864/src%2Fci%2Fpublish_toolstate.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpublish_toolstate.sh?ref=d9278f7ff65b3a4798348d2fc68278b25eaae864", "patch": "@@ -1,6 +1,9 @@\n-#!/bin/sh\n+#!/bin/bash\n \n-set -eu\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n \n # The following lines are also found in src/bootstrap/toolstate.rs,\n # so if updating here, please also update that file.\n@@ -21,7 +24,7 @@ cd rust-toolstate\n FAILURE=1\n for RETRY_COUNT in 1 2 3 4 5; do\n     #  The purpose is to publish the new \"current\" toolstate in the toolstate repo.\n-    \"$BUILD_SOURCESDIRECTORY/src/tools/publish_toolstate.py\" \"$GIT_COMMIT\" \\\n+    \"$(ciCheckoutPath)/src/tools/publish_toolstate.py\" \"$GIT_COMMIT\" \\\n         \"$GIT_COMMIT_MSG\" \\\n         \"$MESSAGE_FILE\" \\\n         \"$TOOLSTATE_REPO_ACCESS_TOKEN\""}]}