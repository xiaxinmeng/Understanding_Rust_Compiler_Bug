{"sha": "faa65d7856314d60e504ebd976a1162342d3b376", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhYTY1ZDc4NTYzMTRkNjBlNTA0ZWJkOTc2YTExNjIzNDJkM2IzNzY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-07T16:12:22Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-07T16:12:22Z"}, "message": ".", "tree": {"sha": "e4b282469e49f9d4de0e4b774103f2acba6cc190", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4b282469e49f9d4de0e4b774103f2acba6cc190"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/faa65d7856314d60e504ebd976a1162342d3b376", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/faa65d7856314d60e504ebd976a1162342d3b376", "html_url": "https://github.com/rust-lang/rust/commit/faa65d7856314d60e504ebd976a1162342d3b376", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/faa65d7856314d60e504ebd976a1162342d3b376/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "695f1a9af816e159ebe3ac7edb63ad81632192c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/695f1a9af816e159ebe3ac7edb63ad81632192c2", "html_url": "https://github.com/rust-lang/rust/commit/695f1a9af816e159ebe3ac7edb63ad81632192c2"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "f447613d4306b7c9f1ec896e7ffd4f0753eb8050", "filename": "xtask/src/main.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/faa65d7856314d60e504ebd976a1162342d3b376/xtask%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/faa65d7856314d60e504ebd976a1162342d3b376/xtask%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmain.rs?ref=faa65d7856314d60e504ebd976a1162342d3b376", "patch": "@@ -17,7 +17,7 @@ use xtask::{\n     install::{ClientOpt, InstallCmd, ServerOpt},\n     not_bash::pushd,\n     pre_commit, project_root,\n-    release::ReleaseCmd,\n+    release::{PromoteCmd, ReleaseCmd},\n     run_clippy, run_fuzzer, run_pre_cache, run_rustfmt, Result,\n };\n \n@@ -105,6 +105,11 @@ FLAGS:\n             args.finish()?;\n             ReleaseCmd { dry_run }.run()\n         }\n+        \"promote\" => {\n+            let dry_run = args.contains(\"--dry-run\");\n+            args.finish()?;\n+            PromoteCmd { dry_run }.run()\n+        }\n         \"dist\" => {\n             let nightly = args.contains(\"--nightly\");\n             let client_version: Option<String> = args.opt_value_from_str(\"--client\")?;"}, {"sha": "d2d769099d655bc8998c4dae4f090dc8136cb676", "filename": "xtask/src/release.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/faa65d7856314d60e504ebd976a1162342d3b376/xtask%2Fsrc%2Frelease.rs", "raw_url": "https://github.com/rust-lang/rust/raw/faa65d7856314d60e504ebd976a1162342d3b376/xtask%2Fsrc%2Frelease.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Frelease.rs?ref=faa65d7856314d60e504ebd976a1162342d3b376", "patch": "@@ -69,3 +69,16 @@ Release: release:{}[]\n         Ok(())\n     }\n }\n+\n+pub struct PromoteCmd {\n+    pub dry_run: bool,\n+}\n+\n+impl PromoteCmd {\n+    pub fn run(self) -> Result<()> {\n+        run!(\"git switch release\")?;\n+        run!(\"git fetch upstream\")?;\n+        run!(\"git reset --hard upstream/release\")?;\n+        Ok(())\n+    }\n+}"}]}