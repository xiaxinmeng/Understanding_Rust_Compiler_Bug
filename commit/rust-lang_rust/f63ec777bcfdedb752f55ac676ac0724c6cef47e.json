{"sha": "f63ec777bcfdedb752f55ac676ac0724c6cef47e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2M2VjNzc3YmNmZGVkYjc1MmY1NWFjNjc2YWMwNzI0YzZjZWY0N2U=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-25T01:47:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-25T01:47:43Z"}, "message": "Auto merge of #87331 - camelid:summary-escaping, r=GuillaumeGomez\n\nEscape item search summaries\n\nI noticed that `Pin::new()`'s search summary looked off, and I realized\nthat the reason is that it has inline code containing `Pin<P>`, which is\nnot escaped and thus renders as a paragraph tag!", "tree": {"sha": "cff4fefd9e1d5e25d36bedc33f06e1876d303ba2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cff4fefd9e1d5e25d36bedc33f06e1876d303ba2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f63ec777bcfdedb752f55ac676ac0724c6cef47e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f63ec777bcfdedb752f55ac676ac0724c6cef47e", "html_url": "https://github.com/rust-lang/rust/commit/f63ec777bcfdedb752f55ac676ac0724c6cef47e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f63ec777bcfdedb752f55ac676ac0724c6cef47e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b4196e97736ffe75433235bf586989cdb4221c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b4196e97736ffe75433235bf586989cdb4221c4", "html_url": "https://github.com/rust-lang/rust/commit/2b4196e97736ffe75433235bf586989cdb4221c4"}, {"sha": "4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9", "html_url": "https://github.com/rust-lang/rust/commit/4ad2d68602a3d75532c4d30bd72c5f5a784d5dd9"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "783b8b2db46a10be5619ca8b660331d85e2b9ab0", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f63ec777bcfdedb752f55ac676ac0724c6cef47e/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f63ec777bcfdedb752f55ac676ac0724c6cef47e/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=f63ec777bcfdedb752f55ac676ac0724c6cef47e", "patch": "@@ -34,15 +34,14 @@ use std::str;\n use crate::clean::RenderedLink;\n use crate::doctest;\n use crate::html::escape::Escape;\n+use crate::html::format::Buffer;\n use crate::html::highlight;\n use crate::html::toc::TocBuilder;\n \n use pulldown_cmark::{\n     html, BrokenLink, CodeBlockKind, CowStr, Event, LinkType, Options, Parser, Tag,\n };\n \n-use super::format::Buffer;\n-\n #[cfg(test)]\n mod tests;\n \n@@ -1086,7 +1085,7 @@ fn markdown_summary_with_limit(\n     let mut stopped_early = false;\n \n     fn push(s: &mut String, text_length: &mut usize, text: &str) {\n-        s.push_str(text);\n+        write!(s, \"{}\", Escape(text)).unwrap();\n         *text_length += text.len();\n     }\n "}, {"sha": "1e4bdc2d15199525b173ed084984cfcc50ff04e2", "filename": "src/librustdoc/html/markdown/tests.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f63ec777bcfdedb752f55ac676ac0724c6cef47e/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f63ec777bcfdedb752f55ac676ac0724c6cef47e/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs?ref=f63ec777bcfdedb752f55ac676ac0724c6cef47e", "patch": "@@ -234,7 +234,17 @@ fn test_short_markdown_summary() {\n     t(\"hello [Rust](https://www.rust-lang.org \\\"Rust\\\") :)\", \"hello Rust :)\");\n     t(\"dud [link]\", \"dud [link]\");\n     t(\"code `let x = i32;` ...\", \"code <code>let x = i32;</code> \u2026\");\n-    t(\"type `Type<'static>` ...\", \"type <code>Type<'static></code> \u2026\");\n+    t(\"type `Type<'static>` ...\", \"type <code>Type&lt;&#39;static&gt;</code> \u2026\");\n+    // Test to ensure escaping and length-limiting work well together.\n+    // The output should be limited based on the input length,\n+    // rather than the output, because escaped versions of characters\n+    // are usually longer than how the character is actually displayed.\n+    t(\n+        \"& & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & & &\",\n+        \"&amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \\\n+         &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \\\n+         &amp; &amp; &amp; &amp; &amp; \u2026\",\n+    );\n     t(\"# top header\", \"top header\");\n     t(\"# top header\\n\\nfollowed by a paragraph\", \"top header\");\n     t(\"## header\", \"header\");"}]}