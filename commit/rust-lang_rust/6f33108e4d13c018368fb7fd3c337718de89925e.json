{"sha": "6f33108e4d13c018368fb7fd3c337718de89925e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmMzMxMDhlNGQxM2MwMTgzNjhmYjdmZDNjMzM3NzE4ZGU4OTkyNWU=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2017-10-16T19:57:37Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2017-10-16T20:10:16Z"}, "message": "bootstrap: update and enable the LLVM version-check\n\nWhile the `config.toml.example` comments say \"we automatically check the\nversion by default,\" we actually didn't.  That check was badly out of\ndate, only allowing 3.5, 3.6, or 3.7.  This it now updated to the new\n3.9 minimum requirement, and truly enabled by default.", "tree": {"sha": "505427b3f941d3980b989632dee0a3c0d41f414d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/505427b3f941d3980b989632dee0a3c0d41f414d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f33108e4d13c018368fb7fd3c337718de89925e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f33108e4d13c018368fb7fd3c337718de89925e", "html_url": "https://github.com/rust-lang/rust/commit/6f33108e4d13c018368fb7fd3c337718de89925e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f33108e4d13c018368fb7fd3c337718de89925e/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7538a9b8afc42abfdc01afb4481a63dc3840f2ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/7538a9b8afc42abfdc01afb4481a63dc3840f2ee", "html_url": "https://github.com/rust-lang/rust/commit/7538a9b8afc42abfdc01afb4481a63dc3840f2ee"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "261fe2053879f004fd2ffeecc23d49c43ceb8467", "filename": "config.toml.example", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6f33108e4d13c018368fb7fd3c337718de89925e/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/6f33108e4d13c018368fb7fd3c337718de89925e/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=6f33108e4d13c018368fb7fd3c337718de89925e", "patch": "@@ -35,7 +35,7 @@\n # If an external LLVM root is specified, we automatically check the version by\n # default to make sure it's within the range that we're expecting, but setting\n # this flag will indicate that this version check should not be done.\n-#version-check = false\n+#version-check = true\n \n # Link libstdc++ statically into the librustc_llvm instead of relying on a\n # dynamic version to be available."}, {"sha": "d6c83e3acfc8ab3d844535644e4310aab3bb950b", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6f33108e4d13c018368fb7fd3c337718de89925e/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f33108e4d13c018368fb7fd3c337718de89925e/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=6f33108e4d13c018368fb7fd3c337718de89925e", "patch": "@@ -299,6 +299,7 @@ impl Config {\n         let mut config = Config::default();\n         config.llvm_enabled = true;\n         config.llvm_optimize = true;\n+        config.llvm_version_check = true;\n         config.use_jemalloc = true;\n         config.backtrace = true;\n         config.rust_optimize = true;"}, {"sha": "c37b1dad4c687cd9698543861ec74433206c3ab0", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6f33108e4d13c018368fb7fd3c337718de89925e/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f33108e4d13c018368fb7fd3c337718de89925e/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=6f33108e4d13c018368fb7fd3c337718de89925e", "patch": "@@ -259,11 +259,14 @@ fn check_llvm_version(build: &Build, llvm_config: &Path) {\n \n     let mut cmd = Command::new(llvm_config);\n     let version = output(cmd.arg(\"--version\"));\n-    if version.starts_with(\"3.5\") || version.starts_with(\"3.6\") ||\n-       version.starts_with(\"3.7\") {\n-        return\n+    let mut parts = version.split('.').take(2)\n+        .filter_map(|s| s.parse::<u32>().ok());\n+    if let (Some(major), Some(minor)) = (parts.next(), parts.next()) {\n+        if major > 3 || (major == 3 && minor >= 9) {\n+            return\n+        }\n     }\n-    panic!(\"\\n\\nbad LLVM version: {}, need >=3.5\\n\\n\", version)\n+    panic!(\"\\n\\nbad LLVM version: {}, need >=3.9\\n\\n\", version)\n }\n \n #[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]"}]}