{"sha": "eb5f146f1492cce356883905865f4bb9fc97d8ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViNWYxNDZmMTQ5MmNjZTM1Njg4MzkwNTg2NWY0YmI5ZmM5N2Q4YmE=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-01T20:33:20Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-01T20:34:52Z"}, "message": "Fix 'impossible case reached' ICE", "tree": {"sha": "9876805fadffae7cd58ef67320671bc9bf9eb874", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9876805fadffae7cd58ef67320671bc9bf9eb874"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb5f146f1492cce356883905865f4bb9fc97d8ba", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAluyhOwACgkQtvoGpuDi\nZlu4Lg//arh7tDYRIuApRoOo4GiRtugTbzWK6FpTI4JmbZsG4SuU0KvlrBGvN/pl\n5ILMSLpuDqmvDWGw9fMSHRFJT7CdYaoZWiWT87jqXjSPLNAD9b/x2g6R6PNiniOd\nNTwWCOx6qamPE1WOyuWrQl1yvRd+CBkzU/HdOvYsq0aqiDqHXbtGPCDl1L6ROBfO\nJY8hQTLphcOTUc5RlRTTgsRi/1RQdDbBeB9pKG4ribNzYgpO3VZHfk/omwZFE/PC\nZ3eyoL78oVB4J7EISy/dv+1TaVPh3N1XqUoqhmYlFG4/1Tmgfb0nFYs4lrkvQ1LS\nExamoidjViMGpCMvo4eifYWERgIg9HrYLsVKnYN3AWZhzJEqzNaqh0qzOw45JlLo\nzNXA0DEDiK7RscPlGVCFjLNyYCpn+BviCE2gKqELZYeq5nzbzKhfXHcgAPwoo7/8\noJ6gIq/OMTXDODjq7dMgQnpHdqZQp7DzhkJzLaFaGM8tp7M8vsC/bLQGvV9Yye0Y\nLDYhIXECaOrOWrmdvetHMuwJFf5JXDo0gkjYN3nNP6RBrrU3dIWFMih7Efovsg8x\n4EGkul8IAft+x+5k6oi7robBomw9U748trORADKS+XGQp+sjVWGI/IB8KawYqTPx\nYicCLFrsjNziwTxF83lz6QkjWxm7pYs8lIenZ7BETxd9+vMcSPo=\n=yIel\n-----END PGP SIGNATURE-----", "payload": "tree 9876805fadffae7cd58ef67320671bc9bf9eb874\nparent 5f9af5f69c81367e32deae49e5c200826bab0954\nauthor Philipp Hansch <dev@phansch.net> 1538426000 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1538426092 +0200\n\nFix 'impossible case reached' ICE\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb5f146f1492cce356883905865f4bb9fc97d8ba", "html_url": "https://github.com/rust-lang/rust/commit/eb5f146f1492cce356883905865f4bb9fc97d8ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb5f146f1492cce356883905865f4bb9fc97d8ba/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f9af5f69c81367e32deae49e5c200826bab0954", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f9af5f69c81367e32deae49e5c200826bab0954", "html_url": "https://github.com/rust-lang/rust/commit/5f9af5f69c81367e32deae49e5c200826bab0954"}], "stats": {"total": 33, "additions": 27, "deletions": 6}, "files": [{"sha": "73d59d7a33c91a1bce044449a0fb46c6b07931f4", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/eb5f146f1492cce356883905865f4bb9fc97d8ba/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb5f146f1492cce356883905865f4bb9fc97d8ba/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=eb5f146f1492cce356883905865f4bb9fc97d8ba", "patch": "@@ -174,15 +174,14 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n                 (\n                     preds.iter().any(|t| t.def_id() == borrow_trait),\n                     !preds.is_empty() && preds.iter().all(|t| {\n+                        let ty_params = &t.skip_binder().trait_ref.substs.iter().skip(1)\n+                            .cloned()\n+                            .collect::<Vec<_>>();\n                         implements_trait(\n                             cx,\n                             cx.tcx.mk_imm_ref(&RegionKind::ReErased, ty),\n                             t.def_id(),\n-                            &t.skip_binder()\n-                                .input_types()\n-                                .skip(1)\n-                                .map(|ty| ty.into())\n-                                .collect::<Vec<_>>(),\n+                            ty_params\n                         )\n                     }),\n                 )"}, {"sha": "31ad96942d66e9820d53bb4d9957d013d9ffb6c7", "filename": "tests/ui/needless_pass_by_value.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/eb5f146f1492cce356883905865f4bb9fc97d8ba/tests%2Fui%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb5f146f1492cce356883905865f4bb9fc97d8ba/tests%2Fui%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_pass_by_value.rs?ref=eb5f146f1492cce356883905865f4bb9fc97d8ba", "patch": "@@ -134,4 +134,14 @@ fn test_destructure_copy(x: CopyWrapper, y: CopyWrapper, z: CopyWrapper) {\n     println!(\"{}\", t);\n }\n \n+// The following 3 lines should not cause an ICE. See #2831\n+trait Bar<'a, A> {}\n+impl<'b, T> Bar<'b, T> for T {}\n+fn some_fun<'b, S: Bar<'b, ()>>(_item: S) {}\n+\n+// Also this should not cause an ICE. See #2831\n+trait Club<'a, A> {}\n+impl<T> Club<'static, T> for T {}\n+fn more_fun(_item: impl Club<'static, i32>) {}\n+\n fn main() {}"}, {"sha": "0d4a35363fba7db78604980ea8efcb2872ad01ed", "filename": "tests/ui/needless_pass_by_value.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/eb5f146f1492cce356883905865f4bb9fc97d8ba/tests%2Fui%2Fneedless_pass_by_value.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb5f146f1492cce356883905865f4bb9fc97d8ba/tests%2Fui%2Fneedless_pass_by_value.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_pass_by_value.stderr?ref=eb5f146f1492cce356883905865f4bb9fc97d8ba", "patch": "@@ -184,5 +184,17 @@ help: consider taking a reference instead\n 129 |     let CopyWrapper(s) = *z; // moved\n     |\n \n-error: aborting due to 20 previous errors\n+error: this argument is passed by value, but not consumed in the function body\n+   --> $DIR/needless_pass_by_value.rs:140:40\n+    |\n+140 | fn some_fun<'b, S: Bar<'b, ()>>(_item: S) {}\n+    |                                        ^ help: consider taking a reference instead: `&S`\n+\n+error: this argument is passed by value, but not consumed in the function body\n+   --> $DIR/needless_pass_by_value.rs:145:20\n+    |\n+145 | fn more_fun(_item: impl Club<'static, i32>) {}\n+    |                    ^^^^^^^^^^^^^^^^^^^^^^^ help: consider taking a reference instead: `&impl Club<'static, i32>`\n+\n+error: aborting due to 22 previous errors\n "}]}