{"sha": "150765d755fdfcab5d6f2949be7ad9df37e36e86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1MDc2NWQ3NTVmZGZjYWI1ZDZmMjk0OWJlN2FkOWRmMzdlMzZlODY=", "commit": {"author": {"name": "csmoe", "email": "35686186+csmoe@users.noreply.github.com", "date": "2018-05-21T04:18:06Z"}, "committer": {"name": "csmoe", "email": "35686186+csmoe@users.noreply.github.com", "date": "2018-05-21T05:30:07Z"}, "message": "format label break", "tree": {"sha": "74379ec1150988460829b7f36612420b8e06a66d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/74379ec1150988460829b7f36612420b8e06a66d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/150765d755fdfcab5d6f2949be7ad9df37e36e86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/150765d755fdfcab5d6f2949be7ad9df37e36e86", "html_url": "https://github.com/rust-lang/rust/commit/150765d755fdfcab5d6f2949be7ad9df37e36e86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/150765d755fdfcab5d6f2949be7ad9df37e36e86/comments", "author": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "committer": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26586d9de80ceab49b13c4430a940f4837639eba", "url": "https://api.github.com/repos/rust-lang/rust/commits/26586d9de80ceab49b13c4430a940f4837639eba", "html_url": "https://github.com/rust-lang/rust/commit/26586d9de80ceab49b13c4430a940f4837639eba"}], "stats": {"total": 39, "additions": 36, "deletions": 3}, "files": [{"sha": "f1cfe8b4c4c59a3a7b7dd80ba81269e558f9855e", "filename": "src/expr.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/150765d755fdfcab5d6f2949be7ad9df37e36e86/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/150765d755fdfcab5d6f2949be7ad9df37e36e86/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=150765d755fdfcab5d6f2949be7ad9df37e36e86", "patch": "@@ -118,8 +118,7 @@ pub fn format_expr(\n         | ast::ExprKind::While(..)\n         | ast::ExprKind::WhileLet(..) => to_control_flow(expr, expr_type)\n             .and_then(|control_flow| control_flow.rewrite(context, shape)),\n-        // FIXME(topecongiro): Handle label on a block (#2722).\n-        ast::ExprKind::Block(ref block, _) => {\n+        ast::ExprKind::Block(ref block, opt_label) => {\n             match expr_type {\n                 ExprType::Statement => {\n                     if is_unsafe_block(block) {\n@@ -131,9 +130,11 @@ pub fn format_expr(\n                         rw\n                     } else {\n                         let prefix = block_prefix(context, block, shape)?;\n+                        let label_string = rewrite_label(opt_label);\n+\n                         rewrite_block_with_visitor(\n                             context,\n-                            &prefix,\n+                            &format!(\"{}{}\", &prefix, &label_string),\n                             block,\n                             Some(&expr.attrs),\n                             shape,"}, {"sha": "d1e34bce4d40382896a837aa24131ddf385c8e62", "filename": "tests/source/label_break.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/150765d755fdfcab5d6f2949be7ad9df37e36e86/tests%2Fsource%2Flabel_break.rs", "raw_url": "https://github.com/rust-lang/rust/raw/150765d755fdfcab5d6f2949be7ad9df37e36e86/tests%2Fsource%2Flabel_break.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Flabel_break.rs?ref=150765d755fdfcab5d6f2949be7ad9df37e36e86", "patch": "@@ -0,0 +1,16 @@\n+// format with label break value.\n+fn main() {\n+\n+'empty_block: {}\n+\n+let result = 'block: {\n+    if foo() {\n+        // comment\n+        break 'block 1;\n+    }\n+    if bar() { /* comment */\n+        break 'block      2;\n+    }\n+    3\n+};\n+}\n\\ No newline at end of file"}, {"sha": "2e05159de3989e827b34818ffc4377aa6fe45b5b", "filename": "tests/target/label_break.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/150765d755fdfcab5d6f2949be7ad9df37e36e86/tests%2Ftarget%2Flabel_break.rs", "raw_url": "https://github.com/rust-lang/rust/raw/150765d755fdfcab5d6f2949be7ad9df37e36e86/tests%2Ftarget%2Flabel_break.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Flabel_break.rs?ref=150765d755fdfcab5d6f2949be7ad9df37e36e86", "patch": "@@ -0,0 +1,16 @@\n+// format with label break value.\n+fn main() {\n+    {}\n+\n+    let result = {\n+        if foo() {\n+            // comment\n+            break 'block 1;\n+        }\n+        if bar() {\n+            /* comment */\n+            break 'block 2;\n+        }\n+        3\n+    };\n+}"}]}