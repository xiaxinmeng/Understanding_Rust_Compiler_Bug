{"sha": "17d17420285b312ea75faddad79d8552e685c85e", "node_id": "C_kwDOAAsO6NoAKDE3ZDE3NDIwMjg1YjMxMmVhNzVmYWRkYWQ3OWQ4NTUyZTY4NWM4NWU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-10-27T16:25:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-27T16:25:44Z"}, "message": "Rollup merge of #90267 - EliseZeroTwo:elisezerotwo/fix_invalid_attrs_ice, r=Aaron1011\n\nfix: inner attribute followed by outer attribute causing ICE\n\nFixes #87936, #88938, and #89971.\n\nThis removes the assertion that validates that there are no outer attributes following inner attributes. Where the inner attribute is invalid you get an actual error.", "tree": {"sha": "4704e4f7249defb9f4045366ad8d79ad50920bc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4704e4f7249defb9f4045366ad8d79ad50920bc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17d17420285b312ea75faddad79d8552e685c85e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJheX2ICRBK7hj4Ov3rIwAAIiAIAJX5kvwJiYavzZGcEu5XTx4+\nkrpOw0AkCWpiOOIsZNel4kwjguihas6iqXVmzLc6KJFUdrzD0B6NoFBEBj5Jndkh\noie/FaA0aV+dVbcnF0zRs7wMEHtF2T9xWL2Z8ODV84c3TsPyNVwCLM4bzOKgVol8\neIgijN5P0cMD4JYLO2cKIlKPrl5RJJojqGp4Y/HLdQp/QX2d/Z107QUIxE0+4yah\nU/qxifPcXGvBAVpvAjsjuL9kALFVraX3KeyD4XDtfw3HjH4P/XdDt7Y76RxkNRpg\nq1exCVAgTxDhPdOshGgBbNf7xUb3ZzyiLqBwT1unZGYZDX/OX6MwbewBzmvbGjQ=\n=lxC9\n-----END PGP SIGNATURE-----\n", "payload": "tree 4704e4f7249defb9f4045366ad8d79ad50920bc5\nparent 088dc91e0a8cda39c9525d275a55046427c33485\nparent 7f0d43a003a70ce4cc12d8239e379feb5e5e48f8\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1635351944 +0200\ncommitter GitHub <noreply@github.com> 1635351944 +0200\n\nRollup merge of #90267 - EliseZeroTwo:elisezerotwo/fix_invalid_attrs_ice, r=Aaron1011\n\nfix: inner attribute followed by outer attribute causing ICE\n\nFixes #87936, #88938, and #89971.\n\nThis removes the assertion that validates that there are no outer attributes following inner attributes. Where the inner attribute is invalid you get an actual error.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17d17420285b312ea75faddad79d8552e685c85e", "html_url": "https://github.com/rust-lang/rust/commit/17d17420285b312ea75faddad79d8552e685c85e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17d17420285b312ea75faddad79d8552e685c85e/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "088dc91e0a8cda39c9525d275a55046427c33485", "url": "https://api.github.com/repos/rust-lang/rust/commits/088dc91e0a8cda39c9525d275a55046427c33485", "html_url": "https://github.com/rust-lang/rust/commit/088dc91e0a8cda39c9525d275a55046427c33485"}, {"sha": "7f0d43a003a70ce4cc12d8239e379feb5e5e48f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f0d43a003a70ce4cc12d8239e379feb5e5e48f8", "html_url": "https://github.com/rust-lang/rust/commit/7f0d43a003a70ce4cc12d8239e379feb5e5e48f8"}], "stats": {"total": 52, "additions": 46, "deletions": 6}, "files": [{"sha": "51cabb50cd3de7280a1ddfd8cff2caaeabb1e3c6", "filename": "compiler/rustc_ast/src/tokenstream.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/17d17420285b312ea75faddad79d8552e685c85e/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d17420285b312ea75faddad79d8552e685c85e/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs?ref=17d17420285b312ea75faddad79d8552e685c85e", "patch": "@@ -221,12 +221,6 @@ impl AttrAnnotatedTokenStream {\n                     for attr in &data.attrs {\n                         match attr.style {\n                             crate::AttrStyle::Outer => {\n-                                assert!(\n-                                    inner_attrs.len() == 0,\n-                                    \"Found outer attribute {:?} after inner attrs {:?}\",\n-                                    attr,\n-                                    inner_attrs\n-                                );\n                                 outer_attrs.push(attr);\n                             }\n                             crate::AttrStyle::Inner => {"}, {"sha": "e5604b816b5e9ad81d1797ff2bfc8da3175888ac", "filename": "src/test/ui/parser/auxiliary/issue-89971-outer-attr-following-inner-attr-ice.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fauxiliary%2Fissue-89971-outer-attr-following-inner-attr-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fauxiliary%2Fissue-89971-outer-attr-following-inner-attr-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fauxiliary%2Fissue-89971-outer-attr-following-inner-attr-ice.rs?ref=17d17420285b312ea75faddad79d8552e685c85e", "patch": "@@ -0,0 +1,13 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_derive(ICE)]\n+pub fn derive(_: TokenStream) -> TokenStream {\n+    r#\"#[allow(missing_docs)] struct X { }\"#.parse().unwrap()\n+}"}, {"sha": "fe67d9822fc9ca7d80b748378282d1627d4e5669", "filename": "src/test/ui/parser/issue-89971-outer-attr-following-inner-attr-ice.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.rs?ref=17d17420285b312ea75faddad79d8552e685c85e", "patch": "@@ -0,0 +1,15 @@\n+// aux-build:issue-89971-outer-attr-following-inner-attr-ice.rs\n+\n+#[macro_use]\n+extern crate issue_89971_outer_attr_following_inner_attr_ice;\n+\n+fn main() {\n+    Mew();\n+    X {};\n+}\n+\n+#![deny(missing_docs)]\n+//~^ ERROR an inner attribute is not permitted in this context\n+#[derive(ICE)]\n+#[deny(missing_docs)]\n+struct Mew();"}, {"sha": "34a6ab00d7b2dbfe66e11b88caca7ea5b3515204", "filename": "src/test/ui/parser/issue-89971-outer-attr-following-inner-attr-ice.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/17d17420285b312ea75faddad79d8552e685c85e/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-89971-outer-attr-following-inner-attr-ice.stderr?ref=17d17420285b312ea75faddad79d8552e685c85e", "patch": "@@ -0,0 +1,18 @@\n+error: an inner attribute is not permitted in this context\n+  --> $DIR/issue-89971-outer-attr-following-inner-attr-ice.rs:11:1\n+   |\n+LL | #![deny(missing_docs)]\n+   | ^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL | struct Mew();\n+   | ------------- the inner attribute doesn't annotate this struct\n+   |\n+   = note: inner attributes, like `#![no_std]`, annotate the item enclosing them, and are usually found at the beginning of source files\n+help: to annotate the struct, change the attribute from inner to outer style\n+   |\n+LL - #![deny(missing_docs)]\n+LL + #[deny(missing_docs)]\n+   | \n+\n+error: aborting due to previous error\n+"}]}