{"sha": "b1fcba6024adeb290e17e48be8184722dacf9261", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxZmNiYTYwMjRhZGViMjkwZTE3ZTQ4YmU4MTg0NzIyZGFjZjkyNjE=", "commit": {"author": {"name": "Corey Richardson", "email": "corey@octayn.net", "date": "2013-12-16T14:14:37Z"}, "committer": {"name": "Corey Richardson", "email": "corey@octayn.net", "date": "2013-12-16T15:17:08Z"}, "message": "Update and un-xfail auto-encode test\n\nCloses #6122", "tree": {"sha": "26a486ccc8ef0049607c24e200b36267924fbb85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26a486ccc8ef0049607c24e200b36267924fbb85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1fcba6024adeb290e17e48be8184722dacf9261", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1fcba6024adeb290e17e48be8184722dacf9261", "html_url": "https://github.com/rust-lang/rust/commit/b1fcba6024adeb290e17e48be8184722dacf9261", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1fcba6024adeb290e17e48be8184722dacf9261/comments", "author": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "committer": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b424974531b0ade62e6a26cce038abf5dac0723", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b424974531b0ade62e6a26cce038abf5dac0723", "html_url": "https://github.com/rust-lang/rust/commit/7b424974531b0ade62e6a26cce038abf5dac0723"}], "stats": {"total": 76, "additions": 34, "deletions": 42}, "files": [{"sha": "86af60e736000b02318e171129c6a300df2ff2fe", "filename": "src/test/run-pass/auto-encode.rs", "status": "modified", "additions": 34, "deletions": 42, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/b1fcba6024adeb290e17e48be8184722dacf9261/src%2Ftest%2Frun-pass%2Fauto-encode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1fcba6024adeb290e17e48be8184722dacf9261/src%2Ftest%2Frun-pass%2Fauto-encode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fauto-encode.rs?ref=b1fcba6024adeb290e17e48be8184722dacf9261", "patch": "@@ -1,6 +1,6 @@\n // xfail-fast\n \n-// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -10,14 +10,15 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// xfail-test #6122\n+#[feature(managed_boxes)];\n \n extern mod extra;\n \n // These tests used to be separate files, but I wanted to refactor all\n // the common code.\n \n use std::hashmap::{HashMap, HashSet};\n+use std::io::Decorator;\n \n use EBReader = extra::ebml::reader;\n use EBWriter = extra::ebml::writer;\n@@ -32,17 +33,14 @@ fn test_ebml<A:\n     Encodable<EBWriter::Encoder> +\n     Decodable<EBReader::Decoder>\n >(a1: &A) {\n-    let bytes = do io::with_bytes_writer |wr| {\n-        let mut ebml_w = EBWriter::Encoder(wr);\n-        a1.encode(&mut ebml_w)\n-    };\n+    let mut wr = @mut std::io::mem::MemWriter::new();\n+    let mut ebml_w = EBWriter::Encoder(wr);\n+    a1.encode(&mut ebml_w);\n+    let bytes = wr.inner_ref().to_owned();\n+\n     let d = EBReader::Doc(@bytes);\n     let mut decoder = EBReader::Decoder(d);\n     let a2: A = Decodable::decode(&mut decoder);\n-    if !(*a1 == a2) {\n-        ::std::sys::FailWithCause::fail_with(~\"explicit failure\" + \"foo\",\n-                                             \"auto-encode.rs\", 43u);\n-    }\n     assert!(*a1 == a2);\n }\n \n@@ -139,47 +137,41 @@ pub fn main() {\n     let a = &Plus(@Minus(@Val(3u), @Val(10u)), @Plus(@Val(22u), @Val(5u)));\n     test_ebml(a);\n \n-//    let a = &Spanned {lo: 0u, hi: 5u, node: 22u};\n-//    test_ebml(a);\n+    let a = &Spanned {lo: 0u, hi: 5u, node: 22u};\n+    test_ebml(a);\n \n-//    let a = &Point {x: 3u, y: 5u};\n-//    test_ebml(a);\n-//\n-//    let a = &@[1u, 2u, 3u];\n-//    test_ebml(a);\n-//\n-//    let a = &Top(22u);\n-//    test_ebml(a);\n-//\n-//    let a = &Bottom(222u);\n-//    test_ebml(a);\n-//\n-//    let a = &A;\n-//    test_ebml(a);\n-//\n-//    let a = &B;\n-//    test_ebml(a);\n+    let a = &Point {x: 3u, y: 5u};\n+    test_ebml(a);\n+\n+    let a = &@[1u, 2u, 3u];\n+    test_ebml(a);\n+\n+    let a = &Top(22u);\n+    test_ebml(a);\n+\n+    let a = &Bottom(222u);\n+    test_ebml(a);\n+\n+    let a = &A;\n+    test_ebml(a);\n+\n+    let a = &B;\n+    test_ebml(a);\n \n-    println(\"Hi1\");\n     let a = &time::now();\n     test_ebml(a);\n \n-    println(\"Hi2\");\n-//    test_ebml(&1.0f32);\n-//    test_ebml(&1.0f64);\n-    test_ebml(&1.0f);\n-//    println(\"Hi3\");\n-//    test_ebml(&'a');\n+    test_ebml(&1.0f32);\n+    test_ebml(&1.0f64);\n+    test_ebml(&'a');\n \n-    println(\"Hi4\");\n     let mut a = HashMap::new();\n     test_ebml(&a);\n     a.insert(1, 2);\n-    println(\"Hi4\");\n     test_ebml(&a);\n \n-//    let mut a = HashSet::new();\n-//    test_ebml(&a);\n-//    a.insert(1);\n-//    test_ebml(&a);\n+    let mut a = HashSet::new();\n+    test_ebml(&a);\n+    a.insert(1);\n+    test_ebml(&a);\n }"}]}