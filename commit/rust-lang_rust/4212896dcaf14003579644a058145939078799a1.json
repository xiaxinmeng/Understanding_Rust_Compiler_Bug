{"sha": "4212896dcaf14003579644a058145939078799a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyMTI4OTZkY2FmMTQwMDM1Nzk2NDRhMDU4MTQ1OTM5MDc4Nzk5YTE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-26T10:24:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-26T10:24:57Z"}, "message": "Rollup merge of #54921 - GuillaumeGomez:line-numbers, r=QuietMisdreavus\n\nAdd line numbers option to rustdoc\n\nFixes #22878.\n\nr? @QuietMisdreavus", "tree": {"sha": "1e2b848f65806465332af12873b5ed4ac2d7e69f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e2b848f65806465332af12873b5ed4ac2d7e69f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4212896dcaf14003579644a058145939078799a1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb0ut5CRBK7hj4Ov3rIwAAdHIIADh0mjb7y7BjN8N4MTtpB82Y\nS7IgaKB0zBxgb4DDqN087vq7LIim9VYfx1NCwejCRw2JVopgFZ0idvdXblASRJG0\ngv/Sa+2OytZjmnezkiCfjyqd0sl2uh2WYmL/4Kz/6ffwU3JeHo6SMkAR7/IsdFnK\n7yp9Rts/DGTN9W6eEjzTuFFuliYH5IbwTikg7NIryEQczRKXPcbBb4VujLssFy1C\nv8vUXmH70rZardlTB9LY1u2pemz36NYcRFxEx6lDC0LY1fcrtZSh55dKhTcgBBSd\ngU9uXCzQHKIm+sLneAZCOkJpjmYk2ZF31J9jsX+BiMgH6oKuyCOFF+arvWzSEnw=\n=I96A\n-----END PGP SIGNATURE-----\n", "payload": "tree 1e2b848f65806465332af12873b5ed4ac2d7e69f\nparent a57ce63a91013b0a212120776769d8a20e6f7f92\nparent e961d397cab900c55f8d8c104648852e2b63664e\nauthor kennytm <kennytm@gmail.com> 1540549497 +0800\ncommitter GitHub <noreply@github.com> 1540549497 +0800\n\nRollup merge of #54921 - GuillaumeGomez:line-numbers, r=QuietMisdreavus\n\nAdd line numbers option to rustdoc\n\nFixes #22878.\n\nr? @QuietMisdreavus\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4212896dcaf14003579644a058145939078799a1", "html_url": "https://github.com/rust-lang/rust/commit/4212896dcaf14003579644a058145939078799a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4212896dcaf14003579644a058145939078799a1/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a57ce63a91013b0a212120776769d8a20e6f7f92", "url": "https://api.github.com/repos/rust-lang/rust/commits/a57ce63a91013b0a212120776769d8a20e6f7f92", "html_url": "https://github.com/rust-lang/rust/commit/a57ce63a91013b0a212120776769d8a20e6f7f92"}, {"sha": "e961d397cab900c55f8d8c104648852e2b63664e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e961d397cab900c55f8d8c104648852e2b63664e", "html_url": "https://github.com/rust-lang/rust/commit/e961d397cab900c55f8d8c104648852e2b63664e"}], "stats": {"total": 82, "additions": 68, "deletions": 14}, "files": [{"sha": "6522261fe1e7c81a345f71783cdfcd1222202198", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -28,9 +28,12 @@ use syntax::parse;\n use syntax_pos::{Span, FileName};\n \n /// Highlights `src`, returning the HTML output.\n-pub fn render_with_highlighting(src: &str, class: Option<&str>,\n-                                extension: Option<&str>,\n-                                tooltip: Option<(&str, &str)>) -> String {\n+pub fn render_with_highlighting(\n+    src: &str,\n+    class: Option<&str>,\n+    extension: Option<&str>,\n+    tooltip: Option<(&str, &str)>,\n+) -> String {\n     debug!(\"highlighting: ================\\n{}\\n==============\", src);\n     let sess = parse::ParseSess::new(FilePathMapping::empty());\n     let fm = sess.source_map().new_source_file(FileName::Custom(\"stdin\".to_string()),\n@@ -384,9 +387,9 @@ impl Class {\n }\n \n fn write_header(class: Option<&str>, out: &mut dyn Write) -> io::Result<()> {\n-    write!(out, \"<pre class=\\\"rust {}\\\">\\n\", class.unwrap_or(\"\"))\n+    write!(out, \"<div class=\\\"example-wrap\\\"><pre class=\\\"rust {}\\\">\\n\", class.unwrap_or(\"\"))\n }\n \n fn write_footer(out: &mut dyn Write) -> io::Result<()> {\n-    write!(out, \"</pre>\\n\")\n+    write!(out, \"</pre></div>\\n\")\n }"}, {"sha": "ea51c46a332cbc254ff39ed240a2ea09bb14d356", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -1709,6 +1709,7 @@ impl<'a> Settings<'a> {\n                 (\"method-docs\", \"Auto-hide item methods' documentation\", false),\n                 (\"go-to-only-result\", \"Directly go to item in search if there is only one result\",\n                  false),\n+                (\"line-numbers\", \"Show line numbers on code examples\", false),\n             ],\n             root_path,\n             suffix,"}, {"sha": "9d1a5c38378308f6a6ca4c1ccb096b003d2e70ab", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 33, "deletions": 9, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -2093,6 +2093,7 @@\n         return wrapper;\n     }\n \n+    var hideItemDeclarations = getCurrentValue('rustdoc-item-declarations') === \"false\";\n     onEach(document.getElementsByClassName('docblock'), function(e) {\n         if (hasClass(e, 'autohide')) {\n             var wrap = e.previousElementSibling;\n@@ -2116,16 +2117,14 @@\n             }\n         }\n         if (e.parentNode.id === \"main\") {\n-            var otherMessage;\n+            var otherMessage = '';\n             var fontSize;\n             var extraClass;\n-            var show = true;\n \n             if (hasClass(e, \"type-decl\")) {\n                 fontSize = \"20px\";\n                 otherMessage = '&nbsp;Show&nbsp;declaration';\n-                show = getCurrentValue('rustdoc-item-declarations') === \"false\";\n-                if (!show) {\n+                if (hideItemDeclarations === false) {\n                     extraClass = 'collapsed';\n                 }\n             } else if (hasClass(e, \"non-exhaustive\")) {\n@@ -2142,8 +2141,12 @@\n                 extraClass = \"marg-left\";\n             }\n \n-            e.parentNode.insertBefore(createToggle(otherMessage, fontSize, extraClass, show), e);\n-            if (otherMessage && show) {\n+            e.parentNode.insertBefore(createToggle(otherMessage,\n+                                                   fontSize,\n+                                                   extraClass,\n+                                                   hideItemDeclarations),\n+                                      e);\n+            if (otherMessage.length > 0 && hideItemDeclarations === true) {\n                 collapseDocs(e.previousSibling.childNodes[0], \"toggle\");\n             }\n         }\n@@ -2186,13 +2189,33 @@\n         });\n     }\n \n+    // To avoid checking on \"rustdoc-item-attributes\" value on every loop...\n+    var itemAttributesFunc = function() {};\n+    if (getCurrentValue(\"rustdoc-item-attributes\") !== \"false\") {\n+        itemAttributesFunc = function(x) {\n+            collapseDocs(x.previousSibling.childNodes[0], \"toggle\");\n+        };\n+    }\n     onEach(document.getElementById('main').getElementsByClassName('attributes'), function(i_e) {\n         i_e.parentNode.insertBefore(createToggleWrapper(toggle.cloneNode(true)), i_e);\n-        if (getCurrentValue(\"rustdoc-item-attributes\") !== \"false\") {\n-            collapseDocs(i_e.previousSibling.childNodes[0], \"toggle\");\n-        }\n+        itemAttributesFunc(i_e);\n     });\n \n+    // To avoid checking on \"rustdoc-line-numbers\" value on every loop...\n+    var lineNumbersFunc = function() {};\n+    if (getCurrentValue(\"rustdoc-line-numbers\") === \"true\") {\n+        lineNumbersFunc = function(x) {\n+            var count = x.textContent.split('\\n').length;\n+            var elems = [];\n+            for (var i = 0; i < count; ++i) {\n+                elems.push(i + 1);\n+            }\n+            var node = document.createElement('pre');\n+            addClass(node, 'line-number');\n+            node.innerHTML = elems.join('\\n');\n+            x.parentNode.insertBefore(node, x);\n+        };\n+    }\n     onEach(document.getElementsByClassName('rust-example-rendered'), function(e) {\n         if (hasClass(e, 'compile_fail')) {\n             e.addEventListener(\"mouseover\", function(event) {\n@@ -2209,6 +2232,7 @@\n                 e.previousElementSibling.childNodes[0].style.color = '';\n             });\n         }\n+        lineNumbersFunc(e);\n     });\n \n     function showModal(content) {"}, {"sha": "c0951d9f8401e45a94db9a00d813a6bb213863e9", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -282,6 +282,24 @@ nav.sub {\n \tpadding-left: 0;\n }\n \n+.example-wrap {\n+\tdisplay: inline-flex;\n+\twidth: 100%;\n+}\n+\n+.example-wrap > pre.line-number {\n+\toverflow: initial;\n+\tborder: 1px solid;\n+\tborder-top-left-radius: 5px;\n+\tborder-bottom-left-radius: 5px;\n+\tpadding: 13px 8px;\n+\ttext-align: right;\n+}\n+\n+.example-wrap > pre.rust {\n+\twidth: 100%;\n+}\n+\n #search {\n \tmargin-left: 230px;\n \tposition: relative;"}, {"sha": "4a8950b236c62da6175a83280fb122b3cb134bb0", "filename": "src/librustdoc/html/static/themes/dark.css", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fdark.css?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -233,6 +233,10 @@ pre.rust .question-mark {\n \tcolor: #ff9011;\n }\n \n+.example-wrap > pre.line-number {\n+\tborder-color: #4a4949;\n+}\n+\n a.test-arrow {\n \tbackground-color: rgba(78, 139, 202, 0.2);\n }"}, {"sha": "b3b0b6b2ea9e869f1bb3a07c39f292611805ccaa", "filename": "src/librustdoc/html/static/themes/light.css", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/4212896dcaf14003579644a058145939078799a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Flight.css?ref=4212896dcaf14003579644a058145939078799a1", "patch": "@@ -227,6 +227,10 @@ pre.rust .question-mark {\n \tcolor: #ff9011;\n }\n \n+.example-wrap > pre.line-number {\n+\tborder-color: #c7c7c7;\n+}\n+\n a.test-arrow {\n \tbackground-color: rgba(78, 139, 202, 0.2);\n }"}]}