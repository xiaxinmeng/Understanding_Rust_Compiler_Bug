{"sha": "2746dacac02d56854e9aa31877730eb9e83628d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3NDZkYWNhYzAyZDU2ODU0ZTlhYTMxODc3NzMwZWI5ZTgzNjI4ZDU=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-12-31T12:37:05Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-12-31T12:37:05Z"}, "message": "Merge #385\n\n385: Implement DocumentHighlight r=matklad a=DJMcNab\n\nFixes #80.\n\nCo-authored-by: DJMcNab <36049421+djmcnab@users.noreply.github.com>", "tree": {"sha": "3dfe2f9e21f4a421268e480d9759a70dc8a1e2e2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3dfe2f9e21f4a421268e480d9759a70dc8a1e2e2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2746dacac02d56854e9aa31877730eb9e83628d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2746dacac02d56854e9aa31877730eb9e83628d5", "html_url": "https://github.com/rust-lang/rust/commit/2746dacac02d56854e9aa31877730eb9e83628d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2746dacac02d56854e9aa31877730eb9e83628d5/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "81acdafc518f858db38f1a3d78d9ff498c989176", "url": "https://api.github.com/repos/rust-lang/rust/commits/81acdafc518f858db38f1a3d78d9ff498c989176", "html_url": "https://github.com/rust-lang/rust/commit/81acdafc518f858db38f1a3d78d9ff498c989176"}, {"sha": "be75e547ce13dea281d2787ef5280637e76f6156", "url": "https://api.github.com/repos/rust-lang/rust/commits/be75e547ce13dea281d2787ef5280637e76f6156", "html_url": "https://github.com/rust-lang/rust/commit/be75e547ce13dea281d2787ef5280637e76f6156"}], "stats": {"total": 29, "additions": 25, "deletions": 4}, "files": [{"sha": "a74f9f27b63f8733f738c8fcd97516299d9a12a1", "filename": "crates/ra_lsp_server/src/caps.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs?ref=2746dacac02d56854e9aa31877730eb9e83628d5", "patch": "@@ -28,7 +28,7 @@ pub fn server_capabilities() -> ServerCapabilities {\n         type_definition_provider: None,\n         implementation_provider: None,\n         references_provider: Some(true),\n-        document_highlight_provider: None,\n+        document_highlight_provider: Some(true),\n         document_symbol_provider: Some(true),\n         workspace_symbol_provider: Some(true),\n         code_action_provider: Some(CodeActionProviderCapability::Simple(true)),"}, {"sha": "06dd373c02fce5761a8a38d04141eecd2df6faa6", "filename": "crates/ra_lsp_server/src/main_loop.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs?ref=2746dacac02d56854e9aa31877730eb9e83628d5", "patch": "@@ -300,6 +300,7 @@ fn on_request(\n         .on::<req::Rename>(handlers::handle_rename)?\n         .on::<req::References>(handlers::handle_references)?\n         .on::<req::Formatting>(handlers::handle_formatting)?\n+        .on::<req::DocumentHighlightRequest>(handlers::handle_document_highlight)?\n         .finish();\n     match req {\n         Ok(id) => {"}, {"sha": "012f74270f5558c3be1debc4eee4828af880a5e9", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 23, "deletions": 3, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2746dacac02d56854e9aa31877730eb9e83628d5/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=2746dacac02d56854e9aa31877730eb9e83628d5", "patch": "@@ -6,9 +6,8 @@ use languageserver_types::{\n     DiagnosticSeverity, DocumentSymbol, Documentation, FoldingRange, FoldingRangeKind,\n     FoldingRangeParams, Location, MarkupContent, MarkupKind, MarkedString, Position,\n     PrepareRenameResponse, RenameParams, SymbolInformation, TextDocumentIdentifier, TextEdit,\n-    Range,\n-    WorkspaceEdit, ParameterInformation, ParameterLabel, SignatureInformation, Hover, HoverContents,\n-    DocumentFormattingParams,\n+    Range, WorkspaceEdit, ParameterInformation, ParameterLabel, SignatureInformation, Hover,\n+    HoverContents, DocumentFormattingParams, DocumentHighlight,\n };\n use ra_analysis::{FileId, FoldKind, Query, RunnableKind, FileRange, FilePosition, Severity};\n use ra_syntax::{TextUnit, text_utils::intersect};\n@@ -668,6 +667,27 @@ pub fn handle_code_action(\n     Ok(Some(CodeActionResponse::Commands(res)))\n }\n \n+pub fn handle_document_highlight(\n+    world: ServerWorld,\n+    params: req::TextDocumentPositionParams,\n+) -> Result<Option<Vec<DocumentHighlight>>> {\n+    let file_id = params.text_document.try_conv_with(&world)?;\n+    let line_index = world.analysis().file_line_index(file_id);\n+\n+    let refs = world\n+        .analysis()\n+        .find_all_refs(params.try_conv_with(&world)?)?;\n+\n+    Ok(Some(\n+        refs.into_iter()\n+            .map(|r| DocumentHighlight {\n+                range: r.1.conv_with(&line_index),\n+                kind: None,\n+            })\n+            .collect(),\n+    ))\n+}\n+\n pub fn publish_diagnostics(\n     world: &ServerWorld,\n     file_id: FileId,"}]}