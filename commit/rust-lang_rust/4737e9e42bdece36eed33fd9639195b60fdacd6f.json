{"sha": "4737e9e42bdece36eed33fd9639195b60fdacd6f", "node_id": "C_kwDOAAsO6NoAKDQ3MzdlOWU0MmJkZWNlMzZlZWQzM2ZkOTYzOTE5NWI2MGZkYWNkNmY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-06-18T22:17:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-18T22:17:13Z"}, "message": "Rollup merge of #98165 - WaffleLapkin:once_things_renamings, r=m-ou-se\n\nonce cell renamings\n\nThis PR does the renamings proposed in https://github.com/rust-lang/rust/issues/74465#issuecomment-1153703128\n\n- Move/rename `lazy::{OnceCell, Lazy}` to `cell::{OnceCell, LazyCell}`\n- Move/rename `lazy::{SyncOnceCell, SyncLazy}` to `sync::{OnceLock, LazyLock}`\n\n(I used `Lazy...` instead of `...Lazy` as it seems to be more consistent, easier to pronounce, etc)\n\n```@rustbot``` label +T-libs-api -T-libs", "tree": {"sha": "db4050ede26c7c0eb52c2bd2f0dc1c607860388d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db4050ede26c7c0eb52c2bd2f0dc1c607860388d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4737e9e42bdece36eed33fd9639195b60fdacd6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4737e9e42bdece36eed33fd9639195b60fdacd6f", "html_url": "https://github.com/rust-lang/rust/commit/4737e9e42bdece36eed33fd9639195b60fdacd6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4737e9e42bdece36eed33fd9639195b60fdacd6f/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09c93018d77a19e3f8f6bde5dc70e929f04f6318", "url": "https://api.github.com/repos/rust-lang/rust/commits/09c93018d77a19e3f8f6bde5dc70e929f04f6318", "html_url": "https://github.com/rust-lang/rust/commit/09c93018d77a19e3f8f6bde5dc70e929f04f6318"}, {"sha": "f095f802dcd0f5ead14539c3f11985b4a3562912", "url": "https://api.github.com/repos/rust-lang/rust/commits/f095f802dcd0f5ead14539c3f11985b4a3562912", "html_url": "https://github.com/rust-lang/rust/commit/f095f802dcd0f5ead14539c3f11985b4a3562912"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "f5c51b9474fcd878cf631441cc03a194d239301b", "filename": "clippy_dev/src/bless.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4737e9e42bdece36eed33fd9639195b60fdacd6f/clippy_dev%2Fsrc%2Fbless.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4737e9e42bdece36eed33fd9639195b60fdacd6f/clippy_dev%2Fsrc%2Fbless.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fbless.rs?ref=4737e9e42bdece36eed33fd9639195b60fdacd6f", "patch": "@@ -4,12 +4,12 @@\n use crate::cargo_clippy_path;\n use std::ffi::OsStr;\n use std::fs;\n-use std::lazy::SyncLazy;\n use std::path::{Path, PathBuf};\n+use std::sync::LazyLock;\n use walkdir::{DirEntry, WalkDir};\n \n-static CLIPPY_BUILD_TIME: SyncLazy<Option<std::time::SystemTime>> =\n-    SyncLazy::new(|| cargo_clippy_path().metadata().ok()?.modified().ok());\n+static CLIPPY_BUILD_TIME: LazyLock<Option<std::time::SystemTime>> =\n+    LazyLock::new(|| cargo_clippy_path().metadata().ok()?.modified().ok());\n \n /// # Panics\n ///"}, {"sha": "5106c39b5c6fca70687f31e2737e3f58d633bd8c", "filename": "clippy_utils/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4737e9e42bdece36eed33fd9639195b60fdacd6f/clippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4737e9e42bdece36eed33fd9639195b60fdacd6f/clippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Flib.rs?ref=4737e9e42bdece36eed33fd9639195b60fdacd6f", "patch": "@@ -64,7 +64,7 @@ pub use self::hir_utils::{\n \n use std::collections::hash_map::Entry;\n use std::hash::BuildHasherDefault;\n-use std::lazy::SyncOnceCell;\n+use std::sync::OnceLock;\n use std::sync::{Mutex, MutexGuard};\n \n use if_chain::if_chain;\n@@ -2080,7 +2080,7 @@ pub fn is_hir_ty_cfg_dependant(cx: &LateContext<'_>, ty: &hir::Ty<'_>) -> bool {\n     false\n }\n \n-static TEST_ITEM_NAMES_CACHE: SyncOnceCell<Mutex<FxHashMap<LocalDefId, Vec<Symbol>>>> = SyncOnceCell::new();\n+static TEST_ITEM_NAMES_CACHE: OnceLock<Mutex<FxHashMap<LocalDefId, Vec<Symbol>>>> = OnceLock::new();\n \n fn with_test_item_names<'tcx>(tcx: TyCtxt<'tcx>, module: LocalDefId, f: impl Fn(&[Symbol]) -> bool) -> bool {\n     let cache = TEST_ITEM_NAMES_CACHE.get_or_init(|| Mutex::new(FxHashMap::default()));"}, {"sha": "67467f89b475fe4bda8d2e7be90dbf4b1cd84c10", "filename": "src/driver.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4737e9e42bdece36eed33fd9639195b60fdacd6f/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4737e9e42bdece36eed33fd9639195b60fdacd6f/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=4737e9e42bdece36eed33fd9639195b60fdacd6f", "patch": "@@ -21,11 +21,11 @@ use rustc_tools_util::VersionInfo;\n \n use std::borrow::Cow;\n use std::env;\n-use std::lazy::SyncLazy;\n use std::ops::Deref;\n use std::panic;\n use std::path::{Path, PathBuf};\n use std::process::{exit, Command};\n+use std::sync::LazyLock;\n \n /// If a command-line option matches `find_arg`, then apply the predicate `pred` on its value. If\n /// true, then return it. The parameter is assumed to be either `--arg=value` or `--arg value`.\n@@ -152,7 +152,7 @@ You can use tool lints to allow or deny lints from your code, eg.:\n \n const BUG_REPORT_URL: &str = \"https://github.com/rust-lang/rust-clippy/issues/new\";\n \n-static ICE_HOOK: SyncLazy<Box<dyn Fn(&panic::PanicInfo<'_>) + Sync + Send + 'static>> = SyncLazy::new(|| {\n+static ICE_HOOK: LazyLock<Box<dyn Fn(&panic::PanicInfo<'_>) + Sync + Send + 'static>> = LazyLock::new(|| {\n     let hook = panic::take_hook();\n     panic::set_hook(Box::new(|info| report_clippy_ice(info, BUG_REPORT_URL)));\n     hook\n@@ -219,7 +219,7 @@ fn toolchain_path(home: Option<String>, toolchain: Option<String>) -> Option<Pat\n #[allow(clippy::too_many_lines)]\n pub fn main() {\n     rustc_driver::init_rustc_env_logger();\n-    SyncLazy::force(&ICE_HOOK);\n+    LazyLock::force(&ICE_HOOK);\n     exit(rustc_driver::catch_with_exit_code(move || {\n         let mut orig_args: Vec<String> = env::args().collect();\n "}, {"sha": "061cda7e01e5b800c34c8da98d8f20b4aac9e109", "filename": "tests/compile-test.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4737e9e42bdece36eed33fd9639195b60fdacd6f/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4737e9e42bdece36eed33fd9639195b60fdacd6f/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=4737e9e42bdece36eed33fd9639195b60fdacd6f", "patch": "@@ -12,8 +12,8 @@ use std::env::{self, remove_var, set_var, var_os};\n use std::ffi::{OsStr, OsString};\n use std::fs;\n use std::io;\n-use std::lazy::SyncLazy;\n use std::path::{Path, PathBuf};\n+use std::sync::LazyLock;\n use test_utils::IS_RUSTC_TEST_SUITE;\n \n mod test_utils;\n@@ -69,7 +69,7 @@ extern crate tokio;\n /// dependencies must be added to Cargo.toml at the project root. Test\n /// dependencies that are not *directly* used by this test module require an\n /// `extern crate` declaration.\n-static EXTERN_FLAGS: SyncLazy<String> = SyncLazy::new(|| {\n+static EXTERN_FLAGS: LazyLock<String> = LazyLock::new(|| {\n     let current_exe_depinfo = {\n         let mut path = env::current_exe().unwrap();\n         path.set_extension(\"d\");"}, {"sha": "ea8c54e08b33806ca6bad8e4420618530d671632", "filename": "tests/test_utils/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4737e9e42bdece36eed33fd9639195b60fdacd6f/tests%2Ftest_utils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4737e9e42bdece36eed33fd9639195b60fdacd6f/tests%2Ftest_utils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftest_utils%2Fmod.rs?ref=4737e9e42bdece36eed33fd9639195b60fdacd6f", "patch": "@@ -1,9 +1,9 @@\n #![allow(dead_code)] // see https://github.com/rust-lang/rust/issues/46379\n \n-use std::lazy::SyncLazy;\n use std::path::PathBuf;\n+use std::sync::LazyLock;\n \n-pub static CARGO_CLIPPY_PATH: SyncLazy<PathBuf> = SyncLazy::new(|| {\n+pub static CARGO_CLIPPY_PATH: LazyLock<PathBuf> = LazyLock::new(|| {\n     let mut path = std::env::current_exe().unwrap();\n     assert!(path.pop()); // deps\n     path.set_file_name(\"cargo-clippy\");"}]}