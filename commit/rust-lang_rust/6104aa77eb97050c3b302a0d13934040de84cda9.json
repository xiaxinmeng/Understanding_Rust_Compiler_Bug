{"sha": "6104aa77eb97050c3b302a0d13934040de84cda9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxMDRhYTc3ZWI5NzA1MGMzYjMwMmEwZDEzOTM0MDQwZGU4NGNkYTk=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-30T17:13:18Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-11-12T10:06:11Z"}, "message": "ci: extract validate-toolstate into a script", "tree": {"sha": "85fd1ba1038019d7cfcf9295861d76a447b9d179", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85fd1ba1038019d7cfcf9295861d76a447b9d179"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6104aa77eb97050c3b302a0d13934040de84cda9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl3KhBQACgkQPgar6Auq\n8Zyq4Q/9Fp+TPE4nxwv7E86uuk5vU/7pD5A2xBBLN5rpGjOk1vapb8oK1V4hJseB\nzoZmCGjEcJRLzBw7Zb8WjNDjtloIDS5QmfuOK1f/ggJ6N+W+xYaSBxwn5xW5EL/e\ntEoxBK/ywFnkdO8vJnMD5ONKG6hBaNLXl34oE8YHqdjR5m34HU/XGuQb99em83AI\nZTzXXm+c+tm+eT3+pTMcsa11VMb6NkGqJuvHfR6FrZpx80DczU4Ge/qM0wR5gjku\nFNdT0GStbds5eNbi5TNGMcYlJXeavzKarkbCDoYdteGqCITfY43zLkv6o8fBmeLI\nnYT/eQKved4KmOkUFU8g6bEGa3lIDBPkVpJSKVWFhoF6F550M2vHB46/SyJD70lA\n15/6vBsFLEOAmbnsDnTmR1B+j/3rS1NzlpcfumQaIPJ/X/3xZylJn9KtqMBnowGA\nLk/CsxP9jp4Q4H963yzJIpOI3V68HFUnrDRnOW8nXrsR89kZ96iySBEf/ZNZkO64\nyHzfdqFN56mYlJHP6knP18qYQIWjmVyt+cw+Zw4fGstbrP/r2RAtAIkMjtm26oYD\nR8A5RMWwNGh3ikFZvXOsOC7/Zk3Mtq1ckt86oBECM9jybfFII5XNSvabdZdhUB7T\neJ8hVvaJuA4JIsqaEiu1C6C5mdo5YGEv4euRqjQfMx13fz2IjWA=\n=TTHg\n-----END PGP SIGNATURE-----", "payload": "tree 85fd1ba1038019d7cfcf9295861d76a447b9d179\nparent af6b26646b41e1b9614be12ae126f7033a3fa908\nauthor Pietro Albini <pietro@pietroalbini.org> 1572455598 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1573553171 +0100\n\nci: extract validate-toolstate into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6104aa77eb97050c3b302a0d13934040de84cda9", "html_url": "https://github.com/rust-lang/rust/commit/6104aa77eb97050c3b302a0d13934040de84cda9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6104aa77eb97050c3b302a0d13934040de84cda9/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af6b26646b41e1b9614be12ae126f7033a3fa908", "url": "https://api.github.com/repos/rust-lang/rust/commits/af6b26646b41e1b9614be12ae126f7033a3fa908", "html_url": "https://github.com/rust-lang/rust/commit/af6b26646b41e1b9614be12ae126f7033a3fa908"}], "stats": {"total": 31, "additions": 19, "deletions": 12}, "files": [{"sha": "4df315d5d5cd322b3582638ff058be383bdf903c", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6104aa77eb97050c3b302a0d13934040de84cda9/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/6104aa77eb97050c3b302a0d13934040de84cda9/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=6104aa77eb97050c3b302a0d13934040de84cda9", "patch": "@@ -144,18 +144,7 @@ steps:\n \n # As a quick smoke check on the otherwise very fast mingw-check linux builder\n # check our own internal scripts.\n-- bash: |\n-    set -e\n-    git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git\n-    cd rust-toolstate\n-    python2.7 \"$BUILD_SOURCESDIRECTORY/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"\" \"\"\n-    # Only check maintainers if this build is supposed to publish toolstate.\n-    # Builds that are not supposed to publish don't have the access token.\n-    if [ -n \"${TOOLSTATE_PUBLISH+is_set}\" ]; then\n-      TOOLSTATE_VALIDATE_MAINTAINERS_REPO=rust-lang/rust python2.7 \"${BUILD_SOURCESDIRECTORY}/src/tools/publish_toolstate.py\"\n-    fi\n-    cd ..\n-    rm -rf rust-toolstate\n+- bash: src/ci/scripts/validate-toolstate.sh\n   env:\n     TOOLSTATE_REPO_ACCESS_TOKEN: $(TOOLSTATE_REPO_ACCESS_TOKEN)\n   condition: and(succeeded(), not(variables.SKIP_JOB), eq(variables['IMAGE'], 'mingw-check'))"}, {"sha": "93e645b24a85914a0cfa86d73ff0ccab35e19e7e", "filename": "src/ci/scripts/validate-toolstate.sh", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6104aa77eb97050c3b302a0d13934040de84cda9/src%2Fci%2Fscripts%2Fvalidate-toolstate.sh", "raw_url": "https://github.com/rust-lang/rust/raw/6104aa77eb97050c3b302a0d13934040de84cda9/src%2Fci%2Fscripts%2Fvalidate-toolstate.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fvalidate-toolstate.sh?ref=6104aa77eb97050c3b302a0d13934040de84cda9", "patch": "@@ -0,0 +1,18 @@\n+#!/bin/bash\n+# A quick smoke test to make sure publish_tooolstate.py works.\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git\n+cd rust-toolstate\n+python2.7 \"${BUILD_SOURCESDIRECTORY}/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"\" \"\"\n+# Only check maintainers if this build is supposed to publish toolstate.\n+# Builds that are not supposed to publish don't have the access token.\n+if [ -n \"${TOOLSTATE_PUBLISH+is_set}\" ]; then\n+  TOOLSTATE_VALIDATE_MAINTAINERS_REPO=rust-lang/rust python2.7 \"${BUILD_SOURCESDIRECTORY}/src/tools/publish_toolstate.py\"\n+fi\n+cd ..\n+rm -rf rust-toolstate"}]}