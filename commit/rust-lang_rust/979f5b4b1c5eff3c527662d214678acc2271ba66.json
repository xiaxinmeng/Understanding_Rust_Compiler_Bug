{"sha": "979f5b4b1c5eff3c527662d214678acc2271ba66", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3OWY1YjRiMWM1ZWZmM2M1Mjc2NjJkMjE0Njc4YWNjMjI3MWJhNjY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-01-27T23:27:57Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-01-28T00:24:59Z"}, "message": "lintify conflicting_repr_hints", "tree": {"sha": "cb4138791f125c0f1a857fb51a30d74816dc0bad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb4138791f125c0f1a857fb51a30d74816dc0bad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/979f5b4b1c5eff3c527662d214678acc2271ba66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/979f5b4b1c5eff3c527662d214678acc2271ba66", "html_url": "https://github.com/rust-lang/rust/commit/979f5b4b1c5eff3c527662d214678acc2271ba66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/979f5b4b1c5eff3c527662d214678acc2271ba66/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a79d08fa57e1c257d647c9848e35defcb379c07", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a79d08fa57e1c257d647c9848e35defcb379c07", "html_url": "https://github.com/rust-lang/rust/commit/8a79d08fa57e1c257d647c9848e35defcb379c07"}], "stats": {"total": 79, "additions": 59, "deletions": 20}, "files": [{"sha": "03fa426460dab2f8bb7b301fd794550d0cf5ba5b", "filename": "src/librustc/hir/check_attr.rs", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Flibrustc%2Fhir%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Flibrustc%2Fhir%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fcheck_attr.rs?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -14,7 +14,7 @@ use rustc_hir::def_id::DefId;\n use rustc_hir::intravisit::{self, NestedVisitorMap, Visitor};\n use rustc_hir::DUMMY_HIR_ID;\n use rustc_hir::{self, HirId, Item, ItemKind, TraitItem, TraitItemKind};\n-use rustc_session::lint::builtin::UNUSED_ATTRIBUTES;\n+use rustc_session::lint::builtin::{CONFLICTING_REPR_HINTS, UNUSED_ATTRIBUTES};\n use rustc_span::symbol::sym;\n use rustc_span::Span;\n use syntax::ast::Attribute;\n@@ -196,7 +196,7 @@ impl CheckAttrVisitor<'tcx> {\n             self.tcx.codegen_fn_attrs(self.tcx.hir().local_def_id(hir_id));\n         }\n \n-        self.check_repr(attrs, span, target, item);\n+        self.check_repr(attrs, span, target, item, hir_id);\n         self.check_used(attrs, target);\n     }\n \n@@ -357,6 +357,7 @@ impl CheckAttrVisitor<'tcx> {\n         span: &Span,\n         target: Target,\n         item: Option<&Item<'_>>,\n+        hir_id: HirId,\n     ) {\n         // Extract the names of all repr hints, e.g., [foo, bar, align] for:\n         // ```\n@@ -446,13 +447,15 @@ impl CheckAttrVisitor<'tcx> {\n             || (is_simd && is_c)\n             || (int_reprs == 1 && is_c && item.map_or(false, |item| is_c_like_enum(item)))\n         {\n-            struct_span_err!(\n-                self.tcx.sess,\n-                hint_spans.collect::<Vec<Span>>(),\n-                E0566,\n-                \"conflicting representation hints\",\n-            )\n-            .emit();\n+            self.tcx\n+                .struct_span_lint_hir(\n+                    CONFLICTING_REPR_HINTS,\n+                    hir_id,\n+                    hint_spans.collect::<Vec<Span>>(),\n+                    \"conflicting representation hints\",\n+                )\n+                .code(rustc_errors::error_code!(E0566))\n+                .emit();\n         }\n     }\n "}, {"sha": "c326061100b063adbf0792061bb5a7b816976cd6", "filename": "src/librustc_session/lint/builtin.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Flibrustc_session%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Flibrustc_session%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Flint%2Fbuiltin.rs?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -18,6 +18,16 @@ declare_lint! {\n     };\n }\n \n+declare_lint! {\n+    pub CONFLICTING_REPR_HINTS,\n+    Deny,\n+    \"conflicts between `#[repr(..)]` hints that were previously accepted and used in practice\",\n+    @future_incompatible = FutureIncompatibleInfo {\n+        reference: \"issue #68585 <https://github.com/rust-lang/rust/issues/68585>\",\n+        edition: None,\n+    };\n+}\n+\n declare_lint! {\n     pub META_VARIABLE_MISUSE,\n     Allow,\n@@ -520,6 +530,7 @@ declare_lint_pass! {\n         MACRO_USE_EXTERN_CRATE,\n         MACRO_EXPANDED_MACRO_EXPORTS_ACCESSED_BY_ABSOLUTE_PATHS,\n         ILL_FORMED_ATTRIBUTE_INPUT,\n+        CONFLICTING_REPR_HINTS,\n         META_VARIABLE_MISUSE,\n         DEPRECATED_IN_FUTURE,\n         AMBIGUOUS_ASSOCIATED_ITEMS,"}, {"sha": "09dade20992ba15234337205d6345200214e9b1a", "filename": "src/test/ui/conflicting-repr-hints.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fconflicting-repr-hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fconflicting-repr-hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconflicting-repr-hints.rs?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -11,11 +11,13 @@ enum B {\n }\n \n #[repr(C, u64)] //~ ERROR conflicting representation hints\n+//~^ WARN this was previously accepted\n enum C {\n     C,\n }\n \n #[repr(u32, u64)] //~ ERROR conflicting representation hints\n+//~^ WARN this was previously accepted\n enum D {\n     D,\n }"}, {"sha": "43b76bf649778ec84706635c4796ca4caac24ed9", "filename": "src/test/ui/conflicting-repr-hints.stderr", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fconflicting-repr-hints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fconflicting-repr-hints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconflicting-repr-hints.stderr?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -3,45 +3,52 @@ error[E0566]: conflicting representation hints\n    |\n LL | #[repr(C, u64)]\n    |        ^  ^^^\n+   |\n+   = note: `#[deny(conflicting_repr_hints)]` on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #68585 <https://github.com/rust-lang/rust/issues/68585>\n \n error[E0566]: conflicting representation hints\n-  --> $DIR/conflicting-repr-hints.rs:18:8\n+  --> $DIR/conflicting-repr-hints.rs:19:8\n    |\n LL | #[repr(u32, u64)]\n    |        ^^^  ^^^\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #68585 <https://github.com/rust-lang/rust/issues/68585>\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:27:1\n+  --> $DIR/conflicting-repr-hints.rs:29:1\n    |\n LL | struct F(i32);\n    | ^^^^^^^^^^^^^^\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:31:1\n+  --> $DIR/conflicting-repr-hints.rs:33:1\n    |\n LL | struct G(i32);\n    | ^^^^^^^^^^^^^^\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:35:1\n+  --> $DIR/conflicting-repr-hints.rs:37:1\n    |\n LL | struct H(i32);\n    | ^^^^^^^^^^^^^^\n \n error[E0634]: type has conflicting packed representation hints\n-  --> $DIR/conflicting-repr-hints.rs:38:1\n+  --> $DIR/conflicting-repr-hints.rs:40:1\n    |\n LL | struct I(i32);\n    | ^^^^^^^^^^^^^^\n \n error[E0634]: type has conflicting packed representation hints\n-  --> $DIR/conflicting-repr-hints.rs:42:1\n+  --> $DIR/conflicting-repr-hints.rs:44:1\n    |\n LL | struct J(i32);\n    | ^^^^^^^^^^^^^^\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:48:1\n+  --> $DIR/conflicting-repr-hints.rs:50:1\n    |\n LL | / union X {\n LL | |\n@@ -50,7 +57,7 @@ LL | | }\n    | |_^\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:55:1\n+  --> $DIR/conflicting-repr-hints.rs:57:1\n    |\n LL | / union Y {\n LL | |\n@@ -59,7 +66,7 @@ LL | | }\n    | |_^\n \n error[E0587]: type has conflicting packed and align representation hints\n-  --> $DIR/conflicting-repr-hints.rs:62:1\n+  --> $DIR/conflicting-repr-hints.rs:64:1\n    |\n LL | / union Z {\n LL | |"}, {"sha": "c527404f57270c732d6c5e17ab5cc6f02d43180d", "filename": "src/test/ui/feature-gates/feature-gate-repr-simd.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.rs?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -2,6 +2,7 @@\n struct Foo(u64, u64);\n \n #[repr(C)] //~ ERROR conflicting representation hints\n+//~^ WARN this was previously accepted\n #[repr(simd)] //~ error: SIMD types are experimental\n struct Bar(u64, u64);\n "}, {"sha": "013bad069d8cd3c3e89e1d415a6a38032e62578e", "filename": "src/test/ui/feature-gates/feature-gate-repr-simd.stderr", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr-simd.stderr?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -8,7 +8,7 @@ LL | #[repr(simd)]\n    = help: add `#![feature(repr_simd)]` to the crate attributes to enable\n \n error[E0658]: SIMD types are experimental and possibly buggy\n-  --> $DIR/feature-gate-repr-simd.rs:5:1\n+  --> $DIR/feature-gate-repr-simd.rs:6:1\n    |\n LL | #[repr(simd)]\n    | ^^^^^^^^^^^^^\n@@ -21,8 +21,13 @@ error[E0566]: conflicting representation hints\n    |\n LL | #[repr(C)]\n    |        ^\n+LL |\n LL | #[repr(simd)]\n    |        ^^^^\n+   |\n+   = note: `#[deny(conflicting_repr_hints)]` on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #68585 <https://github.com/rust-lang/rust/issues/68585>\n \n error: aborting due to 3 previous errors\n "}, {"sha": "c5d37feb1447fd3a8e2f900a90f45794b77c229a", "filename": "src/test/ui/issues/issue-47094.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fissues%2Fissue-47094.rs", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fissues%2Fissue-47094.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-47094.rs?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -1,10 +1,12 @@\n #[repr(C, u8)] //~ ERROR conflicting representation hints\n+//~^ WARN this was previously accepted\n enum Foo {\n     A,\n     B,\n }\n \n #[repr(C)] //~ ERROR conflicting representation hints\n+//~^ WARN this was previously accepted\n #[repr(u8)]\n enum Bar {\n     A,"}, {"sha": "e323ce660290c68d9f1184e212d566c554504484", "filename": "src/test/ui/issues/issue-47094.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fissues%2Fissue-47094.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/979f5b4b1c5eff3c527662d214678acc2271ba66/src%2Ftest%2Fui%2Fissues%2Fissue-47094.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-47094.stderr?ref=979f5b4b1c5eff3c527662d214678acc2271ba66", "patch": "@@ -3,14 +3,22 @@ error[E0566]: conflicting representation hints\n    |\n LL | #[repr(C, u8)]\n    |        ^  ^^\n+   |\n+   = note: `#[deny(conflicting_repr_hints)]` on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #68585 <https://github.com/rust-lang/rust/issues/68585>\n \n error[E0566]: conflicting representation hints\n-  --> $DIR/issue-47094.rs:7:8\n+  --> $DIR/issue-47094.rs:8:8\n    |\n LL | #[repr(C)]\n    |        ^\n+LL |\n LL | #[repr(u8)]\n    |        ^^\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #68585 <https://github.com/rust-lang/rust/issues/68585>\n \n error: aborting due to 2 previous errors\n "}]}