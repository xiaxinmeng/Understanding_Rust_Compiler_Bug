{"sha": "1ce581d70698466879dc7acec0629032fb9006fd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjZTU4MWQ3MDY5ODQ2Njg3OWRjN2FjZWMwNjI5MDMyZmI5MDA2ZmQ=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-05-06T19:33:23Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-05-26T21:53:13Z"}, "message": "Use break api config for unnecessary_wraps", "tree": {"sha": "d657bbe928b01698b60a5ebca2ccb6331b001a34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d657bbe928b01698b60a5ebca2ccb6331b001a34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ce581d70698466879dc7acec0629032fb9006fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ce581d70698466879dc7acec0629032fb9006fd", "html_url": "https://github.com/rust-lang/rust/commit/1ce581d70698466879dc7acec0629032fb9006fd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ce581d70698466879dc7acec0629032fb9006fd/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d77a2b8617f914b1e5503dd93f67a8334693ce0", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d77a2b8617f914b1e5503dd93f67a8334693ce0", "html_url": "https://github.com/rust-lang/rust/commit/3d77a2b8617f914b1e5503dd93f67a8334693ce0"}], "stats": {"total": 25, "additions": 18, "deletions": 7}, "files": [{"sha": "9c9eba0d21e08144cfe8bf5d01249ee1aa03a7ee", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ce581d70698466879dc7acec0629032fb9006fd/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ce581d70698466879dc7acec0629032fb9006fd/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=1ce581d70698466879dc7acec0629032fb9006fd", "patch": "@@ -1976,7 +1976,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| box redundant_clone::RedundantClone);\n     store.register_late_pass(|| box slow_vector_initialization::SlowVectorInit);\n     store.register_late_pass(|| box unnecessary_sort_by::UnnecessarySortBy);\n-    store.register_late_pass(|| box unnecessary_wraps::UnnecessaryWraps);\n+    store.register_late_pass(move || box unnecessary_wraps::UnnecessaryWraps::new(avoid_breaking_exported_api));\n     store.register_late_pass(|| box assertions_on_constants::AssertionsOnConstants);\n     store.register_late_pass(|| box transmuting_null::TransmutingNull);\n     store.register_late_pass(|| box path_buf_push_overwrite::PathBufPushOverwrite);"}, {"sha": "a85ffa6aa950507c823738e77be58eb397ea0d4f", "filename": "clippy_lints/src/unnecessary_wraps.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/1ce581d70698466879dc7acec0629032fb9006fd/clippy_lints%2Fsrc%2Funnecessary_wraps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ce581d70698466879dc7acec0629032fb9006fd/clippy_lints%2Fsrc%2Funnecessary_wraps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funnecessary_wraps.rs?ref=1ce581d70698466879dc7acec0629032fb9006fd", "patch": "@@ -8,7 +8,7 @@ use rustc_hir::LangItem::{OptionSome, ResultOk};\n use rustc_hir::{Body, ExprKind, FnDecl, HirId, Impl, ItemKind, Node};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_middle::ty;\n-use rustc_session::{declare_lint_pass, declare_tool_lint};\n+use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::symbol::sym;\n use rustc_span::Span;\n \n@@ -52,7 +52,19 @@ declare_clippy_lint! {\n     \"functions that only return `Ok` or `Some`\"\n }\n \n-declare_lint_pass!(UnnecessaryWraps => [UNNECESSARY_WRAPS]);\n+pub struct UnnecessaryWraps {\n+    avoid_breaking_exported_api: bool,\n+}\n+\n+impl_lint_pass!(UnnecessaryWraps => [UNNECESSARY_WRAPS]);\n+\n+impl UnnecessaryWraps {\n+    pub fn new(avoid_breaking_exported_api: bool) -> Self {\n+        Self {\n+            avoid_breaking_exported_api,\n+        }\n+    }\n+}\n \n impl<'tcx> LateLintPass<'tcx> for UnnecessaryWraps {\n     fn check_fn(\n@@ -66,13 +78,12 @@ impl<'tcx> LateLintPass<'tcx> for UnnecessaryWraps {\n     ) {\n         // Abort if public function/method or closure.\n         match fn_kind {\n-            FnKind::ItemFn(.., visibility) | FnKind::Method(.., Some(visibility)) => {\n-                if visibility.node.is_pub() {\n+            FnKind::ItemFn(..) | FnKind::Method(..) => {\n+                if self.avoid_breaking_exported_api && cx.access_levels.is_exported(hir_id) {\n                     return;\n                 }\n             },\n             FnKind::Closure => return,\n-            FnKind::Method(..) => (),\n         }\n \n         // Abort if the method is implementing a trait or of it a trait method."}, {"sha": "63648ef5826f6e1f2c5009050393c4b884e9a735", "filename": "tests/ui/unnecessary_wraps.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ce581d70698466879dc7acec0629032fb9006fd/tests%2Fui%2Funnecessary_wraps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ce581d70698466879dc7acec0629032fb9006fd/tests%2Fui%2Funnecessary_wraps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_wraps.rs?ref=1ce581d70698466879dc7acec0629032fb9006fd", "patch": "@@ -65,7 +65,7 @@ fn func10() -> Option<()> {\n     unimplemented!()\n }\n \n-struct A;\n+pub struct A;\n \n impl A {\n     // should not be linted"}]}