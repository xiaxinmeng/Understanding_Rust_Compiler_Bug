{"sha": "2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhMzIwZjIxZDBlNWY5NDNiOWNkMDJiYjc4ODI1MzFiZmI3ZWYwYjk=", "commit": {"author": {"name": "Earl St Sauver", "email": "estsauver@gmail.com", "date": "2015-01-12T09:37:01Z"}, "committer": {"name": "Earl St Sauver", "email": "estsauver@gmail.com", "date": "2015-01-14T06:25:11Z"}, "message": "Fix playpen links to not all be the same\n\nFixes #20732, that all links in some modules point to the same code\nexamples was reported. The ID's generated for documents in\nlibrustdoc are not all unique, which means the code rendered as\ntext is not being properly selected.\n\nThis change removes the unique id generation and instead changes the\nfrontend code to grab the correct code sample by it's relative\nposition in the dom.", "tree": {"sha": "df22d587e1fae73b8e4b5c119b6bf5e5314f1815", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df22d587e1fae73b8e4b5c119b6bf5e5314f1815"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "comment_count": 7, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "html_url": "https://github.com/rust-lang/rust/commit/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9/comments", "author": {"login": "estsauver", "id": 766985, "node_id": "MDQ6VXNlcjc2Njk4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/766985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estsauver", "html_url": "https://github.com/estsauver", "followers_url": "https://api.github.com/users/estsauver/followers", "following_url": "https://api.github.com/users/estsauver/following{/other_user}", "gists_url": "https://api.github.com/users/estsauver/gists{/gist_id}", "starred_url": "https://api.github.com/users/estsauver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estsauver/subscriptions", "organizations_url": "https://api.github.com/users/estsauver/orgs", "repos_url": "https://api.github.com/users/estsauver/repos", "events_url": "https://api.github.com/users/estsauver/events{/privacy}", "received_events_url": "https://api.github.com/users/estsauver/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estsauver", "id": 766985, "node_id": "MDQ6VXNlcjc2Njk4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/766985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estsauver", "html_url": "https://github.com/estsauver", "followers_url": "https://api.github.com/users/estsauver/followers", "following_url": "https://api.github.com/users/estsauver/following{/other_user}", "gists_url": "https://api.github.com/users/estsauver/gists{/gist_id}", "starred_url": "https://api.github.com/users/estsauver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estsauver/subscriptions", "organizations_url": "https://api.github.com/users/estsauver/orgs", "repos_url": "https://api.github.com/users/estsauver/repos", "events_url": "https://api.github.com/users/estsauver/events{/privacy}", "received_events_url": "https://api.github.com/users/estsauver/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bed1e8c0a433f30f85a01cd74d2251c73f590a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bed1e8c0a433f30f85a01cd74d2251c73f590a2", "html_url": "https://github.com/rust-lang/rust/commit/4bed1e8c0a433f30f85a01cd74d2251c73f590a2"}], "stats": {"total": 29, "additions": 9, "deletions": 20}, "files": [{"sha": "0dbd13b4616bb36bf91f6d8ed1dde08202eb5cbd", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 8, "deletions": 17, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "patch": "@@ -30,7 +30,7 @@\n use libc;\n use std::ascii::AsciiExt;\n use std::ffi::CString;\n-use std::cell::{RefCell, Cell};\n+use std::cell::RefCell;\n use std::collections::HashMap;\n use std::fmt;\n use std::slice;\n@@ -155,7 +155,6 @@ fn stripped_filtered_line<'a>(s: &'a str) -> Option<&'a str> {\n thread_local!(static USED_HEADER_MAP: RefCell<HashMap<String, uint>> = {\n     RefCell::new(HashMap::new())\n });\n-thread_local!(static TEST_IDX: Cell<uint> = Cell::new(0));\n \n thread_local!(pub static PLAYGROUND_KRATE: RefCell<Option<Option<String>>> = {\n     RefCell::new(None)\n@@ -195,26 +194,19 @@ pub fn render(w: &mut fmt::Formatter, s: &str, print_toc: bool) -> fmt::Result {\n             if rendered { return }\n             PLAYGROUND_KRATE.with(|krate| {\n                 let mut s = String::new();\n-                let id = krate.borrow().as_ref().map(|krate| {\n-                    let idx = TEST_IDX.with(|slot| {\n-                        let i = slot.get();\n-                        slot.set(i + 1);\n-                        i\n-                    });\n-\n+                krate.borrow().as_ref().map(|krate| {\n                     let test = origtext.lines().map(|l| {\n                         stripped_filtered_line(l).unwrap_or(l)\n                     }).collect::<Vec<&str>>().connect(\"\\n\");\n                     let krate = krate.as_ref().map(|s| s.as_slice());\n                     let test = test::maketest(test.as_slice(), krate, false, false);\n-                    s.push_str(format!(\"<span id='rust-example-raw-{}' \\\n-                                         class='rusttest'>{}</span>\",\n-                                       idx, Escape(test.as_slice())).as_slice());\n-                    format!(\"rust-example-rendered-{}\", idx)\n+                    s.push_str(format!(\"<span class='rusttest'>{}</span>\",\n+                                         Escape(test.as_slice())).as_slice());\n                 });\n-                let id = id.as_ref().map(|a| a.as_slice());\n-                s.push_str(highlight::highlight(text.as_slice(), None, id)\n-                                     .as_slice());\n+                s.push_str(highlight::highlight(text.as_slice(),\n+                                                None,\n+                                                Some(\"rust-example-rendered\"))\n+                             .as_slice());\n                 let output = CString::from_vec(s.into_bytes());\n                 hoedown_buffer_puts(ob, output.as_ptr());\n             })\n@@ -432,7 +424,6 @@ impl LangString {\n /// previous state (if any).\n pub fn reset_headers() {\n     USED_HEADER_MAP.with(|s| s.borrow_mut().clear());\n-    TEST_IDX.with(|s| s.set(0));\n }\n \n impl<'a> fmt::String for Markdown<'a> {"}, {"sha": "687f764f02077a10cc0df749585984d9e08030b7", "filename": "src/librustdoc/html/static/playpen.js", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fplaypen.js", "raw_url": "https://github.com/rust-lang/rust/raw/2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fplaypen.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fplaypen.js?ref=2a320f21d0e5f943b9cd02bb7882531bfb7ef0b9", "patch": "@@ -14,10 +14,8 @@\n (function() {\n     if (window.playgroundUrl) {\n         $('pre.rust').hover(function() {\n-            if (!$(this).attr('id')) { return; }\n-            var id = '#' + $(this).attr('id').replace('rendered', 'raw');\n             var a = $('<a>').text('\u21f1').attr('class', 'test-arrow');\n-            var code = $(id).text();\n+            var code = $(this).siblings(\".rusttest\").text();\n             a.attr('href', window.playgroundUrl + '?code=' +\n                            encodeURIComponent(code));\n             a.attr('target', '_blank');"}]}