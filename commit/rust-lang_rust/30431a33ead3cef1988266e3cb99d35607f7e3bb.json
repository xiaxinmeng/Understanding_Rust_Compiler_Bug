{"sha": "30431a33ead3cef1988266e3cb99d35607f7e3bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwNDMxYTMzZWFkM2NlZjE5ODgyNjZlM2NiOTlkMzU2MDdmN2UzYmI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-10-28T20:36:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-28T20:36:08Z"}, "message": "Rollup merge of #65893 - jafern14:let-expr-stable-error-messaging, r=Centril\n\nOutput previous stable  error messaging when using stable build.\n\nFixes #65254\n\nAs I had mentioned previously there I have the logic running right now however I'm not getting the exact same syntax highlighting as there was originally for this error.\n\nI'm currently getting the following:\n```\nerror: expected expression, found statement (`let`)\n --> src/main.rs:2:14\n  |\n2 |     let x = (let y = 6);\n  |              ^^^^^^^^^\n  |\n  = note: variable declaration using `let` is a statement\n```\n\nI'd like to get the following instead:\n\n```\n  |     let x = (let y = 6);\n  |              ^^^\n```\n\nMy current understanding is that the `span` being passed into `lower_expr_let` is coming from `lowering.rs`. I still don't know how the byte range is calculated for the erroneous syntax and need to look into it a bit more. In the meantime does anybody have any hints/tips regarding this??", "tree": {"sha": "2077cb9f1ca4643f57ae5ce4b0ee400672963880", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2077cb9f1ca4643f57ae5ce4b0ee400672963880"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30431a33ead3cef1988266e3cb99d35607f7e3bb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdt1E5CRBK7hj4Ov3rIwAAdHIIAIuPKxakN9TjyxE3xLDKuIVw\njfkPUWictdeLDg1DV0sdaXZrjwqpaMc2gSDM9pZMYHkLcnCT7iffZni1ghx/948z\nTBK19Xlj56EGvt8DLuLmzaxFz7ab4bqz30a9vxBu/CXnrilk65E37EfrfcWRfMnV\n2ypunQ/MvYu+frKYX+04Raej3O0GItrbR3gf6VrXl/JzQRhaI4ObHyxOYus7HP2/\ncAMIO7Qu8q/mawZpwbCXHd2ubLkklckpiKBd26xDY6F9NDvTA4SAjHkZFuCbTiUl\nmZ6SDt8ekJgJCIlV3k9g4lx7MwFyHyNxYZa19gDz6/4zqeu/ME4V4Y8VwiuhlIs=\n=Pyr2\n-----END PGP SIGNATURE-----\n", "payload": "tree 2077cb9f1ca4643f57ae5ce4b0ee400672963880\nparent 545166435cfcc10bb5665c693566e012834d4093\nparent f1aa8b2c01a97b0114f84b2d557e4598e6070515\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1572294968 +0100\ncommitter GitHub <noreply@github.com> 1572294968 +0100\n\nRollup merge of #65893 - jafern14:let-expr-stable-error-messaging, r=Centril\n\nOutput previous stable  error messaging when using stable build.\n\nFixes #65254\n\nAs I had mentioned previously there I have the logic running right now however I'm not getting the exact same syntax highlighting as there was originally for this error.\n\nI'm currently getting the following:\n```\nerror: expected expression, found statement (`let`)\n --> src/main.rs:2:14\n  |\n2 |     let x = (let y = 6);\n  |              ^^^^^^^^^\n  |\n  = note: variable declaration using `let` is a statement\n```\n\nI'd like to get the following instead:\n\n```\n  |     let x = (let y = 6);\n  |              ^^^\n```\n\nMy current understanding is that the `span` being passed into `lower_expr_let` is coming from `lowering.rs`. I still don't know how the byte range is calculated for the erroneous syntax and need to look into it a bit more. In the meantime does anybody have any hints/tips regarding this??\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30431a33ead3cef1988266e3cb99d35607f7e3bb", "html_url": "https://github.com/rust-lang/rust/commit/30431a33ead3cef1988266e3cb99d35607f7e3bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30431a33ead3cef1988266e3cb99d35607f7e3bb/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "545166435cfcc10bb5665c693566e012834d4093", "url": "https://api.github.com/repos/rust-lang/rust/commits/545166435cfcc10bb5665c693566e012834d4093", "html_url": "https://github.com/rust-lang/rust/commit/545166435cfcc10bb5665c693566e012834d4093"}, {"sha": "f1aa8b2c01a97b0114f84b2d557e4598e6070515", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1aa8b2c01a97b0114f84b2d557e4598e6070515", "html_url": "https://github.com/rust-lang/rust/commit/f1aa8b2c01a97b0114f84b2d557e4598e6070515"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "73db762a64bda22d905ddb23135b1bedef35b723", "filename": "src/librustc/hir/lowering/expr.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/30431a33ead3cef1988266e3cb99d35607f7e3bb/src%2Flibrustc%2Fhir%2Flowering%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30431a33ead3cef1988266e3cb99d35607f7e3bb/src%2Flibrustc%2Fhir%2Flowering%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering%2Fexpr.rs?ref=30431a33ead3cef1988266e3cb99d35607f7e3bb", "patch": "@@ -235,11 +235,20 @@ impl LoweringContext<'_> {\n     /// ```\n     fn lower_expr_let(&mut self, span: Span, pat: &Pat, scrutinee: &Expr) -> hir::ExprKind {\n         // If we got here, the `let` expression is not allowed.\n-        self.sess\n-            .struct_span_err(span, \"`let` expressions are not supported here\")\n-            .note(\"only supported directly in conditions of `if`- and `while`-expressions\")\n-            .note(\"as well as when nested within `&&` and parenthesis in those conditions\")\n-            .emit();\n+\n+        if self.sess.opts.unstable_features.is_nightly_build() {\n+            self.sess\n+                .struct_span_err(span, \"`let` expressions are not supported here\")\n+                .note(\"only supported directly in conditions of `if`- and `while`-expressions\")\n+                .note(\"as well as when nested within `&&` and parenthesis in those conditions\")\n+                .emit();\n+        }\n+        else {\n+            self.sess\n+                .struct_span_err(span, \"expected expression, found statement (`let`)\")\n+                .note(\"variable declaration using `let` is a statement\")\n+                .emit();\n+        }\n \n         // For better recovery, we emit:\n         // ```"}]}