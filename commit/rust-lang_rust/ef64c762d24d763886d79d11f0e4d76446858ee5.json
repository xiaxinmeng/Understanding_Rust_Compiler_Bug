{"sha": "ef64c762d24d763886d79d11f0e4d76446858ee5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmNjRjNzYyZDI0ZDc2Mzg4NmQ3OWQxMWYwZTRkNzY0NDY4NThlZTU=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-12-03T07:12:35Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-12-03T07:12:35Z"}, "message": "Fix wildcard_dependencies false positive\n\nThis now only checks for wildcard_dependencies if the source is a\nnon-git source.\n\nI tried adding a compiletest suite for the cargo lints, but I was unable\nto override the `Cargo.toml` of the original executable.\n\nI tested this manually by modifying the main `Cargo.toml`.\n\nFixes #3458", "tree": {"sha": "0f960da3d01759abb1251374fde5bc4d7f345c83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f960da3d01759abb1251374fde5bc4d7f345c83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef64c762d24d763886d79d11f0e4d76446858ee5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlwE190ACgkQtvoGpuDi\nZlsgOw/+N6WitUtG9MzOD5a2fUjo4SaH279K9dUhyxfR7Na+S4s90ztxPDzHiuPf\nDRH/0HMkQCJklr/jI/GqGVDGtA3rKbQHPGijl2aNHCZ4FIF9UVOtu5OUTXW6AyJf\nrRv2JBfAJQXce3DZMmrsYI9bZIpWfQ2N8Q4XE1gp/yRp9jK0CM3jtEvVOOcuycq3\n/+cNGkNTz4MAbK/PI3qXyQ1f2xlXaAccrW1NK+KuhOkplrjJpV/Vp00KXaDQJPpP\n6VqsyFFNqjSOOfESDcfzZGdJvNukDvrw1F+HYLQ1jEojHDmWQ7a0A0JNsZ0aeLkI\niLexDYhQ/ZDWZhM3IbocacmUyw/N670SIBJ1KVFypMxynQ3WOe1r3xkUIh4NdwNm\npP7ackK+PB6+/vVsT121F2ymJXwvqvE8jQwflb4uIsVC+bch3Vc1kBpYIKJerGlZ\nBc6cOg4WXACyAu/wyd42Uvxdi6hHZyE8lqbKIkksDiVFvfQU/20vnD2BJB3+2ML0\n75yiL48A0WZNl/pNLiAgHXgKHQQedP4ex+sMuofO5HRRBcmYb45OxYbP7eVeynXS\nJI7dIhFOOYwWVvnDGov/oThH3wyKsPc4BivB2rIlFIlqHNTiQ7UTxbwuf2z4H+D1\nZhgADWTPPDfguednwK0yMwKJKvBnOibHH79I5X4mPsGUfmYK460=\n=c1dR\n-----END PGP SIGNATURE-----", "payload": "tree 0f960da3d01759abb1251374fde5bc4d7f345c83\nparent 6253d457e1c558d5580bdd6dfd35cccead31f3ac\nauthor Philipp Hansch <dev@phansch.net> 1543821155 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1543821155 +0100\n\nFix wildcard_dependencies false positive\n\nThis now only checks for wildcard_dependencies if the source is a\nnon-git source.\n\nI tried adding a compiletest suite for the cargo lints, but I was unable\nto override the `Cargo.toml` of the original executable.\n\nI tested this manually by modifying the main `Cargo.toml`.\n\nFixes #3458\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef64c762d24d763886d79d11f0e4d76446858ee5", "html_url": "https://github.com/rust-lang/rust/commit/ef64c762d24d763886d79d11f0e4d76446858ee5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef64c762d24d763886d79d11f0e4d76446858ee5/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6253d457e1c558d5580bdd6dfd35cccead31f3ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/6253d457e1c558d5580bdd6dfd35cccead31f3ac", "html_url": "https://github.com/rust-lang/rust/commit/6253d457e1c558d5580bdd6dfd35cccead31f3ac"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "d7178f1f11a36a83f2fb9fb0807a09f662cb06e9", "filename": "clippy_lints/src/wildcard_dependencies.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ef64c762d24d763886d79d11f0e4d76446858ee5/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef64c762d24d763886d79d11f0e4d76446858ee5/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs?ref=ef64c762d24d763886d79d11f0e4d76446858ee5", "patch": "@@ -12,6 +12,7 @@ use crate::rustc::{declare_tool_lint, lint_array};\n use crate::syntax::{ast::*, source_map::DUMMY_SP};\n use crate::utils::span_lint;\n \n+use if_chain::if_chain;\n use cargo_metadata;\n use semver;\n \n@@ -54,8 +55,12 @@ impl EarlyLintPass for Pass {\n \n         for dep in &metadata.packages[0].dependencies {\n             // VersionReq::any() does not work\n-            if let Ok(wildcard_ver) = semver::VersionReq::parse(\"*\") {\n-                if dep.req == wildcard_ver {\n+            if_chain! {\n+                if let Ok(wildcard_ver) = semver::VersionReq::parse(\"*\");\n+                if let Some(ref source) = dep.source;\n+                if !source.starts_with(\"git\");\n+                if dep.req == wildcard_ver;\n+                then {\n                     span_lint(\n                         cx,\n                         WILDCARD_DEPENDENCIES,"}]}