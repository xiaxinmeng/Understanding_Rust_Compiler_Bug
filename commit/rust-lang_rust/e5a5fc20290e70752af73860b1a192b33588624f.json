{"sha": "e5a5fc20290e70752af73860b1a192b33588624f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1YTVmYzIwMjkwZTcwNzUyYWY3Mzg2MGIxYTE5MmIzMzU4ODYyNGY=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-06-13T22:46:57Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-06-13T22:52:00Z"}, "message": "Allow impls to be re-exported\n\nIt was a little hard for me to believe, but it seems that re-exporting\nan impl doesn't work at a, because encoder::encode_info_for_mod requires\nthat all the impls in the current module's impl map be local (that is,\nbound to a value in the current crate's item map). Fixed it.\n\nCloses #2414.", "tree": {"sha": "60c477cadde42dad623af8d40eaf66c3b30c26d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60c477cadde42dad623af8d40eaf66c3b30c26d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5a5fc20290e70752af73860b1a192b33588624f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5a5fc20290e70752af73860b1a192b33588624f", "html_url": "https://github.com/rust-lang/rust/commit/e5a5fc20290e70752af73860b1a192b33588624f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5a5fc20290e70752af73860b1a192b33588624f/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1db8515c08b76aaf0d10002f6d574a75465fc252", "url": "https://api.github.com/repos/rust-lang/rust/commits/1db8515c08b76aaf0d10002f6d574a75465fc252", "html_url": "https://github.com/rust-lang/rust/commit/1db8515c08b76aaf0d10002f6d574a75465fc252"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "9ad1ef1a4e1d49d3cc912248a4db376e0f260ac2", "filename": "src/rustc/metadata/encoder.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e5a5fc20290e70752af73860b1a192b33588624f/src%2Frustc%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5a5fc20290e70752af73860b1a192b33588624f/src%2Frustc%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmetadata%2Fencoder.rs?ref=e5a5fc20290e70752af73860b1a192b33588624f", "patch": "@@ -396,17 +396,21 @@ fn encode_info_for_mod(ecx: @encode_ctxt, ebml_w: ebml::writer, md: _mod,\n         let (ident, did) = i;\n         if ast_util::is_exported(ident, md) {\n             ebml_w.start_tag(tag_mod_impl);\n+            alt ecx.tcx.items.find(did.node) {\n+              some(ast_map::node_item(it@@{node: cl@item_class(*),_},_)) {\n             /* If did stands for an iface\n             ref, we need to map it to its parent class */\n-            alt ecx.tcx.items.get(did.node) {\n-              ast_map::node_item(it@@{node: cl@item_class(*),_},_) {\n                 ebml_w.wr_str(def_to_str(local_def(it.id)));\n               }\n-              ast_map::node_item(@{node: item_impl(_,_,\n-                                                   some(ifce),_,_),_},_) {\n+              some(ast_map::node_item(@{node: item_impl(_,_,\n+                                                   some(ifce),_,_),_},_)) {\n                 ebml_w.wr_str(def_to_str(did));\n               }\n-              _ {\n+              some(_) {\n+                ebml_w.wr_str(def_to_str(did));\n+              }\n+              none {\n+                // Must be a re-export, then!\n                 ebml_w.wr_str(def_to_str(did));\n               }\n             };"}, {"sha": "0f4b51a8dad4e995106ee0f71c6d08e56e770586", "filename": "src/test/auxiliary/issue-2414-a.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Fauxiliary%2Fissue-2414-a.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Fauxiliary%2Fissue-2414-a.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fissue-2414-a.rs?ref=e5a5fc20290e70752af73860b1a192b33588624f", "patch": "@@ -0,0 +1,5 @@\n+#[link(name = \"a\", vers = \"0.1\")];\n+#[crate_type = \"lib\"];\n+\n+type t1 = uint;\n+impl t2 for str { }"}, {"sha": "b5a27c6fabc451844c1f4dcbab9839f0080ea2c9", "filename": "src/test/auxiliary/issue-2414-b.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Fauxiliary%2Fissue-2414-b.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Fauxiliary%2Fissue-2414-b.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fissue-2414-b.rs?ref=e5a5fc20290e70752af73860b1a192b33588624f", "patch": "@@ -0,0 +1,9 @@\n+// xfail-fast\n+\n+#[link(name = \"b\", vers = \"0.1\")];\n+#[crate_type = \"lib\"];\n+\n+use a;\n+\n+import a::t2;\n+export t2;"}, {"sha": "17defc82e229c627f89474b2621f6f0f46ab402d", "filename": "src/test/run-pass/issue-2414-c.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Frun-pass%2Fissue-2414-c.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5a5fc20290e70752af73860b1a192b33588624f/src%2Ftest%2Frun-pass%2Fissue-2414-c.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-2414-c.rs?ref=e5a5fc20290e70752af73860b1a192b33588624f", "patch": "@@ -0,0 +1,7 @@\n+// xfail-fast\n+// aux-build:issue-2414-a.rs\n+// aux-build:issue-2414-b.rs\n+\n+use b;\n+\n+fn main() {}"}]}