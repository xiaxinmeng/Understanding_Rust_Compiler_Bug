{"sha": "7affcd5394b5c85b5dbdf13b388785998a772a26", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhZmZjZDUzOTRiNWM4NWI1ZGJkZjEzYjM4ODc4NTk5OGE3NzJhMjY=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-01-03T08:56:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-03T08:56:27Z"}, "message": "Rollup merge of #67783 - LeSeulArtichaut:pattern-ref-warning, r=Centril\n\nWarn for bindings named same as variants when matching against a borrow\n\nFixes #67776", "tree": {"sha": "9574b3e42e440a386658e0e4a3f1fe9fda121840", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9574b3e42e440a386658e0e4a3f1fe9fda121840"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7affcd5394b5c85b5dbdf13b388785998a772a26", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeDwG7CRBK7hj4Ov3rIwAAdHIIACbppjmWwNlmg0ko418XtmMX\n12g0XcKvqmJbEkI1Gwfy7k0Cs63kraSqDog3Z0jnU1x4z7oqnqziWf0ZVUxnTf92\ngTe/GcdU/TrPIiA134l2K0OrjkyGI5teFLwWCLLPXBMofSiPThnlA+G5Bxg1arBk\nRq9jqvSHE+nhLLlda/HEt6PQyAUKAH6ZxucBvBf/sazJjOyhKVHgQevZwsg/j5bH\nLvIVgXgTtaMErI0B0LRu/Fn/HRtrih2r1GdOS3BHCjXb54rbtYo6irS+tSDy9qRQ\nmfe6jde+Hfoim/zuNBKWOVGgO79Ko4Ji1tAK0/B7nQBe0FMeshYni7c6MyGYxc0=\n=CnLa\n-----END PGP SIGNATURE-----\n", "payload": "tree 9574b3e42e440a386658e0e4a3f1fe9fda121840\nparent aefc3cd3720935c305f12a339ca1069f65c8ae56\nparent 5cc9f6b70681617300655561b9ff49cc5e4a2a04\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1578041787 +0900\ncommitter GitHub <noreply@github.com> 1578041787 +0900\n\nRollup merge of #67783 - LeSeulArtichaut:pattern-ref-warning, r=Centril\n\nWarn for bindings named same as variants when matching against a borrow\n\nFixes #67776\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7affcd5394b5c85b5dbdf13b388785998a772a26", "html_url": "https://github.com/rust-lang/rust/commit/7affcd5394b5c85b5dbdf13b388785998a772a26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7affcd5394b5c85b5dbdf13b388785998a772a26/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aefc3cd3720935c305f12a339ca1069f65c8ae56", "url": "https://api.github.com/repos/rust-lang/rust/commits/aefc3cd3720935c305f12a339ca1069f65c8ae56", "html_url": "https://github.com/rust-lang/rust/commit/aefc3cd3720935c305f12a339ca1069f65c8ae56"}, {"sha": "5cc9f6b70681617300655561b9ff49cc5e4a2a04", "url": "https://api.github.com/repos/rust-lang/rust/commits/5cc9f6b70681617300655561b9ff49cc5e4a2a04", "html_url": "https://github.com/rust-lang/rust/commit/5cc9f6b70681617300655561b9ff49cc5e4a2a04"}], "stats": {"total": 80, "additions": 79, "deletions": 1}, "files": [{"sha": "bbbad36e4851db71204b327b83d0e8a9cfa55db4", "filename": "src/librustc_mir/hair/pattern/check_match.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fcheck_match.rs?ref=7affcd5394b5c85b5dbdf13b388785998a772a26", "patch": "@@ -284,7 +284,7 @@ fn check_for_bindings_named_same_as_variants(cx: &MatchVisitor<'_, '_>, pat: &Pa\n             if let Some(ty::BindByValue(hir::Mutability::Not)) =\n                 cx.tables.extract_binding_mode(cx.tcx.sess, p.hir_id, p.span)\n             {\n-                let pat_ty = cx.tables.pat_ty(p);\n+                let pat_ty = cx.tables.pat_ty(p).peel_refs();\n                 if let ty::Adt(edef, _) = pat_ty.kind {\n                     if edef.is_enum()\n                         && edef.variants.iter().any(|variant| {"}, {"sha": "6fd5768a5a26dd2e032ed6726fc13160155ef256", "filename": "src/test/ui/pattern/issue-67776-match-same-name-enum-variant-refs.rs", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.rs?ref=7affcd5394b5c85b5dbdf13b388785998a772a26", "patch": "@@ -0,0 +1,42 @@\n+// Test for issue #67776: binding named the same as enum variant\n+// should report a warning even when matching against a reference type\n+\n+// check-pass\n+\n+#![allow(unused_variables)]\n+#![allow(non_snake_case)]\n+\n+enum Foo {\n+    Bar,\n+    Baz,\n+}\n+\n+\n+fn fn1(e: Foo) {\n+    match e {\n+        Bar => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+        Baz => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+    }\n+}\n+\n+fn fn2(e: &Foo) {\n+    match e {\n+        Bar => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+        Baz => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+    }\n+}\n+\n+fn fn3(e: &mut &&mut Foo) {\n+    match e {\n+        Bar => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+        Baz => {},\n+        //~^ WARNING named the same as one of the variants of the type `Foo`\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "abb8d6907e76d85c957689f993387d7612293213", "filename": "src/test/ui/pattern/issue-67776-match-same-name-enum-variant-refs.stderr", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7affcd5394b5c85b5dbdf13b388785998a772a26/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpattern%2Fissue-67776-match-same-name-enum-variant-refs.stderr?ref=7affcd5394b5c85b5dbdf13b388785998a772a26", "patch": "@@ -0,0 +1,36 @@\n+warning[E0170]: pattern binding `Bar` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:17:9\n+   |\n+LL |         Bar => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Bar`\n+\n+warning[E0170]: pattern binding `Baz` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:19:9\n+   |\n+LL |         Baz => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Baz`\n+\n+warning[E0170]: pattern binding `Bar` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:26:9\n+   |\n+LL |         Bar => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Bar`\n+\n+warning[E0170]: pattern binding `Baz` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:28:9\n+   |\n+LL |         Baz => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Baz`\n+\n+warning[E0170]: pattern binding `Bar` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:35:9\n+   |\n+LL |         Bar => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Bar`\n+\n+warning[E0170]: pattern binding `Baz` is named the same as one of the variants of the type `Foo`\n+  --> $DIR/issue-67776-match-same-name-enum-variant-refs.rs:37:9\n+   |\n+LL |         Baz => {},\n+   |         ^^^ help: to match on the variant, qualify the path: `Foo::Baz`\n+"}]}