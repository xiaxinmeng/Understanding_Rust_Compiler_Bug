{"sha": "5c1e30ab05841af32e206c8111f5343be3475a90", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjMWUzMGFiMDU4NDFhZjMyZTIwNmM4MTExZjUzNDNiZTM0NzVhOTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-03T14:06:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-03T14:06:13Z"}, "message": "Auto merge of #4327 - phansch:doctests_perf, r=flip1995\n\nDoctests: Enable running doc tests for perf lints\n\nchangelog: none\n\nThis should be possible to merge independently of #4325\n\ncc #4319", "tree": {"sha": "7d6cd8f1f4dfc53bda9cd28a37a650ddd87094d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d6cd8f1f4dfc53bda9cd28a37a650ddd87094d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c1e30ab05841af32e206c8111f5343be3475a90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c1e30ab05841af32e206c8111f5343be3475a90", "html_url": "https://github.com/rust-lang/rust/commit/5c1e30ab05841af32e206c8111f5343be3475a90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c1e30ab05841af32e206c8111f5343be3475a90/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3dc91838e466a2b972fa91b3dfe0211412858244", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dc91838e466a2b972fa91b3dfe0211412858244", "html_url": "https://github.com/rust-lang/rust/commit/3dc91838e466a2b972fa91b3dfe0211412858244"}, {"sha": "c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "html_url": "https://github.com/rust-lang/rust/commit/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d"}], "stats": {"total": 97, "additions": 65, "deletions": 32}, "files": [{"sha": "ab9cf951261748c0a6d816c55a4b08cf9e53b02b", "filename": "clippy_lints/src/bytecount.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fbytecount.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fbytecount.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbytecount.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -24,7 +24,8 @@ declare_clippy_lint! {\n     /// **Example:**\n     ///\n     /// ```rust\n-    /// &my_data.filter(|&x| x == 0u8).count() // use bytecount::count instead\n+    /// # let vec = vec![1_u8];\n+    /// &vec.iter().filter(|x| **x == 0u8).count(); // use bytecount::count instead\n     /// ```\n     pub NAIVE_BYTECOUNT,\n     perf,"}, {"sha": "e6b09f89b3530192962ae587c9653150325e0867", "filename": "clippy_lints/src/entry.rs", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fentry.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -16,21 +16,32 @@ declare_clippy_lint! {\n     ///\n     /// **Known problems:** Some false negatives, eg.:\n     /// ```rust\n-    /// let k = &key;\n-    /// if !m.contains_key(k) {\n-    ///     m.insert(k.clone(), v);\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let v = 1;\n+    /// # let k = 1;\n+    /// if !map.contains_key(&k) {\n+    ///     map.insert(k.clone(), v);\n     /// }\n     /// ```\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// if !m.contains_key(&k) {\n-    ///     m.insert(k, v)\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let k = 1;\n+    /// # let v = 1;\n+    /// if !map.contains_key(&k) {\n+    ///     map.insert(k, v);\n     /// }\n     /// ```\n-    /// can be rewritten as:\n+    /// can both be rewritten as:\n     /// ```rust\n-    /// m.entry(k).or_insert(v);\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let k = 1;\n+    /// # let v = 1;\n+    /// map.entry(k).or_insert(v);\n     /// ```\n     pub MAP_ENTRY,\n     perf,"}, {"sha": "c37efbd6e49dafe17f6a6072781f850c91c2247e", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -28,11 +28,10 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// fn main() {\n-    ///     let x = Box::new(1);\n-    ///     foo(*x);\n-    ///     println!(\"{}\", *x);\n-    /// }\n+    /// # fn foo(bar: usize) {}\n+    /// let x = Box::new(1);\n+    /// foo(*x);\n+    /// println!(\"{}\", *x);\n     /// ```\n     pub BOXED_LOCAL,\n     perf,"}, {"sha": "86a32a69e6e3608e0c9e942c94d5f5a3f66b13af", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -105,7 +105,7 @@ macro_rules! declare_clippy_lint {\n     };\n     { $(#[$attr:meta])* pub $name:tt, perf, $description:tt } => {\n         declare_tool_lint! {\n-            pub clippy::$name, Warn, $description, report_in_external_macro: true\n+            $(#[$attr])* pub clippy::$name, Warn, $description, report_in_external_macro: true\n         }\n     };\n     { $(#[$attr:meta])* pub $name:tt, pedantic, $description:tt } => {\n@@ -120,7 +120,7 @@ macro_rules! declare_clippy_lint {\n     };\n     { $(#[$attr:meta])* pub $name:tt, cargo, $description:tt } => {\n         declare_tool_lint! {\n-            pub clippy::$name, Allow, $description, report_in_external_macro: true\n+            $(#[$attr])* pub clippy::$name, Allow, $description, report_in_external_macro: true\n         }\n     };\n     { $(#[$attr:meta])* pub $name:tt, nursery, $description:tt } => {"}, {"sha": "e1a949c04c1a7189c5029ed6eb73556de009f29e", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -41,7 +41,9 @@ declare_clippy_lint! {\n     /// **Known problems:** None.\n     ///\n     /// **Example:**\n-    /// ```ignore\n+    /// ```rust\n+    /// # let src = vec![1];\n+    /// # let mut dst = vec![0; 65];\n     /// for i in 0..src.len() {\n     ///     dst[i + 64] = src[i];\n     /// }\n@@ -265,8 +267,9 @@ declare_clippy_lint! {\n     /// None\n     ///\n     /// **Example:**\n-    /// ```ignore\n-    /// let len = iterator.collect::<Vec<_>>().len();\n+    /// ```rust\n+    /// # let iterator = vec![1].into_iter();\n+    /// let len = iterator.clone().collect::<Vec<_>>().len();\n     /// // should be\n     /// let len = iterator.count();\n     /// ```"}, {"sha": "2a52ad58df8306d492a76717d5da1e039a1a6db1", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -386,15 +386,18 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// foo.unwrap_or(String::new())\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or(String::new());\n     /// ```\n     /// this can instead be written:\n     /// ```rust\n-    /// foo.unwrap_or_else(String::new)\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or_else(String::new);\n     /// ```\n     /// or\n     /// ```rust\n-    /// foo.unwrap_or_default()\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or_default();\n     /// ```\n     pub OR_FUN_CALL,\n     perf,\n@@ -412,15 +415,24 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// foo.expect(&format!(\"Err {}: {}\", err_code, err_msg))\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.expect(&format!(\"Err {}: {}\", err_code, err_msg));\n     /// ```\n     /// or\n     /// ```rust\n-    /// foo.expect(format!(\"Err {}: {}\", err_code, err_msg).as_str())\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.expect(format!(\"Err {}: {}\", err_code, err_msg).as_str());\n     /// ```\n     /// this can instead be written:\n     /// ```rust\n-    /// foo.unwrap_or_else(|_| panic!(\"Err {}: {}\", err_code, err_msg))\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.unwrap_or_else(|| panic!(\"Err {}: {}\", err_code, err_msg));\n     /// ```\n     pub EXPECT_FUN_CALL,\n     perf,"}, {"sha": "dec3cd0fb42dd1b02c98c67e1ca10ae95e4e6d7e", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -101,7 +101,9 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// x.to_owned() == y\n+    /// # let x = \"foo\";\n+    /// # let y = String::from(\"foo\");\n+    /// if x.to_owned() == y {}\n     /// ```\n     pub CMP_OWNED,\n     perf,"}, {"sha": "bf76e0ff369aabf8b752d03dfa991f2e378c52ec", "filename": "clippy_lints/src/mutex_atomic.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmutex_atomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fmutex_atomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmutex_atomic.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -22,6 +22,8 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n+    /// # use std::sync::Mutex;\n+    /// # let y = 1;\n     /// let x = Mutex::new(&y);\n     /// ```\n     pub MUTEX_ATOMIC,"}, {"sha": "7e543bfe60f7239cd9ae184350b6506368a9d9aa", "filename": "clippy_lints/src/slow_vector_initialization.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -19,6 +19,8 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n+    /// # use core::iter::repeat;\n+    /// # let len = 4;\n     /// let mut vec1 = Vec::with_capacity(len);\n     /// vec1.resize(len, 0);\n     ///"}, {"sha": "be79fc2fb81fb20852f92560659a80c1829656ca", "filename": "clippy_lints/src/trivially_copy_pass_by_ref.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c1e30ab05841af32e206c8111f5343be3475a90/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs?ref=5c1e30ab05841af32e206c8111f5343be3475a90", "patch": "@@ -39,14 +39,15 @@ declare_clippy_lint! {\n     /// each other.\n     ///\n     /// **Example:**\n+    ///\n+    /// ```rust\n+    /// // Bad\n+    /// fn foo(v: &u32) {}\n+    /// ```\n+    ///\n     /// ```rust\n-    /// fn foo(v: &u32) {\n-    ///     assert_eq!(v, 42);\n-    /// }\n-    /// // should be\n-    /// fn foo(v: u32) {\n-    ///     assert_eq!(v, 42);\n-    /// }\n+    /// // Better\n+    /// fn foo(v: u32) {}\n     /// ```\n     pub TRIVIALLY_COPY_PASS_BY_REF,\n     perf,"}]}