{"sha": "ccd2be5b91a5536bc18a90d20a77f10ac052e54c", "node_id": "C_kwDOAAsO6NoAKGNjZDJiZTViOTFhNTUzNmJjMThhOTBkMjBhNzdmMTBhYzA1MmU1NGM", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-10-04T20:01:50Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-10-04T22:04:52Z"}, "message": "fix busted JavaScript in error index generator\n\nThe old JavaScript didn't work. It filled the browser console\nwith \"e.previousElementSibling not defined\" errors, because\nit didn't account for the example-wrap div that a newer version\nof rustdoc added.\n\nAdditionally, it had copied versions of utility functions that\nhad been optimized in rustdoc main.js. This version updates those.", "tree": {"sha": "70a76ce0a5fbd1e6af3f3e8aec57622ce68d47ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70a76ce0a5fbd1e6af3f3e8aec57622ce68d47ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ccd2be5b91a5536bc18a90d20a77f10ac052e54c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ccd2be5b91a5536bc18a90d20a77f10ac052e54c", "html_url": "https://github.com/rust-lang/rust/commit/ccd2be5b91a5536bc18a90d20a77f10ac052e54c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ccd2be5b91a5536bc18a90d20a77f10ac052e54c/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3", "html_url": "https://github.com/rust-lang/rust/commit/175b8db73bfd078b4bcd3c28c8d6f51d5895ebf3"}], "stats": {"total": 53, "additions": 19, "deletions": 34}, "files": [{"sha": "0386d8be167ee22c94dcc65f732cdc0dcdffe819", "filename": "src/tools/error_index_generator/main.rs", "status": "modified", "additions": 19, "deletions": 34, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/ccd2be5b91a5536bc18a90d20a77f10ac052e54c/src%2Ftools%2Ferror_index_generator%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccd2be5b91a5536bc18a90d20a77f10ac052e54c/src%2Ftools%2Ferror_index_generator%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ferror_index_generator%2Fmain.rs?ref=ccd2be5b91a5536bc18a90d20a77f10ac052e54c", "patch": "@@ -143,56 +143,41 @@ impl Formatter for HTMLFormatter {\n             r##\"<script>\n function onEach(arr, func) {{\n     if (arr && arr.length > 0 && func) {{\n-        for (var i = 0; i < arr.length; i++) {{\n-            func(arr[i]);\n+        var length = arr.length;\n+        var i;\n+        for (i = 0; i < length; ++i) {{\n+            if (func(arr[i])) {{\n+                return true;\n+            }}\n         }}\n     }}\n+    return false;\n+}}\n+\n+function onEachLazy(lazyArray, func) {{\n+    return onEach(\n+        Array.prototype.slice.call(lazyArray),\n+        func);\n }}\n \n function hasClass(elem, className) {{\n-    if (elem && className && elem.className) {{\n-        var elemClass = elem.className;\n-        var start = elemClass.indexOf(className);\n-        if (start === -1) {{\n-            return false;\n-        }} else if (elemClass.length === className.length) {{\n-            return true;\n-        }} else {{\n-            if (start > 0 && elemClass[start - 1] !== ' ') {{\n-                return false;\n-            }}\n-            var end = start + className.length;\n-            if (end < elemClass.length && elemClass[end] !== ' ') {{\n-                return false;\n-            }}\n-            return true;\n-        }}\n-        if (start > 0 && elemClass[start - 1] !== ' ') {{\n-            return false;\n-        }}\n-        var end = start + className.length;\n-        if (end < elemClass.length && elemClass[end] !== ' ') {{\n-            return false;\n-        }}\n-        return true;\n-    }}\n-    return false;\n+    return elem && elem.classList && elem.classList.contains(className);\n }}\n \n-onEach(document.getElementsByClassName('rust-example-rendered'), function(e) {{\n+onEachLazy(document.getElementsByClassName('rust-example-rendered'), function(e) {{\n     if (hasClass(e, 'compile_fail')) {{\n         e.addEventListener(\"mouseover\", function(event) {{\n-            e.previousElementSibling.childNodes[0].style.color = '#f00';\n+            e.parentElement.previousElementSibling.childNodes[0].style.color = '#f00';\n         }});\n         e.addEventListener(\"mouseout\", function(event) {{\n-            e.previousElementSibling.childNodes[0].style.color = '';\n+            e.parentElement.previousElementSibling.childNodes[0].style.color = '';\n         }});\n     }} else if (hasClass(e, 'ignore')) {{\n         e.addEventListener(\"mouseover\", function(event) {{\n-            e.previousElementSibling.childNodes[0].style.color = '#ff9200';\n+            e.parentElement.previousElementSibling.childNodes[0].style.color = '#ff9200';\n         }});\n         e.addEventListener(\"mouseout\", function(event) {{\n-            e.previousElementSibling.childNodes[0].style.color = '';\n+            e.parentElement.previousElementSibling.childNodes[0].style.color = '';\n         }});\n     }}\n }});"}]}