{"sha": "1b7ea6d2d404833d0c5af44f750c45e95896df7a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiN2VhNmQyZDQwNDgzM2QwYzVhZjQ0Zjc1MGM0NWU5NTg5NmRmN2E=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-12-07T22:59:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-12-07T22:59:02Z"}, "message": "Rollup merge of #46526 - GuillaumeGomez:mobile-sidebar, r=QuietMisdreavus\n\nGreatly improve sidebar when width < 700px\n\nFixes #36531.\n\nr? @QuietMisdreavus\n\nA few screenshots:\n\n<img width=\"1440\" alt=\"screen shot 2017-12-06 at 00 41 36\" src=\"https://user-images.githubusercontent.com/3050060/33636875-6ad8b1a6-da1e-11e7-8d5b-d6d530ea5258.png\">\n<img width=\"1440\" alt=\"screen shot 2017-12-06 at 00 41 40\" src=\"https://user-images.githubusercontent.com/3050060/33636876-6af58196-da1e-11e7-82ab-b82768958037.png\">", "tree": {"sha": "2a57ecbee0c77cef8a04275177a8c9700f8a643e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a57ecbee0c77cef8a04275177a8c9700f8a643e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b7ea6d2d404833d0c5af44f750c45e95896df7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b7ea6d2d404833d0c5af44f750c45e95896df7a", "html_url": "https://github.com/rust-lang/rust/commit/1b7ea6d2d404833d0c5af44f750c45e95896df7a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b7ea6d2d404833d0c5af44f750c45e95896df7a/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "14f2bc0405a32dd9e19daf776ffeb59bd4de1b30", "url": "https://api.github.com/repos/rust-lang/rust/commits/14f2bc0405a32dd9e19daf776ffeb59bd4de1b30", "html_url": "https://github.com/rust-lang/rust/commit/14f2bc0405a32dd9e19daf776ffeb59bd4de1b30"}, {"sha": "423e5ac6f3ca61cd050277293dcae9faf9bd08f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/423e5ac6f3ca61cd050277293dcae9faf9bd08f5", "html_url": "https://github.com/rust-lang/rust/commit/423e5ac6f3ca61cd050277293dcae9faf9bd08f5"}], "stats": {"total": 81, "additions": 76, "deletions": 5}, "files": [{"sha": "61de5f4bc4c4500e9155024cb9edcb179ddf53a4", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=1b7ea6d2d404833d0c5af44f750c45e95896df7a", "patch": "@@ -65,6 +65,7 @@ r##\"<!DOCTYPE html>\n     {before_content}\n \n     <nav class=\"sidebar\">\n+        <div class=\"sidebar-menu\">&#9776;</div>\n         {logo}\n         {sidebar}\n     </nav>"}, {"sha": "d42faebd39e57a8acaffa98a8cb1f0c5e84bef27", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=1b7ea6d2d404833d0c5af44f750c45e95896df7a", "patch": "@@ -3542,6 +3542,7 @@ impl<'a> fmt::Display for Sidebar<'a> {\n         let cx = self.cx;\n         let it = self.item;\n         let parentlen = cx.current.len() - if it.is_mod() {1} else {0};\n+        let mut should_close = false;\n \n         if it.is_struct() || it.is_trait() || it.is_primitive() || it.is_union()\n             || it.is_enum() || it.is_mod() || it.is_typedef()\n@@ -3575,6 +3576,8 @@ impl<'a> fmt::Display for Sidebar<'a> {\n                 }\n             }\n \n+            write!(fmt, \"<div class=\\\"sidebar-elems\\\">\")?;\n+            should_close = true;\n             match it.inner {\n                 clean::StructItem(ref s) => sidebar_struct(fmt, it, s)?,\n                 clean::TraitItem(ref t) => sidebar_trait(fmt, it, t)?,\n@@ -3625,6 +3628,10 @@ impl<'a> fmt::Display for Sidebar<'a> {\n             write!(fmt, \"<script defer src=\\\"{path}sidebar-items.js\\\"></script>\",\n                    path = relpath)?;\n         }\n+        if should_close {\n+            // Closes sidebar-elems div.\n+            write!(fmt, \"</div>\")?;\n+        }\n \n         Ok(())\n     }"}, {"sha": "06e9cbbdf9a71118c65cf6b9510f66b96c499215", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 43, "deletions": 1, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=1b7ea6d2d404833d0c5af44f750c45e95896df7a", "patch": "@@ -106,6 +106,30 @@\n         return (elem.offsetParent === null)\n     }\n \n+    function showSidebar() {\n+        var elems = document.getElementsByClassName(\"sidebar-elems\")[0];\n+        if (elems) {\n+            elems.style.display = \"block\";\n+        }\n+        var sidebar = document.getElementsByClassName('sidebar')[0];\n+        sidebar.style.position = 'fixed';\n+        sidebar.style.width = '100%';\n+        sidebar.style.marginLeft = '0';\n+        document.getElementsByTagName(\"body\")[0].style.marginTop = '45px';\n+    }\n+\n+    function hideSidebar() {\n+        var elems = document.getElementsByClassName(\"sidebar-elems\")[0];\n+        if (elems) {\n+            elems.style.display = \"\";\n+        }\n+        var sidebar = document.getElementsByClassName('sidebar')[0];\n+        sidebar.style.position = '';\n+        sidebar.style.width = '';\n+        sidebar.style.marginLeft = '';\n+        document.getElementsByTagName(\"body\")[0].style.marginTop = '';\n+    }\n+\n     // used for special search precedence\n     var TY_PRIMITIVE = itemTypes.indexOf(\"primitive\");\n \n@@ -130,6 +154,8 @@\n     }\n \n     function highlightSourceLines(ev) {\n+        // If we're in mobile mode, we should add the sidebar in any case.\n+        hideSidebar();\n         var search = document.getElementById(\"search\");\n         var i, from, to, match = window.location.hash.match(/^#?(\\d+)(?:-(\\d+))?$/);\n         if (match) {\n@@ -1459,7 +1485,7 @@\n \n     // delayed sidebar rendering.\n     function initSidebarItems(items) {\n-        var sidebar = document.getElementsByClassName('sidebar')[0];\n+        var sidebar = document.getElementsByClassName('sidebar-elems')[0];\n         var current = window.sidebarCurrent;\n \n         function block(shortty, longty) {\n@@ -1829,6 +1855,22 @@\n         removeClass(search, \"hidden\");\n         search.innerHTML = '<h3 style=\"text-align: center;\">Loading search results...</h3>';\n     }\n+\n+    var sidebar_menu = document.getElementsByClassName(\"sidebar-menu\")[0];\n+    if (sidebar_menu) {\n+        sidebar_menu.onclick = function() {\n+            var sidebar = document.getElementsByClassName('sidebar')[0];\n+            if (sidebar.style.position === \"fixed\") {\n+                hideSidebar();\n+            } else {\n+                showSidebar();\n+            }\n+        };\n+    }\n+\n+    window.onresize = function() {\n+        hideSidebar();\n+    };\n }());\n \n // Sets the focus on the search bar at the top of the page"}, {"sha": "b342df6a464aed299363bc4843d4b08a695d235b", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 25, "deletions": 4, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/1b7ea6d2d404833d0c5af44f750c45e95896df7a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=1b7ea6d2d404833d0c5af44f750c45e95896df7a", "patch": "@@ -263,6 +263,10 @@ nav.sub {\n \twidth: 100%;\n }\n \n+.sidebar-menu {\n+\tdisplay: none;\n+}\n+\n .content {\n \tpadding: 15px 0;\n }\n@@ -820,7 +824,7 @@ span.since {\n \t\tposition: static;\n \t}\n \n-\t.sidebar .location {\n+\t.sidebar > .location {\n \t\tfloat: right;\n \t\tmargin: 0px;\n \t\tmargin-top: 2px;\n@@ -840,16 +844,33 @@ span.since {\n \t\tmargin-top: 5px;\n \t\tmargin-bottom: 5px;\n \t\tfloat: left;\n+\t\tmargin-left: 50px;\n \t}\n \n-\tnav.sub {\n-\t\tmargin: 0 auto;\n+\t.sidebar-menu {\n+\t\tposition: absolute;\n+\t\tfont-size: 2rem;\n+\t\tcursor: pointer;\n+\t\tmargin-top: 2px;\n+\t\tdisplay: block;\n \t}\n \n-\t.sidebar .block {\n+\t.sidebar-elems {\n+\t\tbackground-color: #F1F1F1;\n+\t\tposition: fixed;\n+\t\tz-index: 1;\n+\t\tleft: 0;\n+\t\ttop: 45px;\n+\t\tbottom: 0;\n+\t\toverflow-y: auto;\n+\t\tborder-right: 1px solid #000;\n \t\tdisplay: none;\n \t}\n \n+\tnav.sub {\n+\t\tmargin: 0 auto;\n+\t}\n+\n \t.content {\n \t\tmargin-left: 0px;\n \t}"}]}