{"sha": "21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxZDRiYTJlYTY2ZWUyOTdlNTU2YWY5YjFlNGU5NjEzMGUyZTFiY2Y=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-09-22T14:37:46Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-09-23T11:16:21Z"}, "message": "add some comments", "tree": {"sha": "2a8b451321b6a1eb32accdb81586ce38d7c0b7b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a8b451321b6a1eb32accdb81586ce38d7c0b7b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf", "html_url": "https://github.com/rust-lang/rust/commit/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c30435be5b83a80e5e7c0f786fe7bb7b85b77086", "url": "https://api.github.com/repos/rust-lang/rust/commits/c30435be5b83a80e5e7c0f786fe7bb7b85b77086", "html_url": "https://github.com/rust-lang/rust/commit/c30435be5b83a80e5e7c0f786fe7bb7b85b77086"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "7110a1ba81d8f4888891ca60ef464136e54e662c", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=21d4ba2ea66ee297e556af9b1e4e96130e2e1bcf", "patch": "@@ -262,14 +262,24 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                 None\n             }\n             (_, &ty::TyRef(_, checked)) => {\n+                // We have `&T`, check if what was expected was `T`. If so,\n+                // we may want to suggest adding a `*`, or removing\n+                // a `&`.\n+                //\n+                // (But, also check check the `expn_info()` to see if this is\n+                // a macro; if so, it's hard to extract the text and make a good\n+                // suggestion, so don't bother.)\n                 if self.infcx.can_sub(self.param_env, checked.ty, &expected).is_ok() &&\n                    expr.span.ctxt().outer().expn_info().is_none() {\n                     match expr.node {\n+                        // Maybe remove `&`?\n                         hir::ExprAddrOf(_, ref expr) => {\n                             if let Ok(code) = self.tcx.sess.codemap().span_to_snippet(expr.span) {\n                                 return Some(format!(\"try with `{}`\", code));\n                             }\n                         }\n+\n+                        // Maybe add `*`? Only if `T: Copy`.\n                         _ => {\n                             if !self.infcx.type_moves_by_default(self.param_env,\n                                                                 checked.ty,"}]}