{"sha": "c35546383f89aa7255679f40094c9ad113c63dd6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzNTU0NjM4M2Y4OWFhNzI1NTY3OWY0MDA5NGM5YWQxMTNjNjNkZDY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-22T01:40:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-22T01:40:06Z"}, "message": "Rollup merge of #67500 - JohnTitor:non-shorthand-field-patterns, r=Centril\n\nTweak non_shorthand_field_patterns' suggestion\n\nFixes #66434\n\nr? @estebank", "tree": {"sha": "23ace79a6465d73ed212476effbb3ffa4d8726a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23ace79a6465d73ed212476effbb3ffa4d8726a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c35546383f89aa7255679f40094c9ad113c63dd6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd/sl2CRBK7hj4Ov3rIwAAdHIIAJwuyaEWkSVXv/i1CbLmYesE\nW+hqfF0zXqXwHht2uuzQCIqJEghoHsNubGJiprs2ESeZ3nlFGP/K6uK0N9geDgcn\na7DbgndWFbv0VupS1Qz2f4vGhNCJgdRrcUuUb7SImp4b1DXVwasccdPGvu1hJcEm\n9OeAPdH1esD2x1SvXcaGjADnpFnEcwq7hbRQULWCllkUJeA9nJOibOS+CUfBBuzf\n91l+QogkU5nprV6aVxUeCk4qDHkNcT4pxmZcNNwxc4mFxFkddJsiYll9gR8p3rHR\nlvVJvkgOB7hDg6AVqjEQv2s+qTTx5f86RMhBMMFQliumIeXp1jdVfRTp//OO6d8=\n=A6PP\n-----END PGP SIGNATURE-----\n", "payload": "tree 23ace79a6465d73ed212476effbb3ffa4d8726a9\nparent eaeb1138c6e4956a416e161ffc03eaf7db832101\nparent 30e84b02446e9906595e3053f537162c96fc7722\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1576978806 +0100\ncommitter GitHub <noreply@github.com> 1576978806 +0100\n\nRollup merge of #67500 - JohnTitor:non-shorthand-field-patterns, r=Centril\n\nTweak non_shorthand_field_patterns' suggestion\n\nFixes #66434\n\nr? @estebank\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c35546383f89aa7255679f40094c9ad113c63dd6", "html_url": "https://github.com/rust-lang/rust/commit/c35546383f89aa7255679f40094c9ad113c63dd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c35546383f89aa7255679f40094c9ad113c63dd6/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eaeb1138c6e4956a416e161ffc03eaf7db832101", "url": "https://api.github.com/repos/rust-lang/rust/commits/eaeb1138c6e4956a416e161ffc03eaf7db832101", "html_url": "https://github.com/rust-lang/rust/commit/eaeb1138c6e4956a416e161ffc03eaf7db832101"}, {"sha": "30e84b02446e9906595e3053f537162c96fc7722", "url": "https://api.github.com/repos/rust-lang/rust/commits/30e84b02446e9906595e3053f537162c96fc7722", "html_url": "https://github.com/rust-lang/rust/commit/30e84b02446e9906595e3053f537162c96fc7722"}], "stats": {"total": 151, "additions": 129, "deletions": 22}, "files": [{"sha": "6461263bf512311efab91040c5d0917a4886102f", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -174,18 +174,27 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NonShorthandFieldPatterns {\n                     // (Issue #49588)\n                     continue;\n                 }\n-                if let PatKind::Binding(_, _, ident, None) = fieldpat.pat.kind {\n+                if let PatKind::Binding(binding_annot, _, ident, None) = fieldpat.pat.kind {\n                     if cx.tcx.find_field_index(ident, &variant) ==\n                        Some(cx.tcx.field_index(fieldpat.hir_id, cx.tables)) {\n                         let mut err = cx.struct_span_lint(NON_SHORTHAND_FIELD_PATTERNS,\n                                      fieldpat.span,\n                                      &format!(\"the `{}:` in this pattern is redundant\", ident));\n-                        let subspan = cx.tcx.sess.source_map().span_through_char(fieldpat.span,\n-                                                                                 ':');\n-                        err.span_suggestion_short(\n-                            subspan,\n-                            \"remove this\",\n-                            ident.to_string(),\n+                        let binding = match binding_annot {\n+                            hir::BindingAnnotation::Unannotated => None,\n+                            hir::BindingAnnotation::Mutable => Some(\"mut\"),\n+                            hir::BindingAnnotation::Ref => Some(\"ref\"),\n+                            hir::BindingAnnotation::RefMut => Some(\"ref mut\"),\n+                        };\n+                        let ident = if let Some(binding) = binding {\n+                            format!(\"{} {}\", binding, ident)\n+                        } else {\n+                            ident.to_string()\n+                        };\n+                        err.span_suggestion(\n+                            fieldpat.span,\n+                            \"use shorthand field pattern\",\n+                            ident,\n                             Applicability::MachineApplicable\n                         );\n                         err.emit();"}, {"sha": "7cd5717bc5aac9c748f10583cace8e49c44dc3b7", "filename": "src/test/ui/lint/lint-shorthand-field.fixed", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.fixed?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -0,0 +1,70 @@\n+// run-rustfix\n+\n+#![allow(nonstandard_style, unused_variables, unused_mut)]\n+#![deny(non_shorthand_field_patterns)]\n+\n+struct Foo {\n+    x: isize,\n+    y: isize,\n+}\n+\n+fn main() {\n+    {\n+        let Foo {\n+            x, //~ ERROR the `x:` in this pattern is redundant\n+            ref y, //~ ERROR the `y:` in this pattern is redundant\n+        } = Foo { x: 0, y: 0 };\n+\n+        let Foo {\n+            x,\n+            ref y,\n+        } = Foo { x: 0, y: 0 };\n+    }\n+\n+    {\n+        const x: isize = 1;\n+\n+        match (Foo { x: 1, y: 1 }) {\n+            Foo { x: x, ..} => {},\n+            _ => {},\n+        }\n+    }\n+\n+    {\n+        struct Bar {\n+            x: x,\n+        }\n+\n+        struct x;\n+\n+        match (Bar { x: x }) {\n+            Bar { x: x } => {},\n+        }\n+    }\n+\n+    {\n+        struct Bar {\n+            x: Foo,\n+        }\n+\n+        enum Foo { x }\n+\n+        match (Bar { x: Foo::x }) {\n+            Bar { x: Foo::x } => {},\n+        }\n+    }\n+\n+    {\n+        struct Baz {\n+            x: isize,\n+            y: isize,\n+            z: isize,\n+        }\n+\n+        let Baz {\n+            mut x, //~ ERROR the `x:` in this pattern is redundant\n+            ref y, //~ ERROR the `y:` in this pattern is redundant\n+            ref mut z, //~ ERROR the `z:` in this pattern is redundant\n+        } = Baz { x: 0, y: 0, z: 0 };\n+    }\n+}"}, {"sha": "22de9c325459015cf653d6207779159b5372843a", "filename": "src/test/ui/lint/lint-shorthand-field.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.rs?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -1,4 +1,6 @@\n-#![allow(nonstandard_style, unused_variables)]\n+// run-rustfix\n+\n+#![allow(nonstandard_style, unused_variables, unused_mut)]\n #![deny(non_shorthand_field_patterns)]\n \n struct Foo {\n@@ -51,4 +53,18 @@ fn main() {\n             Bar { x: Foo::x } => {},\n         }\n     }\n+\n+    {\n+        struct Baz {\n+            x: isize,\n+            y: isize,\n+            z: isize,\n+        }\n+\n+        let Baz {\n+            x: mut x, //~ ERROR the `x:` in this pattern is redundant\n+            y: ref y, //~ ERROR the `y:` in this pattern is redundant\n+            z: ref mut z, //~ ERROR the `z:` in this pattern is redundant\n+        } = Baz { x: 0, y: 0, z: 0 };\n+    }\n }"}, {"sha": "5c9b21ffdc7b7b51771db49e33b41aebf2a3357a", "filename": "src/test/ui/lint/lint-shorthand-field.stderr", "status": "modified", "additions": 24, "deletions": 10, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-shorthand-field.stderr?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -1,24 +1,38 @@\n error: the `x:` in this pattern is redundant\n-  --> $DIR/lint-shorthand-field.rs:12:13\n+  --> $DIR/lint-shorthand-field.rs:14:13\n    |\n LL |             x: x,\n-   |             --^^\n-   |             |\n-   |             help: remove this\n+   |             ^^^^ help: use shorthand field pattern: `x`\n    |\n note: lint level defined here\n-  --> $DIR/lint-shorthand-field.rs:2:9\n+  --> $DIR/lint-shorthand-field.rs:4:9\n    |\n LL | #![deny(non_shorthand_field_patterns)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: the `y:` in this pattern is redundant\n-  --> $DIR/lint-shorthand-field.rs:13:13\n+  --> $DIR/lint-shorthand-field.rs:15:13\n    |\n LL |             y: ref y,\n-   |             --^^^^^^\n-   |             |\n-   |             help: remove this\n+   |             ^^^^^^^^ help: use shorthand field pattern: `ref y`\n \n-error: aborting due to 2 previous errors\n+error: the `x:` in this pattern is redundant\n+  --> $DIR/lint-shorthand-field.rs:65:13\n+   |\n+LL |             x: mut x,\n+   |             ^^^^^^^^ help: use shorthand field pattern: `mut x`\n+\n+error: the `y:` in this pattern is redundant\n+  --> $DIR/lint-shorthand-field.rs:66:13\n+   |\n+LL |             y: ref y,\n+   |             ^^^^^^^^ help: use shorthand field pattern: `ref y`\n+\n+error: the `z:` in this pattern is redundant\n+  --> $DIR/lint-shorthand-field.rs:67:13\n+   |\n+LL |             z: ref mut z,\n+   |             ^^^^^^^^^^^^ help: use shorthand field pattern: `ref mut z`\n+\n+error: aborting due to 5 previous errors\n "}, {"sha": "29297d08dcac4dcb059fc3948a62a0d575fd7bc5", "filename": "src/test/ui/lint/suggestions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -60,7 +60,7 @@ fn main() {\n         match d {\n             Equinox { warp_factor: warp_factor } => {}\n             //~^ WARN this pattern is redundant\n-            //~| HELP remove this\n+            //~| HELP use shorthand field pattern\n         }\n         println!(\"{} {}\", registry_no, b);\n     }"}, {"sha": "e42ee0fa6401cf57810185b32b7884bb780c3b6a", "filename": "src/test/ui/lint/suggestions.stderr", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c35546383f89aa7255679f40094c9ad113c63dd6/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr?ref=c35546383f89aa7255679f40094c9ad113c63dd6", "patch": "@@ -77,9 +77,7 @@ warning: the `warp_factor:` in this pattern is redundant\n   --> $DIR/suggestions.rs:61:23\n    |\n LL |             Equinox { warp_factor: warp_factor } => {}\n-   |                       ------------^^^^^^^^^^^^\n-   |                       |\n-   |                       help: remove this\n+   |                       ^^^^^^^^^^^^^^^^^^^^^^^^ help: use shorthand field pattern: `warp_factor`\n    |\n    = note: `#[warn(non_shorthand_field_patterns)]` on by default\n "}]}