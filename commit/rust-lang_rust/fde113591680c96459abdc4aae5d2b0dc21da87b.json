{"sha": "fde113591680c96459abdc4aae5d2b0dc21da87b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkZTExMzU5MTY4MGM5NjQ1OWFiZGM0YWFlNWQyYjBkYzIxZGE4N2I=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-10-01T15:25:54Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-10-01T15:30:24Z"}, "message": "build-manifest: avoid collecting SHAs in parallel on legacy mode\n\nThis avoids overloading the old server, and disrupting the other\nprograms running on it.", "tree": {"sha": "0e1241fee290b20b5cce8649ce6655cd14f4b881", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e1241fee290b20b5cce8649ce6655cd14f4b881"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fde113591680c96459abdc4aae5d2b0dc21da87b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl919hEACgkQPgar6Auq\n8ZwK2Q/9H5khWBfYM3rYgGlMBhRYGzsZf15gU2BuAxUuY0tmWbHvqc2At3Z0ZIvz\n+F/kyTLZHGbg2aEJNf724TV30nz0QqWlbA27mrZZq5uFGyWjz0qhMr6DQfEp8ltU\nwApMyEOOuvyhPddxBnHSbsTd/x01XQiPBypuM4808DMq2t0AwAZV1MEdUcFAEsng\nNHqKa8RnE1nGxIUFVOa+2GbahOGLAjCgmGpU4M8o8ZsJ8HYeZNyfefnse0sP9mE0\nLbOUXGUoNepd2/vh4Hl+KG/dyuusS5S93eFq0MtyW15kmVzGeeBgTGcPNVAnX3dO\nXqZgjPPtL1WdYSE7bZUx083COIoT/zFqUriybWajBQA3M43w3eCYSxb/PNSOsWri\nAxV15SE+cIz8DMxsBYehDw0N9nj2zFpRrKMvbjAjWDi8YoXwcYXhAgeMuYuJT1EE\n2/tlLdfYRrRUdljsWhtQTEZhm+YLf+llslDHkiHJBesJDJpOi2Bm4G3qmbXNv/bX\nVC3Xeo4dyy8qMFPDLauXUtwp3BgAPA4bzhKt2B7wDn9PypNGMDxNkb8WnNx6M2n7\nm90dxhfQXscJrp0u8ELrySU/Eqqo8t4l/xUJ8CRqYTTVqIFEDKU4QUhtkMII0BjM\nzqtVxH7gym6qma1crHwjRT7xXJdKauZ119rQF0N+9POS0UG9GBo=\n=WsVA\n-----END PGP SIGNATURE-----", "payload": "tree 0e1241fee290b20b5cce8649ce6655cd14f4b881\nparent acd8e59b6650deab3979e82b49c8c26e0f4ceefa\nauthor Pietro Albini <pietro@pietroalbini.org> 1601565954 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1601566224 +0200\n\nbuild-manifest: avoid collecting SHAs in parallel on legacy mode\n\nThis avoids overloading the old server, and disrupting the other\nprograms running on it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fde113591680c96459abdc4aae5d2b0dc21da87b", "html_url": "https://github.com/rust-lang/rust/commit/fde113591680c96459abdc4aae5d2b0dc21da87b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fde113591680c96459abdc4aae5d2b0dc21da87b/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acd8e59b6650deab3979e82b49c8c26e0f4ceefa", "url": "https://api.github.com/repos/rust-lang/rust/commits/acd8e59b6650deab3979e82b49c8c26e0f4ceefa", "html_url": "https://github.com/rust-lang/rust/commit/acd8e59b6650deab3979e82b49c8c26e0f4ceefa"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "1a698bbac053e5f01d531f4e30748e5ca27ef878", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fde113591680c96459abdc4aae5d2b0dc21da87b/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fde113591680c96459abdc4aae5d2b0dc21da87b/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=fde113591680c96459abdc4aae5d2b0dc21da87b", "patch": "@@ -207,6 +207,14 @@ fn main() {\n     // related code in this tool and ./x.py dist hash-and-sign can be removed.\n     let legacy = env::var(\"BUILD_MANIFEST_LEGACY\").is_ok();\n \n+    // Avoid overloading the old server in legacy mode.\n+    if legacy {\n+        rayon::ThreadPoolBuilder::new()\n+            .num_threads(1)\n+            .build_global()\n+            .expect(\"failed to initialize Rayon\");\n+    }\n+\n     let mut args = env::args().skip(1);\n     let input = PathBuf::from(args.next().unwrap());\n     let output = PathBuf::from(args.next().unwrap());"}]}