{"sha": "7beb0da4a9391facbb636a370a47d7439c8ee862", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiZWIwZGE0YTkzOTFmYWNiYjYzNmEzNzBhNDdkNzQzOWM4ZWU4NjI=", "commit": {"author": {"name": "Florian Warzecha", "email": "liketechnik@disroot.org", "date": "2020-11-09T18:58:19Z"}, "committer": {"name": "Florian Warzecha", "email": "liketechnik@disroot.org", "date": "2020-11-10T00:02:38Z"}, "message": "(rustdoc) [src] link for types defined by macros shows invocation\n\nPreviously the [src] link on types defined by a macro\npointed to the macro definition.\nThis commit makes the Clean-Implementation for Spans\naware of macro defined types,\nso that the link points to the invocation instead.", "tree": {"sha": "b6b69fbcee5b445c620e836160aae9ae097e3b2a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6b69fbcee5b445c620e836160aae9ae097e3b2a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7beb0da4a9391facbb636a370a47d7439c8ee862", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmbauVGD14yLN3Z9qS+jH2X+RDGAFAl+p2KUACgkQS+jH2X+R\nDGB83A/7BXoN9atFwHRr1KZuq54ySaoDx3NrlvXxilzMNkaKtDaNizacxtKSMesb\n5rczqaKw8XQgcnIFX9zPgP4AA1DIkYxLhH+loGykjjSBXlq3X2T5zVMbLJkw6pgT\n4h7Xlj4bKDyCdozOumgZA5o41Za3Qa6JVZ4iMZKc5jsfrrupRg5W2C+Gm52asZ/s\nuDHOJCVQ7i7e2OjbDw0wb96ImO3kgjhYRvD8BMsmYBDA5SSbuN02Ns080ByTY4ms\ny5o1+jMx3Qh1GeBueZ1fJZ6EA76G0AUuFxfabYr94g8MqKEezoSQmUaNmilYR9gY\n58k6fj+gLWJnA8YzptUbBYbdXc6xJI6ag2iZyniANthCibf/DRFBBoBti9Ap8PBQ\nE2OvUBGVXnGJJvGCdKr1NvTk8dyyMwpzYaq/02RvLcGidgxlJvYAjDORBORu618o\nHKpROkljoJALyplKl0h3zJGSB1ceC2YsY8U3K1QgnTIZdfVwuvtVDISeqsaTFFZ9\nfl1GDthzIGcSo+3RB2mc5Q+0d/2vxj1+LPTUJ0uFUjJAItJXLtB8bgORj/Tc8taP\nE2cKHlFiKdemk2o1KA5Q6KTs3O4QuvGQASwDTsQxU0vgNBSeub+sazzYw1M/3QrO\n3PzqZDtYanmWGxzI6qpSntM+fMBdDezAmCfHyVnXA2iUZmTSBhM=\n=Qhbz\n-----END PGP SIGNATURE-----", "payload": "tree b6b69fbcee5b445c620e836160aae9ae097e3b2a\nparent 25f6938da459a57b43bdf16ed6bdad3225b2a3ce\nauthor Florian Warzecha <liketechnik@disroot.org> 1604948299 +0100\ncommitter Florian Warzecha <liketechnik@disroot.org> 1604966558 +0100\n\n(rustdoc) [src] link for types defined by macros shows invocation\n\nPreviously the [src] link on types defined by a macro\npointed to the macro definition.\nThis commit makes the Clean-Implementation for Spans\naware of macro defined types,\nso that the link points to the invocation instead.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7beb0da4a9391facbb636a370a47d7439c8ee862", "html_url": "https://github.com/rust-lang/rust/commit/7beb0da4a9391facbb636a370a47d7439c8ee862", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7beb0da4a9391facbb636a370a47d7439c8ee862/comments", "author": {"login": "liketechnik", "id": 24209689, "node_id": "MDQ6VXNlcjI0MjA5Njg5", "avatar_url": "https://avatars.githubusercontent.com/u/24209689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liketechnik", "html_url": "https://github.com/liketechnik", "followers_url": "https://api.github.com/users/liketechnik/followers", "following_url": "https://api.github.com/users/liketechnik/following{/other_user}", "gists_url": "https://api.github.com/users/liketechnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/liketechnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liketechnik/subscriptions", "organizations_url": "https://api.github.com/users/liketechnik/orgs", "repos_url": "https://api.github.com/users/liketechnik/repos", "events_url": "https://api.github.com/users/liketechnik/events{/privacy}", "received_events_url": "https://api.github.com/users/liketechnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "liketechnik", "id": 24209689, "node_id": "MDQ6VXNlcjI0MjA5Njg5", "avatar_url": "https://avatars.githubusercontent.com/u/24209689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liketechnik", "html_url": "https://github.com/liketechnik", "followers_url": "https://api.github.com/users/liketechnik/followers", "following_url": "https://api.github.com/users/liketechnik/following{/other_user}", "gists_url": "https://api.github.com/users/liketechnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/liketechnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liketechnik/subscriptions", "organizations_url": "https://api.github.com/users/liketechnik/orgs", "repos_url": "https://api.github.com/users/liketechnik/repos", "events_url": "https://api.github.com/users/liketechnik/events{/privacy}", "received_events_url": "https://api.github.com/users/liketechnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25f6938da459a57b43bdf16ed6bdad3225b2a3ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/25f6938da459a57b43bdf16ed6bdad3225b2a3ce", "html_url": "https://github.com/rust-lang/rust/commit/25f6938da459a57b43bdf16ed6bdad3225b2a3ce"}], "stats": {"total": 24, "additions": 13, "deletions": 11}, "files": [{"sha": "ec7932d8bbfa4c1d9611803a3a80579b2ef58edf", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=7beb0da4a9391facbb636a370a47d7439c8ee862", "patch": "@@ -1967,18 +1967,23 @@ impl Clean<Span> for rustc_span::Span {\n             return Span::empty();\n         }\n \n+        // Get the macro invocation instead of the definition,\n+        // in case the span is result of a macro expansion.\n+        // (See rust-lang/rust#39726)\n+        let span = self.source_callsite();\n+\n         let sm = cx.sess().source_map();\n-        let filename = sm.span_to_filename(*self);\n-        let lo = sm.lookup_char_pos(self.lo());\n-        let hi = sm.lookup_char_pos(self.hi());\n+        let filename = sm.span_to_filename(span);\n+        let lo = sm.lookup_char_pos(span.lo());\n+        let hi = sm.lookup_char_pos(span.hi());\n         Span {\n             filename,\n             cnum: lo.file.cnum,\n             loline: lo.line,\n             locol: lo.col.to_usize(),\n             hiline: hi.line,\n             hicol: hi.col.to_usize(),\n-            original: *self,\n+            original: span,\n         }\n     }\n }"}, {"sha": "6a7dbb004a3626c29d5fc3d86fa3cda27c03bbff", "filename": "src/test/rustdoc/external-macro-src.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fexternal-macro-src.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fexternal-macro-src.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fexternal-macro-src.rs?ref=7beb0da4a9391facbb636a370a47d7439c8ee862", "patch": "@@ -1,15 +1,12 @@\n // aux-build:external-macro-src.rs\n-// ignore-tidy-linelength\n \n #![crate_name = \"foo\"]\n \n #[macro_use]\n extern crate external_macro_src;\n \n-// @has foo/index.html '//a[@href=\"../src/foo/external-macro-src.rs.html#4-15\"]' '[src]'\n+// @has foo/index.html '//a[@href=\"../src/foo/external-macro-src.rs.html#3-12\"]' '[src]'\n \n // @has foo/struct.Foo.html\n-// @has - '//a[@href=\"https://example.com/src/external_macro_src/external-macro-src.rs.html#8\"]' '[src]'\n-// @has - '//a[@href=\"https://example.com/src/external_macro_src/external-macro-src.rs.html#9-13\"]' '[src]'\n-// @has - '//a[@href=\"https://example.com/src/external_macro_src/external-macro-src.rs.html#10-12\"]' '[src]'\n+// @has - '//a[@href=\"../src/foo/external-macro-src.rs.html#12\"]' '[src]'\n make_foo!();"}, {"sha": "bd6f38e912338226d93b5f997f603f29f279158e", "filename": "src/test/rustdoc/issue-26606.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fissue-26606.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fissue-26606.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-26606.rs?ref=7beb0da4a9391facbb636a370a47d7439c8ee862", "patch": "@@ -7,5 +7,5 @@\n extern crate issue_26606_macro;\n \n // @has issue_26606/constant.FOO.html\n-// @has - '//a/@href' '../src/issue_26606_macro/issue-26606-macro.rs.html#3'\n+// @has - '//a[@href=\"../src/issue_26606/issue-26606.rs.html#11\"]' '[src]'\n make_item!(FOO);"}, {"sha": "5e56bb5819a104b55acc98780074265dfc32bd9f", "filename": "src/test/rustdoc/thread-local-src.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fthread-local-src.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7beb0da4a9391facbb636a370a47d7439c8ee862/src%2Ftest%2Frustdoc%2Fthread-local-src.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fthread-local-src.rs?ref=7beb0da4a9391facbb636a370a47d7439c8ee862", "patch": "@@ -2,5 +2,5 @@\n \n // @has foo/index.html '//a[@href=\"../src/foo/thread-local-src.rs.html#1-6\"]' '[src]'\n \n-// @has foo/constant.FOO.html '//a/@href' 'https://doc.rust-lang.org/nightly/src/std/'\n+// @has foo/constant.FOO.html '//a[@href=\"../src/foo/thread-local-src.rs.html#6\"]' '[src]'\n thread_local!(pub static FOO: bool = false);"}]}