{"sha": "d2b4f4d4521fcbc8c30096775a2964aab088b154", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyYjRmNGQ0NTIxZmNiYzhjMzAwOTY3NzVhMjk2NGFhYjA4OGIxNTQ=", "commit": {"author": {"name": "Dmitry Murzin", "email": "diraria@yandex.ru", "date": "2019-04-26T14:06:20Z"}, "committer": {"name": "Dmitry Murzin", "email": "diraria@yandex.ru", "date": "2019-04-26T19:39:00Z"}, "message": "Make \"Implementations on Foreign Types\" items in sidebar link to specific impls", "tree": {"sha": "405f74f9103b17cbfeec2ac5315ff49f20c7fd07", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/405f74f9103b17cbfeec2ac5315ff49f20c7fd07"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2b4f4d4521fcbc8c30096775a2964aab088b154", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2b4f4d4521fcbc8c30096775a2964aab088b154", "html_url": "https://github.com/rust-lang/rust/commit/d2b4f4d4521fcbc8c30096775a2964aab088b154", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2b4f4d4521fcbc8c30096775a2964aab088b154/comments", "author": {"login": "dima74", "id": 6505554, "node_id": "MDQ6VXNlcjY1MDU1NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6505554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dima74", "html_url": "https://github.com/dima74", "followers_url": "https://api.github.com/users/dima74/followers", "following_url": "https://api.github.com/users/dima74/following{/other_user}", "gists_url": "https://api.github.com/users/dima74/gists{/gist_id}", "starred_url": "https://api.github.com/users/dima74/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dima74/subscriptions", "organizations_url": "https://api.github.com/users/dima74/orgs", "repos_url": "https://api.github.com/users/dima74/repos", "events_url": "https://api.github.com/users/dima74/events{/privacy}", "received_events_url": "https://api.github.com/users/dima74/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dima74", "id": 6505554, "node_id": "MDQ6VXNlcjY1MDU1NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6505554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dima74", "html_url": "https://github.com/dima74", "followers_url": "https://api.github.com/users/dima74/followers", "following_url": "https://api.github.com/users/dima74/following{/other_user}", "gists_url": "https://api.github.com/users/dima74/gists{/gist_id}", "starred_url": "https://api.github.com/users/dima74/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dima74/subscriptions", "organizations_url": "https://api.github.com/users/dima74/orgs", "repos_url": "https://api.github.com/users/dima74/repos", "events_url": "https://api.github.com/users/dima74/events{/privacy}", "received_events_url": "https://api.github.com/users/dima74/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ee936378662bd2e74be951d6a7011a95a6bd84d", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ee936378662bd2e74be951d6a7011a95a6bd84d", "html_url": "https://github.com/rust-lang/rust/commit/3ee936378662bd2e74be951d6a7011a95a6bd84d"}], "stats": {"total": 46, "additions": 35, "deletions": 11}, "files": [{"sha": "be349de05cab6daf1f7b58e7ea3c86afccd295f3", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 19, "deletions": 11, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/d2b4f4d4521fcbc8c30096775a2964aab088b154/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2b4f4d4521fcbc8c30096775a2964aab088b154/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=d2b4f4d4521fcbc8c30096775a2964aab088b154", "patch": "@@ -3060,7 +3060,7 @@ fn render_implementor(cx: &Context, implementor: &Impl, w: &mut fmt::Formatter<'\n         _ => false,\n     };\n     render_impl(w, cx, implementor, AssocItemLink::Anchor(None), RenderMode::Normal,\n-                implementor.impl_item.stable_since(), false, Some(use_absolute))?;\n+                implementor.impl_item.stable_since(), false, Some(use_absolute), false)?;\n     Ok(())\n }\n \n@@ -3071,7 +3071,7 @@ fn render_impls(cx: &Context, w: &mut fmt::Formatter<'_>,\n         let did = i.trait_did().unwrap();\n         let assoc_link = AssocItemLink::GotoSource(did, &i.inner_impl().provided_trait_methods);\n         render_impl(w, cx, i, assoc_link,\n-                    RenderMode::Normal, containing_item.stable_since(), true, None)?;\n+                    RenderMode::Normal, containing_item.stable_since(), true, None, false)?;\n     }\n     Ok(())\n }\n@@ -3301,7 +3301,7 @@ fn item_trait(\n                 );\n                 render_impl(w, cx, &implementor, assoc_link,\n                             RenderMode::Normal, implementor.impl_item.stable_since(), false,\n-                            None)?;\n+                            None, true)?;\n             }\n             write_loading_content(w, \"\")?;\n         }\n@@ -3958,7 +3958,7 @@ fn render_assoc_items(w: &mut fmt::Formatter<'_>,\n         };\n         for i in &non_trait {\n             render_impl(w, cx, i, AssocItemLink::Anchor(None), render_mode,\n-                        containing_item.stable_since(), true, None)?;\n+                        containing_item.stable_since(), true, None, false)?;\n         }\n     }\n     if let AssocItemRender::DerefFor { .. } = what {\n@@ -4138,11 +4138,15 @@ fn spotlight_decl(decl: &clean::FnDecl) -> Result<String, fmt::Error> {\n }\n \n fn render_impl(w: &mut fmt::Formatter<'_>, cx: &Context, i: &Impl, link: AssocItemLink<'_>,\n-               render_mode: RenderMode, outer_version: Option<&str>,\n-               show_def_docs: bool, use_absolute: Option<bool>) -> fmt::Result {\n+               render_mode: RenderMode, outer_version: Option<&str>, show_def_docs: bool,\n+               use_absolute: Option<bool>, is_on_foreign_type: bool) -> fmt::Result {\n     if render_mode == RenderMode::Normal {\n         let id = cx.derive_id(match i.inner_impl().trait_ {\n-            Some(ref t) => format!(\"impl-{}\", small_url_encode(&format!(\"{:#}\", t))),\n+            Some(ref t) => if is_on_foreign_type {\n+                get_id_for_impl_on_foreign_type(&i.inner_impl().for_, t)\n+            } else {\n+                format!(\"impl-{}\", small_url_encode(&format!(\"{:#}\", t)))\n+            },\n             None => \"impl\".to_string(),\n         });\n         if let Some(use_absolute) = use_absolute {\n@@ -4688,11 +4692,15 @@ fn sidebar_struct(fmt: &mut fmt::Formatter<'_>, it: &clean::Item,\n     Ok(())\n }\n \n+fn get_id_for_impl_on_foreign_type(for_: &clean::Type, trait_: &clean::Type) -> String {\n+    small_url_encode(&format!(\"impl-{:#}-for-{:#}\", trait_, for_))\n+}\n+\n fn extract_for_impl_name(item: &clean::Item) -> Option<(String, String)> {\n     match item.inner {\n         clean::ItemEnum::ImplItem(ref i) => {\n             if let Some(ref trait_) = i.trait_ {\n-                Some((format!(\"{:#}\", i.for_), format!(\"{:#}\", trait_)))\n+                Some((format!(\"{:#}\", i.for_), get_id_for_impl_on_foreign_type(&i.for_, trait_)))\n             } else {\n                 None\n             }\n@@ -4788,9 +4796,9 @@ fn sidebar_trait(fmt: &mut fmt::Formatter<'_>, it: &clean::Item,\n                                   .map_or(false, |d| !c.paths.contains_key(&d)))\n                                   .filter_map(|i| {\n                                       match extract_for_impl_name(&i.impl_item) {\n-                                          Some((ref name, ref url)) => {\n-                                              Some(format!(\"<a href=\\\"#impl-{}\\\">{}</a>\",\n-                                                          small_url_encode(url),\n+                                          Some((ref name, ref id)) => {\n+                                              Some(format!(\"<a href=\\\"#{}\\\">{}</a>\",\n+                                                          id,\n                                                           Escape(name)))\n                                           }\n                                           _ => None,"}, {"sha": "6219a2c3b9073afd5fa74a577c441aa2291f155d", "filename": "src/test/rustdoc/sidebar-links-to-foreign-impl.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d2b4f4d4521fcbc8c30096775a2964aab088b154/src%2Ftest%2Frustdoc%2Fsidebar-links-to-foreign-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2b4f4d4521fcbc8c30096775a2964aab088b154/src%2Ftest%2Frustdoc%2Fsidebar-links-to-foreign-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fsidebar-links-to-foreign-impl.rs?ref=d2b4f4d4521fcbc8c30096775a2964aab088b154", "patch": "@@ -0,0 +1,16 @@\n+// issue #56018: \"Implementations on Foreign Types\" sidebar items should link to specific impls\n+\n+#![crate_name = \"foo\"]\n+\n+// @has foo/trait.Foo.html\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#foreign-impls\"]' 'Implementations on Foreign Types'\n+// @has - '//h2[@id=\"foreign-impls\"]' 'Implementations on Foreign Types'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#impl-Foo-for-u32\"]' 'u32'\n+// @has - '//h3[@id=\"impl-Foo-for-u32\"]//code' 'impl Foo for u32'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#impl-Foo-for-%26%27a%20str\"]' \"&'a str\"\n+// @has - '//h3[@id=\"impl-Foo-for-%26%27a%20str\"]//code' \"impl<'a> Foo for &'a str\"\n+pub trait Foo {}\n+\n+impl Foo for u32 {}\n+\n+impl<'a> Foo for &'a str {}"}]}