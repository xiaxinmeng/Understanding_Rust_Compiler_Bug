{"sha": "aa0706bf20bd6f647c0132e0779e99b7c11208df", "node_id": "C_kwDOAAsO6NoAKGFhMDcwNmJmMjBiZDZmNjQ3YzAxMzJlMDc3OWU5OWI3YzExMjA4ZGY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-15T13:57:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-15T13:57:46Z"}, "message": "Auto merge of #9178 - alex-semenyuk:match_like_matches_macro_fix, r=Jarcho\n\nmatch_like_matches_macro does not trigger when one arm contains conta\u2026\n\nClose #9163\nchangelog: none", "tree": {"sha": "747e99fc52fdcb8d779796b5c5cd6eaa118e7cb6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/747e99fc52fdcb8d779796b5c5cd6eaa118e7cb6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa0706bf20bd6f647c0132e0779e99b7c11208df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa0706bf20bd6f647c0132e0779e99b7c11208df", "html_url": "https://github.com/rust-lang/rust/commit/aa0706bf20bd6f647c0132e0779e99b7c11208df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa0706bf20bd6f647c0132e0779e99b7c11208df/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe6814508f283d2a4a7583eab2087b4a3356658a", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe6814508f283d2a4a7583eab2087b4a3356658a", "html_url": "https://github.com/rust-lang/rust/commit/fe6814508f283d2a4a7583eab2087b4a3356658a"}, {"sha": "2894df34092ce5fb9bfcf74a22a397b17dfaf983", "url": "https://api.github.com/repos/rust-lang/rust/commits/2894df34092ce5fb9bfcf74a22a397b17dfaf983", "html_url": "https://github.com/rust-lang/rust/commit/2894df34092ce5fb9bfcf74a22a397b17dfaf983"}], "stats": {"total": 55, "additions": 43, "deletions": 12}, "files": [{"sha": "0da4833f1dfe0c9dfc5694874ab0cad257c30487", "filename": "clippy_lints/src/matches/match_like_matches.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa0706bf20bd6f647c0132e0779e99b7c11208df/clippy_lints%2Fsrc%2Fmatches%2Fmatch_like_matches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa0706bf20bd6f647c0132e0779e99b7c11208df/clippy_lints%2Fsrc%2Fmatches%2Fmatch_like_matches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fmatch_like_matches.rs?ref=aa0706bf20bd6f647c0132e0779e99b7c11208df", "patch": "@@ -81,14 +81,14 @@ where\n         if let Some((_, last_pat_opt, last_expr, _)) = iter.next_back();\n         let iter_without_last = iter.clone();\n         if let Some((first_attrs, _, first_expr, first_guard)) = iter.next();\n-        if let Some(b0) = find_bool_lit(&first_expr.kind, is_if_let);\n-        if let Some(b1) = find_bool_lit(&last_expr.kind, is_if_let);\n+        if let Some(b0) = find_bool_lit(&first_expr.kind);\n+        if let Some(b1) = find_bool_lit(&last_expr.kind);\n         if b0 != b1;\n         if first_guard.is_none() || iter.len() == 0;\n         if first_attrs.is_empty();\n         if iter\n             .all(|arm| {\n-                find_bool_lit(&arm.2.kind, is_if_let).map_or(false, |b| b == b0) && arm.3.is_none() && arm.0.is_empty()\n+                find_bool_lit(&arm.2.kind).map_or(false, |b| b == b0) && arm.3.is_none() && arm.0.is_empty()\n             });\n         then {\n             if let Some(last_pat) = last_pat_opt {\n@@ -144,7 +144,7 @@ where\n }\n \n /// Extract a `bool` or `{ bool }`\n-fn find_bool_lit(ex: &ExprKind<'_>, is_if_let: bool) -> Option<bool> {\n+fn find_bool_lit(ex: &ExprKind<'_>) -> Option<bool> {\n     match ex {\n         ExprKind::Lit(Spanned {\n             node: LitKind::Bool(b), ..\n@@ -156,7 +156,7 @@ fn find_bool_lit(ex: &ExprKind<'_>, is_if_let: bool) -> Option<bool> {\n                 ..\n             },\n             _,\n-        ) if is_if_let => {\n+        ) => {\n             if let ExprKind::Lit(Spanned {\n                 node: LitKind::Bool(b), ..\n             }) = exp.kind"}, {"sha": "1ccbfda64b73a5240ae68929f83c37d07cd66c05", "filename": "tests/ui/match_expr_like_matches_macro.fixed", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_expr_like_matches_macro.fixed?ref=aa0706bf20bd6f647c0132e0779e99b7c11208df", "patch": "@@ -45,6 +45,12 @@ fn main() {\n         // lint\n         let _ans = matches!(x, E::A(_) | E::B(_));\n     }\n+    {\n+        // lint\n+        // skip rustfmt to prevent removing block for first pattern\n+        #[rustfmt::skip]\n+        let _ans = matches!(x, E::A(_) | E::B(_));\n+    }\n     {\n         // lint\n         let _ans = !matches!(x, E::B(_) | E::C);"}, {"sha": "a49991f594174473c51cc41609d3f808b1d80768", "filename": "tests/ui/match_expr_like_matches_macro.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_expr_like_matches_macro.rs?ref=aa0706bf20bd6f647c0132e0779e99b7c11208df", "patch": "@@ -61,6 +61,18 @@ fn main() {\n             _ => false,\n         };\n     }\n+    {\n+        // lint\n+        // skip rustfmt to prevent removing block for first pattern\n+        #[rustfmt::skip]\n+        let _ans = match x {\n+            E::A(_) => {\n+                true\n+            }\n+            E::B(_) => true,\n+            _ => false,\n+        };\n+    }\n     {\n         // lint\n         let _ans = match x {"}, {"sha": "e94555e27448b0d131c6e34d6d0cb5bdac330b4e", "filename": "tests/ui/match_expr_like_matches_macro.stderr", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aa0706bf20bd6f647c0132e0779e99b7c11208df/tests%2Fui%2Fmatch_expr_like_matches_macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_expr_like_matches_macro.stderr?ref=aa0706bf20bd6f647c0132e0779e99b7c11208df", "patch": "@@ -60,7 +60,20 @@ LL | |         };\n    | |_________^ help: try this: `matches!(x, E::A(_) | E::B(_))`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:66:20\n+  --> $DIR/match_expr_like_matches_macro.rs:68:20\n+   |\n+LL |           let _ans = match x {\n+   |  ____________________^\n+LL | |             E::A(_) => {\n+LL | |                 true\n+LL | |             }\n+LL | |             E::B(_) => true,\n+LL | |             _ => false,\n+LL | |         };\n+   | |_________^ help: try this: `matches!(x, E::A(_) | E::B(_))`\n+\n+error: match expression looks like `matches!` macro\n+  --> $DIR/match_expr_like_matches_macro.rs:78:20\n    |\n LL |           let _ans = match x {\n    |  ____________________^\n@@ -71,7 +84,7 @@ LL | |         };\n    | |_________^ help: try this: `!matches!(x, E::B(_) | E::C)`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:126:18\n+  --> $DIR/match_expr_like_matches_macro.rs:138:18\n    |\n LL |           let _z = match &z {\n    |  __________________^\n@@ -81,7 +94,7 @@ LL | |         };\n    | |_________^ help: try this: `matches!(z, Some(3))`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:135:18\n+  --> $DIR/match_expr_like_matches_macro.rs:147:18\n    |\n LL |           let _z = match &z {\n    |  __________________^\n@@ -91,7 +104,7 @@ LL | |         };\n    | |_________^ help: try this: `matches!(&z, Some(3))`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:152:21\n+  --> $DIR/match_expr_like_matches_macro.rs:164:21\n    |\n LL |               let _ = match &z {\n    |  _____________________^\n@@ -101,7 +114,7 @@ LL | |             };\n    | |_____________^ help: try this: `matches!(&z, AnEnum::X)`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:166:20\n+  --> $DIR/match_expr_like_matches_macro.rs:178:20\n    |\n LL |           let _res = match &val {\n    |  ____________________^\n@@ -111,7 +124,7 @@ LL | |         };\n    | |_________^ help: try this: `matches!(&val, &Some(ref _a))`\n \n error: match expression looks like `matches!` macro\n-  --> $DIR/match_expr_like_matches_macro.rs:178:20\n+  --> $DIR/match_expr_like_matches_macro.rs:190:20\n    |\n LL |           let _res = match &val {\n    |  ____________________^\n@@ -120,5 +133,5 @@ LL | |             _ => false,\n LL | |         };\n    | |_________^ help: try this: `matches!(&val, &Some(ref _a))`\n \n-error: aborting due to 12 previous errors\n+error: aborting due to 13 previous errors\n "}]}