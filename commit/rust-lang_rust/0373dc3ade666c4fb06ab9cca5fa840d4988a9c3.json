{"sha": "0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzNzNkYzNhZGU2NjZjNGZiMDZhYjljY2E1ZmE4NDBkNDk4OGE5YzM=", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-01-22T18:04:28Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-01-24T20:16:41Z"}, "message": "Added documentation for adding a configuration to lints\n\n* Fixed some spelling", "tree": {"sha": "84bd383ba03396077e2aa6f3d41b96b9cbf40a22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84bd383ba03396077e2aa6f3d41b96b9cbf40a22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "html_url": "https://github.com/rust-lang/rust/commit/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a905cf6737197096e2aa1b8f384b07ded9e96fd1", "url": "https://api.github.com/repos/rust-lang/rust/commits/a905cf6737197096e2aa1b8f384b07ded9e96fd1", "html_url": "https://github.com/rust-lang/rust/commit/a905cf6737197096e2aa1b8f384b07ded9e96fd1"}], "stats": {"total": 81, "additions": 79, "deletions": 2}, "files": [{"sha": "fd2a7d171d020aff7b99eb2826f199a6bd591287", "filename": "doc/adding_lints.md", "status": "modified", "additions": 76, "deletions": 0, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3/doc%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3/doc%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Fadding_lints.md?ref=0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "patch": "@@ -23,6 +23,7 @@ because that's clearly a non-descriptive name.\n   - [Running rustfmt](#running-rustfmt)\n   - [Debugging](#debugging)\n   - [PR Checklist](#pr-checklist)\n+  - [Adding configuration to a lint](#adding-configuration-to-a-lint)\n   - [Cheatsheet](#cheatsheet)\n \n ## Setup\n@@ -526,6 +527,81 @@ Before submitting your PR make sure you followed all of the basic requirements:\n - \\[ ] Added lint documentation\n - \\[ ] Run `cargo dev fmt`\n \n+## Adding configuration to a lint\n+\n+Clippy supports the configuration of lints values using a `clippy.toml` file in the workspace \n+directory. Adding a configuration to a lint can be useful for thresholds or to constrain some\n+behavior that can be seen as a false positive for some users. Adding a configuration is done \n+in the following steps:\n+\n+1. Adding a new configuration entry to [clippy_lints::utils::conf](/clippy_lints/src/utils/conf.rs)\n+    like this:\n+    ```rust\n+    /// Lint: LINT_NAME. <The configuration field doc comment>\n+    (configuration_ident, \"configuration_value\": Type, DefaultValue),\n+    ```\n+    The configuration value and identifier should usually be the same. The doc comment will be \n+    automatically added to the lint documentation.\n+2. Adding the configuration value to the lint impl struct:\n+    1. This first requires the definition of a lint impl struct. Lint impl structs are usually \n+        generated with the `declare_lint_pass!` macro. This struct needs to be defined manually\n+        to add some kind of metadata to it:\n+        ```rust\n+        // Generated struct definition\n+        declare_lint_pass!(StructName => [\n+            LINT_NAME\n+        ]);\n+\n+        // New manual definition struct\n+        #[derive(Copy, Clone)]\n+        pub struct StructName {}\n+\n+        impl_lint_pass!(StructName => [\n+            LINT_NAME\n+        ]);\n+        ```\n+    \n+    2. Next add the configuration value and a corresponding creation method like this:\n+        ```rust\n+        #[derive(Copy, Clone)]\n+        pub struct StructName {\n+            configuration_ident: Type,\n+        }\n+\n+        // ...\n+\n+        impl StructName {\n+            pub fn new(configuration_ident: Type) -> Self {\n+                Self {\n+                    configuration_ident,\n+                }\n+            }\n+        }\n+        ```\n+3. Passing the configuration value to the lint impl struct:\n+\n+    First find the struct construction in the [clippy_lints lib file](/clippy_lints/src/lib.rs). \n+    Make sure that `clippy dev update_lints` added it beforehand. The configuration value is now \n+    cloned or copied into a local value that is then passed to the impl struct like this:\n+    ```rust\n+    // Default generated registration:\n+    store.register_late_pass(|| box module::StructName);\n+\n+    // New registration with configuration value\n+    let configuration_ident = conf.configuration_ident.clone();\n+    store.register_late_pass(move || box module::StructName::new(configuration_ident));\n+    ```\n+\n+    Congratulations the work is almost done. The configuration value can now be accessed\n+    in the linting code via `self.configuration_ident`.\n+\n+4. Adding tests:\n+    1. The default configured value can be tested like any normal lint in [`tests/ui`](/tests/ui).\n+    2. The configuration itself will be tested separately in [`tests/ui-toml`](/tests/ui-toml). \n+        Simply add a new subfolder with a fitting name. This folder contains a `clippy.toml` file \n+        with the configuration value and a rust file that should be linted by clippy. The test can \n+        otherwise be written as usual.\n+\n ## Cheatsheet\n \n Here are some pointers to things you are likely going to need for every lint:"}, {"sha": "57f83bdf32bc2bb748a72f6cacf7d7017d59e09d", "filename": "doc/basics.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3/doc%2Fbasics.md", "raw_url": "https://github.com/rust-lang/rust/raw/0373dc3ade666c4fb06ab9cca5fa840d4988a9c3/doc%2Fbasics.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Fbasics.md?ref=0373dc3ade666c4fb06ab9cca5fa840d4988a9c3", "patch": "@@ -11,6 +11,7 @@ the codebase take a look at [Adding Lints] or [Common Tools].\n   - [Get the Code](#get-the-code)\n   - [Building and Testing](#building-and-testing)\n   - [`cargo dev`](#cargo-dev)\n+  - [Common Abbreviations](#common-abbreviations)\n   - [PR](#pr)\n \n ## Get the Code\n@@ -109,7 +110,7 @@ See <https://rustc-dev-guide.rust-lang.org/contributing.html#opening-a-pr>.\n | TCX          | Type context                           |\n \n This is a concise list of abbreviations that can come up during clippy development. An extensive\n-genal list can be found in the [rustc-dev-guide glossary][glossary]. Always feel free to ask if\n+general list can be found in the [rustc-dev-guide glossary][glossary]. Always feel free to ask if\n an abbreviation or meaning is unclear to you.\n \n-[glossary]: https://rustc-dev-guide.rust-lang.org/appendix/glossary.html\n\\ No newline at end of file\n+[glossary]: https://rustc-dev-guide.rust-lang.org/appendix/glossary.html"}]}