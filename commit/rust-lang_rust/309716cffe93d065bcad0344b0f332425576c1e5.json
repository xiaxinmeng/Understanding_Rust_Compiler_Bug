{"sha": "309716cffe93d065bcad0344b0f332425576c1e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwOTcxNmNmZmU5M2QwNjViY2FkMDM0NGIwZjMzMjQyNTU3NmMxZTU=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-03-25T11:28:04Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-03-25T11:29:24Z"}, "message": "move tests to where they belong", "tree": {"sha": "e4d602a1548ea7e0ebe565f9ff5c702b9e153a8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4d602a1548ea7e0ebe565f9ff5c702b9e153a8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/309716cffe93d065bcad0344b0f332425576c1e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/309716cffe93d065bcad0344b0f332425576c1e5", "html_url": "https://github.com/rust-lang/rust/commit/309716cffe93d065bcad0344b0f332425576c1e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/309716cffe93d065bcad0344b0f332425576c1e5/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9af69d9db8856d79f0da7ae7da66169cc225aac", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9af69d9db8856d79f0da7ae7da66169cc225aac", "html_url": "https://github.com/rust-lang/rust/commit/e9af69d9db8856d79f0da7ae7da66169cc225aac"}], "stats": {"total": 76, "additions": 32, "deletions": 44}, "files": [{"sha": "572bd1bf74734725ef27aa728733b63abde75579", "filename": "crates/ra_hir/src/nameres/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests.rs?ref=309716cffe93d065bcad0344b0f332425576c1e5", "patch": "@@ -560,6 +560,7 @@ fn unresolved_module_diagnostics() {\n         //- /lib.rs\n         mod foo;\n         mod bar;\n+        mod baz {}\n         //- /foo.rs\n         \",\n     )"}, {"sha": "5a78e94d82225eb230b2643badf472a90bc5216b", "filename": "crates/ra_ide_api/src/diagnostics.rs", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_ide_api%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_ide_api%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fdiagnostics.rs?ref=309716cffe93d065bcad0344b0f332425576c1e5", "patch": "@@ -152,6 +152,9 @@ fn check_struct_shorthand_initialization(\n #[cfg(test)]\n mod tests {\n     use test_utils::assert_eq_text;\n+    use insta::assert_debug_snapshot_matches;\n+\n+    use crate::mock_analysis::single_file;\n \n     use super::*;\n \n@@ -180,6 +183,34 @@ mod tests {\n         assert_eq_text!(after, &actual);\n     }\n \n+    #[test]\n+    fn test_unresolved_module_diagnostic() {\n+        let (analysis, file_id) = single_file(\"mod foo;\");\n+        let diagnostics = analysis.diagnostics(file_id).unwrap();\n+        assert_debug_snapshot_matches!(diagnostics, @r####\"[\n+    Diagnostic {\n+        message: \"unresolved module\",\n+        range: [0; 8),\n+        fix: Some(\n+            SourceChange {\n+                label: \"create module\",\n+                source_file_edits: [],\n+                file_system_edits: [\n+                    CreateFile {\n+                        source_root: SourceRootId(\n+                            0\n+                        ),\n+                        path: \"foo.rs\"\n+                    }\n+                ],\n+                cursor_position: None\n+            }\n+        ),\n+        severity: Error\n+    }\n+]\"####);\n+    }\n+\n     #[test]\n     fn test_check_unnecessary_braces_in_use_statement() {\n         check_not_applicable("}, {"sha": "d4ff21c09ccab9fc79b72152f75b94952835d9e9", "filename": "crates/ra_ide_api/tests/test/main.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_ide_api%2Ftests%2Ftest%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/309716cffe93d065bcad0344b0f332425576c1e5/crates%2Fra_ide_api%2Ftests%2Ftest%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Ftests%2Ftest%2Fmain.rs?ref=309716cffe93d065bcad0344b0f332425576c1e5", "patch": "@@ -1,26 +1,10 @@\n-use insta::assert_debug_snapshot_matches;\n use ra_ide_api::{\n     mock_analysis::{single_file, single_file_with_position, single_file_with_range, MockAnalysis},\n     AnalysisChange, CrateGraph, Edition::Edition2018, Query, NavigationTarget,\n     ReferenceSearchResult,\n };\n use ra_syntax::SmolStr;\n \n-#[test]\n-fn test_unresolved_module_diagnostic() {\n-    let (analysis, file_id) = single_file(\"mod foo;\");\n-    let diagnostics = analysis.diagnostics(file_id).unwrap();\n-    assert_debug_snapshot_matches!(\"unresolved_module_diagnostic\", &diagnostics);\n-}\n-\n-// FIXME: move this test to hir\n-#[test]\n-fn test_unresolved_module_diagnostic_no_diag_for_inline_mode() {\n-    let (analysis, file_id) = single_file(\"mod foo {}\");\n-    let diagnostics = analysis.diagnostics(file_id).unwrap();\n-    assert!(diagnostics.is_empty());\n-}\n-\n #[test]\n fn test_resolve_crate_root() {\n     let mock = MockAnalysis::with_files("}, {"sha": "5bb9538922312ebadc85efca82ae623c143649fa", "filename": "crates/ra_ide_api/tests/test/snapshots/test__unresolved_module_diagnostic.snap", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/e9af69d9db8856d79f0da7ae7da66169cc225aac/crates%2Fra_ide_api%2Ftests%2Ftest%2Fsnapshots%2Ftest__unresolved_module_diagnostic.snap", "raw_url": "https://github.com/rust-lang/rust/raw/e9af69d9db8856d79f0da7ae7da66169cc225aac/crates%2Fra_ide_api%2Ftests%2Ftest%2Fsnapshots%2Ftest__unresolved_module_diagnostic.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Ftests%2Ftest%2Fsnapshots%2Ftest__unresolved_module_diagnostic.snap?ref=e9af69d9db8856d79f0da7ae7da66169cc225aac", "patch": "@@ -1,28 +0,0 @@\n----\n-created: \"2019-01-22T14:45:01.486985900+00:00\"\n-creator: insta@0.4.0\n-expression: \"&diagnostics\"\n-source: \"crates\\\\ra_ide_api\\\\tests\\\\test\\\\main.rs\"\n----\n-[\n-    Diagnostic {\n-        message: \"unresolved module\",\n-        range: [0; 8),\n-        fix: Some(\n-            SourceChange {\n-                label: \"create module\",\n-                source_file_edits: [],\n-                file_system_edits: [\n-                    CreateFile {\n-                        source_root: SourceRootId(\n-                            0\n-                        ),\n-                        path: \"foo.rs\"\n-                    }\n-                ],\n-                cursor_position: None\n-            }\n-        ),\n-        severity: Error\n-    }\n-]"}]}