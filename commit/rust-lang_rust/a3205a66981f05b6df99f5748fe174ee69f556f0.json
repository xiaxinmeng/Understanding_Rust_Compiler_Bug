{"sha": "a3205a66981f05b6df99f5748fe174ee69f556f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzMjA1YTY2OTgxZjA1YjZkZjk5ZjU3NDhmZTE3NGVlNjlmNTU2ZjA=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-06-05T14:36:27Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-06-05T14:42:03Z"}, "message": "Use sysroot instead of CFG_PREFIX for the rpath\n\nCFG_PREFIX is incorrect for rustup installed rustc versions. It also\ncauses unnecessary recompilation when changing the install prefix.", "tree": {"sha": "8454338ee4de77b5bee78de2c49efb84fca71dca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8454338ee4de77b5bee78de2c49efb84fca71dca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3205a66981f05b6df99f5748fe174ee69f556f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3205a66981f05b6df99f5748fe174ee69f556f0", "html_url": "https://github.com/rust-lang/rust/commit/a3205a66981f05b6df99f5748fe174ee69f556f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3205a66981f05b6df99f5748fe174ee69f556f0/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "016e9b5e33ef1407bffb575ec63d24241912556d", "url": "https://api.github.com/repos/rust-lang/rust/commits/016e9b5e33ef1407bffb575ec63d24241912556d", "html_url": "https://github.com/rust-lang/rust/commit/016e9b5e33ef1407bffb575ec63d24241912556d"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "df74e2f60c6212bd85e1741885df52bd52897ca5", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a3205a66981f05b6df99f5748fe174ee69f556f0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3205a66981f05b6df99f5748fe174ee69f556f0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=a3205a66981f05b6df99f5748fe174ee69f556f0", "patch": "@@ -1567,13 +1567,12 @@ fn add_rpath_args(\n ) {\n     // FIXME (#2397): At some point we want to rpath our guesses as to\n     // where extern libraries might live, based on the\n-    // addl_lib_search_paths\n+    // add_lib_search_paths\n     if sess.opts.cg.rpath {\n         let target_triple = sess.opts.target_triple.triple();\n         let mut get_install_prefix_lib_path = || {\n-            let install_prefix = option_env!(\"CFG_PREFIX\").expect(\"CFG_PREFIX\");\n             let tlib = rustc_target::target_rustlib_path(&sess.sysroot, target_triple).join(\"lib\");\n-            let mut path = PathBuf::from(install_prefix);\n+            let mut path = PathBuf::from(&sess.sysroot);\n             path.push(&tlib);\n \n             path"}, {"sha": "233f29e4c53d075dbd040874d8d38a3aa90e5a40", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a3205a66981f05b6df99f5748fe174ee69f556f0/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3205a66981f05b6df99f5748fe174ee69f556f0/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=a3205a66981f05b6df99f5748fe174ee69f556f0", "patch": "@@ -629,8 +629,7 @@ pub fn rustc_cargo_env(builder: &Builder<'_>, cargo: &mut Cargo, target: TargetS\n     cargo\n         .env(\"CFG_RELEASE\", builder.rust_release())\n         .env(\"CFG_RELEASE_CHANNEL\", &builder.config.channel)\n-        .env(\"CFG_VERSION\", builder.rust_version())\n-        .env(\"CFG_PREFIX\", builder.config.prefix.clone().unwrap_or_default());\n+        .env(\"CFG_VERSION\", builder.rust_version());\n \n     let libdir_relative = builder.config.libdir_relative().unwrap_or_else(|| Path::new(\"lib\"));\n     cargo.env(\"CFG_LIBDIR_RELATIVE\", libdir_relative);"}]}