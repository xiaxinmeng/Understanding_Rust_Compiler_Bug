{"sha": "c9196290af3934481bd413e11057725f248fd104", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5MTk2MjkwYWYzOTM0NDgxYmQ0MTNlMTEwNTc3MjVmMjQ4ZmQxMDQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-08T06:01:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-08T06:01:39Z"}, "message": "auto merge of #9674 : ben0x539/rust/raw-str, r=alexcrichton\n\nThis branch parses raw string literals as in #9411.", "tree": {"sha": "64e4d5fed93cfedb791ac3abddb9cc703d337f75", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64e4d5fed93cfedb791ac3abddb9cc703d337f75"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9196290af3934481bd413e11057725f248fd104", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9196290af3934481bd413e11057725f248fd104", "html_url": "https://github.com/rust-lang/rust/commit/c9196290af3934481bd413e11057725f248fd104", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9196290af3934481bd413e11057725f248fd104/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ddd011ce8875c6c5b119e5a8957a51d524a95da", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ddd011ce8875c6c5b119e5a8957a51d524a95da", "html_url": "https://github.com/rust-lang/rust/commit/6ddd011ce8875c6c5b119e5a8957a51d524a95da"}, {"sha": "d7dfe0ae34eb9a818dcbdb5646e21e721ffb3c33", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7dfe0ae34eb9a818dcbdb5646e21e721ffb3c33", "html_url": "https://github.com/rust-lang/rust/commit/d7dfe0ae34eb9a818dcbdb5646e21e721ffb3c33"}], "stats": {"total": 354, "additions": 274, "deletions": 80}, "files": [{"sha": "b2429fde89160c560344df4cb91643c98d8f697a", "filename": "doc/rust.md", "status": "modified", "additions": 32, "deletions": 4, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/doc%2Frust.md", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/doc%2Frust.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Frust.md?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -239,13 +239,14 @@ literal : string_lit | char_lit | num_lit ;\n \n ~~~~~~~~ {.ebnf .gram}\n char_lit : '\\x27' char_body '\\x27' ;\n-string_lit : '\"' string_body * '\"' ;\n+string_lit : '\"' string_body * '\"' | 'r' raw_string ;\n \n char_body : non_single_quote\n           | '\\x5c' [ '\\x27' | common_escape ] ;\n \n string_body : non_double_quote\n             | '\\x5c' [ '\\x22' | common_escape ] ;\n+raw_string : '\"' raw_string_body '\"' | '#' raw_string '#' ;\n \n common_escape : '\\x5c'\n               | 'n' | 'r' | 't' | '0'\n@@ -267,9 +268,10 @@ which must be _escaped_ by a preceding U+005C character (`\\`).\n \n A _string literal_ is a sequence of any Unicode characters enclosed within\n two `U+0022` (double-quote) characters, with the exception of `U+0022`\n-itself, which must be _escaped_ by a preceding `U+005C` character (`\\`).\n+itself, which must be _escaped_ by a preceding `U+005C` character (`\\`),\n+or a _raw string literal_.\n \n-Some additional _escapes_ are available in either character or string\n+Some additional _escapes_ are available in either character or non-raw string\n literals. An escape starts with a `U+005C` (`\\`) and continues with one of\n the following forms:\n \n@@ -285,9 +287,35 @@ the following forms:\n   * A _whitespace escape_ is one of the characters `U+006E` (`n`), `U+0072`\n     (`r`), or `U+0074` (`t`), denoting the unicode values `U+000A` (LF),\n     `U+000D` (CR) or `U+0009` (HT) respectively.\n-  * The _backslash escape_ is the character U+005C (`\\`) which must be\n+  * The _backslash escape_ is the character `U+005C` (`\\`) which must be\n     escaped in order to denote *itself*.\n \n+Raw string literals do not process any escapes. They start with the character\n+`U+0072` (`r`), followed zero or more of the character `U+0023` (`#`) and a\n+`U+0022` (double-quote) character. The _raw string body_ is not defined in the\n+EBNF grammar above: it can contain any sequence of Unicode characters and is\n+terminated only by another `U+0022` (double-quote) character, followed by the\n+same number of `U+0023` (`#`) characters that preceeded the opening `U+0022`\n+(double-quote) character.\n+\n+All Unicode characters contained in the raw string body represent themselves,\n+the characters `U+0022` (double-quote) (except when followed by at least as\n+many `U+0023` (`#`) characters as were used to start the raw string literal) or\n+`U+005C` (`\\`) do not have any special meaning.\n+\n+Examples for string literals:\n+\n+~~~\n+\"foo\"; r\"foo\";                     // foo\n+\"\\\"foo\\\"\"; r#\"\"foo\"\"#;             // \"foo\"\n+\n+\"foo #\\\"# bar\";\n+r##\"foo #\"# bar\"##;                // foo #\"# bar\n+\n+\"\\x52\"; \"R\"; r\"R\";                 // R\n+\"\\\\x52\"; r\"\\x52\";                  // \\x52\n+~~~\n+\n #### Number literals\n \n ~~~~~~~~ {.ebnf .gram}"}, {"sha": "2567875b7b9d6dbf6fb19058384d65c0743cfcec", "filename": "doc/tutorial.md", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/doc%2Ftutorial.md", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/doc%2Ftutorial.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Ftutorial.md?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -353,7 +353,12 @@ whose literals are written between single quotes, as in `'x'`.\n Just like C, Rust understands a number of character escapes, using the backslash\n character, such as `\\n`, `\\r`, and `\\t`. String literals,\n written between double quotes, allow the same escape sequences.\n-More on strings [later](#vectors-and-strings).\n+\n+On the other hand, raw string literals do not process any escape sequences.\n+They are written as `r##\"blah\"##`, with a matching number of zero or more `#`\n+before the opening and after the closing quote, and can contain any sequence of\n+characters except their closing delimiter.  More on strings\n+[later](#vectors-and-strings).\n \n The nil type, written `()`, has a single value, also written `()`.\n "}, {"sha": "7d51c3b84758844e6c0ef798002bcf58361e7e4c", "filename": "src/etc/vim/syntax/rust.vim", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -148,6 +148,7 @@ syn match     rustFormat      display \"%%\" contained\n syn match     rustSpecial     display contained /\\\\\\([nrt\\\\'\"]\\|x\\x\\{2}\\|u\\x\\{4}\\|U\\x\\{8}\\)/\n syn match     rustStringContinuation display contained /\\\\\\n\\s*/\n syn region    rustString      start=+\"+ skip=+\\\\\\\\\\|\\\\\"+ end=+\"+ contains=rustTodo,rustFormat,rustSpecial,rustStringContinuation\n+syn region    rustString      start='r\\z(#*\\)\"' end='\"\\z1'\n \n syn region    rustAttribute   start=\"#\\[\" end=\"\\]\" contains=rustString,rustDeriving\n syn region    rustDeriving    start=\"deriving(\" end=\")\" contained contains=rustTrait"}, {"sha": "aad2228f66fda6a04126541f6514adebddc8e0c1", "filename": "src/librustc/front/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Ffront%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Ffront%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Ftest.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -407,7 +407,7 @@ fn mk_test_desc_and_fn_rec(cx: &TestCtxt, test: &Test) -> @ast::Expr {\n     debug2!(\"encoding {}\", ast_util::path_name_i(path));\n \n     let name_lit: ast::lit =\n-        nospan(ast::lit_str(ast_util::path_name_i(path).to_managed()));\n+        nospan(ast::lit_str(ast_util::path_name_i(path).to_managed(), ast::CookedStr));\n \n     let name_expr = @ast::Expr {\n           id: ast::DUMMY_NODE_ID,"}, {"sha": "fd4f31c3dc75f4392bc213eed3d1da501c071263", "filename": "src/librustc/metadata/creader.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fcreader.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -142,7 +142,7 @@ fn visit_view_item(e: @mut Env, i: &ast::view_item) {\n           let ident = token::ident_to_str(&ident);\n           let meta_items = match path_opt {\n               None => meta_items.clone(),\n-              Some(p) => {\n+              Some((p, _path_str_style)) => {\n                   let p_path = Path(p);\n                   match p_path.filestem() {\n                       Some(s) =>"}, {"sha": "5434e7ab07b1c77f9fb8bb814bdb40c42de95b12", "filename": "src/librustc/metadata/encoder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fencoder.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -1440,7 +1440,7 @@ fn encode_meta_item(ebml_w: &mut writer::Encoder, mi: @MetaItem) {\n       }\n       MetaNameValue(name, value) => {\n         match value.node {\n-          lit_str(value) => {\n+          lit_str(value, _) => {\n             ebml_w.start_tag(tag_meta_item_name_value);\n             ebml_w.start_tag(tag_meta_item_name);\n             ebml_w.writer.write(name.as_bytes());"}, {"sha": "dd624a882839abb9428c85eb46143332d6fb56f0", "filename": "src/librustc/middle/check_const.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -86,7 +86,7 @@ pub fn check_pat(v: &mut CheckCrateVisitor, p: @Pat, _is_const: bool) {\n         match e.node {\n             ExprVstore(\n                 @Expr { node: ExprLit(@codemap::Spanned {\n-                    node: lit_str(_),\n+                    node: lit_str(*),\n                     _}),\n                        _ },\n                 ExprVstoreUniq\n@@ -120,7 +120,7 @@ pub fn check_expr(v: &mut CheckCrateVisitor,\n                           \"disallowed operator in constant expression\");\n             return;\n           }\n-          ExprLit(@codemap::Spanned {node: lit_str(_), _}) => { }\n+          ExprLit(@codemap::Spanned {node: lit_str(*), _}) => { }\n           ExprBinary(*) | ExprUnary(*) => {\n             if method_map.contains_key(&e.id) {\n                 sess.span_err(e.span, \"user-defined operators are not \\"}, {"sha": "77cba0f33eae29fc962726386c8716d1fcdfee08", "filename": "src/librustc/middle/const_eval.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -475,7 +475,7 @@ pub fn eval_const_expr_partial<T: ty::ExprTyProvider>(tcx: &T, e: &Expr)\n \n pub fn lit_to_const(lit: &lit) -> const_val {\n     match lit.node {\n-      lit_str(s) => const_str(s),\n+      lit_str(s, _) => const_str(s),\n       lit_char(n) => const_uint(n as u64),\n       lit_int(n, _) => const_int(n),\n       lit_uint(n, _) => const_uint(n),"}, {"sha": "dd938b5a60f8d7c997f865f55f7e876afc31c591", "filename": "src/librustc/middle/trans/consts.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fconsts.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -71,7 +71,7 @@ pub fn const_lit(cx: &mut CrateContext, e: &ast::Expr, lit: ast::lit)\n       }\n       ast::lit_bool(b) => C_bool(b),\n       ast::lit_nil => C_nil(),\n-      ast::lit_str(s) => C_estr_slice(cx, s)\n+      ast::lit_str(s, _) => C_estr_slice(cx, s)\n     }\n }\n "}, {"sha": "d31ca763209a88db7ebc084d8acb2afd9e81ab26", "filename": "src/librustc/middle/trans/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fexpr.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -705,7 +705,7 @@ fn trans_rvalue_dps_unadjusted(bcx: @mut Block, expr: &ast::Expr,\n                 args.iter().enumerate().map(|(i, arg)| (i, *arg)).collect();\n             return trans_adt(bcx, repr, 0, numbered_fields, None, dest);\n         }\n-        ast::ExprLit(@codemap::Spanned {node: ast::lit_str(s), _}) => {\n+        ast::ExprLit(@codemap::Spanned {node: ast::lit_str(s, _), _}) => {\n             return tvec::trans_lit_str(bcx, expr, s, dest);\n         }\n         ast::ExprVstore(contents, ast::ExprVstoreSlice) |"}, {"sha": "7bcbedf50f75fd385dba50cb22f962aa053a59ae", "filename": "src/librustc/middle/trans/tvec.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftvec.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -205,7 +205,7 @@ pub fn trans_slice_vstore(bcx: @mut Block,\n \n     // Handle the &\"...\" case:\n     match content_expr.node {\n-        ast::ExprLit(@codemap::Spanned {node: ast::lit_str(s), span: _}) => {\n+        ast::ExprLit(@codemap::Spanned {node: ast::lit_str(s, _), span: _}) => {\n             return trans_lit_str(bcx, content_expr, s, dest);\n         }\n         _ => {}\n@@ -296,7 +296,7 @@ pub fn trans_uniq_or_managed_vstore(bcx: @mut Block, heap: heap, vstore_expr: &a\n         heap_exchange => {\n             match content_expr.node {\n                 ast::ExprLit(@codemap::Spanned {\n-                    node: ast::lit_str(s), span\n+                    node: ast::lit_str(s, _), span\n                 }) => {\n                     let llptrval = C_cstr(bcx.ccx(), s);\n                     let llptrval = PointerCast(bcx, llptrval, Type::i8p());\n@@ -357,7 +357,7 @@ pub fn write_content(bcx: @mut Block,\n     let _indenter = indenter();\n \n     match content_expr.node {\n-        ast::ExprLit(@codemap::Spanned { node: ast::lit_str(s), _ }) => {\n+        ast::ExprLit(@codemap::Spanned { node: ast::lit_str(s, _), _ }) => {\n             match dest {\n                 Ignore => {\n                     return bcx;\n@@ -490,7 +490,7 @@ pub fn elements_required(bcx: @mut Block, content_expr: &ast::Expr) -> uint {\n     //! Figure out the number of elements we need to store this content\n \n     match content_expr.node {\n-        ast::ExprLit(@codemap::Spanned { node: ast::lit_str(s), _ }) => {\n+        ast::ExprLit(@codemap::Spanned { node: ast::lit_str(s, _), _ }) => {\n             s.len()\n         },\n         ast::ExprVec(ref es, _) => es.len(),"}, {"sha": "d14e81244596a413765c315062020b1a5979f218", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -3266,7 +3266,7 @@ pub fn expr_kind(tcx: ctxt,\n         ast::ExprDoBody(*) |\n         ast::ExprBlock(*) |\n         ast::ExprRepeat(*) |\n-        ast::ExprLit(@codemap::Spanned {node: lit_str(_), _}) |\n+        ast::ExprLit(@codemap::Spanned {node: lit_str(*), _}) |\n         ast::ExprVstore(_, ast::ExprVstoreSlice) |\n         ast::ExprVstore(_, ast::ExprVstoreMutSlice) |\n         ast::ExprVec(*) => {"}, {"sha": "ec5ee3838b1875edb17674a37745b554d8e53d84", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -2259,7 +2259,7 @@ pub fn check_expr_with_unifier(fcx: @mut FnCtxt,\n     match expr.node {\n       ast::ExprVstore(ev, vst) => {\n         let typ = match ev.node {\n-          ast::ExprLit(@codemap::Spanned { node: ast::lit_str(_), _ }) => {\n+          ast::ExprLit(@codemap::Spanned { node: ast::lit_str(*), _ }) => {\n             let tt = ast_expr_vstore_to_vstore(fcx, ev, vst);\n             ty::mk_estr(tcx, tt)\n           }"}, {"sha": "54b8a5c038d965cd29947836e7abd088559888a3", "filename": "src/librustdoc/clean.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustdoc%2Fclean.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustdoc%2Fclean.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -1008,7 +1008,7 @@ impl Clean<ViewItemInner> for ast::view_item_ {\n     fn clean(&self) -> ViewItemInner {\n         match self {\n             &ast::view_item_extern_mod(ref i, ref p, ref mi, ref id) =>\n-                ExternMod(i.clean(), p.map(|x| x.to_owned()),  mi.clean(), *id),\n+                ExternMod(i.clean(), p.map(|&(ref x, _)| x.to_owned()),  mi.clean(), *id),\n             &ast::view_item_use(ref vp) => Import(vp.clean())\n         }\n     }\n@@ -1114,7 +1114,7 @@ impl ToSource for syntax::codemap::Span {\n \n fn lit_to_str(lit: &ast::lit) -> ~str {\n     match lit.node {\n-        ast::lit_str(st) => st.to_owned(),\n+        ast::lit_str(st, _) => st.to_owned(),\n         ast::lit_char(c) => ~\"'\" + std::char::from_u32(c).unwrap().to_str() + \"'\",\n         ast::lit_int(i, _t) => i.to_str(),\n         ast::lit_uint(u, _t) => u.to_str(),"}, {"sha": "d7138139bc1b6f4dd2e8664acbae2aa6846b600b", "filename": "src/librustpkg/util.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustpkg%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibrustpkg%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Futil.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -406,7 +406,7 @@ impl<'self> Visitor<()> for ViewItemVisitor<'self> {\n             // ignore metadata, I guess\n             ast::view_item_extern_mod(lib_ident, path_opt, _, _) => {\n                 let lib_name = match path_opt {\n-                    Some(p) => p,\n+                    Some((p, _)) => p,\n                     None => self.sess.str_of(lib_ident)\n                 };\n                 debug2!(\"Finding and installing... {}\", lib_name);\n@@ -513,7 +513,7 @@ pub fn find_and_install_dependencies(context: &BuildContext,\n \n pub fn mk_string_lit(s: @str) -> ast::lit {\n     Spanned {\n-        node: ast::lit_str(s),\n+        node: ast::lit_str(s, ast::CookedStr),\n         span: dummy_sp()\n     }\n }"}, {"sha": "63c2f0e519147fb01adca39fd689c3311acd0cc8", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -680,11 +680,17 @@ pub enum mac_ {\n     mac_invoc_tt(Path,~[token_tree],SyntaxContext),   // new macro-invocation\n }\n \n+#[deriving(Clone, Eq, Encodable, Decodable, IterBytes)]\n+pub enum StrStyle {\n+    CookedStr,\n+    RawStr(uint)\n+}\n+\n pub type lit = Spanned<lit_>;\n \n #[deriving(Clone, Eq, Encodable, Decodable, IterBytes)]\n pub enum lit_ {\n-    lit_str(@str),\n+    lit_str(@str, StrStyle),\n     lit_char(u32),\n     lit_int(i64, int_ty),\n     lit_uint(u64, uint_ty),\n@@ -862,6 +868,7 @@ pub enum asm_dialect {\n #[deriving(Clone, Eq, Encodable, Decodable, IterBytes)]\n pub struct inline_asm {\n     asm: @str,\n+    asm_str_style: StrStyle,\n     clobbers: @str,\n     inputs: ~[(@str, @Expr)],\n     outputs: ~[(@str, @Expr)],\n@@ -1027,7 +1034,7 @@ pub enum view_item_ {\n     // optional @str: if present, this is a location (containing\n     // arbitrary characters) from which to fetch the crate sources\n     // For example, extern mod whatever = \"github.com/mozilla/rust\"\n-    view_item_extern_mod(Ident, Option<@str>, ~[@MetaItem], NodeId),\n+    view_item_extern_mod(Ident, Option<(@str, StrStyle)>, ~[@MetaItem], NodeId),\n     view_item_use(~[@view_path]),\n }\n "}, {"sha": "d9a23f6eb35cf6d7edf5f81f0d6d8d69ff604625", "filename": "src/libsyntax/attr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -67,7 +67,7 @@ impl AttrMetaMethods for MetaItem {\n         match self.node {\n             MetaNameValue(_, ref v) => {\n                 match v.node {\n-                    ast::lit_str(s) => Some(s),\n+                    ast::lit_str(s, _) => Some(s),\n                     _ => None,\n                 }\n             },\n@@ -127,7 +127,7 @@ impl AttributeMethods for Attribute {\n /* Constructors */\n \n pub fn mk_name_value_item_str(name: @str, value: @str) -> @MetaItem {\n-    let value_lit = dummy_spanned(ast::lit_str(value));\n+    let value_lit = dummy_spanned(ast::lit_str(value, ast::CookedStr));\n     mk_name_value_item(name, value_lit)\n }\n \n@@ -153,7 +153,7 @@ pub fn mk_attr(item: @MetaItem) -> Attribute {\n \n pub fn mk_sugared_doc_attr(text: @str, lo: BytePos, hi: BytePos) -> Attribute {\n     let style = doc_comment_style(text);\n-    let lit = spanned(lo, hi, ast::lit_str(text));\n+    let lit = spanned(lo, hi, ast::lit_str(text, ast::CookedStr));\n     let attr = Attribute_ {\n         style: style,\n         value: @spanned(lo, hi, MetaNameValue(@\"doc\", lit)),"}, {"sha": "e836367555a74136b66c6def808aa134aa1e8639", "filename": "src/libsyntax/ext/asm.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fasm.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -44,6 +44,7 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n                                        tts.to_owned());\n \n     let mut asm = @\"\";\n+    let mut asm_str_style = None;\n     let mut outputs = ~[];\n     let mut inputs = ~[];\n     let mut cons = ~\"\";\n@@ -58,8 +59,11 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n     while continue_ {\n         match state {\n             Asm => {\n-                asm = expr_to_str(cx, p.parse_expr(),\n-                                  \"inline assembly must be a string literal.\");\n+                let (s, style) =\n+                    expr_to_str(cx, p.parse_expr(),\n+                                \"inline assembly must be a string literal.\");\n+                asm = s;\n+                asm_str_style = Some(style);\n             }\n             Outputs => {\n                 while *p.token != token::EOF &&\n@@ -70,7 +74,7 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n                         p.eat(&token::COMMA);\n                     }\n \n-                    let constraint = p.parse_str();\n+                    let (constraint, _str_style) = p.parse_str();\n                     p.expect(&token::LPAREN);\n                     let out = p.parse_expr();\n                     p.expect(&token::RPAREN);\n@@ -93,7 +97,7 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n                         p.eat(&token::COMMA);\n                     }\n \n-                    let constraint = p.parse_str();\n+                    let (constraint, _str_style) = p.parse_str();\n                     p.expect(&token::LPAREN);\n                     let input = p.parse_expr();\n                     p.expect(&token::RPAREN);\n@@ -111,14 +115,15 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n                         p.eat(&token::COMMA);\n                     }\n \n-                    let clob = format!(\"~\\\\{{}\\\\}\", p.parse_str());\n+                    let (s, _str_style) = p.parse_str();\n+                    let clob = format!(\"~\\\\{{}\\\\}\", s);\n                     clobs.push(clob);\n                 }\n \n                 cons = clobs.connect(\",\");\n             }\n             Options => {\n-                let option = p.parse_str();\n+                let (option, _str_style) = p.parse_str();\n \n                 if \"volatile\" == option {\n                     volatile = true;\n@@ -175,6 +180,7 @@ pub fn expand_asm(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n         id: ast::DUMMY_NODE_ID,\n         node: ast::ExprInlineAsm(ast::inline_asm {\n             asm: asm,\n+            asm_str_style: asm_str_style.unwrap(),\n             clobbers: cons.to_managed(),\n             inputs: inputs,\n             outputs: outputs,"}, {"sha": "7f89271927c63ff2e256dafad596a5e00efb21b5", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -410,10 +410,10 @@ impl ExtCtxt {\n     }\n }\n \n-pub fn expr_to_str(cx: @ExtCtxt, expr: @ast::Expr, err_msg: &str) -> @str {\n+pub fn expr_to_str(cx: @ExtCtxt, expr: @ast::Expr, err_msg: &str) -> (@str, ast::StrStyle) {\n     match expr.node {\n       ast::ExprLit(l) => match l.node {\n-        ast::lit_str(s) => s,\n+        ast::lit_str(s, style) => (s, style),\n         _ => cx.span_fatal(l.span, err_msg)\n       },\n       _ => cx.span_fatal(expr.span, err_msg)\n@@ -437,7 +437,8 @@ pub fn get_single_str_from_tts(cx: @ExtCtxt,\n     }\n \n     match tts[0] {\n-        ast::tt_tok(_, token::LIT_STR(ident)) => cx.str_of(ident),\n+        ast::tt_tok(_, token::LIT_STR(ident))\n+        | ast::tt_tok(_, token::LIT_STR_RAW(ident, _)) => cx.str_of(ident),\n         _ => cx.span_fatal(sp, format!(\"{} requires a string.\", name)),\n     }\n }"}, {"sha": "a5336187200835e9bb65b932459c2f82c2004f4b", "filename": "src/libsyntax/ext/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbuild.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -562,7 +562,7 @@ impl AstBuilder for @ExtCtxt {\n         self.expr_vstore(sp, self.expr_vec(sp, exprs), ast::ExprVstoreSlice)\n     }\n     fn expr_str(&self, sp: Span, s: @str) -> @ast::Expr {\n-        self.expr_lit(sp, ast::lit_str(s))\n+        self.expr_lit(sp, ast::lit_str(s, ast::CookedStr))\n     }\n     fn expr_str_uniq(&self, sp: Span, s: @str) -> @ast::Expr {\n         self.expr_vstore(sp, self.expr_str(sp, s), ast::ExprVstoreUniq)"}, {"sha": "5ebaea2ce44c8d849a68bca8dc1959fc380ddde4", "filename": "src/libsyntax/ext/bytes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbytes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fbytes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbytes.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -28,7 +28,7 @@ pub fn expand_syntax_ext(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree]) -> bas\n             // expression is a literal\n             ast::ExprLit(lit) => match lit.node {\n                 // string literal, push each byte to vector expression\n-                ast::lit_str(s) => {\n+                ast::lit_str(s, _) => {\n                     for byte in s.byte_iter() {\n                         bytes.push(cx.expr_u8(expr.span, byte));\n                     }"}, {"sha": "c31c609d4e74afd0001a3279f7682db9c46a31aa", "filename": "src/libsyntax/ext/deriving/generic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -361,7 +361,7 @@ impl<'self> TraitDef<'self> {\n             span,\n             cx.meta_name_value(span,\n                                @\"doc\",\n-                               ast::lit_str(@\"Automatically derived.\")));\n+                               ast::lit_str(@\"Automatically derived.\", ast::CookedStr)));\n         cx.item(\n             span,\n             ::parse::token::special_idents::clownshoes_extensions,"}, {"sha": "15630e37eadd514ca4e23697d164156172950a6d", "filename": "src/libsyntax/ext/env.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fenv.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -41,10 +41,13 @@ pub fn expand_env(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n         cx.span_fatal(sp, \"env! takes 1 or 2 arguments\");\n     }\n \n-    let var = expr_to_str(cx, exprs[0], \"expected string literal\");\n+    let (var, _var_str_style) = expr_to_str(cx, exprs[0], \"expected string literal\");\n     let msg = match exprs.len() {\n         1 => format!(\"Environment variable {} not defined\", var).to_managed(),\n-        2 => expr_to_str(cx, exprs[1], \"expected string literal\"),\n+        2 => {\n+            let (s, _style) = expr_to_str(cx, exprs[1], \"expected string literal\");\n+            s\n+        }\n         _ => cx.span_fatal(sp, \"env! takes 1 or 2 arguments\")\n     };\n "}, {"sha": "8258048a04db1485c02d4941f7cf05ce17076aef", "filename": "src/libsyntax/ext/fmt.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Ffmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Ffmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ffmt.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -30,7 +30,7 @@ pub fn expand_syntax_ext(cx: @ExtCtxt, sp: Span, tts: &[ast::token_tree])\n     if args.len() == 0 {\n         cx.span_fatal(sp, \"fmt! takes at least 1 argument.\");\n     }\n-    let fmt =\n+    let (fmt, _fmt_str_style) =\n         expr_to_str(cx, args[0],\n                     \"first argument to fmt! must be a string literal.\");\n     let fmtspan = args[0].span;"}, {"sha": "171748e9b2e9943aa13eb5aa48ded356ef863e2d", "filename": "src/libsyntax/ext/format.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fformat.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -722,8 +722,8 @@ pub fn expand_args(ecx: @ExtCtxt, sp: Span,\n         (_, None) => { return MRExpr(ecx.expr_uint(sp, 2)); }\n     };\n     cx.fmtsp = efmt.span;\n-    let fmt = expr_to_str(ecx, efmt,\n-                          \"format argument must be a string literal.\");\n+    let (fmt, _fmt_str_style) = expr_to_str(ecx, efmt,\n+                                            \"format argument must be a string literal.\");\n \n     let mut err = false;\n     do parse::parse_error::cond.trap(|m| {"}, {"sha": "4bef960185523d8e1b8b3db6471e4a05d5af000e", "filename": "src/libsyntax/ext/quote.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fquote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fext%2Fquote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fquote.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -118,7 +118,7 @@ pub mod rt {\n \n     impl<'self> ToSource for &'self str {\n         fn to_source(&self) -> @str {\n-            let lit = dummy_spanned(ast::lit_str(self.to_managed()));\n+            let lit = dummy_spanned(ast::lit_str(self.to_managed(), ast::CookedStr));\n             pprust::lit_to_str(@lit).to_managed()\n         }\n     }\n@@ -464,6 +464,13 @@ fn mk_token(cx: @ExtCtxt, sp: Span, tok: &token::Token) -> @ast::Expr {\n                                       ~[mk_ident(cx, sp, ident)]);\n         }\n \n+        LIT_STR_RAW(ident, n) => {\n+            return cx.expr_call_ident(sp,\n+                                      id_ext(\"LIT_STR_RAW\"),\n+                                      ~[mk_ident(cx, sp, ident),\n+                                        cx.expr_uint(sp, n)]);\n+        }\n+\n         IDENT(ident, b) => {\n             return cx.expr_call_ident(sp,\n                                       id_ext(\"IDENT\"),"}, {"sha": "a43e018cf49493e193af3f48aeb19be38435abcd", "filename": "src/libsyntax/parse/lexer.rs", "status": "modified", "additions": 66, "deletions": 2, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -213,10 +213,22 @@ fn byte_offset(rdr: &StringReader, pos: BytePos) -> BytePos {\n     (pos - rdr.filemap.start_pos)\n }\n \n+/// Calls `f` with a string slice of the source text spanning from `start`\n+/// up to but excluding `rdr.last_pos`, meaning the slice does not include\n+/// the character `rdr.curr`.\n pub fn with_str_from<T>(rdr: @mut StringReader, start: BytePos, f: &fn(s: &str) -> T) -> T {\n+    with_str_from_to(rdr, start, rdr.last_pos, f)\n+}\n+\n+/// Calls `f` with astring slice of the source text spanning from `start`\n+/// up to but excluding `end`.\n+fn with_str_from_to<T>(rdr: @mut StringReader,\n+                       start: BytePos,\n+                       end: BytePos,\n+                       f: &fn(s: &str) -> T) -> T {\n     f(rdr.src.slice(\n             byte_offset(rdr, start).to_uint(),\n-            byte_offset(rdr, rdr.last_pos).to_uint()))\n+            byte_offset(rdr, end).to_uint()))\n }\n \n // EFFECT: advance the StringReader by one character. If a newline is\n@@ -612,7 +624,10 @@ fn ident_continue(c: char) -> bool {\n // EFFECT: updates the interner\n fn next_token_inner(rdr: @mut StringReader) -> token::Token {\n     let c = rdr.curr;\n-    if ident_start(c) {\n+    if ident_start(c) && nextch(rdr) != '\"' && nextch(rdr) != '#' {\n+        // Note: r as in r\" or r#\" is part of a raw string literal,\n+        // not an identifier, and is handled further down.\n+\n         let start = rdr.last_pos;\n         while ident_continue(rdr.curr) {\n             bump(rdr);\n@@ -829,6 +844,47 @@ fn next_token_inner(rdr: @mut StringReader) -> token::Token {\n         bump(rdr);\n         return token::LIT_STR(str_to_ident(accum_str));\n       }\n+      'r' => {\n+        let start_bpos = rdr.last_pos;\n+        bump(rdr);\n+        let mut hash_count = 0u;\n+        while rdr.curr == '#' {\n+            bump(rdr);\n+            hash_count += 1;\n+        }\n+        if rdr.curr != '\"' {\n+            fatal_span_char(rdr, start_bpos, rdr.last_pos,\n+                            ~\"only `#` is allowed in raw string delimitation; \\\n+                              found illegal character\",\n+                            rdr.curr);\n+        }\n+        bump(rdr);\n+        let content_start_bpos = rdr.last_pos;\n+        let mut content_end_bpos;\n+        'outer: loop {\n+            if is_eof(rdr) {\n+                fatal_span(rdr, start_bpos, rdr.last_pos,\n+                           ~\"unterminated raw string\");\n+            }\n+            if rdr.curr == '\"' {\n+                content_end_bpos = rdr.last_pos;\n+                for _ in range(0, hash_count) {\n+                    bump(rdr);\n+                    if rdr.curr != '#' {\n+                        continue 'outer;\n+                    }\n+                }\n+                break;\n+            }\n+            bump(rdr);\n+        }\n+        bump(rdr);\n+        let str_content = with_str_from_to(rdr,\n+                                           content_start_bpos,\n+                                           content_end_bpos,\n+                                           str_to_ident);\n+        return token::LIT_STR_RAW(str_content, hash_count);\n+      }\n       '-' => {\n         if nextch(rdr) == '>' {\n             bump(rdr);\n@@ -987,6 +1043,14 @@ mod test {\n         assert_eq!(tok, token::LIFETIME(id));\n     }\n \n+    #[test] fn raw_string() {\n+        let env = setup(@\"r###\\\"\\\"#a\\\\b\\x00c\\\"\\\"###\");\n+        let TokenAndSpan {tok, sp: _} =\n+            env.string_reader.next_token();\n+        let id = token::str_to_ident(\"\\\"#a\\\\b\\x00c\\\"\");\n+        assert_eq!(tok, token::LIT_STR_RAW(id, 3));\n+    }\n+\n     #[test] fn line_doc_comments() {\n         assert!(!is_line_non_doc_comment(\"///\"));\n         assert!(!is_line_non_doc_comment(\"/// blah\"));"}, {"sha": "ffebe7980bf5101544f8cfa7e3ddf3768bd1d308", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 24, "deletions": 21, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -48,6 +48,7 @@ use ast::{BiRem, required};\n use ast::{ret_style, return_val, BiShl, BiShr, Stmt, StmtDecl};\n use ast::{StmtExpr, StmtSemi, StmtMac, struct_def, struct_field};\n use ast::{struct_variant_kind, BiSub};\n+use ast::StrStyle;\n use ast::{sty_box, sty_region, sty_static, sty_uniq, sty_value};\n use ast::{token_tree, trait_method, trait_ref, tt_delim, tt_seq, tt_tok};\n use ast::{tt_nonterminal, tuple_variant_kind, Ty, ty_, ty_bot, ty_box};\n@@ -1282,7 +1283,8 @@ impl Parser {\n             token::LIT_FLOAT(s, ft) => lit_float(self.id_to_str(s), ft),\n             token::LIT_FLOAT_UNSUFFIXED(s) =>\n                 lit_float_unsuffixed(self.id_to_str(s)),\n-            token::LIT_STR(s) => lit_str(self.id_to_str(s)),\n+            token::LIT_STR(s) => lit_str(self.id_to_str(s), ast::CookedStr),\n+            token::LIT_STR_RAW(s, n) => lit_str(self.id_to_str(s), ast::RawStr(n)),\n             token::LPAREN => { self.expect(&token::RPAREN); lit_nil },\n             _ => { self.unexpected_last(tok); }\n         }\n@@ -2157,7 +2159,7 @@ impl Parser {\n                 // HACK: turn &[...] into a &-evec\n                 ex = match e.node {\n                   ExprVec(*) | ExprLit(@codemap::Spanned {\n-                    node: lit_str(_), span: _\n+                    node: lit_str(*), span: _\n                   })\n                   if m == MutImmutable => {\n                     ExprVstore(e, ExprVstoreSlice)\n@@ -2181,7 +2183,7 @@ impl Parser {\n               ExprVec(*) | ExprRepeat(*) if m == MutMutable =>\n                 ExprVstore(e, ExprVstoreMutBox),\n               ExprVec(*) |\n-              ExprLit(@codemap::Spanned { node: lit_str(_), span: _}) |\n+              ExprLit(@codemap::Spanned { node: lit_str(*), span: _}) |\n               ExprRepeat(*) if m == MutImmutable => ExprVstore(e, ExprVstoreBox),\n               _ => self.mk_unary(UnBox(m), e)\n             };\n@@ -2194,7 +2196,7 @@ impl Parser {\n             // HACK: turn ~[...] into a ~-evec\n             ex = match e.node {\n               ExprVec(*) |\n-              ExprLit(@codemap::Spanned { node: lit_str(_), span: _}) |\n+              ExprLit(@codemap::Spanned { node: lit_str(*), span: _}) |\n               ExprRepeat(*) => ExprVstore(e, ExprVstoreUniq),\n               _ => self.mk_unary(UnUniq, e)\n             };\n@@ -2706,7 +2708,7 @@ impl Parser {\n             pat = match sub.node {\n               PatLit(e@@Expr {\n                 node: ExprLit(@codemap::Spanned {\n-                    node: lit_str(_),\n+                    node: lit_str(*),\n                     span: _}), _\n               }) => {\n                 let vst = @Expr {\n@@ -2734,7 +2736,7 @@ impl Parser {\n             pat = match sub.node {\n               PatLit(e@@Expr {\n                 node: ExprLit(@codemap::Spanned {\n-                    node: lit_str(_),\n+                    node: lit_str(*),\n                     span: _}), _\n               }) => {\n                 let vst = @Expr {\n@@ -2763,7 +2765,7 @@ impl Parser {\n               pat = match sub.node {\n                   PatLit(e@@Expr {\n                       node: ExprLit(@codemap::Spanned {\n-                            node: lit_str(_), span: _}), _\n+                            node: lit_str(*), span: _}), _\n                   }) => {\n                       let vst = @Expr {\n                           id: ast::DUMMY_NODE_ID,\n@@ -4345,7 +4347,8 @@ impl Parser {\n     // parse a string as an ABI spec on an extern type or module\n     fn parse_opt_abis(&self) -> Option<AbiSet> {\n         match *self.token {\n-            token::LIT_STR(s) => {\n+            token::LIT_STR(s)\n+            | token::LIT_STR_RAW(s, _) => {\n                 self.bump();\n                 let the_string = ident_to_str(&s);\n                 let mut abis = AbiSet::empty();\n@@ -4371,15 +4374,15 @@ impl Parser {\n                                      abi::all_names().connect(\", \"),\n                                      word));\n                         }\n-                    }\n-                }\n+                     }\n+                 }\n                 Some(abis)\n             }\n \n             _ => {\n                 None\n-            }\n-        }\n+             }\n+         }\n     }\n \n     // parse one of the items or view items allowed by the\n@@ -4930,17 +4933,17 @@ impl Parser {\n         }\n     }\n \n-    pub fn parse_optional_str(&self) -> Option<@str> {\n-        match *self.token {\n-            token::LIT_STR(s) => {\n-                self.bump();\n-                Some(ident_to_str(&s))\n-            }\n-            _ => None\n-        }\n+    pub fn parse_optional_str(&self) -> Option<(@str, ast::StrStyle)> {\n+        let (s, style) = match *self.token {\n+            token::LIT_STR(s) => (s, ast::CookedStr),\n+            token::LIT_STR_RAW(s, n) => (s, ast::RawStr(n)),\n+            _ => return None\n+        };\n+        self.bump();\n+        Some((ident_to_str(&s), style))\n     }\n \n-    pub fn parse_str(&self) -> @str {\n+    pub fn parse_str(&self) -> (@str, StrStyle) {\n         match self.parse_optional_str() {\n             Some(s) => { s }\n             _ =>  self.fatal(\"expected string literal\")"}, {"sha": "ba4c2637d10e337f19753f5219d7ea27e2211f34", "filename": "src/libsyntax/parse/token.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Ftoken.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fparse%2Ftoken.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Ftoken.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -79,6 +79,7 @@ pub enum Token {\n     LIT_FLOAT(ast::Ident, ast::float_ty),\n     LIT_FLOAT_UNSUFFIXED(ast::Ident),\n     LIT_STR(ast::Ident),\n+    LIT_STR_RAW(ast::Ident, uint), /* raw str delimited by n hash symbols */\n \n     /* Name components */\n     // an identifier contains an \"is_mod_name\" boolean,\n@@ -194,6 +195,10 @@ pub fn to_str(input: @ident_interner, t: &Token) -> ~str {\n         body\n       }\n       LIT_STR(ref s) => { format!(\"\\\"{}\\\"\", ident_to_str(s).escape_default()) }\n+      LIT_STR_RAW(ref s, n) => {\n+          format!(\"r{delim}\\\"{string}\\\"{delim}\",\n+                  delim=\"#\".repeat(n), string=ident_to_str(s))\n+      }\n \n       /* Name components */\n       IDENT(s, _) => input.get(s.name).to_owned(),\n@@ -243,6 +248,7 @@ pub fn can_begin_expr(t: &Token) -> bool {\n       LIT_FLOAT(_, _) => true,\n       LIT_FLOAT_UNSUFFIXED(_) => true,\n       LIT_STR(_) => true,\n+      LIT_STR_RAW(_, _) => true,\n       POUND => true,\n       AT => true,\n       NOT => true,\n@@ -284,6 +290,7 @@ pub fn is_lit(t: &Token) -> bool {\n       LIT_FLOAT(_, _) => true,\n       LIT_FLOAT_UNSUFFIXED(_) => true,\n       LIT_STR(_) => true,\n+      LIT_STR_RAW(_, _) => true,\n       _ => false\n     }\n }"}, {"sha": "7091a2d5518773201c22f732301bf6bd9720be7d", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -1433,25 +1433,25 @@ pub fn print_expr(s: @ps, expr: &ast::Expr) {\n             word(s.s, \"asm!\");\n         }\n         popen(s);\n-        print_string(s, a.asm);\n+        print_string(s, a.asm, a.asm_str_style);\n         word_space(s, \":\");\n         for &(co, o) in a.outputs.iter() {\n-            print_string(s, co);\n+            print_string(s, co, ast::CookedStr);\n             popen(s);\n             print_expr(s, o);\n             pclose(s);\n             word_space(s, \",\");\n         }\n         word_space(s, \":\");\n         for &(co, o) in a.inputs.iter() {\n-            print_string(s, co);\n+            print_string(s, co, ast::CookedStr);\n             popen(s);\n             print_expr(s, o);\n             pclose(s);\n             word_space(s, \",\");\n         }\n         word_space(s, \":\");\n-        print_string(s, a.clobbers);\n+        print_string(s, a.clobbers, ast::CookedStr);\n         pclose(s);\n       }\n       ast::ExprMac(ref m) => print_mac(s, m),\n@@ -1894,9 +1894,11 @@ pub fn print_view_item(s: @ps, item: &ast::view_item) {\n         ast::view_item_extern_mod(id, ref optional_path, ref mta, _) => {\n             head(s, \"extern mod\");\n             print_ident(s, id);\n-            for p in optional_path.iter() {\n+            for &(ref p, style) in optional_path.iter() {\n+                space(s.s);\n                 word(s.s, \"=\");\n-                print_string(s, *p);\n+                space(s.s);\n+                print_string(s, *p, style);\n             }\n             if !mta.is_empty() {\n                 popen(s);\n@@ -2058,7 +2060,7 @@ pub fn print_literal(s: @ps, lit: &ast::lit) {\n       _ => ()\n     }\n     match lit.node {\n-      ast::lit_str(st) => print_string(s, st),\n+      ast::lit_str(st, style) => print_string(s, st, style),\n       ast::lit_char(ch) => {\n           let mut res = ~\"'\";\n           do char::from_u32(ch).unwrap().escape_default |c| {\n@@ -2178,10 +2180,13 @@ pub fn print_comment(s: @ps, cmnt: &comments::cmnt) {\n     }\n }\n \n-pub fn print_string(s: @ps, st: &str) {\n-    word(s.s, \"\\\"\");\n-    word(s.s, st.escape_default());\n-    word(s.s, \"\\\"\");\n+pub fn print_string(s: @ps, st: &str, style: ast::StrStyle) {\n+    let st = match style {\n+        ast::CookedStr => format!(\"\\\"{}\\\"\", st.escape_default()),\n+        ast::RawStr(n) => format!(\"r{delim}\\\"{string}\\\"{delim}\",\n+                                  delim=\"#\".repeat(n), string=st)\n+    };\n+    word(s.s, st);\n }\n \n pub fn to_str<T>(t: &T, f: &fn(@ps, &T), intr: @ident_interner) -> ~str {"}, {"sha": "83afb33b641cf82090c9ee82bb7b3aef275ef47c", "filename": "src/test/compile-fail/raw-str-delim.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-delim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-delim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fraw-str-delim.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+static s: &'static str =\n+    r#x\"#\"x# //~ ERROR only `#` is allowed in raw string delimitation; found illegal character\n+;"}, {"sha": "3e161041711db59d285c88a68d700fa8d5637d8b", "filename": "src/test/compile-fail/raw-str-unbalanced.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-unbalanced.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-unbalanced.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fraw-str-unbalanced.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+static s: &'static str =\n+    r#\"\n+      \"## //~ ERROR expected `;` but found `#`\n+;"}, {"sha": "4151cf32346ce4fde5636b886c5bb1c8dbbc1633", "filename": "src/test/compile-fail/raw-str-unterminated.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-unterminated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fcompile-fail%2Fraw-str-unterminated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fraw-str-unterminated.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -0,0 +1,14 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+static s: &'static str =\n+    r#\" string literal goes on\n+        and on\n+    //~^^ ERROR unterminated raw string"}, {"sha": "d7960a7ea804089d766796443c628dbb67edbc61", "filename": "src/test/pretty/raw-str-nonexpr.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fpretty%2Fraw-str-nonexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Fpretty%2Fraw-str-nonexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fraw-str-nonexpr.rs?ref=c9196290af3934481bd413e11057725f248fd104", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// pp-exact\n+\n+#[cfg = r#\"just parse this\"#]\n+extern mod blah = r##\"blah\"##;\n+\n+fn main() { unsafe { asm!(r###\"blah\"###); } }"}, {"sha": "bfe5326043983dabdf4f0691c135c77ab4af648a", "filename": "src/test/run-pass/raw-str.rs", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Frun-pass%2Fraw-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9196290af3934481bd413e11057725f248fd104/src%2Ftest%2Frun-pass%2Fraw-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fraw-str.rs?ref=c9196290af3934481bd413e11057725f248fd104"}]}