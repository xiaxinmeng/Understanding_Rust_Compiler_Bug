{"sha": "251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "node_id": "C_kwDOAAsO6NoAKDI1MWY2NjJlNGRjNTAwNTVlODM3NmYzYzFiYjhhYzYxYWM3MTQ4YzE", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-04-14T11:09:26Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-04-14T11:24:22Z"}, "message": "Share `Tag2` impl between `CopyTaggedPtr` and `TaggedPtr` tests", "tree": {"sha": "4a1d4af4d714e8dac6585078968d0a08ed8b0a72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a1d4af4d714e8dac6585078968d0a08ed8b0a72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "html_url": "https://github.com/rust-lang/rust/commit/251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d49e948a83faf8b88cd7f3327e9f65a7296a0f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d49e948a83faf8b88cd7f3327e9f65a7296a0f5", "html_url": "https://github.com/rust-lang/rust/commit/8d49e948a83faf8b88cd7f3327e9f65a7296a0f5"}], "stats": {"total": 93, "additions": 31, "deletions": 62}, "files": [{"sha": "14f282dcbebfeaacd2c9d7e943e0af7651b2aa8e", "filename": "compiler/rustc_data_structures/src/tagged_ptr.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs?ref=251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "patch": "@@ -232,3 +232,32 @@ pub const fn bits_for<T: ?Sized + Aligned>() -> usize {\n \n     bits as usize\n }\n+\n+/// A tag type used in [`CopyTaggedPtr`] and [`TaggedPtr`] tests.\n+#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n+#[cfg(test)]\n+enum Tag2 {\n+    B00 = 0b00,\n+    B01 = 0b01,\n+    B10 = 0b10,\n+    B11 = 0b11,\n+}\n+\n+#[cfg(test)]\n+unsafe impl Tag for Tag2 {\n+    const BITS: usize = 2;\n+\n+    fn into_usize(self) -> usize {\n+        self as _\n+    }\n+\n+    unsafe fn from_usize(tag: usize) -> Self {\n+        match tag {\n+            0b00 => Tag2::B00,\n+            0b01 => Tag2::B01,\n+            0b10 => Tag2::B10,\n+            0b11 => Tag2::B11,\n+            _ => unreachable!(),\n+        }\n+    }\n+}"}, {"sha": "09e7b59fd64d5076c291689991b88acac02b0572", "filename": "compiler/rustc_data_structures/src/tagged_ptr/copy/tests.rs", "status": "modified", "additions": 1, "deletions": 31, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fcopy%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fcopy%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fcopy%2Ftests.rs?ref=251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "patch": "@@ -1,36 +1,6 @@\n use std::ptr;\n \n-use crate::tagged_ptr::{CopyTaggedPtr, Pointer, Tag};\n-\n-#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n-enum Tag2 {\n-    B00 = 0b00,\n-    B01 = 0b01,\n-    B10 = 0b10,\n-    B11 = 0b11,\n-}\n-\n-unsafe impl Tag for Tag2 {\n-    const BITS: usize = 2;\n-\n-    fn into_usize(self) -> usize {\n-        self as _\n-    }\n-\n-    unsafe fn from_usize(tag: usize) -> Self {\n-        const B00: usize = Tag2::B00 as _;\n-        const B01: usize = Tag2::B01 as _;\n-        const B10: usize = Tag2::B10 as _;\n-        const B11: usize = Tag2::B11 as _;\n-        match tag {\n-            B00 => Tag2::B00,\n-            B01 => Tag2::B01,\n-            B10 => Tag2::B10,\n-            B11 => Tag2::B11,\n-            _ => unreachable!(),\n-        }\n-    }\n-}\n+use crate::tagged_ptr::{CopyTaggedPtr, Pointer, Tag, Tag2};\n \n #[test]\n fn smoke() {"}, {"sha": "2c17d678d3aa0ae6c84848ca5a5dd66aba95cc53", "filename": "compiler/rustc_data_structures/src/tagged_ptr/drop/tests.rs", "status": "modified", "additions": 1, "deletions": 31, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fdrop%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/251f662e4dc50055e8376f3c1bb8ac61ac7148c1/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fdrop%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr%2Fdrop%2Ftests.rs?ref=251f662e4dc50055e8376f3c1bb8ac61ac7148c1", "patch": "@@ -1,36 +1,6 @@\n use std::{ptr, sync::Arc};\n \n-use crate::tagged_ptr::{Pointer, Tag, TaggedPtr};\n-\n-#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n-enum Tag2 {\n-    B00 = 0b00,\n-    B01 = 0b01,\n-    B10 = 0b10,\n-    B11 = 0b11,\n-}\n-\n-unsafe impl Tag for Tag2 {\n-    const BITS: usize = 2;\n-\n-    fn into_usize(self) -> usize {\n-        self as _\n-    }\n-\n-    unsafe fn from_usize(tag: usize) -> Self {\n-        const B00: usize = Tag2::B00 as _;\n-        const B01: usize = Tag2::B01 as _;\n-        const B10: usize = Tag2::B10 as _;\n-        const B11: usize = Tag2::B11 as _;\n-        match tag {\n-            B00 => Tag2::B00,\n-            B01 => Tag2::B01,\n-            B10 => Tag2::B10,\n-            B11 => Tag2::B11,\n-            _ => unreachable!(),\n-        }\n-    }\n-}\n+use crate::tagged_ptr::{Pointer, Tag, Tag2, TaggedPtr};\n \n #[test]\n fn smoke() {"}]}