{"sha": "790513056f8fc6aad10f479454d449da2892d284", "node_id": "C_kwDOAAsO6NoAKDc5MDUxMzA1NmY4ZmM2YWFkMTBmNDc5NDU0ZDQ0OWRhMjg5MmQyODQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-20T00:15:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-20T00:15:18Z"}, "message": "Auto merge of #8138 - r00ster91:safety, r=giraffate\n\nFix `SAFETY` comment tag casing in undocumented_unsafe_blocks\n\nThis changes the lint introduced in #7748 to suggest adding a `SAFETY` comment instead of a `Safety` comment.\n\nSearching for `// Safety:` in rust-lang/rust yields 67 results while `// SAFETY:` yields 1072.\nI think it's safe to say that this comment tag is written in upper case, just like `TODO`, `FIXME` and so on are. As such I would expect this lint to follow the official convention as well.\n\nNote that I intentionally introduced some casing diversity in `tests/ui/undocumented_unsafe_blocks.rs` to test more cases than just `Safety:`.\n\nchangelog: Capitalize `SAFETY` comment in [`undocumented_unsafe_blocks`]", "tree": {"sha": "c2343e21c192606bffba3d46621314d1fd9af602", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2343e21c192606bffba3d46621314d1fd9af602"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/790513056f8fc6aad10f479454d449da2892d284", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/790513056f8fc6aad10f479454d449da2892d284", "html_url": "https://github.com/rust-lang/rust/commit/790513056f8fc6aad10f479454d449da2892d284", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/790513056f8fc6aad10f479454d449da2892d284/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1962ce08ef4b6e9cade506ecffca216f7685691f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1962ce08ef4b6e9cade506ecffca216f7685691f", "html_url": "https://github.com/rust-lang/rust/commit/1962ce08ef4b6e9cade506ecffca216f7685691f"}, {"sha": "eba441391d7830081befd4b2dfa23a0b78ace92b", "url": "https://api.github.com/repos/rust-lang/rust/commits/eba441391d7830081befd4b2dfa23a0b78ace92b", "html_url": "https://github.com/rust-lang/rust/commit/eba441391d7830081befd4b2dfa23a0b78ace92b"}], "stats": {"total": 76, "additions": 38, "deletions": 38}, "files": [{"sha": "3d3b4a6679dd1e445b956a8777b6a6e889c93b8d", "filename": "clippy_lints/src/undocumented_unsafe_blocks.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/790513056f8fc6aad10f479454d449da2892d284/clippy_lints%2Fsrc%2Fundocumented_unsafe_blocks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/790513056f8fc6aad10f479454d449da2892d284/clippy_lints%2Fsrc%2Fundocumented_unsafe_blocks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fundocumented_unsafe_blocks.rs?ref=790513056f8fc6aad10f479454d449da2892d284", "patch": "@@ -15,7 +15,7 @@ use std::borrow::Cow;\n \n declare_clippy_lint! {\n     /// ### What it does\n-    /// Checks for `unsafe` blocks without a `// Safety: ` comment\n+    /// Checks for `unsafe` blocks without a `// SAFETY: ` comment\n     /// explaining why the unsafe operations performed inside\n     /// the block are safe.\n     ///\n@@ -36,7 +36,7 @@ declare_clippy_lint! {\n     /// use std::ptr::NonNull;\n     /// let a = &mut 42;\n     ///\n-    /// // Safety: references are guaranteed to be non-null.\n+    /// // SAFETY: references are guaranteed to be non-null.\n     /// let ptr = unsafe { NonNull::new_unchecked(a) };\n     /// ```\n     #[clippy::version = \"1.58.0\"]\n@@ -213,7 +213,7 @@ impl UndocumentedUnsafeBlocks {\n             );\n         } else {\n             let block_indent = indent_of(cx, span);\n-            let suggestion = format!(\"// Safety: ...\\n{}\", snippet(cx, span, \"..\"));\n+            let suggestion = format!(\"// SAFETY: ...\\n{}\", snippet(cx, span, \"..\"));\n \n             span_lint_and_sugg(\n                 cx,"}, {"sha": "111350a6280dc44a4415e30f74fe636f673c0f0e", "filename": "tests/ui/crashes/ice-7868.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fcrashes%2Fice-7868.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fcrashes%2Fice-7868.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-7868.stderr?ref=790513056f8fc6aad10f479454d449da2892d284", "patch": "@@ -7,7 +7,7 @@ LL |     unsafe { 0 };\n    = note: `-D clippy::undocumented-unsafe-blocks` implied by `-D warnings`\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL ~     unsafe { 0 };\n    |\n "}, {"sha": "380303d8152aae2bfc56d37e7a09ddf660f46302", "filename": "tests/ui/undocumented_unsafe_blocks.rs", "status": "modified", "additions": 19, "deletions": 19, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fundocumented_unsafe_blocks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fundocumented_unsafe_blocks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fundocumented_unsafe_blocks.rs?ref=790513056f8fc6aad10f479454d449da2892d284", "patch": "@@ -5,7 +5,7 @@\n fn nested_local() {\n     let _ = {\n         let _ = {\n-            // Safety:\n+            // SAFETY:\n             let _ = unsafe {};\n         };\n     };\n@@ -14,7 +14,7 @@ fn nested_local() {\n fn deep_nest() {\n     let _ = {\n         let _ = {\n-            // Safety:\n+            // SAFETY:\n             let _ = unsafe {};\n \n             // Safety:\n@@ -28,7 +28,7 @@ fn deep_nest() {\n                                 // Safety:\n                                 let _ = unsafe {};\n \n-                                // Safety:\n+                                // SAFETY:\n                                 unsafe {};\n                             };\n                         };\n@@ -44,7 +44,7 @@ fn deep_nest() {\n         unsafe {};\n     };\n \n-    // Safety:\n+    // SAFETY:\n     unsafe {};\n }\n \n@@ -59,7 +59,7 @@ fn line_comment() {\n }\n \n fn line_comment_newlines() {\n-    // Safety:\n+    // SAFETY:\n \n     unsafe {}\n }\n@@ -84,7 +84,7 @@ fn block_comment() {\n }\n \n fn block_comment_newlines() {\n-    /* Safety: */\n+    /* SAFETY: */\n \n     unsafe {}\n }\n@@ -96,7 +96,7 @@ fn inline_block_comment() {\n \n fn block_comment_with_extras() {\n     /* This is a description\n-     * Safety:\n+     * SAFETY:\n      */\n     unsafe {}\n }\n@@ -122,7 +122,7 @@ fn buried_safety() {\n }\n \n fn safety_with_prepended_text() {\n-    // This is a test. Safety:\n+    // This is a test. safety:\n     unsafe {}\n }\n \n@@ -132,7 +132,7 @@ fn local_line_comment() {\n }\n \n fn local_block_comment() {\n-    /* Safety: */\n+    /* SAFETY: */\n     let _ = unsafe {};\n }\n \n@@ -142,18 +142,18 @@ fn comment_array() {\n }\n \n fn comment_tuple() {\n-    // Safety:\n+    // sAFETY:\n     let _ = (42, unsafe {}, \"test\", unsafe {});\n }\n \n fn comment_unary() {\n-    // Safety:\n+    // SAFETY:\n     let _ = *unsafe { &42 };\n }\n \n #[allow(clippy::match_single_binding)]\n fn comment_match() {\n-    // Safety:\n+    // SAFETY:\n     let _ = match unsafe {} {\n         _ => {},\n     };\n@@ -177,7 +177,7 @@ fn comment_macro_call() {\n     }\n \n     t!(\n-        // Safety:\n+        // SAFETY:\n         unsafe {}\n     );\n }\n@@ -194,18 +194,18 @@ fn comment_macro_def() {\n }\n \n fn non_ascii_comment() {\n-    // \u0950\u19fb\u0ed2 Safety: \u0bf5\u2230\n+    // \u0950\u19fb\u0ed2 SaFeTy: \u0bf5\u2230\n     unsafe {};\n }\n \n fn local_commented_block() {\n     let _ =\n-        // Safety:\n+        // safety:\n         unsafe {};\n }\n \n fn local_nest() {\n-    // Safety:\n+    // safety:\n     let _ = [(42, unsafe {}, unsafe {}), (52, unsafe {}, unsafe {})];\n }\n \n@@ -267,17 +267,17 @@ fn no_comment_macro_def() {\n }\n \n fn trailing_comment() {\n-    unsafe {} // Safety:\n+    unsafe {} // SAFETY:\n }\n \n fn internal_comment() {\n     unsafe {\n-        // Safety:\n+        // SAFETY:\n     }\n }\n \n fn interference() {\n-    // Safety\n+    // SAFETY\n \n     let _ = 42;\n "}, {"sha": "f69d0da54e0d6cf4fdb21a80aa73244b5d38e7c5", "filename": "tests/ui/undocumented_unsafe_blocks.stderr", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fundocumented_unsafe_blocks.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/790513056f8fc6aad10f479454d449da2892d284/tests%2Fui%2Fundocumented_unsafe_blocks.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fundocumented_unsafe_blocks.stderr?ref=790513056f8fc6aad10f479454d449da2892d284", "patch": "@@ -7,7 +7,7 @@ LL |     unsafe {}\n    = note: `-D clippy::undocumented-unsafe-blocks` implied by `-D warnings`\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     unsafe {}\n    |\n \n@@ -19,7 +19,7 @@ LL |     let _ = [unsafe { 14 }, unsafe { 15 }, 42, unsafe { 16 }];\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = [unsafe { 14 }, unsafe { 15 }, 42, unsafe { 16 }];\n    |\n \n@@ -31,7 +31,7 @@ LL |     let _ = (42, unsafe {}, \"test\", unsafe {});\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = (42, unsafe {}, \"test\", unsafe {});\n    |\n \n@@ -43,7 +43,7 @@ LL |     let _ = *unsafe { &42 };\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = *unsafe { &42 };\n    |\n \n@@ -55,7 +55,7 @@ LL |     let _ = match unsafe {} {\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = match unsafe {} {\n    |\n \n@@ -67,7 +67,7 @@ LL |     let _ = &unsafe {};\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = &unsafe {};\n    |\n \n@@ -79,7 +79,7 @@ LL |     let _ = [unsafe {}; 5];\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = [unsafe {}; 5];\n    |\n \n@@ -91,7 +91,7 @@ LL |     let _ = unsafe {};\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     let _ = unsafe {};\n    |\n \n@@ -103,7 +103,7 @@ LL |     t!(unsafe {});\n    |\n help: consider adding a safety comment\n    |\n-LL ~     t!(// Safety: ...\n+LL ~     t!(// SAFETY: ...\n LL ~     unsafe {});\n    |\n \n@@ -122,13 +122,13 @@ LL |     t!();\n error: unsafe block missing a safety comment\n   --> $DIR/undocumented_unsafe_blocks.rs:270:5\n    |\n-LL |     unsafe {} // Safety:\n+LL |     unsafe {} // SAFETY:\n    |     ^^^^^^^^^\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n-LL ~     unsafe {} // Safety:\n+LL ~     // SAFETY: ...\n+LL ~     unsafe {} // SAFETY:\n    |\n \n error: unsafe block missing a safety comment\n@@ -139,7 +139,7 @@ LL |     unsafe {\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL +     unsafe {\n    |\n \n@@ -151,7 +151,7 @@ LL |     unsafe {};\n    |\n help: consider adding a safety comment\n    |\n-LL ~     // Safety: ...\n+LL ~     // SAFETY: ...\n LL ~     unsafe {};\n    |\n \n@@ -163,7 +163,7 @@ LL |     println!(\"{}\", unsafe { String::from_utf8_unchecked(vec![]) });\n    |\n help: consider adding a safety comment\n    |\n-LL ~     println!(\"{}\", // Safety: ...\n+LL ~     println!(\"{}\", // SAFETY: ...\n LL ~     unsafe { String::from_utf8_unchecked(vec![]) });\n    |\n "}]}