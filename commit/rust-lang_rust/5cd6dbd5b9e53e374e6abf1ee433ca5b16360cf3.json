{"sha": "5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZDZkYmQ1YjllNTNlMzc0ZTZhYmYxZWU0MzNjYTViMTYzNjBjZjM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-06T23:12:45Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-06T23:12:45Z"}, "message": "Always use an absolute path for the backup install prefix rpath", "tree": {"sha": "9809c64b9b9bf79d5934c15d403f905b36cd937e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9809c64b9b9bf79d5934c15d403f905b36cd937e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3", "html_url": "https://github.com/rust-lang/rust/commit/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04e89af6dbf0e99c8cec6763a81b41dcf51e52c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/04e89af6dbf0e99c8cec6763a81b41dcf51e52c3", "html_url": "https://github.com/rust-lang/rust/commit/04e89af6dbf0e99c8cec6763a81b41dcf51e52c3"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "781e42ef0e6a24ed15438f31f372cdc599e0f437", "filename": "src/comp/back/rpath.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3/src%2Fcomp%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3/src%2Fcomp%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Frpath.rs?ref=5cd6dbd5b9e53e374e6abf1ee433ca5b16360cf3", "patch": "@@ -71,7 +71,7 @@ fn get_rpaths(os: session::os, cwd: fs::path, sysroot: fs::path,\n     let abs_rpaths = get_absolute_rpaths(cwd, libs);\n \n     // And a final backup rpath to the global library location.\n-    let fallback_rpaths = [get_install_prefix_rpath(target_triple)];\n+    let fallback_rpaths = [get_install_prefix_rpath(cwd, target_triple)];\n \n     fn log_rpaths(desc: str, rpaths: [str]) {\n         log #fmt(\"%s rpaths:\", desc);\n@@ -166,7 +166,7 @@ fn get_absolute(cwd: fs::path, lib: fs::path) -> fs::path {\n     }\n }\n \n-fn get_install_prefix_rpath(target_triple: str) -> str {\n+fn get_install_prefix_rpath(cwd: fs::path, target_triple: str) -> str {\n     let install_prefix = #env(\"CFG_PREFIX\");\n \n     if install_prefix == \"\" {\n@@ -176,7 +176,7 @@ fn get_install_prefix_rpath(target_triple: str) -> str {\n     let path = [install_prefix]\n         + filesearch::relative_target_lib_path(target_triple);\n     check vec::is_not_empty(path);\n-    fs::connect_many(path)\n+    get_absolute(cwd, fs::connect_many(path))\n }\n \n fn minimize_rpaths(rpaths: [str]) -> [str] {\n@@ -219,8 +219,15 @@ mod test {\n \n     #[test]\n     fn test_prefix_rpath() {\n-        let res = get_install_prefix_rpath(\"triple\");\n-        assert res == #env(\"CFG_PREFIX\") + \"/lib/rustc/triple/lib\";\n+        let res = get_install_prefix_rpath(\"/usr/lib\", \"triple\");\n+        assert str::ends_with(res, #env(\"CFG_PREFIX\")\n+                              + \"/lib/rustc/triple/lib\");\n+    }\n+\n+    #[test]\n+    fn test_prefix_rpath_abs() {\n+        let res = get_install_prefix_rpath(\"/usr/lib\", \"triple\");\n+        assert str::starts_with(res, \"/\");\n     }\n \n     #[test]"}]}