{"sha": "2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "node_id": "C_kwDOAAsO6NoAKDJlMTdhNWQ0MDYwYzg2YjFlMmRjNzA3YTYwNWIwNmViZmMwZWQyMGE", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-12T06:25:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-12T06:25:47Z"}, "message": "Rollup merge of #103800 - danielhenrymantilla:stabilize-pin-macro, r=dtolnay\n\nStabilize `::{core,std}::pin::pin!`\n\nAs discussed [over here](https://github.com/rust-lang/rust/issues/93178#issuecomment-1295843548), it looks like a decent time to stabilize the `pin!` macro.\n\n### Public API\n\n```rust\n// in module `core::pin`\n\n/// API: `fn pin<T>($value: T) -> Pin<&'local mut T>`\npub macro pin($value:expr $(,)?) {\n    \u2026\n}\n```\n\n  - Tracking issue: #93178\n\n(now all this needs is an FCP by the proper team?)", "tree": {"sha": "1298d7f48181b8f8b1d40137aff3631ae75c8ed6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1298d7f48181b8f8b1d40137aff3631ae75c8ed6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjv6frCRBK7hj4Ov3rIwAA1QcIALH8lSqpgjMFVRPd5vCpMhW1\n9emgcCYNa7YRo1U4pBdbbrzl5jzVSoGXJ+4DdqpMXoAvR79nTnEgWAF/iq6ny/9E\nQmA2lLL070qit+PC3CyLA1vLeNVr2kZNQAMS4n+PrnI+ub2A9oglWu2BVZHU/42q\nzTMapi0f16D4A1bSTlWNm6hlCxTXK4Ksf6mY3nK/YdJVCUjpr0i/HYjPkDP6qg/E\nhepyqIZJL4HisnqvJJ7uS8m5n3nwNKLtAh3Is3ban3Y9ASVsczgrKNKS6ZlPMID4\nF9+Q1+3BDGPB+Blte6H24uQtqvn+wRCmCbZ2bImxxBZbLYk2+a50S7HGK7NMRrU=\n=h/9t\n-----END PGP SIGNATURE-----\n", "payload": "tree 1298d7f48181b8f8b1d40137aff3631ae75c8ed6\nparent e23b0fd318c3e5d28092e78d69977d21d1b1843e\nparent 48b7e2a5b93e01fbf30484a8dd4f8ead24db0196\nauthor Michael Goulet <michael@errs.io> 1673504747 -0800\ncommitter GitHub <noreply@github.com> 1673504747 -0800\n\nRollup merge of #103800 - danielhenrymantilla:stabilize-pin-macro, r=dtolnay\n\nStabilize `::{core,std}::pin::pin!`\n\nAs discussed [over here](https://github.com/rust-lang/rust/issues/93178#issuecomment-1295843548), it looks like a decent time to stabilize the `pin!` macro.\n\n### Public API\n\n```rust\n// in module `core::pin`\n\n/// API: `fn pin<T>($value: T) -> Pin<&'local mut T>`\npub macro pin($value:expr $(,)?) {\n    \u2026\n}\n```\n\n  - Tracking issue: #93178\n\n(now all this needs is an FCP by the proper team?)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "html_url": "https://github.com/rust-lang/rust/commit/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e23b0fd318c3e5d28092e78d69977d21d1b1843e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e23b0fd318c3e5d28092e78d69977d21d1b1843e", "html_url": "https://github.com/rust-lang/rust/commit/e23b0fd318c3e5d28092e78d69977d21d1b1843e"}, {"sha": "48b7e2a5b93e01fbf30484a8dd4f8ead24db0196", "url": "https://api.github.com/repos/rust-lang/rust/commits/48b7e2a5b93e01fbf30484a8dd4f8ead24db0196", "html_url": "https://github.com/rust-lang/rust/commit/48b7e2a5b93e01fbf30484a8dd4f8ead24db0196"}], "stats": {"total": 23, "additions": 6, "deletions": 17}, "files": [{"sha": "2eb29d4f9c57410081309ed539b6c6f2fb34d1ac", "filename": "library/core/src/pin.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/library%2Fcore%2Fsrc%2Fpin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/library%2Fcore%2Fsrc%2Fpin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fpin.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -622,9 +622,8 @@ impl<P: Deref> Pin<P> {\n     /// that the closure is pinned.\n     ///\n     /// The better alternative is to avoid all that trouble and do the pinning in the outer function\n-    /// instead (here using the unstable `pin` macro):\n+    /// instead (here using the [`pin!`][crate::pin::pin] macro):\n     /// ```\n-    /// #![feature(pin_macro)]\n     /// use std::pin::pin;\n     /// use std::task::Context;\n     /// use std::future::Future;\n@@ -1026,7 +1025,6 @@ impl<P, U> DispatchFromDyn<Pin<U>> for Pin<P> where P: DispatchFromDyn<U> {}\n /// ### Basic usage\n ///\n /// ```rust\n-/// #![feature(pin_macro)]\n /// # use core::marker::PhantomPinned as Foo;\n /// use core::pin::{pin, Pin};\n ///\n@@ -1044,7 +1042,6 @@ impl<P, U> DispatchFromDyn<Pin<U>> for Pin<P> where P: DispatchFromDyn<U> {}\n /// ### Manually polling a `Future` (without `Unpin` bounds)\n ///\n /// ```rust\n-/// #![feature(pin_macro)]\n /// use std::{\n ///     future::Future,\n ///     pin::pin,\n@@ -1083,7 +1080,7 @@ impl<P, U> DispatchFromDyn<Pin<U>> for Pin<P> where P: DispatchFromDyn<U> {}\n /// ### With `Generator`s\n ///\n /// ```rust\n-/// #![feature(generators, generator_trait, pin_macro)]\n+/// #![feature(generators, generator_trait)]\n /// use core::{\n ///     ops::{Generator, GeneratorState},\n ///     pin::pin,\n@@ -1126,7 +1123,6 @@ impl<P, U> DispatchFromDyn<Pin<U>> for Pin<P> where P: DispatchFromDyn<U> {}\n /// The following, for instance, fails to compile:\n ///\n /// ```rust,compile_fail\n-/// #![feature(pin_macro)]\n /// use core::pin::{pin, Pin};\n /// # use core::{marker::PhantomPinned as Foo, mem::drop as stuff};\n ///\n@@ -1168,7 +1164,7 @@ impl<P, U> DispatchFromDyn<Pin<U>> for Pin<P> where P: DispatchFromDyn<U> {}\n /// constructor.\n ///\n /// [`Box::pin`]: ../../std/boxed/struct.Box.html#method.pin\n-#[unstable(feature = \"pin_macro\", issue = \"93178\")]\n+#[stable(feature = \"pin_macro\", since = \"CURRENT_RUSTC_VERSION\")]\n #[rustc_macro_transparency = \"semitransparent\"]\n #[allow_internal_unstable(unsafe_pin_internals)]\n pub macro pin($value:expr $(,)?) {"}, {"sha": "42a26ae1675c182fb7e7c300e220d96aec2bc115", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -48,7 +48,6 @@\n #![feature(is_sorted)]\n #![feature(layout_for_ptr)]\n #![feature(pattern)]\n-#![feature(pin_macro)]\n #![feature(sort_internals)]\n #![feature(slice_take)]\n #![feature(slice_from_ptr_range)]"}, {"sha": "fe4078f77107b244d564595b8bf06fa98add2582", "filename": "src/tools/miri/tests/pass/issues/issue-miri-2068.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fissues%2Fissue-miri-2068.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fissues%2Fissue-miri-2068.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fissues%2Fissue-miri-2068.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,3 @@\n-#![feature(pin_macro)]\n-\n use core::future::Future;\n use core::pin::Pin;\n use core::task::{Context, Poll};"}, {"sha": "96fc0be344dbfea2f8065c503b4df6b3057d0a7c", "filename": "src/tools/miri/tests/pass/stacked-borrows/future-self-referential.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Ffuture-self-referential.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Ffuture-self-referential.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Fpass%2Fstacked-borrows%2Ffuture-self-referential.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,3 @@\n-#![feature(pin_macro)]\n-\n use std::future::*;\n use std::marker::PhantomPinned;\n use std::pin::*;"}, {"sha": "5826a18b5718b781c7bc364676aa96f9de4a7515", "filename": "tests/ui/pin-macro/cant_access_internals.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Fcant_access_internals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Fcant_access_internals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpin-macro%2Fcant_access_internals.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,4 @@\n // edition:2018\n-#![feature(pin_macro)]\n \n use core::{\n     marker::PhantomPinned,"}, {"sha": "d43027657f0462031f43fad7c652113179787f10", "filename": "tests/ui/pin-macro/cant_access_internals.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Fcant_access_internals.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Fcant_access_internals.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpin-macro%2Fcant_access_internals.stderr?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,5 @@\n error[E0658]: use of unstable library feature 'unsafe_pin_internals'\n-  --> $DIR/cant_access_internals.rs:12:15\n+  --> $DIR/cant_access_internals.rs:11:15\n    |\n LL |     mem::take(phantom_pinned.pointer);\n    |               ^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "59774bc753dc9e6e8e8b9da13168d3aba728b91c", "filename": "tests/ui/pin-macro/lifetime_errors_on_promotion_misusage.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.rs?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,4 @@\n // edition:2018\n-#![feature(pin_macro)]\n \n use core::{\n     convert::identity,"}, {"sha": "4ecc6370d3caad2a64cca22f979853187c39c7e1", "filename": "tests/ui/pin-macro/lifetime_errors_on_promotion_misusage.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpin-macro%2Flifetime_errors_on_promotion_misusage.stderr?ref=2e17a5d4060c86b1e2dc707a605b06ebfc0ed20a", "patch": "@@ -1,5 +1,5 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/lifetime_errors_on_promotion_misusage.rs:12:35\n+  --> $DIR/lifetime_errors_on_promotion_misusage.rs:11:35\n    |\n LL |     let phantom_pinned = identity(pin!(PhantomPinned));\n    |                                   ^^^^^^^^^^^^^^^^^^^ - temporary value is freed at the end of this statement\n@@ -13,7 +13,7 @@ LL |     stuff(phantom_pinned)\n    = note: this error originates in the macro `pin` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/lifetime_errors_on_promotion_misusage.rs:19:30\n+  --> $DIR/lifetime_errors_on_promotion_misusage.rs:18:30\n    |\n LL |     let phantom_pinned = {\n    |         -------------- borrow later stored here"}]}