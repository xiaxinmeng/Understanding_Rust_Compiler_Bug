{"sha": "1e926f06528ecb2503f026e2fd53cb735d487b10", "node_id": "C_kwDOAAsO6NoAKDFlOTI2ZjA2NTI4ZWNiMjUwM2YwMjZlMmZkNTNjYjczNWQ0ODdiMTA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-11T08:09:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-11T08:09:41Z"}, "message": "Auto merge of #102755 - pcc:data-local-tmp, r=Mark-Simulacrum\n\ntools/remote-test-{server,client}: Use /data/local/tmp on Android\n\nThe /data/tmp directory does not exist, at least not on recent versions of Android, which currently leads to test failures on that platform. I checked a virtual device running AOSP master and a Nexus 5 running Android Marshmallow and on both devices the /data/tmp directory does not exist and /data/local/tmp does, so let's switch to /data/local/tmp.", "tree": {"sha": "bc806408b6530e64536a0f8269f3987220ad7622", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc806408b6530e64536a0f8269f3987220ad7622"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e926f06528ecb2503f026e2fd53cb735d487b10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e926f06528ecb2503f026e2fd53cb735d487b10", "html_url": "https://github.com/rust-lang/rust/commit/1e926f06528ecb2503f026e2fd53cb735d487b10", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e926f06528ecb2503f026e2fd53cb735d487b10/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "365578445c6771bb74bfd341c8c48867164a9992", "url": "https://api.github.com/repos/rust-lang/rust/commits/365578445c6771bb74bfd341c8c48867164a9992", "html_url": "https://github.com/rust-lang/rust/commit/365578445c6771bb74bfd341c8c48867164a9992"}, {"sha": "9a1c1c7941e111b67e89cc6e0738455d6edbbd5e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a1c1c7941e111b67e89cc6e0738455d6edbbd5e", "html_url": "https://github.com/rust-lang/rust/commit/9a1c1c7941e111b67e89cc6e0738455d6edbbd5e"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "8d4914097787f920ed1c295c9028f3a81e017cf7", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=1e926f06528ecb2503f026e2fd53cb735d487b10", "patch": "@@ -23,7 +23,7 @@ use crate::toolstate::ToolState;\n use crate::util::{self, add_link_lib_path, dylib_path, dylib_path_var, output, t};\n use crate::{envify, CLang, DocTests, GitRepo, Mode};\n \n-const ADB_TEST_DIR: &str = \"/data/tmp/work\";\n+const ADB_TEST_DIR: &str = \"/data/local/tmp/work\";\n \n /// The two modes of the test runner; tests or benchmarks.\n #[derive(Debug, PartialEq, Eq, Hash, Copy, Clone, PartialOrd, Ord)]"}, {"sha": "bcda930d093c5be1381f527109defea52a84dbfa", "filename": "src/tools/remote-test-client/src/main.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Ftools%2Fremote-test-client%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Ftools%2Fremote-test-client%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fremote-test-client%2Fsrc%2Fmain.rs?ref=1e926f06528ecb2503f026e2fd53cb735d487b10", "patch": "@@ -93,7 +93,7 @@ fn start_android_emulator(server: &Path) {\n \n     println!(\"pushing server\");\n     let status =\n-        Command::new(\"adb\").arg(\"push\").arg(server).arg(\"/data/tmp/testd\").status().unwrap();\n+        Command::new(\"adb\").arg(\"push\").arg(server).arg(\"/data/local/tmp/testd\").status().unwrap();\n     assert!(status.success());\n \n     println!(\"forwarding tcp\");\n@@ -102,7 +102,7 @@ fn start_android_emulator(server: &Path) {\n     assert!(status.success());\n \n     println!(\"executing server\");\n-    Command::new(\"adb\").arg(\"shell\").arg(\"/data/tmp/testd\").spawn().unwrap();\n+    Command::new(\"adb\").arg(\"shell\").arg(\"/data/local/tmp/testd\").spawn().unwrap();\n }\n \n fn prepare_rootfs(target: &str, rootfs: &Path, server: &Path, rootfs_img: &Path) {"}, {"sha": "bed9d39161df804ee63de4e8f966d20067eb8275", "filename": "src/tools/remote-test-server/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e926f06528ecb2503f026e2fd53cb735d487b10/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fremote-test-server%2Fsrc%2Fmain.rs?ref=1e926f06528ecb2503f026e2fd53cb735d487b10", "patch": "@@ -98,7 +98,7 @@ fn main() {\n \n     let listener = t!(TcpListener::bind(config.bind));\n     let (work, tmp): (PathBuf, PathBuf) = if cfg!(target_os = \"android\") {\n-        (\"/data/tmp/work\".into(), \"/data/tmp/work/tmp\".into())\n+        (\"/data/local/tmp/work\".into(), \"/data/local/tmp/work/tmp\".into())\n     } else {\n         let mut work_dir = env::temp_dir();\n         work_dir.push(\"work\");"}]}