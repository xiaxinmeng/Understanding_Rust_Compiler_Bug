{"sha": "8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjYmVhZjczODI2N2M4ZGRiNWFiMjA1ZGFlNDQwNGUyZjI1ZWVlZWI=", "commit": {"author": {"name": "Roxane", "email": "roxane.fruytier@hotmail.com", "date": "2021-07-09T14:18:55Z"}, "committer": {"name": "Roxane", "email": "roxane.fruytier@hotmail.com", "date": "2021-07-09T14:18:55Z"}, "message": "Address comments", "tree": {"sha": "bd3481fecdebf1103e56ab3afa5f051b74a5d23c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd3481fecdebf1103e56ab3afa5f051b74a5d23c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "html_url": "https://github.com/rust-lang/rust/commit/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/comments", "author": {"login": "roxelo", "id": 12419401, "node_id": "MDQ6VXNlcjEyNDE5NDAx", "avatar_url": "https://avatars.githubusercontent.com/u/12419401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roxelo", "html_url": "https://github.com/roxelo", "followers_url": "https://api.github.com/users/roxelo/followers", "following_url": "https://api.github.com/users/roxelo/following{/other_user}", "gists_url": "https://api.github.com/users/roxelo/gists{/gist_id}", "starred_url": "https://api.github.com/users/roxelo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roxelo/subscriptions", "organizations_url": "https://api.github.com/users/roxelo/orgs", "repos_url": "https://api.github.com/users/roxelo/repos", "events_url": "https://api.github.com/users/roxelo/events{/privacy}", "received_events_url": "https://api.github.com/users/roxelo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "roxelo", "id": 12419401, "node_id": "MDQ6VXNlcjEyNDE5NDAx", "avatar_url": "https://avatars.githubusercontent.com/u/12419401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roxelo", "html_url": "https://github.com/roxelo", "followers_url": "https://api.github.com/users/roxelo/followers", "following_url": "https://api.github.com/users/roxelo/following{/other_user}", "gists_url": "https://api.github.com/users/roxelo/gists{/gist_id}", "starred_url": "https://api.github.com/users/roxelo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roxelo/subscriptions", "organizations_url": "https://api.github.com/users/roxelo/orgs", "repos_url": "https://api.github.com/users/roxelo/repos", "events_url": "https://api.github.com/users/roxelo/events{/privacy}", "received_events_url": "https://api.github.com/users/roxelo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca443729575da9c81e47da80adcbf1b14fa1e09b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca443729575da9c81e47da80adcbf1b14fa1e09b", "html_url": "https://github.com/rust-lang/rust/commit/ca443729575da9c81e47da80adcbf1b14fa1e09b"}], "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "b6d1468b7a6178360573f4eccc32e448cfeee52e", "filename": "compiler/rustc_typeck/src/check/upvar.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -619,7 +619,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         }\n \n         if auto_trait_reasons.len() > 0 && drop_reason {\n-            reasons = format!(\"{}, and \", reasons);\n+            reasons = format!(\"{} and \", reasons);\n         }\n \n         if drop_reason {\n@@ -886,12 +886,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             };\n \n             // Combine all the captures responsible for needing migrations into one HashSet\n-            let mut capture_disagnostic = drop_reorder_diagnostic.clone();\n+            let mut capture_diagnostic = drop_reorder_diagnostic.clone();\n             for key in auto_trait_diagnostic.keys() {\n-                capture_disagnostic.insert(key.clone());\n+                capture_diagnostic.insert(key.clone());\n             }\n \n-            for captured_info in capture_disagnostic.iter() {\n+            for captured_info in capture_diagnostic.iter() {\n                 // Get the auto trait reasons of why migration is needed because of that capture, if there are any\n                 let capture_trait_reasons =\n                     if let Some(reasons) = auto_trait_diagnostic.get(captured_info) {\n@@ -917,7 +917,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 ));\n             }\n \n-            if capture_disagnostic.len() > 0 {\n+            if capture_diagnostic.len() > 0 {\n                 need_migrations.push((var_hir_id, responsible_captured_hir_ids));\n             }\n         }"}, {"sha": "e2b7b8f0275204194965c83012005aba659739bd", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -56,7 +56,7 @@ impl Clone for U {\n fn test_clone_trait() {\n     let f = U(S(String::from(\"Hello World\")), T(0));\n     let c = || { let _ = &f; \n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f.1` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f` to be fully captured"}, {"sha": "6c56ca27475a3d177492a48885e29ea70989b66d", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -56,7 +56,7 @@ impl Clone for U {\n fn test_clone_trait() {\n     let f = U(S(String::from(\"Hello World\")), T(0));\n     let c = || {\n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f.1` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f` to be fully captured"}, {"sha": "9c954b1465d837e5a3d8293382a76323d92eae2b", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -43,7 +43,7 @@ LL |\n LL |         *fptr.0.0 = 20;\n  ...\n \n-error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure, and drop order\n+error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure and drop order\n   --> $DIR/auto_traits.rs:58:13\n    |\n LL |     let c = || {"}, {"sha": "98f578abc44dcc1cac03f97d0b8c0fd7da012528", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/multi_diagnostics.fixed", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.fixed?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -21,7 +21,7 @@ fn test_multi_issues() {\n     let f1 = U(S(String::from(\"foo\")), T(0));\n     let f2 = U(S(String::from(\"bar\")), T(0));\n     let c = || { let _ = (&f1, &f2); \n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f1` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f1.0` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f1`, `f2` to be fully captured\n@@ -84,7 +84,7 @@ fn test_capturing_several_disjoint_fields_individually_1() {\n fn test_capturing_several_disjoint_fields_individually_2() {\n     let f1 = U1(S(String::from(\"foo\")), T(0), S(String::from(\"bar\")));\n     let c = || { let _ = &f1; \n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f1` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f1.0` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f1` to be fully captured"}, {"sha": "1577b91c960185a04f71084cbd96ae9c72301190", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/multi_diagnostics.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.rs?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -21,7 +21,7 @@ fn test_multi_issues() {\n     let f1 = U(S(String::from(\"foo\")), T(0));\n     let f2 = U(S(String::from(\"bar\")), T(0));\n     let c = || {\n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f1` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f1.0` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f1`, `f2` to be fully captured\n@@ -84,7 +84,7 @@ fn test_capturing_several_disjoint_fields_individually_1() {\n fn test_capturing_several_disjoint_fields_individually_2() {\n     let f1 = U1(S(String::from(\"foo\")), T(0), S(String::from(\"bar\")));\n     let c = || {\n-        //~^ ERROR: `Clone` trait implementation for closure, and drop order\n+        //~^ ERROR: `Clone` trait implementation for closure and drop order\n         //~| NOTE: in Rust 2018, this closure would implement `Clone` as `f1` implements `Clone`, but in Rust 2021, this closure would no longer implement `Clone` as `f1.0` does not implement `Clone`\n         //~| NOTE: for more information, see\n         //~| HELP: add a dummy let to cause `f1` to be fully captured"}, {"sha": "856fbdf5f9fd027cc71f990bf558d14f209a9347", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/multi_diagnostics.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmulti_diagnostics.stderr?ref=8cbeaf738267c8ddb5ab205dae4404e2f25eeeeb", "patch": "@@ -1,4 +1,4 @@\n-error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure, and drop order\n+error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure and drop order\n   --> $DIR/multi_diagnostics.rs:23:13\n    |\n LL |     let c = || {\n@@ -75,7 +75,7 @@ LL |\n LL |\n  ...\n \n-error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure, and drop order\n+error: changes to closure capture in Rust 2021 will affect `Clone` trait implementation for closure and drop order\n   --> $DIR/multi_diagnostics.rs:86:13\n    |\n LL |     let c = || {\n@@ -90,8 +90,8 @@ LL |         let _f_1 = f1.1;\n LL | }\n    | -\n    | |\n-   | in Rust 2018, `f1` would be dropped here, but in Rust 2021, only `f1.0` would be dropped here alongside the closure\n    | in Rust 2018, `f1` would be dropped here, but in Rust 2021, only `f1.1` would be dropped here alongside the closure\n+   | in Rust 2018, `f1` would be dropped here, but in Rust 2021, only `f1.0` would be dropped here alongside the closure\n    |\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `f1` to be fully captured"}]}