{"sha": "aa6065bd70482cffb23602d59940ade0b290a208", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhNjA2NWJkNzA0ODJjZmZiMjM2MDJkNTk5NDBhZGUwYjI5MGEyMDg=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2017-12-03T13:16:19Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2017-12-21T18:21:40Z"}, "message": "Add a -Z query-threads compiler option", "tree": {"sha": "d1b40e8d9c0c2c4da5392e7d18b60d26738ec2a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d1b40e8d9c0c2c4da5392e7d18b60d26738ec2a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa6065bd70482cffb23602d59940ade0b290a208", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa6065bd70482cffb23602d59940ade0b290a208", "html_url": "https://github.com/rust-lang/rust/commit/aa6065bd70482cffb23602d59940ade0b290a208", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa6065bd70482cffb23602d59940ade0b290a208/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7082dcafb35c636533ecddf1c40d8325c5a20a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7082dcafb35c636533ecddf1c40d8325c5a20a5", "html_url": "https://github.com/rust-lang/rust/commit/f7082dcafb35c636533ecddf1c40d8325c5a20a5"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "84c63a05024a45d49393e2dbf69d82e730cb5707", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa6065bd70482cffb23602d59940ade0b290a208/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa6065bd70482cffb23602d59940ade0b290a208/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=aa6065bd70482cffb23602d59940ade0b290a208", "patch": "@@ -1067,6 +1067,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"prints the llvm optimization passes being run\"),\n     ast_json: bool = (false, parse_bool, [UNTRACKED],\n         \"print the AST as JSON and halt\"),\n+    query_threads: Option<usize> = (None, parse_opt_uint, [UNTRACKED],\n+        \"execute queries on a thread pool with N threads\"),\n     ast_json_noexpand: bool = (false, parse_bool, [UNTRACKED],\n         \"print the pre-expansion AST as JSON and halt\"),\n     ls: bool = (false, parse_bool, [UNTRACKED],\n@@ -1663,6 +1665,10 @@ pub fn build_session_options_and_crate_config(matches: &getopts::Matches)\n         }\n     }\n \n+    if debugging_opts.query_threads == Some(0) {\n+        early_error(error_format, \"Value for query threads must be a positive nonzero integer\");\n+    }\n+\n     if codegen_units == Some(0) {\n         early_error(error_format, \"Value for codegen units must be a positive nonzero integer\");\n     }"}, {"sha": "0de1c20dbde1e02e588d8cfc7beed9d50c2a1e2b", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/aa6065bd70482cffb23602d59940ade0b290a208/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa6065bd70482cffb23602d59940ade0b290a208/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=aa6065bd70482cffb23602d59940ade0b290a208", "patch": "@@ -725,6 +725,12 @@ impl Session {\n         ret\n     }\n \n+    /// Returns the number of query threads that should be used for this\n+    /// compilation\n+    pub fn query_threads(&self) -> usize {\n+        self.opts.debugging_opts.query_threads.unwrap_or(1)\n+    }\n+\n     /// Returns the number of codegen units that should be used for this\n     /// compilation\n     pub fn codegen_units(&self) -> usize {"}]}