{"sha": "af4f66ef938bd21b82a81473974cb620be9a0c72", "node_id": "C_kwDOAAsO6NoAKGFmNGY2NmVmOTM4YmQyMWI4MmE4MTQ3Mzk3NGNiNjIwYmU5YTBjNzI", "commit": {"author": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-08-18T12:14:21Z"}, "committer": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-08-18T12:18:26Z"}, "message": "ADD - ExpectedUsedSymbol diagnostic to port used() diagnostic", "tree": {"sha": "1607eea3d2a40b5edc1706c16d1b420f62794dc7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1607eea3d2a40b5edc1706c16d1b420f62794dc7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af4f66ef938bd21b82a81473974cb620be9a0c72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af4f66ef938bd21b82a81473974cb620be9a0c72", "html_url": "https://github.com/rust-lang/rust/commit/af4f66ef938bd21b82a81473974cb620be9a0c72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af4f66ef938bd21b82a81473974cb620be9a0c72/comments", "author": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f241c0c43d71960f078b897e9b8721d4b452ce5e", "url": "https://api.github.com/repos/rust-lang/rust/commits/f241c0c43d71960f078b897e9b8721d4b452ce5e", "html_url": "https://github.com/rust-lang/rust/commit/f241c0c43d71960f078b897e9b8721d4b452ce5e"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "d937661794a6aea1924457d77eb7f5139e8f11be", "filename": "compiler/rustc_error_messages/locales/en-US/typeck.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Ftypeck.ftl?ref=af4f66ef938bd21b82a81473974cb620be9a0c72", "patch": "@@ -131,3 +131,5 @@ typeck_unused_extern_crate =\n typeck_extern_crate_not_idiomatic =\n     `extern crate` is not idiomatic in the new edition\n     .suggestion = convert it to a `{$msg_code}`\n+\n+typeck_expected_used_symbol = expected `used`, `used(compiler)` or `used(linker)`"}, {"sha": "970b39dc845afbf65225a1b1e966068ef052fa5f", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=af4f66ef938bd21b82a81473974cb620be9a0c72", "patch": "@@ -2836,12 +2836,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, did: DefId) -> CodegenFnAttrs {\n                     codegen_fn_attrs.flags |= CodegenFnAttrFlags::USED;\n                 }\n                 Some(_) => {\n-                    tcx.sess\n-                        .struct_span_err(\n-                            attr.span,\n-                            \"expected `used`, `used(compiler)` or `used(linker)`\",\n-                        )\n-                        .emit();\n+                    tcx.sess.emit_err(errors::ExpectedUsedSymbol { span: attr.span });\n                 }\n                 None => {\n                     // Unfortunately, unconditionally using `llvm.used` causes"}, {"sha": "8b1cb8d1c939ab144c459d287301b43acbeef267", "filename": "compiler/rustc_typeck/src/errors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af4f66ef938bd21b82a81473974cb620be9a0c72/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Ferrors.rs?ref=af4f66ef938bd21b82a81473974cb620be9a0c72", "patch": "@@ -340,3 +340,10 @@ pub struct ExternCrateNotIdiomatic {\n     pub msg_code: String,\n     pub suggestion_code: String,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[error(typeck::expected_used_symbol)]\n+pub struct ExpectedUsedSymbol {\n+    #[primary_span]\n+    pub span: Span,\n+}"}]}