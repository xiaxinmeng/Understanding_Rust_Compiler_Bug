{"sha": "df712ab3d540affe0442763dc1841030bcab7698", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmNzEyYWIzZDU0MGFmZmUwNDQyNzYzZGMxODQxMDMwYmNhYjc2OTg=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-13T01:59:14Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-13T01:59:14Z"}, "message": "libcore: Make %? use the visitor, not shape glue", "tree": {"sha": "2813ad0ec1c32273036c7b3e5dd7393897721ac4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2813ad0ec1c32273036c7b3e5dd7393897721ac4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df712ab3d540affe0442763dc1841030bcab7698", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df712ab3d540affe0442763dc1841030bcab7698", "html_url": "https://github.com/rust-lang/rust/commit/df712ab3d540affe0442763dc1841030bcab7698", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df712ab3d540affe0442763dc1841030bcab7698/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45f5f8ec45da02700d77569b0ea470ae0fb430b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/45f5f8ec45da02700d77569b0ea470ae0fb430b0", "html_url": "https://github.com/rust-lang/rust/commit/45f5f8ec45da02700d77569b0ea470ae0fb430b0"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "1adadc5eba6bbeecb9869f2d0b4577658a1f32c3", "filename": "src/libcore/sys.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/df712ab3d540affe0442763dc1841030bcab7698/src%2Flibcore%2Fsys.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df712ab3d540affe0442763dc1841030bcab7698/src%2Flibcore%2Fsys.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fsys.rs?ref=df712ab3d540affe0442763dc1841030bcab7698", "patch": "@@ -32,11 +32,6 @@ struct Closure {\n     env: *(),\n }\n \n-#[abi = \"cdecl\"]\n-extern mod rustrt {\n-    pure fn shape_log_str(t: *sys::TypeDesc, data: *()) -> ~str;\n-}\n-\n #[abi = \"rust-intrinsic\"]\n extern mod rusti {\n     fn get_tydesc<T>() -> *();\n@@ -104,8 +99,10 @@ pure fn refcount<T>(+t: @T) -> uint {\n \n pure fn log_str<T>(t: T) -> ~str {\n     unsafe {\n-        let data_ptr: *() = unsafe::reinterpret_cast(&ptr::addr_of(t));\n-        rustrt::shape_log_str(get_type_desc::<T>(), data_ptr)\n+        let buffer = io::mem_buffer();\n+        let writer = io::mem_buffer_writer(buffer);\n+        repr::write_repr(writer, &t);\n+        return io::mem_buffer_str(buffer);  // XXX: Extra malloc and copy.\n     }\n }\n "}]}