{"sha": "11663b1b4857ffeafbd85a9a36c234d117373b76", "node_id": "C_kwDOAAsO6NoAKDExNjYzYjFiNDg1N2ZmZWFmYmQ4NWE5YTM2YzIzNGQxMTczNzNiNzY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-02T04:24:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-02T04:24:57Z"}, "message": "Auto merge of #104963 - petrochenkov:noaddids2, r=cjgillot\n\nrustc_ast_lowering: Stop lowering imports into multiple items\n\nLower them into a single item with multiple resolutions instead.\nThis also allows to remove additional `NodId`s and `DefId`s related to those additional items.", "tree": {"sha": "8435bee872a201dd965825f47c9981802dd6f8c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8435bee872a201dd965825f47c9981802dd6f8c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11663b1b4857ffeafbd85a9a36c234d117373b76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11663b1b4857ffeafbd85a9a36c234d117373b76", "html_url": "https://github.com/rust-lang/rust/commit/11663b1b4857ffeafbd85a9a36c234d117373b76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11663b1b4857ffeafbd85a9a36c234d117373b76/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "56c241c86212d84b9528dca1628bc06e32c742c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/56c241c86212d84b9528dca1628bc06e32c742c1", "html_url": "https://github.com/rust-lang/rust/commit/56c241c86212d84b9528dca1628bc06e32c742c1"}, {"sha": "b32a4edb2078ca61ebcd9bad993905873f4a990a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b32a4edb2078ca61ebcd9bad993905873f4a990a", "html_url": "https://github.com/rust-lang/rust/commit/b32a4edb2078ca61ebcd9bad993905873f4a990a"}], "stats": {"total": 551, "additions": 227, "deletions": 324}, "files": [{"sha": "f2f8e1386a5c7dcae63a8111a4663eaaca2fd349", "filename": "compiler/rustc_ast/src/ast.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fast.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -2517,10 +2517,7 @@ pub struct Variant {\n #[derive(Clone, Encodable, Decodable, Debug)]\n pub enum UseTreeKind {\n     /// `use prefix` or `use prefix as rename`\n-    ///\n-    /// The extra `NodeId`s are for HIR lowering, when additional statements are created for each\n-    /// namespace.\n-    Simple(Option<Ident>, NodeId, NodeId),\n+    Simple(Option<Ident>),\n     /// `use prefix::{...}`\n     Nested(Vec<(UseTree, NodeId)>),\n     /// `use prefix::*`\n@@ -2539,8 +2536,8 @@ pub struct UseTree {\n impl UseTree {\n     pub fn ident(&self) -> Ident {\n         match self.kind {\n-            UseTreeKind::Simple(Some(rename), ..) => rename,\n-            UseTreeKind::Simple(None, ..) => {\n+            UseTreeKind::Simple(Some(rename)) => rename,\n+            UseTreeKind::Simple(None) => {\n                 self.prefix.segments.last().expect(\"empty prefix in a simple import\").ident\n             }\n             _ => panic!(\"`UseTree::ident` can only be used on a simple import\"),"}, {"sha": "963e5a608a4927ecc24551fa6cee3f39f957754e", "filename": "compiler/rustc_ast/src/mut_visit.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -410,11 +410,7 @@ pub fn noop_visit_use_tree<T: MutVisitor>(use_tree: &mut UseTree, vis: &mut T) {\n     let UseTree { prefix, kind, span } = use_tree;\n     vis.visit_path(prefix);\n     match kind {\n-        UseTreeKind::Simple(rename, id1, id2) => {\n-            visit_opt(rename, |rename| vis.visit_ident(rename));\n-            vis.visit_id(id1);\n-            vis.visit_id(id2);\n-        }\n+        UseTreeKind::Simple(rename) => visit_opt(rename, |rename| vis.visit_ident(rename)),\n         UseTreeKind::Nested(items) => {\n             for (tree, id) in items {\n                 vis.visit_use_tree(tree);"}, {"sha": "fe27d7fa8de172bb87587435d18c2b6c256d884b", "filename": "compiler/rustc_ast/src/visit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -439,7 +439,7 @@ pub fn walk_path<'a, V: Visitor<'a>>(visitor: &mut V, path: &'a Path) {\n pub fn walk_use_tree<'a, V: Visitor<'a>>(visitor: &mut V, use_tree: &'a UseTree, id: NodeId) {\n     visitor.visit_path(&use_tree.prefix, id);\n     match &use_tree.kind {\n-        UseTreeKind::Simple(rename, ..) => {\n+        UseTreeKind::Simple(rename) => {\n             // The extra IDs are handled during HIR lowering.\n             if let &Some(rename) = rename {\n                 visitor.visit_ident(rename);"}, {"sha": "f6275433fc51bcde5fb9edf669094fd338c4ba6c", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 15, "deletions": 80, "changes": 95, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -19,7 +19,6 @@ use rustc_span::symbol::{kw, sym, Ident};\n use rustc_span::{Span, Symbol};\n use rustc_target::spec::abi;\n use smallvec::{smallvec, SmallVec};\n-use std::iter;\n use thin_vec::ThinVec;\n \n pub(super) struct ItemLowerer<'a, 'hir> {\n@@ -179,36 +178,22 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let mut node_ids =\n             smallvec![hir::ItemId { owner_id: hir::OwnerId { def_id: self.local_def_id(i.id) } }];\n         if let ItemKind::Use(use_tree) = &i.kind {\n-            self.lower_item_id_use_tree(use_tree, i.id, &mut node_ids);\n+            self.lower_item_id_use_tree(use_tree, &mut node_ids);\n         }\n         node_ids\n     }\n \n-    fn lower_item_id_use_tree(\n-        &mut self,\n-        tree: &UseTree,\n-        base_id: NodeId,\n-        vec: &mut SmallVec<[hir::ItemId; 1]>,\n-    ) {\n+    fn lower_item_id_use_tree(&mut self, tree: &UseTree, vec: &mut SmallVec<[hir::ItemId; 1]>) {\n         match &tree.kind {\n             UseTreeKind::Nested(nested_vec) => {\n                 for &(ref nested, id) in nested_vec {\n                     vec.push(hir::ItemId {\n                         owner_id: hir::OwnerId { def_id: self.local_def_id(id) },\n                     });\n-                    self.lower_item_id_use_tree(nested, id, vec);\n-                }\n-            }\n-            UseTreeKind::Glob => {}\n-            UseTreeKind::Simple(_, id1, id2) => {\n-                for (_, id) in\n-                    iter::zip(self.expect_full_res_from_use(base_id).skip(1), [*id1, *id2])\n-                {\n-                    vec.push(hir::ItemId {\n-                        owner_id: hir::OwnerId { def_id: self.local_def_id(id) },\n-                    });\n+                    self.lower_item_id_use_tree(nested, vec);\n                 }\n             }\n+            UseTreeKind::Simple(..) | UseTreeKind::Glob => {}\n         }\n     }\n \n@@ -489,7 +474,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         let segments = prefix.segments.iter().chain(path.segments.iter()).cloned().collect();\n \n         match tree.kind {\n-            UseTreeKind::Simple(rename, id1, id2) => {\n+            UseTreeKind::Simple(rename) => {\n                 *ident = tree.ident();\n \n                 // First, apply the prefix to the path.\n@@ -505,66 +490,16 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     }\n                 }\n \n-                let mut resolutions = self.expect_full_res_from_use(id).fuse();\n-                // We want to return *something* from this function, so hold onto the first item\n-                // for later.\n-                let ret_res = self.lower_res(resolutions.next().unwrap_or(Res::Err));\n-\n-                // Here, we are looping over namespaces, if they exist for the definition\n-                // being imported. We only handle type and value namespaces because we\n-                // won't be dealing with macros in the rest of the compiler.\n-                // Essentially a single `use` which imports two names is desugared into\n-                // two imports.\n-                for new_node_id in [id1, id2] {\n-                    let new_id = self.local_def_id(new_node_id);\n-                    let Some(res) = resolutions.next() else {\n-                        debug_assert!(self.children.iter().find(|(id, _)| id == &new_id).is_none());\n-                        // Associate an HirId to both ids even if there is no resolution.\n-                        self.children.push((\n-                            new_id,\n-                            hir::MaybeOwner::NonOwner(hir::HirId::make_owner(new_id))),\n-                        );\n-                        continue;\n-                    };\n-                    let ident = *ident;\n-                    let mut path = path.clone();\n-                    for seg in &mut path.segments {\n-                        // Give the cloned segment the same resolution information\n-                        // as the old one (this is needed for stability checking).\n-                        let new_id = self.next_node_id();\n-                        self.resolver.clone_res(seg.id, new_id);\n-                        seg.id = new_id;\n-                    }\n-                    let span = path.span;\n-\n-                    self.with_hir_id_owner(new_node_id, |this| {\n-                        let res = this.lower_res(res);\n-                        let path = this.lower_path_extra(res, &path, ParamMode::Explicit);\n-                        let kind = hir::ItemKind::Use(path, hir::UseKind::Single);\n-                        if let Some(attrs) = attrs {\n-                            this.attrs.insert(hir::ItemLocalId::new(0), attrs);\n-                        }\n-\n-                        let item = hir::Item {\n-                            owner_id: hir::OwnerId { def_id: new_id },\n-                            ident: this.lower_ident(ident),\n-                            kind,\n-                            vis_span,\n-                            span: this.lower_span(span),\n-                        };\n-                        hir::OwnerNode::Item(this.arena.alloc(item))\n-                    });\n-                }\n-\n-                let path = self.lower_path_extra(ret_res, &path, ParamMode::Explicit);\n+                let res =\n+                    self.expect_full_res_from_use(id).map(|res| self.lower_res(res)).collect();\n+                let path = self.lower_use_path(res, &path, ParamMode::Explicit);\n                 hir::ItemKind::Use(path, hir::UseKind::Single)\n             }\n             UseTreeKind::Glob => {\n-                let path = self.lower_path(\n-                    id,\n-                    &Path { segments, span: path.span, tokens: None },\n-                    ParamMode::Explicit,\n-                );\n+                let res = self.expect_full_res(id);\n+                let res = smallvec![self.lower_res(res)];\n+                let path = Path { segments, span: path.span, tokens: None };\n+                let path = self.lower_use_path(res, &path, ParamMode::Explicit);\n                 hir::ItemKind::Use(path, hir::UseKind::Glob)\n             }\n             UseTreeKind::Nested(ref trees) => {\n@@ -634,9 +569,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     });\n                 }\n \n-                let res = self.expect_full_res_from_use(id).next().unwrap_or(Res::Err);\n-                let res = self.lower_res(res);\n-                let path = self.lower_path_extra(res, &prefix, ParamMode::Explicit);\n+                let res =\n+                    self.expect_full_res_from_use(id).map(|res| self.lower_res(res)).collect();\n+                let path = self.lower_use_path(res, &prefix, ParamMode::Explicit);\n                 hir::ItemKind::Use(path, hir::UseKind::ListStem)\n             }\n         }"}, {"sha": "8d23c26e603b77bf035aded708af0676d47dff59", "filename": "compiler/rustc_ast_lowering/src/path.rs", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -12,7 +12,7 @@ use rustc_hir::GenericArg;\n use rustc_span::symbol::{kw, Ident};\n use rustc_span::{BytePos, Span, DUMMY_SP};\n \n-use smallvec::smallvec;\n+use smallvec::{smallvec, SmallVec};\n \n impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     #[instrument(level = \"trace\", skip(self))]\n@@ -144,13 +144,13 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         );\n     }\n \n-    pub(crate) fn lower_path_extra(\n+    pub(crate) fn lower_use_path(\n         &mut self,\n-        res: Res,\n+        res: SmallVec<[Res; 3]>,\n         p: &Path,\n         param_mode: ParamMode,\n-    ) -> &'hir hir::Path<'hir> {\n-        self.arena.alloc(hir::Path {\n+    ) -> &'hir hir::UsePath<'hir> {\n+        self.arena.alloc(hir::UsePath {\n             res,\n             segments: self.arena.alloc_from_iter(p.segments.iter().map(|segment| {\n                 self.lower_path_segment(\n@@ -165,17 +165,6 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         })\n     }\n \n-    pub(crate) fn lower_path(\n-        &mut self,\n-        id: NodeId,\n-        p: &Path,\n-        param_mode: ParamMode,\n-    ) -> &'hir hir::Path<'hir> {\n-        let res = self.expect_full_res(id);\n-        let res = self.lower_res(res);\n-        self.lower_path_extra(res, p, param_mode)\n-    }\n-\n     pub(crate) fn lower_path_segment(\n         &mut self,\n         path_span: Span,"}, {"sha": "e68a7b3f202b3e4238d26675bca20291e5d7df14", "filename": "compiler/rustc_ast_pretty/src/pprust/state/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fitem.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -663,7 +663,7 @@ impl<'a> State<'a> {\n \n     fn print_use_tree(&mut self, tree: &ast::UseTree) {\n         match &tree.kind {\n-            ast::UseTreeKind::Simple(rename, ..) => {\n+            ast::UseTreeKind::Simple(rename) => {\n                 self.print_path(&tree.prefix, false, 0);\n                 if let &Some(rename) = rename {\n                     self.nbsp();"}, {"sha": "d82bc0453f5722c0912c4a9463dcf461daf941ec", "filename": "compiler/rustc_builtin_macros/src/assert/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -106,7 +106,7 @@ impl<'cx, 'a> Context<'cx, 'a> {\n             (\n                 UseTree {\n                     prefix: this.cx.path(this.span, vec![Ident::with_dummy_span(sym)]),\n-                    kind: UseTreeKind::Simple(None, DUMMY_NODE_ID, DUMMY_NODE_ID),\n+                    kind: UseTreeKind::Simple(None),\n                     span: this.span,\n                 },\n                 DUMMY_NODE_ID,"}, {"sha": "e2c33e7e06268328a9d027e2e1b48eb6f1e8d778", "filename": "compiler/rustc_data_structures/src/stable_hasher.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -399,7 +399,7 @@ where\n     }\n }\n \n-impl<A, CTX> HashStable<CTX> for SmallVec<[A; 1]>\n+impl<A, const N: usize, CTX> HashStable<CTX> for SmallVec<[A; N]>\n where\n     A: HashStable<CTX>,\n {"}, {"sha": "c89e7eb75f8f0d9480aa31e51435eabbb9ad6947", "filename": "compiler/rustc_hir/src/arena.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Farena.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Farena.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Farena.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -39,6 +39,7 @@ macro_rules! arena_types {\n             [] param: rustc_hir::Param<'tcx>,\n             [] pat: rustc_hir::Pat<'tcx>,\n             [] path: rustc_hir::Path<'tcx>,\n+            [] use_path: rustc_hir::UsePath<'tcx>,\n             [] path_segment: rustc_hir::PathSegment<'tcx>,\n             [] poly_trait_ref: rustc_hir::PolyTraitRef<'tcx>,\n             [] qpath: rustc_hir::QPath<'tcx>,"}, {"sha": "118eafe2910f0a8f504247c3a6f345b8ef1bcad0", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -183,14 +183,17 @@ impl Lifetime {\n /// `std::cmp::PartialEq`. It's represented as a sequence of identifiers,\n /// along with a bunch of supporting information.\n #[derive(Debug, HashStable_Generic)]\n-pub struct Path<'hir> {\n+pub struct Path<'hir, R = Res> {\n     pub span: Span,\n     /// The resolution for the path.\n-    pub res: Res,\n+    pub res: R,\n     /// The segments in the path: the things separated by `::`.\n     pub segments: &'hir [PathSegment<'hir>],\n }\n \n+/// Up to three resolutions for type, value and macro namespaces.\n+pub type UsePath<'hir> = Path<'hir, SmallVec<[Res; 3]>>;\n+\n impl Path<'_> {\n     pub fn is_global(&self) -> bool {\n         !self.segments.is_empty() && self.segments[0].ident.name == kw::PathRoot\n@@ -3068,7 +3071,7 @@ pub enum ItemKind<'hir> {\n     /// or just\n     ///\n     /// `use foo::bar::baz;` (with `as baz` implicitly on the right).\n-    Use(&'hir Path<'hir>, UseKind),\n+    Use(&'hir UsePath<'hir>, UseKind),\n \n     /// A `static` item.\n     Static(&'hir Ty<'hir>, Mutability, BodyId),"}, {"sha": "cbb530424ca5d36d37a2c343f798ac70a48d4a26", "filename": "compiler/rustc_hir/src/intravisit.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -367,7 +367,7 @@ pub trait Visitor<'v>: Sized {\n     fn visit_fn(&mut self, fk: FnKind<'v>, fd: &'v FnDecl<'v>, b: BodyId, _: Span, id: HirId) {\n         walk_fn(self, fk, fd, b, id)\n     }\n-    fn visit_use(&mut self, path: &'v Path<'v>, hir_id: HirId) {\n+    fn visit_use(&mut self, path: &'v UsePath<'v>, hir_id: HirId) {\n         walk_use(self, path, hir_id)\n     }\n     fn visit_trait_item(&mut self, ti: &'v TraitItem<'v>) {\n@@ -422,7 +422,7 @@ pub trait Visitor<'v>: Sized {\n     fn visit_qpath(&mut self, qpath: &'v QPath<'v>, id: HirId, _span: Span) {\n         walk_qpath(self, qpath, id)\n     }\n-    fn visit_path(&mut self, path: &'v Path<'v>, _id: HirId) {\n+    fn visit_path(&mut self, path: &Path<'v>, _id: HirId) {\n         walk_path(self, path)\n     }\n     fn visit_path_segment(&mut self, path_segment: &'v PathSegment<'v>) {\n@@ -938,9 +938,12 @@ pub fn walk_fn_kind<'v, V: Visitor<'v>>(visitor: &mut V, function_kind: FnKind<'\n     }\n }\n \n-pub fn walk_use<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v Path<'v>, hir_id: HirId) {\n+pub fn walk_use<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v UsePath<'v>, hir_id: HirId) {\n     visitor.visit_id(hir_id);\n-    visitor.visit_path(path, hir_id);\n+    let UsePath { segments, ref res, span } = *path;\n+    for &res in res {\n+        visitor.visit_path(&Path { segments, res, span }, hir_id);\n+    }\n }\n \n pub fn walk_trait_item<'v, V: Visitor<'v>>(visitor: &mut V, trait_item: &'v TraitItem<'v>) {\n@@ -1126,7 +1129,7 @@ pub fn walk_qpath<'v, V: Visitor<'v>>(visitor: &mut V, qpath: &'v QPath<'v>, id:\n     }\n }\n \n-pub fn walk_path<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v Path<'v>) {\n+pub fn walk_path<'v, V: Visitor<'v>>(visitor: &mut V, path: &Path<'v>) {\n     for segment in path.segments {\n         visitor.visit_path_segment(segment);\n     }"}, {"sha": "9a7b261fffd4ded6cde9bc8bee5f84f8af042336", "filename": "compiler/rustc_hir_analysis/src/collect/lifetimes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -814,7 +814,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n         }\n     }\n \n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, _: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, _: hir::HirId) {\n         for (i, segment) in path.segments.iter().enumerate() {\n             let depth = path.segments.len() - i - 1;\n             if let Some(ref args) = segment.args {"}, {"sha": "2460a23bb3f34ff52fa9375bbb6e6c0ce913f9a9", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1591,7 +1591,7 @@ impl<'a> State<'a> {\n         self.print_ident(Ident::with_dummy_span(name))\n     }\n \n-    pub fn print_path(&mut self, path: &hir::Path<'_>, colons_before_params: bool) {\n+    pub fn print_path<R>(&mut self, path: &hir::Path<'_, R>, colons_before_params: bool) {\n         self.maybe_print_comment(path.span.lo());\n \n         for (i, segment) in path.segments.iter().enumerate() {"}, {"sha": "4f92661dbd3342198d286c717b67a26bd7039bf6", "filename": "compiler/rustc_lint/src/internal.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Finternal.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -117,7 +117,7 @@ impl<'tcx> LateLintPass<'tcx> for TyTyKind {\n     fn check_path(\n         &mut self,\n         cx: &LateContext<'tcx>,\n-        path: &'tcx rustc_hir::Path<'tcx>,\n+        path: &rustc_hir::Path<'tcx>,\n         _: rustc_hir::HirId,\n     ) {\n         if let Some(segment) = path.segments.iter().nth_back(1)"}, {"sha": "1d0b3f34d5d7830f2dfe6e19a2ca81bebdf173d0", "filename": "compiler/rustc_lint/src/late.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flate.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -292,7 +292,7 @@ impl<'tcx, T: LateLintPass<'tcx>> hir_visit::Visitor<'tcx> for LateContextAndPas\n         hir_visit::walk_lifetime(self, lt);\n     }\n \n-    fn visit_path(&mut self, p: &'tcx hir::Path<'tcx>, id: hir::HirId) {\n+    fn visit_path(&mut self, p: &hir::Path<'tcx>, id: hir::HirId) {\n         lint_callback!(self, check_path, p, id);\n         hir_visit::walk_path(self, p);\n     }"}, {"sha": "fc11d092ccb4b084b26b2315e64206c414aef7a3", "filename": "compiler/rustc_lint/src/passes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fpasses.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -44,7 +44,7 @@ macro_rules! late_lint_methods {\n             fn check_struct_def(a: &$hir hir::VariantData<$hir>);\n             fn check_field_def(a: &$hir hir::FieldDef<$hir>);\n             fn check_variant(a: &$hir hir::Variant<$hir>);\n-            fn check_path(a: &$hir hir::Path<$hir>, b: hir::HirId);\n+            fn check_path(a: &hir::Path<$hir>, b: hir::HirId);\n             fn check_attribute(a: &$hir ast::Attribute);\n \n             /// Called when entering a syntax node that can have lint attributes such"}, {"sha": "a7836ea8e7a4bc5fdd6136e612d92ec28dbdc542", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1264,7 +1264,7 @@ impl UnusedImportBraces {\n \n             // Trigger the lint if the nested item is a non-self single item\n             let node_name = match items[0].0.kind {\n-                ast::UseTreeKind::Simple(rename, ..) => {\n+                ast::UseTreeKind::Simple(rename) => {\n                     let orig_ident = items[0].0.prefix.segments.last().unwrap().ident;\n                     if orig_ident.name == kw::SelfLower {\n                         return;"}, {"sha": "84c632199203aa76b3a09759ee28309f258c5fe4", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1012,7 +1012,7 @@ impl<'a> Parser<'a> {\n                     prefix.span = lo.to(self.prev_token.span);\n                 }\n \n-                UseTreeKind::Simple(self.parse_rename()?, DUMMY_NODE_ID, DUMMY_NODE_ID)\n+                UseTreeKind::Simple(self.parse_rename()?)\n             }\n         };\n "}, {"sha": "da023fcf4c3b5c23405cacb7bca785998dd95c94", "filename": "compiler/rustc_passes/src/dead.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fdead.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -433,7 +433,7 @@ impl<'tcx> Visitor<'tcx> for MarkSymbolVisitor<'tcx> {\n         self.in_pat = false;\n     }\n \n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, _: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, _: hir::HirId) {\n         self.handle_res(path.res);\n         intravisit::walk_path(self, path);\n     }"}, {"sha": "a7854cd49988f721806864a33570b646bc5379d2", "filename": "compiler/rustc_passes/src/hir_stats.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -369,7 +369,7 @@ impl<'v> hir_visit::Visitor<'v> for StatCollector<'v> {\n         hir_visit::walk_fn(self, fk, fd, b, id)\n     }\n \n-    fn visit_use(&mut self, p: &'v hir::Path<'v>, hir_id: hir::HirId) {\n+    fn visit_use(&mut self, p: &'v hir::UsePath<'v>, hir_id: hir::HirId) {\n         // This is `visit_use`, but the type is `Path` so record it that way.\n         self.record(\"Path\", Id::None, p);\n         hir_visit::walk_use(self, p, hir_id)\n@@ -442,7 +442,7 @@ impl<'v> hir_visit::Visitor<'v> for StatCollector<'v> {\n         hir_visit::walk_lifetime(self, lifetime)\n     }\n \n-    fn visit_path(&mut self, path: &'v hir::Path<'v>, _id: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'v>, _id: hir::HirId) {\n         self.record(\"Path\", Id::None, path);\n         hir_visit::walk_path(self, path)\n     }"}, {"sha": "da715523474f9bc6cb63c8da1b83880f71a67682", "filename": "compiler/rustc_passes/src/stability.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fstability.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -787,7 +787,7 @@ impl<'tcx> Visitor<'tcx> for Checker<'tcx> {\n         intravisit::walk_item(self, item);\n     }\n \n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, id: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, id: hir::HirId) {\n         if let Some(def_id) = path.res.opt_def_id() {\n             let method_span = path.segments.last().map(|s| s.ident.span);\n             let item_is_allowed = self.tcx.check_stability_allow_unstable(\n@@ -880,7 +880,7 @@ struct CheckTraitImplStable<'tcx> {\n }\n \n impl<'tcx> Visitor<'tcx> for CheckTraitImplStable<'tcx> {\n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, _id: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, _id: hir::HirId) {\n         if let Some(def_id) = path.res.opt_def_id() {\n             if let Some(stab) = self.tcx.lookup_stability(def_id) {\n                 self.fully_stable &= stab.level.is_stable();"}, {"sha": "605cf0a93b877aa255df7aaa99cb7e7823ccfdd5", "filename": "compiler/rustc_passes/src/upvars.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fupvars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_passes%2Fsrc%2Fupvars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fupvars.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -66,7 +66,7 @@ impl CaptureCollector<'_, '_> {\n }\n \n impl<'tcx> Visitor<'tcx> for CaptureCollector<'_, 'tcx> {\n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, _: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, _: hir::HirId) {\n         if let Res::Local(var_id) = path.res {\n             self.visit_local_use(var_id, path.span);\n         }"}, {"sha": "9c90d67aadf7194c4a79108ac0c35f041716030e", "filename": "compiler/rustc_resolve/src/build_reduced_graph.rs", "status": "modified", "additions": 2, "deletions": 13, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -445,19 +445,13 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n             prefix.is_empty() || prefix.len() == 1 && prefix[0].ident.name == kw::PathRoot\n         };\n         match use_tree.kind {\n-            ast::UseTreeKind::Simple(rename, id1, id2) => {\n+            ast::UseTreeKind::Simple(rename) => {\n                 let mut ident = use_tree.ident();\n                 let mut module_path = prefix;\n                 let mut source = module_path.pop().unwrap();\n                 let mut type_ns_only = false;\n \n                 self.r.visibilities.insert(self.r.local_def_id(id), vis);\n-                if id1 != ast::DUMMY_NODE_ID {\n-                    self.r.visibilities.insert(self.r.local_def_id(id1), vis);\n-                }\n-                if id2 != ast::DUMMY_NODE_ID {\n-                    self.r.visibilities.insert(self.r.local_def_id(id2), vis);\n-                }\n \n                 if nested {\n                     // Correctly handle `self`\n@@ -565,7 +559,6 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n                     type_ns_only,\n                     nested,\n                     id,\n-                    additional_ids: (id1, id2),\n                 };\n \n                 self.add_import(module_path, kind, use_tree.span, item, root_span, item.id, vis);\n@@ -621,11 +614,7 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n                     let new_span = prefix[prefix.len() - 1].ident.span;\n                     let tree = ast::UseTree {\n                         prefix: ast::Path::from_ident(Ident::new(kw::SelfLower, new_span)),\n-                        kind: ast::UseTreeKind::Simple(\n-                            Some(Ident::new(kw::Underscore, new_span)),\n-                            ast::DUMMY_NODE_ID,\n-                            ast::DUMMY_NODE_ID,\n-                        ),\n+                        kind: ast::UseTreeKind::Simple(Some(Ident::new(kw::Underscore, new_span))),\n                         span: use_tree.span,\n                     };\n                     self.build_reduced_graph_for_use_tree("}, {"sha": "2764a6c28a5e934bc7b74c27acfdf1ad372ece0a", "filename": "compiler/rustc_resolve/src/def_collector.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -158,14 +158,6 @@ impl<'a, 'b> visit::Visitor<'a> for DefCollector<'a, 'b> {\n \n     fn visit_use_tree(&mut self, use_tree: &'a UseTree, id: NodeId, _nested: bool) {\n         self.create_def(id, DefPathData::Use, use_tree.span);\n-        match use_tree.kind {\n-            UseTreeKind::Simple(_, id1, id2) => {\n-                self.create_def(id1, DefPathData::Use, use_tree.prefix.span);\n-                self.create_def(id2, DefPathData::Use, use_tree.prefix.span);\n-            }\n-            UseTreeKind::Glob => (),\n-            UseTreeKind::Nested(..) => {}\n-        }\n         visit::walk_use_tree(self, use_tree, id);\n     }\n "}, {"sha": "85399385d1fd4fb2bd66a9b1244a869011aae057", "filename": "compiler/rustc_resolve/src/effective_visibilities.rs", "status": "modified", "additions": 6, "deletions": 23, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Feffective_visibilities.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Feffective_visibilities.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Feffective_visibilities.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1,4 +1,4 @@\n-use crate::{ImportKind, NameBinding, NameBindingKind, Resolver, ResolverTree};\n+use crate::{NameBinding, NameBindingKind, Resolver, ResolverTree};\n use rustc_ast::ast;\n use rustc_ast::visit;\n use rustc_ast::visit::Visitor;\n@@ -104,28 +104,11 @@ impl<'r, 'a> EffectiveVisibilitiesVisitor<'r, 'a> {\n         for (binding, eff_vis) in visitor.import_effective_visibilities.iter() {\n             let NameBindingKind::Import { import, .. } = binding.kind else { unreachable!() };\n             if let Some(node_id) = import.id() {\n-                let mut update = |node_id| {\n-                    r.effective_visibilities.update_eff_vis(\n-                        r.local_def_id(node_id),\n-                        eff_vis,\n-                        ResolverTree(&r.definitions, &r.crate_loader),\n-                    )\n-                };\n-                update(node_id);\n-                if let ImportKind::Single { additional_ids: (id1, id2), .. } = import.kind {\n-                    // In theory all the single import IDs have individual visibilities and\n-                    // effective visibilities, but in practice these IDs go straight to HIR\n-                    // where all their few uses assume that their (effective) visibility\n-                    // applies to the whole syntactic `use` item. So they all get the same\n-                    // value which is the maximum of all bindings. Maybe HIR for imports\n-                    // shouldn't use three IDs at all.\n-                    if id1 != ast::DUMMY_NODE_ID {\n-                        update(id1);\n-                    }\n-                    if id2 != ast::DUMMY_NODE_ID {\n-                        update(id2);\n-                    }\n-                }\n+                r.effective_visibilities.update_eff_vis(\n+                    r.local_def_id(node_id),\n+                    eff_vis,\n+                    ResolverTree(&r.definitions, &r.crate_loader),\n+                )\n             }\n         }\n "}, {"sha": "e6f4d7fcfcf06b92629d0ca423d9c0ef84ccabbe", "filename": "compiler/rustc_resolve/src/imports.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -56,9 +56,6 @@ pub enum ImportKind<'a> {\n         /// If this is the import for `foo::bar::a`, we would have the ID of the `UseTree`\n         /// for `a` in this field.\n         id: NodeId,\n-        /// Additional `NodeId`s allocated to a `ast::UseTree` for automatically generated `use` statement\n-        /// (eg. implicit struct constructors)\n-        additional_ids: (NodeId, NodeId),\n     },\n     Glob {\n         is_prelude: bool,\n@@ -88,7 +85,6 @@ impl<'a> std::fmt::Debug for ImportKind<'a> {\n                 ref type_ns_only,\n                 ref nested,\n                 ref id,\n-                ref additional_ids,\n                 // Ignore the following to avoid an infinite loop while printing.\n                 source_bindings: _,\n                 target_bindings: _,\n@@ -99,7 +95,6 @@ impl<'a> std::fmt::Debug for ImportKind<'a> {\n                 .field(\"type_ns_only\", type_ns_only)\n                 .field(\"nested\", nested)\n                 .field(\"id\", id)\n-                .field(\"additional_ids\", additional_ids)\n                 .finish_non_exhaustive(),\n             Glob { ref is_prelude, ref max_vis, ref id } => f\n                 .debug_struct(\"Glob\")"}, {"sha": "b45288538256f84e9c10b8a80409cd9a773c9bfc", "filename": "compiler/rustc_save_analysis/src/dump_visitor.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -185,13 +185,13 @@ impl<'tcx> DumpVisitor<'tcx> {\n         }\n     }\n \n-    fn write_sub_paths(&mut self, path: &'tcx hir::Path<'tcx>) {\n+    fn write_sub_paths<R>(&mut self, path: &'tcx hir::Path<'tcx, R>) {\n         self.write_segments(path.segments)\n     }\n \n     // As write_sub_paths, but does not process the last ident in the path (assuming it\n     // will be processed elsewhere). See note on write_sub_paths about global.\n-    fn write_sub_paths_truncated(&mut self, path: &'tcx hir::Path<'tcx>) {\n+    fn write_sub_paths_truncated<R>(&mut self, path: &'tcx hir::Path<'tcx, R>) {\n         if let [segments @ .., _] = path.segments {\n             self.write_segments(segments)\n         }"}, {"sha": "f05eb2b7432b5cabd3c8eb1b0839acf7e5a1788e", "filename": "compiler/rustc_save_analysis/src/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -594,7 +594,9 @@ impl<'tcx> SaveContext<'tcx> {\n         match self.tcx.hir().get(hir_id) {\n             Node::TraitRef(tr) => tr.path.res,\n \n-            Node::Item(&hir::Item { kind: hir::ItemKind::Use(path, _), .. }) => path.res,\n+            Node::Item(&hir::Item { kind: hir::ItemKind::Use(path, _), .. }) => {\n+                path.res.get(0).copied().unwrap_or(Res::Err)\n+            }\n             Node::PathSegment(seg) => {\n                 if seg.res != Res::Err {\n                     seg.res"}, {"sha": "80909919ba2b69e64a21c3e6c502ac4ec23363c1", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -2231,6 +2231,26 @@ fn clean_extern_crate<'tcx>(\n }\n \n fn clean_use_statement<'tcx>(\n+    import: &hir::Item<'tcx>,\n+    name: Symbol,\n+    path: &hir::UsePath<'tcx>,\n+    kind: hir::UseKind,\n+    cx: &mut DocContext<'tcx>,\n+    inlined_names: &mut FxHashSet<(ItemType, Symbol)>,\n+) -> Vec<Item> {\n+    let mut items = Vec::new();\n+    let hir::UsePath { segments, ref res, span } = *path;\n+    for &res in res {\n+        if let Res::Def(DefKind::Ctor(..), _) | Res::SelfCtor(..) = res {\n+            continue;\n+        }\n+        let path = hir::Path { segments, res, span };\n+        items.append(&mut clean_use_statement_inner(import, name, &path, kind, cx, inlined_names));\n+    }\n+    items\n+}\n+\n+fn clean_use_statement_inner<'tcx>(\n     import: &hir::Item<'tcx>,\n     name: Symbol,\n     path: &hir::Path<'tcx>,"}, {"sha": "2590bb0df3f0e62ef74c84ce9eab4b3922e2862b", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -242,7 +242,9 @@ impl ExternalCrate {\n                         hir::ItemKind::Use(path, hir::UseKind::Single)\n                             if tcx.visibility(id.owner_id).is_public() =>\n                         {\n-                            as_keyword(path.res.expect_non_local())\n+                            path.res\n+                                .iter()\n+                                .find_map(|res| as_keyword(res.expect_non_local()))\n                                 .map(|(_, prim)| (id.owner_id.to_def_id(), prim))\n                         }\n                         _ => None,\n@@ -310,10 +312,11 @@ impl ExternalCrate {\n                         hir::ItemKind::Use(path, hir::UseKind::Single)\n                             if tcx.visibility(id.owner_id).is_public() =>\n                         {\n-                            as_primitive(path.res.expect_non_local()).map(|(_, prim)| {\n+                            path.res\n+                                .iter()\n+                                .find_map(|res| as_primitive(res.expect_non_local()))\n                                 // Pretend the primitive is local.\n-                                (id.owner_id.to_def_id(), prim)\n-                            })\n+                                .map(|(_, prim)| (id.owner_id.to_def_id(), prim))\n                         }\n                         _ => None,\n                     }"}, {"sha": "da0df596c41e34f7ca88e07b1e7b0811b75ed22d", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -489,7 +489,7 @@ impl<'tcx> Visitor<'tcx> for EmitIgnoredResolutionErrors<'tcx> {\n         self.tcx.hir()\n     }\n \n-    fn visit_path(&mut self, path: &'tcx Path<'_>, _id: HirId) {\n+    fn visit_path(&mut self, path: &Path<'tcx>, _id: HirId) {\n         debug!(\"visiting path {:?}\", path);\n         if path.res == Res::Err {\n             // We have less context here than in rustc_resolve,"}, {"sha": "4514894cabe0fcdf33035cf0b9b2b3ed580946ff", "filename": "src/librustdoc/html/render/span_map.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -140,7 +140,7 @@ impl<'tcx> Visitor<'tcx> for SpanMapVisitor<'tcx> {\n         self.tcx.hir()\n     }\n \n-    fn visit_path(&mut self, path: &'tcx rustc_hir::Path<'tcx>, _id: HirId) {\n+    fn visit_path(&mut self, path: &rustc_hir::Path<'tcx>, _id: HirId) {\n         if self.handle_macro(path.span) {\n             return;\n         }\n@@ -190,12 +190,4 @@ impl<'tcx> Visitor<'tcx> for SpanMapVisitor<'tcx> {\n         }\n         intravisit::walk_expr(self, expr);\n     }\n-\n-    fn visit_use(&mut self, path: &'tcx rustc_hir::Path<'tcx>, id: HirId) {\n-        if self.handle_macro(path.span) {\n-            return;\n-        }\n-        self.handle_path(path);\n-        intravisit::walk_use(self, path, id);\n-    }\n }"}, {"sha": "83be1a16eb2c474bd11752530c6f1b357c3c5243", "filename": "src/librustdoc/json/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fjson%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fjson%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fmod.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -225,10 +225,10 @@ impl<'tcx> FormatRenderer<'tcx> for JsonRenderer<'tcx> {\n \n                 types::ItemEnum::Function(_)\n                 | types::ItemEnum::Module(_)\n+                | types::ItemEnum::Import(_)\n                 | types::ItemEnum::AssocConst { .. }\n                 | types::ItemEnum::AssocType { .. } => true,\n                 types::ItemEnum::ExternCrate { .. }\n-                | types::ItemEnum::Import(_)\n                 | types::ItemEnum::StructField(_)\n                 | types::ItemEnum::Variant(_)\n                 | types::ItemEnum::TraitAlias(_)"}, {"sha": "22068ebe041c729ca87e33470255f9e40c22bb3b", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 30, "deletions": 29, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -301,39 +301,40 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n             hir::ItemKind::GlobalAsm(..) => {}\n             hir::ItemKind::Use(_, hir::UseKind::ListStem) => {}\n             hir::ItemKind::Use(path, kind) => {\n-                let is_glob = kind == hir::UseKind::Glob;\n-\n-                // Struct and variant constructors and proc macro stubs always show up alongside\n-                // their definitions, we've already processed them so just discard these.\n-                if let Res::Def(DefKind::Ctor(..), _) | Res::SelfCtor(..) = path.res {\n-                    return;\n-                }\n-\n-                let attrs = self.cx.tcx.hir().attrs(item.hir_id());\n+                for &res in &path.res {\n+                    // Struct and variant constructors and proc macro stubs always show up alongside\n+                    // their definitions, we've already processed them so just discard these.\n+                    if let Res::Def(DefKind::Ctor(..), _) | Res::SelfCtor(..) = res {\n+                        continue;\n+                    }\n \n-                // If there was a private module in the current path then don't bother inlining\n-                // anything as it will probably be stripped anyway.\n-                if is_pub && self.inside_public_path {\n-                    let please_inline = attrs.iter().any(|item| match item.meta_item_list() {\n-                        Some(ref list) if item.has_name(sym::doc) => {\n-                            list.iter().any(|i| i.has_name(sym::inline))\n+                    let attrs = self.cx.tcx.hir().attrs(item.hir_id());\n+\n+                    // If there was a private module in the current path then don't bother inlining\n+                    // anything as it will probably be stripped anyway.\n+                    if is_pub && self.inside_public_path {\n+                        let please_inline = attrs.iter().any(|item| match item.meta_item_list() {\n+                            Some(ref list) if item.has_name(sym::doc) => {\n+                                list.iter().any(|i| i.has_name(sym::inline))\n+                            }\n+                            _ => false,\n+                        });\n+                        let is_glob = kind == hir::UseKind::Glob;\n+                        let ident = if is_glob { None } else { Some(name) };\n+                        if self.maybe_inline_local(\n+                            item.hir_id(),\n+                            res,\n+                            ident,\n+                            is_glob,\n+                            om,\n+                            please_inline,\n+                        ) {\n+                            continue;\n                         }\n-                        _ => false,\n-                    });\n-                    let ident = if is_glob { None } else { Some(name) };\n-                    if self.maybe_inline_local(\n-                        item.hir_id(),\n-                        path.res,\n-                        ident,\n-                        is_glob,\n-                        om,\n-                        please_inline,\n-                    ) {\n-                        return;\n                     }\n-                }\n \n-                om.items.push((item, renamed, parent_id))\n+                    om.items.push((item, renamed, parent_id))\n+                }\n             }\n             hir::ItemKind::Macro(ref macro_def, _) => {\n                 // `#[macro_export] macro_rules!` items are handled separately in `visit()`,"}, {"sha": "7aaeadd0403cbe5e36115c26eb38cb7fa3b47f8c", "filename": "src/test/ui/consts/miri_unleashed/tls.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Ftls.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Ftls.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Ftls.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -2,13 +2,13 @@ error[E0080]: could not evaluate static initializer\n   --> $DIR/tls.rs:11:25\n    |\n LL |     unsafe { let _val = A; }\n-   |                         ^ cannot access thread local static (DefId(0:6 ~ tls[78b0]::A))\n+   |                         ^ cannot access thread local static (DefId(0:4 ~ tls[78b0]::A))\n \n error[E0080]: could not evaluate static initializer\n   --> $DIR/tls.rs:18:26\n    |\n LL |     unsafe { let _val = &A; }\n-   |                          ^ cannot access thread local static (DefId(0:6 ~ tls[78b0]::A))\n+   |                          ^ cannot access thread local static (DefId(0:4 ~ tls[78b0]::A))\n \n warning: skipping const checks\n    |"}, {"sha": "ed0628bbbc3cce135ed9308d8911b9aa66e14fff", "filename": "src/test/ui/generator/print/generator-print-verbose-1.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fgenerator%2Fprint%2Fgenerator-print-verbose-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fgenerator%2Fprint%2Fgenerator-print-verbose-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Fprint%2Fgenerator-print-verbose-1.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -9,7 +9,7 @@ note: generator is not `Send` as this value is used across a yield\n   --> $DIR/generator-print-verbose-1.rs:35:9\n    |\n LL |         let _non_send_gen = make_non_send_generator();\n-   |             ------------- has type `Opaque(DefId(0:44 ~ generator_print_verbose_1[749a]::make_non_send_generator::{opaque#0}), [])` which is not `Send`\n+   |             ------------- has type `Opaque(DefId(0:34 ~ generator_print_verbose_1[749a]::make_non_send_generator::{opaque#0}), [])` which is not `Send`\n LL |         yield;\n    |         ^^^^^ yield occurs here, with `_non_send_gen` maybe used later\n LL |     };\n@@ -35,17 +35,17 @@ note: required because it's used within this generator\n    |\n LL |     || {\n    |     ^^\n-note: required because it appears within the type `Opaque(DefId(0:45 ~ generator_print_verbose_1[749a]::make_gen2::{opaque#0}), [std::sync::Arc<std::cell::RefCell<i32>>])`\n+note: required because it appears within the type `Opaque(DefId(0:35 ~ generator_print_verbose_1[749a]::make_gen2::{opaque#0}), [std::sync::Arc<std::cell::RefCell<i32>>])`\n   --> $DIR/generator-print-verbose-1.rs:41:30\n    |\n LL | pub fn make_gen2<T>(t: T) -> impl Generator<Return = T> {\n    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: required because it appears within the type `Opaque(DefId(0:46 ~ generator_print_verbose_1[749a]::make_non_send_generator2::{opaque#0}), [])`\n+note: required because it appears within the type `Opaque(DefId(0:36 ~ generator_print_verbose_1[749a]::make_non_send_generator2::{opaque#0}), [])`\n   --> $DIR/generator-print-verbose-1.rs:47:34\n    |\n LL | fn make_non_send_generator2() -> impl Generator<Return = Arc<RefCell<i32>>> {\n    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   = note: required because it captures the following types: `Opaque(DefId(0:46 ~ generator_print_verbose_1[749a]::make_non_send_generator2::{opaque#0}), [])`, `()`\n+   = note: required because it captures the following types: `Opaque(DefId(0:36 ~ generator_print_verbose_1[749a]::make_non_send_generator2::{opaque#0}), [])`, `()`\n note: required because it's used within this generator\n   --> $DIR/generator-print-verbose-1.rs:52:20\n    |"}, {"sha": "9e9b2e18abeb85164e1cdbd2f2ef09204bd456de", "filename": "src/test/ui/generic-associated-types/self-outlives-lint.stderr", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fself-outlives-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fself-outlives-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fself-outlives-lint.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -108,17 +108,6 @@ LL |     type Bar<'b>;\n    = note: this bound is currently required to ensure that impls have maximum flexibility\n    = note: we are soliciting feedback, see issue #87479 <https://github.com/rust-lang/rust/issues/87479> for more information\n \n-error: missing required bound on `Item`\n-  --> $DIR/self-outlives-lint.rs:140:5\n-   |\n-LL |     type Item<'a>;\n-   |     ^^^^^^^^^^^^^-\n-   |                  |\n-   |                  help: add the required where clause: `where Self: 'a`\n-   |\n-   = note: this bound is currently required to ensure that impls have maximum flexibility\n-   = note: we are soliciting feedback, see issue #87479 <https://github.com/rust-lang/rust/issues/87479> for more information\n-\n error: missing required bound on `Iterator`\n   --> $DIR/self-outlives-lint.rs:142:5\n    |\n@@ -130,6 +119,17 @@ LL |     type Iterator<'a>: Iterator<Item = Self::Item<'a>>;\n    = note: this bound is currently required to ensure that impls have maximum flexibility\n    = note: we are soliciting feedback, see issue #87479 <https://github.com/rust-lang/rust/issues/87479> for more information\n \n+error: missing required bound on `Item`\n+  --> $DIR/self-outlives-lint.rs:140:5\n+   |\n+LL |     type Item<'a>;\n+   |     ^^^^^^^^^^^^^-\n+   |                  |\n+   |                  help: add the required where clause: `where Self: 'a`\n+   |\n+   = note: this bound is currently required to ensure that impls have maximum flexibility\n+   = note: we are soliciting feedback, see issue #87479 <https://github.com/rust-lang/rust/issues/87479> for more information\n+\n error: missing required bound on `Item`\n   --> $DIR/self-outlives-lint.rs:148:5\n    |"}, {"sha": "ff20e20d332884d6cb8526651d3143f16b9141cf", "filename": "src/test/ui/privacy/effective_visibilities.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -72,6 +72,5 @@ mod half_public_import {\n \n #[rustc_effective_visibility]\n pub use half_public_import::HalfPublicImport; //~ ERROR Direct: pub, Reexported: pub, Reachable: pub, ReachableThroughImplTrait: pub\n-                                              //~^ ERROR Direct: pub, Reexported: pub, Reachable: pub, ReachableThroughImplTrait: pub\n \n fn main() {}"}, {"sha": "046b6095f4e79b0008cb4c01d1884118b69c6a8e", "filename": "src/test/ui/privacy/effective_visibilities.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Feffective_visibilities.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -124,12 +124,6 @@ error: Direct: pub, Reexported: pub, Reachable: pub, ReachableThroughImplTrait:\n LL | pub use half_public_import::HalfPublicImport;\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: Direct: pub, Reexported: pub, Reachable: pub, ReachableThroughImplTrait: pub\n-  --> $DIR/effective_visibilities.rs:74:9\n-   |\n-LL | pub use half_public_import::HalfPublicImport;\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: Direct: pub(crate), Reexported: pub, Reachable: pub, ReachableThroughImplTrait: pub\n   --> $DIR/effective_visibilities.rs:14:13\n    |\n@@ -142,5 +136,5 @@ error: Direct: pub(crate), Reexported: pub, Reachable: pub, ReachableThroughImpl\n LL |             type B;\n    |             ^^^^^^\n \n-error: aborting due to 24 previous errors\n+error: aborting due to 23 previous errors\n "}, {"sha": "15900bef7f62458493a9a04fb0ae4c7ad900fbf4", "filename": "src/test/ui/stats/hir-stats.stderr", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -120,59 +120,59 @@ hir-stats Name                Accumulated Size         Count     Item Size\n hir-stats ----------------------------------------------------------------\n hir-stats ForeignItemRef            24 ( 0.3%)             1            24\n hir-stats Lifetime                  24 ( 0.3%)             1            24\n-hir-stats Mod                       32 ( 0.3%)             1            32\n+hir-stats Mod                       32 ( 0.4%)             1            32\n hir-stats ExprField                 40 ( 0.4%)             1            40\n hir-stats TraitItemRef              56 ( 0.6%)             2            28\n hir-stats Local                     64 ( 0.7%)             1            64\n hir-stats Param                     64 ( 0.7%)             2            32\n hir-stats InlineAsm                 72 ( 0.8%)             1            72\n hir-stats ImplItemRef               72 ( 0.8%)             2            36\n-hir-stats Body                      96 ( 1.0%)             3            32\n-hir-stats FieldDef                  96 ( 1.0%)             2            48\n-hir-stats Arm                       96 ( 1.0%)             2            48\n-hir-stats Stmt                      96 ( 1.0%)             3            32\n-hir-stats - Local                     32 ( 0.3%)             1\n-hir-stats - Semi                      32 ( 0.3%)             1\n-hir-stats - Expr                      32 ( 0.3%)             1\n+hir-stats Body                      96 ( 1.1%)             3            32\n+hir-stats FieldDef                  96 ( 1.1%)             2            48\n+hir-stats Arm                       96 ( 1.1%)             2            48\n+hir-stats Stmt                      96 ( 1.1%)             3            32\n+hir-stats - Local                     32 ( 0.4%)             1\n+hir-stats - Semi                      32 ( 0.4%)             1\n+hir-stats - Expr                      32 ( 0.4%)             1\n hir-stats FnDecl                   120 ( 1.3%)             3            40\n hir-stats Attribute                128 ( 1.4%)             4            32\n hir-stats GenericArg               128 ( 1.4%)             4            32\n-hir-stats - Type                      32 ( 0.3%)             1\n-hir-stats - Lifetime                  96 ( 1.0%)             3\n+hir-stats - Type                      32 ( 0.4%)             1\n+hir-stats - Lifetime                  96 ( 1.1%)             3\n hir-stats GenericArgs              144 ( 1.6%)             3            48\n hir-stats Variant                  176 ( 1.9%)             2            88\n hir-stats GenericBound             192 ( 2.1%)             4            48\n hir-stats - Trait                    192 ( 2.1%)             4\n hir-stats WherePredicate           192 ( 2.1%)             3            64\n hir-stats - BoundPredicate           192 ( 2.1%)             3\n-hir-stats Block                    288 ( 3.1%)             6            48\n-hir-stats Pat                      360 ( 3.9%)             5            72\n+hir-stats Block                    288 ( 3.2%)             6            48\n+hir-stats Pat                      360 ( 4.0%)             5            72\n hir-stats - Wild                      72 ( 0.8%)             1\n hir-stats - Struct                    72 ( 0.8%)             1\n hir-stats - Binding                  216 ( 2.4%)             3\n hir-stats GenericParam             400 ( 4.4%)             5            80\n-hir-stats Generics                 560 ( 6.1%)            10            56\n-hir-stats Ty                       720 ( 7.9%)            15            48\n+hir-stats Generics                 560 ( 6.2%)            10            56\n+hir-stats Ty                       720 ( 8.0%)            15            48\n hir-stats - Ptr                       48 ( 0.5%)             1\n hir-stats - Rptr                      48 ( 0.5%)             1\n-hir-stats - Path                     624 ( 6.8%)            13\n-hir-stats Expr                     768 ( 8.4%)            12            64\n+hir-stats - Path                     624 ( 6.9%)            13\n+hir-stats Expr                     768 ( 8.5%)            12            64\n hir-stats - Path                      64 ( 0.7%)             1\n hir-stats - Struct                    64 ( 0.7%)             1\n hir-stats - Match                     64 ( 0.7%)             1\n hir-stats - InlineAsm                 64 ( 0.7%)             1\n hir-stats - Lit                      128 ( 1.4%)             2\n hir-stats - Block                    384 ( 4.2%)             6\n-hir-stats Item                     960 (10.5%)            12            80\n+hir-stats Item                     880 ( 9.7%)            11            80\n hir-stats - Trait                     80 ( 0.9%)             1\n hir-stats - Enum                      80 ( 0.9%)             1\n hir-stats - ExternCrate               80 ( 0.9%)             1\n hir-stats - ForeignMod                80 ( 0.9%)             1\n hir-stats - Impl                      80 ( 0.9%)             1\n-hir-stats - Fn                       160 ( 1.7%)             2\n-hir-stats - Use                      400 ( 4.4%)             5\n-hir-stats Path                   1_280 (14.0%)            32            40\n-hir-stats PathSegment            1_920 (20.9%)            40            48\n+hir-stats - Fn                       160 ( 1.8%)             2\n+hir-stats - Use                      320 ( 3.5%)             4\n+hir-stats Path                   1_240 (13.7%)            31            40\n+hir-stats PathSegment            1_920 (21.2%)            40            48\n hir-stats ----------------------------------------------------------------\n-hir-stats Total                  9_168\n+hir-stats Total                  9_048\n hir-stats"}, {"sha": "1f56d0118a404b50d88b938620c01b70fcc11212", "filename": "src/tools/clippy/clippy_lints/src/disallowed_types.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_types.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -106,7 +106,9 @@ impl<'tcx> LateLintPass<'tcx> for DisallowedTypes {\n \n     fn check_item(&mut self, cx: &LateContext<'tcx>, item: &'tcx Item<'tcx>) {\n         if let ItemKind::Use(path, UseKind::Single) = &item.kind {\n-            self.check_res_emit(cx, &path.res, item.span);\n+            for res in &path.res {\n+                self.check_res_emit(cx, res, item.span);\n+            }\n         }\n     }\n "}, {"sha": "0634b2798fefee63669f0a2325e9e89b8332ca7a", "filename": "src/tools/clippy/clippy_lints/src/from_over_into.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffrom_over_into.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffrom_over_into.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ffrom_over_into.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -126,7 +126,7 @@ impl<'a, 'tcx> Visitor<'tcx> for SelfFinder<'a, 'tcx> {\n         self.cx.tcx.hir()\n     }\n \n-    fn visit_path(&mut self, path: &'tcx Path<'tcx>, _id: HirId) {\n+    fn visit_path(&mut self, path: &Path<'tcx>, _id: HirId) {\n         for segment in path.segments {\n             match segment.ident.name {\n                 kw::SelfLower => self.lower.push(segment.ident.span),"}, {"sha": "e2e6a87a30151472b7bc93e250f556275641f441", "filename": "src/tools/clippy/clippy_lints/src/macro_use.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -94,7 +94,10 @@ impl<'tcx> LateLintPass<'tcx> for MacroUseImports {\n             let hir_id = item.hir_id();\n             let attrs = cx.tcx.hir().attrs(hir_id);\n             if let Some(mac_attr) = attrs.iter().find(|attr| attr.has_name(sym::macro_use));\n-            if let Res::Def(DefKind::Mod, id) = path.res;\n+            if let Some(id) = path.res.iter().find_map(|res| match res {\n+                Res::Def(DefKind::Mod, id) => Some(id),\n+                _ => None,\n+            });\n             if !id.is_local();\n             then {\n                 for kid in cx.tcx.module_children(id).iter() {"}, {"sha": "910ee14855e234d21507ff2ef01eb25061461bbb", "filename": "src/tools/clippy/clippy_lints/src/methods/option_map_unwrap_or.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Foption_map_unwrap_or.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Foption_map_unwrap_or.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Foption_map_unwrap_or.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -97,7 +97,7 @@ struct UnwrapVisitor<'a, 'tcx> {\n impl<'a, 'tcx> Visitor<'tcx> for UnwrapVisitor<'a, 'tcx> {\n     type NestedFilter = nested_filter::All;\n \n-    fn visit_path(&mut self, path: &'tcx Path<'_>, _id: HirId) {\n+    fn visit_path(&mut self, path: &Path<'tcx>, _id: HirId) {\n         self.identifiers.insert(ident(path));\n         walk_path(self, path);\n     }\n@@ -116,7 +116,7 @@ struct MapExprVisitor<'a, 'tcx> {\n impl<'a, 'tcx> Visitor<'tcx> for MapExprVisitor<'a, 'tcx> {\n     type NestedFilter = nested_filter::All;\n \n-    fn visit_path(&mut self, path: &'tcx Path<'_>, _id: HirId) {\n+    fn visit_path(&mut self, path: &Path<'tcx>, _id: HirId) {\n         if self.identifiers.contains(&ident(path)) {\n             self.found_identifier = true;\n             return;"}, {"sha": "773174679dbdce618b244bfdfe9f5516d2eaaa0f", "filename": "src/tools/clippy/clippy_lints/src/missing_enforced_import_rename.rs", "status": "modified", "additions": 31, "deletions": 28, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_enforced_import_rename.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -66,35 +66,38 @@ impl LateLintPass<'_> for ImportRename {\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'_>, item: &Item<'_>) {\n-        if_chain! {\n-            if let ItemKind::Use(path, UseKind::Single) = &item.kind;\n-            if let Res::Def(_, id) = path.res;\n-            if let Some(name) = self.renames.get(&id);\n-            // Remove semicolon since it is not present for nested imports\n-            let span_without_semi = cx.sess().source_map().span_until_char(item.span, ';');\n-            if let Some(snip) = snippet_opt(cx, span_without_semi);\n-            if let Some(import) = match snip.split_once(\" as \") {\n-                None => Some(snip.as_str()),\n-                Some((import, rename)) => {\n-                    if rename.trim() == name.as_str() {\n-                        None\n-                    } else {\n-                        Some(import.trim())\n+        if let ItemKind::Use(path, UseKind::Single) = &item.kind {\n+            for &res in &path.res {\n+                if_chain! {\n+                    if let Res::Def(_, id) = res;\n+                    if let Some(name) = self.renames.get(&id);\n+                    // Remove semicolon since it is not present for nested imports\n+                    let span_without_semi = cx.sess().source_map().span_until_char(item.span, ';');\n+                    if let Some(snip) = snippet_opt(cx, span_without_semi);\n+                    if let Some(import) = match snip.split_once(\" as \") {\n+                        None => Some(snip.as_str()),\n+                        Some((import, rename)) => {\n+                            if rename.trim() == name.as_str() {\n+                                None\n+                            } else {\n+                                Some(import.trim())\n+                            }\n+                        },\n+                    };\n+                    then {\n+                        span_lint_and_sugg(\n+                            cx,\n+                            MISSING_ENFORCED_IMPORT_RENAMES,\n+                            span_without_semi,\n+                            \"this import should be renamed\",\n+                            \"try\",\n+                            format!(\n+                                \"{import} as {name}\",\n+                            ),\n+                            Applicability::MachineApplicable,\n+                        );\n                     }\n-                },\n-            };\n-            then {\n-                span_lint_and_sugg(\n-                    cx,\n-                    MISSING_ENFORCED_IMPORT_RENAMES,\n-                    span_without_semi,\n-                    \"this import should be renamed\",\n-                    \"try\",\n-                    format!(\n-                        \"{import} as {name}\",\n-                    ),\n-                    Applicability::MachineApplicable,\n-                );\n+                }\n             }\n         }\n     }"}, {"sha": "d612d249c2f000ab3c869952f1806ff491ac2450", "filename": "src/tools/clippy/clippy_lints/src/redundant_pub_crate.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_pub_crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_pub_crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_pub_crate.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -84,7 +84,7 @@ impl<'tcx> LateLintPass<'tcx> for RedundantPubCrate {\n \n fn is_not_macro_export<'tcx>(item: &'tcx Item<'tcx>) -> bool {\n     if let ItemKind::Use(path, _) = item.kind {\n-        if let Res::Def(DefKind::Macro(MacroKind::Bang), _) = path.res {\n+        if path.res.iter().all(|res| matches!(res, Res::Def(DefKind::Macro(MacroKind::Bang), _))) {\n             return false;\n         }\n     } else if let ItemKind::Macro(..) = item.kind {"}, {"sha": "d46f6a6352c63ead2b1418c911e887ce0eaefe4b", "filename": "src/tools/clippy/clippy_lints/src/single_component_path_imports.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsingle_component_path_imports.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -149,7 +149,7 @@ impl SingleComponentPathImports {\n \n                 // keep track of `use some_module;` usages\n                 if segments.len() == 1 {\n-                    if let UseTreeKind::Simple(None, _, _) = use_tree.kind {\n+                    if let UseTreeKind::Simple(None) = use_tree.kind {\n                         let name = segments[0].ident.name;\n                         if !macros.contains(&name) {\n                             single_use_usages.push(SingleUse {\n@@ -169,7 +169,7 @@ impl SingleComponentPathImports {\n                         for tree in trees {\n                             let segments = &tree.0.prefix.segments;\n                             if segments.len() == 1 {\n-                                if let UseTreeKind::Simple(None, _, _) = tree.0.kind {\n+                                if let UseTreeKind::Simple(None) = tree.0.kind {\n                                     let name = segments[0].ident.name;\n                                     if !macros.contains(&name) {\n                                         single_use_usages.push(SingleUse {"}, {"sha": "397633f533b22c767b3e1186d4f172c9341e31c2", "filename": "src/tools/clippy/clippy_lints/src/unnecessary_self_imports.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_self_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_self_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_self_imports.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -57,7 +57,7 @@ impl EarlyLintPass for UnnecessarySelfImports {\n                             format!(\n                                 \"{}{};\",\n                                 last_segment.ident,\n-                                if let UseTreeKind::Simple(Some(alias), ..) = self_tree.kind { format!(\" as {alias}\") } else { String::new() },\n+                                if let UseTreeKind::Simple(Some(alias)) = self_tree.kind { format!(\" as {alias}\") } else { String::new() },\n                             ),\n                             Applicability::MaybeIncorrect,\n                         );"}, {"sha": "7ee785804f0a564ad9b2a68cc46d75022159aec5", "filename": "src/tools/clippy/clippy_lints/src/unsafe_removed_from_name.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funsafe_removed_from_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funsafe_removed_from_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funsafe_removed_from_name.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -39,7 +39,7 @@ impl EarlyLintPass for UnsafeNameRemoval {\n \n fn check_use_tree(use_tree: &UseTree, cx: &EarlyContext<'_>, span: Span) {\n     match use_tree.kind {\n-        UseTreeKind::Simple(Some(new_name), ..) => {\n+        UseTreeKind::Simple(Some(new_name)) => {\n             let old_name = use_tree\n                 .prefix\n                 .segments\n@@ -48,7 +48,7 @@ fn check_use_tree(use_tree: &UseTree, cx: &EarlyContext<'_>, span: Span) {\n                 .ident;\n             unsafe_to_safe_check(old_name, new_name, cx, span);\n         },\n-        UseTreeKind::Simple(None, ..) | UseTreeKind::Glob => {},\n+        UseTreeKind::Simple(None) | UseTreeKind::Glob => {},\n         UseTreeKind::Nested(ref nested_use_tree) => {\n             for (use_tree, _) in nested_use_tree {\n                 check_use_tree(use_tree, cx, span);"}, {"sha": "786d9608c851ee1001e1c59c36c1a0911e313544", "filename": "src/tools/clippy/clippy_lints/src/utils/internal_lints/lint_without_lint_pass.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Flint_without_lint_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Flint_without_lint_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Flint_without_lint_pass.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -330,7 +330,7 @@ struct LintCollector<'a, 'tcx> {\n impl<'a, 'tcx> Visitor<'tcx> for LintCollector<'a, 'tcx> {\n     type NestedFilter = nested_filter::All;\n \n-    fn visit_path(&mut self, path: &'tcx Path<'_>, _: HirId) {\n+    fn visit_path(&mut self, path: &Path<'_>, _: HirId) {\n         if path.segments.len() == 1 {\n             self.output.insert(path.segments[0].ident.name);\n         }"}, {"sha": "857abe77e21f239c6225a1dd06b6d45348d38d5b", "filename": "src/tools/clippy/clippy_lints/src/utils/internal_lints/metadata_collector.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1019,7 +1019,7 @@ impl<'a, 'hir> intravisit::Visitor<'hir> for ApplicabilityResolver<'a, 'hir> {\n         self.cx.tcx.hir()\n     }\n \n-    fn visit_path(&mut self, path: &'hir hir::Path<'hir>, _id: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'hir>, _id: hir::HirId) {\n         for (index, enum_value) in paths::APPLICABILITY_VALUES.iter().enumerate() {\n             if match_path(path, enum_value) {\n                 self.add_new_index(index);"}, {"sha": "e4d1ee195c4dfb10aed5eed874f7de6fe280d84d", "filename": "src/tools/clippy/clippy_lints/src/wildcard_imports.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwildcard_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwildcard_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwildcard_imports.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -176,7 +176,8 @@ impl LateLintPass<'_> for WildcardImports {\n                     format!(\"{import_source_snippet}::{imports_string}\")\n                 };\n \n-                let (lint, message) = if let Res::Def(DefKind::Enum, _) = use_path.res {\n+                // Glob imports always have a single resolution.\n+                let (lint, message) = if let Res::Def(DefKind::Enum, _) = use_path.res[0] {\n                     (ENUM_GLOB_USE, \"usage of wildcard import for enum variants\")\n                 } else {\n                     (WILDCARD_IMPORTS, \"usage of wildcard import\")"}, {"sha": "49e5f283db08904b5e273449a9f3696343dcab3a", "filename": "src/tools/clippy/clippy_utils/src/ast_utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -566,7 +566,7 @@ pub fn eq_use_tree_kind(l: &UseTreeKind, r: &UseTreeKind) -> bool {\n     use UseTreeKind::*;\n     match (l, r) {\n         (Glob, Glob) => true,\n-        (Simple(l, _, _), Simple(r, _, _)) => both(l, r, |l, r| eq_id(*l, *r)),\n+        (Simple(l), Simple(r)) => both(l, r, |l, r| eq_id(*l, *r)),\n         (Nested(l), Nested(r)) => over(l, r, |(l, _), (r, _)| eq_use_tree(l, r)),\n         _ => false,\n     }"}, {"sha": "ab3976a13bdbbf4f8524e965e209f62165f623ce", "filename": "src/tools/clippy/clippy_utils/src/usage.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fusage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fusage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fusage.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -128,7 +128,7 @@ impl<'a, 'tcx> intravisit::Visitor<'tcx> for BindingUsageFinder<'a, 'tcx> {\n         }\n     }\n \n-    fn visit_path(&mut self, path: &'tcx hir::Path<'tcx>, _: hir::HirId) {\n+    fn visit_path(&mut self, path: &hir::Path<'tcx>, _: hir::HirId) {\n         if let hir::def::Res::Local(id) = path.res {\n             if self.binding_ids.contains(&id) {\n                 self.usage_found = true;"}, {"sha": "61843124ccd91f03e3b4cd760aeccb1b7fc40102", "filename": "src/tools/clippy/tests/ui/macro_use_imports.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmacro_use_imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmacro_use_imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmacro_use_imports.stderr?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -1,8 +1,8 @@\n error: `macro_use` attributes are no longer needed in the Rust 2018 edition\n-  --> $DIR/macro_use_imports.rs:23:5\n+  --> $DIR/macro_use_imports.rs:25:5\n    |\n LL |     #[macro_use]\n-   |     ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use mac::{inner::foofoo, inner::try_err};`\n+   |     ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use mac::inner::nested::string_add;`\n    |\n    = note: `-D clippy::macro-use-imports` implied by `-D warnings`\n \n@@ -13,10 +13,10 @@ LL |     #[macro_use]\n    |     ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use mini_mac::ClippyMiniMacroTest;`\n \n error: `macro_use` attributes are no longer needed in the Rust 2018 edition\n-  --> $DIR/macro_use_imports.rs:25:5\n+  --> $DIR/macro_use_imports.rs:23:5\n    |\n LL |     #[macro_use]\n-   |     ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use mac::inner::nested::string_add;`\n+   |     ^^^^^^^^^^^^ help: remove the attribute and import the macro directly, try: `use mac::{inner::foofoo, inner::try_err};`\n \n error: `macro_use` attributes are no longer needed in the Rust 2018 edition\n   --> $DIR/macro_use_imports.rs:19:5"}, {"sha": "d9dc8d004aff42d4b24eea2c400ca33c6dfecbd1", "filename": "src/tools/rustfmt/src/imports.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11663b1b4857ffeafbd85a9a36c234d117373b76/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs?ref=11663b1b4857ffeafbd85a9a36c234d117373b76", "patch": "@@ -490,7 +490,7 @@ impl UseTree {\n                 );\n                 result.path.push(UseSegment { kind, version });\n             }\n-            UseTreeKind::Simple(ref rename, ..) => {\n+            UseTreeKind::Simple(ref rename) => {\n                 // If the path has leading double colons and is composed of only 2 segments, then we\n                 // bypass the call to path_to_imported_ident which would get only the ident and\n                 // lose the path root, e.g., `that` in `::that`."}]}