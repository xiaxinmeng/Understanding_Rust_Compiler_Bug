{"sha": "39ed894926c4e1bc40667e54175d405ad8c4e41c", "node_id": "C_kwDOAAsO6NoAKDM5ZWQ4OTQ5MjZjNGUxYmM0MDY2N2U1NDE3NWQ0MDVhZDhjNGU0MWM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-04-29T13:51:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-29T13:51:17Z"}, "message": "Rollup merge of #110964 - notriddle:notriddle/deref-impl, r=GuillaumeGomez\n\nrustdoc: fix weird margins between Deref impl items\n\n## Before\n\n![image](https://user-images.githubusercontent.com/1593513/235245977-90770591-22c1-4a27-9464-248a3729a2b7.png)\n\n## After\n\n![image](https://user-images.githubusercontent.com/1593513/235246009-0e83113e-42b7-4e29-981d-969f9d20af01.png)\n\n## Description\n\nIn the old setup, if the dereffed-to item has multiple impl blocks, each one gets its own `div.impl-items` in the section, but there are no headers separating them. Since the last method in a `div.impl-items` has no bottom margin, and there are no margins between these divs, there is no margin between the last method of one impl and the first method of the following impl.\n\nThis patch fixes it by simplifying the HTML. Each Deref block gets exactly one `div.impl-items`, no matter how many impl blocks it actually has.", "tree": {"sha": "9b8aed083f6a30f8596d3e50144c1365c30724e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b8aed083f6a30f8596d3e50144c1365c30724e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39ed894926c4e1bc40667e54175d405ad8c4e41c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkTSDVCRBK7hj4Ov3rIwAAaEkIAJKMjP+5cU+J3JslAQ4UyEpt\ny7uEZbTUg5go55KoH06CoXvAw+RpCwqtmIEhyn6Hp30GbJ4QTySWVyxJ3FSCCt20\nJ2daIzmUGkkuPt6NaNA8WOZeFcsUAGrF6cNDDht7WjLafuTdigN9YIxciCKj34GF\nreWwGiKJvsQhC3JuHcCMiE1Tbtay8guj2tzEEDfcKXR08dvY86wky5zcJfhKmNor\nmdwf2PdhDHRx612VvYNoNRlzD/TvmsabCFOcvQntHK7Vg9AMUG9FCUs6EqPxLbyK\n39CFN6RqtcA8OJCV4wjImZZV9pTfODrnv8ewCHIbEns3ebnjWk4jqB2zptyr60o=\n=vZEY\n-----END PGP SIGNATURE-----\n", "payload": "tree 9b8aed083f6a30f8596d3e50144c1365c30724e0\nparent cdcec39be6ceaf1e196ca1d6e7033744832b4f75\nparent 2299ba1ca2afdf56000017c70572ed181e174c37\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1682776277 +0200\ncommitter GitHub <noreply@github.com> 1682776277 +0200\n\nRollup merge of #110964 - notriddle:notriddle/deref-impl, r=GuillaumeGomez\n\nrustdoc: fix weird margins between Deref impl items\n\n## Before\n\n![image](https://user-images.githubusercontent.com/1593513/235245977-90770591-22c1-4a27-9464-248a3729a2b7.png)\n\n## After\n\n![image](https://user-images.githubusercontent.com/1593513/235246009-0e83113e-42b7-4e29-981d-969f9d20af01.png)\n\n## Description\n\nIn the old setup, if the dereffed-to item has multiple impl blocks, each one gets its own `div.impl-items` in the section, but there are no headers separating them. Since the last method in a `div.impl-items` has no bottom margin, and there are no margins between these divs, there is no margin between the last method of one impl and the first method of the following impl.\n\nThis patch fixes it by simplifying the HTML. Each Deref block gets exactly one `div.impl-items`, no matter how many impl blocks it actually has.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39ed894926c4e1bc40667e54175d405ad8c4e41c", "html_url": "https://github.com/rust-lang/rust/commit/39ed894926c4e1bc40667e54175d405ad8c4e41c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39ed894926c4e1bc40667e54175d405ad8c4e41c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdcec39be6ceaf1e196ca1d6e7033744832b4f75", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdcec39be6ceaf1e196ca1d6e7033744832b4f75", "html_url": "https://github.com/rust-lang/rust/commit/cdcec39be6ceaf1e196ca1d6e7033744832b4f75"}, {"sha": "2299ba1ca2afdf56000017c70572ed181e174c37", "url": "https://api.github.com/repos/rust-lang/rust/commits/2299ba1ca2afdf56000017c70572ed181e174c37", "html_url": "https://github.com/rust-lang/rust/commit/2299ba1ca2afdf56000017c70572ed181e174c37"}], "stats": {"total": 61, "additions": 55, "deletions": 6}, "files": [{"sha": "d90d0aecb93ad5e6d9ff6624b1d22e45d3c4b9df", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "patch": "@@ -1155,10 +1155,10 @@ fn render_assoc_items_inner(\n     let (non_trait, traits): (Vec<_>, _) = v.iter().partition(|i| i.inner_impl().trait_.is_none());\n     if !non_trait.is_empty() {\n         let mut tmp_buf = Buffer::html();\n-        let (render_mode, id) = match what {\n+        let (render_mode, id, class_html) = match what {\n             AssocItemRender::All => {\n                 write_impl_section_heading(&mut tmp_buf, \"Implementations\", \"implementations\");\n-                (RenderMode::Normal, \"implementations-list\".to_owned())\n+                (RenderMode::Normal, \"implementations-list\".to_owned(), \"\")\n             }\n             AssocItemRender::DerefFor { trait_, type_, deref_mut_ } => {\n                 let id =\n@@ -1175,7 +1175,11 @@ fn render_assoc_items_inner(\n                     ),\n                     &id,\n                 );\n-                (RenderMode::ForDeref { mut_: deref_mut_ }, cx.derive_id(id))\n+                (\n+                    RenderMode::ForDeref { mut_: deref_mut_ },\n+                    cx.derive_id(id),\n+                    r#\" class=\"impl-items\"\"#,\n+                )\n             }\n         };\n         let mut impls_buf = Buffer::html();\n@@ -1199,7 +1203,7 @@ fn render_assoc_items_inner(\n         }\n         if !impls_buf.is_empty() {\n             write!(w, \"{}\", tmp_buf.into_inner()).unwrap();\n-            write!(w, \"<div id=\\\"{}\\\">\", id).unwrap();\n+            write!(w, \"<div id=\\\"{id}\\\"{class_html}>\").unwrap();\n             write!(w, \"{}\", impls_buf.into_inner()).unwrap();\n             w.write_str(\"</div>\").unwrap();\n         }\n@@ -1788,12 +1792,14 @@ fn render_impl(\n                 .into_string()\n             );\n         }\n+        if !default_impl_items.is_empty() || !impl_items.is_empty() {\n+            w.write_str(\"<div class=\\\"impl-items\\\">\");\n+            close_tags.insert_str(0, \"</div>\");\n+        }\n     }\n     if !default_impl_items.is_empty() || !impl_items.is_empty() {\n-        w.write_str(\"<div class=\\\"impl-items\\\">\");\n         w.push_buffer(default_impl_items);\n         w.push_buffer(impl_items);\n-        close_tags.insert_str(0, \"</div>\");\n     }\n     w.write_str(&close_tags);\n }"}, {"sha": "8ecca6d12d24af01bd4c61fe58a422a97bd9e607", "filename": "tests/rustdoc/deref/deref-const-fn.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-const-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-const-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-const-fn.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-const-fn.rs"}, {"sha": "fa3607c5fc12d711be9dfc24f7b7779a2150b3f1", "filename": "tests/rustdoc/deref/deref-multiple-impl-blocks.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-multiple-impl-blocks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-multiple-impl-blocks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-multiple-impl-blocks.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "patch": "@@ -0,0 +1,43 @@\n+#![crate_name=\"foo\"]\n+\n+use std::ops::{Deref, DerefMut};\n+\n+// @has foo/struct.Vec.html\n+// @count - '//h2[@id=\"deref-methods-Slice\"]' 1\n+// @count - '//div[@id=\"deref-methods-Slice-1\"]' 1\n+// @count - '//div[@id=\"deref-methods-Slice-1\"][@class=\"impl-items\"]' 1\n+// @count - '//div[@id=\"deref-methods-Slice-1\"]/div[@class=\"impl-items\"]' 0\n+pub struct Vec;\n+\n+pub struct Slice;\n+\n+impl Deref for Vec {\n+    type Target = Slice;\n+    fn deref(&self) -> &Slice {\n+        &Slice\n+    }\n+}\n+\n+impl DerefMut for Vec {\n+    fn deref_mut(&mut self) -> &mut Slice {\n+        &mut Slice\n+    }\n+}\n+\n+impl Slice {\n+    pub fn sort_floats(&mut self) {\n+        todo!();\n+    }\n+}\n+\n+impl Slice {\n+    pub fn sort(&mut self) {\n+        todo!();\n+    }\n+}\n+\n+impl Slice {\n+    pub fn len(&self) {\n+        todo!();\n+    }\n+}"}, {"sha": "fdf8434224f839b0a00453f32ae77eb2b147b3bf", "filename": "tests/rustdoc/deref/deref-mut-methods.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-mut-methods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-mut-methods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-mut-methods.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-mut-methods.rs"}, {"sha": "be2b42b5ac611dbd99d3a493722dee694b86d1d4", "filename": "tests/rustdoc/deref/deref-recursive-pathbuf.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-recursive-pathbuf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-recursive-pathbuf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-recursive-pathbuf.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-recursive-pathbuf.rs"}, {"sha": "0436f2f86f594f056e7213eda790f6145b55ef42", "filename": "tests/rustdoc/deref/deref-recursive.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-recursive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-recursive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-recursive.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-recursive.rs"}, {"sha": "cccf273a820283afbcd848eb50b8bc7192bc8556", "filename": "tests/rustdoc/deref/deref-slice-core.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-slice-core.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-slice-core.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-slice-core.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-slice-core.rs"}, {"sha": "527de780d48923c5d2b3ba501ed5e2f8b4b20397", "filename": "tests/rustdoc/deref/deref-to-primitive.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-to-primitive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-to-primitive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-to-primitive.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-to-primitive.rs"}, {"sha": "32424d13eb85509c26e56e1c057a15a893030817", "filename": "tests/rustdoc/deref/deref-typedef.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-typedef.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fderef-typedef.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fderef-typedef.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/deref-typedef.rs"}, {"sha": "66919d73eeb63e286c4919d86d30f18157f1aa3e", "filename": "tests/rustdoc/deref/escape-deref-methods.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fescape-deref-methods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fescape-deref-methods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fescape-deref-methods.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/escape-deref-methods.rs"}, {"sha": "f09d23206093d7a36d43f6789ed479c8c74206e9", "filename": "tests/rustdoc/deref/issue-100679-sidebar-links-deref.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fissue-100679-sidebar-links-deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Fissue-100679-sidebar-links-deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Fissue-100679-sidebar-links-deref.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/issue-100679-sidebar-links-deref.rs"}, {"sha": "619f40eff8984fc6ee45fdf1f58fa233b23e60c2", "filename": "tests/rustdoc/deref/recursive-deref-sidebar.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Frecursive-deref-sidebar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Frecursive-deref-sidebar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Frecursive-deref-sidebar.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/recursive-deref-sidebar.rs"}, {"sha": "aa38485c44558b7658d0e0100fdaaa7105597222", "filename": "tests/rustdoc/deref/recursive-deref.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Frecursive-deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39ed894926c4e1bc40667e54175d405ad8c4e41c/tests%2Frustdoc%2Fderef%2Frecursive-deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc%2Fderef%2Frecursive-deref.rs?ref=39ed894926c4e1bc40667e54175d405ad8c4e41c", "previous_filename": "tests/rustdoc/recursive-deref.rs"}]}