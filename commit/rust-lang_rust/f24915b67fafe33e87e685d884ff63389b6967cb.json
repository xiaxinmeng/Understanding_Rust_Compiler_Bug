{"sha": "f24915b67fafe33e87e685d884ff63389b6967cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyNDkxNWI2N2ZhZmUzM2U4N2U2ODVkODg0ZmY2MzM4OWI2OTY3Y2I=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-05T16:54:12Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-05T18:34:07Z"}, "message": "Added a tidy test to ensure libcore cannot contain any tests.", "tree": {"sha": "5f9da0e5550175bee121a81ee95dbbeca62fef27", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f9da0e5550175bee121a81ee95dbbeca62fef27"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f24915b67fafe33e87e685d884ff63389b6967cb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlrt+SAACgkQ/vbIBR0O\nATw9khAAps+GenZPAHzfIFJdeCxggzF/mF9oaM6mAlWYdVag7fmpozOPv3x3Miz1\ni3qxz91qGtHqLaPLg4IPV1kkDb8Fa50RacTcFpN2nTDfZ+mpajOoY2evW/KdJC1/\nAXsaygMgJWeb3ZhWII9e0q4o6Iu+4nUSzl2jsiluc7dGkd7oYmGkPCMkKKjW6d5M\nED1fGekuLQoeJ8uX8P/BV6klLgfZVa0VTMLxKo1giKAfVxpjqJEzkL0hDJiSu8JH\nw1u1pYhc+f0fAYciIV8rv1l66LaA0LGVsZoCvvfzeageQAXPsQTb9UThCS77dXVp\nR3vQOZ4C/BdWTBJHafQlp8OnphBoY+h1J54thILIdqCZael3YuobHIpDNjd0lQ1C\nKGAlmHYrBNoxHonA3SCtn/hs/DjO32wAJhqMOcjadARLaM1Hz5LXxhLjZYfCzLha\nQLazCsK9X5Yf7Bw37sWi9y/LmRis7XgWMWD151Je32W96zcGpGFP8327lXrNVjAn\ntagpAAxPCB/TE8vB6I2osP7wZlv0z8JvmomkEBjPP0IfFDNjWF5gVpLYUInJWdXF\nasL+tgXj25q3ru2ojddRQwWrA6sM0+g00O/HdAQqqL1xQ64/NotkXQDEKmz+vMWX\nn9cCaCV3yDr9Nf8Ukw7B/tp/SaBCOfzZsLOUH8JZjvbbl4FzyVs=\n=9hNr\n-----END PGP SIGNATURE-----", "payload": "tree 5f9da0e5550175bee121a81ee95dbbeca62fef27\nparent 13e07a4e180e964717a0f71f0fc40260bab7d84a\nauthor kennytm <kennytm@gmail.com> 1525539252 +0800\ncommitter kennytm <kennytm@gmail.com> 1525545247 +0800\n\nAdded a tidy test to ensure libcore cannot contain any tests.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f24915b67fafe33e87e685d884ff63389b6967cb", "html_url": "https://github.com/rust-lang/rust/commit/f24915b67fafe33e87e685d884ff63389b6967cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f24915b67fafe33e87e685d884ff63389b6967cb/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13e07a4e180e964717a0f71f0fc40260bab7d84a", "url": "https://api.github.com/repos/rust-lang/rust/commits/13e07a4e180e964717a0f71f0fc40260bab7d84a", "html_url": "https://github.com/rust-lang/rust/commit/13e07a4e180e964717a0f71f0fc40260bab7d84a"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "022ef57503aaabadaec4d5e7b76525c5ca32599f", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=f24915b67fafe33e87e685d884ff63389b6967cb", "patch": "@@ -51,6 +51,7 @@ pub mod pal;\n pub mod deps;\n pub mod ui_tests;\n pub mod unstable_book;\n+pub mod libcoretest;\n \n fn filter_dirs(path: &Path) -> bool {\n     let skip = ["}, {"sha": "ef8b55186b104e8c0ad67012bbc2cad53d455e91", "filename": "src/tools/tidy/src/libcoretest.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Flibcoretest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Flibcoretest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flibcoretest.rs?ref=f24915b67fafe33e87e685d884ff63389b6967cb", "patch": "@@ -0,0 +1,34 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+//! Tidy check to ensure `#[test]` is not used directly inside `libcore`.\n+//!\n+//! `#![no_core]` libraries cannot be tested directly due to duplicating lang\n+//! item. All tests must be written externally in `libcore/tests`.\n+\n+use std::path::Path;\n+use std::fs::read_to_string;\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    let libcore_path = path.join(\"libcore\");\n+    super::walk(\n+        &libcore_path,\n+        &mut |subpath| t!(subpath.strip_prefix(&libcore_path)).starts_with(\"tests\"),\n+        &mut |subpath| {\n+            if t!(read_to_string(subpath)).contains(\"#[test]\") {\n+                tidy_error!(\n+                    bad,\n+                    \"{} contains #[test]; libcore tests must be placed inside `src/libcore/tests/`\",\n+                    subpath.display()\n+                );\n+            }\n+        },\n+    );\n+}"}, {"sha": "7b86650823a437a1366c2a1a4f0bfc198569790c", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f24915b67fafe33e87e685d884ff63389b6967cb/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=f24915b67fafe33e87e685d884ff63389b6967cb", "patch": "@@ -41,6 +41,7 @@ fn main() {\n     features::check(&path, &mut bad, quiet);\n     pal::check(&path, &mut bad);\n     unstable_book::check(&path, &mut bad);\n+    libcoretest::check(&path, &mut bad);\n     if !args.iter().any(|s| *s == \"--no-vendor\") {\n         deps::check(&path, &mut bad);\n     }"}]}