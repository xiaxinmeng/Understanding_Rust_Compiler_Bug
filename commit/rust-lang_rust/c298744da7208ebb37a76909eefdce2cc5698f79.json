{"sha": "c298744da7208ebb37a76909eefdce2cc5698f79", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyOTg3NDRkYTcyMDhlYmIzN2E3NjkwOWVlZmRjZTJjYzU2OThmNzk=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-11-26T23:27:34Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-09T18:23:07Z"}, "message": "Remove hir::StructField::attrs.", "tree": {"sha": "75c9c57d6e57df9b95f4a301c7af6c97ac5ec67d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/75c9c57d6e57df9b95f4a301c7af6c97ac5ec67d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c298744da7208ebb37a76909eefdce2cc5698f79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c298744da7208ebb37a76909eefdce2cc5698f79", "html_url": "https://github.com/rust-lang/rust/commit/c298744da7208ebb37a76909eefdce2cc5698f79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c298744da7208ebb37a76909eefdce2cc5698f79/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c0afc3e1c53042915d8626ae55919a64d462333", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c0afc3e1c53042915d8626ae55919a64d462333", "html_url": "https://github.com/rust-lang/rust/commit/3c0afc3e1c53042915d8626ae55919a64d462333"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "3cb1a9e994f3af6ff2cdd8bc0a958a79bd9f18ae", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=c298744da7208ebb37a76909eefdce2cc5698f79", "patch": "@@ -802,6 +802,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             self.lower_ty(&f.ty, ImplTraitContext::disallowed())\n         };\n         let hir_id = self.lower_node_id(f.id);\n+        self.lower_attrs(hir_id, &f.attrs);\n         hir::StructField {\n             span: f.span,\n             hir_id,\n@@ -812,7 +813,6 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             },\n             vis: self.lower_visibility(&f.vis, None),\n             ty,\n-            attrs: self.lower_attrs(hir_id, &f.attrs),\n         }\n     }\n "}, {"sha": "5f56cca5fc9d7bc5beb24eb628786c81216e8ee6", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=c298744da7208ebb37a76909eefdce2cc5698f79", "patch": "@@ -2631,7 +2631,6 @@ pub struct StructField<'hir> {\n     pub vis: Visibility<'hir>,\n     pub hir_id: HirId,\n     pub ty: &'hir Ty<'hir>,\n-    pub attrs: &'hir [Attribute],\n }\n \n impl StructField<'_> {"}, {"sha": "5f2498c231ed82c46e97b1737bd5b450cd8ffef0", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=c298744da7208ebb37a76909eefdce2cc5698f79", "patch": "@@ -888,7 +888,7 @@ impl<'a> State<'a> {\n                     self.popen();\n                     self.commasep(Inconsistent, struct_def.fields(), |s, field| {\n                         s.maybe_print_comment(field.span.lo());\n-                        s.print_outer_attributes(&field.attrs);\n+                        s.print_outer_attributes(s.attrs(field.hir_id));\n                         s.print_visibility(&field.vis);\n                         s.print_type(&field.ty)\n                     });\n@@ -910,7 +910,7 @@ impl<'a> State<'a> {\n                 for field in struct_def.fields() {\n                     self.hardbreak_if_not_bol();\n                     self.maybe_print_comment(field.span.lo());\n-                    self.print_outer_attributes(&field.attrs);\n+                    self.print_outer_attributes(self.attrs(field.hir_id));\n                     self.print_visibility(&field.vis);\n                     self.print_ident(field.ident);\n                     self.word_nbsp(\":\");"}, {"sha": "2bd7aa58afa42dc952152fa446ad8713e63916b9", "filename": "compiler/rustc_save_analysis/src/lib.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c298744da7208ebb37a76909eefdce2cc5698f79/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs?ref=c298744da7208ebb37a76909eefdce2cc5698f79", "patch": "@@ -387,6 +387,7 @@ impl<'tcx> SaveContext<'tcx> {\n \n         let id = id_from_def_id(field_def_id);\n         let span = self.span_from_span(field.ident.span);\n+        let attrs = self.tcx.hir().attrs(field.hir_id);\n \n         Some(Def {\n             kind: DefKind::Field,\n@@ -398,9 +399,9 @@ impl<'tcx> SaveContext<'tcx> {\n             parent: Some(id_from_def_id(scope_def_id)),\n             children: vec![],\n             decl_id: None,\n-            docs: self.docs_for_attrs(&field.attrs),\n+            docs: self.docs_for_attrs(attrs),\n             sig: sig::field_signature(field, self),\n-            attributes: lower_attributes(field.attrs.to_vec(), self),\n+            attributes: lower_attributes(attrs.to_vec(), self),\n         })\n     }\n "}, {"sha": "e82fe9f01000554f385560c1ecc3ed9f692fc601", "filename": "src/tools/clippy/clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c298744da7208ebb37a76909eefdce2cc5698f79/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c298744da7208ebb37a76909eefdce2cc5698f79/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs?ref=c298744da7208ebb37a76909eefdce2cc5698f79", "patch": "@@ -187,7 +187,8 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n \n     fn check_struct_field(&mut self, cx: &LateContext<'tcx>, sf: &'tcx hir::StructField<'_>) {\n         if !sf.is_positional() {\n-            self.check_missing_docs_attrs(cx, &sf.attrs, sf.span, \"a\", \"struct field\");\n+            let attrs = cx.tcx.hir().attrs(sf.hir_id);\n+            self.check_missing_docs_attrs(cx, attrs, sf.span, \"a\", \"struct field\");\n         }\n     }\n "}]}