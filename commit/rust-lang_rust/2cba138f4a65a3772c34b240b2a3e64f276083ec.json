{"sha": "2cba138f4a65a3772c34b240b2a3e64f276083ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjYmExMzhmNGE2NWEzNzcyYzM0YjI0MGIyYTNlNjRmMjc2MDgzZWM=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-05-15T21:57:42Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-05-17T00:15:24Z"}, "message": "Add simple NRVO test", "tree": {"sha": "6133fac3b9007399f428b848e28d5b40a9bc1bb1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6133fac3b9007399f428b848e28d5b40a9bc1bb1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2cba138f4a65a3772c34b240b2a3e64f276083ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2cba138f4a65a3772c34b240b2a3e64f276083ec", "html_url": "https://github.com/rust-lang/rust/commit/2cba138f4a65a3772c34b240b2a3e64f276083ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2cba138f4a65a3772c34b240b2a3e64f276083ec/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "966df3e9266494771254db650cad478ca8c322e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/966df3e9266494771254db650cad478ca8c322e4", "html_url": "https://github.com/rust-lang/rust/commit/966df3e9266494771254db650cad478ca8c322e4"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "bf3a0efeada0ba0e8ee1d904bb076d2ec6a70b6b", "filename": "src/test/mir-opt/nrvo-simple.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2cba138f4a65a3772c34b240b2a3e64f276083ec/src%2Ftest%2Fmir-opt%2Fnrvo-simple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cba138f4a65a3772c34b240b2a3e64f276083ec/src%2Ftest%2Fmir-opt%2Fnrvo-simple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fnrvo-simple.rs?ref=2cba138f4a65a3772c34b240b2a3e64f276083ec", "patch": "@@ -0,0 +1,10 @@\n+// EMIT_MIR rustc.nrvo.RenameReturnPlace.diff\n+fn nrvo(init: fn(&mut [u8; 1024])) -> [u8; 1024] {\n+    let mut buf = [0; 1024];\n+    init(&mut buf);\n+    buf\n+}\n+\n+fn main() {\n+    let _ = nrvo(|buf| { buf[4] = 4; });\n+}"}, {"sha": "79d92897cb57229c027f198af2552d1cf341d7fb", "filename": "src/test/mir-opt/nrvo-simple/rustc.nrvo.RenameReturnPlace.diff", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/2cba138f4a65a3772c34b240b2a3e64f276083ec/src%2Ftest%2Fmir-opt%2Fnrvo-simple%2Frustc.nrvo.RenameReturnPlace.diff", "raw_url": "https://github.com/rust-lang/rust/raw/2cba138f4a65a3772c34b240b2a3e64f276083ec/src%2Ftest%2Fmir-opt%2Fnrvo-simple%2Frustc.nrvo.RenameReturnPlace.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fnrvo-simple%2Frustc.nrvo.RenameReturnPlace.diff?ref=2cba138f4a65a3772c34b240b2a3e64f276083ec", "patch": "@@ -0,0 +1,41 @@\n+- // MIR for `nrvo` before RenameReturnPlace\n++ // MIR for `nrvo` after RenameReturnPlace\n+  \n+  fn nrvo(_1: for<'r> fn(&'r mut [u8; 1024])) -> [u8; 1024] {\n+      debug init => _1;                    // in scope 0 at $DIR/nrvo-simple.rs:2:9: 2:13\n+-     let mut _0: [u8; 1024];              // return place in scope 0 at $DIR/nrvo-simple.rs:2:39: 2:49\n++     let mut _0: [u8; 1024];              // return place in scope 0 at $DIR/nrvo-simple.rs:3:9: 3:16\n+      let mut _2: [u8; 1024];              // in scope 0 at $DIR/nrvo-simple.rs:3:9: 3:16\n+      let _3: ();                          // in scope 0 at $DIR/nrvo-simple.rs:4:5: 4:19\n+      let mut _4: for<'r> fn(&'r mut [u8; 1024]); // in scope 0 at $DIR/nrvo-simple.rs:4:5: 4:9\n+      let mut _5: &mut [u8; 1024];         // in scope 0 at $DIR/nrvo-simple.rs:4:10: 4:18\n+      let mut _6: &mut [u8; 1024];         // in scope 0 at $DIR/nrvo-simple.rs:4:10: 4:18\n+      scope 1 {\n+-         debug buf => _2;                 // in scope 1 at $DIR/nrvo-simple.rs:3:9: 3:16\n++         debug buf => _0;                 // in scope 1 at $DIR/nrvo-simple.rs:3:9: 3:16\n+      }\n+  \n+      bb0: {\n+-         StorageLive(_2);                 // scope 0 at $DIR/nrvo-simple.rs:3:9: 3:16\n+-         _2 = [const 0u8; 1024];          // scope 0 at $DIR/nrvo-simple.rs:3:19: 3:28\n++         _0 = [const 0u8; 1024];          // scope 0 at $DIR/nrvo-simple.rs:3:19: 3:28\n+                                           // ty::Const\n+                                           // + ty: u8\n+                                           // + val: Value(Scalar(0x00))\n+                                           // mir::Constant\n+                                           // + span: $DIR/nrvo-simple.rs:3:20: 3:21\n+                                           // + literal: Const { ty: u8, val: Value(Scalar(0x00)) }\n+          StorageLive(_3);                 // scope 1 at $DIR/nrvo-simple.rs:4:5: 4:19\n+-         _6 = &mut _2;                    // scope 1 at $DIR/nrvo-simple.rs:4:10: 4:18\n++         _6 = &mut _0;                    // scope 1 at $DIR/nrvo-simple.rs:4:10: 4:18\n+          _3 = move _1(move _6) -> bb1;    // scope 1 at $DIR/nrvo-simple.rs:4:5: 4:19\n+      }\n+  \n+      bb1: {\n+          StorageDead(_3);                 // scope 1 at $DIR/nrvo-simple.rs:4:19: 4:20\n+-         _0 = _2;                         // scope 1 at $DIR/nrvo-simple.rs:5:5: 5:8\n+-         StorageDead(_2);                 // scope 0 at $DIR/nrvo-simple.rs:6:1: 6:2\n+          return;                          // scope 0 at $DIR/nrvo-simple.rs:6:2: 6:2\n+      }\n+  }\n+  "}]}