{"sha": "5721cca2f3a469954a4e778b6a24c0d530f531c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU3MjFjY2EyZjNhNDY5OTU0YTRlNzc4YjZhMjRjMGQ1MzBmNTMxYzM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-08-05T13:31:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-05T13:31:37Z"}, "message": "Merge #5494\n\n5494: Use salsa's purge to account for all memory r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "125d7a89eaa87938ef0e2b8e074bccb1a353fc50", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/125d7a89eaa87938ef0e2b8e074bccb1a353fc50"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5721cca2f3a469954a4e778b6a24c0d530f531c3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfKrS5CRBK7hj4Ov3rIwAAdHIIAKCQpEbGYXQXSaBbbrO5xEe/\nfkyxz7w3N85IaBVMJU+TCjXJd/3dxQlm3oDe2iVkQ6eXNYnkg+0tyciLnWTRpewQ\nztG30X6Am9L/U6w/Z5osl1iJAoKcNu53bo7Estt+OYH4Gcn5W5qwv1oVWywpaKAm\n2HkKdc8fJsU+7GjrtK57IpZ7s+l+HAIH1F3uEIUEgxNhbSJPPlSoe/C2pelubOJX\nRC9J2JpQ2yPxP2spaHECmD/hcNw21ErAgExqOE9giY94cecIXlLIRX5F+pCanxSm\nyIDS6FmTney2084LeG4G4POMkEKBELosNRpDW7fjXPZ/xUET4yx+/7Vwzbfg7+o=\n=Sc9S\n-----END PGP SIGNATURE-----\n", "payload": "tree 125d7a89eaa87938ef0e2b8e074bccb1a353fc50\nparent 2ad29eb23167273f2e101b44c1f21b4ec2821bc2\nparent edd4a83ee3c887670afd077eeb1ddb8ce1976108\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1596634297 +0000\ncommitter GitHub <noreply@github.com> 1596634297 +0000\n\nMerge #5494\n\n5494: Use salsa's purge to account for all memory r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5721cca2f3a469954a4e778b6a24c0d530f531c3", "html_url": "https://github.com/rust-lang/rust/commit/5721cca2f3a469954a4e778b6a24c0d530f531c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5721cca2f3a469954a4e778b6a24c0d530f531c3/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ad29eb23167273f2e101b44c1f21b4ec2821bc2", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ad29eb23167273f2e101b44c1f21b4ec2821bc2", "html_url": "https://github.com/rust-lang/rust/commit/2ad29eb23167273f2e101b44c1f21b4ec2821bc2"}, {"sha": "edd4a83ee3c887670afd077eeb1ddb8ce1976108", "url": "https://api.github.com/repos/rust-lang/rust/commits/edd4a83ee3c887670afd077eeb1ddb8ce1976108", "html_url": "https://github.com/rust-lang/rust/commit/edd4a83ee3c887670afd077eeb1ddb8ce1976108"}], "stats": {"total": 55, "additions": 35, "deletions": 20}, "files": [{"sha": "451928c27bbacc0a6a1055dba11767e5aed1f326", "filename": "Cargo.lock", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5721cca2f3a469954a4e778b6a24c0d530f531c3/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/5721cca2f3a469954a4e778b6a24c0d530f531c3/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=5721cca2f3a469954a4e778b6a24c0d530f531c3", "patch": "@@ -318,9 +318,9 @@ dependencies = [\n \n [[package]]\n name = \"filetime\"\n-version = \"0.2.11\"\n+version = \"0.2.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e500da2fab70bdc43f8f0e0b350a227f31c72311c56aba48f01d5cd62bb0345b\"\n+checksum = \"3ed85775dcc68644b5c950ac06a2b23768d3bc9390464151aaf27136998dcf9e\"\n dependencies = [\n  \"cfg-if\",\n  \"libc\",\n@@ -1371,9 +1371,9 @@ checksum = \"71d301d4193d031abdd79ff7e3dd721168a9572ef3fe51a1517aba235bd8f86e\"\n \n [[package]]\n name = \"salsa\"\n-version = \"0.15.1\"\n+version = \"0.15.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d4cdc109fcc9e9450c7ef47fb7474e99bffd51799da03ed0a6c7f0e2cb3848a6\"\n+checksum = \"9ab29056d4fb4048a5f0d169c9b6e5526160c9ec37aded5a6879c2c9c445a8e4\"\n dependencies = [\n  \"crossbeam-utils\",\n  \"indexmap\",\n@@ -1388,9 +1388,9 @@ dependencies = [\n \n [[package]]\n name = \"salsa-macros\"\n-version = \"0.15.0\"\n+version = \"0.15.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2c280ac85b15ac214b86ac4b407626a48e6a1c4f90769a582fec74aa57942b9f\"\n+checksum = \"a1c3aec007c63c4ed4cd7a018529fb0b5575c4562575fc6a40d6cd2ae0b792ef\"\n dependencies = [\n  \"heck\",\n  \"proc-macro2\",\n@@ -1533,9 +1533,9 @@ version = \"0.1.0\"\n \n [[package]]\n name = \"syn\"\n-version = \"1.0.36\"\n+version = \"1.0.38\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4cdb98bcb1f9d81d07b536179c269ea15999b5d14ea958196413869445bb5250\"\n+checksum = \"e69abc24912995b3038597a7a593be5053eb0fb44f3cc5beec0deb421790c1f4\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -1644,9 +1644,9 @@ dependencies = [\n \n [[package]]\n name = \"tracing-core\"\n-version = \"0.1.12\"\n+version = \"0.1.13\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b2734b5a028fa697686f16c6d18c2c6a3c7e41513f9a213abb6754c4acb3c8d7\"\n+checksum = \"d593f98af59ebc017c0648f0117525db358745a8894a8d684e185ba3f45954f9\"\n dependencies = [\n  \"lazy_static\",\n ]"}, {"sha": "fe73dc01574fb3fafb74c57f3d23ae19c88439c7", "filename": "crates/ra_db/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_db%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_db%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_db%2FCargo.toml?ref=5721cca2f3a469954a4e778b6a24c0d530f531c3", "patch": "@@ -9,7 +9,7 @@ license = \"MIT OR Apache-2.0\"\n doctest = false\n \n [dependencies]\n-salsa = \"0.15.0\"\n+salsa = \"0.15.2\"\n rustc-hash = \"1.1.0\"\n \n ra_syntax = { path = \"../ra_syntax\" }"}, {"sha": "07333c453f0e0c9f902ae0d636d7e0b94fdd61e7", "filename": "crates/ra_hir/src/db.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_hir%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_hir%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fdb.rs?ref=5721cca2f3a469954a4e778b6a24c0d530f531c3", "patch": "@@ -13,14 +13,7 @@ pub use hir_expand::db::{\n     AstDatabase, AstDatabaseStorage, AstIdMapQuery, InternEagerExpansionQuery, InternMacroQuery,\n     MacroArgTextQuery, MacroDefQuery, MacroExpandQuery, ParseMacroQuery,\n };\n-pub use hir_ty::db::{\n-    AssociatedTyDataQuery, AssociatedTyValueQuery, CallableItemSignatureQuery, FieldTypesQuery,\n-    GenericDefaultsQuery, GenericPredicatesForParamQuery, GenericPredicatesQuery, HirDatabase,\n-    HirDatabaseStorage, ImplDatumQuery, ImplSelfTyQuery, ImplTraitQuery, InferQueryQuery,\n-    InherentImplsInCrateQuery, InternTypeParamIdQuery, ReturnTypeImplTraitsQuery, StructDatumQuery,\n-    TraitDatumQuery, TraitImplsInCrateQuery, TraitImplsInDepsQuery, TraitSolveQuery, TyQuery,\n-    ValueTyQuery,\n-};\n+pub use hir_ty::db::*;\n \n #[test]\n fn hir_database_is_object_safe() {"}, {"sha": "b13df8b855b2a40afbe68d89d6c98c57f672c70e", "filename": "crates/ra_ide_db/src/change.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_ide_db%2Fsrc%2Fchange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5721cca2f3a469954a4e778b6a24c0d530f531c3/crates%2Fra_ide_db%2Fsrc%2Fchange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fchange.rs?ref=5721cca2f3a469954a4e778b6a24c0d530f531c3", "patch": "@@ -190,11 +190,24 @@ impl RootDatabase {\n                 let q: $q = Default::default();\n                 let name = format!(\"{:?} (deps)\", q);\n                 acc.push((name, before - after));\n+\n+                let before = memory_usage().allocated;\n+                $q.in_db(self).purge();\n+                let after = memory_usage().allocated;\n+                let q: $q = Default::default();\n+                let name = format!(\"{:?} (purge)\", q);\n+                acc.push((name, before - after));\n             )*}\n         }\n         sweep_each_query![\n             // SourceDatabase\n             ra_db::ParseQuery\n+            ra_db::CrateGraphQuery\n+\n+            // SourceDatabaseExt\n+            ra_db::FileTextQuery\n+            ra_db::FileSourceRootQuery\n+            ra_db::SourceRootQuery\n             ra_db::SourceRootCratesQuery\n \n             // AstDatabase\n@@ -242,15 +255,24 @@ impl RootDatabase {\n             hir::db::TraitImplsInCrateQuery\n             hir::db::TraitImplsInDepsQuery\n             hir::db::AssociatedTyDataQuery\n+            hir::db::AssociatedTyDataQuery\n             hir::db::TraitDatumQuery\n             hir::db::StructDatumQuery\n             hir::db::ImplDatumQuery\n+            hir::db::FnDefDatumQuery\n+            hir::db::ReturnTypeImplTraitsQuery\n+            hir::db::InternCallableDefQuery\n+            hir::db::InternTypeParamIdQuery\n+            hir::db::InternImplTraitIdQuery\n+            hir::db::InternClosureQuery\n             hir::db::AssociatedTyValueQuery\n             hir::db::TraitSolveQuery\n-            hir::db::ReturnTypeImplTraitsQuery\n \n             // SymbolsDatabase\n             crate::symbol_index::FileSymbolsQuery\n+            crate::symbol_index::LibrarySymbolsQuery\n+            crate::symbol_index::LocalRootsQuery\n+            crate::symbol_index::LibraryRootsQuery\n \n             // LineIndexDatabase\n             crate::LineIndexQuery"}]}