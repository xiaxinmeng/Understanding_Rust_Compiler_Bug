{"sha": "c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "node_id": "C_kwDOAAsO6NoAKGMyZTM1MjFiZmJlZjQ3OTM5ZDg1OGEwYzlkMTFlMDhiNzFiYzgwYzA", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-25T20:58:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-25T20:58:02Z"}, "message": "Rollup merge of #111950 - cjgillot:expn-noinline, r=oli-obk\n\nRemove ExpnKind::Inlined.\n\nSuggested in https://github.com/rust-lang/rust/pull/111815#issuecomment-1561903339\n\nr? ``@oli-obk``", "tree": {"sha": "255ebd85d7c30ba43616a673bf014d19be47c1f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/255ebd85d7c30ba43616a673bf014d19be47c1f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkb8vaCRBK7hj4Ov3rIwAA8sYIAJsKXi9qq9v+PmYSD31tQ3+T\nxx7cl8dX0rjp8PMVAFnelMhzAiDd3y6TiaP/Yfa2T07G23iV8kBIf3kgpQIA6Lxi\nwY97TdiUgLkc23OhKNPORXqYrWiW3lQ1lhKjpLPngfMAiWZbRg4CnO4pGgokR0kL\nMi10XEOldeLZJJrOFYXWaamZLrJyIlreX9dCXl0vUHkuBEPtqhlktemccIbP7JZp\nu4zwbndiaUcGmAbCvdt4aRox6q+kAdkPe/XVylNxuhUAJnf4bkLM/QFUtCIwqLgq\nVa42W9gtGsYTkhy2o9LaNjJxcayo5zd9JJzTY848syqL9YUTji0Vdwbyoumj21Y=\n=WoLm\n-----END PGP SIGNATURE-----\n", "payload": "tree 255ebd85d7c30ba43616a673bf014d19be47c1f2\nparent cb5b40269f6f087e4bdb8cc1c2776fd47eda1a3e\nparent 3a423c3feb9b4827ff8b3dd1e18307df700320f2\nauthor Michael Goulet <michael@errs.io> 1685048282 -0700\ncommitter GitHub <noreply@github.com> 1685048282 -0700\n\nRollup merge of #111950 - cjgillot:expn-noinline, r=oli-obk\n\nRemove ExpnKind::Inlined.\n\nSuggested in https://github.com/rust-lang/rust/pull/111815#issuecomment-1561903339\n\nr? ``@oli-obk``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "html_url": "https://github.com/rust-lang/rust/commit/c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb5b40269f6f087e4bdb8cc1c2776fd47eda1a3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb5b40269f6f087e4bdb8cc1c2776fd47eda1a3e", "html_url": "https://github.com/rust-lang/rust/commit/cb5b40269f6f087e4bdb8cc1c2776fd47eda1a3e"}, {"sha": "3a423c3feb9b4827ff8b3dd1e18307df700320f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a423c3feb9b4827ff8b3dd1e18307df700320f2", "html_url": "https://github.com/rust-lang/rust/commit/3a423c3feb9b4827ff8b3dd1e18307df700320f2"}], "stats": {"total": 86, "additions": 29, "deletions": 57}, "files": [{"sha": "5eaa988dd09298d0236ac93cf3a7a025dd3ad159", "filename": "compiler/rustc_codegen_cranelift/src/common.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fcommon.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -413,11 +413,7 @@ impl<'tcx> FunctionCx<'_, '_, 'tcx> {\n \n     // Note: must be kept in sync with get_caller_location from cg_ssa\n     pub(crate) fn get_caller_location(&mut self, mut source_info: mir::SourceInfo) -> CValue<'tcx> {\n-        let span_to_caller_location = |fx: &mut FunctionCx<'_, '_, 'tcx>, mut span: Span| {\n-            // Remove `Inlined` marks as they pollute `expansion_cause`.\n-            while span.is_inlined() {\n-                span.remove_mark();\n-            }\n+        let span_to_caller_location = |fx: &mut FunctionCx<'_, '_, 'tcx>, span: Span| {\n             let topmost = span.ctxt().outer_expn().expansion_cause().unwrap_or(span);\n             let caller = fx.tcx.sess.source_map().lookup_char_pos(topmost.lo());\n             let const_loc = fx.tcx.const_caller_location(("}, {"sha": "d516ac4ebb749aea478937d443439f605d1233ac", "filename": "compiler/rustc_codegen_ssa/src/mir/block.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -1450,11 +1450,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n     ) -> OperandRef<'tcx, Bx::Value> {\n         let tcx = bx.tcx();\n \n-        let mut span_to_caller_location = |mut span: Span| {\n-            // Remove `Inlined` marks as they pollute `expansion_cause`.\n-            while span.is_inlined() {\n-                span.remove_mark();\n-            }\n+        let mut span_to_caller_location = |span: Span| {\n             let topmost = span.ctxt().outer_expn().expansion_cause().unwrap_or(span);\n             let caller = tcx.sess.source_map().lookup_char_pos(topmost.lo());\n             let const_loc = tcx.const_caller_location(("}, {"sha": "7e94578003ebfc13159f14c17f5e949348041a3c", "filename": "compiler/rustc_const_eval/src/interpret/eval_context.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -949,7 +949,20 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         // This deliberately does *not* honor `requires_caller_location` since it is used for much\n         // more than just panics.\n         for frame in stack.iter().rev() {\n-            let span = frame.current_span();\n+            let span = match frame.loc {\n+                Left(loc) => {\n+                    // If the stacktrace passes through MIR-inlined source scopes, add them.\n+                    let mir::SourceInfo { mut span, scope } = *frame.body.source_info(loc);\n+                    let mut scope_data = &frame.body.source_scopes[scope];\n+                    while let Some((instance, call_span)) = scope_data.inlined {\n+                        frames.push(FrameInfo { span, instance });\n+                        span = call_span;\n+                        scope_data = &frame.body.source_scopes[scope_data.parent_scope.unwrap()];\n+                    }\n+                    span\n+                }\n+                Right(span) => span,\n+            };\n             frames.push(FrameInfo { span, instance: frame.instance });\n         }\n         trace!(\"generate stacktrace: {:#?}\", frames);"}, {"sha": "df5b581000b7d155242e9282b535ba56d31730bf", "filename": "compiler/rustc_const_eval/src/interpret/intrinsics/caller_location.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -111,11 +111,7 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         location\n     }\n \n-    pub(crate) fn location_triple_for_span(&self, mut span: Span) -> (Symbol, u32, u32) {\n-        // Remove `Inlined` marks as they pollute `expansion_cause`.\n-        while span.is_inlined() {\n-            span.remove_mark();\n-        }\n+    pub(crate) fn location_triple_for_span(&self, span: Span) -> (Symbol, u32, u32) {\n         let topmost = span.ctxt().outer_expn().expansion_cause().unwrap_or(span);\n         let caller = self.tcx.sess.source_map().lookup_char_pos(topmost.lo());\n         ("}, {"sha": "e8cd7eaa60f1acb02a3dcacb2b9290ce77dc0236", "filename": "compiler/rustc_errors/src/emitter.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Femitter.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -332,7 +332,7 @@ pub trait Emitter: Translate {\n \n                     // Skip past non-macro entries, just in case there\n                     // are some which do actually involve macros.\n-                    ExpnKind::Inlined | ExpnKind::Desugaring(..) | ExpnKind::AstPass(..) => None,\n+                    ExpnKind::Desugaring(..) | ExpnKind::AstPass(..) => None,\n \n                     ExpnKind::Macro(macro_kind, name) => Some((macro_kind, name)),\n                 }\n@@ -403,7 +403,7 @@ pub trait Emitter: Translate {\n                     continue;\n                 }\n \n-                if always_backtrace && !matches!(trace.kind, ExpnKind::Inlined) {\n+                if always_backtrace {\n                     new_labels.push((\n                         trace.def_site,\n                         format!(\n@@ -442,7 +442,6 @@ pub trait Emitter: Translate {\n                             \"this derive macro expansion\".into()\n                         }\n                         ExpnKind::Macro(MacroKind::Bang, _) => \"this macro invocation\".into(),\n-                        ExpnKind::Inlined => \"this inlined function call\".into(),\n                         ExpnKind::Root => \"the crate root\".into(),\n                         ExpnKind::AstPass(kind) => kind.descr().into(),\n                         ExpnKind::Desugaring(kind) => {"}, {"sha": "14343ac1108b2dfb1269e57b61aa616d6d2c0e2e", "filename": "compiler/rustc_middle/src/lint.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flint.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -468,8 +468,7 @@ pub fn struct_lint_level(\n pub fn in_external_macro(sess: &Session, span: Span) -> bool {\n     let expn_data = span.ctxt().outer_expn_data();\n     match expn_data.kind {\n-        ExpnKind::Inlined\n-        | ExpnKind::Root\n+        ExpnKind::Root\n         | ExpnKind::Desugaring(\n             DesugaringKind::ForLoop | DesugaringKind::WhileLoop | DesugaringKind::OpaqueTy,\n         ) => false,"}, {"sha": "a8d0dca37ff99e43049d3409db9306c435083402", "filename": "compiler/rustc_middle/src/ty/mod.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -2488,9 +2488,7 @@ impl<'tcx> TyCtxt<'tcx> {\n             && if self.features().collapse_debuginfo {\n                 span.in_macro_expansion_with_collapse_debuginfo()\n             } else {\n-                // Inlined spans should not be collapsed as that leads to all of the\n-                // inlined code being attributed to the inline callsite.\n-                span.from_expansion() && !span.is_inlined()\n+                span.from_expansion()\n             }\n     }\n "}, {"sha": "1748b1bf4a02a513184523f163637bcd8f7c8890", "filename": "compiler/rustc_mir_transform/src/inline.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Finline.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -10,7 +10,6 @@ use rustc_middle::mir::*;\n use rustc_middle::ty::TypeVisitableExt;\n use rustc_middle::ty::{self, Instance, InstanceDef, ParamEnv, Ty, TyCtxt};\n use rustc_session::config::OptLevel;\n-use rustc_span::{hygiene::ExpnKind, ExpnData, LocalExpnId, Span};\n use rustc_target::abi::{FieldIdx, FIRST_VARIANT};\n use rustc_target::spec::abi::Abi;\n \n@@ -551,16 +550,6 @@ impl<'tcx> Inliner<'tcx> {\n                 // Copy the arguments if needed.\n                 let args: Vec<_> = self.make_call_args(args, &callsite, caller_body, &callee_body);\n \n-                let mut expn_data = ExpnData::default(\n-                    ExpnKind::Inlined,\n-                    callsite.source_info.span,\n-                    self.tcx.sess.edition(),\n-                    None,\n-                    None,\n-                );\n-                expn_data.def_site = callee_body.span;\n-                let expn_data =\n-                    self.tcx.with_stable_hashing_context(|hcx| LocalExpnId::fresh(expn_data, hcx));\n                 let mut integrator = Integrator {\n                     args: &args,\n                     new_locals: Local::new(caller_body.local_decls.len())..,\n@@ -572,7 +561,6 @@ impl<'tcx> Inliner<'tcx> {\n                     cleanup_block: unwind,\n                     in_cleanup_block: false,\n                     tcx: self.tcx,\n-                    expn_data,\n                     always_live_locals: BitSet::new_filled(callee_body.local_decls.len()),\n                 };\n \n@@ -956,7 +944,6 @@ struct Integrator<'a, 'tcx> {\n     cleanup_block: UnwindAction,\n     in_cleanup_block: bool,\n     tcx: TyCtxt<'tcx>,\n-    expn_data: LocalExpnId,\n     always_live_locals: BitSet<Local>,\n }\n \n@@ -1042,11 +1029,6 @@ impl<'tcx> MutVisitor<'tcx> for Integrator<'_, 'tcx> {\n         *scope = self.map_scope(*scope);\n     }\n \n-    fn visit_span(&mut self, span: &mut Span) {\n-        // Make sure that all spans track the fact that they were inlined.\n-        *span = span.fresh_expansion(self.expn_data);\n-    }\n-\n     fn visit_basic_block_data(&mut self, block: BasicBlock, data: &mut BasicBlockData<'tcx>) {\n         self.in_cleanup_block = data.is_cleanup;\n         self.super_basic_block_data(block, data);"}, {"sha": "6755657c7276eb54fc5161e02f174ff7d0c68b93", "filename": "compiler/rustc_span/src/hygiene.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fhygiene.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -320,7 +320,6 @@ impl ExpnId {\n             // Stop going up the backtrace once include! is encountered\n             if expn_data.is_root()\n                 || expn_data.kind == ExpnKind::Macro(MacroKind::Bang, sym::include)\n-                || expn_data.kind == ExpnKind::Inlined\n             {\n                 break;\n             }\n@@ -1058,8 +1057,6 @@ pub enum ExpnKind {\n     AstPass(AstPass),\n     /// Desugaring done by the compiler during HIR lowering.\n     Desugaring(DesugaringKind),\n-    /// MIR inlining\n-    Inlined,\n }\n \n impl ExpnKind {\n@@ -1073,7 +1070,6 @@ impl ExpnKind {\n             },\n             ExpnKind::AstPass(kind) => kind.descr().to_string(),\n             ExpnKind::Desugaring(kind) => format!(\"desugaring of {}\", kind.descr()),\n-            ExpnKind::Inlined => \"inlined source\".to_string(),\n         }\n     }\n }"}, {"sha": "eae3f0fa041dd1cd19ec750518d2e08eb9227e6b", "filename": "compiler/rustc_span/src/lib.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_span%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/compiler%2Frustc_span%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Flib.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -594,12 +594,6 @@ impl Span {\n         matches!(outer_expn.kind, ExpnKind::Macro(..)) && outer_expn.collapse_debuginfo\n     }\n \n-    /// Returns `true` if this span comes from MIR inlining.\n-    pub fn is_inlined(self) -> bool {\n-        let outer_expn = self.ctxt().outer_expn_data();\n-        matches!(outer_expn.kind, ExpnKind::Inlined)\n-    }\n-\n     /// Returns `true` if `span` originates in a derive-macro's expansion.\n     pub fn in_derive_expansion(self) -> bool {\n         matches!(self.ctxt().outer_expn_data().kind, ExpnKind::Macro(MacroKind::Derive, _))"}, {"sha": "b9199cff079e79096a03ab5bd28478be56e94dcc", "filename": "src/tools/miri/tests/fail/terminate-terminator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.rs?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -12,13 +12,13 @@ impl Drop for Foo {\n \n #[inline(always)]\n fn has_cleanup() {\n+    //~^ ERROR: panic in a function that cannot unwind\n     let _f = Foo;\n     panic!();\n }\n \n extern \"C\" fn panic_abort() {\n     has_cleanup();\n-    //~^ ERROR: panic in a function that cannot unwind\n }\n \n fn main() {"}, {"sha": "d73e23a53d0d9d74230d9d6bbca9e57beba2b0f5", "filename": "src/tools/miri/tests/fail/terminate-terminator.stderr", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c2e3521bfbef47939d858a0c9d11e08b71bc80c0/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Fterminate-terminator.stderr?ref=c2e3521bfbef47939d858a0c9d11e08b71bc80c0", "patch": "@@ -6,15 +6,18 @@ error: abnormal termination: panic in a function that cannot unwind\n   --> $DIR/terminate-terminator.rs:LL:CC\n    |\n LL | / fn has_cleanup() {\n+LL | |\n LL | |     let _f = Foo;\n LL | |     panic!();\n LL | | }\n    | |_^ panic in a function that cannot unwind\n-...\n-LL |       has_cleanup();\n-   |       ------------- in this inlined function call\n    |\n-   = note: inside `panic_abort` at $DIR/terminate-terminator.rs:LL:CC\n+   = note: inside `has_cleanup` at $DIR/terminate-terminator.rs:LL:CC\n+note: inside `panic_abort`\n+  --> $DIR/terminate-terminator.rs:LL:CC\n+   |\n+LL |     has_cleanup();\n+   |     ^^^^^^^^^^^^^\n note: inside `main`\n   --> $DIR/terminate-terminator.rs:LL:CC\n    |"}]}