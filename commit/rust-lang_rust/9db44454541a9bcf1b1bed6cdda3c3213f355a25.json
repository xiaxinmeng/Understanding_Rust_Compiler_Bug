{"sha": "9db44454541a9bcf1b1bed6cdda3c3213f355a25", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkYjQ0NDU0NTQxYTliY2YxYjFiZWQ2Y2RkYTNjMzIxM2YzNTVhMjU=", "commit": {"author": {"name": "Tim Chevalier", "email": "catamorphism@gmail.com", "date": "2012-09-05T17:58:16Z"}, "committer": {"name": "Tim Chevalier", "email": "catamorphism@gmail.com", "date": "2012-09-05T17:58:16Z"}, "message": "Merge pull request #3316 from Vincent-Belliard/issue_3222\n\nfix issue #3222", "tree": {"sha": "5e5c226dd17f031565304f78ede52766a2d0dbe9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e5c226dd17f031565304f78ede52766a2d0dbe9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9db44454541a9bcf1b1bed6cdda3c3213f355a25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9db44454541a9bcf1b1bed6cdda3c3213f355a25", "html_url": "https://github.com/rust-lang/rust/commit/9db44454541a9bcf1b1bed6cdda3c3213f355a25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9db44454541a9bcf1b1bed6cdda3c3213f355a25/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fa2fb0f86831c7bdb1c874eb49074d11640d5cf9", "url": "https://api.github.com/repos/rust-lang/rust/commits/fa2fb0f86831c7bdb1c874eb49074d11640d5cf9", "html_url": "https://github.com/rust-lang/rust/commit/fa2fb0f86831c7bdb1c874eb49074d11640d5cf9"}, {"sha": "d12128f56fdf315913bd5c427b3322bed484f1b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/d12128f56fdf315913bd5c427b3322bed484f1b3", "html_url": "https://github.com/rust-lang/rust/commit/d12128f56fdf315913bd5c427b3322bed484f1b3"}], "stats": {"total": 59, "additions": 55, "deletions": 4}, "files": [{"sha": "a96529fa01c74dcb361c41a4addd9dc88bbe996a", "filename": "src/rustc/middle/trans/alt.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9db44454541a9bcf1b1bed6cdda3c3213f355a25/src%2Frustc%2Fmiddle%2Ftrans%2Falt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db44454541a9bcf1b1bed6cdda3c3213f355a25/src%2Frustc%2Fmiddle%2Ftrans%2Falt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Falt.rs?ref=9db44454541a9bcf1b1bed6cdda3c3213f355a25", "patch": "@@ -58,8 +58,7 @@ fn trans_opt(bcx: block, o: opt) -> opt_result {\n             return single_result(rslt(bcx, *cell));\n           }\n           _ => {\n-            return single_result(\n-                rslt(bcx, consts::const_expr(ccx, l)));\n+            return single_result(trans_temp_expr(bcx, l));\n           }\n         }\n       }\n@@ -636,13 +635,14 @@ fn compile_submatch(bcx: block, m: match_, vals: ~[ValueRef],\n             }\n           }\n           lit(_) => {\n-            test_val = Load(bcx, val);\n             let pty = node_id_type(bcx, pat_id);\n+            test_val = load_if_immediate(bcx, val, pty);\n             kind = if ty::type_is_integral(pty) { switch }\n                    else { compare };\n           }\n           range(_, _) => {\n-            test_val = Load(bcx, val);\n+            let pty = node_id_type(bcx, pat_id);\n+            test_val = load_if_immediate(bcx, val, pty);\n             kind = compare;\n           }\n         }"}, {"sha": "0bc3eeb169d243e51445aa9f00360e5c90f2aa54", "filename": "src/test/run-pass/alt-borrowed_str.rs", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/9db44454541a9bcf1b1bed6cdda3c3213f355a25/src%2Ftest%2Frun-pass%2Falt-borrowed_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db44454541a9bcf1b1bed6cdda3c3213f355a25/src%2Ftest%2Frun-pass%2Falt-borrowed_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Falt-borrowed_str.rs?ref=9db44454541a9bcf1b1bed6cdda3c3213f355a25", "patch": "@@ -0,0 +1,51 @@\n+// -*- rust -*-\n+fn f1(ref_string: &str) {\n+    match ref_string {\n+        \"a\" => io::println(\"found a\"),\n+        \"b\" => io::println(\"found b\"),\n+        _ => io::println(\"not found\")\n+    }\n+}\n+\n+fn f2(ref_string: &str) {\n+    match ref_string {\n+        \"a\" => io::println(\"found a\"),\n+        \"b\" => io::println(\"found b\"),\n+        s => io::println(fmt!(\"not found (%s)\", s))\n+    }\n+}\n+\n+fn g1(ref_1: &str, ref_2: &str) {\n+    match (ref_1, ref_2) {\n+        (\"a\", \"b\") => io::println(\"found a,b\"),\n+        (\"b\", \"c\") => io::println(\"found b,c\"),\n+        _ => io::println(\"not found\")\n+    }\n+}\n+\n+fn g2(ref_1: &str, ref_2: &str) {\n+    match (ref_1, ref_2) {\n+        (\"a\", \"b\") => io::println(\"found a,b\"),\n+        (\"b\", \"c\") => io::println(\"found b,c\"),\n+        (s1, s2) => io::println(fmt!(\"not found (%s, %s)\", s1, s2))\n+    }\n+}\n+\n+fn main() {\n+    f1(@\"a\");\n+    f1(~\"b\");\n+    f1(&\"c\");\n+    f1(\"d\");\n+    f2(@\"a\");\n+    f2(~\"b\");\n+    f2(&\"c\");\n+    f2(\"d\");\n+    g1(@\"a\", @\"b\");\n+    g1(~\"b\", ~\"c\");\n+    g1(&\"c\", &\"d\");\n+    g1(\"d\", \"e\");\n+    g2(@\"a\", @\"b\");\n+    g2(~\"b\", ~\"c\");\n+    g2(&\"c\", &\"d\");\n+    g2(\"d\", \"e\");\n+}"}]}