{"sha": "3715f1e490e187c3635ef241104bd5abe119958b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3MTVmMWU0OTBlMTg3YzM2MzVlZjI0MTEwNGJkNWFiZTExOTk1OGI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-14T08:14:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-14T08:14:32Z"}, "message": "Rollup merge of #48065 - Xaeroxe:patch-1, r=alexcrichton\n\nApply optimization from #44355 to retain\n\nAs discussed in #44355 this PR applies a similar optimization to `Vec::retain`.  For `drain_filter`, a very similar function, this improved performance by up to 20%.", "tree": {"sha": "e675da0a97f32d6a5f554b838b9b00bfb3be689f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e675da0a97f32d6a5f554b838b9b00bfb3be689f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3715f1e490e187c3635ef241104bd5abe119958b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJag+/pCRBK7hj4Ov3rIwAAdHIIAAaFypQaBPFbjezz514W4AHo\n1orlshqB5dZkVAVrznnpAoFOymkx1/jd2YvB755nJyslibLqytWBhk0Ly+jzFVbZ\nhPnn3M5bX6GzxnSA9Moo9KvELH5IaPorMfP752yLbODsOy0uNe5O9G9yRcibNn9E\nxSlPM5LI5w664QpYrc717egkY+w/A0rsz/JL5Hc1BhYHfDvnF3pyX5yTf5lVAL/5\ngs9VRUCkNqFCKa4fkRd8ZkR0QFl+YnaM7YxKRTJZDU8/n5gpwG1lopL2Eu07WKDZ\nVu9k6LF32Jehie5yjPV3gaNa3QRx13EpnJFt7vTHXcJmp58UjDIlMlgNCGAHXKc=\n=hday\n-----END PGP SIGNATURE-----\n", "payload": "tree e675da0a97f32d6a5f554b838b9b00bfb3be689f\nparent a5c3209374261b2589e7be4d19953fd14f268ccc\nparent fbad3b2468f46c14d0fd1283aa4935b3d79f007b\nauthor kennytm <kennytm@gmail.com> 1518596072 +0800\ncommitter GitHub <noreply@github.com> 1518596072 +0800\n\nRollup merge of #48065 - Xaeroxe:patch-1, r=alexcrichton\n\nApply optimization from #44355 to retain\n\nAs discussed in #44355 this PR applies a similar optimization to `Vec::retain`.  For `drain_filter`, a very similar function, this improved performance by up to 20%.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3715f1e490e187c3635ef241104bd5abe119958b", "html_url": "https://github.com/rust-lang/rust/commit/3715f1e490e187c3635ef241104bd5abe119958b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3715f1e490e187c3635ef241104bd5abe119958b/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5c3209374261b2589e7be4d19953fd14f268ccc", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5c3209374261b2589e7be4d19953fd14f268ccc", "html_url": "https://github.com/rust-lang/rust/commit/a5c3209374261b2589e7be4d19953fd14f268ccc"}, {"sha": "fbad3b2468f46c14d0fd1283aa4935b3d79f007b", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbad3b2468f46c14d0fd1283aa4935b3d79f007b", "html_url": "https://github.com/rust-lang/rust/commit/fbad3b2468f46c14d0fd1283aa4935b3d79f007b"}], "stats": {"total": 17, "additions": 1, "deletions": 16}, "files": [{"sha": "5c7f8ef73217f62141e5afb84998a98b4db0b0cc", "filename": "src/liballoc/vec.rs", "status": "modified", "additions": 1, "deletions": 16, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/3715f1e490e187c3635ef241104bd5abe119958b/src%2Fliballoc%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3715f1e490e187c3635ef241104bd5abe119958b/src%2Fliballoc%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fvec.rs?ref=3715f1e490e187c3635ef241104bd5abe119958b", "patch": "@@ -805,22 +805,7 @@ impl<T> Vec<T> {\n     pub fn retain<F>(&mut self, mut f: F)\n         where F: FnMut(&T) -> bool\n     {\n-        let len = self.len();\n-        let mut del = 0;\n-        {\n-            let v = &mut **self;\n-\n-            for i in 0..len {\n-                if !f(&v[i]) {\n-                    del += 1;\n-                } else if del > 0 {\n-                    v.swap(i - del, i);\n-                }\n-            }\n-        }\n-        if del > 0 {\n-            self.truncate(len - del);\n-        }\n+        self.drain_filter(|x| !f(x));\n     }\n \n     /// Removes all but the first of consecutive elements in the vector that resolve to the same"}]}