{"sha": "a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3ODNkMmExYmFmN2I0YTMzYzZkNGEwNDg2MDk5OGEyYWY1ZTFkOWE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-22T13:04:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-22T13:04:16Z"}, "message": "Merge #4983\n\n4983: Add paths::RelPath[Buf] r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "0af9a258328a702193086136ea15dd337d12a0bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0af9a258328a702193086136ea15dd337d12a0bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe8KxQCRBK7hj4Ov3rIwAAdHIIAEAEvuHWeWs9gMV8kK5VKe+Z\n/+B3kfMnJOUma4A1BmQDsboTV7cKKdzCg5rB4ZHFZJp1F0k+JK4vg02q3F30HLkd\n2SZMAfhruzZS4IRA/ElzYTzoIz2FnqwICJZ7J/bNYOrJ71PnkrTUq2ocxIFPpvlX\naDqaLByn0uaVuVc5CctydsmgsoN5IJ8wmF7j7x+5GtbLy8gqmIsNGIfhxt0+37H2\nhPHxx5YQLAdZOhMlefxNQ8slUQljX3dchsDsuOrdZG4eKQOGlwtizhlpQ1FOAr94\nJAD/9g7SlUPM4Iugpb2ht4Z0GnmuAVfWggj9F38yMjB2KcV3L0U9g7Mm5BYmQEQ=\n=iP3w\n-----END PGP SIGNATURE-----\n", "payload": "tree 0af9a258328a702193086136ea15dd337d12a0bf\nparent d8842e89e9053b62c081d2995cbf43b8fd5c51b2\nparent 7c9f97ecb836e449d6d4e20b73c9697b2b63476e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1592831056 +0000\ncommitter GitHub <noreply@github.com> 1592831056 +0000\n\nMerge #4983\n\n4983: Add paths::RelPath[Buf] r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a", "html_url": "https://github.com/rust-lang/rust/commit/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8842e89e9053b62c081d2995cbf43b8fd5c51b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8842e89e9053b62c081d2995cbf43b8fd5c51b2", "html_url": "https://github.com/rust-lang/rust/commit/d8842e89e9053b62c081d2995cbf43b8fd5c51b2"}, {"sha": "7c9f97ecb836e449d6d4e20b73c9697b2b63476e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c9f97ecb836e449d6d4e20b73c9697b2b63476e", "html_url": "https://github.com/rust-lang/rust/commit/7c9f97ecb836e449d6d4e20b73c9697b2b63476e"}], "stats": {"total": 74, "additions": 74, "deletions": 0}, "files": [{"sha": "32267f2e6e3949bd810def80547cacc0ecde2a2e", "filename": "crates/paths/src/lib.rs", "status": "modified", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a/crates%2Fpaths%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a/crates%2Fpaths%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fpaths%2Fsrc%2Flib.rs?ref=a783d2a1baf7b4a33c6d4a04860998a2af5e1d9a", "patch": "@@ -95,6 +95,80 @@ impl AbsPath {\n     pub fn normalize(&self) -> AbsPathBuf {\n         AbsPathBuf(normalize_path(&self.0))\n     }\n+    pub fn to_path_buf(&self) -> AbsPathBuf {\n+        AbsPathBuf::try_from(self.0.to_path_buf()).unwrap()\n+    }\n+    pub fn strip_prefix(&self, base: &AbsPath) -> Option<&RelPath> {\n+        self.0.strip_prefix(base).ok().map(RelPath::new_unchecked)\n+    }\n+}\n+\n+#[derive(Debug, Clone, Ord, PartialOrd, Eq, PartialEq, Hash)]\n+pub struct RelPathBuf(PathBuf);\n+\n+impl From<RelPathBuf> for PathBuf {\n+    fn from(RelPathBuf(path_buf): RelPathBuf) -> PathBuf {\n+        path_buf\n+    }\n+}\n+\n+impl ops::Deref for RelPathBuf {\n+    type Target = RelPath;\n+    fn deref(&self) -> &RelPath {\n+        self.as_path()\n+    }\n+}\n+\n+impl AsRef<Path> for RelPathBuf {\n+    fn as_ref(&self) -> &Path {\n+        self.0.as_path()\n+    }\n+}\n+\n+impl TryFrom<PathBuf> for RelPathBuf {\n+    type Error = PathBuf;\n+    fn try_from(path_buf: PathBuf) -> Result<RelPathBuf, PathBuf> {\n+        if !path_buf.is_relative() {\n+            return Err(path_buf);\n+        }\n+        Ok(RelPathBuf(path_buf))\n+    }\n+}\n+\n+impl TryFrom<&str> for RelPathBuf {\n+    type Error = PathBuf;\n+    fn try_from(path: &str) -> Result<RelPathBuf, PathBuf> {\n+        RelPathBuf::try_from(PathBuf::from(path))\n+    }\n+}\n+\n+impl RelPathBuf {\n+    pub fn as_path(&self) -> &RelPath {\n+        RelPath::new_unchecked(self.0.as_path())\n+    }\n+}\n+\n+#[derive(Debug, Ord, PartialOrd, Eq, PartialEq, Hash)]\n+#[repr(transparent)]\n+pub struct RelPath(Path);\n+\n+impl ops::Deref for RelPath {\n+    type Target = Path;\n+    fn deref(&self) -> &Path {\n+        &self.0\n+    }\n+}\n+\n+impl AsRef<Path> for RelPath {\n+    fn as_ref(&self) -> &Path {\n+        &self.0\n+    }\n+}\n+\n+impl RelPath {\n+    pub fn new_unchecked(path: &Path) -> &RelPath {\n+        unsafe { &*(path as *const Path as *const RelPath) }\n+    }\n }\n \n // https://github.com/rust-lang/cargo/blob/79c769c3d7b4c2cf6a93781575b7f592ef974255/src/cargo/util/paths.rs#L60-L85"}]}