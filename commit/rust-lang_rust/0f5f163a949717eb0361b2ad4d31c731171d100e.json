{"sha": "0f5f163a949717eb0361b2ad4d31c731171d100e", "node_id": "C_kwDOAAsO6NoAKDBmNWYxNjNhOTQ5NzE3ZWIwMzYxYjJhZDRkMzFjNzMxMTcxZDEwMGU", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-12-11T01:57:56Z"}, "committer": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-12-11T02:55:16Z"}, "message": "Add some regression tests for #44454\n\nSigned-off-by: Yuki Okushi <jtitor@2k36.org>", "tree": {"sha": "1bedabf6540dedb5bd2995ebd0f0d96ac005a567", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1bedabf6540dedb5bd2995ebd0f0d96ac005a567"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f5f163a949717eb0361b2ad4d31c731171d100e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN SSH SIGNATURE-----\nU1NIU0lHAAAAAQAAADMAAAALc3NoLWVkMjU1MTkAAAAgHhkVL0/9C9iZr1PMss4Lz7KmAH\nPO6dU/JqcK/z29OHQAAAADZ2l0AAAAAAAAAAZzaGE1MTIAAABTAAAAC3NzaC1lZDI1NTE5\nAAAAQI9tqmnRF4ONc7npANGbh63Os5ab93YnRCNkME3lkOeoBTx31fqeuaWwxALDWNAV6d\nuMskPY59A2CY2x3RRU9w8=\n-----END SSH SIGNATURE-----", "payload": "tree 1bedabf6540dedb5bd2995ebd0f0d96ac005a567\nparent c6fcdb690609769a240fc8ab0de0ce68d5ea7dba\nauthor Yuki Okushi <jtitor@2k36.org> 1670723876 +0900\ncommitter Yuki Okushi <jtitor@2k36.org> 1670727316 +0900\n\nAdd some regression tests for #44454\n\nSigned-off-by: Yuki Okushi <jtitor@2k36.org>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f5f163a949717eb0361b2ad4d31c731171d100e", "html_url": "https://github.com/rust-lang/rust/commit/0f5f163a949717eb0361b2ad4d31c731171d100e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f5f163a949717eb0361b2ad4d31c731171d100e/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6fcdb690609769a240fc8ab0de0ce68d5ea7dba", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6fcdb690609769a240fc8ab0de0ce68d5ea7dba", "html_url": "https://github.com/rust-lang/rust/commit/c6fcdb690609769a240fc8ab0de0ce68d5ea7dba"}], "stats": {"total": 115, "additions": 115, "deletions": 0}, "files": [{"sha": "bbaf3188a8963bd4735aa1c7ae115df660675a1e", "filename": "src/test/ui/traits/object/issue-44454-1.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.rs?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,22 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issue-256435333\n+\n+trait Animal<X>: 'static {}\n+\n+fn foo<Y, X>()\n+where\n+    Y: Animal<X> + ?Sized,\n+{\n+    // `Y` implements `Animal<X>` so `Y` is 'static.\n+    baz::<Y>()\n+}\n+\n+fn bar<'a>(_arg: &'a i32) {\n+    foo::<dyn Animal<&'a i32>, &'a i32>() //~ ERROR: lifetime may not live long enough\n+}\n+\n+fn baz<T: 'static + ?Sized>() {}\n+\n+fn main() {\n+    let a = 5;\n+    bar(&a);\n+}"}, {"sha": "859487f50ac1ec6373edecfe9a10738332f55c8b", "filename": "src/test/ui/traits/object/issue-44454-1.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-1.stderr?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,10 @@\n+error: lifetime may not live long enough\n+  --> $DIR/issue-44454-1.rs:14:5\n+   |\n+LL | fn bar<'a>(_arg: &'a i32) {\n+   |        -- lifetime `'a` defined here\n+LL |     foo::<dyn Animal<&'a i32>, &'a i32>()\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+"}, {"sha": "f5178bcdbe224011b134946f9120d52ce40dbcad", "filename": "src/test/ui/traits/object/issue-44454-2.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.rs?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,22 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issuecomment-1175925928\n+\n+trait Trait<ARG: 'static>: 'static {\n+    type Assoc: AsRef<str>;\n+}\n+\n+fn hr<T: ?Sized, ARG>(x: T::Assoc) -> Box<dyn AsRef<str> + 'static>\n+where\n+    T: Trait<ARG>\n+{\n+    Box::new(x)\n+}\n+\n+fn extend_lt<'a>(x: &'a str) -> Box<dyn AsRef<str> + 'static> {\n+    type DynTrait = dyn for<'a> Trait<&'a str, Assoc = &'a str>;\n+    hr::<DynTrait, _>(x) //~ ERROR: borrowed data escapes outside of function\n+}\n+\n+fn main() {\n+    let extended = extend_lt(&String::from(\"hello\"));\n+    println!(\"{}\", extended.as_ref().as_ref());\n+}"}, {"sha": "7f574769b7f60ed39aa0f4779f09a94c0aba12f3", "filename": "src/test/ui/traits/object/issue-44454-2.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-2.stderr?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,17 @@\n+error[E0521]: borrowed data escapes outside of function\n+  --> $DIR/issue-44454-2.rs:16:5\n+   |\n+LL | fn extend_lt<'a>(x: &'a str) -> Box<dyn AsRef<str> + 'static> {\n+   |              --  - `x` is a reference that is only valid in the function body\n+   |              |\n+   |              lifetime `'a` defined here\n+LL |     type DynTrait = dyn for<'a> Trait<&'a str, Assoc = &'a str>;\n+LL |     hr::<DynTrait, _>(x)\n+   |     ^^^^^^^^^^^^^^^^^^^^\n+   |     |\n+   |     `x` escapes the function body here\n+   |     argument requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0521`."}, {"sha": "bff727035346405c006b9365637a671359b7b3e0", "filename": "src/test/ui/traits/object/issue-44454-3.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.rs?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,33 @@\n+// Taken from https://github.com/rust-lang/rust/issues/44454#issuecomment-1332781290\n+\n+use std::any::Any;\n+\n+trait Animal<X>: 'static {}\n+\n+trait Projector {\n+    type Foo;\n+}\n+\n+impl<X> Projector for dyn Animal<X> {\n+    type Foo = X;\n+}\n+\n+fn make_static<'a, T>(t: &'a T) -> &'static T {\n+    let x: <dyn Animal<&'a T> as Projector>::Foo = t;\n+    let any = generic::<dyn Animal<&'a T>, &'a T>(x);\n+    //~^ ERROR: lifetime may not live long enough\n+    any.downcast_ref::<&'static T>().unwrap()\n+}\n+\n+fn generic<T: Projector + Animal<U> + ?Sized, U>(x: <T as Projector>::Foo) -> Box<dyn Any> {\n+    make_static_any(x)\n+}\n+\n+fn make_static_any<U: 'static>(u: U) -> Box<dyn Any> {\n+    Box::new(u)\n+}\n+\n+fn main() {\n+    let a = make_static(&\"salut\".to_string());\n+    println!(\"{}\", *a);\n+}"}, {"sha": "294684d26bdfc8defe8e4a565d6fe414eb2e58d5", "filename": "src/test/ui/traits/object/issue-44454-3.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0f5f163a949717eb0361b2ad4d31c731171d100e/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fobject%2Fissue-44454-3.stderr?ref=0f5f163a949717eb0361b2ad4d31c731171d100e", "patch": "@@ -0,0 +1,11 @@\n+error: lifetime may not live long enough\n+  --> $DIR/issue-44454-3.rs:17:15\n+   |\n+LL | fn make_static<'a, T>(t: &'a T) -> &'static T {\n+   |                -- lifetime `'a` defined here\n+LL |     let x: <dyn Animal<&'a T> as Projector>::Foo = t;\n+LL |     let any = generic::<dyn Animal<&'a T>, &'a T>(x);\n+   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ requires that `'a` must outlive `'static`\n+\n+error: aborting due to previous error\n+"}]}