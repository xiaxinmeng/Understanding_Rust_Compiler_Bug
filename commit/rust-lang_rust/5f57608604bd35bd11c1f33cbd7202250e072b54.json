{"sha": "5f57608604bd35bd11c1f33cbd7202250e072b54", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmNTc2MDg2MDRiZDM1YmQxMWMxZjMzY2JkNzIwMjI1MGUwNzJiNTQ=", "commit": {"author": {"name": "Aleksei Latyshev", "email": "alex_700_95@mail.ru", "date": "2020-11-06T11:38:46Z"}, "committer": {"name": "Aleksei Latyshev", "email": "alex_700_95@mail.ru", "date": "2020-11-06T11:38:46Z"}, "message": "do not trigger map_clone in the case of &mut", "tree": {"sha": "53368092e0b2a73ea2aa23539358abbf7bdd9870", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53368092e0b2a73ea2aa23539358abbf7bdd9870"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f57608604bd35bd11c1f33cbd7202250e072b54", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEopQOAF0V9HUfAT+fRv3WL5zBFNsFAl+lNcYACgkQRv3WL5zB\nFNufRxAAo8xw79UhpdD8hkywbBUnBs1BnvS2QrszkIt2hfywFe13WsIwAT3CwvyI\n2vXUPH/WLfiBogsvmd541jWDeSXSwbvfMgRYRoW8b2LB1R3pxvWGVt5/9bPsmU9r\nZA9yXxueMKfiJUs9ZgPjHK9e5HpfAEx12HTCRb8Lc0kF44h/wQ8Yu7d5JdOnwea7\nOj5SaUuotsyOJlfeMy+qGjFGikTQ/b6v74wDtnNG8MjUTS7i/SDoygWHKmxS1BU6\nhmpikKe538U2w2se7ZwXYKqwHv3Ly9p7RySgWi5fVt2Qi23qkg385UIk9E5kDhAW\n/D3IE2oPSN3bzMRYvhO9daLxEArsepM508NARwBqSjWY8ANeaTM8O483LR3toG8b\nzcDVerH7CYO1+a1gAEzBdghVD3tT2do44V0q1Al8PvSd4SJ9kpzFus9Xe6vhtIFA\nTcPZQDG4c/PfDnWU9xAohoN6+aqXFz+JfbW50fWu9Gp7AUFi4jO6oBsrE3QwZjBw\n6Pn/GM+1CVFva5Zudu2aWjqGsBzIqnlO0/NF8t7J7hHNf/f+Kwd9tiZH2GD5Go5L\njEZ21nU9a6Jy576fAixlYJRMdqoT2Tj2WzveKIzpoj3vJlXCN/2KAByORV0ZZLmC\n2G3wZcCh5qsGRYZhu3q/a1F5uiJ1c4p72QjKzDSd7x5I2/tO7Hs=\n=NHOK\n-----END PGP SIGNATURE-----", "payload": "tree 53368092e0b2a73ea2aa23539358abbf7bdd9870\nparent b20d4c155d2fe3a8391f86dcf9a8c49e17188703\nauthor Aleksei Latyshev <alex_700_95@mail.ru> 1604662726 +0300\ncommitter Aleksei Latyshev <alex_700_95@mail.ru> 1604662726 +0300\n\ndo not trigger map_clone in the case of &mut\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f57608604bd35bd11c1f33cbd7202250e072b54", "html_url": "https://github.com/rust-lang/rust/commit/5f57608604bd35bd11c1f33cbd7202250e072b54", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f57608604bd35bd11c1f33cbd7202250e072b54/comments", "author": {"login": "alex-700", "id": 8705888, "node_id": "MDQ6VXNlcjg3MDU4ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/8705888?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex-700", "html_url": "https://github.com/alex-700", "followers_url": "https://api.github.com/users/alex-700/followers", "following_url": "https://api.github.com/users/alex-700/following{/other_user}", "gists_url": "https://api.github.com/users/alex-700/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex-700/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex-700/subscriptions", "organizations_url": "https://api.github.com/users/alex-700/orgs", "repos_url": "https://api.github.com/users/alex-700/repos", "events_url": "https://api.github.com/users/alex-700/events{/privacy}", "received_events_url": "https://api.github.com/users/alex-700/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alex-700", "id": 8705888, "node_id": "MDQ6VXNlcjg3MDU4ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/8705888?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex-700", "html_url": "https://github.com/alex-700", "followers_url": "https://api.github.com/users/alex-700/followers", "following_url": "https://api.github.com/users/alex-700/following{/other_user}", "gists_url": "https://api.github.com/users/alex-700/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex-700/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex-700/subscriptions", "organizations_url": "https://api.github.com/users/alex-700/orgs", "repos_url": "https://api.github.com/users/alex-700/repos", "events_url": "https://api.github.com/users/alex-700/events{/privacy}", "received_events_url": "https://api.github.com/users/alex-700/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b20d4c155d2fe3a8391f86dcf9a8c49e17188703", "url": "https://api.github.com/repos/rust-lang/rust/commits/b20d4c155d2fe3a8391f86dcf9a8c49e17188703", "html_url": "https://github.com/rust-lang/rust/commit/b20d4c155d2fe3a8391f86dcf9a8c49e17188703"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "9a00608ce3947842bfcf0a1657da3d2b1774c18f", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5f57608604bd35bd11c1f33cbd7202250e072b54/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f57608604bd35bd11c1f33cbd7202250e072b54/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=5f57608604bd35bd11c1f33cbd7202250e072b54", "patch": "@@ -80,9 +80,11 @@ impl<'tcx> LateLintPass<'tcx> for MapClone {\n                                     && match_trait_method(cx, closure_expr, &paths::CLONE_TRAIT) {\n \n                                     let obj_ty = cx.typeck_results().expr_ty(&obj[0]);\n-                                    if let ty::Ref(_, ty, _) = obj_ty.kind() {\n-                                        let copy = is_copy(cx, ty);\n-                                        lint(cx, e.span, args[0].span, copy);\n+                                    if let ty::Ref(_, ty, mutability) = obj_ty.kind() {\n+                                        if matches!(mutability, Mutability::Not) {\n+                                            let copy = is_copy(cx, ty);\n+                                            lint(cx, e.span, args[0].span, copy);\n+                                        }\n                                     } else {\n                                         lint_needless_cloning(cx, e.span, args[0].span);\n                                     }"}, {"sha": "6e3a8e67e811ebeb5cf99f4add616fcf816dd516", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5f57608604bd35bd11c1f33cbd7202250e072b54/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/5f57608604bd35bd11c1f33cbd7202250e072b54/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=5f57608604bd35bd11c1f33cbd7202250e072b54", "patch": "@@ -44,4 +44,12 @@ fn main() {\n         let v = vec![&mut d];\n         let _: Vec<u32> = v.into_iter().map(|&mut x| x).collect();\n     }\n+\n+    // Issue #6299\n+    {\n+        let mut aa = 5;\n+        let mut bb = 3;\n+        let items = vec![&mut aa, &mut bb];\n+        let _: Vec<_> = items.into_iter().map(|x| x.clone()).collect();\n+    }\n }"}, {"sha": "6fd395710d4ba9d91ec44cb8b92666435eac78be", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5f57608604bd35bd11c1f33cbd7202250e072b54/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f57608604bd35bd11c1f33cbd7202250e072b54/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=5f57608604bd35bd11c1f33cbd7202250e072b54", "patch": "@@ -44,4 +44,12 @@ fn main() {\n         let v = vec![&mut d];\n         let _: Vec<u32> = v.into_iter().map(|&mut x| x).collect();\n     }\n+\n+    // Issue #6299\n+    {\n+        let mut aa = 5;\n+        let mut bb = 3;\n+        let items = vec![&mut aa, &mut bb];\n+        let _: Vec<_> = items.into_iter().map(|x| x.clone()).collect();\n+    }\n }"}]}