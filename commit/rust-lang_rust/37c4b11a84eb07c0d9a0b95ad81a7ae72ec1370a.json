{"sha": "37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3YzRiMTFhODRlYjA3YzBkOWEwYjk1YWQ4MWE3YWU3MmVjMTM3MGE=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-03-04T21:33:22Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-03-04T21:33:35Z"}, "message": "lintcheck: add test", "tree": {"sha": "12350d3d6d6f35c6e5aff8645bebe0c7e1a1254c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12350d3d6d6f35c6e5aff8645bebe0c7e1a1254c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "html_url": "https://github.com/rust-lang/rust/commit/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7be3a32f25f514fa376cfbdfd6e89d77d0dd350e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7be3a32f25f514fa376cfbdfd6e89d77d0dd350e", "html_url": "https://github.com/rust-lang/rust/commit/7be3a32f25f514fa376cfbdfd6e89d77d0dd350e"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "01f3c9a5bd8a23ec4ff73d519bbc12f49fcf2c83", "filename": "clippy_dev/src/lintcheck.rs", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a/clippy_dev%2Fsrc%2Flintcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a/clippy_dev%2Fsrc%2Flintcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flintcheck.rs?ref=37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "patch": "@@ -503,6 +503,10 @@ fn gather_stats(clippy_warnings: &[ClippyWarning]) -> (String, HashMap<&String,\n /// check if the latest modification of the logfile is older than the modification date of the\n /// clippy binary, if this is true, we should clean the lintchec shared target directory and recheck\n fn lintcheck_needs_rerun(lintcheck_logs_path: &Path) -> bool {\n+    if !lintcheck_logs_path.exists() {\n+        return true;\n+    }\n+\n     let clippy_modified: std::time::SystemTime = {\n         let mut times = [CLIPPY_DRIVER_PATH, CARGO_CLIPPY_PATH].iter().map(|p| {\n             std::fs::metadata(p)\n@@ -665,7 +669,6 @@ fn read_stats_from_file(file_path: &Path) -> HashMap<String, usize> {\n     let file_content: String = match std::fs::read_to_string(file_path).ok() {\n         Some(content) => content,\n         None => {\n-            eprintln!(\"RETURND\");\n             return HashMap::new();\n         },\n     };\n@@ -734,3 +737,30 @@ fn print_stats(old_stats: HashMap<String, usize>, new_stats: HashMap<&String, us\n             println!(\"{} {} => 0\", old_key, old_value);\n         });\n }\n+\n+#[test]\n+fn lintcheck_test() {\n+    let args = [\n+        \"run\",\n+        \"--target-dir\",\n+        \"clippy_dev/target\",\n+        \"--package\",\n+        \"clippy_dev\",\n+        \"--bin\",\n+        \"clippy_dev\",\n+        \"--manifest-path\",\n+        \"clippy_dev/Cargo.toml\",\n+        \"--features\",\n+        \"lintcheck\",\n+        \"--\",\n+        \"lintcheck\",\n+        \"--crates-toml\",\n+        \"clippy_dev/test_sources.toml\",\n+    ];\n+    let status = std::process::Command::new(\"cargo\")\n+        .args(&args)\n+        .current_dir(\"../\" /* repo root */)\n+        .status();\n+\n+    assert!(status.unwrap().success());\n+}"}, {"sha": "4b0eb71ef4bfe1fa01c103e0c3e8be283ba18b1e", "filename": "clippy_dev/test_sources.toml", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a/clippy_dev%2Ftest_sources.toml", "raw_url": "https://github.com/rust-lang/rust/raw/37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a/clippy_dev%2Ftest_sources.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Ftest_sources.toml?ref=37c4b11a84eb07c0d9a0b95ad81a7ae72ec1370a", "patch": "@@ -0,0 +1,4 @@\n+[crates]\n+cc = {name = \"cc\", versions = ['1.0.67']}\n+home = {name = \"home\", git_url = \"https://github.com/brson/home\", git_hash = \"32044e53dfbdcd32bafad3109d1fbab805fc0f40\"}\n+rustc_tools_util = {name = \"rustc_tools_util\", versions = ['0.2.0']}"}]}