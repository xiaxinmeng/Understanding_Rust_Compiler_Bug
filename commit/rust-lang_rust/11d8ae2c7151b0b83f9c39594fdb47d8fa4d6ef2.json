{"sha": "11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2", "node_id": "C_kwDOAAsO6NoAKDExZDhhZTJjNzE1MWIwYjgzZjljMzk1OTRmZGI0N2Q4ZmE0ZDZlZjI", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-06-11T10:59:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-11T10:59:26Z"}, "message": "Rollup merge of #97761 - RalfJung:vtable-validation, r=cjgillot\n\nvalidating the vtable can lead to Stacked Borrows errors\n\nFixes https://github.com/rust-lang/miri/issues/2123", "tree": {"sha": "83d418f85e8ad21541bb4f3553964521e239c553", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83d418f85e8ad21541bb4f3553964521e239c553"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJipHWPCRBK7hj4Ov3rIwAAX2oIAIUj9L9BOqPy5vU2Q8gOpoc2\nCfrXGjRSVXlRyUnqhp2UUUI5KWKCwTgAweBlNr6lyJdb4FLNfP4q93Ncv4t4MEG1\nM2/UF6jU9nj7RT0TZMS0OedbMqztvsBlO8Sy73d5uNy7swLF/zkI8zPYIdPBgCLh\nEoKmlv1qt+yUTb4vR+27QgoaHRdJ3gmyTXX/btwLzTKKVYfQdyW6MkNudhwGH6qT\nUHt3X748ig76ZmRFSQ3a/n5s8VSHol0/YHlRkhGszEbWJ+UPJe4wEhSjHiuvHwQz\nkMMd3QyStmmORXRYEqzKoBEoRmOgnWV+Si1pGG5s6SkWSVyl4Qid+7tvavc8z58=\n=xAlJ\n-----END PGP SIGNATURE-----\n", "payload": "tree 83d418f85e8ad21541bb4f3553964521e239c553\nparent 7092d42c04a56378d2e748f98169b728b1f1d5d1\nparent 67ec96955f4a08c1005bda843d48ca73ea171c9e\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1654945166 +0200\ncommitter GitHub <noreply@github.com> 1654945166 +0200\n\nRollup merge of #97761 - RalfJung:vtable-validation, r=cjgillot\n\nvalidating the vtable can lead to Stacked Borrows errors\n\nFixes https://github.com/rust-lang/miri/issues/2123\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2", "html_url": "https://github.com/rust-lang/rust/commit/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7092d42c04a56378d2e748f98169b728b1f1d5d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/7092d42c04a56378d2e748f98169b728b1f1d5d1", "html_url": "https://github.com/rust-lang/rust/commit/7092d42c04a56378d2e748f98169b728b1f1d5d1"}, {"sha": "67ec96955f4a08c1005bda843d48ca73ea171c9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/67ec96955f4a08c1005bda843d48ca73ea171c9e", "html_url": "https://github.com/rust-lang/rust/commit/67ec96955f4a08c1005bda843d48ca73ea171c9e"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "630281bb09254ec90b401737ed88c94970e72898", "filename": "compiler/rustc_const_eval/src/interpret/validity.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fvalidity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fvalidity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fvalidity.rs?ref=11d8ae2c7151b0b83f9c39594fdb47d8fa4d6ef2", "patch": "@@ -338,6 +338,10 @@ impl<'rt, 'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> ValidityVisitor<'rt, 'mir, '\n                         { \"invalid drop function pointer in vtable (not pointing to a function)\" },\n                     err_ub!(InvalidVtableDropFn(..)) =>\n                         { \"invalid drop function pointer in vtable (function has incompatible signature)\" },\n+                    // Stacked Borrows errors can happen here, see https://github.com/rust-lang/miri/issues/2123.\n+                    // (We assume there are no other MachineStop errors possible here.)\n+                    InterpError::MachineStop(_) =>\n+                        { \"vtable pointer does not have permission to read drop function pointer\" },\n                 );\n                 try_validation!(\n                     self.ecx.read_size_and_align_from_vtable(vtable),\n@@ -347,6 +351,10 @@ impl<'rt, 'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> ValidityVisitor<'rt, 'mir, '\n                     err_ub!(InvalidVtableAlignment(msg)) =>\n                         { \"invalid vtable: alignment {}\", msg },\n                     err_unsup!(ReadPointerAsBytes) => { \"invalid size or align in vtable\" },\n+                    // Stacked Borrows errors can happen here, see https://github.com/rust-lang/miri/issues/2123.\n+                    // (We assume there are no other MachineStop errors possible here.)\n+                    InterpError::MachineStop(_) =>\n+                        { \"vtable pointer does not have permission to read size and alignment\" },\n                 );\n                 // FIXME: More checks for the vtable.\n             }"}]}