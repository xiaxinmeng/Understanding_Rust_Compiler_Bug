{"sha": "859d467276bf45e621858069192d7a68c42d2a32", "node_id": "C_kwDOAAsO6NoAKDg1OWQ0NjcyNzZiZjQ1ZTYyMTg1ODA2OTE5MmQ3YTY4YzQyZDJhMzI", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-08-04T17:51:38Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-08-04T17:58:16Z"}, "message": "fix: make `concat!` work with char", "tree": {"sha": "a272d964c9505f2a19d9073379b489949e36e13c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a272d964c9505f2a19d9073379b489949e36e13c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/859d467276bf45e621858069192d7a68c42d2a32", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmLsCLgACgkQ4laYqTBY\nYXHCrhAAmXmpRdCUBLGtOU2fypY1T0m7q4HEGz3nvGSw/NtODeMaNA4WXDLG90ZB\nFfewD8LOotBAFtmaLPRfV42mzuEwdIe+AMVeYBB83EysXwXU77uUl+L51VoSUCXh\nSijf6pA9kCSbcpmYFC+yHnRbLwnOB+Kg3/YVAeSw6M4MvUupewHbVOR4Mm3CZWhc\n18qE1eViKGkz9QTOmOfajPlGNTLsnkfbdQs4bpz5wtIYHo+MbEbDHeNCFQkj2wda\nR8Ao5swW+ydzGeUKy4i+eAB+XDhKJ7qpL4UMBXf6PlSS68PUVGA7vQ86Py39n2l3\nRgaBmGbZu2qOsx0CeccIy0eO+X3mfwClFDbkmixghID8f81VNfqs95NIF81Bjl/8\n2Gu8BAWw/CHq2J1xXYyzLJi+1uHwJqvARQunrsIrLCdruKH2F+kpIi5W+4qpBH9F\nqdvfE2/J1kJbvs9oMoKDooInA3rALZtLzHavvjYaAjl5/Ra/qKwVO/Yiy63gQYFn\nyqkPs8I9ZTy1k5FfwF3PAJZEUT4mG4lH1K0jmZWvYbEx/Q6zhPoe+8rs3bD0Ao+0\nD1Ky3seB+cRwtF4S1P1EqD2dUNEnysSi1MvC7XDIsMZhDHJ+YrYNJvqVwU0mps/S\ndDakcqSpJiT1CmballgKD4SyvfIVkyE1GHF7LdqBWh+Fn7/NAs8=\n=91th\n-----END PGP SIGNATURE-----", "payload": "tree a272d964c9505f2a19d9073379b489949e36e13c\nparent 1c03f45c08145be5b1ecd40aa1f28a12c615d63a\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1659635498 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1659635896 +0900\n\nfix: make `concat!` work with char\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/859d467276bf45e621858069192d7a68c42d2a32", "html_url": "https://github.com/rust-lang/rust/commit/859d467276bf45e621858069192d7a68c42d2a32", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/859d467276bf45e621858069192d7a68c42d2a32/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c03f45c08145be5b1ecd40aa1f28a12c615d63a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c03f45c08145be5b1ecd40aa1f28a12c615d63a", "html_url": "https://github.com/rust-lang/rust/commit/1c03f45c08145be5b1ecd40aa1f28a12c615d63a"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "32006c4b43e1998b703e12436de59b8af9fb245b", "filename": "crates/hir-def/src/macro_expansion_tests/builtin_fn_macro.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/859d467276bf45e621858069192d7a68c42d2a32/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/859d467276bf45e621858069192d7a68c42d2a32/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin_fn_macro.rs?ref=859d467276bf45e621858069192d7a68c42d2a32", "patch": "@@ -295,13 +295,13 @@ fn test_concat_expand() {\n #[rustc_builtin_macro]\n macro_rules! concat {}\n \n-fn main() { concat!(\"foo\", \"r\", 0, r#\"bar\"#, \"\\n\", false); }\n+fn main() { concat!(\"foo\", \"r\", 0, r#\"bar\"#, \"\\n\", false, '\\n'); }\n \"##,\n         expect![[r##\"\n #[rustc_builtin_macro]\n macro_rules! concat {}\n \n-fn main() { \"foor0bar\\nfalse\"; }\n+fn main() { \"foor0bar\\nfalse\\n\"; }\n \"##]],\n     );\n }"}, {"sha": "c21b35cdc0917eb6be6c20d5032e74d3bf042516", "filename": "crates/hir-expand/src/builtin_fn_macro.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/859d467276bf45e621858069192d7a68c42d2a32/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/859d467276bf45e621858069192d7a68c42d2a32/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-expand%2Fsrc%2Fbuiltin_fn_macro.rs?ref=859d467276bf45e621858069192d7a68c42d2a32", "patch": "@@ -357,6 +357,12 @@ fn unquote_str(lit: &tt::Literal) -> Option<String> {\n     token.value().map(|it| it.into_owned())\n }\n \n+fn unquote_char(lit: &tt::Literal) -> Option<char> {\n+    let lit = ast::make::tokens::literal(&lit.to_string());\n+    let token = ast::Char::cast(lit)?;\n+    token.value()\n+}\n+\n fn unquote_byte_string(lit: &tt::Literal) -> Option<Vec<u8>> {\n     let lit = ast::make::tokens::literal(&lit.to_string());\n     let token = ast::ByteString::cast(lit)?;\n@@ -408,8 +414,12 @@ fn concat_expand(\n                 // concat works with string and char literals, so remove any quotes.\n                 // It also works with integer, float and boolean literals, so just use the rest\n                 // as-is.\n-                let component = unquote_str(it).unwrap_or_else(|| it.text.to_string());\n-                text.push_str(&component);\n+                if let Some(c) = unquote_char(it) {\n+                    text.push(c);\n+                } else {\n+                    let component = unquote_str(it).unwrap_or_else(|| it.text.to_string());\n+                    text.push_str(&component);\n+                }\n             }\n             // handle boolean literals\n             tt::TokenTree::Leaf(tt::Leaf::Ident(id))"}]}