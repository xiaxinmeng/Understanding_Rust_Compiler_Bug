{"sha": "bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "node_id": "C_kwDOAAsO6NoAKGJkNGQxY2Q3YTJlZGQ5OGE5MmI4NTk5NzgxMmU3MGFlZTVlNzQwYzc", "commit": {"author": {"name": "Christian Poveda", "email": "git@pvdrz.com", "date": "2022-05-31T16:22:26Z"}, "committer": {"name": "Christian Poveda", "email": "git@pvdrz.com", "date": "2022-05-31T16:22:26Z"}, "message": "migrate `maybe_recover_from_bad_qpath_stage_2` diagnostic", "tree": {"sha": "1fdf64bf571207f0538567888268ba8c4589b095", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1fdf64bf571207f0538567888268ba8c4589b095"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQRsB8A/3NrzTlMMjT0nUl7150IKUAUCYpZAwgAKCRAnUl7150IK\nUD3FAQCqdJOKL1uYIYd439ILIVGTDbvFeGvQ+WukC7oEyi0FiQEAmh7UrtAHPvRN\nOfwysLywp/kfC26B/uDMSGXh2ZChvAE=\n=SM0X\n-----END PGP SIGNATURE-----", "payload": "tree 1fdf64bf571207f0538567888268ba8c4589b095\nparent 16a0d03698bfc9f93250490797f9a1a870f8bcfe\nauthor Christian Poveda <git@pvdrz.com> 1654014146 -0500\ncommitter Christian Poveda <git@pvdrz.com> 1654014146 -0500\n\nmigrate `maybe_recover_from_bad_qpath_stage_2` diagnostic\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "html_url": "https://github.com/rust-lang/rust/commit/bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd4d1cd7a2edd98a92b85997812e70aee5e740c7/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16a0d03698bfc9f93250490797f9a1a870f8bcfe", "url": "https://api.github.com/repos/rust-lang/rust/commits/16a0d03698bfc9f93250490797f9a1a870f8bcfe", "html_url": "https://github.com/rust-lang/rust/commit/16a0d03698bfc9f93250490797f9a1a870f8bcfe"}], "stats": {"total": 26, "additions": 17, "deletions": 9}, "files": [{"sha": "985173277e1701faea7bfaae66d5b2e0f1c4dac4", "filename": "compiler/rustc_error_messages/locales/en-US/parser.ftl", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bd4d1cd7a2edd98a92b85997812e70aee5e740c7/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/bd4d1cd7a2edd98a92b85997812e70aee5e740c7/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl?ref=bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "patch": "@@ -14,3 +14,7 @@ parser-add-paren = try adding parentheses\n parser-forgot-paren = perhaps you forgot parentheses?\n \n parser-expect-path = expected a path\n+\n+parser-maybe-recover-from-bad-qpath-stage-2 =\n+    missing angle brackets in associated item path\n+    .suggestion = try: `{$ty}`"}, {"sha": "f57338ae4dd6ed79c4073f12c80732298e2ec399", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/bd4d1cd7a2edd98a92b85997812e70aee5e740c7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd4d1cd7a2edd98a92b85997812e70aee5e740c7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=bd4d1cd7a2edd98a92b85997812e70aee5e740c7", "patch": "@@ -286,6 +286,15 @@ pub enum BadTypePlusSub {\n     },\n }\n \n+#[derive(SessionDiagnostic)]\n+#[error(slug = \"parser-maybe-recover-from-bad-qpath-stage-2\")]\n+struct BadQPathStage2 {\n+    #[primary_span]\n+    #[suggestion(applicability = \"maybe-incorrect\")]\n+    span: Span,\n+    ty: String,\n+}\n+\n // SnapshotParser is used to create a snapshot of the parser\n // without causing duplicate errors being emitted when the `Parser`\n // is dropped.\n@@ -1469,15 +1478,10 @@ impl<'a> Parser<'a> {\n         path.span = ty_span.to(self.prev_token.span);\n \n         let ty_str = self.span_to_snippet(ty_span).unwrap_or_else(|_| pprust::ty_to_string(&ty));\n-        self.struct_span_err(path.span, \"missing angle brackets in associated item path\")\n-            .span_suggestion(\n-                // This is a best-effort recovery.\n-                path.span,\n-                \"try\",\n-                format!(\"<{}>::{}\", ty_str, pprust::path_to_string(&path)),\n-                Applicability::MaybeIncorrect,\n-            )\n-            .emit();\n+        self.sess.emit_err(BadQPathStage2 {\n+            span: path.span,\n+            ty: format!(\"<{}>::{}\", ty_str, pprust::path_to_string(&path)),\n+        });\n \n         let path_span = ty_span.shrink_to_hi(); // Use an empty path since `position == 0`.\n         Ok(P(T::recovered(Some(QSelf { ty, path_span, position: 0 }), path)))"}]}