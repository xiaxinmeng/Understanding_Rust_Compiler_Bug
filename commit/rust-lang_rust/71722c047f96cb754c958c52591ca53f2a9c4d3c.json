{"sha": "71722c047f96cb754c958c52591ca53f2a9c4d3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxNzIyYzA0N2Y5NmNiNzU0Yzk1OGM1MjU5MWNhNTNmMmE5YzRkM2M=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-26T09:51:45Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-26T09:51:45Z"}, "message": "Simple scope completion", "tree": {"sha": "981f344602900130acdae20509e5e0cb029f508b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/981f344602900130acdae20509e5e0cb029f508b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/71722c047f96cb754c958c52591ca53f2a9c4d3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/71722c047f96cb754c958c52591ca53f2a9c4d3c", "html_url": "https://github.com/rust-lang/rust/commit/71722c047f96cb754c958c52591ca53f2a9c4d3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/71722c047f96cb754c958c52591ca53f2a9c4d3c/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac226021cfd26a9332b5971f3e05118d77822af5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac226021cfd26a9332b5971f3e05118d77822af5", "html_url": "https://github.com/rust-lang/rust/commit/ac226021cfd26a9332b5971f3e05118d77822af5"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "aeed1955931373855c691ed52dbffbe7b8484488", "filename": "crates/libeditor/src/completion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Flibeditor%2Fsrc%2Fcompletion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Flibeditor%2Fsrc%2Fcompletion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibeditor%2Fsrc%2Fcompletion.rs?ref=71722c047f96cb754c958c52591ca53f2a9c4d3c", "patch": "@@ -14,7 +14,7 @@ use {\n \n #[derive(Debug)]\n pub struct CompletionItem {\n-    name: String,\n+    pub name: String,\n }\n \n pub fn scope_completion(file: &File, offset: TextUnit) -> Option<Vec<CompletionItem>> {"}, {"sha": "98499bb05ea1496eb136d8dcd8efa79f87ff7898", "filename": "crates/server/src/caps.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fcaps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fcaps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fcaps.rs?ref=71722c047f96cb754c958c52591ca53f2a9c4d3c", "patch": "@@ -4,6 +4,7 @@ use languageserver_types::{\n     TextDocumentSyncOptions,\n     TextDocumentSyncKind,\n     ExecuteCommandOptions,\n+    CompletionOptions,\n };\n \n pub fn server_capabilities() -> ServerCapabilities {\n@@ -18,7 +19,10 @@ pub fn server_capabilities() -> ServerCapabilities {\n             }\n         )),\n         hover_provider: None,\n-        completion_provider: None,\n+        completion_provider: Some(CompletionOptions {\n+            resolve_provider: None,\n+            trigger_characters: None,\n+        }),\n         signature_help_provider: None,\n         definition_provider: Some(true),\n         type_definition_provider: None,"}, {"sha": "e7ac53028aeb6b3a824ab8d823dd49803899bfaf", "filename": "crates/server/src/main_loop/handlers.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=71722c047f96cb754c958c52591ca53f2a9c4d3c", "patch": "@@ -4,6 +4,7 @@ use languageserver_types::{\n     Diagnostic, DiagnosticSeverity, Url, DocumentSymbol,\n     Command, TextDocumentIdentifier, WorkspaceEdit,\n     SymbolInformation, Position, Location, TextEdit,\n+    CompletionItem,\n };\n use serde_json::{to_value, from_value};\n use libanalysis::{Query};\n@@ -259,6 +260,28 @@ pub fn handle_parent_module(\n     Ok(res)\n }\n \n+pub fn handle_completion(\n+    world: ServerWorld,\n+    params: req::CompletionParams,\n+) -> Result<Option<req::CompletionResponse>> {\n+    let file_id = params.text_document.try_conv_with(&world)?;\n+    let file = world.analysis().file_syntax(file_id)?;\n+    let line_index = world.analysis().file_line_index(file_id)?;\n+    let offset = params.position.conv_with(&line_index);\n+    let items = match libeditor::scope_completion(&file, offset) {\n+        None => return Ok(None),\n+        Some(items) => items,\n+    };\n+    let items = items.into_iter()\n+        .map(|item| CompletionItem {\n+            label: item.name,\n+            .. Default::default()\n+        })\n+        .collect();\n+\n+    Ok(Some(req::CompletionResponse::Array(items)))\n+}\n+\n pub fn handle_execute_command(\n     world: ServerWorld,\n     mut params: req::ExecuteCommandParams,"}, {"sha": "5213ecc0483241135186d7985a1d82cc893a2664", "filename": "crates/server/src/main_loop/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fmain_loop%2Fmod.rs?ref=71722c047f96cb754c958c52591ca53f2a9c4d3c", "patch": "@@ -28,6 +28,7 @@ use {\n         handle_find_matching_brace,\n         handle_parent_module,\n         handle_join_lines,\n+        handle_completion,\n     },\n };\n \n@@ -143,6 +144,9 @@ fn on_request(\n     handle_request_on_threadpool::<req::GotoDefinition>(\n         &mut req, pool, world, sender, handle_goto_definition,\n     )?;\n+    handle_request_on_threadpool::<req::Completion>(\n+        &mut req, pool, world, sender, handle_completion,\n+    )?;\n     handle_request_on_threadpool::<req::ParentModule>(\n         &mut req, pool, world, sender, handle_parent_module,\n     )?;"}, {"sha": "6d3466b660ef649152a7d253dd7cb7589fa2b0a3", "filename": "crates/server/src/req.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Freq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71722c047f96cb754c958c52591ca53f2a9c4d3c/crates%2Fserver%2Fsrc%2Freq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Freq.rs?ref=71722c047f96cb754c958c52591ca53f2a9c4d3c", "patch": "@@ -11,6 +11,7 @@ pub use languageserver_types::{\n     WorkspaceSymbolParams,\n     TextDocumentPositionParams,\n     TextEdit,\n+    CompletionParams, CompletionResponse,\n };\n \n "}]}