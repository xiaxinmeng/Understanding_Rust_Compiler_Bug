{"sha": "3948b054dc8e598b83a194056dc4d3a0852dc79e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5NDhiMDU0ZGM4ZTU5OGI4M2ExOTQwNTZkYzRkM2EwODUyZGM3OWU=", "commit": {"author": {"name": "Florian Warzecha", "email": "liketechnik@disroot.org", "date": "2020-10-21T10:36:07Z"}, "committer": {"name": "Florian Warzecha", "email": "liketechnik@disroot.org", "date": "2020-10-21T16:04:18Z"}, "message": "add rustc_allow_const_fn_unstable attribute\n\nallow_internal_unstable is currently used\nto side-step feature gate and stability checks.\nWhile it was originally only meant to be used\nonly on macros, its use was expanded to\nconst functions.\n\nThis commit prepares stricter checks for the usage of allow_internal_unstable (only on macros)\nand introduces the rustc_allow_const_fn_unstable attribute for usage on functions.\n\nSee rust-lang/rust#69399", "tree": {"sha": "64dda3a4d42d191fd42afe7fea86252daf2fdc14", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64dda3a4d42d191fd42afe7fea86252daf2fdc14"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3948b054dc8e598b83a194056dc4d3a0852dc79e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmbauVGD14yLN3Z9qS+jH2X+RDGAFAl+QXAcACgkQS+jH2X+R\nDGDuaxAAotQUfAQMK+7N1kuHnwtKPFD4RVIQRHbvMknl9LtgxWMCC+dcTmeEmVPW\nyFxbqMBiP1+FMMU6buCQ9FbHj5tdUDtLvRKNW8s/mkS0DCSrWk5rruI41vL1r3Zj\nvqSb2XH0jWgHw+jHyzQNxqVT4Wwka5ublnBbu4RBg0NAdqcfLVPg4VEXGl6KpfdE\npnGP2bkWqkSyrEW6RtRJB6ehidmMFsruZIjsDLjIZUnAXRyXO6nZvRYifOZ01Htu\n5PzTtQs8+L5pLo6QV2arrpHkOSyH2zAbeDbXkOhu48a7gEIlmBKMq7jEq0LSojJu\n+/8cbQcurqCu4iMib1lkgawNUuNyFuF8UT53qAY6/GkLvuIQLLPbF9x4GdGH8kZY\n73R55ZUFN8WO5+GTi8WGxr2tkUSPZ1NNTLTfCagR6z/u22PnU/YC1p2tutwsk4CJ\nPUERAmdrnqPu5eiyubHpd0K+zmbPzy5eAmeJXfpvegk+y+0HuZj43RVaTxLAl9CB\nODw0a76s38z4xlS3B/LgwLtp1P+RpVN6S7sljQWRJnWM53ynk3VaR51wkDZC/nLW\nhEZN4LCWAvIENdPLtwse95DrmvFweGMraOP00E//a05YOZ8zBSmyuPWKguzdrzc7\naEtctmCAFV09hzAM9GP5MMrKGasNjsOD4KnAl7Dnd5K5Mg5HTRo=\n=srjV\n-----END PGP SIGNATURE-----", "payload": "tree 64dda3a4d42d191fd42afe7fea86252daf2fdc14\nparent 554633534c550d20715e5e1576702b1f035586ad\nauthor Florian Warzecha <liketechnik@disroot.org> 1603276567 +0200\ncommitter Florian Warzecha <liketechnik@disroot.org> 1603296258 +0200\n\nadd rustc_allow_const_fn_unstable attribute\n\nallow_internal_unstable is currently used\nto side-step feature gate and stability checks.\nWhile it was originally only meant to be used\nonly on macros, its use was expanded to\nconst functions.\n\nThis commit prepares stricter checks for the usage of allow_internal_unstable (only on macros)\nand introduces the rustc_allow_const_fn_unstable attribute for usage on functions.\n\nSee rust-lang/rust#69399\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3948b054dc8e598b83a194056dc4d3a0852dc79e", "html_url": "https://github.com/rust-lang/rust/commit/3948b054dc8e598b83a194056dc4d3a0852dc79e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3948b054dc8e598b83a194056dc4d3a0852dc79e/comments", "author": {"login": "liketechnik", "id": 24209689, "node_id": "MDQ6VXNlcjI0MjA5Njg5", "avatar_url": "https://avatars.githubusercontent.com/u/24209689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liketechnik", "html_url": "https://github.com/liketechnik", "followers_url": "https://api.github.com/users/liketechnik/followers", "following_url": "https://api.github.com/users/liketechnik/following{/other_user}", "gists_url": "https://api.github.com/users/liketechnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/liketechnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liketechnik/subscriptions", "organizations_url": "https://api.github.com/users/liketechnik/orgs", "repos_url": "https://api.github.com/users/liketechnik/repos", "events_url": "https://api.github.com/users/liketechnik/events{/privacy}", "received_events_url": "https://api.github.com/users/liketechnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "liketechnik", "id": 24209689, "node_id": "MDQ6VXNlcjI0MjA5Njg5", "avatar_url": "https://avatars.githubusercontent.com/u/24209689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liketechnik", "html_url": "https://github.com/liketechnik", "followers_url": "https://api.github.com/users/liketechnik/followers", "following_url": "https://api.github.com/users/liketechnik/following{/other_user}", "gists_url": "https://api.github.com/users/liketechnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/liketechnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liketechnik/subscriptions", "organizations_url": "https://api.github.com/users/liketechnik/orgs", "repos_url": "https://api.github.com/users/liketechnik/repos", "events_url": "https://api.github.com/users/liketechnik/events{/privacy}", "received_events_url": "https://api.github.com/users/liketechnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "554633534c550d20715e5e1576702b1f035586ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/554633534c550d20715e5e1576702b1f035586ad", "html_url": "https://github.com/rust-lang/rust/commit/554633534c550d20715e5e1576702b1f035586ad"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "90fed862b9993253957c2ec9e148832d5c5fdb9f", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=3948b054dc8e598b83a194056dc4d3a0852dc79e", "patch": "@@ -210,6 +210,11 @@ declare_features! (\n     /// it is not on path for eventual stabilization).\n     (active, no_niche, \"1.42.0\", None, None),\n \n+    /// Allows using `#[rustc_allow_const_fn_unstable]`.\n+    /// This is an attribute on `const fn` for the same\n+    /// purpose as `#[allow_internal_unstable]`.\n+    (active, rustc_allow_const_fn_unstable, \"1.49.0\", Some(69399), None),\n+\n     // no-tracking-issue-end\n \n     // -------------------------------------------------------------------------"}, {"sha": "f73363cbccc25808e91f19c42c76118002277ae5", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=3948b054dc8e598b83a194056dc4d3a0852dc79e", "patch": "@@ -379,6 +379,10 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n         allow_internal_unstable, AssumedUsed, template!(Word, List: \"feat1, feat2, ...\"),\n         \"allow_internal_unstable side-steps feature gating and stability checks\",\n     ),\n+    gated!(\n+        rustc_allow_const_fn_unstable, AssumedUsed, template!(Word, List: \"feat1, feat2, ...\"),\n+        \"rustc_allow_const_fn_unstable side-steps feature gating and stability checks\"\n+    ),\n     gated!(\n         allow_internal_unsafe, Normal, template!(Word),\n         \"allow_internal_unsafe side-steps the unsafe_code lint\","}, {"sha": "13864f6d0ea8dbdb5ce73c3d8d891c92b24abd81", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3948b054dc8e598b83a194056dc4d3a0852dc79e/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=3948b054dc8e598b83a194056dc4d3a0852dc79e", "patch": "@@ -893,6 +893,7 @@ symbols! {\n         rustc,\n         rustc_allocator,\n         rustc_allocator_nounwind,\n+        rustc_allow_const_fn_unstable,\n         rustc_args_required_const,\n         rustc_attrs,\n         rustc_builtin_macro,"}, {"sha": "19d8fa87f55365646623c3692e82e59b7e5762ed", "filename": "src/test/ui/feature-gates/feature-gate-rustc-allow-const-fn-unstable.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3948b054dc8e598b83a194056dc4d3a0852dc79e/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3948b054dc8e598b83a194056dc4d3a0852dc79e/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.rs?ref=3948b054dc8e598b83a194056dc4d3a0852dc79e", "patch": "@@ -0,0 +1,6 @@\n+#![allow(unused_macros)]\n+\n+#[rustc_allow_const_fn_unstable()] //~ ERROR rustc_allow_const_fn_unstable side-steps\n+const fn foo() { }\n+\n+fn main() {}"}, {"sha": "a549cb64e0cb63bf9c444e7e4b7689da92a35dd1", "filename": "src/test/ui/feature-gates/feature-gate-rustc-allow-const-fn-unstable.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3948b054dc8e598b83a194056dc4d3a0852dc79e/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3948b054dc8e598b83a194056dc4d3a0852dc79e/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-rustc-allow-const-fn-unstable.stderr?ref=3948b054dc8e598b83a194056dc4d3a0852dc79e", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: rustc_allow_const_fn_unstable side-steps feature gating and stability checks\n+  --> $DIR/feature-gate-rustc-allow-const-fn-unstable.rs:3:1\n+   |\n+LL | #[rustc_allow_const_fn_unstable()]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #69399 <https://github.com/rust-lang/rust/issues/69399> for more information\n+   = help: add `#![feature(rustc_allow_const_fn_unstable)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}