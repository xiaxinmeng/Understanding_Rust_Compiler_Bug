{"sha": "cae9c503b0d6de9702ca99bda95c081b1eb530f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhZTljNTAzYjBkNmRlOTcwMmNhOTliZGE5NWMwODFiMWViNTMwZjU=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-18T01:13:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-18T01:13:55Z"}, "message": "Rollup merge of #74464 - FedericoPonzi:fix-#67108, r=Manishearth\n\nUse pathdiff crate\n\nI wanted to tackle a simple issue, and stumbled upon #67108: this pr removes the function which was exported to the external crate as required in the todo/issue.\nI've tested it with:\n```\n./x.py build --stage 1 --keep-stage 1 src/librustc_codegen_ssa\n```\nAnd it looks like it's compiling", "tree": {"sha": "aa1118412d2690e0e595788144b14970826c3d1f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa1118412d2690e0e595788144b14970826c3d1f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cae9c503b0d6de9702ca99bda95c081b1eb530f5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfEkzTCRBK7hj4Ov3rIwAAdHIIAD4RL9RbqcV5Zq+xUYXXUgQ9\ng7VIIam6jsRP1GyLRQdWQqrSuW6wKJ17EI5ol8okmtWQMJpWa6FN6zzjNYwdPd7B\nfrvzn249un6gH+vt3FkcC9cnhBmOu81KDj7FMBfvwscr2fvwi3+aQXfA9KR7yNNN\netU5zYI244Zb+bHIjYDsKY5QDc5lPWlg6l+gFpChWKN5a1XlymYw/4b/EmoAyKFv\nUKpVqByObD+vf+sD4NOJkuyC+vutXZb35KfY57tkYaPYNkOPm/x8jgRwq+LXMbpQ\nexBVk6PaXQpMU/5Ui+ctXntpGRPGKpVQYL4yHLwciLOET621QiUvna9J4h76t1M=\n=Q34M\n-----END PGP SIGNATURE-----\n", "payload": "tree aa1118412d2690e0e595788144b14970826c3d1f\nparent 5f76240354af9e8a2dfffbb4205e686d0e5ef081\nparent c41db4cccd1977812c23a1ddfdef5d6a911d610a\nauthor Manish Goregaokar <manishsmail@gmail.com> 1595034835 -0700\ncommitter GitHub <noreply@github.com> 1595034835 -0700\n\nRollup merge of #74464 - FedericoPonzi:fix-#67108, r=Manishearth\n\nUse pathdiff crate\n\nI wanted to tackle a simple issue, and stumbled upon #67108: this pr removes the function which was exported to the external crate as required in the todo/issue.\nI've tested it with:\n```\n./x.py build --stage 1 --keep-stage 1 src/librustc_codegen_ssa\n```\nAnd it looks like it's compiling\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cae9c503b0d6de9702ca99bda95c081b1eb530f5", "html_url": "https://github.com/rust-lang/rust/commit/cae9c503b0d6de9702ca99bda95c081b1eb530f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cae9c503b0d6de9702ca99bda95c081b1eb530f5/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f76240354af9e8a2dfffbb4205e686d0e5ef081", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f76240354af9e8a2dfffbb4205e686d0e5ef081", "html_url": "https://github.com/rust-lang/rust/commit/5f76240354af9e8a2dfffbb4205e686d0e5ef081"}, {"sha": "c41db4cccd1977812c23a1ddfdef5d6a911d610a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c41db4cccd1977812c23a1ddfdef5d6a911d610a", "html_url": "https://github.com/rust-lang/rust/commit/c41db4cccd1977812c23a1ddfdef5d6a911d610a"}], "stats": {"total": 42, "additions": 11, "deletions": 31}, "files": [{"sha": "3ee7d07900700cdc1797ecbcbc1fcb8efd98c8df", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cae9c503b0d6de9702ca99bda95c081b1eb530f5/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/cae9c503b0d6de9702ca99bda95c081b1eb530f5/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=cae9c503b0d6de9702ca99bda95c081b1eb530f5", "patch": "@@ -2142,6 +2142,12 @@ dependencies = [\n  \"winapi 0.3.8\",\n ]\n \n+[[package]]\n+name = \"pathdiff\"\n+version = \"0.2.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"877630b3de15c0b64cc52f659345724fbf6bdad9bd9566699fc53688f3c34a34\"\n+\n [[package]]\n name = \"percent-encoding\"\n version = \"1.0.1\"\n@@ -3318,6 +3324,7 @@ dependencies = [\n  \"log\",\n  \"memmap\",\n  \"num_cpus\",\n+ \"pathdiff\",\n  \"rustc_apfloat\",\n  \"rustc_ast\",\n  \"rustc_attr\","}, {"sha": "e100e0095c92a4bfd37142ee7c9310b8ad8f2f86", "filename": "src/librustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Flibrustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Flibrustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2FCargo.toml?ref=cae9c503b0d6de9702ca99bda95c081b1eb530f5", "patch": "@@ -18,6 +18,7 @@ log = \"0.4.5\"\n libc = \"0.2.50\"\n jobserver = \"0.1.11\"\n tempfile = \"3.1\"\n+pathdiff = \"0.2.0\"\n \n rustc_serialize = { path = \"../librustc_serialize\" }\n rustc_ast = { path = \"../librustc_ast\" }"}, {"sha": "005d2efdd3b26ab95bff7995c2c7a5f5778eb61d", "filename": "src/librustc_codegen_ssa/back/rpath.rs", "status": "modified", "additions": 2, "deletions": 31, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs?ref=cae9c503b0d6de9702ca99bda95c081b1eb530f5", "patch": "@@ -1,3 +1,4 @@\n+use pathdiff::diff_paths;\n use rustc_data_structures::fx::FxHashSet;\n use std::env;\n use std::fs;\n@@ -109,37 +110,7 @@ fn get_rpath_relative_to_output(config: &mut RPathConfig<'_>, lib: &Path) -> Str\n // In particular, this handles the case on unix where both paths are\n // absolute but with only the root as the common directory.\n fn path_relative_from(path: &Path, base: &Path) -> Option<PathBuf> {\n-    use std::path::Component;\n-\n-    if path.is_absolute() != base.is_absolute() {\n-        path.is_absolute().then(|| PathBuf::from(path))\n-    } else {\n-        let mut ita = path.components();\n-        let mut itb = base.components();\n-        let mut comps: Vec<Component<'_>> = vec![];\n-        loop {\n-            match (ita.next(), itb.next()) {\n-                (None, None) => break,\n-                (Some(a), None) => {\n-                    comps.push(a);\n-                    comps.extend(ita.by_ref());\n-                    break;\n-                }\n-                (None, _) => comps.push(Component::ParentDir),\n-                (Some(a), Some(b)) if comps.is_empty() && a == b => (),\n-                (Some(a), Some(b)) if b == Component::CurDir => comps.push(a),\n-                (Some(_), Some(b)) if b == Component::ParentDir => return None,\n-                (Some(a), Some(_)) => {\n-                    comps.push(Component::ParentDir);\n-                    comps.extend(itb.map(|_| Component::ParentDir));\n-                    comps.push(a);\n-                    comps.extend(ita.by_ref());\n-                    break;\n-                }\n-            }\n-        }\n-        Some(comps.iter().map(|c| c.as_os_str()).collect())\n-    }\n+    diff_paths(path, base)\n }\n \n fn get_install_prefix_rpath(config: &mut RPathConfig<'_>) -> String {"}, {"sha": "559267a494f29a009954f07d66b8f02399e1f8ac", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cae9c503b0d6de9702ca99bda95c081b1eb530f5/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=cae9c503b0d6de9702ca99bda95c081b1eb530f5", "patch": "@@ -123,6 +123,7 @@ const PERMITTED_DEPENDENCIES: &[&str] = &[\n     \"opaque-debug\",\n     \"parking_lot\",\n     \"parking_lot_core\",\n+    \"pathdiff\",\n     \"pkg-config\",\n     \"polonius-engine\",\n     \"ppv-lite86\","}]}