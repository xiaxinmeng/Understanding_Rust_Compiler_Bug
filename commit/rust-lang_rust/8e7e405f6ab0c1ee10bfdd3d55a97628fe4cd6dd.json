{"sha": "8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlN2U0MDVmNmFiMGMxZWUxMGJmZGQzZDU1YTk3NjI4ZmU0Y2Q2ZGQ=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2021-03-20T09:51:00Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2021-03-20T09:51:00Z"}, "message": "Remove WhereClause::Error\n\nChalk doesn't have it, and judging from the removed code, it wasn't\nuseful anyway.", "tree": {"sha": "ebdcea14c479ddfca358bbeabdde1da8f45b2423", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ebdcea14c479ddfca358bbeabdde1da8f45b2423"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "html_url": "https://github.com/rust-lang/rust/commit/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a5fb37cf12f4e25ce1ba7e464dd257408444bfb", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a5fb37cf12f4e25ce1ba7e464dd257408444bfb", "html_url": "https://github.com/rust-lang/rust/commit/7a5fb37cf12f4e25ce1ba7e464dd257408444bfb"}], "stats": {"total": 50, "additions": 8, "deletions": 42}, "files": [{"sha": "4765c99a452c6158b77c20dbb0def5457359682d", "filename": "crates/hir_ty/src/display.rs", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -731,16 +731,6 @@ fn write_bounds_like_dyn_trait(\n                 }\n                 ty.hir_fmt(f)?;\n             }\n-            WhereClause::Error => {\n-                if angle_open {\n-                    // impl Trait<X, {error}>\n-                    write!(f, \", \")?;\n-                } else if !first {\n-                    // impl Trait + {error}\n-                    write!(f, \" + \")?;\n-                }\n-                p.hir_fmt(f)?;\n-            }\n         }\n         first = false;\n     }\n@@ -796,7 +786,7 @@ impl HirDisplay for WhereClause {\n                 )?;\n                 ty.hir_fmt(f)?;\n             }\n-            WhereClause::AliasEq(_) | WhereClause::Error => write!(f, \"{{error}}\")?,\n+            WhereClause::AliasEq(_) => write!(f, \"{{error}}\")?,\n         }\n         Ok(())\n     }"}, {"sha": "8de2d422f887d5401129c9a7c5fc44ccae6aaeba", "filename": "crates/hir_ty/src/lib.rs", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Flib.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -569,16 +569,9 @@ pub enum WhereClause {\n     Implemented(TraitRef),\n     /// An associated type bindings like in `Iterator<Item = T>`.\n     AliasEq(AliasEq),\n-    /// We couldn't resolve the trait reference. (If some type parameters can't\n-    /// be resolved, they will just be Unknown).\n-    Error,\n }\n \n impl WhereClause {\n-    pub fn is_error(&self) -> bool {\n-        matches!(self, WhereClause::Error)\n-    }\n-\n     pub fn is_implemented(&self) -> bool {\n         matches!(self, WhereClause::Implemented(_))\n     }\n@@ -589,7 +582,7 @@ impl WhereClause {\n             WhereClause::AliasEq(AliasEq { alias: AliasTy::Projection(proj), .. }) => {\n                 Some(proj.trait_ref(db))\n             }\n-            WhereClause::AliasEq(_) | WhereClause::Error => None,\n+            WhereClause::AliasEq(_) => None,\n         }\n     }\n }\n@@ -599,7 +592,6 @@ impl TypeWalk for WhereClause {\n         match self {\n             WhereClause::Implemented(trait_ref) => trait_ref.walk(f),\n             WhereClause::AliasEq(alias_eq) => alias_eq.walk(f),\n-            WhereClause::Error => {}\n         }\n     }\n \n@@ -611,7 +603,6 @@ impl TypeWalk for WhereClause {\n         match self {\n             WhereClause::Implemented(trait_ref) => trait_ref.walk_mut_binders(f, binders),\n             WhereClause::AliasEq(alias_eq) => alias_eq.walk_mut_binders(f, binders),\n-            WhereClause::Error => {}\n         }\n     }\n }"}, {"sha": "cbbb535e554b2442fac14c41d57dab3b26fe87b5", "filename": "crates/hir_ty/src/lower.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Flower.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -703,10 +703,10 @@ impl<'a> TyLoweringContext<'a> {\n         let trait_ref = match bound {\n             TypeBound::Path(path) => {\n                 bindings = self.lower_trait_ref_from_path(path, Some(self_ty));\n-                Some(bindings.clone().map_or(WhereClause::Error, WhereClause::Implemented))\n+                bindings.clone().map(WhereClause::Implemented)\n             }\n             TypeBound::Lifetime(_) => None,\n-            TypeBound::Error => Some(WhereClause::Error),\n+            TypeBound::Error => None,\n         };\n         trait_ref.into_iter().chain(\n             bindings\n@@ -919,9 +919,6 @@ pub(crate) fn trait_environment_query(\n     let mut clauses = Vec::new();\n     for pred in resolver.where_predicates_in_scope() {\n         for pred in ctx.lower_where_predicate(pred) {\n-            if pred.is_error() {\n-                continue;\n-            }\n             if let WhereClause::Implemented(tr) = &pred {\n                 traits_in_scope.push((tr.self_type_parameter().clone(), tr.hir_trait_id()));\n             }"}, {"sha": "8f2bdffc03fdd2747f759e3888213d42a64cef7b", "filename": "crates/hir_ty/src/tests/traits.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -1412,8 +1412,8 @@ fn weird_bounds() {\n             50..51 'b': impl\n             69..70 'c': impl Trait\n             86..87 'd': impl\n-            107..108 'e': impl {error}\n-            123..124 'f': impl Trait + {error}\n+            107..108 'e': impl\n+            123..124 'f': impl Trait\n             147..149 '{}': ()\n         \"#]],\n     );"}, {"sha": "87c92bd12043e5318ee95d452792d182b13ce412", "filename": "crates/hir_ty/src/traits.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftraits.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -100,7 +100,6 @@ impl Obligation {\n         match predicate {\n             WhereClause::Implemented(trait_ref) => Some(Obligation::Trait(trait_ref)),\n             WhereClause::AliasEq(alias_eq) => Some(Obligation::AliasEq(alias_eq)),\n-            WhereClause::Error => None,\n         }\n     }\n }"}, {"sha": "734679414bdc1720c7fe2a7012373bcb79daf4a2", "filename": "crates/hir_ty/src/traits/chalk.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -187,13 +187,7 @@ impl<'a> chalk_solve::RustIrDatabase<Interner> for ChalkContext<'a> {\n                 let data = &datas.value.impl_traits[idx as usize];\n                 let bound = OpaqueTyDatumBound {\n                     bounds: make_binders(\n-                        data.bounds\n-                            .value\n-                            .iter()\n-                            .cloned()\n-                            .filter(|b| !b.is_error())\n-                            .map(|b| b.to_chalk(self.db))\n-                            .collect(),\n+                        data.bounds.value.iter().cloned().map(|b| b.to_chalk(self.db)).collect(),\n                         1,\n                     ),\n                     where_clauses: make_binders(vec![], 0),"}, {"sha": "7841c216cb9d74d4fef49ec70d4f4a41bfadb509", "filename": "crates/hir_ty/src/traits/chalk/mapping.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Fmapping.rs?ref=8e7e405f6ab0c1ee10bfdd3d55a97628fe4cd6dd", "patch": "@@ -98,7 +98,7 @@ impl ToChalk for Ty {\n             TyKind::Dyn(predicates) => {\n                 let where_clauses = chalk_ir::QuantifiedWhereClauses::from_iter(\n                     &Interner,\n-                    predicates.iter().filter(|p| !p.is_error()).cloned().map(|p| p.to_chalk(db)),\n+                    predicates.iter().cloned().map(|p| p.to_chalk(db)),\n                 );\n                 let bounded_ty = chalk_ir::DynTy {\n                     bounds: make_binders(where_clauses, 1),\n@@ -318,7 +318,6 @@ impl ToChalk for WhereClause {\n                 chalk_ir::WhereClause::AliasEq(alias_eq.to_chalk(db).shifted_in(&Interner)),\n                 0,\n             ),\n-            WhereClause::Error => panic!(\"tried passing GenericPredicate::Error to Chalk\"),\n         }\n     }\n \n@@ -521,10 +520,6 @@ pub(super) fn convert_where_clauses(\n     let generic_predicates = db.generic_predicates(def);\n     let mut result = Vec::with_capacity(generic_predicates.len());\n     for pred in generic_predicates.iter() {\n-        if pred.value.is_error() {\n-            // skip errored predicates completely\n-            continue;\n-        }\n         result.push(pred.clone().subst(substs).to_chalk(db));\n     }\n     result"}]}