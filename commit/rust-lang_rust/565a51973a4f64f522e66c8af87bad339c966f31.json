{"sha": "565a51973a4f64f522e66c8af87bad339c966f31", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2NWE1MTk3M2E0ZjY0ZjUyMmU2NmM4YWY4N2JhZDMzOWM5NjZmMzE=", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-07-29T01:50:59Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-08-08T21:11:29Z"}, "message": "Update Windows arg parsing tests\n\nThis updates the tests to be consistent with argv in modern C/C++ applications.", "tree": {"sha": "336f9109f640ce5bf1d6f28500883da4d758e14c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/336f9109f640ce5bf1d6f28500883da4d758e14c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/565a51973a4f64f522e66c8af87bad339c966f31", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmEQSIEACgkQcTRy8vRW\nJ96bsQ//YNTuBMV7XWdXVczyOz7CBLuQh4HXeJXV1JfcGucdKMQ1fP7V/uBOselP\njpf3YkVtqcJvbaFJGaO9dteNWcXTbaNskg2Kqc3IaBUXlqXY1yuFST0+RMgyCsMz\nz9r2vmfnb6UMXDl6bD0UgMsv6Rs0JFAmauc71coXB1TrRfeBvEs+BH/wJsjMNN3S\nJcdAHO7v4SvkPEyYJNPdPRCmb20xzHwhst6mVud+eXMy7miiOWNxzVTRkNQohUTt\nI2MfrflMWRZBbEVuk8o/qDlohbOuoOQe6qiCe04rt4aC4U3b1WMrMg27VgTRmYBm\nZ5igvha/f46upThWCEXc3DcLlv8kmWEgUksxzUTDc+GfdYAfuupoYDifTU3FD7M7\nZLtoanP/m/KwbXqTMEZG5e+FXF57xjwrtqrEgWPqTIPFzBh4z2Ym32PPUolxPfU2\nqBFBR/bMuEh8x80GxCGcYiC56NVdYtJA4KqEcwRauFa7wZvr5Opz48c1IWpD2yJ6\nFCl9kAogH/FuaPMz8xJRfgHKrvdhx5nZogBdpt/D1TBuQPqj/KF2jT8nydh5NV61\n7fbSEzZnV6OEjTmVoU2JEdq8HGVATX3BKl37Gpa+4OCLGqjh13/MHSMZqK8V2RH0\n1LZYQMCvrhSUhYmdUqSik7crkOWamH2okUWa+59vytIwPmp4shs=\n=Hd8i\n-----END PGP SIGNATURE-----", "payload": "tree 336f9109f640ce5bf1d6f28500883da4d758e14c\nparent 442e627beef1c582b81b241bd862fea185937585\nauthor Chris Denton <christophersdenton@gmail.com> 1627523459 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1628457089 +0100\n\nUpdate Windows arg parsing tests\n\nThis updates the tests to be consistent with argv in modern C/C++ applications.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/565a51973a4f64f522e66c8af87bad339c966f31", "html_url": "https://github.com/rust-lang/rust/commit/565a51973a4f64f522e66c8af87bad339c966f31", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/565a51973a4f64f522e66c8af87bad339c966f31/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "442e627beef1c582b81b241bd862fea185937585", "url": "https://api.github.com/repos/rust-lang/rust/commits/442e627beef1c582b81b241bd862fea185937585", "html_url": "https://github.com/rust-lang/rust/commit/442e627beef1c582b81b241bd862fea185937585"}], "stats": {"total": 64, "additions": 47, "deletions": 17}, "files": [{"sha": "82c32d08c5ea8f927a576b3b709f04396c621339", "filename": "library/std/src/sys/windows/args/tests.rs", "status": "modified", "additions": 47, "deletions": 17, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/565a51973a4f64f522e66c8af87bad339c966f31/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/565a51973a4f64f522e66c8af87bad339c966f31/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs%2Ftests.rs?ref=565a51973a4f64f522e66c8af87bad339c966f31", "patch": "@@ -5,9 +5,9 @@ fn chk(string: &str, parts: &[&str]) {\n     let mut wide: Vec<u16> = OsString::from(string).encode_wide().collect();\n     wide.push(0);\n     let parsed =\n-        unsafe { parse_lp_cmd_line(wide.as_ptr() as *const u16, || OsString::from(\"TEST.EXE\")) };\n+        unsafe { parse_lp_cmd_line(WStrUnits::new(wide.as_ptr()), || OsString::from(\"TEST.EXE\")) };\n     let expected: Vec<OsString> = parts.iter().map(|k| OsString::from(k)).collect();\n-    assert_eq!(parsed.as_slice(), expected.as_slice());\n+    assert_eq!(parsed.as_slice(), expected.as_slice(), \"{:?}\", string);\n }\n \n #[test]\n@@ -27,35 +27,65 @@ fn single_words() {\n #[test]\n fn official_examples() {\n     chk(r#\"EXE \"abc\" d e\"#, &[\"EXE\", \"abc\", \"d\", \"e\"]);\n-    chk(r#\"EXE a\\\\\\b d\"e f\"g h\"#, &[\"EXE\", r#\"a\\\\\\b\"#, \"de fg\", \"h\"]);\n+    chk(r#\"EXE a\\\\\\b d\"e f\"g h\"#, &[\"EXE\", r\"a\\\\\\b\", \"de fg\", \"h\"]);\n     chk(r#\"EXE a\\\\\\\"b c d\"#, &[\"EXE\", r#\"a\\\"b\"#, \"c\", \"d\"]);\n-    chk(r#\"EXE a\\\\\\\\\"b c\" d e\"#, &[\"EXE\", r#\"a\\\\b c\"#, \"d\", \"e\"]);\n+    chk(r#\"EXE a\\\\\\\\\"b c\" d e\"#, &[\"EXE\", r\"a\\\\b c\", \"d\", \"e\"]);\n }\n \n #[test]\n fn whitespace_behavior() {\n-    chk(r#\" test\"#, &[\"\", \"test\"]);\n-    chk(r#\"  test\"#, &[\"\", \"test\"]);\n-    chk(r#\" test test2\"#, &[\"\", \"test\", \"test2\"]);\n-    chk(r#\" test  test2\"#, &[\"\", \"test\", \"test2\"]);\n-    chk(r#\"test test2 \"#, &[\"test\", \"test2\"]);\n-    chk(r#\"test  test2 \"#, &[\"test\", \"test2\"]);\n-    chk(r#\"test \"#, &[\"test\"]);\n+    chk(\" test\", &[\"\", \"test\"]);\n+    chk(\"  test\", &[\"\", \"test\"]);\n+    chk(\" test test2\", &[\"\", \"test\", \"test2\"]);\n+    chk(\" test  test2\", &[\"\", \"test\", \"test2\"]);\n+    chk(\"test test2 \", &[\"test\", \"test2\"]);\n+    chk(\"test  test2 \", &[\"test\", \"test2\"]);\n+    chk(\"test \", &[\"test\"]);\n }\n \n #[test]\n fn genius_quotes() {\n     chk(r#\"EXE \"\" \"\"\"#, &[\"EXE\", \"\", \"\"]);\n-    chk(r#\"EXE \"\" \"\"\"\"#, &[\"EXE\", \"\", \"\\\"\"]);\n+    chk(r#\"EXE \"\" \"\"\"\"#, &[\"EXE\", \"\", r#\"\"\"#]);\n     chk(\n         r#\"EXE \"this is \"\"\"all\"\"\" in the same argument\"\"#,\n-        &[\"EXE\", \"this is \\\"all\\\" in the same argument\"],\n+        &[\"EXE\", r#\"this is \"all\" in the same argument\"#],\n     );\n-    chk(r#\"EXE \"a\"\"\"#, &[\"EXE\", \"a\\\"\"]);\n-    chk(r#\"EXE \"a\"\" a\"#, &[\"EXE\", \"a\\\"\", \"a\"]);\n+    chk(r#\"EXE \"a\"\"\"#, &[\"EXE\", r#\"a\"\"#]);\n+    chk(r#\"EXE \"a\"\" a\"#, &[\"EXE\", r#\"a\" a\"#]);\n     // quotes cannot be escaped in command names\n     chk(r#\"\"EXE\" check\"#, &[\"EXE\", \"check\"]);\n     chk(r#\"\"EXE check\"\"#, &[\"EXE check\"]);\n-    chk(r#\"\"EXE \"\"\"for\"\"\" check\"#, &[\"EXE \", r#\"for\"\"#, \"check\"]);\n-    chk(r#\"\"EXE \\\"for\\\" check\"#, &[r#\"EXE \\\"#, r#\"for\"\"#, \"check\"]);\n+    chk(r#\"\"EXE \"\"\"for\"\"\" check\"#, &[\"EXE for check\"]);\n+    chk(r#\"\"EXE \\\"for\\\" check\"#, &[r\"EXE \\for\\ check\"]);\n+    chk(r#\"\"EXE \\\" for \\\" check\"#, &[r\"EXE \\\", \"for\", r#\"\"\"#, \"check\"]);\n+    chk(r#\"E\"X\"E test\"#, &[\"EXE\", \"test\"]);\n+    chk(r#\"EX\"\"E test\"#, &[\"EXE\", \"test\"]);\n+}\n+\n+// from https://daviddeley.com/autohotkey/parameters/parameters.htm#WINCRULESEX\n+#[test]\n+fn post_2008() {\n+    chk(\"EXE CallMeIshmael\", &[\"EXE\", \"CallMeIshmael\"]);\n+    chk(r#\"EXE \"Call Me Ishmael\"\"#, &[\"EXE\", \"Call Me Ishmael\"]);\n+    chk(r#\"EXE Cal\"l Me I\"shmael\"#, &[\"EXE\", \"Call Me Ishmael\"]);\n+    chk(r#\"EXE CallMe\\\"Ishmael\"#, &[\"EXE\", r#\"CallMe\"Ishmael\"#]);\n+    chk(r#\"EXE \"CallMe\\\"Ishmael\"\"#, &[\"EXE\", r#\"CallMe\"Ishmael\"#]);\n+    chk(r#\"EXE \"Call Me Ishmael\\\\\"\"#, &[\"EXE\", r\"Call Me Ishmael\\\"]);\n+    chk(r#\"EXE \"CallMe\\\\\\\"Ishmael\"\"#, &[\"EXE\", r#\"CallMe\\\"Ishmael\"#]);\n+    chk(r#\"EXE a\\\\\\b\"#, &[\"EXE\", r\"a\\\\\\b\"]);\n+    chk(r#\"EXE \"a\\\\\\b\"\"#, &[\"EXE\", r\"a\\\\\\b\"]);\n+    chk(r#\"EXE \"\\\"Call Me Ishmael\\\"\"\"#, &[\"EXE\", r#\"\"Call Me Ishmael\"\"#]);\n+    chk(r#\"EXE \"C:\\TEST A\\\\\"\"#, &[\"EXE\", r\"C:\\TEST A\\\"]);\n+    chk(r#\"EXE \"\\\"C:\\TEST A\\\\\\\"\"\"#, &[\"EXE\", r#\"\"C:\\TEST A\\\"\"#]);\n+    chk(r#\"EXE \"a b c\"  d  e\"#, &[\"EXE\", \"a b c\", \"d\", \"e\"]);\n+    chk(r#\"EXE \"ab\\\"c\"  \"\\\\\"  d\"#, &[\"EXE\", r#\"ab\"c\"#, r\"\\\", \"d\"]);\n+    chk(r#\"EXE a\\\\\\b d\"e f\"g h\"#, &[\"EXE\", r\"a\\\\\\b\", \"de fg\", \"h\"]);\n+    chk(r#\"EXE a\\\\\\\"b c d\"#, &[\"EXE\", r#\"a\\\"b\"#, \"c\", \"d\"]);\n+    chk(r#\"EXE a\\\\\\\\\"b c\" d e\"#, &[\"EXE\", r\"a\\\\b c\", \"d\", \"e\"]);\n+    // Double Double Quotes\n+    chk(r#\"EXE \"a b c\"\"\"#, &[\"EXE\", r#\"a b c\"\"#]);\n+    chk(r#\"EXE \"\"\"CallMeIshmael\"\"\"  b  c\"#, &[\"EXE\", r#\"\"CallMeIshmael\"\"#, \"b\", \"c\"]);\n+    chk(r#\"EXE \"\"\"Call Me Ishmael\"\"\"\"#, &[\"EXE\", r#\"\"Call Me Ishmael\"\"#]);\n+    chk(r#\"EXE \"\"\"\"Call Me Ishmael\"\" b c\"#, &[\"EXE\", r#\"\"Call\"#, \"Me\", \"Ishmael\", \"b\", \"c\"]);\n }"}]}