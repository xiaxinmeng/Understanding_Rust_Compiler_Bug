{"sha": "5145c970871e2dbe37228280fe34decd8c26ea4e", "node_id": "C_kwDOAAsO6NoAKDUxNDVjOTcwODcxZTJkYmUzNzIyODI4MGZlMzRkZWNkOGMyNmVhNGU", "commit": {"author": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2022-08-17T19:09:59Z"}, "committer": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2022-08-17T19:09:59Z"}, "message": "Add LLVM15-specific codegen test for `try`/`?`s that now optimize away\n\nThese still generated a bunch of code back in Rust 1.63 (<https://rust.godbolt.org/z/z31P8h6rz>), but with LLVM 15 merged they no longer do :tada:", "tree": {"sha": "1bb8835ebac61856eb96f5a93b63c0205a927455", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1bb8835ebac61856eb96f5a93b63c0205a927455"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5145c970871e2dbe37228280fe34decd8c26ea4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5145c970871e2dbe37228280fe34decd8c26ea4e", "html_url": "https://github.com/rust-lang/rust/commit/5145c970871e2dbe37228280fe34decd8c26ea4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5145c970871e2dbe37228280fe34decd8c26ea4e/comments", "author": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76c427d6e20c2942716de9932be4215771aeb4b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/76c427d6e20c2942716de9932be4215771aeb4b1", "html_url": "https://github.com/rust-lang/rust/commit/76c427d6e20c2942716de9932be4215771aeb4b1"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "d239387768e6b9fec95d21dc86b0fad4908b0e0d", "filename": "src/test/codegen/try_question_mark_nop.rs", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/5145c970871e2dbe37228280fe34decd8c26ea4e/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5145c970871e2dbe37228280fe34decd8c26ea4e/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Ftry_question_mark_nop.rs?ref=5145c970871e2dbe37228280fe34decd8c26ea4e", "patch": "@@ -0,0 +1,54 @@\n+// min-llvm-version: 15.0\n+// compile-flags: -O -Z merge-functions=disabled --edition=2021\n+// only-x86_64\n+\n+#![crate_type = \"lib\"]\n+#![feature(try_blocks)]\n+\n+// These are now NOPs in LLVM 15, presumably thanks to nikic's change mentioned in\n+// <https://github.com/rust-lang/rust/issues/85133#issuecomment-1072168354>.\n+// Unfortunately, as of 2022-08-17 they're not yet nops for `u64`s nor `Option`.\n+\n+use std::ops::ControlFlow::{self, Continue, Break};\n+\n+// CHECK-LABEL: @result_nop_match_32\n+#[no_mangle]\n+pub fn result_nop_match_32(x: Result<i32, u32>) -> Result<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    match x {\n+        Ok(x) => Ok(x),\n+        Err(x) => Err(x),\n+    }\n+}\n+\n+// CHECK-LABEL: @result_nop_traits_32\n+#[no_mangle]\n+pub fn result_nop_traits_32(x: Result<i32, u32>) -> Result<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    try {\n+        x?\n+    }\n+}\n+\n+// CHECK-LABEL: @control_flow_nop_match_32\n+#[no_mangle]\n+pub fn control_flow_nop_match_32(x: ControlFlow<i32, u32>) -> ControlFlow<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    match x {\n+        Continue(x) => Continue(x),\n+        Break(x) => Break(x),\n+    }\n+}\n+\n+// CHECK-LABEL: @control_flow_nop_traits_32\n+#[no_mangle]\n+pub fn control_flow_nop_traits_32(x: ControlFlow<i32, u32>) -> ControlFlow<i32, u32> {\n+    // CHECK: start\n+    // CHECK-NEXT: ret i64 %0\n+    try {\n+        x?\n+    }\n+}"}]}