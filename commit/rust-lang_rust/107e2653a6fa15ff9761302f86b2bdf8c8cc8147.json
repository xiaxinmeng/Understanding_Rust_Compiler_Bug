{"sha": "107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "node_id": "C_kwDOAAsO6NoAKDEwN2UyNjUzYTZmYTE1ZmY5NzYxMzAyZjg2YjJiZGY4YzhjYzgxNDc", "commit": {"author": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-22T16:16:46Z"}, "committer": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-24T08:38:19Z"}, "message": "Don't run slow tests in Rust CI, only RA CI", "tree": {"sha": "84d8f70bb0acc698b9144d295da54ce96fc5e018", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84d8f70bb0acc698b9144d295da54ce96fc5e018"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "html_url": "https://github.com/rust-lang/rust/commit/107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/107e2653a6fa15ff9761302f86b2bdf8c8cc8147/comments", "author": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44f50c5fd275dfe7260d6eea5065e12eb3c8e811", "url": "https://api.github.com/repos/rust-lang/rust/commits/44f50c5fd275dfe7260d6eea5065e12eb3c8e811", "html_url": "https://github.com/rust-lang/rust/commit/44f50c5fd275dfe7260d6eea5065e12eb3c8e811"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "c2c45355694ec96c7a830e7973c04b2db19049c2", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/107e2653a6fa15ff9761302f86b2bdf8c8cc8147/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/107e2653a6fa15ff9761302f86b2bdf8c8cc8147/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "patch": "@@ -396,6 +396,10 @@ impl Step for RustAnalyzer {\n         // https://github.com/rust-analyzer/expect-test/issues/33\n         cargo.env(\"CARGO_WORKSPACE_DIR\", &dir);\n \n+        // RA's test suite tries to write to the source directory, that can't\n+        // work in Rust CI\n+        cargo.env(\"SKIP_SLOW_TESTS\", \"1\");\n+\n         cargo.add_rustc_lib_path(builder, compiler);\n         cargo.arg(\"--\").args(builder.config.cmd.test_args());\n "}, {"sha": "8a9cfb6c22e45e5dd8af957ea16a4bb1245c64aa", "filename": "src/tools/rust-analyzer/crates/test-utils/src/lib.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/107e2653a6fa15ff9761302f86b2bdf8c8cc8147/src%2Ftools%2Frust-analyzer%2Fcrates%2Ftest-utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/107e2653a6fa15ff9761302f86b2bdf8c8cc8147/src%2Ftools%2Frust-analyzer%2Fcrates%2Ftest-utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frust-analyzer%2Fcrates%2Ftest-utils%2Fsrc%2Flib.rs?ref=107e2653a6fa15ff9761302f86b2bdf8c8cc8147", "patch": "@@ -8,9 +8,9 @@\n \n #![warn(rust_2018_idioms, unused_lifetimes, semicolon_in_expressions_from_macros)]\n \n+mod assert_linear;\n pub mod bench_fixture;\n mod fixture;\n-mod assert_linear;\n \n use std::{\n     collections::BTreeMap,\n@@ -391,7 +391,8 @@ fn main() {\n /// also creates a file at `./target/.slow_tests_cookie` which serves as a flag\n /// that slow tests did run.\n pub fn skip_slow_tests() -> bool {\n-    let should_skip = std::env::var(\"CI\").is_err() && std::env::var(\"RUN_SLOW_TESTS\").is_err();\n+    let should_skip = (std::env::var(\"CI\").is_err() && std::env::var(\"RUN_SLOW_TESTS\").is_err())\n+        || std::env::var(\"SKIP_SLOW_TESTS\").is_ok();\n     if should_skip {\n         eprintln!(\"ignoring slow test\");\n     } else {\n@@ -475,7 +476,7 @@ pub fn ensure_file_contents(file: &Path, contents: &str) {\n pub fn try_ensure_file_contents(file: &Path, contents: &str) -> Result<(), ()> {\n     match std::fs::read_to_string(file) {\n         Ok(old_contents) if normalize_newlines(&old_contents) == normalize_newlines(contents) => {\n-            return Ok(())\n+            return Ok(());\n         }\n         _ => (),\n     }"}]}