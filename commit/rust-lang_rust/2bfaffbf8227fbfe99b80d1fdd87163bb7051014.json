{"sha": "2bfaffbf8227fbfe99b80d1fdd87163bb7051014", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiZmFmZmJmODIyN2ZiZmU5OWI4MGQxZmRkODcxNjNiYjcwNTEwMTQ=", "commit": {"author": {"name": "Florian sp1rit\u200b", "email": "sp1ritCS@protonmail.com", "date": "2021-08-16T11:23:53Z"}, "committer": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2021-08-17T11:08:10Z"}, "message": "proc_macro_api: make commit & date suffix of binary version optional\n\nSigned-off-by: Florian \"sp1rit\"\u200b <sp1ritCS@protonmail.com>", "tree": {"sha": "4d7e1069de617be1f649497fb19d0147fafa83af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d7e1069de617be1f649497fb19d0147fafa83af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2bfaffbf8227fbfe99b80d1fdd87163bb7051014", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2bfaffbf8227fbfe99b80d1fdd87163bb7051014", "html_url": "https://github.com/rust-lang/rust/commit/2bfaffbf8227fbfe99b80d1fdd87163bb7051014", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2bfaffbf8227fbfe99b80d1fdd87163bb7051014/comments", "author": {"login": "sp1ritCS", "id": 31540351, "node_id": "MDQ6VXNlcjMxNTQwMzUx", "avatar_url": "https://avatars.githubusercontent.com/u/31540351?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sp1ritCS", "html_url": "https://github.com/sp1ritCS", "followers_url": "https://api.github.com/users/sp1ritCS/followers", "following_url": "https://api.github.com/users/sp1ritCS/following{/other_user}", "gists_url": "https://api.github.com/users/sp1ritCS/gists{/gist_id}", "starred_url": "https://api.github.com/users/sp1ritCS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sp1ritCS/subscriptions", "organizations_url": "https://api.github.com/users/sp1ritCS/orgs", "repos_url": "https://api.github.com/users/sp1ritCS/repos", "events_url": "https://api.github.com/users/sp1ritCS/events{/privacy}", "received_events_url": "https://api.github.com/users/sp1ritCS/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dcbaa75bc14c69ab060bffe9b108cb55b325b121", "url": "https://api.github.com/repos/rust-lang/rust/commits/dcbaa75bc14c69ab060bffe9b108cb55b325b121", "html_url": "https://github.com/rust-lang/rust/commit/dcbaa75bc14c69ab060bffe9b108cb55b325b121"}], "stats": {"total": 34, "additions": 20, "deletions": 14}, "files": [{"sha": "abd28e6182c0e7d3b9defc1e551ca0a56dc563ac", "filename": "crates/proc_macro_api/src/version.rs", "status": "modified", "additions": 20, "deletions": 14, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/2bfaffbf8227fbfe99b80d1fdd87163bb7051014/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2bfaffbf8227fbfe99b80d1fdd87163bb7051014/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc_macro_api%2Fsrc%2Fversion.rs?ref=2bfaffbf8227fbfe99b80d1fdd87163bb7051014", "patch": "@@ -14,8 +14,8 @@ use snap::read::FrameDecoder as SnapDecoder;\n pub struct RustCInfo {\n     pub version: (usize, usize, usize),\n     pub channel: String,\n-    pub commit: String,\n-    pub date: String,\n+    pub commit: Option<String>,\n+    pub date: Option<String>,\n }\n \n /// Read rustc dylib information\n@@ -38,18 +38,24 @@ pub fn read_dylib_info(dylib_path: &AbsPath) -> io::Result<RustCInfo> {\n     let version = version_parts.next().ok_or_else(|| err!(\"no version\"))?;\n     let channel = version_parts.next().unwrap_or_default().to_string();\n \n-    let commit = items.next().ok_or_else(|| err!(\"no commit info\"))?;\n-    // remove (\n-    if commit.len() == 0 {\n-        return Err(err!(\"commit format error\"));\n-    }\n-    let commit = commit[1..].to_string();\n-    let date = items.next().ok_or_else(|| err!(\"no date info\"))?;\n-    // remove )\n-    if date.len() == 0 {\n-        return Err(err!(\"date format error\"));\n-    }\n-    let date = date[0..date.len() - 2].to_string();\n+    let commit = match items.next() {\n+        Some(commit) => {\n+            match commit.len() {\n+                0 => None,\n+                _ => Some(commit[1..].to_string() /* remove ( */)\n+            }\n+        },\n+        None => None\n+    };\n+    let date = match items.next() {\n+        Some(date) => {\n+            match date.len() {\n+                0 => None,\n+                _ => Some(date[0..date.len() - 2].to_string() /* remove ) */)\n+            }\n+        },\n+        None => None\n+    };\n \n     let version_numbers = version\n         .split('.')"}]}