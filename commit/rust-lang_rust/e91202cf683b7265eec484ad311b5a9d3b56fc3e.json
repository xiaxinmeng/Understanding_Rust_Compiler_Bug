{"sha": "e91202cf683b7265eec484ad311b5a9d3b56fc3e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5MTIwMmNmNjgzYjcyNjVlZWM0ODRhZDMxMWI1YTlkM2I1NmZjM2U=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2020-10-02T03:43:43Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2020-10-02T05:02:58Z"}, "message": "Allow exponent separator\n\nFixes #6096", "tree": {"sha": "875de622e24df433d3ad106eb1b3ad56ebd3285d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/875de622e24df433d3ad106eb1b3ad56ebd3285d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e91202cf683b7265eec484ad311b5a9d3b56fc3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e91202cf683b7265eec484ad311b5a9d3b56fc3e", "html_url": "https://github.com/rust-lang/rust/commit/e91202cf683b7265eec484ad311b5a9d3b56fc3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e91202cf683b7265eec484ad311b5a9d3b56fc3e/comments", "author": null, "committer": null, "parents": [{"sha": "8c9800a3a9026aa3cc1071276d0672585ba2175e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c9800a3a9026aa3cc1071276d0672585ba2175e", "html_url": "https://github.com/rust-lang/rust/commit/8c9800a3a9026aa3cc1071276d0672585ba2175e"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "52d3c2c1daf0961dec0f4af9f5efb565a9d6b14b", "filename": "clippy_lints/src/utils/numeric_literal.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/e91202cf683b7265eec484ad311b5a9d3b56fc3e/clippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e91202cf683b7265eec484ad311b5a9d3b56fc3e/clippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs?ref=e91202cf683b7265eec484ad311b5a9d3b56fc3e", "patch": "@@ -36,8 +36,9 @@ pub struct NumericLiteral<'a> {\n     pub integer: &'a str,\n     /// The fraction part of the number.\n     pub fraction: Option<&'a str>,\n-    /// The character used as exponent separator (b'e' or b'E') and the exponent part.\n-    pub exponent: Option<(char, &'a str)>,\n+    /// The exponent separator (b'e' or b'E') including preceding underscore if present\n+    /// and the exponent part.\n+    pub exponent: Option<(&'a str, &'a str)>,\n \n     /// The type suffix, including preceding underscore if present.\n     pub suffix: Option<&'a str>,\n@@ -100,7 +101,7 @@ impl<'a> NumericLiteral<'a> {\n         self.radix == Radix::Decimal\n     }\n \n-    pub fn split_digit_parts(digits: &str, float: bool) -> (&str, Option<&str>, Option<(char, &str)>) {\n+    pub fn split_digit_parts(digits: &str, float: bool) -> (&str, Option<&str>, Option<(&str, &str)>) {\n         let mut integer = digits;\n         let mut fraction = None;\n         let mut exponent = None;\n@@ -113,12 +114,14 @@ impl<'a> NumericLiteral<'a> {\n                         fraction = Some(&digits[i + 1..]);\n                     },\n                     'e' | 'E' => {\n-                        if integer.len() > i {\n-                            integer = &digits[..i];\n+                        let exp_start = if digits[..i].ends_with('_') { i - 1 } else { i };\n+\n+                        if integer.len() > exp_start {\n+                            integer = &digits[..exp_start];\n                         } else {\n-                            fraction = Some(&digits[integer.len() + 1..i]);\n+                            fraction = Some(&digits[integer.len() + 1..exp_start]);\n                         };\n-                        exponent = Some((c, &digits[i + 1..]));\n+                        exponent = Some((&digits[exp_start..=i], &digits[i + 1..]));\n                         break;\n                     },\n                     _ => {},\n@@ -153,7 +156,7 @@ impl<'a> NumericLiteral<'a> {\n         }\n \n         if let Some((separator, exponent)) = self.exponent {\n-            output.push(separator);\n+            output.push_str(separator);\n             Self::group_digits(&mut output, exponent, group_size, true, false);\n         }\n "}, {"sha": "dd683e7f746a48ec16bc0acb3a0bc775f4a4ac22", "filename": "tests/ui/inconsistent_digit_grouping.fixed", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e91202cf683b7265eec484ad311b5a9d3b56fc3e/tests%2Fui%2Finconsistent_digit_grouping.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/e91202cf683b7265eec484ad311b5a9d3b56fc3e/tests%2Fui%2Finconsistent_digit_grouping.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finconsistent_digit_grouping.fixed?ref=e91202cf683b7265eec484ad311b5a9d3b56fc3e", "patch": "@@ -40,4 +40,8 @@ fn main() {\n     // Ignore literals in macros\n     let _ = mac1!();\n     let _ = mac2!();\n+\n+    // Issue #6096\n+    // Allow separating exponent with '_'\n+    let _ = 1.025_011_10_E0;\n }"}, {"sha": "d5d27c853c28d516667619eea792856394259ac3", "filename": "tests/ui/inconsistent_digit_grouping.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e91202cf683b7265eec484ad311b5a9d3b56fc3e/tests%2Fui%2Finconsistent_digit_grouping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e91202cf683b7265eec484ad311b5a9d3b56fc3e/tests%2Fui%2Finconsistent_digit_grouping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finconsistent_digit_grouping.rs?ref=e91202cf683b7265eec484ad311b5a9d3b56fc3e", "patch": "@@ -40,4 +40,8 @@ fn main() {\n     // Ignore literals in macros\n     let _ = mac1!();\n     let _ = mac2!();\n+\n+    // Issue #6096\n+    // Allow separating exponent with '_'\n+    let _ = 1.025_011_10_E0;\n }"}]}