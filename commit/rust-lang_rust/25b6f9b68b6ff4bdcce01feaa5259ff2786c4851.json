{"sha": "25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "node_id": "C_kwDOAAsO6NoAKDI1YjZmOWI2OGI2ZmY0YmRjY2UwMWZlYWE1MjU5ZmYyNzg2YzQ4NTE", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-09-28T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-09-28T00:00:00Z"}, "message": "print-type-sizes: skip field printing for primitives", "tree": {"sha": "e9bb1d7724e40a72ed2afb80d78681091d97f9da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9bb1d7724e40a72ed2afb80d78681091d97f9da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "html_url": "https://github.com/rust-lang/rust/commit/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d71ba862309d59df710078a845c8772ffb22aba", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d71ba862309d59df710078a845c8772ffb22aba", "html_url": "https://github.com/rust-lang/rust/commit/1d71ba862309d59df710078a845c8772ffb22aba"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "2c3c21e7a393b1c07075845f2454db3af6d4c9c4", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "patch": "@@ -1805,8 +1805,11 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n \n         match layout.variants {\n             Variants::Single { index } => {\n-                debug!(\"print-type-size `{:#?}` variant {}\", layout, adt_def.variants[index].ident);\n-                if !adt_def.variants.is_empty() {\n+                if !adt_def.variants.is_empty() && layout.fields != FieldsShape::Primitive {\n+                    debug!(\n+                        \"print-type-size `{:#?}` variant {}\",\n+                        layout, adt_def.variants[index].ident\n+                    );\n                     let variant_def = &adt_def.variants[index];\n                     let fields: Vec<_> = variant_def.fields.iter().map(|f| f.ident.name).collect();\n                     record("}, {"sha": "06a62db4ebb0f37014d835f0e71fc2f2fe85ad25", "filename": "src/test/ui/print_type_sizes/uninhabited.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.rs?ref=25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "patch": "@@ -11,5 +11,5 @@\n fn start(_: isize, _: *const *const u8) -> isize {\n     let _x: Option<!> = None;\n     let _y: Result<u32, !> = Ok(42);\n-    0\n+    let _z: Result<!, !> = loop {};\n }"}, {"sha": "5eb5384bce34060023359990010bc47617a2e145", "filename": "src/test/ui/print_type_sizes/uninhabited.stdout", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/25b6f9b68b6ff4bdcce01feaa5259ff2786c4851/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprint_type_sizes%2Funinhabited.stdout?ref=25b6f9b68b6ff4bdcce01feaa5259ff2786c4851", "patch": "@@ -3,3 +3,4 @@ print-type-size     variant `Ok`: 4 bytes\n print-type-size         field `.0`: 4 bytes\n print-type-size type: `std::option::Option<!>`: 0 bytes, alignment: 1 bytes\n print-type-size     variant `None`: 0 bytes\n+print-type-size type: `std::result::Result<!, !>`: 0 bytes, alignment: 1 bytes"}]}