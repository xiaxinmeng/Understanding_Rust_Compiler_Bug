{"sha": "11331b1030fba551df4c7fc2babd44496040030f", "node_id": "C_kwDOAAsO6NoAKDExMzMxYjEwMzBmYmE1NTFkZjRjN2ZjMmJhYmQ0NDQ5NjA0MDAzMGY", "commit": {"author": {"name": "Tomer Zeitune", "email": "tomerzeitune@gmail.com", "date": "2022-11-26T22:35:52Z"}, "committer": {"name": "Tomer Zeitune", "email": "tomerzeitune@gmail.com", "date": "2022-12-14T17:37:28Z"}, "message": "Enable atomic cas for bpf targets", "tree": {"sha": "6a85fb1133915c03c98a12f5f77f34eb83acfd6b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a85fb1133915c03c98a12f5f77f34eb83acfd6b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11331b1030fba551df4c7fc2babd44496040030f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11331b1030fba551df4c7fc2babd44496040030f", "html_url": "https://github.com/rust-lang/rust/commit/11331b1030fba551df4c7fc2babd44496040030f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11331b1030fba551df4c7fc2babd44496040030f/comments", "author": {"login": "tomerze", "id": 45238974, "node_id": "MDQ6VXNlcjQ1MjM4OTc0", "avatar_url": "https://avatars.githubusercontent.com/u/45238974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomerze", "html_url": "https://github.com/tomerze", "followers_url": "https://api.github.com/users/tomerze/followers", "following_url": "https://api.github.com/users/tomerze/following{/other_user}", "gists_url": "https://api.github.com/users/tomerze/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomerze/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomerze/subscriptions", "organizations_url": "https://api.github.com/users/tomerze/orgs", "repos_url": "https://api.github.com/users/tomerze/repos", "events_url": "https://api.github.com/users/tomerze/events{/privacy}", "received_events_url": "https://api.github.com/users/tomerze/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tomerze", "id": 45238974, "node_id": "MDQ6VXNlcjQ1MjM4OTc0", "avatar_url": "https://avatars.githubusercontent.com/u/45238974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomerze", "html_url": "https://github.com/tomerze", "followers_url": "https://api.github.com/users/tomerze/followers", "following_url": "https://api.github.com/users/tomerze/following{/other_user}", "gists_url": "https://api.github.com/users/tomerze/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomerze/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomerze/subscriptions", "organizations_url": "https://api.github.com/users/tomerze/orgs", "repos_url": "https://api.github.com/users/tomerze/repos", "events_url": "https://api.github.com/users/tomerze/events{/privacy}", "received_events_url": "https://api.github.com/users/tomerze/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba64ba8b0dfd57f7d6d7399d0df7ded37d2af18d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba64ba8b0dfd57f7d6d7399d0df7ded37d2af18d", "html_url": "https://github.com/rust-lang/rust/commit/ba64ba8b0dfd57f7d6d7399d0df7ded37d2af18d"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "2b00cda44b511372a33ba51c89c95eb721fcd249", "filename": "compiler/rustc_target/src/spec/bpf_base.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/11331b1030fba551df4c7fc2babd44496040030f/compiler%2Frustc_target%2Fsrc%2Fspec%2Fbpf_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11331b1030fba551df4c7fc2babd44496040030f/compiler%2Frustc_target%2Fsrc%2Fspec%2Fbpf_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fbpf_base.rs?ref=11331b1030fba551df4c7fc2babd44496040030f", "patch": "@@ -6,7 +6,7 @@ pub fn opts(endian: Endian) -> TargetOptions {\n         allow_asm: true,\n         endian,\n         linker_flavor: LinkerFlavor::Bpf,\n-        atomic_cas: false,\n+        atomic_cas: true,\n         dynamic_linking: true,\n         no_builtins: true,\n         panic_strategy: PanicStrategy::Abort,\n@@ -19,6 +19,10 @@ pub fn opts(endian: Endian) -> TargetOptions {\n         obj_is_bitcode: true,\n         requires_lto: false,\n         singlethread: true,\n+        // When targeting the `v3` cpu in llvm, 32-bit atomics are also supported.\n+        // But making this value change based on the target cpu can be mostly confusing\n+        // and would require a bit of a refactor.\n+        min_atomic_width: Some(64),\n         max_atomic_width: Some(64),\n         ..Default::default()\n     }"}]}