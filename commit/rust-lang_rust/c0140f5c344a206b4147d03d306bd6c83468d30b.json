{"sha": "c0140f5c344a206b4147d03d306bd6c83468d30b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwMTQwZjVjMzQ0YTIwNmI0MTQ3ZDAzZDMwNmJkNmM4MzQ2OGQzMGI=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-15T21:28:52Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-08-15T21:57:45Z"}, "message": "Reject empty matches on inhabited types\n\nCloses #3096", "tree": {"sha": "4d2dcd5fb38d06b640c8bc7ee742959119ee1257", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d2dcd5fb38d06b640c8bc7ee742959119ee1257"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0140f5c344a206b4147d03d306bd6c83468d30b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0140f5c344a206b4147d03d306bd6c83468d30b", "html_url": "https://github.com/rust-lang/rust/commit/c0140f5c344a206b4147d03d306bd6c83468d30b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0140f5c344a206b4147d03d306bd6c83468d30b/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a83414b6e8879b2485374469f7f5fe60f22ae936", "url": "https://api.github.com/repos/rust-lang/rust/commits/a83414b6e8879b2485374469f7f5fe60f22ae936", "html_url": "https://github.com/rust-lang/rust/commit/a83414b6e8879b2485374469f7f5fe60f22ae936"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "66216b523cb48897e310fd107c1f5c4b7b47e6fb", "filename": "src/rustc/middle/check_alt.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Frustc%2Fmiddle%2Fcheck_alt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Frustc%2Fmiddle%2Fcheck_alt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Fcheck_alt.rs?ref=c0140f5c344a206b4147d03d306bd6c83468d30b", "patch": "@@ -4,6 +4,7 @@ import const_eval::{eval_const_expr, const_val, const_int,\n                     compare_const_vals};\n import syntax::codemap::span;\n import syntax::print::pprust::pat_to_str;\n+import util::ppaux::ty_to_str;\n import pat_util::*;\n import syntax::visit;\n import driver::session::session;\n@@ -29,10 +30,15 @@ fn check_expr(tcx: ty::ctxt, ex: @expr, &&s: (), v: visit::vt<()>) {\n          // Check for empty enum, because is_useful only works on inhabited\n          // types.\n        let pat_ty = node_id_to_type(tcx, scrut.id);\n-       if type_is_empty(tcx, pat_ty) && arms.is_empty() {\n-               // Vacuously exhaustive\n-               return;\n+       if arms.is_empty() {\n+           if !type_is_empty(tcx, pat_ty) {\n+               // We know the type is inhabited, so this must be wrong\n+               tcx.sess.span_err(ex.span, #fmt(\"non-exhaustive patterns: \\\n+                             type %s is non-empty\", ty_to_str(tcx, pat_ty)));\n            }\n+           // If the type *is* empty, it's vacuously exhaustive\n+           return;\n+       }\n        match ty::get(pat_ty).struct {\n           ty_enum(did, _) => {\n               if (*enum_variants(tcx, did)).is_empty() && arms.is_empty() {"}, {"sha": "edc3b322305c8379e27ba2f9b3013572b03f8ba2", "filename": "src/test/compile-fail/issue-3096-1.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Ftest%2Fcompile-fail%2Fissue-3096-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Ftest%2Fcompile-fail%2Fissue-3096-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-3096-1.rs?ref=c0140f5c344a206b4147d03d306bd6c83468d30b", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    match () { } //~ ERROR non-exhaustive\n+}"}, {"sha": "cd3d63b588894ab0345cb80e7d19b71500505913", "filename": "src/test/compile-fail/issue-3096-2.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Ftest%2Fcompile-fail%2Fissue-3096-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0140f5c344a206b4147d03d306bd6c83468d30b/src%2Ftest%2Fcompile-fail%2Fissue-3096-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-3096-2.rs?ref=c0140f5c344a206b4147d03d306bd6c83468d30b", "patch": "@@ -0,0 +1,6 @@\n+enum bottom { } \n+\n+fn main() {\n+    let x = ptr::addr_of(()) as *bottom;\n+    match x { } //~ ERROR non-exhaustive patterns\n+}"}]}