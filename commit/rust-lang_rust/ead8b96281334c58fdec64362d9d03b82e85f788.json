{"sha": "ead8b96281334c58fdec64362d9d03b82e85f788", "node_id": "C_kwDOAAsO6NoAKGVhZDhiOTYyODEzMzRjNThmZGVjNjQzNjJkOWQwM2I4MmU4NWY3ODg", "commit": {"author": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2023-03-08T11:14:19Z"}, "committer": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2023-03-08T11:14:19Z"}, "message": "set LIBC_CHECK_CFG=1 when building Rust code in bootstrap", "tree": {"sha": "2b05424a13b54c7fdfe69c72b557421ed29828a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b05424a13b54c7fdfe69c72b557421ed29828a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ead8b96281334c58fdec64362d9d03b82e85f788", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMycKYjxLY0eb13b7zXazX3c0dp4FAmQIbisACgkQzXazX3c0\ndp5I7Q//RSrB4rCJQ1mif0iIv2aJ/E+1jmlrlvwh62JBgNMlXR80a/AEM22szWkJ\nhVut0IrmS7V873lik+CMGgA87rX7Y8RAagUdYwbl+Eev30ep4haIg1EgpwNBoT5q\nlOGVgTiHESL1cGQWXiAB1CI/E3QY/TpEp3aUI7iT0ZJikWRcsdYnCpmCRWg8PxTJ\nnr6txgDXzThQ1Kgig/OKhwFWBeZdaR6V4NGSAN7KVv83/pfhwxIL4O2QvRUXfcN9\niiuVMBrs8SRHBYZEzY82fAGSXpQpU09GyVt71iSDDg/SpWX7Yy5GqMqv1RUAY8K1\nIawMxSj7qRNm75z8x6XhPSA5QXBzi/cIZzANFkmB7kaZy9EFdLlhwY1ru6v8PPgQ\nNGMaDxckiA0+Y2ijQIY7QbPo7ktLc2GkFLOCgMLkEMU5IF/+snZsUba2shJklJ26\n3g4X0Y+gHxtkEW3SNDnUrExYARiY/UadsxdolcuI1b2mZ6X0PYDuYZ2ZrYtfOjid\nV/4A9rY9WORwHA0Mql2vz64jX15tTb45sZ3J23IwZyNJejUzd0qmyoaUJsMcpuyq\nbrt0yOtdaDtE16jFf4VJ1IFWmBiVzGPBl+zcPMBkBF+HtCBMAPXdUVSKLD/Evp1h\ngRY8g/RbsrVleWxkeYwmWQXoNWSmblhos+Mwunos6oj8kigyVSE=\n=i5Z9\n-----END PGP SIGNATURE-----", "payload": "tree 2b05424a13b54c7fdfe69c72b557421ed29828a9\nparent 64165aac68af780182ff89a6eb3982e3c262266e\nauthor Pietro Albini <pietro.albini@ferrous-systems.com> 1678274059 +0100\ncommitter Pietro Albini <pietro.albini@ferrous-systems.com> 1678274059 +0100\n\nset LIBC_CHECK_CFG=1 when building Rust code in bootstrap\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ead8b96281334c58fdec64362d9d03b82e85f788", "html_url": "https://github.com/rust-lang/rust/commit/ead8b96281334c58fdec64362d9d03b82e85f788", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ead8b96281334c58fdec64362d9d03b82e85f788/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64165aac68af780182ff89a6eb3982e3c262266e", "url": "https://api.github.com/repos/rust-lang/rust/commits/64165aac68af780182ff89a6eb3982e3c262266e", "html_url": "https://github.com/rust-lang/rust/commit/64165aac68af780182ff89a6eb3982e3c262266e"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "9beccd4f8f2b698712d75ce2951724b246b56aea", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ead8b96281334c58fdec64362d9d03b82e85f788/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ead8b96281334c58fdec64362d9d03b82e85f788/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=ead8b96281334c58fdec64362d9d03b82e85f788", "patch": "@@ -1718,6 +1718,15 @@ impl<'a> Builder<'a> {\n \n         cargo.env(\"RUSTC_VERBOSE\", self.verbosity.to_string());\n \n+        // Downstream forks of the Rust compiler might want to use a custom libc to add support for\n+        // targets that are not yet available upstream. Adding a patch to replace libc with a\n+        // custom one would cause compilation errors though, because Cargo would interpret the\n+        // custom libc as part of the workspace, and apply the check-cfg lints on it.\n+        //\n+        // The libc build script emits check-cfg flags only when this environment variable is set,\n+        // so this line allows the use of custom libcs.\n+        cargo.env(\"LIBC_CHECK_CFG\", \"1\");\n+\n         if source_type == SourceType::InTree {\n             let mut lint_flags = Vec::new();\n             // When extending this list, add the new lints to the RUSTFLAGS of the"}]}