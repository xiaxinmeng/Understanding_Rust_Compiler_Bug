{"sha": "2f681bf6024b551c2bea777ae6df3e6fafaa985f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmNjgxYmY2MDI0YjU1MWMyYmVhNzc3YWU2ZGYzZTZmYWZhYTk4NWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-09-05T02:21:02Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-09-05T02:21:02Z"}, "message": "Auto merge of #44248 - oli-obk:spans, r=jseyfried\n\nProduce expansion info for more builtin macros\n\nr? @jseyfried\n\nfixes #43268", "tree": {"sha": "f86356dee9c0b35ab994159bd57696acfe45234f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f86356dee9c0b35ab994159bd57696acfe45234f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f681bf6024b551c2bea777ae6df3e6fafaa985f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f681bf6024b551c2bea777ae6df3e6fafaa985f", "html_url": "https://github.com/rust-lang/rust/commit/2f681bf6024b551c2bea777ae6df3e6fafaa985f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f681bf6024b551c2bea777ae6df3e6fafaa985f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22d65983b9b9ef4300bc84926c0ae8e1ec1897dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/22d65983b9b9ef4300bc84926c0ae8e1ec1897dd", "html_url": "https://github.com/rust-lang/rust/commit/22d65983b9b9ef4300bc84926c0ae8e1ec1897dd"}, {"sha": "c4d5a1e17ba26ef3c049548470f85538eb94edfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4d5a1e17ba26ef3c049548470f85538eb94edfc", "html_url": "https://github.com/rust-lang/rust/commit/c4d5a1e17ba26ef3c049548470f85538eb94edfc"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "780d34d570170247f5faf8ffb64114afa02f52cd", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -44,7 +44,7 @@ use std::collections::HashSet;\n use syntax::ast;\n use syntax::attr;\n use syntax::feature_gate::{AttributeGate, AttributeType, Stability, deprecated_attributes};\n-use syntax_pos::Span;\n+use syntax_pos::{Span, SyntaxContext};\n use syntax::symbol::keywords;\n \n use rustc::hir::{self, PatKind};\n@@ -75,9 +75,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for WhileTrue {\n         if let hir::ExprWhile(ref cond, ..) = e.node {\n             if let hir::ExprLit(ref lit) = cond.node {\n                 if let ast::LitKind::Bool(true) = lit.node {\n-                    cx.span_lint(WHILE_TRUE,\n-                                 e.span,\n-                                 \"denote infinite loops with loop { ... }\");\n+                    if lit.span.ctxt() == SyntaxContext::empty() {\n+                        cx.span_lint(WHILE_TRUE,\n+                                    e.span,\n+                                    \"denote infinite loops with loop { ... }\");\n+                    }\n                 }\n             }\n         }"}, {"sha": "1d8dc4064685bdc06a34e2d70e150c2ad172c670", "filename": "src/libsyntax_ext/cfg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fcfg.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -24,6 +24,7 @@ pub fn expand_cfg<'cx>(cx: &mut ExtCtxt,\n                        sp: Span,\n                        tts: &[tokenstream::TokenTree])\n                        -> Box<base::MacResult + 'static> {\n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     let mut p = cx.new_parser_from_tts(tts);\n     let cfg = panictry!(p.parse_meta_item());\n "}, {"sha": "c79e7867c5f5ef8602bdd2defde8642ba5b8b0cb", "filename": "src/libsyntax_ext/concat.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fconcat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fconcat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fconcat.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -57,5 +57,6 @@ pub fn expand_syntax_ext(cx: &mut base::ExtCtxt,\n             }\n         }\n     }\n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     base::MacEager::expr(cx.expr_str(sp, Symbol::intern(&accumulator)))\n }"}, {"sha": "8d0104e512bfb41cee35e57c50110faab655fcdf", "filename": "src/libsyntax_ext/concat_idents.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fconcat_idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fconcat_idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fconcat_idents.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -92,6 +92,6 @@ pub fn expand_syntax_ext<'cx>(cx: &'cx mut ExtCtxt,\n \n     Box::new(Result {\n         ident: res,\n-        span: sp,\n+        span: sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark)),\n     })\n }"}, {"sha": "fcad065be52bcaf1868a5594dc95e1ea5d89fea5", "filename": "src/libsyntax_ext/env.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Flibsyntax_ext%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fenv.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -32,6 +32,7 @@ pub fn expand_option_env<'cx>(cx: &'cx mut ExtCtxt,\n         Some(v) => v,\n     };\n \n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     let e = match env::var(&*var.as_str()) {\n         Err(..) => {\n             cx.expr_path(cx.path_all(sp,"}, {"sha": "54a720d75b5ad1a067a78c1c53bf12ec79a70f99", "filename": "src/test/compile-fail/lint-impl-fn.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f681bf6024b551c2bea777ae6df3e6fafaa985f/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs?ref=2f681bf6024b551c2bea777ae6df3e6fafaa985f", "patch": "@@ -36,3 +36,8 @@ mod foo {\n fn main() {\n     while true {} //~ ERROR: infinite loops\n }\n+\n+#[deny(while_true)]\n+fn bar() {\n+    while cfg!(unix) {} // no error\n+}"}]}