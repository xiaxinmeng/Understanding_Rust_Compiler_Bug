{"sha": "76bf3454da405fb3ccd56fca49a8423f2b72c40f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2YmYzNDU0ZGE0MDVmYjNjY2Q1NmZjYTQ5YTg0MjNmMmI3MmM0MGY=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-05-13T00:50:39Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-05-17T20:13:09Z"}, "message": "Keep crate edition in metadata", "tree": {"sha": "1d2d175c28b101a4e9d0fb007a6b0a9ec5c1324e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d2d175c28b101a4e9d0fb007a6b0a9ec5c1324e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76bf3454da405fb3ccd56fca49a8423f2b72c40f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76bf3454da405fb3ccd56fca49a8423f2b72c40f", "html_url": "https://github.com/rust-lang/rust/commit/76bf3454da405fb3ccd56fca49a8423f2b72c40f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76bf3454da405fb3ccd56fca49a8423f2b72c40f/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd4925d1b832f30e07b124b96534ceb199c07ec1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd4925d1b832f30e07b124b96534ceb199c07ec1", "html_url": "https://github.com/rust-lang/rust/commit/cd4925d1b832f30e07b124b96534ceb199c07ec1"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "518021f412574dcb73c849f370f31f0a2181a9a3", "filename": "src/librustc/middle/cstore.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcstore.rs?ref=76bf3454da405fb3ccd56fca49a8423f2b72c40f", "patch": "@@ -34,6 +34,7 @@ use session::search_paths::PathKind;\n use std::any::Any;\n use std::path::{Path, PathBuf};\n use syntax::ast;\n+use syntax::edition::Edition;\n use syntax::ext::base::SyntaxExtension;\n use syntax::symbol::Symbol;\n use syntax_pos::Span;\n@@ -235,6 +236,7 @@ pub trait CrateStore {\n     fn crate_name_untracked(&self, cnum: CrateNum) -> Symbol;\n     fn crate_disambiguator_untracked(&self, cnum: CrateNum) -> CrateDisambiguator;\n     fn crate_hash_untracked(&self, cnum: CrateNum) -> Svh;\n+    fn crate_edition_untracked(&self, cnum: CrateNum) -> Edition;\n     fn struct_field_names_untracked(&self, def: DefId) -> Vec<ast::Name>;\n     fn item_children_untracked(&self, did: DefId, sess: &Session) -> Vec<def::Export>;\n     fn load_macro_untracked(&self, did: DefId, sess: &Session) -> LoadedMacro;\n@@ -309,6 +311,7 @@ impl CrateStore for DummyCrateStore {\n         bug!(\"crate_disambiguator\")\n     }\n     fn crate_hash_untracked(&self, cnum: CrateNum) -> Svh { bug!(\"crate_hash\") }\n+    fn crate_edition_untracked(&self, cnum: CrateNum) -> Edition { bug!(\"crate_edition_untracked\") }\n \n     // resolve\n     fn def_key(&self, def: DefId) -> DefKey { bug!(\"def_key\") }"}, {"sha": "f2d2d090e0ab38cd1effe3ac7c6b8704ddc2b4f5", "filename": "src/librustc_metadata/cstore.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcstore.rs?ref=76bf3454da405fb3ccd56fca49a8423f2b72c40f", "patch": "@@ -24,6 +24,7 @@ use rustc::util::nodemap::{FxHashMap, NodeMap};\n \n use rustc_data_structures::sync::{Lrc, RwLock, Lock};\n use syntax::{ast, attr};\n+use syntax::edition::Edition;\n use syntax::ext::base::SyntaxExtension;\n use syntax::symbol::Symbol;\n use syntax_pos;\n@@ -234,4 +235,8 @@ impl CrateMetadata {\n     pub fn panic_strategy(&self) -> PanicStrategy {\n         self.root.panic_strategy.clone()\n     }\n+\n+    pub fn edition(&self) -> Edition {\n+        self.root.edition\n+    }\n }"}, {"sha": "22b574e75b2e020302a2d0220db69fc1ac637903", "filename": "src/librustc_metadata/cstore_impl.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcstore_impl.rs?ref=76bf3454da405fb3ccd56fca49a8423f2b72c40f", "patch": "@@ -38,6 +38,7 @@ use std::sync::Arc;\n use syntax::ast;\n use syntax::attr;\n use syntax::codemap;\n+use syntax::edition::Edition;\n use syntax::ext::base::SyntaxExtension;\n use syntax::parse::filemap_to_stream;\n use syntax::symbol::Symbol;\n@@ -464,6 +465,11 @@ impl CrateStore for cstore::CStore {\n         self.get_crate_data(cnum).hash()\n     }\n \n+    fn crate_edition_untracked(&self, cnum: CrateNum) -> Edition\n+    {\n+        self.get_crate_data(cnum).edition()\n+    }\n+\n     /// Returns the `DefKey` for a given `DefId`. This indicates the\n     /// parent `DefId` as well as some idea of what kind of data the\n     /// `DefId` refers to."}, {"sha": "d00f4f32c109f61422897b952a563147b8976575", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=76bf3454da405fb3ccd56fca49a8423f2b72c40f", "patch": "@@ -44,7 +44,7 @@ use syntax::ast::{self, CRATE_NODE_ID};\n use syntax::codemap::Spanned;\n use syntax::attr;\n use syntax::symbol::Symbol;\n-use syntax_pos::{self, FileName, FileMap, Span, DUMMY_SP};\n+use syntax_pos::{self, hygiene, FileName, FileMap, Span, DUMMY_SP};\n \n use rustc::hir::{self, PatKind};\n use rustc::hir::itemlikevisit::ItemLikeVisitor;\n@@ -496,6 +496,7 @@ impl<'a, 'tcx> EncodeContext<'a, 'tcx> {\n             hash: link_meta.crate_hash,\n             disambiguator: tcx.sess.local_crate_disambiguator(),\n             panic_strategy: tcx.sess.panic_strategy(),\n+            edition: hygiene::default_edition(),\n             has_global_allocator: has_global_allocator,\n             has_default_lib_allocator: has_default_lib_allocator,\n             plugin_registrar_fn: tcx.sess"}, {"sha": "8e17b7f8d692d94194627f66d56342a4c1bb9682", "filename": "src/librustc_metadata/schema.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fschema.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76bf3454da405fb3ccd56fca49a8423f2b72c40f/src%2Flibrustc_metadata%2Fschema.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fschema.rs?ref=76bf3454da405fb3ccd56fca49a8423f2b72c40f", "patch": "@@ -23,6 +23,7 @@ use rustc_target::spec::{PanicStrategy, TargetTriple};\n \n use rustc_serialize as serialize;\n use syntax::{ast, attr};\n+use syntax::edition::Edition;\n use syntax::symbol::Symbol;\n use syntax_pos::{self, Span};\n \n@@ -189,6 +190,7 @@ pub struct CrateRoot {\n     pub hash: hir::svh::Svh,\n     pub disambiguator: CrateDisambiguator,\n     pub panic_strategy: PanicStrategy,\n+    pub edition: Edition,\n     pub has_global_allocator: bool,\n     pub has_default_lib_allocator: bool,\n     pub plugin_registrar_fn: Option<DefIndex>,"}]}