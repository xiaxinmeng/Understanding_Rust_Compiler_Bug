{"sha": "862c99d0d5ef7c791a9319fa76c436762d88460c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2MmM5OWQwZDVlZjdjNzkxYTkzMTlmYTc2YzQzNjc2MmQ4ODQ2MGM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-31T16:06:00Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-31T16:06:00Z"}, "message": "generalize highlighting to work with nodes", "tree": {"sha": "8430cf52c1d20f32b675274422c3fa97dab841b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8430cf52c1d20f32b675274422c3fa97dab841b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/862c99d0d5ef7c791a9319fa76c436762d88460c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/862c99d0d5ef7c791a9319fa76c436762d88460c", "html_url": "https://github.com/rust-lang/rust/commit/862c99d0d5ef7c791a9319fa76c436762d88460c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/862c99d0d5ef7c791a9319fa76c436762d88460c/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1e8ebfbeb5f84405fb609e3841df02e270037c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1e8ebfbeb5f84405fb609e3841df02e270037c4", "html_url": "https://github.com/rust-lang/rust/commit/f1e8ebfbeb5f84405fb609e3841df02e270037c4"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "7e9139a740699ba2d60b767d7ce8676af31ba811", "filename": "crates/ra_analysis/src/syntax_highlighting.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/862c99d0d5ef7c791a9319fa76c436762d88460c/crates%2Fra_analysis%2Fsrc%2Fsyntax_highlighting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/862c99d0d5ef7c791a9319fa76c436762d88460c/crates%2Fra_analysis%2Fsrc%2Fsyntax_highlighting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fsyntax_highlighting.rs?ref=862c99d0d5ef7c791a9319fa76c436762d88460c", "patch": "@@ -9,14 +9,14 @@ use crate::{\n \n pub(crate) fn highlight(db: &RootDatabase, file_id: FileId) -> Cancelable<Vec<HighlightedRange>> {\n     let source_file = db.source_file(file_id);\n-    let mut res = ra_editor::highlight(&source_file);\n+    let mut res = ra_editor::highlight(source_file.syntax());\n     for macro_call in source_file\n         .syntax()\n         .descendants()\n         .filter_map(ast::MacroCall::cast)\n     {\n         if let Some(exp) = crate::macros::expand(db, file_id, macro_call) {\n-            let mapped_ranges = ra_editor::highlight(exp.source_file())\n+            let mapped_ranges = ra_editor::highlight(exp.source_file().syntax())\n                 .into_iter()\n                 .filter_map(|r| {\n                     let mapped_range = exp.map_range_back(r.range)?;"}, {"sha": "a293fec345f2047acebbdff5e8f2e6958aa04d07", "filename": "crates/ra_editor/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/862c99d0d5ef7c791a9319fa76c436762d88460c/crates%2Fra_editor%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/862c99d0d5ef7c791a9319fa76c436762d88460c/crates%2Fra_editor%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Flib.rs?ref=862c99d0d5ef7c791a9319fa76c436762d88460c", "patch": "@@ -79,11 +79,11 @@ pub fn matching_brace(file: &SourceFileNode, offset: TextUnit) -> Option<TextUni\n     Some(matching_node.range().start())\n }\n \n-pub fn highlight(file: &SourceFileNode) -> Vec<HighlightedRange> {\n+pub fn highlight(root: SyntaxNodeRef) -> Vec<HighlightedRange> {\n     // Visited nodes to handle highlighting priorities\n     let mut highlighted = FxHashSet::default();\n     let mut res = Vec::new();\n-    for node in file.syntax().descendants() {\n+    for node in root.descendants() {\n         if highlighted.contains(&node) {\n             continue;\n         }\n@@ -178,7 +178,7 @@ fn main() {}\n     println!(\"Hello, {}!\", 92);\n \"#,\n         );\n-        let hls = highlight(&file);\n+        let hls = highlight(file.syntax());\n         assert_eq_dbg(\n             r#\"[HighlightedRange { range: [1; 11), tag: \"comment\" },\n                 HighlightedRange { range: [12; 14), tag: \"keyword\" },"}]}