{"sha": "23408de992598d89bf6ed697b4b86bbefc0f2df0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzNDA4ZGU5OTI1OThkODliZjZlZDY5N2I0Yjg2YmJlZmMwZjJkZjA=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-02T22:31:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-02T22:31:16Z"}, "message": "Rollup merge of #77421 - petrochenkov:globtravel, r=nagisa\n\nRevert \"resolve: Avoid \"self-confirming\" import resolutions in one more case\"\n\nAnd remove the assert that https://github.com/rust-lang/rust/pull/70236 tried to avoid instead.\n\nCloses https://github.com/rust-lang/rust/issues/74556.", "tree": {"sha": "bca613ca393f9a718ceb29680b6ff7550b89bf34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bca613ca393f9a718ceb29680b6ff7550b89bf34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23408de992598d89bf6ed697b4b86bbefc0f2df0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfd6o0CRBK7hj4Ov3rIwAAdHIIAIhY+0DIHrgMPd9elmQBEoiB\nO7bDRLTmUbBiMGjo556sykP5NMq918UKjv4YDw71ZA1BG2fGT1CXd4N9uto1cYqa\nrjzv1ch8pECapGJCnmyWBp7/0YuwjU24vH55IdVkvWvqmDM8lYczGo3igyZbVWz9\ndq6co4U+8QYBzsBZ3+tL+l5x36DEmcWT5oJ3B3uadAiK3vZYJ0OLZNoq3wAu3Ayw\nebjrWC0pa8kD7wL1soXw2UyvLDVSxF2yeVFQYSjB75vYqTIK7DVx8ck41R4V9xfV\nemh0dS6hCaXNf3BT/dUwfq3nHpbZEfVeKNvXg2D8D90D7nVfL/6dvzemrk1cLYI=\n=M532\n-----END PGP SIGNATURE-----\n", "payload": "tree bca613ca393f9a718ceb29680b6ff7550b89bf34\nparent 01ca8299d48df39a1567ec39f9768d8fcb69ce7f\nparent b20bce8ce54ea9d47c2e3eb0b17cbb6baf916ae2\nauthor Jonas Schievink <jonasschievink@gmail.com> 1601677876 +0200\ncommitter GitHub <noreply@github.com> 1601677876 +0200\n\nRollup merge of #77421 - petrochenkov:globtravel, r=nagisa\n\nRevert \"resolve: Avoid \"self-confirming\" import resolutions in one more case\"\n\nAnd remove the assert that https://github.com/rust-lang/rust/pull/70236 tried to avoid instead.\n\nCloses https://github.com/rust-lang/rust/issues/74556.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23408de992598d89bf6ed697b4b86bbefc0f2df0", "html_url": "https://github.com/rust-lang/rust/commit/23408de992598d89bf6ed697b4b86bbefc0f2df0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23408de992598d89bf6ed697b4b86bbefc0f2df0/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "01ca8299d48df39a1567ec39f9768d8fcb69ce7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/01ca8299d48df39a1567ec39f9768d8fcb69ce7f", "html_url": "https://github.com/rust-lang/rust/commit/01ca8299d48df39a1567ec39f9768d8fcb69ce7f"}, {"sha": "b20bce8ce54ea9d47c2e3eb0b17cbb6baf916ae2", "url": "https://api.github.com/repos/rust-lang/rust/commits/b20bce8ce54ea9d47c2e3eb0b17cbb6baf916ae2", "html_url": "https://github.com/rust-lang/rust/commit/b20bce8ce54ea9d47c2e3eb0b17cbb6baf916ae2"}], "stats": {"total": 57, "additions": 41, "deletions": 16}, "files": [{"sha": "adff4542b0ff8a38cecc1f7fed87e7d9088c8fe3", "filename": "compiler/rustc_resolve/src/imports.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/23408de992598d89bf6ed697b4b86bbefc0f2df0/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23408de992598d89bf6ed697b4b86bbefc0f2df0/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs?ref=23408de992598d89bf6ed697b4b86bbefc0f2df0", "patch": "@@ -875,12 +875,6 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n     /// consolidate multiple unresolved import errors into a single diagnostic.\n     fn finalize_import(&mut self, import: &'b Import<'b>) -> Option<UnresolvedImportError> {\n         let orig_vis = import.vis.replace(ty::Visibility::Invisible);\n-        let orig_unusable_binding = match &import.kind {\n-            ImportKind::Single { target_bindings, .. } => {\n-                Some(mem::replace(&mut self.r.unusable_binding, target_bindings[TypeNS].get()))\n-            }\n-            _ => None,\n-        };\n         let prev_ambiguity_errors_len = self.r.ambiguity_errors.len();\n         let path_res = self.r.resolve_path(\n             &import.module_path,\n@@ -891,9 +885,6 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n             import.crate_lint(),\n         );\n         let no_ambiguity = self.r.ambiguity_errors.len() == prev_ambiguity_errors_len;\n-        if let Some(orig_unusable_binding) = orig_unusable_binding {\n-            self.r.unusable_binding = orig_unusable_binding;\n-        }\n         import.vis.set(orig_vis);\n         if let PathResult::Failed { .. } | PathResult::NonModule(..) = path_res {\n             // Consider erroneous imports used to avoid duplicate diagnostics.\n@@ -904,7 +895,8 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n                 // Consistency checks, analogous to `finalize_macro_resolutions`.\n                 if let Some(initial_module) = import.imported_module.get() {\n                     if !ModuleOrUniformRoot::same_def(module, initial_module) && no_ambiguity {\n-                        span_bug!(import.span, \"inconsistent resolution for an import\");\n+                        let msg = \"inconsistent resolution for an import\";\n+                        self.r.session.span_err(import.span, msg);\n                     }\n                 } else {\n                     if self.r.privacy_errors.is_empty() {\n@@ -926,7 +918,6 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n             }\n             PathResult::Failed { is_error_from_last_segment: true, span, label, suggestion } => {\n                 if no_ambiguity {\n-                    assert!(import.imported_module.get().is_none());\n                     let err = match self.make_path_suggestion(\n                         span,\n                         import.module_path.clone(),"}, {"sha": "0e0f915ea53c20069e7fcbfea0b1d55922a15794", "filename": "src/test/ui/imports/issue-62767.rs", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/23408de992598d89bf6ed697b4b86bbefc0f2df0/src%2Ftest%2Fui%2Fimports%2Fissue-62767.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23408de992598d89bf6ed697b4b86bbefc0f2df0/src%2Ftest%2Fui%2Fimports%2Fissue-62767.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-62767.rs?ref=23408de992598d89bf6ed697b4b86bbefc0f2df0", "patch": "@@ -1,5 +1,4 @@\n-// check-pass\n-\n+// Minimized case from #62767.\n mod m {\n     pub enum Same {\n         Same,\n@@ -8,8 +7,22 @@ mod m {\n \n use m::*;\n \n-// The variant `Same` introduced by this import is not considered when resolving the prefix\n-// `Same::` during import validation (issue #62767).\n-use Same::Same;\n+// The variant `Same` introduced by this import is also considered when resolving the prefix\n+// `Same::` during import validation to avoid effects similar to time travel (#74556).\n+use Same::Same; //~ ERROR unresolved import `Same`\n+\n+// Case from #74556.\n+mod foo {\n+    pub mod bar {\n+        pub mod bar {\n+            pub fn foobar() {}\n+        }\n+    }\n+}\n+\n+use foo::*;\n+use bar::bar; //~ ERROR unresolved import `bar::bar`\n+              //~| ERROR inconsistent resolution for an import\n+use bar::foobar;\n \n fn main() {}"}, {"sha": "a4334bda6dd870b8d1864fa13eba6de6c63c02d8", "filename": "src/test/ui/imports/issue-62767.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/23408de992598d89bf6ed697b4b86bbefc0f2df0/src%2Ftest%2Fui%2Fimports%2Fissue-62767.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/23408de992598d89bf6ed697b4b86bbefc0f2df0/src%2Ftest%2Fui%2Fimports%2Fissue-62767.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-62767.stderr?ref=23408de992598d89bf6ed697b4b86bbefc0f2df0", "patch": "@@ -0,0 +1,21 @@\n+error: inconsistent resolution for an import\n+  --> $DIR/issue-62767.rs:24:5\n+   |\n+LL | use bar::bar;\n+   |     ^^^^^^^^\n+\n+error[E0432]: unresolved import `Same`\n+  --> $DIR/issue-62767.rs:12:5\n+   |\n+LL | use Same::Same;\n+   |     ^^^^ `Same` is a variant, not a module\n+\n+error[E0432]: unresolved import `bar::bar`\n+  --> $DIR/issue-62767.rs:24:5\n+   |\n+LL | use bar::bar;\n+   |     ^^^^^^^^ no `bar` in `foo::bar::bar`\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0432`."}]}