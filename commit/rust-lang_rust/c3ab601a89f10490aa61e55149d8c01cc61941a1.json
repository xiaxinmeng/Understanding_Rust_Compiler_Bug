{"sha": "c3ab601a89f10490aa61e55149d8c01cc61941a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzYWI2MDFhODlmMTA0OTBhYTYxZTU1MTQ5ZDhjMDFjYzYxOTQxYTE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-12T06:37:23Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-12T06:37:23Z"}, "message": "rustc: Move next_var_id from typeck.crate_ctxt to typeck.fn_ctxt", "tree": {"sha": "bf4b4e5971a305008fb9a528f3efb02181ab070a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf4b4e5971a305008fb9a528f3efb02181ab070a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3ab601a89f10490aa61e55149d8c01cc61941a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3ab601a89f10490aa61e55149d8c01cc61941a1", "html_url": "https://github.com/rust-lang/rust/commit/c3ab601a89f10490aa61e55149d8c01cc61941a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3ab601a89f10490aa61e55149d8c01cc61941a1/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "368459db431faeba4399fb18a12616b3a95fc089", "url": "https://api.github.com/repos/rust-lang/rust/commits/368459db431faeba4399fb18a12616b3a95fc089", "html_url": "https://github.com/rust-lang/rust/commit/368459db431faeba4399fb18a12616b3a95fc089"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "ca8c26fe94fcfe98177a4ce879b5acc1b6e94b40", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c3ab601a89f10490aa61e55149d8c01cc61941a1/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3ab601a89f10490aa61e55149d8c01cc61941a1/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=c3ab601a89f10490aa61e55149d8c01cc61941a1", "patch": "@@ -18,11 +18,11 @@ import std.option.some;\n \n type ty_table = hashmap[ast.def_id, @ty];\n type crate_ctxt = rec(session.session sess,\n-                      @ty_table item_types,\n-                      mutable int next_var_id);\n+                      @ty_table item_types);\n \n type fn_ctxt = rec(@ty ret_ty,\n                    @ty_table locals,\n+                   mutable int next_var_id,\n                    @crate_ctxt ccx);\n \n type arg = rec(ast.mode mode, @ty ty);\n@@ -1695,8 +1695,8 @@ fn check_expr(&fn_ctxt fcx, @ast.expr expr) -> @ast.expr {\n }\n \n fn next_ty_var(&fn_ctxt fcx) -> @ty {\n-    auto t = plain_ty(ty_var(fcx.ccx.next_var_id));\n-    fcx.ccx.next_var_id += 1;\n+    auto t = plain_ty(ty_var(fcx.next_var_id));\n+    fcx.next_var_id += 1;\n     ret t;\n }\n \n@@ -1814,6 +1814,7 @@ fn check_const(&@crate_ctxt ccx, &span sp, ast.ident ident, @ast.ty t,\n     auto rty = ann_to_type(ann);\n     let fn_ctxt fcx = rec(ret_ty = rty,\n                           locals = @common.new_def_hash[@ty](),\n+                          mutable next_var_id = 0,\n                           ccx = ccx);\n     auto e_ = check_expr(fcx, e);\n     // FIXME: necessary? Correct sequence?\n@@ -1845,6 +1846,7 @@ fn check_fn(&@crate_ctxt ccx, &span sp, ast.ident ident, &ast._fn f,\n \n     let fn_ctxt fcx = rec(ret_ty = output_ty,\n                           locals = local_ty_table,\n+                          mutable next_var_id = 0,\n                           ccx = ccx);\n \n     // TODO: Make sure the type of the block agrees with the function type.\n@@ -1861,8 +1863,7 @@ fn check_crate(session.session sess, @ast.crate crate) -> @ast.crate {\n     auto result = collect_item_types(crate);\n \n     auto ccx = @rec(sess=sess,\n-                    item_types=result._1,\n-                    mutable next_var_id=0);\n+                    item_types=result._1);\n \n     auto fld = fold.new_identity_fold[@crate_ctxt]();\n     auto f = check_fn;  // FIXME: trans_const_lval bug"}]}