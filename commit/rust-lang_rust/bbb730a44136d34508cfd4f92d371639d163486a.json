{"sha": "bbb730a44136d34508cfd4f92d371639d163486a", "node_id": "C_kwDOAAsO6NoAKGJiYjczMGE0NDEzNmQzNDUwOGNmZDRmOTJkMzcxNjM5ZDE2MzQ4NmE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-19T14:53:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-19T14:53:59Z"}, "message": "Auto merge of #13983 - ink-feather-org:parse_const_closure, r=Veykril\n\nParse const_closures syntax.\n\nEnables parsing of the syntax for `#![features(const_closures)]` introduced in [this PR](https://github.com/rust-lang/rust/pull/106004)", "tree": {"sha": "fd5f9fbd426f3d60840e1268b08034672a3ab5db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd5f9fbd426f3d60840e1268b08034672a3ab5db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bbb730a44136d34508cfd4f92d371639d163486a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bbb730a44136d34508cfd4f92d371639d163486a", "html_url": "https://github.com/rust-lang/rust/commit/bbb730a44136d34508cfd4f92d371639d163486a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bbb730a44136d34508cfd4f92d371639d163486a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93c8ae08dd6d4ffdfb1be265e6159274c0f7f72a", "url": "https://api.github.com/repos/rust-lang/rust/commits/93c8ae08dd6d4ffdfb1be265e6159274c0f7f72a", "html_url": "https://github.com/rust-lang/rust/commit/93c8ae08dd6d4ffdfb1be265e6159274c0f7f72a"}, {"sha": "872408500b9ed4f083a6ba36f1c5dbdf174f7627", "url": "https://api.github.com/repos/rust-lang/rust/commits/872408500b9ed4f083a6ba36f1c5dbdf174f7627", "html_url": "https://github.com/rust-lang/rust/commit/872408500b9ed4f083a6ba36f1c5dbdf174f7627"}], "stats": {"total": 54, "additions": 50, "deletions": 4}, "files": [{"sha": "a23f900b73864b26a96f5f0b72ae106304116ff0", "filename": "crates/parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=bbb730a44136d34508cfd4f92d371639d163486a", "patch": "@@ -152,7 +152,7 @@ pub(super) fn atom_expr(\n             m.complete(p, BLOCK_EXPR)\n         }\n \n-        T![static] | T![async] | T![move] | T![|] => closure_expr(p),\n+        T![const] | T![static] | T![async] | T![move] | T![|] => closure_expr(p),\n         T![for] if la == T![<] => closure_expr(p),\n         T![for] => for_expr(p, None),\n \n@@ -255,7 +255,7 @@ fn array_expr(p: &mut Parser<'_>) -> CompletedMarker {\n // }\n fn closure_expr(p: &mut Parser<'_>) -> CompletedMarker {\n     assert!(match p.current() {\n-        T![static] | T![async] | T![move] | T![|] => true,\n+        T![const] | T![static] | T![async] | T![move] | T![|] => true,\n         T![for] => p.nth(1) == T![<],\n         _ => false,\n     });\n@@ -265,7 +265,9 @@ fn closure_expr(p: &mut Parser<'_>) -> CompletedMarker {\n     if p.at(T![for]) {\n         types::for_binder(p);\n     }\n-\n+    // test const_closure\n+    // fn main() { let cl = const || _ = 0; }\n+    p.eat(T![const]);\n     p.eat(T![static]);\n     p.eat(T![async]);\n     p.eat(T![move]);"}, {"sha": "06442a1d0f1f7f555047518551cf44bd14e8480f", "filename": "crates/parser/test_data/parser/inline/ok/0205_const_closure.rast", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rast", "raw_url": "https://github.com/rust-lang/rust/raw/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rast?ref=bbb730a44136d34508cfd4f92d371639d163486a", "patch": "@@ -0,0 +1,42 @@\n+SOURCE_FILE\n+  FN\n+    FN_KW \"fn\"\n+    WHITESPACE \" \"\n+    NAME\n+      IDENT \"main\"\n+    PARAM_LIST\n+      L_PAREN \"(\"\n+      R_PAREN \")\"\n+    WHITESPACE \" \"\n+    BLOCK_EXPR\n+      STMT_LIST\n+        L_CURLY \"{\"\n+        WHITESPACE \" \"\n+        LET_STMT\n+          LET_KW \"let\"\n+          WHITESPACE \" \"\n+          IDENT_PAT\n+            NAME\n+              IDENT \"cl\"\n+          WHITESPACE \" \"\n+          EQ \"=\"\n+          WHITESPACE \" \"\n+          CLOSURE_EXPR\n+            CONST_KW \"const\"\n+            WHITESPACE \" \"\n+            PARAM_LIST\n+              PIPE \"|\"\n+              PIPE \"|\"\n+            WHITESPACE \" \"\n+            BIN_EXPR\n+              UNDERSCORE_EXPR\n+                UNDERSCORE \"_\"\n+              WHITESPACE \" \"\n+              EQ \"=\"\n+              WHITESPACE \" \"\n+              LITERAL\n+                INT_NUMBER \"0\"\n+          SEMICOLON \";\"\n+        WHITESPACE \" \"\n+        R_CURLY \"}\"\n+  WHITESPACE \"\\n\""}, {"sha": "0c05cc70bd37699b7e0ea21e56e477c1618696e5", "filename": "crates/parser/test_data/parser/inline/ok/0205_const_closure.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Ftest_data%2Fparser%2Finline%2Fok%2F0205_const_closure.rs?ref=bbb730a44136d34508cfd4f92d371639d163486a", "patch": "@@ -0,0 +1 @@\n+fn main() { let cl = const || _ = 0; }"}, {"sha": "36ad5fddfd0c50cfa17680855aa9b532ef0dd8a3", "filename": "crates/syntax/rust.ungram", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fsyntax%2Frust.ungram", "raw_url": "https://github.com/rust-lang/rust/raw/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fsyntax%2Frust.ungram", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Frust.ungram?ref=bbb730a44136d34508cfd4f92d371639d163486a", "patch": "@@ -452,7 +452,7 @@ FieldExpr =\n   Attr* Expr '.' NameRef\n \n ClosureExpr =\n-  Attr* ('for' GenericParamList)? 'static'? 'async'? 'move'?  ParamList RetType?\n+  Attr* ('for' GenericParamList)? 'const'? 'static'? 'async'? 'move'?  ParamList RetType?\n   body:Expr\n \n IfExpr ="}, {"sha": "642a3bfc35d13c5a4eb71faabd30c7b5b5641cf9", "filename": "crates/syntax/src/ast/generated/nodes.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbb730a44136d34508cfd4f92d371639d163486a/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fgenerated%2Fnodes.rs?ref=bbb730a44136d34508cfd4f92d371639d163486a", "patch": "@@ -842,6 +842,7 @@ impl ast::HasAttrs for ClosureExpr {}\n impl ClosureExpr {\n     pub fn for_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![for]) }\n     pub fn generic_param_list(&self) -> Option<GenericParamList> { support::child(&self.syntax) }\n+    pub fn const_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![const]) }\n     pub fn static_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![static]) }\n     pub fn async_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![async]) }\n     pub fn move_token(&self) -> Option<SyntaxToken> { support::token(&self.syntax, T![move]) }"}]}