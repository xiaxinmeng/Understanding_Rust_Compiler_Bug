{"sha": "3962b0d53c8da6e3f95f54395d266cb99562bd47", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5NjJiMGQ1M2M4ZGE2ZTNmOTVmNTQzOTVkMjY2Y2I5OTU2MmJkNDc=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-03-15T13:42:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-15T13:42:12Z"}, "message": "Merge #8027\n\n8027: Completion context remove exact match method in favor of fields r=JoshMcguigan a=JoshMcguigan\n\nThis is a minor cleanup PR following #8008. It removes the `expected_name_and_type` method on completion context in favor of using the fields. \r\n\r\nI thought this method was used in more places, or else it may have just made sense to make this change directly in #8008 :shrug: \n\nCo-authored-by: Josh Mcguigan <joshmcg88@gmail.com>", "tree": {"sha": "f2330e5ffdc8206b7a08e2f74fc204f78363dabf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f2330e5ffdc8206b7a08e2f74fc204f78363dabf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3962b0d53c8da6e3f95f54395d266cb99562bd47", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgT2Q0CRBK7hj4Ov3rIwAAdHIIACbVyKcs36PmUf4p20Szwl4p\n4pzvp3429iJpiVu6GHsESeSZ2WU3DvWY00hBjsjj038fJqZWgZ4wtdUfGlrUgbYD\ni7RzzlNAyZ1S7bVsLyLWpS5iCDL9OR2Ac6F0YRM2jIVmO2XPw7G2bG6yph1Mci5x\nmtX2qjNfrJ4dGj0Gi6LPK8n39XIW7GcoSWhomE4PBaFAdgsPu3fbDWmPxPLRb1jc\nFjzI8bPz9RzjWawMey6UJl+XFWfi4ICa1AGE8/kaooizW45/62PxCiLbx/wQdiPZ\npXL0KT3UBrMvh7Q5j/KRzJR0Gh7cuYvMs/k7yQLYgtx1BrnvzPBevW5bidPrF1A=\n=BC40\n-----END PGP SIGNATURE-----\n", "payload": "tree f2330e5ffdc8206b7a08e2f74fc204f78363dabf\nparent b245e8d115ef63673bd475a56be96ed654aaa4d7\nparent 67d59aeb7cc442ce629dbd3976f57000fa73df51\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1615815732 +0000\ncommitter GitHub <noreply@github.com> 1615815732 +0000\n\nMerge #8027\n\n8027: Completion context remove exact match method in favor of fields r=JoshMcguigan a=JoshMcguigan\n\nThis is a minor cleanup PR following #8008. It removes the `expected_name_and_type` method on completion context in favor of using the fields. \r\n\r\nI thought this method was used in more places, or else it may have just made sense to make this change directly in #8008 :shrug: \n\nCo-authored-by: Josh Mcguigan <joshmcg88@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3962b0d53c8da6e3f95f54395d266cb99562bd47", "html_url": "https://github.com/rust-lang/rust/commit/3962b0d53c8da6e3f95f54395d266cb99562bd47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3962b0d53c8da6e3f95f54395d266cb99562bd47/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b245e8d115ef63673bd475a56be96ed654aaa4d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/b245e8d115ef63673bd475a56be96ed654aaa4d7", "html_url": "https://github.com/rust-lang/rust/commit/b245e8d115ef63673bd475a56be96ed654aaa4d7"}, {"sha": "67d59aeb7cc442ce629dbd3976f57000fa73df51", "url": "https://api.github.com/repos/rust-lang/rust/commits/67d59aeb7cc442ce629dbd3976f57000fa73df51", "html_url": "https://github.com/rust-lang/rust/commit/67d59aeb7cc442ce629dbd3976f57000fa73df51"}], "stats": {"total": 16, "additions": 4, "deletions": 12}, "files": [{"sha": "670563e5093d9b9cb919878aaec00fb741fc71f3", "filename": "crates/ide_completion/src/render.rs", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3962b0d53c8da6e3f95f54395d266cb99562bd47/crates%2Fide_completion%2Fsrc%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3962b0d53c8da6e3f95f54395d266cb99562bd47/crates%2Fide_completion%2Fsrc%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender.rs?ref=3962b0d53c8da6e3f95f54395d266cb99562bd47", "patch": "@@ -118,12 +118,6 @@ impl<'a> RenderContext<'a> {\n     fn docs(&self, node: impl HasAttrs) -> Option<Documentation> {\n         node.docs(self.db())\n     }\n-\n-    // FIXME delete this method in favor of directly using the fields\n-    // on CompletionContext\n-    fn expected_name_and_type(&self) -> Option<(String, Type)> {\n-        Some((self.completion.expected_name.clone()?, self.completion.expected_type.clone()?))\n-    }\n }\n \n /// Generic renderer for completion items.\n@@ -249,8 +243,8 @@ impl<'a> Render<'a> {\n             relevance.is_local = true;\n             item.set_relevance(relevance);\n \n-            if let Some((_expected_name, expected_type)) = self.ctx.expected_name_and_type() {\n-                if ty != expected_type {\n+            if let Some(expected_type) = self.ctx.completion.expected_type.as_ref() {\n+                if &ty != expected_type {\n                     if let Some(ty_without_ref) = expected_type.remove_ref() {\n                         if relevance_type_match(self.ctx.db().upcast(), &ty, &ty_without_ref) {\n                             cov_mark::hit!(suggest_ref);\n@@ -322,10 +316,8 @@ impl<'a> Render<'a> {\n fn compute_relevance(ctx: &RenderContext, ty: &Type, name: &str) -> CompletionRelevance {\n     let mut res = CompletionRelevance::default();\n \n-    if let Some((expected_name, expected_type)) = ctx.expected_name_and_type() {\n-        res.exact_type_match = ty == &expected_type;\n-        res.exact_name_match = name == &expected_name;\n-    }\n+    res.exact_type_match = Some(ty) == ctx.completion.expected_type.as_ref();\n+    res.exact_name_match = Some(name) == ctx.completion.expected_name.as_deref();\n \n     res\n }"}]}