{"sha": "c9e361fcd138eb131d045e53a094e1f3827b38dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5ZTM2MWZjZDEzOGViMTMxZDA0NWU1M2EwOTRlMWYzODI3YjM4ZGQ=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-20T17:46:49Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-10-20T17:53:10Z"}, "message": "Check all files in `src/test` for `borrowck_graphviz_postflow`\n\nThis attribute causes DOT files to be generated in the top-level\ndirectory. It is intended to be used only temporarily and should never\nappear on master.\n\nThis will prevent #65071 from occurring again.", "tree": {"sha": "0cbb1c3b86d2cf14c655301880bcd43efcde453c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cbb1c3b86d2cf14c655301880bcd43efcde453c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9e361fcd138eb131d045e53a094e1f3827b38dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9e361fcd138eb131d045e53a094e1f3827b38dd", "html_url": "https://github.com/rust-lang/rust/commit/c9e361fcd138eb131d045e53a094e1f3827b38dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9e361fcd138eb131d045e53a094e1f3827b38dd/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c49187530d1e5599101ff74bcf3f82888e768def", "url": "https://api.github.com/repos/rust-lang/rust/commits/c49187530d1e5599101ff74bcf3f82888e768def", "html_url": "https://github.com/rust-lang/rust/commit/c49187530d1e5599101ff74bcf3f82888e768def"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "ee555a3e5bda764a0500d82d80e00462f6cc6f05", "filename": "src/tools/tidy/src/debug_artifacts.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdebug_artifacts.rs?ref=c9e361fcd138eb131d045e53a094e1f3827b38dd", "patch": "@@ -0,0 +1,24 @@\n+//! Tidy check to prevent creation of unnecessary debug artifacts.\n+\n+use std::path::{Path, PathBuf};\n+\n+const GRAPHVIZ_POSTFLOW_MSG: &'static str =\n+    \"`borrowck_graphviz_postflow` attribute in test\";\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    let test_dir: PathBuf = path.join(\"test\");\n+\n+    super::walk(&test_dir, &mut super::filter_dirs, &mut |entry, contents| {\n+        let filename = entry.path();\n+        let is_rust = filename.extension().map_or(false, |ext| ext == \"rs\");\n+        if !is_rust {\n+            return;\n+        }\n+\n+        for (i, line) in contents.lines().enumerate() {\n+            if line.contains(\"borrowck_graphviz_postflow\") {\n+                tidy_error!(bad, \"{}:{}: {}\", filename.display(), i + 1, GRAPHVIZ_POSTFLOW_MSG);\n+            }\n+        }\n+    });\n+}"}, {"sha": "c76cc4cff7f87378f084a2a9635c4018fc1df3a0", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=c9e361fcd138eb131d045e53a094e1f3827b38dd", "patch": "@@ -31,6 +31,7 @@ macro_rules! tidy_error {\n \n pub mod bins;\n pub mod style;\n+pub mod debug_artifacts;\n pub mod errors;\n pub mod features;\n pub mod cargo;"}, {"sha": "de6b0c5b28d9de31674a7d353a03167dd87b49c1", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9e361fcd138eb131d045e53a094e1f3827b38dd/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=c9e361fcd138eb131d045e53a094e1f3827b38dd", "patch": "@@ -22,6 +22,7 @@ fn main() {\n     let verbose = args.iter().any(|s| *s == \"--verbose\");\n     bins::check(&path, &mut bad);\n     style::check(&path, &mut bad);\n+    debug_artifacts::check(&path, &mut bad);\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n     edition::check(&path, &mut bad);"}]}