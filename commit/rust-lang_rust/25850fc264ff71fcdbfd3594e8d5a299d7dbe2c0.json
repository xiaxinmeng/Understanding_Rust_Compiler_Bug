{"sha": "25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "node_id": "C_kwDOAAsO6NoAKDI1ODUwZmMyNjRmZjcxZmNkYmZkMzU5NGU4ZDVhMjk5ZDdkYmUyYzA", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-09-28T15:33:58Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-09-28T15:40:59Z"}, "message": "Make doc_unsafe lint on unsafe traits as well", "tree": {"sha": "1409213095472bcbad7f7b53529cc97ff16d64c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1409213095472bcbad7f7b53529cc97ff16d64c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "html_url": "https://github.com/rust-lang/rust/commit/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13834e6ad2294a95c664aca2acaedb1a9619773f", "url": "https://api.github.com/repos/rust-lang/rust/commits/13834e6ad2294a95c664aca2acaedb1a9619773f", "html_url": "https://github.com/rust-lang/rust/commit/13834e6ad2294a95c664aca2acaedb1a9619773f"}], "stats": {"total": 50, "additions": 43, "deletions": 7}, "files": [{"sha": "0a9edfd733460cf5a80d07bfc0d442f0fd33a82b", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "patch": "@@ -236,7 +236,17 @@ impl<'tcx> LateLintPass<'tcx> for DocMarkdown {\n             hir::ItemKind::Impl(ref impl_) => {\n                 self.in_trait_impl = impl_.of_trait.is_some();\n             },\n-            _ => {},\n+            hir::ItemKind::Trait(_, unsafety, ..) => {\n+                if !headers.safety && unsafety == hir::Unsafety::Unsafe {\n+                    span_lint(\n+                        cx,\n+                        MISSING_SAFETY_DOC,\n+                        item.span,\n+                        \"unsafe trait's docs miss `# Safety` section\",\n+                    );\n+                }\n+            },\n+            _ => (),\n         }\n     }\n "}, {"sha": "9ff3b5e5ef50f3acfe90090ab43c447283bda8b1", "filename": "tests/ui/def_id_nocore.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdef_id_nocore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdef_id_nocore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdef_id_nocore.rs?ref=25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "patch": "@@ -3,6 +3,7 @@\n \n #![feature(no_core, lang_items, start)]\n #![no_core]\n+#![allow(clippy::missing_safety_doc)]\n \n #[link(name = \"c\")]\n extern \"C\" {}"}, {"sha": "6210d7c6cfd80c1d32369494f3010694b606dc65", "filename": "tests/ui/def_id_nocore.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdef_id_nocore.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdef_id_nocore.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdef_id_nocore.stderr?ref=25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "patch": "@@ -1,5 +1,5 @@\n error: methods called `as_*` usually take `self` by reference or `self` by mutable reference\n-  --> $DIR/def_id_nocore.rs:26:19\n+  --> $DIR/def_id_nocore.rs:27:19\n    |\n LL |     pub fn as_ref(self) -> &'static str {\n    |                   ^^^^"}, {"sha": "8f823f1672ba2d30e868414cdf87104a39caa175", "filename": "tests/ui/doc_unsafe.rs", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdoc_unsafe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdoc_unsafe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc_unsafe.rs?ref=25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "patch": "@@ -34,16 +34,25 @@ mod private_mod {\n \n pub use private_mod::republished;\n \n-pub trait UnsafeTrait {\n+pub trait SafeTraitUnsafeMethods {\n     unsafe fn woefully_underdocumented(self);\n \n     /// # Safety\n     unsafe fn at_least_somewhat_documented(self);\n }\n \n+pub unsafe trait UnsafeTrait {\n+    fn method();\n+}\n+\n+/// # Safety\n+pub unsafe trait DocumentedUnsafeTrait {\n+    fn method2();\n+}\n+\n pub struct Struct;\n \n-impl UnsafeTrait for Struct {\n+impl SafeTraitUnsafeMethods for Struct {\n     unsafe fn woefully_underdocumented(self) {\n         // all is well\n     }\n@@ -53,6 +62,14 @@ impl UnsafeTrait for Struct {\n     }\n }\n \n+unsafe impl UnsafeTrait for Struct {\n+    fn method() {}\n+}\n+\n+unsafe impl DocumentedUnsafeTrait for Struct {\n+    fn method2() {}\n+}\n+\n impl Struct {\n     pub unsafe fn more_undocumented_unsafe() -> Self {\n         unimplemented!();"}, {"sha": "d540abd126213b9483e655c74321b14eb43f59dd", "filename": "tests/ui/doc_unsafe.stderr", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdoc_unsafe.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0/tests%2Fui%2Fdoc_unsafe.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc_unsafe.stderr?ref=25850fc264ff71fcdbfd3594e8d5a299d7dbe2c0", "patch": "@@ -22,16 +22,24 @@ error: unsafe function's docs miss `# Safety` section\n LL |     unsafe fn woefully_underdocumented(self);\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n+error: unsafe trait's docs miss `# Safety` section\n+  --> $DIR/doc_unsafe.rs:44:1\n+   |\n+LL | / pub unsafe trait UnsafeTrait {\n+LL | |     fn method();\n+LL | | }\n+   | |_^\n+\n error: unsafe function's docs miss `# Safety` section\n-  --> $DIR/doc_unsafe.rs:57:5\n+  --> $DIR/doc_unsafe.rs:74:5\n    |\n LL | /     pub unsafe fn more_undocumented_unsafe() -> Self {\n LL | |         unimplemented!();\n LL | |     }\n    | |_____^\n \n error: unsafe function's docs miss `# Safety` section\n-  --> $DIR/doc_unsafe.rs:73:9\n+  --> $DIR/doc_unsafe.rs:90:9\n    |\n LL | /         pub unsafe fn whee() {\n LL | |             unimplemented!()\n@@ -43,5 +51,5 @@ LL |   very_unsafe!();\n    |\n    = note: this error originates in the macro `very_unsafe` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n-error: aborting due to 5 previous errors\n+error: aborting due to 6 previous errors\n "}]}