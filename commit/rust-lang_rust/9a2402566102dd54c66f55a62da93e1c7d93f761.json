{"sha": "9a2402566102dd54c66f55a62da93e1c7d93f761", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhMjQwMjU2NjEwMmRkNTRjNjZmNTVhNjJkYTkzZTFjN2Q5M2Y3NjE=", "commit": {"author": {"name": "Richard Diamond", "email": "wichard@vitalitystudios.com", "date": "2015-09-15T21:22:16Z"}, "committer": {"name": "Richard Diamond", "email": "wichard@vitalitystudios.com", "date": "2015-09-21T20:43:52Z"}, "message": "Avoid loading the whole gdb debug scripts section.\n\nThis is so LLVM isn't forced to load every byte of it. Also sets the alignment of\nthe load. Adds a test for the debug script section.", "tree": {"sha": "8ad705d759548751418b982a6987e7870af4f889", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ad705d759548751418b982a6987e7870af4f889"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a2402566102dd54c66f55a62da93e1c7d93f761", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a2402566102dd54c66f55a62da93e1c7d93f761", "html_url": "https://github.com/rust-lang/rust/commit/9a2402566102dd54c66f55a62da93e1c7d93f761", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a2402566102dd54c66f55a62da93e1c7d93f761/comments", "author": {"login": "DiamondLovesYou", "id": 650357, "node_id": "MDQ6VXNlcjY1MDM1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/650357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DiamondLovesYou", "html_url": "https://github.com/DiamondLovesYou", "followers_url": "https://api.github.com/users/DiamondLovesYou/followers", "following_url": "https://api.github.com/users/DiamondLovesYou/following{/other_user}", "gists_url": "https://api.github.com/users/DiamondLovesYou/gists{/gist_id}", "starred_url": "https://api.github.com/users/DiamondLovesYou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DiamondLovesYou/subscriptions", "organizations_url": "https://api.github.com/users/DiamondLovesYou/orgs", "repos_url": "https://api.github.com/users/DiamondLovesYou/repos", "events_url": "https://api.github.com/users/DiamondLovesYou/events{/privacy}", "received_events_url": "https://api.github.com/users/DiamondLovesYou/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DiamondLovesYou", "id": 650357, "node_id": "MDQ6VXNlcjY1MDM1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/650357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DiamondLovesYou", "html_url": "https://github.com/DiamondLovesYou", "followers_url": "https://api.github.com/users/DiamondLovesYou/followers", "following_url": "https://api.github.com/users/DiamondLovesYou/following{/other_user}", "gists_url": "https://api.github.com/users/DiamondLovesYou/gists{/gist_id}", "starred_url": "https://api.github.com/users/DiamondLovesYou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DiamondLovesYou/subscriptions", "organizations_url": "https://api.github.com/users/DiamondLovesYou/orgs", "repos_url": "https://api.github.com/users/DiamondLovesYou/repos", "events_url": "https://api.github.com/users/DiamondLovesYou/events{/privacy}", "received_events_url": "https://api.github.com/users/DiamondLovesYou/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5120f4a3f95f6695c711839b3cc8551303bee0e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5120f4a3f95f6695c711839b3cc8551303bee0e3", "html_url": "https://github.com/rust-lang/rust/commit/5120f4a3f95f6695c711839b3cc8551303bee0e3"}], "stats": {"total": 54, "additions": 50, "deletions": 4}, "files": [{"sha": "8db6725f7a8f87a0c9811a10dd6af3e0dbc0cdc3", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -1669,8 +1669,7 @@ fn compile_test_and_save_ir(config: &Config, props: &TestProps,\n     // FIXME (#9639): This needs to handle non-utf8 paths\n     let mut link_args = vec!(\"-L\".to_owned(),\n                              aux_dir.to_str().unwrap().to_owned());\n-    let llvm_args = vec!(\"--emit=llvm-ir\".to_owned(),\n-                         \"--crate-type=lib\".to_owned());\n+    let llvm_args = vec!(\"--emit=llvm-ir\".to_owned(),);\n     link_args.extend(llvm_args);\n     let args = make_compile_args(config,\n                                  props,"}, {"sha": "ffef7e71a773472aae1f06c5188592d3a92060ee", "filename": "src/librustc_trans/trans/debuginfo/gdb.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fgdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fgdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fgdb.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -13,7 +13,7 @@\n use llvm;\n use llvm::ValueRef;\n \n-use trans::common::{C_bytes, CrateContext};\n+use trans::common::{C_bytes, CrateContext, C_i32};\n use trans::declare;\n use trans::type_::Type;\n use session::config::NoDebugInfo;\n@@ -31,11 +31,21 @@ pub fn insert_reference_to_gdb_debug_scripts_section_global(ccx: &CrateContext)\n         let gdb_debug_scripts_section_global =\n             get_or_insert_gdb_debug_scripts_section_global(ccx);\n         unsafe {\n+            // Load just the first byte as that's all that's necessary to force\n+            // LLVM to keep around the reference to the global.\n+            let indices = [C_i32(ccx, 0), C_i32(ccx, 0)];\n+            let element =\n+                llvm::LLVMBuildInBoundsGEP(ccx.raw_builder(),\n+                                           gdb_debug_scripts_section_global,\n+                                           indices.as_ptr(),\n+                                           indices.len() as ::libc::c_uint,\n+                                           empty.as_ptr());\n             let volative_load_instruction =\n                 llvm::LLVMBuildLoad(ccx.raw_builder(),\n-                                    gdb_debug_scripts_section_global,\n+                                    element,\n                                     empty.as_ptr());\n             llvm::LLVMSetVolatile(volative_load_instruction, llvm::True);\n+            llvm::LLVMSetAlignment(volative_load_instruction, 1);\n         }\n     }\n }"}, {"sha": "a61fa84398e9aacbd9b8f1958ec2dc71875368c7", "filename": "src/test/codegen/adjustments.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fadjustments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fadjustments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fadjustments.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,8 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n+\n // Hack to get the correct size for the length part in slices\n // CHECK: @helper([[USIZE:i[0-9]+]])\n #[no_mangle]"}, {"sha": "c8c9f5b407c421b11458d6b6c514f54ac64afbaf", "filename": "src/test/codegen/coercions.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fcoercions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fcoercions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fcoercions.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,8 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n+\n static X: i32 = 5;\n \n // CHECK-LABEL: @raw_ptr_to_raw_ptr_noop"}, {"sha": "ff9d54e67e4782439005eb7d2dcc048b658209b7", "filename": "src/test/codegen/extern-functions.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fextern-functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fextern-functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fextern-functions.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,7 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n #![feature(unwind_attributes)]\n \n extern {"}, {"sha": "90ced88324e7fb1041e1f7e3ef3d34ab778c560b", "filename": "src/test/codegen/function-arguments.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Ffunction-arguments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Ffunction-arguments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Ffunction-arguments.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,7 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n #![feature(allocator)]\n \n pub struct S {"}, {"sha": "efaca29752b5d0dc399e59c3939e183c640a350d", "filename": "src/test/codegen/gdb_debug_script_load.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fgdb_debug_script_load.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fgdb_debug_script_load.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fgdb_debug_script_load.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-tidy-linelength\n+// ignore-windows\n+// ignore-macos\n+\n+// compile-flags: -g -C no-prepopulate-passes\n+\n+#![feature(start)]\n+\n+// CHECK-LABEL: @main\n+// CHECK: load volatile i8, i8* getelementptr inbounds ([[B:\\[[0-9]* x i8\\]]], [[B]]* @__rustc_debug_gdb_scripts_section__, i32 0, i32 0), align 1\n+\n+#[start]\n+fn start(_: isize, _: *const *const u8) -> isize {\n+    return 0;\n+}"}, {"sha": "5ad3854c05ccc4a1e201a2c995972225bb8bad95", "filename": "src/test/codegen/link_section.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Flink_section.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Flink_section.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Flink_section.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,8 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n+\n // CHECK: @VAR1 = constant i32 1, section \".test_one\"\n #[no_mangle]\n #[link_section = \".test_one\"]"}, {"sha": "21f23b6ea18612dee9c0ae2708964553a47f3639", "filename": "src/test/codegen/loads.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Floads.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Floads.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Floads.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,8 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n+\n pub struct Bytes {\n   a: u8,\n   b: u8,"}, {"sha": "5d2d47e1bf3f6f3ed53b375448667fa41d49449b", "filename": "src/test/codegen/stores.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fstores.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a2402566102dd54c66f55a62da93e1c7d93f761/src%2Ftest%2Fcodegen%2Fstores.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fstores.rs?ref=9a2402566102dd54c66f55a62da93e1c7d93f761", "patch": "@@ -10,6 +10,8 @@\n \n // compile-flags: -C no-prepopulate-passes\n \n+#![crate_type = \"lib\"]\n+\n pub struct Bytes {\n   a: u8,\n   b: u8,"}]}