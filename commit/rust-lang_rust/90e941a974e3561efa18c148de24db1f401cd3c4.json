{"sha": "90e941a974e3561efa18c148de24db1f401cd3c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwZTk0MWE5NzRlMzU2MWVmYTE4YzE0OGRlMjRkYjFmNDAxY2QzYzQ=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-22T09:31:12Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-22T14:36:22Z"}, "message": "mir: improve polymorphic constant bug\n\nThis commit changes the span and content of the \"collection encountered\npolymorphic constant\" bug in monomorphization collection to point to the\nuse of the constant rather than the definition.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "7f4a22cafc568ba2d9ecd15c8a98777773510b2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f4a22cafc568ba2d9ecd15c8a98777773510b2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90e941a974e3561efa18c148de24db1f401cd3c4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl8YTuYACgkQJZLnbIc4\nH9kfBRAAuJLwrfRrOK4YfIb1hnyCPDtQUVhKwWN3UMIpVw1IHzgz5TWwpj6rtudH\n4cHJ+c7D55QGiL7EBZkOCNeglrBArYARMWdBaBKMnpL08NbC3oQ++HOdtlgpxSda\nSjrG6/EUzTLeFy4GVM6HDEgoEytBZsNEaviqSb84sBg+Cn9hPX6uEMXdxeHS5VX4\nhNc7UGtjUjguRm9fhWpwYAbKjpIDbEAz88oFsOyZYN4LYk4/263Gwm5KAsiWhrIj\nhbuIb3/BIW9O8UgdfIwWLH3xw47CBqRDIFkDLYBo7yxO5OURp8w7TS2mNfb+I/iR\n0eTaGgqZz2KY+vcHemFyoyX6q0L6F1VLtFOL+gDO25N6HE4tsmItrzopHS4xDaXQ\nt5F8O6NncjFNDBDe7y1X0pUbnZqjupDECq5J1cFjZ1I9ZlokVxPWKduRkrd/2/fZ\nTWxUy1/oxP6Ui1SILZa0KRqcg/ECeRUUPCIJzMy3KmNkH5yeR/VxZqB1UsVa01Fv\nJEZ9TL1+VfuSI0uyLTTqmr9Lsrnl537MCwwhNfkCBu6GQYaHj2hsQW3fI4jOP9kv\n6Olt51cbr8AnUsxdrHRXUlSU+/Y8cxHtAEWwrChduigGtw0Kl66CIvSC2rjCGcKz\niUcBgYH/r9lyMNp4F+/J3SUw6NNQIFX3v7Bll6IuqmEmB3kuxD8=\n=e5JM\n-----END PGP SIGNATURE-----", "payload": "tree 7f4a22cafc568ba2d9ecd15c8a98777773510b2c\nparent 4825e12fc9c79954aa0fe18f5521efa6c19c7539\nauthor David Wood <david@davidtw.co> 1595410272 +0100\ncommitter David Wood <david@davidtw.co> 1595428582 +0100\n\nmir: improve polymorphic constant bug\n\nThis commit changes the span and content of the \"collection encountered\npolymorphic constant\" bug in monomorphization collection to point to the\nuse of the constant rather than the definition.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90e941a974e3561efa18c148de24db1f401cd3c4", "html_url": "https://github.com/rust-lang/rust/commit/90e941a974e3561efa18c148de24db1f401cd3c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90e941a974e3561efa18c148de24db1f401cd3c4/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4825e12fc9c79954aa0fe18f5521efa6c19c7539", "url": "https://api.github.com/repos/rust-lang/rust/commits/4825e12fc9c79954aa0fe18f5521efa6c19c7539", "html_url": "https://github.com/rust-lang/rust/commit/4825e12fc9c79954aa0fe18f5521efa6c19c7539"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "e724180f4d833d588c199cc4bdf46bab1c681410", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/90e941a974e3561efa18c148de24db1f401cd3c4/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90e941a974e3561efa18c148de24db1f401cd3c4/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=90e941a974e3561efa18c148de24db1f401cd3c4", "patch": "@@ -627,8 +627,9 @@ impl<'a, 'tcx> MirVisitor<'tcx> for MirNeighborCollector<'a, 'tcx> {\n                     Ok(val) => collect_const_value(self.tcx, val, self.output),\n                     Err(ErrorHandled::Reported(ErrorReported) | ErrorHandled::Linted) => {}\n                     Err(ErrorHandled::TooGeneric) => span_bug!(\n-                        self.tcx.def_span(def.did),\n-                        \"collection encountered polymorphic constant\",\n+                        self.body.source_info(location).span,\n+                        \"collection encountered polymorphic constant: {}\",\n+                        substituted_constant\n                     ),\n                 }\n             }"}]}