{"sha": "3d6840234c1dce3456afa131d5c42221a9c6a0f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkNjg0MDIzNGMxZGNlMzQ1NmFmYTEzMWQ1YzQyMjIxYTljNmEwZjA=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-13T18:56:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-07-13T18:56:56Z"}, "message": "Rollup merge of #52333 - kennytm:linux-core-dump, r=alexcrichton\n\nCI: Enable core dump on Linux, and print their stack trace on segfault.", "tree": {"sha": "fc6fcfe98788bbbe1b410e5657b663df2b46e5de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc6fcfe98788bbbe1b410e5657b663df2b46e5de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d6840234c1dce3456afa131d5c42221a9c6a0f0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbSPX4CRBK7hj4Ov3rIwAAdHIIAIhUrZ+ZuiTM4rSNFZ26LQsp\n5Oe7Ouu1uYfgnGAPTKZ52+i9FEWVkxOWPO9BjiQiPNKZ9WO2q4UPqB6QZ7Irfahc\nC983vjMk2+0ICiNF7D6Pc+UUi0wgczmPHLIK98qSTTLGUfVDD8KU/P6nbXo4f8br\n/at/DjgVZtxTenhfRxwpzmI5lNr09YW4UhA8AhAglHRt71tfyPpVlyF/hPpumgox\nDv3D/Az5Y31KFTIFBJsydyvViBWC7/nBm7ee+h9kijVmf6PvSxS7HLAmKDElqpI8\nAj8ENhz/iF9hgeR0GKhXtAD4i9DWqtpnMUUDqDzvE8qBXxUiByACTrktjOyY/QQ=\n=+TV4\n-----END PGP SIGNATURE-----\n", "payload": "tree fc6fcfe98788bbbe1b410e5657b663df2b46e5de\nparent fe64419102fa641bd042cbafbd7fd7868dde14d4\nparent 1e1b800c2eb81418613520f9ede321e9d97e1707\nauthor kennytm <kennytm@gmail.com> 1531508216 +0800\ncommitter GitHub <noreply@github.com> 1531508216 +0800\n\nRollup merge of #52333 - kennytm:linux-core-dump, r=alexcrichton\n\nCI: Enable core dump on Linux, and print their stack trace on segfault.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d6840234c1dce3456afa131d5c42221a9c6a0f0", "html_url": "https://github.com/rust-lang/rust/commit/3d6840234c1dce3456afa131d5c42221a9c6a0f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d6840234c1dce3456afa131d5c42221a9c6a0f0/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe64419102fa641bd042cbafbd7fd7868dde14d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe64419102fa641bd042cbafbd7fd7868dde14d4", "html_url": "https://github.com/rust-lang/rust/commit/fe64419102fa641bd042cbafbd7fd7868dde14d4"}, {"sha": "1e1b800c2eb81418613520f9ede321e9d97e1707", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e1b800c2eb81418613520f9ede321e9d97e1707", "html_url": "https://github.com/rust-lang/rust/commit/1e1b800c2eb81418613520f9ede321e9d97e1707"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "0228fdc994dd769b5512c55a074dafd2dcffddd1", "filename": ".travis.yml", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3d6840234c1dce3456afa131d5c42221a9c6a0f0/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/3d6840234c1dce3456afa131d5c42221a9c6a0f0/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=3d6840234c1dce3456afa131d5c42221a9c6a0f0", "patch": "@@ -3,6 +3,10 @@ sudo: required\n dist: trusty\n services:\n   - docker\n+addons:\n+  apt:\n+    packages:\n+      - gdb\n \n git:\n   depth: 2\n@@ -249,6 +253,8 @@ before_script:\n           export RUN_SCRIPT=\"$RUN_SCRIPT && src/ci/run.sh\";\n       else\n           export RUN_SCRIPT=\"$RUN_SCRIPT && src/ci/docker/run.sh $IMAGE\";\n+          # Enable core dump on Linux.\n+          sudo sh -c 'echo \"/checkout/obj/cores/core.%p.%E\" > /proc/sys/kernel/core_pattern';\n       fi\n \n # Log time information from this machine and an external machine for insight into possible\n@@ -274,6 +280,8 @@ after_failure:\n \n   # Random attempt at debugging currently. Just poking around in here to see if\n   # anything shows up.\n+\n+  # Dump backtrace for macOS\n   - ls -lat $HOME/Library/Logs/DiagnosticReports/\n   - find $HOME/Library/Logs/DiagnosticReports\n       -type f\n@@ -284,8 +292,24 @@ after_failure:\n       -exec head -750 {} \\;\n       -exec echo travis_fold\":\"end:crashlog \\; || true\n \n+  # Dump backtrace for Linux\n+  - ln -s . checkout &&\n+    for CORE in obj/cores/core.*; do\n+      EXE=$(echo $CORE | sed 's|obj/cores/core\\.[0-9]*\\.!checkout!\\(.*\\)|\\1|;y|!|/|');\n+      if [ -f \"$EXE\" ]; then\n+        printf travis_fold\":start:crashlog\\n\\033[31;1m%s\\033[0m\\n\" \"$CORE\";\n+        gdb -q -c \"$CORE\" \"$EXE\"\n+          -iex 'set auto-load off'\n+          -iex 'dir src/'\n+          -iex 'set sysroot .'\n+          -ex bt\n+          -ex q;\n+        echo travis_fold\":\"end:crashlog;\n+      fi;\n+    done || true\n+\n   # see #50887\n-  - head -30 ./obj/build/x86_64-unknown-linux-gnu/native/asan/build/lib/asan/clang_rt.asan-dynamic-i386.vers || true\n+  - cat ./obj/build/x86_64-unknown-linux-gnu/native/asan/build/lib/asan/clang_rt.asan-dynamic-i386.vers || true\n \n   # attempt to debug anything killed by the oom killer on linux, just to see if\n   # it happened"}, {"sha": "931c28f1ca98e95f3bd944c2123ba91156e0fe8d", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3d6840234c1dce3456afa131d5c42221a9c6a0f0/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/3d6840234c1dce3456afa131d5c42221a9c6a0f0/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=3d6840234c1dce3456afa131d5c42221a9c6a0f0", "patch": "@@ -99,6 +99,7 @@ objdir=$root_dir/obj\n \n mkdir -p $HOME/.cargo\n mkdir -p $objdir/tmp\n+mkdir $objdir/cores\n \n args=\n if [ \"$SCCACHE_BUCKET\" != \"\" ]; then"}, {"sha": "09a0cf3541d8dde8f7dc524db62af022933b2e5b", "filename": "src/ci/run.sh", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3d6840234c1dce3456afa131d5c42221a9c6a0f0/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/3d6840234c1dce3456afa131d5c42221a9c6a0f0/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=3d6840234c1dce3456afa131d5c42221a9c6a0f0", "patch": "@@ -24,6 +24,11 @@ if [ \"$NO_CHANGE_USER\" = \"\" ]; then\n   fi\n fi\n \n+# only enable core dump on Linux\n+if [ -f /proc/sys/kernel/core_pattern ]; then\n+  ulimit -c unlimited\n+fi\n+\n ci_dir=`cd $(dirname $0) && pwd`\n source \"$ci_dir/shared.sh\"\n "}]}