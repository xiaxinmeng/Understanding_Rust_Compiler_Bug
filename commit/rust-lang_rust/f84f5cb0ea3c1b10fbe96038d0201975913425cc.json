{"sha": "f84f5cb0ea3c1b10fbe96038d0201975913425cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NGY1Y2IwZWEzYzFiMTBmYmU5NjAzOGQwMjAxOTc1OTEzNDI1Y2M=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-01-13T12:09:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-13T12:09:26Z"}, "message": "Merge #7262\n\n7262: Don't show internal server error on rename r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "efabf4ed9338b7081ff2ceb4546c39c789275492", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efabf4ed9338b7081ff2ceb4546c39c789275492"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f84f5cb0ea3c1b10fbe96038d0201975913425cc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf/uL2CRBK7hj4Ov3rIwAAdHIIAAIOilaHtUIXd852J1mJA6e3\n1vGjeiZtGP1NpKO1GgQ7NB0ozmwFOh4h/diL94GR6OXX3imigoFXItj7/bkKFp/t\nFyPajTcErSbJSJz4u4UqPKIZMU3zTjawICRfg94vim9+sWuDGMILuJ+bBgx+Wuny\nQz6n1NVRlDzaCmRuRQZScDPU1lLTj641IJJkU7RpamOt5kZXSOhFMI/E4+txrqrG\nEVvMiYVSnZB0Ez8tZxodSzl694cAHZTMG/9h+r0R9wL8cD95CTXSdGUKnxt5kXGJ\nVlligbk08iAc6GS/qLp0Ca7wIag3alrzlH7m/VTgh2+8rEBLlsnV+7H0Rez0swo=\n=Wr95\n-----END PGP SIGNATURE-----\n", "payload": "tree efabf4ed9338b7081ff2ceb4546c39c789275492\nparent e41b36302784fc2661b4be2e13cb9a54cfa08ac9\nparent f0e802f4903cee864b193beb2ddcd50d6d9f60c7\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1610539766 +0000\ncommitter GitHub <noreply@github.com> 1610539766 +0000\n\nMerge #7262\n\n7262: Don't show internal server error on rename r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f84f5cb0ea3c1b10fbe96038d0201975913425cc", "html_url": "https://github.com/rust-lang/rust/commit/f84f5cb0ea3c1b10fbe96038d0201975913425cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f84f5cb0ea3c1b10fbe96038d0201975913425cc/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e41b36302784fc2661b4be2e13cb9a54cfa08ac9", "url": "https://api.github.com/repos/rust-lang/rust/commits/e41b36302784fc2661b4be2e13cb9a54cfa08ac9", "html_url": "https://github.com/rust-lang/rust/commit/e41b36302784fc2661b4be2e13cb9a54cfa08ac9"}, {"sha": "f0e802f4903cee864b193beb2ddcd50d6d9f60c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0e802f4903cee864b193beb2ddcd50d6d9f60c7", "html_url": "https://github.com/rust-lang/rust/commit/f0e802f4903cee864b193beb2ddcd50d6d9f60c7"}], "stats": {"total": 24, "additions": 10, "deletions": 14}, "files": [{"sha": "c3ae568c28b05fc8e761cb2d36cf1d5c21b890df", "filename": "crates/ide/src/references/rename.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Fide%2Fsrc%2Freferences%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Fide%2Fsrc%2Freferences%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Freferences%2Frename.rs?ref=f84f5cb0ea3c1b10fbe96038d0201975913425cc", "patch": "@@ -1,7 +1,6 @@\n //! FIXME: write short doc here\n use std::{\n     convert::TryInto,\n-    error::Error,\n     fmt::{self, Display},\n };\n \n@@ -35,8 +34,6 @@ impl fmt::Display for RenameError {\n     }\n }\n \n-impl Error for RenameError {}\n-\n macro_rules! format_err {\n     ($fmt:expr) => {RenameError(format!($fmt))};\n     ($fmt:expr, $($arg:tt)+) => {RenameError(format!($fmt, $($arg)+))}"}, {"sha": "70dd519110037dbdd62109a2ee55acee214d8027", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=f84f5cb0ea3c1b10fbe96038d0201975913425cc", "patch": "@@ -773,7 +773,8 @@ pub(crate) fn handle_prepare_rename(\n     let _p = profile::span(\"handle_prepare_rename\");\n     let position = from_proto::file_position(&snap, params)?;\n \n-    let change = snap.analysis.prepare_rename(position)??;\n+    let change = snap.analysis.prepare_rename(position)?.map_err(to_proto::rename_error)?;\n+\n     let line_index = snap.analysis.file_line_index(position.file_id)?;\n     let range = to_proto::range(&line_index, change.range);\n     Ok(Some(PrepareRenameResponse::Range(range)))\n@@ -786,15 +787,8 @@ pub(crate) fn handle_rename(\n     let _p = profile::span(\"handle_rename\");\n     let position = from_proto::file_position(&snap, params.text_document_position)?;\n \n-    if params.new_name.is_empty() {\n-        return Err(LspError::new(\n-            ErrorCode::InvalidParams as i32,\n-            \"New Name cannot be empty\".into(),\n-        )\n-        .into());\n-    }\n-\n-    let change = snap.analysis.rename(position, &*params.new_name)??;\n+    let change =\n+        snap.analysis.rename(position, &*params.new_name)?.map_err(to_proto::rename_error)?;\n     let workspace_edit = to_proto::workspace_edit(&snap, change.info)?;\n     Ok(Some(workspace_edit))\n }"}, {"sha": "a7ff8975adfe17e900ba56bd9f65fa446fe20e92", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f84f5cb0ea3c1b10fbe96038d0201975913425cc/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=f84f5cb0ea3c1b10fbe96038d0201975913425cc", "patch": "@@ -8,7 +8,8 @@ use ide::{\n     Assist, AssistKind, CallInfo, CompletionItem, CompletionItemKind, Documentation, FileId,\n     FileRange, FileSystemEdit, Fold, FoldKind, Highlight, HlMod, HlPunct, HlRange, HlTag, Indel,\n     InlayHint, InlayKind, InsertTextFormat, LineIndex, Markup, NavigationTarget, ReferenceAccess,\n-    Runnable, Severity, SourceChange, SourceFileEdit, SymbolKind, TextEdit, TextRange, TextSize,\n+    RenameError, Runnable, Severity, SourceChange, SourceFileEdit, SymbolKind, TextEdit, TextRange,\n+    TextSize,\n };\n use itertools::Itertools;\n \n@@ -855,6 +856,10 @@ pub(crate) fn markup_content(markup: Markup) -> lsp_types::MarkupContent {\n     lsp_types::MarkupContent { kind: lsp_types::MarkupKind::Markdown, value }\n }\n \n+pub(crate) fn rename_error(err: RenameError) -> crate::LspError {\n+    crate::LspError { code: lsp_server::ErrorCode::InvalidParams as i32, message: err.to_string() }\n+}\n+\n #[cfg(test)]\n mod tests {\n     use ide::Analysis;"}]}