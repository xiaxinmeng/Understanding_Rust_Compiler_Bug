{"sha": "45bcf59bdee49bb81182e89abceae2d5466e9986", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ1YmNmNTliZGVlNDliYjgxMTgyZTg5YWJjZWFlMmQ1NDY2ZTk5ODY=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-10-23T22:14:24Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-10-23T22:14:24Z"}, "message": "Merge pull request #528 from marcusklaas/chain-idempotence\n\nRestore idempotence for chain formatting", "tree": {"sha": "510aa2655b3ebf20986c95dfe42e5ea6b723f194", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/510aa2655b3ebf20986c95dfe42e5ea6b723f194"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/45bcf59bdee49bb81182e89abceae2d5466e9986", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/45bcf59bdee49bb81182e89abceae2d5466e9986", "html_url": "https://github.com/rust-lang/rust/commit/45bcf59bdee49bb81182e89abceae2d5466e9986", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/45bcf59bdee49bb81182e89abceae2d5466e9986/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02c118ae7207c2d5a48a2b1cf5f6a59dbbe1d314", "url": "https://api.github.com/repos/rust-lang/rust/commits/02c118ae7207c2d5a48a2b1cf5f6a59dbbe1d314", "html_url": "https://github.com/rust-lang/rust/commit/02c118ae7207c2d5a48a2b1cf5f6a59dbbe1d314"}, {"sha": "0bb979bb852ca8889492f595245ec9f55d1c94e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0bb979bb852ca8889492f595245ec9f55d1c94e8", "html_url": "https://github.com/rust-lang/rust/commit/0bb979bb852ca8889492f595245ec9f55d1c94e8"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "f004a5798c2a24ec245ddecdd446a8612f1ddf92", "filename": "src/chains.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/45bcf59bdee49bb81182e89abceae2d5466e9986/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45bcf59bdee49bb81182e89abceae2d5466e9986/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=45bcf59bdee49bb81182e89abceae2d5466e9986", "patch": "@@ -80,11 +80,11 @@ pub fn rewrite_chain(mut expr: &ast::Expr,\n     let veto_single_line = if context.config.take_source_hints && subexpr_list.len() > 1 {\n         // Look at the source code. Unless all chain elements start on the same\n         // line, we won't consider putting them on a single line either.\n-        let first_line_no = context.codemap.lookup_char_pos(subexpr_list[0].span.lo).line;\n+        let last_span = context.snippet(mk_sp(subexpr_list[1].span.hi, total_span.hi));\n+        let first_span = context.snippet(subexpr_list[1].span);\n+        let last_iter = last_span.chars().take_while(|c| c.is_whitespace());\n \n-        subexpr_list[1..]\n-            .iter()\n-            .any(|ex| context.codemap.lookup_char_pos(ex.span.hi).line != first_line_no)\n+        first_span.chars().chain(last_iter).any(|c| c == '\\n')\n     } else {\n         false\n     };"}, {"sha": "bf1ed31afe70ec66dc5950cf195f32077a9425f2", "filename": "tests/source/chains.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Fsource%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Fsource%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fchains.rs?ref=45bcf59bdee49bb81182e89abceae2d5466e9986", "patch": "@@ -101,3 +101,8 @@ fn floaters() {\n \n     a + match x { true => \"yay!\", false => \"boo!\" }.bar()\n }\n+\n+fn is_replaced_content() -> bool {\n+    constellat.send(ConstellationMsg::ViewportConstrained(\n+            self.id, constraints)).unwrap();\n+}"}, {"sha": "400db5f8df50753edab873484c159ee74aa9a919", "filename": "tests/target/chains-no-overflow.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Ftarget%2Fchains-no-overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Ftarget%2Fchains-no-overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains-no-overflow.rs?ref=45bcf59bdee49bb81182e89abceae2d5466e9986", "patch": "@@ -2,7 +2,8 @@\n // Test chain formatting without overflowing the last item.\n \n fn main() {\n-    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc.ddddddddddddddddddddddddddd();\n+    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n+                       .ddddddddddddddddddddddddddd();\n \n     bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n                        .ddddddddddddddddddddddddddd"}, {"sha": "2fb201011a5c2ad4107a0d733c9952f0fecf8d35", "filename": "tests/target/chains.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Ftarget%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45bcf59bdee49bb81182e89abceae2d5466e9986/tests%2Ftarget%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains.rs?ref=45bcf59bdee49bb81182e89abceae2d5466e9986", "patch": "@@ -7,7 +7,8 @@ fn main() {\n              .1\n              .foo(|x| x + 1);\n \n-    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc.ddddddddddddddddddddddddddd();\n+    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n+                       .ddddddddddddddddddddddddddd();\n \n     bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n                        .ddddddddddddddddddddddddddd\n@@ -126,3 +127,8 @@ fn floaters() {\n     }\n     .bar()\n }\n+\n+fn is_replaced_content() -> bool {\n+    constellat.send(ConstellationMsg::ViewportConstrained(self.id, constraints))\n+              .unwrap();\n+}"}]}