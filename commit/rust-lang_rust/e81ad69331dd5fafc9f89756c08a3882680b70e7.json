{"sha": "e81ad69331dd5fafc9f89756c08a3882680b70e7", "node_id": "C_kwDOAAsO6NoAKGU4MWFkNjkzMzFkZDVmYWZjOWY4OTc1NmMwOGEzODgyNjgwYjcwZTc", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-12-10T20:01:48Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-12-10T20:01:48Z"}, "message": "Don't take into account hashtag prepended lines if not in rust code block", "tree": {"sha": "f2a8c8a9b28e3e9324be464d5d9e45d58b35a6f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f2a8c8a9b28e3e9324be464d5d9e45d58b35a6f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e81ad69331dd5fafc9f89756c08a3882680b70e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e81ad69331dd5fafc9f89756c08a3882680b70e7", "html_url": "https://github.com/rust-lang/rust/commit/e81ad69331dd5fafc9f89756c08a3882680b70e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e81ad69331dd5fafc9f89756c08a3882680b70e7/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a161a7b654083a881b22908a475988bcc3221a79", "url": "https://api.github.com/repos/rust-lang/rust/commits/a161a7b654083a881b22908a475988bcc3221a79", "html_url": "https://github.com/rust-lang/rust/commit/a161a7b654083a881b22908a475988bcc3221a79"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "1e1c657b0bf22f7d71306f57099be4ac8d9c3145", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e81ad69331dd5fafc9f89756c08a3882680b70e7/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e81ad69331dd5fafc9f89756c08a3882680b70e7/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=e81ad69331dd5fafc9f89756c08a3882680b70e7", "patch": "@@ -246,8 +246,6 @@ impl<'a, I: Iterator<Item = Event<'a>>> Iterator for CodeBlocks<'_, 'a, I> {\n                 _ => {}\n             }\n         }\n-        let lines = origtext.lines().filter_map(|l| map_line(l).for_html());\n-        let text = lines.intersperse(\"\\n\".into()).collect::<String>();\n \n         let parse_result = match kind {\n             CodeBlockKind::Fenced(ref lang) => {\n@@ -260,7 +258,7 @@ impl<'a, I: Iterator<Item = Event<'a>>> Iterator for CodeBlocks<'_, 'a, I> {\n                                  <pre class=\\\"language-{}\\\"><code>{}</code></pre>\\\n                              </div>\",\n                             lang,\n-                            Escape(&text),\n+                            Escape(&origtext),\n                         )\n                         .into(),\n                     ));\n@@ -270,6 +268,9 @@ impl<'a, I: Iterator<Item = Event<'a>>> Iterator for CodeBlocks<'_, 'a, I> {\n             CodeBlockKind::Indented => Default::default(),\n         };\n \n+        let lines = origtext.lines().filter_map(|l| map_line(l).for_html());\n+        let text = lines.intersperse(\"\\n\".into()).collect::<String>();\n+\n         compile_fail = parse_result.compile_fail;\n         should_panic = parse_result.should_panic;\n         ignore = parse_result.ignore;"}]}