{"sha": "602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwMmUxYTAzZmNkMDBmOWE0ZGZjOTdhYzUxY2U1NjFmZGJhZmIxYTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-06T10:25:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-06T10:25:32Z"}, "message": "Auto merge of #1168 - RalfJung:rustup, r=RalfJung\n\nRustup", "tree": {"sha": "fe9edad057d30c218318992eebf88ce99cc229a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe9edad057d30c218318992eebf88ce99cc229a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "html_url": "https://github.com/rust-lang/rust/commit/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad7b1bd8367b1dc141ae23033f195ef03e3ccde1", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad7b1bd8367b1dc141ae23033f195ef03e3ccde1", "html_url": "https://github.com/rust-lang/rust/commit/ad7b1bd8367b1dc141ae23033f195ef03e3ccde1"}, {"sha": "5d2caef3cebe97fc6cf67971064c0d5cf7bc974a", "url": "https://api.github.com/repos/rust-lang/rust/commits/5d2caef3cebe97fc6cf67971064c0d5cf7bc974a", "html_url": "https://github.com/rust-lang/rust/commit/5d2caef3cebe97fc6cf67971064c0d5cf7bc974a"}], "stats": {"total": 83, "additions": 22, "deletions": 61}, "files": [{"sha": "1ea3561cca3ac4f77392a5482b1566c6b4b5e918", "filename": "rust-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/rust-version", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/rust-version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-version?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1 +1 @@\n-0cbcb17d3306d6e22eafc2c05ce885db97d0189c\n+333c32a5a4a51cae562c47e0669bc5aeaf741c45"}, {"sha": "9cae97a4060cf7bff3243ab4fe68d354cddaa9cc", "filename": "src/shims/intrinsics.rs", "status": "modified", "additions": 0, "deletions": 40, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/src%2Fshims%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/src%2Fshims%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fintrinsics.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -518,46 +518,6 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                 this.write_scalar(Scalar::from_uint(align.bytes(), ptr_size), dest)?;\n             }\n \n-            \"unchecked_div\" => {\n-                let l = this.read_immediate(args[0])?;\n-                let r = this.read_immediate(args[1])?;\n-                let rval = r.to_scalar()?.to_bits(args[1].layout.size)?;\n-                if rval == 0 {\n-                    throw_ub_format!(\"Division by 0 in unchecked_div\");\n-                }\n-                this.binop_ignore_overflow(mir::BinOp::Div, l, r, dest)?;\n-            }\n-\n-            \"unchecked_rem\" => {\n-                let l = this.read_immediate(args[0])?;\n-                let r = this.read_immediate(args[1])?;\n-                let rval = r.to_scalar()?.to_bits(args[1].layout.size)?;\n-                if rval == 0 {\n-                    throw_ub_format!(\"Division by 0 in unchecked_rem\");\n-                }\n-                this.binop_ignore_overflow(mir::BinOp::Rem, l, r, dest)?;\n-            }\n-\n-            #[rustfmt::skip]\n-            | \"unchecked_add\"\n-            | \"unchecked_sub\"\n-            | \"unchecked_mul\"\n-            => {\n-                let l = this.read_immediate(args[0])?;\n-                let r = this.read_immediate(args[1])?;\n-                let op = match intrinsic_name {\n-                    \"unchecked_add\" => mir::BinOp::Add,\n-                    \"unchecked_sub\" => mir::BinOp::Sub,\n-                    \"unchecked_mul\" => mir::BinOp::Mul,\n-                    _ => bug!(),\n-                };\n-                let (res, overflowed, _ty) = this.overflowing_binary_op(op, l, r)?;\n-                if overflowed {\n-                    throw_ub_format!(\"Overflowing arithmetic in {}\", intrinsic_name);\n-                }\n-                this.write_scalar(res, dest)?;\n-            }\n-\n             \"uninit\" => {\n                 // Check fast path: we don't want to force an allocation in case the destination is a simple value,\n                 // but we also do not want to create a new allocation with 0s and then copy that over."}, {"sha": "d67d06dc1e6742fdbf7f3b3787a5ef223585268d", "filename": "tests/compile-fail/div-by-zero-1.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Fdiv-by-zero-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Fdiv-by-zero-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fdiv-by-zero-1.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -2,10 +2,8 @@\n \n use std::intrinsics::*;\n \n-//error-pattern: Division by 0 in unchecked_div\n-\n fn main() {\n     unsafe {\n-        let _n = unchecked_div(1i64, 0);\n+        let _n = unchecked_div(1i64, 0); //~ERROR dividing by zero\n     }\n }"}, {"sha": "e904049e3b466e7bef51486a3ea3f91008902056", "filename": "tests/compile-fail/div-by-zero-2.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Fdiv-by-zero-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Fdiv-by-zero-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fdiv-by-zero-2.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -0,0 +1,9 @@\n+#![feature(core_intrinsics)]\n+\n+use std::intrinsics::*;\n+\n+fn main() {\n+    unsafe {\n+        let _n = unchecked_rem(3u32, 0); //~ ERROR calculating the remainder with a divisor of zero\n+    }\n+}"}, {"sha": "3200504ddb6e1d45ce85daf15d1345f995f49294", "filename": "tests/compile-fail/div-by-zero-3.rs", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ad7b1bd8367b1dc141ae23033f195ef03e3ccde1/tests%2Fcompile-fail%2Fdiv-by-zero-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad7b1bd8367b1dc141ae23033f195ef03e3ccde1/tests%2Fcompile-fail%2Fdiv-by-zero-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fdiv-by-zero-3.rs?ref=ad7b1bd8367b1dc141ae23033f195ef03e3ccde1", "patch": "@@ -1,11 +0,0 @@\n-#![feature(core_intrinsics)]\n-\n-use std::intrinsics::*;\n-\n-//error-pattern: Division by 0 in unchecked_rem\n-\n-fn main() {\n-    unsafe {\n-        let _n = unchecked_rem(3u32, 0);\n-    }\n-}"}, {"sha": "eb5a41fdfaf9d4bb5128e2c264bb5fe65b36fce3", "filename": "tests/compile-fail/unchecked_add1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_add1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_add1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_add1.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MAX overflow\n-    unsafe { std::intrinsics::unchecked_add(40000u16, 30000); } //~ ERROR Overflowing arithmetic in unchecked_add\n+    unsafe { std::intrinsics::unchecked_add(40000u16, 30000); } //~ ERROR Overflow executing `unchecked_add`\n }"}, {"sha": "fa6a232aedee9c23843237f88ded47c03bd172e5", "filename": "tests/compile-fail/unchecked_add2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_add2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_add2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_add2.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MIN overflow\n-    unsafe { std::intrinsics::unchecked_add(-30000i16, -8000); } //~ ERROR Overflowing arithmetic in unchecked_add\n+    unsafe { std::intrinsics::unchecked_add(-30000i16, -8000); } //~ ERROR Overflow executing `unchecked_add`\n }"}, {"sha": "1d1bbb09aa267f56bd6004d35f5266fa301c1c90", "filename": "tests/compile-fail/unchecked_div1.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_div1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_div1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_div1.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -0,0 +1,5 @@\n+#![feature(core_intrinsics)]\n+fn main() {\n+    // MIN/-1 cannot be represented\n+    unsafe { std::intrinsics::unchecked_div(i16::min_value(), -1); } //~ ERROR Overflow executing `unchecked_div`\n+}"}, {"sha": "a3681a57df79d255f6410d5e4951c706551ec542", "filename": "tests/compile-fail/unchecked_mul1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_mul1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_mul1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_mul1.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MAX overflow\n-    unsafe { std::intrinsics::unchecked_mul(300u16, 250u16); } //~ ERROR Overflowing arithmetic in unchecked_mul\n+    unsafe { std::intrinsics::unchecked_mul(300u16, 250u16); } //~ ERROR Overflow executing `unchecked_mul`\n }"}, {"sha": "8fe677f8ded53028a40095d5d396df3ea0aa088c", "filename": "tests/compile-fail/unchecked_mul2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_mul2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_mul2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_mul2.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MIN overflow\n-    unsafe { std::intrinsics::unchecked_mul(1_000_000_000i32, -4); } //~ ERROR Overflowing arithmetic in unchecked_mul\n+    unsafe { std::intrinsics::unchecked_mul(1_000_000_000i32, -4); } //~ ERROR Overflow executing `unchecked_mul`\n }"}, {"sha": "230607f033058c80a4bf92ddc77cbd4d28ae4ee0", "filename": "tests/compile-fail/unchecked_sub1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_sub1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_sub1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_sub1.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MIN overflow\n-    unsafe { std::intrinsics::unchecked_sub(14u32, 22); } //~ ERROR Overflowing arithmetic in unchecked_sub\n+    unsafe { std::intrinsics::unchecked_sub(14u32, 22); } //~ ERROR Overflow executing `unchecked_sub`\n }"}, {"sha": "1ea41a3c0fb07693089c10c7db3cd9edecfff3bd", "filename": "tests/compile-fail/unchecked_sub2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_sub2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7/tests%2Fcompile-fail%2Funchecked_sub2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Funchecked_sub2.rs?ref=602e1a03fcd00f9a4dfc97ac51ce561fdbafb1a7", "patch": "@@ -1,5 +1,5 @@\n #![feature(core_intrinsics)]\n fn main() {\n     // MAX overflow\n-    unsafe { std::intrinsics::unchecked_sub(30000i16, -7000); } //~ ERROR Overflowing arithmetic in unchecked_sub\n+    unsafe { std::intrinsics::unchecked_sub(30000i16, -7000); } //~ ERROR Overflow executing `unchecked_sub`\n }"}]}