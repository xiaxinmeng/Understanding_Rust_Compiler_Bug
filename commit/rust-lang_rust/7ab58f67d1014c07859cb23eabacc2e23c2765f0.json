{"sha": "7ab58f67d1014c07859cb23eabacc2e23c2765f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhYjU4ZjY3ZDEwMTRjMDc4NTljYjIzZWFiYWNjMmUyM2MyNzY1ZjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-09T07:56:19Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-09T07:56:19Z"}, "message": "auto merge of #17083 : thestinger/rust/jemalloc, r=alexcrichton\n\nThe performance hit from these checks is significant, but unoptimized\r\nbuilds are already incredibly slow. Enabling these checks results in\r\nbetter test coverage since there are bots doing unoptimized builds, and\r\nthe cost is relatively small in the context of an unoptimized build.\r\nThis also allows using `JEMALLOC_FLAGS` to override the default\r\nconfigure flags.", "tree": {"sha": "c93dd3526e2efdccf24400db7f7865d6c2c3f52c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c93dd3526e2efdccf24400db7f7865d6c2c3f52c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ab58f67d1014c07859cb23eabacc2e23c2765f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ab58f67d1014c07859cb23eabacc2e23c2765f0", "html_url": "https://github.com/rust-lang/rust/commit/7ab58f67d1014c07859cb23eabacc2e23c2765f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ab58f67d1014c07859cb23eabacc2e23c2765f0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "641b1980a4031f711099c5791653464f93c43ebf", "url": "https://api.github.com/repos/rust-lang/rust/commits/641b1980a4031f711099c5791653464f93c43ebf", "html_url": "https://github.com/rust-lang/rust/commit/641b1980a4031f711099c5791653464f93c43ebf"}, {"sha": "1ee099da36f6ac647747806558e555c5fe8dcd12", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ee099da36f6ac647747806558e555c5fe8dcd12", "html_url": "https://github.com/rust-lang/rust/commit/1ee099da36f6ac647747806558e555c5fe8dcd12"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "48b211167cf18736e976d22f546e232110fdc7e9", "filename": "Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7ab58f67d1014c07859cb23eabacc2e23c2765f0/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/7ab58f67d1014c07859cb23eabacc2e23c2765f0/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=7ab58f67d1014c07859cb23eabacc2e23c2765f0", "patch": "@@ -65,6 +65,7 @@\n #\n #   * `VERBOSE=1` - Print all commands. Use this to see what's going on.\n #   * `RUSTFLAGS=...` - Add compiler flags to all `rustc` invocations\n+#   * `JEMALLOC_FLAGS=...` - Pass flags to jemalloc's configure script\n #\n #   * `TESTNAME=...` - Specify the name of tests to run\n #   * `CHECK_IGNORED=1` - Run normally-ignored tests"}, {"sha": "3d5d0b441f18c39d87163299bd2d72e2ee08938c", "filename": "mk/main.mk", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7ab58f67d1014c07859cb23eabacc2e23c2765f0/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7ab58f67d1014c07859cb23eabacc2e23c2765f0/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=7ab58f67d1014c07859cb23eabacc2e23c2765f0", "patch": "@@ -90,15 +90,19 @@ endif\n CFG_RUSTC_FLAGS := $(RUSTFLAGS)\n CFG_GCCISH_CFLAGS :=\n CFG_GCCISH_LINK_FLAGS :=\n+CFG_JEMALLOC_FLAGS :=\n \n ifdef CFG_DISABLE_OPTIMIZE\n   $(info cfg: disabling rustc optimization (CFG_DISABLE_OPTIMIZE))\n   CFG_RUSTC_FLAGS +=\n+  CFG_JEMALLOC_FLAGS += --enable-debug\n else\n   # The rtopt cfg turns off runtime sanity checks\n   CFG_RUSTC_FLAGS += -O --cfg rtopt\n endif\n \n+CFG_JEMALLOC_FLAGS += $(JEMALLOC_FLAGS)\n+\n ifdef CFG_DISABLE_DEBUG\n   CFG_RUSTC_FLAGS += --cfg ndebug\n   CFG_GCCISH_CFLAGS += -DRUST_NDEBUG"}, {"sha": "216abcf5f3e80504e91321c71e158ce3f942dfa8", "filename": "mk/rt.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7ab58f67d1014c07859cb23eabacc2e23c2765f0/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7ab58f67d1014c07859cb23eabacc2e23c2765f0/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=7ab58f67d1014c07859cb23eabacc2e23c2765f0", "patch": "@@ -301,7 +301,7 @@ JEMALLOC_LOCAL_$(1) := $$(JEMALLOC_BUILD_DIR_$(1))/lib/$$(JEMALLOC_REAL_NAME_$(1\n $$(JEMALLOC_LOCAL_$(1)): $$(JEMALLOC_DEPS) $$(MKFILE_DEPS)\n \t@$$(call E, make: jemalloc)\n \tcd \"$$(JEMALLOC_BUILD_DIR_$(1))\"; \"$(S)src/jemalloc/configure\" \\\n-\t\t$$(JEMALLOC_ARGS_$(1)) --with-jemalloc-prefix=je_ \\\n+\t\t$$(JEMALLOC_ARGS_$(1)) --with-jemalloc-prefix=je_ $(CFG_JEMALLOC_FLAGS) \\\n \t\t--build=$(CFG_BUILD) --host=$(1) \\\n \t\tCC=\"$$(CC_$(1))\" \\\n \t\tAR=\"$$(AR_$(1))\" \\"}]}