{"sha": "e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1ZjFiOWY2ZGM5NDE4MzI1ZjgzZDk3NjZjN2NmYWIzMGNiNDgwMTg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-04-04T18:56:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-04-04T18:56:53Z"}, "message": "auto merge of #13272 : ipetkov/rust/rustdoc-ignored-tests, r=alexcrichton\n\nlibrustdoc: instead of skipping ignored tests, pass them to libtest\r\nso it can report them as such.  If a test is marked as `notrust`,\r\nhowever, it will not show up in the final report.\r\n\r\nFix #12939", "tree": {"sha": "dd6f8895a3161855fcf3325c65ff3f80fde45f2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd6f8895a3161855fcf3325c65ff3f80fde45f2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "html_url": "https://github.com/rust-lang/rust/commit/e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5f1b9f6dc9418325f83d9766c7cfab30cb48018/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b27a5ad917b2746e5f28a33e64586c0d36b00f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b27a5ad917b2746e5f28a33e64586c0d36b00f3", "html_url": "https://github.com/rust-lang/rust/commit/2b27a5ad917b2746e5f28a33e64586c0d36b00f3"}, {"sha": "a0a769310117cbaafad3f2c50dd4b6d7dc83719e", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0a769310117cbaafad3f2c50dd4b6d7dc83719e", "html_url": "https://github.com/rust-lang/rust/commit/a0a769310117cbaafad3f2c50dd4b6d7dc83719e"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "e6fb5629eaf317bed75749962314b4520d3e7f7c", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e5f1b9f6dc9418325f83d9766c7cfab30cb48018/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5f1b9f6dc9418325f83d9766c7cfab30cb48018/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2013-2014 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -268,24 +268,25 @@ pub fn find_testable_code(doc: &str, tests: &mut ::test::Collector) {\n     extern fn block(_ob: *buf, text: *buf, lang: *buf, opaque: *libc::c_void) {\n         unsafe {\n             if text.is_null() { return }\n-            let (should_fail, no_run, ignore) = if lang.is_null() {\n-                (false, false, false)\n+            let (should_fail, no_run, ignore, notrust) = if lang.is_null() {\n+                (false, false, false, false)\n             } else {\n                 slice::raw::buf_as_slice((*lang).data,\n                                        (*lang).size as uint, |lang| {\n                     let s = str::from_utf8(lang).unwrap();\n                     (s.contains(\"should_fail\"),\n                      s.contains(\"no_run\"),\n-                     s.contains(\"ignore\") || s.contains(\"notrust\"))\n+                     s.contains(\"ignore\"),\n+                     s.contains(\"notrust\"))\n                 })\n             };\n-            if ignore { return }\n+            if notrust { return }\n             slice::raw::buf_as_slice((*text).data, (*text).size as uint, |text| {\n                 let tests = &mut *(opaque as *mut ::test::Collector);\n                 let text = str::from_utf8(text).unwrap();\n                 let mut lines = text.lines().map(|l| stripped_filtered_line(l).unwrap_or(l));\n                 let text = lines.collect::<~[&str]>().connect(\"\\n\");\n-                tests.add_test(text, should_fail, no_run);\n+                tests.add_test(text, should_fail, no_run, ignore);\n             })\n         }\n     }"}, {"sha": "3ede325997d732d57a172f21dea16e40b53dc35c", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e5f1b9f6dc9418325f83d9766c7cfab30cb48018/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5f1b9f6dc9418325f83d9766c7cfab30cb48018/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=e5f1b9f6dc9418325f83d9766c7cfab30cb48018", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2013-2014 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -221,7 +221,7 @@ impl Collector {\n         }\n     }\n \n-    pub fn add_test(&mut self, test: ~str, should_fail: bool, no_run: bool) {\n+    pub fn add_test(&mut self, test: ~str, should_fail: bool, no_run: bool, should_ignore: bool) {\n         let name = if self.use_headers {\n             let s = self.current_header.as_ref().map(|s| s.as_slice()).unwrap_or(\"\");\n             format!(\"{}_{}\", s, self.cnt)\n@@ -236,7 +236,7 @@ impl Collector {\n         self.tests.push(testing::TestDescAndFn {\n             desc: testing::TestDesc {\n                 name: testing::DynTestName(name),\n-                ignore: false,\n+                ignore: should_ignore,\n                 should_fail: false, // compiler failures are test failures\n             },\n             testfn: testing::DynTestFn(proc() {"}]}