{"sha": "a770d8edd0f5f6d1bc4b2abb0842f900f121c186", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3NzBkOGVkZDBmNWY2ZDFiYzRiMmFiYjA4NDJmOTAwZjEyMWMxODY=", "commit": {"author": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-09-18T09:35:53Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2018-11-02T18:49:58Z"}, "message": "Differ between inner and outer attributes", "tree": {"sha": "791eafefcc0640c1a3e3ef5ef05925d57ec97a19", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/791eafefcc0640c1a3e3ef5ef05925d57ec97a19"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a770d8edd0f5f6d1bc4b2abb0842f900f121c186", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE46kBTF5vnyuSPg0W6OiXpYcOQcIFAlvcnFYACgkQ6OiXpYcO\nQcLAHRAAhWf43J+Nx4yjKmdyYd9ohkAnfGD0m5kwCY0L+TVvg5xx/zll6OpIeTKX\nsuNWuXOViZu9aQVbcgw9Tvq72tXNC+YCvmGrn9lHQgZ7BjKh0EZgOTlgyaNXtIDJ\n31cquF/5dgHpBqH4Nv3ivcqDiZ2GN0VV5sr7MP0ck3Y+lkpmXwuBEaJKgX1Ya0Kq\nKo4xBqc1yTkdyK5VOqg/OFD23G2WosAObNFY0ycapCH7J9Rx9fxpeFA3/bVKdlha\nH+ZfpRyOhAHJIllbtCiT7Z/Inxk9Vgmd3ZJ6Olb5vXABhB72FbUJLyYNQCfatLAS\n/YDM0IUwqDK61eWThUOMMBr4FVJ/txrJQfeu/tdM+mKe9fLU+y+i4D1eMECQM/zr\nBcOiNT7bKV6Ac/KktNlT9ex1+IsmTz1oKCsE7JDfPEJET1+0pVoqQEo1N7HGgIwq\nx6voEUZhvzzk58p760YMh+MrJ0HjMx8hlw2gr1IvsFOOEgyyo7g0/lEyL2c7L2kM\nb7d7++U95Zp5VOPRZow48bia4QoWW1D3L1UqK/IZQoQ1JI2AtTmvi4puBQ8LJMEX\nNQzqYrBaiuvQNiDyQI0lPQaMPPntHaijAAevLblZEjswHD9Mbrx7lSpDOzje+C9i\n0IVmYe95PMdqIc7EsY77c+2l+qxA0wkkFlhRvy0SW9/NmggYle4=\n=uXCN\n-----END PGP SIGNATURE-----", "payload": "tree 791eafefcc0640c1a3e3ef5ef05925d57ec97a19\nparent 7bd8c303d34369124b6550ad6c645d2e1a149214\nauthor flip1995 <9744647+flip1995@users.noreply.github.com> 1537263353 +0200\ncommitter flip1995 <hello@philkrones.com> 1541184598 +0100\n\nDiffer between inner and outer attributes\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a770d8edd0f5f6d1bc4b2abb0842f900f121c186", "html_url": "https://github.com/rust-lang/rust/commit/a770d8edd0f5f6d1bc4b2abb0842f900f121c186", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a770d8edd0f5f6d1bc4b2abb0842f900f121c186/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7bd8c303d34369124b6550ad6c645d2e1a149214", "url": "https://api.github.com/repos/rust-lang/rust/commits/7bd8c303d34369124b6550ad6c645d2e1a149214", "html_url": "https://github.com/rust-lang/rust/commit/7bd8c303d34369124b6550ad6c645d2e1a149214"}], "stats": {"total": 53, "additions": 48, "deletions": 5}, "files": [{"sha": "24edf6d84952116edcd3e7df81b845ee559cc477", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 48, "deletions": 5, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/a770d8edd0f5f6d1bc4b2abb0842f900f121c186/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a770d8edd0f5f6d1bc4b2abb0842f900f121c186/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=a770d8edd0f5f6d1bc4b2abb0842f900f121c186", "patch": "@@ -172,12 +172,12 @@ declare_clippy_lint! {\n /// **What it does:** Checks for `#[cfg_attr(rustfmt, rustfmt_skip)]` and suggests to replace it\n /// with `#[rustfmt::skip]`.\n ///\n-/// **Why is this bad?** Since tool_attributes (rust-lang/rust#44690) are stable now, they should\n-/// be used instead of the old `cfg_attr(rustfmt)` attribute.\n+/// **Why is this bad?** Since tool_attributes ([rust-lang/rust#44690](https://github.com/rust-lang/rust/issues/44690))\n+/// are stable now, they should be used instead of the old `cfg_attr(rustfmt)` attributes.\n ///\n-/// **Known problems:** It currently only detects outer attributes. But since it does not really\n-/// makes sense to have `#![cfg_attr(rustfmt, rustfmt_skip)]` as an inner attribute, this should be\n-/// ok.\n+/// **Known problems:** This lint doesn't detect crate level inner attributes, because they get\n+/// processed before the PreExpansionPass lints get executed. See\n+/// [#3123](https://github.com/rust-lang-nursery/rust-clippy/pull/3123#issuecomment-422321765)\n ///\n /// **Example:**\n ///\n@@ -495,3 +495,46 @@ fn is_present_in_source(cx: &LateContext<'_, '_>, span: Span) -> bool {\n     }\n     true\n }\n+\n+#[derive(Copy, Clone)]\n+pub struct CfgAttrPass;\n+\n+impl LintPass for CfgAttrPass {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(\n+            DEPRECATED_CFG_ATTR,\n+        )\n+    }\n+}\n+\n+impl EarlyLintPass for CfgAttrPass {\n+    fn check_attribute(&mut self, cx: &EarlyContext<'_>, attr: &Attribute) {\n+        if_chain! {\n+            // check cfg_attr\n+            if attr.name() == \"cfg_attr\";\n+            if let Some(ref items) = attr.meta_item_list();\n+            if items.len() == 2;\n+            // check for `rustfmt`\n+            if let Some(feature_item) = items[0].meta_item();\n+            if feature_item.name() == \"rustfmt\";\n+            // check for `rustfmt_skip`\n+            if let Some(skip_item) = &items[1].meta_item();\n+            if skip_item.name() == \"rustfmt_skip\";\n+            then {\n+                let attr_style = match attr.style {\n+                    AttrStyle::Outer => \"#[\",\n+                    AttrStyle::Inner => \"#![\",\n+                };\n+                span_lint_and_sugg(\n+                    cx,\n+                    DEPRECATED_CFG_ATTR,\n+                    attr.span,\n+                    \"`cfg_attr` is deprecated for rustfmt and got replaced by tool_attributes\",\n+                    \"use\",\n+                    format!(\"{}rustfmt::skip]\", attr_style),\n+                );\n+            }\n+        }\n+    }\n+}\n+"}]}