{"sha": "f49f1b1574ff70df062ff38272125a55777a720b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0OWYxYjE1NzRmZjcwZGYwNjJmZjM4MjcyMTI1YTU1Nzc3YTcyMGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-17T08:25:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-17T08:25:26Z"}, "message": "Auto merge of #7364 - flip1995:rustup, r=flip1995\n\nRustup\n\nr? `@ghost`\n\nchangelog: none", "tree": {"sha": "8ce99d1faa97ab62cfe619ff3258a899b3947167", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ce99d1faa97ab62cfe619ff3258a899b3947167"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f49f1b1574ff70df062ff38272125a55777a720b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f49f1b1574ff70df062ff38272125a55777a720b", "html_url": "https://github.com/rust-lang/rust/commit/f49f1b1574ff70df062ff38272125a55777a720b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f49f1b1574ff70df062ff38272125a55777a720b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c9da3c1e4f22504efbc198d5428ea2ac963b924", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c9da3c1e4f22504efbc198d5428ea2ac963b924", "html_url": "https://github.com/rust-lang/rust/commit/7c9da3c1e4f22504efbc198d5428ea2ac963b924"}, {"sha": "8302eefacde4d6f18f835f253c188e9821644c52", "url": "https://api.github.com/repos/rust-lang/rust/commits/8302eefacde4d6f18f835f253c188e9821644c52", "html_url": "https://github.com/rust-lang/rust/commit/8302eefacde4d6f18f835f253c188e9821644c52"}], "stats": {"total": 60, "additions": 38, "deletions": 22}, "files": [{"sha": "9b5d9b2adf3b2413c85027477d1a2e36043b9801", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,6 +1,6 @@\n [package]\n name = \"clippy\"\n-version = \"0.1.54\"\n+version = \"0.1.55\"\n authors = [\"The Rust Clippy Developers\"]\n description = \"A bunch of helpful lints to avoid common pitfalls in Rust\"\n repository = \"https://github.com/rust-lang/rust-clippy\""}, {"sha": "d3d12062f0772f837f7127382afbd8b5d3324876", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,7 +1,7 @@\n [package]\n name = \"clippy_lints\"\n # begin automatic update\n-version = \"0.1.54\"\n+version = \"0.1.55\"\n # end automatic update\n authors = [\"The Rust Clippy Developers\"]\n description = \"A bunch of helpful lints to avoid common pitfalls in Rust\""}, {"sha": "2201cf56d52ab357c287633b45c8e3d0b8dbcc7e", "filename": "clippy_lints/src/misc_early/unneeded_field_pattern.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_field_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_field_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_field_pattern.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -5,7 +5,7 @@ use rustc_lint::{EarlyContext, LintContext};\n use super::UNNEEDED_FIELD_PATTERN;\n \n pub(super) fn check(cx: &EarlyContext<'_>, pat: &Pat) {\n-    if let PatKind::Struct(ref npat, ref pfields, _) = pat.kind {\n+    if let PatKind::Struct(_, ref npat, ref pfields, _) = pat.kind {\n         let mut wilds = 0;\n         let type_name = npat\n             .segments"}, {"sha": "df044538fe19d36b825bcd5d858c9833a6308961", "filename": "clippy_lints/src/misc_early/unneeded_wildcard_pattern.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_wildcard_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_wildcard_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early%2Funneeded_wildcard_pattern.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -7,7 +7,7 @@ use rustc_span::source_map::Span;\n use super::UNNEEDED_WILDCARD_PATTERN;\n \n pub(super) fn check(cx: &EarlyContext<'_>, pat: &Pat) {\n-    if let PatKind::TupleStruct(_, ref patterns) | PatKind::Tuple(ref patterns) = pat.kind {\n+    if let PatKind::TupleStruct(_, _, ref patterns) | PatKind::Tuple(ref patterns) = pat.kind {\n         if let Some(rest_index) = patterns.iter().position(|pat| pat.is_rest()) {\n             if let Some((left_index, left_pat)) = patterns[..rest_index]\n                 .iter()"}, {"sha": "b81f8d24a33e98a9dfd166fc0dc865e8269812ba", "filename": "clippy_lints/src/non_expressive_names.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fnon_expressive_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Fnon_expressive_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fnon_expressive_names.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -138,7 +138,7 @@ impl<'a, 'tcx, 'b> Visitor<'tcx> for SimilarNamesNameVisitor<'a, 'tcx, 'b> {\n                     self.check_ident(ident);\n                 }\n             },\n-            PatKind::Struct(_, ref fields, _) => {\n+            PatKind::Struct(_, _, ref fields, _) => {\n                 for field in fields {\n                     if !field.is_shorthand {\n                         self.visit_pat(&field.pat);"}, {"sha": "07a4e294049791f7256e41810c31ed22088a3426", "filename": "clippy_lints/src/unnested_or_patterns.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Funnested_or_patterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_lints%2Fsrc%2Funnested_or_patterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funnested_or_patterns.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,6 +1,6 @@\n #![allow(clippy::wildcard_imports, clippy::enum_glob_use)]\n \n-use clippy_utils::ast_utils::{eq_field_pat, eq_id, eq_pat, eq_path};\n+use clippy_utils::ast_utils::{eq_field_pat, eq_id, eq_maybe_qself, eq_pat, eq_path};\n use clippy_utils::diagnostics::span_lint_and_then;\n use clippy_utils::{meets_msrv, msrvs, over};\n use rustc_ast::mut_visit::*;\n@@ -273,16 +273,17 @@ fn transform_with_focus_on_idx(alternatives: &mut Vec<P<Pat>>, focus_idx: usize)\n             |k| always_pat!(k, Tuple(ps) => ps),\n         ),\n         // Transform `S(pre, x, post) | ... | S(pre, y, post)` into `S(pre, x | y, post)`.\n-        TupleStruct(path1, ps1) => extend_with_matching_product(\n+        TupleStruct(qself1, path1, ps1) => extend_with_matching_product(\n             ps1, start, alternatives,\n             |k, ps1, idx| matches!(\n                 k,\n-                TupleStruct(path2, ps2) if eq_path(path1, path2) && eq_pre_post(ps1, ps2, idx)\n+                TupleStruct(qself2, path2, ps2)\n+                    if eq_maybe_qself(qself1, qself2) && eq_path(path1, path2) && eq_pre_post(ps1, ps2, idx)\n             ),\n-            |k| always_pat!(k, TupleStruct(_, ps) => ps),\n+            |k| always_pat!(k, TupleStruct(_, _, ps) => ps),\n         ),\n         // Transform a record pattern `S { fp_0, ..., fp_n }`.\n-        Struct(path1, fps1, rest1) => extend_with_struct_pat(path1, fps1, *rest1, start, alternatives),\n+        Struct(qself1, path1, fps1, rest1) => extend_with_struct_pat(qself1, path1, fps1, *rest1, start, alternatives),\n     };\n \n     alternatives[focus_idx].kind = focus_kind;\n@@ -294,6 +295,7 @@ fn transform_with_focus_on_idx(alternatives: &mut Vec<P<Pat>>, focus_idx: usize)\n /// So when we fixate on some `ident_k: pat_k`, we try to find `ident_k` in the other pattern\n /// and check that all `fp_i` where `i \u2208 ((0...n) \\ k)` between two patterns are equal.\n fn extend_with_struct_pat(\n+    qself1: &Option<ast::QSelf>,\n     path1: &ast::Path,\n     fps1: &mut Vec<ast::PatField>,\n     rest1: bool,\n@@ -306,8 +308,9 @@ fn extend_with_struct_pat(\n             start,\n             alternatives,\n             |k| {\n-                matches!(k, Struct(path2, fps2, rest2)\n+                matches!(k, Struct(qself2, path2, fps2, rest2)\n                 if rest1 == *rest2 // If one struct pattern has `..` so must the other.\n+                && eq_maybe_qself(qself1, qself2)\n                 && eq_path(path1, path2)\n                 && fps1.len() == fps2.len()\n                 && fps1.iter().enumerate().all(|(idx_1, fp1)| {\n@@ -323,7 +326,7 @@ fn extend_with_struct_pat(\n                 }))\n             },\n             // Extract `p2_k`.\n-            |k| always_pat!(k, Struct(_, mut fps, _) => fps.swap_remove(pos_in_2.take().unwrap()).pat),\n+            |k| always_pat!(k, Struct(_, _, mut fps, _) => fps.swap_remove(pos_in_2.take().unwrap()).pat),\n         );\n         extend_with_tail_or(&mut fps1[idx].pat, tail_or)\n     })"}, {"sha": "6ede9011208305f5905f25435744c1bf8e735ce2", "filename": "clippy_utils/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2FCargo.toml?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,6 +1,6 @@\n [package]\n name = \"clippy_utils\"\n-version = \"0.1.54\"\n+version = \"0.1.55\"\n authors = [\"The Rust Clippy Developers\"]\n edition = \"2018\"\n publish = false"}, {"sha": "30c2260d15cacdeb05d30416ff5d0c6276c2ecb2", "filename": "clippy_utils/src/ast_utils.rs", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2Fsrc%2Fast_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2Fsrc%2Fast_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fast_utils.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -47,9 +47,14 @@ pub fn eq_pat(l: &Pat, r: &Pat) -> bool {\n         | (Ref(l, Mutability::Mut), Ref(r, Mutability::Mut)) => eq_pat(l, r),\n         (Tuple(l), Tuple(r)) | (Slice(l), Slice(r)) => over(l, r, |l, r| eq_pat(l, r)),\n         (Path(lq, lp), Path(rq, rp)) => both(lq, rq, |l, r| eq_qself(l, r)) && eq_path(lp, rp),\n-        (TupleStruct(lp, lfs), TupleStruct(rp, rfs)) => eq_path(lp, rp) && over(lfs, rfs, |l, r| eq_pat(l, r)),\n-        (Struct(lp, lfs, lr), Struct(rp, rfs, rr)) => {\n-            lr == rr && eq_path(lp, rp) && unordered_over(lfs, rfs, |lf, rf| eq_field_pat(lf, rf))\n+        (TupleStruct(lqself, lp, lfs), TupleStruct(rqself, rp, rfs)) => {\n+            eq_maybe_qself(lqself, rqself) && eq_path(lp, rp) && over(lfs, rfs, |l, r| eq_pat(l, r))\n+        },\n+        (Struct(lqself, lp, lfs, lr), Struct(rqself, rp, rfs, rr)) => {\n+            lr == rr\n+                && eq_maybe_qself(lqself, rqself)\n+                && eq_path(lp, rp)\n+                && unordered_over(lfs, rfs, |lf, rf| eq_field_pat(lf, rf))\n         },\n         (Or(ls), Or(rs)) => unordered_over(ls, rs, |l, r| eq_pat(l, r)),\n         (MacCall(l), MacCall(r)) => eq_mac_call(l, r),\n@@ -78,6 +83,14 @@ pub fn eq_qself(l: &QSelf, r: &QSelf) -> bool {\n     l.position == r.position && eq_ty(&l.ty, &r.ty)\n }\n \n+pub fn eq_maybe_qself(l: &Option<QSelf>, r: &Option<QSelf>) -> bool {\n+    match (l, r) {\n+        (Some(l), Some(r)) => eq_qself(l, r),\n+        (None, None) => true,\n+        _ => false,\n+    }\n+}\n+\n pub fn eq_path(l: &Path, r: &Path) -> bool {\n     over(&l.segments, &r.segments, |l, r| eq_path_seg(l, r))\n }\n@@ -170,7 +183,8 @@ pub fn eq_expr(l: &Expr, r: &Expr) -> bool {\n         (Path(lq, lp), Path(rq, rp)) => both(lq, rq, |l, r| eq_qself(l, r)) && eq_path(lp, rp),\n         (MacCall(l), MacCall(r)) => eq_mac_call(l, r),\n         (Struct(lse), Struct(rse)) => {\n-            eq_path(&lse.path, &rse.path)\n+            eq_maybe_qself(&lse.qself, &rse.qself)\n+                && eq_path(&lse.path, &rse.path)\n                 && eq_struct_rest(&lse.rest, &rse.rest)\n                 && unordered_over(&lse.fields, &rse.fields, |l, r| eq_field(l, r))\n         },"}, {"sha": "b913d1ce8b1f769cc2b1884feb5fae2d19722eb6", "filename": "clippy_utils/src/paths.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2Fsrc%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/clippy_utils%2Fsrc%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fpaths.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -116,8 +116,8 @@ pub const PERMISSIONS_FROM_MODE: [&str; 7] = [\"std\", \"os\", \"imp\", \"unix\", \"fs\",\n pub const POLL: [&str; 4] = [\"core\", \"task\", \"poll\", \"Poll\"];\n pub const POLL_PENDING: [&str; 5] = [\"core\", \"task\", \"poll\", \"Poll\", \"Pending\"];\n pub const POLL_READY: [&str; 5] = [\"core\", \"task\", \"poll\", \"Poll\", \"Ready\"];\n-pub const PTR_COPY: [&str; 4] = [\"core\", \"intrinsics\", \"\", \"copy\"];\n-pub const PTR_COPY_NONOVERLAPPING: [&str; 4] = [\"core\", \"intrinsics\", \"\", \"copy_nonoverlapping\"];\n+pub const PTR_COPY: [&str; 3] = [\"core\", \"intrinsics\", \"copy\"];\n+pub const PTR_COPY_NONOVERLAPPING: [&str; 3] = [\"core\", \"intrinsics\", \"copy_nonoverlapping\"];\n pub const PTR_EQ: [&str; 3] = [\"core\", \"ptr\", \"eq\"];\n pub const PTR_NULL: [&str; 3] = [\"core\", \"ptr\", \"null\"];\n pub const PTR_NULL_MUT: [&str; 3] = [\"core\", \"ptr\", \"null_mut\"];"}, {"sha": "cd73478715aeec179ae00f0e24c8d121fee7a1e3", "filename": "rust-toolchain", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/rust-toolchain", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/rust-toolchain", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-toolchain?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,3 +1,3 @@\n [toolchain]\n-channel = \"nightly-2021-06-03\"\n+channel = \"nightly-2021-06-17\"\n components = [\"llvm-tools-preview\", \"rustc-dev\", \"rust-src\"]"}, {"sha": "e00c7fbfed15745932a1929049ef96f943ae5fd2", "filename": "tests/ui/missing-doc-crate.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f49f1b1574ff70df062ff38272125a55777a720b/tests%2Fui%2Fmissing-doc-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f49f1b1574ff70df062ff38272125a55777a720b/tests%2Fui%2Fmissing-doc-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmissing-doc-crate.rs?ref=f49f1b1574ff70df062ff38272125a55777a720b", "patch": "@@ -1,5 +1,4 @@\n #![warn(clippy::missing_docs_in_private_items)]\n-#![feature(external_doc)]\n-#![doc(include = \"../../README.md\")]\n+#![doc = include_str!(\"../../README.md\")]\n \n fn main() {}"}]}