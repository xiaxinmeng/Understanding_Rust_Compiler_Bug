{"sha": "ade6c36e5319963e34c5c35a4c0c948951c48f19", "node_id": "C_kwDOAAsO6NoAKGFkZTZjMzZlNTMxOTk2M2UzNGM1YzM1YTRjMGM5NDg5NTFjNDhmMTk", "commit": {"author": {"name": "Jing Peng", "email": "pj.hades@gmail.com", "date": "2023-06-06T21:54:34Z"}, "committer": {"name": "Jing Peng", "email": "pj.hades@gmail.com", "date": "2023-06-06T21:54:34Z"}, "message": "fix\n\n- remove useless commands from test Makefile\n- do not unnecessarily remove metadata temporary files because they'll be managed by MaybeTempDir\n- remove unused FailedRemove error introduced by this PR", "tree": {"sha": "8a728426fe36b19135542cf0df2fb72b0db2b0db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a728426fe36b19135542cf0df2fb72b0db2b0db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ade6c36e5319963e34c5c35a4c0c948951c48f19", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ade6c36e5319963e34c5c35a4c0c948951c48f19", "html_url": "https://github.com/rust-lang/rust/commit/ade6c36e5319963e34c5c35a4c0c948951c48f19", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ade6c36e5319963e34c5c35a4c0c948951c48f19/comments", "author": {"login": "pjhades", "id": 1171455, "node_id": "MDQ6VXNlcjExNzE0NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1171455?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pjhades", "html_url": "https://github.com/pjhades", "followers_url": "https://api.github.com/users/pjhades/followers", "following_url": "https://api.github.com/users/pjhades/following{/other_user}", "gists_url": "https://api.github.com/users/pjhades/gists{/gist_id}", "starred_url": "https://api.github.com/users/pjhades/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pjhades/subscriptions", "organizations_url": "https://api.github.com/users/pjhades/orgs", "repos_url": "https://api.github.com/users/pjhades/repos", "events_url": "https://api.github.com/users/pjhades/events{/privacy}", "received_events_url": "https://api.github.com/users/pjhades/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pjhades", "id": 1171455, "node_id": "MDQ6VXNlcjExNzE0NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1171455?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pjhades", "html_url": "https://github.com/pjhades", "followers_url": "https://api.github.com/users/pjhades/followers", "following_url": "https://api.github.com/users/pjhades/following{/other_user}", "gists_url": "https://api.github.com/users/pjhades/gists{/gist_id}", "starred_url": "https://api.github.com/users/pjhades/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pjhades/subscriptions", "organizations_url": "https://api.github.com/users/pjhades/orgs", "repos_url": "https://api.github.com/users/pjhades/repos", "events_url": "https://api.github.com/users/pjhades/events{/privacy}", "received_events_url": "https://api.github.com/users/pjhades/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b1a1e1d95d1e40bdf57ef9d37ccbac91fc9c280", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b1a1e1d95d1e40bdf57ef9d37ccbac91fc9c280", "html_url": "https://github.com/rust-lang/rust/commit/9b1a1e1d95d1e40bdf57ef9d37ccbac91fc9c280"}], "stats": {"total": 21, "additions": 2, "deletions": 19}, "files": [{"sha": "13b3dac85d1091e75890bc830e973acfbf491ae1", "filename": "compiler/rustc_metadata/messages.ftl", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fmessages.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fmessages.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fmessages.ftl?ref=ade6c36e5319963e34c5c35a4c0c948951c48f19", "patch": "@@ -78,9 +78,6 @@ metadata_failed_create_file =\n metadata_failed_create_tempdir =\n     couldn't create a temp dir: {$err}\n \n-metadata_failed_remove =\n-    failed to remove {$filename}: {$err}\n-\n metadata_failed_write_error =\n     failed to write {$filename}: {$err}\n "}, {"sha": "fca06c0f47c22a58249b6fe41bc0d7acf3f94ef5", "filename": "compiler/rustc_metadata/src/errors.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Ferrors.rs?ref=ade6c36e5319963e34c5c35a4c0c948951c48f19", "patch": "@@ -402,13 +402,6 @@ pub struct FailedCopyToStdout {\n     pub err: Error,\n }\n \n-#[derive(Diagnostic)]\n-#[diag(metadata_failed_remove)]\n-pub struct FailedRemove {\n-    pub filename: PathBuf,\n-    pub err: Error,\n-}\n-\n #[derive(Diagnostic)]\n #[diag(metadata_binary_output_to_tty)]\n pub struct BinaryOutputToTty;"}, {"sha": "238f963ed4630120351cf4889c03305ea3c8fd00", "filename": "compiler/rustc_metadata/src/fs.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fsrc%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ade6c36e5319963e34c5c35a4c0c948951c48f19/compiler%2Frustc_metadata%2Fsrc%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Ffs.rs?ref=ade6c36e5319963e34c5c35a4c0c948951c48f19", "patch": "@@ -1,6 +1,6 @@\n use crate::errors::{\n     BinaryOutputToTty, FailedCopyToStdout, FailedCreateEncodedMetadata, FailedCreateFile,\n-    FailedCreateTempdir, FailedRemove, FailedWriteError,\n+    FailedCreateTempdir, FailedWriteError,\n };\n use crate::{encode_metadata, EncodedMetadata};\n \n@@ -109,13 +109,6 @@ pub fn encode_and_write_metadata(tcx: TyCtxt<'_>) -> (EncodedMetadata, bool) {\n             tcx.sess.emit_fatal(FailedCreateEncodedMetadata { err });\n         });\n \n-    // Delete the temporary metadata file if output is stdout\n-    if need_metadata_file && out_filename.is_stdout() {\n-        if let Err(err) = fs::remove_file(&metadata_filename) {\n-            tcx.sess.emit_err(FailedRemove { filename: metadata_filename, err });\n-        }\n-    }\n-\n     let need_metadata_module = metadata_kind == MetadataKind::Compressed;\n \n     (metadata, need_metadata_module)"}, {"sha": "80e9b6a4ded6733ef8b6fd379dadf4f09136d2b6", "filename": "tests/run-make/emit-to-stdout/Makefile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ade6c36e5319963e34c5c35a4c0c948951c48f19/tests%2Frun-make%2Femit-to-stdout%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ade6c36e5319963e34c5c35a4c0c948951c48f19/tests%2Frun-make%2Femit-to-stdout%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-make%2Femit-to-stdout%2FMakefile?ref=ade6c36e5319963e34c5c35a4c0c948951c48f19", "patch": "@@ -32,7 +32,7 @@ obj: $(OUT)\n # it there.\n metadata: $(OUT)\n \tcp $(SRC) $(OUT)\n-\t(cd $(OUT); pwd; ls -d; $(RUSTC) --emit metadata=- $(SRC) 1>/dev/ptmx 2>$(OUT)/$@ || true)\n+\t(cd $(OUT); $(RUSTC) --emit metadata=- $(SRC) 1>/dev/ptmx 2>$(OUT)/$@ || true)\n \tdiff $(OUT)/$@ emit-metadata.stderr\n \n link: $(OUT)"}]}