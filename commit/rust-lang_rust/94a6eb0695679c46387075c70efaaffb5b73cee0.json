{"sha": "94a6eb0695679c46387075c70efaaffb5b73cee0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0YTZlYjA2OTU2NzljNDYzODcwNzVjNzBlZmFhZmZiNWI3M2NlZTA=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-01-26T09:10:13Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-01-26T09:10:13Z"}, "message": "Fix dogfood tests on Appveyor\n\nThis introduces a work-around for a bug in rustup.rs when excuting\ncargo from a custom toolchain. Instead of trusting rustup to\ninvoke cargo from one of the release channels we just invoke\nnightly cargo directly.", "tree": {"sha": "dd8ae03ce228ee466abbd8c9b2ea2316e74e434b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd8ae03ce228ee466abbd8c9b2ea2316e74e434b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94a6eb0695679c46387075c70efaaffb5b73cee0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94a6eb0695679c46387075c70efaaffb5b73cee0", "html_url": "https://github.com/rust-lang/rust/commit/94a6eb0695679c46387075c70efaaffb5b73cee0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94a6eb0695679c46387075c70efaaffb5b73cee0/comments", "author": null, "committer": null, "parents": [{"sha": "c5325063c8fba725970c50708a4694902069cf35", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5325063c8fba725970c50708a4694902069cf35", "html_url": "https://github.com/rust-lang/rust/commit/c5325063c8fba725970c50708a4694902069cf35"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "20466fc567d7fd4e26ea7cafe1de31c2b5b7883b", "filename": "src/main.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/94a6eb0695679c46387075c70efaaffb5b73cee0/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94a6eb0695679c46387075c70efaaffb5b73cee0/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=94a6eb0695679c46387075c70efaaffb5b73cee0", "patch": "@@ -97,6 +97,12 @@ where\n         })\n         .map(|p| (\"CARGO_TARGET_DIR\", p));\n \n+    // Run the dogfood tests directly on nightly cargo. This is required due\n+    // to a bug in rustup.rs when running cargo on custom toolchains. See issue #3118.\n+    if std::env::var_os(\"CLIPPY_DOGFOOD\").is_some() && cfg!(windows) {\n+        args.insert(0, \"+nightly\".to_string());\n+    }\n+\n     let exit_status = std::process::Command::new(\"cargo\")\n         .args(&args)\n         .env(\"RUSTC_WRAPPER\", path)"}, {"sha": "27a3d84da4127a972ce3c912550354b97234ad4d", "filename": "tests/dogfood.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/94a6eb0695679c46387075c70efaaffb5b73cee0/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94a6eb0695679c46387075c70efaaffb5b73cee0/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=94a6eb0695679c46387075c70efaaffb5b73cee0", "patch": "@@ -1,6 +1,6 @@\n #[test]\n fn dogfood() {\n-    if option_env!(\"RUSTC_TEST_SUITE\").is_some() || cfg!(windows) {\n+    if option_env!(\"RUSTC_TEST_SUITE\").is_some() {\n         return;\n     }\n     let root_dir = std::path::PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n@@ -30,7 +30,7 @@ fn dogfood() {\n \n #[test]\n fn dogfood_tests() {\n-    if option_env!(\"RUSTC_TEST_SUITE\").is_some() || cfg!(windows) {\n+    if option_env!(\"RUSTC_TEST_SUITE\").is_some() {\n         return;\n     }\n     let root_dir = std::path::PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));"}]}