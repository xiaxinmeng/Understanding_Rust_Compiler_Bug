{"sha": "a86544b799b0fe81e2e2a734a2b49d16faad4f3d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4NjU0NGI3OTliMGZlODFlMmUyYTczNGEyYjQ5ZDE2ZmFhZDRmM2Q=", "commit": {"author": {"name": "Nicholas Nethercote", "email": "nnethercote@mozilla.com", "date": "2018-05-22T06:51:28Z"}, "committer": {"name": "Nicholas Nethercote", "email": "nnethercote@mozilla.com", "date": "2018-05-22T09:55:48Z"}, "message": "Right-size the `VecDeque` in `coerce_unsized`.\n\nThe default capacity of a VecDeque is 8, which is excessive here. In a\n\"base incremental\" check build of rustc-perf's tuple-stress benchmark,\nthis decreases total heap allocation by 26%. I couldn't see a clear\nspeedup, but it can't hurt.", "tree": {"sha": "92771ffa1435e5489e4f1e4ba1b38a6588c7bd32", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/92771ffa1435e5489e4f1e4ba1b38a6588c7bd32"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a86544b799b0fe81e2e2a734a2b49d16faad4f3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a86544b799b0fe81e2e2a734a2b49d16faad4f3d", "html_url": "https://github.com/rust-lang/rust/commit/a86544b799b0fe81e2e2a734a2b49d16faad4f3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a86544b799b0fe81e2e2a734a2b49d16faad4f3d/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c26e2e3fba61f18caca8bd43c57e1f1d799f07b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c26e2e3fba61f18caca8bd43c57e1f1d799f07b", "html_url": "https://github.com/rust-lang/rust/commit/4c26e2e3fba61f18caca8bd43c57e1f1d799f07b"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "1905ffef8db184767ee3f2749422b6a501064bc2", "filename": "src/librustc_typeck/check/coercion.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a86544b799b0fe81e2e2a734a2b49d16faad4f3d/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a86544b799b0fe81e2e2a734a2b49d16faad4f3d/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs?ref=a86544b799b0fe81e2e2a734a2b49d16faad4f3d", "patch": "@@ -537,8 +537,9 @@ impl<'f, 'gcx, 'tcx> Coerce<'f, 'gcx, 'tcx> {\n \n         let mut selcx = traits::SelectionContext::new(self);\n \n-        // Use a FIFO queue for this custom fulfillment procedure.\n-        let mut queue = VecDeque::new();\n+        // Use a FIFO queue for this custom fulfillment procedure. (The maximum\n+        // length is almost always 1.)\n+        let mut queue = VecDeque::with_capacity(1);\n \n         // Create an obligation for `Source: CoerceUnsized<Target>`.\n         let cause = ObligationCause::misc(self.cause.span, self.body_id);"}]}