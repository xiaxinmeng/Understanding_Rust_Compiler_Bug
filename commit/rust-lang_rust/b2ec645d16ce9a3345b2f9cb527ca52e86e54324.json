{"sha": "b2ec645d16ce9a3345b2f9cb527ca52e86e54324", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyZWM2NDVkMTZjZTlhMzM0NWIyZjljYjUyN2NhNTJlODZlNTQzMjQ=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-06-19T17:27:10Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-06-19T17:33:53Z"}, "message": "Incorporate review suggestions\n\nCo-authored-by: Tyler Mandry <tmandry@gmail.com>", "tree": {"sha": "751b47d1ad39a531b4345bf7cca0aa0c708fb06b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/751b47d1ad39a531b4345bf7cca0aa0c708fb06b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2ec645d16ce9a3345b2f9cb527ca52e86e54324", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2ec645d16ce9a3345b2f9cb527ca52e86e54324", "html_url": "https://github.com/rust-lang/rust/commit/b2ec645d16ce9a3345b2f9cb527ca52e86e54324", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2ec645d16ce9a3345b2f9cb527ca52e86e54324/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c178e6436a4c3f34b8790a908de044bba9401284", "url": "https://api.github.com/repos/rust-lang/rust/commits/c178e6436a4c3f34b8790a908de044bba9401284", "html_url": "https://github.com/rust-lang/rust/commit/c178e6436a4c3f34b8790a908de044bba9401284"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "59be8dc224dee57d4d1e959160ff80646e23cf6f", "filename": "src/librustc_mir/transform/generator.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b2ec645d16ce9a3345b2f9cb527ca52e86e54324/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2ec645d16ce9a3345b2f9cb527ca52e86e54324/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fgenerator.rs?ref=b2ec645d16ce9a3345b2f9cb527ca52e86e54324", "patch": "@@ -1343,7 +1343,7 @@ impl<'tcx> MirPass<'tcx> for StateTransform {\n }\n \n /// Looks for any assignments between locals (e.g., `_4 = _5`) that will both be converted to fields\n-/// in the generator state machine but whose storage does not conflict.\n+/// in the generator state machine but whose storage is not marked as conflicting\n ///\n /// Validation needs to happen immediately *before* `TransformVisitor` is invoked, not after.\n ///\n@@ -1371,7 +1371,7 @@ impl EnsureGeneratorFieldAssignmentsNeverAlias<'_> {\n \n     fn check_assigned_place(&mut self, place: Place<'tcx>, f: impl FnOnce(&mut Self)) {\n         if let Some(assigned_local) = self.saved_local_for_direct_place(place) {\n-            assert!(self.assigned_local.is_none(), \"`check_assigned_local` must not recurse\");\n+            assert!(self.assigned_local.is_none(), \"`check_assigned_place` must not recurse\");\n \n             self.assigned_local = Some(assigned_local);\n             f(self);\n@@ -1385,7 +1385,10 @@ impl Visitor<'tcx> for EnsureGeneratorFieldAssignmentsNeverAlias<'_> {\n         let lhs = match self.assigned_local {\n             Some(l) => l,\n             None => {\n-                // We should be visiting all places used in the MIR.\n+                // This visitor only invokes `visit_place` for the right-hand side of an assignment\n+                // and only after setting `self.assigned_local`. However, the default impl of\n+                // `Visitor::super_body` may call `visit_place` with a `NonUseContext` for places\n+                // with debuginfo. Ignore them here.\n                 assert!(!context.is_use());\n                 return;\n             }\n@@ -1398,8 +1401,8 @@ impl Visitor<'tcx> for EnsureGeneratorFieldAssignmentsNeverAlias<'_> {\n \n         if !self.storage_conflicts.contains(lhs, rhs) {\n             bug!(\n-                \"Assignment between generator saved locals whose storage does not conflict: \\\n-                    {:?}: {:?} = {:?}\",\n+                \"Assignment between generator saved locals whose storage is not \\\n+                    marked as conflicting: {:?}: {:?} = {:?}\",\n                 location,\n                 lhs,\n                 rhs,"}]}