{"sha": "b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxOGEzYzViNjA3MzM3NWQzY2I2ZDE3YTk3ZTdhMmJhMDQ3NGZlMzg=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-08-06T07:16:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-06T07:16:42Z"}, "message": "Merge pull request #3007 from mikerite/issue3000\n\nFix #3000", "tree": {"sha": "57e5945e6cb2a84e59f42c36f836a22087a721bc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57e5945e6cb2a84e59f42c36f836a22087a721bc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbZ/XaCRBK7hj4Ov3rIwAAdHIIACjadE3ZWnG8MC5dQG7DFiCb\n9KMj7oQlhxDfl8JhlmSzUrkhojPTEeQ6mwZ0XLDXgT9WnnBpQWQAvF0D8Y6CQ5lL\nLP/MG5YVTNKH/pedSIalSFT3cDkPR4G10wDsBzSHfr13KFiIybd4Rn7xCQaN7Oza\nIy8mHw0ptPYaPbvLv6HGv0T4A5Kzic2cdI/uvtq8LcU7HDSXxwHsrKCe8TxYpx6V\nV8Ro9BIj1Ru9g0DaWx5TeYOjriIva+wmZ9rrtHn5TDfpdcGVXsvylZQG4APLH1zR\nA4Mjb/LK+PGXSE81TWsaIAG1NwEsFJpMSMDcdAfCGiPF1k4kTlAQgZFkEP57tog=\n=ZhR1\n-----END PGP SIGNATURE-----\n", "payload": "tree 57e5945e6cb2a84e59f42c36f836a22087a721bc\nparent f6c4e303c9745b96199ccf3a6d0d77d979ee343d\nparent ffce3c77e4e1dd997b1713e0c2bf151e612fc313\nauthor Oliver Schneider <github35764891676564198441@oli-obk.de> 1533539802 +0200\ncommitter GitHub <noreply@github.com> 1533539802 +0200\n\nMerge pull request #3007 from mikerite/issue3000\n\nFix #3000"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "html_url": "https://github.com/rust-lang/rust/commit/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6c4e303c9745b96199ccf3a6d0d77d979ee343d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6c4e303c9745b96199ccf3a6d0d77d979ee343d", "html_url": "https://github.com/rust-lang/rust/commit/f6c4e303c9745b96199ccf3a6d0d77d979ee343d"}, {"sha": "ffce3c77e4e1dd997b1713e0c2bf151e612fc313", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffce3c77e4e1dd997b1713e0c2bf151e612fc313", "html_url": "https://github.com/rust-lang/rust/commit/ffce3c77e4e1dd997b1713e0c2bf151e612fc313"}], "stats": {"total": 76, "additions": 21, "deletions": 55}, "files": [{"sha": "5b6b362fdfc88cb7946c6c923ec393b185819c4a", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "patch": "@@ -178,6 +178,7 @@ mod reexport {\n \n pub fn register_pre_expansion_lints(session: &rustc::session::Session, store: &mut rustc::lint::LintStore) {\n     store.register_pre_expansion_pass(Some(session), box write::Pass);\n+    store.register_pre_expansion_pass(Some(session), box redundant_field_names::RedundantFieldNames);\n }\n \n #[cfg_attr(rustfmt, rustfmt_skip)]\n@@ -390,7 +391,6 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>) {\n     reg.register_late_lint_pass(box double_comparison::DoubleComparisonPass);\n     reg.register_late_lint_pass(box question_mark::QuestionMarkPass);\n     reg.register_late_lint_pass(box suspicious_trait_impl::SuspiciousImpl);\n-    reg.register_late_lint_pass(box redundant_field_names::RedundantFieldNames);\n     reg.register_early_lint_pass(box multiple_crate_versions::Pass);\n     reg.register_late_lint_pass(box map_unit_fn::Pass);\n     reg.register_late_lint_pass(box infallible_destructuring_match::Pass);"}, {"sha": "c5cf35edabe455246183486f72cd06c2331929e5", "filename": "clippy_lints/src/redundant_field_names.rs", "status": "modified", "additions": 18, "deletions": 22, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/clippy_lints%2Fsrc%2Fredundant_field_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/clippy_lints%2Fsrc%2Fredundant_field_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fredundant_field_names.rs?ref=b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "patch": "@@ -1,7 +1,7 @@\n use rustc::lint::*;\n use rustc::{declare_lint, lint_array};\n-use rustc::hir::*;\n-use crate::utils::{in_macro, match_var, span_lint_and_sugg};\n+use syntax::ast::*;\n+use crate::utils::{span_lint_and_sugg};\n \n /// **What it does:** Checks for fields in struct literals where shorthands\n /// could be used.\n@@ -35,28 +35,24 @@ impl LintPass for RedundantFieldNames {\n     }\n }\n \n-impl<'a, 'tcx> LateLintPass<'a, 'tcx> for RedundantFieldNames {\n-    fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr) {\n-        // Ignore all macros including range expressions.\n-        // They can have redundant field names when expanded.\n-        // e.g. range expression `start..end` is desugared to `Range { start: start, end: end }`\n-        if in_macro(expr.span) {\n-            return;\n-        }\n-\n+impl EarlyLintPass for RedundantFieldNames {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n         if let ExprKind::Struct(_, ref fields, _) = expr.node {\n             for field in fields {\n-                let name = field.ident.name;\n-\n-                if match_var(&field.expr, name) && !field.is_shorthand {\n-                    span_lint_and_sugg (\n-                        cx,\n-                        REDUNDANT_FIELD_NAMES,\n-                        field.span,\n-                        \"redundant field names in struct initialization\",\n-                        \"replace it with\",\n-                        name.to_string()\n-                    );\n+                if field.is_shorthand {\n+                    continue;\n+                }\n+                if let ExprKind::Path(None, path) = &field.expr.node {\n+                    if path.segments.len() == 1 && path.segments[0].ident == field.ident {\n+                        span_lint_and_sugg (\n+                            cx,\n+                            REDUNDANT_FIELD_NAMES,\n+                            field.span,\n+                            \"redundant field names in struct initialization\",\n+                            \"replace it with\",\n+                            field.ident.to_string()\n+                        );\n+                    }\n                 }\n             }\n         }"}, {"sha": "d757f1871a781c4026b24485163b0cd050ef837f", "filename": "tests/ui/redundant_field_names.stderr", "status": "modified", "additions": 1, "deletions": 31, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/tests%2Fui%2Fredundant_field_names.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/tests%2Fui%2Fredundant_field_names.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fredundant_field_names.stderr?ref=b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "patch": "@@ -12,36 +12,6 @@ error: redundant field names in struct initialization\n 35 |         age: age,\n    |         ^^^^^^^^ help: replace it with: `age`\n \n-error: redundant field names in struct initialization\n-  --> $DIR/redundant_field_names.rs:45:13\n-   |\n-45 |     let _ = start..;\n-   |             ^^^^^ help: replace it with: `start`\n-\n-error: redundant field names in struct initialization\n-  --> $DIR/redundant_field_names.rs:46:15\n-   |\n-46 |     let _ = ..end;\n-   |               ^^^ help: replace it with: `end`\n-\n-error: redundant field names in struct initialization\n-  --> $DIR/redundant_field_names.rs:47:13\n-   |\n-47 |     let _ = start..end;\n-   |             ^^^^^ help: replace it with: `start`\n-\n-error: redundant field names in struct initialization\n-  --> $DIR/redundant_field_names.rs:47:20\n-   |\n-47 |     let _ = start..end;\n-   |                    ^^^ help: replace it with: `end`\n-\n-error: redundant field names in struct initialization\n-  --> $DIR/redundant_field_names.rs:49:16\n-   |\n-49 |     let _ = ..=end;\n-   |                ^^^ help: replace it with: `end`\n-\n error: redundant field names in struct initialization\n   --> $DIR/redundant_field_names.rs:53:25\n    |\n@@ -72,5 +42,5 @@ error: redundant field names in struct initialization\n 57 |     let _ = RangeToInclusive { end: end };\n    |                                ^^^^^^^^ help: replace it with: `end`\n \n-error: aborting due to 12 previous errors\n+error: aborting due to 7 previous errors\n "}, {"sha": "a1a1de1e43941184eba6bba990da6f80c997e9cb", "filename": "tests/ui/trivially_copy_pass_by_ref.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/tests%2Fui%2Ftrivially_copy_pass_by_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38/tests%2Fui%2Ftrivially_copy_pass_by_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftrivially_copy_pass_by_ref.rs?ref=b18a3c5b6073375d3cb6d17a97e7a2ba0474fe38", "patch": "@@ -1,4 +1,4 @@\n-#![allow(many_single_char_names, blacklisted_name)]\n+#![allow(many_single_char_names, blacklisted_name, redundant_field_names)]\n \n #[derive(Copy, Clone)]\n struct Foo(u32);"}]}