{"sha": "1502713f994d595e4ae1ffbbe8ef3e373bbb11bc", "node_id": "C_kwDOAAsO6NoAKDE1MDI3MTNmOTk0ZDU5NWU0YWUxZmZiYmU4ZWYzZTM3M2JiYjExYmM", "commit": {"author": {"name": "Aria Beingessner", "email": "a.beingessner@gmail.com", "date": "2022-06-06T19:14:41Z"}, "committer": {"name": "Aria Beingessner", "email": "a.beingessner@gmail.com", "date": "2022-06-17T17:54:17Z"}, "message": "Impl Termination for Infallible and then make the Result impls of Termination into a blanket\n\nThis allows things like `Result<ExitCode, E>` to 'just work'", "tree": {"sha": "492ecf3d27e8dcfb1ab447c65a00a741be30fb80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/492ecf3d27e8dcfb1ab447c65a00a741be30fb80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc", "html_url": "https://github.com/rust-lang/rust/commit/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc/comments", "author": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43c47db0b04627dbd0e16a1e7cad14a4a5a60d3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/43c47db0b04627dbd0e16a1e7cad14a4a5a60d3a", "html_url": "https://github.com/rust-lang/rust/commit/43c47db0b04627dbd0e16a1e7cad14a4a5a60d3a"}], "stats": {"total": 37, "additions": 15, "deletions": 22}, "files": [{"sha": "da8eee9030b908bfd975bfb08af9e12ef15f94de", "filename": "library/std/src/process.rs", "status": "modified", "additions": 15, "deletions": 22, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc/library%2Fstd%2Fsrc%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1502713f994d595e4ae1ffbbe8ef3e373bbb11bc/library%2Fstd%2Fsrc%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprocess.rs?ref=1502713f994d595e4ae1ffbbe8ef3e373bbb11bc", "patch": "@@ -2140,16 +2140,6 @@ impl Termination for () {\n     }\n }\n \n-#[stable(feature = \"termination_trait_lib\", since = \"1.61.0\")]\n-impl<E: fmt::Debug> Termination for Result<(), E> {\n-    fn report(self) -> ExitCode {\n-        match self {\n-            Ok(()) => ().report(),\n-            Err(err) => Err::<!, _>(err).report(),\n-        }\n-    }\n-}\n-\n #[stable(feature = \"termination_trait_lib\", since = \"1.61.0\")]\n impl Termination for ! {\n     fn report(self) -> ExitCode {\n@@ -2158,28 +2148,31 @@ impl Termination for ! {\n }\n \n #[stable(feature = \"termination_trait_lib\", since = \"1.61.0\")]\n-impl<E: fmt::Debug> Termination for Result<!, E> {\n+impl Termination for Infallible {\n     fn report(self) -> ExitCode {\n-        let Err(err) = self;\n-        // Ignore error if the write fails, for example because stderr is\n-        // already closed. There is not much point panicking at this point.\n-        let _ = writeln!(io::stderr(), \"Error: {err:?}\");\n-        ExitCode::FAILURE\n+        match self {}\n     }\n }\n \n #[stable(feature = \"termination_trait_lib\", since = \"1.61.0\")]\n-impl<E: fmt::Debug> Termination for Result<Infallible, E> {\n+impl Termination for ExitCode {\n+    #[inline]\n     fn report(self) -> ExitCode {\n-        let Err(err) = self;\n-        Err::<!, _>(err).report()\n+        self\n     }\n }\n \n #[stable(feature = \"termination_trait_lib\", since = \"1.61.0\")]\n-impl Termination for ExitCode {\n-    #[inline]\n+impl<T: Termination, E: fmt::Debug> Termination for Result<T, E> {\n     fn report(self) -> ExitCode {\n-        self\n+        match self {\n+            Ok(val) => val.report(),\n+            Err(err) => {\n+                // Ignore error if the write fails, for example because stderr is\n+                // already closed. There is not much point panicking at this point.\n+                let _ = writeln!(io::stderr(), \"Error: {err:?}\");\n+                ExitCode::FAILURE\n+            }\n+        }\n     }\n }"}]}