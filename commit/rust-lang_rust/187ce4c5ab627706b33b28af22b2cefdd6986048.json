{"sha": "187ce4c5ab627706b33b28af22b2cefdd6986048", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4N2NlNGM1YWI2Mjc3MDZiMzNiMjhhZjIyYjJjZWZkZDY5ODYwNDg=", "commit": {"author": {"name": "Taiki Endo", "email": "te316e89@gmail.com", "date": "2019-03-11T14:24:49Z"}, "committer": {"name": "Taiki Endo", "email": "te316e89@gmail.com", "date": "2019-03-11T14:24:49Z"}, "message": "Fix `use_self` false positive on nested functions", "tree": {"sha": "a4e9f5da51fd5ce08bdb42bec3384d3c8ee999b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4e9f5da51fd5ce08bdb42bec3384d3c8ee999b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/187ce4c5ab627706b33b28af22b2cefdd6986048", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/187ce4c5ab627706b33b28af22b2cefdd6986048", "html_url": "https://github.com/rust-lang/rust/commit/187ce4c5ab627706b33b28af22b2cefdd6986048", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/187ce4c5ab627706b33b28af22b2cefdd6986048/comments", "author": {"login": "taiki-e", "id": 43724913, "node_id": "MDQ6VXNlcjQzNzI0OTEz", "avatar_url": "https://avatars.githubusercontent.com/u/43724913?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taiki-e", "html_url": "https://github.com/taiki-e", "followers_url": "https://api.github.com/users/taiki-e/followers", "following_url": "https://api.github.com/users/taiki-e/following{/other_user}", "gists_url": "https://api.github.com/users/taiki-e/gists{/gist_id}", "starred_url": "https://api.github.com/users/taiki-e/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taiki-e/subscriptions", "organizations_url": "https://api.github.com/users/taiki-e/orgs", "repos_url": "https://api.github.com/users/taiki-e/repos", "events_url": "https://api.github.com/users/taiki-e/events{/privacy}", "received_events_url": "https://api.github.com/users/taiki-e/received_events", "type": "User", "site_admin": false}, "committer": {"login": "taiki-e", "id": 43724913, "node_id": "MDQ6VXNlcjQzNzI0OTEz", "avatar_url": "https://avatars.githubusercontent.com/u/43724913?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taiki-e", "html_url": "https://github.com/taiki-e", "followers_url": "https://api.github.com/users/taiki-e/followers", "following_url": "https://api.github.com/users/taiki-e/following{/other_user}", "gists_url": "https://api.github.com/users/taiki-e/gists{/gist_id}", "starred_url": "https://api.github.com/users/taiki-e/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taiki-e/subscriptions", "organizations_url": "https://api.github.com/users/taiki-e/orgs", "repos_url": "https://api.github.com/users/taiki-e/repos", "events_url": "https://api.github.com/users/taiki-e/events{/privacy}", "received_events_url": "https://api.github.com/users/taiki-e/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1cdac4a9c798f8e22a4db220020713175eb9159b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cdac4a9c798f8e22a4db220020713175eb9159b", "html_url": "https://github.com/rust-lang/rust/commit/1cdac4a9c798f8e22a4db220020713175eb9159b"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "903e0a81b993e8d813e85d4b54e5b69292358d18", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/187ce4c5ab627706b33b28af22b2cefdd6986048/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/187ce4c5ab627706b33b28af22b2cefdd6986048/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=187ce4c5ab627706b33b28af22b2cefdd6986048", "patch": "@@ -248,7 +248,8 @@ impl<'a, 'tcx> Visitor<'tcx> for UseSelfVisitor<'a, 'tcx> {\n             | ItemKind::Enum(..)\n             | ItemKind::Struct(..)\n             | ItemKind::Union(..)\n-            | ItemKind::Impl(..) => {\n+            | ItemKind::Impl(..)\n+            | ItemKind::Fn(..) => {\n                 // Don't check statements that shadow `Self` or where `Self` can't be used\n             },\n             _ => walk_item(self, item),"}, {"sha": "730d391848ec1be38c8e39c4dc37c47f1b1dc493", "filename": "tests/ui/use_self.fixed", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.fixed?ref=187ce4c5ab627706b33b28af22b2cefdd6986048", "patch": "@@ -249,6 +249,16 @@ mod nesting {\n                     Self { foo: Foo {} }\n                 }\n             }\n+\n+            // Can't use Self here\n+            fn baz() -> Foo {\n+                Foo {}\n+            }\n+        }\n+\n+        // Should lint here\n+        fn baz() -> Self {\n+            Self {}\n         }\n     }\n "}, {"sha": "00824731512106153b320b488c1839e7bee3fd65", "filename": "tests/ui/use_self.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.rs?ref=187ce4c5ab627706b33b28af22b2cefdd6986048", "patch": "@@ -249,6 +249,16 @@ mod nesting {\n                     Bar { foo: Foo {} }\n                 }\n             }\n+\n+            // Can't use Self here\n+            fn baz() -> Foo {\n+                Foo {}\n+            }\n+        }\n+\n+        // Should lint here\n+        fn baz() -> Foo {\n+            Foo {}\n         }\n     }\n "}, {"sha": "6e39a28012a88de7ab4cd456db81d85636f97902", "filename": "tests/ui/use_self.stderr", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/187ce4c5ab627706b33b28af22b2cefdd6986048/tests%2Fui%2Fuse_self.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.stderr?ref=187ce4c5ab627706b33b28af22b2cefdd6986048", "patch": "@@ -150,6 +150,18 @@ LL |                 Foo {}\n LL |         use_self_expand!(); // Should lint in local macros\n    |         ------------------- in this macro invocation\n \n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:260:21\n+   |\n+LL |         fn baz() -> Foo {\n+   |                     ^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:261:13\n+   |\n+LL |             Foo {}\n+   |             ^^^ help: use the applicable keyword: `Self`\n+\n error: unnecessary structure name repetition\n   --> $DIR/use_self.rs:248:29\n    |\n@@ -163,22 +175,22 @@ LL |                     Bar { foo: Foo {} }\n    |                     ^^^ help: use the applicable keyword: `Self`\n \n error: unnecessary structure name repetition\n-  --> $DIR/use_self.rs:293:13\n+  --> $DIR/use_self.rs:303:13\n    |\n LL |             nested::A::fun_1();\n    |             ^^^^^^^^^ help: use the applicable keyword: `Self`\n \n error: unnecessary structure name repetition\n-  --> $DIR/use_self.rs:294:13\n+  --> $DIR/use_self.rs:304:13\n    |\n LL |             nested::A::A;\n    |             ^^^^^^^^^ help: use the applicable keyword: `Self`\n \n error: unnecessary structure name repetition\n-  --> $DIR/use_self.rs:296:13\n+  --> $DIR/use_self.rs:306:13\n    |\n LL |             nested::A {};\n    |             ^^^^^^^^^ help: use the applicable keyword: `Self`\n \n-error: aborting due to 29 previous errors\n+error: aborting due to 31 previous errors\n "}]}