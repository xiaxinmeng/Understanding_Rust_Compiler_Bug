{"sha": "7fd0db7dd319cfb73664c8a068474dc8759ebabf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmZDBkYjdkZDMxOWNmYjczNjY0YzhhMDY4NDc0ZGM4NzU5ZWJhYmY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2019-06-11T20:29:27Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2019-07-02T16:15:20Z"}, "message": "add a `depth_first_search` helper function", "tree": {"sha": "2f9d9d37bea1229cecb25c4a04ba855ca795a8c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f9d9d37bea1229cecb25c4a04ba855ca795a8c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7fd0db7dd319cfb73664c8a068474dc8759ebabf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7fd0db7dd319cfb73664c8a068474dc8759ebabf", "html_url": "https://github.com/rust-lang/rust/commit/7fd0db7dd319cfb73664c8a068474dc8759ebabf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7fd0db7dd319cfb73664c8a068474dc8759ebabf/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c91bb9571ffbc7ddad52cc98552f5b19b0d44d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c91bb9571ffbc7ddad52cc98552f5b19b0d44d7", "html_url": "https://github.com/rust-lang/rust/commit/4c91bb9571ffbc7ddad52cc98552f5b19b0d44d7"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "5612778ce07ed1075b89c257745daacad3b4107b", "filename": "src/librustc_data_structures/graph/iterate/mod.rs", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fiterate%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fiterate%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fgraph%2Fiterate%2Fmod.rs?ref=7fd0db7dd319cfb73664c8a068474dc8759ebabf", "patch": "@@ -1,5 +1,6 @@\n use super::super::indexed_vec::IndexVec;\n-use super::{DirectedGraph, WithSuccessors, WithNumNodes};\n+use super::{DirectedGraph, WithNumNodes, WithSuccessors};\n+use crate::bit_set::BitSet;\n \n #[cfg(test)]\n mod test;\n@@ -51,3 +52,36 @@ pub fn reverse_post_order<G: DirectedGraph + WithSuccessors + WithNumNodes>(\n     vec.reverse();\n     vec\n }\n+\n+/// A \"depth-first search\" iterator for a directed graph.\n+pub struct DepthFirstSearch<'graph, G>\n+where\n+    G: ?Sized + DirectedGraph + WithNumNodes + WithSuccessors,\n+{\n+    graph: &'graph G,\n+    stack: Vec<G::Node>,\n+    visited: BitSet<G::Node>,\n+}\n+\n+impl<G> DepthFirstSearch<'graph, G>\n+where\n+    G: ?Sized + DirectedGraph + WithNumNodes + WithSuccessors,\n+{\n+    pub fn new(graph: &'graph G, start_node: G::Node) -> Self {\n+        Self { graph, stack: vec![start_node], visited: BitSet::new_empty(graph.num_nodes()) }\n+    }\n+}\n+\n+impl<G> Iterator for DepthFirstSearch<'_, G>\n+where\n+    G: ?Sized + DirectedGraph + WithNumNodes + WithSuccessors,\n+{\n+    type Item = G::Node;\n+\n+    fn next(&mut self) -> Option<G::Node> {\n+        let DepthFirstSearch { stack, visited, graph } = self;\n+        let n = stack.pop()?;\n+        stack.extend(graph.successors(n).filter(|&m| visited.insert(m)));\n+        Some(n)\n+    }\n+}"}, {"sha": "2787fa3c6b1e4eb9dd5cf4d98f82c507f0a4fe22", "filename": "src/librustc_data_structures/graph/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs?ref=7fd0db7dd319cfb73664c8a068474dc8759ebabf", "patch": "@@ -30,6 +30,13 @@ where\n         &'graph self,\n         node: Self::Node,\n     ) -> <Self as GraphSuccessors<'graph>>::Iter;\n+\n+    fn depth_first_search(&self, from: Self::Node) -> iterate::DepthFirstSearch<'_, Self>\n+    where\n+        Self: WithNumNodes,\n+    {\n+        iterate::DepthFirstSearch::new(self, from)\n+    }\n }\n \n pub trait GraphSuccessors<'graph> {"}, {"sha": "c54a72264f66c574c35dd82f6453dca199fdfeb8", "filename": "src/librustc_data_structures/graph/vec_graph/test.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fvec_graph%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7fd0db7dd319cfb73664c8a068474dc8759ebabf/src%2Flibrustc_data_structures%2Fgraph%2Fvec_graph%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fgraph%2Fvec_graph%2Ftest.rs?ref=7fd0db7dd319cfb73664c8a068474dc8759ebabf", "patch": "@@ -44,3 +44,10 @@ fn succesors() {\n     assert_eq!(graph.successors(5), &[1]);\n     assert_eq!(graph.successors(6), &[]);\n }\n+\n+#[test]\n+fn dfs() {\n+    let graph = create_graph();\n+    let dfs: Vec<_> = graph.depth_first_search(0).collect();\n+    assert_eq!(dfs, vec![0, 1, 3, 4, 2]);\n+}"}]}