{"sha": "52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyY2M1ZmNlMWU3ZGZkNDQwYTJhZTljODkyYmNlYTJhYTk4OGM1YmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-01T14:50:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-01T14:50:53Z"}, "message": "Auto merge of #5760 - phansch:deprecate-regex-macro, r=Manishearth\n\nDeprecate regex_macro lint\n\nCloses #2586\n\nchangelog: Deprecate regex_macro lint", "tree": {"sha": "32f283c37ba0b068a21a83016cf27fc8315a40f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32f283c37ba0b068a21a83016cf27fc8315a40f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "html_url": "https://github.com/rust-lang/rust/commit/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0860375664112ba3263eaf83aa17ff1d7113b172", "url": "https://api.github.com/repos/rust-lang/rust/commits/0860375664112ba3263eaf83aa17ff1d7113b172", "html_url": "https://github.com/rust-lang/rust/commit/0860375664112ba3263eaf83aa17ff1d7113b172"}, {"sha": "d347d0cf59d0a502361db873d900f4587c6e34de", "url": "https://api.github.com/repos/rust-lang/rust/commits/d347d0cf59d0a502361db873d900f4587c6e34de", "html_url": "https://github.com/rust-lang/rust/commit/d347d0cf59d0a502361db873d900f4587c6e34de"}], "stats": {"total": 95, "additions": 26, "deletions": 69}, "files": [{"sha": "818d8188a787a6608f3071810b539010fea3ffcb", "filename": "clippy_lints/src/deprecated_lints.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Fdeprecated_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Fdeprecated_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdeprecated_lints.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -153,5 +153,13 @@ declare_deprecated_lint! {\n     ///\n     /// **Deprecation reason:** Associated-constants are now preferred.\n     pub REPLACE_CONSTS,\n-    \"associated-constants `MIN`/`MAX` of integers are prefer to `{min,max}_value()` and module constants\"\n+    \"associated-constants `MIN`/`MAX` of integers are prefered to `{min,max}_value()` and module constants\"\n+}\n+\n+declare_deprecated_lint! {\n+    /// **What it does:** Nothing. This lint has been deprecated.\n+    ///\n+    /// **Deprecation reason:** The regex! macro does not exist anymore.\n+    pub REGEX_MACRO,\n+    \"the regex! macro has been removed from the regex crate in 2018\"\n }"}, {"sha": "d31a597b66ac6c0d6f48b909154af334398972e5", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -460,7 +460,11 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     );\n     store.register_removed(\n         \"clippy::replace_consts\",\n-        \"associated-constants `MIN`/`MAX` of integers are prefer to `{min,max}_value()` and module constants\",\n+        \"associated-constants `MIN`/`MAX` of integers are prefered to `{min,max}_value()` and module constants\",\n+    );\n+    store.register_removed(\n+        \"clippy::regex_macro\",\n+        \"the regex! macro has been removed from the regex crate in 2018\",\n     );\n     // end deprecated lints, do not remove this comment, it\u2019s used in `update_lints`\n \n@@ -755,7 +759,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &reference::DEREF_ADDROF,\n         &reference::REF_IN_DEREF,\n         &regex::INVALID_REGEX,\n-        &regex::REGEX_MACRO,\n         &regex::TRIVIAL_REGEX,\n         &returns::NEEDLESS_RETURN,\n         &returns::UNUSED_UNIT,\n@@ -1380,7 +1383,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&reference::DEREF_ADDROF),\n         LintId::of(&reference::REF_IN_DEREF),\n         LintId::of(&regex::INVALID_REGEX),\n-        LintId::of(&regex::REGEX_MACRO),\n         LintId::of(&regex::TRIVIAL_REGEX),\n         LintId::of(&returns::NEEDLESS_RETURN),\n         LintId::of(&returns::UNUSED_UNIT),\n@@ -1517,7 +1519,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&redundant_field_names::REDUNDANT_FIELD_NAMES),\n         LintId::of(&redundant_pattern_matching::REDUNDANT_PATTERN_MATCHING),\n         LintId::of(&redundant_static_lifetimes::REDUNDANT_STATIC_LIFETIMES),\n-        LintId::of(&regex::REGEX_MACRO),\n         LintId::of(&regex::TRIVIAL_REGEX),\n         LintId::of(&returns::NEEDLESS_RETURN),\n         LintId::of(&returns::UNUSED_UNIT),"}, {"sha": "7405edbcd1966ac736be2a0f7ed01ff5e11ea438", "filename": "clippy_lints/src/regex.rs", "status": "modified", "additions": 3, "deletions": 54, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fregex.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -1,9 +1,9 @@\n use crate::consts::{constant, Constant};\n-use crate::utils::{is_expn_of, match_def_path, match_type, paths, span_lint, span_lint_and_help};\n+use crate::utils::{match_def_path, paths, span_lint, span_lint_and_help};\n use if_chain::if_chain;\n use rustc_ast::ast::{LitKind, StrStyle};\n use rustc_data_structures::fx::FxHashSet;\n-use rustc_hir::{Block, BorrowKind, Crate, Expr, ExprKind, HirId};\n+use rustc_hir::{BorrowKind, Expr, ExprKind, HirId};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::{BytePos, Span};\n@@ -46,66 +46,15 @@ declare_clippy_lint! {\n     \"trivial regular expressions\"\n }\n \n-declare_clippy_lint! {\n-    /// **What it does:** Checks for usage of `regex!(_)` which (as of now) is\n-    /// usually slower than `Regex::new(_)` unless called in a loop (which is a bad\n-    /// idea anyway).\n-    ///\n-    /// **Why is this bad?** Performance, at least for now. The macro version is\n-    /// likely to catch up long-term, but for now the dynamic version is faster.\n-    ///\n-    /// **Known problems:** None.\n-    ///\n-    /// **Example:**\n-    /// ```ignore\n-    /// regex!(\"foo|bar\")\n-    /// ```\n-    pub REGEX_MACRO,\n-    style,\n-    \"use of `regex!(_)` instead of `Regex::new(_)`\"\n-}\n-\n #[derive(Clone, Default)]\n pub struct Regex {\n     spans: FxHashSet<Span>,\n     last: Option<HirId>,\n }\n \n-impl_lint_pass!(Regex => [INVALID_REGEX, REGEX_MACRO, TRIVIAL_REGEX]);\n+impl_lint_pass!(Regex => [INVALID_REGEX, TRIVIAL_REGEX]);\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Regex {\n-    fn check_crate(&mut self, _: &LateContext<'a, 'tcx>, _: &'tcx Crate<'_>) {\n-        self.spans.clear();\n-    }\n-\n-    fn check_block(&mut self, cx: &LateContext<'a, 'tcx>, block: &'tcx Block<'_>) {\n-        if_chain! {\n-            if self.last.is_none();\n-            if let Some(ref expr) = block.expr;\n-            if match_type(cx, cx.tables().expr_ty(expr), &paths::REGEX);\n-            if let Some(span) = is_expn_of(expr.span, \"regex\");\n-            then {\n-                if !self.spans.contains(&span) {\n-                    span_lint(\n-                        cx,\n-                        REGEX_MACRO,\n-                        span,\n-                        \"`regex!(_)` found. \\\n-                        Please use `Regex::new(_)`, which is faster for now.\"\n-                    );\n-                    self.spans.insert(span);\n-                }\n-                self.last = Some(block.hir_id);\n-            }\n-        }\n-    }\n-\n-    fn check_block_post(&mut self, _: &LateContext<'a, 'tcx>, block: &'tcx Block<'_>) {\n-        if self.last.map_or(false, |id| block.hir_id == id) {\n-            self.last = None;\n-        }\n-    }\n-\n     fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr<'_>) {\n         if_chain! {\n             if let ExprKind::Call(ref fun, ref args) = expr.kind;"}, {"sha": "4c3462802e9218535b8343bc10b1946a3c3adb87", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -98,7 +98,6 @@ pub const RANGE_TO_STD: [&str; 3] = [\"std\", \"ops\", \"RangeTo\"];\n pub const RC: [&str; 3] = [\"alloc\", \"rc\", \"Rc\"];\n pub const RC_PTR_EQ: [&str; 4] = [\"alloc\", \"rc\", \"Rc\", \"ptr_eq\"];\n pub const RECEIVER: [&str; 4] = [\"std\", \"sync\", \"mpsc\", \"Receiver\"];\n-pub const REGEX: [&str; 3] = [\"regex\", \"re_unicode\", \"Regex\"];\n pub const REGEX_BUILDER_NEW: [&str; 5] = [\"regex\", \"re_builder\", \"unicode\", \"RegexBuilder\", \"new\"];\n pub const REGEX_BYTES_BUILDER_NEW: [&str; 5] = [\"regex\", \"re_builder\", \"bytes\", \"RegexBuilder\", \"new\"];\n pub const REGEX_BYTES_NEW: [&str; 4] = [\"regex\", \"re_bytes\", \"Regex\", \"new\"];"}, {"sha": "a2998d74130474a280e139d0434f7e918a2d67c2", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -1865,13 +1865,6 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"reference\",\n     },\n-    Lint {\n-        name: \"regex_macro\",\n-        group: \"style\",\n-        desc: \"use of `regex!(_)` instead of `Regex::new(_)`\",\n-        deprecation: None,\n-        module: \"regex\",\n-    },\n     Lint {\n         name: \"rest_pat_in_fully_bound_structs\",\n         group: \"restriction\","}, {"sha": "3eefb232780f1a9931a6040307eb67edbefeca4d", "filename": "tests/ui/deprecated.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fdeprecated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fdeprecated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdeprecated.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -7,5 +7,6 @@\n #[warn(clippy::invalid_ref)]\n #[warn(clippy::into_iter_on_array)]\n #[warn(clippy::unused_label)]\n+#[warn(clippy::regex_macro)]\n \n fn main() {}"}, {"sha": "a80e2bf31feb6b37a7869bba98cef5e84b5ccdae", "filename": "tests/ui/deprecated.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fdeprecated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fdeprecated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdeprecated.stderr?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -54,11 +54,17 @@ error: lint `clippy::unused_label` has been removed: `this lint has been uplifte\n LL | #[warn(clippy::unused_label)]\n    |        ^^^^^^^^^^^^^^^^^^^^\n \n+error: lint `clippy::regex_macro` has been removed: `the regex! macro has been removed from the regex crate in 2018`\n+  --> $DIR/deprecated.rs:10:8\n+   |\n+LL | #[warn(clippy::regex_macro)]\n+   |        ^^^^^^^^^^^^^^^^^^^\n+\n error: lint `clippy::str_to_string` has been removed: `using `str::to_string` is common even today and specialization will likely happen soon`\n   --> $DIR/deprecated.rs:1:8\n    |\n LL | #[warn(clippy::str_to_string)]\n    |        ^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 10 previous errors\n+error: aborting due to 11 previous errors\n "}, {"sha": "9767e5bf76a85ca7953b01ee53068b67925b282a", "filename": "tests/ui/regex.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb/tests%2Fui%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fregex.rs?ref=52cc5fce1e7dfd440a2ae9c892bcea2aa988c5bb", "patch": "@@ -1,5 +1,5 @@\n #![allow(unused)]\n-#![warn(clippy::invalid_regex, clippy::trivial_regex, clippy::regex_macro)]\n+#![warn(clippy::invalid_regex, clippy::trivial_regex)]\n \n extern crate regex;\n "}]}