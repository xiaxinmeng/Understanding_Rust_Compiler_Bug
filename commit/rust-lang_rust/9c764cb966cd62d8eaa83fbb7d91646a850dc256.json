{"sha": "9c764cb966cd62d8eaa83fbb7d91646a850dc256", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNzY0Y2I5NjZjZDYyZDhlYWE4M2ZiYjdkOTE2NDZhODUwZGMyNTY=", "commit": {"author": {"name": "Wilco Kusee", "email": "wilcokusee@gmail.com", "date": "2019-11-29T14:14:42Z"}, "committer": {"name": "Wilco Kusee", "email": "wilcokusee@gmail.com", "date": "2019-11-29T14:14:53Z"}, "message": "Only allow renames to valid identifiers", "tree": {"sha": "46f572272a2567f90c5b8e004bb75998df155bd2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46f572272a2567f90c5b8e004bb75998df155bd2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c764cb966cd62d8eaa83fbb7d91646a850dc256", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJd4SfhAAoJENWyu1zcMzS8M4MH/jl1NC9xE+2EHBPfDrZuAr6c\n3ysMmqgNZNBTsen8V0P0/pYlbwSlyONtt5zRAqw22scbG7tAu2Rbl0dX1tz8Tefd\n+/7b4yHxlhhkAa9rFuFAKQ2VvcGPVTmw5UWR5n2i9Nbh7ZoNK7dwwDvLMyNtwWx7\nBTOXBzdQG8yTIo1lZovQXxRxU4ljxllZGJGug5YO7kXc0jTV9dhXLjXxfma+Bf7F\nZ9UBuOp184IXQnedHf3IrKKN9eaoq14LX+J95iTdEE/GzlC3V1KkiAswqlorVZoZ\niHZAWPSCtsTmrY69Fvgt+GarxrhvEHPgcB9HK2dQbxlhBYwiyInE/xkURs3c4eY=\n=EK+1\n-----END PGP SIGNATURE-----", "payload": "tree 46f572272a2567f90c5b8e004bb75998df155bd2\nparent 8b278b1ab660df0728508e45e88ac769a2e03a58\nauthor Wilco Kusee <wilcokusee@gmail.com> 1575036882 +0100\ncommitter Wilco Kusee <wilcokusee@gmail.com> 1575036893 +0100\n\nOnly allow renames to valid identifiers\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c764cb966cd62d8eaa83fbb7d91646a850dc256", "html_url": "https://github.com/rust-lang/rust/commit/9c764cb966cd62d8eaa83fbb7d91646a850dc256", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c764cb966cd62d8eaa83fbb7d91646a850dc256/comments", "author": {"login": "detrumi", "id": 5758008, "node_id": "MDQ6VXNlcjU3NTgwMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/5758008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/detrumi", "html_url": "https://github.com/detrumi", "followers_url": "https://api.github.com/users/detrumi/followers", "following_url": "https://api.github.com/users/detrumi/following{/other_user}", "gists_url": "https://api.github.com/users/detrumi/gists{/gist_id}", "starred_url": "https://api.github.com/users/detrumi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/detrumi/subscriptions", "organizations_url": "https://api.github.com/users/detrumi/orgs", "repos_url": "https://api.github.com/users/detrumi/repos", "events_url": "https://api.github.com/users/detrumi/events{/privacy}", "received_events_url": "https://api.github.com/users/detrumi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "detrumi", "id": 5758008, "node_id": "MDQ6VXNlcjU3NTgwMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/5758008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/detrumi", "html_url": "https://github.com/detrumi", "followers_url": "https://api.github.com/users/detrumi/followers", "following_url": "https://api.github.com/users/detrumi/following{/other_user}", "gists_url": "https://api.github.com/users/detrumi/gists{/gist_id}", "starred_url": "https://api.github.com/users/detrumi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/detrumi/subscriptions", "organizations_url": "https://api.github.com/users/detrumi/orgs", "repos_url": "https://api.github.com/users/detrumi/repos", "events_url": "https://api.github.com/users/detrumi/events{/privacy}", "received_events_url": "https://api.github.com/users/detrumi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b278b1ab660df0728508e45e88ac769a2e03a58", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b278b1ab660df0728508e45e88ac769a2e03a58", "html_url": "https://github.com/rust-lang/rust/commit/8b278b1ab660df0728508e45e88ac769a2e03a58"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "137f263027d14f9745fbfb24eabd4e5d12368d0d", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9c764cb966cd62d8eaa83fbb7d91646a850dc256/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c764cb966cd62d8eaa83fbb7d91646a850dc256/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=9c764cb966cd62d8eaa83fbb7d91646a850dc256", "patch": "@@ -13,7 +13,7 @@ use ra_ide::{\n     AssistId, FileId, FilePosition, FileRange, Query, Runnable, RunnableKind, SearchScope,\n };\n use ra_prof::profile;\n-use ra_syntax::{AstNode, SyntaxKind, TextRange, TextUnit};\n+use ra_syntax::{tokenize, AstNode, SyntaxKind, TextRange, TextUnit};\n use rustc_hash::FxHashMap;\n use serde::{Deserialize, Serialize};\n use serde_json::to_value;\n@@ -506,6 +506,12 @@ pub fn handle_rename(world: WorldSnapshot, params: RenameParams) -> Result<Optio\n         .into());\n     }\n \n+    // Only rename to valid identifiers\n+    let tokens = tokenize(&params.new_name);\n+    if tokens.len() != 1 || tokens[0].kind != SyntaxKind::IDENT {\n+        return Ok(None);\n+    }\n+\n     let optional_change = world.analysis().rename(position, &*params.new_name)?;\n     let change = match optional_change {\n         None => return Ok(None),"}]}