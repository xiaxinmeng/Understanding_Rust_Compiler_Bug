{"sha": "a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwNzliODdlN2M3YTkzN2JkNjg5ZTUxYWY1YzJjMmI0YmE2OTBjYTc=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-03-27T22:12:15Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-03-27T22:12:15Z"}, "message": "Use a char len heuristic rather than item count for chain_one_line_max", "tree": {"sha": "69d5074e7903d80610dd6ac7ed96f3e0019787c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69d5074e7903d80610dd6ac7ed96f3e0019787c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "html_url": "https://github.com/rust-lang/rust/commit/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "91bbe0ff8b1cbeb50dd9e43aad1b424f99a8454a", "url": "https://api.github.com/repos/rust-lang/rust/commits/91bbe0ff8b1cbeb50dd9e43aad1b424f99a8454a", "html_url": "https://github.com/rust-lang/rust/commit/91bbe0ff8b1cbeb50dd9e43aad1b424f99a8454a"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "82b80e963cf35359be17f1680b265cb0e06176af", "filename": "src/chains.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "patch": "@@ -165,9 +165,9 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n     let almost_total = rewrites[..rewrites.len() - 1].iter().fold(0, |a, b| {\n         a + first_line_width(b)\n     }) + parent_rewrite.len();\n+    let one_line_len = rewrites.iter().fold(0, |a, r| a + r.len() + 1) + parent_rewrite.len();\n \n-    let veto_single_line = if subexpr_list.len() > context.config.chain_one_line_max - 1 {\n-        // -1 above because subexpr_list does not include the parent.\n+    let veto_single_line = if one_line_len > context.config.chain_one_line_max - 1 && rewrites.len() > 1 {\n         true\n     } else if context.config.take_source_hints && subexpr_list.len() > 1 {\n         // Look at the source code. Unless all chain elements start on the same"}, {"sha": "9a554659e83fd384d877af3076641e969ba8cf63", "filename": "src/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "patch": "@@ -372,7 +372,7 @@ create_config! {\n     report_fixme: ReportTactic, ReportTactic::Never,\n         \"Report all, none or unnumbered occurrences of FIXME in source file comments\";\n     chain_indent: IndentStyle, IndentStyle::Block, \"Indentation of chain\";\n-    chain_one_line_max: usize, 4, \"Maximum number of elements in a chain to fit on a single line\";\n+    chain_one_line_max: usize, 60, \"Maximum length of a chain to fit on a single line\";\n     reorder_imports: bool, false, \"Reorder import statements alphabetically\";\n     reorder_imported_names: bool, false,\n         \"Reorder lists of names in import statements alphabetically\";"}, {"sha": "f0c096faf2b28e82a56c2d3c80289f5168d95f36", "filename": "tests/source/chains.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/tests%2Fsource%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/tests%2Fsource%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fchains.rs?ref=a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "patch": "@@ -1,5 +1,6 @@\n // rustfmt-normalize_comments: true\n // rustfmt-single_line_if_else_max_width: 0\n+// rustfmt-chain_one_line_max: 100\n // Test chain formatting.\n \n fn main() {"}, {"sha": "2b4a31bf2a3465c7064463aeca519bea22687b5d", "filename": "tests/target/chains.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/tests%2Ftarget%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a079b87e7c7a937bd689e51af5c2c2b4ba690ca7/tests%2Ftarget%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains.rs?ref=a079b87e7c7a937bd689e51af5c2c2b4ba690ca7", "patch": "@@ -1,5 +1,6 @@\n // rustfmt-normalize_comments: true\n // rustfmt-single_line_if_else_max_width: 0\n+// rustfmt-chain_one_line_max: 100\n // Test chain formatting.\n \n fn main() {"}]}