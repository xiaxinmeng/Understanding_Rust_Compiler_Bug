{"sha": "ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViYzRhY2VlOTFkYzk4NzFkMWM5MGYwZDdhMzhhZmYwNTgwZGQxOGE=", "commit": {"author": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2021-03-22T18:53:16Z"}, "committer": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2021-04-15T18:52:09Z"}, "message": "stabilize :pat2015, leave :pat2021 gated", "tree": {"sha": "4dbf786f7459fca087a6834714b0fe2c406c36d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4dbf786f7459fca087a6834714b0fe2c406c36d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "html_url": "https://github.com/rust-lang/rust/commit/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/comments", "author": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2962e7c0089d5c136f4e9600b7abccfbbde4973d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2962e7c0089d5c136f4e9600b7abccfbbde4973d", "html_url": "https://github.com/rust-lang/rust/commit/2962e7c0089d5c136f4e9600b7abccfbbde4973d"}], "stats": {"total": 42, "additions": 15, "deletions": 27}, "files": [{"sha": "c3e7448b63090d45380485effc5fb09d75b0ff18", "filename": "compiler/rustc_expand/src/mbe/quoted.rs", "status": "modified", "additions": 10, "deletions": 13, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fquoted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fquoted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fquoted.rs?ref=ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "patch": "@@ -62,19 +62,16 @@ pub(super) fn parse(\n                                 Some((frag, _)) => {\n                                     let span = token.span.with_lo(start_sp.lo());\n \n-                                    match frag.name {\n-                                        sym::pat2015 | sym::pat2021 => {\n-                                            if !features.edition_macro_pats {\n-                                                feature_err(\n-                                                    sess,\n-                                                    sym::edition_macro_pats,\n-                                                    frag.span,\n-                                                    \"`pat2015` and `pat2021` are unstable.\",\n-                                                )\n-                                                .emit();\n-                                            }\n-                                        }\n-                                        _ => {}\n+                                    if matches!(frag.name, sym::pat2021)\n+                                        && !features.edition_macro_pats\n+                                    {\n+                                        feature_err(\n+                                            sess,\n+                                            sym::edition_macro_pats,\n+                                            frag.span,\n+                                            \"`pat2021` is unstable.\",\n+                                        )\n+                                        .emit();\n                                     }\n \n                                     let kind ="}, {"sha": "774f21b2dd885344ebf38cceb6847c170cefbdc1", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "patch": "@@ -609,7 +609,7 @@ declare_features! (\n     /// Allows arbitrary expressions in key-value attributes at parse time.\n     (active, extended_key_value_attributes, \"1.50.0\", Some(78835), None),\n \n-    /// `:pat2015` and `:pat2021` macro matchers.\n+    /// `:pat2021` macro matcher.\n     (active, edition_macro_pats, \"1.51.0\", Some(54883), None),\n \n     /// Allows const generics to have default values (e.g. `struct Foo<const N: usize = 3>(...);`)."}, {"sha": "e9f813f83ae98889bed9f61de5d2e31c720f314b", "filename": "src/test/ui/feature-gates/feature-gate-edition_macro_pats.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.rs?ref=ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "patch": "@@ -1,8 +1,8 @@\n // Feature gate test for `edition_macro_pats` feature.\n \n macro_rules! foo {\n-    ($x:pat2015) => {}; //~ERROR `pat2015` and `pat2021` are unstable\n-    ($x:pat2021) => {}; //~ERROR `pat2015` and `pat2021` are unstable\n+    ($x:pat2015) => {}; // ok\n+    ($x:pat2021) => {}; //~ERROR `pat2021` is unstable\n }\n \n fn main() {}"}, {"sha": "dc1f52d87a820743e5f22718c302e724af34c503", "filename": "src/test/ui/feature-gates/feature-gate-edition_macro_pats.stderr", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ebc4acee91dc9871d1c90f0d7a38aff0580dd18a/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-edition_macro_pats.stderr?ref=ebc4acee91dc9871d1c90f0d7a38aff0580dd18a", "patch": "@@ -1,13 +1,4 @@\n-error[E0658]: `pat2015` and `pat2021` are unstable.\n-  --> $DIR/feature-gate-edition_macro_pats.rs:4:9\n-   |\n-LL |     ($x:pat2015) => {};\n-   |         ^^^^^^^\n-   |\n-   = note: see issue #54883 <https://github.com/rust-lang/rust/issues/54883> for more information\n-   = help: add `#![feature(edition_macro_pats)]` to the crate attributes to enable\n-\n-error[E0658]: `pat2015` and `pat2021` are unstable.\n+error[E0658]: `pat2021` is unstable.\n   --> $DIR/feature-gate-edition_macro_pats.rs:5:9\n    |\n LL |     ($x:pat2021) => {};\n@@ -16,6 +7,6 @@ LL |     ($x:pat2021) => {};\n    = note: see issue #54883 <https://github.com/rust-lang/rust/issues/54883> for more information\n    = help: add `#![feature(edition_macro_pats)]` to the crate attributes to enable\n \n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0658`."}]}