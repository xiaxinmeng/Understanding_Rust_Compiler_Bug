{"sha": "fe548e311a8f3a2e193989dc959841874738423f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlNTQ4ZTMxMWE4ZjNhMmUxOTM5ODlkYzk1OTg0MTg3NDczODQyM2Y=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-11-25T02:45:43Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-11-25T13:41:29Z"}, "message": "resolve: Fix some more asserts in import validation", "tree": {"sha": "386d043020c28d20d3264065687a78182a1b2be7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/386d043020c28d20d3264065687a78182a1b2be7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe548e311a8f3a2e193989dc959841874738423f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe548e311a8f3a2e193989dc959841874738423f", "html_url": "https://github.com/rust-lang/rust/commit/fe548e311a8f3a2e193989dc959841874738423f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe548e311a8f3a2e193989dc959841874738423f/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e593431bc7f3ad89aea8e792384d6719bf60f3f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/e593431bc7f3ad89aea8e792384d6719bf60f3f3", "html_url": "https://github.com/rust-lang/rust/commit/e593431bc7f3ad89aea8e792384d6719bf60f3f3"}], "stats": {"total": 89, "additions": 63, "deletions": 26}, "files": [{"sha": "52e3e54b9f93181090918414b7bb8c3052263cd6", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fe548e311a8f3a2e193989dc959841874738423f/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe548e311a8f3a2e193989dc959841874738423f/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=fe548e311a8f3a2e193989dc959841874738423f", "patch": "@@ -864,7 +864,8 @@ impl<'a, 'b:'a, 'c: 'b> ImportResolver<'a, 'b, 'c> {\n             }\n             PathResult::NonModule(path_res) if path_res.base_def() == Def::Err => {\n                 // The error was already reported earlier.\n-                assert!(directive.imported_module.get().is_none());\n+                assert!(!self.ambiguity_errors.is_empty() ||\n+                        directive.imported_module.get().is_none());\n                 return None;\n             }\n             PathResult::Indeterminate | PathResult::NonModule(..) => unreachable!(),"}, {"sha": "8e0797582970d9c0aa427c33a87c798517b6e02d", "filename": "src/test/ui/imports/auxiliary/issue-56125.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fauxiliary%2Fissue-56125.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fauxiliary%2Fissue-56125.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fauxiliary%2Fissue-56125.rs?ref=fe548e311a8f3a2e193989dc959841874738423f", "patch": "@@ -1,3 +1,5 @@\n+pub mod issue_56125 {}\n+\n pub mod last_segment {\n     pub mod issue_56125 {}\n }"}, {"sha": "843b52f18435e5ec95ec1676bdf55444ce8ec584", "filename": "src/test/ui/imports/issue-56125.rs", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs?ref=fe548e311a8f3a2e193989dc959841874738423f", "patch": "@@ -2,11 +2,24 @@\n // compile-flags:--extern issue_56125\n // aux-build:issue-56125.rs\n \n-use issue_56125::last_segment::*;\n-//~^ ERROR `issue_56125` is ambiguous\n-//~| ERROR unresolved import `issue_56125::last_segment`\n-use issue_56125::non_last_segment::non_last_segment::*;\n-//~^ ERROR `issue_56125` is ambiguous\n-//~| ERROR failed to resolve: could not find `non_last_segment` in `issue_56125`\n+#![feature(uniform_paths)]\n+\n+mod m1 {\n+    use issue_56125::last_segment::*;\n+    //~^ ERROR `issue_56125` is ambiguous\n+    //~| ERROR unresolved import `issue_56125::last_segment`\n+}\n+\n+mod m2 {\n+    use issue_56125::non_last_segment::non_last_segment::*;\n+    //~^ ERROR `issue_56125` is ambiguous\n+    //~| ERROR failed to resolve: could not find `non_last_segment` in `issue_56125`\n+}\n+\n+mod m3 {\n+    mod empty {}\n+    use empty::issue_56125; //~ ERROR unresolved import `empty::issue_56125`\n+    use issue_56125::*; //~ ERROR `issue_56125` is ambiguous\n+}\n \n fn main() {}"}, {"sha": "b1292ef8f783e35c4b2048e53ad3f80a938a5cbc", "filename": "src/test/ui/imports/issue-56125.stderr", "status": "modified", "additions": 40, "deletions": 19, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fe548e311a8f3a2e193989dc959841874738423f/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr?ref=fe548e311a8f3a2e193989dc959841874738423f", "patch": "@@ -1,46 +1,67 @@\n error[E0433]: failed to resolve: could not find `non_last_segment` in `issue_56125`\n-  --> $DIR/issue-56125.rs:8:18\n+  --> $DIR/issue-56125.rs:14:22\n    |\n-LL | use issue_56125::non_last_segment::non_last_segment::*;\n-   |                  ^^^^^^^^^^^^^^^^ could not find `non_last_segment` in `issue_56125`\n+LL |     use issue_56125::non_last_segment::non_last_segment::*;\n+   |                      ^^^^^^^^^^^^^^^^ could not find `non_last_segment` in `issue_56125`\n \n error[E0432]: unresolved import `issue_56125::last_segment`\n-  --> $DIR/issue-56125.rs:5:18\n+  --> $DIR/issue-56125.rs:8:22\n    |\n-LL | use issue_56125::last_segment::*;\n-   |                  ^^^^^^^^^^^^ could not find `last_segment` in `issue_56125`\n+LL |     use issue_56125::last_segment::*;\n+   |                      ^^^^^^^^^^^^ could not find `last_segment` in `issue_56125`\n+\n+error[E0432]: unresolved import `empty::issue_56125`\n+  --> $DIR/issue-56125.rs:21:9\n+   |\n+LL |     use empty::issue_56125; //~ ERROR unresolved import `empty::issue_56125`\n+   |         ^^^^^^^^^^^^^^^^^^ no `issue_56125` in `m3::empty`\n \n error[E0659]: `issue_56125` is ambiguous (name vs any other name during import resolution)\n-  --> $DIR/issue-56125.rs:5:5\n+  --> $DIR/issue-56125.rs:8:9\n    |\n-LL | use issue_56125::last_segment::*;\n-   |     ^^^^^^^^^^^ ambiguous name\n+LL |     use issue_56125::last_segment::*;\n+   |         ^^^^^^^^^^^ ambiguous name\n    |\n    = note: `issue_56125` could refer to an extern crate passed with `--extern`\n    = help: use `::issue_56125` to refer to this extern crate unambiguously\n note: `issue_56125` could also refer to the module imported here\n-  --> $DIR/issue-56125.rs:5:5\n+  --> $DIR/issue-56125.rs:8:9\n    |\n-LL | use issue_56125::last_segment::*;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |     use issue_56125::last_segment::*;\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `self::issue_56125` to refer to this module unambiguously\n \n error[E0659]: `issue_56125` is ambiguous (name vs any other name during import resolution)\n-  --> $DIR/issue-56125.rs:8:5\n+  --> $DIR/issue-56125.rs:14:9\n    |\n-LL | use issue_56125::non_last_segment::non_last_segment::*;\n-   |     ^^^^^^^^^^^ ambiguous name\n+LL |     use issue_56125::non_last_segment::non_last_segment::*;\n+   |         ^^^^^^^^^^^ ambiguous name\n    |\n    = note: `issue_56125` could refer to an extern crate passed with `--extern`\n    = help: use `::issue_56125` to refer to this extern crate unambiguously\n note: `issue_56125` could also refer to the module imported here\n-  --> $DIR/issue-56125.rs:5:5\n+  --> $DIR/issue-56125.rs:14:9\n    |\n-LL | use issue_56125::last_segment::*;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL |     use issue_56125::non_last_segment::non_last_segment::*;\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `self::issue_56125` to refer to this module unambiguously\n \n-error: aborting due to 4 previous errors\n+error[E0659]: `issue_56125` is ambiguous (name vs any other name during import resolution)\n+  --> $DIR/issue-56125.rs:22:9\n+   |\n+LL |     use issue_56125::*; //~ ERROR `issue_56125` is ambiguous\n+   |         ^^^^^^^^^^^ ambiguous name\n+   |\n+   = note: `issue_56125` could refer to an extern crate passed with `--extern`\n+   = help: use `::issue_56125` to refer to this extern crate unambiguously\n+note: `issue_56125` could also refer to the unresolved item imported here\n+  --> $DIR/issue-56125.rs:21:9\n+   |\n+LL |     use empty::issue_56125; //~ ERROR unresolved import `empty::issue_56125`\n+   |         ^^^^^^^^^^^^^^^^^^\n+   = help: use `self::issue_56125` to refer to this unresolved item unambiguously\n+\n+error: aborting due to 6 previous errors\n \n Some errors occurred: E0432, E0433, E0659.\n For more information about an error, try `rustc --explain E0432`."}]}