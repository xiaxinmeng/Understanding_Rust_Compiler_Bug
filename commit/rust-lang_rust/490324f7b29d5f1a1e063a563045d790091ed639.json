{"sha": "490324f7b29d5f1a1e063a563045d790091ed639", "node_id": "C_kwDOAAsO6NoAKDQ5MDMyNGY3YjI5ZDVmMWExZTA2M2E1NjMwNDVkNzkwMDkxZWQ2Mzk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-26T19:33:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-26T19:33:22Z"}, "message": "Auto merge of #97434 - matthiaskrgr:rollup-7j3y16l, r=matthiaskrgr\n\nRollup of 3 pull requests\n\nSuccessful merges:\n\n - #96033 (Add section on common message styles for Result::expect)\n - #97354 (Updates to browser-ui-test)\n - #97424 (clippy::complexity fixes)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "fcc61ff0ba11a8f03e8f24726cc1f780dad44165", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fcc61ff0ba11a8f03e8f24726cc1f780dad44165"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/490324f7b29d5f1a1e063a563045d790091ed639", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/490324f7b29d5f1a1e063a563045d790091ed639", "html_url": "https://github.com/rust-lang/rust/commit/490324f7b29d5f1a1e063a563045d790091ed639", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/490324f7b29d5f1a1e063a563045d790091ed639/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1851f0802e148bb7fa0bfd7dabcb7397bf371b0b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1851f0802e148bb7fa0bfd7dabcb7397bf371b0b", "html_url": "https://github.com/rust-lang/rust/commit/1851f0802e148bb7fa0bfd7dabcb7397bf371b0b"}, {"sha": "2cacc325bca1451f935caf51c7685236dba474f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/2cacc325bca1451f935caf51c7685236dba474f6", "html_url": "https://github.com/rust-lang/rust/commit/2cacc325bca1451f935caf51c7685236dba474f6"}], "stats": {"total": 251, "additions": 205, "deletions": 46}, "files": [{"sha": "0520c9ac60cf019ed29d4cb9894234d344771abb", "filename": "compiler/rustc_ast_passes/src/ast_validation.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -1463,18 +1463,17 @@ impl<'a> Visitor<'a> for AstValidator<'a> {\n         if let GenericBound::Trait(ref poly, modify) = *bound {\n             match (ctxt, modify) {\n                 (BoundKind::SuperTraits, TraitBoundModifier::Maybe) => {\n-                    let mut err = self.err_handler().struct_span_err(\n-                        poly.span,\n-                        &format!(\"`?Trait` is not permitted in supertraits\"),\n-                    );\n+                    let mut err = self\n+                        .err_handler()\n+                        .struct_span_err(poly.span, \"`?Trait` is not permitted in supertraits\");\n                     let path_str = pprust::path_to_string(&poly.trait_ref.path);\n                     err.note(&format!(\"traits are `?{}` by default\", path_str));\n                     err.emit();\n                 }\n                 (BoundKind::TraitObject, TraitBoundModifier::Maybe) => {\n                     let mut err = self.err_handler().struct_span_err(\n                         poly.span,\n-                        &format!(\"`?Trait` is not permitted in trait object types\"),\n+                        \"`?Trait` is not permitted in trait object types\",\n                     );\n                     err.emit();\n                 }"}, {"sha": "6478a104815b6b3b691936bbb6eb92b24792a052", "filename": "compiler/rustc_borrowck/src/diagnostics/region_errors.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_errors.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -450,10 +450,10 @@ impl<'a, 'tcx> MirBorrowckCtxt<'a, 'tcx> {\n                 _ => None,\n             };\n \n-            if defined_hir.is_some() {\n+            if let Some(def_hir) = defined_hir {\n                 let upvars_map = self.infcx.tcx.upvars_mentioned(def_id).unwrap();\n-                let upvar_def_span = self.infcx.tcx.hir().span(defined_hir.unwrap());\n-                let upvar_span = upvars_map.get(&defined_hir.unwrap()).unwrap().span;\n+                let upvar_def_span = self.infcx.tcx.hir().span(def_hir);\n+                let upvar_span = upvars_map.get(&def_hir).unwrap().span;\n                 diag.span_label(upvar_def_span, \"variable defined here\");\n                 diag.span_label(upvar_span, \"variable captured here\");\n             }"}, {"sha": "3185b952ab886b234785ec895921548263a1a228", "filename": "compiler/rustc_codegen_ssa/src/mir/place.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -462,7 +462,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n             }\n         };\n         for elem in place_ref.projection[base..].iter() {\n-            cg_base = match elem.clone() {\n+            cg_base = match *elem {\n                 mir::ProjectionElem::Deref => {\n                     // a box with a non-zst allocator should not be directly dereferenced\n                     if cg_base.layout.ty.is_box() && !cg_base.layout.field(cx, 1).is_zst() {"}, {"sha": "0c954ac6e5f6e6a185c40adfbc73cb0e4a5d8ace", "filename": "compiler/rustc_const_eval/src/interpret/eval_context.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Feval_context.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -520,13 +520,13 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         frame\n             .instance\n             .try_subst_mir_and_normalize_erasing_regions(*self.tcx, self.param_env, value)\n-            .or_else(|e| {\n+            .map_err(|e| {\n                 self.tcx.sess.delay_span_bug(\n                     self.cur_span(),\n                     format!(\"failed to normalize {}\", e.get_type_for_failure()).as_str(),\n                 );\n \n-                Err(InterpError::InvalidProgram(InvalidProgramInfo::TooGeneric))\n+                InterpError::InvalidProgram(InvalidProgramInfo::TooGeneric)\n             })\n     }\n \n@@ -1009,11 +1009,7 @@ impl<'a, 'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> std::fmt::Debug\n                     }\n                 }\n \n-                write!(\n-                    fmt,\n-                    \": {:?}\",\n-                    self.ecx.dump_allocs(allocs.into_iter().filter_map(|x| x).collect())\n-                )\n+                write!(fmt, \": {:?}\", self.ecx.dump_allocs(allocs.into_iter().flatten().collect()))\n             }\n             Place::Ptr(mplace) => match mplace.ptr.provenance.and_then(Provenance::get_alloc_id) {\n                 Some(alloc_id) => write!("}, {"sha": "f2ec80b0c1b6369676dfbb31903ad9fe9621ec48", "filename": "compiler/rustc_log/src/lib.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_log%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_log%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_log%2Fsrc%2Flib.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -69,13 +69,7 @@ pub fn init_env_logger(env: &str) -> Result<(), Error> {\n \n     let verbose_entry_exit = match env::var_os(String::from(env) + \"_ENTRY_EXIT\") {\n         None => false,\n-        Some(v) => {\n-            if &v == \"0\" {\n-                false\n-            } else {\n-                true\n-            }\n-        }\n+        Some(v) => &v != \"0\",\n     };\n \n     let layer = tracing_tree::HierarchicalLayer::default()"}, {"sha": "c1e1cfef9f89d8008d502e45f3e99a1575fc145b", "filename": "compiler/rustc_middle/src/mir/patch.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -167,8 +167,7 @@ impl<'tcx> MirPatch<'tcx> {\n             if loc.statement_index > body[loc.block].statements.len() {\n                 let term = body[loc.block].terminator();\n                 for i in term.successors() {\n-                    stmts_and_targets\n-                        .push((Statement { source_info, kind: stmt.clone() }, i.clone()));\n+                    stmts_and_targets.push((Statement { source_info, kind: stmt.clone() }, i));\n                 }\n                 delta += 1;\n                 continue;"}, {"sha": "ccbb518e72d08d49c905132c76c8de98bf5f208c", "filename": "compiler/rustc_mir_build/src/build/expr/into.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fexpr%2Finto.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -435,11 +435,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                         }\n                         thir::InlineAsmOperand::SymFn { value, span } => {\n                             mir::InlineAsmOperand::SymFn {\n-                                value: Box::new(Constant {\n-                                    span,\n-                                    user_ty: None,\n-                                    literal: value.into(),\n-                                }),\n+                                value: Box::new(Constant { span, user_ty: None, literal: value }),\n                             }\n                         }\n                         thir::InlineAsmOperand::SymStatic { def_id } => {"}, {"sha": "3774a39503521c7b9cb5d3e56435fe34f47cbc60", "filename": "compiler/rustc_mir_build/src/build/matches/test.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmatches%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmatches%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fmatches%2Ftest.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -264,7 +264,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                     );\n                 } else if let [success, fail] = *make_target_blocks(self) {\n                     assert_eq!(value.ty(), ty);\n-                    let expect = self.literal_operand(test.span, value.into());\n+                    let expect = self.literal_operand(test.span, value);\n                     let val = Operand::Copy(place);\n                     self.compare(block, success, fail, source_info, BinOp::Eq, expect, val);\n                 } else {\n@@ -277,8 +277,8 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                 let target_blocks = make_target_blocks(self);\n \n                 // Test `val` by computing `lo <= val && val <= hi`, using primitive comparisons.\n-                let lo = self.literal_operand(test.span, lo.into());\n-                let hi = self.literal_operand(test.span, hi.into());\n+                let lo = self.literal_operand(test.span, lo);\n+                let hi = self.literal_operand(test.span, hi);\n                 let val = Operand::Copy(place);\n \n                 let [success, fail] = *target_blocks else {\n@@ -370,7 +370,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n         place: Place<'tcx>,\n         mut ty: Ty<'tcx>,\n     ) {\n-        let mut expect = self.literal_operand(source_info.span, value.into());\n+        let mut expect = self.literal_operand(source_info.span, value);\n         let mut val = Operand::Copy(place);\n \n         // If we're using `b\"...\"` as a pattern, we need to insert an"}, {"sha": "82e1ae9d274c0034fcb3e8b530efb7ec3c5b4177", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/checks.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -845,7 +845,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         let first_provided_ty = if let Some((ty, _)) = final_arg_types[input_idx] {\n                             format!(\",found `{}`\", ty)\n                         } else {\n-                            \"\".into()\n+                            String::new()\n                         };\n                         labels.push((\n                             first_span,\n@@ -857,7 +857,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             if let Some((ty, _)) = final_arg_types[other_input_idx] {\n                                 format!(\",found `{}`\", ty)\n                             } else {\n-                                \"\".into()\n+                                String::new()\n                             };\n                         labels.push((\n                             second_span,\n@@ -875,7 +875,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             let provided_ty = if let Some((ty, _)) = final_arg_types[dst_arg] {\n                                 format!(\",found `{}`\", ty)\n                             } else {\n-                                \"\".into()\n+                                String::new()\n                             };\n                             labels.push((\n                                 provided_args[dst_arg].span,\n@@ -1744,8 +1744,7 @@ fn label_fn_like<'tcx>(\n             .get_if_local(def_id)\n             .and_then(|node| node.body_id())\n             .into_iter()\n-            .map(|id| tcx.hir().body(id).params)\n-            .flatten();\n+            .flat_map(|id| tcx.hir().body(id).params);\n \n         for param in params {\n             spans.push_span_label(param.span, String::new());"}, {"sha": "4e54d554c6ec23a510856618cd708efb3292e86c", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -492,7 +492,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                 Obligation {\n                                     cause: cause.clone(),\n                                     param_env: self.param_env,\n-                                    predicate: predicate.clone(),\n+                                    predicate: *predicate,\n                                     recursion_depth: 0,\n                                 },\n                             ));\n@@ -676,7 +676,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                 let span = self_ty.span.ctxt().outer_expn_data().call_site;\n                                 let mut spans: MultiSpan = span.into();\n                                 spans.push_span_label(span, derive_msg.to_string());\n-                                let entry = spanned_predicates.entry(spans.into());\n+                                let entry = spanned_predicates.entry(spans);\n                                 entry.or_insert_with(|| (path, tr_self_ty, Vec::new())).2.push(p);\n                             }\n \n@@ -704,7 +704,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                     ident.span.into()\n                                 };\n                                 spans.push_span_label(ident.span, \"in this trait\".to_string());\n-                                let entry = spanned_predicates.entry(spans.into());\n+                                let entry = spanned_predicates.entry(spans);\n                                 entry.or_insert_with(|| (path, tr_self_ty, Vec::new())).2.push(p);\n                             }\n \n@@ -748,7 +748,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                 }\n                                 spans.push_span_label(self_ty.span, String::new());\n \n-                                let entry = spanned_predicates.entry(spans.into());\n+                                let entry = spanned_predicates.entry(spans);\n                                 entry.or_insert_with(|| (path, tr_self_ty, Vec::new())).2.push(p);\n                             }\n                             _ => {}\n@@ -1460,7 +1460,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             {\n                                 derives.push((\n                                     self_name.clone(),\n-                                    self_span.clone(),\n+                                    self_span,\n                                     parent_diagnostic_name.to_string(),\n                                 ));\n                             }"}, {"sha": "637f6459525a2853df22fc02f2adf9092e65bd71", "filename": "compiler/rustc_typeck/src/check/op.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fop.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -705,7 +705,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         let predicates = errors\n                             .iter()\n                             .filter_map(|error| {\n-                                error.obligation.predicate.clone().to_opt_poly_trait_pred()\n+                                error.obligation.predicate.to_opt_poly_trait_pred()\n                             });\n                         for pred in predicates {\n                             self.infcx.suggest_restricting_param_bound("}, {"sha": "28ea45ed235dc995df37637a5c3f249e51fab9dd", "filename": "library/core/src/option.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fcore%2Fsrc%2Foption.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fcore%2Fsrc%2Foption.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Foption.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -708,6 +708,26 @@ impl<T> Option<T> {\n     /// let x: Option<&str> = None;\n     /// x.expect(\"fruits are healthy\"); // panics with `fruits are healthy`\n     /// ```\n+    ///\n+    /// # Recommended Message Style\n+    ///\n+    /// We recommend that `expect` messages are used to describe the reason you\n+    /// _expect_ the `Option` should be `Some`.\n+    ///\n+    /// ```should_panic\n+    /// # let slice: &[u8] = &[];\n+    /// let item = slice.get(0)\n+    ///     .expect(\"slice should not be empty\");\n+    /// ```\n+    ///\n+    /// **Hint**: If you're having trouble remembering how to phrase expect\n+    /// error messages remember to focus on the word \"should\" as in \"env\n+    /// variable should be set by blah\" or \"the given binary should be available\n+    /// and executable by the current user\".\n+    ///\n+    /// For more detail on expect message styles and the reasoning behind our\n+    /// recommendation please refer to the section on [\"Common Message\n+    /// Styles\"](../../std/error/index.html#common-message-styles) in the [`std::error`](../../std/error/index.html) module docs.\n     #[inline]\n     #[track_caller]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]"}, {"sha": "c4dc34fff97fab5f55c8b6d6447d4759d9501de0", "filename": "library/core/src/result.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fcore%2Fsrc%2Fresult.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fcore%2Fsrc%2Fresult.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fresult.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -1023,6 +1023,26 @@ impl<T, E> Result<T, E> {\n     /// let x: Result<u32, &str> = Err(\"emergency failure\");\n     /// x.expect(\"Testing expect\"); // panics with `Testing expect: emergency failure`\n     /// ```\n+    ///\n+    /// # Recommended Message Style\n+    ///\n+    /// We recommend that `expect` messages are used to describe the reason you\n+    /// _expect_ the `Result` should be `Ok`.\n+    ///\n+    /// ```should_panic\n+    /// let path = std::env::var(\"IMPORTANT_PATH\")\n+    ///     .expect(\"env variable `IMPORTANT_PATH` should be set by `wrapper_script.sh`\");\n+    /// ```\n+    ///\n+    /// **Hint**: If you're having trouble remembering how to phrase expect\n+    /// error messages remember to focus on the word \"should\" as in \"env\n+    /// variable should be set by blah\" or \"the given binary should be available\n+    /// and executable by the current user\".\n+    ///\n+    /// For more detail on expect message styles and the reasoning behind our recommendation please\n+    /// refer to the section on [\"Common Message\n+    /// Styles\"](../../std/error/index.html#common-message-styles) in the\n+    /// [`std::error`](../../std/error/index.html) module docs.\n     #[inline]\n     #[track_caller]\n     #[stable(feature = \"result_expect\", since = \"1.4.0\")]"}, {"sha": "c2d30616019c718899ef692f0eb2bb8218cb2fa2", "filename": "library/std/src/error.rs", "status": "modified", "additions": 137, "deletions": 1, "changes": 138, "blob_url": "https://github.com/rust-lang/rust/blob/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fstd%2Fsrc%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/490324f7b29d5f1a1e063a563045d790091ed639/library%2Fstd%2Fsrc%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Ferror.rs?ref=490324f7b29d5f1a1e063a563045d790091ed639", "patch": "@@ -1,4 +1,140 @@\n-//! Traits for working with Errors.\n+//! Interfaces for working with Errors.\n+//!\n+//! # Error Handling In Rust\n+//!\n+//! The Rust language provides two complementary systems for constructing /\n+//! representing, reporting, propagating, reacting to, and discarding errors.\n+//! These responsibilities are collectively known as \"error handling.\" The\n+//! components of the first system, the panic runtime and interfaces, are most\n+//! commonly used to represent bugs that have been detected in your program. The\n+//! components of the second system, `Result`, the error traits, and user\n+//! defined types, are used to represent anticipated runtime failure modes of\n+//! your program.\n+//!\n+//! ## The Panic Interfaces\n+//!\n+//! The following are the primary interfaces of the panic system and the\n+//! responsibilities they cover:\n+//!\n+//! * [`panic!`] and [`panic_any`] (Constructing, Propagated automatically)\n+//! * [`PanicInfo`] (Reporting)\n+//! * [`set_hook`], [`take_hook`], and [`#[panic_handler]`][panic-handler] (Reporting)\n+//! * [`catch_unwind`] and [`resume_unwind`] (Discarding, Propagating)\n+//!\n+//! The following are the primary interfaces of the error system and the\n+//! responsibilities they cover:\n+//!\n+//! * [`Result`] (Propagating, Reacting)\n+//! * The [`Error`] trait (Reporting)\n+//! * User defined types (Constructing / Representing)\n+//! * [`match`] and [`downcast`] (Reacting)\n+//! * The question mark operator ([`?`]) (Propagating)\n+//! * The partially stable [`Try`] traits (Propagating, Constructing)\n+//! * [`Termination`] (Reporting)\n+//!\n+//! ## Converting Errors into Panics\n+//!\n+//! The panic and error systems are not entirely distinct. Often times errors\n+//! that are anticipated runtime failures in an API might instead represent bugs\n+//! to a caller. For these situations the standard library provides APIs for\n+//! constructing panics with an `Error` as it's source.\n+//!\n+//! * [`Result::unwrap`]\n+//! * [`Result::expect`]\n+//!\n+//! These functions are equivalent, they either return the inner value if the\n+//! `Result` is `Ok` or panic if the `Result` is `Err` printing the inner error\n+//! as the source. The only difference between them is that with `expect` you\n+//! provide a panic error message to be printed alongside the source, whereas\n+//! `unwrap` has a default message indicating only that you unwraped an `Err`.\n+//!\n+//! Of the two, `expect` is generally preferred since its `msg` field allows you\n+//! to convey your intent and assumptions which makes tracking down the source\n+//! of a panic easier. `unwrap` on the other hand can still be a good fit in\n+//! situations where you can trivially show that a piece of code will never\n+//! panick, such as `\"127.0.0.1\".parse::<std::net::IpAddr>().unwrap()` or early\n+//! prototyping.\n+//!\n+//! # Common Message Styles\n+//!\n+//! There are two common styles for how people word `expect` messages. Using\n+//! the message to present information to users encountering a panic\n+//! (\"expect as error message\") or using the message to present information\n+//! to developers debugging the panic (\"expect as precondition\").\n+//!\n+//! In the former case the expect message is used to describe the error that\n+//! has occurred which is considered a bug. Consider the following example:\n+//!\n+//! ```should_panic\n+//! // Read environment variable, panic if it is not present\n+//! let path = std::env::var(\"IMPORTANT_PATH\").unwrap();\n+//! ```\n+//!\n+//! In the \"expect as error message\" style we would use expect to describe\n+//! that the environment variable was not set when it should have been:\n+//!\n+//! ```should_panic\n+//! let path = std::env::var(\"IMPORTANT_PATH\")\n+//!     .expect(\"env variable `IMPORTANT_PATH` is not set\");\n+//! ```\n+//!\n+//! In the \"expect as precondition\" style, we would instead describe the\n+//! reason we _expect_ the `Result` should be `Ok`. With this style we would\n+//! prefer to write:\n+//!\n+//! ```should_panic\n+//! let path = std::env::var(\"IMPORTANT_PATH\")\n+//!     .expect(\"env variable `IMPORTANT_PATH` should be set by `wrapper_script.sh`\");\n+//! ```\n+//!\n+//! The \"expect as error message\" style does not work as well with the\n+//! default output of the std panic hooks, and often ends up repeating\n+//! information that is already communicated by the source error being\n+//! unwrapped:\n+//!\n+//! ```text\n+//! thread 'main' panicked at 'env variable `IMPORTANT_PATH` is not set: NotPresent', src/main.rs:4:6\n+//! ```\n+//!\n+//! In this example we end up mentioning that an env variable is not set,\n+//! followed by our source message that says the env is not present, the\n+//! only additional information we're communicating is the name of the\n+//! environment variable being checked.\n+//!\n+//! The \"expect as precondition\" style instead focuses on source code\n+//! readability, making it easier to understand what must have gone wrong in\n+//! situations where panics are being used to represent bugs exclusively.\n+//! Also, by framing our expect in terms of what \"SHOULD\" have happened to\n+//! prevent the source error, we end up introducing new information that is\n+//! independent from our source error.\n+//!\n+//! ```text\n+//! thread 'main' panicked at 'env variable `IMPORTANT_PATH` should be set by `wrapper_script.sh`: NotPresent', src/main.rs:4:6\n+//! ```\n+//!\n+//! In this example we are communicating not only the name of the\n+//! environment variable that should have been set, but also an explanation\n+//! for why it should have been set, and we let the source error display as\n+//! a clear contradiction to our expectation.\n+//!\n+//! **Hint**: If you're having trouble remembering how to phrase\n+//! expect-as-precondition style error messages remember to focus on the word\n+//! \"should\" as in \"env variable should be set by blah\" or \"the given binary\n+//! should be available and executable by the current user\".\n+//!\n+//! [`panic_any`]: crate::panic::panic_any\n+//! [`PanicInfo`]: crate::panic::PanicInfo\n+//! [`catch_unwind`]: crate::panic::catch_unwind\n+//! [`resume_unwind`]: crate::panic::resume_unwind\n+//! [`downcast`]: crate::error::Error\n+//! [`Termination`]: crate::process::Termination\n+//! [`Try`]: crate::ops::Try\n+//! [panic hook]: crate::panic::set_hook\n+//! [`set_hook`]: crate::panic::set_hook\n+//! [`take_hook`]: crate::panic::take_hook\n+//! [panic-handler]: <https://doc.rust-lang.org/nomicon/panic-handler.html>\n+//! [`match`]: ../../std/keyword.match.html\n+//! [`?`]: ../../std/result/index.html#the-question-mark-operator-\n \n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n "}]}