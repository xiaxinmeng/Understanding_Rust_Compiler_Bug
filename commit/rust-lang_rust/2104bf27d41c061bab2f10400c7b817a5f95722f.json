{"sha": "2104bf27d41c061bab2f10400c7b817a5f95722f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxMDRiZjI3ZDQxYzA2MWJhYjJmMTA0MDBjN2I4MTdhNWY5NTcyMmY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-04-13T13:52:41Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-08-05T21:08:28Z"}, "message": "Add an option for the source code link generation", "tree": {"sha": "708b2f8aefac3d7e59d6e9f03a62598ef5383915", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/708b2f8aefac3d7e59d6e9f03a62598ef5383915"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2104bf27d41c061bab2f10400c7b817a5f95722f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2104bf27d41c061bab2f10400c7b817a5f95722f", "html_url": "https://github.com/rust-lang/rust/commit/2104bf27d41c061bab2f10400c7b817a5f95722f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2104bf27d41c061bab2f10400c7b817a5f95722f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "023231a709b88e1a73ac86076aa5e1b4b3001276", "url": "https://api.github.com/repos/rust-lang/rust/commits/023231a709b88e1a73ac86076aa5e1b4b3001276", "html_url": "https://github.com/rust-lang/rust/commit/023231a709b88e1a73ac86076aa5e1b4b3001276"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "99d2039b183afd610f9a8f5e5772d8a3a1639375", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=2104bf27d41c061bab2f10400c7b817a5f95722f", "patch": "@@ -276,6 +276,8 @@ crate struct RenderOptions {\n     crate show_type_layout: bool,\n     crate unstable_features: rustc_feature::UnstableFeatures,\n     crate emit: Vec<EmitType>,\n+    /// If `true`, HTML source pages will generate links for items to their definition.\n+    crate generate_link_to_definition: bool,\n }\n \n #[derive(Copy, Clone, Debug, PartialEq, Eq)]\n@@ -655,6 +657,7 @@ impl Options {\n         let generate_redirect_map = matches.opt_present(\"generate-redirect-map\");\n         let show_type_layout = matches.opt_present(\"show-type-layout\");\n         let nocapture = matches.opt_present(\"nocapture\");\n+        let generate_link_to_definition = matches.opt_present(\"generate-link-to-definition\");\n \n         let (lint_opts, describe_lints, lint_cap) =\n             get_cmd_lint_options(matches, error_format, &debugging_opts);\n@@ -721,6 +724,7 @@ impl Options {\n                     crate_name.as_deref(),\n                 ),\n                 emit,\n+                generate_link_to_definition,\n             },\n             crate_name,\n             output_format,"}, {"sha": "c0668fcce999f8b347826ce8b1f83b83d9b59238", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=2104bf27d41c061bab2f10400c7b817a5f95722f", "patch": "@@ -396,6 +396,7 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n             unstable_features,\n             generate_redirect_map,\n             show_type_layout,\n+            generate_link_to_definition,\n             ..\n         } = options;\n \n@@ -456,8 +457,13 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n             }\n         }\n \n-        let (mut krate, local_sources, matches) =\n-            collect_spans_and_sources(tcx, krate, &src_root, include_sources);\n+        let (mut krate, local_sources, matches) = collect_spans_and_sources(\n+            tcx,\n+            krate,\n+            &src_root,\n+            include_sources,\n+            generate_link_to_definition,\n+        );\n \n         let (sender, receiver) = channel();\n         let mut scx = SharedContext {"}, {"sha": "fa1f8954a158613390323edcb2b00a5dd3320f70", "filename": "src/librustdoc/html/render/span_map.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fspan_map.rs?ref=2104bf27d41c061bab2f10400c7b817a5f95722f", "patch": "@@ -20,11 +20,14 @@ crate fn collect_spans_and_sources(\n     krate: clean::Crate,\n     src_root: &std::path::Path,\n     include_sources: bool,\n+    generate_link_to_definition: bool,\n ) -> (clean::Crate, FxHashMap<std::path::PathBuf, String>, FxHashMap<(u32, u32), LinkFromSrc>) {\n     let mut visitor = SpanMapVisitor { tcx, matches: FxHashMap::default() };\n \n     if include_sources {\n-        intravisit::walk_crate(&mut visitor, tcx.hir().krate());\n+        if generate_link_to_definition {\n+            intravisit::walk_crate(&mut visitor, tcx.hir().krate());\n+        }\n         let (krate, sources) = sources::collect_local_sources(tcx, src_root, krate);\n         (krate, sources, visitor.matches)\n     } else {"}, {"sha": "a98725e683cb6d678052602bf490dfc5b0fec64d", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2104bf27d41c061bab2f10400c7b817a5f95722f/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=2104bf27d41c061bab2f10400c7b817a5f95722f", "patch": "@@ -607,6 +607,13 @@ fn opts() -> Vec<RustcOptGroup> {\n         unstable(\"nocapture\", |o| {\n             o.optflag(\"\", \"nocapture\", \"Don't capture stdout and stderr of tests\")\n         }),\n+        unstable(\"generate-link-to-definition\", |o| {\n+            o.optflag(\n+                \"\",\n+                \"generate-link-to-definition\",\n+                \"Make the identifiers in the HTML source code pages navigable\",\n+            )\n+        }),\n     ]\n }\n "}]}