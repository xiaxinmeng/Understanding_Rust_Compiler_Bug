{"sha": "6aa78563697245ff7835a57c7e7eb331e9ecec08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhYTc4NTYzNjk3MjQ1ZmY3ODM1YTU3YzdlN2ViMzMxZTllY2VjMDg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T21:58:45Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T22:50:53Z"}, "message": "resolve: Mark extern crate items as used in more cases", "tree": {"sha": "7cf7add93229adabd076281195fc523f22447175", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cf7add93229adabd076281195fc523f22447175"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6aa78563697245ff7835a57c7e7eb331e9ecec08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6aa78563697245ff7835a57c7e7eb331e9ecec08", "html_url": "https://github.com/rust-lang/rust/commit/6aa78563697245ff7835a57c7e7eb331e9ecec08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6aa78563697245ff7835a57c7e7eb331e9ecec08/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d6525ef539a04cb43de40080bdabc5f2f5a4a197", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6525ef539a04cb43de40080bdabc5f2f5a4a197", "html_url": "https://github.com/rust-lang/rust/commit/d6525ef539a04cb43de40080bdabc5f2f5a4a197"}], "stats": {"total": 69, "additions": 69, "deletions": 0}, "files": [{"sha": "378f1c9fd668dd1c84d7b31e7b39514d7cea8e9b", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=6aa78563697245ff7835a57c7e7eb331e9ecec08", "patch": "@@ -5089,6 +5089,9 @@ impl<'a> Resolver<'a> {\n         }\n         self.extern_prelude.get(&ident.modern()).cloned().and_then(|entry| {\n             if let Some(binding) = entry.extern_crate_item {\n+                if !speculative && entry.introduced_by_item {\n+                    self.record_use(ident, TypeNS, binding, false);\n+                }\n                 Some(binding)\n             } else {\n                 let crate_id = if !speculative {"}, {"sha": "2d91cbc00f27d492bb11387582a0bd4b829c35c4", "filename": "src/test/ui/imports/extern-crate-used.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs?ref=6aa78563697245ff7835a57c7e7eb331e9ecec08", "patch": "@@ -0,0 +1,28 @@\n+// Extern crate items are marked as used if they are used\n+// through extern prelude entries introduced by them.\n+\n+// edition:2018\n+\n+#![deny(unused_extern_crates)]\n+\n+extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n+extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+\n+// Doesn't introduce its extern prelude entry, so it's still considered unused.\n+extern crate core; //~ ERROR unused extern crate\n+\n+mod m {\n+    use iso1::any as are_you_okay1;\n+    use ::iso2::any as are_you_okay2;\n+    type AreYouOkay1 = iso3::any::Any;\n+    type AreYouOkay2 = ::iso4::any::Any;\n+\n+    use core::any as are_you_okay3;\n+    use ::core::any as are_you_okay4;\n+    type AreYouOkay3 = core::any::Any;\n+    type AreYouOkay4 = ::core::any::Any;\n+}\n+\n+fn main() {}"}, {"sha": "3f9aab9dc79cb44bf7ae4a37b585d0bcc806c6c7", "filename": "src/test/ui/imports/extern-crate-used.stderr", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6aa78563697245ff7835a57c7e7eb331e9ecec08/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr?ref=6aa78563697245ff7835a57c7e7eb331e9ecec08", "patch": "@@ -0,0 +1,38 @@\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:8:1\n+   |\n+LL | extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+   |\n+note: lint level defined here\n+  --> $DIR/extern-crate-used.rs:6:9\n+   |\n+LL | #![deny(unused_extern_crates)]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:9:1\n+   |\n+LL | extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:10:1\n+   |\n+LL | extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: `extern crate` is not idiomatic in the new edition\n+  --> $DIR/extern-crate-used.rs:11:1\n+   |\n+LL | extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+\n+error: unused extern crate\n+  --> $DIR/extern-crate-used.rs:14:1\n+   |\n+LL | extern crate core; //~ ERROR unused extern crate\n+   | ^^^^^^^^^^^^^^^^^^ help: remove it\n+\n+error: aborting due to 5 previous errors\n+"}]}