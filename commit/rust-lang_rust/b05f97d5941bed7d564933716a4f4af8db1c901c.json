{"sha": "b05f97d5941bed7d564933716a4f4af8db1c901c", "node_id": "C_kwDOAAsO6NoAKGIwNWY5N2Q1OTQxYmVkN2Q1NjQ5MzM3MTZhNGY0YWY4ZGIxYzkwMWM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-09-01T19:37:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-01T19:37:08Z"}, "message": "Rollup merge of #100852 - Samyak2:samyak/100459, r=Mark-Simulacrum\n\nUse `getuid` to check instead of `USER` env var in rustbuild\n\nThis makes it consistent with `x.py` as changed in #95671\n\nFixes #100459", "tree": {"sha": "08fe1ba6bb03eee43c295005cfda706b4c081bfa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08fe1ba6bb03eee43c295005cfda706b4c081bfa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b05f97d5941bed7d564933716a4f4af8db1c901c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjEQnkCRBK7hj4Ov3rIwAAWKkIACh8KQF8htHdpgKbOZzenD6q\nd2VCqKqF+LVXCV6P6/EafyawTxoKpz2tga793kg9J0pTKX5DH6eYV415hXrVK+8e\nFTZe1r7pFGG054XG42nJz/Fqz2q4dTAq7z5AMk3mbdTF/b2n3KF7H2KgVGRA/pbc\nthnzzo22znA/nkbRy8g8LW8FVTfrvXsiQg5gAmX/Ehrsau91hHw4CYMeAMSFWWWm\nQRsJ4xou38NczajuYTe9l8LYAECxNrTshzrqCbtQ+KKXyfA2DMoNFjNofol0rOxY\nfUK+Hb+ecu6iDv08keDkuxL0cuKVD2RArbC4em6kjO5SIEdHfkIUXOrxWVQVrMc=\n=ymaE\n-----END PGP SIGNATURE-----\n", "payload": "tree 08fe1ba6bb03eee43c295005cfda706b4c081bfa\nparent da1d7386014bd5dbe045d9f4f80921c3882719bc\nparent b9c47f624e8baaccde5b8c022a9fd61d07bda106\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1662061028 +0200\ncommitter GitHub <noreply@github.com> 1662061028 +0200\n\nRollup merge of #100852 - Samyak2:samyak/100459, r=Mark-Simulacrum\n\nUse `getuid` to check instead of `USER` env var in rustbuild\n\nThis makes it consistent with `x.py` as changed in #95671\n\nFixes #100459\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b05f97d5941bed7d564933716a4f4af8db1c901c", "html_url": "https://github.com/rust-lang/rust/commit/b05f97d5941bed7d564933716a4f4af8db1c901c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b05f97d5941bed7d564933716a4f4af8db1c901c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da1d7386014bd5dbe045d9f4f80921c3882719bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/da1d7386014bd5dbe045d9f4f80921c3882719bc", "html_url": "https://github.com/rust-lang/rust/commit/da1d7386014bd5dbe045d9f4f80921c3882719bc"}, {"sha": "b9c47f624e8baaccde5b8c022a9fd61d07bda106", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9c47f624e8baaccde5b8c022a9fd61d07bda106", "html_url": "https://github.com/rust-lang/rust/commit/b9c47f624e8baaccde5b8c022a9fd61d07bda106"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "cc08ae5f99f0e80d03c36998ad02df043dcf10d0", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b05f97d5941bed7d564933716a4f4af8db1c901c/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b05f97d5941bed7d564933716a4f4af8db1c901c/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b05f97d5941bed7d564933716a4f4af8db1c901c", "patch": "@@ -793,6 +793,8 @@ def set_dist_environment(self, url):\n \n     def check_vendored_status(self):\n         \"\"\"Check that vendoring is configured properly\"\"\"\n+        # keep this consistent with the equivalent check in rustbuild:\n+        # https://github.com/rust-lang/rust/blob/a8a33cf27166d3eabaffc58ed3799e054af3b0c6/src/bootstrap/lib.rs#L399-L405\n         if 'SUDO_USER' in os.environ and not self.use_vendored_sources:\n             if os.getuid() == 0:\n                 self.use_vendored_sources = True"}, {"sha": "a2ca6e5ce7c1ea4fb744da2cc80058143825b694", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b05f97d5941bed7d564933716a4f4af8db1c901c/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b05f97d5941bed7d564933716a4f4af8db1c901c/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=b05f97d5941bed7d564933716a4f4af8db1c901c", "patch": "@@ -395,13 +395,18 @@ impl Build {\n         let src = config.src.clone();\n         let out = config.out.clone();\n \n+        #[cfg(unix)]\n+        // keep this consistent with the equivalent check in x.py:\n+        // https://github.com/rust-lang/rust/blob/a8a33cf27166d3eabaffc58ed3799e054af3b0c6/src/bootstrap/bootstrap.py#L796-L797\n         let is_sudo = match env::var_os(\"SUDO_USER\") {\n-            Some(sudo_user) => match env::var_os(\"USER\") {\n-                Some(user) => user != sudo_user,\n-                None => false,\n-            },\n+            Some(_sudo_user) => {\n+                let uid = unsafe { libc::getuid() };\n+                uid == 0\n+            }\n             None => false,\n         };\n+        #[cfg(not(unix))]\n+        let is_sudo = false;\n \n         let ignore_git = config.ignore_git;\n         let rust_info = channel::GitInfo::new(ignore_git, &src);"}]}