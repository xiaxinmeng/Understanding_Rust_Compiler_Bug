{"sha": "07ba986db7b9f7c275bc2b6a32487e0aa8b70864", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3YmE5ODZkYjdiOWY3YzI3NWJjMmI2YTMyNDg3ZTBhYThiNzA4NjQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-01T13:19:36Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-01T13:19:36Z"}, "message": "Don't recursively call `impls_from_deps`\n\nIt creates a big map and duplicates lots of impls that are then left\nlying around", "tree": {"sha": "85bc94c7081aa8fb843eec1e7746ff8c8b0d3d21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85bc94c7081aa8fb843eec1e7746ff8c8b0d3d21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07ba986db7b9f7c275bc2b6a32487e0aa8b70864", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07ba986db7b9f7c275bc2b6a32487e0aa8b70864", "html_url": "https://github.com/rust-lang/rust/commit/07ba986db7b9f7c275bc2b6a32487e0aa8b70864", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07ba986db7b9f7c275bc2b6a32487e0aa8b70864/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63ea8f2af097316523f54f09e1c54d515a1bb9fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/63ea8f2af097316523f54f09e1c54d515a1bb9fd", "html_url": "https://github.com/rust-lang/rust/commit/63ea8f2af097316523f54f09e1c54d515a1bb9fd"}], "stats": {"total": 13, "additions": 2, "deletions": 11}, "files": [{"sha": "201604e1d3e604582f3fab6b9ae7e2e5ea77df06", "filename": "crates/ra_hir_ty/src/method_resolution.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/07ba986db7b9f7c275bc2b6a32487e0aa8b70864/crates%2Fra_hir_ty%2Fsrc%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07ba986db7b9f7c275bc2b6a32487e0aa8b70864/crates%2Fra_hir_ty%2Fsrc%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fmethod_resolution.rs?ref=07ba986db7b9f7c275bc2b6a32487e0aa8b70864", "patch": "@@ -72,13 +72,8 @@ impl CrateImplDefs {\n             impls_by_trait: FxHashMap::default(),\n         };\n \n-        // For each dependency, calculate `impls_from_deps` recursively, then add its own\n-        // `impls_in_crate`.\n-        // As we might visit crates multiple times, `merge` has to deduplicate impls to avoid\n-        // wasting memory.\n-        for dep in &crate_graph[krate].dependencies {\n-            res.merge(&db.impls_from_deps(dep.crate_id));\n-            res.merge(&db.impls_in_crate(dep.crate_id));\n+        for krate in crate_graph.transitive_deps(krate) {\n+            res.merge(&db.impls_in_crate(krate));\n         }\n \n         Arc::new(res)\n@@ -114,17 +109,13 @@ impl CrateImplDefs {\n         for (fp, impls) in &other.inherent_impls {\n             let vec = self.inherent_impls.entry(*fp).or_default();\n             vec.extend(impls);\n-            vec.sort();\n-            vec.dedup();\n         }\n \n         for (trait_, other_map) in &other.impls_by_trait {\n             let map = self.impls_by_trait.entry(*trait_).or_default();\n             for (fp, impls) in other_map {\n                 let vec = map.entry(*fp).or_default();\n                 vec.extend(impls);\n-                vec.sort();\n-                vec.dedup();\n             }\n         }\n     }"}]}