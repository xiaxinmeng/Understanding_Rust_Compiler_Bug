{"sha": "6a4def0c9df85649336a52607347f613efcca918", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhNGRlZjBjOWRmODU2NDkzMzZhNTI2MDczNDdmNjEzZWZjY2E5MTg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-07-25T22:22:59Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-07-27T14:26:55Z"}, "message": "tidy: Fix a regression in `#[test]` detection in libcore\n\n`contents` is the whole file rather than a single line.", "tree": {"sha": "ec76aa4cd089151721cfe0163d5496b61733a4c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec76aa4cd089151721cfe0163d5496b61733a4c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a4def0c9df85649336a52607347f613efcca918", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a4def0c9df85649336a52607347f613efcca918", "html_url": "https://github.com/rust-lang/rust/commit/6a4def0c9df85649336a52607347f613efcca918", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a4def0c9df85649336a52607347f613efcca918/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0df742de8af58f06b6d6d4af3244ae470976f53", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0df742de8af58f06b6d6d4af3244ae470976f53", "html_url": "https://github.com/rust-lang/rust/commit/c0df742de8af58f06b6d6d4af3244ae470976f53"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "6c61144f2793127d9df0e932bfd5131530c9df29", "filename": "src/tools/tidy/src/unit_tests.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6a4def0c9df85649336a52607347f613efcca918/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a4def0c9df85649336a52607347f613efcca918/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs?ref=6a4def0c9df85649336a52607347f613efcca918", "patch": "@@ -13,14 +13,16 @@ pub fn check(path: &Path, bad: &mut bool) {\n         &mut |entry, contents| {\n             let subpath = entry.path();\n             if let Some(\"rs\") = subpath.extension().and_then(|e| e.to_str()) {\n-                let contents = contents.trim();\n-                if !contents.starts_with(\"//\") && contents.contains(\"#[test]\") {\n-                    tidy_error!(\n-                        bad,\n-                        \"`{}` contains `#[test]`; libcore tests must be placed inside \\\n-                        `src/libcore/tests/`\",\n-                        subpath.display()\n-                    );\n+                for line in contents.lines() {\n+                    let line = line.trim();\n+                    if !line.starts_with(\"//\") && line.contains(\"#[test]\") {\n+                        tidy_error!(\n+                            bad,\n+                            \"`{}` contains `#[test]`; libcore tests must be placed inside \\\n+                            `src/libcore/tests/`\",\n+                            subpath.display()\n+                        );\n+                    }\n                 }\n             }\n         },"}]}