{"sha": "ad4bc3323b9299d867697e9653dcea1b5e1ad283", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkNGJjMzMyM2I5Mjk5ZDg2NzY5N2U5NjUzZGNlYTFiNWUxYWQyODM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-01T19:03:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-01T19:03:23Z"}, "message": "Auto merge of #72779 - RalfJung:miri, r=oli-obk\n\nbump Miri, update for cargo-miri being a separate project\n\nr? @oli-obk\n\nFixes https://github.com/rust-lang/rust/issues/72801", "tree": {"sha": "f768128570517b6bc243869a84b66ca257dca473", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f768128570517b6bc243869a84b66ca257dca473"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad4bc3323b9299d867697e9653dcea1b5e1ad283", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad4bc3323b9299d867697e9653dcea1b5e1ad283", "html_url": "https://github.com/rust-lang/rust/commit/ad4bc3323b9299d867697e9653dcea1b5e1ad283", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad4bc3323b9299d867697e9653dcea1b5e1ad283/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3cba254e464303a6495942f3a831c2bbd7f1768", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3cba254e464303a6495942f3a831c2bbd7f1768", "html_url": "https://github.com/rust-lang/rust/commit/d3cba254e464303a6495942f3a831c2bbd7f1768"}, {"sha": "759e495bbf33dd510deb7aa645622f8f4388b406", "url": "https://api.github.com/repos/rust-lang/rust/commits/759e495bbf33dd510deb7aa645622f8f4388b406", "html_url": "https://github.com/rust-lang/rust/commit/759e495bbf33dd510deb7aa645622f8f4388b406"}], "stats": {"total": 49, "additions": 34, "deletions": 15}, "files": [{"sha": "6cfedd4a56da812685db8ef9ebf72188c9c62b5f", "filename": "Cargo.lock", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ad4bc3323b9299d867697e9653dcea1b5e1ad283/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ad4bc3323b9299d867697e9653dcea1b5e1ad283/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -345,6 +345,19 @@ dependencies = [\n  \"winapi 0.3.8\",\n ]\n \n+[[package]]\n+name = \"cargo-miri\"\n+version = \"0.1.0\"\n+dependencies = [\n+ \"cargo_metadata 0.9.1\",\n+ \"directories\",\n+ \"rustc-workspace-hack\",\n+ \"rustc_version\",\n+ \"serde\",\n+ \"serde_json\",\n+ \"vergen\",\n+]\n+\n [[package]]\n name = \"cargo-platform\"\n version = \"0.1.1\"\n@@ -2220,22 +2233,17 @@ name = \"miri\"\n version = \"0.1.0\"\n dependencies = [\n  \"byteorder\",\n- \"cargo_metadata 0.9.1\",\n  \"colored\",\n  \"compiletest_rs\",\n- \"directories\",\n  \"env_logger 0.7.1\",\n  \"getrandom\",\n  \"hex 0.4.0\",\n+ \"libc\",\n  \"log\",\n- \"num-traits\",\n  \"rand 0.7.3\",\n  \"rustc-workspace-hack\",\n  \"rustc_version\",\n- \"serde\",\n- \"serde_json\",\n  \"shell-escape\",\n- \"vergen\",\n ]\n \n [[package]]\n@@ -5555,13 +5563,12 @@ checksum = \"05c78687fb1a80548ae3250346c3db86a80a7cdd77bda190189f2d0a0987c81a\"\n \n [[package]]\n name = \"vergen\"\n-version = \"3.0.4\"\n+version = \"3.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"6aba5e34f93dc7051dfad05b98a18e9156f27e7b431fe1d2398cb6061c0a1dba\"\n+checksum = \"4ce50d8996df1f85af15f2cd8d33daae6e479575123ef4314a51a70a230739cb\"\n dependencies = [\n  \"bitflags\",\n  \"chrono\",\n- \"failure\",\n ]\n \n [[package]]"}, {"sha": "f2177a99a9b88b09672694ee4a2ac60ab2293d65", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad4bc3323b9299d867697e9653dcea1b5e1ad283/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ad4bc3323b9299d867697e9653dcea1b5e1ad283/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -22,6 +22,7 @@ members = [\n   \"src/tools/rls\",\n   \"src/tools/rustfmt\",\n   \"src/tools/miri\",\n+  \"src/tools/miri/cargo-miri\",\n   \"src/tools/rustdoc-themes\",\n   \"src/tools/unicode-table-generator\",\n   \"src/tools/expand-yaml-anchors\","}, {"sha": "ffdd8485181f4665d4f25c54ab66bfda8c161077", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -344,10 +344,12 @@ impl<'a> Builder<'a> {\n                 tool::Rls,\n                 tool::Rustdoc,\n                 tool::Clippy,\n+                tool::CargoClippy,\n                 native::Llvm,\n                 native::Sanitizers,\n                 tool::Rustfmt,\n                 tool::Miri,\n+                tool::CargoMiri,\n                 native::Lld\n             ),\n             Kind::Check | Kind::Clippy | Kind::Fix | Kind::Format => {"}, {"sha": "9f305ea4729c52d78f87e87bd87fddc557029b72", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -360,7 +360,12 @@ impl Step for Miri {\n \n         let miri =\n             builder.ensure(tool::Miri { compiler, target: self.host, extra_features: Vec::new() });\n-        if let Some(miri) = miri {\n+        let cargo_miri = builder.ensure(tool::CargoMiri {\n+            compiler,\n+            target: self.host,\n+            extra_features: Vec::new(),\n+        });\n+        if let (Some(miri), Some(_cargo_miri)) = (miri, cargo_miri) {\n             let mut cargo = builder.cargo(compiler, Mode::ToolRustc, host, \"install\");\n             cargo.arg(\"xargo\");\n             // Configure `cargo install` path. cargo adds a `bin/`.\n@@ -378,14 +383,16 @@ impl Step for Miri {\n                 Mode::ToolRustc,\n                 host,\n                 \"run\",\n-                \"src/tools/miri\",\n+                \"src/tools/miri/cargo-miri\",\n                 SourceType::Submodule,\n                 &[],\n             );\n-            cargo.arg(\"--bin\").arg(\"cargo-miri\").arg(\"--\").arg(\"miri\").arg(\"setup\");\n+            cargo.arg(\"--\").arg(\"miri\").arg(\"setup\");\n \n             // Tell `cargo miri setup` where to find the sources.\n             cargo.env(\"XARGO_RUST_SRC\", builder.src.join(\"src\"));\n+            // Tell it where to find Miri.\n+            cargo.env(\"MIRI\", &miri);\n             // Debug things.\n             cargo.env(\"RUST_BACKTRACE\", \"1\");\n             // Overwrite bootstrap's `rustc` wrapper overwriting our flags.\n@@ -437,7 +444,7 @@ impl Step for Miri {\n             // miri tests need to know about the stage sysroot\n             cargo.env(\"MIRI_SYSROOT\", miri_sysroot);\n             cargo.env(\"RUSTC_LIB_PATH\", builder.rustc_libdir(compiler));\n-            cargo.env(\"MIRI_PATH\", miri);\n+            cargo.env(\"MIRI\", miri);\n \n             cargo.arg(\"--\").args(builder.config.cmd.test_args());\n "}, {"sha": "6cd9f9029c948ac6996af4f193dc4e18107228aa", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad4bc3323b9299d867697e9653dcea1b5e1ad283/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -649,12 +649,14 @@ macro_rules! tool_extended {\n     }\n }\n \n+// Note: tools need to be also added to `Builder::get_step_descriptions` in `build.rs`\n+// to make `./x.py build <tool>` work.\n tool_extended!((self, builder),\n     Cargofmt, rustfmt, \"src/tools/rustfmt\", \"cargo-fmt\", {};\n     CargoClippy, clippy, \"src/tools/clippy\", \"cargo-clippy\", {};\n     Clippy, clippy, \"src/tools/clippy\", \"clippy-driver\", {};\n     Miri, miri, \"src/tools/miri\", \"miri\", {};\n-    CargoMiri, miri, \"src/tools/miri\", \"cargo-miri\", {};\n+    CargoMiri, miri, \"src/tools/miri/cargo-miri\", \"cargo-miri\", {};\n     Rls, rls, \"src/tools/rls\", \"rls\", {\n         builder.ensure(Clippy {\n             compiler: self.compiler,"}, {"sha": "faff9a7ad9f2d07c1702bd8be392134d27e3eaf8", "filename": "src/tools/miri", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri?ref=ad4bc3323b9299d867697e9653dcea1b5e1ad283", "patch": "@@ -1 +1 @@\n-Subproject commit a6c28f08458e15cead0e80f3b5b7009786bce4a4\n+Subproject commit faff9a7ad9f2d07c1702bd8be392134d27e3eaf8"}]}