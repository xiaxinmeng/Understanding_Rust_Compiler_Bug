{"sha": "092d6be3683192bdbcd780d950817c622f44b62e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5MmQ2YmUzNjgzMTkyYmRiY2Q3ODBkOTUwODE3YzYyMmY0NGI2MmU=", "commit": {"author": {"name": "Ga\u00ebtan Cassiers", "email": "gaetan.cassiers@gmail.com", "date": "2015-05-25T20:14:05Z"}, "committer": {"name": "Ga\u00ebtan Cassiers", "email": "gaetan.cassiers@gmail.com", "date": "2015-05-28T19:30:28Z"}, "message": "Implement reformat of tuple litterals", "tree": {"sha": "de467b66eaf4d18ac6961e368d5d27ecd835644c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de467b66eaf4d18ac6961e368d5d27ecd835644c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/092d6be3683192bdbcd780d950817c622f44b62e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/092d6be3683192bdbcd780d950817c622f44b62e", "html_url": "https://github.com/rust-lang/rust/commit/092d6be3683192bdbcd780d950817c622f44b62e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/092d6be3683192bdbcd780d950817c622f44b62e/comments", "author": {"login": "cassiersg", "id": 9348542, "node_id": "MDQ6VXNlcjkzNDg1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/9348542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cassiersg", "html_url": "https://github.com/cassiersg", "followers_url": "https://api.github.com/users/cassiersg/followers", "following_url": "https://api.github.com/users/cassiersg/following{/other_user}", "gists_url": "https://api.github.com/users/cassiersg/gists{/gist_id}", "starred_url": "https://api.github.com/users/cassiersg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cassiersg/subscriptions", "organizations_url": "https://api.github.com/users/cassiersg/orgs", "repos_url": "https://api.github.com/users/cassiersg/repos", "events_url": "https://api.github.com/users/cassiersg/events{/privacy}", "received_events_url": "https://api.github.com/users/cassiersg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cassiersg", "id": 9348542, "node_id": "MDQ6VXNlcjkzNDg1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/9348542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cassiersg", "html_url": "https://github.com/cassiersg", "followers_url": "https://api.github.com/users/cassiersg/followers", "following_url": "https://api.github.com/users/cassiersg/following{/other_user}", "gists_url": "https://api.github.com/users/cassiersg/gists{/gist_id}", "starred_url": "https://api.github.com/users/cassiersg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cassiersg/subscriptions", "organizations_url": "https://api.github.com/users/cassiersg/orgs", "repos_url": "https://api.github.com/users/cassiersg/repos", "events_url": "https://api.github.com/users/cassiersg/events{/privacy}", "received_events_url": "https://api.github.com/users/cassiersg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ecd95574952bc0900c99b30395ec7950a0f8f864", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecd95574952bc0900c99b30395ec7950a0f8f864", "html_url": "https://github.com/rust-lang/rust/commit/ecd95574952bc0900c99b30395ec7950a0f8f864"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "e731abde4e7a633a71b8cae665dcf807197e93e2", "filename": "src/expr.rs", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/092d6be3683192bdbcd780d950817c622f44b62e/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/092d6be3683192bdbcd780d950817c622f44b62e/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=092d6be3683192bdbcd780d950817c622f44b62e", "patch": "@@ -194,6 +194,40 @@ impl<'a> FmtVisitor<'a> {\n         format!(\"{}: {}\", name, expr)\n     }\n \n+    fn rewrite_tuple_lit(&mut self, items: &[ptr::P<ast::Expr>], width: usize, offset: usize)\n+        -> String {\n+        // opening paren\n+        let indent = offset + 1;\n+        // Only last line has width-1 as budget, other may take max_width\n+        let item_strs: Vec<_> =\n+            items.iter()\n+                 .enumerate()\n+                 .map(|(i, item)| self.rewrite_expr(\n+                    item,\n+                    // for last line, -2 is for indent + \")\", for other lines, -1 is for comma\n+                    if i == items.len() - 1 { width - 2 } else { config!(max_width) - indent - 1 },\n+                    indent))\n+                 .collect();\n+        let tactics = if item_strs.iter().any(|s| s.contains('\\n')) {\n+            ListTactic::Vertical\n+        } else {\n+            ListTactic::HorizontalVertical\n+        };\n+        // FIXME handle comments\n+        let item_strs: Vec<_> = item_strs.into_iter().map(|s| (s, String::new())).collect();\n+        let fmt = ListFormatting {\n+            tactic: tactics,\n+            separator: \",\",\n+            trailing_separator: SeparatorTactic::Never,\n+            indent: indent,\n+            h_width: width - 2,\n+            v_width: width - 2,\n+        };\n+        let item_str = write_list(&item_strs, &fmt);\n+        format!(\"({})\", item_str)\n+    }\n+\n+\n     pub fn rewrite_expr(&mut self, expr: &ast::Expr, width: usize, offset: usize) -> String {\n         match expr.node {\n             ast::Expr_::ExprLit(ref l) => {\n@@ -219,6 +253,9 @@ impl<'a> FmtVisitor<'a> {\n                                                width,\n                                                offset);\n             }\n+            ast::Expr_::ExprTup(ref items) => {\n+                return self.rewrite_tuple_lit(items, width, offset);\n+            }\n             _ => {}\n         }\n "}, {"sha": "a0ca2c1e145e03616b3fa9e3ab49817bbdf569cb", "filename": "tests/idem/tuple.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/092d6be3683192bdbcd780d950817c622f44b62e/tests%2Fidem%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/092d6be3683192bdbcd780d950817c622f44b62e/tests%2Fidem%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fidem%2Ftuple.rs?ref=092d6be3683192bdbcd780d950817c622f44b62e", "patch": "@@ -0,0 +1,9 @@\n+// Test tuple litterals\n+\n+fn foo() {\n+    let a = (a, a, a, a, a);\n+    let aaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, aaaaaaaaaaaaaa, aaaaaaaaaa);\n+    let aaaaaaaaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaa);\n+}"}]}