{"sha": "445e7350f2a0a776b541ddca7b028a804639b40f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0NWU3MzUwZjJhMGE3NzZiNTQxZGRjYTdiMDI4YTgwNDYzOWI0MGY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-09-25T15:08:40Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-10-01T12:38:36Z"}, "message": "Prevent rustdoc feature to be passed down to doctests", "tree": {"sha": "d8ae97d11b9b6a4a592c0b4e7e901d8ad3be16c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8ae97d11b9b6a4a592c0b4e7e901d8ad3be16c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/445e7350f2a0a776b541ddca7b028a804639b40f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/445e7350f2a0a776b541ddca7b028a804639b40f", "html_url": "https://github.com/rust-lang/rust/commit/445e7350f2a0a776b541ddca7b028a804639b40f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/445e7350f2a0a776b541ddca7b028a804639b40f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42ec6831b019114a4b6f6b58bfb5bc2927d70388", "url": "https://api.github.com/repos/rust-lang/rust/commits/42ec6831b019114a4b6f6b58bfb5bc2927d70388", "html_url": "https://github.com/rust-lang/rust/commit/42ec6831b019114a4b6f6b58bfb5bc2927d70388"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "fe4e2bd091519b9e912d3a2fe5fb8854af8fd473", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=445e7350f2a0a776b541ddca7b028a804639b40f", "patch": "@@ -344,7 +344,6 @@ impl Options {\n                             .map(|s| PathBuf::from(&s))\n                             .unwrap_or_else(|| PathBuf::from(\"doc\"));\n         let mut cfgs = matches.opt_strs(\"cfg\");\n-        cfgs.push(\"rustdoc\".to_string());\n         if should_test {\n             cfgs.push(\"doctest\".to_string());\n         }"}, {"sha": "00265caa965ea69b683aefa87ecee9fc4e1a9305", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=445e7350f2a0a776b541ddca7b028a804639b40f", "patch": "@@ -234,7 +234,7 @@ pub fn run_core(options: RustdocOptions) -> (clean::Crate, RenderInfo, RenderOpt\n         error_format,\n         libs,\n         externs,\n-        cfgs,\n+        mut cfgs,\n         codegen_options,\n         debugging_options,\n         target,\n@@ -250,6 +250,9 @@ pub fn run_core(options: RustdocOptions) -> (clean::Crate, RenderInfo, RenderOpt\n         ..\n     } = options;\n \n+    // Add the rustdoc cfg into the doc build.\n+    cfgs.push(\"rustdoc\".to_string());\n+\n     let cpath = Some(input.clone());\n     let input = Input::File(input);\n "}, {"sha": "3e77ca47e8a6a887feb2a67a87715acbf00f399e", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/445e7350f2a0a776b541ddca7b028a804639b40f/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=445e7350f2a0a776b541ddca7b028a804639b40f", "patch": "@@ -62,9 +62,11 @@ pub fn run(options: Options) -> i32 {\n         ..config::Options::default()\n     };\n \n+    let mut cfgs = options.cfgs.clone();\n+    cfgs.push(\"rustdoc\".to_owned());\n     let config = interface::Config {\n         opts: sessopts,\n-        crate_cfg: config::parse_cfgspecs(options.cfgs.clone()),\n+        crate_cfg: config::parse_cfgspecs(cfgs),\n         input,\n         input_path: None,\n         output_file: None,"}]}