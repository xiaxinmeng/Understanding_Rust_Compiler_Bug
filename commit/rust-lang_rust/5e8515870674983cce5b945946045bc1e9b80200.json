{"sha": "5e8515870674983cce5b945946045bc1e9b80200", "node_id": "C_kwDOAAsO6NoAKDVlODUxNTg3MDY3NDk4M2NjZTViOTQ1OTQ2MDQ1YmMxZTliODAyMDA", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-03-13T09:25:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-13T09:25:55Z"}, "message": "Merge #11696\n\n11696: editors/code: fix nixos detection r=lnicola a=cab404\n\nProblem: NixOS started using quotes around it's id field in /etc/os-release\r\nSolution: Parially parsing os-release, and detecting, whether `nixos` appears anywhere in \"ID=\" field\\\r\nSee https://github.com/rust-analyzer/rust-analyzer/issues/11695\r\n\r\nCloses #11695\n\nCo-authored-by: Vladimir Serov <me@cab404.ru>", "tree": {"sha": "4290e85d509a3f2499c477369121c85ec80a8032", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4290e85d509a3f2499c477369121c85ec80a8032"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e8515870674983cce5b945946045bc1e9b80200", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiLbijCRBK7hj4Ov3rIwAAgZsIAKMomqPNwXg+2qSInO0BikZb\nwwHE1VIOLZ3i5ynxCZRDwY/fSDBWocid4YGVbJ1Wa41yfWUwYb4SZsddCjJTTT1K\nAH+xz79/ZwusrP9inzUERnWf+vkJE3MBh8RZQ/vQO4P9Q+Y8DI6cJbvn5Y3WWK+5\nzGGZyGgTJnypqsgHbLzdEE8Y3Pqw/BVKwGy/IhuVEfNsezKSBZV9KcX5B/Oe0Msg\nqIY/sNn/ck9R0DaadUOI+lEW3fPl7YYK/EKD9d82GLSq6zNkoaLpIqrHQkprCFtC\n3p2pMvRPvhXW6hU3u9nmCe+kwDd19hun+427+e+Fz0kE0n2w/nv3Ou5jEjMmm6w=\n=mFml\n-----END PGP SIGNATURE-----\n", "payload": "tree 4290e85d509a3f2499c477369121c85ec80a8032\nparent 5fcf979f8a09e6504bbe540cbff6d640b959935c\nparent ce4b61003d8eb5383c4e759d919cdc72a137bc11\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1647163555 +0000\ncommitter GitHub <noreply@github.com> 1647163555 +0000\n\nMerge #11696\n\n11696: editors/code: fix nixos detection r=lnicola a=cab404\n\nProblem: NixOS started using quotes around it's id field in /etc/os-release\r\nSolution: Parially parsing os-release, and detecting, whether `nixos` appears anywhere in \"ID=\" field\\\r\nSee https://github.com/rust-analyzer/rust-analyzer/issues/11695\r\n\r\nCloses #11695\n\nCo-authored-by: Vladimir Serov <me@cab404.ru>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e8515870674983cce5b945946045bc1e9b80200", "html_url": "https://github.com/rust-lang/rust/commit/5e8515870674983cce5b945946045bc1e9b80200", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e8515870674983cce5b945946045bc1e9b80200/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fcf979f8a09e6504bbe540cbff6d640b959935c", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fcf979f8a09e6504bbe540cbff6d640b959935c", "html_url": "https://github.com/rust-lang/rust/commit/5fcf979f8a09e6504bbe540cbff6d640b959935c"}, {"sha": "ce4b61003d8eb5383c4e759d919cdc72a137bc11", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce4b61003d8eb5383c4e759d919cdc72a137bc11", "html_url": "https://github.com/rust-lang/rust/commit/ce4b61003d8eb5383c4e759d919cdc72a137bc11"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "4856079f68a51846bdeaa45e581e2fb868a3aeff", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5e8515870674983cce5b945946045bc1e9b80200/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/5e8515870674983cce5b945946045bc1e9b80200/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=5e8515870674983cce5b945946045bc1e9b80200", "patch": "@@ -269,7 +269,8 @@ function serverPath(config: Config): string | null {\n async function isNixOs(): Promise<boolean> {\n     try {\n         const contents = (await vscode.workspace.fs.readFile(vscode.Uri.file(\"/etc/os-release\"))).toString();\n-        return contents.indexOf(\"ID=nixos\") !== -1;\n+        const idString = contents.split('\\n').find((a) => a.startsWith(\"ID=\"));\n+        return idString?.toLowerCase()?.indexOf(\"nixos\") !== -1;\n     } catch {\n         return false;\n     }"}]}