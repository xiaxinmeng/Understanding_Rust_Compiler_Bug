{"sha": "ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlOTBkYjFmZjEwMzIyNGJjMmE2M2U3YTlhYzUwMzI1OWZiZTdlYjA=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-11T16:43:05Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-23T20:05:30Z"}, "message": "Deduplicate const eval error spans for better output", "tree": {"sha": "f9f436325d888c65d2062d687d1c9f2b350c5b38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f9f436325d888c65d2062d687d1c9f2b350c5b38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "html_url": "https://github.com/rust-lang/rust/commit/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44730271f79e74def2dc09315268df64f3ea6271", "url": "https://api.github.com/repos/rust-lang/rust/commits/44730271f79e74def2dc09315268df64f3ea6271", "html_url": "https://github.com/rust-lang/rust/commit/44730271f79e74def2dc09315268df64f3ea6271"}], "stats": {"total": 44, "additions": 15, "deletions": 29}, "files": [{"sha": "fc04c7672db68757380b368122ad5aac323db927", "filename": "src/librustc/mir/interpret/error.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Flibrustc%2Fmir%2Finterpret%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Flibrustc%2Fmir%2Finterpret%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Finterpret%2Ferror.rs?ref=ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "patch": "@@ -116,7 +116,9 @@ impl<'a, 'gcx, 'tcx> ConstEvalErr<'tcx> {\n                     // point to the `const` statement as a secondary span\n                     // they don't have any label\n                     for sp in primary_spans {\n-                        lint.span_label(sp, \"\");\n+                        if sp != span {\n+                            lint.span_label(sp, \"\");\n+                        }\n                     }\n                 }\n                 lint.emit();"}, {"sha": "c9d5ede61ade47c89e8fe420755173b9c80c3ea4", "filename": "src/test/ui/consts/const-eval/promoted_errors.stderr", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpromoted_errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpromoted_errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpromoted_errors.stderr?ref=ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "patch": "@@ -50,15 +50,11 @@ warning: reaching this expression at runtime will panic or abort\n   --> $DIR/promoted_errors.rs:14:20\n    |\n LL |     println!(\"{}\", 1/(false as u32));\n-   |                    ^^^^^^^^^^^^^^^^\n-   |                    |\n-   |                    attempt to divide by zero\n+   |                    ^^^^^^^^^^^^^^^^ attempt to divide by zero\n \n warning: reaching this expression at runtime will panic or abort\n   --> $DIR/promoted_errors.rs:9:20\n    |\n LL |     println!(\"{}\", 1/(1-1));\n-   |                    ^^^^^^^\n-   |                    |\n-   |                    attempt to divide by zero\n+   |                    ^^^^^^^ attempt to divide by zero\n "}, {"sha": "87f84480bf66b93313f4088ddd7ef677c3446885", "filename": "src/test/ui/consts/dangling-alloc-id-ice.stderr", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fdangling-alloc-id-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fdangling-alloc-id-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fdangling-alloc-id-ice.stderr?ref=ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "patch": "@@ -1,17 +1,11 @@\n error: any use of this value will cause an error\n   --> $DIR/dangling-alloc-id-ice.rs:8:1\n    |\n-LL |    const FOO: &() = {\n-   |   _^\n-   |  |_|\n-   | ||\n-LL | ||     let y = ();\n-LL | ||     unsafe { Foo { y: &y }.long_live_the_unit }\n-LL | || };\n-   | ||  ^\n-   | ||__|\n-   | |___type validation failed: encountered dangling pointer in final constant\n-   | \n+LL | / const FOO: &() = {\n+LL | |     let y = ();\n+LL | |     unsafe { Foo { y: &y }.long_live_the_unit }\n+LL | | };\n+   | |__^ type validation failed: encountered dangling pointer in final constant\n    |\n    = note: #[deny(const_err)] on by default\n "}, {"sha": "0168c08f011d4c49426ce4b38dccf3be86f582dd", "filename": "src/test/ui/consts/dangling_raw_ptr.stderr", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fdangling_raw_ptr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ce90db1ff103224bc2a63e7a9ac503259fbe7eb0/src%2Ftest%2Fui%2Fconsts%2Fdangling_raw_ptr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fdangling_raw_ptr.stderr?ref=ce90db1ff103224bc2a63e7a9ac503259fbe7eb0", "patch": "@@ -1,17 +1,11 @@\n error: any use of this value will cause an error\n   --> $DIR/dangling_raw_ptr.rs:1:1\n    |\n-LL |    const FOO: *const u32 = {\n-   |   _^\n-   |  |_|\n-   | ||\n-LL | ||     let x = 42;\n-LL | ||     &x\n-LL | || };\n-   | ||  ^\n-   | ||__|\n-   | |___type validation failed: encountered dangling pointer in final constant\n-   | \n+LL | / const FOO: *const u32 = {\n+LL | |     let x = 42;\n+LL | |     &x\n+LL | | };\n+   | |__^ type validation failed: encountered dangling pointer in final constant\n    |\n    = note: #[deny(const_err)] on by default\n "}]}