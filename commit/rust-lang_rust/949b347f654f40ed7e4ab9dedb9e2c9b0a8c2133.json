{"sha": "949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0OWIzNDdmNjU0ZjQwZWQ3ZTRhYjlkZWRiOWUyYzliMGE4YzIxMzM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-26T14:32:12Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-26T14:32:12Z"}, "message": "Auto merge of #4444 - phansch:split_up_cmp_owned2, r=flip1995\n\nSplit up cmp_owned tests, add run-rustfix\n\nSome of the cmp_owned tests emitted non-machine-applicable suggestions,\nso I moved them to `tests/ui/cmp_owned/without_suggestion.rs` and added\n`// run-rustfix` to the other half.\n\nchangelog: none\n\ncc #3630", "tree": {"sha": "c9852db5b508f8fb513cf4ef1bf1e9874f6b1541", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c9852db5b508f8fb513cf4ef1bf1e9874f6b1541"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "html_url": "https://github.com/rust-lang/rust/commit/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fea888f2ecd95d0a959637e9e0011a0f11bd9d72", "url": "https://api.github.com/repos/rust-lang/rust/commits/fea888f2ecd95d0a959637e9e0011a0f11bd9d72", "html_url": "https://github.com/rust-lang/rust/commit/fea888f2ecd95d0a959637e9e0011a0f11bd9d72"}, {"sha": "6d425a60a7e7d272a17449d85d7d590db1b2ce5e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d425a60a7e7d272a17449d85d7d590db1b2ce5e", "html_url": "https://github.com/rust-lang/rust/commit/6d425a60a7e7d272a17449d85d7d590db1b2ce5e"}], "stats": {"total": 196, "additions": 160, "deletions": 36}, "files": [{"sha": "05fb96339e33e9ff561c1e4e5c067170e1e48c58", "filename": "tests/ui/cmp_owned/with_suggestion.fixed", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.fixed?ref=949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "patch": "@@ -0,0 +1,72 @@\n+// run-rustfix\n+\n+#[warn(clippy::cmp_owned)]\n+#[allow(clippy::unnecessary_operation, clippy::no_effect, unused_must_use, clippy::eq_op)]\n+fn main() {\n+    fn with_to_string(x: &str) {\n+        x != \"foo\";\n+\n+        \"foo\" != x;\n+    }\n+\n+    let x = \"oh\";\n+\n+    with_to_string(x);\n+\n+    x != \"foo\";\n+\n+    x != \"foo\";\n+\n+    42.to_string() == \"42\";\n+\n+    Foo == Foo;\n+\n+    \"abc\".chars().filter(|c| *c != 'X');\n+\n+    \"abc\".chars().filter(|c| *c != 'X');\n+}\n+\n+struct Foo;\n+\n+impl PartialEq for Foo {\n+    // Allow this here, because it emits the lint\n+    // without a suggestion. This is tested in\n+    // `tests/ui/cmp_owned/without_suggestion.rs`\n+    #[allow(clippy::cmp_owned)]\n+    fn eq(&self, other: &Self) -> bool {\n+        self.to_owned() == *other\n+    }\n+}\n+\n+impl ToOwned for Foo {\n+    type Owned = Bar;\n+    fn to_owned(&self) -> Bar {\n+        Bar\n+    }\n+}\n+\n+#[derive(PartialEq)]\n+struct Bar;\n+\n+impl PartialEq<Foo> for Bar {\n+    fn eq(&self, _: &Foo) -> bool {\n+        true\n+    }\n+}\n+\n+impl std::borrow::Borrow<Foo> for Bar {\n+    fn borrow(&self) -> &Foo {\n+        static FOO: Foo = Foo;\n+        &FOO\n+    }\n+}\n+\n+#[derive(PartialEq)]\n+struct Baz;\n+\n+impl ToOwned for Baz {\n+    type Owned = Baz;\n+    fn to_owned(&self) -> Baz {\n+        Baz\n+    }\n+}"}, {"sha": "0a02825ed82f1b858eb1c52a6ceb3981c4effcee", "filename": "tests/ui/cmp_owned/with_suggestion.rs", "status": "renamed", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.rs?ref=949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "patch": "@@ -1,5 +1,7 @@\n+// run-rustfix\n+\n #[warn(clippy::cmp_owned)]\n-#[allow(clippy::unnecessary_operation)]\n+#[allow(clippy::unnecessary_operation, clippy::no_effect, unused_must_use, clippy::eq_op)]\n fn main() {\n     fn with_to_string(x: &str) {\n         x != \"foo\".to_string();\n@@ -22,21 +24,15 @@ fn main() {\n     \"abc\".chars().filter(|c| c.to_owned() != 'X');\n \n     \"abc\".chars().filter(|c| *c != 'X');\n-\n-    let x = &Baz;\n-    let y = &Baz;\n-\n-    y.to_owned() == *x;\n-\n-    let x = &&Baz;\n-    let y = &Baz;\n-\n-    y.to_owned() == **x;\n }\n \n struct Foo;\n \n impl PartialEq for Foo {\n+    // Allow this here, because it emits the lint\n+    // without a suggestion. This is tested in\n+    // `tests/ui/cmp_owned/without_suggestion.rs`\n+    #[allow(clippy::cmp_owned)]\n     fn eq(&self, other: &Self) -> bool {\n         self.to_owned() == *other\n     }", "previous_filename": "tests/ui/cmp_owned.rs"}, {"sha": "2f333e6ea8ecbda9d0338ff7cbfa131b518a690c", "filename": "tests/ui/cmp_owned/with_suggestion.stderr", "status": "renamed", "additions": 7, "deletions": 25, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcmp_owned%2Fwith_suggestion.stderr?ref=949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "patch": "@@ -1,58 +1,40 @@\n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:5:14\n+  --> $DIR/with_suggestion.rs:7:14\n    |\n LL |         x != \"foo\".to_string();\n    |              ^^^^^^^^^^^^^^^^^ help: try: `\"foo\"`\n    |\n    = note: `-D clippy::cmp-owned` implied by `-D warnings`\n \n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:7:9\n+  --> $DIR/with_suggestion.rs:9:9\n    |\n LL |         \"foo\".to_string() != x;\n    |         ^^^^^^^^^^^^^^^^^ help: try: `\"foo\"`\n \n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:14:10\n+  --> $DIR/with_suggestion.rs:16:10\n    |\n LL |     x != \"foo\".to_owned();\n    |          ^^^^^^^^^^^^^^^^ help: try: `\"foo\"`\n \n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:16:10\n+  --> $DIR/with_suggestion.rs:18:10\n    |\n LL |     x != String::from(\"foo\");\n    |          ^^^^^^^^^^^^^^^^^^^ help: try: `\"foo\"`\n \n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:20:5\n+  --> $DIR/with_suggestion.rs:22:5\n    |\n LL |     Foo.to_owned() == Foo;\n    |     ^^^^^^^^^^^^^^ help: try: `Foo`\n \n error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:22:30\n+  --> $DIR/with_suggestion.rs:24:30\n    |\n LL |     \"abc\".chars().filter(|c| c.to_owned() != 'X');\n    |                              ^^^^^^^^^^^^ help: try: `*c`\n \n-error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:29:5\n-   |\n-LL |     y.to_owned() == *x;\n-   |     ^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n-\n-error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:34:5\n-   |\n-LL |     y.to_owned() == **x;\n-   |     ^^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n-\n-error: this creates an owned instance just for comparison\n-  --> $DIR/cmp_owned.rs:41:9\n-   |\n-LL |         self.to_owned() == *other\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n-\n-error: aborting due to 9 previous errors\n+error: aborting due to 6 previous errors\n ", "previous_filename": "tests/ui/cmp_owned.stderr"}, {"sha": "9ab8795474c674912f3f42c4fe1f5a266b814e9e", "filename": "tests/ui/cmp_owned/without_suggestion.rs", "status": "added", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.rs?ref=949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "patch": "@@ -0,0 +1,52 @@\n+#[allow(clippy::unnecessary_operation)]\n+\n+fn main() {\n+    let x = &Baz;\n+    let y = &Baz;\n+    y.to_owned() == *x;\n+\n+    let x = &&Baz;\n+    let y = &Baz;\n+    y.to_owned() == **x;\n+}\n+\n+struct Foo;\n+\n+impl PartialEq for Foo {\n+    fn eq(&self, other: &Self) -> bool {\n+        self.to_owned() == *other\n+    }\n+}\n+\n+impl ToOwned for Foo {\n+    type Owned = Bar;\n+    fn to_owned(&self) -> Bar {\n+        Bar\n+    }\n+}\n+\n+#[derive(PartialEq)]\n+struct Baz;\n+\n+impl ToOwned for Baz {\n+    type Owned = Baz;\n+    fn to_owned(&self) -> Baz {\n+        Baz\n+    }\n+}\n+\n+#[derive(PartialEq)]\n+struct Bar;\n+\n+impl PartialEq<Foo> for Bar {\n+    fn eq(&self, _: &Foo) -> bool {\n+        true\n+    }\n+}\n+\n+impl std::borrow::Borrow<Foo> for Bar {\n+    fn borrow(&self) -> &Foo {\n+        static FOO: Foo = Foo;\n+        &FOO\n+    }\n+}"}, {"sha": "6e8a5ad2a17b5a6c02ae1dce0815da9c22b4dfa6", "filename": "tests/ui/cmp_owned/without_suggestion.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcmp_owned%2Fwithout_suggestion.stderr?ref=949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "patch": "@@ -0,0 +1,22 @@\n+error: this creates an owned instance just for comparison\n+  --> $DIR/without_suggestion.rs:6:5\n+   |\n+LL |     y.to_owned() == *x;\n+   |     ^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n+   |\n+   = note: `-D clippy::cmp-owned` implied by `-D warnings`\n+\n+error: this creates an owned instance just for comparison\n+  --> $DIR/without_suggestion.rs:10:5\n+   |\n+LL |     y.to_owned() == **x;\n+   |     ^^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n+\n+error: this creates an owned instance just for comparison\n+  --> $DIR/without_suggestion.rs:17:9\n+   |\n+LL |         self.to_owned() == *other\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^ try implementing the comparison without allocating\n+\n+error: aborting due to 3 previous errors\n+"}]}