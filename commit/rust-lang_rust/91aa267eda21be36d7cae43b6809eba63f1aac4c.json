{"sha": "91aa267eda21be36d7cae43b6809eba63f1aac4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxYWEyNjdlZGEyMWJlMzZkN2NhZTQzYjY4MDllYmE2M2YxYWFjNGM=", "commit": {"author": {"name": "Aaron Aaeng", "email": "aaaa9270@colorado.edu", "date": "2018-04-21T22:06:48Z"}, "committer": {"name": "Aaron Aaeng", "email": "aaaa9270@colorado.edu", "date": "2018-04-22T23:16:33Z"}, "message": "Make must_use lint cover all binary/unary operators", "tree": {"sha": "289140f78d587f46fa46fc05334fc6f95b2a8036", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/289140f78d587f46fa46fc05334fc6f95b2a8036"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91aa267eda21be36d7cae43b6809eba63f1aac4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91aa267eda21be36d7cae43b6809eba63f1aac4c", "html_url": "https://github.com/rust-lang/rust/commit/91aa267eda21be36d7cae43b6809eba63f1aac4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91aa267eda21be36d7cae43b6809eba63f1aac4c/comments", "author": {"login": "aaronaaeng", "id": 18424381, "node_id": "MDQ6VXNlcjE4NDI0Mzgx", "avatar_url": "https://avatars.githubusercontent.com/u/18424381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aaronaaeng", "html_url": "https://github.com/aaronaaeng", "followers_url": "https://api.github.com/users/aaronaaeng/followers", "following_url": "https://api.github.com/users/aaronaaeng/following{/other_user}", "gists_url": "https://api.github.com/users/aaronaaeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/aaronaaeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aaronaaeng/subscriptions", "organizations_url": "https://api.github.com/users/aaronaaeng/orgs", "repos_url": "https://api.github.com/users/aaronaaeng/repos", "events_url": "https://api.github.com/users/aaronaaeng/events{/privacy}", "received_events_url": "https://api.github.com/users/aaronaaeng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aaronaaeng", "id": 18424381, "node_id": "MDQ6VXNlcjE4NDI0Mzgx", "avatar_url": "https://avatars.githubusercontent.com/u/18424381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aaronaaeng", "html_url": "https://github.com/aaronaaeng", "followers_url": "https://api.github.com/users/aaronaaeng/followers", "following_url": "https://api.github.com/users/aaronaaeng/following{/other_user}", "gists_url": "https://api.github.com/users/aaronaaeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/aaronaaeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aaronaaeng/subscriptions", "organizations_url": "https://api.github.com/users/aaronaaeng/orgs", "repos_url": "https://api.github.com/users/aaronaaeng/repos", "events_url": "https://api.github.com/users/aaronaaeng/events{/privacy}", "received_events_url": "https://api.github.com/users/aaronaaeng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "222551f3f3a26b9553c97c8e8b9ad15fdb7dc902", "url": "https://api.github.com/repos/rust-lang/rust/commits/222551f3f3a26b9553c97c8e8b9ad15fdb7dc902", "html_url": "https://github.com/rust-lang/rust/commit/222551f3f3a26b9553c97c8e8b9ad15fdb7dc902"}], "stats": {"total": 239, "additions": 224, "deletions": 15}, "files": [{"sha": "8fd06e7bb4b9bcbab5b11c729dfd4e9195d73cea", "filename": "src/libcore/ops/arith.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Farith.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Farith.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fops%2Farith.rs?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -93,6 +93,7 @@ pub trait Add<RHS=Self> {\n     type Output;\n \n     /// Performs the `+` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn add(self, rhs: RHS) -> Self::Output;\n }\n@@ -189,6 +190,7 @@ pub trait Sub<RHS=Self> {\n     type Output;\n \n     /// Performs the `-` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn sub(self, rhs: RHS) -> Self::Output;\n }\n@@ -307,6 +309,7 @@ pub trait Mul<RHS=Self> {\n     type Output;\n \n     /// Performs the `*` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn mul(self, rhs: RHS) -> Self::Output;\n }\n@@ -429,6 +432,7 @@ pub trait Div<RHS=Self> {\n     type Output;\n \n     /// Performs the `/` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn div(self, rhs: RHS) -> Self::Output;\n }\n@@ -512,6 +516,7 @@ pub trait Rem<RHS=Self> {\n     type Output = Self;\n \n     /// Performs the `%` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn rem(self, rhs: RHS) -> Self::Output;\n }\n@@ -595,6 +600,7 @@ pub trait Neg {\n     type Output;\n \n     /// Performs the unary `-` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn neg(self) -> Self::Output;\n }"}, {"sha": "9bde02abe6471b5af61d1d3adf4b1005b2d848a1", "filename": "src/libcore/ops/bit.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Fbit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Fbit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fops%2Fbit.rs?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -46,6 +46,7 @@ pub trait Not {\n     type Output;\n \n     /// Performs the unary `!` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn not(self) -> Self::Output;\n }\n@@ -128,6 +129,7 @@ pub trait BitAnd<RHS=Self> {\n     type Output;\n \n     /// Performs the `&` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn bitand(self, rhs: RHS) -> Self::Output;\n }\n@@ -210,6 +212,7 @@ pub trait BitOr<RHS=Self> {\n     type Output;\n \n     /// Performs the `|` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn bitor(self, rhs: RHS) -> Self::Output;\n }\n@@ -295,6 +298,7 @@ pub trait BitXor<RHS=Self> {\n     type Output;\n \n     /// Performs the `^` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn bitxor(self, rhs: RHS) -> Self::Output;\n }\n@@ -381,6 +385,7 @@ pub trait Shl<RHS=Self> {\n     type Output;\n \n     /// Performs the `<<` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn shl(self, rhs: RHS) -> Self::Output;\n }\n@@ -488,6 +493,7 @@ pub trait Shr<RHS=Self> {\n     type Output;\n \n     /// Performs the `>>` operation.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn shr(self, rhs: RHS) -> Self::Output;\n }"}, {"sha": "3903e85768c3cbc16868df2049b930bd49169750", "filename": "src/libcore/ops/deref.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Fderef.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibcore%2Fops%2Fderef.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fops%2Fderef.rs?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -75,6 +75,7 @@ pub trait Deref {\n     type Target: ?Sized;\n \n     /// Dereferences the value.\n+    #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     fn deref(&self) -> &Self::Target;\n }"}, {"sha": "5ec8305de788c3ecb4fa4fa84ca4a05b6466c47c", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 27, "deletions": 15, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -91,23 +91,35 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for UnusedResults {\n                 let def_id = def.def_id();\n                 fn_warned = check_must_use(cx, def_id, s.span, \"return value of \");\n             }\n-\n-            if let hir::ExprBinary(bin_op, ..) = expr.node {\n-                match bin_op.node {\n-                    // Hardcoding the comparison operators here seemed more\n-                    // expedient than the refactoring that would be needed to\n-                    // look up the `#[must_use]` attribute which does exist on\n-                    // the comparison trait methods\n-                    hir::BiEq | hir::BiLt | hir::BiLe | hir::BiNe | hir::BiGe | hir::BiGt => {\n-                        let msg = \"unused comparison which must be used\";\n-                        cx.span_lint(UNUSED_MUST_USE, expr.span, msg);\n-                        op_warned = true;\n-                    },\n-                    _ => {},\n-                }\n+            let must_use_op = match expr.node {\n+                // Hardcoding operators here seemed more expedient than the\n+                // refactoring that would be needed to look up the `#[must_use]`\n+                // attribute which does exist on the comparison trait methods\n+                hir::ExprBinary(bin_op, ..)  => {\n+                    match bin_op.node {\n+                        hir::BiEq | hir::BiLt | hir::BiLe | hir::BiNe | hir::BiGe | hir::BiGt => {\n+                            Some(\"comparison\")\n+                        },\n+                        hir::BiAdd | hir::BiSub | hir::BiDiv | hir::BiMul | hir::BiRem => {\n+                            Some(\"arithmetic operation\")\n+                        },\n+                        hir::BiAnd | hir::BiOr => {\n+                            Some(\"logical operation\")\n+                        },\n+                        hir::BiBitXor | hir::BiBitAnd | hir::BiBitOr | hir::BiShl | hir::BiShr => {\n+                            Some(\"bitwise operation\")\n+                        },\n+                    }\n+                },\n+                hir::ExprUnary(..) => Some(\"unary operation\"),\n+                _ => None\n+            };\n+            if let Some(must_use_op) = must_use_op {\n+                cx.span_lint(UNUSED_MUST_USE, expr.span,\n+                    &format!(\"unused {} which must be used\", must_use_op));\n+                op_warned = true;\n             }\n         }\n-\n         if !(ty_warned || fn_warned || op_warned) {\n             cx.span_lint(UNUSED_RESULTS, s.span, \"unused result\");\n         }"}, {"sha": "4ed82ab3b4025c283726b3b47b3cac4e2412d935", "filename": "src/test/ui/lint/must-use-ops.rs", "status": "added", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.rs?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -0,0 +1,52 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Issue #50124 - Test warning for unused operator expressions\n+\n+// compile-pass\n+\n+#![feature(fn_must_use)]\n+#![warn(unused_must_use)]\n+\n+fn main() {\n+    let val = 1;\n+    let val_pointer = &val;\n+\n+// Comparison Operators\n+    val == 1;\n+    val < 1;\n+    val <= 1;\n+    val != 1;\n+    val >= 1;\n+    val > 1;\n+\n+// Arithmetic Operators\n+    val + 2;\n+    val - 2;\n+    val / 2;\n+    val * 2;\n+    val % 2;\n+\n+// Logical Operators\n+    true && true;\n+    false || true;\n+\n+// Bitwise Operators\n+    5 ^ val;\n+    5 & val;\n+    5 | val;\n+    5 << val;\n+    5 >> val;\n+\n+// Unary Operators\n+    !val;\n+    -val;\n+    *val_pointer;\n+}"}, {"sha": "f444ef0907575e4b7cc5f3373ee811b7eed2d355", "filename": "src/test/ui/lint/must-use-ops.stderr", "status": "added", "additions": 132, "deletions": 0, "changes": 132, "blob_url": "https://github.com/rust-lang/rust/blob/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/91aa267eda21be36d7cae43b6809eba63f1aac4c/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr?ref=91aa267eda21be36d7cae43b6809eba63f1aac4c", "patch": "@@ -0,0 +1,132 @@\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:23:5\n+   |\n+LL |     val == 1;\n+   |     ^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/must-use-ops.rs:16:9\n+   |\n+LL | #![warn(unused_must_use)]\n+   |         ^^^^^^^^^^^^^^^\n+\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:24:5\n+   |\n+LL |     val < 1;\n+   |     ^^^^^^^\n+\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:25:5\n+   |\n+LL |     val <= 1;\n+   |     ^^^^^^^^\n+\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:26:5\n+   |\n+LL |     val != 1;\n+   |     ^^^^^^^^\n+\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:27:5\n+   |\n+LL |     val >= 1;\n+   |     ^^^^^^^^\n+\n+warning: unused comparison which must be used\n+  --> $DIR/must-use-ops.rs:28:5\n+   |\n+LL |     val > 1;\n+   |     ^^^^^^^\n+\n+warning: unused arithmetic operation which must be used\n+  --> $DIR/must-use-ops.rs:31:5\n+   |\n+LL |     val + 2;\n+   |     ^^^^^^^\n+\n+warning: unused arithmetic operation which must be used\n+  --> $DIR/must-use-ops.rs:32:5\n+   |\n+LL |     val - 2;\n+   |     ^^^^^^^\n+\n+warning: unused arithmetic operation which must be used\n+  --> $DIR/must-use-ops.rs:33:5\n+   |\n+LL |     val / 2;\n+   |     ^^^^^^^\n+\n+warning: unused arithmetic operation which must be used\n+  --> $DIR/must-use-ops.rs:34:5\n+   |\n+LL |     val * 2;\n+   |     ^^^^^^^\n+\n+warning: unused arithmetic operation which must be used\n+  --> $DIR/must-use-ops.rs:35:5\n+   |\n+LL |     val % 2;\n+   |     ^^^^^^^\n+\n+warning: unused logical operation which must be used\n+  --> $DIR/must-use-ops.rs:38:5\n+   |\n+LL |     true && true;\n+   |     ^^^^^^^^^^^^\n+\n+warning: unused logical operation which must be used\n+  --> $DIR/must-use-ops.rs:39:5\n+   |\n+LL |     false || true;\n+   |     ^^^^^^^^^^^^^\n+\n+warning: unused bitwise operation which must be used\n+  --> $DIR/must-use-ops.rs:42:5\n+   |\n+LL |     5 ^ val;\n+   |     ^^^^^^^\n+\n+warning: unused bitwise operation which must be used\n+  --> $DIR/must-use-ops.rs:43:5\n+   |\n+LL |     5 & val;\n+   |     ^^^^^^^\n+\n+warning: unused bitwise operation which must be used\n+  --> $DIR/must-use-ops.rs:44:5\n+   |\n+LL |     5 | val;\n+   |     ^^^^^^^\n+\n+warning: unused bitwise operation which must be used\n+  --> $DIR/must-use-ops.rs:45:5\n+   |\n+LL |     5 << val;\n+   |     ^^^^^^^^\n+\n+warning: unused bitwise operation which must be used\n+  --> $DIR/must-use-ops.rs:46:5\n+   |\n+LL |     5 >> val;\n+   |     ^^^^^^^^\n+\n+warning: unused unary operation which must be used\n+  --> $DIR/must-use-ops.rs:49:5\n+   |\n+LL |     !val;\n+   |     ^^^^\n+\n+warning: unused unary operation which must be used\n+  --> $DIR/must-use-ops.rs:50:5\n+   |\n+LL |     -val;\n+   |     ^^^^\n+\n+warning: unused unary operation which must be used\n+  --> $DIR/must-use-ops.rs:51:5\n+   |\n+LL |     *val_pointer;\n+   |     ^^^^^^^^^^^^\n+"}]}