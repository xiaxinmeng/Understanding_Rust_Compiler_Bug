{"sha": "7e55061def5c09567ab51da9d9dcaa5016183806", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlNTUwNjFkZWY1YzA5NTY3YWI1MWRhOWQ5ZGNhYTUwMTYxODM4MDY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-18T23:07:34Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-18T23:16:48Z"}, "message": "Add str::replace", "tree": {"sha": "a148e806f43347b0b505e63bd8388015b6c93197", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a148e806f43347b0b505e63bd8388015b6c93197"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e55061def5c09567ab51da9d9dcaa5016183806", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e55061def5c09567ab51da9d9dcaa5016183806", "html_url": "https://github.com/rust-lang/rust/commit/7e55061def5c09567ab51da9d9dcaa5016183806", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e55061def5c09567ab51da9d9dcaa5016183806/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "689f5f487c7c32b2fa543350d1458e75eb20922c", "url": "https://api.github.com/repos/rust-lang/rust/commits/689f5f487c7c32b2fa543350d1458e75eb20922c", "html_url": "https://github.com/rust-lang/rust/commit/689f5f487c7c32b2fa543350d1458e75eb20922c"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "15ca04df190c9775e724b71f3e993a0d33609361", "filename": "src/lib/str.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7e55061def5c09567ab51da9d9dcaa5016183806/src%2Flib%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e55061def5c09567ab51da9d9dcaa5016183806/src%2Flib%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fstr.rs?ref=7e55061def5c09567ab51da9d9dcaa5016183806", "patch": "@@ -52,6 +52,7 @@ export bytes_ivec;\n export unsafe_from_bytes_ivec;\n export is_empty;\n export is_not_empty;\n+export replace;\n \n native \"rust\" mod rustrt {\n     type sbuf;\n@@ -511,6 +512,22 @@ fn to_upper(str s) -> str {\n     }\n     ret outstr;\n }\n+\n+// FIXME: This is super-inefficient\n+fn replace(str s, str from, str to) : is_not_empty(from) -> str {\n+    // FIXME (694): Shouldn't have to check this\n+    check is_not_empty(from);\n+    if (byte_len(s) == 0u) {\n+        ret \"\";\n+    } else if (starts_with(s, from)) {\n+        ret to + replace(slice(s, byte_len(from), byte_len(s)),\n+                             from, to);\n+    } else {\n+        ret unsafe_from_byte(s.(0))\n+            + replace(slice(s, 1u, byte_len(s)), from, to);\n+    }\n+}\n+\n // Local Variables:\n // mode: rust;\n // fill-column: 78;"}, {"sha": "52ec5b78addd2d4ad6d688d2082d7d1399f33087", "filename": "src/test/run-pass/lib-str.rs", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/7e55061def5c09567ab51da9d9dcaa5016183806/src%2Ftest%2Frun-pass%2Flib-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e55061def5c09567ab51da9d9dcaa5016183806/src%2Ftest%2Frun-pass%2Flib-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-str.rs?ref=7e55061def5c09567ab51da9d9dcaa5016183806", "patch": "@@ -132,6 +132,19 @@ fn test_is_not_empty() {\n   assert !str::is_not_empty(\"\");\n }\n \n+fn test_replace() {\n+    auto a = \"a\";\n+    check str::is_not_empty(a);\n+    assert str::replace(\"\", a, \"b\") == \"\";\n+    assert str::replace(\"a\", a, \"b\") == \"b\";\n+    assert str::replace(\"ab\", a, \"b\") == \"bb\";\n+    auto test = \"test\";\n+    check str::is_not_empty(test);\n+    assert str::replace(\" test test \", test, \"toast\")\n+        == \" toast toast \";\n+    assert str::replace(\" test test \", test, \"\") == \"   \";\n+}\n+\n fn main() {\n     test_bytes_len();\n     test_index_and_rindex();\n@@ -145,4 +158,15 @@ fn main() {\n     test_ends_with();\n     test_is_empty();\n     test_is_not_empty();\n-}\n\\ No newline at end of file\n+    test_replace();\n+}\n+\n+\n+// Local Variables:\n+// mode: rust;\n+// fill-column: 78;\n+// indent-tabs-mode: nil\n+// c-basic-offset: 4\n+// buffer-file-coding-system: utf-8-unix\n+// compile-command: \"make -k -C $RBUILD 2>&1 | sed -e 's/\\\\/x\\\\//x:\\\\//g'\";\n+// End:"}]}