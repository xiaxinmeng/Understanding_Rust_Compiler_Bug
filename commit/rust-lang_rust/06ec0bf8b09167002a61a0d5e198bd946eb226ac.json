{"sha": "06ec0bf8b09167002a61a0d5e198bd946eb226ac", "node_id": "C_kwDOAAsO6NoAKDA2ZWMwYmY4YjA5MTY3MDAyYTYxYTBkNWUxOThiZDk0NmViMjI2YWM", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-12-29T08:47:23Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-12-29T08:47:23Z"}, "message": "Revert \"Implement allow-by-default multiple_supertrait_upcastable lint\"\n\nThis reverts commit 5e44a65517bfcccbe6624a70b54b9f192baa94f3.", "tree": {"sha": "6bd4e709d13e485089e721f0181cbe3fa31444e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6bd4e709d13e485089e721f0181cbe3fa31444e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/06ec0bf8b09167002a61a0d5e198bd946eb226ac", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmOtVB0ACgkQ+boUO5X/\nbYI7DQ//QVgz4idMWVZ6g+/Q61foAY9Xl65UJDv5bLH/jrWDXegGxX12OaEY/BU6\npeDlI+k6X/dc/tjy/9KYsGkLmZdfqBvKLN2Sxq8TkCRVUJHdAu7pFSZtFkIP1MSr\nxMm0fb+HZE0+yR/YBup3X/ClU+cPILfPqrKpwDguSg6HO4+pu21nT0jSBjJS8D4R\nNzIWhxUMC0Me2SSeat+6rZDpCQ+Ha9PuS+s6w0wefS/yXE84zDEi2780zEv8MZrQ\nMxdLjwSVEzhiRVIRs79tR432h1QyWpqriaVx4x2tP+Wnk3grlojX5Px+abMa4ROp\nWe0HyRZsOzzfrzwWGxnbzTRJDzzudFWmsWybNHIXv+OLjXd1nzIdRdVq+wrZwVsf\n/ucp7TK1JYiU1/PgbAM26jbyv5+5ALAnsqiRbFXL68S+tH9tjYJFctqkJajJZzm7\nIzf9u6rysIcRJD6krSSq6TS560SpRelJRPdXtsnlh17ZulWrZ42WDvI/SUcG+ppD\nOtE+BJ+Elmeffq5rYEg2up440W334gOMALpY5ylPY3d5MuaqT4H4g7/ixxsdwd2+\nrxjCuk0BCJO6FrDnmE+9KdICXGd368NujcLKbw2dAq7b6EeCzTdKUen6/7AeWgWf\nkpq5RqDxHeLlfwsNx4fj1t3GRQgx3cwcqUPUQ3uy2GO2nFT/RGQ=\n=VlIc\n-----END PGP SIGNATURE-----", "payload": "tree 6bd4e709d13e485089e721f0181cbe3fa31444e8\nparent c5f66726f0d196cd060ef419067d8f2fe4e3d76c\nauthor David Tolnay <dtolnay@gmail.com> 1672303643 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1672303643 -0800\n\nRevert \"Implement allow-by-default multiple_supertrait_upcastable lint\"\n\nThis reverts commit 5e44a65517bfcccbe6624a70b54b9f192baa94f3.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/06ec0bf8b09167002a61a0d5e198bd946eb226ac", "html_url": "https://github.com/rust-lang/rust/commit/06ec0bf8b09167002a61a0d5e198bd946eb226ac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/06ec0bf8b09167002a61a0d5e198bd946eb226ac/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5f66726f0d196cd060ef419067d8f2fe4e3d76c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5f66726f0d196cd060ef419067d8f2fe4e3d76c", "html_url": "https://github.com/rust-lang/rust/commit/c5f66726f0d196cd060ef419067d8f2fe4e3d76c"}], "stats": {"total": 74, "additions": 0, "deletions": 74}, "files": [{"sha": "deb37bdebda638a77701537f008000a80452a4d6", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -160,8 +160,6 @@ declare_features! (\n     (active, intrinsics, \"1.0.0\", None, None),\n     /// Allows using `#[lang = \"..\"]` attribute for linking items to special compiler logic.\n     (active, lang_items, \"1.0.0\", None, None),\n-    /// Allows the `multiple_supertrait_upcastable` lint.\n-    (active, multiple_supertrait_upcastable, \"CURRENT_RUSTC_VERSION\", None, None),\n     /// Allows using `#[omit_gdb_pretty_printer_section]`.\n     (active, omit_gdb_pretty_printer_section, \"1.5.0\", None, None),\n     /// Allows using `#[prelude_import]` on glob `use` items."}, {"sha": "1275d6f223c7a38ebe5fbfd42cc50c04c4990149", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -61,7 +61,6 @@ mod late;\n mod let_underscore;\n mod levels;\n mod methods;\n-mod multiple_supertrait_upcastable;\n mod non_ascii_idents;\n mod non_fmt_panic;\n mod nonstandard_style;\n@@ -96,7 +95,6 @@ use hidden_unicode_codepoints::*;\n use internal::*;\n use let_underscore::*;\n use methods::*;\n-use multiple_supertrait_upcastable::*;\n use non_ascii_idents::*;\n use non_fmt_panic::NonPanicFmt;\n use nonstandard_style::*;\n@@ -231,7 +229,6 @@ late_lint_methods!(\n             InvalidAtomicOrdering: InvalidAtomicOrdering,\n             NamedAsmLabels: NamedAsmLabels,\n             OpaqueHiddenInferredBound: OpaqueHiddenInferredBound,\n-            MultipleSupertraitUpcastable: MultipleSupertraitUpcastable,\n         ]\n     ]\n );"}, {"sha": "5861b826b1ca337309631b1ed4c5e0947f9adaf7", "filename": "compiler/rustc_lint/src/multiple_supertrait_upcastable.rs", "status": "removed", "additions": 0, "deletions": 63, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/c5f66726f0d196cd060ef419067d8f2fe4e3d76c/compiler%2Frustc_lint%2Fsrc%2Fmultiple_supertrait_upcastable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5f66726f0d196cd060ef419067d8f2fe4e3d76c/compiler%2Frustc_lint%2Fsrc%2Fmultiple_supertrait_upcastable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fmultiple_supertrait_upcastable.rs?ref=c5f66726f0d196cd060ef419067d8f2fe4e3d76c", "patch": "@@ -1,63 +0,0 @@\n-use crate::{LateContext, LateLintPass, LintContext};\n-\n-use rustc_errors::DelayDm;\n-use rustc_hir as hir;\n-use rustc_span::sym;\n-\n-declare_lint! {\n-    /// The `multiple_supertrait_upcastable` lint detects when an object-safe trait has multiple\n-    /// supertraits.\n-    ///\n-    /// ### Example\n-    ///\n-    /// ```rust\n-    /// trait A {}\n-    /// trait B {}\n-    ///\n-    /// #[warn(multiple_supertrait_upcastable)]\n-    /// trait C: A + B {}\n-    /// ```\n-    ///\n-    /// {{produces}}\n-    ///\n-    /// ### Explanation\n-    ///\n-    /// To support upcasting with multiple supertraits, we need to store multiple vtables and this\n-    /// can result in extra space overhead, even if no code actually uses upcasting.\n-    /// This lint allows users to identify when such scenarios occur and to decide whether the\n-    /// additional overhead is justified.\n-    pub MULTIPLE_SUPERTRAIT_UPCASTABLE,\n-    Allow,\n-    \"detect when an object-safe trait has multiple supertraits\",\n-    @feature_gate = sym::multiple_supertrait_upcastable;\n-}\n-\n-declare_lint_pass!(MultipleSupertraitUpcastable => [MULTIPLE_SUPERTRAIT_UPCASTABLE]);\n-\n-impl<'tcx> LateLintPass<'tcx> for MultipleSupertraitUpcastable {\n-    fn check_item(&mut self, cx: &LateContext<'tcx>, item: &'tcx hir::Item<'tcx>) {\n-        let def_id = item.owner_id.to_def_id();\n-        if let hir::ItemKind::Trait(_, _, _, _, _) = item.kind\n-            && cx.tcx.is_object_safe(def_id)\n-        {\n-            let direct_super_traits_iter = cx.tcx\n-                    .super_predicates_of(def_id)\n-                    .predicates\n-                    .into_iter()\n-                    .filter_map(|(pred, _)| pred.to_opt_poly_trait_pred());\n-            if direct_super_traits_iter.count() > 1 {\n-                cx.struct_span_lint(\n-                    MULTIPLE_SUPERTRAIT_UPCASTABLE,\n-                    cx.tcx.def_span(def_id),\n-                    DelayDm(|| {\n-                        format!(\n-                            \"`{}` is object-safe and has multiple supertraits\",\n-                            item.ident,\n-                        )\n-                    }),\n-                    |diag| diag,\n-                );\n-            }\n-        }\n-    }\n-}"}, {"sha": "85510fa2c660c53c700764823d1150eb3721927e", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -944,7 +944,6 @@ symbols! {\n         mul,\n         mul_assign,\n         mul_with_overflow,\n-        multiple_supertrait_upcastable,\n         must_not_suspend,\n         must_use,\n         naked,"}, {"sha": "31d6920305a542f17b71acec257f6450a6ca8f84", "filename": "library/alloc/src/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Falloc%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Falloc%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Flib.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -87,7 +87,6 @@\n #![warn(missing_debug_implementations)]\n #![warn(missing_docs)]\n #![allow(explicit_outlives_requirements)]\n-#![cfg_attr(not(bootstrap), warn(multiple_supertrait_upcastable))]\n //\n // Library features:\n #![feature(alloc_layout_extra)]\n@@ -192,7 +191,6 @@\n #![feature(unsized_fn_params)]\n #![feature(c_unwind)]\n #![feature(with_negative_coherence)]\n-#![cfg_attr(not(bootstrap), feature(multiple_supertrait_upcastable))]\n //\n // Rustdoc features:\n #![feature(doc_cfg)]"}, {"sha": "7152300abcbf3a446cca031d797040d23abb2353", "filename": "library/core/src/error.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Fcore%2Fsrc%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Fcore%2Fsrc%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Ferror.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -28,7 +28,6 @@ use crate::fmt::{Debug, Display};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"Error\")]\n #[rustc_has_incoherent_inherent_impls]\n-#[cfg_attr(not(bootstrap), allow(multiple_supertrait_upcastable))]\n pub trait Error: Debug + Display {\n     /// The lower-level source of this error, if any.\n     ///"}, {"sha": "19f193cfe95a7ad1eec7da7cce88b2535386afde", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/06ec0bf8b09167002a61a0d5e198bd946eb226ac/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=06ec0bf8b09167002a61a0d5e198bd946eb226ac", "patch": "@@ -95,7 +95,6 @@\n #![warn(missing_docs)]\n #![allow(explicit_outlives_requirements)]\n #![allow(incomplete_features)]\n-#![cfg_attr(not(bootstrap), warn(multiple_supertrait_upcastable))]\n //\n // Library features:\n #![feature(const_align_offset)]\n@@ -232,7 +231,6 @@\n #![feature(unsized_fn_params)]\n #![feature(asm_const)]\n #![feature(const_transmute_copy)]\n-#![cfg_attr(not(bootstrap), feature(multiple_supertrait_upcastable))]\n //\n // Target features:\n #![feature(arm_target_feature)]"}]}