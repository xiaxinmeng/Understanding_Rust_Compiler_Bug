{"sha": "aeb16828945ef7d3cda88d27da96a1b475acd90a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlYjE2ODI4OTQ1ZWY3ZDNjZGE4OGQyN2RhOTZhMWI0NzVhY2Q5MGE=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-07-04T20:35:38Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-07-04T20:35:38Z"}, "message": "Ensure that borrows wind up unactivated.", "tree": {"sha": "33ad5d5335d127f21a6446eb63b7822f92d539da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33ad5d5335d127f21a6446eb63b7822f92d539da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aeb16828945ef7d3cda88d27da96a1b475acd90a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAls9L5oACgkQAXYLT59T\n8VTj4RAAn6l+URE8fKK8h2htpzEhl89BiQ6G+SJMyKd895tudVhfp9PV53Lo4Q3W\nbVE3AiOaskyCVR6Mky31liE4DGs141MzP9eCbR6P9QBn1Vu4mpJKuWseuyf8kRxG\nvHNXMB/n0otyBPi9CTh3hU5zYVTIaP2tdkAX0Twi0u+YC4H/Ki/bcs3JIEyIgjBz\n6GWs6/mnEAS1e1UeTj1mKvITBpxFJxkfofRhRIdaIqZy6rPTofPnrgsQMJQuKRDo\nr1VQAvxsGkvy1Mngwxq1fFwe54toQ8k7YYiXswqh4ny2qmbqLYC32q0oPoHOvf8c\nTDUyEe6lMHyv1ACADpCQlrbA5hJEVwswJAmszMpO/SvNN5MfdT6S6AN3wr/IJpbf\nmWc9pRzdHz5ORCGZfN24hpG3CqNPJnY662DqSoYpjeBSwwBEUdsafv90e3XwaDHG\nf+/YNmQISNYdXHp0+2wI9aJm8jfp8ixEScUR59euzV1FnKEHkrx9qUByOq9XDdZQ\n206EeEsJIfXCBT0LueSdahlosuYhhLNSTKvpEG9k/q4wtKqmEHDtCbhRPW0v51Xw\nK314ojwTFjsMFOg7zceUIGW52n/MXdFQwwGkVBBmx+omY11nC6b5C23IzHtAvYQP\nBMt3NnTJw/QI3h/iOC5O3NEy3aW3n4jSJGey77gqngX+T/o7gzo=\n=R261\n-----END PGP SIGNATURE-----", "payload": "tree 33ad5d5335d127f21a6446eb63b7822f92d539da\nparent 7eba13f45164f42892b1430badae197ec2a77c5a\nauthor David Wood <david@davidtw.co> 1530736538 +0100\ncommitter David Wood <david@davidtw.co> 1530736538 +0100\n\nEnsure that borrows wind up unactivated.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aeb16828945ef7d3cda88d27da96a1b475acd90a", "html_url": "https://github.com/rust-lang/rust/commit/aeb16828945ef7d3cda88d27da96a1b475acd90a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aeb16828945ef7d3cda88d27da96a1b475acd90a/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7eba13f45164f42892b1430badae197ec2a77c5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7eba13f45164f42892b1430badae197ec2a77c5a", "html_url": "https://github.com/rust-lang/rust/commit/7eba13f45164f42892b1430badae197ec2a77c5a"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "a427b9dd5b7d5cfd2aff142a1f0ea9a001d47b68", "filename": "src/librustc_mir/borrow_check/borrow_set.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aeb16828945ef7d3cda88d27da96a1b475acd90a/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aeb16828945ef7d3cda88d27da96a1b475acd90a/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fborrow_set.rs?ref=aeb16828945ef7d3cda88d27da96a1b475acd90a", "patch": "@@ -237,6 +237,14 @@ impl<'a, 'gcx, 'tcx> Visitor<'tcx> for GatherBorrows<'a, 'gcx, 'tcx> {\n                             TwoPhaseActivation::NotActivated\n                         }\n                         _ => {\n+                            // Double check: We should have found an activation for every pending\n+                            // activation.\n+                            assert_eq!(\n+                                borrow_data.activation_location,\n+                                TwoPhaseActivation::NotActivated,\n+                                \"never found an activation for this borrow!\",\n+                            );\n+\n                             self.activation_map\n                                 .entry(location)\n                                 .or_insert(Vec::new())\n@@ -322,6 +330,10 @@ impl<'a, 'gcx, 'tcx> GatherBorrows<'a, 'gcx, 'tcx> {\n             );\n         };\n \n+        // Consider the borrow not activated.\n+        let borrow_data = &mut self.idx_vec[borrow_index];\n+        borrow_data.activation_location = TwoPhaseActivation::NotActivated;\n+\n         // Insert `temp` into the list of pending activations. From\n         // now on, we'll be on the lookout for a use of it. Note that\n         // we are guaranteed that this use will come after the"}, {"sha": "9efd08195a1bb123f5324f5f319a0b5c87052792", "filename": "src/test/run-fail/issue-51345.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/aeb16828945ef7d3cda88d27da96a1b475acd90a/src%2Ftest%2Frun-fail%2Fissue-51345.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aeb16828945ef7d3cda88d27da96a1b475acd90a/src%2Ftest%2Frun-fail%2Fissue-51345.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fissue-51345.rs?ref=aeb16828945ef7d3cda88d27da96a1b475acd90a", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// error-pattern: thread 'main' panicked at 'explicit panic'\n+\n+#![feature(nll)]\n+\n+fn main() {\n+    let mut vec = vec![];\n+    vec.push((vec.len(), panic!()));\n+}"}]}