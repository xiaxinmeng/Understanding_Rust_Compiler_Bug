{"sha": "3e17988a537a5aaa4c02d8ba586b5cfe58c73aae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlMTc5ODhhNTM3YTVhYWE0YzAyZDhiYTU4NmI1Y2ZlNThjNzNhYWU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-12-14T14:10:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-14T14:10:11Z"}, "message": "Rollup merge of #56702 - wesleywiser:calc_total_time_stats, r=michaelwoerister\n\n[self-profiler] Add column for percent of total time\n\nExample output:\n\n```\nSelf profiling results:\n\n| Phase            | Time (ms)      | Time (%) | Queries        | Hits (%)\n| ---------------- | -------------- | -------- | -------------- | --------\n| Parsing          | 3              | 0.52     |                |\n| Expansion        | 64             | 11.27    |                |\n| TypeChecking     | 13             | 2.36     | 35208          | 90.77\n| BorrowChecking   | 0              | 0.10     | 68             | 50.00\n| Codegen          | 22             | 3.82     | 7362           | 75.12\n| Linking          | 252            | 43.81    | 458            | 68.56\n| Other            | 219            | 38.12    | 47372          | 56.84\n\nOptimization level: No\nIncremental: off\n\n```\n\ncc @michaelwoerister", "tree": {"sha": "456d270a1c704a293883da8847b680969ca75356", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/456d270a1c704a293883da8847b680969ca75356"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcE7nDCRBK7hj4Ov3rIwAAdHIIALFJO8im5L2Yn1U4/Y6Y5GkE\neHPMKJDlDK5Ghb/+1+FaiW0/M0WmOLIJJ/XYI0FqPA5UsUxvxikQAk48Ktc28J9B\nDOIRL1eHa+Oa3ZfWOycigtsI9Yq8pikwNeH7cQPbGWrOQMZC0suOgwPT2BMkhnRb\n1e3rCB68bGUyMW1kBu5Te0bXLrwNH2X8vX8NQFahUwMk84OsBt6d9/8m3rlbN+/n\nb66r3rBx9NA0y1Wztu47u1AQLgWnn3Frh3X1ZGarXXi/G5qx+EjvmD2xGMaFpTdH\nezzhUWgmVdwU6rlWiZhrsDDgQjyCrAz9f8KzT1aDNBLz2ke0H7Eab70/UOIWFRI=\n=mPLr\n-----END PGP SIGNATURE-----\n", "payload": "tree 456d270a1c704a293883da8847b680969ca75356\nparent dadf7fcc2dc76dd90a9f5a4eea595cf7add8ffff\nparent 771e8b82af5921c52f2f6074196002f8a951f596\nauthor kennytm <kennytm@gmail.com> 1544796611 +0800\ncommitter GitHub <noreply@github.com> 1544796611 +0800\n\nRollup merge of #56702 - wesleywiser:calc_total_time_stats, r=michaelwoerister\n\n[self-profiler] Add column for percent of total time\n\nExample output:\n\n```\nSelf profiling results:\n\n| Phase            | Time (ms)      | Time (%) | Queries        | Hits (%)\n| ---------------- | -------------- | -------- | -------------- | --------\n| Parsing          | 3              | 0.52     |                |\n| Expansion        | 64             | 11.27    |                |\n| TypeChecking     | 13             | 2.36     | 35208          | 90.77\n| BorrowChecking   | 0              | 0.10     | 68             | 50.00\n| Codegen          | 22             | 3.82     | 7362           | 75.12\n| Linking          | 252            | 43.81    | 458            | 68.56\n| Other            | 219            | 38.12    | 47372          | 56.84\n\nOptimization level: No\nIncremental: off\n\n```\n\ncc @michaelwoerister\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae", "html_url": "https://github.com/rust-lang/rust/commit/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dadf7fcc2dc76dd90a9f5a4eea595cf7add8ffff", "url": "https://api.github.com/repos/rust-lang/rust/commits/dadf7fcc2dc76dd90a9f5a4eea595cf7add8ffff", "html_url": "https://github.com/rust-lang/rust/commit/dadf7fcc2dc76dd90a9f5a4eea595cf7add8ffff"}, {"sha": "771e8b82af5921c52f2f6074196002f8a951f596", "url": "https://api.github.com/repos/rust-lang/rust/commits/771e8b82af5921c52f2f6074196002f8a951f596", "html_url": "https://github.com/rust-lang/rust/commit/771e8b82af5921c52f2f6074196002f8a951f596"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "c2bfa62cf9d068737c6a5ea694fdb40778cc1d6a", "filename": "src/librustc/util/profiling.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae/src%2Flibrustc%2Futil%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e17988a537a5aaa4c02d8ba586b5cfe58c73aae/src%2Flibrustc%2Futil%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fprofiling.rs?ref=3e17988a537a5aaa4c02d8ba586b5cfe58c73aae", "patch": "@@ -62,11 +62,15 @@ macro_rules! define_categories {\n             }\n \n             fn print(&self, lock: &mut StderrLock<'_>) {\n-                writeln!(lock, \"| Phase            | Time (ms)      | Queries        | Hits (%) |\")\n+                writeln!(lock, \"| Phase            | Time (ms)      \\\n+                                | Time (%) | Queries        | Hits (%)\")\n                     .unwrap();\n-                writeln!(lock, \"| ---------------- | -------------- | -------------- | -------- |\")\n+                writeln!(lock, \"| ---------------- | -------------- \\\n+                                | -------- | -------------- | --------\")\n                     .unwrap();\n \n+                let total_time = ($(self.times.$name + )* 0) as f32;\n+\n                 $(\n                     let (hits, total) = self.query_counts.$name;\n                     let (hits, total) = if total > 0 {\n@@ -78,11 +82,12 @@ macro_rules! define_categories {\n \n                     writeln!(\n                         lock,\n-                        \"| {0: <16} | {1: <14} | {2: <14} | {3: <8} |\",\n+                        \"| {0: <16} | {1: <14} | {2: <8.2} | {3: <14} | {4: <8}\",\n                         stringify!($name),\n                         self.times.$name / 1_000_000,\n+                        ((self.times.$name as f32) / total_time) * 100.0,\n                         total,\n-                        hits\n+                        hits,\n                     ).unwrap();\n                 )*\n             }"}]}