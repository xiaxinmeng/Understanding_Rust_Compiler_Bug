{"sha": "ca9ef27ed156d599f6feac0c772cc29d960526ee", "node_id": "C_kwDOAAsO6NoAKGNhOWVmMjdlZDE1NmQ1OTlmNmZlYWMwYzc3MmNjMjlkOTYwNTI2ZWU", "commit": {"author": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2022-04-09T15:10:34Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2022-04-09T15:10:34Z"}, "message": "Check for git submodules in non-git source tree.", "tree": {"sha": "4ad55efdfa91002ca25d8b1c40edd892cb9847b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ad55efdfa91002ca25d8b1c40edd892cb9847b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca9ef27ed156d599f6feac0c772cc29d960526ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca9ef27ed156d599f6feac0c772cc29d960526ee", "html_url": "https://github.com/rust-lang/rust/commit/ca9ef27ed156d599f6feac0c772cc29d960526ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca9ef27ed156d599f6feac0c772cc29d960526ee/comments", "author": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fbdb10f9fabe47eb763cb4b52b5721740cc63783", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbdb10f9fabe47eb763cb4b52b5721740cc63783", "html_url": "https://github.com/rust-lang/rust/commit/fbdb10f9fabe47eb763cb4b52b5721740cc63783"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "00dc7da275a43e8d479c18151036793744c76cae", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ca9ef27ed156d599f6feac0c772cc29d960526ee/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/ca9ef27ed156d599f6feac0c772cc29d960526ee/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=ca9ef27ed156d599f6feac0c772cc29d960526ee", "patch": "@@ -1097,8 +1097,19 @@ def update_submodule(self, module, checked_out, recorded_submodules):\n \n     def update_submodules(self):\n         \"\"\"Update submodules\"\"\"\n-        if (not os.path.exists(os.path.join(self.rust_root, \".git\"))) or \\\n-                self.get_toml('submodules') == \"false\":\n+        has_git = os.path.exists(os.path.join(self.rust_root, \".git\"))\n+        # This just arbitrarily checks for cargo, but any workspace member in\n+        # a submodule would work.\n+        has_submodules = os.path.exists(os.path.join(self.rust_root, \"src/tools/cargo/Cargo.toml\"))\n+        if not has_git and not has_submodules:\n+            print(\"This is not a git repository, and the requisite git submodules were not found.\")\n+            print(\"If you downloaded the source from https://github.com/rust-lang/rust/releases,\")\n+            print(\"those sources will not work. Instead, consider downloading from the source\")\n+            print(\"releases linked at\")\n+            print(\"https://forge.rust-lang.org/infra/other-installation-methods.html#source-code\")\n+            print(\"or clone the repository at https://github.com/rust-lang/rust/.\")\n+            raise SystemExit(1)\n+        if not has_git or self.get_toml('submodules') == \"false\":\n             return\n \n         default_encoding = sys.getdefaultencoding()"}]}