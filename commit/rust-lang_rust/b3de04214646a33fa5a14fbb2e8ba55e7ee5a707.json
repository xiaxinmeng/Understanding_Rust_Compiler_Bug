{"sha": "b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzZGUwNDIxNDY0NmEzM2ZhNWExNGZiYjJlOGJhNTVlN2VlNWE3MDc=", "commit": {"author": {"name": "Garrett Squire", "email": "garrettsquire@gmail.com", "date": "2016-05-04T17:25:17Z"}, "committer": {"name": "Garrett Squire", "email": "garrettsquire@gmail.com", "date": "2016-05-04T17:25:17Z"}, "message": "add a check to make tidy to ensure cargo lock file is updated", "tree": {"sha": "f771350a8d5272406e885068c3731af2aa1db058", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f771350a8d5272406e885068c3731af2aa1db058"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "html_url": "https://github.com/rust-lang/rust/commit/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/comments", "author": {"login": "gsquire", "id": 2665334, "node_id": "MDQ6VXNlcjI2NjUzMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2665334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gsquire", "html_url": "https://github.com/gsquire", "followers_url": "https://api.github.com/users/gsquire/followers", "following_url": "https://api.github.com/users/gsquire/following{/other_user}", "gists_url": "https://api.github.com/users/gsquire/gists{/gist_id}", "starred_url": "https://api.github.com/users/gsquire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gsquire/subscriptions", "organizations_url": "https://api.github.com/users/gsquire/orgs", "repos_url": "https://api.github.com/users/gsquire/repos", "events_url": "https://api.github.com/users/gsquire/events{/privacy}", "received_events_url": "https://api.github.com/users/gsquire/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gsquire", "id": 2665334, "node_id": "MDQ6VXNlcjI2NjUzMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2665334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gsquire", "html_url": "https://github.com/gsquire", "followers_url": "https://api.github.com/users/gsquire/followers", "following_url": "https://api.github.com/users/gsquire/following{/other_user}", "gists_url": "https://api.github.com/users/gsquire/gists{/gist_id}", "starred_url": "https://api.github.com/users/gsquire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gsquire/subscriptions", "organizations_url": "https://api.github.com/users/gsquire/orgs", "repos_url": "https://api.github.com/users/gsquire/repos", "events_url": "https://api.github.com/users/gsquire/events{/privacy}", "received_events_url": "https://api.github.com/users/gsquire/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3157691f963a86776cb7e6a7842f566032890aba", "url": "https://api.github.com/repos/rust-lang/rust/commits/3157691f963a86776cb7e6a7842f566032890aba", "html_url": "https://github.com/rust-lang/rust/commit/3157691f963a86776cb7e6a7842f566032890aba"}], "stats": {"total": 78, "additions": 51, "deletions": 27}, "files": [{"sha": "b4c2e21651edb95498d10bc3c5f378eb1f53814c", "filename": "src/rustc/Cargo.lock", "status": "modified", "additions": 6, "deletions": 27, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Frustc%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Frustc%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2FCargo.lock?ref=b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "patch": "@@ -7,15 +7,6 @@ dependencies = [\n  \"rustdoc 0.0.0\",\n ]\n \n-[[package]]\n-name = \"advapi32-sys\"\n-version = \"0.1.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"winapi 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"winapi-build 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n-\n [[package]]\n name = \"arena\"\n version = \"0.0.0\"\n@@ -29,7 +20,7 @@ name = \"flate\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -38,12 +29,8 @@ version = \"0.0.0\"\n \n [[package]]\n name = \"gcc\"\n-version = \"0.3.17\"\n+version = \"0.3.28\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-dependencies = [\n- \"advapi32-sys 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"winapi 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n-]\n \n [[package]]\n name = \"graphviz\"\n@@ -192,7 +179,7 @@ name = \"rustc_llvm\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_bitflags 0.0.0\",\n ]\n \n@@ -233,6 +220,7 @@ dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n  \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n \n@@ -278,6 +266,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n+ \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n \n@@ -323,7 +312,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"arena 0.0.0\",\n  \"build_helper 0.1.0\",\n- \"gcc 0.3.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"gcc 0.3.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n@@ -362,13 +351,3 @@ dependencies = [\n  \"syntax 0.0.0\",\n ]\n \n-[[package]]\n-name = \"winapi\"\n-version = \"0.2.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-\n-[[package]]\n-name = \"winapi-build\"\n-version = \"0.1.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-"}, {"sha": "4324db489b7f8b442eab8e72194f3de77b0b6ddf", "filename": "src/tools/tidy/src/cargo_lock.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fcargo_lock.rs?ref=b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "patch": "@@ -0,0 +1,43 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::path::Path;\n+\n+const CARGO_LOCK: &'static str = \"Cargo.lock\";\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    use std::process::Command;\n+\n+    super::walk(path,\n+                &mut |path| super::filter_dirs(path) || path.ends_with(\"src/test\"),\n+                &mut |file| {\n+        let name = file.file_name().unwrap().to_string_lossy();\n+        if name == CARGO_LOCK {\n+            let rel_path = file.strip_prefix(path).unwrap();\n+            let ret_code = Command::new(\"git\")\n+                                        .arg(\"diff-index\")\n+                                        .arg(\"--quiet\")\n+                                        .arg(\"HEAD\")\n+                                        .arg(rel_path)\n+                                        .current_dir(path)\n+                                        .status()\n+                                        .unwrap_or_else(|e| {\n+                                            panic!(\"could not run git diff-index: {}\", e);\n+                                        });\n+            if !ret_code.success() {\n+                let parent_path = file.parent().unwrap().join(\"Cargo.toml\");\n+                print!(\"dirty lock file found at {} \", rel_path.display());\n+                println!(\"please commit your changes or update the lock file by running:\");\n+                println!(\"\\n\\tcargo update --manifest-path {}\", parent_path.display());\n+                *bad = true;\n+            }\n+        }\n+    });\n+}"}, {"sha": "2839bbded1a5f0cb8d171a70ba13cf3b7efadbee", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3de04214646a33fa5a14fbb2e8ba55e7ee5a707/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=b3de04214646a33fa5a14fbb2e8ba55e7ee5a707", "patch": "@@ -35,6 +35,7 @@ mod style;\n mod errors;\n mod features;\n mod cargo;\n+mod cargo_lock;\n \n fn main() {\n     let path = env::args_os().skip(1).next().expect(\"need an argument\");\n@@ -46,6 +47,7 @@ fn main() {\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n     features::check(&path, &mut bad);\n+    cargo_lock::check(&path, &mut bad);\n \n     if bad {\n         panic!(\"some tidy checks failed\");"}]}