{"sha": "37b3a60b78be10f01aa57d2096d96f5ab9f07656", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3YjNhNjBiNzhiZTEwZjAxYWE1N2QyMDk2ZDk2ZjVhYjlmMDc2NTY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-03-06T05:17:15Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-03-06T08:25:19Z"}, "message": "travis: Use LLVM 3.4 instead of LLVM 3.3\n\nThis version is slightly more up to date and is closer to the 3.5 that we're\nusing. This also updates the travis config to have a build matrix which tests\nrust against LLVM 3.3 and 3.4. For pull requests only LLVM 3.4 is tested to\nreduce the load on travis.\n\nThis is mostly just fluff, there's no real reason to gate rust on these results,\nit's more of just a nice thing to know when we break compatibility with LLVM 3.3\nand 3.4 (and eventually 3.5). This turns off notifications of failed commits\n(which are sent out for pushes to master).", "tree": {"sha": "cc656de711c5112d2a2b860f8f7c9c4e821368db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc656de711c5112d2a2b860f8f7c9c4e821368db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37b3a60b78be10f01aa57d2096d96f5ab9f07656", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37b3a60b78be10f01aa57d2096d96f5ab9f07656", "html_url": "https://github.com/rust-lang/rust/commit/37b3a60b78be10f01aa57d2096d96f5ab9f07656", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37b3a60b78be10f01aa57d2096d96f5ab9f07656/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67c5d793add67878e6e472258748ac13e0f90366", "url": "https://api.github.com/repos/rust-lang/rust/commits/67c5d793add67878e6e472258748ac13e0f90366", "html_url": "https://github.com/rust-lang/rust/commit/67c5d793add67878e6e472258748ac13e0f90366"}], "stats": {"total": 41, "additions": 31, "deletions": 10}, "files": [{"sha": "6e2ebdfa1b26c7ef22a812d28d16f81278f6787b", "filename": ".travis.yml", "status": "modified", "additions": 31, "deletions": 10, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/37b3a60b78be10f01aa57d2096d96f5ab9f07656/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/37b3a60b78be10f01aa57d2096d96f5ab9f07656/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=37b3a60b78be10f01aa57d2096d96f5ab9f07656", "patch": "@@ -5,21 +5,28 @@ language: c\n \n # Before we start doing anything, install a stock LLVM\n install:\n-  - sudo apt-get install llvm-3.3 llvm-3.3-dev clang-3.3 lldb-3.3\n+  - sudo sh -c \"echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.4 main' >> /etc/apt/sources.list\"\n+  - sudo sh -c \"echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' >> /etc/apt/sources.list\"\n+  - sudo sh -c \"echo 'deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu precise main' >> /etc/apt/sources.list\"\n+  - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -\n+  - sudo apt-get update -qq\n+  - sudo apt-get install -qq --force-yes -y llvm-$LLVM_VERSION\n+    llvm-${LLVM_VERSION}-dev clang-$LLVM_VERSION lldb-$LLVM_VERSION\n \n-# All of the llvm tools are suffixed with \"-3.3\" which we don't want, so symlink\n-# them all into a local directory and just use that\n+\n+# All of the llvm tools are suffixed with \"-$VERS\" which we don't want, so\n+# symlink them all into a local directory and just use that\n #\n # FIXME: this shouldn't update the src/llvm sub-repo, that takes about a minute\n #        it's gotta download so much stuff.\n before_script:\n   - mkdir -p local-llvm/bin\n-  - ln -nsf /usr/bin/llvm-config-3.3 local-llvm/bin/llvm-config\n-  - ln -nsf /usr/bin/llvm-mc-3.3 local-llvm/bin/llvm-mc\n-  - ln -nsf /usr/bin/llvm-as-3.3 local-llvm/bin/llvm-as\n-  - ln -nsf /usr/bin/llvm-dis-3.3 local-llvm/bin/llvm-dis\n-  - ln -nsf /usr/bin/llc-3.3 local-llvm/bin/llc\n-  - ln -nsf /usr/include/llvm-3.3 local-llvm/include\n+  - ln -nsf /usr/bin/llvm-config-$LLVM_VERSION local-llvm/bin/llvm-config\n+  - ln -nsf /usr/bin/llvm-mc-$LLVM_VERSION local-llvm/bin/llvm-mc\n+  - ln -nsf /usr/bin/llvm-as-$LLVM_VERSION local-llvm/bin/llvm-as\n+  - ln -nsf /usr/bin/llvm-dis-$LLVM_VERSION local-llvm/bin/llvm-dis\n+  - ln -nsf /usr/bin/llc-$LLVM_VERSION local-llvm/bin/llc\n+  - ln -nsf /usr/include/llvm-$LLVM_VERSION local-llvm/include\n   - ./configure --disable-optimize-tests --llvm-root=`pwd`/local-llvm --enable-fast-make --enable-clang\n \n # Tidy everything up first, then build a few things, and then run a few tests.\n@@ -29,14 +36,28 @@ before_script:\n # As a result of https://github.com/travis-ci/travis-ci/issues/1066, we run\n # everything in one large command instead of multiple commands.\n script: |\n+  if [[ $TRAVIS_PULL_REQUEST != 'false' ]]; then\n+    if [[ $LLVM_VERSION != '3.4' ]]; then exit 0; fi\n+  fi &&\n   make tidy &&\n   make -j4 rustc-stage1 &&\n   make check-stage1-std check-stage1-rpass check-stage1-cfail check-stage1-rfail\n \n env:\n-  - NO_BENCH=1\n+  global:\n+    - NO_BENCH=1\n+  matrix:\n+    - LLVM_VERSION=3.3\n+    - LLVM_VERSION=3.4\n \n # We track this ourselves, and in theory we don't have to update the LLVM repo\n # (but sadly we do right now anyway).\n git:\n   submodules: false\n+\n+notifications:\n+  email: false\n+\n+branches:\n+  only:\n+    - master"}]}