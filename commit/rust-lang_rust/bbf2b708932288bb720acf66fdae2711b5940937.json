{"sha": "bbf2b708932288bb720acf66fdae2711b5940937", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiZjJiNzA4OTMyMjg4YmI3MjBhY2Y2NmZkYWUyNzExYjU5NDA5Mzc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-13T17:17:33Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-13T17:17:33Z"}, "message": "rustbuild: Skip some more non-relevant dist steps\n\nThis commit skips a few more dist tragets during compilation which shouldn't be\nnecessary.\n\n* First, when packaging std we only take action when the host target is the\n  build target. Otherwise we package the same artifacts a number of times, which\n  shouldn't be necessary.\n* Next, we apply the same logic to the save-analysis build. This is actually\n  required for correctness as the build compiler is the only one which actually\n  has save analysis information. This should fix an error seen on nightlies.", "tree": {"sha": "a6da72bc7a1b35d71538ad4c54d3040736ad70b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6da72bc7a1b35d71538ad4c54d3040736ad70b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bbf2b708932288bb720acf66fdae2711b5940937", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bbf2b708932288bb720acf66fdae2711b5940937", "html_url": "https://github.com/rust-lang/rust/commit/bbf2b708932288bb720acf66fdae2711b5940937", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bbf2b708932288bb720acf66fdae2711b5940937/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1f5001998ad43ee6ce5a933be737ed63317916f", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1f5001998ad43ee6ce5a933be737ed63317916f", "html_url": "https://github.com/rust-lang/rust/commit/a1f5001998ad43ee6ce5a933be737ed63317916f"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "245859b78d02917cd35ce4d52e20b86365e0bc67", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/bbf2b708932288bb720acf66fdae2711b5940937/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbf2b708932288bb720acf66fdae2711b5940937/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=bbf2b708932288bb720acf66fdae2711b5940937", "patch": "@@ -260,6 +260,14 @@ pub fn debugger_scripts(build: &Build,\n pub fn std(build: &Build, compiler: &Compiler, target: &str) {\n     println!(\"Dist std stage{} ({} -> {})\", compiler.stage, compiler.host,\n              target);\n+\n+    // The only true set of target libraries came from the build triple, so\n+    // let's reduce redundant work by only producing archives from that host.\n+    if compiler.host != build.config.build {\n+        println!(\"\\tskipping, not a build host\");\n+        return\n+    }\n+\n     let name = format!(\"rust-std-{}\", package_vers(build));\n     let image = tmpdir(build).join(format!(\"{}-{}-image\", name, target));\n     let _ = fs::remove_dir_all(&image);\n@@ -294,10 +302,15 @@ pub fn analysis(build: &Build, compiler: &Compiler, target: &str) {\n     println!(\"Dist analysis\");\n \n     if build.config.channel != \"nightly\" {\n-        println!(\"Skipping dist-analysis - not on nightly channel\");\n+        println!(\"\\tskipping - not on nightly channel\");\n         return;\n     }\n+    if compiler.host != build.config.build {\n+        println!(\"\\tskipping - not a build host\");\n+        return\n+    }\n     if compiler.stage != 2 {\n+        println!(\"\\tskipping - not stage2\");\n         return\n     }\n "}]}