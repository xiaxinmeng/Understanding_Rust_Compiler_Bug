{"sha": "eb9dfb8bd9444d01fc129bfaac180b913299486b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViOWRmYjhiZDk0NDRkMDFmYzEyOWJmYWFjMTgwYjkxMzI5OTQ4NmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-10T15:39:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-10T15:39:47Z"}, "message": "Auto merge of #43109 - pnkfelix:fix-link_args-gate, r=nikomatsakis\n\nFix feature gate for `#[link_args(..)]` attribute\n\nFix feature gate for `#[link_args(..)]` attribute so that it will fire regardless of context of attribute.\n\nSee also #29596 and #43106", "tree": {"sha": "3e320dced01e40a8061215b19cd8eb4de0445196", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e320dced01e40a8061215b19cd8eb4de0445196"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb9dfb8bd9444d01fc129bfaac180b913299486b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb9dfb8bd9444d01fc129bfaac180b913299486b", "html_url": "https://github.com/rust-lang/rust/commit/eb9dfb8bd9444d01fc129bfaac180b913299486b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb9dfb8bd9444d01fc129bfaac180b913299486b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d84693b93dae3958e3504f817face0184c5c3fdd", "url": "https://api.github.com/repos/rust-lang/rust/commits/d84693b93dae3958e3504f817face0184c5c3fdd", "html_url": "https://github.com/rust-lang/rust/commit/d84693b93dae3958e3504f817face0184c5c3fdd"}, {"sha": "c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "html_url": "https://github.com/rust-lang/rust/commit/c512dea1ed4d97792c831eb2d8ec4725e32ac14d"}], "stats": {"total": 31, "additions": 20, "deletions": 11}, "files": [{"sha": "448f95c93a0871c719a09d1c51981b17efd7c576", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/eb9dfb8bd9444d01fc129bfaac180b913299486b/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb9dfb8bd9444d01fc129bfaac180b913299486b/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=eb9dfb8bd9444d01fc129bfaac180b913299486b", "patch": "@@ -551,7 +551,12 @@ pub const BUILTIN_ATTRIBUTES: &'static [(&'static str, AttributeType, AttributeG\n     (\"ignore\", Normal, Ungated),\n     (\"no_implicit_prelude\", Normal, Ungated),\n     (\"reexport_test_harness_main\", Normal, Ungated),\n-    (\"link_args\", Normal, Ungated),\n+    (\"link_args\", Normal, Gated(Stability::Unstable,\n+                                \"link_args\",\n+                                \"the `link_args` attribute is experimental and not \\\n+                                 portable across platforms, it is recommended to \\\n+                                 use `#[link(name = \\\"foo\\\")] instead\",\n+                                cfg_fn!(link_args))),\n     (\"macro_escape\", Normal, Ungated),\n \n     // RFC #1445.\n@@ -1184,12 +1189,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n             }\n \n             ast::ItemKind::ForeignMod(ref foreign_module) => {\n-                if attr::contains_name(&i.attrs[..], \"link_args\") {\n-                    gate_feature_post!(&self, link_args, i.span,\n-                                      \"the `link_args` attribute is not portable \\\n-                                       across platforms, it is recommended to \\\n-                                       use `#[link(name = \\\"foo\\\")]` instead\")\n-                }\n                 self.check_abi(foreign_module.abi, i.span);\n             }\n "}, {"sha": "82f5db3042b77caef7416669c91d5c24c6ece1c5", "filename": "src/test/compile-fail/gated-link-args.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/eb9dfb8bd9444d01fc129bfaac180b913299486b/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb9dfb8bd9444d01fc129bfaac180b913299486b/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs?ref=eb9dfb8bd9444d01fc129bfaac180b913299486b", "patch": "@@ -9,12 +9,22 @@\n // except according to those terms.\n \n // Test that `#[link_args]` attribute is gated by `link_args`\n-// feature gate.\n+// feature gate, both when it occurs where expected (atop\n+// `extern { }` blocks) and where unexpected.\n \n // gate-test-link_args\n \n-#[link_args = \"aFdEfSeVEEE\"]\n+// sidestep warning (which is correct, but misleading for\n+// purposes of this test)\n+#![allow(unused_attributes)]\n+\n+#![link_args = \"-l unexpected_use_as_inner_attr_on_mod\"]\n+//~^ ERROR the `link_args` attribute is experimental\n+\n+#[link_args = \"-l expected_use_case\"]\n+//~^ ERROR the `link_args` attribute is experimental\n extern {}\n-//~^ ERROR the `link_args` attribute is not portable across platforms\n \n-fn main() { }\n+#[link_args = \"-l unexected_use_on_non_extern_item\"]\n+//~^ ERROR: the `link_args` attribute is experimental\n+fn main() {}"}]}