{"sha": "462f06de07d8a5c071c4d8040dad006198f029c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2MmYwNmRlMDdkOGE1YzA3MWM0ZDgwNDBkYWQwMDYxOThmMDI5Yzk=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2019-12-04T01:32:50Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2019-12-04T02:51:16Z"}, "message": "Emit coercion suggestions in more places\n\nFixes #66910\n\nWe have several different kinds of suggestions we can try to make when\ntype coercion fails. However, we were previously only emitting these\nsuggestions from `demand_coerce_diag`. This resulted in the compiler\nfailing to emit applicable suggestions in several different cases, such\nas when the implicit return value of a function had the wrong type.\n\nThis commit adds a new `emit_coerce_suggestions` method, which tries to\nemit a number of related suggestions. This method is called from both\n`demand_coerce_diag` and `CoerceMany::coerce_inner`, which covers a much\nwider range of cases than before.\n\nWe now suggest using `.await` in more cases where it is applicable,\namong other improvements.", "tree": {"sha": "8996c1eb65519a9f8179a21ba7a8cc12ddae7787", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8996c1eb65519a9f8179a21ba7a8cc12ddae7787"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/462f06de07d8a5c071c4d8040dad006198f029c9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl3nIGAACgkQtAh+UQ6Y\nsWTAERAAg/6OCtzPyG3HKiVDWbiw+p5ECqQ59rH0d6nzK5gpvzyL2r+vNQVbK/5p\n0rDcESXF9OqCaaxkoFphmqSb0bFCFpXlVVgu1CLADPw5xBpCVIHNPfEKywSFJI+g\nrn5wyUtWP/kKnV9Zp2sf+obUlyDZpQN/qjW6tJVaAgpjXN6UDOXy4B7unZkW1W3O\n1H3eGX5gph8SP4UD0LvpJRuj8c87SEuNm8GVvGnifU+xwCY3YeSZVnb4jTI77S5x\ndDv+ssYvPIdbMGCPlhmnqv5HOUZMwNmFhJts1QI0jij1/lA1yDZlWI8ywA1PnLnN\n0+rqX5Q47rNo0fq5Qx/G7zHkOJmyEAlHrWtXq2hHQ7tdTS+cvRRwHDMwrSQ/rxQ4\nlysufB4lYcPF8CV9qC/Z96rVV1ESuX/tIVBVQ68xIjtIfYIZr3AZbbQj7gbwverG\n5OVit+qGT2ppeXn3zs+atX/fYdPmYBCnyXsyind2/zjqMqrNUO4SCf7PrAaUIuqM\nRWKZQfc9WD6wKBUMAvobdoL861y9zJgzIrAfljwcYvs/qR2uztsCAXpL0OKxMd9E\neo9qkhB6hJeUTRNie380Y+HhYe2FoPoIny2tXpCTjcINFVGy/Rr0yKVNn3pbHHum\nWfnUIYvLj35+Pk94TeervBypimApWSSIzkis1E8aFmlAbMN0LjQ=\n=+Ew5\n-----END PGP SIGNATURE-----", "payload": "tree 8996c1eb65519a9f8179a21ba7a8cc12ddae7787\nparent 7afe6d9d1f48b998cc88fe6f01ba0082788ba4b9\nauthor Aaron Hill <aa1ronham@gmail.com> 1575423170 -0500\ncommitter Aaron Hill <aa1ronham@gmail.com> 1575427876 -0500\n\nEmit coercion suggestions in more places\n\nFixes #66910\n\nWe have several different kinds of suggestions we can try to make when\ntype coercion fails. However, we were previously only emitting these\nsuggestions from `demand_coerce_diag`. This resulted in the compiler\nfailing to emit applicable suggestions in several different cases, such\nas when the implicit return value of a function had the wrong type.\n\nThis commit adds a new `emit_coerce_suggestions` method, which tries to\nemit a number of related suggestions. This method is called from both\n`demand_coerce_diag` and `CoerceMany::coerce_inner`, which covers a much\nwider range of cases than before.\n\nWe now suggest using `.await` in more cases where it is applicable,\namong other improvements.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/462f06de07d8a5c071c4d8040dad006198f029c9", "html_url": "https://github.com/rust-lang/rust/commit/462f06de07d8a5c071c4d8040dad006198f029c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/462f06de07d8a5c071c4d8040dad006198f029c9/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7afe6d9d1f48b998cc88fe6f01ba0082788ba4b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/7afe6d9d1f48b998cc88fe6f01ba0082788ba4b9", "html_url": "https://github.com/rust-lang/rust/commit/7afe6d9d1f48b998cc88fe6f01ba0082788ba4b9"}], "stats": {"total": 131, "additions": 112, "deletions": 19}, "files": [{"sha": "253fc5575c5bc1639f3010d82a2e078755c6978c", "filename": "src/librustc_typeck/check/coercion.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -1284,6 +1284,10 @@ impl<'tcx, 'exprs, E: AsCoercionSite> CoerceMany<'tcx, 'exprs, E> {\n                     augment_error(&mut err);\n                 }\n \n+                if let Some(expr) = expression {\n+                    fcx.emit_coerce_suggestions(&mut err, expr, found, expected);\n+                }\n+\n                 // Error possibly reported in `check_assign` so avoid emitting error again.\n                 err.emit_unless(expression.filter(|e| fcx.is_assign_to_bool(e, expected))\n                     .is_some());"}, {"sha": "afdc3b220d0b978b314cbdf9d7dbcd1ab28d1065", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -15,6 +15,22 @@ use errors::{Applicability, DiagnosticBuilder};\n use super::method::probe;\n \n impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n+\n+    pub fn emit_coerce_suggestions(\n+        &self,\n+        err: &mut DiagnosticBuilder<'_>,\n+        expr: &hir::Expr,\n+        expr_ty: Ty<'tcx>,\n+        expected: Ty<'tcx>\n+    ) {\n+        self.annotate_expected_due_to_let_ty(err, expr);\n+        self.suggest_compatible_variants(err, expr, expected, expr_ty);\n+        self.suggest_ref_or_into(err, expr, expected, expr_ty);\n+        self.suggest_boxing_when_appropriate(err, expr, expected, expr_ty);\n+        self.suggest_missing_await(err, expr, expected, expr_ty);\n+    }\n+\n+\n     // Requires that the two types unify, and prints an error message if\n     // they don't.\n     pub fn demand_suptype(&self, sp: Span, expected: Ty<'tcx>, actual: Ty<'tcx>) {\n@@ -127,11 +143,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             return (expected, None)\n         }\n \n-        self.annotate_expected_due_to_let_ty(&mut err, expr);\n-        self.suggest_compatible_variants(&mut err, expr, expected, expr_ty);\n-        self.suggest_ref_or_into(&mut err, expr, expected, expr_ty);\n-        self.suggest_boxing_when_appropriate(&mut err, expr, expected, expr_ty);\n-        self.suggest_missing_await(&mut err, expr, expected, expr_ty);\n+        self.emit_coerce_suggestions(&mut err, expr, expr_ty, expected);\n \n         (expected, Some(err))\n     }"}, {"sha": "a956aba4f62b9896ff13b0f56e35b1b31eafa326", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -4584,8 +4584,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             pointing_at_return_type = self.suggest_missing_return_type(\n                 err, &fn_decl, expected, found, can_suggest);\n         }\n-        self.suggest_ref_or_into(err, expr, expected, found);\n-        self.suggest_boxing_when_appropriate(err, expr, expected, found);\n         pointing_at_return_type\n     }\n \n@@ -4957,15 +4955,21 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                     ty: expected,\n                 }));\n                 let obligation = traits::Obligation::new(self.misc(sp), self.param_env, predicate);\n+                debug!(\"suggest_missing_await: trying obligation {:?}\", obligation);\n                 if self.infcx.predicate_may_hold(&obligation) {\n+                    debug!(\"suggest_missing_await: obligation held: {:?}\", obligation);\n                     if let Ok(code) = self.sess().source_map().span_to_snippet(sp) {\n                         err.span_suggestion(\n                             sp,\n                             \"consider using `.await` here\",\n                             format!(\"{}.await\", code),\n                             Applicability::MaybeIncorrect,\n                         );\n+                    } else {\n+                        debug!(\"suggest_missing_await: no snippet for {:?}\", sp);\n                     }\n+                } else {\n+                    debug!(\"suggest_missing_await: obligation did not hold: {:?}\", obligation)\n                 }\n             }\n         }"}, {"sha": "1ec59d906206eada93ce9282dfd81e12afef9517", "filename": "src/test/ui/async-await/suggest-missing-await.fixed", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.fixed?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -16,4 +16,15 @@ async fn suggest_await_in_async_fn() {\n     //~| SUGGESTION x.await\n }\n \n+async fn dummy() {}\n+\n+#[allow(unused)]\n+async fn suggest_await_in_async_fn_return() {\n+    dummy().await;\n+    //~^ ERROR mismatched types [E0308]\n+    //~| HELP try adding a semicolon\n+    //~| HELP consider using `.await` here\n+    //~| SUGGESTION dummy().await\n+}\n+\n fn main() {}"}, {"sha": "70cc1f1d5a2c6078da0f8c4014b9a2e1eec4bd70", "filename": "src/test/ui/async-await/suggest-missing-await.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.rs", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.rs?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -16,4 +16,15 @@ async fn suggest_await_in_async_fn() {\n     //~| SUGGESTION x.await\n }\n \n+async fn dummy() {}\n+\n+#[allow(unused)]\n+async fn suggest_await_in_async_fn_return() {\n+    dummy()\n+    //~^ ERROR mismatched types [E0308]\n+    //~| HELP try adding a semicolon\n+    //~| HELP consider using `.await` here\n+    //~| SUGGESTION dummy().await\n+}\n+\n fn main() {}"}, {"sha": "7ab024434b2bf86250d4c2db32263b20e8259be3", "filename": "src/test/ui/async-await/suggest-missing-await.stderr", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fsuggest-missing-await.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -10,6 +10,23 @@ LL |     take_u32(x)\n    = note:     expected type `u32`\n            found opaque type `impl std::future::Future`\n \n-error: aborting due to previous error\n+error[E0308]: mismatched types\n+  --> $DIR/suggest-missing-await.rs:23:5\n+   |\n+LL |     dummy()\n+   |     ^^^^^^^ expected `()`, found opaque type\n+   |\n+   = note: expected unit type `()`\n+            found opaque type `impl std::future::Future`\n+help: try adding a semicolon\n+   |\n+LL |     dummy();\n+   |            ^\n+help: consider using `.await` here\n+   |\n+LL |     dummy().await\n+   |\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0308`."}, {"sha": "ca61fb0c171febdbd67445dac6811c3d94f2e7c1", "filename": "src/test/ui/fully-qualified-type/fully-qualified-type-name4.stderr", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Ffully-qualified-type%2Ffully-qualified-type-name4.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Ffully-qualified-type%2Ffully-qualified-type-name4.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffully-qualified-type%2Ffully-qualified-type-name4.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -4,7 +4,10 @@ error[E0308]: mismatched types\n LL | fn bar(x: usize) -> Option<usize> {\n    |                     ------------- expected `std::option::Option<usize>` because of return type\n LL |     return x;\n-   |            ^ expected enum `std::option::Option`, found `usize`\n+   |            ^\n+   |            |\n+   |            expected enum `std::option::Option`, found `usize`\n+   |            help: try using a variant of the expected enum: `Some(x)`\n    |\n    = note: expected enum `std::option::Option<usize>`\n               found type `usize`"}, {"sha": "9ca983df30af51392b22145e8f56abc28e9c550e", "filename": "src/test/ui/issues/issue-51632-try-desugar-incompatible-types.stderr", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fissues%2Fissue-51632-try-desugar-incompatible-types.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fissues%2Fissue-51632-try-desugar-incompatible-types.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-51632-try-desugar-incompatible-types.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -2,13 +2,18 @@ error[E0308]: try expression alternatives have incompatible types\n   --> $DIR/issue-51632-try-desugar-incompatible-types.rs:8:5\n    |\n LL |     missing_discourses()?\n-   |     ^^^^^^^^^^^^^^^^^^^^-\n-   |     |                   |\n-   |     |                   help: try removing this `?`\n-   |     expected enum `std::result::Result`, found `isize`\n+   |     ^^^^^^^^^^^^^^^^^^^^^ expected enum `std::result::Result`, found `isize`\n    |\n    = note: expected enum `std::result::Result<isize, ()>`\n               found type `isize`\n+help: try removing this `?`\n+   |\n+LL |     missing_discourses()\n+   |                        --\n+help: try using a variant of the expected enum\n+   |\n+LL |     Ok(missing_discourses()?)\n+   |\n \n error: aborting due to previous error\n "}, {"sha": "9066e57aabfe5eefafb8d89b2261c8921805bc70", "filename": "src/test/ui/issues/issue-59756.stderr", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fissues%2Fissue-59756.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fissues%2Fissue-59756.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-59756.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -2,13 +2,18 @@ error[E0308]: try expression alternatives have incompatible types\n   --> $DIR/issue-59756.rs:13:5\n    |\n LL |     foo()?\n-   |     ^^^^^-\n-   |     |    |\n-   |     |    help: try removing this `?`\n-   |     expected enum `std::result::Result`, found struct `A`\n+   |     ^^^^^^ expected enum `std::result::Result`, found struct `A`\n    |\n    = note: expected enum `std::result::Result<A, B>`\n             found struct `A`\n+help: try removing this `?`\n+   |\n+LL |     foo()\n+   |         --\n+help: try using a variant of the expected enum\n+   |\n+LL |     Ok(foo()?)\n+   |\n \n error: aborting due to previous error\n "}, {"sha": "c73130643db7b18c06d1a215878db53ed361ae80", "filename": "src/test/ui/mismatched_types/abridged.stderr", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fmismatched_types%2Fabridged.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fmismatched_types%2Fabridged.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fabridged.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -26,7 +26,10 @@ error[E0308]: mismatched types\n LL | fn b() -> Option<Foo> {\n    |           ----------- expected `std::option::Option<Foo>` because of return type\n LL |     Foo { bar: 1 }\n-   |     ^^^^^^^^^^^^^^ expected enum `std::option::Option`, found struct `Foo`\n+   |     ^^^^^^^^^^^^^^\n+   |     |\n+   |     expected enum `std::option::Option`, found struct `Foo`\n+   |     help: try using a variant of the expected enum: `Some(Foo { bar: 1 })`\n    |\n    = note: expected enum `std::option::Option<Foo>`\n             found struct `Foo`\n@@ -37,7 +40,10 @@ error[E0308]: mismatched types\n LL | fn c() -> Result<Foo, Bar> {\n    |           ---------------- expected `std::result::Result<Foo, Bar>` because of return type\n LL |     Foo { bar: 1 }\n-   |     ^^^^^^^^^^^^^^ expected enum `std::result::Result`, found struct `Foo`\n+   |     ^^^^^^^^^^^^^^\n+   |     |\n+   |     expected enum `std::result::Result`, found struct `Foo`\n+   |     help: try using a variant of the expected enum: `Ok(Foo { bar: 1 })`\n    |\n    = note: expected enum `std::result::Result<Foo, Bar>`\n             found struct `Foo`"}, {"sha": "a77e92022e2b676a4eab4dba9b85bf345174760b", "filename": "src/test/ui/proc-macro/span-preservation.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fproc-macro%2Fspan-preservation.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fproc-macro%2Fspan-preservation.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fspan-preservation.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -14,6 +14,11 @@ LL | fn b(x: Option<isize>) -> usize {\n LL |     match x {\n LL |         Some(x) => { return x },\n    |                             ^ expected `usize`, found `isize`\n+   |\n+help: you can convert an `isize` to `usize` and panic if the converted value wouldn't fit\n+   |\n+LL |         Some(x) => { return x.try_into().unwrap() },\n+   |                             ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0308]: mismatched types\n   --> $DIR/span-preservation.rs:33:22"}, {"sha": "69f8ffa581bc128c0dcabbdd9aa6113d38d97bde", "filename": "src/test/ui/tail-typeck.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Ftail-typeck.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Ftail-typeck.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftail-typeck.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -5,6 +5,11 @@ LL | fn f() -> isize { return g(); }\n    |           -----          ^^^ expected `isize`, found `usize`\n    |           |\n    |           expected `isize` because of return type\n+   |\n+help: you can convert an `usize` to `isize` and panic if the converted value wouldn't fit\n+   |\n+LL | fn f() -> isize { return g().try_into().unwrap(); }\n+   |                          ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: aborting due to previous error\n "}, {"sha": "c1274bd0ea6bc3226bdb8a7ca79e3780ad46ebac", "filename": "src/test/ui/wrong-ret-type.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fwrong-ret-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/462f06de07d8a5c071c4d8040dad006198f029c9/src%2Ftest%2Fui%2Fwrong-ret-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwrong-ret-type.stderr?ref=462f06de07d8a5c071c4d8040dad006198f029c9", "patch": "@@ -5,6 +5,11 @@ LL | fn mk_int() -> usize { let i: isize = 3; return i; }\n    |                -----                            ^ expected `usize`, found `isize`\n    |                |\n    |                expected `usize` because of return type\n+   |\n+help: you can convert an `isize` to `usize` and panic if the converted value wouldn't fit\n+   |\n+LL | fn mk_int() -> usize { let i: isize = 3; return i.try_into().unwrap(); }\n+   |                                                 ^^^^^^^^^^^^^^^^^^^^^\n \n error: aborting due to previous error\n "}]}