{"sha": "399e5cc8db64f06c2d2d57894fc066d289e3eeae", "node_id": "C_kwDOAAsO6NoAKDM5OWU1Y2M4ZGI2NGYwNmMyZDJkNTc4OTRmYzA2NmQyODllM2VlYWU", "commit": {"author": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2022-09-27T08:11:43Z"}, "committer": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2022-10-18T07:38:02Z"}, "message": "partially fix src/test/run-make/coverage-reports when cross-compiling\n\nThe test does not work on cross-compiled targets because the --target\nflag was not passed to rustc inside the test. This commit fixes that by\nadding the flag to the invocations.\n\nNote that the test still fails on cross-compiled targets using\nremote-test, as remote-test is not capable (yet) of sending back to the\nhost system the *.profraw file generated by the instrumentation.\n\nBecause of that, this is only a partial fix, and the test has been\nignored on cross-compilation.", "tree": {"sha": "2645bc7a7e8c42731f5ca280c69aaa146332807a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2645bc7a7e8c42731f5ca280c69aaa146332807a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/399e5cc8db64f06c2d2d57894fc066d289e3eeae", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMycKYjxLY0eb13b7zXazX3c0dp4FAmNOV9wACgkQzXazX3c0\ndp51lRAAjt2oKAX6qyWEnXxrPBtIaGA3dhwUPJdNBYlJGI9ayKFOkTwqrY18w3eg\nrXIN4E5hPJXEd4T2V2TqzmiZacNSWfPX0v+JyIOph45Uv+AcwSFqRpvG50XZX9Y2\nvZPZuIJxLxnjMqE2dN3SHuxb4QJT7sH+kFVLBgHbR7pNCmkYnd6idOxl5SmgzySV\n80wqmV0BQ3PaiQp/Wje59KknOgpQSfGPCVEfI7SA14G6+camNhtBy2UiUCAVedmE\nQ6ok6yx/+OurHWgiXcz3ZtLDCQRoqzgDKsYApED89EhQ8W427AiwLn7NkHxtaK+N\ny0GHcgiXiUlnP9A+KCGbMoIwxI7f5HsdaU7PEFDPskNzmuz6JuTUWIEFYjp1yKIg\nqz1UYowru3RySc7PFRlYHhbONuDRz3/2GDwPlulJl6yVLGNjuUN5omu9htksriO1\n1afGvrKe6QSEAS6JZ9pcq1v1VCufXJ2J0KjRIoDOjwTsTc+s9fOf6fahPvRPdm+/\nyFuHvBJ4ACEFex0iDcAd9glME2MSjCjvRUZNPXHl/nz93wTp18KTK6vxnbSOcxwL\nbddVEo13H7w8Kn+QWncfapPmxEO1nlrXKCP23KcgtxRWUgHB4Q4pv4HcsuGsaTnl\nPXBIVzPwcJWHz3NC2hseghxcsFIpy+HTlP6cjYxKs0+7u8p37wM=\n=50ql\n-----END PGP SIGNATURE-----", "payload": "tree 2645bc7a7e8c42731f5ca280c69aaa146332807a\nparent dd8c3a80dd2e5a0b62c3ef77511f3296070f78e2\nauthor Pietro Albini <pietro.albini@ferrous-systems.com> 1664266303 +0200\ncommitter Pietro Albini <pietro.albini@ferrous-systems.com> 1666078682 +0200\n\npartially fix src/test/run-make/coverage-reports when cross-compiling\n\nThe test does not work on cross-compiled targets because the --target\nflag was not passed to rustc inside the test. This commit fixes that by\nadding the flag to the invocations.\n\nNote that the test still fails on cross-compiled targets using\nremote-test, as remote-test is not capable (yet) of sending back to the\nhost system the *.profraw file generated by the instrumentation.\n\nBecause of that, this is only a partial fix, and the test has been\nignored on cross-compilation.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/399e5cc8db64f06c2d2d57894fc066d289e3eeae", "html_url": "https://github.com/rust-lang/rust/commit/399e5cc8db64f06c2d2d57894fc066d289e3eeae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/399e5cc8db64f06c2d2d57894fc066d289e3eeae/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd8c3a80dd2e5a0b62c3ef77511f3296070f78e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd8c3a80dd2e5a0b62c3ef77511f3296070f78e2", "html_url": "https://github.com/rust-lang/rust/commit/dd8c3a80dd2e5a0b62c3ef77511f3296070f78e2"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "407992c9f43d89eef7941cdf14436f7632a24f8a", "filename": "src/test/run-make/coverage-reports/Makefile", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/399e5cc8db64f06c2d2d57894fc066d289e3eeae/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/399e5cc8db64f06c2d2d57894fc066d289e3eeae/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile?ref=399e5cc8db64f06c2d2d57894fc066d289e3eeae", "patch": "@@ -1,6 +1,11 @@\n # needs-profiler-support\n # ignore-windows-gnu\n \n+# FIXME(pietroalbini): this test currently does not work on cross-compiled\n+# targets because remote-test is not capable of sending back the *.profraw\n+# files generated by the LLVM instrumentation.\n+# ignore-cross-compile\n+\n # Rust coverage maps support LLVM Coverage Mapping Format versions 5 and 6,\n # corresponding with LLVM versions 12 and 13, respectively.\n # When upgrading LLVM versions, consider whether to enforce a minimum LLVM\n@@ -81,13 +86,13 @@ include clear_expected_if_blessed\n \t# Compile the test library with coverage instrumentation\n \t$(RUSTC) $(SOURCEDIR)/lib/$@.rs \\\n \t\t\t$$( sed -n 's/^\\/\\/ compile-flags: \\([^#]*\\).*/\\1/p' $(SOURCEDIR)/lib/$@.rs ) \\\n-\t\t\t--crate-type rlib -Cinstrument-coverage\n+\t\t\t--crate-type rlib -Cinstrument-coverage --target $(TARGET)\n \n %: $(SOURCEDIR)/%.rs\n \t# Compile the test program with coverage instrumentation\n \t$(RUSTC) $(SOURCEDIR)/$@.rs \\\n \t\t\t$$( sed -n 's/^\\/\\/ compile-flags: \\([^#]*\\).*/\\1/p' $(SOURCEDIR)/$@.rs ) \\\n-\t\t\t-L \"$(TMPDIR)\" -Cinstrument-coverage\n+\t\t\t-L \"$(TMPDIR)\" -Cinstrument-coverage --target $(TARGET)\n \n \t# Run it in order to generate some profiling data,\n \t# with `LLVM_PROFILE_FILE=<profdata_file>` environment variable set to"}]}