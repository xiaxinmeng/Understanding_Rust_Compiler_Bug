{"sha": "b656384d8398ec03ce5c40056252f818d6c44761", "node_id": "C_kwDOAAsO6NoAKGI2NTYzODRkODM5OGVjMDNjZTVjNDAwNTYyNTJmODE4ZDZjNDQ3NjE", "commit": {"author": {"name": "Lucas Kent", "email": "rubickent@gmail.com", "date": "2021-12-17T09:08:36Z"}, "committer": {"name": "Lucas Kent", "email": "rubickent@gmail.com", "date": "2021-12-17T13:21:53Z"}, "message": "Update stdlib to the 2021 edition", "tree": {"sha": "80930a2e9618a60b9df6e46bb4548f9ebe2dec9b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/80930a2e9618a60b9df6e46bb4548f9ebe2dec9b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b656384d8398ec03ce5c40056252f818d6c44761", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b656384d8398ec03ce5c40056252f818d6c44761", "html_url": "https://github.com/rust-lang/rust/commit/b656384d8398ec03ce5c40056252f818d6c44761", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b656384d8398ec03ce5c40056252f818d6c44761/comments", "author": {"login": "rukai", "id": 5120858, "node_id": "MDQ6VXNlcjUxMjA4NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5120858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rukai", "html_url": "https://github.com/rukai", "followers_url": "https://api.github.com/users/rukai/followers", "following_url": "https://api.github.com/users/rukai/following{/other_user}", "gists_url": "https://api.github.com/users/rukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/rukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rukai/subscriptions", "organizations_url": "https://api.github.com/users/rukai/orgs", "repos_url": "https://api.github.com/users/rukai/repos", "events_url": "https://api.github.com/users/rukai/events{/privacy}", "received_events_url": "https://api.github.com/users/rukai/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rukai", "id": 5120858, "node_id": "MDQ6VXNlcjUxMjA4NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5120858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rukai", "html_url": "https://github.com/rukai", "followers_url": "https://api.github.com/users/rukai/followers", "following_url": "https://api.github.com/users/rukai/following{/other_user}", "gists_url": "https://api.github.com/users/rukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/rukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rukai/subscriptions", "organizations_url": "https://api.github.com/users/rukai/orgs", "repos_url": "https://api.github.com/users/rukai/repos", "events_url": "https://api.github.com/users/rukai/events{/privacy}", "received_events_url": "https://api.github.com/users/rukai/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b45f04414f3e4006fc2ed3d8e1fa7708efe0e53", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b45f04414f3e4006fc2ed3d8e1fa7708efe0e53", "html_url": "https://github.com/rust-lang/rust/commit/9b45f04414f3e4006fc2ed3d8e1fa7708efe0e53"}], "stats": {"total": 33, "additions": 17, "deletions": 16}, "files": [{"sha": "232ccdf39d456eb7a0be916fb7c976a7676b0e70", "filename": "library/std/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2FCargo.toml?ref=b656384d8398ec03ce5c40056252f818d6c44761", "patch": "@@ -4,7 +4,7 @@ version = \"0.0.0\"\n license = \"MIT OR Apache-2.0\"\n repository = \"https://github.com/rust-lang/rust.git\"\n description = \"The Rust Standard Library\"\n-edition = \"2018\"\n+edition = \"2021\"\n \n [lib]\n crate-type = [\"dylib\", \"rlib\"]"}, {"sha": "749d51d4981c3027eeb07fdf01d16d6bef6baf4d", "filename": "library/std/src/fs/tests.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs?ref=b656384d8398ec03ce5c40056252f818d6c44761", "patch": "@@ -38,10 +38,9 @@ macro_rules! error {\n     ($e:expr, $s:expr) => {\n         match $e {\n             Ok(_) => panic!(\"Unexpected success. Should've been: {:?}\", $s),\n-            Err(ref err) => assert!(\n-                err.raw_os_error() == Some($s),\n-                format!(\"`{}` did not have a code of `{}`\", err, $s)\n-            ),\n+            Err(ref err) => {\n+                assert!(err.raw_os_error() == Some($s), \"`{}` did not have a code of `{}`\", err, $s)\n+            }\n         }\n     };\n }\n@@ -58,7 +57,7 @@ macro_rules! error_contains {\n         match $e {\n             Ok(_) => panic!(\"Unexpected success. Should've been: {:?}\", $s),\n             Err(ref err) => {\n-                assert!(err.to_string().contains($s), format!(\"`{}` did not contain `{}`\", err, $s))\n+                assert!(err.to_string().contains($s), \"`{}` did not contain `{}`\", err, $s)\n             }\n         }\n     };"}, {"sha": "e012594dd4648e45a278bb3dda231da1a939aac4", "filename": "library/std/src/process.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprocess.rs?ref=b656384d8398ec03ce5c40056252f818d6c44761", "patch": "@@ -1600,7 +1600,6 @@ impl ExitStatusError {\n     /// ```\n     /// #![feature(exit_status_error)]\n     /// # if cfg!(unix) {\n-    /// use std::convert::TryFrom;\n     /// use std::num::NonZeroI32;\n     /// use std::process::Command;\n     ///"}, {"sha": "4f2c81731a335fd3c163bc849adb1dc1e2e21e80", "filename": "library/std/src/thread/tests.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b656384d8398ec03ce5c40056252f818d6c44761/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs?ref=b656384d8398ec03ce5c40056252f818d6c44761", "patch": "@@ -1,6 +1,7 @@\n use super::Builder;\n use crate::any::Any;\n use crate::mem;\n+use crate::panic::panic_any;\n use crate::result;\n use crate::sync::{\n     mpsc::{channel, Sender},\n@@ -183,7 +184,7 @@ fn test_simple_newsched_spawn() {\n }\n \n #[test]\n-fn test_try_panic_message_static_str() {\n+fn test_try_panic_message_string_literal() {\n     match thread::spawn(move || {\n         panic!(\"static string\");\n     })\n@@ -199,9 +200,9 @@ fn test_try_panic_message_static_str() {\n }\n \n #[test]\n-fn test_try_panic_message_owned_str() {\n+fn test_try_panic_any_message_owned_str() {\n     match thread::spawn(move || {\n-        panic!(\"owned string\".to_string());\n+        panic_any(\"owned string\".to_string());\n     })\n     .join()\n     {\n@@ -215,9 +216,9 @@ fn test_try_panic_message_owned_str() {\n }\n \n #[test]\n-fn test_try_panic_message_any() {\n+fn test_try_panic_any_message_any() {\n     match thread::spawn(move || {\n-        panic!(box 413u16 as Box<dyn Any + Send>);\n+        panic_any(box 413u16 as Box<dyn Any + Send>);\n     })\n     .join()\n     {\n@@ -233,10 +234,10 @@ fn test_try_panic_message_any() {\n }\n \n #[test]\n-fn test_try_panic_message_unit_struct() {\n+fn test_try_panic_any_message_unit_struct() {\n     struct Juju;\n \n-    match thread::spawn(move || panic!(Juju)).join() {\n+    match thread::spawn(move || panic_any(Juju)).join() {\n         Err(ref e) if e.is::<Juju>() => {}\n         Err(_) | Ok(()) => panic!(),\n     }"}, {"sha": "f610dbd806aea658bdd6d429ce612702f90c2b2c", "filename": "src/tools/tidy/src/edition.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b656384d8398ec03ce5c40056252f818d6c44761/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b656384d8398ec03ce5c40056252f818d6c44761/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs?ref=b656384d8398ec03ce5c40056252f818d6c44761", "patch": "@@ -23,8 +23,10 @@ pub fn check(path: &Path, bad: &mut bool) {\n                 return;\n             }\n \n-            // Library crates are not yet ready to migrate to 2021.\n-            if path.components().any(|c| c.as_os_str() == \"library\") {\n+            // Not all library crates are ready to migrate to 2021.\n+            if file.components().any(|c| c.as_os_str() == \"library\")\n+                && file.components().all(|c| c.as_os_str() != \"std\")\n+            {\n                 let has = contents.lines().any(is_edition_2018);\n                 if !has {\n                     tidy_error!("}]}