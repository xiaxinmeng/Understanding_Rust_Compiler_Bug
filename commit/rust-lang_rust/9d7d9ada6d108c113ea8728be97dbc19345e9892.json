{"sha": "9d7d9ada6d108c113ea8728be97dbc19345e9892", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkN2Q5YWRhNmQxMDhjMTEzZWE4NzI4YmU5N2RiYzE5MzQ1ZTk4OTI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-11-04T22:00:31Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-11-18T10:51:17Z"}, "message": "resolve: Simplify ambiguity checking for built-in attributes", "tree": {"sha": "871c2faa7ead7ca6585325b90c06c75ee67aa0f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/871c2faa7ead7ca6585325b90c06c75ee67aa0f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d7d9ada6d108c113ea8728be97dbc19345e9892", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d7d9ada6d108c113ea8728be97dbc19345e9892", "html_url": "https://github.com/rust-lang/rust/commit/9d7d9ada6d108c113ea8728be97dbc19345e9892", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d7d9ada6d108c113ea8728be97dbc19345e9892/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6739fe27448e1f85820d80a6a75292b39446d08", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6739fe27448e1f85820d80a6a75292b39446d08", "html_url": "https://github.com/rust-lang/rust/commit/e6739fe27448e1f85820d80a6a75292b39446d08"}], "stats": {"total": 25, "additions": 8, "deletions": 17}, "files": [{"sha": "05a2ad23e64b5c0e98321bc7843186beda7b0d36", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9d7d9ada6d108c113ea8728be97dbc19345e9892/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d7d9ada6d108c113ea8728be97dbc19345e9892/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=9d7d9ada6d108c113ea8728be97dbc19345e9892", "patch": "@@ -684,7 +684,7 @@ impl<'a, 'cl> Resolver<'a, 'cl> {\n                         let binding = (Def::NonMacroAttr(NonMacroAttrKind::Builtin),\n                                        ty::Visibility::Public, ident.span, Mark::root())\n                                        .to_name_binding(self.arenas);\n-                        Ok((binding, Flags::PRELUDE, Flags::empty()))\n+                        Ok((binding, Flags::PRELUDE, Flags::all()))\n                     } else {\n                         Err(Determinacy::Determined)\n                     }\n@@ -917,18 +917,9 @@ impl<'a, 'cl> Resolver<'a, 'cl> {\n \n         let builtin_attrs = mem::replace(&mut *module.builtin_attrs.borrow_mut(), Vec::new());\n         for (ident, parent_scope) in builtin_attrs {\n-            let binding = self.early_resolve_ident_in_lexical_scope(\n+            let _ = self.early_resolve_ident_in_lexical_scope(\n                 ident, MacroNS, Some(MacroKind::Attr), false, &parent_scope, true, true, ident.span\n             );\n-            if let Ok(binding) = binding {\n-                if binding.def_ignoring_ambiguity() !=\n-                        Def::NonMacroAttr(NonMacroAttrKind::Builtin) {\n-                    let builtin_binding = (Def::NonMacroAttr(NonMacroAttrKind::Builtin),\n-                                           ty::Visibility::Public, ident.span, Mark::root())\n-                                           .to_name_binding(self.arenas);\n-                    self.report_ambiguity_error(ident, binding, builtin_binding);\n-                }\n-            }\n         }\n     }\n "}, {"sha": "0720ccb7cf9df056e284c65dd2ddb1f539e39661", "filename": "src/test/ui-fulldeps/proc-macro/ambiguous-builtin-attrs.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9d7d9ada6d108c113ea8728be97dbc19345e9892/src%2Ftest%2Fui-fulldeps%2Fproc-macro%2Fambiguous-builtin-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9d7d9ada6d108c113ea8728be97dbc19345e9892/src%2Ftest%2Fui-fulldeps%2Fproc-macro%2Fambiguous-builtin-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fproc-macro%2Fambiguous-builtin-attrs.stderr?ref=9d7d9ada6d108c113ea8728be97dbc19345e9892", "patch": "@@ -1,3 +1,9 @@\n+error[E0425]: cannot find value `NonExistent` in this scope\n+  --> $DIR/ambiguous-builtin-attrs.rs:30:5\n+   |\n+LL |     NonExistent; //~ ERROR cannot find value `NonExistent` in this scope\n+   |     ^^^^^^^^^^^ not found in this scope\n+\n error[E0659]: `repr` is ambiguous\n   --> $DIR/ambiguous-builtin-attrs.rs:9:3\n    |\n@@ -88,12 +94,6 @@ LL | #![feature(decl_macro)] //~ ERROR `feature` is ambiguous\n    |    ^^^^^^^\n    = note: consider adding an explicit import of `feature` to disambiguate\n \n-error[E0425]: cannot find value `NonExistent` in this scope\n-  --> $DIR/ambiguous-builtin-attrs.rs:30:5\n-   |\n-LL |     NonExistent; //~ ERROR cannot find value `NonExistent` in this scope\n-   |     ^^^^^^^^^^^ not found in this scope\n-\n error: aborting due to 6 previous errors\n \n Some errors occurred: E0425, E0659."}]}