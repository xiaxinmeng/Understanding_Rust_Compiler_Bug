{"sha": "63ec33e929f60177a02ae3d059482e3743f1d8cc", "node_id": "C_kwDOAAsO6NoAKDYzZWMzM2U5MjlmNjAxNzdhMDJhZTNkMDU5NDgyZTM3NDNmMWQ4Y2M", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-28T16:25:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-28T16:25:46Z"}, "message": "Rollup merge of #104804 - nnethercote:MetaItemLit, r=petrochenkov\n\nRename `ast::Lit` as `ast::MetaItemLit`.\n\nAnd some other literal cleanups.\n\nr? `@petrochenkov`", "tree": {"sha": "4f2119f00183d398b744abb56fbddc6f184c0c90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f2119f00183d398b744abb56fbddc6f184c0c90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63ec33e929f60177a02ae3d059482e3743f1d8cc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjhOEKCRBK7hj4Ov3rIwAALUgIACxkYV5WdJ60am1GRkoIMyUE\nNijx+ym5NahWP7vKQ0yNphVrqgVtYFEOmCGWvSAMNh3cXFnbLeggSRdCHTJfHIR8\n5cbtswYzevMV/OwnQmryxnVF7yhmhtxDogyemw5u5q5m1lDINM+8Iz/0p/v33glf\ngNEg/zX5rFs3QNKUXAZEPRzTPuYNbnt5bop7QAMyHQ/hovrYejxuCQC6ueDKinG9\nxLB67GfwNO4Qi50Z+A7/yhE9WXe6QNcYbtAu5dbM3c7IGlesBdz1AbPzkVzWIBQA\nPXNLKCvOMm/A+3AxjObE1OpTqBRhED3lBZHN/1EIyXJ/Qio8iIlCjdJ053X44xw=\n=wmaS\n-----END PGP SIGNATURE-----\n", "payload": "tree 4f2119f00183d398b744abb56fbddc6f184c0c90\nparent 8a09420ac48658cad726e0a6997687ceac4151e3\nparent a60e337c884f3201e693e6a5111b663bbc54de27\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1669652746 +0100\ncommitter GitHub <noreply@github.com> 1669652746 +0100\n\nRollup merge of #104804 - nnethercote:MetaItemLit, r=petrochenkov\n\nRename `ast::Lit` as `ast::MetaItemLit`.\n\nAnd some other literal cleanups.\n\nr? `@petrochenkov`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63ec33e929f60177a02ae3d059482e3743f1d8cc", "html_url": "https://github.com/rust-lang/rust/commit/63ec33e929f60177a02ae3d059482e3743f1d8cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63ec33e929f60177a02ae3d059482e3743f1d8cc/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a09420ac48658cad726e0a6997687ceac4151e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a09420ac48658cad726e0a6997687ceac4151e3", "html_url": "https://github.com/rust-lang/rust/commit/8a09420ac48658cad726e0a6997687ceac4151e3"}, {"sha": "a60e337c884f3201e693e6a5111b663bbc54de27", "url": "https://api.github.com/repos/rust-lang/rust/commits/a60e337c884f3201e693e6a5111b663bbc54de27", "html_url": "https://github.com/rust-lang/rust/commit/a60e337c884f3201e693e6a5111b663bbc54de27"}], "stats": {"total": 254, "additions": 126, "deletions": 128}, "files": [{"sha": "d0bb05c36549b09a5b2db238644895fca7aca18c", "filename": "compiler/rustc_ast/src/ast.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fast.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -13,7 +13,7 @@\n //! - [`FnDecl`], [`FnHeader`] and [`Param`]: Metadata associated with a function declaration.\n //! - [`Generics`], [`GenericParam`], [`WhereClause`]: Metadata associated with generic parameters.\n //! - [`EnumDef`] and [`Variant`]: Enum declaration.\n-//! - [`Lit`] and [`LitKind`]: Literal expressions.\n+//! - [`MetaItemLit`] and [`LitKind`]: Literal expressions.\n //! - [`MacroDef`], [`MacStmtStyle`], [`MacCall`], [`MacDelimiter`]: Macro definition and invocation.\n //! - [`Attribute`]: Metadata associated with item.\n //! - [`UnOp`], [`BinOp`], and [`BinOpKind`]: Unary and binary operators.\n@@ -489,7 +489,7 @@ pub enum NestedMetaItem {\n     /// A literal.\n     ///\n     /// E.g., `\"foo\"`, `64`, `true`.\n-    Literal(Lit),\n+    Lit(MetaItemLit),\n }\n \n /// A spanned compile-time attribute item.\n@@ -518,7 +518,7 @@ pub enum MetaItemKind {\n     /// Name value meta item.\n     ///\n     /// E.g., `feature = \"foo\"` as in `#[feature = \"foo\"]`.\n-    NameValue(Lit),\n+    NameValue(MetaItemLit),\n }\n \n /// A block (`{ .. }`).\n@@ -1599,12 +1599,12 @@ pub enum AttrArgs {\n }\n \n // The RHS of an `AttrArgs::Eq` starts out as an expression. Once macro\n-// expansion is completed, all cases end up either as a literal, which is the\n-// form used after lowering to HIR, or as an error.\n+// expansion is completed, all cases end up either as a meta item literal,\n+// which is the form used after lowering to HIR, or as an error.\n #[derive(Clone, Encodable, Decodable, Debug)]\n pub enum AttrArgsEq {\n     Ast(P<Expr>),\n-    Hir(Lit),\n+    Hir(MetaItemLit),\n }\n \n impl AttrArgs {\n@@ -1726,19 +1726,18 @@ pub enum StrStyle {\n     Raw(u8),\n }\n \n-/// An AST literal.\n+/// A literal in a meta item.\n #[derive(Clone, Encodable, Decodable, Debug, HashStable_Generic)]\n-pub struct Lit {\n+pub struct MetaItemLit {\n     /// The original literal token as written in source code.\n     pub token_lit: token::Lit,\n     /// The \"semantic\" representation of the literal lowered from the original tokens.\n     /// Strings are unescaped, hexadecimal forms are eliminated, etc.\n-    /// FIXME: Remove this and only create the semantic representation during lowering to HIR.\n     pub kind: LitKind,\n     pub span: Span,\n }\n \n-/// Same as `Lit`, but restricted to string literals.\n+/// Similar to `MetaItemLit`, but restricted to string literals.\n #[derive(Clone, Copy, Encodable, Decodable, Debug)]\n pub struct StrLit {\n     /// The original literal token as written in source code.\n@@ -1747,7 +1746,6 @@ pub struct StrLit {\n     pub suffix: Option<Symbol>,\n     pub span: Span,\n     /// The unescaped \"semantic\" representation of the literal lowered from the original token.\n-    /// FIXME: Remove this and only create the semantic representation during lowering to HIR.\n     pub symbol_unescaped: Symbol,\n }\n \n@@ -1783,6 +1781,8 @@ pub enum LitFloatType {\n     Unsuffixed,\n }\n \n+/// This type is used within both `ast::MetaItemLit` and `hir::Lit`.\n+///\n /// Note that the entire literal (including the suffix) is considered when\n /// deciding the `LitKind`. This means that float literals like `1f32` are\n /// classified by this type as `Float`. This is different to `token::LitKind`\n@@ -3096,9 +3096,9 @@ mod size_asserts {\n     static_assert_size!(Impl, 184);\n     static_assert_size!(Item, 184);\n     static_assert_size!(ItemKind, 112);\n-    static_assert_size!(Lit, 48);\n     static_assert_size!(LitKind, 24);\n     static_assert_size!(Local, 72);\n+    static_assert_size!(MetaItemLit, 48);\n     static_assert_size!(Param, 40);\n     static_assert_size!(Pat, 88);\n     static_assert_size!(Path, 24);"}, {"sha": "7a86b471ba298a988f7f61b89ecbf8d6b56c3e29", "filename": "compiler/rustc_ast/src/attr/mod.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fattr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fattr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fattr%2Fmod.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -2,7 +2,7 @@\n \n use crate::ast;\n use crate::ast::{AttrArgs, AttrArgsEq, AttrId, AttrItem, AttrKind, AttrStyle, Attribute};\n-use crate::ast::{DelimArgs, Lit, LitKind};\n+use crate::ast::{DelimArgs, LitKind, MetaItemLit};\n use crate::ast::{MacDelimiter, MetaItem, MetaItemKind, NestedMetaItem};\n use crate::ast::{Path, PathSegment};\n use crate::ptr::P;\n@@ -50,10 +50,10 @@ impl NestedMetaItem {\n         }\n     }\n \n-    /// Returns the `Lit` if `self` is a `NestedMetaItem::Literal`s.\n-    pub fn literal(&self) -> Option<&Lit> {\n+    /// Returns the `MetaItemLit` if `self` is a `NestedMetaItem::Literal`s.\n+    pub fn lit(&self) -> Option<&MetaItemLit> {\n         match self {\n-            NestedMetaItem::Literal(lit) => Some(lit),\n+            NestedMetaItem::Lit(lit) => Some(lit),\n             _ => None,\n         }\n     }\n@@ -78,12 +78,12 @@ impl NestedMetaItem {\n     }\n \n     /// Returns a name and single literal value tuple of the `MetaItem`.\n-    pub fn name_value_literal(&self) -> Option<(Symbol, &Lit)> {\n+    pub fn name_value_literal(&self) -> Option<(Symbol, &MetaItemLit)> {\n         self.meta_item().and_then(|meta_item| {\n             meta_item.meta_item_list().and_then(|meta_item_list| {\n                 if meta_item_list.len() == 1\n                     && let Some(ident) = meta_item.ident()\n-                    && let Some(lit) = meta_item_list[0].literal()\n+                    && let Some(lit) = meta_item_list[0].lit()\n                 {\n                     return Some((ident.name, lit));\n                 }\n@@ -179,7 +179,7 @@ impl MetaItem {\n     ///     #[attribute(name = \"value\")]\n     ///                 ^^^^^^^^^^^^^^\n     /// ```\n-    pub fn name_value_literal(&self) -> Option<&Lit> {\n+    pub fn name_value_literal(&self) -> Option<&MetaItemLit> {\n         match &self.kind {\n             MetaItemKind::NameValue(v) => Some(v),\n             _ => None,\n@@ -334,7 +334,7 @@ pub fn mk_name_value_item_str(ident: Ident, str: Symbol, str_span: Span) -> Meta\n }\n \n pub fn mk_name_value_item(ident: Ident, lit_kind: LitKind, lit_span: Span) -> MetaItem {\n-    let lit = Lit::from_lit_kind(lit_kind, lit_span);\n+    let lit = MetaItemLit::from_lit_kind(lit_kind, lit_span);\n     let span = ident.span.to(lit_span);\n     MetaItem { path: Path::from_ident(ident), span, kind: MetaItemKind::NameValue(lit) }\n }\n@@ -604,7 +604,7 @@ impl MetaItemKind {\n                 MetaItemKind::name_value_from_tokens(&mut inner_tokens.into_trees())\n             }\n             Some(TokenTree::Token(token, _)) => {\n-                Lit::from_token(&token).map(MetaItemKind::NameValue)\n+                MetaItemLit::from_token(&token).map(MetaItemKind::NameValue)\n             }\n             _ => None,\n         }\n@@ -622,7 +622,7 @@ impl MetaItemKind {\n             AttrArgs::Eq(_, AttrArgsEq::Ast(expr)) => match expr.kind {\n                 ast::ExprKind::Lit(token_lit) => {\n                     // Turn failures to `None`, we'll get parse errors elsewhere.\n-                    Lit::from_token_lit(token_lit, expr.span)\n+                    MetaItemLit::from_token_lit(token_lit, expr.span)\n                         .ok()\n                         .map(|lit| MetaItemKind::NameValue(lit))\n                 }\n@@ -655,14 +655,14 @@ impl NestedMetaItem {\n     pub fn span(&self) -> Span {\n         match self {\n             NestedMetaItem::MetaItem(item) => item.span,\n-            NestedMetaItem::Literal(lit) => lit.span,\n+            NestedMetaItem::Lit(lit) => lit.span,\n         }\n     }\n \n     fn token_trees(&self) -> Vec<TokenTree> {\n         match self {\n             NestedMetaItem::MetaItem(item) => item.token_trees(),\n-            NestedMetaItem::Literal(lit) => {\n+            NestedMetaItem::Lit(lit) => {\n                 vec![TokenTree::Token(lit.to_token(), Spacing::Alone)]\n             }\n         }\n@@ -674,10 +674,10 @@ impl NestedMetaItem {\n     {\n         match tokens.peek() {\n             Some(TokenTree::Token(token, _))\n-                if let Some(lit) = Lit::from_token(token) =>\n+                if let Some(lit) = MetaItemLit::from_token(token) =>\n             {\n                 tokens.next();\n-                return Some(NestedMetaItem::Literal(lit));\n+                return Some(NestedMetaItem::Lit(lit));\n             }\n             Some(TokenTree::Delimited(_, Delimiter::Invisible, inner_tokens)) => {\n                 let inner_tokens = inner_tokens.clone();"}, {"sha": "cb3c54fa03ce56dd4395d543179bdd1842d4fcb7", "filename": "compiler/rustc_ast/src/mut_visit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -628,7 +628,7 @@ pub fn noop_visit_macro_def<T: MutVisitor>(macro_def: &mut MacroDef, vis: &mut T\n pub fn noop_visit_meta_list_item<T: MutVisitor>(li: &mut NestedMetaItem, vis: &mut T) {\n     match li {\n         NestedMetaItem::MetaItem(mi) => vis.visit_meta_item(mi),\n-        NestedMetaItem::Literal(_lit) => {}\n+        NestedMetaItem::Lit(_lit) => {}\n     }\n }\n "}, {"sha": "42cba07fcef8d41c6044d15f8e4571b97aeb00c7", "filename": "compiler/rustc_ast/src/util/literal.rs", "status": "modified", "additions": 12, "deletions": 20, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Futil%2Fliteral.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast%2Fsrc%2Futil%2Fliteral.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Futil%2Fliteral.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -1,8 +1,7 @@\n //! Code related to parsing literals.\n \n-use crate::ast::{self, Lit, LitKind};\n+use crate::ast::{self, LitKind, MetaItemLit};\n use crate::token::{self, Token};\n-use rustc_data_structures::sync::Lrc;\n use rustc_lexer::unescape::{byte_from_char, unescape_byte, unescape_char, unescape_literal, Mode};\n use rustc_span::symbol::{kw, sym, Symbol};\n use rustc_span::Span;\n@@ -196,33 +195,26 @@ impl LitKind {\n     }\n }\n \n-impl Lit {\n-    /// Converts literal token into an AST literal.\n-    pub fn from_token_lit(token_lit: token::Lit, span: Span) -> Result<Lit, LitError> {\n-        Ok(Lit { token_lit, kind: LitKind::from_token_lit(token_lit)?, span })\n+impl MetaItemLit {\n+    /// Converts token literal into a meta item literal.\n+    pub fn from_token_lit(token_lit: token::Lit, span: Span) -> Result<MetaItemLit, LitError> {\n+        Ok(MetaItemLit { token_lit, kind: LitKind::from_token_lit(token_lit)?, span })\n     }\n \n-    /// Converts an arbitrary token into an AST literal.\n-    pub fn from_token(token: &Token) -> Option<Lit> {\n+    /// Converts an arbitrary token into meta item literal.\n+    pub fn from_token(token: &Token) -> Option<MetaItemLit> {\n         token::Lit::from_token(token)\n-            .and_then(|token_lit| Lit::from_token_lit(token_lit, token.span).ok())\n+            .and_then(|token_lit| MetaItemLit::from_token_lit(token_lit, token.span).ok())\n     }\n \n-    /// Attempts to recover an AST literal from semantic literal.\n+    /// Attempts to create a meta item literal from a `LitKind`.\n     /// This function is used when the original token doesn't exist (e.g. the literal is created\n     /// by an AST-based macro) or unavailable (e.g. from HIR pretty-printing).\n-    pub fn from_lit_kind(kind: LitKind, span: Span) -> Lit {\n-        Lit { token_lit: kind.to_token_lit(), kind, span }\n+    pub fn from_lit_kind(kind: LitKind, span: Span) -> MetaItemLit {\n+        MetaItemLit { token_lit: kind.to_token_lit(), kind, span }\n     }\n \n-    /// Recovers an AST literal from a string of bytes produced by `include_bytes!`.\n-    /// This requires ASCII-escaping the string, which can result in poor performance\n-    /// for very large strings of bytes.\n-    pub fn from_included_bytes(bytes: &Lrc<[u8]>, span: Span) -> Lit {\n-        Self::from_lit_kind(LitKind::ByteStr(bytes.clone()), span)\n-    }\n-\n-    /// Losslessly convert an AST literal into a token.\n+    /// Losslessly convert a meta item literal into a token.\n     pub fn to_token(&self) -> Token {\n         let kind = match self.token_lit.kind {\n             token::Bool => token::Ident(self.token_lit.symbol, false),"}, {"sha": "ad6e72d015695efd1f2934881bf795f8074434d0", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -948,17 +948,12 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n             AttrArgs::Eq(eq_span, AttrArgsEq::Ast(expr)) => {\n                 // In valid code the value always ends up as a single literal. Otherwise, a dummy\n                 // literal suffices because the error is handled elsewhere.\n-                let lit = if let ExprKind::Lit(token_lit) = expr.kind {\n-                    match Lit::from_token_lit(token_lit, expr.span) {\n-                        Ok(lit) => lit,\n-                        Err(_err) => Lit {\n-                            token_lit: token::Lit::new(token::LitKind::Err, kw::Empty, None),\n-                            kind: LitKind::Err,\n-                            span: DUMMY_SP,\n-                        },\n-                    }\n+                let lit = if let ExprKind::Lit(token_lit) = expr.kind\n+                    && let Ok(lit) = MetaItemLit::from_token_lit(token_lit, expr.span)\n+                {\n+                    lit\n                 } else {\n-                    Lit {\n+                    MetaItemLit {\n                         token_lit: token::Lit::new(token::LitKind::Err, kw::Empty, None),\n                         kind: LitKind::Err,\n                         span: DUMMY_SP,"}, {"sha": "7a9243c511b921c068edc1d1491ae8f2da0740ee", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -371,7 +371,7 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n         }\n     }\n \n-    fn print_literal(&mut self, lit: &ast::Lit) {\n+    fn print_meta_item_lit(&mut self, lit: &ast::MetaItemLit) {\n         self.print_token_literal(lit.token_lit, lit.span)\n     }\n \n@@ -488,7 +488,7 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n                 self.print_path(&item.path, false, 0);\n                 self.space();\n                 self.word_space(\"=\");\n-                let token_str = self.literal_to_string(lit);\n+                let token_str = self.meta_item_lit_to_string(lit);\n                 self.word(token_str);\n             }\n         }\n@@ -498,7 +498,7 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n     fn print_meta_list_item(&mut self, item: &ast::NestedMetaItem) {\n         match item {\n             ast::NestedMetaItem::MetaItem(ref mi) => self.print_meta_item(mi),\n-            ast::NestedMetaItem::Literal(ref lit) => self.print_literal(lit),\n+            ast::NestedMetaItem::Lit(ref lit) => self.print_meta_item_lit(lit),\n         }\n     }\n \n@@ -510,7 +510,7 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n                 self.print_path(&item.path, false, 0);\n                 self.space();\n                 self.word_space(\"=\");\n-                self.print_literal(value);\n+                self.print_meta_item_lit(value);\n             }\n             ast::MetaItemKind::List(ref items) => {\n                 self.print_path(&item.path, false, 0);\n@@ -825,8 +825,8 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n         Self::to_string(|s| s.print_expr(e))\n     }\n \n-    fn literal_to_string(&self, lit: &ast::Lit) -> String {\n-        Self::to_string(|s| s.print_literal(lit))\n+    fn meta_item_lit_to_string(&self, lit: &ast::MetaItemLit) -> String {\n+        Self::to_string(|s| s.print_meta_item_lit(lit))\n     }\n \n     fn tt_to_string(&self, tt: &TokenTree) -> String {"}, {"sha": "f4d77549eff4cc77a3a374cd9267b5678b741ef9", "filename": "compiler/rustc_ast_pretty/src/pprust/state/expr.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -328,8 +328,8 @@ impl<'a> State<'a> {\n                 self.print_token_literal(token_lit, expr.span);\n             }\n             ast::ExprKind::IncludedBytes(ref bytes) => {\n-                let lit = ast::Lit::from_included_bytes(bytes, expr.span);\n-                self.print_literal(&lit)\n+                let lit = ast::LitKind::ByteStr(bytes.clone()).to_token_lit();\n+                self.print_token_literal(lit, expr.span)\n             }\n             ast::ExprKind::Cast(ref expr, ref ty) => {\n                 let prec = AssocOp::As.precedence() as i8;"}, {"sha": "13b48d8f89ab4a6eea6f60a986d88369be7235d4", "filename": "compiler/rustc_attr/src/builtin.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -1,7 +1,7 @@\n //! Parsing and validation of builtin attributes\n \n use rustc_ast as ast;\n-use rustc_ast::{Attribute, Lit, LitKind, MetaItem, MetaItemKind, NestedMetaItem, NodeId};\n+use rustc_ast::{Attribute, LitKind, MetaItem, MetaItemKind, MetaItemLit, NestedMetaItem, NodeId};\n use rustc_ast_pretty::pprust;\n use rustc_feature::{find_gated_cfg, is_builtin_attr_name, Features, GatedCfg};\n use rustc_macros::HashStable_Generic;\n@@ -486,7 +486,7 @@ where\n                                     continue 'outer;\n                                 }\n                             },\n-                            NestedMetaItem::Literal(lit) => {\n+                            NestedMetaItem::Lit(lit) => {\n                                 handle_errors(\n                                     &sess.parse_sess,\n                                     lit.span,\n@@ -658,11 +658,11 @@ pub fn eval_condition(\n         ast::MetaItemKind::List(ref mis) if cfg.name_or_empty() == sym::version => {\n             try_gate_cfg(sym::version, cfg.span, sess, features);\n             let (min_version, span) = match &mis[..] {\n-                [NestedMetaItem::Literal(Lit { kind: LitKind::Str(sym, ..), span, .. })] => {\n+                [NestedMetaItem::Lit(MetaItemLit { kind: LitKind::Str(sym, ..), span, .. })] => {\n                     (sym, span)\n                 }\n                 [\n-                    NestedMetaItem::Literal(Lit { span, .. })\n+                    NestedMetaItem::Lit(MetaItemLit { span, .. })\n                     | NestedMetaItem::MetaItem(MetaItem { span, .. }),\n                 ] => {\n                     sess.emit_err(session_diagnostics::ExpectedVersionLiteral { span: *span });\n@@ -899,7 +899,7 @@ where\n                                 continue 'outer;\n                             }\n                         },\n-                        NestedMetaItem::Literal(lit) => {\n+                        NestedMetaItem::Lit(lit) => {\n                             handle_errors(\n                                 &sess.parse_sess,\n                                 lit.span,"}, {"sha": "c8a2fca00e800efacb597aea3744e2275f2d6e48", "filename": "compiler/rustc_builtin_macros/src/derive.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_builtin_macros%2Fsrc%2Fderive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_builtin_macros%2Fsrc%2Fderive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fderive.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -48,9 +48,9 @@ impl MultiItemModifier for Expander {\n                     .into_iter()\n                     .filter_map(|nested_meta| match nested_meta {\n                         NestedMetaItem::MetaItem(meta) => Some(meta),\n-                        NestedMetaItem::Literal(lit) => {\n+                        NestedMetaItem::Lit(lit) => {\n                             // Reject `#[derive(\"Debug\")]`.\n-                            report_unexpected_literal(sess, &lit);\n+                            report_unexpected_meta_item_lit(sess, &lit);\n                             None\n                         }\n                     })\n@@ -127,7 +127,7 @@ fn report_bad_target(sess: &Session, item: &Annotatable, span: Span) -> bool {\n     bad_target\n }\n \n-fn report_unexpected_literal(sess: &Session, lit: &ast::Lit) {\n+fn report_unexpected_meta_item_lit(sess: &Session, lit: &ast::MetaItemLit) {\n     let help_msg = match lit.token_lit.kind {\n         token::Str if rustc_lexer::is_ident(lit.token_lit.symbol.as_str()) => {\n             format!(\"try using `#[derive({})]`\", lit.token_lit.symbol)"}, {"sha": "7616579611711984161c740745240ab4a9bac203", "filename": "compiler/rustc_expand/src/proc_macro_server.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fproc_macro_server.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -526,11 +526,8 @@ impl server::TokenStream for Rustc<'_, '_> {\n                 Ok(tokenstream::TokenStream::token_alone(token::Literal(*token_lit), expr.span))\n             }\n             ast::ExprKind::IncludedBytes(bytes) => {\n-                let lit = ast::Lit::from_included_bytes(bytes, expr.span);\n-                Ok(tokenstream::TokenStream::token_alone(\n-                    token::TokenKind::Literal(lit.token_lit),\n-                    expr.span,\n-                ))\n+                let lit = ast::LitKind::ByteStr(bytes.clone()).to_token_lit();\n+                Ok(tokenstream::TokenStream::token_alone(token::TokenKind::Literal(lit), expr.span))\n             }\n             ast::ExprKind::Unary(ast::UnOp::Neg, e) => match &e.kind {\n                 ast::ExprKind::Lit(token_lit) => match token_lit {"}, {"sha": "638dd6d756b58177ec5225df67a1668599406f44", "filename": "compiler/rustc_hir_analysis/src/collect.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -2145,7 +2145,7 @@ fn should_inherit_track_caller(tcx: TyCtxt<'_>, def_id: DefId) -> bool {\n }\n \n fn check_link_ordinal(tcx: TyCtxt<'_>, attr: &ast::Attribute) -> Option<u16> {\n-    use rustc_ast::{Lit, LitIntType, LitKind};\n+    use rustc_ast::{LitIntType, LitKind, MetaItemLit};\n     if !tcx.features().raw_dylib && tcx.sess.target.arch == \"x86\" {\n         feature_err(\n             &tcx.sess.parse_sess,\n@@ -2158,7 +2158,7 @@ fn check_link_ordinal(tcx: TyCtxt<'_>, attr: &ast::Attribute) -> Option<u16> {\n     let meta_item_list = attr.meta_item_list();\n     let meta_item_list = meta_item_list.as_deref();\n     let sole_meta_list = match meta_item_list {\n-        Some([item]) => item.literal(),\n+        Some([item]) => item.lit(),\n         Some(_) => {\n             tcx.sess\n                 .struct_span_err(attr.span, \"incorrect number of arguments to `#[link_ordinal]`\")\n@@ -2168,7 +2168,9 @@ fn check_link_ordinal(tcx: TyCtxt<'_>, attr: &ast::Attribute) -> Option<u16> {\n         }\n         _ => None,\n     };\n-    if let Some(Lit { kind: LitKind::Int(ordinal, LitIntType::Unsuffixed), .. }) = sole_meta_list {\n+    if let Some(MetaItemLit { kind: LitKind::Int(ordinal, LitIntType::Unsuffixed), .. }) =\n+        sole_meta_list\n+    {\n         // According to the table at https://docs.microsoft.com/en-us/windows/win32/debug/pe-format#import-header,\n         // the ordinal must fit into 16 bits.  Similarly, the Ordinal field in COFFShortExport (defined\n         // in llvm/include/llvm/Object/COFFImportFile.h), which we use to communicate import information"}, {"sha": "4c22ab68a5681f227aa4a644c64a346be1689311", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -194,7 +194,7 @@ pub fn parse_check_cfg(specs: Vec<String>) -> CheckCfg {\n \n                                         for val in values {\n                                             if let Some(LitKind::Str(s, _)) =\n-                                                val.literal().map(|lit| &lit.kind)\n+                                                val.lit().map(|lit| &lit.kind)\n                                             {\n                                                 ident_values.insert(s.to_string());\n                                             } else {"}, {"sha": "a6c7e819482c25c992f4f125a4d6f6ae530875f7", "filename": "compiler/rustc_lint/src/internal.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Finternal.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -462,8 +462,8 @@ impl LateLintPass<'_> for BadOptAccess {\n                 let Some(attr) = cx.tcx.get_attr(field.did, sym::rustc_lint_opt_deny_field_access) &&\n                 let Some(items) = attr.meta_item_list()  &&\n                 let Some(item) = items.first()  &&\n-                let Some(literal) = item.literal()  &&\n-                let ast::LitKind::Str(val, _) = literal.kind\n+                let Some(lit) = item.lit()  &&\n+                let ast::LitKind::Str(val, _) = lit.kind\n             {\n                 cx.struct_span_lint(BAD_OPT_ACCESS, expr.span, val.as_str(), |lint|\n                     lint"}, {"sha": "297433d37c4f369b19dff3f1eab83694a4fb5426", "filename": "compiler/rustc_middle/src/ty/context.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -1191,8 +1191,9 @@ impl<'tcx> TyCtxt<'tcx> {\n             debug!(\"layout_scalar_valid_range: attr={:?}\", attr);\n             if let Some(\n                 &[\n-                    ast::NestedMetaItem::Literal(ast::Lit {\n-                        kind: ast::LitKind::Int(a, _), ..\n+                    ast::NestedMetaItem::Lit(ast::MetaItemLit {\n+                        kind: ast::LitKind::Int(a, _),\n+                        ..\n                     }),\n                 ],\n             ) = attr.meta_item_list().as_deref()"}, {"sha": "c7d239b647f35b2bc273fdc0185a5cf224f13ac9", "filename": "compiler/rustc_parse/src/parser/attr.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -315,8 +315,9 @@ impl<'a> Parser<'a> {\n         Ok(attrs)\n     }\n \n-    pub(crate) fn parse_unsuffixed_lit(&mut self) -> PResult<'a, ast::Lit> {\n-        let lit = self.parse_ast_lit()?;\n+    // Note: must be unsuffixed.\n+    pub(crate) fn parse_unsuffixed_meta_item_lit(&mut self) -> PResult<'a, ast::MetaItemLit> {\n+        let lit = self.parse_meta_item_lit()?;\n         debug!(\"checking if {:?} is unsuffixed\", lit);\n \n         if !lit.kind.is_unsuffixed() {\n@@ -391,7 +392,7 @@ impl<'a> Parser<'a> {\n \n     pub(crate) fn parse_meta_item_kind(&mut self) -> PResult<'a, ast::MetaItemKind> {\n         Ok(if self.eat(&token::Eq) {\n-            ast::MetaItemKind::NameValue(self.parse_unsuffixed_lit()?)\n+            ast::MetaItemKind::NameValue(self.parse_unsuffixed_meta_item_lit()?)\n         } else if self.check(&token::OpenDelim(Delimiter::Parenthesis)) {\n             // Matches `meta_seq = ( COMMASEP(meta_item_inner) )`.\n             let (list, _) = self.parse_paren_comma_seq(|p| p.parse_meta_item_inner())?;\n@@ -403,8 +404,8 @@ impl<'a> Parser<'a> {\n \n     /// Matches `meta_item_inner : (meta_item | UNSUFFIXED_LIT) ;`.\n     fn parse_meta_item_inner(&mut self) -> PResult<'a, ast::NestedMetaItem> {\n-        match self.parse_unsuffixed_lit() {\n-            Ok(lit) => return Ok(ast::NestedMetaItem::Literal(lit)),\n+        match self.parse_unsuffixed_meta_item_lit() {\n+            Ok(lit) => return Ok(ast::NestedMetaItem::Lit(lit)),\n             Err(err) => err.cancel(),\n         }\n "}, {"sha": "e0443a697b50415fc950376706034f3aacdb9085", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -33,10 +33,10 @@ use rustc_ast::util::case::Case;\n use rustc_ast::util::classify;\n use rustc_ast::util::parser::{prec_let_scrutinee_needs_par, AssocOp, Fixity};\n use rustc_ast::visit::Visitor;\n-use rustc_ast::{self as ast, AttrStyle, AttrVec, CaptureBy, ExprField, Lit, UnOp, DUMMY_NODE_ID};\n+use rustc_ast::{self as ast, AttrStyle, AttrVec, CaptureBy, ExprField, UnOp, DUMMY_NODE_ID};\n use rustc_ast::{AnonConst, BinOp, BinOpKind, FnDecl, FnRetTy, MacCall, Param, Ty, TyKind};\n use rustc_ast::{Arm, Async, BlockCheckMode, Expr, ExprKind, Label, Movability, RangeLimits};\n-use rustc_ast::{ClosureBinder, StmtKind};\n+use rustc_ast::{ClosureBinder, MetaItemLit, StmtKind};\n use rustc_ast_pretty::pprust;\n use rustc_errors::{\n     Applicability, Diagnostic, DiagnosticBuilder, ErrorGuaranteed, IntoDiagnostic, PResult,\n@@ -1631,7 +1631,7 @@ impl<'a> Parser<'a> {\n         &self,\n         lifetime: Ident,\n         err: impl FnOnce(&Self) -> DiagnosticBuilder<'a, ErrorGuaranteed>,\n-    ) -> ast::Lit {\n+    ) -> ast::MetaItemLit {\n         if let Some(mut diag) =\n             self.sess.span_diagnostic.steal_diagnostic(lifetime.span, StashKey::LifetimeIsChar)\n         {\n@@ -1653,7 +1653,7 @@ impl<'a> Parser<'a> {\n                 .emit();\n         }\n         let name = lifetime.without_first_quote().name;\n-        ast::Lit {\n+        ast::MetaItemLit {\n             token_lit: token::Lit::new(token::LitKind::Char, name, None),\n             kind: ast::LitKind::Char(name.as_str().chars().next().unwrap_or('_')),\n             span: lifetime.span,\n@@ -1768,8 +1768,8 @@ impl<'a> Parser<'a> {\n     /// Returns a string literal if the next token is a string literal.\n     /// In case of error returns `Some(lit)` if the next token is a literal with a wrong kind,\n     /// and returns `None` if the next token is not literal at all.\n-    pub fn parse_str_lit(&mut self) -> Result<ast::StrLit, Option<Lit>> {\n-        match self.parse_opt_ast_lit() {\n+    pub fn parse_str_lit(&mut self) -> Result<ast::StrLit, Option<MetaItemLit>> {\n+        match self.parse_opt_meta_item_lit() {\n             Some(lit) => match lit.kind {\n                 ast::LitKind::Str(symbol_unescaped, style) => Ok(ast::StrLit {\n                     style,\n@@ -1784,7 +1784,7 @@ impl<'a> Parser<'a> {\n         }\n     }\n \n-    fn handle_missing_lit(&mut self) -> PResult<'a, Lit> {\n+    fn handle_missing_lit(&mut self) -> PResult<'a, MetaItemLit> {\n         if let token::Interpolated(inner) = &self.token.kind {\n             let expr = match inner.as_ref() {\n                 token::NtExpr(expr) => Some(expr),\n@@ -1820,8 +1820,8 @@ impl<'a> Parser<'a> {\n             .or_else(|()| self.handle_missing_lit().map(|lit| (lit.token_lit, lit.span)))\n     }\n \n-    pub(super) fn parse_ast_lit(&mut self) -> PResult<'a, Lit> {\n-        self.parse_opt_ast_lit().ok_or(()).or_else(|()| self.handle_missing_lit())\n+    pub(super) fn parse_meta_item_lit(&mut self) -> PResult<'a, MetaItemLit> {\n+        self.parse_opt_meta_item_lit().ok_or(()).or_else(|()| self.handle_missing_lit())\n     }\n \n     fn recover_after_dot(&mut self) -> Option<Token> {\n@@ -1867,12 +1867,12 @@ impl<'a> Parser<'a> {\n \n     /// Matches `lit = true | false | token_lit`.\n     /// Returns `None` if the next token is not a literal.\n-    pub(super) fn parse_opt_ast_lit(&mut self) -> Option<Lit> {\n+    pub(super) fn parse_opt_meta_item_lit(&mut self) -> Option<MetaItemLit> {\n         let recovered = self.recover_after_dot();\n         let token = recovered.as_ref().unwrap_or(&self.token);\n         match token::Lit::from_token(token) {\n             Some(token_lit) => {\n-                match Lit::from_token_lit(token_lit, token.span) {\n+                match MetaItemLit::from_token_lit(token_lit, token.span) {\n                     Ok(lit) => {\n                         self.bump();\n                         Some(lit)\n@@ -1889,7 +1889,10 @@ impl<'a> Parser<'a> {\n                         let suffixless_lit = token::Lit::new(lit.kind, lit.symbol, None);\n                         let symbol = Symbol::intern(&suffixless_lit.to_string());\n                         let lit = token::Lit::new(token::Err, symbol, lit.suffix);\n-                        Some(Lit::from_token_lit(lit, span).unwrap_or_else(|_| unreachable!()))\n+                        Some(\n+                            MetaItemLit::from_token_lit(lit, span)\n+                                .unwrap_or_else(|_| unreachable!()),\n+                        )\n                     }\n                 }\n             }"}, {"sha": "ff1ddfd97dfc62dc52e183f64fb1280433d44ce7", "filename": "compiler/rustc_parse/src/parser/stmt.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -358,7 +358,7 @@ impl<'a> Parser<'a> {\n     /// report error for `let 1x = 123`\n     pub fn report_invalid_identifier_error(&mut self) -> PResult<'a, ()> {\n         if let token::Literal(lit) = self.token.uninterpolate().kind &&\n-            rustc_ast::Lit::from_token(&self.token).is_none() &&\n+            rustc_ast::MetaItemLit::from_token(&self.token).is_none() &&\n             (lit.kind == token::LitKind::Integer || lit.kind == token::LitKind::Float) &&\n             self.look_ahead(1, |t| matches!(t.kind, token::Eq) || matches!(t.kind, token::Colon ) ) {\n                 return Err(self.sess.create_err(InvalidIdentiferStartsWithNumber { span: self.token.span }));"}, {"sha": "59e564114e5cf0e390ed38585e5f83c0c2026425", "filename": "compiler/rustc_parse/src/validate_attr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fvalidate_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_parse%2Fsrc%2Fvalidate_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fvalidate_attr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -51,7 +51,7 @@ pub fn parse_meta<'a>(sess: &'a ParseSess, attr: &Attribute) -> PResult<'a, Meta\n             }\n             AttrArgs::Eq(_, AttrArgsEq::Ast(expr)) => {\n                 if let ast::ExprKind::Lit(token_lit) = expr.kind\n-                    && let Ok(lit) = ast::Lit::from_token_lit(token_lit, expr.span)\n+                    && let Ok(lit) = ast::MetaItemLit::from_token_lit(token_lit, expr.span)\n                 {\n                     if token_lit.suffix.is_some() {\n                         let mut err = sess.span_diagnostic.struct_span_err("}, {"sha": "2e2874dbccb9e4fb3749f901398f9310e9212f4b", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -8,7 +8,7 @@ use crate::errors::{\n     self, AttrApplication, DebugVisualizerUnreadable, InvalidAttrAtCrateLevel, ObjectLifetimeErr,\n     OnlyHasEffectOn, TransparentIncompatible, UnrecognizedReprHint,\n };\n-use rustc_ast::{ast, AttrStyle, Attribute, Lit, LitKind, MetaItemKind, NestedMetaItem};\n+use rustc_ast::{ast, AttrStyle, Attribute, LitKind, MetaItemKind, MetaItemLit, NestedMetaItem};\n use rustc_data_structures::fx::FxHashMap;\n use rustc_errors::{fluent, Applicability, MultiSpan};\n use rustc_expand::base::resolve_path;\n@@ -715,7 +715,7 @@ impl CheckAttrVisitor<'_> {\n         if let Some(values) = meta.meta_item_list() {\n             let mut errors = 0;\n             for v in values {\n-                match v.literal() {\n+                match v.lit() {\n                     Some(l) => match l.kind {\n                         LitKind::Str(s, _) => {\n                             if !self.check_doc_alias_value(v, s, hir_id, target, true, aliases) {\n@@ -1355,7 +1355,7 @@ impl CheckAttrVisitor<'_> {\n             return false;\n         };\n \n-        if matches!(&list[..], &[NestedMetaItem::Literal(Lit { kind: LitKind::Int(..), .. })]) {\n+        if matches!(&list[..], &[NestedMetaItem::Lit(MetaItemLit { kind: LitKind::Int(..), .. })]) {\n             true\n         } else {\n             self.tcx.sess.emit_err(errors::RustcLayoutScalarValidRangeArg { attr_span: attr.span });\n@@ -1418,7 +1418,7 @@ impl CheckAttrVisitor<'_> {\n         let arg_count = decl.inputs.len() as u128 + generics.params.len() as u128;\n         let mut invalid_args = vec![];\n         for meta in list {\n-            if let Some(LitKind::Int(val, _)) = meta.literal().map(|lit| &lit.kind) {\n+            if let Some(LitKind::Int(val, _)) = meta.lit().map(|lit| &lit.kind) {\n                 if *val >= arg_count {\n                     let span = meta.span();\n                     self.tcx.sess.emit_err(errors::RustcLegacyConstGenericsIndexExceed {"}, {"sha": "4ef89cfb2554fdbc13f0dde06cbb2582a81eeb30", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -1989,7 +1989,7 @@ impl<'a> Resolver<'a> {\n                     .find(|a| a.has_name(sym::rustc_legacy_const_generics))?;\n                 let mut ret = Vec::new();\n                 for meta in attr.meta_item_list()? {\n-                    match meta.literal()?.kind {\n+                    match meta.lit()?.kind {\n                         LitKind::Int(a, _) => ret.push(a as usize),\n                         _ => panic!(\"invalid arg index\"),\n                     }"}, {"sha": "1843a21205cfa65ef3de0f27c2b2391ac0b191b1", "filename": "src/librustdoc/clean/cfg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fcfg.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -50,7 +50,7 @@ impl Cfg {\n     ) -> Result<Option<Cfg>, InvalidCfgError> {\n         match nested_cfg {\n             NestedMetaItem::MetaItem(ref cfg) => Cfg::parse_without(cfg, exclude),\n-            NestedMetaItem::Literal(ref lit) => {\n+            NestedMetaItem::Lit(ref lit) => {\n                 Err(InvalidCfgError { msg: \"unexpected literal\", span: lit.span })\n             }\n         }"}, {"sha": "42328222fd3820a0b8023c8bb11681d0fd93b16b", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -893,7 +893,7 @@ fn clean_fn_decl_legacy_const_generics(func: &mut Function, attrs: &[ast::Attrib\n         .filter(|a| a.has_name(sym::rustc_legacy_const_generics))\n         .filter_map(|a| a.meta_item_list())\n     {\n-        for (pos, literal) in meta_item_list.iter().filter_map(|meta| meta.literal()).enumerate() {\n+        for (pos, literal) in meta_item_list.iter().filter_map(|meta| meta.lit()).enumerate() {\n             match literal.kind {\n                 ast::LitKind::Int(a, _) => {\n                     let gen = func.generics.params.remove(0);"}, {"sha": "ed4e9508f430999e603fb7417a1243d0fb88e6ce", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -1305,7 +1305,7 @@ impl Attributes {\n         for attr in self.other_attrs.lists(sym::doc).filter(|a| a.has_name(sym::alias)) {\n             if let Some(values) = attr.meta_item_list() {\n                 for l in values {\n-                    match l.literal().unwrap().kind {\n+                    match l.lit().unwrap().kind {\n                         ast::LitKind::Str(s, _) => {\n                             aliases.insert(s);\n                         }"}, {"sha": "018f10f258867872816e22b5f9604ee0cbc57a0f", "filename": "src/tools/clippy/clippy_lints/src/attrs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -6,7 +6,7 @@ use clippy_utils::msrvs;\n use clippy_utils::source::{first_line_of_span, is_present_in_source, snippet_opt, without_block_comments};\n use clippy_utils::{extract_msrv_attr, meets_msrv};\n use if_chain::if_chain;\n-use rustc_ast::{AttrKind, AttrStyle, Attribute, Lit, LitKind, MetaItemKind, NestedMetaItem};\n+use rustc_ast::{AttrKind, AttrStyle, Attribute, LitKind, MetaItemKind, MetaItemLit, NestedMetaItem};\n use rustc_errors::Applicability;\n use rustc_hir::{\n     Block, Expr, ExprKind, ImplItem, ImplItemKind, Item, ItemKind, StmtKind, TraitFn, TraitItem, TraitItemKind,\n@@ -576,7 +576,7 @@ fn check_attrs(cx: &LateContext<'_>, span: Span, name: Symbol, attrs: &[Attribut\n     }\n }\n \n-fn check_semver(cx: &LateContext<'_>, span: Span, lit: &Lit) {\n+fn check_semver(cx: &LateContext<'_>, span: Span, lit: &MetaItemLit) {\n     if let LitKind::Str(is, _) = lit.kind {\n         if Version::parse(is.as_str()).is_ok() {\n             return;"}, {"sha": "2ac703b957b86456b1784119dfae6d31324af1c4", "filename": "src/tools/rustfmt/src/attr.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -260,9 +260,7 @@ impl Rewrite for ast::NestedMetaItem {\n     fn rewrite(&self, context: &RewriteContext<'_>, shape: Shape) -> Option<String> {\n         match self {\n             ast::NestedMetaItem::MetaItem(ref meta_item) => meta_item.rewrite(context, shape),\n-            ast::NestedMetaItem::Literal(ref l) => {\n-                rewrite_literal(context, l.token_lit, l.span, shape)\n-            }\n+            ast::NestedMetaItem::Lit(ref l) => rewrite_literal(context, l.token_lit, l.span, shape),\n         }\n     }\n }\n@@ -527,14 +525,19 @@ pub(crate) trait MetaVisitor<'ast> {\n \n     fn visit_meta_word(&mut self, _meta_item: &'ast ast::MetaItem) {}\n \n-    fn visit_meta_name_value(&mut self, _meta_item: &'ast ast::MetaItem, _lit: &'ast ast::Lit) {}\n+    fn visit_meta_name_value(\n+        &mut self,\n+        _meta_item: &'ast ast::MetaItem,\n+        _lit: &'ast ast::MetaItemLit,\n+    ) {\n+    }\n \n     fn visit_nested_meta_item(&mut self, nm: &'ast ast::NestedMetaItem) {\n         match nm {\n             ast::NestedMetaItem::MetaItem(ref meta_item) => self.visit_meta_item(meta_item),\n-            ast::NestedMetaItem::Literal(ref lit) => self.visit_literal(lit),\n+            ast::NestedMetaItem::Lit(ref lit) => self.visit_meta_item_lit(lit),\n         }\n     }\n \n-    fn visit_literal(&mut self, _lit: &'ast ast::Lit) {}\n+    fn visit_meta_item_lit(&mut self, _lit: &'ast ast::MetaItemLit) {}\n }"}, {"sha": "48431693332a619211a269c29da2669ed3d78ae3", "filename": "src/tools/rustfmt/src/modules/visitor.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Fmodules%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Fmodules%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fmodules%2Fvisitor.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -84,23 +84,27 @@ impl PathVisitor {\n }\n \n impl<'ast> MetaVisitor<'ast> for PathVisitor {\n-    fn visit_meta_name_value(&mut self, meta_item: &'ast ast::MetaItem, lit: &'ast ast::Lit) {\n+    fn visit_meta_name_value(\n+        &mut self,\n+        meta_item: &'ast ast::MetaItem,\n+        lit: &'ast ast::MetaItemLit,\n+    ) {\n         if meta_item.has_name(Symbol::intern(\"path\")) && lit.kind.is_str() {\n-            self.paths.push(lit_to_str(lit));\n+            self.paths.push(meta_item_lit_to_str(lit));\n         }\n     }\n }\n \n #[cfg(not(windows))]\n-fn lit_to_str(lit: &ast::Lit) -> String {\n+fn meta_item_lit_to_str(lit: &ast::MetaItemLit) -> String {\n     match lit.kind {\n         ast::LitKind::Str(symbol, ..) => symbol.to_string(),\n         _ => unreachable!(),\n     }\n }\n \n #[cfg(windows)]\n-fn lit_to_str(lit: &ast::Lit) -> String {\n+fn meta_item_lit_to_str(lit: &ast::MetaItemLit) -> String {\n     match lit.kind {\n         ast::LitKind::Str(symbol, ..) => symbol.as_str().replace(\"/\", \"\\\\\"),\n         _ => unreachable!(),"}, {"sha": "af0b95430a1979c9098d3facf79987cf453121ad", "filename": "src/tools/rustfmt/src/overflow.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -125,7 +125,7 @@ impl<'a> OverflowableItem<'a> {\n             OverflowableItem::MacroArg(MacroArg::Keyword(..)) => true,\n             OverflowableItem::MacroArg(MacroArg::Expr(expr)) => is_simple_expr(expr),\n             OverflowableItem::NestedMetaItem(nested_meta_item) => match nested_meta_item {\n-                ast::NestedMetaItem::Literal(..) => true,\n+                ast::NestedMetaItem::Lit(..) => true,\n                 ast::NestedMetaItem::MetaItem(ref meta_item) => {\n                     matches!(meta_item.kind, ast::MetaItemKind::Word)\n                 }\n@@ -169,7 +169,7 @@ impl<'a> OverflowableItem<'a> {\n             },\n             OverflowableItem::NestedMetaItem(nested_meta_item) if len == 1 => {\n                 match nested_meta_item {\n-                    ast::NestedMetaItem::Literal(..) => false,\n+                    ast::NestedMetaItem::Lit(..) => false,\n                     ast::NestedMetaItem::MetaItem(..) => true,\n                 }\n             }"}, {"sha": "3e884419f1a32c84406947b74ae678979577bfef", "filename": "src/tools/rustfmt/src/utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ec33e929f60177a02ae3d059482e3743f1d8cc/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs?ref=63ec33e929f60177a02ae3d059482e3743f1d8cc", "patch": "@@ -263,7 +263,7 @@ fn is_skip(meta_item: &MetaItem) -> bool {\n fn is_skip_nested(meta_item: &NestedMetaItem) -> bool {\n     match meta_item {\n         NestedMetaItem::MetaItem(ref mi) => is_skip(mi),\n-        NestedMetaItem::Literal(_) => false,\n+        NestedMetaItem::Lit(_) => false,\n     }\n }\n "}]}