{"sha": "24dc8377df06407a84f3858ab98ba0a175c11bc7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0ZGM4Mzc3ZGYwNjQwN2E4NGYzODU4YWI5OGJhMGExNzVjMTFiYzc=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-06-05T19:56:28Z"}, "committer": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-06-05T19:56:28Z"}, "message": "Merge pull request #987 from Manishearth/fix-985\n\nFix false-positive in `USELESS_LET_IF_SEQ`", "tree": {"sha": "dc3d4b35def5d727cc69e4fdfaa09bc64b262db7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc3d4b35def5d727cc69e4fdfaa09bc64b262db7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24dc8377df06407a84f3858ab98ba0a175c11bc7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24dc8377df06407a84f3858ab98ba0a175c11bc7", "html_url": "https://github.com/rust-lang/rust/commit/24dc8377df06407a84f3858ab98ba0a175c11bc7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24dc8377df06407a84f3858ab98ba0a175c11bc7/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3436699ed6249e655bd8da4fd4630b646db2f93f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3436699ed6249e655bd8da4fd4630b646db2f93f", "html_url": "https://github.com/rust-lang/rust/commit/3436699ed6249e655bd8da4fd4630b646db2f93f"}, {"sha": "8497e3bacbbf6a729ced38f5481f193c927a164e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8497e3bacbbf6a729ced38f5481f193c927a164e", "html_url": "https://github.com/rust-lang/rust/commit/8497e3bacbbf6a729ced38f5481f193c927a164e"}], "stats": {"total": 49, "additions": 41, "deletions": 8}, "files": [{"sha": "166990b3d3b925a98bc78efdb325cb711196d0c3", "filename": "CHANGELOG.md", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/24dc8377df06407a84f3858ab98ba0a175c11bc7/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/24dc8377df06407a84f3858ab98ba0a175c11bc7/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=24dc8377df06407a84f3858ab98ba0a175c11bc7", "patch": "@@ -1,6 +1,9 @@\n # Change Log\n All notable changes to this project will be documented in this file.\n \n+## 0.0.73 \u2014 2016-06-05\n+* Fix false positives in [`useless_let_if_seq`]\n+\n ## 0.0.72 \u2014 2016-06-04\n * Fix false positives in [`useless_let_if_seq`]\n "}, {"sha": "aadc4e8e0412e28e6732e4562c537b918be0c054", "filename": "Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/24dc8377df06407a84f3858ab98ba0a175c11bc7/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24dc8377df06407a84f3858ab98ba0a175c11bc7/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=24dc8377df06407a84f3858ab98ba0a175c11bc7", "patch": "@@ -1,6 +1,6 @@\n [package]\n name = \"clippy\"\n-version = \"0.0.72\"\n+version = \"0.0.73\"\n authors = [\n \t\"Manish Goregaokar <manishsmail@gmail.com>\",\n \t\"Andre Bogus <bogusandre@gmail.com>\",\n@@ -30,7 +30,7 @@ toml = \"0.1\"\n unicode-normalization = \"0.1\"\n quine-mc_cluskey = \"0.2.2\"\n # begin automatic update\n-clippy_lints = { version = \"0.0.72\", path = \"clippy_lints\" }\n+clippy_lints = { version = \"0.0.73\", path = \"clippy_lints\" }\n # end automatic update\n rustc-serialize = \"0.3\"\n "}, {"sha": "d0398897bea6f553bdf7d7359663b2af2718f530", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/24dc8377df06407a84f3858ab98ba0a175c11bc7/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24dc8377df06407a84f3858ab98ba0a175c11bc7/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=24dc8377df06407a84f3858ab98ba0a175c11bc7", "patch": "@@ -1,7 +1,7 @@\n [package]\n name = \"clippy_lints\"\n # begin automatic update\n-version = \"0.0.72\"\n+version = \"0.0.73\"\n # end automatic update\n authors = [\n \t\"Manish Goregaokar <manishsmail@gmail.com>\","}, {"sha": "a85cb52f2dc6e0d4687750474fb0ca879710c2e9", "filename": "clippy_lints/src/let_if_seq.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/24dc8377df06407a84f3858ab98ba0a175c11bc7/clippy_lints%2Fsrc%2Flet_if_seq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24dc8377df06407a84f3858ab98ba0a175c11bc7/clippy_lints%2Fsrc%2Flet_if_seq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flet_if_seq.rs?ref=24dc8377df06407a84f3858ab98ba0a175c11bc7", "patch": "@@ -69,12 +69,9 @@ impl LateLintPass for LetIfSeq {\n                 let Some(def) = cx.tcx.def_map.borrow().get(&decl.pat.id),\n                 let hir::StmtExpr(ref if_, _) = expr.node,\n                 let hir::ExprIf(ref cond, ref then, ref else_) = if_.node,\n-                {\n-                    let mut v = UsedVisitor { cx: cx, id: def.def_id(), used: false };\n-                    hir::intravisit::walk_expr(&mut v, cond);\n-                    !v.used\n-                },\n+                !used_in_expr(cx, def.def_id(), cond),\n                 let Some(value) = check_assign(cx, def.def_id(), then),\n+                !used_in_expr(cx, def.def_id(), value),\n             ], {\n                 let span = codemap::mk_sp(stmt.span.lo, if_.span.hi);\n \n@@ -179,3 +176,13 @@ fn check_assign<'e>(cx: &LateContext, decl: hir::def_id::DefId, block: &'e hir::\n \n     None\n }\n+\n+fn used_in_expr(cx: &LateContext, id: hir::def_id::DefId, expr: &hir::Expr) -> bool {\n+    let mut v = UsedVisitor {\n+        cx: cx,\n+        id: id,\n+        used: false\n+    };\n+    hir::intravisit::walk_expr(&mut v, expr);\n+    v.used\n+}"}, {"sha": "0b086faf077d45ed565f96baa8a616e87f3b5116", "filename": "tests/compile-fail/let_if_seq.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/24dc8377df06407a84f3858ab98ba0a175c11bc7/tests%2Fcompile-fail%2Flet_if_seq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24dc8377df06407a84f3858ab98ba0a175c11bc7/tests%2Fcompile-fail%2Flet_if_seq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Flet_if_seq.rs?ref=24dc8377df06407a84f3858ab98ba0a175c11bc7", "patch": "@@ -5,6 +5,27 @@\n #![deny(useless_let_if_seq)]\n \n fn f() -> bool { true }\n+fn g(x: i32) -> i32 { x + 1 }\n+\n+fn issue985() -> i32 {\n+    let mut x = 42;\n+    if f() {\n+        x = g(x);\n+    }\n+\n+    x\n+}\n+\n+fn issue985_alt() -> i32 {\n+    let mut x = 42;\n+    if f() {\n+        f();\n+    } else {\n+        x = g(x);\n+    }\n+\n+    x\n+}\n \n fn issue975() -> String {\n     let mut udn = \"dummy\".to_string();\n@@ -30,6 +51,8 @@ fn early_return() -> u8 {\n fn main() {\n     early_return();\n     issue975();\n+    issue985();\n+    issue985_alt();\n \n     let mut foo = 0;\n     //~^ ERROR `if _ { .. } else { .. }` is an expression"}]}