{"sha": "86747a9952d9d112f64dd2671cfa8694a7822158", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2NzQ3YTk5NTJkOWQxMTJmNjRkZDI2NzFjZmE4Njk0YTc4MjIxNTg=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-04-20T00:31:43Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-04-25T02:31:01Z"}, "message": "Force link with an absolute rpath when using sanitizer on macOS.", "tree": {"sha": "3366356ed61807e76d94b22f5cf02c3cc1366057", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3366356ed61807e76d94b22f5cf02c3cc1366057"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86747a9952d9d112f64dd2671cfa8694a7822158", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJY/rTlAAoJEP72yAUdDgE8yWkP/185IS5FXNXEgcJHIlP18seU\nVVKdIpWdNdFf123w79GRUacytZxv9wjNdX3mkqJHvj1sdr2ifbTmtQ69ZirfoOPg\nTPDryBw8iAVJEE08x7up7ERSM5w7F8QOXyLHgvLwoK0eCyc8/jkC1GbIHcir+kmt\nv7tKkRfEqvYDZsPm2te4akEo42/fmHdvIaendXbWvmGgrdWjbmNpr5o3lBSouoM2\nXD37XOpecr5GDwmtks1OSwngtiwK2WbOEDP0xbo6bl1MCyosx1isrDVZ05elsBCd\n2u7UERn5FwodxsTD3gfXJL0g4nqqoDWfg1CynPrZeemDSgTHqFEElCaHShZGm0cz\n8Ouo9Xqk8VXJaljtuy39DAezpx5NojRUc8tEYhwCdVrjOT6lSh5yT/daeRGthx5R\nrcwrcK/m/uAbWMalLgmcrjnyP4NPDStDkb8NrYOgxhhWfPFVcwEklZEZMell9Ay4\npjbbXbJtm9ZlUjslwbEeCxUbbJvokH4nQiB76ztM8XpeAXnIEzudkUfj83We0WgQ\nXcmj2ImLRnbAuY61x4vLxZaMq9lYCUyusACD6OdqGPkGb2HS9QTRLBdVbGcJbNsR\nUp3JFWKs/Rdae4wgaSz5267pZlow8GbAxpoQwRE0e0bwho8OQOLZalPq4vDt52Us\n+VVUcjqW/zVfYL5dGsgZ\n=Fa3q\n-----END PGP SIGNATURE-----", "payload": "tree 3366356ed61807e76d94b22f5cf02c3cc1366057\nparent 00dff0aa59ce2d71957ca16a4444c303910686a3\nauthor kennytm <kennytm@gmail.com> 1492648303 +0800\ncommitter kennytm <kennytm@gmail.com> 1493087461 +0800\n\nForce link with an absolute rpath when using sanitizer on macOS.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86747a9952d9d112f64dd2671cfa8694a7822158", "html_url": "https://github.com/rust-lang/rust/commit/86747a9952d9d112f64dd2671cfa8694a7822158", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86747a9952d9d112f64dd2671cfa8694a7822158/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00dff0aa59ce2d71957ca16a4444c303910686a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/00dff0aa59ce2d71957ca16a4444c303910686a3", "html_url": "https://github.com/rust-lang/rust/commit/00dff0aa59ce2d71957ca16a4444c303910686a3"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "e42e69d2a76e27979718317626a86ee2a51df1de", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/86747a9952d9d112f64dd2671cfa8694a7822158/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86747a9952d9d112f64dd2671cfa8694a7822158/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=86747a9952d9d112f64dd2671cfa8694a7822158", "patch": "@@ -1122,6 +1122,19 @@ fn add_upstream_rust_crates(cmd: &mut Linker,\n                               cnum: CrateNum) {\n         let src = sess.cstore.used_crate_source(cnum);\n         let cratepath = &src.rlib.unwrap().0;\n+\n+        if sess.target.target.options.is_like_osx {\n+            // On Apple platforms, the sanitizer is always built as a dylib, and\n+            // LLVM will link to `@rpath/*.dylib`, so we need to specify an\n+            // rpath to the library as well (the rpath should be absolute, see\n+            // PR #41352 for details).\n+            //\n+            // FIXME: Remove this logic into librustc_*san once Cargo supports it\n+            let rpath = cratepath.parent().unwrap();\n+            let rpath = rpath.to_str().expect(\"non-utf8 component in path\");\n+            cmd.args(&[\"-Wl,-rpath\".into(), \"-Xlinker\".into(), rpath.into()]);\n+        }\n+\n         let dst = tmpdir.join(cratepath.file_name().unwrap());\n         let cfg = archive_config(sess, &dst, Some(cratepath));\n         let mut archive = ArchiveBuilder::new(cfg);"}]}