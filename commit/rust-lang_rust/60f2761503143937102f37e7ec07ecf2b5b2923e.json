{"sha": "60f2761503143937102f37e7ec07ecf2b5b2923e", "node_id": "C_kwDOAAsO6NoAKDYwZjI3NjE1MDMxNDM5MzcxMDJmMzdlN2VjMDdlY2YyYjViMjkyM2U", "commit": {"author": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2023-03-16T09:19:14Z"}, "committer": {"name": "Pietro Albini", "email": "pietro.albini@ferrous-systems.com", "date": "2023-04-03T07:30:36Z"}, "message": "add support for ignore-llvm-version", "tree": {"sha": "b48280b6161f504ddb0217bf3021ae1170fec5a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b48280b6161f504ddb0217bf3021ae1170fec5a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/60f2761503143937102f37e7ec07ecf2b5b2923e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMycKYjxLY0eb13b7zXazX3c0dp4FAmQqgJwACgkQzXazX3c0\ndp5Aog//XB6ieU4L4rAcnOsegZQs6bJXPVfFO07nMqK5qMxcQKAVHaEBmBWVPI9E\nlFWs3i6gQczsC9NjhNQrowikcVv+/Vq55o1uBjxXUsyD2CXC9TTMk+0J7rKhrEb/\n3adqy8vX2lZ+AkBzPiN2GhvWxk2YD5U03tK7UybGpXYN9UQjEnL2Ss6VaOSWSDrd\nCONU6+48ZLUZzjcZOovCsBYXhiOgqOOKBqWsWqqWVaPt0oLpXOhMx+id7QXpiAk3\nPf5kpbqtqCP3clLgpkV0JlhxspruSi+HGB/K9P9zAZPGLPHTFqB/YmTeQO7Xxf8X\nxWGthaIk1xTjpzl6WXExIUcb8cRxorOd8XefbfZzZPZEMTyu9331E82rUzsl+Gqq\nCqWcisqMm398M0T45ZbSAzLOmmtxt/uMGdvJdnp+iFxVSIqWRV/LKDjTFKqrtbEb\nIFTyWxgGWF99yeXcgCZktwCUoTDDvqWNaQjXfPrxhbLwzZpl3em7jN8+S5Gs9HuN\n6Y/bRLcUtRsvvoDpRVunNCyjd7QetDHDsc+ONloOxxOAp+NrnRJMvMWaKhQbc9Kq\ndTig9a38L92ojIcAQ09WMwHrzIOAaTiH9/zYrDorqZB8yZdnOI+Cm79VjLa6Bja2\nCjNqZktX8iDJqMj5VGljE7tKkb8yRnZ5Ti7Zedey3YbAzktFcCA=\n=o4Ty\n-----END PGP SIGNATURE-----", "payload": "tree b48280b6161f504ddb0217bf3021ae1170fec5a1\nparent 54c4762a86e4c278f8aa97d7136997cd77d4ede7\nauthor Pietro Albini <pietro.albini@ferrous-systems.com> 1678958354 +0100\ncommitter Pietro Albini <pietro.albini@ferrous-systems.com> 1680507036 +0200\n\nadd support for ignore-llvm-version\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/60f2761503143937102f37e7ec07ecf2b5b2923e", "html_url": "https://github.com/rust-lang/rust/commit/60f2761503143937102f37e7ec07ecf2b5b2923e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/60f2761503143937102f37e7ec07ecf2b5b2923e/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54c4762a86e4c278f8aa97d7136997cd77d4ede7", "url": "https://api.github.com/repos/rust-lang/rust/commits/54c4762a86e4c278f8aa97d7136997cd77d4ede7", "html_url": "https://github.com/rust-lang/rust/commit/54c4762a86e4c278f8aa97d7136997cd77d4ede7"}], "stats": {"total": 22, "additions": 15, "deletions": 7}, "files": [{"sha": "ffb81dfdcdb68a3d79d97da522509022b076d686", "filename": "src/tools/compiletest/src/header/cfg.rs", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/60f2761503143937102f37e7ec07ecf2b5b2923e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60f2761503143937102f37e7ec07ecf2b5b2923e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader%2Fcfg.rs?ref=60f2761503143937102f37e7ec07ecf2b5b2923e", "patch": "@@ -171,14 +171,22 @@ pub(super) fn parse_cfg_name_directive<'a>(\n         message: \"when comparing with {name}\",\n     }\n \n-    // Don't error out for ignore-tidy-* diretives, as those are not handled by compiletest.\n-    if prefix == \"ignore\" && name.starts_with(\"tidy-\") && outcome == MatchOutcome::Invalid {\n-        outcome = MatchOutcome::External;\n-    }\n+    if prefix == \"ignore\" && outcome == MatchOutcome::Invalid {\n+        // Don't error out for ignore-tidy-* diretives, as those are not handled by compiletest.\n+        if name.starts_with(\"tidy-\") {\n+            outcome = MatchOutcome::External;\n+        }\n \n-    // Don't error out for ignore-pass, as that is handled elsewhere.\n-    if prefix == \"ignore\" && name == \"pass\" && outcome == MatchOutcome::Invalid {\n-        outcome = MatchOutcome::External;\n+        // Don't error out for ignore-pass, as that is handled elsewhere.\n+        if name == \"pass\" {\n+            outcome = MatchOutcome::External;\n+        }\n+\n+        // Don't error out for ignore-llvm-version, that has a custom syntax and is handled\n+        // elsewhere.\n+        if name == \"llvm-version\" {\n+            outcome = MatchOutcome::External;\n+        }\n     }\n \n     ParsedNameDirective {"}]}