{"sha": "55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1ZmJlZDNkOGQ3MDc4YmZkMzg2NGU2NGNjMDQ0Y2JlODc2YzVkMWE=", "commit": {"author": {"name": "Lindsey Kuper", "email": "lkuper@mozilla.com", "date": "2011-03-29T22:51:53Z"}, "committer": {"name": "Lindsey Kuper", "email": "lkuper@mozilla.com", "date": "2011-03-29T22:59:15Z"}, "message": "Beginnings of support for magical self prefix; nothing profound happening yet.", "tree": {"sha": "3c0a53f8f59dbda781fda2a7ad1e5afcce719de2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c0a53f8f59dbda781fda2a7ad1e5afcce719de2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "html_url": "https://github.com/rust-lang/rust/commit/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/comments", "author": {"login": "lkuper", "id": 535218, "node_id": "MDQ6VXNlcjUzNTIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/535218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkuper", "html_url": "https://github.com/lkuper", "followers_url": "https://api.github.com/users/lkuper/followers", "following_url": "https://api.github.com/users/lkuper/following{/other_user}", "gists_url": "https://api.github.com/users/lkuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkuper/subscriptions", "organizations_url": "https://api.github.com/users/lkuper/orgs", "repos_url": "https://api.github.com/users/lkuper/repos", "events_url": "https://api.github.com/users/lkuper/events{/privacy}", "received_events_url": "https://api.github.com/users/lkuper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lkuper", "id": 535218, "node_id": "MDQ6VXNlcjUzNTIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/535218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkuper", "html_url": "https://github.com/lkuper", "followers_url": "https://api.github.com/users/lkuper/followers", "following_url": "https://api.github.com/users/lkuper/following{/other_user}", "gists_url": "https://api.github.com/users/lkuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkuper/subscriptions", "organizations_url": "https://api.github.com/users/lkuper/orgs", "repos_url": "https://api.github.com/users/lkuper/repos", "events_url": "https://api.github.com/users/lkuper/events{/privacy}", "received_events_url": "https://api.github.com/users/lkuper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6490a6f03dd997d7cb801dff9d48a56b336fccc", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6490a6f03dd997d7cb801dff9d48a56b336fccc", "html_url": "https://github.com/rust-lang/rust/commit/f6490a6f03dd997d7cb801dff9d48a56b336fccc"}], "stats": {"total": 57, "additions": 56, "deletions": 1}, "files": [{"sha": "9e7c3cc144e5d2451be2d4f99ef140672ca086fa", "filename": "src/comp/front/ast.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Fast.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -252,6 +252,7 @@ tag expr_ {\n     expr_tup(vec[elt], ann);\n     expr_rec(vec[field], option.t[@expr], ann);\n     expr_call(@expr, vec[@expr], ann);\n+    expr_call_self(@expr, vec[@expr], ann);\n     expr_bind(@expr, vec[option.t[@expr]], ann);\n     expr_spawn(spawn_dom, option.t[str], @expr, vec[@expr], ann);\n     expr_binary(binop, @expr, @expr, ann);"}, {"sha": "86b872da708d51c59255af39a7e3afbb0a8bbba5", "filename": "src/comp/front/lexer.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Flexer.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -169,6 +169,7 @@ impure fn new_reader(io.reader rdr, str filename) -> reader\n     keywords.insert(\"any\", token.ANY);\n \n     keywords.insert(\"obj\", token.OBJ);\n+    keywords.insert(\"self\", token.SELF);\n \n     keywords.insert(\"port\", token.PORT);\n     keywords.insert(\"chan\", token.CHAN);"}, {"sha": "25c9f4a50fa62b273eafa03df85a2e01e04dd26d", "filename": "src/comp/front/parser.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Fparser.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -883,6 +883,20 @@ impure fn parse_bottom_expr(parser p) -> @ast.expr {\n             ex = ast.expr_chan(e, ast.ann_none);\n         }\n \n+        case (token.SELF) {\n+            p.bump();\n+            expect(p, token.DOT);\n+            // The rest is a call expression.\n+            auto e = parse_bottom_expr(p);\n+            auto pf = parse_expr;\n+            auto es = parse_seq[@ast.expr](token.LPAREN,\n+                                           token.RPAREN,\n+                                           some(token.COMMA),\n+                                           pf, p);\n+            hi = es.span;\n+            auto ex = ast.expr_call_self(e, es.node, ast.ann_none);\n+        }\n+\n         case (_) {\n             auto lit = parse_lit(p);\n             hi = lit.span;\n@@ -1646,6 +1660,7 @@ fn stmt_ends_with_semi(@ast.stmt stmt) -> bool {\n                 case (ast.expr_tup(_,_))        { ret true; }\n                 case (ast.expr_rec(_,_,_))      { ret true; }\n                 case (ast.expr_call(_,_,_))     { ret true; }\n+                case (ast.expr_call_self(_,_,_)){ ret true; }\n                 case (ast.expr_binary(_,_,_,_)) { ret true; }\n                 case (ast.expr_unary(_,_,_))    { ret true; }\n                 case (ast.expr_lit(_,_))        { ret true; }"}, {"sha": "5ac9d662f1cfe9e59a2582937ea12e960c5abdef", "filename": "src/comp/front/token.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Ftoken.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Ffront%2Ftoken.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Ftoken.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -160,8 +160,9 @@ tag token {\n     FN;\n     ITER;\n \n-    /* Object type */\n+    /* Object type and related keywords */\n     OBJ;\n+    SELF;\n \n     /* Comm and task types */\n     CHAN;"}, {"sha": "d1d7c5e30f80633a6dafa6956128bf057b44fc9a", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -757,6 +757,7 @@ fn expr_ty(@ast.expr expr) -> @t {\n         case (ast.expr_rec(_, _, ?ann))       { ret ann_to_type(ann); }\n         case (ast.expr_bind(_, _, ?ann))      { ret ann_to_type(ann); }\n         case (ast.expr_call(_, _, ?ann))      { ret ann_to_type(ann); }\n+        case (ast.expr_call_self(_, _, ?ann)) { ret ann_to_type(ann); }\n         case (ast.expr_spawn(_, _, _, _, ?ann))\n                                               { ret ann_to_type(ann); }\n         case (ast.expr_binary(_, _, _, ?ann)) { ret ann_to_type(ann); }"}, {"sha": "daab4b49aee992a4cab5cbd169bd010e7740fc76", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -1312,6 +1312,13 @@ fn demand_expr_full(&@fn_ctxt fcx, @ty.t expected, @ast.expr e,\n                                  ann_to_type(ann), adk);\n             e_1 = ast.expr_call(sube, es, ast.ann_type(t, none[vec[@ty.t]]));\n         }\n+        case (ast.expr_call_self(?sube, ?es, ?ann)) {\n+            auto t = demand_full(fcx, e.span, expected,\n+                                 ann_to_type(ann), adk);\n+            e_1 = ast.expr_call_self(sube, \n+                                     es, \n+                                     ast.ann_type(t, none[vec[@ty.t]]));\n+        }\n         case (ast.expr_binary(?bop, ?lhs, ?rhs, ?ann)) {\n             auto t = demand(fcx, e.span, expected, ann_to_type(ann));\n             e_1 = ast.expr_binary(bop, lhs, rhs,"}, {"sha": "01c4ea14de32a10481f855c734559e53ffa25100", "filename": "src/test/compile-fail/self-missing-method.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Ftest%2Fcompile-fail%2Fself-missing-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Ftest%2Fcompile-fail%2Fself-missing-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fself-missing-method.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -0,0 +1,13 @@\n+// xfail-boot\n+// error-pattern:expecting ., found (\n+fn main() {\n+\n+  obj foo() {\n+      fn m() {\n+          self();\n+      }\n+  }\n+  \n+  auto a = foo;\n+  a.m();\n+}"}, {"sha": "741624fb6b23e688701e8c2a30692fff9da9f9eb", "filename": "src/test/run-pass/obj-self.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Ftest%2Frun-pass%2Fobj-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55fbed3d8d7078bfd3864e64cc044cbe876c5d1a/src%2Ftest%2Frun-pass%2Fobj-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fobj-self.rs?ref=55fbed3d8d7078bfd3864e64cc044cbe876c5d1a", "patch": "@@ -0,0 +1,16 @@\n+// xfail-boot\n+fn main() {\n+\n+  obj foo() {\n+      fn m1() {\n+          log \"hi!\";\n+      }\n+      fn m2() {\n+          self.m1();\n+      }\n+  }\n+  \n+  auto a = foo();\n+  a.m1();\n+  a.m2();\n+}"}]}