{"sha": "4161a67c1bf0215523738e419b996ed5d2ea8f97", "node_id": "C_kwDOAAsO6NoAKDQxNjFhNjdjMWJmMDIxNTUyMzczOGU0MTliOTk2ZWQ1ZDJlYThmOTc", "commit": {"author": {"name": "CrazyRoka", "email": "rokarostuk@gmail.com", "date": "2021-12-09T11:49:07Z"}, "committer": {"name": "CrazyRoka", "email": "rokarostuk@gmail.com", "date": "2021-12-16T16:57:59Z"}, "message": "Added dropdown directive to theme-selector", "tree": {"sha": "eafdc58b17f726fdc2e397fb00cf9097c8e5238a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eafdc58b17f726fdc2e397fb00cf9097c8e5238a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4161a67c1bf0215523738e419b996ed5d2ea8f97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4161a67c1bf0215523738e419b996ed5d2ea8f97", "html_url": "https://github.com/rust-lang/rust/commit/4161a67c1bf0215523738e419b996ed5d2ea8f97", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4161a67c1bf0215523738e419b996ed5d2ea8f97/comments", "author": {"login": "CrazyRoka", "id": 19844144, "node_id": "MDQ6VXNlcjE5ODQ0MTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/19844144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CrazyRoka", "html_url": "https://github.com/CrazyRoka", "followers_url": "https://api.github.com/users/CrazyRoka/followers", "following_url": "https://api.github.com/users/CrazyRoka/following{/other_user}", "gists_url": "https://api.github.com/users/CrazyRoka/gists{/gist_id}", "starred_url": "https://api.github.com/users/CrazyRoka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CrazyRoka/subscriptions", "organizations_url": "https://api.github.com/users/CrazyRoka/orgs", "repos_url": "https://api.github.com/users/CrazyRoka/repos", "events_url": "https://api.github.com/users/CrazyRoka/events{/privacy}", "received_events_url": "https://api.github.com/users/CrazyRoka/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CrazyRoka", "id": 19844144, "node_id": "MDQ6VXNlcjE5ODQ0MTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/19844144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CrazyRoka", "html_url": "https://github.com/CrazyRoka", "followers_url": "https://api.github.com/users/CrazyRoka/followers", "following_url": "https://api.github.com/users/CrazyRoka/following{/other_user}", "gists_url": "https://api.github.com/users/CrazyRoka/gists{/gist_id}", "starred_url": "https://api.github.com/users/CrazyRoka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CrazyRoka/subscriptions", "organizations_url": "https://api.github.com/users/CrazyRoka/orgs", "repos_url": "https://api.github.com/users/CrazyRoka/repos", "events_url": "https://api.github.com/users/CrazyRoka/events{/privacy}", "received_events_url": "https://api.github.com/users/CrazyRoka/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb531320ebe6c3ac6798bee4201f33741aed8fdc", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb531320ebe6c3ac6798bee4201f33741aed8fdc", "html_url": "https://github.com/rust-lang/rust/commit/bb531320ebe6c3ac6798bee4201f33741aed8fdc"}], "stats": {"total": 133, "additions": 79, "deletions": 54}, "files": [{"sha": "13f280799eb39e25616475907f6e50b4000cc2cf", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 79, "deletions": 54, "changes": 133, "blob_url": "https://github.com/rust-lang/rust/blob/4161a67c1bf0215523738e419b996ed5d2ea8f97/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/4161a67c1bf0215523738e419b996ed5d2ea8f97/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=4161a67c1bf0215523738e419b996ed5d2ea8f97", "patch": "@@ -38,7 +38,6 @@\n         .dropdown-menu .checkbox {\n             width: 100%;\n             display: block;\n-            padding: 3px 20px;\n             clear: both;\n             font-weight: 400;\n             line-height: 1.42857143;\n@@ -47,8 +46,8 @@\n          }\n \n          .dropdown-menu .checkbox label {\n-             padding-left: 0;\n-             width: 100%;\n+            padding: 3px 20px;\n+            width: 100%;\n          }\n \n          .dropdown-menu .checkbox input {\n@@ -209,13 +208,17 @@\n             --inline-code-bg: #191f26;\n         }\n \n+        .theme-dropdown {\n+            position: absolute;\n+            margin: 0.7em;\n+            z-index: 10;\n+        }\n+\n         /* Applying the mdBook theme */\n         .theme-icon {\n-            position: absolute;\n             text-align: center;\n             width: 2em;\n             height: 2em;\n-            margin: 0.7em;\n             line-height: 2em;\n             border: solid 1px var(--icons);\n             border-radius: 5px;\n@@ -226,24 +229,28 @@\n             background: var(--theme-hover);\n         }\n         .theme-choice {\n-            position: absolute;\n-            margin-top: calc(2em + 0.7em);\n-            margin-left: 0.7em;\n+            display: none;\n             list-style: none;\n             border: 1px solid var(--theme-popup-border);\n             border-radius: 5px;\n             color: var(--fg);\n             background: var(--theme-popup-bg);\n             padding: 0 0;\n-            z-index: 10;\n+            overflow: hidden;\n         }\n-        .theme-choice > li {\n+\n+        .theme-dropdown.open .theme-choice {\n+            display: block;\n+        }\n+\n+        .theme-choice>li {\n             padding: 5px 10px;\n             font-size: 0.8em;\n             user-select: none;\n             cursor: pointer;\n         }\n-        .theme-choice > li:hover {\n+\n+        .theme-choice>li:hover {\n             background: var(--theme-hover);\n         }\n \n@@ -307,15 +314,13 @@\n \n     </style>\n </head>\n-<body ng-app=\"clippy\" ng-controller=\"lintList\" ng-click=\"toggleDropdown(undefined, $event)\">\n-    <div id=\"theme-icon\" class=\"theme-icon\">&#128396;</div>\n-    <ul id=\"theme-menu\" class=\"theme-choice\" style=\"display: none;\">\n-        <li id=\"light\">Light</li>\n-        <li id=\"rust\">Rust</li>\n-        <li id=\"coal\">Coal</li>\n-        <li id=\"navy\">Navy</li>\n-        <li id=\"ayu\">Ayu</li>\n-    </ul>\n+<body ng-app=\"clippy\" ng-controller=\"lintList\">\n+    <div theme-dropdown class=\"theme-dropdown\">\n+        <div id=\"theme-icon\" class=\"theme-icon\">&#128396;</div>\n+        <ul id=\"theme-menu\" class=\"theme-choice\">\n+            <li id=\"{{id}}\" ng-repeat=\"(id, name) in themes\" ng-click=\"selectTheme(id)\">{{name}}</li>\n+        </ul>\n+    </div>\n \n     <div class=\"container\">\n         <div class=\"page-header\">\n@@ -340,8 +345,7 @@ <h1>Clippy Lints</h1>\n             <div class=\"panel panel-default\" ng-show=\"data\">\n                 <div class=\"panel-body row\">\n                     <div class=\"col-12 col-md-4\">\n-                        <div class=\"btn-group\" ng-class=\"{ open: selectedDropdown == 'levels' }\"\n-                            ng-click=\"toggleDropdown('levels', $event)\">\n+                        <div class=\"btn-group\" filter-dropdown>\n                             <button type=\"button\" class=\"btn btn-default dropdown-toggle\">\n                                 Lint levels <span class=\"badge\">{{selectedValuesCount(levels)}}</span> <span class=\"caret\"></span>\n                             </button>\n@@ -365,8 +369,7 @@ <h1>Clippy Lints</h1>\n                                 </li>\n                             </ul>\n                         </div>\n-                        <div class=\"btn-group\" ng-class=\"{ open: selectedDropdown == 'groups' }\"\n-                            ng-click=\"toggleDropdown('groups', $event)\">\n+                        <div class=\"btn-group\" filter-dropdown>\n                             <button type=\"button\" class=\"btn btn-default dropdown-toggle\">\n                                 Lint groups <span class=\"badge\">{{selectedValuesCount(groups)}}</span> <span class=\"caret\"></span>\n                             </button>\n@@ -518,6 +521,46 @@ <h2 class=\"panel-title\">\n                 );\n             };\n         })\n+                .directive('themeDropdown', function ($document) {\n+                    return {\n+                        restrict: 'A',\n+                        link: function ($scope, $element, $attr) {\n+                            $element.bind('click', function () {\n+                                $element.toggleClass('open');\n+                                $element.addClass('open-recent');\n+                            });\n+\n+                            $document.bind('click', function () {\n+                                if (!$element.hasClass('open-recent')) {\n+                                    $element.removeClass('open');\n+                                }\n+                                $element.removeClass('open-recent');\n+                            })\n+                        }\n+                    }\n+                })\n+                .directive('filterDropdown', function ($document) {\n+                    return {\n+                        restrict: 'A',\n+                        link: function ($scope, $element, $attr) {\n+                            $element.bind('click', function (event) {\n+                                if (event.target.closest('button')) {\n+                                    $element.toggleClass('open');\n+                                } else {\n+                                    $element.addClass('open');\n+                                }\n+                                $element.addClass('open-recent');\n+                            });\n+\n+                            $document.bind('click', function () {\n+                                if (!$element.hasClass('open-recent')) {\n+                                    $element.removeClass('open');\n+                                }\n+                                $element.removeClass('open-recent');\n+                            })\n+                        }\n+                    }\n+                })\n         .directive('onFinishRender', function ($timeout) {\n             return {\n                 restrict: 'A',\n@@ -551,15 +594,19 @@ <h2 class=\"panel-title\">\n                 suspicious: true,\n             };\n             $scope.groups = GROUPS_FILTER_DEFAULT;\n-            $scope.toggleDropdown = function (name, $event) {\n-                const target = $event.target;\n-                if (name === $scope.selectedDropdown && target.closest('button')) {\n-                    $scope.selectedDropdown = undefined;\n-                } else {\n-                    $scope.selectedDropdown = name;\n-                }\n-                $event.stopPropagation();\n+            const THEMES_DEFAULT = {\n+                light: \"Light\",\n+                rust: \"Rust\",\n+                coal: \"Coal\",\n+                navy: \"Navy\",\n+                ayu: \"Ayu\"\n+            };\n+            $scope.themes = THEMES_DEFAULT;\n+\n+            $scope.selectTheme = function (theme) {\n+                setTheme(theme, true);\n             }\n+\n             $scope.toggleLevels = function (value) {\n                 const levels = $scope.levels;\n                 for (const key in levels) {\n@@ -670,28 +717,6 @@ <h2 class=\"panel-title\">\n         }\n     }\n \n-    function setupListeners() {\n-        let themeIcon = document.getElementById(\"theme-icon\");\n-        let themeMenu = document.getElementById(\"theme-menu\");\n-        themeIcon.addEventListener(\"click\", function(e) {\n-            if (themeMenu.style.display == \"none\") {\n-                themeMenu.style.display = \"block\";\n-            } else {\n-                themeMenu.style.display = \"none\";\n-            }\n-        });\n-\n-        let children = themeMenu.children;\n-        for (let index = 0; index < children.length; index++) {\n-            let child = children[index];\n-            child.addEventListener(\"click\", function(e) {\n-                setTheme(child.id, true);\n-            });\n-        }\n-    }\n-\n-    setupListeners();\n-\n     function setTheme(theme, store) {\n         let enableHighlight = false;\n         let enableNight = false;"}]}