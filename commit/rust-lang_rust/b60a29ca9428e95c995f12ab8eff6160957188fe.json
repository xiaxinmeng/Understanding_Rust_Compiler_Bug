{"sha": "b60a29ca9428e95c995f12ab8eff6160957188fe", "node_id": "C_kwDOAAsO6NoAKGI2MGEyOWNhOTQyOGU5NWM5OTVmMTJhYjhlZmY2MTYwOTU3MTg4ZmU", "commit": {"author": {"name": "Benjamin Coenen", "email": "5719034+bnjjj@users.noreply.github.com", "date": "2022-01-07T13:13:34Z"}, "committer": {"name": "Benjamin Coenen", "email": "5719034+bnjjj@users.noreply.github.com", "date": "2022-01-07T13:13:34Z"}, "message": "feat(diagnostics): use default expression instead of todo! when missing fields\n\nSigned-off-by: Benjamin Coenen <5719034+bnjjj@users.noreply.github.com>", "tree": {"sha": "4277f771073f55c945196b93229528d4cf61158f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4277f771073f55c945196b93229528d4cf61158f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b60a29ca9428e95c995f12ab8eff6160957188fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b60a29ca9428e95c995f12ab8eff6160957188fe", "html_url": "https://github.com/rust-lang/rust/commit/b60a29ca9428e95c995f12ab8eff6160957188fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b60a29ca9428e95c995f12ab8eff6160957188fe/comments", "author": {"login": "bnjjj", "id": 5719034, "node_id": "MDQ6VXNlcjU3MTkwMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5719034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bnjjj", "html_url": "https://github.com/bnjjj", "followers_url": "https://api.github.com/users/bnjjj/followers", "following_url": "https://api.github.com/users/bnjjj/following{/other_user}", "gists_url": "https://api.github.com/users/bnjjj/gists{/gist_id}", "starred_url": "https://api.github.com/users/bnjjj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bnjjj/subscriptions", "organizations_url": "https://api.github.com/users/bnjjj/orgs", "repos_url": "https://api.github.com/users/bnjjj/repos", "events_url": "https://api.github.com/users/bnjjj/events{/privacy}", "received_events_url": "https://api.github.com/users/bnjjj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bnjjj", "id": 5719034, "node_id": "MDQ6VXNlcjU3MTkwMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5719034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bnjjj", "html_url": "https://github.com/bnjjj", "followers_url": "https://api.github.com/users/bnjjj/followers", "following_url": "https://api.github.com/users/bnjjj/following{/other_user}", "gists_url": "https://api.github.com/users/bnjjj/gists{/gist_id}", "starred_url": "https://api.github.com/users/bnjjj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bnjjj/subscriptions", "organizations_url": "https://api.github.com/users/bnjjj/orgs", "repos_url": "https://api.github.com/users/bnjjj/repos", "events_url": "https://api.github.com/users/bnjjj/events{/privacy}", "received_events_url": "https://api.github.com/users/bnjjj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a4239a8153a17dda816678dfd870e1e5d10a101", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a4239a8153a17dda816678dfd870e1e5d10a101", "html_url": "https://github.com/rust-lang/rust/commit/0a4239a8153a17dda816678dfd870e1e5d10a101"}], "stats": {"total": 25, "additions": 12, "deletions": 13}, "files": [{"sha": "186bfc3d5846cd8c5a1ca1f70d1ed0ebcc7df834", "filename": "crates/ide_diagnostics/src/handlers/missing_fields.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -73,7 +73,7 @@ fn fixes(ctx: &DiagnosticsContext<'_>, d: &hir::MissingFields) -> Option<Vec<Ass\n \n     let generate_fill_expr = |ty: &Type| match ctx.config.expr_fill_default {\n         crate::ExprFillDefaultMode::Todo => Some(make::ext::expr_todo()),\n-        crate::ExprFillDefaultMode::DefaultImpl => {\n+        crate::ExprFillDefaultMode::Default => {\n             let default_constr = get_default_constructor(ctx, d, ty);\n             match default_constr {\n                 Some(default_constr) => Some(default_constr),\n@@ -159,7 +159,6 @@ fn get_default_constructor(\n             if let AssocItem::Function(func) = assoc_item {\n                 if func.name(ctx.sema.db) == known::new\n                     && func.assoc_fn_params(ctx.sema.db).is_empty()\n-                    && func.self_param(ctx.sema.db).is_none()\n                 {\n                     return Some(());\n                 }"}, {"sha": "86d76751ad6c659f186dab8f473c7da5e7bd51b0", "filename": "crates/ide_diagnostics/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_diagnostics%2Fsrc%2Flib.rs?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -132,7 +132,7 @@ pub enum Severity {\n #[derive(Clone, Debug, PartialEq, Eq)]\n pub enum ExprFillDefaultMode {\n     Todo,\n-    DefaultImpl,\n+    Default,\n }\n impl Default for ExprFillDefaultMode {\n     fn default() -> Self {"}, {"sha": "7d06e9d36fffeb6dfb1b94506ce152dee1a9e1f1", "filename": "crates/ide_diagnostics/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fide_diagnostics%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_diagnostics%2Fsrc%2Ftests.rs?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -37,7 +37,7 @@ fn check_nth_fix(nth: usize, ra_fixture_before: &str, ra_fixture_after: &str) {\n \n     let (db, file_position) = RootDatabase::with_position(ra_fixture_before);\n     let mut conf = DiagnosticsConfig::default();\n-    conf.expr_fill_default = ExprFillDefaultMode::DefaultImpl;\n+    conf.expr_fill_default = ExprFillDefaultMode::Default;\n     let diagnostic =\n         super::diagnostics(&db, &conf, &AssistResolveStrategy::All, file_position.file_id)\n             .pop()"}, {"sha": "6be889df67afd219035bd326634cc970d5ad8734", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -698,7 +698,7 @@ impl Config {\n             disabled: self.data.diagnostics_disabled.clone(),\n             expr_fill_default: match self.data.assist_exprFillDefault {\n                 ExprFillDefaultDef::Todo => ExprFillDefaultMode::Todo,\n-                ExprFillDefaultDef::DefaultImpl => ExprFillDefaultMode::DefaultImpl,\n+                ExprFillDefaultDef::Default => ExprFillDefaultMode::Default,\n             },\n         }\n     }\n@@ -1070,8 +1070,8 @@ enum ManifestOrProjectJson {\n pub enum ExprFillDefaultDef {\n     #[serde(alias = \"todo\")]\n     Todo,\n-    #[serde(alias = \"defaultImpl\")]\n-    DefaultImpl,\n+    #[serde(alias = \"default\")]\n+    Default,\n }\n \n #[derive(Deserialize, Debug, Clone)]\n@@ -1270,9 +1270,9 @@ fn field_props(field: &str, ty: &str, doc: &[&str], default: &str) -> serde_json\n         },\n         \"ExprFillDefaultDef\" => set! {\n             \"type\": \"string\",\n-            \"enum\": [\"todo\", \"defaultImpl\"],\n+            \"enum\": [\"todo\", \"default\"],\n             \"enumDescriptions\": [\n-                \"Fill missing elements with 'todo' macro\",\n+                \"Fill missing expressions with the 'todo' macro\",\n                 \"Fill missing expressions with reasonable defaults, `new` or `default` constructors.\"\n             ],\n         },"}, {"sha": "357502097544b5e7bd6b47fba4ff51d6fc4372b8", "filename": "crates/syntax/src/ast/make.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -76,7 +76,7 @@ pub mod ext {\n         expr_from_text(r#\"\"\"\"#)\n     }\n     pub fn empty_char() -> ast::Expr {\n-        expr_from_text(\"''\")\n+        expr_from_text(\"'\\x00'\")\n     }\n     pub fn default_bool() -> ast::Expr {\n         expr_from_text(\"false\")"}, {"sha": "c81fd0b3d2dac4b0dc6485e131726f6898400df5", "filename": "editors/code/package.json", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b60a29ca9428e95c995f12ab8eff6160957188fe/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/b60a29ca9428e95c995f12ab8eff6160957188fe/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=b60a29ca9428e95c995f12ab8eff6160957188fe", "patch": "@@ -384,11 +384,11 @@\n                     \"type\": \"string\",\n                     \"enum\": [\n                         \"todo\",\n-                        \"defaultImpl\"\n+                        \"default\"\n                     ],\n                     \"enumDescriptions\": [\n-                        \"Fill missing elements with 'todo' macro\",\n-                        \"Fill missing elements with T::default()\"\n+                        \"Fill missing expressions with the 'todo' macro\",\n+                        \"Fill missing expressions with reasonable defaults, `new` or `default` constructors.\"\n                     ]\n                 },\n                 \"rust-analyzer.assist.importGranularity\": {"}]}