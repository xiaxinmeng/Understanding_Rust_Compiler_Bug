{"sha": "e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2NmM3YjNhNDUzZTdiNzM4NWYxMDNhZTdmMWYzZjc0MzhiZGIzMWI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-04T17:51:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-04T17:51:03Z"}, "message": "Merge #4737\n\n4737: Parse default unsafe & default const r=matklad a=Avi-D-coder\n\nCloses: #4718 #4264\n\nCo-authored-by: Avi Dessauer <avi.the.coder@gmail.com>", "tree": {"sha": "4a71b164a5b2e97cf219d7cfcd926b9119b6f646", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a71b164a5b2e97cf219d7cfcd926b9119b6f646"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe2TSHCRBK7hj4Ov3rIwAAdHIIACHSSDgFMZCbFSmYrCJSH5Mw\nl9V0gruUsmbCf0xY3QS94LSa93f7PVE1uy5nIgKsxv3AKe7cnPP4PyIF0ch76FaU\n8OWNWNNW9w6G6o+NbduuUMw2TcR4z4UqcGe0d3R0zYKb2Pcy5v23aeSdy1UTxTpa\nxyQn7UOHaDlAkaVOT9RF0uyBrrA07ia3orHA2D5IyyHdbjAvVdTDg4Ds2j2d9WSk\ncHhxwCy+kTKgFTQAlgHBo7LGI5LEDicRDIbxAbrcY09C1ZG4U+tC5DgfanfSf8qg\nP01UKd0AADbYBatSsVZWtdkyO/6xeyJjMUVPBoTwyBGcZSs4xoyMZGYl7qMOC7Y=\n=R4g0\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a71b164a5b2e97cf219d7cfcd926b9119b6f646\nparent c19496f845a4adcd7e0f48f5dcb5b405bbc63dfc\nparent c4fd46398132a409d7947141094d7301c0f0af73\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1591293063 +0000\ncommitter GitHub <noreply@github.com> 1591293063 +0000\n\nMerge #4737\n\n4737: Parse default unsafe & default const r=matklad a=Avi-D-coder\n\nCloses: #4718 #4264\n\nCo-authored-by: Avi Dessauer <avi.the.coder@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "html_url": "https://github.com/rust-lang/rust/commit/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c19496f845a4adcd7e0f48f5dcb5b405bbc63dfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/c19496f845a4adcd7e0f48f5dcb5b405bbc63dfc", "html_url": "https://github.com/rust-lang/rust/commit/c19496f845a4adcd7e0f48f5dcb5b405bbc63dfc"}, {"sha": "c4fd46398132a409d7947141094d7301c0f0af73", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4fd46398132a409d7947141094d7301c0f0af73", "html_url": "https://github.com/rust-lang/rust/commit/c4fd46398132a409d7947141094d7301c0f0af73"}], "stats": {"total": 158, "additions": 143, "deletions": 15}, "files": [{"sha": "9c14b954af4bb72592be6659294540aa5eeb6fe7", "filename": "crates/ra_parser/src/grammar/items.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -118,7 +118,17 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker, flavor: ItemFlavor) -> Resul\n         && p.at_contextual_kw(\"default\")\n         && (match p.nth(1) {\n             T![impl] => true,\n-            T![fn] | T![type] => {\n+            T![unsafe] => {\n+                // test default_unsafe_impl\n+                // default unsafe impl Foo {}\n+                if p.nth(2) == T![impl] {\n+                    p.bump_remap(T![default]);\n+                    p.bump(T![unsafe]);\n+                    has_mods = true;\n+                }\n+                false\n+            }\n+            T![fn] | T![type] | T![const] => {\n                 if let ItemFlavor::Mod = flavor {\n                     true\n                 } else {\n@@ -198,6 +208,9 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker, flavor: ItemFlavor) -> Resul\n         //     default type T = Bar;\n         //     default fn foo() {}\n         // }\n+        T![const] => {\n+            consts::const_def(p, m);\n+        }\n \n         // test unsafe_default_impl\n         // unsafe default impl Foo {}"}, {"sha": "8eb583ef85ccc70d005978c839226c86834e89ef", "filename": "crates/ra_syntax/test_data/parser/err/0043_default_const.rast", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rast", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rast?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1,40 @@\n+SOURCE_FILE@0..39\n+  TRAIT_DEF@0..38\n+    TRAIT_KW@0..5 \"trait\"\n+    WHITESPACE@5..6 \" \"\n+    NAME@6..7\n+      IDENT@6..7 \"T\"\n+    WHITESPACE@7..8 \" \"\n+    ITEM_LIST@8..38\n+      L_CURLY@8..9 \"{\"\n+      WHITESPACE@9..12 \"\\n  \"\n+      MACRO_CALL@12..19\n+        PATH@12..19\n+          PATH_SEGMENT@12..19\n+            NAME_REF@12..19\n+              IDENT@12..19 \"default\"\n+      WHITESPACE@19..20 \" \"\n+      CONST_DEF@20..36\n+        CONST_KW@20..25 \"const\"\n+        WHITESPACE@25..26 \" \"\n+        NAME@26..27\n+          IDENT@26..27 \"f\"\n+        COLON@27..28 \":\"\n+        WHITESPACE@28..29 \" \"\n+        PATH_TYPE@29..31\n+          PATH@29..31\n+            PATH_SEGMENT@29..31\n+              NAME_REF@29..31\n+                IDENT@29..31 \"u8\"\n+        WHITESPACE@31..32 \" \"\n+        EQ@32..33 \"=\"\n+        WHITESPACE@33..34 \" \"\n+        LITERAL@34..35\n+          INT_NUMBER@34..35 \"0\"\n+        SEMICOLON@35..36 \";\"\n+      WHITESPACE@36..37 \"\\n\"\n+      R_CURLY@37..38 \"}\"\n+  WHITESPACE@38..39 \"\\n\"\n+error 19..19: expected BANG\n+error 19..19: expected `{`, `[`, `(`\n+error 19..19: expected SEMICOLON"}, {"sha": "80f15474a5d0dcc39ba6dd4ccee087b96edbf172", "filename": "crates/ra_syntax/test_data/parser/err/0043_default_const.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0043_default_const.rs?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1,3 @@\n+trait T {\n+  default const f: u8 = 0;\n+}"}, {"sha": "53f7ebaf9a724bce2117a965d437556e91125894", "filename": "crates/ra_syntax/test_data/parser/inline/err/0010_wrong_order_fns.rast", "status": "modified", "additions": 20, "deletions": 14, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rast", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Ferr%2F0010_wrong_order_fns.rast?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -17,23 +17,29 @@ SOURCE_FILE@0..50\n       L_CURLY@22..23 \"{\"\n       R_CURLY@23..24 \"}\"\n   WHITESPACE@24..25 \"\\n\"\n-  ERROR@25..31\n+  CONST_DEF@25..46\n     UNSAFE_KW@25..31 \"unsafe\"\n-  WHITESPACE@31..32 \" \"\n-  FN_DEF@32..49\n+    WHITESPACE@31..32 \" \"\n     CONST_KW@32..37 \"const\"\n     WHITESPACE@37..38 \" \"\n-    FN_KW@38..40 \"fn\"\n+    ERROR@38..40\n+      FN_KW@38..40 \"fn\"\n     WHITESPACE@40..41 \" \"\n-    NAME@41..44\n-      IDENT@41..44 \"bar\"\n-    PARAM_LIST@44..46\n-      L_PAREN@44..45 \"(\"\n-      R_PAREN@45..46 \")\"\n-    WHITESPACE@46..47 \" \"\n-    BLOCK_EXPR@47..49\n-      L_CURLY@47..48 \"{\"\n-      R_CURLY@48..49 \"}\"\n+    PATH_TYPE@41..46\n+      PATH@41..46\n+        PATH_SEGMENT@41..46\n+          NAME_REF@41..44\n+            IDENT@41..44 \"bar\"\n+          PARAM_LIST@44..46\n+            L_PAREN@44..45 \"(\"\n+            R_PAREN@45..46 \")\"\n+  WHITESPACE@46..47 \" \"\n+  ERROR@47..49\n+    L_CURLY@47..48 \"{\"\n+    R_CURLY@48..49 \"}\"\n   WHITESPACE@49..50 \"\\n\"\n error 6..6: expected existential, fn, trait or impl\n-error 31..31: expected existential, fn, trait or impl\n+error 38..38: expected a name\n+error 40..40: expected COLON\n+error 46..46: expected SEMICOLON\n+error 47..47: expected an item"}, {"sha": "a9eda56681121e1b9d746e2d278c5d95906873ad", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0163_default_unsafe_impl.rast", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rast", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rast?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1,18 @@\n+SOURCE_FILE@0..27\n+  IMPL_DEF@0..26\n+    DEFAULT_KW@0..7 \"default\"\n+    WHITESPACE@7..8 \" \"\n+    UNSAFE_KW@8..14 \"unsafe\"\n+    WHITESPACE@14..15 \" \"\n+    IMPL_KW@15..19 \"impl\"\n+    WHITESPACE@19..20 \" \"\n+    PATH_TYPE@20..23\n+      PATH@20..23\n+        PATH_SEGMENT@20..23\n+          NAME_REF@20..23\n+            IDENT@20..23 \"Foo\"\n+    WHITESPACE@23..24 \" \"\n+    ITEM_LIST@24..26\n+      L_CURLY@24..25 \"{\"\n+      R_CURLY@25..26 \"}\"\n+  WHITESPACE@26..27 \"\\n\""}, {"sha": "ba0998ff4d997263ff4cb8a00a5620c61144c888", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0163_default_unsafe_impl.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_unsafe_impl.rs?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1 @@\n+default unsafe impl Foo {}"}, {"sha": "dab0247ee6fa25a2bc8b1774fc6f322fdc89ac7e", "filename": "crates/ra_syntax/test_data/parser/ok/0066_default_const.rast", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rast", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rast?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1,44 @@\n+SOURCE_FILE@0..46\n+  IMPL_DEF@0..45\n+    IMPL_KW@0..4 \"impl\"\n+    WHITESPACE@4..5 \" \"\n+    PATH_TYPE@5..6\n+      PATH@5..6\n+        PATH_SEGMENT@5..6\n+          NAME_REF@5..6\n+            IDENT@5..6 \"T\"\n+    WHITESPACE@6..7 \" \"\n+    FOR_KW@7..10 \"for\"\n+    WHITESPACE@10..11 \" \"\n+    PATH_TYPE@11..14\n+      PATH@11..14\n+        PATH_SEGMENT@11..14\n+          NAME_REF@11..14\n+            IDENT@11..14 \"Foo\"\n+    WHITESPACE@14..15 \" \"\n+    ITEM_LIST@15..45\n+      L_CURLY@15..16 \"{\"\n+      WHITESPACE@16..19 \"\\n  \"\n+      CONST_DEF@19..43\n+        DEFAULT_KW@19..26 \"default\"\n+        WHITESPACE@26..27 \" \"\n+        CONST_KW@27..32 \"const\"\n+        WHITESPACE@32..33 \" \"\n+        NAME@33..34\n+          IDENT@33..34 \"f\"\n+        COLON@34..35 \":\"\n+        WHITESPACE@35..36 \" \"\n+        PATH_TYPE@36..38\n+          PATH@36..38\n+            PATH_SEGMENT@36..38\n+              NAME_REF@36..38\n+                IDENT@36..38 \"u8\"\n+        WHITESPACE@38..39 \" \"\n+        EQ@39..40 \"=\"\n+        WHITESPACE@40..41 \" \"\n+        LITERAL@41..42\n+          INT_NUMBER@41..42 \"0\"\n+        SEMICOLON@42..43 \";\"\n+      WHITESPACE@43..44 \"\\n\"\n+      R_CURLY@44..45 \"}\"\n+  WHITESPACE@45..46 \"\\n\""}, {"sha": "dfb3b92dca7969fc598249b48aa500a0c00444f5", "filename": "crates/ra_syntax/test_data/parser/ok/0066_default_const.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0066_default_const.rs?ref=e66c7b3a453e7b7385f103ae7f1f3f7438bdb31b", "patch": "@@ -0,0 +1,3 @@\n+impl T for Foo {\n+  default const f: u8 = 0;\n+}"}]}