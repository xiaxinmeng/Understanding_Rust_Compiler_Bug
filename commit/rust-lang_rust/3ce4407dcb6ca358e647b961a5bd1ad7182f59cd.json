{"sha": "3ce4407dcb6ca358e647b961a5bd1ad7182f59cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjZTQ0MDdkY2I2Y2EzNThlNjQ3Yjk2MWE1YmQxYWQ3MTgyZjU5Y2Q=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-09T13:51:32Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-09T13:51:32Z"}, "message": "Fix diagnostic for method calls", "tree": {"sha": "9e4a9b61d14f02d33e211f03d8aa68e99046ae28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e4a9b61d14f02d33e211f03d8aa68e99046ae28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd", "html_url": "https://github.com/rust-lang/rust/commit/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d04f3604d5b054674720276900ebc35564e2df96", "url": "https://api.github.com/repos/rust-lang/rust/commits/d04f3604d5b054674720276900ebc35564e2df96", "html_url": "https://github.com/rust-lang/rust/commit/d04f3604d5b054674720276900ebc35564e2df96"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "53828d29d94ab0240f8cb0f292fe5db170c9c27e", "filename": "crates/ra_hir_ty/src/expr.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd/crates%2Fra_hir_ty%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce4407dcb6ca358e647b961a5bd1ad7182f59cd/crates%2Fra_hir_ty%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Fexpr.rs?ref=3ce4407dcb6ca358e647b961a5bd1ad7182f59cd", "patch": "@@ -157,18 +157,23 @@ impl<'a, 'b> ExprValidator<'a, 'b> {\n             return Some(());\n         }\n \n+        let is_method_call;\n         let (callee, args) = match expr {\n             Expr::Call { callee, args } => {\n+                is_method_call = false;\n                 let callee = &self.infer.type_of_expr[*callee];\n                 let (callable, _) = callee.as_callable()?;\n                 let callee = match callable {\n                     CallableDef::FunctionId(func) => func,\n+\n+                    // FIXME: Handle tuple struct/variant constructor calls.\n                     _ => return None,\n                 };\n \n                 (callee, args.clone())\n             }\n             Expr::MethodCall { receiver, args, .. } => {\n+                is_method_call = true;\n                 let callee = self.infer.method_resolution(call_id)?;\n                 let mut args = args.clone();\n                 args.insert(0, *receiver);\n@@ -182,15 +187,19 @@ impl<'a, 'b> ExprValidator<'a, 'b> {\n         let params = ast.value.param_list()?;\n \n         let mut param_count = params.params().count();\n+        let mut arg_count = args.len();\n+\n         if params.self_param().is_some() {\n             param_count += 1;\n         }\n-        let arg_count = args.len();\n \n         if arg_count != param_count {\n-            let (_, source_map): (Arc<Body>, Arc<BodySourceMap>) =\n-                db.body_with_source_map(self.func.into());\n+            let (_, source_map) = db.body_with_source_map(self.func.into());\n             if let Ok(source_ptr) = source_map.expr_syntax(call_id) {\n+                if is_method_call {\n+                    param_count -= 1;\n+                    arg_count -= 1;\n+                }\n                 self.sink.push(MismatchedArgCount {\n                     file: source_ptr.file_id,\n                     call_expr: source_ptr.value,"}]}