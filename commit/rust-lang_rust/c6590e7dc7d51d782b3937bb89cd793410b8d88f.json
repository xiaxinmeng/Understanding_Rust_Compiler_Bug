{"sha": "c6590e7dc7d51d782b3937bb89cd793410b8d88f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2NTkwZTdkYzdkNTFkNzgyYjM5MzdiYjg5Y2Q3OTM0MTBiOGQ4OGY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-13T17:12:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-13T17:12:32Z"}, "message": "Rollup merge of #58276 - varkor:missing-stability-attr-top-level, r=davidtwco\n\nImprove the error messages for missing stability attributes\n\nThis makes the capitalisation consistent and provides more context (especially for missing top-level attributes).", "tree": {"sha": "6a41618ccf6b02749eb39675faabd9b112b3a85c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a41618ccf6b02749eb39675faabd9b112b3a85c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6590e7dc7d51d782b3937bb89cd793410b8d88f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcZFAACRBK7hj4Ov3rIwAAdHIIABjkJ6G5FP4DJH/V2MN0eCH3\n4wQ0swQS3vEcEF2tOeq4cak/8B1lDgBCZ/tcnEua4vaCo8puWiAZ0z3hIpmqaBZu\n1xL2amGM/RKJzWKD1mODUkN+YL7PjdYopCMvx+Yy6Wc2St7A0qmR4hnQRrpg6UhN\nvleOeYwfmBl5hIyKj/56vMUhVDyhQaaL9lmcgEhAAFzw9lUZPDRKgsKxM3FciANG\nfOLocVwaGzDT4YDBlCcVSy/zqjb9E6aAyX8Fgfbka7fzTf3xJPGUgbiAdvfk19KS\nY8ar+BzxKrlLX3TA+Vt8+LgFlrosnEroHv7yMZ8WunFb52URTc2ByL3s2x9wN4k=\n=CrLR\n-----END PGP SIGNATURE-----\n", "payload": "tree 6a41618ccf6b02749eb39675faabd9b112b3a85c\nparent c0d507d73b1cc51dd052abe96580f1c3d233ed25\nparent bb1eed0ec8537a09666978ad92d71ee1b5aba13b\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550077952 +0100\ncommitter GitHub <noreply@github.com> 1550077952 +0100\n\nRollup merge of #58276 - varkor:missing-stability-attr-top-level, r=davidtwco\n\nImprove the error messages for missing stability attributes\n\nThis makes the capitalisation consistent and provides more context (especially for missing top-level attributes).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6590e7dc7d51d782b3937bb89cd793410b8d88f", "html_url": "https://github.com/rust-lang/rust/commit/c6590e7dc7d51d782b3937bb89cd793410b8d88f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6590e7dc7d51d782b3937bb89cd793410b8d88f/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0d507d73b1cc51dd052abe96580f1c3d233ed25", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0d507d73b1cc51dd052abe96580f1c3d233ed25", "html_url": "https://github.com/rust-lang/rust/commit/c0d507d73b1cc51dd052abe96580f1c3d233ed25"}, {"sha": "bb1eed0ec8537a09666978ad92d71ee1b5aba13b", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb1eed0ec8537a09666978ad92d71ee1b5aba13b", "html_url": "https://github.com/rust-lang/rust/commit/bb1eed0ec8537a09666978ad92d71ee1b5aba13b"}], "stats": {"total": 62, "additions": 40, "deletions": 22}, "files": [{"sha": "0bf9857b4977762be53f30f69c8d581bb47d6b2d", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -2290,7 +2290,7 @@ impl ItemKind {\n             ItemKind::Union(..) => \"union\",\n             ItemKind::Trait(..) => \"trait\",\n             ItemKind::TraitAlias(..) => \"trait alias\",\n-            ItemKind::Impl(..) => \"item\",\n+            ItemKind::Impl(..) => \"impl\",\n         }\n     }\n "}, {"sha": "30a43c7a92595c57c2b5a2ac25e14949a7d37ef5", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 13, "deletions": 10, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -322,14 +322,17 @@ struct MissingStabilityAnnotations<'a, 'tcx: 'a> {\n }\n \n impl<'a, 'tcx: 'a> MissingStabilityAnnotations<'a, 'tcx> {\n-    fn check_missing_stability(&self, id: NodeId, span: Span) {\n+    fn check_missing_stability(&self, id: NodeId, span: Span, name: &str) {\n         let hir_id = self.tcx.hir().node_to_hir_id(id);\n         let stab = self.tcx.stability().local_stability(hir_id);\n         let is_error = !self.tcx.sess.opts.test &&\n                         stab.is_none() &&\n                         self.access_levels.is_reachable(id);\n         if is_error {\n-            self.tcx.sess.span_err(span, \"This node does not have a stability attribute\");\n+            self.tcx.sess.span_err(\n+                span,\n+                &format!(\"{} has missing stability attribute\", name),\n+            );\n         }\n     }\n }\n@@ -347,42 +350,42 @@ impl<'a, 'tcx> Visitor<'tcx> for MissingStabilityAnnotations<'a, 'tcx> {\n             // optional. They inherit stability from their parents when unannotated.\n             hir::ItemKind::Impl(.., None, _, _) | hir::ItemKind::ForeignMod(..) => {}\n \n-            _ => self.check_missing_stability(i.id, i.span)\n+            _ => self.check_missing_stability(i.id, i.span, i.node.descriptive_variant())\n         }\n \n         intravisit::walk_item(self, i)\n     }\n \n     fn visit_trait_item(&mut self, ti: &'tcx hir::TraitItem) {\n-        self.check_missing_stability(ti.id, ti.span);\n+        self.check_missing_stability(ti.id, ti.span, \"item\");\n         intravisit::walk_trait_item(self, ti);\n     }\n \n     fn visit_impl_item(&mut self, ii: &'tcx hir::ImplItem) {\n         let impl_def_id = self.tcx.hir().local_def_id(self.tcx.hir().get_parent(ii.id));\n         if self.tcx.impl_trait_ref(impl_def_id).is_none() {\n-            self.check_missing_stability(ii.id, ii.span);\n+            self.check_missing_stability(ii.id, ii.span, \"item\");\n         }\n         intravisit::walk_impl_item(self, ii);\n     }\n \n     fn visit_variant(&mut self, var: &'tcx Variant, g: &'tcx Generics, item_id: NodeId) {\n-        self.check_missing_stability(var.node.data.id(), var.span);\n+        self.check_missing_stability(var.node.data.id(), var.span, \"variant\");\n         intravisit::walk_variant(self, var, g, item_id);\n     }\n \n     fn visit_struct_field(&mut self, s: &'tcx StructField) {\n-        self.check_missing_stability(s.id, s.span);\n+        self.check_missing_stability(s.id, s.span, \"field\");\n         intravisit::walk_struct_field(self, s);\n     }\n \n     fn visit_foreign_item(&mut self, i: &'tcx hir::ForeignItem) {\n-        self.check_missing_stability(i.id, i.span);\n+        self.check_missing_stability(i.id, i.span, i.node.descriptive_variant());\n         intravisit::walk_foreign_item(self, i);\n     }\n \n     fn visit_macro_def(&mut self, md: &'tcx hir::MacroDef) {\n-        self.check_missing_stability(md.id, md.span);\n+        self.check_missing_stability(md.id, md.span, \"macro\");\n     }\n }\n \n@@ -840,7 +843,7 @@ pub fn check_unused_or_stable_features<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>) {\n             tcx,\n             access_levels,\n         };\n-        missing.check_missing_stability(ast::CRATE_NODE_ID, krate.span);\n+        missing.check_missing_stability(ast::CRATE_NODE_ID, krate.span, \"crate\");\n         intravisit::walk_crate(&mut missing, krate);\n         krate.visit_all_item_likes(&mut missing.as_deep_visitor());\n     }"}, {"sha": "469c22fdb17d7b6aedbf12e8cfa4500d57b41674", "filename": "src/test/ui/missing/missing-stability.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -6,7 +6,7 @@\n #![stable(feature = \"stable_test_feature\", since = \"1.0.0\")]\n \n pub fn unmarked() {\n-    //~^ ERROR This node does not have a stability attribute\n+    //~^ ERROR function has missing stability attribute\n     ()\n }\n \n@@ -20,5 +20,5 @@ pub mod foo {\n pub mod bar {\n     // #[stable] is not inherited\n     pub fn unmarked() {}\n-    //~^ ERROR This node does not have a stability attribute\n+    //~^ ERROR function has missing stability attribute\n }"}, {"sha": "6c81f2bac57889753083ab52d233ae573380ca80", "filename": "src/test/ui/missing/missing-stability.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmissing%2Fmissing-stability.stderr?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -1,13 +1,13 @@\n-error: This node does not have a stability attribute\n+error: function has missing stability attribute\n   --> $DIR/missing-stability.rs:8:1\n    |\n LL | / pub fn unmarked() {\n-LL | |     //~^ ERROR This node does not have a stability attribute\n+LL | |     //~^ ERROR function has missing stability attribute\n LL | |     ()\n LL | | }\n    | |_^\n \n-error: This node does not have a stability attribute\n+error: function has missing stability attribute\n   --> $DIR/missing-stability.rs:22:5\n    |\n LL |     pub fn unmarked() {}"}, {"sha": "8f750ae62f5e4c2f57e725e0f3b620410535479d", "filename": "src/test/ui/stability-attribute/missing-stability-attr-at-top-level.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -0,0 +1,4 @@\n+#![feature(staged_api)]\n+//~^ ERROR crate has missing stability attribute\n+\n+fn main() {}"}, {"sha": "f6747976945572429892e77838fc31dd4ab74305", "filename": "src/test/ui/stability-attribute/missing-stability-attr-at-top-level.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-stability-attr-at-top-level.stderr?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -0,0 +1,11 @@\n+error: crate has missing stability attribute\n+  --> $DIR/missing-stability-attr-at-top-level.rs:1:1\n+   |\n+LL | / #![feature(staged_api)]\n+LL | | //~^ ERROR crate has missing stability attribute\n+LL | |\n+LL | | fn main() {}\n+   | |____________^\n+\n+error: aborting due to previous error\n+"}, {"sha": "0b243bb52119bae080f3163343f3b4e6ff61340e", "filename": "src/test/ui/stability-attribute/stability-attribute-issue-43027.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -2,7 +2,7 @@\n #![stable(feature = \"test\", since = \"0\")]\n \n #[stable(feature = \"test\", since = \"0\")]\n-pub struct Reverse<T>(pub T); //~ ERROR This node does not have a stability attribute\n+pub struct Reverse<T>(pub T); //~ ERROR field has missing stability attribute\n \n fn main() {\n     // Make sure the field is used to fill the stability cache"}, {"sha": "7ffb4bb487a7b514b3cc04a50156efe38ee05739", "filename": "src/test/ui/stability-attribute/stability-attribute-issue-43027.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-issue-43027.stderr?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -1,7 +1,7 @@\n-error: This node does not have a stability attribute\n+error: field has missing stability attribute\n   --> $DIR/stability-attribute-issue-43027.rs:5:23\n    |\n-LL | pub struct Reverse<T>(pub T); //~ ERROR This node does not have a stability attribute\n+LL | pub struct Reverse<T>(pub T); //~ ERROR field has missing stability attribute\n    |                       ^^^^^\n \n error: aborting due to previous error"}, {"sha": "13ef3d3f53d2b0dc2629249eda300d8c6f90ed38", "filename": "src/test/ui/stability-attribute/stability-attribute-sanity-3.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.rs?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -5,7 +5,7 @@\n #![stable(feature = \"stable_test_feature\", since = \"1.0.0\")]\n \n #[macro_export]\n-macro_rules! mac { //~ ERROR This node does not have a stability attribute\n+macro_rules! mac { //~ ERROR macro has missing stability attribute\n     () => ()\n }\n "}, {"sha": "1c759d49b9947483a4c22529d566f7466782de29", "filename": "src/test/ui/stability-attribute/stability-attribute-sanity-3.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c6590e7dc7d51d782b3937bb89cd793410b8d88f/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity-3.stderr?ref=c6590e7dc7d51d782b3937bb89cd793410b8d88f", "patch": "@@ -1,7 +1,7 @@\n-error: This node does not have a stability attribute\n+error: macro has missing stability attribute\n   --> $DIR/stability-attribute-sanity-3.rs:8:1\n    |\n-LL | / macro_rules! mac { //~ ERROR This node does not have a stability attribute\n+LL | / macro_rules! mac { //~ ERROR macro has missing stability attribute\n LL | |     () => ()\n LL | | }\n    | |_^"}]}