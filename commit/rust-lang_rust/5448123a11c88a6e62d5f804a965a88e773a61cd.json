{"sha": "5448123a11c88a6e62d5f804a965a88e773a61cd", "node_id": "C_kwDOAAsO6NoAKDU0NDgxMjNhMTFjODhhNmU2MmQ1ZjgwNGE5NjVhODhlNzczYTYxY2Q", "commit": {"author": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-02-26T01:05:27Z"}, "committer": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-02-28T01:54:55Z"}, "message": "Remove or justify use of #[rustc_box]", "tree": {"sha": "bfde3a1f6911dd936caa41349462efe66ac61675", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bfde3a1f6911dd936caa41349462efe66ac61675"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5448123a11c88a6e62d5f804a965a88e773a61cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5448123a11c88a6e62d5f804a965a88e773a61cd", "html_url": "https://github.com/rust-lang/rust/commit/5448123a11c88a6e62d5f804a965a88e773a61cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5448123a11c88a6e62d5f804a965a88e773a61cd/comments", "author": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34e6673a0473e90ef01a18eb575392c9e3859747", "url": "https://api.github.com/repos/rust-lang/rust/commits/34e6673a0473e90ef01a18eb575392c9e3859747", "html_url": "https://github.com/rust-lang/rust/commit/34e6673a0473e90ef01a18eb575392c9e3859747"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "44a37899007f8db12f2b67de4a6bc1bc63d74561", "filename": "library/alloc/src/boxed.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fboxed.rs?ref=5448123a11c88a6e62d5f804a965a88e773a61cd", "patch": "@@ -283,9 +283,7 @@ impl<T> Box<T> {\n     #[must_use]\n     #[inline(always)]\n     pub fn pin(x: T) -> Pin<Box<T>> {\n-        (#[rustc_box]\n-        Box::new(x))\n-        .into()\n+        Box::new(x).into()\n     }\n \n     /// Allocates memory on the heap then places `x` into it,\n@@ -1242,8 +1240,8 @@ unsafe impl<#[may_dangle] T: ?Sized, A: Allocator> Drop for Box<T, A> {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<T: Default> Default for Box<T> {\n     /// Creates a `Box<T>`, with the `Default` value for T.\n+    #[inline]\n     fn default() -> Self {\n-        #[rustc_box]\n         Box::new(T::default())\n     }\n }\n@@ -1252,6 +1250,7 @@ impl<T: Default> Default for Box<T> {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[rustc_const_unstable(feature = \"const_default_impls\", issue = \"87864\")]\n impl<T> const Default for Box<[T]> {\n+    #[inline]\n     fn default() -> Self {\n         let ptr: Unique<[T]> = Unique::<[T; 0]>::dangling();\n         Box(ptr, Global)\n@@ -1262,6 +1261,7 @@ impl<T> const Default for Box<[T]> {\n #[stable(feature = \"default_box_extra\", since = \"1.17.0\")]\n #[rustc_const_unstable(feature = \"const_default_impls\", issue = \"87864\")]\n impl const Default for Box<str> {\n+    #[inline]\n     fn default() -> Self {\n         // SAFETY: This is the same as `Unique::cast<U>` but with an unsized `U = str`.\n         let ptr: Unique<str> = unsafe {\n@@ -1616,7 +1616,6 @@ impl<T, const N: usize> From<[T; N]> for Box<[T]> {\n     /// println!(\"{boxed:?}\");\n     /// ```\n     fn from(array: [T; N]) -> Box<[T]> {\n-        #[rustc_box]\n         Box::new(array)\n     }\n }"}, {"sha": "4c6ae8f2579fae0f41e22a00ef14d8d27e8b715a", "filename": "library/alloc/src/macros.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fmacros.rs?ref=5448123a11c88a6e62d5f804a965a88e773a61cd", "patch": "@@ -48,6 +48,8 @@ macro_rules! vec {\n     );\n     ($($x:expr),+ $(,)?) => (\n         $crate::__rust_force_expr!(<[_]>::into_vec(\n+            // This rustc_box is not required, but it produces a dramatic improvement in compile\n+            // time when constructing arrays with many elements.\n             #[rustc_box]\n             $crate::boxed::Box::new([$($x),+])\n         ))"}, {"sha": "f2aa30f18fcf65d27d81adb237b35f4cd4b0c5c5", "filename": "library/alloc/src/vec/mod.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5448123a11c88a6e62d5f804a965a88e773a61cd/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fvec%2Fmod.rs?ref=5448123a11c88a6e62d5f804a965a88e773a61cd", "patch": "@@ -3131,10 +3131,7 @@ impl<T, const N: usize> From<[T; N]> for Vec<T> {\n     /// ```\n     #[cfg(not(test))]\n     fn from(s: [T; N]) -> Vec<T> {\n-        <[T]>::into_vec(\n-            #[rustc_box]\n-            Box::new(s),\n-        )\n+        <[T]>::into_vec(Box::new(s))\n     }\n \n     #[cfg(test)]"}]}