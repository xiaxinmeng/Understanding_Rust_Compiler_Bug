{"sha": "19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5ZTg0OTUxNmUxOWZjYjBhMTZiZTdkM2UzMjljMWJiYjE3NDZmYTM=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-22T12:36:53Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-20T10:23:31Z"}, "message": "debuginfo: add type metadata for params\n\nThis commit adds type metadata for generic parameters (that arise from\npolymorphization). Generic parameter metadata is considered zero-sized\nand named after the generic parameter.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "7bbce6384fc4d84e8ff8fdc4abd115c36ac8a7f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7bbce6384fc4d84e8ff8fdc4abd115c36ac8a7f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl8VcKMACgkQJZLnbIc4\nH9kpPRAAq6gAh6s2w2rv/K3GHjliwNGYQSNXH5b7LyLYNE/fc/xVpfMABJ52rShv\nun3PeTddnKpdlL5uUz0HauCW+E4Cvl3dBRYKrgyUD3oNScNMWZQT73ggE8TFwhEE\ne+2GEFyLjy842zLdXVtO/XvJOWLwTnBJjc6vwHAMIjqm7VEGa2hj9MCiKZcDof52\nnxZbGqOHRU8gzTGj/6it0ZXsuMGNgfiD1IvEaMbzOrOgW94gPBrjFgJUBG/NM/2q\nCJl32B81rKbgfVZZCq7L4b3Ufp+xtPK4ctwJP2tUWYpOtXg5dwPA74ikvQz40aWz\n7/KloN+A0tF/KpK7xa4C1AwuDU7H34rDONsYAUfY15e2ogeirRn5cEr2iVijyRfa\nTJrjkmVsKYKrUdnyaga2H1u2RRBQPVBW8WUWr0Cgv5XsiaTyn0B5JZv7bZGUbbD7\n01M8aBcKmdSYsZEk7GXyjCch1thN3dwt+qNcD0JHwfgPrKD9gKuwyqyL0QhW57Zh\nfg7hqm8UHtNruepF2VsJo2yKwM76RVSae6K62MCaFBBY84sNXIOxQYfXHeZd2Fh7\nYwUQnlWCbe12vkVFFZ9EdbN+bS6NnPYRbzX4d9X9j2BUhdx7yKQJSQyteH6jYeBv\nKynalLTvpOiibqy+eFlLlaKVP/0UfbBvK5ouLlSE6uqTJe0Yw30=\n=jjQ7\n-----END PGP SIGNATURE-----", "payload": "tree 7bbce6384fc4d84e8ff8fdc4abd115c36ac8a7f3\nparent 5bf2c7d4fec536c4237e859390c524837324977f\nauthor David Wood <david@davidtw.co> 1592829413 +0100\ncommitter David Wood <david@davidtw.co> 1595240611 +0100\n\ndebuginfo: add type metadata for params\n\nThis commit adds type metadata for generic parameters (that arise from\npolymorphization). Generic parameter metadata is considered zero-sized\nand named after the generic parameter.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "html_url": "https://github.com/rust-lang/rust/commit/19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/19e849516e19fcb0a16be7d3e329c1bbb1746fa3/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5bf2c7d4fec536c4237e859390c524837324977f", "url": "https://api.github.com/repos/rust-lang/rust/commits/5bf2c7d4fec536c4237e859390c524837324977f", "html_url": "https://github.com/rust-lang/rust/commit/5bf2c7d4fec536c4237e859390c524837324977f"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "c34c6caa8cab48cdf585d55c0c1aa40686c97219", "filename": "src/librustc_codegen_llvm/debuginfo/metadata.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/19e849516e19fcb0a16be7d3e329c1bbb1746fa3/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/19e849516e19fcb0a16be7d3e329c1bbb1746fa3/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs?ref=19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "patch": "@@ -700,6 +700,8 @@ pub fn type_metadata(cx: &CodegenCx<'ll, 'tcx>, t: Ty<'tcx>, usage_site_span: Sp\n             prepare_tuple_metadata(cx, t, &tys, unique_type_id, usage_site_span, NO_SCOPE_METADATA)\n                 .finalize(cx)\n         }\n+        // Type parameters from polymorphized functions.\n+        ty::Param(_) => MetadataCreationResult::new(param_type_metadata(cx, t), false),\n         _ => bug!(\"debuginfo: unexpected type in type_metadata: {:?}\", t),\n     };\n \n@@ -955,6 +957,20 @@ fn pointer_type_metadata(\n     }\n }\n \n+fn param_type_metadata(cx: &CodegenCx<'ll, 'tcx>, t: Ty<'tcx>) -> &'ll DIType {\n+    debug!(\"param_type_metadata: {:?}\", t);\n+    let name = format!(\"{:?}\", t);\n+    return unsafe {\n+        llvm::LLVMRustDIBuilderCreateBasicType(\n+            DIB(cx),\n+            name.as_ptr().cast(),\n+            name.len(),\n+            Size::ZERO.bits(),\n+            DW_ATE_unsigned,\n+        )\n+    };\n+}\n+\n pub fn compile_unit_metadata(\n     tcx: TyCtxt<'_>,\n     codegen_unit_name: &str,"}, {"sha": "fb8f5a6298911f23584790e9cf62b39db5ec189d", "filename": "src/librustc_codegen_ssa/debuginfo/type_names.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/19e849516e19fcb0a16be7d3e329c1bbb1746fa3/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/19e849516e19fcb0a16be7d3e329c1bbb1746fa3/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs?ref=19e849516e19fcb0a16be7d3e329c1bbb1746fa3", "patch": "@@ -205,14 +205,17 @@ pub fn push_debuginfo_type_name<'tcx>(\n                 tcx.def_key(def_id).disambiguated_data.disambiguator\n             ));\n         }\n+        // Type parameters from polymorphized functions.\n+        ty::Param(_) => {\n+            output.push_str(&format!(\"{:?}\", t));\n+        }\n         ty::Error(_)\n         | ty::Infer(_)\n         | ty::Placeholder(..)\n         | ty::Projection(..)\n         | ty::Bound(..)\n         | ty::Opaque(..)\n-        | ty::GeneratorWitness(..)\n-        | ty::Param(_) => {\n+        | ty::GeneratorWitness(..) => {\n             bug!(\n                 \"debuginfo: Trying to create type name for \\\n                   unexpected type: {:?}\","}]}