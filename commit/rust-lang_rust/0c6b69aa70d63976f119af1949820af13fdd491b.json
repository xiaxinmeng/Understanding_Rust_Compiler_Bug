{"sha": "0c6b69aa70d63976f119af1949820af13fdd491b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjNmI2OWFhNzBkNjM5NzZmMTE5YWYxOTQ5ODIwYWYxM2ZkZDQ5MWI=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-03-01T23:50:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-01T23:50:10Z"}, "message": "Rollup merge of #82662 - GuillaumeGomez:doc-attr-check, r=jyn514\n\nWarn about unknown doc attributes\n\nFixes #82652.\n\nFor the text error, I decided to go for \"invalid\" instead of \"unknown\". What do you think?\n\nr? `@jyn514`", "tree": {"sha": "7aef229a9777a8f14aba743f3e252ca188bb4314", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7aef229a9777a8f14aba743f3e252ca188bb4314"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0c6b69aa70d63976f119af1949820af13fdd491b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgPX2yCRBK7hj4Ov3rIwAAdHIIABIZmzfg6zNDkMx7gTk8wjoV\n27wMJw4zIKCA0rgtk4/AVZS3y6oxbX/KNjYd/NoIYuFsxhVWiteBxjaVvAo4s2uS\nnDdaRuDmoclzNTpo2FxLrxr60vhhevp/ynBR1Vp5REcdTddt6p6lcBDmG13EuYD/\nU1TvIeeJRagpmfTw3Bc3ObM4SzAjTiOsd+k5p2rrCULO3vHRao5f+4Ux59OCRYuX\nxd/u3CkyyJ6qKVZPDav993jj3U0XS1O1+4G8KC9Gm9ExD/9VUrN9R3nLcuPGaOYY\na7hX4VdOoGzJOFO6auF9kc8/lXjXWjBC7x7ZVzaPL8Pb83lSeZqTeC8vEfBe5hM=\n=RcWZ\n-----END PGP SIGNATURE-----\n", "payload": "tree 7aef229a9777a8f14aba743f3e252ca188bb4314\nparent d259d1d98a31b299d8c64abf5be429468329dec8\nparent f6de1300b499c669a1a7865cb9860c27cebe5ac1\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1614642610 +0100\ncommitter GitHub <noreply@github.com> 1614642610 +0100\n\nRollup merge of #82662 - GuillaumeGomez:doc-attr-check, r=jyn514\n\nWarn about unknown doc attributes\n\nFixes #82652.\n\nFor the text error, I decided to go for \"invalid\" instead of \"unknown\". What do you think?\n\nr? `@jyn514`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0c6b69aa70d63976f119af1949820af13fdd491b", "html_url": "https://github.com/rust-lang/rust/commit/0c6b69aa70d63976f119af1949820af13fdd491b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0c6b69aa70d63976f119af1949820af13fdd491b/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d259d1d98a31b299d8c64abf5be429468329dec8", "url": "https://api.github.com/repos/rust-lang/rust/commits/d259d1d98a31b299d8c64abf5be429468329dec8", "html_url": "https://github.com/rust-lang/rust/commit/d259d1d98a31b299d8c64abf5be429468329dec8"}, {"sha": "f6de1300b499c669a1a7865cb9860c27cebe5ac1", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6de1300b499c669a1a7865cb9860c27cebe5ac1", "html_url": "https://github.com/rust-lang/rust/commit/f6de1300b499c669a1a7865cb9860c27cebe5ac1"}], "stats": {"total": 73, "additions": 73, "deletions": 0}, "files": [{"sha": "afd1642bbd57c49c070c2777278f0c73e8e6f4c9", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/0c6b69aa70d63976f119af1949820af13fdd491b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c6b69aa70d63976f119af1949820af13fdd491b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=0c6b69aa70d63976f119af1949820af13fdd491b", "patch": "@@ -544,6 +544,41 @@ impl CheckAttrVisitor<'tcx> {\n                         {\n                             return false;\n                         }\n+                    } else if let Some(i_meta) = meta.meta_item() {\n+                        if ![\n+                            sym::cfg,\n+                            sym::hidden,\n+                            sym::html_favicon_url,\n+                            sym::html_logo_url,\n+                            sym::html_no_source,\n+                            sym::html_playground_url,\n+                            sym::html_root_url,\n+                            sym::include,\n+                            sym::inline,\n+                            sym::issue_tracker_base_url,\n+                            sym::masked,\n+                            sym::no_default_passes, // deprecated\n+                            sym::no_inline,\n+                            sym::passes, // deprecated\n+                            sym::primitive,\n+                            sym::spotlight,\n+                            sym::test,\n+                        ]\n+                        .iter()\n+                        .any(|m| i_meta.has_name(*m))\n+                        {\n+                            self.tcx\n+                                .sess\n+                                .struct_span_err(\n+                                    meta.span(),\n+                                    &format!(\n+                                        \"unknown `doc` attribute `{}`\",\n+                                        i_meta.name_or_empty(),\n+                                    ),\n+                                )\n+                                .emit();\n+                            return false;\n+                        }\n                     }\n                 }\n             }"}, {"sha": "37c69a214b8edb2adf2b41863e2115aca289a286", "filename": "src/test/rustdoc-ui/doc-attr.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs?ref=0c6b69aa70d63976f119af1949820af13fdd491b", "patch": "@@ -0,0 +1,5 @@\n+#![crate_type = \"lib\"]\n+#![doc(as_ptr)] //~ ERROR\n+\n+#[doc(as_ptr)] //~ ERROR\n+pub fn foo() {}"}, {"sha": "17bc3d6a45a05a06183f8f5e6c27547cba08f52f", "filename": "src/test/rustdoc-ui/doc-attr.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr?ref=0c6b69aa70d63976f119af1949820af13fdd491b", "patch": "@@ -0,0 +1,14 @@\n+error: unknown `doc` attribute `as_ptr`\n+  --> $DIR/doc-attr.rs:4:7\n+   |\n+LL | #[doc(as_ptr)]\n+   |       ^^^^^^\n+\n+error: unknown `doc` attribute `as_ptr`\n+  --> $DIR/doc-attr.rs:2:8\n+   |\n+LL | #![doc(as_ptr)]\n+   |        ^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "37c69a214b8edb2adf2b41863e2115aca289a286", "filename": "src/test/ui/attributes/doc-attr.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs?ref=0c6b69aa70d63976f119af1949820af13fdd491b", "patch": "@@ -0,0 +1,5 @@\n+#![crate_type = \"lib\"]\n+#![doc(as_ptr)] //~ ERROR\n+\n+#[doc(as_ptr)] //~ ERROR\n+pub fn foo() {}"}, {"sha": "17bc3d6a45a05a06183f8f5e6c27547cba08f52f", "filename": "src/test/ui/attributes/doc-attr.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c6b69aa70d63976f119af1949820af13fdd491b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr?ref=0c6b69aa70d63976f119af1949820af13fdd491b", "patch": "@@ -0,0 +1,14 @@\n+error: unknown `doc` attribute `as_ptr`\n+  --> $DIR/doc-attr.rs:4:7\n+   |\n+LL | #[doc(as_ptr)]\n+   |       ^^^^^^\n+\n+error: unknown `doc` attribute `as_ptr`\n+  --> $DIR/doc-attr.rs:2:8\n+   |\n+LL | #![doc(as_ptr)]\n+   |        ^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}