{"sha": "ce50e42ed667eb3e3fe26f05881e7d312e503970", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlNTBlNDJlZDY2N2ViM2UzZmUyNmYwNTg4MWU3ZDMxMmU1MDM5NzA=", "commit": {"author": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-04-25T21:52:36Z"}, "committer": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-04-26T19:27:29Z"}, "message": "Use the span of the attribute for the error message", "tree": {"sha": "a2619dc7e9502607d3fcf24aa27b962baba94857", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2619dc7e9502607d3fcf24aa27b962baba94857"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce50e42ed667eb3e3fe26f05881e7d312e503970", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce50e42ed667eb3e3fe26f05881e7d312e503970", "html_url": "https://github.com/rust-lang/rust/commit/ce50e42ed667eb3e3fe26f05881e7d312e503970", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce50e42ed667eb3e3fe26f05881e7d312e503970/comments", "author": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d24a1063958f8603463526b7a61f68648daec185", "url": "https://api.github.com/repos/rust-lang/rust/commits/d24a1063958f8603463526b7a61f68648daec185", "html_url": "https://github.com/rust-lang/rust/commit/d24a1063958f8603463526b7a61f68648daec185"}], "stats": {"total": 128, "additions": 84, "deletions": 44}, "files": [{"sha": "6431e0d6132b1a2cd4f84cbb96c81094e0c93b3b", "filename": "clippy_lints/src/attrs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ce50e42ed667eb3e3fe26f05881e7d312e503970/clippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce50e42ed667eb3e3fe26f05881e7d312e503970/clippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fattrs.rs?ref=ce50e42ed667eb3e3fe26f05881e7d312e503970", "patch": "@@ -632,11 +632,11 @@ fn check_mismatched_target_os(cx: &EarlyContext<'_>, attr: &Attribute) {\n         if attr.check_name(sym!(cfg));\n         if let Some(list) = attr.meta_item_list();\n         let mismatched = find_mismatched_target_os(&list);\n-        if let Some((_, span)) = mismatched.iter().peekable().peek();\n+        if !mismatched.is_empty();\n         then {\n             let mess = \"operating system used in target family position\";\n \n-            span_lint_and_then(cx, MISMATCHED_TARGET_OS, *span, &mess, |diag| {\n+            span_lint_and_then(cx, MISMATCHED_TARGET_OS, attr.span, &mess, |diag| {\n                 // Avoid showing the unix suggestion multiple times in case\n                 // we have more than one mismatch for unix-like systems\n                 let mut unix_suggested = false;"}, {"sha": "9cc1439ccc87a139d3ce3aadedc0ea5464b64638", "filename": "tests/ui/mismatched_target_os.stderr", "status": "modified", "additions": 82, "deletions": 42, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/ce50e42ed667eb3e3fe26f05881e7d312e503970/tests%2Fui%2Fmismatched_target_os.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ce50e42ed667eb3e3fe26f05881e7d312e503970/tests%2Fui%2Fmismatched_target_os.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmismatched_target_os.stderr?ref=ce50e42ed667eb3e3fe26f05881e7d312e503970", "patch": "@@ -1,161 +1,201 @@\n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:8:7\n+  --> $DIR/mismatched_target_os.rs:8:1\n    |\n LL | #[cfg(linux)]\n-   |       ^^^^^ help: try: `target_os = \"linux\"`\n+   | ^^^^^^-----^^\n+   |       |\n+   |       help: try: `target_os = \"linux\"`\n    |\n    = note: `-D clippy::mismatched-target-os` implied by `-D warnings`\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:11:7\n+  --> $DIR/mismatched_target_os.rs:11:1\n    |\n LL | #[cfg(freebsd)]\n-   |       ^^^^^^^ help: try: `target_os = \"freebsd\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"freebsd\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:14:7\n+  --> $DIR/mismatched_target_os.rs:14:1\n    |\n LL | #[cfg(dragonfly)]\n-   |       ^^^^^^^^^ help: try: `target_os = \"dragonfly\"`\n+   | ^^^^^^---------^^\n+   |       |\n+   |       help: try: `target_os = \"dragonfly\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:17:7\n+  --> $DIR/mismatched_target_os.rs:17:1\n    |\n LL | #[cfg(openbsd)]\n-   |       ^^^^^^^ help: try: `target_os = \"openbsd\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"openbsd\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:20:7\n+  --> $DIR/mismatched_target_os.rs:20:1\n    |\n LL | #[cfg(netbsd)]\n-   |       ^^^^^^ help: try: `target_os = \"netbsd\"`\n+   | ^^^^^^------^^\n+   |       |\n+   |       help: try: `target_os = \"netbsd\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:23:7\n+  --> $DIR/mismatched_target_os.rs:23:1\n    |\n LL | #[cfg(macos)]\n-   |       ^^^^^ help: try: `target_os = \"macos\"`\n+   | ^^^^^^-----^^\n+   |       |\n+   |       help: try: `target_os = \"macos\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:26:7\n+  --> $DIR/mismatched_target_os.rs:26:1\n    |\n LL | #[cfg(ios)]\n-   |       ^^^ help: try: `target_os = \"ios\"`\n+   | ^^^^^^---^^\n+   |       |\n+   |       help: try: `target_os = \"ios\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:29:7\n+  --> $DIR/mismatched_target_os.rs:29:1\n    |\n LL | #[cfg(android)]\n-   |       ^^^^^^^ help: try: `target_os = \"android\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"android\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:32:7\n+  --> $DIR/mismatched_target_os.rs:32:1\n    |\n LL | #[cfg(emscripten)]\n-   |       ^^^^^^^^^^ help: try: `target_os = \"emscripten\"`\n+   | ^^^^^^----------^^\n+   |       |\n+   |       help: try: `target_os = \"emscripten\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:35:7\n+  --> $DIR/mismatched_target_os.rs:35:1\n    |\n LL | #[cfg(fuchsia)]\n-   |       ^^^^^^^ help: try: `target_os = \"fuchsia\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"fuchsia\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:38:7\n+  --> $DIR/mismatched_target_os.rs:38:1\n    |\n LL | #[cfg(haiku)]\n-   |       ^^^^^ help: try: `target_os = \"haiku\"`\n+   | ^^^^^^-----^^\n+   |       |\n+   |       help: try: `target_os = \"haiku\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:41:7\n+  --> $DIR/mismatched_target_os.rs:41:1\n    |\n LL | #[cfg(illumos)]\n-   |       ^^^^^^^ help: try: `target_os = \"illumos\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"illumos\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:44:7\n+  --> $DIR/mismatched_target_os.rs:44:1\n    |\n LL | #[cfg(l4re)]\n-   |       ^^^^ help: try: `target_os = \"l4re\"`\n+   | ^^^^^^----^^\n+   |       |\n+   |       help: try: `target_os = \"l4re\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:47:7\n+  --> $DIR/mismatched_target_os.rs:47:1\n    |\n LL | #[cfg(redox)]\n-   |       ^^^^^ help: try: `target_os = \"redox\"`\n+   | ^^^^^^-----^^\n+   |       |\n+   |       help: try: `target_os = \"redox\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:50:7\n+  --> $DIR/mismatched_target_os.rs:50:1\n    |\n LL | #[cfg(solaris)]\n-   |       ^^^^^^^ help: try: `target_os = \"solaris\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"solaris\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:53:7\n+  --> $DIR/mismatched_target_os.rs:53:1\n    |\n LL | #[cfg(vxworks)]\n-   |       ^^^^^^^ help: try: `target_os = \"vxworks\"`\n+   | ^^^^^^-------^^\n+   |       |\n+   |       help: try: `target_os = \"vxworks\"`\n    |\n    = help: Did you mean `unix`?\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:58:7\n+  --> $DIR/mismatched_target_os.rs:58:1\n    |\n LL | #[cfg(cloudabi)]\n-   |       ^^^^^^^^ help: try: `target_os = \"cloudabi\"`\n+   | ^^^^^^--------^^\n+   |       |\n+   |       help: try: `target_os = \"cloudabi\"`\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:61:7\n+  --> $DIR/mismatched_target_os.rs:61:1\n    |\n LL | #[cfg(hermit)]\n-   |       ^^^^^^ help: try: `target_os = \"hermit\"`\n+   | ^^^^^^------^^\n+   |       |\n+   |       help: try: `target_os = \"hermit\"`\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:64:7\n+  --> $DIR/mismatched_target_os.rs:64:1\n    |\n LL | #[cfg(wasi)]\n-   |       ^^^^ help: try: `target_os = \"wasi\"`\n+   | ^^^^^^----^^\n+   |       |\n+   |       help: try: `target_os = \"wasi\"`\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:67:7\n+  --> $DIR/mismatched_target_os.rs:67:1\n    |\n LL | #[cfg(none)]\n-   |       ^^^^ help: try: `target_os = \"none\"`\n+   | ^^^^^^----^^\n+   |       |\n+   |       help: try: `target_os = \"none\"`\n \n error: operating system used in target family position\n-  --> $DIR/mismatched_target_os.rs:71:28\n+  --> $DIR/mismatched_target_os.rs:71:1\n    |\n LL | #[cfg(all(not(any(windows, linux)), freebsd))]\n-   |                            ^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: Did you mean `unix`?\n help: try"}]}