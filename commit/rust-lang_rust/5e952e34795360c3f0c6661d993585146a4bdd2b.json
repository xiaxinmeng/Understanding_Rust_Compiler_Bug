{"sha": "5e952e34795360c3f0c6661d993585146a4bdd2b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlOTUyZTM0Nzk1MzYwYzNmMGM2NjYxZDk5MzU4NTE0NmE0YmRkMmI=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-12-27T04:18:41Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-12-27T04:36:02Z"}, "message": "Add span label to unused string formatting argument\n\nFix #55350.", "tree": {"sha": "d7155e38c2b8e8ebaf5e42e295472ea724a75e61", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7155e38c2b8e8ebaf5e42e295472ea724a75e61"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e952e34795360c3f0c6661d993585146a4bdd2b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e952e34795360c3f0c6661d993585146a4bdd2b", "html_url": "https://github.com/rust-lang/rust/commit/5e952e34795360c3f0c6661d993585146a4bdd2b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e952e34795360c3f0c6661d993585146a4bdd2b/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e75001c596991d63729b41769164197db6fc5c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e75001c596991d63729b41769164197db6fc5c8", "html_url": "https://github.com/rust-lang/rust/commit/5e75001c596991d63729b41769164197db6fc5c8"}], "stats": {"total": 77, "additions": 46, "deletions": 31}, "files": [{"sha": "1d0cd9bd47222e749a9c3813220142e141054f7a", "filename": "src/libsyntax_ext/format.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Flibsyntax_ext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Flibsyntax_ext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fformat.rs?ref=5e952e34795360c3f0c6661d993585146a4bdd2b", "patch": "@@ -957,13 +957,18 @@ pub fn expand_preparsed_format_args(ecx: &mut ExtCtxt,\n         let mut diag = {\n             if errs_len == 1 {\n                 let (sp, msg) = errs.into_iter().next().unwrap();\n-                cx.ecx.struct_span_err(sp, msg)\n+                let mut diag = cx.ecx.struct_span_err(sp, msg);\n+                diag.span_label(sp, msg);\n+                diag\n             } else {\n                 let mut diag = cx.ecx.struct_span_err(\n                     errs.iter().map(|&(sp, _)| sp).collect::<Vec<Span>>(),\n                     \"multiple unused formatting arguments\",\n                 );\n                 diag.span_label(cx.fmtsp, \"multiple missing formatting specifiers\");\n+                for (sp, msg) in errs {\n+                    diag.span_label(sp, msg);\n+                }\n                 diag\n             }\n         };"}, {"sha": "d4153ac94acd1e6bcb9a4e0ba2a58196993bebb6", "filename": "src/test/ui/if/ifmt-bad-arg.stderr", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fif%2Fifmt-bad-arg.stderr?ref=5e952e34795360c3f0c6661d993585146a4bdd2b", "patch": "@@ -16,7 +16,7 @@ error: argument never used\n   --> $DIR/ifmt-bad-arg.rs:9:20\n    |\n LL |     format!(\"{1}\", 1);\n-   |             -----  ^\n+   |             -----  ^ argument never used\n    |             |\n    |             formatting specifier missing\n \n@@ -80,56 +80,58 @@ error: multiple unused formatting arguments\n   --> $DIR/ifmt-bad-arg.rs:32:17\n    |\n LL |     format!(\"\", 1, 2);               //~ ERROR: multiple unused formatting arguments\n-   |             --  ^  ^\n-   |             |\n+   |             --  ^  ^ argument never used\n+   |             |   |\n+   |             |   argument never used\n    |             multiple missing formatting specifiers\n \n error: argument never used\n   --> $DIR/ifmt-bad-arg.rs:33:22\n    |\n LL |     format!(\"{}\", 1, 2);             //~ ERROR: argument never used\n-   |             ----     ^\n+   |             ----     ^ argument never used\n    |             |\n    |             formatting specifier missing\n \n error: argument never used\n   --> $DIR/ifmt-bad-arg.rs:34:20\n    |\n LL |     format!(\"{1}\", 1, 2);            //~ ERROR: argument never used\n-   |             -----  ^\n+   |             -----  ^ argument never used\n    |             |\n    |             formatting specifier missing\n \n error: named argument never used\n   --> $DIR/ifmt-bad-arg.rs:35:26\n    |\n LL |     format!(\"{}\", 1, foo=2);         //~ ERROR: named argument never used\n-   |             ----         ^\n+   |             ----         ^ named argument never used\n    |             |\n    |             formatting specifier missing\n \n error: argument never used\n   --> $DIR/ifmt-bad-arg.rs:36:22\n    |\n LL |     format!(\"{foo}\", 1, foo=2);      //~ ERROR: argument never used\n-   |             -------  ^\n+   |             -------  ^ argument never used\n    |             |\n    |             formatting specifier missing\n \n error: named argument never used\n   --> $DIR/ifmt-bad-arg.rs:37:21\n    |\n LL |     format!(\"\", foo=2);              //~ ERROR: named argument never used\n-   |             --      ^\n+   |             --      ^ named argument never used\n    |             |\n    |             formatting specifier missing\n \n error: multiple unused formatting arguments\n   --> $DIR/ifmt-bad-arg.rs:38:32\n    |\n LL |     format!(\"{} {}\", 1, 2, foo=1, bar=2);  //~ ERROR: multiple unused formatting arguments\n-   |             -------            ^      ^\n-   |             |\n+   |             -------            ^      ^ named argument never used\n+   |             |                  |\n+   |             |                  named argument never used\n    |             multiple missing formatting specifiers\n \n error: duplicate argument named `foo`\n@@ -160,7 +162,7 @@ error: named argument never used\n   --> $DIR/ifmt-bad-arg.rs:45:51\n    |\n LL |     format!(\"{valuea} {valueb}\", valuea=5, valuec=7);\n-   |             -------------------                   ^\n+   |             -------------------                   ^ named argument never used\n    |             |\n    |             formatting specifier missing\n \n@@ -194,7 +196,7 @@ error: argument never used\n   --> $DIR/ifmt-bad-arg.rs:56:27\n    |\n LL |     format!(\"foo %s baz\", \"bar\"); //~ ERROR: argument never used\n-   |                  --       ^^^^^\n+   |                  --       ^^^^^ argument never used\n    |                  |\n    |                  help: format specifiers use curly braces: `{}`\n    |"}, {"sha": "0b8bfcbdc17baa74fb748ccaca47520836967e44", "filename": "src/test/ui/macros/format-foreign.stderr", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fmacros%2Fformat-foreign.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fmacros%2Fformat-foreign.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fformat-foreign.stderr?ref=5e952e34795360c3f0c6661d993585146a4bdd2b", "patch": "@@ -2,8 +2,10 @@ error: multiple unused formatting arguments\n   --> $DIR/format-foreign.rs:2:30\n    |\n LL |     println!(\"%.*3$s %s!/n\", \"Hello,\", \"World\", 4); //~ ERROR multiple unused formatting arguments\n-   |              --------------  ^^^^^^^^  ^^^^^^^  ^\n-   |              |\n+   |              --------------  ^^^^^^^^  ^^^^^^^  ^ argument never used\n+   |              |               |         |\n+   |              |               |         argument never used\n+   |              |               argument never used\n    |              multiple missing formatting specifiers\n    |\n    = note: printf formatting not supported; see the documentation for `std::fmt`\n@@ -16,7 +18,7 @@ error: argument never used\n   --> $DIR/format-foreign.rs:3:29\n    |\n LL |     println!(\"%1$*2$.*3$f\", 123.456); //~ ERROR never used\n-   |               -----------   ^^^^^^^\n+   |               -----------   ^^^^^^^ argument never used\n    |               |\n    |               help: format specifiers use curly braces: `{0:1$.2$}`\n    |\n@@ -29,8 +31,10 @@ LL |       println!(r###\"%.*3$s\n    |  ______________-\n LL | |         %s!/n\n LL | | \"###, \"Hello,\", \"World\", 4);\n-   | |    -  ^^^^^^^^  ^^^^^^^  ^\n-   | |____|\n+   | |    -  ^^^^^^^^  ^^^^^^^  ^ argument never used\n+   | |    |  |         |\n+   | |    |  |         argument never used\n+   | |____|  argument never used\n    |      multiple missing formatting specifiers\n    |\n    = note: printf formatting not supported; see the documentation for `std::fmt`\n@@ -44,15 +48,15 @@ error: argument never used\n   --> $DIR/format-foreign.rs:12:30\n    |\n LL |     println!(\"{} %f\", \"one\", 2.0); //~ ERROR never used\n-   |              -------         ^^^\n+   |              -------         ^^^ argument never used\n    |              |\n    |              formatting specifier missing\n \n error: named argument never used\n   --> $DIR/format-foreign.rs:14:39\n    |\n LL |     println!(\"Hi there, $NAME.\", NAME=\"Tim\"); //~ ERROR never used\n-   |                         -----         ^^^^^\n+   |                         -----         ^^^^^ named argument never used\n    |                         |\n    |                         help: format specifiers use curly braces: `{NAME}`\n    |\n@@ -62,8 +66,10 @@ error: multiple unused formatting arguments\n   --> $DIR/format-foreign.rs:15:32\n    |\n LL |     println!(\"$1 $0 $$ $NAME\", 1, 2, NAME=3);\n-   |              ----------------  ^  ^       ^\n-   |              |\n+   |              ----------------  ^  ^       ^ named argument never used\n+   |              |                 |  |\n+   |              |                 |  argument never used\n+   |              |                 argument never used\n    |              multiple missing formatting specifiers\n    |\n    = note: shell formatting not supported; see the documentation for `std::fmt`"}, {"sha": "0a5e379a4adb4777bbbcc5d847882a1ec25f0ad9", "filename": "src/test/ui/macros/format-unused-lables.stderr", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fmacros%2Fformat-unused-lables.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e952e34795360c3f0c6661d993585146a4bdd2b/src%2Ftest%2Fui%2Fmacros%2Fformat-unused-lables.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fformat-unused-lables.stderr?ref=5e952e34795360c3f0c6661d993585146a4bdd2b", "patch": "@@ -2,8 +2,10 @@ error: multiple unused formatting arguments\n   --> $DIR/format-unused-lables.rs:2:22\n    |\n LL |     println!(\"Test\", 123, 456, 789);\n-   |              ------  ^^^  ^^^  ^^^\n-   |              |\n+   |              ------  ^^^  ^^^  ^^^ argument never used\n+   |              |       |    |\n+   |              |       |    argument never used\n+   |              |       argument never used\n    |              multiple missing formatting specifiers\n \n error: multiple unused formatting arguments\n@@ -12,17 +14,17 @@ error: multiple unused formatting arguments\n LL |     println!(\"Test2\",\n    |              ------- multiple missing formatting specifiers\n LL |         123,  //~ ERROR multiple unused formatting arguments\n-   |         ^^^\n+   |         ^^^ argument never used\n LL |         456,\n-   |         ^^^\n+   |         ^^^ argument never used\n LL |         789\n-   |         ^^^\n+   |         ^^^ argument never used\n \n error: named argument never used\n   --> $DIR/format-unused-lables.rs:11:35\n    |\n LL |     println!(\"Some stuff\", UNUSED=\"args\"); //~ ERROR named argument never used\n-   |              ------------         ^^^^^^\n+   |              ------------         ^^^^^^ named argument never used\n    |              |\n    |              formatting specifier missing\n \n@@ -35,12 +37,12 @@ LL |     println!(\"Some more $STUFF\",\n    |              |          help: format specifiers use curly braces: `{STUFF}`\n    |              multiple missing formatting specifiers\n LL |         \"woo!\",  //~ ERROR multiple unused formatting arguments\n-   |         ^^^^^^\n+   |         ^^^^^^ argument never used\n LL |             STUFF=\n LL |        \"things\"\n-   |        ^^^^^^^^\n+   |        ^^^^^^^^ named argument never used\n LL |              , UNUSED=\"args\");\n-   |                       ^^^^^^\n+   |                       ^^^^^^ named argument never used\n    |\n    = note: shell formatting not supported; see the documentation for `std::fmt`\n "}]}