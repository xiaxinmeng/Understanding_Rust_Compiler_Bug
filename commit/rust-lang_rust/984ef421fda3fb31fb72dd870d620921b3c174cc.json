{"sha": "984ef421fda3fb31fb72dd870d620921b3c174cc", "node_id": "C_kwDOAAsO6NoAKDk4NGVmNDIxZmRhM2ZiMzFmYjcyZGQ4NzBkNjIwOTIxYjNjMTc0Y2M", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-16T20:30:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-16T20:30:49Z"}, "message": "Rollup merge of #99258 - estebank:suggest-let, r=wesleywiser\n\nProvide structured suggestion for dropped temp value", "tree": {"sha": "e9ea5dd175de12b59a062ba450ba4efc7754a99a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9ea5dd175de12b59a062ba450ba4efc7754a99a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/984ef421fda3fb31fb72dd870d620921b3c174cc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi0x/6CRBK7hj4Ov3rIwAAwnkIAAOhh7plYGNOyZvUrgnv96qm\nKShKddy5/DsW/i0fLCoSvnIFr1OhC8OLt2D0s5i1yVqDPvGRQSyjTgJKMvHIMN+q\nRMfxC442rvXCpLHpyM4B6aibWWbKOJ861CsAfpg2BzTIIHI2C/6yDJcGHfMhxQ2P\n2ywROrDV0zSynFopsCYMGD2APTnZrjPb5/ygaAYgkTvDnj4ZYNZlnIAqtST2B+BH\npqLOoOp9lsOn5RK5MW6pB+0gjfFcpTAi9+0aYCNQQpt2jymHbrkfVAkXh2z1dNnQ\ngzBKt9zGYFdzyXEGzJFUT5FOqu6Heh8H6q7+u45/Rjb5Q3xRqUW1asLV7tUzJqQ=\n=wfSL\n-----END PGP SIGNATURE-----\n", "payload": "tree e9ea5dd175de12b59a062ba450ba4efc7754a99a\nparent 79857a740eb4757a7b59da9e7740223bb4c9e115\nparent 3ee4e5f7040e2c7bca4dd39a6c5670c1a343eeb5\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1658003449 +0200\ncommitter GitHub <noreply@github.com> 1658003449 +0200\n\nRollup merge of #99258 - estebank:suggest-let, r=wesleywiser\n\nProvide structured suggestion for dropped temp value\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/984ef421fda3fb31fb72dd870d620921b3c174cc", "html_url": "https://github.com/rust-lang/rust/commit/984ef421fda3fb31fb72dd870d620921b3c174cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/984ef421fda3fb31fb72dd870d620921b3c174cc/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79857a740eb4757a7b59da9e7740223bb4c9e115", "url": "https://api.github.com/repos/rust-lang/rust/commits/79857a740eb4757a7b59da9e7740223bb4c9e115", "html_url": "https://github.com/rust-lang/rust/commit/79857a740eb4757a7b59da9e7740223bb4c9e115"}, {"sha": "3ee4e5f7040e2c7bca4dd39a6c5670c1a343eeb5", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ee4e5f7040e2c7bca4dd39a6c5670c1a343eeb5", "html_url": "https://github.com/rust-lang/rust/commit/3ee4e5f7040e2c7bca4dd39a6c5670c1a343eeb5"}], "stats": {"total": 251, "additions": 220, "deletions": 31}, "files": [{"sha": "3cd1f4e0b4bdcbd8a90cbb52ef391c2f377b2c2c", "filename": "compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs", "status": "modified", "additions": 65, "deletions": 2, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -7,7 +7,7 @@ use rustc_errors::{\n };\n use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n-use rustc_hir::intravisit::{walk_expr, Visitor};\n+use rustc_hir::intravisit::{walk_block, walk_expr, Visitor};\n use rustc_hir::{AsyncGeneratorKind, GeneratorKind};\n use rustc_infer::infer::TyCtxtInferExt;\n use rustc_infer::traits::ObligationCause;\n@@ -1500,7 +1500,70 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n             | BorrowExplanation::UsedLaterInLoop(..)\n             | BorrowExplanation::UsedLaterWhenDropped { .. } => {\n                 // Only give this note and suggestion if it could be relevant.\n-                err.note(\"consider using a `let` binding to create a longer lived value\");\n+                let sm = self.infcx.tcx.sess.source_map();\n+                let mut suggested = false;\n+                let msg = \"consider using a `let` binding to create a longer lived value\";\n+\n+                /// We check that there's a single level of block nesting to ensure always correct\n+                /// suggestions. If we don't, then we only provide a free-form message to avoid\n+                /// misleading users in cases like `src/test/ui/nll/borrowed-temporary-error.rs`.\n+                /// We could expand the analysis to suggest hoising all of the relevant parts of\n+                /// the users' code to make the code compile, but that could be too much.\n+                struct NestedStatementVisitor {\n+                    span: Span,\n+                    current: usize,\n+                    found: usize,\n+                }\n+\n+                impl<'tcx> Visitor<'tcx> for NestedStatementVisitor {\n+                    fn visit_block(&mut self, block: &hir::Block<'tcx>) {\n+                        self.current += 1;\n+                        walk_block(self, block);\n+                        self.current -= 1;\n+                    }\n+                    fn visit_expr(&mut self, expr: &hir::Expr<'tcx>) {\n+                        if self.span == expr.span {\n+                            self.found = self.current;\n+                        }\n+                        walk_expr(self, expr);\n+                    }\n+                }\n+                let source_info = self.body.source_info(location);\n+                if let Some(scope) = self.body.source_scopes.get(source_info.scope)\n+                    && let ClearCrossCrate::Set(scope_data) = &scope.local_data\n+                    && let Some(node) = self.infcx.tcx.hir().find(scope_data.lint_root)\n+                    && let Some(id) = node.body_id()\n+                    && let hir::ExprKind::Block(block, _) = self.infcx.tcx.hir().body(id).value.kind\n+                {\n+                    for stmt in block.stmts {\n+                        let mut visitor = NestedStatementVisitor {\n+                            span: proper_span,\n+                            current: 0,\n+                            found: 0,\n+                        };\n+                        visitor.visit_stmt(stmt);\n+                        if visitor.found == 0\n+                            && stmt.span.contains(proper_span)\n+                            && let Some(p) = sm.span_to_margin(stmt.span)\n+                            && let Ok(s) = sm.span_to_snippet(proper_span)\n+                        {\n+                            let addition = format!(\"let binding = {};\\n{}\", s, \" \".repeat(p));\n+                            err.multipart_suggestion_verbose(\n+                                msg,\n+                                vec![\n+                                    (stmt.span.shrink_to_lo(), addition),\n+                                    (proper_span, \"binding\".to_string()),\n+                                ],\n+                                Applicability::MaybeIncorrect,\n+                            );\n+                            suggested = true;\n+                            break;\n+                        }\n+                    }\n+                }\n+                if !suggested {\n+                    err.note(msg);\n+                }\n             }\n             _ => {}\n         }"}, {"sha": "8bf6a2f6db3966c2410c637bed09dc3da4319396", "filename": "src/test/ui/borrowck/borrowck-borrowed-uniq-rvalue.fixed", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.fixed?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -0,0 +1,14 @@\n+// run-rustfix\n+\n+use std::collections::HashMap;\n+\n+fn main() {\n+    let tmp: Box<_>;\n+    let mut buggy_map: HashMap<usize, &usize> = HashMap::new();\n+    let binding = Box::new(1);\n+    buggy_map.insert(42, &*binding); //~ ERROR temporary value dropped while borrowed\n+\n+    // but it is ok if we use a temporary\n+    tmp = Box::new(2);\n+    buggy_map.insert(43, &*tmp);\n+}"}, {"sha": "85481336a305f5dbadadc7ce9f72fd0ff86dd774", "filename": "src/test/ui/borrowck/borrowck-borrowed-uniq-rvalue.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,8 +1,6 @@\n-use std::collections::HashMap;\n-\n-\n-\n+// run-rustfix\n \n+use std::collections::HashMap;\n \n fn main() {\n     let tmp: Box<_>;"}, {"sha": "dea8ac90bec2ebe5033acfa2657020c6b574aadd", "filename": "src/test/ui/borrowck/borrowck-borrowed-uniq-rvalue.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-borrowed-uniq-rvalue.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,5 +1,5 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/borrowck-borrowed-uniq-rvalue.rs:10:28\n+  --> $DIR/borrowck-borrowed-uniq-rvalue.rs:8:28\n    |\n LL |     buggy_map.insert(42, &*Box::new(1));\n    |                            ^^^^^^^^^^^ - temporary value is freed at the end of this statement\n@@ -9,7 +9,11 @@ LL |     buggy_map.insert(42, &*Box::new(1));\n LL |     buggy_map.insert(43, &*tmp);\n    |     --------------------------- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = Box::new(1);\n+LL ~     buggy_map.insert(42, &*binding);\n+   |\n \n error: aborting due to previous error\n "}, {"sha": "139bd9a073973fdcc30117ea11c2be0f202fbb43", "filename": "src/test/ui/borrowck/issue-11493.fixed", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.fixed?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -0,0 +1,9 @@\n+// run-rustfix\n+fn id<T>(x: T) -> T { x }\n+\n+fn main() {\n+    let x = Some(3);\n+    let binding = id(5);\n+    let y = x.as_ref().unwrap_or(&binding);  //~ ERROR\n+    let _ = &y;\n+}"}, {"sha": "cb77f89fb2b1ec5efe544d5f45db1fc7c12b6da8", "filename": "src/test/ui/borrowck/issue-11493.rs", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,7 +1,8 @@\n+// run-rustfix\n fn id<T>(x: T) -> T { x }\n \n fn main() {\n     let x = Some(3);\n     let y = x.as_ref().unwrap_or(&id(5));  //~ ERROR\n-    &y;\n+    let _ = &y;\n }", "previous_filename": "src/test/ui/issues/issue-11493.rs"}, {"sha": "a5d1f2816f1ca707dbf04b1130d8cf07b82e5c7b", "filename": "src/test/ui/borrowck/issue-11493.stderr", "status": "renamed", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-11493.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,14 +1,18 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/issue-11493.rs:5:35\n+  --> $DIR/issue-11493.rs:6:35\n    |\n LL |     let y = x.as_ref().unwrap_or(&id(5));\n    |                                   ^^^^^ - temporary value is freed at the end of this statement\n    |                                   |\n    |                                   creates a temporary which is freed while still in use\n-LL |     &y;\n-   |     -- borrow later used here\n+LL |     let _ = &y;\n+   |             -- borrow later used here\n+   |\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = id(5);\n+LL ~     let y = x.as_ref().unwrap_or(&binding);\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n \n error: aborting due to previous error\n ", "previous_filename": "src/test/ui/issues/issue-11493.stderr"}, {"sha": "8640ca7a509648142c49cde2430c5bc010398588", "filename": "src/test/ui/borrowck/issue-36082.fixed", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.fixed?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -0,0 +1,17 @@\n+// run-rustfix\n+use std::cell::RefCell;\n+\n+fn main() {\n+    let mut r = 0;\n+    let s = 0;\n+    let x = RefCell::new((&mut r,s));\n+\n+    let binding = x.borrow();\n+    let val: &_ = binding.0;\n+    //~^ ERROR temporary value dropped while borrowed [E0716]\n+    //~| NOTE temporary value is freed at the end of this statement\n+    //~| NOTE creates a temporary which is freed while still in use\n+    //~| HELP consider using a `let` binding to create a longer lived value\n+    println!(\"{}\", val);\n+    //~^ borrow later used here\n+}"}, {"sha": "877d372fb8484985fb880bc6b5bbe165122ad974", "filename": "src/test/ui/borrowck/issue-36082.rs", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n use std::cell::RefCell;\n \n fn main() {\n@@ -9,7 +10,7 @@ fn main() {\n     //~^ ERROR temporary value dropped while borrowed [E0716]\n     //~| NOTE temporary value is freed at the end of this statement\n     //~| NOTE creates a temporary which is freed while still in use\n-    //~| NOTE consider using a `let` binding to create a longer lived value\n+    //~| HELP consider using a `let` binding to create a longer lived value\n     println!(\"{}\", val);\n     //~^ borrow later used here\n }", "previous_filename": "src/test/ui/issues/issue-36082.rs"}, {"sha": "4bd586db1cdcea283e86407ae370811641a27f99", "filename": "src/test/ui/borrowck/issue-36082.stderr", "status": "renamed", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-36082.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,5 +1,5 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/issue-36082.rs:8:19\n+  --> $DIR/issue-36082.rs:9:19\n    |\n LL |     let val: &_ = x.borrow().0;\n    |                   ^^^^^^^^^^  - temporary value is freed at the end of this statement\n@@ -9,7 +9,11 @@ LL |     let val: &_ = x.borrow().0;\n LL |     println!(\"{}\", val);\n    |                    --- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = x.borrow();\n+LL ~     let val: &_ = binding.0;\n+   |\n \n error: aborting due to previous error\n ", "previous_filename": "src/test/ui/issues/issue-36082.stderr"}, {"sha": "40f14c389842e6e93331b2d162c5490dfe6e2a47", "filename": "src/test/ui/cleanup-rvalue-scopes-cf.stderr", "status": "modified", "additions": 35, "deletions": 7, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fcleanup-rvalue-scopes-cf.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fcleanup-rvalue-scopes-cf.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcleanup-rvalue-scopes-cf.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -9,7 +9,11 @@ LL |     let x1 = arg(&AddFlags(1));\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |      -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let x1 = arg(&binding);\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:27:14\n@@ -22,7 +26,11 @@ LL |     let x2 = AddFlags(1).get();\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |          -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let x2 = binding.get();\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:28:21\n@@ -35,7 +43,11 @@ LL |     let x3 = &*arg(&AddFlags(1));\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |              -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let x3 = &*arg(&binding);\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:29:24\n@@ -48,7 +60,11 @@ LL |     let ref x4 = *arg(&AddFlags(1));\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |                  -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let ref x4 = *arg(&binding);\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:30:24\n@@ -61,7 +77,11 @@ LL |     let &ref x5 = arg(&AddFlags(1));\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |                      -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let &ref x5 = arg(&binding);\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:31:14\n@@ -74,7 +94,11 @@ LL |     let x6 = AddFlags(1).get();\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |                          -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let x6 = binding.get();\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/cleanup-rvalue-scopes-cf.rs:32:44\n@@ -87,7 +111,11 @@ LL |\n LL |     (x1, x2, x3, x4, x5, x6, x7);\n    |                              -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = AddFlags(1);\n+LL ~     let StackBox { f: x7 } = StackBox { f: binding.get() };\n+   |\n \n error: aborting due to 7 previous errors\n "}, {"sha": "6240f103c99b062a9b60bce70c161ef94efe65a8", "filename": "src/test/ui/span/borrowck-let-suggestion-suffixes.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -20,7 +20,7 @@ fn f() {\n     //~^ ERROR temporary value dropped while borrowed\n     //~| NOTE creates a temporary which is freed while still in use\n     //~| NOTE temporary value is freed at the end of this statement\n-    //~| NOTE consider using a `let` binding to create a longer lived value\n+    //~| HELP consider using a `let` binding to create a longer lived value\n \n     {\n \n@@ -41,7 +41,7 @@ fn f() {\n     //~^ ERROR temporary value dropped while borrowed\n     //~| NOTE creates a temporary which is freed while still in use\n     //~| NOTE temporary value is freed at the end of this statement\n-    //~| NOTE consider using a `let` binding to create a longer lived value\n+    //~| HELP consider using a `let` binding to create a longer lived value\n \n     v1.push(&old[0]);\n "}, {"sha": "a236dab3ae562ef96a19c2c7423c0a9169835dbb", "filename": "src/test/ui/span/borrowck-let-suggestion-suffixes.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -21,7 +21,11 @@ LL |     v3.push(&id('x'));           // statement 6\n LL |     (v1, v2, v3, /* v4 is above. */ v5).use_ref();\n    |              -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = id('x');\n+LL ~     v3.push(&binding);           // statement 6\n+   |\n \n error[E0716]: temporary value dropped while borrowed\n   --> $DIR/borrowck-let-suggestion-suffixes.rs:29:18\n@@ -47,7 +51,11 @@ LL |     v5.push(&id('z'));\n LL |     (v1, v2, v3, /* v4 is above. */ v5).use_ref();\n    |                                     -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = id('z');\n+LL ~     v5.push(&binding);\n+   |\n \n error: aborting due to 4 previous errors\n "}, {"sha": "51f65e5345d2a0f2ad3b75b0621b4ecf83c55226", "filename": "src/test/ui/span/borrowck-ref-into-rvalue.fixed", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.fixed?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -0,0 +1,13 @@\n+// run-rustfix\n+fn main() {\n+    let msg;\n+    let binding = Some(\"Hello\".to_string());\n+    match binding {\n+        //~^ ERROR temporary value dropped while borrowed\n+        Some(ref m) => {\n+            msg = m;\n+        },\n+        None => { panic!() }\n+    }\n+    println!(\"{}\", *msg);\n+}"}, {"sha": "7b09fad927fdf75040fea2d118cea45a6db1da7f", "filename": "src/test/ui/span/borrowck-ref-into-rvalue.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n fn main() {\n     let msg;\n     match Some(\"Hello\".to_string()) {"}, {"sha": "cb5289d24b4fc4ee5ee9a3c272ba48860c43e791", "filename": "src/test/ui/span/borrowck-ref-into-rvalue.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-ref-into-rvalue.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,5 +1,5 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/borrowck-ref-into-rvalue.rs:3:11\n+  --> $DIR/borrowck-ref-into-rvalue.rs:4:11\n    |\n LL |     match Some(\"Hello\".to_string()) {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^ creates a temporary which is freed while still in use\n@@ -9,7 +9,11 @@ LL |     }\n LL |     println!(\"{}\", *msg);\n    |                    ---- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = Some(\"Hello\".to_string());\n+LL ~     match binding {\n+   |\n \n error: aborting due to previous error\n "}, {"sha": "e6d1a4dd32806e4c75ff4dd4a7a5ffeedf2f02d8", "filename": "src/test/ui/span/issue-15480.fixed", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-15480.fixed?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -0,0 +1,14 @@\n+// run-rustfix\n+fn id<T>(x: T) -> T { x }\n+\n+fn main() {\n+    let binding = id(3);\n+    let v = vec![\n+        &binding\n+    ];\n+    //~^^ ERROR temporary value dropped while borrowed\n+\n+    for &&x in &v {\n+        println!(\"{}\", x + 3);\n+    }\n+}"}, {"sha": "916ce4b1edb266330b8972fc2fa127acc321ed6b", "filename": "src/test/ui/span/issue-15480.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n fn id<T>(x: T) -> T { x }\n \n fn main() {"}, {"sha": "460ad9ac7444502da198362c2f3273b317035134", "filename": "src/test/ui/span/issue-15480.stderr", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/984ef421fda3fb31fb72dd870d620921b3c174cc/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr?ref=984ef421fda3fb31fb72dd870d620921b3c174cc", "patch": "@@ -1,5 +1,5 @@\n error[E0716]: temporary value dropped while borrowed\n-  --> $DIR/issue-15480.rs:5:10\n+  --> $DIR/issue-15480.rs:6:10\n    |\n LL |         &id(3)\n    |          ^^^^^ creates a temporary which is freed while still in use\n@@ -9,7 +9,12 @@ LL |     ];\n LL |     for &&x in &v {\n    |                -- borrow later used here\n    |\n-   = note: consider using a `let` binding to create a longer lived value\n+help: consider using a `let` binding to create a longer lived value\n+   |\n+LL ~     let binding = id(3);\n+LL ~     let v = vec![\n+LL ~         &binding\n+   |\n \n error: aborting due to previous error\n "}]}