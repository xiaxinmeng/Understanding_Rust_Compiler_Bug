{"sha": "33e8aaf830578d71ac55c6e612dbcff7aef766d2", "node_id": "C_kwDOAAsO6NoAKDMzZThhYWY4MzA1NzhkNzFhYzU1YzZlNjEyZGJjZmY3YWVmNzY2ZDI", "commit": {"author": {"name": "nidnogg", "email": "henriquevt98@gmail.com", "date": "2022-08-19T01:49:59Z"}, "committer": {"name": "nidnogg", "email": "henriquevt98@gmail.com", "date": "2022-08-22T02:22:53Z"}, "message": "Migration on ops.rs for unstable const functions", "tree": {"sha": "cd84891407dd3a15109e30b8d39023f32aeec11d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd84891407dd3a15109e30b8d39023f32aeec11d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33e8aaf830578d71ac55c6e612dbcff7aef766d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33e8aaf830578d71ac55c6e612dbcff7aef766d2", "html_url": "https://github.com/rust-lang/rust/commit/33e8aaf830578d71ac55c6e612dbcff7aef766d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33e8aaf830578d71ac55c6e612dbcff7aef766d2/comments", "author": {"login": "nidnogg", "id": 17261185, "node_id": "MDQ6VXNlcjE3MjYxMTg1", "avatar_url": "https://avatars.githubusercontent.com/u/17261185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nidnogg", "html_url": "https://github.com/nidnogg", "followers_url": "https://api.github.com/users/nidnogg/followers", "following_url": "https://api.github.com/users/nidnogg/following{/other_user}", "gists_url": "https://api.github.com/users/nidnogg/gists{/gist_id}", "starred_url": "https://api.github.com/users/nidnogg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nidnogg/subscriptions", "organizations_url": "https://api.github.com/users/nidnogg/orgs", "repos_url": "https://api.github.com/users/nidnogg/repos", "events_url": "https://api.github.com/users/nidnogg/events{/privacy}", "received_events_url": "https://api.github.com/users/nidnogg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nidnogg", "id": 17261185, "node_id": "MDQ6VXNlcjE3MjYxMTg1", "avatar_url": "https://avatars.githubusercontent.com/u/17261185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nidnogg", "html_url": "https://github.com/nidnogg", "followers_url": "https://api.github.com/users/nidnogg/followers", "following_url": "https://api.github.com/users/nidnogg/following{/other_user}", "gists_url": "https://api.github.com/users/nidnogg/gists{/gist_id}", "starred_url": "https://api.github.com/users/nidnogg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nidnogg/subscriptions", "organizations_url": "https://api.github.com/users/nidnogg/orgs", "repos_url": "https://api.github.com/users/nidnogg/repos", "events_url": "https://api.github.com/users/nidnogg/events{/privacy}", "received_events_url": "https://api.github.com/users/nidnogg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70ea98633e44b1220e40c1e8bcdc82edcc18da77", "url": "https://api.github.com/repos/rust-lang/rust/commits/70ea98633e44b1220e40c1e8bcdc82edcc18da77", "html_url": "https://github.com/rust-lang/rust/commit/70ea98633e44b1220e40c1e8bcdc82edcc18da77"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "19e9e33ab8005d10a15d6780cd617b0b6543c940", "filename": "compiler/rustc_const_eval/src/errors.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs?ref=33e8aaf830578d71ac55c6e612dbcff7aef766d2", "patch": "@@ -103,3 +103,11 @@ pub(crate) struct UnallowedFnPointerCall {\n     pub span: Span,\n     pub kind: ConstContext,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[error(const_eval::unstable_const_fn)]\n+pub(crate) struct UnstableConstFn {\n+    #[primary_span]\n+    pub span: Span,\n+    pub def_id: String,\n+}"}, {"sha": "22d681fd33679e5a6a5b2bf824955f50fe2976a1", "filename": "compiler/rustc_const_eval/src/transform/check_consts/ops.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=33e8aaf830578d71ac55c6e612dbcff7aef766d2", "patch": "@@ -25,7 +25,7 @@ use rustc_trait_selection::traits::SelectionContext;\n use super::ConstCx;\n use crate::errors::{\n     MutDerefErr, NonConstOpErr, PanicNonStrErr, RawPtrToIntErr, StaticAccessErr,\n-    TransientMutBorrowErr, TransientMutBorrowErrRaw, UnallowedFnPointerCall,\n+    TransientMutBorrowErr, TransientMutBorrowErrRaw, UnallowedFnPointerCall, UnstableConstFn,\n };\n use crate::util::{call_kind, CallDesugaringKind, CallKind};\n \n@@ -351,10 +351,8 @@ impl<'tcx> NonConstOp<'tcx> for FnCallUnstable {\n     ) -> DiagnosticBuilder<'tcx, ErrorGuaranteed> {\n         let FnCallUnstable(def_id, feature) = *self;\n \n-        let mut err = ccx.tcx.sess.struct_span_err(\n-            span,\n-            &format!(\"`{}` is not yet stable as a const fn\", ccx.tcx.def_path_str(def_id)),\n-        );\n+        let mut err =\n+            ccx.tcx.sess.create_err(UnstableConstFn { span, def_id: ccx.tcx.def_path_str(def_id) });\n \n         if ccx.is_const_stable_const_fn() {\n             err.help(\"const-stable functions can only call other const-stable functions\");"}, {"sha": "a9d9838a382424abae5d613384fd5e1ba9406da3", "filename": "compiler/rustc_error_messages/locales/en-US/const_eval.ftl", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/33e8aaf830578d71ac55c6e612dbcff7aef766d2/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl?ref=33e8aaf830578d71ac55c6e612dbcff7aef766d2", "patch": "@@ -32,4 +32,6 @@ const_eval_transient_mut_borrow_raw = raw mutable references are not allowed in\n \n const_evaL_max_num_nodes_exceeded = maximum number of nodes exceeded in constant {$s}\n \n-const_eval_unallowed_fn_pointer_call = function pointer calls are not allowed in {$const_kind}s\n\\ No newline at end of file\n+const_eval_unallowed_fn_pointer_call = function pointer calls are not allowed in {$kind}s\n+\n+const_eval_unstable_const_fn = `{$def_id}` is not yet stable as a const fn\n\\ No newline at end of file"}]}