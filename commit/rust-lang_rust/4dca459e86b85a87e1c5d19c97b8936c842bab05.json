{"sha": "4dca459e86b85a87e1c5d19c97b8936c842bab05", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkY2E0NTllODZiODVhODdlMWM1ZDE5Yzk3Yjg5MzZjODQyYmFiMDU=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2017-01-06T15:51:37Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2017-01-09T15:06:58Z"}, "message": "trans: Disambiguate generic instance symbol names by instantiating crate.\n\nTwo crates will often instantiate the same generic functions. Since\nwe don't make any attempt to re-use these instances cross-crate, we\nwould run into symbol conflicts for anything with external linkage.\n\nIn order to avoid this, this commit makes the compiler incorporate\nthe ID of the instantiating crate into the symbol hash. This way\nequal generic instances will have different symbols names when\nused in different crates.", "tree": {"sha": "461a58e8af80c3d4ccebccb242642b7638d814be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/461a58e8af80c3d4ccebccb242642b7638d814be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4dca459e86b85a87e1c5d19c97b8936c842bab05", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4dca459e86b85a87e1c5d19c97b8936c842bab05", "html_url": "https://github.com/rust-lang/rust/commit/4dca459e86b85a87e1c5d19c97b8936c842bab05", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4dca459e86b85a87e1c5d19c97b8936c842bab05/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ef1a69d2e05d86e0893763d2c86677e9c5f3d99", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ef1a69d2e05d86e0893763d2c86677e9c5f3d99", "html_url": "https://github.com/rust-lang/rust/commit/7ef1a69d2e05d86e0893763d2c86677e9c5f3d99"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "8f8c48a06b2c086bc749b72513442d3067b46ae4", "filename": "src/librustc_trans/back/symbol_names.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/4dca459e86b85a87e1c5d19c97b8936c842bab05/src%2Flibrustc_trans%2Fback%2Fsymbol_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dca459e86b85a87e1c5d19c97b8936c842bab05/src%2Flibrustc_trans%2Fback%2Fsymbol_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fsymbol_names.rs?ref=4dca459e86b85a87e1c5d19c97b8936c842bab05", "patch": "@@ -152,6 +152,15 @@ fn get_symbol_hash<'a, 'tcx>(scx: &SharedCrateContext<'a, 'tcx>,\n             assert!(!substs.has_erasable_regions());\n             assert!(!substs.needs_subst());\n             substs.visit_with(&mut hasher);\n+\n+            // If this is an instance of a generic function, we also hash in\n+            // the ID of the instantiating crate. This avoids symbol conflicts\n+            // in case the same instances is emitted in two crates of the same\n+            // project.\n+            if substs.types().next().is_some() {\n+                hasher.hash(scx.tcx().crate_name.as_str());\n+                hasher.hash(scx.sess().local_crate_disambiguator().as_str());\n+            }\n         }\n     });\n "}]}