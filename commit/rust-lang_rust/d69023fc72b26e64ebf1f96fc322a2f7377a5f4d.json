{"sha": "d69023fc72b26e64ebf1f96fc322a2f7377a5f4d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2OTAyM2ZjNzJiMjZlNjRlYmYxZjk2ZmMzMjJhMmY3Mzc3YTVmNGQ=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-01T23:49:20Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-04T20:49:34Z"}, "message": "Lower extern crates to imports\n\nThis is probably not completely correct, but it kind of works.", "tree": {"sha": "1e448053268f830a77076069bf26b39694d518d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e448053268f830a77076069bf26b39694d518d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d", "html_url": "https://github.com/rust-lang/rust/commit/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "397d84ee292295ce1d19033e586467ef9148e5bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/397d84ee292295ce1d19033e586467ef9148e5bc", "html_url": "https://github.com/rust-lang/rust/commit/397d84ee292295ce1d19033e586467ef9148e5bc"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "db898a782fbf4e06b491720c1cd4195248585eac", "filename": "crates/ra_hir/src/nameres/lower.rs", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d69023fc72b26e64ebf1f96fc322a2f7377a5f4d/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs?ref=d69023fc72b26e64ebf1f96fc322a2f7377a5f4d", "patch": "@@ -8,7 +8,7 @@ use ra_arena::{Arena, RawId, impl_arena_id, map::ArenaMap};\n use rustc_hash::FxHashMap;\n \n use crate::{\n-    SourceItemId, Path, ModuleSource, Name,\n+    SourceItemId, Path, PathKind, ModuleSource, Name,\n     HirFileId, MacroCallLoc, AsName, PerNs, Function,\n     ModuleDef, Module, Struct, Enum, Const, Static, Trait, Type,\n     ids::LocationCtx, PersistentHirDatabase,\n@@ -186,8 +186,21 @@ impl LoweredModule {\n             ast::ModuleItemKind::UseItem(it) => {\n                 self.add_use_item(source_map, it);\n             }\n-            ast::ModuleItemKind::ExternCrateItem(_) => {\n-                // TODO\n+            ast::ModuleItemKind::ExternCrateItem(it) => {\n+                // Lower `extern crate x` to `use ::x`. This is kind of cheating\n+                // and only works if we always interpret absolute paths in the\n+                // 2018 style; otherwise `::x` could also refer to a module in\n+                // the crate root.\n+                if let Some(name_ref) = it.name_ref() {\n+                    let mut path = Path::from_name_ref(name_ref);\n+                    path.kind = PathKind::Abs;\n+                    let alias = it.alias().and_then(|a| a.name()).map(AsName::as_name);\n+                    self.imports.alloc(ImportData {\n+                        path,\n+                        alias,\n+                        is_glob: false,\n+                    });\n+                }\n             }\n             ast::ModuleItemKind::ConstDef(it) => {\n                 if let Some(name) = it.name() {"}]}