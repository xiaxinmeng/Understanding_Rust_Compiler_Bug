{"sha": "081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4MTgzN2VmZjBjNmY4ZGRlOWM2ZDg3YjhiOWRkYWIxZDJlY2ZkNjA=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-04-04T09:38:49Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-04-04T13:15:02Z"}, "message": "fix Travis and adjust AppVeyor", "tree": {"sha": "bd132c61b18648163004848faf968aac5723b682", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd132c61b18648163004848faf968aac5723b682"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "html_url": "https://github.com/rust-lang/rust/commit/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31bc4355aaa27627d96696c03faa61ec35c5b7b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/31bc4355aaa27627d96696c03faa61ec35c5b7b4", "html_url": "https://github.com/rust-lang/rust/commit/31bc4355aaa27627d96696c03faa61ec35c5b7b4"}], "stats": {"total": 44, "additions": 28, "deletions": 16}, "files": [{"sha": "e99b0cc33c9b3b356016eb7ca4f9d19aa1511b5c", "filename": ".appveyor.yml", "status": "modified", "additions": 20, "deletions": 10, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60/.appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60/.appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.appveyor.yml?ref=081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "patch": "@@ -3,28 +3,31 @@ environment:\n         PROJECT_NAME: miri\n     matrix:\n         - TARGET: x86_64-pc-windows-msvc\n-          MSYS2_BITS: 64\n-        - TARGET: i686-pc-windows-msvc\n-          MSYS2_BITS: 32\n+        #- TARGET: i686-pc-windows-msvc\n \n # branches to build\n branches:\n   # whitelist\n   only:\n     - master\n \n+cache:\n+    - '%USERPROFILE%\\.cargo'\n+    - '%USERPROFILE%\\.rustup'\n+\n install:\n-    # Install Rust.\n-    - set PATH=C:\\Program Files\\Git\\mingw64\\bin;C:\\msys64\\mingw%MSYS2_BITS%\\bin;%PATH%\n-    - set /p RUST_TOOLCHAIN=<rust-version\n+    # Install Rust\n     - curl -sSf -o rustup-init.exe https://win.rustup.rs/\n-    - rustup-init.exe -y --default-host %TARGET% --default-toolchain %RUST_TOOLCHAIN%\n+    - rustup-init.exe -y --default-host %TARGET% --default-toolchain stable\n     - set PATH=%USERPROFILE%\\.cargo\\bin;%PATH%\n+    # Install \"master\" toolchain\n+    - cargo install rustup-toolchain-install-master\n+    - set /p RUSTC_HASH=<rust-version\n+    - rustup-toolchain-install-master -f -n master %RUSTC_HASH% -c cargo -c rust-src\n+    - rustup default master\n     - rustc --version\n \n-build: false\n-\n-test_script:\n+build_script:\n     - set RUST_TEST_NOCAPTURE=1\n     - set RUST_BACKTRACE=1\n     # Build and install miri\n@@ -33,12 +36,19 @@ test_script:\n     # Get ourselves a MIR-full libstd, and use it henceforth\n     - cargo miri setup\n     - set MIRI_SYSROOT=%USERPROFILE%\\AppData\\Local\\miri\\miri\\cache\\HOST\n+\n+test_script:\n     # Test miri\n     - cargo test --release --all-features\n     # Test cargo integration\n     - cd test-cargo-miri\n     - python3 run-test.py\n \n+after_test:\n+    # Don't cache \"master\" toolchain, it's a waste\n+    - rustup default stable\n+    - rustup toolchain uninstall master\n+\n notifications:\n     - provider: Email\n       on_build_success: false"}, {"sha": "883404fb4a0876f556ef78db96eeccfedbd07dc0", "filename": ".travis.yml", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=081837eff0c6f8dde9c6d87b8b9ddab1d2ecfd60", "patch": "@@ -4,8 +4,8 @@ cache:\n   # we cannot reuse anyway when the nightly changes (and it grows quite large\n   # over time).\n   directories:\n-    - /home/travis/.cargo\n-    - /home/travis/.rustup\n+    - $HOME/.cargo\n+    - $HOME/.rustup\n \n os:\n - linux\n@@ -22,19 +22,21 @@ before_script:\n   else\n     RUSTC_HASH=$(cat rust-version)\n   fi\n-# install Rust\n+# Install Rust (\"stable\" toolchain for better caching, it is just used to build rustup-toolchain-install-master)\n - curl https://build.travis-ci.org/files/rustup-init.sh -sSf | sh -s -- -y --default-toolchain stable\n - export PATH=$HOME/.cargo/bin:$PATH\n+# Install \"master\" toolchain\n - cargo install rustup-toolchain-install-master || echo \"rustup-toolchain-install-master already installed\"\n-- rustup-toolchain-install-master -f -n master $RUSTC_HASH\n+- travis_retry rustup-toolchain-install-master -f -n master $RUSTC_HASH -c cargo -c rust-src\n - rustup default master\n - rustc --version\n \n script:\n - ./travis.sh\n \n-after_script:\n-# Don't cache this, it's a waste\n+before_cache:\n+# Don't cache \"master\" toolchain, it's a waste\n+- rustup default stable\n - rustup toolchain uninstall master\n \n notifications:"}]}