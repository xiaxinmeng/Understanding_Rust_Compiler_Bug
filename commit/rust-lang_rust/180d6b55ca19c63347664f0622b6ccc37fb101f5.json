{"sha": "180d6b55ca19c63347664f0622b6ccc37fb101f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4MGQ2YjU1Y2ExOWM2MzM0NzY2NGYwNjIyYjZjY2MzN2ZiMTAxZjU=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-03-22T20:24:54Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-03-24T02:54:22Z"}, "message": "Tests", "tree": {"sha": "490d7a701861d996ae4a897e7b508a617375fa99", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/490d7a701861d996ae4a897e7b508a617375fa99"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/180d6b55ca19c63347664f0622b6ccc37fb101f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/180d6b55ca19c63347664f0622b6ccc37fb101f5", "html_url": "https://github.com/rust-lang/rust/commit/180d6b55ca19c63347664f0622b6ccc37fb101f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/180d6b55ca19c63347664f0622b6ccc37fb101f5/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2731dc169c3e35707049575829cb106e2bdc9801", "url": "https://api.github.com/repos/rust-lang/rust/commits/2731dc169c3e35707049575829cb106e2bdc9801", "html_url": "https://github.com/rust-lang/rust/commit/2731dc169c3e35707049575829cb106e2bdc9801"}], "stats": {"total": 105, "additions": 97, "deletions": 8}, "files": [{"sha": "29ef105eccb72293ad705190b60de593bb63f4d1", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -2841,7 +2841,12 @@ impl<'a> Parser<'a> {\n                 maybe_whole!(deref self, NtTT);\n                 match self.token {\n                     token::CloseDelim(_) => {\n-                        panic!(\"should have been caught above\");\n+                        // An unexpected closing delimiter (i.e., there is no\n+                        // matching opening delimiter).\n+                        let token_str = self.this_token_to_string();\n+                        let err = self.diagnostic().struct_span_err(self.span,\n+                            &format!(\"unexpected close delimiter: `{}`\", token_str));\n+                        Err(err)\n                     },\n                     /* we ought to allow different depths of unquotation */\n                     token::Dollar | token::SubstNt(..) if self.quote_depth > 0 => {"}, {"sha": "eaccaf3cdbd27c6e4f51ba747555bd06d5c6b375", "filename": "src/test/compile-fail/issue-10636-2.rs", "status": "renamed", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-10636-2.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2013-2016 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -11,11 +11,9 @@\n // FIXME(31528) we emit a bunch of silly errors here due to continuing past the\n // first one. This would be easy-ish to address by better recovery in tokenisation.\n \n-// compile-flags: -Z parse-only\n-\n-pub fn trace_option(option: Option<isize>) { //~ HELP did you mean to close this delimiter?\n+pub fn trace_option(option: Option<isize>) {\n     option.map(|some| 42; //~ NOTE: unclosed delimiter\n                           //~^ ERROR: expected one of\n+                          //~^^ ERROR: mismatched types\n } //~ ERROR: incorrect close delimiter\n //~^ ERROR: expected one of\n-//~ ERROR: this file contains an un-closed delimiter", "previous_filename": "src/test/parse-fail/issue-10636-2.rs"}, {"sha": "b6a04bee85d4faada3cd72a60121f4043e3b2474", "filename": "src/test/compile-fail/issue-31804.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Fissue-31804.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Fissue-31804.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-31804.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that error recovery in the parser to an EOF does not give an infinite\n+// spew of errors.\n+\n+fn main() {\n+    let\n+} //~ ERROR unexpected token: `}`"}, {"sha": "ab429ab878073c02585aa91f7e87b0f2d56db446", "filename": "src/test/compile-fail/token-error-correct-2.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-2.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we do some basic error correcton in the tokeniser (and don't ICE).\n+\n+fn main() {\n+    if foo { //~ NOTE: unclosed delimiter\n+    //~^ ERROR: unresolved name `foo`\n+    ) //~ ERROR: incorrect close delimiter: `)`\n+}"}, {"sha": "fe8c9f690139f65a3b72991504f571cc59bd3609", "filename": "src/test/compile-fail/token-error-correct-3.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct-3.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -0,0 +1,33 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we do some basic error correcton in the tokeniser (and don't spew\n+// too many bogus errors).\n+\n+pub mod raw {\n+    use std::{io, fs};\n+    use std::path::Path;\n+\n+    pub fn ensure_dir_exists<P: AsRef<Path>, F: FnOnce(&Path)>(path: P,\n+                                                               callback: F)\n+                                                               -> io::Result<bool> {\n+        if !is_directory(path.as_ref()) { //~ ERROR: unresolved name `is_directory`\n+            callback(path.as_ref();  //~ NOTE: unclosed delimiter\n+                     //~^ ERROR: expected one of\n+            fs::create_dir_all(path.as_ref()).map(|()| true) //~ ERROR: expected one of\n+        } else { //~ ERROR: incorrect close delimiter: `}`\n+            Ok(false);\n+        }\n+\n+        panic!();\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "6c54acd7bdbf60827ec5a665ac15d29b0a6ce12f", "filename": "src/test/compile-fail/token-error-correct.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftoken-error-correct.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that we do some basic error correcton in the tokeniser.\n+\n+fn main() {\n+    foo(bar(; //~ NOTE: unclosed delimiter\n+    //~^ NOTE: unclosed delimiter\n+    //~^^ ERROR: unexpected token: `;`\n+    //~^^^ ERROR: unresolved name `bar`\n+    //~^^^^ ERROR: unresolved name `foo`\n+} //~ ERROR: incorrect close delimiter: `}`\n+//~^ ERROR: incorrect close delimiter: `}`"}, {"sha": "f24c544073578ff07def143413cec0e14cfaf49b", "filename": "src/test/parse-fail/issue-2354-1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fparse-fail%2Fissue-2354-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fparse-fail%2Fissue-2354-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Fissue-2354-1.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -10,4 +10,4 @@\n \n // compile-flags: -Z parse-only\n \n-static foo: isize = 2; } //~ ERROR incorrect close delimiter:\n+static foo: isize = 2; } //~ ERROR unexpected close delimiter:"}, {"sha": "cbc0ed0ccdb84760bb98e6f69f68d5e15c574806", "filename": "src/test/parse-fail/macro-mismatched-delim-paren-brace.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fparse-fail%2Fmacro-mismatched-delim-paren-brace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/180d6b55ca19c63347664f0622b6ccc37fb101f5/src%2Ftest%2Fparse-fail%2Fmacro-mismatched-delim-paren-brace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fparse-fail%2Fmacro-mismatched-delim-paren-brace.rs?ref=180d6b55ca19c63347664f0622b6ccc37fb101f5", "patch": "@@ -14,4 +14,4 @@ fn main() {\n     foo! (\n         bar, \"baz\", 1, 2.0\n     } //~ ERROR incorrect close delimiter\n-}\n+} //~ ERROR unexpected close delimiter: `}`"}]}