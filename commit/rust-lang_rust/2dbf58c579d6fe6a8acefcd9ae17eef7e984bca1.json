{"sha": "2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkYmY1OGM1NzlkNmZlNmE4YWNlZmNkOWFlMTdlZWY3ZTk4NGJjYTE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-23T13:05:13Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-23T13:05:13Z"}, "message": "move completion item tests closer to the code\n\nthis is the reason why we need marks: the tests were spread across two\nfiles, because I've forgotten that there were tests already", "tree": {"sha": "eae324e5b6277358bf6d4c162cd387ac4a2a717f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eae324e5b6277358bf6d4c162cd387ac4a2a717f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "html_url": "https://github.com/rust-lang/rust/commit/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "86507c0626eb07485b21c61638673acbb3c2a9ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/86507c0626eb07485b21c61638673acbb3c2a9ad", "html_url": "https://github.com/rust-lang/rust/commit/86507c0626eb07485b21c61638673acbb3c2a9ad"}], "stats": {"total": 119, "additions": 72, "deletions": 47}, "files": [{"sha": "a861ee88e6d272ee2babf7b1656dcc0915eeba27", "filename": "crates/ra_hir/src/lib.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Flib.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -8,8 +8,6 @@\n pub mod db;\n #[cfg(test)]\n mod mock;\n-#[cfg(test)]\n-mod marks;\n mod query_definitions;\n mod path;\n pub mod source_binder;\n@@ -29,6 +27,9 @@ mod generics;\n mod code_model_api;\n mod code_model_impl;\n \n+#[cfg(test)]\n+mod marks;\n+\n use crate::{\n     db::HirDatabase,\n     name::{AsName, KnownName},"}, {"sha": "f4d0c3e59667c3d6a0df2be6d93c6af4601bfab3", "filename": "crates/ra_hir/src/marks.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_hir%2Fsrc%2Fmarks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_hir%2Fsrc%2Fmarks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fmarks.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -1 +1,3 @@\n-test_utils::mark!(name_res_works_for_broken_modules);\n+use test_utils::mark;\n+\n+mark!(name_res_works_for_broken_modules);"}, {"sha": "6bed299d2f4012ab26b010e5610e4b5eff8934ac", "filename": "crates/ra_ide_api/src/completion/complete_path.rs", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_path.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -121,30 +121,4 @@ mod tests {\n             \",\n         );\n     }\n-\n-    #[test]\n-    fn dont_render_function_parens_in_use_item() {\n-        check_reference_completion(\n-            \"dont_render_function_parens_in_use_item\",\n-            \"\n-            //- /lib.rs\n-            mod m { pub fn foo() {} }\n-            use crate::m::f<|>;\n-            \",\n-        )\n-    }\n-\n-    #[test]\n-    fn dont_render_function_parens_if_already_call() {\n-        check_reference_completion(\n-            \"dont_render_function_parens_if_already_call\",\n-            \"\n-            //- /lib.rs\n-            fn frobnicate() {}\n-            fn main() {\n-                frob<|>();\n-            }\n-            \",\n-        )\n-    }\n }"}, {"sha": "f837bb1db2bcaff0f0ce60c356c482419cc5650c", "filename": "crates/ra_ide_api/src/completion/complete_scope.rs", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -175,21 +175,4 @@ mod tests {\n         check_reference_completion(\"self_in_methods\", r\"impl S { fn foo(&self) { <|> } }\")\n     }\n \n-    #[test]\n-    fn inserts_parens_for_function_calls() {\n-        check_reference_completion(\n-            \"inserts_parens_for_function_calls1\",\n-            r\"\n-            fn no_args() {}\n-            fn main() { no_<|> }\n-            \",\n-        );\n-        check_reference_completion(\n-            \"inserts_parens_for_function_calls2\",\n-            r\"\n-            fn with_args(x: i32, y: String) {}\n-            fn main() { with_<|> }\n-            \",\n-        );\n-    }\n }"}, {"sha": "48be812a08552c6d3549ba0c37bd7a28aa659f9f", "filename": "crates/ra_ide_api/src/completion/completion_item.rs", "status": "modified", "additions": 60, "deletions": 1, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -3,9 +3,10 @@ use hir::PerNs;\n use crate::completion::completion_context::CompletionContext;\n use ra_syntax::{\n     ast::{self, AstNode},\n-    TextRange\n+    TextRange,\n };\n use ra_text_edit::TextEdit;\n+use test_utils::tested_by;\n \n /// `CompletionItem` describes a single completion variant in the editor pop-up.\n /// It is basically a POD with various properties. To construct a\n@@ -255,6 +256,7 @@ impl Builder {\n     ) -> Builder {\n         // If not an import, add parenthesis automatically.\n         if ctx.use_item_syntax.is_none() && !ctx.is_call {\n+            tested_by!(inserts_parens_for_function_calls);\n             if function.signature(ctx.db).params().is_empty() {\n                 self.insert_text = Some(format!(\"{}()$0\", self.label));\n             } else {\n@@ -344,3 +346,60 @@ pub(crate) fn check_completion(test_name: &str, code: &str, kind: CompletionKind\n         .collect();\n     assert_debug_snapshot_matches!(test_name, kind_completions);\n }\n+\n+#[cfg(test)]\n+mod tests {\n+    use test_utils::covers;\n+\n+    use super::*;\n+\n+    fn check_reference_completion(code: &str, expected_completions: &str) {\n+        check_completion(code, expected_completions, CompletionKind::Reference);\n+    }\n+\n+    #[test]\n+    fn inserts_parens_for_function_calls() {\n+        covers!(inserts_parens_for_function_calls);\n+        check_reference_completion(\n+            \"inserts_parens_for_function_calls1\",\n+            r\"\n+            fn no_args() {}\n+            fn main() { no_<|> }\n+            \",\n+        );\n+        check_reference_completion(\n+            \"inserts_parens_for_function_calls2\",\n+            r\"\n+            fn with_args(x: i32, y: String) {}\n+            fn main() { with_<|> }\n+            \",\n+        );\n+    }\n+\n+    #[test]\n+    fn dont_render_function_parens_in_use_item() {\n+        check_reference_completion(\n+            \"dont_render_function_parens_in_use_item\",\n+            \"\n+            //- /lib.rs\n+            mod m { pub fn foo() {} }\n+            use crate::m::f<|>;\n+            \",\n+        )\n+    }\n+\n+    #[test]\n+    fn dont_render_function_parens_if_already_call() {\n+        check_reference_completion(\n+            \"dont_render_function_parens_if_already_call\",\n+            \"\n+            //- /lib.rs\n+            fn frobnicate() {}\n+            fn main() {\n+                frob<|>();\n+            }\n+            \",\n+        )\n+    }\n+\n+}"}, {"sha": "3502bfd2e56407d0fd30299a8132091154110355", "filename": "crates/ra_ide_api/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Flib.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -26,6 +26,9 @@ mod syntax_highlighting;\n mod parent_module;\n mod rename;\n \n+#[cfg(test)]\n+mod marks;\n+\n use std::{fmt, sync::Arc};\n \n use ra_syntax::{SourceFile, TreeArc, TextRange, TextUnit};"}, {"sha": "b4a726ef002ba7c5fec57a0d3dab682be06172d1", "filename": "crates/ra_ide_api/src/marks.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fmarks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1/crates%2Fra_ide_api%2Fsrc%2Fmarks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fmarks.rs?ref=2dbf58c579d6fe6a8acefcd9ae17eef7e984bca1", "patch": "@@ -0,0 +1,3 @@\n+use test_utils::mark;\n+\n+mark!(inserts_parens_for_function_calls);"}]}