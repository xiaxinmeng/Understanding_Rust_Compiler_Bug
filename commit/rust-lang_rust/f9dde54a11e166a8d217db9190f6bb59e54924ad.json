{"sha": "f9dde54a11e166a8d217db9190f6bb59e54924ad", "node_id": "C_kwDOAAsO6NoAKGY5ZGRlNTRhMTFlMTY2YThkMjE3ZGI5MTkwZjZiYjU5ZTU0OTI0YWQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-13T18:16:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-13T18:16:42Z"}, "message": "Rollup merge of #106489 - jschwe:fix_linker_detection, r=petrochenkov\n\nFix linker detection for linker (drivers) with a version postfix (e.g. clang-12 instead of clang)\n\nLinker (drivers) such as clang / gcc or lld often have a version postfix matching the regex \"-\\d+$\".\nPreviously, linker detection did not account for the possible version postfix and the fallback value was used, which can cause linker errors due to wrong arguments.\nAlso remove the check for `-clang`, since there are no architecture specific variants of clang (to my knowledge).\n\nFixes #106454", "tree": {"sha": "749284a011a3fcc50b0b8a90f3ccca56feccba49", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/749284a011a3fcc50b0b8a90f3ccca56feccba49"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f9dde54a11e166a8d217db9190f6bb59e54924ad", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjwaAKCRBK7hj4Ov3rIwAAkZIIAGVas8UzyAmyJIEG56DpnluT\nrNu4aCLMjMhRGbizgrZw1XwJ3Zb57kVkXb3d92O+eEwC4JAV1cC9JXbrUIkLqTLz\n4FFcU84Zh7bR8q4kZtWwX1G1Ujf06IRFB7SZLdgWRCTeZoq9sBm4p0IZ9+p1i62l\n29W8WwaxkF6aQmC5MHWYy9ahHTQLx1jjKllilJinNvSezEtGb4QfK8S3om/KXZs0\n7iwSzG/OtssZo9PHs4qc7SSF+2S8nHGl/mgjhaQN2gaxfEQZEcbWx06tTyJli8M0\nYWZzLCZqfptNnzhDxSyUopXFDvZx4+EB9qCUV0okBFZveJrJdgC3T+WJ90JUuT0=\n=/ssg\n-----END PGP SIGNATURE-----\n", "payload": "tree 749284a011a3fcc50b0b8a90f3ccca56feccba49\nparent 1dc43b2e8b5faba0a5a5c7eb899e6f63e654e46c\nparent 3bc2970a2e5f80f04ac2c1b1c1e4ec06a001f151\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1673633802 +0100\ncommitter GitHub <noreply@github.com> 1673633802 +0100\n\nRollup merge of #106489 - jschwe:fix_linker_detection, r=petrochenkov\n\nFix linker detection for linker (drivers) with a version postfix (e.g. clang-12 instead of clang)\n\nLinker (drivers) such as clang / gcc or lld often have a version postfix matching the regex \"-\\d+$\".\nPreviously, linker detection did not account for the possible version postfix and the fallback value was used, which can cause linker errors due to wrong arguments.\nAlso remove the check for `-clang`, since there are no architecture specific variants of clang (to my knowledge).\n\nFixes #106454\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f9dde54a11e166a8d217db9190f6bb59e54924ad", "html_url": "https://github.com/rust-lang/rust/commit/f9dde54a11e166a8d217db9190f6bb59e54924ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f9dde54a11e166a8d217db9190f6bb59e54924ad/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1dc43b2e8b5faba0a5a5c7eb899e6f63e654e46c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1dc43b2e8b5faba0a5a5c7eb899e6f63e654e46c", "html_url": "https://github.com/rust-lang/rust/commit/1dc43b2e8b5faba0a5a5c7eb899e6f63e654e46c"}, {"sha": "3bc2970a2e5f80f04ac2c1b1c1e4ec06a001f151", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bc2970a2e5f80f04ac2c1b1c1e4ec06a001f151", "html_url": "https://github.com/rust-lang/rust/commit/3bc2970a2e5f80f04ac2c1b1c1e4ec06a001f151"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "342abf81f6a7c0d6b465ce23375dcecd80868297", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f9dde54a11e166a8d217db9190f6bb59e54924ad/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f9dde54a11e166a8d217db9190f6bb59e54924ad/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=f9dde54a11e166a8d217db9190f6bb59e54924ad", "patch": "@@ -1231,12 +1231,21 @@ pub fn linker_and_flavor(sess: &Session) -> (PathBuf, LinkerFlavor) {\n                     sess.emit_fatal(errors::LinkerFileStem);\n                 });\n \n+                // Remove any version postfix.\n+                let stem = stem\n+                    .rsplit_once('-')\n+                    .and_then(|(lhs, rhs)| rhs.chars().all(char::is_numeric).then_some(lhs))\n+                    .unwrap_or(stem);\n+\n+                // GCC can have an optional target prefix.\n                 let flavor = if stem == \"emcc\" {\n                     LinkerFlavor::EmCc\n                 } else if stem == \"gcc\"\n                     || stem.ends_with(\"-gcc\")\n+                    || stem == \"g++\"\n+                    || stem.ends_with(\"-g++\")\n                     || stem == \"clang\"\n-                    || stem.ends_with(\"-clang\")\n+                    || stem == \"clang++\"\n                 {\n                     LinkerFlavor::from_cli(LinkerFlavorCli::Gcc, &sess.target)\n                 } else if stem == \"wasm-ld\" || stem.ends_with(\"-wasm-ld\") {"}]}