{"sha": "1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "node_id": "C_kwDOAAsO6NoAKDFlMzQ5ZmIwZGQxZmRkODFlMDViYmNiOGU3ZDYzNjRkMmM0YzFmNTM", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2022-10-26T21:18:46Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2022-10-29T21:04:10Z"}, "message": "Use an array in LanguageItems", "tree": {"sha": "7dd954d6c7460518cf6efde91dfac75eb243168e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7dd954d6c7460518cf6efde91dfac75eb243168e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "html_url": "https://github.com/rust-lang/rust/commit/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f808430497525663dd3f62c294a3ae1762abdc22", "url": "https://api.github.com/repos/rust-lang/rust/commits/f808430497525663dd3f62c294a3ae1762abdc22", "html_url": "https://github.com/rust-lang/rust/commit/f808430497525663dd3f62c294a3ae1762abdc22"}], "stats": {"total": 26, "additions": 13, "deletions": 13}, "files": [{"sha": "672d3fdf28ddec39ba73118f00f24448f578766e", "filename": "compiler/rustc_hir/src/lang_items.rs", "status": "modified", "additions": 12, "deletions": 13, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs?ref=1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "patch": "@@ -39,7 +39,7 @@ macro_rules! expand_group {\n pub struct LanguageItems {\n     /// Mappings from lang items to their possibly found [`DefId`]s.\n     /// The index corresponds to the order in [`LangItem`].\n-    items: Vec<Option<DefId>>,\n+    items: [Option<DefId>; std::mem::variant_count::<LangItem>()],\n     /// Lang items that were not found during collection.\n     pub missing: Vec<LangItem>,\n     /// Mapping from [`LangItemGroup`] discriminants to all\n@@ -48,6 +48,17 @@ pub struct LanguageItems {\n }\n \n impl LanguageItems {\n+    /// Construct an empty collection of lang items and no missing ones.\n+    pub fn new() -> Self {\n+        const EMPTY: Vec<DefId> = Vec::new();\n+\n+        Self {\n+            items: [None; std::mem::variant_count::<LangItem>()],\n+            missing: Vec::new(),\n+            groups: [EMPTY; NUM_GROUPS],\n+        }\n+    }\n+\n     pub fn get(&self, item: LangItem) -> Option<DefId> {\n         self.items[item as usize]\n     }\n@@ -132,18 +143,6 @@ macro_rules! language_item_table {\n         }\n \n         impl LanguageItems {\n-            /// Construct an empty collection of lang items and no missing ones.\n-            pub fn new() -> Self {\n-                fn init_none(_: LangItem) -> Option<DefId> { None }\n-                const EMPTY: Vec<DefId> = Vec::new();\n-\n-                Self {\n-                    items: vec![$(init_none(LangItem::$variant)),*],\n-                    missing: Vec::new(),\n-                    groups: [EMPTY; NUM_GROUPS],\n-                }\n-            }\n-\n             /// Returns the [`DefId`]s of all lang items in a group.\n             pub fn group(&self, group: LangItemGroup) -> &[DefId] {\n                 self.groups[group as usize].as_ref()"}, {"sha": "d54d8e84aaf8c349193c65e0fa4a37ee4ef01b1c", "filename": "compiler/rustc_hir/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53/compiler%2Frustc_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53/compiler%2Frustc_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Flib.rs?ref=1e349fb0dd1fdd81e05bbcb8e7d6364d2c4c1f53", "patch": "@@ -9,6 +9,7 @@\n #![feature(min_specialization)]\n #![feature(never_type)]\n #![feature(rustc_attrs)]\n+#![feature(variant_count)]\n #![recursion_limit = \"256\"]\n #![deny(rustc::untranslatable_diagnostic)]\n #![deny(rustc::diagnostic_outside_of_impl)]"}]}