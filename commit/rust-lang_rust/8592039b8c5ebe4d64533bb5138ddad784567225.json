{"sha": "8592039b8c5ebe4d64533bb5138ddad784567225", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1OTIwMzliOGM1ZWJlNGQ2NDUzM2JiNTEzOGRkYWQ3ODQ1NjcyMjU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-08-01T00:31:50Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-08-01T01:28:40Z"}, "message": "Remove dead code", "tree": {"sha": "d36cb870a553f8e42bb901fedcb90661af0f470e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d36cb870a553f8e42bb901fedcb90661af0f470e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8592039b8c5ebe4d64533bb5138ddad784567225", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8592039b8c5ebe4d64533bb5138ddad784567225", "html_url": "https://github.com/rust-lang/rust/commit/8592039b8c5ebe4d64533bb5138ddad784567225", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8592039b8c5ebe4d64533bb5138ddad784567225/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f390917bc2bd77ea41f2eb152a24fce3d6a77046", "url": "https://api.github.com/repos/rust-lang/rust/commits/f390917bc2bd77ea41f2eb152a24fce3d6a77046", "html_url": "https://github.com/rust-lang/rust/commit/f390917bc2bd77ea41f2eb152a24fce3d6a77046"}], "stats": {"total": 83, "additions": 16, "deletions": 67}, "files": [{"sha": "709590f649b92cab52d4e65f73867d7b98b69638", "filename": "src/librustc_borrowck/borrowck/check_loans.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fcheck_loans.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -91,7 +91,6 @@ struct CheckLoanCtxt<'a, 'tcx: 'a> {\n     dfcx_loans: &'a LoanDataFlow<'a, 'tcx>,\n     move_data: &'a move_data::FlowedMoveData<'a, 'tcx>,\n     all_loans: &'a [Loan<'tcx>],\n-    param_env: ty::ParamEnv<'tcx>,\n     movable_generator: bool,\n }\n \n@@ -215,7 +214,6 @@ pub fn check_loans<'a, 'b, 'c, 'tcx>(bccx: &BorrowckCtxt<'a, 'tcx>,\n         dfcx_loans,\n         move_data,\n         all_loans,\n-        param_env,\n         movable_generator,\n     };\n     let rvalue_promotable_map = bccx.tcx.rvalue_promotable_map(def_id);\n@@ -801,8 +799,7 @@ impl<'a, 'tcx> CheckLoanCtxt<'a, 'tcx> {\n                 use_kind,\n                 &lp,\n                 the_move,\n-                moved_lp,\n-                self.param_env);\n+                moved_lp);\n             false\n         });\n     }"}, {"sha": "b76931c301748c44cc995473755bb1547833c017", "filename": "src/librustc_borrowck/borrowck/gather_loans/gather_moves.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fgather_moves.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fgather_moves.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fgather_moves.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -163,15 +163,11 @@ pub fn gather_assignment<'a, 'tcx>(bccx: &BorrowckCtxt<'a, 'tcx>,\n                                    move_data: &MoveData<'tcx>,\n                                    assignment_id: hir::ItemLocalId,\n                                    assignment_span: Span,\n-                                   assignee_loan_path: Rc<LoanPath<'tcx>>,\n-                                   assignee_id: hir::ItemLocalId,\n-                                   mode: euv::MutateMode) {\n+                                   assignee_loan_path: Rc<LoanPath<'tcx>>) {\n     move_data.add_assignment(bccx.tcx,\n                              assignee_loan_path,\n                              assignment_id,\n-                             assignment_span,\n-                             assignee_id,\n-                             mode);\n+                             assignment_span);\n }\n \n // (keep in sync with move_error::report_cannot_move_out_of )"}, {"sha": "c9dcc0d9fa266beb190653e31c7526d7309f267a", "filename": "src/librustc_borrowck/borrowck/gather_loans/lifetime.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Flifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Flifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Flifetime.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -28,8 +28,7 @@ pub fn guarantee_lifetime<'a, 'tcx>(bccx: &BorrowckCtxt<'a, 'tcx>,\n                                     span: Span,\n                                     cause: euv::LoanCause,\n                                     cmt: &'a mc::cmt_<'tcx>,\n-                                    loan_region: ty::Region<'tcx>,\n-                                    _: ty::BorrowKind)\n+                                    loan_region: ty::Region<'tcx>)\n                                     -> Result<(),()> {\n     //! Reports error if `loan_region` is larger than S\n     //! where S is `item_scope` if `cmt` is an upvar,"}, {"sha": "6c83e2dd1c206608915927e42e141bd1dcd743c8", "filename": "src/librustc_borrowck/borrowck/gather_loans/mod.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fgather_loans%2Fmod.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -145,12 +145,11 @@ impl<'a, 'tcx> euv::Delegate<'tcx> for GatherLoanCtxt<'a, 'tcx> {\n               assignment_id: ast::NodeId,\n               assignment_span: Span,\n               assignee_cmt: &mc::cmt_<'tcx>,\n-              mode: euv::MutateMode)\n+              _: euv::MutateMode)\n     {\n         self.guarantee_assignment_valid(assignment_id,\n                                         assignment_span,\n-                                        assignee_cmt,\n-                                        mode);\n+                                        assignee_cmt);\n     }\n \n     fn decl_without_init(&mut self, id: ast::NodeId, _span: Span) {\n@@ -246,8 +245,7 @@ impl<'a, 'tcx> GatherLoanCtxt<'a, 'tcx> {\n     fn guarantee_assignment_valid(&mut self,\n                                   assignment_id: ast::NodeId,\n                                   assignment_span: Span,\n-                                  cmt: &mc::cmt_<'tcx>,\n-                                  mode: euv::MutateMode) {\n+                                  cmt: &mc::cmt_<'tcx>) {\n \n         let opt_lp = opt_loan_path(cmt);\n         debug!(\"guarantee_assignment_valid(assignment_id={}, cmt={:?}) opt_lp={:?}\",\n@@ -282,9 +280,7 @@ impl<'a, 'tcx> GatherLoanCtxt<'a, 'tcx> {\n                                                 self.bccx.tcx.hir.node_to_hir_id(assignment_id)\n                                                     .local_id,\n                                                 assignment_span,\n-                                                lp,\n-                                                cmt.hir_id.local_id,\n-                                                mode);\n+                                                lp);\n             }\n             None => {\n                 // This can occur with e.g. `*foo() = 5`.  In such\n@@ -320,7 +316,7 @@ impl<'a, 'tcx> GatherLoanCtxt<'a, 'tcx> {\n         // Check that the lifetime of the borrow does not exceed\n         // the lifetime of the data being borrowed.\n         if lifetime::guarantee_lifetime(self.bccx, self.item_ub,\n-                                        borrow_span, cause, cmt, loan_region, req_kind).is_err() {\n+                                        borrow_span, cause, cmt, loan_region).is_err() {\n             return; // reported an error, no sense in reporting more.\n         }\n "}, {"sha": "e892fd0fc48b407d3a5aa1e8aee9e073a717cc46", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 1, "deletions": 19, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -638,8 +638,7 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                                      use_kind: MovedValueUseKind,\n                                      lp: &LoanPath<'tcx>,\n                                      the_move: &move_data::Move,\n-                                     moved_lp: &LoanPath<'tcx>,\n-                                     _param_env: ty::ParamEnv<'tcx>) {\n+                                     moved_lp: &LoanPath<'tcx>) {\n         let (verb, verb_participle) = match use_kind {\n             MovedInUse => (\"use\", \"used\"),\n             MovedInCapture => (\"capture\", \"captured\"),\n@@ -804,23 +803,6 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n         self.signal_error();\n     }\n \n-    pub fn struct_span_err_with_code<S: Into<MultiSpan>>(&self,\n-                                                         s: S,\n-                                                         msg: &str,\n-                                                         code: DiagnosticId)\n-                                                         -> DiagnosticBuilder<'a> {\n-        self.tcx.sess.struct_span_err_with_code(s, msg, code)\n-    }\n-\n-    pub fn span_err_with_code<S: Into<MultiSpan>>(\n-        &self,\n-        s: S,\n-        msg: &str,\n-        code: DiagnosticId,\n-    ) {\n-        self.tcx.sess.span_err_with_code(s, msg, code);\n-    }\n-\n     fn report_bckerr(&self, err: &BckError<'a, 'tcx>) {\n         let error_span = err.span.clone();\n "}, {"sha": "979d71a0923c40ea4f468f04e80b07716bf13cb4", "filename": "src/librustc_borrowck/borrowck/move_data.rs", "status": "modified", "additions": 6, "deletions": 27, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fmove_data.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8592039b8c5ebe4d64533bb5138ddad784567225/src%2Flibrustc_borrowck%2Fborrowck%2Fmove_data.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmove_data.rs?ref=8592039b8c5ebe4d64533bb5138ddad784567225", "patch": "@@ -17,10 +17,8 @@ use dataflow::{DataFlowContext, BitwiseOperator, DataFlowOperator, KillFrom};\n \n use borrowck::*;\n use rustc::cfg;\n-use rustc::middle::expr_use_visitor as euv;\n-use rustc::middle::expr_use_visitor::MutateMode;\n use rustc::ty::{self, TyCtxt};\n-use rustc::util::nodemap::{FxHashMap, FxHashSet};\n+use rustc::util::nodemap::FxHashMap;\n \n use std::cell::RefCell;\n use std::rc::Rc;\n@@ -49,9 +47,6 @@ pub struct MoveData<'tcx> {\n     /// assigned dataflow bits, but we track them because they still\n     /// kill move bits.\n     pub path_assignments: RefCell<Vec<Assignment>>,\n-\n-    /// Assignments to a variable or path, like `x = foo`, but not `x += foo`.\n-    pub assignee_ids: RefCell<FxHashSet<hir::ItemLocalId>>,\n }\n \n pub struct FlowedMoveData<'a, 'tcx: 'a> {\n@@ -149,9 +144,6 @@ pub struct Assignment {\n \n     /// span of node where assignment occurs\n     pub span: Span,\n-\n-    /// id for place expression on lhs of assignment\n-    pub assignee_id: hir::ItemLocalId,\n }\n \n #[derive(Clone, Copy)]\n@@ -386,9 +378,7 @@ impl<'a, 'tcx> MoveData<'tcx> {\n     pub fn add_assignment(&self, tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                           lp: Rc<LoanPath<'tcx>>,\n                           assign_id: hir::ItemLocalId,\n-                          span: Span,\n-                          assignee_id: hir::ItemLocalId,\n-                          mode: euv::MutateMode) {\n+                          span: Span) {\n         // Assigning to one union field automatically assigns to all its fields.\n         if let LpExtend(ref base_lp, mutbl, LpInterior(opt_variant_id, interior)) = lp.kind {\n             if let ty::TyAdt(adt_def, _) = base_lp.ty.sty {\n@@ -405,39 +395,28 @@ impl<'a, 'tcx> MoveData<'tcx> {\n                                                     LpInterior(opt_variant_id, field));\n                         let sibling_lp = Rc::new(LoanPath::new(sibling_lp_kind, field_ty));\n                         self.add_assignment_helper(tcx, sibling_lp, assign_id,\n-                                                   span, assignee_id, mode);\n+                                                   span);\n                     }\n                     return;\n                 }\n             }\n         }\n \n-        self.add_assignment_helper(tcx, lp.clone(), assign_id, span, assignee_id, mode);\n+        self.add_assignment_helper(tcx, lp.clone(), assign_id, span);\n     }\n \n     fn add_assignment_helper(&self, tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                              lp: Rc<LoanPath<'tcx>>,\n                              assign_id: hir::ItemLocalId,\n-                             span: Span,\n-                             assignee_id: hir::ItemLocalId,\n-                             mode: euv::MutateMode) {\n-        debug!(\"add_assignment(lp={:?}, assign_id={:?}, assignee_id={:?}\",\n-               lp, assign_id, assignee_id);\n+                             span: Span) {\n+        debug!(\"add_assignment(lp={:?}, assign_id={:?}\", lp, assign_id);\n \n         let path_index = self.move_path(tcx, lp.clone());\n \n-        match mode {\n-            MutateMode::Init | MutateMode::JustWrite => {\n-                self.assignee_ids.borrow_mut().insert(assignee_id);\n-            }\n-            MutateMode::WriteAndRead => { }\n-        }\n-\n         let assignment = Assignment {\n             path: path_index,\n             id: assign_id,\n             span,\n-            assignee_id,\n         };\n \n         if self.is_var_path(path_index) {"}]}