{"sha": "44a500c8c187b245638684748f54bd6ec67e0b25", "node_id": "C_kwDOAAsO6NoAKDQ0YTUwMGM4YzE4N2IyNDU2Mzg2ODQ3NDhmNTRiZDZlYzY3ZTBiMjU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-14T08:33:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-14T08:33:09Z"}, "message": "Auto merge of #106646 - Amanieu:ilp32-object, r=Mark-Simulacrum\n\nFix aarch64-unknown-linux-gnu_ilp32 target\n\nThis was broken because the synthetic object files produced by rustc were for 64-bit AArch64, which caused link failures when combined with 32-bit ILP32 object files.\n\nThis PR updates the object crate to 0.30.1 which adds support for generating ILP32 AArch64 object files.", "tree": {"sha": "954e5f422b004fc80161df52d7c6731f27b89fcd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/954e5f422b004fc80161df52d7c6731f27b89fcd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44a500c8c187b245638684748f54bd6ec67e0b25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44a500c8c187b245638684748f54bd6ec67e0b25", "html_url": "https://github.com/rust-lang/rust/commit/44a500c8c187b245638684748f54bd6ec67e0b25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44a500c8c187b245638684748f54bd6ec67e0b25/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0b87359599629d69a7b37318088dac3a5d67c9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0b87359599629d69a7b37318088dac3a5d67c9c", "html_url": "https://github.com/rust-lang/rust/commit/c0b87359599629d69a7b37318088dac3a5d67c9c"}, {"sha": "a529ba8f67861c21a6f4d1c497aa1f602b335ecb", "url": "https://api.github.com/repos/rust-lang/rust/commits/a529ba8f67861c21a6f4d1c497aa1f602b335ecb", "html_url": "https://github.com/rust-lang/rust/commit/a529ba8f67861c21a6f4d1c497aa1f602b335ecb"}], "stats": {"total": 88, "additions": 63, "deletions": 25}, "files": [{"sha": "ee91b00377182fce4c8dedbf1e516d338fe29b6f", "filename": "Cargo.lock", "status": "modified", "additions": 50, "deletions": 21, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/44a500c8c187b245638684748f54bd6ec67e0b25/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/44a500c8c187b245638684748f54bd6ec67e0b25/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=44a500c8c187b245638684748f54bd6ec67e0b25", "patch": "@@ -35,6 +35,17 @@ dependencies = [\n  \"version_check\",\n ]\n \n+[[package]]\n+name = \"ahash\"\n+version = \"0.8.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"bf6ccdb167abbf410dcb915cabd428929d7f6a04980b54a11f26a39f1c7f7107\"\n+dependencies = [\n+ \"cfg-if\",\n+ \"once_cell\",\n+ \"version_check\",\n+]\n+\n [[package]]\n name = \"aho-corasick\"\n version = \"0.7.18\"\n@@ -107,7 +118,7 @@ version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"276881980556fdadeb88aa1ffc667e4d2e8fe72531dfabcb7a82bb3c9ea9ba31\"\n dependencies = [\n- \"object\",\n+ \"object 0.29.0\",\n ]\n \n [[package]]\n@@ -193,7 +204,7 @@ dependencies = [\n  \"cfg-if\",\n  \"libc\",\n  \"miniz_oxide\",\n- \"object\",\n+ \"object 0.29.0\",\n  \"rustc-demangle\",\n ]\n \n@@ -1774,9 +1785,9 @@ dependencies = [\n \n [[package]]\n name = \"gimli\"\n-version = \"0.26.1\"\n+version = \"0.26.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"78cc372d058dcf6d5ecd98510e7fbc9e5aec4d21de70f65fea8fecebcd881bd4\"\n+checksum = \"22030e2c5a68ec659fde1e949a745124b48e6fa8b045b7ed5bd1fe4ccc5c4e5d\"\n dependencies = [\n  \"compiler_builtins\",\n  \"fallible-iterator\",\n@@ -1887,12 +1898,21 @@ version = \"0.12.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"8a9ee70c43aaf417c914396645a0fa852624801b24ebb7ae78fe8272889ac888\"\n dependencies = [\n- \"ahash\",\n+ \"ahash 0.7.4\",\n  \"compiler_builtins\",\n  \"rustc-std-workspace-alloc\",\n  \"rustc-std-workspace-core\",\n ]\n \n+[[package]]\n+name = \"hashbrown\"\n+version = \"0.13.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"33ff8ae62cd3a9102e5637afc8452c55acf3844001bd5374e0b0bd7b6616c038\"\n+dependencies = [\n+ \"ahash 0.8.2\",\n+]\n+\n [[package]]\n name = \"heck\"\n version = \"0.4.0\"\n@@ -2129,12 +2149,12 @@ checksum = \"ce23b50ad8242c51a442f3ff322d56b02f08852c77e4c0b4d3fd684abc89c683\"\n \n [[package]]\n name = \"indexmap\"\n-version = \"1.9.1\"\n+version = \"1.9.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"10a35a97730320ffe8e2d410b5d3b69279b98d2c14bdb8b70ea89ecf7888d41e\"\n+checksum = \"1885e79c1fc4b10f0e172c475f458b7f7b93061064d98c3293e98c5ba0c8b399\"\n dependencies = [\n  \"autocfg\",\n- \"hashbrown\",\n+ \"hashbrown 0.12.3\",\n  \"rustc-rayon\",\n  \"serde\",\n ]\n@@ -2740,13 +2760,22 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"21158b2c33aa6d4561f1c0a6ea283ca92bc54802a93b263e910746d679a7eb53\"\n dependencies = [\n  \"compiler_builtins\",\n+ \"memchr\",\n+ \"rustc-std-workspace-alloc\",\n+ \"rustc-std-workspace-core\",\n+]\n+\n+[[package]]\n+name = \"object\"\n+version = \"0.30.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"8d864c91689fdc196779b98dba0aceac6118594c2df6ee5d943eb6a8df4d107a\"\n+dependencies = [\n  \"crc32fast\",\n  \"flate2\",\n- \"hashbrown\",\n+ \"hashbrown 0.13.1\",\n  \"indexmap\",\n  \"memchr\",\n- \"rustc-std-workspace-alloc\",\n- \"rustc-std-workspace-core\",\n ]\n \n [[package]]\n@@ -3791,7 +3820,7 @@ dependencies = [\n  \"cstr\",\n  \"libc\",\n  \"measureme\",\n- \"object\",\n+ \"object 0.30.1\",\n  \"rustc-demangle\",\n  \"rustc_ast\",\n  \"rustc_attr\",\n@@ -3826,7 +3855,7 @@ dependencies = [\n  \"itertools\",\n  \"jobserver\",\n  \"libc\",\n- \"object\",\n+ \"object 0.30.1\",\n  \"pathdiff\",\n  \"regex\",\n  \"rustc_arena\",\n@@ -5296,11 +5325,11 @@ dependencies = [\n  \"core\",\n  \"dlmalloc\",\n  \"fortanix-sgx-abi\",\n- \"hashbrown\",\n+ \"hashbrown 0.12.3\",\n  \"hermit-abi 0.2.6\",\n  \"libc\",\n  \"miniz_oxide\",\n- \"object\",\n+ \"object 0.29.0\",\n  \"panic_abort\",\n  \"panic_unwind\",\n  \"profiler_builtins\",\n@@ -5549,13 +5578,13 @@ dependencies = [\n \n [[package]]\n name = \"thorin-dwp\"\n-version = \"0.3.0\"\n+version = \"0.4.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e6cb0c7868d7f90407531108ab03263d9452a8811b7cdd87675343a40d4aa254\"\n+checksum = \"da8fbf660a019b6bf11ea95762041464aa9099cc293b6a66d77cea5107619671\"\n dependencies = [\n  \"gimli\",\n- \"hashbrown\",\n- \"object\",\n+ \"hashbrown 0.12.3\",\n+ \"object 0.30.1\",\n  \"tracing\",\n ]\n \n@@ -6090,9 +6119,9 @@ checksum = \"6454029bf181f092ad1b853286f23e2c507d8e8194d01d92da4a55c274a5508c\"\n \n [[package]]\n name = \"version_check\"\n-version = \"0.9.3\"\n+version = \"0.9.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5fecdca9a5291cc2b8dcf7dc02453fee791a280f3743cb0905f8822ae463b3fe\"\n+checksum = \"49874b5167b65d7193b8aba1567f5c7d93d001cafc34600cee003eda787e483f\"\n \n [[package]]\n name = \"vte\""}, {"sha": "9c1bcd431ec4933b2d858b5d6eb21bcffbfabe69", "filename": "compiler/rustc_codegen_llvm/Cargo.toml", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_llvm%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_llvm%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2FCargo.toml?ref=44a500c8c187b245638684748f54bd6ec67e0b25", "patch": "@@ -11,7 +11,10 @@ bitflags = \"1.0\"\n cstr = \"0.2\"\n libc = \"0.2\"\n measureme = \"10.0.0\"\n-object = { version = \"0.29.0\", default-features = false, features = [\"std\", \"read\"] }\n+object = { version = \"0.30.1\", default-features = false, features = [\n+    \"std\",\n+    \"read\",\n+] }\n tracing = \"0.1\"\n rustc_middle = { path = \"../rustc_middle\" }\n rustc-demangle = \"0.1.21\""}, {"sha": "0d2d2ec68a23f3adf9ac9d928d0a435bb67c6c9b", "filename": "compiler/rustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2FCargo.toml?ref=44a500c8c187b245638684748f54bd6ec67e0b25", "patch": "@@ -15,7 +15,7 @@ tracing = \"0.1\"\n libc = \"0.2.50\"\n jobserver = \"0.1.22\"\n tempfile = \"3.2\"\n-thorin-dwp = \"0.3\"\n+thorin-dwp = \"0.4\"\n pathdiff = \"0.2.0\"\n serde_json = \"1.0.59\"\n snap = \"1\"\n@@ -44,6 +44,6 @@ rustc_session = { path = \"../rustc_session\" }\n rustc_const_eval = { path = \"../rustc_const_eval\" }\n \n [dependencies.object]\n-version = \"0.29.0\"\n+version = \"0.30.1\"\n default-features = false\n features = [\"read_core\", \"elf\", \"macho\", \"pe\", \"unaligned\", \"archive\", \"write\"]"}, {"sha": "7d3c14fec5fbf91e26146346386c3faf4c38c724", "filename": "compiler/rustc_codegen_ssa/src/back/metadata.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44a500c8c187b245638684748f54bd6ec67e0b25/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs?ref=44a500c8c187b245638684748f54bd6ec67e0b25", "patch": "@@ -100,7 +100,13 @@ pub(crate) fn create_object_file(sess: &Session) -> Option<write::Object<'static\n     };\n     let architecture = match &sess.target.arch[..] {\n         \"arm\" => Architecture::Arm,\n-        \"aarch64\" => Architecture::Aarch64,\n+        \"aarch64\" => {\n+            if sess.target.pointer_width == 32 {\n+                Architecture::Aarch64_Ilp32\n+            } else {\n+                Architecture::Aarch64\n+            }\n+        }\n         \"x86\" => Architecture::I386,\n         \"s390x\" => Architecture::S390x,\n         \"mips\" => Architecture::Mips,"}]}