{"sha": "926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyNjk5OTUxM2U3ZDNmMmNmNjI0MjFlN2E1MGIyYmRmOGQ1Y2VkOWU=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-12-18T15:22:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-18T15:22:09Z"}, "message": "Rollup merge of #80135 - camelid:const-macro-nt, r=petrochenkov\n\nDon't allow `const` to begin a nonterminal\n\nFixes #79908.\n\nThanks to Vadim Petrochenkov who [told me what the fix was][z]!\n\n[z]: https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/finding.20which.20macro.20rule.20to.20use/near/220240422\n\nr? ``@petrochenkov``", "tree": {"sha": "1c5b1caa910f9a02b1138734b72cd6b214740c89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c5b1caa910f9a02b1138734b72cd6b214740c89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf3MkiCRBK7hj4Ov3rIwAAdHIIAEqCdm8xuZAAgS0KC9Jb5Tev\nCbzmSjH1b0rrR9J7YyFJC3+ShABTiadpAKjFl98ecvAagZG2fpXWt7yB46uTw21d\n4vIzcxqh+ppsOyCJQR2J9YlD59As0uhs6L+jZ6LmlVKWOHB3Z1PWdhaHt1XRISRj\n199NpCI42YNXx0LDEV9dYF8iY7n744iJqHIAh2pz6ywA7ee9HznTKcLGonN+O7nt\ndpNds2s6QsIVVbv93j/ZSlgwTylMwQsOVMUOKfMaqK5L/m+JU1mA3AixEjnAa1t9\nUgZJcmrPcgLM9UlB/hC4X5ZZyH2axR3eSrh6qITmpi/u3pACXm1m7AlCOZhZ1ro=\n=PuEy\n-----END PGP SIGNATURE-----\n", "payload": "tree 1c5b1caa910f9a02b1138734b72cd6b214740c89\nparent 5eb15267ae30b617d6fb2555d33e79eca78ad156\nparent d6f1787447e1132d929efbb5b772be232e336c23\nauthor Ralf Jung <post@ralfj.de> 1608304929 +0100\ncommitter GitHub <noreply@github.com> 1608304929 +0100\n\nRollup merge of #80135 - camelid:const-macro-nt, r=petrochenkov\n\nDon't allow `const` to begin a nonterminal\n\nFixes #79908.\n\nThanks to Vadim Petrochenkov who [told me what the fix was][z]!\n\n[z]: https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/finding.20which.20macro.20rule.20to.20use/near/220240422\n\nr? ``@petrochenkov``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "html_url": "https://github.com/rust-lang/rust/commit/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5eb15267ae30b617d6fb2555d33e79eca78ad156", "url": "https://api.github.com/repos/rust-lang/rust/commits/5eb15267ae30b617d6fb2555d33e79eca78ad156", "html_url": "https://github.com/rust-lang/rust/commit/5eb15267ae30b617d6fb2555d33e79eca78ad156"}, {"sha": "d6f1787447e1132d929efbb5b772be232e336c23", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6f1787447e1132d929efbb5b772be232e336c23", "html_url": "https://github.com/rust-lang/rust/commit/d6f1787447e1132d929efbb5b772be232e336c23"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "76ad5acd5303eb4a8212fcf0ddaed5922e2e88d4", "filename": "compiler/rustc_parse/src/parser/nonterminal.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fnonterminal.rs?ref=926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "patch": "@@ -27,6 +27,8 @@ impl<'a> Parser<'a> {\n                 token.can_begin_expr()\n                 // This exception is here for backwards compatibility.\n                 && !token.is_keyword(kw::Let)\n+                // This exception is here for backwards compatibility.\n+                && !token.is_keyword(kw::Const)\n             }\n             NonterminalKind::Ty => token.can_begin_type(),\n             NonterminalKind::Ident => get_macro_ident(token).is_some(),"}, {"sha": "e7393166d8df3bdf32ed698c3e5ea3a752ce3c8a", "filename": "src/test/ui/inline-const/macro-with-const.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e/src%2Ftest%2Fui%2Finline-const%2Fmacro-with-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/926999513e7d3f2cf62421e7a50b2bdf8d5ced9e/src%2Ftest%2Fui%2Finline-const%2Fmacro-with-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finline-const%2Fmacro-with-const.rs?ref=926999513e7d3f2cf62421e7a50b2bdf8d5ced9e", "patch": "@@ -0,0 +1,20 @@\n+// check-pass\n+\n+macro_rules! exp {\n+    (const $n:expr) => {\n+        $n\n+    };\n+}\n+\n+macro_rules! stmt {\n+    (exp $e:expr) => {\n+        $e\n+    };\n+    (exp $($t:tt)+) => {\n+        exp!($($t)+)\n+    };\n+}\n+\n+fn main() {\n+    stmt!(exp const 1);\n+}"}]}