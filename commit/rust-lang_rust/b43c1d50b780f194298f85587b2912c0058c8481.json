{"sha": "b43c1d50b780f194298f85587b2912c0058c8481", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0M2MxZDUwYjc4MGYxOTQyOThmODU1ODdiMjkxMmMwMDU4Yzg0ODE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-01-30T04:36:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-30T04:36:53Z"}, "message": "Rollup merge of #81495 - camelid:rustdoc-output_format-optional, r=GuillaumeGomez\n\nrustdoc: Remove unnecessary optional\n\nPreviously, the HTML output format was represented by both\n`Some(OutputFormat::Html)` and `None` so there's no need to have an\noptional. Instead, `OutputFormat::Html` is explicitly the default and we\nno longer have a \"tri-state enum\".\n\nr? `````@GuillaumeGomez`````", "tree": {"sha": "a1e111a622c4afad5207fde215e9e05604853636", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1e111a622c4afad5207fde215e9e05604853636"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b43c1d50b780f194298f85587b2912c0058c8481", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgFOJmCRBK7hj4Ov3rIwAAdHIIAB18w0aF9crzU3s4BFcdU8NL\n+8qZqCCjMM1Ax/JVvXapRjw7xKLh+EUs6cncsG3RNCzUT9Jc3GH/M1M1cMNBOepj\nowrOm6joXMnG6yUaVHiBcc552WMzIpza74bE1preMvD7XhWV2T+4HXKCrQK5nGyO\nUfehw8t7GKKnICneTMfkvlHPUNzBw+Gv7wTEyvGEDr2A8T0M/SAZvwxT/yoDnbUA\nDbTdNHjcN3aFMI/TwT/oaAzjlGgu8A30pvzgEWaToSekPa2BjKmaQ+B184umYM7R\nGw2pZn6Nj0+9w+/hineskMlXhZc5NKFRy2uWFeTzYekf6hIipn3z79gDP2GgQEw=\n=b2Y9\n-----END PGP SIGNATURE-----\n", "payload": "tree a1e111a622c4afad5207fde215e9e05604853636\nparent 774ba83226d570d2ac4dd072515d3cbd08bd5b3e\nparent f620b5ced22e43bf484ca02f08b09dd45a30e0a1\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1611981413 +0900\ncommitter GitHub <noreply@github.com> 1611981413 +0900\n\nRollup merge of #81495 - camelid:rustdoc-output_format-optional, r=GuillaumeGomez\n\nrustdoc: Remove unnecessary optional\n\nPreviously, the HTML output format was represented by both\n`Some(OutputFormat::Html)` and `None` so there's no need to have an\noptional. Instead, `OutputFormat::Html` is explicitly the default and we\nno longer have a \"tri-state enum\".\n\nr? `````@GuillaumeGomez`````\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b43c1d50b780f194298f85587b2912c0058c8481", "html_url": "https://github.com/rust-lang/rust/commit/b43c1d50b780f194298f85587b2912c0058c8481", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b43c1d50b780f194298f85587b2912c0058c8481/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "774ba83226d570d2ac4dd072515d3cbd08bd5b3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/774ba83226d570d2ac4dd072515d3cbd08bd5b3e", "html_url": "https://github.com/rust-lang/rust/commit/774ba83226d570d2ac4dd072515d3cbd08bd5b3e"}, {"sha": "f620b5ced22e43bf484ca02f08b09dd45a30e0a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/f620b5ced22e43bf484ca02f08b09dd45a30e0a1", "html_url": "https://github.com/rust-lang/rust/commit/f620b5ced22e43bf484ca02f08b09dd45a30e0a1"}], "stats": {"total": 34, "additions": 21, "deletions": 13}, "files": [{"sha": "63a25e5dbfbbb2dd8e02df8e1ad8f84bce2a08c9", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=b43c1d50b780f194298f85587b2912c0058c8481", "patch": "@@ -35,6 +35,12 @@ crate enum OutputFormat {\n     Html,\n }\n \n+impl Default for OutputFormat {\n+    fn default() -> OutputFormat {\n+        OutputFormat::Html\n+    }\n+}\n+\n impl OutputFormat {\n     crate fn is_json(&self) -> bool {\n         matches!(self, OutputFormat::Json)\n@@ -118,7 +124,7 @@ crate struct Options {\n     crate enable_per_target_ignores: bool,\n \n     /// The path to a rustc-like binary to build tests with. If not set, we\n-    /// default to loading from $sysroot/bin/rustc.\n+    /// default to loading from `$sysroot/bin/rustc`.\n     crate test_builder: Option<PathBuf>,\n \n     // Options that affect the documentation process\n@@ -142,8 +148,10 @@ crate struct Options {\n     crate crate_version: Option<String>,\n     /// Collected options specific to outputting final pages.\n     crate render_options: RenderOptions,\n-    /// Output format rendering (used only for \"show-coverage\" option for the moment)\n-    crate output_format: Option<OutputFormat>,\n+    /// The format that we output when rendering.\n+    ///\n+    /// Currently used only for the `--show-coverage` option.\n+    crate output_format: OutputFormat,\n     /// If this option is set to `true`, rustdoc will only run checks and not generate\n     /// documentation.\n     crate run_check: bool,\n@@ -271,7 +279,7 @@ crate struct RenderInfo {\n     crate deref_trait_did: Option<DefId>,\n     crate deref_mut_trait_did: Option<DefId>,\n     crate owned_box_did: Option<DefId>,\n-    crate output_format: Option<OutputFormat>,\n+    crate output_format: OutputFormat,\n }\n \n impl Options {\n@@ -537,28 +545,28 @@ impl Options {\n \n         let output_format = match matches.opt_str(\"output-format\") {\n             Some(s) => match OutputFormat::try_from(s.as_str()) {\n-                Ok(o) => {\n-                    if o.is_json()\n+                Ok(out_fmt) => {\n+                    if out_fmt.is_json()\n                         && !(show_coverage || nightly_options::match_is_nightly_build(matches))\n                     {\n                         diag.struct_err(\"json output format isn't supported for doc generation\")\n                             .emit();\n                         return Err(1);\n-                    } else if !o.is_json() && show_coverage {\n+                    } else if !out_fmt.is_json() && show_coverage {\n                         diag.struct_err(\n                             \"html output format isn't supported for the --show-coverage option\",\n                         )\n                         .emit();\n                         return Err(1);\n                     }\n-                    Some(o)\n+                    out_fmt\n                 }\n                 Err(e) => {\n                     diag.struct_err(&e).emit();\n                     return Err(1);\n                 }\n             },\n-            None => None,\n+            None => OutputFormat::default(),\n         };\n         let crate_name = matches.opt_str(\"crate-name\");\n         let proc_macro_crate = crate_types.contains(&CrateType::ProcMacro);"}, {"sha": "aa18684aea1978cc4c52a937e4e764c95ab71b66", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=b43c1d50b780f194298f85587b2912c0058c8481", "patch": "@@ -463,7 +463,7 @@ crate fn run_global_ctxt(\n     mut default_passes: passes::DefaultPassOption,\n     mut manual_passes: Vec<String>,\n     render_options: RenderOptions,\n-    output_format: Option<OutputFormat>,\n+    output_format: OutputFormat,\n ) -> (clean::Crate, RenderInfo, RenderOptions) {\n     // Certain queries assume that some checks were run elsewhere\n     // (see https://github.com/rust-lang/rust/pull/73566#issuecomment-656954425),"}, {"sha": "e98cb237635fe9c441486a1e25d7ca7648b8eccd", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=b43c1d50b780f194298f85587b2912c0058c8481", "patch": "@@ -578,7 +578,7 @@ fn main_options(options: config::Options) -> MainResult {\n                 let (error_format, edition, debugging_options) = diag_opts;\n                 let diag = core::new_handler(error_format, None, &debugging_options);\n                 match output_format {\n-                    None | Some(config::OutputFormat::Html) => sess.time(\"render_html\", || {\n+                    config::OutputFormat::Html => sess.time(\"render_html\", || {\n                         run_renderer::<html::render::Context<'_>>(\n                             krate,\n                             render_opts,\n@@ -588,7 +588,7 @@ fn main_options(options: config::Options) -> MainResult {\n                             tcx,\n                         )\n                     }),\n-                    Some(config::OutputFormat::Json) => sess.time(\"render_json\", || {\n+                    config::OutputFormat::Json => sess.time(\"render_json\", || {\n                         run_renderer::<json::JsonRenderer<'_>>(\n                             krate,\n                             render_opts,"}, {"sha": "cdbff62d0645ccf9946c08b64f6a8402f94c2a29", "filename": "src/librustdoc/passes/calculate_doc_coverage.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b43c1d50b780f194298f85587b2912c0058c8481/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs?ref=b43c1d50b780f194298f85587b2912c0058c8481", "patch": "@@ -132,7 +132,7 @@ impl<'a, 'b> CoverageCalculator<'a, 'b> {\n \n     fn print_results(&self) {\n         let output_format = self.ctx.renderinfo.borrow().output_format;\n-        if output_format.map(|o| o.is_json()).unwrap_or_else(|| false) {\n+        if output_format.is_json() {\n             println!(\"{}\", self.to_json());\n             return;\n         }"}]}