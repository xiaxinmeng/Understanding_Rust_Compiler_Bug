{"sha": "61115cd75344598d91023dd5fe4aa855cc276db3", "node_id": "C_kwDOAAsO6NoAKDYxMTE1Y2Q3NTM0NDU5OGQ5MTAyM2RkNWZlNGFhODU1Y2MyNzZkYjM", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-05-07T05:12:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-07T05:12:15Z"}, "message": "Rollup merge of #111150 - mj10021:issue-111025-fix, r=petrochenkov\n\nadded TraitAlias to check_item() for missing_docs\n\nAs in issue #111025 the `missing_docs` was not being triggered for trait aliases.  I added `TraitAlias` to the pattern match for check_item(), and the lint seems to be behaving appropriately", "tree": {"sha": "0f9566da7dd70ace4f0890f08d3866b922a71a1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f9566da7dd70ace4f0890f08d3866b922a71a1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61115cd75344598d91023dd5fe4aa855cc276db3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkVzMvCRBK7hj4Ov3rIwAA7wMIAAw1X60/3I28oDete00TCE5o\nZiCxKVUf6Pdsns4QBPOCrxqpSJpXtvfpPAxeM1NR9udiGOCN9URHFZ6K3wb7hUzO\nT2tTXFr9rT4j6DxNB9sa1AZs/eaNlWvVUCQ+eXW6Hl5BeGgzZeleNkjhvjMyOmwJ\nSSpRr44cozA0lRwZmh3dhGco7dEdnJh7iJyheKMBhcNq+LW+O7/x5bZApWgg1O5k\nlgp5AQGIfARCv+ztXOhNCjNCTkVOa4oSd7CqHZvZcoPPnHL42p+ivvnjPpbhV/5f\nvEqWAQGERK/4/khffZbgyDCl5prsiRRnYD7fnIATMG/QQ5LzhaW/QUell4yP6oY=\n=gWFK\n-----END PGP SIGNATURE-----\n", "payload": "tree 0f9566da7dd70ace4f0890f08d3866b922a71a1d\nparent aef008aa6d3a86714ed739e7a5bf99f17aa9f6d9\nparent fd005b06bb3a9517e7275c99dfbbf7d29b6a3f94\nauthor Yuki Okushi <jtitor@2k36.org> 1683436335 +0900\ncommitter GitHub <noreply@github.com> 1683436335 +0900\n\nRollup merge of #111150 - mj10021:issue-111025-fix, r=petrochenkov\n\nadded TraitAlias to check_item() for missing_docs\n\nAs in issue #111025 the `missing_docs` was not being triggered for trait aliases.  I added `TraitAlias` to the pattern match for check_item(), and the lint seems to be behaving appropriately\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61115cd75344598d91023dd5fe4aa855cc276db3", "html_url": "https://github.com/rust-lang/rust/commit/61115cd75344598d91023dd5fe4aa855cc276db3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61115cd75344598d91023dd5fe4aa855cc276db3/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aef008aa6d3a86714ed739e7a5bf99f17aa9f6d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/aef008aa6d3a86714ed739e7a5bf99f17aa9f6d9", "html_url": "https://github.com/rust-lang/rust/commit/aef008aa6d3a86714ed739e7a5bf99f17aa9f6d9"}, {"sha": "fd005b06bb3a9517e7275c99dfbbf7d29b6a3f94", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd005b06bb3a9517e7275c99dfbbf7d29b6a3f94", "html_url": "https://github.com/rust-lang/rust/commit/fd005b06bb3a9517e7275c99dfbbf7d29b6a3f94"}], "stats": {"total": 88, "additions": 39, "deletions": 49}, "files": [{"sha": "95dfec14fd749153850cd3308003066e6d713053", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 5, "deletions": 24, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/61115cd75344598d91023dd5fe4aa855cc276db3/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61115cd75344598d91023dd5fe4aa855cc276db3/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=61115cd75344598d91023dd5fe4aa855cc276db3", "patch": "@@ -547,32 +547,13 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'_>, it: &hir::Item<'_>) {\n-        match it.kind {\n-            hir::ItemKind::Trait(..) => {\n-                // Issue #11592: traits are always considered exported, even when private.\n-                if cx.tcx.visibility(it.owner_id)\n-                    == ty::Visibility::Restricted(\n-                        cx.tcx.parent_module_from_def_id(it.owner_id.def_id).to_def_id(),\n-                    )\n-                {\n-                    return;\n-                }\n-            }\n-            hir::ItemKind::TyAlias(..)\n-            | hir::ItemKind::Fn(..)\n-            | hir::ItemKind::Macro(..)\n-            | hir::ItemKind::Mod(..)\n-            | hir::ItemKind::Enum(..)\n-            | hir::ItemKind::Struct(..)\n-            | hir::ItemKind::Union(..)\n-            | hir::ItemKind::Const(..)\n-            | hir::ItemKind::Static(..) => {}\n-\n-            _ => return,\n-        };\n+        // Previously the Impl and Use types have been excluded from missing docs,\n+        // so we will continue to exclude them for compatibility\n+        if let hir::ItemKind::Impl(..) | hir::ItemKind::Use(..) = it.kind {\n+            return;\n+        }\n \n         let (article, desc) = cx.tcx.article_and_description(it.owner_id.to_def_id());\n-\n         self.check_missing_docs_attrs(cx, it.owner_id.def_id, article, desc);\n     }\n "}, {"sha": "e4c9f8f559b18219a14e094284c8e4cb20782ff5", "filename": "tests/ui/lint/lint-missing-doc.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61115cd75344598d91023dd5fe4aa855cc276db3/tests%2Fui%2Flint%2Flint-missing-doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61115cd75344598d91023dd5fe4aa855cc276db3/tests%2Fui%2Flint%2Flint-missing-doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Flint-missing-doc.rs?ref=61115cd75344598d91023dd5fe4aa855cc276db3", "patch": "@@ -3,6 +3,7 @@\n #![deny(missing_docs)]\n #![allow(dead_code)]\n #![feature(associated_type_defaults, extern_types)]\n+#![feature(trait_alias)]\n \n //! Some garbage docs for the crate here\n #![doc=\"More garbage\"]\n@@ -202,4 +203,6 @@ extern \"C\" {\n     //~^ ERROR: missing documentation for a foreign type\n }\n \n+pub trait T = Sync; //~ ERROR: missing documentation for a trait alias\n+\n fn main() {}"}, {"sha": "c94bd3b8dfb3fd686bf3d65fbc38bb4f483f1589", "filename": "tests/ui/lint/lint-missing-doc.stderr", "status": "modified", "additions": 31, "deletions": 25, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/61115cd75344598d91023dd5fe4aa855cc276db3/tests%2Fui%2Flint%2Flint-missing-doc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61115cd75344598d91023dd5fe4aa855cc276db3/tests%2Fui%2Flint%2Flint-missing-doc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Flint-missing-doc.stderr?ref=61115cd75344598d91023dd5fe4aa855cc276db3", "patch": "@@ -1,5 +1,5 @@\n error: missing documentation for a type alias\n-  --> $DIR/lint-missing-doc.rs:11:1\n+  --> $DIR/lint-missing-doc.rs:12:1\n    |\n LL | pub type PubTypedef = String;\n    | ^^^^^^^^^^^^^^^^^^^\n@@ -11,142 +11,148 @@ LL | #![deny(missing_docs)]\n    |         ^^^^^^^^^^^^\n \n error: missing documentation for a struct\n-  --> $DIR/lint-missing-doc.rs:18:1\n+  --> $DIR/lint-missing-doc.rs:19:1\n    |\n LL | pub struct PubFoo {\n    | ^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a struct field\n-  --> $DIR/lint-missing-doc.rs:19:5\n+  --> $DIR/lint-missing-doc.rs:20:5\n    |\n LL |     pub a: isize,\n    |     ^^^^^^^^^^^^\n \n error: missing documentation for a module\n-  --> $DIR/lint-missing-doc.rs:30:1\n+  --> $DIR/lint-missing-doc.rs:31:1\n    |\n LL | pub mod pub_module_no_dox {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/lint-missing-doc.rs:34:1\n+  --> $DIR/lint-missing-doc.rs:35:1\n    |\n LL | pub fn foo2() {}\n    | ^^^^^^^^^^^^^\n \n error: missing documentation for a trait\n-  --> $DIR/lint-missing-doc.rs:52:1\n+  --> $DIR/lint-missing-doc.rs:53:1\n    |\n LL | pub trait C {\n    | ^^^^^^^^^^^\n \n error: missing documentation for a method\n-  --> $DIR/lint-missing-doc.rs:53:5\n+  --> $DIR/lint-missing-doc.rs:54:5\n    |\n LL |     fn foo(&self);\n    |     ^^^^^^^^^^^^^^\n \n error: missing documentation for a method\n-  --> $DIR/lint-missing-doc.rs:54:5\n+  --> $DIR/lint-missing-doc.rs:55:5\n    |\n LL |     fn foo_with_impl(&self) {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated function\n-  --> $DIR/lint-missing-doc.rs:55:5\n+  --> $DIR/lint-missing-doc.rs:56:5\n    |\n LL |     fn foo_no_self();\n    |     ^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated function\n-  --> $DIR/lint-missing-doc.rs:56:5\n+  --> $DIR/lint-missing-doc.rs:57:5\n    |\n LL |     fn foo_no_self_with_impl() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated type\n-  --> $DIR/lint-missing-doc.rs:66:5\n+  --> $DIR/lint-missing-doc.rs:67:5\n    |\n LL |     type AssociatedType;\n    |     ^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated type\n-  --> $DIR/lint-missing-doc.rs:67:5\n+  --> $DIR/lint-missing-doc.rs:68:5\n    |\n LL |     type AssociatedTypeDef = Self;\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for an associated function\n-  --> $DIR/lint-missing-doc.rs:83:5\n+  --> $DIR/lint-missing-doc.rs:84:5\n    |\n LL |     pub fn foo() {}\n    |     ^^^^^^^^^^^^\n \n error: missing documentation for an enum\n-  --> $DIR/lint-missing-doc.rs:120:1\n+  --> $DIR/lint-missing-doc.rs:121:1\n    |\n LL | pub enum PubBaz {\n    | ^^^^^^^^^^^^^^^\n \n error: missing documentation for a variant\n-  --> $DIR/lint-missing-doc.rs:121:5\n+  --> $DIR/lint-missing-doc.rs:122:5\n    |\n LL |     PubBazA {\n    |     ^^^^^^^\n \n error: missing documentation for a struct field\n-  --> $DIR/lint-missing-doc.rs:122:9\n+  --> $DIR/lint-missing-doc.rs:123:9\n    |\n LL |         a: isize,\n    |         ^^^^^^^^\n \n error: missing documentation for a constant\n-  --> $DIR/lint-missing-doc.rs:153:1\n+  --> $DIR/lint-missing-doc.rs:154:1\n    |\n LL | pub const FOO4: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n-  --> $DIR/lint-missing-doc.rs:163:1\n+  --> $DIR/lint-missing-doc.rs:164:1\n    |\n LL | pub static BAR4: u32 = 0;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/lint-missing-doc.rs:169:5\n+  --> $DIR/lint-missing-doc.rs:170:5\n    |\n LL |     pub fn undocumented1() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/lint-missing-doc.rs:170:5\n+  --> $DIR/lint-missing-doc.rs:171:5\n    |\n LL |     pub fn undocumented2() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/lint-missing-doc.rs:176:9\n+  --> $DIR/lint-missing-doc.rs:177:9\n    |\n LL |         pub fn also_undocumented1() {}\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a function\n-  --> $DIR/lint-missing-doc.rs:191:5\n+  --> $DIR/lint-missing-doc.rs:192:5\n    |\n LL |     pub fn extern_fn_undocumented(f: f32) -> f32;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a static\n-  --> $DIR/lint-missing-doc.rs:196:5\n+  --> $DIR/lint-missing-doc.rs:197:5\n    |\n LL |     pub static EXTERN_STATIC_UNDOCUMENTED: u8;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: missing documentation for a foreign type\n-  --> $DIR/lint-missing-doc.rs:201:5\n+  --> $DIR/lint-missing-doc.rs:202:5\n    |\n LL |     pub type ExternTyUndocumented;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 24 previous errors\n+error: missing documentation for a trait alias\n+  --> $DIR/lint-missing-doc.rs:206:1\n+   |\n+LL | pub trait T = Sync;\n+   | ^^^^^^^^^^^\n+\n+error: aborting due to 25 previous errors\n "}]}