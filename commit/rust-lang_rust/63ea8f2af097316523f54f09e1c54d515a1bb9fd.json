{"sha": "63ea8f2af097316523f54f09e1c54d515a1bb9fd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzZWE4ZjJhZjA5NzMxNjUyM2Y1NGYwOWUxYzU0ZDUxNWExYmI5ZmQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-01T13:18:51Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-01T13:18:51Z"}, "message": "Add a transitive deps iterator to `CrateGraph`", "tree": {"sha": "ee6ac25d659325235b87c82cb78dcbb43b4b789d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee6ac25d659325235b87c82cb78dcbb43b4b789d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63ea8f2af097316523f54f09e1c54d515a1bb9fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63ea8f2af097316523f54f09e1c54d515a1bb9fd", "html_url": "https://github.com/rust-lang/rust/commit/63ea8f2af097316523f54f09e1c54d515a1bb9fd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63ea8f2af097316523f54f09e1c54d515a1bb9fd/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f94ad332aa22252a46d948888f5b23c0e21cd38", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f94ad332aa22252a46d948888f5b23c0e21cd38", "html_url": "https://github.com/rust-lang/rust/commit/3f94ad332aa22252a46d948888f5b23c0e21cd38"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "aaa4927596e24e063ffe8b2926736b9dd6d3290c", "filename": "crates/ra_db/src/input.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/63ea8f2af097316523f54f09e1c54d515a1bb9fd/crates%2Fra_db%2Fsrc%2Finput.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63ea8f2af097316523f54f09e1c54d515a1bb9fd/crates%2Fra_db%2Fsrc%2Finput.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_db%2Fsrc%2Finput.rs?ref=63ea8f2af097316523f54f09e1c54d515a1bb9fd", "patch": "@@ -197,6 +197,23 @@ impl CrateGraph {\n         self.arena.keys().copied()\n     }\n \n+    /// Returns an iterator over all transitive dependencies of the given crate.\n+    pub fn transitive_deps(&self, of: CrateId) -> impl Iterator<Item = CrateId> + '_ {\n+        let mut worklist = vec![of];\n+        let mut deps = FxHashSet::default();\n+\n+        while let Some(krate) = worklist.pop() {\n+            if !deps.insert(krate) {\n+                continue;\n+            }\n+\n+            worklist.extend(self[krate].dependencies.iter().map(|dep| dep.crate_id));\n+        }\n+\n+        deps.remove(&of);\n+        deps.into_iter()\n+    }\n+\n     // FIXME: this only finds one crate with the given root; we could have multiple\n     pub fn crate_id_for_crate_root(&self, file_id: FileId) -> Option<CrateId> {\n         let (&crate_id, _) ="}]}