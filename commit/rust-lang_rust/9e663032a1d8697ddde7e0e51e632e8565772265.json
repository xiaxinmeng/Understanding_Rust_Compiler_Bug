{"sha": "9e663032a1d8697ddde7e0e51e632e8565772265", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNjYzMDMyYTFkODY5N2RkZGU3ZTBlNTFlNjMyZTg1NjU3NzIyNjU=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-03-25T22:27:49Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-03-25T22:27:49Z"}, "message": "[CI] record docker image info for reuse\n\nThis writes an extra `dist/image-$image.txt` which contains the S3 URL\nof the cached image and the `sha256` digest of the docker entry point.\nThis will be uploaded with the rest of the deployed artifacts in the\nTravis `after_success` script.", "tree": {"sha": "95d173f6cb458b287b2f3613501af10285ef24a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/95d173f6cb458b287b2f3613501af10285ef24a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e663032a1d8697ddde7e0e51e632e8565772265", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e663032a1d8697ddde7e0e51e632e8565772265", "html_url": "https://github.com/rust-lang/rust/commit/9e663032a1d8697ddde7e0e51e632e8565772265", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e663032a1d8697ddde7e0e51e632e8565772265/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d91b32b4dc9db066ab7deedbc51dc62ba597524b", "url": "https://api.github.com/repos/rust-lang/rust/commits/d91b32b4dc9db066ab7deedbc51dc62ba597524b", "html_url": "https://github.com/rust-lang/rust/commit/d91b32b4dc9db066ab7deedbc51dc62ba597524b"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "98a765e1cec9557c815dca50507ebeb5fe2def60", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9e663032a1d8697ddde7e0e51e632e8565772265/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9e663032a1d8697ddde7e0e51e632e8565772265/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=9e663032a1d8697ddde7e0e51e632e8565772265", "patch": "@@ -12,6 +12,9 @@ ci_dir=\"`dirname $docker_dir`\"\n src_dir=\"`dirname $ci_dir`\"\n root_dir=\"`dirname $src_dir`\"\n \n+objdir=$root_dir/obj\n+dist=$objdir/build/dist\n+\n source \"$ci_dir/shared.sh\"\n \n travis_fold start build_docker\n@@ -77,6 +80,11 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       else\n         echo \"Looks like docker image is the same as before, not uploading\"\n       fi\n+      # Record the container image for reuse, e.g. by rustup.rs builds\n+      info=\"$dist/image-$image.txt\"\n+      mkdir -p \"$dist\"\n+      echo \"$url\" >\"$info\"\n+      echo \"$digest\" >>\"$info\"\n     fi\n elif [ -f \"$docker_dir/disabled/$image/Dockerfile\" ]; then\n     if [ -n \"$TRAVIS_OS_NAME\" ]; then\n@@ -99,8 +107,6 @@ fi\n travis_fold end build_docker\n travis_time_finish\n \n-objdir=$root_dir/obj\n-\n mkdir -p $HOME/.cargo\n mkdir -p $objdir/tmp\n mkdir -p $objdir/cores"}]}