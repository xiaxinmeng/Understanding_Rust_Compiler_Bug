{"sha": "5640304c63c5c77b721424be88791503a0e0ea3d", "node_id": "C_kwDOAAsO6NoAKDU2NDAzMDRjNjNjNWM3N2I3MjE0MjRiZTg4NzkxNTAzYTBlMGVhM2Q", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-04-17T21:26:15Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-04-17T23:03:08Z"}, "message": "add log warnings for when we overwrite parts of a pointer, and de-init the rest", "tree": {"sha": "9bdc4aeb5f8db48d5f85c204799cb3cee82644db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9bdc4aeb5f8db48d5f85c204799cb3cee82644db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5640304c63c5c77b721424be88791503a0e0ea3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5640304c63c5c77b721424be88791503a0e0ea3d", "html_url": "https://github.com/rust-lang/rust/commit/5640304c63c5c77b721424be88791503a0e0ea3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5640304c63c5c77b721424be88791503a0e0ea3d/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad4e98ed7dc535d161886b17f7792501baa82c9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad4e98ed7dc535d161886b17f7792501baa82c9b", "html_url": "https://github.com/rust-lang/rust/commit/ad4e98ed7dc535d161886b17f7792501baa82c9b"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "357e67de7575a1606f84b159dd81fb69602a8142", "filename": "compiler/rustc_middle/src/mir/interpret/allocation.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5640304c63c5c77b721424be88791503a0e0ea3d/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5640304c63c5c77b721424be88791503a0e0ea3d/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs?ref=5640304c63c5c77b721424be88791503a0e0ea3d", "patch": "@@ -509,6 +509,9 @@ impl<Tag: Copy, Extra> Allocation<Tag, Extra> {\n             if Tag::ERR_ON_PARTIAL_PTR_OVERWRITE {\n                 return Err(AllocError::PartialPointerOverwrite(first));\n             }\n+            warn!(\n+                \"Partial pointer overwrite! De-initializing memory at offsets {first:?}..{start:?}.\"\n+            );\n             self.init_mask.set_range(first, start, false);\n         }\n         if last > end {\n@@ -517,10 +520,15 @@ impl<Tag: Copy, Extra> Allocation<Tag, Extra> {\n                     last - cx.data_layout().pointer_size,\n                 ));\n             }\n+            warn!(\n+                \"Partial pointer overwrite! De-initializing memory at offsets {end:?}..{last:?}.\"\n+            );\n             self.init_mask.set_range(end, last, false);\n         }\n \n         // Forget all the relocations.\n+        // Since relocations do not overlap, we know that removing until `last` (exclusive) is fine,\n+        // i.e., this will not remove any other relocations just after the ones we care about.\n         self.relocations.0.remove_range(first..last);\n \n         Ok(())"}]}