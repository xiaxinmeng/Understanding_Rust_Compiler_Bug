{"sha": "61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxYTYwY2U3ZDM2OWI1NGUyMDkwMDNlOWU5MmJmOTBkNmY1ZTVkNGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-09T23:50:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-09T23:50:04Z"}, "message": "Auto merge of #61229 - Centril:stabilize-repr_align_enum, r=nagisa\n\nStabilize #![feature(repr_align_enum)] in Rust 1.37.0\n\nOn an `enum` item, you may now write:\n\n```rust\n#[repr(align(X))]\nenum Foo {\n    // ...\n}\n```\n\nThis has equivalent effects to first defining:\n\n```rust\n#[repr(align(X))]\nstruct AlignX<T>(T);\n```\n\nand then using `AlignX<Foo>` in `Foo`'s stead.\n\nr? @nagisa", "tree": {"sha": "0b606c3a8160219d9b02f75fdeb656c3a3c7a0e2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b606c3a8160219d9b02f75fdeb656c3a3c7a0e2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "html_url": "https://github.com/rust-lang/rust/commit/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "400b409efc4975a082185c5a74412572e49dfd98", "url": "https://api.github.com/repos/rust-lang/rust/commits/400b409efc4975a082185c5a74412572e49dfd98", "html_url": "https://github.com/rust-lang/rust/commit/400b409efc4975a082185c5a74412572e49dfd98"}, {"sha": "c25e3d2be5825463cf63c518854b583fbc9e8386", "url": "https://api.github.com/repos/rust-lang/rust/commits/c25e3d2be5825463cf63c518854b583fbc9e8386", "html_url": "https://github.com/rust-lang/rust/commit/c25e3d2be5825463cf63c518854b583fbc9e8386"}], "stats": {"total": 134, "additions": 38, "deletions": 96}, "files": [{"sha": "415c6ebe8b4bcfe7e45026f4e0dda575da807bcb", "filename": "src/doc/unstable-book/src/language-features/repr-align-enum.md", "status": "removed", "additions": 0, "deletions": 42, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/400b409efc4975a082185c5a74412572e49dfd98/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md", "raw_url": "https://github.com/rust-lang/rust/raw/400b409efc4975a082185c5a74412572e49dfd98/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md?ref=400b409efc4975a082185c5a74412572e49dfd98", "patch": "@@ -1,42 +0,0 @@\n-# `repr_align_enum`\n-\n-The tracking issue for this feature is: [#57996]\n-\n-[#57996]: https://github.com/rust-lang/rust/issues/57996\n-\n-------------------------\n-\n-The `repr_align_enum` feature allows using the `#[repr(align(x))]` attribute\n-on enums, similarly to structs.\n-\n-# Examples\n-\n-```rust\n-#![feature(repr_align_enum)]\n-\n-#[repr(align(8))]\n-enum Aligned {\n-    Foo,\n-    Bar { value: u32 },\n-}\n-\n-fn main() {\n-    assert_eq!(std::mem::align_of::<Aligned>(), 8);\n-}\n-```\n-\n-This is equivalent to using an aligned wrapper struct everywhere:\n-\n-```rust\n-#[repr(align(8))]\n-struct Aligned(Unaligned);\n-\n-enum Unaligned {\n-    Foo,\n-    Bar { value: u32 },\n-}\n-\n-fn main() {\n-    assert_eq!(std::mem::align_of::<Aligned>(), 8);\n-}\n-```"}, {"sha": "bbb297e3c4fc7950f746c8eee46e2c77625398a9", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 14, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -551,9 +551,6 @@ declare_features! (\n     // Allows using `#[optimize(X)]`.\n     (active, optimize_attribute, \"1.34.0\", Some(54882), None),\n \n-    // Allows using `#[repr(align(X))]` on enums.\n-    (active, repr_align_enum, \"1.34.0\", Some(57996), None),\n-\n     // Allows using C-variadics.\n     (active, c_variadic, \"1.34.0\", Some(44930), None),\n \n@@ -843,6 +840,9 @@ declare_features! (\n     (accepted, extern_crate_self, \"1.34.0\", Some(56409), None),\n     // Allows arbitrary delimited token streams in non-macro attributes.\n     (accepted, unrestricted_attribute_tokens, \"1.34.0\", Some(55208), None),\n+    // Allows using `#[repr(align(X))]` on enums with equivalent semantics\n+    // to wrapping an enum in a wrapper struct with `#[repr(align(X))]`.\n+    (accepted, repr_align_enum, \"1.37.0\", Some(57996), None),\n \n     // -------------------------------------------------------------------------\n     // feature-group-end: accepted features\n@@ -2033,17 +2033,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 }\n             }\n \n-            ast::ItemKind::Enum(..) => {\n-                for attr in attr::filter_by_name(&i.attrs[..], sym::repr) {\n-                    for item in attr.meta_item_list().unwrap_or_else(Vec::new) {\n-                        if item.check_name(sym::align) {\n-                            gate_feature_post!(&self, repr_align_enum, attr.span,\n-                                               \"`#[repr(align(x))]` on enums is experimental\");\n-                        }\n-                    }\n-                }\n-            }\n-\n             ast::ItemKind::Impl(_, polarity, defaultness, _, _, _, _) => {\n                 if polarity == ast::ImplPolarity::Negative {\n                     gate_feature_post!(&self, optin_builtin_traits,"}, {"sha": "4241fcea8047dd68f7ecb08f8082946c12eb2d0e", "filename": "src/test/codegen/align-enum.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fcodegen%2Falign-enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fcodegen%2Falign-enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Falign-enum.rs?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -3,7 +3,6 @@\n // min-llvm-version 7.0\n \n #![crate_type = \"lib\"]\n-#![feature(repr_align_enum)]\n \n #[repr(align(64))]\n pub enum Align64 {"}, {"sha": "fa872caa3b47edf003d5d94369072b4be858e5f5", "filename": "src/test/run-pass/structs-enums/align-enum.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -1,6 +1,5 @@\n // run-pass\n #![allow(dead_code)]\n-#![feature(repr_align_enum)]\n \n use std::mem;\n "}, {"sha": "ef64dfe20bc9dc59fec15e6f99b8d626b80ba898", "filename": "src/test/ui/attr-usage-repr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Fattr-usage-repr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Fattr-usage-repr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattr-usage-repr.rs?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -1,5 +1,4 @@\n #![feature(repr_simd)]\n-#![feature(repr_align_enum)]\n \n #[repr(C)] //~ ERROR: attribute should be applied to struct, enum or union\n fn f() {}"}, {"sha": "d1f4f3bfeb2cbad20a6f463a09c49712e8002450", "filename": "src/test/ui/attr-usage-repr.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Fattr-usage-repr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Fattr-usage-repr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattr-usage-repr.stderr?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -1,29 +1,29 @@\n error[E0517]: attribute should be applied to struct, enum or union\n-  --> $DIR/attr-usage-repr.rs:4:8\n+  --> $DIR/attr-usage-repr.rs:3:8\n    |\n LL | #[repr(C)]\n    |        ^\n LL | fn f() {}\n    | --------- not a struct, enum or union\n \n error[E0517]: attribute should be applied to enum\n-  --> $DIR/attr-usage-repr.rs:16:8\n+  --> $DIR/attr-usage-repr.rs:15:8\n    |\n LL | #[repr(i8)]\n    |        ^^\n LL | struct SInt(f64, f64);\n    | ---------------------- not an enum\n \n error[E0517]: attribute should be applied to struct or union\n-  --> $DIR/attr-usage-repr.rs:25:8\n+  --> $DIR/attr-usage-repr.rs:24:8\n    |\n LL | #[repr(packed)]\n    |        ^^^^^^\n LL | enum EPacked { A, B }\n    | --------------------- not a struct or union\n \n error[E0517]: attribute should be applied to struct\n-  --> $DIR/attr-usage-repr.rs:28:8\n+  --> $DIR/attr-usage-repr.rs:27:8\n    |\n LL | #[repr(simd)]\n    |        ^^^^"}, {"sha": "8b68caa6f5b0ed498a8904c435bf65b7b13e88ef", "filename": "src/test/ui/feature-gates/feature-gate-repr_align_enum.rs", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/400b409efc4975a082185c5a74412572e49dfd98/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/400b409efc4975a082185c5a74412572e49dfd98/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs?ref=400b409efc4975a082185c5a74412572e49dfd98", "patch": "@@ -1,10 +0,0 @@\n-#[repr(align(16))]\n-struct Foo(u64);\n-\n-#[repr(align(8))] //~ ERROR `#[repr(align(x))]` on enums is experimental\n-enum Bar {\n-    Foo { foo: Foo },\n-    Baz,\n-}\n-\n-fn main() { }"}, {"sha": "36924f4c167ca0b7e11ae67d5ac886ef2ebcc036", "filename": "src/test/ui/feature-gates/feature-gate-repr_align_enum.stderr", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/400b409efc4975a082185c5a74412572e49dfd98/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/400b409efc4975a082185c5a74412572e49dfd98/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr?ref=400b409efc4975a082185c5a74412572e49dfd98", "patch": "@@ -1,12 +0,0 @@\n-error[E0658]: `#[repr(align(x))]` on enums is experimental\n-  --> $DIR/feature-gate-repr_align_enum.rs:4:1\n-   |\n-LL | #[repr(align(8))]\n-   | ^^^^^^^^^^^^^^^^^\n-   |\n-   = note: for more information, see https://github.com/rust-lang/rust/issues/57996\n-   = help: add #![feature(repr_align_enum)] to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "bc6a9fe562a6790289f279a36c01d2f628bef3c7", "filename": "src/test/ui/repr/repr-align.rs", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -1,19 +1,27 @@\n-#![feature(repr_align_enum)]\n #![allow(dead_code)]\n \n #[repr(align(16.0))] //~ ERROR: invalid `repr(align)` attribute: not an unsuffixed integer\n-struct A(i32);\n+struct S0(i32);\n \n #[repr(align(15))] //~ ERROR: invalid `repr(align)` attribute: not a power of two\n-struct B(i32);\n+struct S1(i32);\n \n #[repr(align(4294967296))] //~ ERROR: invalid `repr(align)` attribute: larger than 2^29\n-struct C(i32);\n+struct S2(i32);\n \n #[repr(align(536870912))] // ok: this is the largest accepted alignment\n-struct D(i32);\n+struct S3(i32);\n+\n+#[repr(align(16.0))] //~ ERROR: invalid `repr(align)` attribute: not an unsuffixed integer\n+enum E0 { A, B }\n \n #[repr(align(15))] //~ ERROR: invalid `repr(align)` attribute: not a power of two\n-enum E { Left, Right }\n+enum E1 { A, B }\n+\n+#[repr(align(4294967296))] //~ ERROR: invalid `repr(align)` attribute: larger than 2^29\n+enum E2 { A, B }\n+\n+#[repr(align(536870912))] // ok: this is the largest accepted alignment\n+enum E3 { A, B }\n \n fn main() {}"}, {"sha": "280cab2b4a144fed2ff097ec02ac54bbb4a09d50", "filename": "src/test/ui/repr/repr-align.stderr", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61a60ce7d369b54e209003e9e92bf90d6f5e5d4b/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr?ref=61a60ce7d369b54e209003e9e92bf90d6f5e5d4b", "patch": "@@ -1,27 +1,39 @@\n error[E0589]: invalid `repr(align)` attribute: not an unsuffixed integer\n-  --> $DIR/repr-align.rs:4:8\n+  --> $DIR/repr-align.rs:3:8\n    |\n LL | #[repr(align(16.0))]\n    |        ^^^^^^^^^^^\n \n error[E0589]: invalid `repr(align)` attribute: not a power of two\n-  --> $DIR/repr-align.rs:7:8\n+  --> $DIR/repr-align.rs:6:8\n    |\n LL | #[repr(align(15))]\n    |        ^^^^^^^^^\n \n error[E0589]: invalid `repr(align)` attribute: larger than 2^29\n-  --> $DIR/repr-align.rs:10:8\n+  --> $DIR/repr-align.rs:9:8\n    |\n LL | #[repr(align(4294967296))]\n    |        ^^^^^^^^^^^^^^^^^\n \n+error[E0589]: invalid `repr(align)` attribute: not an unsuffixed integer\n+  --> $DIR/repr-align.rs:15:8\n+   |\n+LL | #[repr(align(16.0))]\n+   |        ^^^^^^^^^^^\n+\n error[E0589]: invalid `repr(align)` attribute: not a power of two\n-  --> $DIR/repr-align.rs:16:8\n+  --> $DIR/repr-align.rs:18:8\n    |\n LL | #[repr(align(15))]\n    |        ^^^^^^^^^\n \n-error: aborting due to 4 previous errors\n+error[E0589]: invalid `repr(align)` attribute: larger than 2^29\n+  --> $DIR/repr-align.rs:21:8\n+   |\n+LL | #[repr(align(4294967296))]\n+   |        ^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0589`."}]}