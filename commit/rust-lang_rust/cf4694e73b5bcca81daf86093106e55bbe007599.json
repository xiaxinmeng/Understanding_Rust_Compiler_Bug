{"sha": "cf4694e73b5bcca81daf86093106e55bbe007599", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmNDY5NGU3M2I1YmNjYTgxZGFmODYwOTMxMDZlNTViYmUwMDc1OTk=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-08-13T22:56:17Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-08-14T23:52:05Z"}, "message": "std: Change ProcessOptions struct to have an option of a ~ vector\n\nThis is a workaround for #8498", "tree": {"sha": "3995ff3fb7e6fac8f0c5807d59355be271b803c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3995ff3fb7e6fac8f0c5807d59355be271b803c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf4694e73b5bcca81daf86093106e55bbe007599", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf4694e73b5bcca81daf86093106e55bbe007599", "html_url": "https://github.com/rust-lang/rust/commit/cf4694e73b5bcca81daf86093106e55bbe007599", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf4694e73b5bcca81daf86093106e55bbe007599/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7b572952c76fd6b05c947aa3193e10410773078", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7b572952c76fd6b05c947aa3193e10410773078", "html_url": "https://github.com/rust-lang/rust/commit/e7b572952c76fd6b05c947aa3193e10410773078"}], "stats": {"total": 32, "additions": 17, "deletions": 15}, "files": [{"sha": "45e4f756d7a15752a7e3d3e7ed672ac2547c8296", "filename": "src/compiletest/procsrv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Fcompiletest%2Fprocsrv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Fcompiletest%2Fprocsrv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fprocsrv.rs?ref=cf4694e73b5bcca81daf86093106e55bbe007599", "patch": "@@ -49,7 +49,7 @@ pub fn run(lib_path: &str,\n \n     let env = env + target_env(lib_path, prog);\n     let mut proc = run::Process::new(prog, args, run::ProcessOptions {\n-        env: Some(env.slice(0, env.len())),\n+        env: Some(env),\n         dir: None,\n         in_fd: None,\n         out_fd: None,"}, {"sha": "be3cb644edbaa3f3685ae978376ec3b42aac26de", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=cf4694e73b5bcca81daf86093106e55bbe007599", "patch": "@@ -114,7 +114,7 @@ fn mk_temp_workspace(short_name: &Path, version: &Version) -> Path {\n fn run_git(args: &[~str], env: Option<~[(~str, ~str)]>, cwd: &Path, err_msg: &str) {\n     let cwd = (*cwd).clone();\n     let mut prog = run::Process::new(\"git\", args, run::ProcessOptions {\n-        env: env.map(|v| v.slice(0, v.len())),\n+        env: env,\n         dir: Some(&cwd),\n         in_fd: None,\n         out_fd: None,\n@@ -222,7 +222,7 @@ fn command_line_test_with_env(args: &[~str], cwd: &Path, env: Option<~[(~str, ~s\n     assert!(os::path_is_dir(&*cwd));\n     let cwd = (*cwd).clone();\n     let mut prog = run::Process::new(cmd, args, run::ProcessOptions {\n-        env: env.map(|v| v.slice(0, v.len())),\n+        env: env,\n         dir: Some(&cwd),\n         in_fd: None,\n         out_fd: None,\n@@ -757,7 +757,9 @@ fn rust_path_test() {\n                                      // use command_line_test_with_env\n     let mut prog = run::Process::new(\"rustpkg\",\n                                      [~\"install\", ~\"foo\"],\n-                                     run::ProcessOptions { env: Some(&[(~\"RUST_LOG\",\n+// This should actually extend the environment; then we can probably\n+// un-ignore it\n+                                     run::ProcessOptions { env: Some(~[(~\"RUST_LOG\",\n                                                                         ~\"rustpkg\"),\n                                                                        (~\"RUST_PATH\",\n                                                                        dir_for_path.to_str())]),\n@@ -1039,7 +1041,7 @@ fn test_extern_mod() {\n                                                       ~\"--sysroot\", test_sysroot().to_str(),\n                                                ~\"-o\", exec_file.to_str()],\n                                      run::ProcessOptions {\n-        env: env.map(|v| v.slice(0, v.len())),\n+        env: env,\n         dir: Some(&dir),\n         in_fd: None,\n         out_fd: None,"}, {"sha": "4d751101d730d4c44316d188d5497f1f08eccaff", "filename": "src/libstd/run.rs", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Flibstd%2Frun.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf4694e73b5bcca81daf86093106e55bbe007599/src%2Flibstd%2Frun.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frun.rs?ref=cf4694e73b5bcca81daf86093106e55bbe007599", "patch": "@@ -68,7 +68,7 @@ pub struct ProcessOptions<'self> {\n      * If this is Some(vec-of-names-and-values) then the new process will\n      * have an environment containing the given named values only.\n      */\n-    env: Option<&'self [(~str, ~str)]>,\n+    env: Option<~[(~str, ~str)]>,\n \n     /**\n      * If this is None then the new process will use the same initial working\n@@ -171,7 +171,7 @@ impl Process {\n             Some(fd) => (None, fd)\n         };\n \n-        let res = spawn_process_os(prog, args, options.env, options.dir,\n+        let res = spawn_process_os(prog, args, options.env.clone(), options.dir,\n                                    in_fd, out_fd, err_fd);\n \n         unsafe {\n@@ -444,7 +444,7 @@ struct SpawnProcessResult {\n \n #[cfg(windows)]\n fn spawn_process_os(prog: &str, args: &[~str],\n-                    env: Option<&[(~str, ~str)]>,\n+                    env: Option<~[(~str, ~str)]>,\n                     dir: Option<&Path>,\n                     in_fd: c_int, out_fd: c_int, err_fd: c_int) -> SpawnProcessResult {\n \n@@ -627,7 +627,7 @@ pub fn make_command_line(prog: &str, args: &[~str]) -> ~str {\n \n #[cfg(unix)]\n fn spawn_process_os(prog: &str, args: &[~str],\n-                    env: Option<&[(~str, ~str)]>,\n+                    env: Option<~[(~str, ~str)]>,\n                     dir: Option<&Path>,\n                     in_fd: c_int, out_fd: c_int, err_fd: c_int) -> SpawnProcessResult {\n \n@@ -717,7 +717,7 @@ fn with_argv<T>(prog: &str, args: &[~str], cb: &fn(**libc::c_char) -> T) -> T {\n }\n \n #[cfg(unix)]\n-fn with_envp<T>(env: Option<&[(~str, ~str)]>, cb: &fn(*c_void) -> T) -> T {\n+fn with_envp<T>(env: Option<~[(~str, ~str)]>, cb: &fn(*c_void) -> T) -> T {\n     use vec;\n \n     // On posixy systems we can pass a char** for envp, which is a\n@@ -749,7 +749,7 @@ fn with_envp<T>(env: Option<&[(~str, ~str)]>, cb: &fn(*c_void) -> T) -> T {\n }\n \n #[cfg(windows)]\n-fn with_envp<T>(env: Option<&[(~str, ~str)]>, cb: &fn(*mut c_void) -> T) -> T {\n+fn with_envp<T>(env: Option<~[(~str, ~str)]>, cb: &fn(*mut c_void) -> T) -> T {\n     // On win32 we pass an \"environment block\" which is not a char**, but\n     // rather a concatenation of null-terminated k=v\\0 sequences, with a final\n     // \\0 to terminate.\n@@ -1284,22 +1284,22 @@ mod tests {\n     }\n \n     #[cfg(unix,not(target_os=\"android\"))]\n-    fn run_env(env: Option<&[(~str, ~str)]>) -> run::Process {\n+    fn run_env(env: Option<~[(~str, ~str)]>) -> run::Process {\n         run::Process::new(\"env\", [], run::ProcessOptions {\n             env: env,\n             .. run::ProcessOptions::new()\n         })\n     }\n     #[cfg(unix,target_os=\"android\")]\n-    fn run_env(env: Option<&[(~str, ~str)]>) -> run::Process {\n+    fn run_env(env: Option<~[(~str, ~str)]>) -> run::Process {\n         run::Process::new(\"/system/bin/sh\", [~\"-c\",~\"set\"], run::ProcessOptions {\n             env: env,\n             .. run::ProcessOptions::new()\n         })\n     }\n \n     #[cfg(windows)]\n-    fn run_env(env: Option<&[(~str, ~str)]>) -> run::Process {\n+    fn run_env(env: Option<~[(~str, ~str)]>) -> run::Process {\n         run::Process::new(\"cmd\", [~\"/c\", ~\"set\"], run::ProcessOptions {\n             env: env,\n             .. run::ProcessOptions::new()\n@@ -1344,7 +1344,7 @@ mod tests {\n         let mut new_env = os::env();\n         new_env.push((~\"RUN_TEST_NEW_ENV\", ~\"123\"));\n \n-        let mut prog = run_env(Some(new_env.slice(0, new_env.len())));\n+        let mut prog = run_env(Some(new_env));\n         let output = str::from_bytes(prog.finish_with_output().output);\n \n         assert!(output.contains(\"RUN_TEST_NEW_ENV=123\"));"}]}