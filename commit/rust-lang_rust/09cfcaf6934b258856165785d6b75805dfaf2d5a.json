{"sha": "09cfcaf6934b258856165785d6b75805dfaf2d5a", "node_id": "C_kwDOAAsO6NoAKDA5Y2ZjYWY2OTM0YjI1ODg1NjE2NTc4NWQ2Yjc1ODA1ZGZhZjJkNWE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-19T16:43:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-19T16:43:32Z"}, "message": "Auto merge of #10103 - Niki4tap:overflow_ice, r=flip1995\n\nFix overflow ICE in large_stack/const_arrays\n\nChange `maximum_allowed_size` config variable type from `u64` to `u128`, and converting total array sizes to `u128` to avoid overflow during multiplication.\n\nFixes #10044\n\nchangelog: Fix: [`large_const_arrays`] and [`large_stack_arrays`]: avoid integer overflow when calculating total array size\n#10103", "tree": {"sha": "1b08e11b9067b08ecc5c4110d986443f62e64041", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b08e11b9067b08ecc5c4110d986443f62e64041"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09cfcaf6934b258856165785d6b75805dfaf2d5a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09cfcaf6934b258856165785d6b75805dfaf2d5a", "html_url": "https://github.com/rust-lang/rust/commit/09cfcaf6934b258856165785d6b75805dfaf2d5a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09cfcaf6934b258856165785d6b75805dfaf2d5a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3145fea6a5c9f67cf8ac77f1c9ff9bb84b71c18", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3145fea6a5c9f67cf8ac77f1c9ff9bb84b71c18", "html_url": "https://github.com/rust-lang/rust/commit/b3145fea6a5c9f67cf8ac77f1c9ff9bb84b71c18"}, {"sha": "d0ac6ba0b17666431b4727345059c71cde281680", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0ac6ba0b17666431b4727345059c71cde281680", "html_url": "https://github.com/rust-lang/rust/commit/d0ac6ba0b17666431b4727345059c71cde281680"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "db637dfc068d4840775e6909519d8616ff38a19f", "filename": "clippy_lints/src/large_const_arrays.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Flarge_const_arrays.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Flarge_const_arrays.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flarge_const_arrays.rs?ref=09cfcaf6934b258856165785d6b75805dfaf2d5a", "patch": "@@ -34,12 +34,12 @@ declare_clippy_lint! {\n }\n \n pub struct LargeConstArrays {\n-    maximum_allowed_size: u64,\n+    maximum_allowed_size: u128,\n }\n \n impl LargeConstArrays {\n     #[must_use]\n-    pub fn new(maximum_allowed_size: u64) -> Self {\n+    pub fn new(maximum_allowed_size: u128) -> Self {\n         Self { maximum_allowed_size }\n     }\n }\n@@ -56,7 +56,7 @@ impl<'tcx> LateLintPass<'tcx> for LargeConstArrays {\n             if let ConstKind::Value(ty::ValTree::Leaf(element_count)) = cst.kind();\n             if let Ok(element_count) = element_count.try_to_machine_usize(cx.tcx);\n             if let Ok(element_size) = cx.layout_of(*element_type).map(|l| l.size.bytes());\n-            if self.maximum_allowed_size < element_count * element_size;\n+            if self.maximum_allowed_size < u128::from(element_count) * u128::from(element_size);\n \n             then {\n                 let hi_pos = item.ident.span.lo() - BytePos::from_usize(1);"}, {"sha": "89ae83d48f536795f9aecc0d0de69a353d043177", "filename": "clippy_lints/src/large_stack_arrays.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flarge_stack_arrays.rs?ref=09cfcaf6934b258856165785d6b75805dfaf2d5a", "patch": "@@ -24,12 +24,12 @@ declare_clippy_lint! {\n }\n \n pub struct LargeStackArrays {\n-    maximum_allowed_size: u64,\n+    maximum_allowed_size: u128,\n }\n \n impl LargeStackArrays {\n     #[must_use]\n-    pub fn new(maximum_allowed_size: u64) -> Self {\n+    pub fn new(maximum_allowed_size: u128) -> Self {\n         Self { maximum_allowed_size }\n     }\n }\n@@ -45,7 +45,7 @@ impl<'tcx> LateLintPass<'tcx> for LargeStackArrays {\n           && let Ok(element_size) = cx.layout_of(*element_type).map(|l| l.size.bytes())\n           && !cx.tcx.hir().parent_iter(expr.hir_id)\n               .any(|(_, node)| matches!(node, Node::Item(Item { kind: ItemKind::Static(..), .. })))\n-          && self.maximum_allowed_size < element_count * element_size {\n+          && self.maximum_allowed_size < u128::from(element_count) * u128::from(element_size) {\n               span_lint_and_help(\n                   cx,\n                   LARGE_STACK_ARRAYS,"}, {"sha": "c1589c771c462f6379ac9e3f16bfd0fb4b86fb08", "filename": "clippy_lints/src/utils/conf.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09cfcaf6934b258856165785d6b75805dfaf2d5a/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fconf.rs?ref=09cfcaf6934b258856165785d6b75805dfaf2d5a", "patch": "@@ -333,7 +333,7 @@ define_Conf! {\n     /// Lint: LARGE_STACK_ARRAYS, LARGE_CONST_ARRAYS.\n     ///\n     /// The maximum allowed size for arrays on the stack\n-    (array_size_threshold: u64 = 512_000),\n+    (array_size_threshold: u128 = 512_000),\n     /// Lint: VEC_BOX.\n     ///\n     /// The size of the boxed type in bytes, where boxing in a `Vec` is allowed"}, {"sha": "65f38fe71188e8384aca61f800cd02563a681f11", "filename": "tests/ui/crashes/ice-10044.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/09cfcaf6934b258856165785d6b75805dfaf2d5a/tests%2Fui%2Fcrashes%2Fice-10044.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09cfcaf6934b258856165785d6b75805dfaf2d5a/tests%2Fui%2Fcrashes%2Fice-10044.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-10044.rs?ref=09cfcaf6934b258856165785d6b75805dfaf2d5a", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    [0; usize::MAX];\n+}"}, {"sha": "731f8265ad6c9efa055d8722438cf242e6d77e97", "filename": "tests/ui/crashes/ice-10044.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/09cfcaf6934b258856165785d6b75805dfaf2d5a/tests%2Fui%2Fcrashes%2Fice-10044.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/09cfcaf6934b258856165785d6b75805dfaf2d5a/tests%2Fui%2Fcrashes%2Fice-10044.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-10044.stderr?ref=09cfcaf6934b258856165785d6b75805dfaf2d5a", "patch": "@@ -0,0 +1,10 @@\n+error: statement with no effect\n+  --> $DIR/ice-10044.rs:2:5\n+   |\n+LL |     [0; usize::MAX];\n+   |     ^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::no-effect` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}