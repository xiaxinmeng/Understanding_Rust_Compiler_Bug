{"sha": "ce36e88256f09078519f8bc6b21e4dc88f88f523", "node_id": "C_kwDOAAsO6NoAKGNlMzZlODgyNTZmMDkwNzg1MTlmOGJjNmIyMWU0ZGM4OGY4OGY1MjM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-28T18:31:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-28T18:31:08Z"}, "message": "Auto merge of #100497 - kadiwa4:remove_clone_into_iter, r=cjgillot\n\nAvoid cloning a collection only to iterate over it\n\n`@rustbot` label: +C-cleanup", "tree": {"sha": "be5fdfdcd24afdbc4510741b227587f9294efdc7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be5fdfdcd24afdbc4510741b227587f9294efdc7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce36e88256f09078519f8bc6b21e4dc88f88f523", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce36e88256f09078519f8bc6b21e4dc88f88f523", "html_url": "https://github.com/rust-lang/rust/commit/ce36e88256f09078519f8bc6b21e4dc88f88f523", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce36e88256f09078519f8bc6b21e4dc88f88f523/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "223d16ebbde1bd309c58e853b053e14318e56b0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/223d16ebbde1bd309c58e853b053e14318e56b0e", "html_url": "https://github.com/rust-lang/rust/commit/223d16ebbde1bd309c58e853b053e14318e56b0e"}, {"sha": "4eebcb9910c1180791b0e5dba5b3192d0e0046a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/4eebcb9910c1180791b0e5dba5b3192d0e0046a4", "html_url": "https://github.com/rust-lang/rust/commit/4eebcb9910c1180791b0e5dba5b3192d0e0046a4"}], "stats": {"total": 62, "additions": 31, "deletions": 31}, "files": [{"sha": "ecaafd0fc2652946fd2afb73a79b1d4592477b77", "filename": "compiler/rustc_builtin_macros/src/deriving/generic/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fderiving%2Fgeneric%2Fmod.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -383,8 +383,7 @@ fn find_type_parameters(\n         // Place bound generic params on a stack, to extract them when a type is encountered.\n         fn visit_poly_trait_ref(&mut self, trait_ref: &'a ast::PolyTraitRef) {\n             let stack_len = self.bound_generic_params_stack.len();\n-            self.bound_generic_params_stack\n-                .extend(trait_ref.bound_generic_params.clone().into_iter());\n+            self.bound_generic_params_stack.extend(trait_ref.bound_generic_params.iter().cloned());\n \n             visit::walk_poly_trait_ref(self, trait_ref);\n "}, {"sha": "b564f4ad92cff89cf28a5dcf03cadd4d33ce4c2d", "filename": "compiler/rustc_parse/src/parser/attr_wrapper.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr_wrapper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr_wrapper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr_wrapper.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -117,7 +117,7 @@ impl CreateTokenStream for LazyTokenStreamImpl {\n \n         if !self.replace_ranges.is_empty() {\n             let mut tokens: Vec<_> = tokens.collect();\n-            let mut replace_ranges = self.replace_ranges.clone();\n+            let mut replace_ranges = self.replace_ranges.to_vec();\n             replace_ranges.sort_by_key(|(range, _)| range.start);\n \n             #[cfg(debug_assertions)]\n@@ -147,7 +147,7 @@ impl CreateTokenStream for LazyTokenStreamImpl {\n             // start position, we ensure that any replace range which encloses\n             // another replace range will capture the *replaced* tokens for the inner\n             // range, not the original tokens.\n-            for (range, new_tokens) in replace_ranges.iter().rev() {\n+            for (range, new_tokens) in replace_ranges.into_iter().rev() {\n                 assert!(!range.is_empty(), \"Cannot replace an empty range: {:?}\", range);\n                 // Replace ranges are only allowed to decrease the number of tokens.\n                 assert!(\n@@ -166,7 +166,7 @@ impl CreateTokenStream for LazyTokenStreamImpl {\n \n                 tokens.splice(\n                     (range.start as usize)..(range.end as usize),\n-                    new_tokens.clone().into_iter().chain(filler),\n+                    new_tokens.into_iter().chain(filler),\n                 );\n             }\n             make_token_stream(tokens.into_iter(), self.break_last_token)\n@@ -322,7 +322,7 @@ impl<'a> Parser<'a> {\n             self.capture_state.replace_ranges[replace_ranges_start..replace_ranges_end]\n                 .iter()\n                 .cloned()\n-                .chain(inner_attr_replace_ranges.clone().into_iter())\n+                .chain(inner_attr_replace_ranges.iter().cloned())\n                 .map(|(range, tokens)| {\n                     ((range.start - start_calls)..(range.end - start_calls), tokens)\n                 })"}, {"sha": "f0ea1dfe297f2fb5c99da39460a21b693bc9c980", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -759,7 +759,7 @@ impl<'a> Parser<'a> {\n     /// This is to avoid losing unclosed delims errors `create_snapshot_for_diagnostic` clears.\n     pub(super) fn restore_snapshot(&mut self, snapshot: SnapshotParser<'a>) {\n         *self = snapshot.parser;\n-        self.unclosed_delims.extend(snapshot.unclosed_delims.clone());\n+        self.unclosed_delims.extend(snapshot.unclosed_delims);\n     }\n \n     pub fn unclosed_delims(&self) -> &[UnmatchedBrace] {"}, {"sha": "d41edea6a256f423fe03f88ee9ad6d160090fe5c", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -2350,7 +2350,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                         err.multipart_suggestion_verbose(\n                             message,\n                             std::iter::once((span, intro_sugg))\n-                                .chain(spans_suggs.clone())\n+                                .chain(spans_suggs.iter().cloned())\n                                 .collect(),\n                             Applicability::MaybeIncorrect,\n                         );"}, {"sha": "4bab99355012e0792b8e3135040db1be28f11032", "filename": "compiler/rustc_trait_selection/src/traits/auto_trait.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fauto_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fauto_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fauto_trait.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -341,7 +341,7 @@ impl<'tcx> AutoTraitFinder<'tcx> {\n                         }\n                     }\n \n-                    let obligations = impl_source.clone().nested_obligations().into_iter();\n+                    let obligations = impl_source.borrow_nested_obligations().iter().cloned();\n \n                     if !self.evaluate_nested_obligations(\n                         ty,"}, {"sha": "ad0da4bed4573caf03c716f585f6bd8968a34a3b", "filename": "compiler/rustc_typeck/src/astconv/generics.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -298,9 +298,8 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                                     // show that order to the user as a possible order for the parameters\n                                     let mut param_types_present = defs\n                                         .params\n-                                        .clone()\n-                                        .into_iter()\n-                                        .map(|param| (param.kind.to_ord(), param))\n+                                        .iter()\n+                                        .map(|param| (param.kind.to_ord(), param.clone()))\n                                         .collect::<Vec<(ParamKindOrd, GenericParamDef)>>();\n                                     param_types_present.sort_by_key(|(ord, _)| *ord);\n                                     let (mut param_types_present, ordered_params): ("}, {"sha": "0afc153300bf2449c381744a26b415ab3b8677e0", "filename": "compiler/rustc_typeck/src/check/upvar.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -1217,7 +1217,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n                 // Combine all the reasons of why the root variable should be captured as a result of\n                 // auto trait implementation issues\n-                auto_trait_migration_reasons.extend(capture_trait_reasons.clone());\n+                auto_trait_migration_reasons.extend(capture_trait_reasons.iter().copied());\n \n                 diagnostics_info.push(MigrationLintNote {\n                     captures_info,"}, {"sha": "756e4f3b127e1f93b6d78c2eb35aab0f0da41ca8", "filename": "src/librustdoc/clean/auto_trait.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fauto_trait.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -525,8 +525,8 @@ where\n                             GenericBound::TraitBound(ref mut p, _) => {\n                                 // Insert regions into the for_generics hash map first, to ensure\n                                 // that we don't end up with duplicate bounds (e.g., for<'b, 'b>)\n-                                for_generics.extend(p.generic_params.clone());\n-                                p.generic_params = for_generics.into_iter().collect();\n+                                for_generics.extend(p.generic_params.drain(..));\n+                                p.generic_params.extend(for_generics);\n                                 self.is_fn_trait(&p.trait_)\n                             }\n                             _ => false,"}, {"sha": "8eb9c07f8a7964d9440383c8519052fa6372c20a", "filename": "src/librustdoc/html/render/search_index.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fsearch_index.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -544,10 +544,15 @@ fn get_fn_inputs_and_outputs<'tcx>(\n             (true, _) => (Some(impl_self), &func.generics),\n             (_, true) => (Some(impl_self), impl_generics),\n             (false, false) => {\n-                let mut params = func.generics.params.clone();\n-                params.extend(impl_generics.params.clone());\n-                let mut where_predicates = func.generics.where_predicates.clone();\n-                where_predicates.extend(impl_generics.where_predicates.clone());\n+                let params =\n+                    func.generics.params.iter().chain(&impl_generics.params).cloned().collect();\n+                let where_predicates = func\n+                    .generics\n+                    .where_predicates\n+                    .iter()\n+                    .chain(&impl_generics.where_predicates)\n+                    .cloned()\n+                    .collect();\n                 combined_generics = clean::Generics { params, where_predicates };\n                 (Some(impl_self), &combined_generics)\n             }"}, {"sha": "b78f8f2b4f1092620b07bfa1f5e25ac259a0b3d7", "filename": "src/librustdoc/json/mod.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fjson%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Flibrustdoc%2Fjson%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fmod.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -106,7 +106,9 @@ impl<'tcx> JsonRenderer<'tcx> {\n                 // only need to synthesize items for external traits\n                 if !id.is_local() {\n                     let trait_item = &trait_item.trait_;\n-                    trait_item.items.clone().into_iter().for_each(|i| self.item(i).unwrap());\n+                    for item in &trait_item.items {\n+                        self.item(item.clone()).unwrap();\n+                    }\n                     let item_id = from_item_id(id.into(), self.tcx);\n                     Some((\n                         item_id.clone(),\n@@ -274,10 +276,9 @@ impl<'tcx> FormatRenderer<'tcx> for JsonRenderer<'tcx> {\n             paths: self\n                 .cache\n                 .paths\n-                .clone()\n-                .into_iter()\n-                .chain(self.cache.external_paths.clone().into_iter())\n-                .map(|(k, (path, kind))| {\n+                .iter()\n+                .chain(&self.cache.external_paths)\n+                .map(|(&k, &(ref path, kind))| {\n                     (\n                         from_item_id(k.into(), self.tcx),\n                         types::ItemSummary {"}, {"sha": "11d0798d553ad61172a55624507d2f80ae673bdb", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -1703,7 +1703,7 @@ impl<'test> TestCx<'test> {\n \n     fn compose_and_run_compiler(&self, mut rustc: Command, input: Option<String>) -> ProcRes {\n         let aux_dir = self.build_all_auxiliary(&mut rustc);\n-        self.props.unset_rustc_env.clone().iter().fold(&mut rustc, |rustc, v| rustc.env_remove(v));\n+        self.props.unset_rustc_env.iter().fold(&mut rustc, Command::env_remove);\n         rustc.envs(self.props.rustc_env.clone());\n         self.compose_and_run(\n             rustc,"}, {"sha": "13eed7b10997e3d0d60f2571cac36a7a00724971", "filename": "src/tools/unicode-table-generator/src/raw_emitter.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce36e88256f09078519f8bc6b21e4dc88f88f523/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs?ref=ce36e88256f09078519f8bc6b21e4dc88f88f523", "patch": "@@ -121,12 +121,8 @@ impl RawEmitter {\n         for chunk in compressed_words.chunks(chunk_length) {\n             chunks.insert(chunk);\n         }\n-        let chunk_map = chunks\n-            .clone()\n-            .into_iter()\n-            .enumerate()\n-            .map(|(idx, chunk)| (chunk, idx))\n-            .collect::<HashMap<_, _>>();\n+        let chunk_map =\n+            chunks.iter().enumerate().map(|(idx, &chunk)| (chunk, idx)).collect::<HashMap<_, _>>();\n         let mut chunk_indices = Vec::new();\n         for chunk in compressed_words.chunks(chunk_length) {\n             chunk_indices.push(chunk_map[chunk]);"}]}