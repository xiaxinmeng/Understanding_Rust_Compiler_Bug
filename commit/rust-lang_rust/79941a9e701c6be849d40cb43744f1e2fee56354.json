{"sha": "79941a9e701c6be849d40cb43744f1e2fee56354", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5OTQxYTllNzAxYzZiZTg0OWQ0MGNiNDM3NDRmMWUyZmVlNTYzNTQ=", "commit": {"author": {"name": "DJMcNab", "email": "36049421+DJMcNab@users.noreply.github.com", "date": "2018-12-31T11:08:44Z"}, "committer": {"name": "DJMcNab", "email": "36049421+DJMcNab@users.noreply.github.com", "date": "2018-12-31T11:08:44Z"}, "message": "Implement DocumentHighlight", "tree": {"sha": "9b2d5cad4d9284fdf949e5fb5a97559685b4de62", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b2d5cad4d9284fdf949e5fb5a97559685b4de62"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79941a9e701c6be849d40cb43744f1e2fee56354", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79941a9e701c6be849d40cb43744f1e2fee56354", "html_url": "https://github.com/rust-lang/rust/commit/79941a9e701c6be849d40cb43744f1e2fee56354", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79941a9e701c6be849d40cb43744f1e2fee56354/comments", "author": {"login": "DJMcNab", "id": 36049421, "node_id": "MDQ6VXNlcjM2MDQ5NDIx", "avatar_url": "https://avatars.githubusercontent.com/u/36049421?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DJMcNab", "html_url": "https://github.com/DJMcNab", "followers_url": "https://api.github.com/users/DJMcNab/followers", "following_url": "https://api.github.com/users/DJMcNab/following{/other_user}", "gists_url": "https://api.github.com/users/DJMcNab/gists{/gist_id}", "starred_url": "https://api.github.com/users/DJMcNab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DJMcNab/subscriptions", "organizations_url": "https://api.github.com/users/DJMcNab/orgs", "repos_url": "https://api.github.com/users/DJMcNab/repos", "events_url": "https://api.github.com/users/DJMcNab/events{/privacy}", "received_events_url": "https://api.github.com/users/DJMcNab/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DJMcNab", "id": 36049421, "node_id": "MDQ6VXNlcjM2MDQ5NDIx", "avatar_url": "https://avatars.githubusercontent.com/u/36049421?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DJMcNab", "html_url": "https://github.com/DJMcNab", "followers_url": "https://api.github.com/users/DJMcNab/followers", "following_url": "https://api.github.com/users/DJMcNab/following{/other_user}", "gists_url": "https://api.github.com/users/DJMcNab/gists{/gist_id}", "starred_url": "https://api.github.com/users/DJMcNab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DJMcNab/subscriptions", "organizations_url": "https://api.github.com/users/DJMcNab/orgs", "repos_url": "https://api.github.com/users/DJMcNab/repos", "events_url": "https://api.github.com/users/DJMcNab/events{/privacy}", "received_events_url": "https://api.github.com/users/DJMcNab/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9b58454a43274d3b1d4d0e74cdef597b75f9a97", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9b58454a43274d3b1d4d0e74cdef597b75f9a97", "html_url": "https://github.com/rust-lang/rust/commit/f9b58454a43274d3b1d4d0e74cdef597b75f9a97"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "a74f9f27b63f8733f738c8fcd97516299d9a12a1", "filename": "crates/ra_lsp_server/src/caps.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fcaps.rs?ref=79941a9e701c6be849d40cb43744f1e2fee56354", "patch": "@@ -28,7 +28,7 @@ pub fn server_capabilities() -> ServerCapabilities {\n         type_definition_provider: None,\n         implementation_provider: None,\n         references_provider: Some(true),\n-        document_highlight_provider: None,\n+        document_highlight_provider: Some(true),\n         document_symbol_provider: Some(true),\n         workspace_symbol_provider: Some(true),\n         code_action_provider: Some(CodeActionProviderCapability::Simple(true)),"}, {"sha": "46b48830de5d8246f9667a4a990c44ec558002e4", "filename": "crates/ra_lsp_server/src/main_loop.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs?ref=79941a9e701c6be849d40cb43744f1e2fee56354", "patch": "@@ -300,6 +300,7 @@ fn on_request(\n         .on::<req::Rename>(handlers::handle_rename)?\n         .on::<req::References>(handlers::handle_references)?\n         .on::<req::Formatting>(handlers::handle_formatting)?\n+        .on::<req::DocumentHighlightRequest>(handlers::handle_document_highlight)?\n         .finish();\n     match req {\n         Ok(id) => {"}, {"sha": "60441e8ea4745c2c9b77659d825e41de7305c30e", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79941a9e701c6be849d40cb43744f1e2fee56354/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=79941a9e701c6be849d40cb43744f1e2fee56354", "patch": "@@ -6,9 +6,8 @@ use languageserver_types::{\n     DiagnosticSeverity, DocumentSymbol, Documentation, FoldingRange, FoldingRangeKind,\n     FoldingRangeParams, Location, MarkupContent, MarkupKind, MarkedString, Position,\n     PrepareRenameResponse, RenameParams, SymbolInformation, TextDocumentIdentifier, TextEdit,\n-    Range,\n-    WorkspaceEdit, ParameterInformation, ParameterLabel, SignatureInformation, Hover, HoverContents,\n-    DocumentFormattingParams,\n+    Range, WorkspaceEdit, ParameterInformation, ParameterLabel, SignatureInformation, Hover,\n+    HoverContents, DocumentFormattingParams, DocumentHighlight,\n };\n use ra_analysis::{FileId, FoldKind, Query, RunnableKind, FileRange, FilePosition, Severity};\n use ra_syntax::{TextUnit, text_utils::intersect};\n@@ -673,6 +672,28 @@ pub fn handle_code_action(\n     Ok(Some(CodeActionResponse::Commands(res)))\n }\n \n+pub fn handle_document_highlight(\n+    world: ServerWorld,\n+    params: req::TextDocumentPositionParams,\n+) -> Result<Option<Vec<DocumentHighlight>>> {\n+    let file_id = params.text_document.try_conv_with(&world)?;\n+    let line_index = world.analysis().file_line_index(file_id);\n+    let offset = params.position.conv_with(&line_index);\n+\n+    let refs = world\n+        .analysis()\n+        .find_all_refs(FilePosition { file_id, offset })?;\n+\n+    Ok(Some(\n+        refs.into_iter()\n+            .map(|r| DocumentHighlight {\n+                range: r.1.conv_with(&line_index),\n+                kind: None,\n+            })\n+            .collect(),\n+    ))\n+}\n+\n pub fn publish_diagnostics(\n     world: &ServerWorld,\n     file_id: FileId,"}]}