{"sha": "c6316df19f14702a16c7be3685547def9ff21b21", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2MzE2ZGYxOWYxNDcwMmExNmM3YmUzNjg1NTQ3ZGVmOWZmMjFiMjE=", "commit": {"author": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-03-10T17:13:49Z"}, "committer": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-03-11T13:18:56Z"}, "message": "Rustup to 1.9.0-nightly (c9629d61c 2016-03-10)", "tree": {"sha": "c9dfba344931920122f2a781a572d9ae7e1d6899", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c9dfba344931920122f2a781a572d9ae7e1d6899"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6316df19f14702a16c7be3685547def9ff21b21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6316df19f14702a16c7be3685547def9ff21b21", "html_url": "https://github.com/rust-lang/rust/commit/c6316df19f14702a16c7be3685547def9ff21b21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6316df19f14702a16c7be3685547def9ff21b21/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "233000da3d0bf4b8887ef3031cade4eae7cc8498", "url": "https://api.github.com/repos/rust-lang/rust/commits/233000da3d0bf4b8887ef3031cade4eae7cc8498", "html_url": "https://github.com/rust-lang/rust/commit/233000da3d0bf4b8887ef3031cade4eae7cc8498"}], "stats": {"total": 70, "additions": 40, "deletions": 30}, "files": [{"sha": "bc13576fe3bc139beaaa0da17df963f74fea68e1", "filename": "src/cyclomatic_complexity.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fcyclomatic_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fcyclomatic_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcyclomatic_complexity.rs?ref=c6316df19f14702a16c7be3685547def9ff21b21", "patch": "@@ -124,13 +124,14 @@ impl<'a, 'b, 'tcx> Visitor<'a> for CCHelper<'b, 'tcx> {\n             ExprCall(ref callee, _) => {\n                 walk_expr(self, e);\n                 let ty = self.tcx.node_id_to_type(callee.id);\n-                if let ty::TyBareFn(_, ty) = ty.sty {\n-                    if ty.sig.skip_binder().output.diverges() {\n+                match ty.sty {\n+                    ty::TyFnDef(_, _, ty) | ty::TyFnPtr(ty) if ty.sig.skip_binder().output.diverges() => {\n                         self.divergence += 1;\n                     }\n+                    _ => (),\n                 }\n             }\n-            ExprClosure(..) => {}\n+            ExprClosure(..) => (),\n             ExprBinary(op, _, _) => {\n                 walk_expr(self, e);\n                 match op.node {"}, {"sha": "380ff0a30f9270bc70be205c0531afef6fbd26ce", "filename": "src/derive.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fderive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fderive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fderive.rs?ref=c6316df19f14702a16c7be3685547def9ff21b21", "patch": "@@ -155,7 +155,7 @@ fn check_copy_clone<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, item: &Item, trait_ref\n                             TypeVariants::TyArray(_, size) if size > 32 => {\n                                 return;\n                             }\n-                            TypeVariants::TyBareFn(..) => {\n+                            TypeVariants::TyFnPtr(..) => {\n                                 return;\n                             }\n                             TypeVariants::TyTuple(ref tys) if tys.len() > 12 => {"}, {"sha": "6335f3f13980d5250bb2020c8433dc4125254a97", "filename": "src/eta_reduction.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c6316df19f14702a16c7be3685547def9ff21b21/src%2Feta_reduction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6316df19f14702a16c7be3685547def9ff21b21/src%2Feta_reduction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Feta_reduction.rs?ref=c6316df19f14702a16c7be3685547def9ff21b21", "patch": "@@ -58,11 +58,14 @@ fn check_closure(cx: &LateContext, expr: &Expr) {\n                     return;\n                 }\n                 let fn_ty = cx.tcx.expr_ty(caller);\n-                if let ty::TyBareFn(_, fn_ty) = fn_ty.sty {\n+                match fn_ty.sty {\n                     // Is it an unsafe function? They don't implement the closure traits\n-                    if fn_ty.unsafety == Unsafety::Unsafe {\n-                        return;\n+                    ty::TyFnDef(_, _, fn_ty) | ty::TyFnPtr(fn_ty) => {\n+                        if fn_ty.unsafety == Unsafety::Unsafe {\n+                            return;\n+                        }\n                     }\n+                    _ => (),\n                 }\n                 for (ref a1, ref a2) in decl.inputs.iter().zip(args) {\n                     if let PatKind::Ident(_, ident, _) = a1.pat.node {"}, {"sha": "707ce8efaeb50917aec61390ac67cbe43c9c0341", "filename": "src/mut_reference.rs", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fmut_reference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6316df19f14702a16c7be3685547def9ff21b21/src%2Fmut_reference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmut_reference.rs?ref=c6316df19f14702a16c7be3685547def9ff21b21", "patch": "@@ -53,21 +53,24 @@ impl LateLintPass for UnnecessaryMutPassed {\n }\n \n fn check_arguments(cx: &LateContext, arguments: &[P<Expr>], type_definition: &TyS, name: &str) {\n-    if let TypeVariants::TyBareFn(_, ref fn_type) = type_definition.sty {\n-        let parameters = &fn_type.sig.skip_binder().inputs;\n-        for (argument, parameter) in arguments.iter().zip(parameters.iter()) {\n-            match parameter.sty {\n-                TypeVariants::TyRef(_, TypeAndMut {mutbl: MutImmutable, ..}) |\n-                TypeVariants::TyRawPtr(TypeAndMut {mutbl: MutImmutable, ..}) => {\n-                    if let ExprAddrOf(MutMutable, _) = argument.node {\n-                        span_lint(cx,\n-                                  UNNECESSARY_MUT_PASSED,\n-                                  argument.span,\n-                                  &format!(\"The function/method \\\"{}\\\" doesn't need a mutable reference\", name));\n+    match type_definition.sty {\n+        TypeVariants::TyFnDef(_, _, ref fn_type) | TypeVariants::TyFnPtr(ref fn_type) => {\n+            let parameters = &fn_type.sig.skip_binder().inputs;\n+            for (argument, parameter) in arguments.iter().zip(parameters.iter()) {\n+                match parameter.sty {\n+                    TypeVariants::TyRef(_, TypeAndMut {mutbl: MutImmutable, ..}) |\n+                    TypeVariants::TyRawPtr(TypeAndMut {mutbl: MutImmutable, ..}) => {\n+                        if let ExprAddrOf(MutMutable, _) = argument.node {\n+                            span_lint(cx,\n+                                      UNNECESSARY_MUT_PASSED,\n+                                      argument.span,\n+                                      &format!(\"The function/method \\\"{}\\\" doesn't need a mutable reference\", name));\n+                        }\n                     }\n+                    _ => {}\n                 }\n-                _ => {}\n             }\n         }\n+        _ => (),\n     }\n }"}, {"sha": "1d81ed14e4edce3791a3368090cfed1c761b7129", "filename": "tests/compile-fail/mut_reference.rs", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/c6316df19f14702a16c7be3685547def9ff21b21/tests%2Fcompile-fail%2Fmut_reference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6316df19f14702a16c7be3685547def9ff21b21/tests%2Fcompile-fail%2Fmut_reference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fmut_reference.rs?ref=c6316df19f14702a16c7be3685547def9ff21b21", "patch": "@@ -3,12 +3,8 @@\n \n #![allow(unused_variables)]\n \n-fn takes_an_immutable_reference(a: &i32) {\n-}\n-\n-\n-fn takes_a_mutable_reference(a: &mut i32) {\n-}\n+fn takes_an_immutable_reference(a: &i32) {}\n+fn takes_a_mutable_reference(a: &mut i32) {}\n \n struct MyStruct;\n \n@@ -24,23 +20,30 @@ impl MyStruct {\n fn main() {\n     // Functions\n     takes_an_immutable_reference(&mut 42); //~ERROR The function/method \"takes_an_immutable_reference\" doesn't need a mutable reference\n-    \n+    let foo: fn(&i32) = takes_an_immutable_reference;\n+    foo(&mut 42); //~ERROR The function/method \"foo\" doesn't need a mutable reference\n+\n     // Methods\n     let my_struct = MyStruct;\n     my_struct.takes_an_immutable_reference(&mut 42); //~ERROR The function/method \"takes_an_immutable_reference\" doesn't need a mutable reference\n-    \n+\n \n     // No error\n-    \n+\n     // Functions\n     takes_an_immutable_reference(&42);\n+    let foo: fn(&i32) = takes_an_immutable_reference;\n+    foo(&42);\n+\n     takes_a_mutable_reference(&mut 42);\n+    let foo: fn(&mut i32) = takes_a_mutable_reference;\n+    foo(&mut 42);\n+\n     let a = &mut 42;\n     takes_an_immutable_reference(a);\n-    \n+\n     // Methods\n     my_struct.takes_an_immutable_reference(&42);\n     my_struct.takes_a_mutable_reference(&mut 42);\n     my_struct.takes_an_immutable_reference(a);\n-    \n }"}]}