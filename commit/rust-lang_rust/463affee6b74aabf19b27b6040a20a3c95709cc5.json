{"sha": "463affee6b74aabf19b27b6040a20a3c95709cc5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2M2FmZmVlNmI3NGFhYmYxOWIyN2I2MDQwYTIwYTNjOTU3MDljYzU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-27T12:23:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-01-27T12:23:23Z"}, "message": "Auto merge of #39282 - petrochenkov:selfstab, r=nikomatsakis\n\nStabilize Self and associated types in struct expressions and patterns\n\nRebase of https://github.com/rust-lang/rust/pull/37734\nCloses https://github.com/rust-lang/rust/issues/37544\nr? @nikomatsakis", "tree": {"sha": "897512b623d3a3e02e15a5df667a13f7278161ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/897512b623d3a3e02e15a5df667a13f7278161ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/463affee6b74aabf19b27b6040a20a3c95709cc5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/463affee6b74aabf19b27b6040a20a3c95709cc5", "html_url": "https://github.com/rust-lang/rust/commit/463affee6b74aabf19b27b6040a20a3c95709cc5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/463affee6b74aabf19b27b6040a20a3c95709cc5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8367fb7ba6abae89ab7e17c1b3987ee321f5bb71", "url": "https://api.github.com/repos/rust-lang/rust/commits/8367fb7ba6abae89ab7e17c1b3987ee321f5bb71", "html_url": "https://github.com/rust-lang/rust/commit/8367fb7ba6abae89ab7e17c1b3987ee321f5bb71"}, {"sha": "5056a43752a34ec633fb71ff395f518bfc7ce52c", "url": "https://api.github.com/repos/rust-lang/rust/commits/5056a43752a34ec633fb71ff395f518bfc7ce52c", "html_url": "https://github.com/rust-lang/rust/commit/5056a43752a34ec633fb71ff395f518bfc7ce52c"}], "stats": {"total": 57, "additions": 2, "deletions": 55}, "files": [{"sha": "20c4f8f95224d1328baccd522949a04267a9abaf", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -3306,16 +3306,6 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             }\n             Def::Struct(..) | Def::Union(..) | Def::TyAlias(..) |\n             Def::AssociatedTy(..) | Def::SelfTy(..) => {\n-                match def {\n-                    Def::AssociatedTy(..) | Def::SelfTy(..)\n-                            if !self.tcx.sess.features.borrow().more_struct_aliases => {\n-                        emit_feature_err(&self.tcx.sess.parse_sess,\n-                                         \"more_struct_aliases\", path_span, GateIssue::Language,\n-                                         \"`Self` and associated types in struct \\\n-                                          expressions and patterns are unstable\");\n-                    }\n-                    _ => {}\n-                }\n                 match ty.sty {\n                     ty::TyAdt(adt, substs) if !adt.is_enum() => {\n                         Some((adt.struct_variant(), adt.did, substs))"}, {"sha": "112211851ec0505600528aea7bc457059a486b63", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -297,10 +297,6 @@ declare_features! (\n     // The #![windows_subsystem] attribute\n     (active, windows_subsystem, \"1.14.0\", Some(37499)),\n \n-    // Allows using `Self` and associated types in struct expressions and patterns.\n-    (active, more_struct_aliases, \"1.14.0\", Some(37544)),\n-\n-\n     // Allows #[link(..., cfg(..))]\n     (active, link_cfg, \"1.14.0\", Some(37406)),\n \n@@ -381,6 +377,8 @@ declare_features! (\n     // Allows `..` in tuple (struct) patterns\n     (accepted, dotdot_in_tuple_patterns, \"1.14.0\", Some(33627)),\n     (accepted, item_like_imports, \"1.14.0\", Some(35120)),\n+    // Allows using `Self` and associated types in struct expressions and patterns.\n+    (accepted, more_struct_aliases, \"1.14.0\", Some(37544)),\n );\n // (changing above list without updating src/doc/reference.md makes @cmr sad)\n "}, {"sha": "660ac44ce0b53c07130fa71b89f73afac155d9d7", "filename": "src/test/compile-fail/struct-path-associated-type.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(more_struct_aliases)]\n-\n struct S;\n \n trait Tr {"}, {"sha": "c40d0574955919351ab47a6747376751514b7997", "filename": "src/test/compile-fail/struct-path-self-feature-gate.rs", "status": "removed", "additions": 0, "deletions": 31, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/8367fb7ba6abae89ab7e17c1b3987ee321f5bb71/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8367fb7ba6abae89ab7e17c1b3987ee321f5bb71/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs?ref=8367fb7ba6abae89ab7e17c1b3987ee321f5bb71", "patch": "@@ -1,31 +0,0 @@\n-// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-// gate-test-more_struct_aliases\n-\n-struct S;\n-\n-trait Tr {\n-    type A;\n-}\n-\n-fn f<T: Tr<A = S>>() {\n-    let _ = T::A {};\n-    //~^ ERROR `Self` and associated types in struct expressions and patterns are unstable\n-}\n-\n-impl S {\n-    fn f() {\n-        let _ = Self {};\n-        //~^ ERROR `Self` and associated types in struct expressions and patterns are unstable\n-    }\n-}\n-\n-fn main() {}"}, {"sha": "f694e7d277c7fec094e70b30b191f17605845340", "filename": "src/test/compile-fail/struct-path-self-type-mismatch.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(more_struct_aliases)]\n-\n struct Foo<A> { inner: A }\n \n trait Bar { fn bar(); }"}, {"sha": "067d6ac22dc6fb35a3a7e06fdb98c6be84487de7", "filename": "src/test/compile-fail/struct-path-self.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(more_struct_aliases)]\n-\n struct S;\n \n trait Tr {"}, {"sha": "b033ed5c802100f51c53096bbccdb43e5c00d84a", "filename": "src/test/run-pass/struct-path-associated-type.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(more_struct_aliases)]\n-\n struct S<T, U = u16> {\n     a: T,\n     b: U,"}, {"sha": "c7a282c2a2fa02c289cfdf87028c4439ff57b45f", "filename": "src/test/run-pass/struct-path-self.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/463affee6b74aabf19b27b6040a20a3c95709cc5/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs?ref=463affee6b74aabf19b27b6040a20a3c95709cc5", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(more_struct_aliases)]\n-\n use std::ops::Add;\n \n struct S<T, U = u16> {"}]}