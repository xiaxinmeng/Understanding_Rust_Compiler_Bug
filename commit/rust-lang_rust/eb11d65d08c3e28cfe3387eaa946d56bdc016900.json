{"sha": "eb11d65d08c3e28cfe3387eaa946d56bdc016900", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViMTFkNjVkMDhjM2UyOGNmZTMzODdlYWE5NDZkNTZiZGMwMTY5MDA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-08-04T19:37:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-08-04T19:37:50Z"}, "message": "Auto merge of #27515 - Eljay:rustdoc-search, r=alexcrichton\n\nSome small changes to (hopefully) make search more useful:\r\n\r\n* Less strict filtering, e.g:\r\n    * searching for \"fn: foo\" now matches methods and trait functions as well.\r\n    * searching for types also matches primitive types.\r\n    * searching for const will also match associated constants (but there aren't any in std yet)\r\n* Changed searching for types to use the actual keyword \"type\" instead of the strange C-like \"typedef\".\r\n* Added const and macro to allowed keywords.", "tree": {"sha": "25327531fda116bb94693eda878848db2f3f0d6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25327531fda116bb94693eda878848db2f3f0d6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb11d65d08c3e28cfe3387eaa946d56bdc016900", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb11d65d08c3e28cfe3387eaa946d56bdc016900", "html_url": "https://github.com/rust-lang/rust/commit/eb11d65d08c3e28cfe3387eaa946d56bdc016900", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb11d65d08c3e28cfe3387eaa946d56bdc016900/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c980aba9a88704717229da3c1ec02685333c0db2", "url": "https://api.github.com/repos/rust-lang/rust/commits/c980aba9a88704717229da3c1ec02685333c0db2", "html_url": "https://github.com/rust-lang/rust/commit/c980aba9a88704717229da3c1ec02685333c0db2"}, {"sha": "acf9d6768e93bbffce7e57de647042af7d40b33d", "url": "https://api.github.com/repos/rust-lang/rust/commits/acf9d6768e93bbffce7e57de647042af7d40b33d", "html_url": "https://github.com/rust-lang/rust/commit/acf9d6768e93bbffce7e57de647042af7d40b33d"}], "stats": {"total": 38, "additions": 29, "deletions": 9}, "files": [{"sha": "51dc8c6e4771373eeaa340927988f809ec1932a7", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb11d65d08c3e28cfe3387eaa946d56bdc016900/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb11d65d08c3e28cfe3387eaa946d56bdc016900/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=eb11d65d08c3e28cfe3387eaa946d56bdc016900", "patch": "@@ -113,8 +113,8 @@ r##\"<!DOCTYPE html>\n                 <p>\n                     Accepted types are: <code>fn</code>, <code>mod</code>,\n                     <code>struct</code>, <code>enum</code>,\n-                    <code>trait</code>, <code>typedef</code> (or\n-                    <code>tdef</code>).\n+                    <code>trait</code>, <code>type</code>, <code>macro</code>,\n+                    and <code>const</code>.\n                 </p>\n \n                 <p>"}, {"sha": "f1351893915fa3440b4b38a6cfee08063ab02268", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/eb11d65d08c3e28cfe3387eaa946d56bdc016900/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/eb11d65d08c3e28cfe3387eaa946d56bdc016900/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=eb11d65d08c3e28cfe3387eaa946d56bdc016900", "patch": "@@ -230,6 +230,28 @@\n                 }\n             }\n \n+            function typePassesFilter(filter, type) {\n+                // No filter\n+                if (filter < 0) return true;\n+\n+                // Exact match\n+                if (filter === type) return true;\n+\n+                // Match related items\n+                var name = itemTypes[type];\n+                switch (itemTypes[filter]) {\n+                    case \"constant\":\n+                        return (name == \"associatedconstant\");\n+                    case \"fn\":\n+                        return (name == \"method\" || name == \"tymethod\");\n+                    case \"type\":\n+                        return (name == \"primitive\");\n+                }\n+\n+                // No match\n+                return false;\n+            }\n+\n             // quoted values mean literal search\n             var nSearchWords = searchWords.length;\n             if ((val.charAt(0) === \"\\\"\" || val.charAt(0) === \"'\") &&\n@@ -239,7 +261,7 @@\n                 for (var i = 0; i < nSearchWords; ++i) {\n                     if (searchWords[i] === val) {\n                         // filter type: ... queries\n-                        if (typeFilter < 0 || typeFilter === searchIndex[i].ty) {\n+                        if (typePassesFilter(typeFilter, searchIndex[i].ty)) {\n                             results.push({id: i, index: -1});\n                         }\n                     }\n@@ -285,7 +307,7 @@\n                             searchWords[j].replace(/_/g, \"\").indexOf(val) > -1)\n                         {\n                             // filter type: ... queries\n-                            if (typeFilter < 0 || typeFilter === searchIndex[j].ty) {\n+                            if (typePassesFilter(typeFilter, searchIndex[j].ty)) {\n                                 results.push({\n                                     id: j,\n                                     index: searchWords[j].replace(/_/g, \"\").indexOf(val),\n@@ -295,7 +317,7 @@\n                         } else if (\n                             (lev_distance = levenshtein(searchWords[j], val)) <=\n                                 MAX_LEV_DISTANCE) {\n-                            if (typeFilter < 0 || typeFilter === searchIndex[j].ty) {\n+                            if (typePassesFilter(typeFilter, searchIndex[j].ty)) {\n                                 results.push({\n                                     id: j,\n                                     index: 0,\n@@ -451,11 +473,9 @@\n             var matches, type, query, raw = $('.search-input').val();\n             query = raw;\n \n-            matches = query.match(/^(fn|mod|struct|enum|trait|t(ype)?d(ef)?)\\s*:\\s*/i);\n+            matches = query.match(/^(fn|mod|struct|enum|trait|type|const|macro)\\s*:\\s*/i);\n             if (matches) {\n-                type = matches[1].replace(/^td$/, 'typedef')\n-                                 .replace(/^tdef$/, 'typedef')\n-                                 .replace(/^typed$/, 'typedef');\n+                type = matches[1].replace(/^const$/, 'constant');\n                 query = query.substring(matches[0].length);\n             }\n "}]}