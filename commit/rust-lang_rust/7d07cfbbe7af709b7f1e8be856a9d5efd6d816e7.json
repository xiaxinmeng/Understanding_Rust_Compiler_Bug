{"sha": "7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkMDdjZmJiZTdhZjcwOWI3ZjFlOGJlODU2YTlkNWVmZDZkODE2ZTc=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-06-07T06:21:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-07T06:21:02Z"}, "message": "Rollup merge of #85996 - jyn514:library-changes, r=Mark-Simulacrum\n\nrustbuild: take changes to the standard library into account for `download-rustc`\n\nPreviously, changing the standard library with `download-rustc =\n\"if-unchanged\"` would incorrectly reuse the cached compiler and standard\nlibrary from CI, which was confusing and led to incorrect test failures\nor successes.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "4efa29e7cf8df09a2ec0df76e3fd748d49d32244", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4efa29e7cf8df09a2ec0df76e3fd748d49d32244"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgvbrOCRBK7hj4Ov3rIwAA9igIABfhyS2Jog6MmyPYnhDgQSVE\nksIv4s/BFrb8/n6+8XCjnV1w5OOuMvSbV4e9wXZhX6CTqUwOtqrf7+SqBHeW8GH8\nk41ZttNS64jgo3DEgi4WqFVPiVHurmgox3xS0Lgqpzw0QFAO55py7KEzTivtTqdx\nvrXDl+Tbht5rBFdlhgqiJSDdNIrATAfcMmQmL82EOeIjpbOCBfHJX6clmatiW528\nGMrtRtmR0KPsANYwkRsKEqGaEFHvFDwav2Cs9eX8N0Ou5se8Sour0g8yWRKEj0sz\nMIsjwlFGUWIS9D78fSmXWAFdvz1MAmvUnFCEpwWLeEmcG3anRh4TYC8v0m0AIwU=\n=lHRf\n-----END PGP SIGNATURE-----\n", "payload": "tree 4efa29e7cf8df09a2ec0df76e3fd748d49d32244\nparent 7fcfe0568042467c57129a3a82d42e09719c439c\nparent 261d16a367b05dbc1fcfb31d85f69997853b37c8\nauthor Yuki Okushi <jtitor@2k36.org> 1623046862 +0900\ncommitter GitHub <noreply@github.com> 1623046862 +0900\n\nRollup merge of #85996 - jyn514:library-changes, r=Mark-Simulacrum\n\nrustbuild: take changes to the standard library into account for `download-rustc`\n\nPreviously, changing the standard library with `download-rustc =\n\"if-unchanged\"` would incorrectly reuse the cached compiler and standard\nlibrary from CI, which was confusing and led to incorrect test failures\nor successes.\n\nr? `@Mark-Simulacrum`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7", "html_url": "https://github.com/rust-lang/rust/commit/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7fcfe0568042467c57129a3a82d42e09719c439c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7fcfe0568042467c57129a3a82d42e09719c439c", "html_url": "https://github.com/rust-lang/rust/commit/7fcfe0568042467c57129a3a82d42e09719c439c"}, {"sha": "261d16a367b05dbc1fcfb31d85f69997853b37c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/261d16a367b05dbc1fcfb31d85f69997853b37c8", "html_url": "https://github.com/rust-lang/rust/commit/261d16a367b05dbc1fcfb31d85f69997853b37c8"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "7c7f162b82c04b43c586df3849d552d32471764a", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=7d07cfbbe7af709b7f1e8be856a9d5efd6d816e7", "patch": "@@ -648,18 +648,20 @@ def maybe_download_ci_toolchain(self):\n         rev_parse = [\"git\", \"rev-parse\", \"--show-toplevel\"]\n         top_level = subprocess.check_output(rev_parse, universal_newlines=True).strip()\n         compiler = \"{}/compiler/\".format(top_level)\n+        library = \"{}/library/\".format(top_level)\n \n         # Look for a version to compare to based on the current commit.\n         # Only commits merged by bors will have CI artifacts.\n         merge_base = [\"git\", \"log\", \"--author=bors\", \"--pretty=%H\", \"-n1\"]\n         commit = subprocess.check_output(merge_base, universal_newlines=True).strip()\n \n-        # Warn if there were changes to the compiler since the ancestor commit.\n-        status = subprocess.call([\"git\", \"diff-index\", \"--quiet\", commit, \"--\", compiler])\n+        # Warn if there were changes to the compiler or standard library since the ancestor commit.\n+        status = subprocess.call([\"git\", \"diff-index\", \"--quiet\", commit, \"--\", compiler, library])\n         if status != 0:\n             if download_rustc == \"if-unchanged\":\n                 return None\n-            print(\"warning: `download-rustc` is enabled, but there are changes to compiler/\")\n+            print(\"warning: `download-rustc` is enabled, but there are changes to \\\n+                   compiler/ or library/\")\n \n         if self.verbose:\n             print(\"using downloaded stage1 artifacts from CI (commit {})\".format(commit))"}]}