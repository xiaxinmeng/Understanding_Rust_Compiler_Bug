{"sha": "1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "node_id": "C_kwDOAAsO6NoAKDFjOWFkMjhkZDJkNTI4NGRkZGJiZGZkOTk1MzlmMGYyYTk4YThmMGY", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-03-22T17:04:20Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-03-22T17:06:22Z"}, "message": "Do not feed param_env for RPITITs impl side", "tree": {"sha": "98318f2657a1109b0427e17f636096fbd55cc6d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98318f2657a1109b0427e17f636096fbd55cc6d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmQbNY4ACgkQgTGiTgx5\n76+P6A//Tek2UmPCiQvZRYGl/8Y+9HQ4vieqXB7MLYDwaK4RsGFbydBqjVbus0Jc\nhw0hpgEUWhzsdn3Cpa6cGLdBVlAUENC98NO34kBRqW6U5nqcb5qDf3kugR92BoZR\n2d4aZDRNbssKlMxlcD7Vs+Qyg+vSLC5HbTzdKSEsEm+1s7a2BEQCDfAYzIkk1Ott\n3LlOrzYzKNIoxEqZU4HdSjwjY4jqnRkx99uCyZjMhItDrc+13gDkZUbJHq72bGnW\nQzZHB+VBCKcHUGkC1JcSaNuayWmXLFWk4kZhTybx2abICgbJPJdIDL3eg3cla9HY\ndSHx/lUAWCmYoQ3BKbxGFL9rXVuyaHZ0ABBt4AlR/1OuIsAsWfExzfbri0JqEW+y\nzZkqnpntc5tqnCA83B1lXZs97Z0tVeFVqOi8Tzc1WkX6TeY8JS+aZH7ftYPAQIW0\n5QQFapmE+fS+XaqnF9L2SoUciqQRT0u7gDTtcE2H1hU+SF/ZR1K9JaOv9/4armlZ\nxxotc2TWke4gd5HG6wzhhBsASgDDzIQzMJalx0o8joSUQPWHM2wlnI9ksDoaOSOV\nZGLTZBctKlg0xSsE1vLIBsHjDo1d/1WdsZHXIZ00+8IVmCAA+lfINdI6yvSYZQO0\nZCWPICIqB14PZG4HMVJp6/Q6WMVFmcJURIgqfMdvVQJoqlTfAqA=\n=t0uE\n-----END PGP SIGNATURE-----", "payload": "tree 98318f2657a1109b0427e17f636096fbd55cc6d2\nparent 439292bc7913399e406d9bb7e8da0f70c6317c6e\nauthor Santiago Pastorino <spastorino@gmail.com> 1679504660 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1679504782 -0300\n\nDo not feed param_env for RPITITs impl side\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "html_url": "https://github.com/rust-lang/rust/commit/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "439292bc7913399e406d9bb7e8da0f70c6317c6e", "url": "https://api.github.com/repos/rust-lang/rust/commits/439292bc7913399e406d9bb7e8da0f70c6317c6e", "html_url": "https://github.com/rust-lang/rust/commit/439292bc7913399e406d9bb7e8da0f70c6317c6e"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "4462b8aef1271363a21aa9f9fcb3fbfd3874e288", "filename": "compiler/rustc_ty_utils/src/assoc.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/compiler%2Frustc_ty_utils%2Fsrc%2Fassoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/compiler%2Frustc_ty_utils%2Fsrc%2Fassoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fassoc.rs?ref=1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "patch": "@@ -384,10 +384,6 @@ fn associated_type_for_impl_trait_in_impl(\n         opt_rpitit_info: Some(ImplTraitInTraitData::Impl { fn_def_id: impl_fn_def_id.to_def_id() }),\n     });\n \n-    // Copy param_env of the containing function. The synthesized associated type doesn't have\n-    // extra predicates to assume.\n-    impl_assoc_ty.param_env(tcx.param_env(impl_fn_def_id));\n-\n     // Copy visility of the containing function.\n     impl_assoc_ty.visibility(tcx.visibility(impl_fn_def_id));\n "}, {"sha": "50aeb7f440faf204aaaa24b6a5e8e0d23f634b70", "filename": "compiler/rustc_ty_utils/src/ty.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs?ref=1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "patch": "@@ -130,7 +130,9 @@ fn param_env(tcx: TyCtxt<'_>, def_id: DefId) -> ty::ParamEnv<'_> {\n     // FIXME(-Zlower-impl-trait-in-trait-to-assoc-ty): I don't like this, we should\n     // at least be making sure that the generics in RPITITs and their parent fn don't\n     // get out of alignment, or else we do actually need to substitute these predicates.\n-    if let Some(ImplTraitInTraitData::Trait { fn_def_id, .. }) = tcx.opt_rpitit_info(def_id) {\n+    if let Some(ImplTraitInTraitData::Trait { fn_def_id, .. })\n+    | Some(ImplTraitInTraitData::Impl { fn_def_id, .. }) = tcx.opt_rpitit_info(def_id)\n+    {\n         predicates = tcx.predicates_of(fn_def_id).instantiate_identity(tcx).predicates;\n     }\n "}, {"sha": "3d010f18009d1102f05d084561f093132e17ae8d", "filename": "tests/ui/async-await/in-trait/issue-104678.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/tests%2Fui%2Fasync-await%2Fin-trait%2Fissue-104678.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f/tests%2Fui%2Fasync-await%2Fin-trait%2Fissue-104678.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync-await%2Fin-trait%2Fissue-104678.rs?ref=1c9ad28dd2d5284dddbbdfd99539f0f2a98a8f0f", "patch": "@@ -1,5 +1,7 @@\n // edition:2021\n // check-pass\n+// [next] compile-flags: -Zlower-impl-trait-in-trait-to-assoc-ty\n+// revisions: current next\n \n #![feature(async_fn_in_trait)]\n #![allow(incomplete_features)]"}]}