{"sha": "af27958fd45ab44818749616ede842976e27d89b", "node_id": "C_kwDOAAsO6NoAKGFmMjc5NThmZDQ1YWI0NDgxODc0OTYxNmVkZTg0Mjk3NmUyN2Q4OWI", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-12-01T11:28:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-01T11:28:17Z"}, "message": "Merge #10897\n\n10897: internal: Try to fix Code tests r=lnicola a=lnicola\n\nIt looks like `--noEmit` broke our unit tests:\r\n\r\n![image](https://user-images.githubusercontent.com/308347/144217192-a8133a6b-880f-4852-846b-b45527485336.png)\r\n\r\nr? `@ChayimFriedman2`\r\n\r\nI suppose we might still:\r\n\r\n - compile stuff twice\r\n - not detect failing tests on CI (since we didn't notice this)\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "4af408640616954698e2498b244e9ae620a538e8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4af408640616954698e2498b244e9ae620a538e8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af27958fd45ab44818749616ede842976e27d89b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhp1xRCRBK7hj4Ov3rIwAANBAIAGjspZP4aoloxTJ2HK6l9gTs\nOXCMJomJaU9bg3hJ5Cx2PB0yDlQ03yxOSE3Brsx/dOKg1kMIiu2whZbkPAz9dZkj\nwiSv9javV3G2Ayk6ES6OUDe8Wu+lPsDmoXcC58C8bxuWoN6EVVb8CUC+fT6Q7oLf\nsYpmrioXzJGR5K6+DVgpA2vifDN14PAfCJtSwO9mtxvVzYwJZCz2JXKvknlcIcsb\nf4+pKvLiald6kDpo6pGGIONvSh/PsFrUPBi91Nqn+5hvHI1e4dNE0KRJdiYECCDF\nZiILAoySNrdc6LhyB9jKKajnTbhKrta6Y7K4vnRmRK3aZ7d6z3b5KOLOkd8HM14=\n=QGHM\n-----END PGP SIGNATURE-----\n", "payload": "tree 4af408640616954698e2498b244e9ae620a538e8\nparent c5ad6c8c5f783cd247a42d77a58d21afc91c6984\nparent b91003222b5420a41bdc343ce3a514ab7f59da6e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1638358097 +0000\ncommitter GitHub <noreply@github.com> 1638358097 +0000\n\nMerge #10897\n\n10897: internal: Try to fix Code tests r=lnicola a=lnicola\n\nIt looks like `--noEmit` broke our unit tests:\r\n\r\n![image](https://user-images.githubusercontent.com/308347/144217192-a8133a6b-880f-4852-846b-b45527485336.png)\r\n\r\nr? `@ChayimFriedman2`\r\n\r\nI suppose we might still:\r\n\r\n - compile stuff twice\r\n - not detect failing tests on CI (since we didn't notice this)\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af27958fd45ab44818749616ede842976e27d89b", "html_url": "https://github.com/rust-lang/rust/commit/af27958fd45ab44818749616ede842976e27d89b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af27958fd45ab44818749616ede842976e27d89b/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5ad6c8c5f783cd247a42d77a58d21afc91c6984", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5ad6c8c5f783cd247a42d77a58d21afc91c6984", "html_url": "https://github.com/rust-lang/rust/commit/c5ad6c8c5f783cd247a42d77a58d21afc91c6984"}, {"sha": "b91003222b5420a41bdc343ce3a514ab7f59da6e", "url": "https://api.github.com/repos/rust-lang/rust/commits/b91003222b5420a41bdc343ce3a514ab7f59da6e", "html_url": "https://github.com/rust-lang/rust/commit/b91003222b5420a41bdc343ce3a514ab7f59da6e"}], "stats": {"total": 24, "additions": 17, "deletions": 7}, "files": [{"sha": "192ef11be37a102da440d05e8d1da1700a03ebed", "filename": ".github/workflows/ci.yaml", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/af27958fd45ab44818749616ede842976e27d89b/.github%2Fworkflows%2Fci.yaml", "raw_url": "https://github.com/rust-lang/rust/raw/af27958fd45ab44818749616ede842976e27d89b/.github%2Fworkflows%2Fci.yaml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yaml?ref=af27958fd45ab44818749616ede842976e27d89b", "patch": "@@ -112,7 +112,11 @@ jobs:\n     - name: Install Nodejs\n       uses: actions/setup-node@v1\n       with:\n-        node-version: 12.x\n+        node-version: 14.x\n+\n+    - name: Install xvfb\n+      if: matrix.os == 'ubuntu-latest'\n+      run: sudo apt-get install -y xvfb\n \n     - run: npm ci\n       working-directory: ./editors/code\n@@ -124,13 +128,19 @@ jobs:\n     - run: npm run lint\n       working-directory: ./editors/code\n \n-    - name: Run vscode tests\n-      uses: GabrielBB/xvfb-action@v1.2\n+    - name: Run VS Code tests (Linux)\n+      if: matrix.os == 'ubuntu-latest'\n       env:\n         VSCODE_CLI: 1\n-      with:\n-        run: npm --prefix ./editors/code test\n-        # working-directory: ./editors/code  # does not work: https://github.com/GabrielBB/xvfb-action/issues/8\n+      run: xvfb-run npm test\n+      working-directory: ./editors/code\n+\n+    - name: Run VS Code tests (Windows)\n+      if: matrix.os == 'windows-latest'\n+      env:\n+        VSCODE_CLI: 1\n+      run: npm test\n+      working-directory: ./editors/code\n \n     - run: npm run pretest\n       working-directory: ./editors/code"}, {"sha": "d10cea82374fdd5622e694f20f957226ff4a9447", "filename": "editors/code/package.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af27958fd45ab44818749616ede842976e27d89b/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/af27958fd45ab44818749616ede842976e27d89b/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=af27958fd45ab44818749616ede842976e27d89b", "patch": "@@ -32,7 +32,7 @@\n         \"watch\": \"npm run build-base -- --sourcemap --watch\",\n         \"lint\": \"tsfmt --verify && eslint -c .eslintrc.js --ext ts ./src ./tests\",\n         \"fix\": \" tsfmt -r       && eslint -c .eslintrc.js --ext ts ./src ./tests --fix\",\n-        \"pretest\": \"tsc --noEmit && npm run build\",\n+        \"pretest\": \"tsc && npm run build\",\n         \"test\": \"node ./out/tests/runTests.js\"\n     },\n     \"dependencies\": {"}]}