{"sha": "5ebe6d3234c285be553ad2f1a4b965d497c1d573", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlYmU2ZDMyMzRjMjg1YmU1NTNhZDJmMWE0Yjk2NWQ0OTdjMWQ1NzM=", "commit": {"author": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-03-05T09:30:26Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-03-05T10:10:29Z"}, "message": "Fix dogfood test\n\nSince clippy cannot be a workspace, we have to check the sub-crates separately", "tree": {"sha": "1355a530e3c38c48f7c6b39d43bb7c130430ce56", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1355a530e3c38c48f7c6b39d43bb7c130430ce56"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ebe6d3234c285be553ad2f1a4b965d497c1d573", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmBCA5UACgkQHKDfKvWd\naKXdCw/9EXNtNVMss6ACUHxkzR7YmVLqesSEyjm0zFpBNvVjtCRoE9wHZHJiynoI\npSVVcmpBzlHxfXz9LrWYuAiF1dHk3w6ciInov9slcon6sYs61Q6NppRNOyld5fTM\n0KbfFuey8zqtoO2boqZgVWuSxdLCz1ZzsOK0s5MHcTMpe3fYsyWcYcleJc7pS97L\nrP3ZVrxPiDHExuQB63w6hXbNK4BodFQdEw7fTkqecp2RtK8Q3Sj834XEOrL+IPxs\n3oQZoIOdKn1VLrkaDd97Rryfo4+ffH5tnRj2TvtPqlppFm5KkMF0jwY3Q5DYZRhL\nfohwwWoJGbBe5ViYQbDaBAS4XX9V0nZYw7rf+eJNwmwqaLkm0GE0PRJ1QkoWmWbv\nwymEMEgOshNfb6vrVnyDioJymToBUJyRKAHCFZ0H2XSORxOkYZ37pyt2moyGbXVq\ngpan1kc/wqsiD8WBS6VLLbpl/mzcMl35op3UKfhS0d52ve0atP7Bz2GFwbPje/ST\nFurhnPBX2m/Rj0UEcBBic+WsK/7LkrinDovD+p8dFcinVIGQM5M7cKrYWgRAGAIx\nadKeIjN5wSEzO4Fv+eZYs3vAE2vsedz31wwKkAFuyZSS6jNNsQ1kFNZD1lvw4VDE\nRuy7LCL6wTGIT2dCl7lv2jIr8Xx+oET4oh+vMWutbA7HGuuN4p0=\n=ZSeB\n-----END PGP SIGNATURE-----", "payload": "tree 1355a530e3c38c48f7c6b39d43bb7c130430ce56\nparent 26265bb9bc815f8b508ae1743f816f76a0eeea41\nauthor flip1995 <philipp.krones@embecosm.com> 1614936626 +0100\ncommitter flip1995 <philipp.krones@embecosm.com> 1614939029 +0100\n\nFix dogfood test\n\nSince clippy cannot be a workspace, we have to check the sub-crates separately\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ebe6d3234c285be553ad2f1a4b965d497c1d573", "html_url": "https://github.com/rust-lang/rust/commit/5ebe6d3234c285be553ad2f1a4b965d497c1d573", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ebe6d3234c285be553ad2f1a4b965d497c1d573/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26265bb9bc815f8b508ae1743f816f76a0eeea41", "url": "https://api.github.com/repos/rust-lang/rust/commits/26265bb9bc815f8b508ae1743f816f76a0eeea41", "html_url": "https://github.com/rust-lang/rust/commit/26265bb9bc815f8b508ae1743f816f76a0eeea41"}], "stats": {"total": 22, "additions": 16, "deletions": 6}, "files": [{"sha": "89526648d2e03e3092bbb4741fa7b614a1464a35", "filename": "tests/dogfood.rs", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5ebe6d3234c285be553ad2f1a4b965d497c1d573/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ebe6d3234c285be553ad2f1a4b965d497c1d573/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=5ebe6d3234c285be553ad2f1a4b965d497c1d573", "patch": "@@ -23,10 +23,9 @@ fn dogfood_clippy() {\n         .current_dir(root_dir)\n         .env(\"CLIPPY_DOGFOOD\", \"1\")\n         .env(\"CARGO_INCREMENTAL\", \"0\")\n-        .arg(\"clippy-preview\")\n+        .arg(\"clippy\")\n         .arg(\"--all-targets\")\n         .arg(\"--all-features\")\n-        .args(&[\"-p\", \"clippy_lints\", \"-p\", \"clippy_utils\", \"-p\", \"rustc_tools_util\"])\n         .arg(\"--\")\n         .args(&[\"-D\", \"clippy::all\"])\n         .args(&[\"-D\", \"clippy::pedantic\"])\n@@ -125,19 +124,30 @@ fn dogfood_subprojects() {\n         \"clippy_workspace_tests/subcrate\",\n         \"clippy_workspace_tests/subcrate/src\",\n         \"clippy_dev\",\n+        \"clippy_lints\",\n+        \"clippy_utils\",\n         \"rustc_tools_util\",\n     ] {\n-        let output = Command::new(&*CLIPPY_PATH)\n+        let mut command = Command::new(&*CLIPPY_PATH);\n+        command\n             .current_dir(root_dir.join(d))\n             .env(\"CLIPPY_DOGFOOD\", \"1\")\n             .env(\"CARGO_INCREMENTAL\", \"0\")\n             .arg(\"clippy\")\n+            .arg(\"--all-targets\")\n+            .arg(\"--all-features\")\n             .arg(\"--\")\n             .args(&[\"-D\", \"clippy::all\"])\n             .args(&[\"-D\", \"clippy::pedantic\"])\n-            .arg(\"-Cdebuginfo=0\") // disable debuginfo to generate less data in the target dir\n-            .output()\n-            .unwrap();\n+            .arg(\"-Cdebuginfo=0\"); // disable debuginfo to generate less data in the target dir\n+\n+        // internal lints only exist if we build with the internal-lints feature\n+        if cfg!(feature = \"internal-lints\") {\n+            command.args(&[\"-D\", \"clippy::internal\"]);\n+        }\n+\n+        let output = command.output().unwrap();\n+\n         println!(\"status: {}\", output.status);\n         println!(\"stdout: {}\", String::from_utf8_lossy(&output.stdout));\n         println!(\"stderr: {}\", String::from_utf8_lossy(&output.stderr));"}]}