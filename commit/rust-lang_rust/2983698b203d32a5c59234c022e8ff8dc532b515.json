{"sha": "2983698b203d32a5c59234c022e8ff8dc532b515", "node_id": "C_kwDOAAsO6NoAKDI5ODM2OThiMjAzZDMyYTVjNTkyMzRjMDIyZThmZjhkYzUzMmI1MTU", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-03-31T15:56:41Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-03-31T16:16:33Z"}, "message": "rustdoc: do not show primitives and keywords as private", "tree": {"sha": "bcb71b9a14c209aaadca82b09ce93859dc988b97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bcb71b9a14c209aaadca82b09ce93859dc988b97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2983698b203d32a5c59234c022e8ff8dc532b515", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2983698b203d32a5c59234c022e8ff8dc532b515", "html_url": "https://github.com/rust-lang/rust/commit/2983698b203d32a5c59234c022e8ff8dc532b515", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2983698b203d32a5c59234c022e8ff8dc532b515/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03314912f1361af6b39383958b5aa1b4aed61c26", "url": "https://api.github.com/repos/rust-lang/rust/commits/03314912f1361af6b39383958b5aa1b4aed61c26", "html_url": "https://github.com/rust-lang/rust/commit/03314912f1361af6b39383958b5aa1b4aed61c26"}], "stats": {"total": 41, "additions": 33, "deletions": 8}, "files": [{"sha": "81c05509c4e804ede8348ea273de54c6e7691f82", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=2983698b203d32a5c59234c022e8ff8dc532b515", "patch": "@@ -471,14 +471,17 @@ impl Item {\n     ) -> Item {\n         trace!(\"name={:?}, def_id={:?}\", name, def_id);\n \n-        Item {\n-            def_id: def_id.into(),\n-            kind: box kind,\n-            name,\n-            attrs,\n-            visibility: cx.tcx.visibility(def_id).clean(cx),\n-            cfg,\n-        }\n+        // Primitives and Keywords are written in the source code as private modules.\n+        // The modules need to be private so that nobody actually uses them, but the\n+        // keywords and primitives that they are documenting are public.\n+        let visibility = if matches!(&kind, ItemKind::KeywordItem(..) | ItemKind::PrimitiveItem(..))\n+        {\n+            Visibility::Public\n+        } else {\n+            cx.tcx.visibility(def_id).clean(cx)\n+        };\n+\n+        Item { def_id: def_id.into(), kind: box kind, name, attrs, visibility, cfg }\n     }\n \n     /// Finds all `doc` attributes as NameValues and returns their corresponding values, joined"}, {"sha": "1cebe4c6797703667ec1f944bc2e92a71da3fd85", "filename": "src/test/rustdoc/keyword.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Ftest%2Frustdoc%2Fkeyword.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Ftest%2Frustdoc%2Fkeyword.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fkeyword.rs?ref=2983698b203d32a5c59234c022e8ff8dc532b515", "patch": "@@ -12,6 +12,7 @@\n // @has foo/index.html '//a/@href' '../foo/index.html'\n // @!has foo/foo/index.html\n // @!has-dir foo/foo\n+// @!has foo/index.html '//span' '\ud83d\udd12'\n #[doc(keyword = \"match\")]\n /// this is a test!\n mod foo{}"}, {"sha": "605ca4d170b39d7088f1c9d41951e22c9ef09888", "filename": "src/test/rustdoc/primitive.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Ftest%2Frustdoc%2Fprimitive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2983698b203d32a5c59234c022e8ff8dc532b515/src%2Ftest%2Frustdoc%2Fprimitive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fprimitive.rs?ref=2983698b203d32a5c59234c022e8ff8dc532b515", "patch": "@@ -0,0 +1,21 @@\n+#![crate_name = \"foo\"]\n+\n+#![feature(rustdoc_internals)]\n+\n+// @has foo/index.html '//h2[@id=\"primitives\"]' 'Primitive Types'\n+// @has foo/index.html '//a[@href=\"primitive.i32.html\"]' 'i32'\n+// @has foo/index.html '//div[@class=\"sidebar-elems\"]//li/a' 'Primitive Types'\n+// @has foo/index.html '//div[@class=\"sidebar-elems\"]//li/a/@href' '#primitives'\n+// @has foo/primitive.i32.html '//a[@class=\"primitive\"]' 'i32'\n+// @has foo/primitive.i32.html '//span[@class=\"in-band\"]' 'Primitive Type i32'\n+// @has foo/primitive.i32.html '//section[@id=\"main-content\"]//div[@class=\"docblock\"]//p' 'this is a test!'\n+// @has foo/index.html '//a/@href' '../foo/index.html'\n+// @!has foo/index.html '//span' '\ud83d\udd12'\n+#[doc(primitive = \"i32\")]\n+/// this is a test!\n+mod i32{}\n+\n+// @has foo/primitive.bool.html '//section[@id=\"main-content\"]//div[@class=\"docblock\"]//p' 'hello'\n+#[doc(primitive = \"bool\")]\n+/// hello\n+mod bool {}"}]}