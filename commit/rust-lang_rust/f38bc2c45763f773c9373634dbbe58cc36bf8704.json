{"sha": "f38bc2c45763f773c9373634dbbe58cc36bf8704", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzOGJjMmM0NTc2M2Y3NzNjOTM3MzYzNGRiYmU1OGNjMzZiZjg3MDQ=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2015-09-29T20:47:01Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2015-10-02T14:02:02Z"}, "message": "Fix librustdoc search events\n\nPreviously only keyup event was looked at, which meant that pasting, cutting and\notherwise changing the input without typing would not catch any updates to the\nsearch query.", "tree": {"sha": "f0484036aa211450a9af4548c7ad8683fef7303c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f0484036aa211450a9af4548c7ad8683fef7303c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f38bc2c45763f773c9373634dbbe58cc36bf8704", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f38bc2c45763f773c9373634dbbe58cc36bf8704", "html_url": "https://github.com/rust-lang/rust/commit/f38bc2c45763f773c9373634dbbe58cc36bf8704", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f38bc2c45763f773c9373634dbbe58cc36bf8704/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98841d4e93b08f9a99a36edff48c44fcc3228b31", "url": "https://api.github.com/repos/rust-lang/rust/commits/98841d4e93b08f9a99a36edff48c44fcc3228b31", "html_url": "https://github.com/rust-lang/rust/commit/98841d4e93b08f9a99a36edff48c44fcc3228b31"}], "stats": {"total": 28, "additions": 17, "deletions": 11}, "files": [{"sha": "5a6d76168322402f27d991b96a67fa1dacb8ecd2", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f38bc2c45763f773c9373634dbbe58cc36bf8704/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/f38bc2c45763f773c9373634dbbe58cc36bf8704/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=f38bc2c45763f773c9373634dbbe58cc36bf8704", "patch": "@@ -515,23 +515,20 @@\n                 var $active = $results.filter('.highlighted');\n \n                 if (e.which === 38) { // up\n-                    e.preventDefault();\n                     if (!$active.length || !$active.prev()) {\n                         return;\n                     }\n \n                     $active.prev().addClass('highlighted');\n                     $active.removeClass('highlighted');\n                 } else if (e.which === 40) { // down\n-                    e.preventDefault();\n                     if (!$active.length) {\n                         $results.first().addClass('highlighted');\n                     } else if ($active.next().length) {\n                         $active.next().addClass('highlighted');\n                         $active.removeClass('highlighted');\n                     }\n                 } else if (e.which === 13) { // return\n-                    e.preventDefault();\n                     if ($active.length) {\n                         document.location.href = $active.find('a').prop('href');\n                     }\n@@ -722,20 +719,29 @@\n         }\n \n         function startSearch() {\n-\n-            $(\".search-input\").on(\"keyup\",function() {\n+            var searchTimeout;\n+            $(\".search-input\").on(\"keyup input\",function() {\n+                clearTimeout(searchTimeout);\n                 if ($(this).val().length === 0) {\n                     window.history.replaceState(\"\", \"std - Rust\", \"?search=\");\n                     $('#main.content').removeClass('hidden');\n                     $('#search.content').addClass('hidden');\n+                } else {\n+                    searchTimeout = setTimeout(search, 500);\n                 }\n             });\n-\n-            var keyUpTimeout;\n-            $('.do-search').on('click', search);\n-            $('.search-input').on('keyup', function() {\n-                clearTimeout(keyUpTimeout);\n-                keyUpTimeout = setTimeout(search, 500);\n+            $('.search-form').on('submit', function(e){\n+                e.preventDefault();\n+                clearTimeout(searchTimeout);\n+                search();\n+            });\n+            $('.search-input').on('change paste', function(e) {\n+                // Do NOT e.preventDefault() here. It will prevent pasting.\n+                clearTimeout(searchTimeout);\n+                // zero-timeout necessary here because at the time of event handler execution the\n+                // pasted content is not in the input field yet. Shouldn\u2019t make any difference for\n+                // change, though.\n+                setTimeout(search, 0);\n             });\n \n             // Push and pop states are used to add search results to the browser"}]}