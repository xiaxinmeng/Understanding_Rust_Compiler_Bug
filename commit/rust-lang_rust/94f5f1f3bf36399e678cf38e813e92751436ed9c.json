{"sha": "94f5f1f3bf36399e678cf38e813e92751436ed9c", "node_id": "C_kwDOAAsO6NoAKDk0ZjVmMWYzYmYzNjM5OWU2NzhjZjM4ZTgxM2U5Mjc1MTQzNmVkOWM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-09T22:14:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-09T22:14:16Z"}, "message": "Rollup merge of #94772 - Urgau:check-cfg-miri, r=petrochenkov\n\nAdd miri to the well known conditional compilation names and values\n\nThis pull request adds `miri` to the list of well known names and values of the conditional compilation checking (`--check-cfg`).\n\nThis was brought up in [Zulip](https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/RFC.203013.3A.20Checking.20conditional.20compilation.20at.20compile.20time/near/274513827) when discussing about the future of `--check-cfg`.\n\nr? ``@petrochenkov``", "tree": {"sha": "0ca515223731d36142e8595b12114cc291acb6b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ca515223731d36142e8595b12114cc291acb6b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94f5f1f3bf36399e678cf38e813e92751436ed9c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiKSa4CRBK7hj4Ov3rIwAAguEIAETrQBLxv7ru0oV0lovQ9saM\nQhji3r3f94ymdV2U3jXKsgA5XIebJ95Vfc8seua/t1C5rWVKzT6TRInbdwYARjwk\nBbhMzcvcEGJ8zuLMLeErq8fv4Mt4nzyFPnWvA7/jvBHWZDbWI9GcBAhpJL6Z0l9s\nnrEArC1gEHyEc91XI+Er2UIEl9HCHuVyoltSNAe3YFRz3tEUtNZ9DR331McWYAaj\nS8zdi9DtaluFQdyKoBelVwdg9xap8efm7ylYinGvi++UgOBG67KKqsUYOdhB5Bp9\nijgPKaf6EgBF0CZs52L/dX8sApm43pHE7FTTfXn5mvQ5KN91o84Om1ilrPJ9R+Q=\n=8pLP\n-----END PGP SIGNATURE-----\n", "payload": "tree 0ca515223731d36142e8595b12114cc291acb6b2\nparent 06944d9e497a952a7a5031ebe1998d8a76c511e9\nparent 6781016421e39208c4c2c644c71f07981c3bcd2e\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1646864056 +0100\ncommitter GitHub <noreply@github.com> 1646864056 +0100\n\nRollup merge of #94772 - Urgau:check-cfg-miri, r=petrochenkov\n\nAdd miri to the well known conditional compilation names and values\n\nThis pull request adds `miri` to the list of well known names and values of the conditional compilation checking (`--check-cfg`).\n\nThis was brought up in [Zulip](https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/RFC.203013.3A.20Checking.20conditional.20compilation.20at.20compile.20time/near/274513827) when discussing about the future of `--check-cfg`.\n\nr? ``@petrochenkov``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94f5f1f3bf36399e678cf38e813e92751436ed9c", "html_url": "https://github.com/rust-lang/rust/commit/94f5f1f3bf36399e678cf38e813e92751436ed9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94f5f1f3bf36399e678cf38e813e92751436ed9c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "06944d9e497a952a7a5031ebe1998d8a76c511e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/06944d9e497a952a7a5031ebe1998d8a76c511e9", "html_url": "https://github.com/rust-lang/rust/commit/06944d9e497a952a7a5031ebe1998d8a76c511e9"}, {"sha": "6781016421e39208c4c2c644c71f07981c3bcd2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6781016421e39208c4c2c644c71f07981c3bcd2e", "html_url": "https://github.com/rust-lang/rust/commit/6781016421e39208c4c2c644c71f07981c3bcd2e"}], "stats": {"total": 59, "additions": 52, "deletions": 7}, "files": [{"sha": "1d36ff059de81eb89456660854facc29f1888a64", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -1072,6 +1072,7 @@ impl CrateCheckConfig {\n         // NOTE: This should be kept in sync with `default_configuration` and\n         // `fill_well_known_values`\n         const WELL_KNOWN_NAMES: &[Symbol] = &[\n+            // rustc\n             sym::unix,\n             sym::windows,\n             sym::target_os,\n@@ -1091,9 +1092,12 @@ impl CrateCheckConfig {\n             sym::debug_assertions,\n             sym::proc_macro,\n             sym::test,\n+            sym::feature,\n+            // rustdoc\n             sym::doc,\n             sym::doctest,\n-            sym::feature,\n+            // miri\n+            sym::miri,\n         ];\n \n         // We only insert well-known names if `names()` was activated\n@@ -1128,13 +1132,14 @@ impl CrateCheckConfig {\n \n         // No-values\n         for name in [\n+            sym::doc,\n+            sym::miri,\n             sym::unix,\n-            sym::windows,\n-            sym::debug_assertions,\n-            sym::proc_macro,\n             sym::test,\n-            sym::doc,\n             sym::doctest,\n+            sym::windows,\n+            sym::proc_macro,\n+            sym::debug_assertions,\n             sym::target_thread_local,\n         ] {\n             self.values_valid.entry(name).or_default();"}, {"sha": "3884578f5d46caf3e86357b6d6ec2557f6261dbe", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -891,6 +891,7 @@ symbols! {\n         minnumf32,\n         minnumf64,\n         mips_target_feature,\n+        miri,\n         misc,\n         mmx_reg,\n         modifiers,"}, {"sha": "2ee67d623eec90f191eacf17ee075116553620c2", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -193,7 +193,6 @@ const EXTRA_CHECK_CFGS: &[(Option<Mode>, &'static str, Option<&[&'static str]>)]\n     (None, \"bootstrap\", None),\n     (Some(Mode::Rustc), \"parallel_compiler\", None),\n     (Some(Mode::ToolRustc), \"parallel_compiler\", None),\n-    (Some(Mode::Std), \"miri\", None),\n     (Some(Mode::Std), \"stdarch_intel_sde\", None),\n     (Some(Mode::Std), \"no_fp_fmt_parse\", None),\n     (Some(Mode::Std), \"no_global_oom_handling\", None),"}, {"sha": "e57fb69a1e05f2d94a7982ee39af6fa2b4fb03fd", "filename": "src/test/ui/check-cfg/well-known-names.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-names.rs?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -24,4 +24,10 @@ fn unix_misspell() {}\n #[cfg(unix)]\n fn unix() {}\n \n+#[cfg(miri)]\n+fn miri() {}\n+\n+#[cfg(doc)]\n+fn doc() {}\n+\n fn main() {}"}, {"sha": "96375dc8d3130e0518ddaa49d1df7974b3232898", "filename": "src/test/ui/check-cfg/well-known-values.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.rs?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -25,4 +25,18 @@ fn unix_with_value() {}\n #[cfg(unix)]\n fn unix() {}\n \n+#[cfg(miri = \"miri\")]\n+//~^ WARNING unexpected `cfg` condition value\n+fn miri_with_value() {}\n+\n+#[cfg(miri)]\n+fn miri() {}\n+\n+#[cfg(doc = \"linux\")]\n+//~^ WARNING unexpected `cfg` condition value\n+fn doc_with_value() {}\n+\n+#[cfg(doc)]\n+fn doc() {}\n+\n fn main() {}"}, {"sha": "8b04c770fb505f99c805aabaf8a938b56ceabf9d", "filename": "src/test/ui/check-cfg/well-known-values.stderr", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/94f5f1f3bf36399e678cf38e813e92751436ed9c/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcheck-cfg%2Fwell-known-values.stderr?ref=94f5f1f3bf36399e678cf38e813e92751436ed9c", "patch": "@@ -29,5 +29,25 @@ LL | #[cfg(unix = \"aa\")]\n    |\n    = note: no expected value for `unix`\n \n-warning: 3 warnings emitted\n+warning: unexpected `cfg` condition value\n+  --> $DIR/well-known-values.rs:28:7\n+   |\n+LL | #[cfg(miri = \"miri\")]\n+   |       ^^^^---------\n+   |           |\n+   |           help: remove the value\n+   |\n+   = note: no expected value for `miri`\n+\n+warning: unexpected `cfg` condition value\n+  --> $DIR/well-known-values.rs:35:7\n+   |\n+LL | #[cfg(doc = \"linux\")]\n+   |       ^^^----------\n+   |          |\n+   |          help: remove the value\n+   |\n+   = note: no expected value for `doc`\n+\n+warning: 5 warnings emitted\n "}]}