{"sha": "2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiOGYyYWNkNWYwZjQ1MGZiM2Q5MzIwYTMyOTVmNWI4NmRiZDMxZjE=", "commit": {"author": {"name": "Tyson Nottingham", "email": "tgnottingham@gmail.com", "date": "2021-01-25T20:56:21Z"}, "committer": {"name": "Tyson Nottingham", "email": "tgnottingham@gmail.com", "date": "2021-01-29T20:46:29Z"}, "message": "Indicate both start and end of pass RSS in time-passes output\n\nPreviously, only the end of pass RSS was indicated. This could easily\nlead one to believe that the change in RSS from one pass to the next was\nattributable to the second pass, when in fact it occurred between the\nend of the first pass and the start of the second.\n\nAlso, improve alignment of columns.", "tree": {"sha": "3d5fd935e749e8480bd65c0316ad3e5a4b9cfce2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d5fd935e749e8480bd65c0316ad3e5a4b9cfce2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1", "html_url": "https://github.com/rust-lang/rust/commit/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1/comments", "author": {"login": "tgnottingham", "id": 3668166, "node_id": "MDQ6VXNlcjM2NjgxNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3668166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tgnottingham", "html_url": "https://github.com/tgnottingham", "followers_url": "https://api.github.com/users/tgnottingham/followers", "following_url": "https://api.github.com/users/tgnottingham/following{/other_user}", "gists_url": "https://api.github.com/users/tgnottingham/gists{/gist_id}", "starred_url": "https://api.github.com/users/tgnottingham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tgnottingham/subscriptions", "organizations_url": "https://api.github.com/users/tgnottingham/orgs", "repos_url": "https://api.github.com/users/tgnottingham/repos", "events_url": "https://api.github.com/users/tgnottingham/events{/privacy}", "received_events_url": "https://api.github.com/users/tgnottingham/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tgnottingham", "id": 3668166, "node_id": "MDQ6VXNlcjM2NjgxNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3668166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tgnottingham", "html_url": "https://github.com/tgnottingham", "followers_url": "https://api.github.com/users/tgnottingham/followers", "following_url": "https://api.github.com/users/tgnottingham/following{/other_user}", "gists_url": "https://api.github.com/users/tgnottingham/gists{/gist_id}", "starred_url": "https://api.github.com/users/tgnottingham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tgnottingham/subscriptions", "organizations_url": "https://api.github.com/users/tgnottingham/orgs", "repos_url": "https://api.github.com/users/tgnottingham/repos", "events_url": "https://api.github.com/users/tgnottingham/events{/privacy}", "received_events_url": "https://api.github.com/users/tgnottingham/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e67b72de2e9c4de59c68f2ad7f0ab117d2446c9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e67b72de2e9c4de59c68f2ad7f0ab117d2446c9e", "html_url": "https://github.com/rust-lang/rust/commit/e67b72de2e9c4de59c68f2ad7f0ab117d2446c9e"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "be369b07fddfe35f3c41bcd4c56dc97c46ef1dce", "filename": "src/bin/cg_clif.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1/src%2Fbin%2Fcg_clif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1/src%2Fbin%2Fcg_clif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcg_clif.rs?ref=2b8f2acd5f0f450fb3d9320a3295f5b86dbd31f1", "patch": "@@ -6,7 +6,7 @@ extern crate rustc_interface;\n extern crate rustc_session;\n extern crate rustc_target;\n \n-use rustc_data_structures::profiling::print_time_passes_entry;\n+use rustc_data_structures::profiling::{get_resident_set_size, print_time_passes_entry};\n use rustc_interface::interface;\n use rustc_session::config::ErrorOutputType;\n use rustc_session::early_error;\n@@ -39,7 +39,8 @@ impl rustc_driver::Callbacks for CraneliftPassesCallbacks {\n }\n \n fn main() {\n-    let start = std::time::Instant::now();\n+    let start_time = std::time::Instant::now();\n+    let start_rss = get_resident_set_size();\n     rustc_driver::init_rustc_env_logger();\n     let mut callbacks = CraneliftPassesCallbacks::default();\n     rustc_driver::install_ice_hook();\n@@ -61,7 +62,11 @@ fn main() {\n         })));\n         run_compiler.run()\n     });\n-    // The extra `\\t` is necessary to align this label with the others.\n-    print_time_passes_entry(callbacks.time_passes, \"\\ttotal\", start.elapsed());\n+\n+    if callbacks.time_passes {\n+        let end_rss = get_resident_set_size();\n+        print_time_passes_entry(\"total\", start_time.elapsed(), start_rss, end_rss);\n+    }\n+\n     std::process::exit(exit_code)\n }"}]}