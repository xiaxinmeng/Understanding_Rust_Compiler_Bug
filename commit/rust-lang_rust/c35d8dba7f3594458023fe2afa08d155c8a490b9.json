{"sha": "c35d8dba7f3594458023fe2afa08d155c8a490b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzNWQ4ZGJhN2YzNTk0NDU4MDIzZmUyYWZhMDhkMTU1YzhhNDkwYjk=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2016-08-14T17:29:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-14T17:29:48Z"}, "message": "Rollup merge of #35491 - sanxiyn:pub-restricted-span, r=nikomatsakis\n\nCorrect span for pub_restricted field\n\nFix #35435.", "tree": {"sha": "48e2dd9c2e6f3fefdc8b6968c635c10dfbaf962d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48e2dd9c2e6f3fefdc8b6968c635c10dfbaf962d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c35d8dba7f3594458023fe2afa08d155c8a490b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c35d8dba7f3594458023fe2afa08d155c8a490b9", "html_url": "https://github.com/rust-lang/rust/commit/c35d8dba7f3594458023fe2afa08d155c8a490b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c35d8dba7f3594458023fe2afa08d155c8a490b9/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d8af8cf5de41d2bdc88c84bf9461b12e76194f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d8af8cf5de41d2bdc88c84bf9461b12e76194f9", "html_url": "https://github.com/rust-lang/rust/commit/6d8af8cf5de41d2bdc88c84bf9461b12e76194f9"}, {"sha": "f76a737bae12788ba6180c13ec5fcba9177d80d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f76a737bae12788ba6180c13ec5fcba9177d80d4", "html_url": "https://github.com/rust-lang/rust/commit/f76a737bae12788ba6180c13ec5fcba9177d80d4"}], "stats": {"total": 62, "additions": 37, "deletions": 25}, "files": [{"sha": "e174f3ad08d6adb4ef916d5a9f85bdb1ac65a27b", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=c35d8dba7f3594458023fe2afa08d155c8a490b9", "patch": "@@ -3788,19 +3788,18 @@ impl<'a> Parser<'a> {\n     }\n \n     /// Parse a structure field\n-    fn parse_name_and_ty(&mut self, pr: Visibility,\n-                         attrs: Vec<Attribute> ) -> PResult<'a, StructField> {\n-        let lo = match pr {\n-            Visibility::Inherited => self.span.lo,\n-            _ => self.last_span.lo,\n-        };\n+    fn parse_name_and_ty(&mut self,\n+                         lo: BytePos,\n+                         vis: Visibility,\n+                         attrs: Vec<Attribute>)\n+                         -> PResult<'a, StructField> {\n         let name = self.parse_ident()?;\n         self.expect(&token::Colon)?;\n         let ty = self.parse_ty_sum()?;\n         Ok(StructField {\n             span: mk_sp(lo, self.last_span.hi),\n             ident: Some(name),\n-            vis: pr,\n+            vis: vis,\n             id: ast::DUMMY_NODE_ID,\n             ty: ty,\n             attrs: attrs,\n@@ -5120,10 +5119,11 @@ impl<'a> Parser<'a> {\n \n     /// Parse a structure field declaration\n     pub fn parse_single_struct_field(&mut self,\n+                                     lo: BytePos,\n                                      vis: Visibility,\n                                      attrs: Vec<Attribute> )\n                                      -> PResult<'a, StructField> {\n-        let a_var = self.parse_name_and_ty(vis, attrs)?;\n+        let a_var = self.parse_name_and_ty(lo, vis, attrs)?;\n         match self.token {\n             token::Comma => {\n                 self.bump();\n@@ -5144,8 +5144,9 @@ impl<'a> Parser<'a> {\n     /// Parse an element of a struct definition\n     fn parse_struct_decl_field(&mut self) -> PResult<'a, StructField> {\n         let attrs = self.parse_outer_attributes()?;\n+        let lo = self.span.lo;\n         let vis = self.parse_visibility(true)?;\n-        self.parse_single_struct_field(vis, attrs)\n+        self.parse_single_struct_field(lo, vis, attrs)\n     }\n \n     // If `allow_path` is false, just parse the `pub` in `pub(path)` (but still parse `pub(crate)`)"}, {"sha": "9f8f871200ca5543a0d1e33a319fb180d3479463", "filename": "src/test/ui/span/pub-struct-field.rs", "status": "renamed", "additions": 8, "deletions": 16, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.rs?ref=c35d8dba7f3594458023fe2afa08d155c8a490b9", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -8,23 +8,15 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// Regression test for issue #26083\n-// Test that span for public struct fields start at `pub` instead of the identifier\n+// Regression test for issue #26083 and #35435\n+// Test that span for public struct fields start at `pub`\n \n-struct Foo {\n-    pub bar: u8,\n+#![feature(pub_restricted)]\n \n-    pub\n-    //~^ error: field `bar` is already declared [E0124]\n+struct Foo {\n     bar: u8,\n-\n-    pub bar:\n-    //~^ error: field `bar` is already declared [E0124]\n-    u8,\n-\n-    bar:\n-    //~^ error: field `bar` is already declared [E0124]\n-    u8,\n+    pub bar: u8,\n+    pub(crate) bar: u8,\n }\n \n-fn main() { }\n+fn main() {}", "previous_filename": "src/test/compile-fail/pub-struct-field-span-26083.rs"}, {"sha": "2c002c34736c54bca4bbd25d93f37c5a6e8cb192", "filename": "src/test/ui/span/pub-struct-field.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c35d8dba7f3594458023fe2afa08d155c8a490b9/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fpub-struct-field.stderr?ref=c35d8dba7f3594458023fe2afa08d155c8a490b9", "patch": "@@ -0,0 +1,19 @@\n+error[E0124]: field `bar` is already declared\n+  --> $DIR/pub-struct-field.rs:18:5\n+   |\n+17 |     bar: u8,\n+   |     ------- `bar` first declared here\n+18 |     pub bar: u8,\n+   |     ^^^^^^^^^^^ field already declared\n+\n+error[E0124]: field `bar` is already declared\n+  --> $DIR/pub-struct-field.rs:19:5\n+   |\n+17 |     bar: u8,\n+   |     ------- `bar` first declared here\n+18 |     pub bar: u8,\n+19 |     pub(crate) bar: u8,\n+   |     ^^^^^^^^^^^^^^^^^^ field already declared\n+\n+error: aborting due to 2 previous errors\n+"}]}