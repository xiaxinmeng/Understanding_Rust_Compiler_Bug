{"sha": "db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiMmE5ODk1NjVlYTJiM2QzYzA2ZTM0Y2QzODVjZmI1NzRhMzJmYmI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-04-13T09:20:54Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-04-13T09:21:59Z"}, "message": "internal: don't use `#[should_panic]` for tests", "tree": {"sha": "27d88010e9441d2af973f04c9b979220b0b07ebf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27d88010e9441d2af973f04c9b979220b0b07ebf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "html_url": "https://github.com/rust-lang/rust/commit/db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "06a633ff421b764428bb946ced914e59532fe13f", "url": "https://api.github.com/repos/rust-lang/rust/commits/06a633ff421b764428bb946ced914e59532fe13f", "html_url": "https://github.com/rust-lang/rust/commit/06a633ff421b764428bb946ced914e59532fe13f"}], "stats": {"total": 46, "additions": 22, "deletions": 24}, "files": [{"sha": "a04333e63e442c1ea283a2a90a06f125423da6ff", "filename": "crates/ide/src/goto_definition.rs", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fgoto_definition.rs?ref=db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "patch": "@@ -110,6 +110,13 @@ mod tests {\n         assert_eq!(expected, FileRange { file_id: nav.file_id, range: nav.focus_or_full_range() });\n     }\n \n+    fn check_unresolved(ra_fixture: &str) {\n+        let (analysis, position) = fixture::position(ra_fixture);\n+        let navs = analysis.goto_definition(position).unwrap().expect(\"no definition found\").info;\n+\n+        assert!(navs.is_empty(), \"didn't expect this to resolve anywhere: {:?}\", navs)\n+    }\n+\n     #[test]\n     fn goto_def_for_extern_crate() {\n         check(\n@@ -927,17 +934,12 @@ fn f() -> impl Iterator<Item$0 = u8> {}\n     }\n \n     #[test]\n-    #[should_panic = \"unresolved reference\"]\n     fn unknown_assoc_ty() {\n-        check(\n+        check_unresolved(\n             r#\"\n-trait Iterator {\n-    type Item;\n-       //^^^^\n-}\n-\n+trait Iterator { type Item; }\n fn f() -> impl Iterator<Invalid$0 = u8> {}\n-            \"#,\n+\"#,\n         )\n     }\n "}, {"sha": "99be5e090ce2a53d7eb1492536cf88d5eb7234e8", "filename": "crates/ide_assists/src/handlers/flip_comma.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs?ref=db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "patch": "@@ -66,26 +66,12 @@ mod tests {\n     }\n \n     #[test]\n-    #[should_panic]\n     fn flip_comma_before_punct() {\n         // See https://github.com/rust-analyzer/rust-analyzer/issues/1619\n         // \"Flip comma\" assist shouldn't be applicable to the last comma in enum or struct\n         // declaration body.\n-        check_assist_target(\n-            flip_comma,\n-            \"pub enum Test { \\\n-             A,$0 \\\n-             }\",\n-            \",\",\n-        );\n-\n-        check_assist_target(\n-            flip_comma,\n-            \"pub struct Test { \\\n-             foo: usize,$0 \\\n-             }\",\n-            \",\",\n-        );\n+        check_assist_not_applicable(flip_comma, \"pub enum Test { A,$0 }\");\n+        check_assist_not_applicable(flip_comma, \"pub struct Test { foo: usize,$0 }\");\n     }\n \n     #[test]"}, {"sha": "7c47c26b2d46441f456f77c1d38113263ff72a52", "filename": "docs/dev/style.md", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/docs%2Fdev%2Fstyle.md", "raw_url": "https://github.com/rust-lang/rust/raw/db2a989565ea2b3d3c06e34cd385cfb574a32fbb/docs%2Fdev%2Fstyle.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Fstyle.md?ref=db2a989565ea2b3d3c06e34cd385cfb574a32fbb", "patch": "@@ -152,6 +152,16 @@ Do not reuse marks between several tests.\n \n **Rationale:** marks provide an easy way to find the canonical test for each bit of code.\n This makes it much easier to understand.\n+More than one mark per test / code branch doesn't add significantly to understanding.\n+\n+## `#[should_panic]`\n+\n+Do not use `#[should_panic]` tests.\n+Instead, explicitly check for `None`, `Err`, etc.\n+\n+**Rationale:**a `#[should_panic]` is a tool for library authors, to makes sure that API does not fail silently, when misused.\n+`rust-analyzer` is not a library, we don't need to test for API misuse, and we have to handle any user input without panics.\n+Panic messages in the logs from the `#[should_panic]` tests are confusing.\n \n ## Function Preconditions\n "}]}