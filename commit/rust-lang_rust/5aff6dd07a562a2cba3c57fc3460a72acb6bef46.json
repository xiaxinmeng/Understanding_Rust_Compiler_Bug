{"sha": "5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhZmY2ZGQwN2E1NjJhMmNiYTNjNTdmYzM0NjBhNzJhY2I2YmVmNDY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-13T09:40:28Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-13T09:40:28Z"}, "message": "Auto merge of #87019 - nikic:clang-12.0.1, r=Mark-Simulacrum\n\nUse clang 12.0.1 on dist-x86_64/i686-linux\n\nThe LLD + ThinLTO __morestack bug has been fixed in 12.0.1, so\nwe can now update our clang version. This also means that we no\nlonger need to build Python 2.", "tree": {"sha": "7cf47debba6f46e51491e80436d612416dc4c8dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cf47debba6f46e51491e80436d612416dc4c8dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "html_url": "https://github.com/rust-lang/rust/commit/5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "394804bb23bf0889c135a21f945b2fe44881ada8", "url": "https://api.github.com/repos/rust-lang/rust/commits/394804bb23bf0889c135a21f945b2fe44881ada8", "html_url": "https://github.com/rust-lang/rust/commit/394804bb23bf0889c135a21f945b2fe44881ada8"}, {"sha": "54110fed4129eb2b78798a8c200248720707a66a", "url": "https://api.github.com/repos/rust-lang/rust/commits/54110fed4129eb2b78798a8c200248720707a66a", "html_url": "https://github.com/rust-lang/rust/commit/54110fed4129eb2b78798a8c200248720707a66a"}], "stats": {"total": 34, "additions": 16, "deletions": 18}, "files": [{"sha": "42fda98bc7a4b1a9e02e9c665d155bb60bd6f4cb", "filename": "src/ci/docker/host-x86_64/dist-i686-linux/Dockerfile", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -69,8 +69,6 @@ COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-# Build Python 2.7 needed for Clang 10.\n-RUN ./build-python.sh 2.7.12\n # Build Python 3 needed for LLVM 12.\n RUN ./build-python.sh 3.9.1\n \n@@ -97,7 +95,7 @@ ENV RUST_CONFIGURE_ARGS \\\n       --build=i686-unknown-linux-gnu \\\n       --set llvm.ninja=false \\\n       --set rust.jemalloc\n-ENV SCRIPT python2.7 ../x.py dist --build $HOSTS --host $HOSTS --target $HOSTS\n+ENV SCRIPT python3 ../x.py dist --build $HOSTS --host $HOSTS --target $HOSTS\n ENV CARGO_TARGET_I686_UNKNOWN_LINUX_GNU_LINKER=clang\n \n # This was added when we switched from gcc to clang. It's not clear why this is"}, {"sha": "8242e091cd4c7890999140b6762762cb81f40cff", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -69,8 +69,6 @@ COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-# Build Python 2.7 needed for Clang 10.\n-RUN ./build-python.sh 2.7.12\n # Build Python 3 needed for LLVM 12.\n RUN ./build-python.sh 3.9.1\n \n@@ -102,7 +100,7 @@ ENV RUST_CONFIGURE_ARGS \\\n       --set llvm.thin-lto=true \\\n       --set llvm.ninja=false \\\n       --set rust.jemalloc\n-ENV SCRIPT ../src/ci/pgo.sh python2.7 ../x.py dist \\\n+ENV SCRIPT ../src/ci/pgo.sh python3 ../x.py dist \\\n     --host $HOSTS --target $HOSTS \\\n     --include-default-paths \\\n     src/tools/build-manifest"}, {"sha": "b5378244b793c6cd559b159c19241fed823f8c62", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-binutils.sh", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-binutils.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-binutils.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-binutils.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -4,14 +4,16 @@ set -ex\n \n source shared.sh\n \n-curl https://ftp.gnu.org/gnu/binutils/binutils-2.25.1.tar.bz2 | tar xfj -\n+VERSION=2.26.1\n+\n+curl https://ftp.gnu.org/gnu/binutils/binutils-$VERSION.tar.bz2 | tar xfj -\n \n mkdir binutils-build\n cd binutils-build\n-hide_output ../binutils-2.25.1/configure --prefix=/rustroot\n-hide_output make -j10\n+hide_output ../binutils-$VERSION/configure --prefix=/rustroot\n+hide_output make -j$(nproc)\n hide_output make install\n \n cd ..\n rm -rf binutils-build\n-rm -rf binutils-2.25.1\n+rm -rf binutils-$VERSION"}, {"sha": "40a637616d35f1fe434bac93a88a19f3a68b382a", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-clang.sh", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -4,7 +4,7 @@ set -ex\n \n source shared.sh\n \n-LLVM=llvmorg-10.0.0\n+LLVM=llvmorg-12.0.1\n \n mkdir llvm-project\n cd llvm-project\n@@ -30,7 +30,7 @@ hide_output \\\n       -DLLVM_ENABLE_PROJECTS=\"clang;lld\" \\\n       -DC_INCLUDE_DIRS=\"$INC\"\n \n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n \n cd ../.."}, {"sha": "2f6b1fa9b8e3e657c344943d2adb07e1fac28ead", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-cmake.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-cmake.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-cmake.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-cmake.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -9,7 +9,7 @@ curl -L https://github.com/Kitware/CMake/releases/download/v$CMAKE/cmake-$CMAKE.\n mkdir cmake-build\n cd cmake-build\n hide_output ../cmake-$CMAKE/configure --prefix=/rustroot\n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n \n cd .."}, {"sha": "6efa789756619fcaf3e318159da75bf2a1051c9b", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-curl.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-curl.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-curl.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-curl.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -30,7 +30,7 @@ hide_output ../curl-$VERSION/configure \\\n       --disable-rtsp \\\n       --disable-ldaps \\\n       --disable-ldap\n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n \n cd .."}, {"sha": "3a03eb2bdc8384557067160e5ece530535a21f0d", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-gcc.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-gcc.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -32,7 +32,7 @@ hide_output ../gcc-$GCC/configure \\\n     --prefix=/rustroot \\\n     --enable-languages=c,c++ \\\n     --disable-gnu-unique-object\n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n ln -s gcc /rustroot/bin/cc\n "}, {"sha": "34bbe19d2fac331cec92db088c24190512273174", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-openssl.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-openssl.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-openssl.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-openssl.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -14,7 +14,7 @@ curl $URL | tar xzf -\n \n cd openssl-$VERSION\n hide_output ./config --prefix=/rustroot shared -fPIC\n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n cd ..\n rm -rf openssl-$VERSION"}, {"sha": "9a203beadd1033ef903be18f94af77839bc923ad", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-python.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -14,7 +14,7 @@ cd python-build\n # than that fairly normal.\n CFLAGS='-I /rustroot/include' LDFLAGS='-L /rustroot/lib -L /rustroot/lib64' \\\n     hide_output ../Python-$VERSION/configure --prefix=/rustroot\n-hide_output make -j10\n+hide_output make -j$(nproc)\n hide_output make install\n \n cd .."}, {"sha": "aa009a4eac6af877e4e4dc005a2fd9abd19d2f2b", "filename": "src/ci/pgo.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fpgo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5aff6dd07a562a2cba3c57fc3460a72acb6bef46/src%2Fci%2Fpgo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpgo.sh?ref=5aff6dd07a562a2cba3c57fc3460a72acb6bef46", "patch": "@@ -4,7 +4,7 @@ set -euxo pipefail\n \n rm -rf /tmp/rustc-pgo\n \n-python2.7 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n+python3 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n     --stage 2 library/std --rust-profile-generate=/tmp/rustc-pgo\n \n RUSTC_BOOTSTRAP=1 ./build/$PGO_HOST/stage2/bin/rustc --edition=2018 \\"}]}