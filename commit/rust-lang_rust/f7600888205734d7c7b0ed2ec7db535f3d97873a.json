{"sha": "f7600888205734d7c7b0ed2ec7db535f3d97873a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3NjAwODg4MjA1NzM0ZDdjN2IwZWQyZWM3ZGI1MzVmM2Q5Nzg3M2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-26T12:46:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-26T12:46:00Z"}, "message": "Auto merge of #4430 - lzutao:defid_trait_alias, r=flip1995\n\nAccount for trait alias when looking for defid\n\nI hit the crash on the `expect` call when running clippy on rustc libcore.\nHopefully this will fix it.\nchangelog: none", "tree": {"sha": "9935be3be921085011aba73ce8530d139c3daf4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9935be3be921085011aba73ce8530d139c3daf4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7600888205734d7c7b0ed2ec7db535f3d97873a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7600888205734d7c7b0ed2ec7db535f3d97873a", "html_url": "https://github.com/rust-lang/rust/commit/f7600888205734d7c7b0ed2ec7db535f3d97873a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7600888205734d7c7b0ed2ec7db535f3d97873a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba6681300e9d7a10379c9fbbf539f4f3261fdc6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba6681300e9d7a10379c9fbbf539f4f3261fdc6a", "html_url": "https://github.com/rust-lang/rust/commit/ba6681300e9d7a10379c9fbbf539f4f3261fdc6a"}, {"sha": "c222e7eca716755f7edcf91a0db8bc523781f0cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/c222e7eca716755f7edcf91a0db8bc523781f0cc", "html_url": "https://github.com/rust-lang/rust/commit/c222e7eca716755f7edcf91a0db8bc523781f0cc"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "cc22d3b9865fb0f3a8abdc34c0a75e35b24bd2ee", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f7600888205734d7c7b0ed2ec7db535f3d97873a/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7600888205734d7c7b0ed2ec7db535f3d97873a/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=f7600888205734d7c7b0ed2ec7db535f3d97873a", "patch": "@@ -2800,7 +2800,10 @@ impl SelfKind {\n                 hir::Mutability::MutMutable => &paths::ASMUT_TRAIT,\n             };\n \n-            let trait_def_id = get_trait_def_id(cx, trait_path).expect(\"trait def id not found\");\n+            let trait_def_id = match get_trait_def_id(cx, trait_path) {\n+                Some(did) => did,\n+                None => return false,\n+            };\n             implements_trait(cx, ty, trait_def_id, &[parent_ty.into()])\n         }\n "}, {"sha": "408deb1b402d2be483da4c6622a8407e8ea1da8d", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f7600888205734d7c7b0ed2ec7db535f3d97873a/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7600888205734d7c7b0ed2ec7db535f3d97873a/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=f7600888205734d7c7b0ed2ec7db535f3d97873a", "patch": "@@ -261,14 +261,16 @@ pub fn path_to_res(cx: &LateContext<'_, '_>, path: &[&str]) -> Option<(def::Res)\n }\n \n /// Convenience function to get the `DefId` of a trait by path.\n+/// It could be a trait or trait alias.\n pub fn get_trait_def_id(cx: &LateContext<'_, '_>, path: &[&str]) -> Option<DefId> {\n     let res = match path_to_res(cx, path) {\n         Some(res) => res,\n         None => return None,\n     };\n \n     match res {\n-        def::Res::Def(DefKind::Trait, trait_id) => Some(trait_id),\n+        Res::Def(DefKind::Trait, trait_id) | Res::Def(DefKind::TraitAlias, trait_id) => Some(trait_id),\n+        Res::Err => unreachable!(\"this trait resolution is impossible: {:?}\", &path),\n         _ => None,\n     }\n }"}, {"sha": "2a948d60b108954b6a6e31980f960449ac91c835", "filename": "tests/ui/def_id_nocore.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f7600888205734d7c7b0ed2ec7db535f3d97873a/tests%2Fui%2Fdef_id_nocore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7600888205734d7c7b0ed2ec7db535f3d97873a/tests%2Fui%2Fdef_id_nocore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdef_id_nocore.rs?ref=f7600888205734d7c7b0ed2ec7db535f3d97873a", "patch": "@@ -0,0 +1,29 @@\n+// ignore-windows\n+// ignore-macos\n+\n+#![feature(no_core, lang_items, start)]\n+#![no_core]\n+\n+#[link(name = \"c\")]\n+extern \"C\" {}\n+\n+#[lang = \"sized\"]\n+pub trait Sized {}\n+#[lang = \"copy\"]\n+pub trait Copy {}\n+#[lang = \"freeze\"]\n+pub unsafe trait Freeze {}\n+\n+#[lang = \"start\"]\n+#[start]\n+fn start(_argc: isize, _argv: *const *const u8) -> isize {\n+    0\n+}\n+\n+pub struct A;\n+\n+impl A {\n+    pub fn as_ref(self) -> &'static str {\n+        \"A\"\n+    }\n+}"}, {"sha": "ed87a50547d17398a13790c1ab9ad7e4114aabe0", "filename": "tests/ui/def_id_nocore.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f7600888205734d7c7b0ed2ec7db535f3d97873a/tests%2Fui%2Fdef_id_nocore.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f7600888205734d7c7b0ed2ec7db535f3d97873a/tests%2Fui%2Fdef_id_nocore.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdef_id_nocore.stderr?ref=f7600888205734d7c7b0ed2ec7db535f3d97873a", "patch": "@@ -0,0 +1,10 @@\n+error: methods called `as_*` usually take self by reference or self by mutable reference; consider choosing a less ambiguous name\n+  --> $DIR/def_id_nocore.rs:26:19\n+   |\n+LL |     pub fn as_ref(self) -> &'static str {\n+   |                   ^^^^\n+   |\n+   = note: `-D clippy::wrong-self-convention` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}