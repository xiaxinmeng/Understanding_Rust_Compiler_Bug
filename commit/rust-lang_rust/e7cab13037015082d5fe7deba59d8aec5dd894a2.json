{"sha": "e7cab13037015082d5fe7deba59d8aec5dd894a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3Y2FiMTMwMzcwMTUwODJkNWZlN2RlYmE1OWQ4YWVjNWRkODk0YTI=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2015-12-28T13:48:01Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2015-12-28T13:48:01Z"}, "message": "[MIR] Fix setting discriminant for unit enums", "tree": {"sha": "360b282b9ba1ba294e52eed567b0b3e123d5f030", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/360b282b9ba1ba294e52eed567b0b3e123d5f030"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7cab13037015082d5fe7deba59d8aec5dd894a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7cab13037015082d5fe7deba59d8aec5dd894a2", "html_url": "https://github.com/rust-lang/rust/commit/e7cab13037015082d5fe7deba59d8aec5dd894a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7cab13037015082d5fe7deba59d8aec5dd894a2/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89753077fc25abb9d04d24a2b2b73984854f7c3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/89753077fc25abb9d04d24a2b2b73984854f7c3a", "html_url": "https://github.com/rust-lang/rust/commit/89753077fc25abb9d04d24a2b2b73984854f7c3a"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "5fbcb687f0968da1dcac5ae6f1fe57de7b979ff4", "filename": "src/librustc_trans/trans/mir/rvalue.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e7cab13037015082d5fe7deba59d8aec5dd894a2/src%2Flibrustc_trans%2Ftrans%2Fmir%2Frvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7cab13037015082d5fe7deba59d8aec5dd894a2/src%2Flibrustc_trans%2Ftrans%2Fmir%2Frvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmir%2Frvalue.rs?ref=e7cab13037015082d5fe7deba59d8aec5dd894a2", "patch": "@@ -102,7 +102,8 @@ impl<'bcx, 'tcx> MirContext<'bcx, 'tcx> {\n                     mir::AggregateKind::Adt(adt_def, index, _)\n                     if adt_def.variants[index].kind() == ty::VariantKind::Unit => {\n                         let repr = adt::represent_type(bcx.ccx(), dest.ty.to_ty(bcx.tcx()));\n-                        adt::trans_set_discr(bcx, &*repr, dest.llval, 0);\n+                        let disr = adt_def.variants[index].disr_val;\n+                        adt::trans_set_discr(bcx, &*repr, dest.llval, disr);\n                     },\n                     _ => {\n                         for (i, operand) in operands.iter().enumerate() {"}, {"sha": "b46ec0d8764d9c35ae9f516ea0b6539aba9b2800", "filename": "src/test/run-pass/mir_refs_correct.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e7cab13037015082d5fe7deba59d8aec5dd894a2/src%2Ftest%2Frun-pass%2Fmir_refs_correct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7cab13037015082d5fe7deba59d8aec5dd894a2/src%2Ftest%2Frun-pass%2Fmir_refs_correct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmir_refs_correct.rs?ref=e7cab13037015082d5fe7deba59d8aec5dd894a2", "patch": "@@ -59,6 +59,12 @@ enum E {\n     U(u8)\n }\n \n+#[derive(PartialEq, Debug, Eq)]\n+enum CEnum {\n+    A = 0x321,\n+    B = 0x123\n+}\n+\n const C: u8 = 84;\n const C2: [u8; 5] = [42; 5];\n const C3: [u8; 3] = [42, 41, 40];\n@@ -187,6 +193,11 @@ fn t22() -> Option<u8> {\n     None\n }\n \n+#[rustc_mir]\n+fn t23() -> (CEnum, CEnum) {\n+    (CEnum::A, CEnum::B)\n+}\n+\n fn main(){\n     unsafe {\n         assert_eq!(t1()(), regular());\n@@ -228,5 +239,6 @@ fn main(){\n         assert_eq!(t20()(123u64, 38u32), <u32 as T<_, _>>::staticmeth(123, 38));\n         assert_eq!(t21(), Unit);\n         assert_eq!(t22(), None);\n+        assert_eq!(t23(), (CEnum::A, CEnum::B));\n     }\n }"}]}