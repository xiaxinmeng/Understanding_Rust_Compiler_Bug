{"sha": "76679c1f91fc68134c850b2d77ff2b83b32a108f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2Njc5YzFmOTFmYzY4MTM0Yzg1MGIyZDc3ZmYyYjgzYjMyYTEwOGY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-02-01T01:52:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-02-01T08:00:17Z"}, "message": "DO NOT COMMIT", "tree": {"sha": "036d7f4ebcca1f6b22ddd8f157230f7b75c0bc03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/036d7f4ebcca1f6b22ddd8f157230f7b75c0bc03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76679c1f91fc68134c850b2d77ff2b83b32a108f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76679c1f91fc68134c850b2d77ff2b83b32a108f", "html_url": "https://github.com/rust-lang/rust/commit/76679c1f91fc68134c850b2d77ff2b83b32a108f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76679c1f91fc68134c850b2d77ff2b83b32a108f/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63c16e9e79839ba767e2a8c7172d9a330c782600", "url": "https://api.github.com/repos/rust-lang/rust/commits/63c16e9e79839ba767e2a8c7172d9a330c782600", "html_url": "https://github.com/rust-lang/rust/commit/63c16e9e79839ba767e2a8c7172d9a330c782600"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "50aa478b74b9c3454879dc143c48496fc5242dbf", "filename": "src/librustc/middle/trans/glue.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/76679c1f91fc68134c850b2d77ff2b83b32a108f/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76679c1f91fc68134c850b2d77ff2b83b32a108f/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs?ref=76679c1f91fc68134c850b2d77ff2b83b32a108f", "patch": "@@ -571,9 +571,30 @@ pub fn decr_refcnt_maybe_free(bcx: block,\n     }\n }\n \n+pub fn copy_glue_should_never_be_called(bcx: block, t: ty::t) -> bool {\n+    match ty::get(t).sty {\n+        ty::ty_infer(*)\n+        | ty::ty_type\n+        | ty::ty_opaque_closure_ptr(*)\n+        | ty::ty_opaque_box\n+        | ty::ty_unboxed_vec(*)\n+        | ty::ty_err => {\n+            // Not sure under what scenarios these non-types get take glue\n+            false\n+        }\n+        _ => !ty::type_is_copyable(bcx.tcx(), t)\n+    }\n+}\n \n pub fn make_take_glue(bcx: block, v: ValueRef, t: ty::t) {\n     let _icx = bcx.insn_ctxt(\"make_take_glue\");\n+\n+    if copy_glue_should_never_be_called(bcx, t) {\n+        controlflow::trans_fail(bcx, bcx.fcx.span,\n+                                ~\"calling take glue on non-copyable\");\n+        return;\n+    }\n+\n     // NB: v is a *pointer* to type t here, not a direct value.\n     let bcx = match ty::get(t).sty {\n       ty::ty_box(_) | ty::ty_opaque_box |"}, {"sha": "48e6a3145f01b08eb4a924e2ab1dd25ff6320e5a", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/76679c1f91fc68134c850b2d77ff2b83b32a108f/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76679c1f91fc68134c850b2d77ff2b83b32a108f/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=76679c1f91fc68134c850b2d77ff2b83b32a108f", "patch": "@@ -2181,7 +2181,8 @@ pub fn type_kind_ext(cx: ctxt, ty: t, allow_ty_var: bool) -> Kind {\n \n       ty_type | ty_opaque_closure_ptr(_)\n       | ty_opaque_box | ty_unboxed_vec(_) | ty_err => {\n-        cx.sess.bug(~\"Asked to compute kind of fictitious type\");\n+          kind_copyable()\n+        //cx.sess.bug(~\"Asked to compute kind of fictitious type\");\n       }\n     };\n "}]}