{"sha": "1aee8083bec509ad290650209d0623db574609d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhZWU4MDgzYmVjNTA5YWQyOTA2NTAyMDlkMDYyM2RiNTc0NjA5ZDM=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-03-11T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-03-11T00:00:00Z"}, "message": "Import small cold functions\n\nThe Rust code is often written under an assumption that for generic\nmethods inline attribute is mostly unnecessary, since for optimized\nbuilds using ThinLTO, a method will be generated in at least one CGU and\navailable for import.\n\nFor example, deref implementations for Box, Vec, MutexGuard, and\nMutexGuard are not currently marked as inline, neither is identity\nimplementation of From trait.\n\nIn PGO builds, when functions are determined to be cold, the default\nmultiplier of zero will stop the import, even for completely trivial\nfunctions.\n\nIncrease slightly the default multiplier from 0 to 0.1 to import them\nregardless.", "tree": {"sha": "55e337e131503609f6c9dcc7274e887a37a5fdc0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/55e337e131503609f6c9dcc7274e887a37a5fdc0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1aee8083bec509ad290650209d0623db574609d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1aee8083bec509ad290650209d0623db574609d3", "html_url": "https://github.com/rust-lang/rust/commit/1aee8083bec509ad290650209d0623db574609d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1aee8083bec509ad290650209d0623db574609d3/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04fce73196638cbb203e2b0dd2a16230ff6e265b", "url": "https://api.github.com/repos/rust-lang/rust/commits/04fce73196638cbb203e2b0dd2a16230ff6e265b", "html_url": "https://github.com/rust-lang/rust/commit/04fce73196638cbb203e2b0dd2a16230ff6e265b"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "93bad74cd215e99fc8b393ee2e0544ff1283b7f6", "filename": "compiler/rustc_codegen_llvm/src/llvm_util.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1aee8083bec509ad290650209d0623db574609d3/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1aee8083bec509ad290650209d0623db574609d3/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs?ref=1aee8083bec509ad290650209d0623db574609d3", "patch": "@@ -98,6 +98,9 @@ unsafe fn configure_llvm(sess: &Session) {\n         // during inlining. Unfortunately these may block other optimizations.\n         add(\"-preserve-alignment-assumptions-during-inlining=false\", false);\n \n+        // Use non-zero `import-instr-limit` multiplier for cold callsites.\n+        add(\"-import-cold-multiplier=0.1\", false);\n+\n         for arg in sess_args {\n             add(&(*arg), true);\n         }"}]}