{"sha": "b61617f752668d1425133d0bf32d62dd1135c66a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2MTYxN2Y3NTI2NjhkMTQyNTEzM2QwYmYzMmQ2MmRkMTEzNWM2NmE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-01-08T18:57:19Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-01-08T18:57:19Z"}, "message": "G: special-case C++ semicolon", "tree": {"sha": "fcebd2559edc831d0f9d375d90e85a4252b4c6fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fcebd2559edc831d0f9d375d90e85a4252b4c6fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b61617f752668d1425133d0bf32d62dd1135c66a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b61617f752668d1425133d0bf32d62dd1135c66a", "html_url": "https://github.com/rust-lang/rust/commit/b61617f752668d1425133d0bf32d62dd1135c66a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b61617f752668d1425133d0bf32d62dd1135c66a/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea186fe2c073dfd56f834068ee928a9c875b0279", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea186fe2c073dfd56f834068ee928a9c875b0279", "html_url": "https://github.com/rust-lang/rust/commit/ea186fe2c073dfd56f834068ee928a9c875b0279"}], "stats": {"total": 67, "additions": 58, "deletions": 9}, "files": [{"sha": "631eb473649c4d4a30e7d0e92a56b0e0d0ae5607", "filename": "src/parser/event_parser/grammar/items.rs", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/b61617f752668d1425133d0bf32d62dd1135c66a/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b61617f752668d1425133d0bf32d62dd1135c66a/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems.rs?ref=b61617f752668d1425133d0bf32d62dd1135c66a", "patch": "@@ -1,17 +1,40 @@\n use super::*;\n \n-pub(super) fn item_first(p: &Parser) -> bool {\n+pub(super) fn mod_items(p: &mut Parser) {\n+    many(p, |p| {\n+        skip_to_first(\n+            p, item_first, mod_item,\n+            \"expected item\",\n+        )\n+    });\n+}\n+\n+fn item_first(p: &Parser) -> bool {\n     match p.current() {\n         STRUCT_KW | FN_KW => true,\n         _ => false,\n     }\n }\n \n-pub(super) fn item(p: &mut Parser) {\n+fn mod_item(p: &mut Parser) {\n+    if item(p) {\n+        if p.current() == SEMI {\n+            node(p, ERROR, |p| {\n+                p.error()\n+                    .message(\"expected item, found `;`\\n\\\n+                              consider removing this semicolon\")\n+                    .emit();\n+                p.bump();\n+            })\n+        }\n+    }\n+}\n+\n+fn item(p: &mut Parser) -> bool {\n     attributes::outer_attributes(p);\n     visibility(p);\n     node_if(p, STRUCT_KW, STRUCT_ITEM, struct_item)\n-        || node_if(p, FN_KW, FN_ITEM, fn_item);\n+        || node_if(p, FN_KW, FN_ITEM, fn_item)\n }\n \n fn struct_item(p: &mut Parser) {"}, {"sha": "274c2cdb469593e7cfd3aaae1713767d0596ebfd", "filename": "src/parser/event_parser/grammar/mod.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b61617f752668d1425133d0bf32d62dd1135c66a/src%2Fparser%2Fevent_parser%2Fgrammar%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b61617f752668d1425133d0bf32d62dd1135c66a/src%2Fparser%2Fevent_parser%2Fgrammar%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fevent_parser%2Fgrammar%2Fmod.rs?ref=b61617f752668d1425133d0bf32d62dd1135c66a", "patch": "@@ -11,12 +11,7 @@ pub(crate) fn file(p: &mut Parser) {\n     node(p, FILE, |p| {\n         p.optional(SHEBANG);\n         attributes::inner_attributes(p);\n-        many(p, |p| {\n-            skip_to_first(\n-                p, items::item_first, items::item,\n-                \"expected item\",\n-            )\n-        });\n+        items::mod_items(p);\n     })\n }\n "}, {"sha": "009312270fed076f92a459447f72c1c0436d1378", "filename": "tests/data/parser/err/0003_C++_semicolon.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b61617f752668d1425133d0bf32d62dd1135c66a/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b61617f752668d1425133d0bf32d62dd1135c66a/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.rs?ref=b61617f752668d1425133d0bf32d62dd1135c66a", "patch": "@@ -0,0 +1,4 @@\n+struct S {\n+    a: i32,\n+    b: String,\n+};\n\\ No newline at end of file"}, {"sha": "9308bb3305c38eb23877d5a23575fd77196ac85b", "filename": "tests/data/parser/err/0003_C++_semicolon.txt", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/b61617f752668d1425133d0bf32d62dd1135c66a/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.txt", "raw_url": "https://github.com/rust-lang/rust/raw/b61617f752668d1425133d0bf32d62dd1135c66a/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Ferr%2F0003_C%2B%2B_semicolon.txt?ref=b61617f752668d1425133d0bf32d62dd1135c66a", "patch": "@@ -0,0 +1,27 @@\n+FILE@[0; 40)\n+  STRUCT_ITEM@[0; 39)\n+    STRUCT_KW@[0; 6)\n+    WHITESPACE@[6; 7)\n+    IDENT@[7; 8)\n+    WHITESPACE@[8; 9)\n+    L_CURLY@[9; 10)\n+    STRUCT_FIELD@[10; 21)\n+      WHITESPACE@[10; 15)\n+      IDENT@[15; 16)\n+      COLON@[16; 17)\n+      WHITESPACE@[17; 18)\n+      IDENT@[18; 21)\n+    COMMA@[21; 22)\n+    STRUCT_FIELD@[22; 36)\n+      WHITESPACE@[22; 27)\n+      IDENT@[27; 28)\n+      COLON@[28; 29)\n+      WHITESPACE@[29; 30)\n+      IDENT@[30; 36)\n+    COMMA@[36; 37)\n+    WHITESPACE@[37; 38)\n+    R_CURLY@[38; 39)\n+  ERROR@[39; 40)\n+  err: `expected item, found `;`\n+consider removing this semicolon`\n+    SEMI@[39; 40)"}]}