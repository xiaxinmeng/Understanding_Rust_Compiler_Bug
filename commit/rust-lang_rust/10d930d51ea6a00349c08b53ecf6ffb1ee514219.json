{"sha": "10d930d51ea6a00349c08b53ecf6ffb1ee514219", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEwZDkzMGQ1MWVhNmEwMDM0OWMwOGI1M2VjZjZmZmIxZWU1MTQyMTk=", "commit": {"author": {"name": "Brian Leibig", "email": "brian.leibig@gmail.com", "date": "2013-04-09T03:13:00Z"}, "committer": {"name": "Brian Leibig", "email": "brian.leibig@gmail.com", "date": "2013-04-10T16:45:54Z"}, "message": "Prevent debug info generation of zero-span nodes\n\nIf a node has a (0, 0) span, it was not in the source, so debug symbols should not be generated for it.", "tree": {"sha": "cc52520c908cd97b8cb6f7cea1a934b6b80c7d5b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc52520c908cd97b8cb6f7cea1a934b6b80c7d5b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/10d930d51ea6a00349c08b53ecf6ffb1ee514219", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/10d930d51ea6a00349c08b53ecf6ffb1ee514219", "html_url": "https://github.com/rust-lang/rust/commit/10d930d51ea6a00349c08b53ecf6ffb1ee514219", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/10d930d51ea6a00349c08b53ecf6ffb1ee514219/comments", "author": {"login": "bleibig", "id": 1253302, "node_id": "MDQ6VXNlcjEyNTMzMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1253302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bleibig", "html_url": "https://github.com/bleibig", "followers_url": "https://api.github.com/users/bleibig/followers", "following_url": "https://api.github.com/users/bleibig/following{/other_user}", "gists_url": "https://api.github.com/users/bleibig/gists{/gist_id}", "starred_url": "https://api.github.com/users/bleibig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bleibig/subscriptions", "organizations_url": "https://api.github.com/users/bleibig/orgs", "repos_url": "https://api.github.com/users/bleibig/repos", "events_url": "https://api.github.com/users/bleibig/events{/privacy}", "received_events_url": "https://api.github.com/users/bleibig/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bleibig", "id": 1253302, "node_id": "MDQ6VXNlcjEyNTMzMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1253302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bleibig", "html_url": "https://github.com/bleibig", "followers_url": "https://api.github.com/users/bleibig/followers", "following_url": "https://api.github.com/users/bleibig/following{/other_user}", "gists_url": "https://api.github.com/users/bleibig/gists{/gist_id}", "starred_url": "https://api.github.com/users/bleibig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bleibig/subscriptions", "organizations_url": "https://api.github.com/users/bleibig/orgs", "repos_url": "https://api.github.com/users/bleibig/repos", "events_url": "https://api.github.com/users/bleibig/events{/privacy}", "received_events_url": "https://api.github.com/users/bleibig/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf22d749eb9717e1e5befa727db5a9f7c47e8f48", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf22d749eb9717e1e5befa727db5a9f7c47e8f48", "html_url": "https://github.com/rust-lang/rust/commit/cf22d749eb9717e1e5befa727db5a9f7c47e8f48"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "b8a14cb329b0457f3fb83cc06fa68e02f0e85199", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/10d930d51ea6a00349c08b53ecf6ffb1ee514219/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10d930d51ea6a00349c08b53ecf6ffb1ee514219/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=10d930d51ea6a00349c08b53ecf6ffb1ee514219", "patch": "@@ -131,6 +131,13 @@ impl get_insn_ctxt for fn_ctxt {\n     }\n }\n \n+fn fcx_has_nonzero_span(fcx: fn_ctxt) -> bool {\n+    match fcx.span {\n+        None => true,\n+        Some(span) => *span.lo != 0 || *span.hi != 0\n+    }\n+}\n+\n pub fn log_fn_time(ccx: @CrateContext, +name: ~str, start: time::Timespec,\n                    end: time::Timespec) {\n     let elapsed = 1000 * ((end.sec - start.sec) as int) +\n@@ -1158,7 +1165,8 @@ pub fn trans_stmt(cx: block, s: ast::stmt) -> block {\n                 ast::decl_local(ref locals) => {\n                     for locals.each |local| {\n                         bcx = init_local(bcx, *local);\n-                        if cx.sess().opts.extra_debuginfo {\n+                        if cx.sess().opts.extra_debuginfo\n+                            && fcx_has_nonzero_span(bcx.fcx) {\n                             debuginfo::create_local_var(bcx, *local);\n                         }\n                     }\n@@ -1738,7 +1746,7 @@ pub fn copy_args_to_allocas(fcx: fn_ctxt,\n \n         fcx.llargs.insert(arg_id, local_mem(llarg));\n \n-        if fcx.ccx.sess.opts.extra_debuginfo {\n+        if fcx.ccx.sess.opts.extra_debuginfo && fcx_has_nonzero_span(fcx) {\n             debuginfo::create_arg(bcx, args[arg_n], args[arg_n].ty.span);\n         }\n     }\n@@ -1861,7 +1869,8 @@ pub fn trans_fn(ccx: @CrateContext,\n     trans_closure(ccx, path, decl, body, llfndecl, ty_self,\n                   param_substs, id, impl_id,\n                   |fcx| {\n-                      if ccx.sess.opts.extra_debuginfo {\n+                      if ccx.sess.opts.extra_debuginfo\n+                          && fcx_has_nonzero_span(fcx) {\n                           debuginfo::create_function(fcx);\n                       }\n                   },"}, {"sha": "31f89deff5d7fac6f1432da0b9c71d1839462b96", "filename": "src/librustc/middle/trans/debuginfo.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/10d930d51ea6a00349c08b53ecf6ffb1ee514219/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10d930d51ea6a00349c08b53ecf6ffb1ee514219/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fdebuginfo.rs?ref=10d930d51ea6a00349c08b53ecf6ffb1ee514219", "patch": "@@ -946,7 +946,7 @@ pub fn create_arg(bcx: block, arg: ast::arg, sp: span)\n }\n \n pub fn update_source_pos(cx: block, s: span) {\n-    if !cx.sess().opts.debuginfo {\n+    if !cx.sess().opts.debuginfo || (*s.lo == 0 && *s.hi == 0) {\n         return;\n     }\n     let cm = cx.sess().codemap;"}]}