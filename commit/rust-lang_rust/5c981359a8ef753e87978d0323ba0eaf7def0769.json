{"sha": "5c981359a8ef753e87978d0323ba0eaf7def0769", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjOTgxMzU5YThlZjc1M2U4Nzk3OGQwMzIzYmEwZWFmN2RlZjA3Njk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-23T00:25:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-23T00:25:05Z"}, "message": "Auto merge of #6483 - xFrednet:5386-github-ticket-search, r=killercup\n\nWebsite issue tracker link and better search performance\n\nThis PR implements some improvements to the website:\n1. Added a \"Search on Github\" link to the \"Known problems\" section (Closes #5386)\n    ![example_3](https://user-images.githubusercontent.com/17087237/102718215-e9f12500-42de-11eb-8c1b-487f8184aaf7.png)\n    <details>\n    <summary>Another mock up I created with the GitHub logo</summary>\n\n    ![example_2](https://user-images.githubusercontent.com/17087237/102718281-3472a180-42df-11eb-99b8-7f6d76da2b55.png)\n\n    </details>\n\n2. Only starting the search after three letters and improving the search performance in general. (Followup #6477)\n\n### Testing\nThese changes can be tested locally by:\n1. Clone this branch\n2. Download the current lint index from the [gh-pages branch](https://github.com/rust-lang/rust-clippy/blob/gh-pages/master/lints.json)\n3. Put it next to the `util/gh-pages/index.html` and open the html file. Make sure that it can load the lint data. (Browsers can be a bit iffy when opening a local html page and loading data)\n\n### Sources for search performance:\n1. [A stackoverflow about angular filter performance](https://stackoverflow.com/questions/26876514/optimize-angular-filter-performance)\n    * I selected a search debounce of 50ms that's fast enough to catch fast deletion and typing but responsive enough to not bother the user\n2. [A stackoverflow about string comparison speeds](https://stackoverflow.com/questions/5296268/fastest-way-to-check-a-string-contain-another-substring-in-javascript)\n3. [JS benchmarks for string search performance (`indexOf` seams to be the best)](https://jsben.ch/9cwLJ)\n\nNote: The performance is still a bit poor when going from a specific lint to no search filter. I suspect that angular is recreating all lint items when the filter is cleared causing a major lag spike. The filter functions is at least optimized for little to no search.\n\n---\n\nchangelog: Added a \"Search on GitHub\" link to the website", "tree": {"sha": "0403c45ac9114b331ee07ee925dfabf92b14ad97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0403c45ac9114b331ee07ee925dfabf92b14ad97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c981359a8ef753e87978d0323ba0eaf7def0769", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c981359a8ef753e87978d0323ba0eaf7def0769", "html_url": "https://github.com/rust-lang/rust/commit/5c981359a8ef753e87978d0323ba0eaf7def0769", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c981359a8ef753e87978d0323ba0eaf7def0769/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "971e5b33dafbe9a656b048d92d6cd39fddbcb152", "url": "https://api.github.com/repos/rust-lang/rust/commits/971e5b33dafbe9a656b048d92d6cd39fddbcb152", "html_url": "https://github.com/rust-lang/rust/commit/971e5b33dafbe9a656b048d92d6cd39fddbcb152"}, {"sha": "f055e7f2e9cc7233dd31384afdb303d362578012", "url": "https://api.github.com/repos/rust-lang/rust/commits/f055e7f2e9cc7233dd31384afdb303d362578012", "html_url": "https://github.com/rust-lang/rust/commit/f055e7f2e9cc7233dd31384afdb303d362578012"}], "stats": {"total": 54, "additions": 31, "deletions": 23}, "files": [{"sha": "1852fb6640ecc9093ce712ecf1e8d4f8b159011a", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 31, "deletions": 23, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/5c981359a8ef753e87978d0323ba0eaf7def0769/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/5c981359a8ef753e87978d0323ba0eaf7def0769/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=5c981359a8ef753e87978d0323ba0eaf7def0769", "patch": "@@ -77,7 +77,7 @@ <h1>ALL the Clippy Lints</h1>\n                     <div class=\"col-md-12 form-horizontal\">\n                         <div class=\"input-group\">\n                             <label class=\"input-group-addon\" id=\"filter-label\" for=\"filter-input\">Filter:</label>\n-                            <input type=\"text\" class=\"form-control\" placeholder=\"Keywords or search string\" id=\"filter-input\" ng-model=\"search\" />\n+                            <input type=\"text\" class=\"form-control\" placeholder=\"Keywords or search string\" id=\"filter-input\" ng-model=\"search\" ng-model-options=\"{debounce: 50}\"/>\n                             <span class=\"input-group-btn\">\n                                 <button class=\"btn btn-default\" type=\"button\" ng-click=\"search = ''\">\n                                     Clear\n@@ -119,6 +119,7 @@ <h4 class=\"list-group-item-heading\">\n                             {{title}}\n                         </h4>\n                         <div class=\"list-group-item-text\" ng-bind-html=\"text | markdown\"></div>\n+                        <a ng-if=\"title == 'Known problems'\" href=\"https://github.com/rust-lang/rust-clippy/issues?q=is%3Aissue+is%3Aopen+{{lint.id}}\">Search on GitHub</a>\n                     </li>\n                 </ul>\n             </article>\n@@ -180,6 +181,22 @@ <h4 class=\"list-group-item-heading\">\n             }\n         }\n \n+        function searchLint(lint, term) {\n+            for (const field in lint.docs) {\n+                // Continue if it's not a property\n+                if (!lint.docs.hasOwnProperty(field)) {\n+                    continue;\n+                }\n+\n+                // Return if not found\n+                if (lint.docs[field].toLowerCase().indexOf(term) !== -1) {\n+                    return true;\n+                }\n+            }\n+\n+            return false;\n+        }\n+\n         angular.module(\"clippy\", [])\n         .filter('markdown', function ($sce) {\n             return function (text) {\n@@ -216,40 +233,31 @@ <h4 class=\"list-group-item-heading\">\n             };\n \n             $scope.bySearch = function (lint, index, array) {\n-                let search_str = $scope.search;\n+                let searchStr = $scope.search;\n                 // It can be `null` I haven't missed this value \n-                if (search_str == null || search_str.length == 0) {\n+                if (searchStr == null || searchStr.length < 3) {\n                     return true;\n                 }\n-                search_str = search_str.toLowerCase();\n+                searchStr = searchStr.toLowerCase();\n \n                 // Search by id\n-                let id_search = search_str.trim().replace(/(\\-| )/g, \"_\");\n-                if (lint.id.includes(id_search)) {\n+                if (lint.id.indexOf(searchStr.replace(\"-\", \"_\")) !== -1) {\n                     return true;\n                 }\n \n                 // Search the description\n                 // The use of `for`-loops instead of `foreach` enables us to return early \n-                let search_lint = (lint, therm) => {\n-                    for (const field in lint.docs) {\n-                        // Continue if it's not a property\n-                        if (!lint.docs.hasOwnProperty(field)) {\n-                            continue;\n-                        }\n-\n-                        // Return if not found\n-                        if (lint.docs[field].toLowerCase().includes(therm)) {\n-                            return true;\n-                        }\n+                let terms = searchStr.split(\" \");\n+                for (index = 0; index < terms.length; index++) {\n+                    if (lint.id.indexOf(terms[index]) !== -1) {\n+                        continue;\n                     }\n-                    return false;\n-                };\n-                let therms = search_str.split(\" \");\n-                for (index = 0; index < therms.length; index++) {\n-                    if (!search_lint(lint, therms[index])) {\n-                        return false;\n+\n+                    if (searchLint(lint, terms[index])) {\n+                        continue;\n                     }\n+\n+                    return false;\n                 }\n \n                 return true;"}]}