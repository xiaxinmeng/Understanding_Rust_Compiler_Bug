{"sha": "af44a2a857618150b180dabe9c3383a3911b3640", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmNDRhMmE4NTc2MTgxNTBiMTgwZGFiZTljMzM4M2EzOTExYjM2NDA=", "commit": {"author": {"name": "Alexis Bourget", "email": "alexis.bourget@gmail.com", "date": "2020-09-08T20:45:56Z"}, "committer": {"name": "Alexis Bourget", "email": "alexis.bourget@gmail.com", "date": "2020-09-21T19:50:25Z"}, "message": "move 'cell does not clone' test", "tree": {"sha": "bc863d48a05ef8059f6e6deaf4b0fc2138ed5522", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc863d48a05ef8059f6e6deaf4b0fc2138ed5522"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af44a2a857618150b180dabe9c3383a3911b3640", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af44a2a857618150b180dabe9c3383a3911b3640", "html_url": "https://github.com/rust-lang/rust/commit/af44a2a857618150b180dabe9c3383a3911b3640", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af44a2a857618150b180dabe9c3383a3911b3640/comments", "author": {"login": "poliorcetics", "id": 7951708, "node_id": "MDQ6VXNlcjc5NTE3MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7951708?v=4", "gravatar_id": "", "url": "https://api.github.com/users/poliorcetics", "html_url": "https://github.com/poliorcetics", "followers_url": "https://api.github.com/users/poliorcetics/followers", "following_url": "https://api.github.com/users/poliorcetics/following{/other_user}", "gists_url": "https://api.github.com/users/poliorcetics/gists{/gist_id}", "starred_url": "https://api.github.com/users/poliorcetics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/poliorcetics/subscriptions", "organizations_url": "https://api.github.com/users/poliorcetics/orgs", "repos_url": "https://api.github.com/users/poliorcetics/repos", "events_url": "https://api.github.com/users/poliorcetics/events{/privacy}", "received_events_url": "https://api.github.com/users/poliorcetics/received_events", "type": "User", "site_admin": false}, "committer": {"login": "poliorcetics", "id": 7951708, "node_id": "MDQ6VXNlcjc5NTE3MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7951708?v=4", "gravatar_id": "", "url": "https://api.github.com/users/poliorcetics", "html_url": "https://github.com/poliorcetics", "followers_url": "https://api.github.com/users/poliorcetics/followers", "following_url": "https://api.github.com/users/poliorcetics/following{/other_user}", "gists_url": "https://api.github.com/users/poliorcetics/gists{/gist_id}", "starred_url": "https://api.github.com/users/poliorcetics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/poliorcetics/subscriptions", "organizations_url": "https://api.github.com/users/poliorcetics/orgs", "repos_url": "https://api.github.com/users/poliorcetics/repos", "events_url": "https://api.github.com/users/poliorcetics/events{/privacy}", "received_events_url": "https://api.github.com/users/poliorcetics/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f69c5aa428efdbc01685c3d06e63fedd3120e8e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/f69c5aa428efdbc01685c3d06e63fedd3120e8e5", "html_url": "https://github.com/rust-lang/rust/commit/f69c5aa428efdbc01685c3d06e63fedd3120e8e5"}], "stats": {"total": 49, "additions": 23, "deletions": 26}, "files": [{"sha": "796c937eaff01f19b6a4b0afa2b222c9a1c601ce", "filename": "library/core/tests/cell.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/af44a2a857618150b180dabe9c3383a3911b3640/library%2Fcore%2Ftests%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af44a2a857618150b180dabe9c3383a3911b3640/library%2Fcore%2Ftests%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fcell.rs?ref=af44a2a857618150b180dabe9c3383a3911b3640", "patch": "@@ -327,6 +327,29 @@ fn cell_exterior() {\n     assert_eq!(b.get().z, 13);\n }\n \n+#[test]\n+fn cell_does_not_clone() {\n+    #[derive(Copy)]\n+    #[allow(dead_code)]\n+    struct Foo {\n+        x: isize,\n+    }\n+\n+    impl Clone for Foo {\n+        fn clone(&self) -> Foo {\n+            // Using Cell in any way should never cause clone() to be\n+            // invoked -- after all, that would permit evil user code to\n+            // abuse `Cell` and trigger crashes.\n+\n+            panic!();\n+        }\n+    }\n+\n+    let x = Cell::new(Foo { x: 22 });\n+    let _y = x.get();\n+    let _z = x.clone();\n+}\n+\n #[test]\n fn refcell_default() {\n     let cell: RefCell<u64> = Default::default();"}, {"sha": "587447b54b7fdc038eced045ea862bf0108ed87d", "filename": "src/test/ui/cell-does-not-clone.rs", "status": "removed", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f69c5aa428efdbc01685c3d06e63fedd3120e8e5/src%2Ftest%2Fui%2Fcell-does-not-clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69c5aa428efdbc01685c3d06e63fedd3120e8e5/src%2Ftest%2Fui%2Fcell-does-not-clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcell-does-not-clone.rs?ref=f69c5aa428efdbc01685c3d06e63fedd3120e8e5", "patch": "@@ -1,26 +0,0 @@\n-// run-pass\n-\n-#![allow(dead_code)]\n-\n-use std::cell::Cell;\n-\n-#[derive(Copy)]\n-struct Foo {\n-    x: isize\n-}\n-\n-impl Clone for Foo {\n-    fn clone(&self) -> Foo {\n-        // Using Cell in any way should never cause clone() to be\n-        // invoked -- after all, that would permit evil user code to\n-        // abuse `Cell` and trigger crashes.\n-\n-        panic!();\n-    }\n-}\n-\n-pub fn main() {\n-    let x = Cell::new(Foo { x: 22 });\n-    let _y = x.get();\n-    let _z = x.clone();\n-}"}]}