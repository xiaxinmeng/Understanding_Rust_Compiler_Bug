{"sha": "0ab44584aa058a5b95cb8a3bd268046ccf71066a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhYjQ0NTg0YWEwNThhNWI5NWNiOGEzYmQyNjgwNDZjY2Y3MTA2NmE=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-11-19T04:36:55Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-11-19T04:36:55Z"}, "message": "Revert \"Normalize function type during validation\"\n\nThis reverts commit d486bfcbff107e8a6769e00c59d02b13c664b6ee.", "tree": {"sha": "abfda4ff0e481156e6cbfba7967c69843d14b01d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abfda4ff0e481156e6cbfba7967c69843d14b01d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0ab44584aa058a5b95cb8a3bd268046ccf71066a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0ab44584aa058a5b95cb8a3bd268046ccf71066a", "html_url": "https://github.com/rust-lang/rust/commit/0ab44584aa058a5b95cb8a3bd268046ccf71066a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0ab44584aa058a5b95cb8a3bd268046ccf71066a/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8247223f74e327f923a49ae208c9aa1547ad7ce1", "url": "https://api.github.com/repos/rust-lang/rust/commits/8247223f74e327f923a49ae208c9aa1547ad7ce1", "html_url": "https://github.com/rust-lang/rust/commit/8247223f74e327f923a49ae208c9aa1547ad7ce1"}], "stats": {"total": 24, "additions": 8, "deletions": 16}, "files": [{"sha": "919e4a90a1716ca49d8995b2ba7d643e3690ace8", "filename": "compiler/rustc_mir/src/transform/validate.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0ab44584aa058a5b95cb8a3bd268046ccf71066a/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fvalidate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ab44584aa058a5b95cb8a3bd268046ccf71066a/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fvalidate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fvalidate.rs?ref=0ab44584aa058a5b95cb8a3bd268046ccf71066a", "patch": "@@ -364,9 +364,7 @@ impl<'a, 'tcx> Visitor<'tcx> for TypeChecker<'a, 'tcx> {\n                 }\n             }\n             TerminatorKind::Call { func, args, destination, cleanup, .. } => {\n-                let param_env = self.param_env.with_reveal_all_normalized(self.tcx);\n                 let func_ty = func.ty(&self.body.local_decls, self.tcx);\n-                let func_ty = self.tcx.normalize_erasing_regions(param_env, func_ty);\n                 match func_ty.kind() {\n                     ty::FnPtr(..) | ty::FnDef(..) => {}\n                     _ => self.fail("}, {"sha": "fb4bf2b8b44e7642e5f68244b9057cd2234e4f8f", "filename": "src/test/ui/issues/issue-50865-private-impl-trait/auxiliary/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0ab44584aa058a5b95cb8a3bd268046ccf71066a/src%2Ftest%2Fui%2Fissues%2Fissue-50865-private-impl-trait%2Fauxiliary%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ab44584aa058a5b95cb8a3bd268046ccf71066a/src%2Ftest%2Fui%2Fissues%2Fissue-50865-private-impl-trait%2Fauxiliary%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-50865-private-impl-trait%2Fauxiliary%2Flib.rs?ref=0ab44584aa058a5b95cb8a3bd268046ccf71066a", "patch": "@@ -1,3 +1,7 @@\n+// revisions: default miropt\n+//[miropt]compile-flags: -Z mir-opt-level=2\n+// ~^ This flag is for #77668, it used to be ICE.\n+\n #![crate_type = \"lib\"]\n \n pub fn bar<P>( // Error won't happen if \"bar\" is not generic"}, {"sha": "4d083bf23215599a16ecf1c8f16cabcf6a678488", "filename": "src/test/ui/mir/mir-inlining/ice-issue-77306-1.rs", "status": "modified", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0ab44584aa058a5b95cb8a3bd268046ccf71066a/src%2Ftest%2Fui%2Fmir%2Fmir-inlining%2Fice-issue-77306-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ab44584aa058a5b95cb8a3bd268046ccf71066a/src%2Ftest%2Fui%2Fmir%2Fmir-inlining%2Fice-issue-77306-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmir%2Fmir-inlining%2Fice-issue-77306-1.rs?ref=0ab44584aa058a5b95cb8a3bd268046ccf71066a", "patch": "@@ -1,27 +1,17 @@\n-// Regression test for various issues related to normalization & inlining.\n-// * #68347, #77306, #77668 - missed normalization during inlining.\n-// * #78442 - missed normalization in validator after inlining.\n-//\n-// build-pass\n+// run-pass\n // compile-flags:-Zmir-opt-level=2\n \n+// Previously ICEd because we did not normalize during inlining,\n+// see https://github.com/rust-lang/rust/pull/77306 for more discussion.\n+\n pub fn write() {\n     create()()\n }\n \n-pub fn write_generic<T>(_t: T) {\n-    hide()();\n-}\n-\n pub fn create() -> impl FnOnce() {\n    || ()\n }\n \n-pub fn hide() -> impl Fn() {\n-    write\n-}\n-\n fn main() {\n     write();\n-    write_generic(());\n }"}]}