{"sha": "7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "node_id": "C_kwDOAAsO6NoAKDdkOTk4NjZiZmM0M2YzNGRiZGQ4NGY0YmY5ODJjNDhhNTFiNzBhOTk", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-12-23T18:41:06Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2023-01-14T09:11:04Z"}, "message": "fix #105061, Fix unused_parens issue for higher ranked function pointers", "tree": {"sha": "c01620bc933dd4f3fc811e87738cdcee2e32e9f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c01620bc933dd4f3fc811e87738cdcee2e32e9f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "html_url": "https://github.com/rust-lang/rust/commit/7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44a500c8c187b245638684748f54bd6ec67e0b25", "url": "https://api.github.com/repos/rust-lang/rust/commits/44a500c8c187b245638684748f54bd6ec67e0b25", "html_url": "https://github.com/rust-lang/rust/commit/44a500c8c187b245638684748f54bd6ec67e0b25"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "3901751c79fb0853646685d88a56f04dcf947256", "filename": "compiler/rustc_lint/src/early.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/compiler%2Frustc_lint%2Fsrc%2Fearly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/compiler%2Frustc_lint%2Fsrc%2Fearly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fearly.rs?ref=7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "patch": "@@ -248,6 +248,12 @@ impl<'a, T: EarlyLintPass> ast_visit::Visitor<'a> for EarlyContextAndPass<'a, T>\n     }\n \n     fn visit_where_predicate(&mut self, p: &'a ast::WherePredicate) {\n+        use rustc_ast::{WhereBoundPredicate, WherePredicate};\n+        if let WherePredicate::BoundPredicate(WhereBoundPredicate { bounded_ty, .. }) = p &&\n+            let ast::TyKind::BareFn(b) = &bounded_ty.kind &&\n+            b.generic_params.len() > 0 {\n+                return;\n+        }\n         ast_visit::walk_where_predicate(self, p);\n     }\n "}, {"sha": "94a33138107171218c9f600b9b8c6c270e379d70", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "patch": "@@ -1002,7 +1002,6 @@ impl EarlyLintPass for UnusedParens {\n         if let ast::TyKind::Paren(r) = &ty.kind {\n             match &r.kind {\n                 ast::TyKind::TraitObject(..) => {}\n-                ast::TyKind::BareFn(b) if b.generic_params.len() > 0 => {}\n                 ast::TyKind::ImplTrait(_, bounds) if bounds.len() > 1 => {}\n                 ast::TyKind::Array(_, len) => {\n                     self.check_unused_delims_expr("}, {"sha": "92d636d0ac62de4acbd857a8dc2a69c7af676e80", "filename": "tests/ui/lint/unused/issue-105061.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/tests%2Fui%2Flint%2Funused%2Fissue-105061.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/tests%2Fui%2Flint%2Funused%2Fissue-105061.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Funused%2Fissue-105061.rs?ref=7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "patch": "@@ -0,0 +1,17 @@\n+#![warn(unused)]\n+#![deny(warnings)]\n+\n+struct Inv<'a>(&'a mut &'a ());\n+\n+trait Trait {}\n+impl Trait for (for<'a> fn(Inv<'a>),) {}\n+\n+\n+fn with_bound()\n+where\n+    ((for<'a> fn(Inv<'a>)),): Trait, //~ ERROR unnecessary parentheses around type\n+{}\n+\n+fn main() {\n+    with_bound();\n+}"}, {"sha": "f07aa2012df5f48d6a346eeef830f0ef01090614", "filename": "tests/ui/lint/unused/issue-105061.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/tests%2Fui%2Flint%2Funused%2Fissue-105061.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7d99866bfc43f34dbdd84f4bf982c48a51b70a99/tests%2Fui%2Flint%2Funused%2Fissue-105061.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Funused%2Fissue-105061.stderr?ref=7d99866bfc43f34dbdd84f4bf982c48a51b70a99", "patch": "@@ -0,0 +1,20 @@\n+error: unnecessary parentheses around type\n+  --> $DIR/issue-105061.rs:12:6\n+   |\n+LL |     ((for<'a> fn(Inv<'a>)),): Trait,\n+   |      ^                   ^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/issue-105061.rs:2:9\n+   |\n+LL | #![deny(warnings)]\n+   |         ^^^^^^^^\n+   = note: `#[deny(unused_parens)]` implied by `#[deny(warnings)]`\n+help: remove these parentheses\n+   |\n+LL -     ((for<'a> fn(Inv<'a>)),): Trait,\n+LL +     (for<'a> fn(Inv<'a>),): Trait,\n+   |\n+\n+error: aborting due to previous error\n+"}]}