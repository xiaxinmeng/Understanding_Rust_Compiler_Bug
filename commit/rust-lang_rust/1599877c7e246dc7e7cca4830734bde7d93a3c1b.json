{"sha": "1599877c7e246dc7e7cca4830734bde7d93a3c1b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1OTk4NzdjN2UyNDZkYzdlN2NjYTQ4MzA3MzRiZGU3ZDkzYTNjMWI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-04T07:21:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-04T07:21:34Z"}, "message": "Rollup merge of #60527 - davidtwco:issue-60518, r=cramertj\n\nFix async fn lowering ICE with APIT.\n\nFixes #60518.\n\nThis PR fixes an ICE where simple bindings (which aren't replaced with replacement arguments during async fn lowering) were not being visited in the def collector and thus caused an ICE during HIR lowering for types that use their `DefId` at that point - such as `impl Trait`.\n\nr? @cramertj", "tree": {"sha": "0fe4a4b339119c497a066dca4c9229b3cbde56d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0fe4a4b339119c497a066dca4c9229b3cbde56d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1599877c7e246dc7e7cca4830734bde7d93a3c1b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJczT1+CRBK7hj4Ov3rIwAAdHIIAGgKkNSJHgyASMcEpt5rLHGC\n7/F7/3UfMPJzRXUgMVlFeOEbpLMLkmahnvUMQF+/FN5BzI1x2jwzodahzv+sz7kL\n/RS4JP2w2ZR8oVMjQxChcrklngM8ZG5hXL9ohrJc4cSn3tZrAM2caJ5/pRuEsGg0\nH3IrlJ7PUEIhgV8naSA3bgyHs/r3yTbO8D97NzuvDSaSJFrqHtnYYgI6ikX7Qc/v\nocETbz0XixneIQs4BuuQbcHeKi83/W4LfPcN8mR+gr9iqxERimJ35ugu9J1q+3fg\nzNa94sUivRymEvC+Cs0InHh8vaYMQgRR8KIJOLqQ8YY/gW1JTMpoD9Q/DgIxqfY=\n=cTYZ\n-----END PGP SIGNATURE-----\n", "payload": "tree 0fe4a4b339119c497a066dca4c9229b3cbde56d7\nparent 10f5a36664825bb22ae7132a31d5749fd84ac912\nparent f346309562c1b894a822839bfddf7291993163a5\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1556954494 +0200\ncommitter GitHub <noreply@github.com> 1556954494 +0200\n\nRollup merge of #60527 - davidtwco:issue-60518, r=cramertj\n\nFix async fn lowering ICE with APIT.\n\nFixes #60518.\n\nThis PR fixes an ICE where simple bindings (which aren't replaced with replacement arguments during async fn lowering) were not being visited in the def collector and thus caused an ICE during HIR lowering for types that use their `DefId` at that point - such as `impl Trait`.\n\nr? @cramertj\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1599877c7e246dc7e7cca4830734bde7d93a3c1b", "html_url": "https://github.com/rust-lang/rust/commit/1599877c7e246dc7e7cca4830734bde7d93a3c1b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1599877c7e246dc7e7cca4830734bde7d93a3c1b/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10f5a36664825bb22ae7132a31d5749fd84ac912", "url": "https://api.github.com/repos/rust-lang/rust/commits/10f5a36664825bb22ae7132a31d5749fd84ac912", "html_url": "https://github.com/rust-lang/rust/commit/10f5a36664825bb22ae7132a31d5749fd84ac912"}, {"sha": "f346309562c1b894a822839bfddf7291993163a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/f346309562c1b894a822839bfddf7291993163a5", "html_url": "https://github.com/rust-lang/rust/commit/f346309562c1b894a822839bfddf7291993163a5"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "7f1352095d936ab334d6145349e0735aaec76cdb", "filename": "src/librustc/hir/map/def_collector.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1599877c7e246dc7e7cca4830734bde7d93a3c1b/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1599877c7e246dc7e7cca4830734bde7d93a3c1b/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fdef_collector.rs?ref=1599877c7e246dc7e7cca4830734bde7d93a3c1b", "patch": "@@ -92,10 +92,12 @@ impl<'a> DefCollector<'a> {\n             visit::walk_generics(this, generics);\n \n             // Walk the generated arguments for the `async fn`.\n-            for a in arguments {\n+            for (i, a) in arguments.iter().enumerate() {\n                 use visit::Visitor;\n                 if let Some(arg) = &a.arg {\n                     this.visit_ty(&arg.ty);\n+                } else {\n+                    this.visit_ty(&decl.inputs[i].ty);\n                 }\n             }\n "}, {"sha": "f603c5bd3f9462b7e4c9027095eb346628da3e01", "filename": "src/test/ui/async-await/issue-60518.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1599877c7e246dc7e7cca4830734bde7d93a3c1b/src%2Ftest%2Fui%2Fasync-await%2Fissue-60518.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1599877c7e246dc7e7cca4830734bde7d93a3c1b/src%2Ftest%2Fui%2Fasync-await%2Fissue-60518.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-60518.rs?ref=1599877c7e246dc7e7cca4830734bde7d93a3c1b", "patch": "@@ -0,0 +1,12 @@\n+// compile-pass\n+// edition:2018\n+\n+#![feature(async_await)]\n+\n+// This is a regression test to ensure that simple bindings (where replacement arguments aren't\n+// created during async fn lowering) that have their DefId used during HIR lowering (such as impl\n+// trait) are visited during def collection and thus have a DefId.\n+\n+async fn foo(ws: impl Iterator<Item = ()>) {}\n+\n+fn main() {}"}]}