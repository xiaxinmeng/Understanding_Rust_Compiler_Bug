{"sha": "86ba4573498ef251933fcc784d513c7586dfaae1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2YmE0NTczNDk4ZWYyNTE5MzNmY2M3ODRkNTEzYzc1ODZkZmFhZTE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-05-19T21:24:36Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-05-20T22:20:50Z"}, "message": "rt: Rename rust_initialize_global_state to rust_initialize_rt_tls_key", "tree": {"sha": "5c46ae7b927da4a5a8a4942c19d190070f0e7abc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c46ae7b927da4a5a8a4942c19d190070f0e7abc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86ba4573498ef251933fcc784d513c7586dfaae1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86ba4573498ef251933fcc784d513c7586dfaae1", "html_url": "https://github.com/rust-lang/rust/commit/86ba4573498ef251933fcc784d513c7586dfaae1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86ba4573498ef251933fcc784d513c7586dfaae1/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f59fcd5d5f7ba94f7c705eb2c081760dd2213067", "url": "https://api.github.com/repos/rust-lang/rust/commits/f59fcd5d5f7ba94f7c705eb2c081760dd2213067", "html_url": "https://github.com/rust-lang/rust/commit/f59fcd5d5f7ba94f7c705eb2c081760dd2213067"}], "stats": {"total": 23, "additions": 15, "deletions": 8}, "files": [{"sha": "5f7f8509a7b2280128448af3fee4c5881c41666c", "filename": "src/libcore/rt/local_sched.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Flibcore%2Frt%2Flocal_sched.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Flibcore%2Frt%2Flocal_sched.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frt%2Flocal_sched.rs?ref=86ba4573498ef251933fcc784d513c7586dfaae1", "patch": "@@ -23,6 +23,16 @@ use unstable::finally::Finally;\n \n #[cfg(test)] use rt::uv::uvio::UvEventLoop;\n \n+/// Initialize the TLS key. Other ops will fail if this isn't executed first.\n+pub fn init_tls_key() {\n+    unsafe {\n+        rust_initialize_rt_tls_key();\n+        extern {\n+            fn rust_initialize_rt_tls_key();\n+        }\n+    }\n+}\n+\n /// Give the Scheduler to thread-local storage\n pub fn put(sched: ~Scheduler) {\n     unsafe {"}, {"sha": "0cdc4e9602bad92ae2085fa7d5cd8ad63e7bbb8c", "filename": "src/libcore/rt/sched.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Flibcore%2Frt%2Fsched.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Flibcore%2Frt%2Fsched.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frt%2Fsched.rs?ref=86ba4573498ef251933fcc784d513c7586dfaae1", "patch": "@@ -64,11 +64,8 @@ pub impl Scheduler {\n \n     fn new(event_loop: ~EventLoopObject) -> Scheduler {\n \n-        // Lazily initialize the global state, currently the scheduler TLS key\n-        unsafe { rust_initialize_global_state(); }\n-        extern {\n-            fn rust_initialize_global_state();\n-        }\n+        // Lazily initialize the scheduler TLS key\n+        local_sched::init_tls_key();\n \n         Scheduler {\n             event_loop: event_loop,"}, {"sha": "a2f253550af1614a0e784602a8f6566ef8dcdbd9", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=86ba4573498ef251933fcc784d513c7586dfaae1", "patch": "@@ -840,9 +840,9 @@ rust_get_rt_tls_key() {\n     return &rt_key;\n }\n \n-// Initialize the global state required by the new scheduler\n+// Initialize the TLS key used by the new scheduler\n extern \"C\" CDECL void\n-rust_initialize_global_state() {\n+rust_initialize_rt_tls_key() {\n \n     static lock_and_signal init_lock;\n     static bool initialized = false;"}, {"sha": "e3e522aa7ceec6d5dfa1a72431b3ff42a5ae86ae", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/86ba4573498ef251933fcc784d513c7586dfaae1/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=86ba4573498ef251933fcc784d513c7586dfaae1", "patch": "@@ -222,7 +222,7 @@ rust_uv_ip4_addrp\n rust_uv_ip6_addrp\n rust_uv_free_ip4_addr\n rust_uv_free_ip6_addr\n-rust_initialize_global_state\n+rust_initialize_rt_tls_key\n rust_dbg_next_port\n rust_new_memory_region\n rust_delete_memory_region"}]}