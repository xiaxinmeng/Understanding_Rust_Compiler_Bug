{"sha": "d2dc425721554348d4ed427f7eb89cdb49efefdb", "node_id": "C_kwDOAAsO6NoAKGQyZGM0MjU3MjE1NTQzNDhkNGVkNDI3ZjdlYjg5Y2RiNDllZmVmZGI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-01-24T11:20:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-01-24T11:20:01Z"}, "message": "Auto merge of #93014 - Kobzol:revert-92103-stable-hash-skip-zero-bytes, r=the8472\n\nRevert \"Do not hash leading zero bytes of i64 numbers in Sip128 hasher\"\n\nReverts rust-lang/rust#92103. It had a (in retrospect, obvious) correctness problem where changing the order of two adjacent values would produce identical hashes, which is problematic in stable hashing (see [this comment](https://github.com/rust-lang/rust/pull/92103#issuecomment-1014625442)).\n\nI'll try to send the PR again with a fix for this issue.\n\nr? `@the8472`", "tree": {"sha": "4b22bae886375dea54ccdc49bb4c7c986d368369", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b22bae886375dea54ccdc49bb4c7c986d368369"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2dc425721554348d4ed427f7eb89cdb49efefdb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2dc425721554348d4ed427f7eb89cdb49efefdb", "html_url": "https://github.com/rust-lang/rust/commit/d2dc425721554348d4ed427f7eb89cdb49efefdb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2dc425721554348d4ed427f7eb89cdb49efefdb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef119d704d87a05435ea97ef4161529142313a9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef119d704d87a05435ea97ef4161529142313a9b", "html_url": "https://github.com/rust-lang/rust/commit/ef119d704d87a05435ea97ef4161529142313a9b"}, {"sha": "50f8062316e37e9be6ee58dc7e5311a5515591da", "url": "https://api.github.com/repos/rust-lang/rust/commits/50f8062316e37e9be6ee58dc7e5311a5515591da", "html_url": "https://github.com/rust-lang/rust/commit/50f8062316e37e9be6ee58dc7e5311a5515591da"}], "stats": {"total": 30, "additions": 8, "deletions": 22}, "files": [{"sha": "53062b9c20da8b8e6e6118730a518ff98c3bbf3f", "filename": "compiler/rustc_data_structures/src/sip128.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d2dc425721554348d4ed427f7eb89cdb49efefdb/compiler%2Frustc_data_structures%2Fsrc%2Fsip128.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2dc425721554348d4ed427f7eb89cdb49efefdb/compiler%2Frustc_data_structures%2Fsrc%2Fsip128.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fsip128.rs?ref=d2dc425721554348d4ed427f7eb89cdb49efefdb", "patch": "@@ -409,20 +409,6 @@ impl SipHasher128 {\n     }\n }\n \n-macro_rules! dispatch_value {\n-    ($target: expr, $value:expr) => {\n-        let value = $value;\n-        #[allow(unreachable_patterns)]\n-        #[allow(overflowing_literals)]\n-        match value {\n-            0..=0xFF => $target.short_write(value as u8),\n-            0x100..=0xFFFF => $target.short_write(value as u16),\n-            0x10000..=0xFFFFFFFF => $target.short_write(value as u32),\n-            _ => $target.short_write(value as u64),\n-        }\n-    };\n-}\n-\n impl Hasher for SipHasher128 {\n     #[inline]\n     fn write_u8(&mut self, i: u8) {\n@@ -436,7 +422,7 @@ impl Hasher for SipHasher128 {\n \n     #[inline]\n     fn write_u32(&mut self, i: u32) {\n-        dispatch_value!(self, i);\n+        self.short_write(i);\n     }\n \n     #[inline]\n@@ -466,7 +452,7 @@ impl Hasher for SipHasher128 {\n \n     #[inline]\n     fn write_i64(&mut self, i: i64) {\n-        dispatch_value!(self, i as u64);\n+        self.short_write(i as u64);\n     }\n \n     #[inline]"}, {"sha": "61d5fc93cd2ad5b7b985d15c07dbcecff0568fa4", "filename": "src/test/debuginfo/function-names.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fdebuginfo%2Ffunction-names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fdebuginfo%2Ffunction-names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Ffunction-names.rs?ref=d2dc425721554348d4ed427f7eb89cdb49efefdb", "patch": "@@ -37,7 +37,7 @@\n // Const generic parameter\n // gdb-command:info functions -q function_names::const_generic_fn.*\n // gdb-check:[...]static fn function_names::const_generic_fn_bool<false>();\n-// gdb-check:[...]static fn function_names::const_generic_fn_non_int<{CONST#3fcd7c34c1555be6}>();\n+// gdb-check:[...]static fn function_names::const_generic_fn_non_int<{CONST#fe3cfa0214ac55c7}>();\n // gdb-check:[...]static fn function_names::const_generic_fn_signed_int<-7>();\n // gdb-check:[...]static fn function_names::const_generic_fn_unsigned_int<14>();\n \n@@ -76,7 +76,7 @@\n // Const generic parameter\n // cdb-command:x a!function_names::const_generic_fn*\n // cdb-check:[...] a!function_names::const_generic_fn_bool<false> (void)\n-// cdb-check:[...] a!function_names::const_generic_fn_non_int<CONST$3fcd7c34c1555be6> (void)\n+// cdb-check:[...] a!function_names::const_generic_fn_non_int<CONST$fe3cfa0214ac55c7> (void)\n // cdb-check:[...] a!function_names::const_generic_fn_unsigned_int<14> (void)\n // cdb-check:[...] a!function_names::const_generic_fn_signed_int<-7> (void)\n "}, {"sha": "5b343b637c316c52f845d9f3431238cd9148f76e", "filename": "src/test/ui/symbol-names/basic.legacy.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.legacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.legacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.legacy.stderr?ref=d2dc425721554348d4ed427f7eb89cdb49efefdb", "patch": "@@ -1,10 +1,10 @@\n-error: symbol-name(_ZN5basic4main17h13492e1c4157543fE)\n+error: symbol-name(_ZN5basic4main17h7c2c715a9b77648bE)\n   --> $DIR/basic.rs:8:1\n    |\n LL | #[rustc_symbol_name]\n    | ^^^^^^^^^^^^^^^^^^^^\n \n-error: demangling(basic::main::h13492e1c4157543f)\n+error: demangling(basic::main::h7c2c715a9b77648b)\n   --> $DIR/basic.rs:8:1\n    |\n LL | #[rustc_symbol_name]"}, {"sha": "dbeab457194ea66b77871d0dece1df9405704977", "filename": "src/test/ui/symbol-names/issue-60925.legacy.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.legacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d2dc425721554348d4ed427f7eb89cdb49efefdb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.legacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.legacy.stderr?ref=d2dc425721554348d4ed427f7eb89cdb49efefdb", "patch": "@@ -1,10 +1,10 @@\n-error: symbol-name(_ZN11issue_609253foo37Foo$LT$issue_60925..llv$u6d$..Foo$GT$3foo17hd250581ce0d79d13E)\n+error: symbol-name(_ZN11issue_609253foo37Foo$LT$issue_60925..llv$u6d$..Foo$GT$3foo17h419983d0842a72aeE)\n   --> $DIR/issue-60925.rs:21:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: demangling(issue_60925::foo::Foo<issue_60925::llvm::Foo>::foo::hd250581ce0d79d13)\n+error: demangling(issue_60925::foo::Foo<issue_60925::llvm::Foo>::foo::h419983d0842a72ae)\n   --> $DIR/issue-60925.rs:21:9\n    |\n LL |         #[rustc_symbol_name]"}]}