{"sha": "636679ecd63a083cd2e3931a77f8a469a8c57c85", "node_id": "C_kwDOAAsO6NoAKDYzNjY3OWVjZDYzYTA4M2NkMmUzOTMxYTc3ZjhhNDY5YThjNTdjODU", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-02-19T07:33:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-19T07:33:42Z"}, "message": "Rollup merge of #108146 - notriddle:notriddle/rustdoc-search-reference, r=GuillaumeGomez\n\nrustdoc: hide `reference` methods in search index\n\nThey're hidden in the HTML, so it makes no sense in the search engine for `reference::next` or `reference::shrink` to be shown.\n\nhttps://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/What.20is.20.60reference.3A.3Ashrink.60.3F", "tree": {"sha": "bc491537c436f461d373737709f3c18a49e429e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc491537c436f461d373737709f3c18a49e429e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/636679ecd63a083cd2e3931a77f8a469a8c57c85", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj8dDWCRBK7hj4Ov3rIwAAja8IAFL0ruxCOVdLcJFJWeHRbTet\n3QAr5BkyOi8jyBTSzpdMFSTtSaneegjXqzoBOrK2SR3ANHAhOqDWh2SPMQOi9bbw\nmUUASWD4htLCN+XhVcokdMCMvhU9eURn2GNHNksTX3hRU7gD5Bs0Qpa1f6jM3QIv\nxyWQ+qHA0u+JwcVnGpYLgYtiM7Q/itUnSDnfDsLFeOVTGncnSF78txVvXIIJ9jfQ\noSo+wBCGughLg1DXJdtxwpO5HiEDc8jQQBdcuS4pzf5i9AwFszjbPG9//kqD/O0w\nFo1L98UD1INhBxkE6rZcW9fsQ1+qfwguqpJva4bSkO5oS5eD5l0y4+T6YhqF6uI=\n=psjT\n-----END PGP SIGNATURE-----\n", "payload": "tree bc491537c436f461d373737709f3c18a49e429e1\nparent 0257e288f54e9935e1554ffb081def6ef57befe8\nparent 0e3ae605bc245e0fb25e04c5f99d398d8a2b5c09\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1676792022 +0530\ncommitter GitHub <noreply@github.com> 1676792022 +0530\n\nRollup merge of #108146 - notriddle:notriddle/rustdoc-search-reference, r=GuillaumeGomez\n\nrustdoc: hide `reference` methods in search index\n\nThey're hidden in the HTML, so it makes no sense in the search engine for `reference::next` or `reference::shrink` to be shown.\n\nhttps://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/What.20is.20.60reference.3A.3Ashrink.60.3F\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/636679ecd63a083cd2e3931a77f8a469a8c57c85", "html_url": "https://github.com/rust-lang/rust/commit/636679ecd63a083cd2e3931a77f8a469a8c57c85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/636679ecd63a083cd2e3931a77f8a469a8c57c85/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0257e288f54e9935e1554ffb081def6ef57befe8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0257e288f54e9935e1554ffb081def6ef57befe8", "html_url": "https://github.com/rust-lang/rust/commit/0257e288f54e9935e1554ffb081def6ef57befe8"}, {"sha": "0e3ae605bc245e0fb25e04c5f99d398d8a2b5c09", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e3ae605bc245e0fb25e04c5f99d398d8a2b5c09", "html_url": "https://github.com/rust-lang/rust/commit/0e3ae605bc245e0fb25e04c5f99d398d8a2b5c09"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "8dbfaf4bbc93d4b814b00c1dd04f7db3d549e462", "filename": "src/librustdoc/formats/cache.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/636679ecd63a083cd2e3931a77f8a469a8c57c85/src%2Flibrustdoc%2Fformats%2Fcache.rs", "raw_url": "https://github.com/rust-lang/rust/raw/636679ecd63a083cd2e3931a77f8a469a8c57c85/src%2Flibrustdoc%2Fformats%2Fcache.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Fcache.rs?ref=636679ecd63a083cd2e3931a77f8a469a8c57c85", "patch": "@@ -287,6 +287,16 @@ impl<'a, 'tcx> DocFolder for CacheBuilder<'a, 'tcx> {\n                     } else {\n                         let last = self.cache.parent_stack.last().expect(\"parent_stack is empty 2\");\n                         let did = match &*last {\n+                            ParentStackItem::Impl {\n+                                // impl Trait for &T { fn method(self); }\n+                                //\n+                                // When generating a function index with the above shape, we want it\n+                                // associated with `T`, not with the primitive reference type. It should\n+                                // show up as `T::method`, rather than `reference::method`, in the search\n+                                // results page.\n+                                for_: clean::Type::BorrowedRef { type_, .. },\n+                                ..\n+                            } => type_.def_id(&self.cache),\n                             ParentStackItem::Impl { for_, .. } => for_.def_id(&self.cache),\n                             ParentStackItem::Type(item_id) => item_id.as_def_id(),\n                         };"}, {"sha": "f90be6d1bfd3514859914b3b5ec9988a9aee4843", "filename": "tests/rustdoc-js-std/reference-shrink.js", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/636679ecd63a083cd2e3931a77f8a469a8c57c85/tests%2Frustdoc-js-std%2Freference-shrink.js", "raw_url": "https://github.com/rust-lang/rust/raw/636679ecd63a083cd2e3931a77f8a469a8c57c85/tests%2Frustdoc-js-std%2Freference-shrink.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js-std%2Freference-shrink.js?ref=636679ecd63a083cd2e3931a77f8a469a8c57c85", "patch": "@@ -0,0 +1,8 @@\n+// exact-check\n+\n+const QUERY = 'reference::shrink';\n+\n+const EXPECTED = {\n+    // avoid including the method that's not going to be in the HTML\n+    'others': [],\n+};"}]}