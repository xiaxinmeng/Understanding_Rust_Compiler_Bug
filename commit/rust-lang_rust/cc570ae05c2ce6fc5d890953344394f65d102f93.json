{"sha": "cc570ae05c2ce6fc5d890953344394f65d102f93", "node_id": "C_kwDOAAsO6NoAKGNjNTcwYWUwNWMyY2U2ZmM1ZDg5MDk1MzM0NDM5NGY2NWQxMDJmOTM", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-03-21T17:18:21Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-03-24T19:23:04Z"}, "message": "Publish a dev release on every commit", "tree": {"sha": "168e9f23112787ef96798d5599480617baac1ea4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/168e9f23112787ef96798d5599480617baac1ea4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc570ae05c2ce6fc5d890953344394f65d102f93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc570ae05c2ce6fc5d890953344394f65d102f93", "html_url": "https://github.com/rust-lang/rust/commit/cc570ae05c2ce6fc5d890953344394f65d102f93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc570ae05c2ce6fc5d890953344394f65d102f93/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ccab9b0e84ed80e5c928a4272f7b4d39ae58408b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ccab9b0e84ed80e5c928a4272f7b4d39ae58408b", "html_url": "https://github.com/rust-lang/rust/commit/ccab9b0e84ed80e5c928a4272f7b4d39ae58408b"}], "stats": {"total": 45, "additions": 42, "deletions": 3}, "files": [{"sha": "e4af73ea6442e5bcd3a6c9439d6a3565a09d5178", "filename": ".github/workflows/main.yml", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/cc570ae05c2ce6fc5d890953344394f65d102f93/.github%2Fworkflows%2Fmain.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cc570ae05c2ce6fc5d890953344394f65d102f93/.github%2Fworkflows%2Fmain.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmain.yml?ref=cc570ae05c2ce6fc5d890953344394f65d102f93", "patch": "@@ -218,3 +218,43 @@ jobs:\n       with:\n         name: cg_clif-${{ runner.os }}-cross-x86_64-mingw\n         path: cg_clif.tar.xz\n+\n+  release:\n+    runs-on: ubuntu-latest\n+    timeout-minutes: 10\n+    if: ${{ github.ref == 'refs/heads/master' }}\n+    needs: [rustfmt, test, bench, dist]\n+\n+    concurrency:\n+      group: release-dev\n+      cancel-in-progress: true\n+\n+    steps:\n+      - uses: actions/checkout@v3\n+\n+      - name: Download all built artifacts\n+        uses: actions/download-artifact@v3\n+        with:\n+          path: artifacts/\n+\n+      - run: |\n+          ls -R artifacts/\n+          mkdir release/\n+          pushd artifacts/\n+          for dir in *; do\n+            mv $dir/cg_clif.tar.xz ../release/$dir.tar.xz\n+            rmdir $dir/ # verify $dir is empty\n+          done\n+          popd\n+          rmdir artifacts/ # verify all artifacts are represented in release/\n+          ls -R release/\n+\n+      - run: npm install --production\n+        working-directory: .github/actions/github-release\n+\n+      - name: Publish Release\n+        uses: ./.github/actions/github-release\n+        with:\n+          files: \"release/*\"\n+          token: ${{ github.token }}\n+        continue-on-error: true"}, {"sha": "c5222982aa739a6a7dcc67915cc19d9ba840c520", "filename": "Readme.md", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cc570ae05c2ce6fc5d890953344394f65d102f93/Readme.md", "raw_url": "https://github.com/rust-lang/rust/raw/cc570ae05c2ce6fc5d890953344394f65d102f93/Readme.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Readme.md?ref=cc570ae05c2ce6fc5d890953344394f65d102f93", "patch": "@@ -22,10 +22,9 @@ $ ./test.sh\n \n For more docs on how to build and test see [build_system/usage.txt](build_system/usage.txt) or the help message of `./y.rs`.\n \n-Alternatively you can download a pre built version from [Github Actions]. It is listed in the artifacts section\n-of workflow runs. Unfortunately due to GHA restrictions you need to be logged in to access it.\n+Alternatively you can download a pre built version from the [releases] page.\n \n-[Github Actions]: https://github.com/bjorn3/rustc_codegen_cranelift/actions?query=branch%3Amaster+event%3Apush+is%3Asuccess\n+[releases]: https://github.com/bjorn3/rustc_codegen_cranelift/releases/tag/dev\n \n ## Usage\n "}]}