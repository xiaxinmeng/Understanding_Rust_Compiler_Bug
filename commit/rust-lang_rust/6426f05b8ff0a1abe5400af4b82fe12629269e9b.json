{"sha": "6426f05b8ff0a1abe5400af4b82fe12629269e9b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0MjZmMDViOGZmMGExYWJlNTQwMGFmNGI4MmZlMTI2MjkyNjllOWI=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-07-13T19:41:26Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-07-13T20:04:36Z"}, "message": "Revert \"Try less complicated trick for solving the dSYM glob portability issue.\"\n\nThis reverts commit 86dfca278dd5f9f589cecfe6de91ad8264c300d0.", "tree": {"sha": "1f92e16eca10a324214b74784ba69abcdc23017f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1f92e16eca10a324214b74784ba69abcdc23017f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6426f05b8ff0a1abe5400af4b82fe12629269e9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6426f05b8ff0a1abe5400af4b82fe12629269e9b", "html_url": "https://github.com/rust-lang/rust/commit/6426f05b8ff0a1abe5400af4b82fe12629269e9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6426f05b8ff0a1abe5400af4b82fe12629269e9b/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c011aab74547a590a5efe3d93bb9e8bfcc0c252", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c011aab74547a590a5efe3d93bb9e8bfcc0c252", "html_url": "https://github.com/rust-lang/rust/commit/3c011aab74547a590a5efe3d93bb9e8bfcc0c252"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "c71e48f6f120514c489ca997adcc4073ee8e248d", "filename": "mk/host.mk", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6426f05b8ff0a1abe5400af4b82fe12629269e9b/mk%2Fhost.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6426f05b8ff0a1abe5400af4b82fe12629269e9b/mk%2Fhost.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fhost.mk?ref=6426f05b8ff0a1abe5400af4b82fe12629269e9b", "patch": "@@ -31,6 +31,7 @@ $$(HLIB$(2)_H_$(4))/$$(CFG_LIBRUSTC): \\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \t$$(Q)cp -R $$(TLIB$(1)_T_$(4)_H_$(3))/$(LIBRUSTC_GLOB) \\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$(LIBRUSTC_DSYM_GLOB) \\\n \t        $$(HLIB$(2)_H_$(4))\n \n $$(HLIB$(2)_H_$(4))/$$(CFG_LIBSYNTAX): \\\n@@ -42,6 +43,7 @@ $$(HLIB$(2)_H_$(4))/$$(CFG_LIBSYNTAX): \\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \t$$(Q)cp -R $$(TLIB$(1)_T_$(4)_H_$(3))/$(LIBSYNTAX_GLOB) \\\n+\t\t$$(TLIB$(1)_T_$(4)_H_$(3))/$(LIBSYNTAX_DSYM_GLOB) \\\n \t        $$(HLIB$(2)_H_$(4))\n \n $$(HLIB$(2)_H_$(4))/$$(CFG_RUNTIME): \\\n@@ -54,7 +56,15 @@ $$(HLIB$(2)_H_$(4))/$$(CFG_CORELIB): \\\n \t$$(HLIB$(2)_H_$(4))/$$(CFG_RUNTIME)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n+# Subtle: We do not let the shell expand $(CORELIB_DSYM_GLOB) directly rather\n+# we use Make's $$(wildcard) facility. The reason is that, on mac, when using\n+# USE_SNAPSHOT_CORELIB, we copy the core.dylib file out of the snapshot.\n+# In that case, there is no .dSYM file.  Annoyingly, bash then refuses to expand\n+# glob, and cp reports an error because libcore-*.dylib.dsym does not exist.\n+# Make instead expands the glob to nothing, which gives us the correct behavior.\n+# (Copy .dsym file if it exists, but do nothing otherwise)\n \t$$(Q)cp -R $$(TLIB$(1)_T_$(4)_H_$(3))/$(CORELIB_GLOB) \\\n+\t\t$$(wildcard $$(TLIB$(1)_T_$(4)_H_$(3))/$(CORELIB_DSYM_GLOB)) \\\n \t        $$(HLIB$(2)_H_$(4))\n \n $$(HLIB$(2)_H_$(4))/$$(CFG_STDLIB): \\\n@@ -64,6 +74,7 @@ $$(HLIB$(2)_H_$(4))/$$(CFG_STDLIB): \\\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \t$$(Q)cp -R $$(TLIB$(1)_T_$(4)_H_$(3))/$(STDLIB_GLOB) \\\n+\t\t$$(wildcard $$(TLIB$(1)_T_$(4)_H_$(3))/$(STDLIB_DSYM_GLOB)) \\\n \t        $$(HLIB$(2)_H_$(4))\n \n $$(HLIB$(2)_H_$(4))/libcore.rlib: \\"}, {"sha": "43a943347a573b9ce4123ab769ce7a54e6e6a681", "filename": "mk/platform.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6426f05b8ff0a1abe5400af4b82fe12629269e9b/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/6426f05b8ff0a1abe5400af4b82fe12629269e9b/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=6426f05b8ff0a1abe5400af4b82fe12629269e9b", "patch": "@@ -76,8 +76,8 @@ endif\n \n ifneq ($(findstring darwin,$(CFG_OSTYPE)),)\n   CFG_LIB_NAME=lib$(1).dylib\n-  # needs trailing * to pick up the .dSYM file too\n-  CFG_LIB_GLOB=lib$(1)-*.dylib*\n+  CFG_LIB_GLOB=lib$(1)-*.dylib\n+  CFG_LIB_DSYM_GLOB=lib$(1)-*.dylib.dSYM\n   CFG_UNIXY := 1\n   CFG_LDENV := DYLD_LIBRARY_PATH\n   CFG_GCCISH_LINK_FLAGS += -dynamiclib -lpthread -framework CoreServices -Wl,-no_compact_unwind"}]}