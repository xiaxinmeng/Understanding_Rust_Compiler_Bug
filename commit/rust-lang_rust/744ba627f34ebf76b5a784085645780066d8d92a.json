{"sha": "744ba627f34ebf76b5a784085645780066d8d92a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0NGJhNjI3ZjM0ZWJmNzZiNWE3ODQwODU2NDU3ODAwNjZkOGQ5MmE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-20T07:33:49Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-20T07:33:49Z"}, "message": "core::rt: Add a test mod and put run_in_newsched_task there", "tree": {"sha": "3473bc1327f8649e623053621e0466d49f5b89d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3473bc1327f8649e623053621e0466d49f5b89d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/744ba627f34ebf76b5a784085645780066d8d92a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/744ba627f34ebf76b5a784085645780066d8d92a", "html_url": "https://github.com/rust-lang/rust/commit/744ba627f34ebf76b5a784085645780066d8d92a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/744ba627f34ebf76b5a784085645780066d8d92a/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f97e6d47f90f1ddfef2d3a888099bd95b0bb1df", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f97e6d47f90f1ddfef2d3a888099bd95b0bb1df", "html_url": "https://github.com/rust-lang/rust/commit/1f97e6d47f90f1ddfef2d3a888099bd95b0bb1df"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "70bc2c7e063fcf53c05f158eac40188ff21dad61", "filename": "src/libcore/rt/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Frt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Frt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frt%2Fmod.rs?ref=744ba627f34ebf76b5a784085645780066d8d92a", "patch": "@@ -49,6 +49,10 @@ mod context;\n mod thread;\n pub mod env;\n \n+/// Tools for testing the runtime\n+#[cfg(test)]\n+pub mod test;\n+\n #[cfg(stage0)]\n pub fn start(main: *u8, _argc: int, _argv: *c_char, _crate_map: *u8) -> int {\n     use self::sched::{Scheduler, Task};"}, {"sha": "14d69c2373253f1c73f2097e5ac11ff50cbe0b76", "filename": "src/libcore/rt/test.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Frt%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Frt%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frt%2Ftest.rs?ref=744ba627f34ebf76b5a784085645780066d8d92a", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// For setting up tests of the new scheduler\n+pub fn run_in_newsched_task(f: ~fn()) {\n+    use cell::Cell;\n+    use unstable::run_in_bare_thread;\n+    use super::sched::Task;\n+    use super::uvio::UvEventLoop;\n+\n+    let f = Cell(Cell(f));\n+\n+    do run_in_bare_thread {\n+        let mut sched = ~UvEventLoop::new_scheduler();\n+        let f = f.take();\n+        let task = ~do Task::new(&mut sched.stack_pool) {\n+            (f.take())();\n+        };\n+        sched.task_queue.push_back(task);\n+        sched.run();\n+    }\n+}"}, {"sha": "a243bfba85c6f669ebc04d747d58159426b6fb8a", "filename": "src/libcore/task/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Ftask%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/744ba627f34ebf76b5a784085645780066d8d92a/src%2Flibcore%2Ftask%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask%2Fmod.rs?ref=744ba627f34ebf76b5a784085645780066d8d92a", "patch": "@@ -1229,7 +1229,7 @@ fn test_spawn_thread_on_demand() {\n \n #[test]\n fn test_simple_newsched_spawn() {\n-    use rt::run_in_newsched_task;\n+    use rt::test::run_in_newsched_task;\n \n     do run_in_newsched_task {\n         spawn(||())"}]}