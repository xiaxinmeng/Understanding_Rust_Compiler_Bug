{"sha": "5938eba4e30b766751483e93776a87a4db1681f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5MzhlYmE0ZTMwYjc2Njc1MTQ4M2U5Mzc3NmE4N2E0ZGIxNjgxZjQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-07T07:15:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-07T07:15:31Z"}, "message": "Auto merge of #38149 - bluss:is-empty, r=alexcrichton\n\nForward more ExactSizeIterator methods and `is_empty` edits\n\n- Forward ExactSizeIterator methods in more places, like `&mut I` and `Box<I>` iterator impls.\n- Improve `VecDeque::is_empty` itself (see commit 4)\n- All the collections iterators now have `len` or `is_empty` forwarded if doing so is a benefit. In the remaining cases, they already use a simple size hint (using something like a stored `usize` value), which is sufficient for the default implementation of len and is_empty.", "tree": {"sha": "1e497c14aaafb3a0471925118e5efb62963eb66b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e497c14aaafb3a0471925118e5efb62963eb66b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5938eba4e30b766751483e93776a87a4db1681f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5938eba4e30b766751483e93776a87a4db1681f4", "html_url": "https://github.com/rust-lang/rust/commit/5938eba4e30b766751483e93776a87a4db1681f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5938eba4e30b766751483e93776a87a4db1681f4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02ea82ddb8315249067afb2f800d62b4ca1f7678", "url": "https://api.github.com/repos/rust-lang/rust/commits/02ea82ddb8315249067afb2f800d62b4ca1f7678", "html_url": "https://github.com/rust-lang/rust/commit/02ea82ddb8315249067afb2f800d62b4ca1f7678"}, {"sha": "d53f82c1d037bf224a72a11747e7788f14b52db5", "url": "https://api.github.com/repos/rust-lang/rust/commits/d53f82c1d037bf224a72a11747e7788f14b52db5", "html_url": "https://github.com/rust-lang/rust/commit/d53f82c1d037bf224a72a11747e7788f14b52db5"}], "stats": {"total": 86, "additions": 77, "deletions": 9}, "files": [{"sha": "addb056f53429f38511b0d63d0d0b691b60f4f99", "filename": "src/liballoc/boxed.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Fliballoc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Fliballoc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fboxed.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -535,7 +535,14 @@ impl<I: DoubleEndedIterator + ?Sized> DoubleEndedIterator for Box<I> {\n     }\n }\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<I: ExactSizeIterator + ?Sized> ExactSizeIterator for Box<I> {}\n+impl<I: ExactSizeIterator + ?Sized> ExactSizeIterator for Box<I> {\n+    fn len(&self) -> usize {\n+        (**self).len()\n+    }\n+    fn is_empty(&self) -> bool {\n+        (**self).is_empty()\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<I: FusedIterator + ?Sized> FusedIterator for Box<I> {}"}, {"sha": "acce4ce035890f0500eb5472cb05729fda857dcf", "filename": "src/liballoc/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Fliballoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Fliballoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Flib.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -79,6 +79,7 @@\n #![feature(core_intrinsics)]\n #![feature(custom_attribute)]\n #![feature(dropck_parametricity)]\n+#![cfg_attr(not(test), feature(exact_size_is_empty))]\n #![feature(fundamental)]\n #![feature(lang_items)]\n #![feature(needs_allocator)]"}, {"sha": "8d0c76c36468c86028de4bfd0f772b7bbddc5206", "filename": "src/libcollections/binary_heap.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollections%2Fbinary_heap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollections%2Fbinary_heap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fbinary_heap.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -986,7 +986,11 @@ impl<'a, T> DoubleEndedIterator for Iter<'a, T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<'a, T> ExactSizeIterator for Iter<'a, T> {}\n+impl<'a, T> ExactSizeIterator for Iter<'a, T> {\n+    fn is_empty(&self) -> bool {\n+        self.iter.is_empty()\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<'a, T> FusedIterator for Iter<'a, T> {}\n@@ -1022,7 +1026,11 @@ impl<T> DoubleEndedIterator for IntoIter<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> ExactSizeIterator for IntoIter<T> {}\n+impl<T> ExactSizeIterator for IntoIter<T> {\n+    fn is_empty(&self) -> bool {\n+        self.iter.is_empty()\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<T> FusedIterator for IntoIter<T> {}\n@@ -1057,7 +1065,11 @@ impl<'a, T: 'a> DoubleEndedIterator for Drain<'a, T> {\n }\n \n #[stable(feature = \"drain\", since = \"1.6.0\")]\n-impl<'a, T: 'a> ExactSizeIterator for Drain<'a, T> {}\n+impl<'a, T: 'a> ExactSizeIterator for Drain<'a, T> {\n+    fn is_empty(&self) -> bool {\n+        self.iter.is_empty()\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<'a, T: 'a> FusedIterator for Drain<'a, T> {}"}, {"sha": "dbe3fec205cb268ee7fa01e80b8194ef934bb131", "filename": "src/libcollections/vec_deque.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollections%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollections%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec_deque.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -810,7 +810,7 @@ impl<T> VecDeque<T> {\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     pub fn is_empty(&self) -> bool {\n-        self.len() == 0\n+        self.tail == self.head\n     }\n \n     /// Create a draining iterator that removes the specified range in the\n@@ -1916,7 +1916,11 @@ impl<'a, T> DoubleEndedIterator for Iter<'a, T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<'a, T> ExactSizeIterator for Iter<'a, T> {}\n+impl<'a, T> ExactSizeIterator for Iter<'a, T> {\n+    fn is_empty(&self) -> bool {\n+        self.head == self.tail\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<'a, T> FusedIterator for Iter<'a, T> {}\n@@ -1980,7 +1984,11 @@ impl<'a, T> DoubleEndedIterator for IterMut<'a, T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<'a, T> ExactSizeIterator for IterMut<'a, T> {}\n+impl<'a, T> ExactSizeIterator for IterMut<'a, T> {\n+    fn is_empty(&self) -> bool {\n+        self.head == self.tail\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<'a, T> FusedIterator for IterMut<'a, T> {}\n@@ -2017,7 +2025,11 @@ impl<T> DoubleEndedIterator for IntoIter<T> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<T> ExactSizeIterator for IntoIter<T> {}\n+impl<T> ExactSizeIterator for IntoIter<T> {\n+    fn is_empty(&self) -> bool {\n+        self.inner.is_empty()\n+    }\n+}\n \n #[unstable(feature = \"fused\", issue = \"35602\")]\n impl<T> FusedIterator for IntoIter<T> {}"}, {"sha": "cdf022e4f02f36ec4e4a623bc26a0d8131d92e06", "filename": "src/libcollectionstest/vec_deque.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollectionstest%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcollectionstest%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollectionstest%2Fvec_deque.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -1007,3 +1007,24 @@ fn assert_covariance() {\n         d\n     }\n }\n+\n+#[test]\n+fn test_is_empty() {\n+    let mut v = VecDeque::<i32>::new();\n+    assert!(v.is_empty());\n+    assert!(v.iter().is_empty());\n+    assert!(v.iter_mut().is_empty());\n+    v.extend(&[2, 3, 4]);\n+    assert!(!v.is_empty());\n+    assert!(!v.iter().is_empty());\n+    assert!(!v.iter_mut().is_empty());\n+    while let Some(_) = v.pop_front() {\n+        assert_eq!(v.is_empty(), v.len() == 0);\n+        assert_eq!(v.iter().is_empty(), v.iter().len() == 0);\n+        assert_eq!(v.iter_mut().is_empty(), v.iter_mut().len() == 0);\n+    }\n+    assert!(v.is_empty());\n+    assert!(v.iter().is_empty());\n+    assert!(v.iter_mut().is_empty());\n+    assert!(v.into_iter().is_empty());\n+}"}, {"sha": "c5465549adf70c6f37bf2cc349c1b31e5426bf9a", "filename": "src/libcore/iter/traits.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcore%2Fiter%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcore%2Fiter%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fiter%2Ftraits.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -552,7 +552,14 @@ pub trait ExactSizeIterator: Iterator {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-impl<'a, I: ExactSizeIterator + ?Sized> ExactSizeIterator for &'a mut I {}\n+impl<'a, I: ExactSizeIterator + ?Sized> ExactSizeIterator for &'a mut I {\n+    fn len(&self) -> usize {\n+        (**self).len()\n+    }\n+    fn is_empty(&self) -> bool {\n+        (**self).is_empty()\n+    }\n+}\n \n /// Trait to represent types that can be created by summing up an iterator.\n ///"}, {"sha": "de418b831cc8842f0061c6df8319c2fdf26eebc7", "filename": "src/libcore/str/mod.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcore%2Fstr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibcore%2Fstr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fstr%2Fmod.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -618,6 +618,11 @@ impl<'a> ExactSizeIterator for Bytes<'a> {\n     fn len(&self) -> usize {\n         self.0.len()\n     }\n+\n+    #[inline]\n+    fn is_empty(&self) -> bool {\n+        self.0.is_empty()\n+    }\n }\n \n #[unstable(feature = \"fused\", issue = \"35602\")]"}, {"sha": "ee6a907f6160ee4a45ec79935f844a542dcadef8", "filename": "src/libstd/env.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibstd%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibstd%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fenv.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -630,6 +630,7 @@ impl Iterator for Args {\n #[stable(feature = \"env\", since = \"1.0.0\")]\n impl ExactSizeIterator for Args {\n     fn len(&self) -> usize { self.inner.len() }\n+    fn is_empty(&self) -> bool { self.inner.is_empty() }\n }\n \n #[stable(feature = \"env_iterators\", since = \"1.11.0\")]\n@@ -649,6 +650,7 @@ impl Iterator for ArgsOs {\n #[stable(feature = \"env\", since = \"1.0.0\")]\n impl ExactSizeIterator for ArgsOs {\n     fn len(&self) -> usize { self.inner.len() }\n+    fn is_empty(&self) -> bool { self.inner.is_empty() }\n }\n \n #[stable(feature = \"env_iterators\", since = \"1.11.0\")]"}, {"sha": "1f40d3fd1d35f3485ad528fb843512c592403708", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5938eba4e30b766751483e93776a87a4db1681f4/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=5938eba4e30b766751483e93776a87a4db1681f4", "patch": "@@ -250,6 +250,7 @@\n #![feature(core_float)]\n #![feature(core_intrinsics)]\n #![feature(dropck_parametricity)]\n+#![feature(exact_size_is_empty)]\n #![feature(float_extras)]\n #![feature(float_from_str_radix)]\n #![feature(fn_traits)]"}]}