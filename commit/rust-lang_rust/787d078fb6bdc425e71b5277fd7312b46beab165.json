{"sha": "787d078fb6bdc425e71b5277fd7312b46beab165", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4N2QwNzhmYjZiZGM0MjVlNzFiNTI3N2ZkNzMxMmI0NmJlYWIxNjU=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-09-29T15:51:52Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-09-29T16:07:19Z"}, "message": "Build build scripts for sysroot using cg_llvm\n\nThere is not yet a cg_clif sysroot available when building the sysroot itself", "tree": {"sha": "ee0e94ba766b4a435de0d126c5db7a3168cb6ab7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee0e94ba766b4a435de0d126c5db7a3168cb6ab7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/787d078fb6bdc425e71b5277fd7312b46beab165", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/787d078fb6bdc425e71b5277fd7312b46beab165", "html_url": "https://github.com/rust-lang/rust/commit/787d078fb6bdc425e71b5277fd7312b46beab165", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/787d078fb6bdc425e71b5277fd7312b46beab165/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8b5a824a689aea09f46c2f7b2f58f5f8051ea1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8b5a824a689aea09f46c2f7b2f58f5f8051ea1d", "html_url": "https://github.com/rust-lang/rust/commit/b8b5a824a689aea09f46c2f7b2f58f5f8051ea1d"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "2f09453e0f7e87b10b5ce04ba6a3aa19774ab075", "filename": "build_sysroot/build_sysroot.sh", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/787d078fb6bdc425e71b5277fd7312b46beab165/build_sysroot%2Fbuild_sysroot.sh", "raw_url": "https://github.com/rust-lang/rust/raw/787d078fb6bdc425e71b5277fd7312b46beab165/build_sysroot%2Fbuild_sysroot.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_sysroot%2Fbuild_sysroot.sh?ref=787d078fb6bdc425e71b5277fd7312b46beab165", "patch": "@@ -14,8 +14,13 @@ popd >/dev/null\n rm -r target/*/{debug,release}/{build,deps,examples,libsysroot*,native} 2>/dev/null || true\n rm -r sysroot/ 2>/dev/null || true\n \n+# Use rustc with cg_clif as hotpluggable backend instead of the custom cg_clif driver so that\n+# build scripts are still compiled using cg_llvm.\n+export RUSTC=rustc\n+export RUSTFLAGS=$RUSTFLAGS\" -Ztrim-diagnostic-paths=no -Zcodegen-backend=$(pwd)/../target/\"$CHANNEL\"/librustc_codegen_cranelift.\"$dylib_ext\" --sysroot $(pwd)/sysroot\"\n+\n # Build libs\n-export RUSTFLAGS=\"$RUSTFLAGS -Z force-unstable-if-unmarked\"\n+export RUSTFLAGS=\"$RUSTFLAGS -Zforce-unstable-if-unmarked -Cpanic=abort\"\n if [[ \"$1\" == \"--release\" ]]; then\n     sysroot_channel='release'\n     # FIXME Enable incremental again once rust-lang/rust#74946 is fixed"}]}