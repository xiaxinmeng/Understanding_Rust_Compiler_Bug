{"sha": "3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMDBiYjIyYTVhNDJlZTVkNmM3NjhiMmYxOTJjNGFjMzNhYmFkNjc=", "commit": {"author": {"name": "xiongmao86", "email": "xiongmao86dev@sina.com", "date": "2019-05-02T13:11:13Z"}, "committer": {"name": "xiongmao86", "email": "xiongmao86dev@sina.com", "date": "2019-05-02T13:11:13Z"}, "message": "Isolate format_doc_comment with normalize_comments and wrap_comments.", "tree": {"sha": "9f999321b266966675e234fefd3b6421f4262c9b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f999321b266966675e234fefd3b6421f4262c9b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "html_url": "https://github.com/rust-lang/rust/commit/3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/comments", "author": {"login": "xiongmao86", "id": 1770218, "node_id": "MDQ6VXNlcjE3NzAyMTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1770218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiongmao86", "html_url": "https://github.com/xiongmao86", "followers_url": "https://api.github.com/users/xiongmao86/followers", "following_url": "https://api.github.com/users/xiongmao86/following{/other_user}", "gists_url": "https://api.github.com/users/xiongmao86/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiongmao86/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiongmao86/subscriptions", "organizations_url": "https://api.github.com/users/xiongmao86/orgs", "repos_url": "https://api.github.com/users/xiongmao86/repos", "events_url": "https://api.github.com/users/xiongmao86/events{/privacy}", "received_events_url": "https://api.github.com/users/xiongmao86/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xiongmao86", "id": 1770218, "node_id": "MDQ6VXNlcjE3NzAyMTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1770218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiongmao86", "html_url": "https://github.com/xiongmao86", "followers_url": "https://api.github.com/users/xiongmao86/followers", "following_url": "https://api.github.com/users/xiongmao86/following{/other_user}", "gists_url": "https://api.github.com/users/xiongmao86/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiongmao86/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiongmao86/subscriptions", "organizations_url": "https://api.github.com/users/xiongmao86/orgs", "repos_url": "https://api.github.com/users/xiongmao86/repos", "events_url": "https://api.github.com/users/xiongmao86/events{/privacy}", "received_events_url": "https://api.github.com/users/xiongmao86/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a653e30d9f5909407e5a28e091c5b923d7bd92db", "url": "https://api.github.com/repos/rust-lang/rust/commits/a653e30d9f5909407e5a28e091c5b923d7bd92db", "html_url": "https://github.com/rust-lang/rust/commit/a653e30d9f5909407e5a28e091c5b923d7bd92db"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "b8dcae2352103021fc0c569bae55f055e9871398", "filename": "src/comment.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -656,9 +656,16 @@ impl<'a> CommentRewrite<'a> {\n                     _ => {\n                         let mut config = self.fmt.config.clone();\n                         config.set().wrap_comments(false);\n-                        match crate::format_code_block(&self.code_block_buffer, &config) {\n-                            Some(ref s) => trim_custom_comment_prefix(&s.snippet),\n-                            None => trim_custom_comment_prefix(&self.code_block_buffer),\n+                        if config.format_doc_comments() {\n+                            if let Some(s) =\n+                                crate::format_code_block(&self.code_block_buffer, &config)\n+                            {\n+                                trim_custom_comment_prefix(&s.snippet)\n+                            } else {\n+                                trim_custom_comment_prefix(&self.code_block_buffer)\n+                            }\n+                        } else {\n+                            trim_custom_comment_prefix(&self.code_block_buffer)\n                         }\n                     }\n                 };"}, {"sha": "9ea522c4fe4e4d26a3a76054b51231d23976bda4", "filename": "tests/source/issue-2520.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-2520.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-2520.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2520.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n //! ```rust\n //! println!( \"hello, world\" );"}, {"sha": "71aed6ac5351e1ca7f329a98239db611cff408a3", "filename": "tests/source/issue-2523.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-2523.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-2523.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2523.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n // Do not unindent macro calls in comment with unformattable syntax.\n //! ```rust"}, {"sha": "eaf00afa3d3879ce585e7325258ee8feff8079e5", "filename": "tests/source/issue-3055/original.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-3055%2Foriginal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fissue-3055%2Foriginal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3055%2Foriginal.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-wrap_comments: true\n+// rustfmt-format_doc_comments: true\n \n /// Vestibulum elit nibh, rhoncus non, euismod sit amet, pretium eu, enim. Nunc commodo ultricies dui.\n ///"}, {"sha": "a0c546ad18e146379cd3c4d0b9cba3667eeddfe5", "filename": "tests/source/itemized-blocks/no_wrap.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fitemized-blocks%2Fno_wrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fitemized-blocks%2Fno_wrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fitemized-blocks%2Fno_wrap.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n //! This is a list:\n //!  * Outer"}, {"sha": "14fc8daa2e9d374b16e0f9e2e01a43c12f7c50be", "filename": "tests/source/itemized-blocks/wrap.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fitemized-blocks%2Fwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Fsource%2Fitemized-blocks%2Fwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fitemized-blocks%2Fwrap.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-wrap_comments: true\n+// rustfmt-format_doc_comments: true\n // rustfmt-max_width: 50\n \n //! This is a list:"}, {"sha": "7d22b2b665a70a2ef49410ac4931ba99b11f2b6b", "filename": "tests/target/issue-2520.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-2520.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-2520.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2520.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n //! ```rust\n //! println!(\"hello, world\");"}, {"sha": "c0118e53780392c3db67d086789a3477a9f11cd1", "filename": "tests/target/issue-2523.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-2523.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-2523.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2523.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n // Do not unindent macro calls in comment with unformattable syntax.\n //! ```rust"}, {"sha": "1fb35d506820cdd5c2dbda67d04277c7327ccd7a", "filename": "tests/target/issue-3055/original.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-3055%2Foriginal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fissue-3055%2Foriginal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3055%2Foriginal.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-wrap_comments: true\n+// rustfmt-format_doc_comments: true\n \n /// Vestibulum elit nibh, rhoncus non, euismod sit amet, pretium eu, enim. Nunc\n /// commodo ultricies dui."}, {"sha": "a1f9c39a1150bbe0d18bf034121b29f8c1ef99d1", "filename": "tests/target/itemized-blocks/no_wrap.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fitemized-blocks%2Fno_wrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fitemized-blocks%2Fno_wrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fitemized-blocks%2Fno_wrap.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-normalize_comments: true\n+// rustfmt-format_doc_comments: true\n \n //! This is a list:\n //!  * Outer"}, {"sha": "967a38b91ae8a9a0a222d8f074f62caa2aab36cf", "filename": "tests/target/itemized-blocks/wrap.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fitemized-blocks%2Fwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fitemized-blocks%2Fwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fitemized-blocks%2Fwrap.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -1,4 +1,5 @@\n // rustfmt-wrap_comments: true\n+// rustfmt-format_doc_comments: true\n // rustfmt-max_width: 50\n \n //! This is a list:"}, {"sha": "d61d4d7c216a309406c9a13a3898766ff151ae6d", "filename": "tests/target/wrap_comments_should_not_imply_format_doc_comments.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fwrap_comments_should_not_imply_format_doc_comments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3300bb22a5a42ee5d6c768b2f192c4ac33abad67/tests%2Ftarget%2Fwrap_comments_should_not_imply_format_doc_comments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fwrap_comments_should_not_imply_format_doc_comments.rs?ref=3300bb22a5a42ee5d6c768b2f192c4ac33abad67", "patch": "@@ -8,7 +8,6 @@\n /// # #![cfg_attr(not(dox), no_std)]\n /// fn foo() {  }\n /// ```\n-///\n fn foo() {}\n \n /// A long commment for wrapping"}]}