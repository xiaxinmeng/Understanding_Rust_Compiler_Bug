{"sha": "b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzNmY3NzAxMmRjYmZiY2Y3ZDA0ZTI5ZmI5YTEwYzhlYWQ5YjNhYjE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-25T12:33:21Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-25T12:33:21Z"}, "message": "Auto merge of #82265 - GuillaumeGomez:cleanup-attrs-twice, r=jyn514\n\nPrevent to compute Item attributes twice\n\nI came across this case when working on another part of rustdoc. Not a game changer but a nice little improvement.\n\ncc `@camelid`\n\nr? `@jyn514`", "tree": {"sha": "69a4296a398bad6cf2ac4b5c825586336a79f45e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69a4296a398bad6cf2ac4b5c825586336a79f45e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "html_url": "https://github.com/rust-lang/rust/commit/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89d32eb1ea44b3d739feb3c2a77adbba1e39b8e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/89d32eb1ea44b3d739feb3c2a77adbba1e39b8e6", "html_url": "https://github.com/rust-lang/rust/commit/89d32eb1ea44b3d739feb3c2a77adbba1e39b8e6"}, {"sha": "cc0d53146363a4741530f16821efc308550a5021", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc0d53146363a4741530f16821efc308550a5021", "html_url": "https://github.com/rust-lang/rust/commit/cc0d53146363a4741530f16821efc308550a5021"}], "stats": {"total": 29, "additions": 23, "deletions": 6}, "files": [{"sha": "9cfa72132cb5a99aae5f2404d79d77baa81e0577", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "patch": "@@ -414,7 +414,10 @@ crate fn build_impl(\n \n     debug!(\"build_impl: impl {:?} for {:?}\", trait_.def_id(), for_.def_id());\n \n-    let mut item = clean::Item::from_def_id_and_parts(\n+    let attrs = box merge_attrs(cx, parent_module.into(), load_attrs(cx, did), attrs);\n+    debug!(\"merged_attrs={:?}\", attrs);\n+\n+    ret.push(clean::Item::from_def_id_and_attrs_and_parts(\n         did,\n         None,\n         clean::ImplItem(clean::Impl {\n@@ -428,11 +431,9 @@ crate fn build_impl(\n             synthetic: false,\n             blanket_impl: None,\n         }),\n+        attrs,\n         cx,\n-    );\n-    item.attrs = box merge_attrs(cx, parent_module.into(), load_attrs(cx, did), attrs);\n-    debug!(\"merged_attrs={:?}\", item.attrs);\n-    ret.push(item);\n+    ));\n }\n \n fn build_module("}, {"sha": "7fc48cd5f0b38819f37882593469c493f7fbcf45", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=b36f77012dcbfbcf7d04e29fb9a10c8ead9b3ab1", "patch": "@@ -147,6 +147,22 @@ impl Item {\n         name: Option<Symbol>,\n         kind: ItemKind,\n         cx: &mut DocContext<'_>,\n+    ) -> Item {\n+        Self::from_def_id_and_attrs_and_parts(\n+            def_id,\n+            name,\n+            kind,\n+            box cx.tcx.get_attrs(def_id).clean(cx),\n+            cx,\n+        )\n+    }\n+\n+    pub fn from_def_id_and_attrs_and_parts(\n+        def_id: DefId,\n+        name: Option<Symbol>,\n+        kind: ItemKind,\n+        attrs: Box<Attributes>,\n+        cx: &mut DocContext<'_>,\n     ) -> Item {\n         debug!(\"name={:?}, def_id={:?}\", name, def_id);\n \n@@ -164,7 +180,7 @@ impl Item {\n             kind: box kind,\n             name,\n             source: source.clean(cx),\n-            attrs: box cx.tcx.get_attrs(def_id).clean(cx),\n+            attrs,\n             visibility: cx.tcx.visibility(def_id).clean(cx),\n         }\n     }"}]}