{"sha": "3ab86fb79edd0c60e4685c0d865531011e6abdb9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhYjg2ZmI3OWVkZDBjNjBlNDY4NWMwZDg2NTUzMTAxMWU2YWJkYjk=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-22T23:39:18Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-22T23:39:18Z"}, "message": "Teach rustc to add istrs. Issue #855", "tree": {"sha": "67e71c300c3cb15f1fedf03beeacc158c45bf5e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67e71c300c3cb15f1fedf03beeacc158c45bf5e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ab86fb79edd0c60e4685c0d865531011e6abdb9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ab86fb79edd0c60e4685c0d865531011e6abdb9", "html_url": "https://github.com/rust-lang/rust/commit/3ab86fb79edd0c60e4685c0d865531011e6abdb9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ab86fb79edd0c60e4685c0d865531011e6abdb9/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aae212727d40140181ca6f481b7e4bc75a64c796", "url": "https://api.github.com/repos/rust-lang/rust/commits/aae212727d40140181ca6f481b7e4bc75a64c796", "html_url": "https://github.com/rust-lang/rust/commit/aae212727d40140181ca6f481b7e4bc75a64c796"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "d5b82c6643657daf8b529c35c0146b6787b99136", "filename": "src/comp/middle/trans_ivec.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3ab86fb79edd0c60e4685c0d865531011e6abdb9/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ab86fb79edd0c60e4685c0d865531011e6abdb9/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs?ref=3ab86fb79edd0c60e4685c0d865531011e6abdb9", "patch": "@@ -494,6 +494,16 @@ fn trans_add(cx: &@block_ctxt, vec_ty: ty::t, lhs: ValueRef,\n     let lhs_len = lhs_len_and_data.len;\n     let lhs_data = lhs_len_and_data.data;\n     bcx = lhs_len_and_data.bcx;\n+\n+    lhs_len = alt ty::struct(bcx_tcx(bcx), vec_ty) {\n+      ty::ty_istr. {\n+        // Forget about the trailing null on the left side\n+        bcx.build.Sub(lhs_len, C_uint(1u))\n+      }\n+      ty::ty_vec(_) { lhs_len }\n+      _ { bcx_tcx(bcx).sess.bug(\"non-istr/ivec in trans_add\") }\n+    };\n+\n     let rhs_len_and_data = get_len_and_data(bcx, rhs, unit_ty);\n     let rhs_len = rhs_len_and_data.len;\n     let rhs_data = rhs_len_and_data.data;"}, {"sha": "6930808f6472375ca860e3a42a3781fecda6d07e", "filename": "src/test/run-pass/istr.rs", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/3ab86fb79edd0c60e4685c0d865531011e6abdb9/src%2Ftest%2Frun-pass%2Fistr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ab86fb79edd0c60e4685c0d865531011e6abdb9/src%2Ftest%2Frun-pass%2Fistr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fistr.rs?ref=3ab86fb79edd0c60e4685c0d865531011e6abdb9", "patch": "@@ -12,18 +12,39 @@ fn test_heap_lit() {\n }\n \n fn test_heap_assign() {\n-    let s: istr;\n-    s = ~\"AAAA\";\n+    let s: istr = ~\"a big ol' string\";\n+    let t: istr = ~\"a big ol' string\";\n+    assert s == t;\n+    let u: istr = ~\"a bad ol' string\";\n+    assert s != u;\n }\n \n fn test_heap_log() {\n     let s = ~\"a big ol' string\";\n     log s;\n }\n \n+fn test_stack_add() {\n+    assert ~\"a\" + ~\"b\" == ~\"ab\";\n+    let s: istr = ~\"a\";\n+    assert s + s == ~\"aa\";\n+    assert ~\"\" + ~\"\" == ~\"\";\n+}\n+\n+fn test_stack_heap_add() {\n+    assert ~\"a\" + ~\"bracadabra\" == ~\"abracadabra\";\n+}\n+\n+fn test_heap_add() {\n+    assert ~\"this should\" + ~\" totally work\" == ~\"this should totally work\";\n+}\n+\n fn main() {\n     test_stack_assign();\n     test_heap_lit();\n     test_heap_assign();\n     test_heap_log();\n+    test_stack_add();\n+    test_stack_heap_add();\n+    test_heap_add();\n }\n\\ No newline at end of file"}]}