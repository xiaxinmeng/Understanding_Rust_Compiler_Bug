{"sha": "4c347a9f650f2cdce3890ff95c16a09d7c57e2dc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjMzQ3YTlmNjUwZjJjZGNlMzg5MGZmOTVjMTZhMDlkN2M1N2UyZGM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-03T16:39:36Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-03T16:39:36Z"}, "message": "Compress rename tests", "tree": {"sha": "2271f1be3a383c7c89fd2c3918dc150c7596bc6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2271f1be3a383c7c89fd2c3918dc150c7596bc6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc", "html_url": "https://github.com/rust-lang/rust/commit/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2656c415c893020331587d2771f10019e9165dce", "url": "https://api.github.com/repos/rust-lang/rust/commits/2656c415c893020331587d2771f10019e9165dce", "html_url": "https://github.com/rust-lang/rust/commit/2656c415c893020331587d2771f10019e9165dce"}], "stats": {"total": 243, "additions": 142, "deletions": 101}, "files": [{"sha": "bbf475f6670aef7dd758e13ed7687a7cd37910df", "filename": "crates/ra_ide/src/references/rename.rs", "status": "modified", "additions": 142, "deletions": 101, "changes": 243, "blob_url": "https://github.com/rust-lang/rust/blob/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c347a9f650f2cdce3890ff95c16a09d7c57e2dc/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs?ref=4c347a9f650f2cdce3890ff95c16a09d7c57e2dc", "patch": "@@ -305,47 +305,17 @@ mod tests {\n \n     #[test]\n     fn test_rename_to_underscore() {\n-        check(\n-            \"_\",\n-            r#\"\n-fn main() {\n-    let i<|> = 1;\n-}\n-\"#,\n-            r#\"\n-fn main() {\n-    let _ = 1;\n-}\n-\"#,\n-        );\n+        check(\"_\", r#\"fn main() { let i<|> = 1; }\"#, r#\"fn main() { let _ = 1; }\"#);\n     }\n \n     #[test]\n     fn test_rename_to_raw_identifier() {\n-        check(\n-            \"r#fn\",\n-            r#\"\n-fn main() {\n-    let i<|> = 1;\n-}\n-\"#,\n-            r#\"\n-fn main() {\n-    let r#fn = 1;\n-}\n-\"#,\n-        );\n+        check(\"r#fn\", r#\"fn main() { let i<|> = 1; }\"#, r#\"fn main() { let r#fn = 1; }\"#);\n     }\n \n     #[test]\n     fn test_rename_to_invalid_identifier() {\n-        let (analysis, position) = analysis_and_position(\n-            r#\"\n-fn main() {\n-    let i<|> = 1;\n-}\n-\"#,\n-        );\n+        let (analysis, position) = analysis_and_position(r#\"fn main() { let i<|> = 1; }\"#);\n         let new_name = \"invalid!\";\n         let source_change = analysis.rename(position, new_name).unwrap();\n         assert!(source_change.is_none());\n@@ -361,9 +331,7 @@ fn main() {\n     let j = 1;\n     i = i<|> + j;\n \n-    {\n-        i = 0;\n-    }\n+    { i = 0; }\n \n     i = 5;\n }\n@@ -374,9 +342,7 @@ fn main() {\n     let j = 1;\n     k = k + j;\n \n-    {\n-        k = 0;\n-    }\n+    { k = 0; }\n \n     k = 5;\n }\n@@ -470,53 +436,17 @@ fn main() {\n \n     #[test]\n     fn test_rename_for_param_inside() {\n-        check(\n-            \"j\",\n-            r#\"\n-fn foo(i : u32) -> u32 {\n-    i<|>\n-}\n-\"#,\n-            r#\"\n-fn foo(j : u32) -> u32 {\n-    j\n-}\n-\"#,\n-        );\n+        check(\"j\", r#\"fn foo(i : u32) -> u32 { i<|> }\"#, r#\"fn foo(j : u32) -> u32 { j }\"#);\n     }\n \n     #[test]\n     fn test_rename_refs_for_fn_param() {\n-        check(\n-            \"new_name\",\n-            r#\"\n-fn foo(i<|> : u32) -> u32 {\n-    i\n-}\n-\"#,\n-            r#\"\n-fn foo(new_name : u32) -> u32 {\n-    new_name\n-}\n-\"#,\n-        );\n+        check(\"j\", r#\"fn foo(i<|> : u32) -> u32 { i }\"#, r#\"fn foo(j : u32) -> u32 { j }\"#);\n     }\n \n     #[test]\n     fn test_rename_for_mut_param() {\n-        check(\n-            \"new_name\",\n-            r#\"\n-fn foo(mut i<|> : u32) -> u32 {\n-    i\n-}\n-\"#,\n-            r#\"\n-fn foo(mut new_name : u32) -> u32 {\n-    new_name\n-}\n-\"#,\n-        );\n+        check(\"j\", r#\"fn foo(mut i<|> : u32) -> u32 { i }\"#, r#\"fn foo(mut j : u32) -> u32 { j }\"#);\n     }\n \n     #[test]\n@@ -602,7 +532,6 @@ impl Foo {\n             \"j\",\n             r#\"\n struct Foo { i<|>: i32 }\n-\n struct Bar { i: i32 }\n \n impl Bar {\n@@ -613,7 +542,6 @@ impl Bar {\n \"#,\n             r#\"\n struct Foo { j: i32 }\n-\n struct Bar { i: i32 }\n \n impl Bar {\n@@ -721,7 +649,53 @@ pub struct FooContent;\n //- /bar.rs\n use crate::foo<|>::FooContent;\n \"#,\n-            expect![[]],\n+            expect![[r#\"\n+                RangeInfo {\n+                    range: 11..14,\n+                    info: SourceChange {\n+                        source_file_edits: [\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    1,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"quux\",\n+                                            delete: 8..11,\n+                                        },\n+                                    ],\n+                                },\n+                            },\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    3,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"quux\",\n+                                            delete: 11..14,\n+                                        },\n+                                    ],\n+                                },\n+                            },\n+                        ],\n+                        file_system_edits: [\n+                            MoveFile {\n+                                src: FileId(\n+                                    2,\n+                                ),\n+                                anchor: FileId(\n+                                    3,\n+                                ),\n+                                dst: \"quux.rs\",\n+                            },\n+                        ],\n+                        is_snippet: false,\n+                    },\n+                }\n+            \"#]],\n         );\n     }\n \n@@ -735,7 +709,40 @@ mod fo<|>o;\n //- /foo/mod.rs\n // emtpy\n \"#,\n-            expect![[]],\n+            expect![[r#\"\n+                RangeInfo {\n+                    range: 4..7,\n+                    info: SourceChange {\n+                        source_file_edits: [\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    1,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"foo2\",\n+                                            delete: 4..7,\n+                                        },\n+                                    ],\n+                                },\n+                            },\n+                        ],\n+                        file_system_edits: [\n+                            MoveFile {\n+                                src: FileId(\n+                                    2,\n+                                ),\n+                                anchor: FileId(\n+                                    1,\n+                                ),\n+                                dst: \"../foo2/mod.rs\",\n+                            },\n+                        ],\n+                        is_snippet: false,\n+                    },\n+                }\n+            \"#]],\n         );\n     }\n \n@@ -744,22 +751,14 @@ mod fo<|>o;\n         check(\n             \"baz\",\n             r#\"\n-mod <|>foo {\n-    pub fn bar() {}\n-}\n+mod <|>foo { pub fn bar() {} }\n \n-fn main() {\n-    foo::bar();\n-}\n+fn main() { foo::bar(); }\n \"#,\n             r#\"\n-mod baz {\n-    pub fn bar() {}\n-}\n+mod baz { pub fn bar() {} }\n \n-fn main() {\n-    baz::bar();\n-}\n+fn main() { baz::bar(); }\n \"#,\n         );\n     }\n@@ -781,7 +780,53 @@ pub mod foo<|>;\n //- /bar/foo.rs\n // pub fn fun() {}\n \"#,\n-            expect![[]],\n+            expect![[r#\"\n+                RangeInfo {\n+                    range: 8..11,\n+                    info: SourceChange {\n+                        source_file_edits: [\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    2,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"foo2\",\n+                                            delete: 8..11,\n+                                        },\n+                                    ],\n+                                },\n+                            },\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    1,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"foo2\",\n+                                            delete: 27..30,\n+                                        },\n+                                    ],\n+                                },\n+                            },\n+                        ],\n+                        file_system_edits: [\n+                            MoveFile {\n+                                src: FileId(\n+                                    3,\n+                                ),\n+                                anchor: FileId(\n+                                    2,\n+                                ),\n+                                dst: \"foo2.rs\",\n+                            },\n+                        ],\n+                        is_snippet: false,\n+                    },\n+                }\n+            \"#]],\n         );\n     }\n \n@@ -791,9 +836,7 @@ pub mod foo<|>;\n             \"Baz\",\n             r#\"\n mod foo {\n-    pub enum Foo {\n-        Bar<|>,\n-    }\n+    pub enum Foo { Bar<|> }\n }\n \n fn func(f: foo::Foo) {\n@@ -804,9 +847,7 @@ fn func(f: foo::Foo) {\n \"#,\n             r#\"\n mod foo {\n-    pub enum Foo {\n-        Baz,\n-    }\n+    pub enum Foo { Baz }\n }\n \n fn func(f: foo::Foo) {"}]}