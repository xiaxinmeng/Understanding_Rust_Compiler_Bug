{"sha": "1ab96db7915f36bae5e1ad645861ef910b79904d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhYjk2ZGI3OTE1ZjM2YmFlNWUxYWQ2NDU4NjFlZjkxMGI3OTkwNGQ=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2018-04-01T07:28:53Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2018-04-01T07:44:30Z"}, "message": "Make dogfood test output to seperate directory\n\nThis commit makes `cargo clippy` output the build artifacts to a\nseparate directory if the `CLIPPY_DOGFOOD` env var is set. This should\nprevent dogfood builds from interfering with regular builds.\n\nThis should help with issue #2595.", "tree": {"sha": "ac8e9d1a6e026feee7cd138e6b3d4611111950d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac8e9d1a6e026feee7cd138e6b3d4611111950d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ab96db7915f36bae5e1ad645861ef910b79904d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ab96db7915f36bae5e1ad645861ef910b79904d", "html_url": "https://github.com/rust-lang/rust/commit/1ab96db7915f36bae5e1ad645861ef910b79904d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ab96db7915f36bae5e1ad645861ef910b79904d/comments", "author": null, "committer": null, "parents": [{"sha": "b45801ff192e6f1bd3504c05e612a1004f52a24e", "url": "https://api.github.com/repos/rust-lang/rust/commits/b45801ff192e6f1bd3504c05e612a1004f52a24e", "html_url": "https://github.com/rust-lang/rust/commit/b45801ff192e6f1bd3504c05e612a1004f52a24e"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "0baeab7338eb3c365040af20838062feea336afc", "filename": "src/main.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1ab96db7915f36bae5e1ad645861ef910b79904d/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ab96db7915f36bae5e1ad645861ef910b79904d/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=1ab96db7915f36bae5e1ad645861ef910b79904d", "patch": "@@ -77,10 +77,27 @@ where\n     if cfg!(windows) {\n         path.set_extension(\"exe\");\n     }\n+\n+    let mut extra_envs = vec![];\n+    if let Ok(_) = std::env::var(\"CLIPPY_DOGFOOD\") {\n+        let target_dir = std::env::var(\"CARGO_MANIFEST_DIR\")\n+            .map(|m| {\n+                std::path::PathBuf::from(m)\n+                    .join(\"target\")\n+                    .join(\"dogfood\")\n+                    .to_string_lossy()\n+                    .into_owned()\n+            })\n+            .unwrap_or(\"clippy_dogfood\".to_string());\n+\n+        extra_envs.push((\"CARGO_TARGET_DIR\", target_dir));\n+    };\n+\n     let exit_status = std::process::Command::new(\"cargo\")\n         .args(&args)\n         .env(\"RUSTC_WRAPPER\", path)\n         .env(\"CLIPPY_ARGS\", clippy_args)\n+        .envs(extra_envs)\n         .spawn()\n         .expect(\"could not run cargo\")\n         .wait()"}, {"sha": "a2d4da9a1ca4a75565e83c4e0cff78f6d95d5100", "filename": "tests/dogfood.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ab96db7915f36bae5e1ad645861ef910b79904d/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ab96db7915f36bae5e1ad645861ef910b79904d/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=1ab96db7915f36bae5e1ad645861ef910b79904d", "patch": "@@ -15,6 +15,7 @@ fn dogfood() {\n             .arg(\"cargo-clippy\")\n             .arg(\"--manifest-path\")\n             .arg(root_dir.join(\"Cargo.toml\"))\n+            .env(\"CLIPPY_DOGFOOD\", \"true\")\n             .output()\n             .unwrap();\n         println!(\"status: {}\", output.status);"}]}