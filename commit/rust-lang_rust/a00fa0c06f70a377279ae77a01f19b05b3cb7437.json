{"sha": "a00fa0c06f70a377279ae77a01f19b05b3cb7437", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwMGZhMGMwNmY3MGEzNzcyNzlhZTc3YTAxZjE5YjA1YjNjYjc0Mzc=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-02-10T14:12:45Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-02-10T14:12:45Z"}, "message": "Put the old resolver back", "tree": {"sha": "f0fa4d957d9cb361b05ee9e268e2077391beffc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f0fa4d957d9cb361b05ee9e268e2077391beffc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a00fa0c06f70a377279ae77a01f19b05b3cb7437", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a00fa0c06f70a377279ae77a01f19b05b3cb7437", "html_url": "https://github.com/rust-lang/rust/commit/a00fa0c06f70a377279ae77a01f19b05b3cb7437", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a00fa0c06f70a377279ae77a01f19b05b3cb7437/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "244d8e37f1cf42e30d3b668dfb088813e54adee2", "url": "https://api.github.com/repos/rust-lang/rust/commits/244d8e37f1cf42e30d3b668dfb088813e54adee2", "html_url": "https://github.com/rust-lang/rust/commit/244d8e37f1cf42e30d3b668dfb088813e54adee2"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "cb59a69374725ebf1dcc1aa8ca758bbaf7f6490b", "filename": "crates/hir_ty/src/infer/expr.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a00fa0c06f70a377279ae77a01f19b05b3cb7437/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a00fa0c06f70a377279ae77a01f19b05b3cb7437/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Finfer%2Fexpr.rs?ref=a00fa0c06f70a377279ae77a01f19b05b3cb7437", "patch": "@@ -138,8 +138,11 @@ impl<'a> InferenceContext<'a> {\n                 self.coerce_merge_branch(&then_ty, &else_ty)\n             }\n             Expr::Block { statements, tail, label, id: _ } => {\n-                self.resolver = resolver_for_expr(self.db.upcast(), self.owner, tgt_expr);\n-                match label {\n+                let old_resolver = mem::replace(\n+                    &mut self.resolver,\n+                    resolver_for_expr(self.db.upcast(), self.owner, tgt_expr),\n+                );\n+                let ty = match label {\n                     Some(_) => {\n                         let break_ty = self.table.new_type_var();\n                         self.breakables.push(BreakableContext {\n@@ -157,7 +160,9 @@ impl<'a> InferenceContext<'a> {\n                         }\n                     }\n                     None => self.infer_block(statements, *tail, expected),\n-                }\n+                };\n+                self.resolver = old_resolver;\n+                ty\n             }\n             Expr::Unsafe { body } | Expr::Const { body } => self.infer_expr(*body, expected),\n             Expr::TryBlock { body } => {"}]}