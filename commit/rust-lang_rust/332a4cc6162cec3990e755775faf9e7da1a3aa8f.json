{"sha": "332a4cc6162cec3990e755775faf9e7da1a3aa8f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMmE0Y2M2MTYyY2VjMzk5MGU3NTU3NzVmYWY5ZTdkYTFhM2FhOGY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-30T01:26:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-12-30T01:26:29Z"}, "message": "Rollup merge of #38647 - alexcrichton:faster-android, r=brson\n\ncompiletest: Don't limit all suites on Android\n\nOn Android we only have one test thread for supposed problems with concurrency\nand the remote debugger. Not all of our suites require one concurrency, however,\nand suites like compile-fail or pretty can be much faster if they're\nparallelized on Travis.\n\nThis commit only sets the test threads to one on Android for suites which\nactually run code, and other suites aren't tampered with.", "tree": {"sha": "f7baaf20b43a1ad9973df0a30ee491935b9ea21a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f7baaf20b43a1ad9973df0a30ee491935b9ea21a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/332a4cc6162cec3990e755775faf9e7da1a3aa8f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/332a4cc6162cec3990e755775faf9e7da1a3aa8f", "html_url": "https://github.com/rust-lang/rust/commit/332a4cc6162cec3990e755775faf9e7da1a3aa8f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/332a4cc6162cec3990e755775faf9e7da1a3aa8f/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b8ab85551877755a652170935eee280f88c7ff6", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b8ab85551877755a652170935eee280f88c7ff6", "html_url": "https://github.com/rust-lang/rust/commit/8b8ab85551877755a652170935eee280f88c7ff6"}, {"sha": "f26e52efa56946c04c3751509a001c91c477e77b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f26e52efa56946c04c3751509a001c91c477e77b", "html_url": "https://github.com/rust-lang/rust/commit/f26e52efa56946c04c3751509a001c91c477e77b"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "f04e308d62fbc4d65bb9bdb335c6572b4a9f98bc", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/332a4cc6162cec3990e755775faf9e7da1a3aa8f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/332a4cc6162cec3990e755775faf9e7da1a3aa8f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=332a4cc6162cec3990e755775faf9e7da1a3aa8f", "patch": "@@ -261,7 +261,24 @@ pub fn run_tests(config: &Config) {\n         // android debug-info test uses remote debugger\n         // so, we test 1 thread at once.\n         // also trying to isolate problems with adb_run_wrapper.sh ilooping\n-        env::set_var(\"RUST_TEST_THREADS\",\"1\");\n+        match config.mode {\n+            // These tests don't actually run code or don't run for android, so\n+            // we don't need to limit ourselves there\n+            Mode::Ui |\n+            Mode::CompileFail |\n+            Mode::ParseFail |\n+            Mode::RunMake |\n+            Mode::Codegen |\n+            Mode::CodegenUnits |\n+            Mode::Pretty |\n+            Mode::Rustdoc |\n+            Mode::Incremental => {}\n+\n+            _ => {\n+                env::set_var(\"RUST_TEST_THREADS\", \"1\");\n+            }\n+\n+        }\n     }\n \n     match config.mode {"}]}