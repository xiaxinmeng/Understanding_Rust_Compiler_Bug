{"sha": "e290891dd75f2ae2d156e8610fd037a84c1b853f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyOTA4OTFkZDc1ZjJhZTJkMTU2ZTg2MTBmZDAzN2E4NGMxYjg1M2Y=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-05-11T18:02:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-11T18:02:31Z"}, "message": "Merge #8801\n\n8801: feat: Allow viewing the crate graph in a webview r=jonas-schievink a=jonas-schievink\n\nThis uses `dot` to render the crate graph as an SVD file, and displays it in a VS Code panel. For simple crate graphs, it works quite well:\r\n\r\n![screenshot-2021-05-11-16:19:32](https://user-images.githubusercontent.com/1786438/117831361-c4a48980-b274-11eb-9276-240cdf6919aa.png)\r\n\r\nUnfortunately, on rust-analyzer itself (and most medium-sized dependency graphs), `dot` runs for around a minute and then produces this mess:\r\n\r\n![screenshot-2021-05-11-16:41:37](https://user-images.githubusercontent.com/1786438/117834831-c754ae00-b277-11eb-850b-138495dbeba8.png)\r\n\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>", "tree": {"sha": "a7a8eb48ae6d5e4ccb759d1b2c180d522170097d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7a8eb48ae6d5e4ccb759d1b2c180d522170097d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e290891dd75f2ae2d156e8610fd037a84c1b853f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgmsa3CRBK7hj4Ov3rIwAAEiUIAChicTLrQkq83GX/x1waneMP\naisPnzov/64wgTjjUFqIvRFRxA3rwp3ITMKlE0MKoKk/fP84d9jsoiZoESYfXUw/\nUoXmn2FYlkolQTesGhOvSfaQ2nBCwQ2atqka3tvT2O3JVLn42eY83/dlF1wjtH79\nPbhDeLRTC1SIISKOhpLZNk6NmHRyCNG6vQIqLU4El+OTdau4SXjQ08Dd0cJP4VeJ\nRD5733sEY/vCtoLf6rNgmp79tSvCEdtOPIdNohyGDSjVJftulA+7X02V9wEQ+qRg\n/MTWVAW7sawU0qN5HmLuukbLcz2HXfKcTi8pEObhFPsMnbr6GUMoJVS2chvrtK0=\n=YGWC\n-----END PGP SIGNATURE-----\n", "payload": "tree a7a8eb48ae6d5e4ccb759d1b2c180d522170097d\nparent 6afd9b2b8dcfaa9338303f29d8fc6c90dbcdd6e7\nparent d1aa6bbe753e50517d568a4b7560f765fbc75bd2\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1620756151 +0000\ncommitter GitHub <noreply@github.com> 1620756151 +0000\n\nMerge #8801\n\n8801: feat: Allow viewing the crate graph in a webview r=jonas-schievink a=jonas-schievink\n\nThis uses `dot` to render the crate graph as an SVD file, and displays it in a VS Code panel. For simple crate graphs, it works quite well:\r\n\r\n![screenshot-2021-05-11-16:19:32](https://user-images.githubusercontent.com/1786438/117831361-c4a48980-b274-11eb-9276-240cdf6919aa.png)\r\n\r\nUnfortunately, on rust-analyzer itself (and most medium-sized dependency graphs), `dot` runs for around a minute and then produces this mess:\r\n\r\n![screenshot-2021-05-11-16:41:37](https://user-images.githubusercontent.com/1786438/117834831-c754ae00-b277-11eb-850b-138495dbeba8.png)\r\n\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e290891dd75f2ae2d156e8610fd037a84c1b853f", "html_url": "https://github.com/rust-lang/rust/commit/e290891dd75f2ae2d156e8610fd037a84c1b853f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e290891dd75f2ae2d156e8610fd037a84c1b853f/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6afd9b2b8dcfaa9338303f29d8fc6c90dbcdd6e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/6afd9b2b8dcfaa9338303f29d8fc6c90dbcdd6e7", "html_url": "https://github.com/rust-lang/rust/commit/6afd9b2b8dcfaa9338303f29d8fc6c90dbcdd6e7"}, {"sha": "d1aa6bbe753e50517d568a4b7560f765fbc75bd2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1aa6bbe753e50517d568a4b7560f765fbc75bd2", "html_url": "https://github.com/rust-lang/rust/commit/d1aa6bbe753e50517d568a4b7560f765fbc75bd2"}], "stats": {"total": 167, "additions": 166, "deletions": 1}, "files": [{"sha": "f9c34547ed5432cdb0afc699339d6f0a16d4b31e", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -319,6 +319,12 @@ version = \"1.0.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"fc4b29f4b9bb94bf267d57269fd0706d343a160937108e9619fe380645428abb\"\n \n+[[package]]\n+name = \"dot\"\n+version = \"0.1.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a74b6c4d4a1cff5f454164363c16b72fa12463ca6b31f4b5f2035a65fa3d5906\"\n+\n [[package]]\n name = \"drop_bomb\"\n version = \"0.1.5\"\n@@ -588,6 +594,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"cfg\",\n  \"cov-mark\",\n+ \"dot\",\n  \"either\",\n  \"expect-test\",\n  \"hir\","}, {"sha": "88f3d09d3407fd8a875ad7d497cf770bb3f592c9", "filename": "crates/ide/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2FCargo.toml?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -20,6 +20,7 @@ oorandom = \"11.1.2\"\n pulldown-cmark-to-cmark = \"6.0.0\"\n pulldown-cmark = { version = \"0.8.0\", default-features = false }\n url = \"2.1.1\"\n+dot = \"0.1.4\"\n \n stdx = { path = \"../stdx\", version = \"0.0.0\" }\n syntax = { path = \"../syntax\", version = \"0.0.0\" }"}, {"sha": "34360501af8eea46de28fc148bd1d94117be26d9", "filename": "crates/ide/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Flib.rs?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -49,6 +49,7 @@ mod syntax_tree;\n mod typing;\n mod markdown_remove;\n mod doc_links;\n+mod view_crate_graph;\n \n use std::sync::Arc;\n \n@@ -287,6 +288,10 @@ impl Analysis {\n         self.with_db(|db| view_hir::view_hir(&db, position))\n     }\n \n+    pub fn view_crate_graph(&self) -> Cancelable<Result<String, String>> {\n+        self.with_db(|db| view_crate_graph::view_crate_graph(&db))\n+    }\n+\n     pub fn expand_macro(&self, position: FilePosition) -> Cancelable<Option<ExpandedMacro>> {\n         self.with_db(|db| expand_macro::expand_macro(db, position))\n     }"}, {"sha": "5e4ba881ef1b85664e5ef543ad3a0ccae91c9d18", "filename": "crates/ide/src/view_crate_graph.rs", "status": "added", "additions": 111, "deletions": 0, "changes": 111, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2Fsrc%2Fview_crate_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Fide%2Fsrc%2Fview_crate_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fview_crate_graph.rs?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -0,0 +1,111 @@\n+use std::{\n+    error::Error,\n+    io::{Read, Write},\n+    process::{Command, Stdio},\n+    sync::Arc,\n+};\n+\n+use dot::{Id, LabelText};\n+use ide_db::{\n+    base_db::{CrateGraph, CrateId, Dependency, SourceDatabase, SourceDatabaseExt},\n+    RootDatabase,\n+};\n+use rustc_hash::FxHashSet;\n+\n+// Feature: View Crate Graph\n+//\n+// Renders the currently loaded crate graph as an SVG graphic. Requires the `dot` tool, which\n+// is part of graphviz, to be installed.\n+//\n+// Only workspace crates are included, no crates.io dependencies or sysroot crates.\n+//\n+// |===\n+// | Editor  | Action Name\n+//\n+// | VS Code | **Rust Analyzer: View Crate Graph**\n+// |===\n+pub(crate) fn view_crate_graph(db: &RootDatabase) -> Result<String, String> {\n+    let crate_graph = db.crate_graph();\n+    let crates_to_render = crate_graph\n+        .iter()\n+        .filter(|krate| {\n+            // Only render workspace crates\n+            let root_id = db.file_source_root(crate_graph[*krate].root_file_id);\n+            !db.source_root(root_id).is_library\n+        })\n+        .collect();\n+    let graph = DotCrateGraph { graph: crate_graph, crates_to_render };\n+\n+    let mut dot = Vec::new();\n+    dot::render(&graph, &mut dot).unwrap();\n+\n+    render_svg(&dot).map_err(|e| e.to_string())\n+}\n+\n+fn render_svg(dot: &[u8]) -> Result<String, Box<dyn Error>> {\n+    // We shell out to `dot` to render to SVG, as there does not seem to be a pure-Rust renderer.\n+    let child = Command::new(\"dot\")\n+        .arg(\"-Tsvg\")\n+        .stdin(Stdio::piped())\n+        .stdout(Stdio::piped())\n+        .spawn()\n+        .map_err(|err| format!(\"failed to spawn `dot`: {}\", err))?;\n+    child.stdin.unwrap().write_all(&dot)?;\n+\n+    let mut svg = String::new();\n+    child.stdout.unwrap().read_to_string(&mut svg)?;\n+    Ok(svg)\n+}\n+\n+struct DotCrateGraph {\n+    graph: Arc<CrateGraph>,\n+    crates_to_render: FxHashSet<CrateId>,\n+}\n+\n+type Edge<'a> = (CrateId, &'a Dependency);\n+\n+impl<'a> dot::GraphWalk<'a, CrateId, Edge<'a>> for DotCrateGraph {\n+    fn nodes(&'a self) -> dot::Nodes<'a, CrateId> {\n+        self.crates_to_render.iter().copied().collect()\n+    }\n+\n+    fn edges(&'a self) -> dot::Edges<'a, Edge<'a>> {\n+        self.crates_to_render\n+            .iter()\n+            .flat_map(|krate| {\n+                self.graph[*krate]\n+                    .dependencies\n+                    .iter()\n+                    .filter(|dep| self.crates_to_render.contains(&dep.crate_id))\n+                    .map(move |dep| (*krate, dep))\n+            })\n+            .collect()\n+    }\n+\n+    fn source(&'a self, edge: &Edge<'a>) -> CrateId {\n+        edge.0\n+    }\n+\n+    fn target(&'a self, edge: &Edge<'a>) -> CrateId {\n+        edge.1.crate_id\n+    }\n+}\n+\n+impl<'a> dot::Labeller<'a, CrateId, Edge<'a>> for DotCrateGraph {\n+    fn graph_id(&'a self) -> Id<'a> {\n+        Id::new(\"rust_analyzer_crate_graph\").unwrap()\n+    }\n+\n+    fn node_id(&'a self, n: &CrateId) -> Id<'a> {\n+        Id::new(format!(\"_{}\", n.0)).unwrap()\n+    }\n+\n+    fn node_shape(&'a self, _node: &CrateId) -> Option<LabelText<'a>> {\n+        Some(LabelText::LabelStr(\"box\".into()))\n+    }\n+\n+    fn node_label(&'a self, n: &CrateId) -> LabelText<'a> {\n+        let name = self.graph[*n].display_name.as_ref().map_or(\"(unnamed crate)\", |name| &*name);\n+        LabelText::LabelStr(name.into())\n+    }\n+}"}, {"sha": "dafbab6d094f10a6d83c48864c297e7ec9679454", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -117,6 +117,12 @@ pub(crate) fn handle_view_hir(\n     Ok(res)\n }\n \n+pub(crate) fn handle_view_crate_graph(snap: GlobalStateSnapshot, (): ()) -> Result<String> {\n+    let _p = profile::span(\"handle_view_crate_graph\");\n+    let res = snap.analysis.view_crate_graph()??;\n+    Ok(res)\n+}\n+\n pub(crate) fn handle_expand_macro(\n     snap: GlobalStateSnapshot,\n     params: lsp_ext::ExpandMacroParams,"}, {"sha": "3bd09805800b7f92b8e03684db148cbe2eb04889", "filename": "crates/rust-analyzer/src/lsp_ext.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -61,6 +61,14 @@ impl Request for ViewHir {\n     const METHOD: &'static str = \"rust-analyzer/viewHir\";\n }\n \n+pub enum ViewCrateGraph {}\n+\n+impl Request for ViewCrateGraph {\n+    type Params = ();\n+    type Result = String;\n+    const METHOD: &'static str = \"rust-analyzer/viewCrateGraph\";\n+}\n+\n pub enum ExpandMacro {}\n \n impl Request for ExpandMacro {"}, {"sha": "c7bd7eee1a90d55e160f73ac5ba1d23481cb80b9", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -513,6 +513,7 @@ impl GlobalState {\n             .on::<lsp_ext::AnalyzerStatus>(handlers::handle_analyzer_status)\n             .on::<lsp_ext::SyntaxTree>(handlers::handle_syntax_tree)\n             .on::<lsp_ext::ViewHir>(handlers::handle_view_hir)\n+            .on::<lsp_ext::ViewCrateGraph>(handlers::handle_view_crate_graph)\n             .on::<lsp_ext::ExpandMacro>(handlers::handle_expand_macro)\n             .on::<lsp_ext::ParentModule>(handlers::handle_parent_module)\n             .on::<lsp_ext::Runnables>(handlers::handle_runnables)"}, {"sha": "8fcd72d5d5dfa49084b7ca3f8d4d6fd254fb9a40", "filename": "docs/dev/lsp-extensions.md", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/docs%2Fdev%2Flsp-extensions.md", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/docs%2Fdev%2Flsp-extensions.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Flsp-extensions.md?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -1,5 +1,5 @@\n <!---\n-lsp_ext.rs hash: 28a9d5a24b7ca396\n+lsp_ext.rs hash: 6e57fc1b345b00e9\n \n If you need to change the above hash to make the test pass, please check if you\n need to adjust this doc as well and ping this issue:\n@@ -486,6 +486,16 @@ Primarily for debugging, but very useful for all people working on rust-analyzer\n Returns a textual representation of the HIR of the function containing the cursor.\n For debugging or when working on rust-analyzer itself.\n \n+## View Crate Graph\n+\n+**Method:** `rust-analyzer/viewCrateGraph`\n+\n+**Request:** `null`\n+\n+**Response:** `string`\n+\n+Renders rust-analyzer's crate graph as an SVG image.\n+\n ## Expand Macro\n \n **Method:** `rust-analyzer/expandMacro`"}, {"sha": "0f38a1673ac013e0ecff26be8610a6a2fef10581", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -109,6 +109,11 @@\n                 \"title\": \"View Hir\",\n                 \"category\": \"Rust Analyzer\"\n             },\n+            {\n+                \"command\": \"rust-analyzer.viewCrateGraph\",\n+                \"title\": \"View Crate Graph\",\n+                \"category\": \"Rust Analyzer\"\n+            },\n             {\n                 \"command\": \"rust-analyzer.expandMacro\",\n                 \"title\": \"Expand macro recursively\","}, {"sha": "8ab259af22119a5182f986c4d58bcacdb78d68e4", "filename": "editors/code/src/commands.ts", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Fcommands.ts", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Fcommands.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands.ts?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -429,6 +429,14 @@ export function viewHir(ctx: Ctx): Cmd {\n     };\n }\n \n+export function viewCrateGraph(ctx: Ctx): Cmd {\n+    return async () => {\n+        const panel = vscode.window.createWebviewPanel(\"rust-analyzer.crate-graph\", \"rust-analyzer crate graph\", vscode.ViewColumn.Two);\n+        const svg = await ctx.client.sendRequest(ra.viewCrateGraph);\n+        panel.webview.html = svg;\n+    };\n+}\n+\n // Opens the virtual file that will show the syntax tree\n //\n // The contents of the file come from the `TextDocumentContentProvider`"}, {"sha": "aa745a65ce60e855668216d4fc30f38f646605aa", "filename": "editors/code/src/lsp_ext.ts", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Flsp_ext.ts", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Flsp_ext.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Flsp_ext.ts?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -27,6 +27,8 @@ export const syntaxTree = new lc.RequestType<SyntaxTreeParams, string, void>(\"ru\n \n export const viewHir = new lc.RequestType<lc.TextDocumentPositionParams, string, void>(\"rust-analyzer/viewHir\");\n \n+export const viewCrateGraph = new lc.RequestType0<string, void>(\"rust-analyzer/viewCrateGraph\");\n+\n export interface ExpandMacroParams {\n     textDocument: lc.TextDocumentIdentifier;\n     position: lc.Position;"}, {"sha": "516322d035d4672796a328a6c60dc6f5af9fe361", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/e290891dd75f2ae2d156e8610fd037a84c1b853f/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=e290891dd75f2ae2d156e8610fd037a84c1b853f", "patch": "@@ -106,6 +106,7 @@ async function tryActivate(context: vscode.ExtensionContext) {\n     ctx.registerCommand('parentModule', commands.parentModule);\n     ctx.registerCommand('syntaxTree', commands.syntaxTree);\n     ctx.registerCommand('viewHir', commands.viewHir);\n+    ctx.registerCommand('viewCrateGraph', commands.viewCrateGraph);\n     ctx.registerCommand('expandMacro', commands.expandMacro);\n     ctx.registerCommand('run', commands.run);\n     ctx.registerCommand('copyRunCommandLine', commands.copyRunCommandLine);"}]}