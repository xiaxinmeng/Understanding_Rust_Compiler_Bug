{"sha": "a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "node_id": "C_kwDOAAsO6NoAKGEzNDcwYTgxMTRlYjNkYjJlNjdhNDg3NmIwNGM3MGZiOGY3YmE3MTI", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T08:39:08Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T08:39:08Z"}, "message": "move tests", "tree": {"sha": "52d13b6f9b4ad94c6dc999d43ac2f4f9bc67dcc8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52d13b6f9b4ad94c6dc999d43ac2f4f9bc67dcc8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "html_url": "https://github.com/rust-lang/rust/commit/a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e53a3ce23c2ad9c0b92fbc3f5c3a025fa3be6a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e53a3ce23c2ad9c0b92fbc3f5c3a025fa3be6a6", "html_url": "https://github.com/rust-lang/rust/commit/7e53a3ce23c2ad9c0b92fbc3f5c3a025fa3be6a6"}], "stats": {"total": 173, "additions": 89, "deletions": 84}, "files": [{"sha": "66874a674d821841fa6c8dbdcbbe14c82669d66c", "filename": "crates/hir_def/src/macro_expansion_tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs?ref=a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "patch": "@@ -131,6 +131,7 @@ fn pretty_print_macro_expansion(expn: SyntaxNode) -> String {\n             (T![,], _) => \" \",\n             (T![fn], T!['(']) => \"\",\n             (T![']'], _) if curr_kind.is_keyword() => \" \",\n+            (T![']'], T![#]) => \"\\n\",\n             _ if prev_kind.is_keyword() => \" \",\n             _ => \"\",\n         };"}, {"sha": "d17c9131da752bee9d6c073741ddd09d4abac21c", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "patch": "@@ -956,3 +956,90 @@ macro_rules! m {\n \"##]],\n     );\n }\n+\n+#[test]\n+fn test_meta_doc_comments() {\n+    cov_mark::check!(test_meta_doc_comments);\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($(#[$m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+m! {\n+    /// Single Line Doc 1\n+    /**\n+        MultiLines Doc\n+    */\n+}\n+\"#,\n+        expect![[r##\"\n+macro_rules! m {\n+    ($(#[$m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+#[doc = \" Single Line Doc 1\"]\n+#[doc = \"\\n        MultiLines Doc\\n    \"] fn bar() {}\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_meta_extended_key_value_attributes() {\n+    check(\n+        r#\"\n+macro_rules! m {\n+    (#[$m:meta]) => ( #[$m] fn bar() {} )\n+}\n+m! { #[doc = concat!(\"The `\", \"bla\", \"` lang item.\")] }\n+\"#,\n+        expect![[r##\"\n+macro_rules! m {\n+    (#[$m:meta]) => ( #[$m] fn bar() {} )\n+}\n+#[doc = concat!(\"The `\", \"bla\", \"` lang item.\")] fn bar() {}\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_meta_doc_comments_non_latin() {\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($(#[$ m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+m! {\n+    /// \u9326\u745f\u7121\u7aef\u4e94\u5341\u5f26\uff0c\u4e00\u5f26\u4e00\u67f1\u601d\u83ef\u5e74\u3002\n+    /**\n+        \u838a\u751f\u66c9\u5922\u8ff7\u8774\u8776\uff0c\u671b\u5e1d\u6625\u5fc3\u8a17\u675c\u9d51\u3002\n+    */\n+}\n+\"#,\n+        expect![[r##\"\n+macro_rules! m {\n+    ($(#[$ m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+#[doc = \" \u9326\u745f\u7121\u7aef\u4e94\u5341\u5f26\uff0c\u4e00\u5f26\u4e00\u67f1\u601d\u83ef\u5e74\u3002\"]\n+#[doc = \"\\n        \u838a\u751f\u66c9\u5922\u8ff7\u8774\u8776\uff0c\u671b\u5e1d\u6625\u5fc3\u8a17\u675c\u9d51\u3002\\n    \"] fn bar() {}\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_meta_doc_comments_escaped_characters() {\n+    check(\n+        r#\"\n+macro_rules! m {\n+    ($(#[$m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+m! {\n+    /// \\ \" '\n+}\n+\"#,\n+        expect![[r##\"\n+macro_rules! m {\n+    ($(#[$m:meta])+) => ( $(#[$m])+ fn bar() {} )\n+}\n+#[doc = \" \\\\ \\\" \\'\"] fn bar() {}\n+\"##]],\n+    );\n+}"}, {"sha": "6bd57bb568bf577468ce425a5d9d8f18da9bce40", "filename": "crates/mbe/src/syntax_bridge.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs?ref=a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "patch": "@@ -307,6 +307,7 @@ fn doc_comment_text(comment: &ast::Comment) -> SmolStr {\n }\n \n fn convert_doc_comment(token: &syntax::SyntaxToken) -> Option<Vec<tt::TokenTree>> {\n+    cov_mark::hit!(test_meta_doc_comments);\n     let comment = ast::Comment::cast(token.clone())?;\n     let doc = comment.kind().doc?;\n "}, {"sha": "2ff85740f5c4b03afb2db18496dc1fb9278a197d", "filename": "crates/mbe/src/tests/expand.rs", "status": "modified", "additions": 0, "deletions": 84, "changes": 84, "blob_url": "https://github.com/rust-lang/rust/blob/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3470a8114eb3db2e67a4876b04c70fb8f7ba712/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs?ref=a3470a8114eb3db2e67a4876b04c70fb8f7ba712", "patch": "@@ -101,90 +101,6 @@ fn test_attr_to_token_tree() {\n     );\n }\n \n-#[test]\n-fn test_meta_doc_comments() {\n-    parse_macro(\n-        r#\"\n-        macro_rules! foo {\n-            ($(#[$ i:meta])+) => (\n-                $(#[$ i])+\n-                fn bar() {}\n-            )\n-        }\n-\"#,\n-    ).\n-    assert_expand_items(\n-        r#\"foo! {\n-            /// Single Line Doc 1\n-            /**\n-                MultiLines Doc\n-            */\n-        }\"#,\n-        \"# [doc = \\\" Single Line Doc 1\\\"] # [doc = \\\"\\\\n                MultiLines Doc\\\\n            \\\"] fn bar () {}\",\n-    );\n-}\n-\n-#[test]\n-fn test_meta_extended_key_value_attributes() {\n-    parse_macro(\n-        r#\"\n-macro_rules! foo {\n-    (#[$i:meta]) => (\n-        #[$ i]\n-        fn bar() {}\n-    )\n-}\n-\"#,\n-    )\n-    .assert_expand_items(\n-        r#\"foo! { #[doc = concat!(\"The `\", \"bla\", \"` lang item.\")] }\"#,\n-        r#\"# [doc = concat ! (\"The `\" , \"bla\" , \"` lang item.\")] fn bar () {}\"#,\n-    );\n-}\n-\n-#[test]\n-fn test_meta_doc_comments_non_latin() {\n-    parse_macro(\n-        r#\"\n-        macro_rules! foo {\n-            ($(#[$ i:meta])+) => (\n-                $(#[$ i])+\n-                fn bar() {}\n-            )\n-        }\n-\"#,\n-    ).\n-    assert_expand_items(\n-        r#\"foo! {\n-            /// \u9326\u745f\u7121\u7aef\u4e94\u5341\u5f26\uff0c\u4e00\u5f26\u4e00\u67f1\u601d\u83ef\u5e74\u3002\n-            /**\n-                \u838a\u751f\u66c9\u5922\u8ff7\u8774\u8776\uff0c\u671b\u5e1d\u6625\u5fc3\u8a17\u675c\u9d51\u3002\n-            */\n-        }\"#,\n-        \"# [doc = \\\" \u9326\u745f\u7121\u7aef\u4e94\u5341\u5f26\uff0c\u4e00\u5f26\u4e00\u67f1\u601d\u83ef\u5e74\u3002\\\"] # [doc = \\\"\\\\n                \u838a\u751f\u66c9\u5922\u8ff7\u8774\u8776\uff0c\u671b\u5e1d\u6625\u5fc3\u8a17\u675c\u9d51\u3002\\\\n            \\\"] fn bar () {}\",\n-    );\n-}\n-\n-#[test]\n-fn test_meta_doc_comments_escaped_characters() {\n-    parse_macro(\n-        r#\"\n-        macro_rules! foo {\n-            ($(#[$ i:meta])+) => (\n-                $(#[$ i])+\n-                fn bar() {}\n-            )\n-        }\n-\"#,\n-    )\n-    .assert_expand_items(\n-        r#\"foo! {\n-            /// \\ \" '\n-        }\"#,\n-        r#\"# [doc = \" \\\\ \\\" \\'\"] fn bar () {}\"#,\n-    );\n-}\n-\n #[test]\n fn test_tt_block() {\n     parse_macro("}]}