{"sha": "183964505bf6775c90da5d034cc8951cd46d7c10", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4Mzk2NDUwNWJmNjc3NWM5MGRhNWQwMzRjYzg5NTFjZDQ2ZDdjMTA=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-11-30T10:21:11Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-12-03T10:36:56Z"}, "message": "Update the tools CI to use --no-fail-fast and --save-toolstates.", "tree": {"sha": "c139671a64afdb78acbf500bf90aaa93684ff53f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c139671a64afdb78acbf500bf90aaa93684ff53f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/183964505bf6775c90da5d034cc8951cd46d7c10", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAloj08gACgkQ/vbIBR0O\nATxx/RAAgkqwLAAtxctdnfkPNwxjtGZCfOnnbXhL5TrDhlVavhrdsp5b3uv2Xdee\nfN6gcyUmkHqKTHYJLaUs3i5Dkf4YfAL7deGWqt1nazaPvUbGd3LuatKvV71PgAtb\nSLhBLfN9WJ1CO01p5FPQ/s6IiLFLb/Q3YJMvzn6jGSbV+kZLQdYI1u1TXYWFD+IM\n2wMsbpDUBJBamU4gT0OHjXymA99i+AdEN8ap9KcQlPtWEf9jRElBmikGSqA5DV0W\nO85TMjEhvHsLthc2uuMqp5ZCARU7vR6tpxNO3FqSh0B8vbkdTg4dAuvnk7O601S1\nOLvjxtoR8U5RxIbQQybTlzFVqsrKReEaLhcok/w1Gf/gTB6BFKkKOCTcxM+JtWoN\nidAMElZG00lM9d1U4KrFuC5jPIdBQfeWolQvO8rgq990kLSLAN0M2QmSxJya2FyT\ntLiarLT3o713EC0HfAFm0+qCVnzVY3AnsfzYBDWjHqcoKT6dgGY+RbSJI57lh9/9\nb6I/6p7DifowMxfi3zR7vWtggMYlF+ki04asryEvBW/rym/HI9xaoCA2W8oLgsA/\n2hgOB3/cpB6vBIYLMH4oOumIor6vF2xkO3DX95PVXdKFKcX6tYsA1uUVklHQarGF\nm/kfC1VOOaxgLrWnjuf3ogXsncUcPt8ZTEjH81oZf+YWtzLMVkc=\n=xBVk\n-----END PGP SIGNATURE-----", "payload": "tree c139671a64afdb78acbf500bf90aaa93684ff53f\nparent 971b1ba42bcb318baf31047cf80a4cf532756ec8\nauthor kennytm <kennytm@gmail.com> 1512037271 +0800\ncommitter kennytm <kennytm@gmail.com> 1512297416 +0800\n\nUpdate the tools CI to use --no-fail-fast and --save-toolstates.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/183964505bf6775c90da5d034cc8951cd46d7c10", "html_url": "https://github.com/rust-lang/rust/commit/183964505bf6775c90da5d034cc8951cd46d7c10", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/183964505bf6775c90da5d034cc8951cd46d7c10/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "971b1ba42bcb318baf31047cf80a4cf532756ec8", "url": "https://api.github.com/repos/rust-lang/rust/commits/971b1ba42bcb318baf31047cf80a4cf532756ec8", "html_url": "https://github.com/rust-lang/rust/commit/971b1ba42bcb318baf31047cf80a4cf532756ec8"}], "stats": {"total": 61, "additions": 47, "deletions": 14}, "files": [{"sha": "b8fd479d0f149b4415e3453b9a0e7cace775113b", "filename": "appveyor.yml", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/183964505bf6775c90da5d034cc8951cd46d7c10/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/183964505bf6775c90da5d034cc8951cd46d7c10/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=183964505bf6775c90da5d034cc8951cd46d7c10", "patch": "@@ -27,13 +27,8 @@ environment:\n \n   # MSVC tools tests\n   - MSYS_BITS: 64\n-    SCRIPT: >\n-      python x.py test --no-fail-fast\n-        src/tools/rls\n-        src/tools/rustfmt\n-        src/tools/miri\n-        src/tools/clippy\n-    RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc\n+    SCRIPT: src/ci/docker/x86_64-gnu-tools/checktools.sh x.py toolstates.json\n+    RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --save-toolstates=toolstates.json\n \n   # 32/64-bit MinGW builds.\n   #"}, {"sha": "fffad1c42dfd80d9ac34de825a55b0bc4c08de50", "filename": "src/ci/docker/x86_64-gnu-tools/Dockerfile", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2FDockerfile?ref=183964505bf6775c90da5d034cc8951cd46d7c10", "patch": "@@ -17,9 +17,7 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n-ENV SCRIPT python2.7 ../x.py --no-fail-fast \\\n-  src/tools/rls \\\n-  src/tools/rustfmt \\\n-  src/tools/miri \\\n-  src/tools/clippy\n+COPY x86_64-gnu-tools/checktools.sh /tmp/\n+\n+ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --save-toolstates=/tmp/toolstates.json\n+ENV SCRIPT /tmp/checktools.sh ../x.py /tmp/toolstates.json"}, {"sha": "bf39bc28a67eac2e293a03143458ea172b7ef86f", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=183964505bf6775c90da5d034cc8951cd46d7c10", "patch": "@@ -0,0 +1,39 @@\n+#!/bin/sh\n+\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -eu\n+\n+X_PY=\"$1\"\n+TOOLSTATE_FILE=\"$2\"\n+\n+touch \"$TOOLSTATE_FILE\"\n+\n+set +e\n+python2.7 \"$X_PY\" test --no-fail-fast \\\n+    src/tools/rls \\\n+    src/tools/rustfmt \\\n+    src/tools/miri \\\n+    src/tools/clippy\n+TEST_RESULT=$?\n+set -e\n+\n+# FIXME: Upload this file to the repository.\n+cat \"$TOOLSTATE_FILE\"\n+\n+# FIXME: After we can properly inform dev-tool maintainers about failure,\n+#        comment out the `exit 0` below.\n+if [ \"$RUST_RELEASE_CHANNEL\" = nightly ]; then\n+    # exit 0\n+    true\n+fi\n+\n+exit $TEST_RESULT"}, {"sha": "dab385c09649cd5a4b54cff972b93b1b2ff8ab0f", "filename": "src/ci/run.sh", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/183964505bf6775c90da5d034cc8951cd46d7c10/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=183964505bf6775c90da5d034cc8951cd46d7c10", "patch": "@@ -42,8 +42,9 @@ fi\n #\n # FIXME: need a scheme for changing this `nightly` value to `beta` and `stable`\n #        either automatically or manually.\n+export RUST_RELEASE_CHANNEL=nightly\n if [ \"$DEPLOY$DEPLOY_ALT\" != \"\" ]; then\n-  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=nightly\"\n+  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-llvm-static-stdcpp\"\n \n   if [ \"$NO_LLVM_ASSERTIONS\" = \"1\" ]; then"}]}