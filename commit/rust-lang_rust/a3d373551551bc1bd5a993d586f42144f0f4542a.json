{"sha": "a3d373551551bc1bd5a993d586f42144f0f4542a", "node_id": "C_kwDOAAsO6NoAKGEzZDM3MzU1MTU1MWJjMWJkNWE5OTNkNTg2ZjQyMTQ0ZjBmNDU0MmE", "commit": {"author": {"name": "surechen", "email": "chenshuo17@huawei.com", "date": "2021-09-18T10:35:17Z"}, "committer": {"name": "surechen", "email": "chenshuo17@huawei.com", "date": "2021-09-30T02:41:36Z"}, "message": "Arrays of sizes from 0 to 32 (inclusive) implement [Default] trait, edit method is_default_equivalent() to satisfy with this.", "tree": {"sha": "dcc279cb859647246758ade4cd16dd7b0f4f834d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dcc279cb859647246758ade4cd16dd7b0f4f834d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3d373551551bc1bd5a993d586f42144f0f4542a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3d373551551bc1bd5a993d586f42144f0f4542a", "html_url": "https://github.com/rust-lang/rust/commit/a3d373551551bc1bd5a993d586f42144f0f4542a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3d373551551bc1bd5a993d586f42144f0f4542a/comments", "author": {"login": "surechen", "id": 7249331, "node_id": "MDQ6VXNlcjcyNDkzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/7249331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/surechen", "html_url": "https://github.com/surechen", "followers_url": "https://api.github.com/users/surechen/followers", "following_url": "https://api.github.com/users/surechen/following{/other_user}", "gists_url": "https://api.github.com/users/surechen/gists{/gist_id}", "starred_url": "https://api.github.com/users/surechen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/surechen/subscriptions", "organizations_url": "https://api.github.com/users/surechen/orgs", "repos_url": "https://api.github.com/users/surechen/repos", "events_url": "https://api.github.com/users/surechen/events{/privacy}", "received_events_url": "https://api.github.com/users/surechen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "surechen", "id": 7249331, "node_id": "MDQ6VXNlcjcyNDkzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/7249331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/surechen", "html_url": "https://github.com/surechen", "followers_url": "https://api.github.com/users/surechen/followers", "following_url": "https://api.github.com/users/surechen/following{/other_user}", "gists_url": "https://api.github.com/users/surechen/gists{/gist_id}", "starred_url": "https://api.github.com/users/surechen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/surechen/subscriptions", "organizations_url": "https://api.github.com/users/surechen/orgs", "repos_url": "https://api.github.com/users/surechen/repos", "events_url": "https://api.github.com/users/surechen/events{/privacy}", "received_events_url": "https://api.github.com/users/surechen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2316f4da83a3952abca808f1f1b2c7ea0a9ee401", "url": "https://api.github.com/repos/rust-lang/rust/commits/2316f4da83a3952abca808f1f1b2c7ea0a9ee401", "html_url": "https://github.com/rust-lang/rust/commit/2316f4da83a3952abca808f1f1b2c7ea0a9ee401"}], "stats": {"total": 46, "additions": 44, "deletions": 2}, "files": [{"sha": "903b61635d68680b01c885092ccfd0cf64fa1158", "filename": "clippy_utils/src/lib.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a3d373551551bc1bd5a993d586f42144f0f4542a/clippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3d373551551bc1bd5a993d586f42144f0f4542a/clippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Flib.rs?ref=a3d373551551bc1bd5a993d586f42144f0f4542a", "patch": "@@ -684,7 +684,17 @@ pub fn is_default_equivalent(cx: &LateContext<'_>, e: &Expr<'_>) -> bool {\n             _ => false,\n         },\n         ExprKind::Tup(items) | ExprKind::Array(items) => items.iter().all(|x| is_default_equivalent(cx, x)),\n-        ExprKind::Repeat(x, _) => is_default_equivalent(cx, x),\n+        ExprKind::Repeat(x, y) => if_chain! {\n+            if let ExprKind::Lit(ref const_lit) = cx.tcx.hir().body(y.body).value.kind;\n+            if let LitKind::Int(v, _) = const_lit.node;\n+            if v <= 32 && is_default_equivalent(cx, x);\n+            then {\n+                true\n+            }\n+            else {\n+                false\n+            }\n+        },\n         ExprKind::Call(repl_func, _) => if_chain! {\n             if let ExprKind::Path(ref repl_func_qpath) = repl_func.kind;\n             if let Some(repl_def_id) = cx.qpath_res(repl_func_qpath, repl_func.hir_id).opt_def_id();"}, {"sha": "3eeebc117f3b05d956e1fe0b5a323b5fe0769ffa", "filename": "tests/ui/derivable_impls.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/a3d373551551bc1bd5a993d586f42144f0f4542a/tests%2Fui%2Fderivable_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3d373551551bc1bd5a993d586f42144f0f4542a/tests%2Fui%2Fderivable_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderivable_impls.rs?ref=a3d373551551bc1bd5a993d586f42144f0f4542a", "patch": "@@ -207,4 +207,24 @@ impl Default for Color2 {\n     }\n }\n \n+pub struct RepeatDefault1 {\n+    a: [i8; 32],\n+}\n+\n+impl Default for RepeatDefault1 {\n+    fn default() -> Self {\n+        RepeatDefault1 { a: [0; 32] }\n+    }\n+}\n+\n+pub struct RepeatDefault2 {\n+    a: [i8; 33],\n+}\n+\n+impl Default for RepeatDefault2 {\n+    fn default() -> Self {\n+        RepeatDefault2 { a: [0; 33] }\n+    }\n+}\n+\n fn main() {}"}, {"sha": "49fb471a21962ce11c69a8b84bccf96a33af3b72", "filename": "tests/ui/derivable_impls.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a3d373551551bc1bd5a993d586f42144f0f4542a/tests%2Fui%2Fderivable_impls.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a3d373551551bc1bd5a993d586f42144f0f4542a/tests%2Fui%2Fderivable_impls.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fderivable_impls.stderr?ref=a3d373551551bc1bd5a993d586f42144f0f4542a", "patch": "@@ -73,5 +73,17 @@ LL | | }\n    |\n    = help: try annotating `WithoutSelfParan` with `#[derive(Default)]`\n \n-error: aborting due to 6 previous errors\n+error: this `impl` can be derived\n+  --> $DIR/derivable_impls.rs:214:1\n+   |\n+LL | / impl Default for RepeatDefault1 {\n+LL | |     fn default() -> Self {\n+LL | |         RepeatDefault1 { a: [0; 32] }\n+LL | |     }\n+LL | | }\n+   | |_^\n+   |\n+   = help: try annotating `RepeatDefault1` with `#[derive(Default)]`\n+\n+error: aborting due to 7 previous errors\n "}]}