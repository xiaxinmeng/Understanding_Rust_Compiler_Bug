{"sha": "b9c3243801d05a789b1be1e220b81f73f76c8672", "node_id": "C_kwDOAAsO6NoAKGI5YzMyNDM4MDFkMDVhNzg5YjFiZTFlMjIwYjgxZjczZjc2Yzg2NzI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-21T07:33:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-21T07:33:41Z"}, "message": "Rollup merge of #92127 - GuillaumeGomez:search-results-duplicate-removal, r=jsha\n\nMove duplicates removal when generating results instead of when displaying them\n\nCurrently, we store 200 results per tab and then display them. However, it was possible to have duplicates which is why we have this check. However, instead of doing it when displaying the results, it's much better instead to do it even before to simplify the display part a bit.\n\nr? `@jsha`", "tree": {"sha": "8b1682671a3558252c663c5c48b736e938371993", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b1682671a3558252c663c5c48b736e938371993"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9c3243801d05a789b1be1e220b81f73f76c8672", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhwYNVCRBK7hj4Ov3rIwAAmCcIAJg29v8Hxg108T9DGjU3zgVF\nDO5FwemvPcX10DkCJg179oOyqLo5U/zCBma0W0g2V71iWM1fuPxQw68WJ7I1w9Pd\nVMkyCXsvHO2je6b7OCfMa7RK8okHecY/PHbzk8g33To22E7SG9cr1gg84Ks9QqFj\nckj4qf2Kftjj9xPvbs+JhNpewdcsankdIgoQzs//DF29MdS336D2yFFqqDbvK5c5\n7Hf9EylrmmINldidu5qnmxB7fYJAVrwXNCgApSpKjEKAfuOd5xqn0ur4HEHolmj2\nbug1wAD7w/YKoY2FnlPLmw9qgO93zs56KZVQ+6xJuSnwCF5y6E5oi/VajjauL+Y=\n=8PKz\n-----END PGP SIGNATURE-----\n", "payload": "tree 8b1682671a3558252c663c5c48b736e938371993\nparent 4d840a6e45d464621d098cdefbe3900584d0ee9b\nparent 879d28d3c1743ec474ec269a7cf76ad338868712\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1640072021 +0100\ncommitter GitHub <noreply@github.com> 1640072021 +0100\n\nRollup merge of #92127 - GuillaumeGomez:search-results-duplicate-removal, r=jsha\n\nMove duplicates removal when generating results instead of when displaying them\n\nCurrently, we store 200 results per tab and then display them. However, it was possible to have duplicates which is why we have this check. However, instead of doing it when displaying the results, it's much better instead to do it even before to simplify the display part a bit.\n\nr? `@jsha`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9c3243801d05a789b1be1e220b81f73f76c8672", "html_url": "https://github.com/rust-lang/rust/commit/b9c3243801d05a789b1be1e220b81f73f76c8672", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9c3243801d05a789b1be1e220b81f73f76c8672/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d840a6e45d464621d098cdefbe3900584d0ee9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d840a6e45d464621d098cdefbe3900584d0ee9b", "html_url": "https://github.com/rust-lang/rust/commit/4d840a6e45d464621d098cdefbe3900584d0ee9b"}, {"sha": "879d28d3c1743ec474ec269a7cf76ad338868712", "url": "https://api.github.com/repos/rust-lang/rust/commits/879d28d3c1743ec474ec269a7cf76ad338868712", "html_url": "https://github.com/rust-lang/rust/commit/879d28d3c1743ec474ec269a7cf76ad338868712"}], "stats": {"total": 24, "additions": 13, "deletions": 11}, "files": [{"sha": "971bd3930cffda487acc85eaad8a12de06400d69", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 13, "deletions": 11, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/b9c3243801d05a789b1be1e220b81f73f76c8672/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/b9c3243801d05a789b1be1e220b81f73f76c8672/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=b9c3243801d05a789b1be1e220b81f73f76c8672", "patch": "@@ -152,16 +152,26 @@ window.initSearch = function(rawSearchIndex) {\n         removeEmptyStringsFromArray(split);\n \n         function transformResults(results) {\n+            var duplicates = {};\n             var out = [];\n+\n             for (var i = 0, len = results.length; i < len; ++i) {\n-                if (results[i].id > -1) {\n-                    var obj = searchIndex[results[i].id];\n-                    obj.lev = results[i].lev;\n+                var result = results[i];\n+\n+                if (result.id > -1) {\n+                    var obj = searchIndex[result.id];\n+                    obj.lev = result.lev;\n                     var res = buildHrefAndPath(obj);\n                     obj.displayPath = pathSplitter(res[0]);\n                     obj.fullPath = obj.displayPath + obj.name;\n                     // To be sure than it some items aren't considered as duplicate.\n                     obj.fullPath += \"|\" + obj.ty;\n+\n+                    if (duplicates[obj.fullPath]) {\n+                        continue;\n+                    }\n+                    duplicates[obj.fullPath] = true;\n+\n                     obj.href = res[1];\n                     out.push(obj);\n                     if (out.length >= MAX_RESULTS) {\n@@ -971,19 +981,11 @@ window.initSearch = function(rawSearchIndex) {\n         }\n \n         var output = document.createElement(\"div\");\n-        var duplicates = {};\n         var length = 0;\n         if (array.length > 0) {\n             output.className = \"search-results \" + extraClass;\n \n             array.forEach(function(item) {\n-                if (item.is_alias !== true) {\n-                    if (duplicates[item.fullPath]) {\n-                        return;\n-                    }\n-                    duplicates[item.fullPath] = true;\n-                }\n-\n                 var name = item.name;\n                 var type = itemTypes[item.ty];\n "}]}