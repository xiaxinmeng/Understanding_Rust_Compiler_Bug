{"sha": "202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMmQzOWE5NmJiMmVjNjRjMGUxZjFmYzQyMjlhNDczZWQ4MTBhNWY=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-05-29T20:49:59Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-06-01T19:12:27Z"}, "message": "Drop metadata_encoding_version.", "tree": {"sha": "fa603d651424238b9d5d05e73164f60141692bb4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa603d651424238b9d5d05e73164f60141692bb4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "html_url": "https://github.com/rust-lang/rust/commit/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f9ab0300cd66f6f616e03ea90b2d71af474bf28", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f9ab0300cd66f6f616e03ea90b2d71af474bf28", "html_url": "https://github.com/rust-lang/rust/commit/7f9ab0300cd66f6f616e03ea90b2d71af474bf28"}], "stats": {"total": 22, "additions": 9, "deletions": 13}, "files": [{"sha": "1d3b539c682c0ddbfe72ab0bfb25f8aee6a0f1c9", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -3677,6 +3677,7 @@ dependencies = [\n  \"rustc_incremental\",\n  \"rustc_index\",\n  \"rustc_llvm\",\n+ \"rustc_metadata\",\n  \"rustc_middle\",\n  \"rustc_serialize\",\n  \"rustc_session\","}, {"sha": "637e91f5117d022810c57b03558b127781f0d6c1", "filename": "compiler/rustc_codegen_cranelift/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Flib.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -14,6 +14,7 @@ extern crate rustc_fs_util;\n extern crate rustc_hir;\n extern crate rustc_incremental;\n extern crate rustc_index;\n+extern crate rustc_metadata;\n extern crate rustc_session;\n extern crate rustc_span;\n extern crate rustc_target;"}, {"sha": "db24bf65eb5a2e015620822b67b81592feeff024", "filename": "compiler/rustc_codegen_cranelift/src/metadata.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2Fsrc%2Fmetadata.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -10,7 +10,7 @@ pub(crate) fn write_metadata<O: WriteMetadata>(tcx: TyCtxt<'_>, object: &mut O)\n     use std::io::Write;\n \n     let metadata = tcx.encode_metadata();\n-    let mut compressed = tcx.metadata_encoding_version();\n+    let mut compressed = rustc_metadata::METADATA_HEADER.to_vec();\n     FrameEncoder::new(&mut compressed).write_all(&metadata.raw_data).unwrap();\n \n     object.add_rustc_section("}, {"sha": "d0eb6913accde06efb58127b23ca33a71673dc62", "filename": "compiler/rustc_codegen_llvm/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_llvm%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_llvm%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2FCargo.toml?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -27,6 +27,7 @@ rustc_hir = { path = \"../rustc_hir\" }\n rustc_incremental = { path = \"../rustc_incremental\" }\n rustc_index = { path = \"../rustc_index\" }\n rustc_llvm = { path = \"../rustc_llvm\" }\n+rustc_metadata = { path = \"../rustc_metadata\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_target = { path = \"../rustc_target\" }"}, {"sha": "cc3cbea4def5e1bf20876b3eaf24baa539d64aee", "filename": "compiler/rustc_codegen_llvm/src/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbase.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -63,7 +63,7 @@ pub fn write_compressed_metadata<'tcx>(\n     let section_name = if tcx.sess.target.is_like_osx { \"__DATA,.rustc\" } else { \".rustc\" };\n \n     let (metadata_llcx, metadata_llmod) = (&*llvm_module.llcx, llvm_module.llmod());\n-    let mut compressed = tcx.metadata_encoding_version();\n+    let mut compressed = rustc_metadata::METADATA_HEADER.to_vec();\n     FrameEncoder::new(&mut compressed).write_all(&metadata.raw_data).unwrap();\n \n     let llmeta = common::bytes_in_context(metadata_llcx, &compressed);"}, {"sha": "c5bbb96f777e22861601fcc12896119204b21415", "filename": "compiler/rustc_metadata/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Flib.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -31,3 +31,5 @@ mod rmeta;\n pub mod creader;\n pub mod dynamic_lib;\n pub mod locator;\n+\n+pub use rmeta::METADATA_HEADER;"}, {"sha": "818376b20defe84704973cd324854f2192b9a04d", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -1,7 +1,7 @@\n use crate::creader::{CStore, LoadedMacro};\n use crate::foreign_modules;\n use crate::native_libs;\n-use crate::rmeta::{self, encoder};\n+use crate::rmeta::encoder;\n \n use rustc_ast as ast;\n use rustc_ast::expand::allocator::AllocatorKind;\n@@ -528,10 +528,6 @@ impl CrateStore for CStore {\n         encoder::encode_metadata(tcx)\n     }\n \n-    fn metadata_encoding_version(&self) -> &[u8] {\n-        rmeta::METADATA_HEADER\n-    }\n-\n     fn allocator_kind(&self) -> Option<AllocatorKind> {\n         self.allocator_kind()\n     }"}, {"sha": "a1819a19097cf09f99e69886d3a62f8c31b3ad3f", "filename": "compiler/rustc_metadata/src/rmeta/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fmod.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -51,7 +51,7 @@ const METADATA_VERSION: u8 = 5;\n /// This header is followed by the position of the `CrateRoot`,\n /// which is encoded as a 32-bit big-endian unsigned integer,\n /// and further followed by the rustc version string.\n-crate const METADATA_HEADER: &[u8; 8] = &[b'r', b'u', b's', b't', 0, 0, 0, METADATA_VERSION];\n+pub const METADATA_HEADER: &[u8; 8] = &[b'r', b'u', b's', b't', 0, 0, 0, METADATA_VERSION];\n \n /// Additional metadata for a `Lazy<T>` where `T` may not be `Sized`,\n /// e.g. for `Lazy<[T]>`, this is the length (count of `T` values)."}, {"sha": "965de117e75b87012743609f00a07654b20e3d73", "filename": "compiler/rustc_middle/src/middle/cstore.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -209,7 +209,6 @@ pub trait CrateStore {\n \n     // utility functions\n     fn encode_metadata(&self, tcx: TyCtxt<'_>) -> EncodedMetadata;\n-    fn metadata_encoding_version(&self) -> &[u8];\n     fn allocator_kind(&self) -> Option<AllocatorKind>;\n }\n "}, {"sha": "175908143224761c3fda24a0953559d85ee2f95a", "filename": "compiler/rustc_middle/src/ty/context.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/202d39a96bb2ec64c0e1f1fc4229a473ed810a5f/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext.rs?ref=202d39a96bb2ec64c0e1f1fc4229a473ed810a5f", "patch": "@@ -1314,10 +1314,6 @@ impl<'tcx> TyCtxt<'tcx> {\n         )\n     }\n \n-    pub fn metadata_encoding_version(self) -> Vec<u8> {\n-        self.cstore.metadata_encoding_version().to_vec()\n-    }\n-\n     pub fn encode_metadata(self) -> EncodedMetadata {\n         let _prof_timer = self.prof.verbose_generic_activity(\"generate_crate_metadata\");\n         self.cstore.encode_metadata(self)"}]}