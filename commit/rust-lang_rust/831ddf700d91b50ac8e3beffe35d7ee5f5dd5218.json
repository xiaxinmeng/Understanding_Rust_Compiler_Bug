{"sha": "831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzMWRkZjcwMGQ5MWI1MGFjOGUzYmVmZmUzNWQ3ZWU1ZjVkZDUyMTg=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-06-14T15:31:43Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-06-18T16:51:39Z"}, "message": "ci: Add a script for generating CPU usage graphs\n\nThis commit checks in a script which generates CPU usage graphs over\ntime, expanding on the previous comment that was include in the\ncollection file.", "tree": {"sha": "1d128078fbcc89c96c3007b0f0e3bc70b3ffa5e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d128078fbcc89c96c3007b0f0e3bc70b3ffa5e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "html_url": "https://github.com/rust-lang/rust/commit/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e699ea096fcc2fc9ce8e8bcf884e11496a31cc9f", "url": "https://api.github.com/repos/rust-lang/rust/commits/e699ea096fcc2fc9ce8e8bcf884e11496a31cc9f", "html_url": "https://github.com/rust-lang/rust/commit/e699ea096fcc2fc9ce8e8bcf884e11496a31cc9f"}], "stats": {"total": 68, "additions": 51, "deletions": 17}, "files": [{"sha": "daf21670b33391d49cbe9f26d6c7fd7b347f6943", "filename": "src/ci/cpu-usage-over-time.py", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218/src%2Fci%2Fcpu-usage-over-time.py", "raw_url": "https://github.com/rust-lang/rust/raw/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218/src%2Fci%2Fcpu-usage-over-time.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fcpu-usage-over-time.py?ref=831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "patch": "@@ -30,23 +30,8 @@\n # the second column is always zero.\n #\n # Once you've downloaded a file there's various ways to plot it and visualize\n-# it. For command line usage you can use a script like so:\n-#\n-#      set timefmt '%Y-%m-%dT%H:%M:%S'\n-#      set xdata time\n-#      set ylabel \"Idle CPU %\"\n-#      set xlabel \"Time\"\n-#      set datafile sep ','\n-#      set term png\n-#      set output \"printme.png\"\n-#      set grid\n-#      builder = \"i686-apple\"\n-#      plot \"cpu-\".builder.\".csv\" using 1:2 with lines title builder\n-#\n-# Executed as `gnuplot < ./foo.plot` it will generate a graph called\n-# `printme.png` which you can then open up. If you know how to improve this\n-# script or the viewing process that would be much appreciated :) (or even if\n-# you know how to automate it!)\n+# it. For command line usage you use the `src/etc/cpu-usage-over-time-plot.sh`\n+# script in this repository.\n \n import datetime\n import sys"}, {"sha": "724a21c3fc2697838c3336ca04ecc62955d1b828", "filename": "src/etc/cpu-usage-over-time-plot.sh", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218/src%2Fetc%2Fcpu-usage-over-time-plot.sh", "raw_url": "https://github.com/rust-lang/rust/raw/831ddf700d91b50ac8e3beffe35d7ee5f5dd5218/src%2Fetc%2Fcpu-usage-over-time-plot.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fcpu-usage-over-time-plot.sh?ref=831ddf700d91b50ac8e3beffe35d7ee5f5dd5218", "patch": "@@ -0,0 +1,49 @@\n+#!/bin/bash\n+\n+# A small script to help visualizing CPU usage over time data collected on CI\n+# using `gnuplot`.\n+#\n+# This script is expected to be called with two arguments. The first is the full\n+# commit SHA of the build you're interested in, and the second is the name of\n+# the builder. For example:\n+#\n+#  ./src/etc/cpu-usage-over-time-plot.sh e699ea096fcc2fc9ce8e8bcf884e11496a31cc9f i686-mingw-1\n+#\n+# That will generate `$builder.png` in the current directory which you can open\n+# up to see a hopefully pretty graph.\n+#\n+# Improvements to this script are greatly appreciated!\n+\n+set -ex\n+\n+bucket=rust-lang-ci-evalazure\n+commit=$1\n+builder=$2\n+\n+curl -O https://$bucket.s3.amazonaws.com/rustc-builds/$commit/cpu-$builder.csv\n+\n+gnuplot <<-EOF\n+reset\n+set timefmt '%Y-%m-%dT%H:%M:%S'\n+set xdata time\n+set ylabel \"CPU Usage %\"\n+set xlabel \"Time\"\n+set datafile sep ','\n+set term png size 3000,1000\n+set output \"$builder.png\"\n+set grid\n+\n+f(x) = mean_y\n+fit f(x) 'cpu-$builder.csv' using 1:(100-\\$2) via mean_y\n+\n+set label 1 gprintf(\"Average = %g%%\", mean_y) center font \",18\"\n+set label 1 at graph 0.50, 0.25\n+set xtics rotate by 45 offset -2,-2.4 300\n+set ytics 10\n+set boxwidth 0.5\n+\n+plot \\\\\n+   mean_y with lines linetype 1 linecolor rgb \"#ff0000\" title \"average\", \\\\\n+   \"cpu-$builder.csv\" using 1:(100-\\$2) with points pointtype 7 pointsize 0.4 title \"$builder\", \\\\\n+   \"\" using 1:(100-\\$2) smooth bezier linewidth 3 title \"bezier\"\n+EOF"}]}