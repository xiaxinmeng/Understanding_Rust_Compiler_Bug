{"sha": "5f4e0677190b82e61dc507e3e72caf89da8e5e28", "node_id": "C_kwDOAAsO6NoAKDVmNGUwNjc3MTkwYjgyZTYxZGM1MDdlM2U3MmNhZjg5ZGE4ZTVlMjg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-10T18:28:45Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-10T18:28:45Z"}, "message": "Auto merge of #94814 - matthiaskrgr:rollup-a5sk366, r=matthiaskrgr\n\nRollup of 8 pull requests\n\nSuccessful merges:\n\n - #94440 (Better error for normalization errors from parent crates that use `#![feature(generic_const_exprs)]`)\n - #94587 (Document new recommended use of `FromIterator::from_iter`)\n - #94644 (Fix soundness issue in scoped threads.)\n - #94740 (Unify impl blocks by wrapping them into a div)\n - #94753 (Improve rustdoc book)\n - #94796 (Allow `cargo run` instead of `cargo run -p bootstrap`)\n - #94805 (Revert accidental stabilization)\n - #94809 (RustWrapper: add missing include)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "50fa030a791eae1815194f2d6631c6ec08888de2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/50fa030a791eae1815194f2d6631c6ec08888de2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f4e0677190b82e61dc507e3e72caf89da8e5e28", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f4e0677190b82e61dc507e3e72caf89da8e5e28", "html_url": "https://github.com/rust-lang/rust/commit/5f4e0677190b82e61dc507e3e72caf89da8e5e28", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f4e0677190b82e61dc507e3e72caf89da8e5e28/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba14a836c7038da21f5e102aacc7e6d5964f79a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba14a836c7038da21f5e102aacc7e6d5964f79a6", "html_url": "https://github.com/rust-lang/rust/commit/ba14a836c7038da21f5e102aacc7e6d5964f79a6"}, {"sha": "07e4fbde5a3c0e4972e056ff0ddf48c1aa743123", "url": "https://api.github.com/repos/rust-lang/rust/commits/07e4fbde5a3c0e4972e056ff0ddf48c1aa743123", "html_url": "https://github.com/rust-lang/rust/commit/07e4fbde5a3c0e4972e056ff0ddf48c1aa743123"}], "stats": {"total": 488, "additions": 338, "deletions": 150}, "files": [{"sha": "4e78399606445837adb68b0d7b0789c77a218a03", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1,4 +1,5 @@\n [workspace]\n+default-members = [\"src/bootstrap\"]\n members = [\n   \"src/bootstrap\",\n   \"compiler/rustc\","}, {"sha": "51739df067f9da03718f914fb92a291132a03fbd", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -9,6 +9,7 @@\n #include \"llvm/Object/Archive.h\"\n #include \"llvm/Object/COFFImportFile.h\"\n #include \"llvm/Object/ObjectFile.h\"\n+#include \"llvm/Pass.h\"\n #include \"llvm/Bitcode/BitcodeWriterPass.h\"\n #include \"llvm/Support/Signals.h\"\n #include \"llvm/ADT/Optional.h\""}, {"sha": "f880b28b3c8dc2f12d7b26ca6304ff482190886d", "filename": "compiler/rustc_trait_selection/src/traits/const_evaluatable.rs", "status": "modified", "additions": 63, "deletions": 25, "changes": 88, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -35,34 +35,14 @@ pub fn is_const_evaluatable<'cx, 'tcx>(\n     span: Span,\n ) -> Result<(), NotConstEvaluatable> {\n     debug!(\"is_const_evaluatable({:?})\", uv);\n-    if infcx.tcx.features().generic_const_exprs {\n-        let tcx = infcx.tcx;\n+    let tcx = infcx.tcx;\n+\n+    if tcx.features().generic_const_exprs {\n         match AbstractConst::new(tcx, uv)? {\n             // We are looking at a generic abstract constant.\n             Some(ct) => {\n-                for pred in param_env.caller_bounds() {\n-                    match pred.kind().skip_binder() {\n-                        ty::PredicateKind::ConstEvaluatable(uv) => {\n-                            if let Some(b_ct) = AbstractConst::new(tcx, uv)? {\n-                                // Try to unify with each subtree in the AbstractConst to allow for\n-                                // `N + 1` being const evaluatable even if theres only a `ConstEvaluatable`\n-                                // predicate for `(N + 1) * 2`\n-                                let result =\n-                                    walk_abstract_const(tcx, b_ct, |b_ct| {\n-                                        match try_unify(tcx, ct, b_ct) {\n-                                            true => ControlFlow::BREAK,\n-                                            false => ControlFlow::CONTINUE,\n-                                        }\n-                                    });\n-\n-                                if let ControlFlow::Break(()) = result {\n-                                    debug!(\"is_const_evaluatable: abstract_const ~~> ok\");\n-                                    return Ok(());\n-                                }\n-                            }\n-                        }\n-                        _ => {} // don't care\n-                    }\n+                if satisfied_from_param_env(tcx, ct, param_env)? {\n+                    return Ok(());\n                 }\n \n                 // We were unable to unify the abstract constant with\n@@ -163,6 +143,33 @@ pub fn is_const_evaluatable<'cx, 'tcx>(\n         }\n     }\n \n+    // If we're evaluating a foreign constant, under a nightly compiler without generic\n+    // const exprs, AND it would've passed if that expression had been evaluated with\n+    // generic const exprs, then suggest using generic const exprs.\n+    if concrete.is_err()\n+        && tcx.sess.is_nightly_build()\n+        && !uv.def.did.is_local()\n+        && !tcx.features().generic_const_exprs\n+        && let Ok(Some(ct)) = AbstractConst::new(tcx, uv)\n+        && satisfied_from_param_env(tcx, ct, param_env) == Ok(true)\n+    {\n+        tcx.sess\n+            .struct_span_fatal(\n+                // Slightly better span than just using `span` alone\n+                if span == rustc_span::DUMMY_SP { tcx.def_span(uv.def.did) } else { span },\n+                \"failed to evaluate generic const expression\",\n+            )\n+            .note(\"the crate this constant originates from uses `#![feature(generic_const_exprs)]`\")\n+            .span_suggestion_verbose(\n+                rustc_span::DUMMY_SP,\n+                \"consider enabling this feature\",\n+                \"#![feature(generic_const_exprs)]\\n\".to_string(),\n+                rustc_errors::Applicability::MaybeIncorrect,\n+            )\n+            .emit();\n+        rustc_errors::FatalError.raise();\n+    }\n+\n     debug!(?concrete, \"is_const_evaluatable\");\n     match concrete {\n         Err(ErrorHandled::TooGeneric) => Err(match uv.has_infer_types_or_consts() {\n@@ -178,6 +185,37 @@ pub fn is_const_evaluatable<'cx, 'tcx>(\n     }\n }\n \n+fn satisfied_from_param_env<'tcx>(\n+    tcx: TyCtxt<'tcx>,\n+    ct: AbstractConst<'tcx>,\n+    param_env: ty::ParamEnv<'tcx>,\n+) -> Result<bool, NotConstEvaluatable> {\n+    for pred in param_env.caller_bounds() {\n+        match pred.kind().skip_binder() {\n+            ty::PredicateKind::ConstEvaluatable(uv) => {\n+                if let Some(b_ct) = AbstractConst::new(tcx, uv)? {\n+                    // Try to unify with each subtree in the AbstractConst to allow for\n+                    // `N + 1` being const evaluatable even if theres only a `ConstEvaluatable`\n+                    // predicate for `(N + 1) * 2`\n+                    let result =\n+                        walk_abstract_const(tcx, b_ct, |b_ct| match try_unify(tcx, ct, b_ct) {\n+                            true => ControlFlow::BREAK,\n+                            false => ControlFlow::CONTINUE,\n+                        });\n+\n+                    if let ControlFlow::Break(()) = result {\n+                        debug!(\"is_const_evaluatable: abstract_const ~~> ok\");\n+                        return Ok(true);\n+                    }\n+                }\n+            }\n+            _ => {} // don't care\n+        }\n+    }\n+\n+    Ok(false)\n+}\n+\n /// A tree representing an anonymous constant.\n ///\n /// This is only able to represent a subset of `MIR`,"}, {"sha": "f753189c6830886004dee109d8314c544ed7ea2b", "filename": "library/alloc/src/boxed.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Falloc%2Fsrc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Falloc%2Fsrc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fboxed.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1170,8 +1170,7 @@ impl<T: ?Sized, A: Allocator> Box<T, A> {\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-#[rustc_const_unstable(feature = \"const_box\", issue = \"92521\")]\n-unsafe impl<#[may_dangle] T: ?Sized, A: Allocator> const Drop for Box<T, A> {\n+unsafe impl<#[may_dangle] T: ?Sized, A: Allocator> Drop for Box<T, A> {\n     fn drop(&mut self) {\n         // FIXME: Do nothing, drop is currently performed by compiler.\n     }"}, {"sha": "9e5123be989900f2809ca93a2471ed57509d1be4", "filename": "library/alloc/tests/boxed.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Falloc%2Ftests%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Falloc%2Ftests%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fboxed.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -160,7 +160,7 @@ fn const_box() {\n         *boxed = 42;\n         assert!(*boxed == 42);\n \n-        *boxed\n+        *Box::leak(boxed)\n     };\n \n     assert!(VALUE == 42);"}, {"sha": "dee66e6e0728382afc453fa9cec7f86925b09411", "filename": "library/core/src/iter/traits/collect.rs", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -4,9 +4,11 @@\n /// created from an iterator. This is common for types which describe a\n /// collection of some kind.\n ///\n-/// [`FromIterator::from_iter()`] is rarely called explicitly, and is instead\n-/// used through [`Iterator::collect()`] method. See [`Iterator::collect()`]'s\n-/// documentation for more examples.\n+/// If you want to create a collection from the contents of an iterator, the\n+/// [`Iterator::collect()`] method is preferred. However, when you need to\n+/// specify the container type, [`FromIterator::from_iter()`] can be more\n+/// readable than using a turbofish (e.g. `::<Vec<_>>()`). See the\n+/// [`Iterator::collect()`] documentation for more examples of its use.\n ///\n /// See also: [`IntoIterator`].\n ///\n@@ -32,6 +34,17 @@\n /// assert_eq!(v, vec![5, 5, 5, 5, 5]);\n /// ```\n ///\n+/// Using [`FromIterator::from_iter()`] as a more readable alternative to\n+/// [`Iterator::collect()`]:\n+///\n+/// ```\n+/// use std::collections::VecDeque;\n+/// let first = (0..10).collect::<VecDeque<i32>>();\n+/// let second = VecDeque::from_iter(0..10);\n+///\n+/// assert_eq!(first, second);\n+/// ```\n+///\n /// Implementing `FromIterator` for your type:\n ///\n /// ```"}, {"sha": "ad3b8cd5c433e5f39e0ca92ecc6867cc2a303231", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -364,6 +364,11 @@ extern crate std as realstd;\n #[macro_use]\n mod macros;\n \n+// The runtime entry point and a few unstable public functions used by the\n+// compiler\n+#[macro_use]\n+pub mod rt;\n+\n // The Rust prelude\n pub mod prelude;\n \n@@ -548,11 +553,6 @@ pub mod arch {\n #[stable(feature = \"simd_x86\", since = \"1.27.0\")]\n pub use std_detect::is_x86_feature_detected;\n \n-// The runtime entry point and a few unstable public functions used by the\n-// compiler\n-#[macro_use]\n-pub mod rt;\n-\n // Platform-abstraction modules\n mod sys;\n mod sys_common;"}, {"sha": "74b29454b94a4896c9297eee061b6de0b684150f", "filename": "library/std/src/thread/mod.rs", "status": "modified", "additions": 23, "deletions": 4, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1287,12 +1287,31 @@ unsafe impl<'scope, T: Sync> Sync for Packet<'scope, T> {}\n \n impl<'scope, T> Drop for Packet<'scope, T> {\n     fn drop(&mut self) {\n+        // If this packet was for a thread that ran in a scope, the thread\n+        // panicked, and nobody consumed the panic payload, we make sure\n+        // the scope function will panic.\n+        let unhandled_panic = matches!(self.result.get_mut(), Some(Err(_)));\n+        // Drop the result without causing unwinding.\n+        // This is only relevant for threads that aren't join()ed, as\n+        // join() will take the `result` and set it to None, such that\n+        // there is nothing left to drop here.\n+        // If this panics, we should handle that, because we're outside the\n+        // outermost `catch_unwind` of our thread.\n+        // We just abort in that case, since there's nothing else we can do.\n+        // (And even if we tried to handle it somehow, we'd also need to handle\n+        // the case where the panic payload we get out of it also panics on\n+        // drop, and so on. See issue #86027.)\n+        if let Err(_) = panic::catch_unwind(panic::AssertUnwindSafe(|| {\n+            *self.result.get_mut() = None;\n+        })) {\n+            rtabort!(\"thread result panicked on drop\");\n+        }\n         // Book-keeping so the scope knows when it's done.\n         if let Some(scope) = self.scope {\n-            // If this packet was for a thread that ran in a scope, the thread\n-            // panicked, and nobody consumed the panic payload, we make sure\n-            // the scope function will panic.\n-            let unhandled_panic = matches!(self.result.get_mut(), Some(Err(_)));\n+            // Now that there will be no more user code running on this thread\n+            // that can use 'scope, mark the thread as 'finished'.\n+            // It's important we only do this after the `result` has been dropped,\n+            // since dropping it might still use things it borrowed from 'scope.\n             scope.decrement_num_running_threads(unhandled_panic);\n         }\n     }"}, {"sha": "7386fe1c442abd6a268a08b79fdc0383c76c6fb8", "filename": "library/std/src/thread/tests.rs", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Ftests.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -4,10 +4,11 @@ use crate::mem;\n use crate::panic::panic_any;\n use crate::result;\n use crate::sync::{\n+    atomic::{AtomicBool, Ordering},\n     mpsc::{channel, Sender},\n     Arc, Barrier,\n };\n-use crate::thread::{self, ThreadId};\n+use crate::thread::{self, Scope, ThreadId};\n use crate::time::Duration;\n use crate::time::Instant;\n \n@@ -293,5 +294,25 @@ fn test_thread_id_not_equal() {\n     assert!(thread::current().id() != spawned_id);\n }\n \n-// NOTE: the corresponding test for stderr is in ui/thread-stderr, due\n-// to the test harness apparently interfering with stderr configuration.\n+#[test]\n+fn test_scoped_threads_drop_result_before_join() {\n+    let actually_finished = &AtomicBool::new(false);\n+    struct X<'scope, 'env>(&'scope Scope<'scope, 'env>, &'env AtomicBool);\n+    impl Drop for X<'_, '_> {\n+        fn drop(&mut self) {\n+            thread::sleep(Duration::from_millis(20));\n+            let actually_finished = self.1;\n+            self.0.spawn(move || {\n+                thread::sleep(Duration::from_millis(20));\n+                actually_finished.store(true, Ordering::Relaxed);\n+            });\n+        }\n+    }\n+    thread::scope(|s| {\n+        s.spawn(move || {\n+            thread::sleep(Duration::from_millis(20));\n+            X(s, actually_finished)\n+        });\n+    });\n+    assert!(actually_finished.load(Ordering::Relaxed));\n+}"}, {"sha": "45405a11765cc761aab576fee0bb37982a96a612", "filename": "src/doc/rustdoc/book.toml", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fbook.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fbook.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fbook.toml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -4,3 +4,7 @@ title = \"The rustdoc book\"\n \n [output.html]\n git-repository-url = \"https://github.com/rust-lang/rust/tree/master/src/doc/rustdoc\"\n+\n+[output.html.redirect]\n+\"/the-doc-attribute.html\" = \"write-documentation/the-doc-attribute.html\"\n+\"/documentation-tests.html\" = \"write-documentation/documentation-tests.html\""}, {"sha": "d627f5b0389f39594ba815a731e9203edab60344", "filename": "src/doc/rustdoc/src/SUMMARY.md", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1,16 +1,15 @@\n # The Rustdoc Book\n \n - [What is rustdoc?](what-is-rustdoc.md)\n+- [Command-line arguments](command-line-arguments.md)\n - [How to read rustdoc output](how-to-read-rustdoc.md)\n - [How to write documentation](how-to-write-documentation.md)\n-- [What to include (and exclude)](what-to-include.md)\n-- [Command-line arguments](command-line-arguments.md)\n-- [The `#[doc]` attribute](the-doc-attribute.md)\n-- [Documentation tests](documentation-tests.md)\n-- [Linking to items by name](linking-to-items-by-name.md)\n-- [Lints](lints.md)\n+    - [What to include (and exclude)](write-documentation/what-to-include.md)\n+    - [The `#[doc]` attribute](write-documentation/the-doc-attribute.md)\n+    - [Linking to items by name](write-documentation/linking-to-items-by-name.md)\n+    - [Documentation tests](write-documentation/documentation-tests.md)\n+- [Rustdoc-specific lints](lints.md)\n - [Advanced features](advanced-features.md)\n - [Unstable features](unstable-features.md)\n-- [Website features](website-features.md)\n-- [Passes](passes.md)\n+- [Deprecated features](deprecated-features.md)\n - [References](references.md)"}, {"sha": "dbf0baec04c03193629feca752c201437a875de1", "filename": "src/doc/rustdoc/src/advanced-features.md", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fadvanced-features.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -88,3 +88,25 @@ You can add multiple aliases at the same time by using a list:\n #[doc(alias(\"x\", \"big\"))]\n pub struct BigX;\n ```\n+\n+## Custom search engines\n+\n+If you find yourself often referencing online Rust docs you might enjoy using a custom search\n+engine. This allows you to use the navigation bar directly to search a `rustdoc` website.\n+Most browsers support this feature by letting you define a URL template containing `%s`\n+which will be substituted for the search term. As an example, for the standard library you could use\n+this template:\n+\n+```text\n+https://doc.rust-lang.org/stable/std/?search=%s\n+```\n+\n+Note that this will take you to a results page listing all matches. If you want to navigate to the first\n+result right away (which is often the best match) use the following instead:\n+\n+```text\n+https://doc.rust-lang.org/stable/std/?search=%s&go_to_first=true\n+```\n+\n+This URL adds the `go_to_first=true` query parameter which can be appended to any `rustdoc` search URL\n+to automatically go to the first result."}, {"sha": "2a2e51b2f6331085224ecb9c661c334cf32e7416", "filename": "src/doc/rustdoc/src/command-line-arguments.md", "status": "modified", "additions": 5, "deletions": 25, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fcommand-line-arguments.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fcommand-line-arguments.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fcommand-line-arguments.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -177,7 +177,7 @@ $ rustdoc src/lib.rs --test\n ```\n \n This flag will run your code examples as tests. For more, see [the chapter\n-on documentation tests](documentation-tests.md).\n+on documentation tests](write-documentation/documentation-tests.md).\n \n See also `--test-args`.\n \n@@ -190,7 +190,7 @@ $ rustdoc src/lib.rs --test --test-args ignored\n ```\n \n This flag will pass options to the test runner when running documentation tests.\n-For more, see [the chapter on documentation tests](documentation-tests.md).\n+For more, see [the chapter on documentation tests](write-documentation/documentation-tests.md).\n \n See also `--test`.\n \n@@ -336,7 +336,7 @@ $ rustdoc src/lib.rs --sysroot /path/to/sysroot\n Similar to `rustc --sysroot`, this lets you change the sysroot `rustdoc` uses\n when compiling your code.\n \n-### `--edition`: control the edition of docs and doctests\n+## `--edition`: control the edition of docs and doctests\n \n Using this flag looks like this:\n \n@@ -403,12 +403,12 @@ encoded as UTF-8.\n ## `--passes`: add more rustdoc passes\n \n This flag is **deprecated**.\n-For more details on passes, see [the chapter on them](passes.md).\n+For more details on passes, see [the chapter on them](deprecated-features.md#passes).\n \n ## `--no-defaults`: don't run default passes\n \n This flag is **deprecated**.\n-For more details on passes, see [the chapter on them](passes.md).\n+For more details on passes, see [the chapter on them](deprecated-features.md#passes).\n \n ## `-r`/`--input-format`: input format\n \n@@ -417,23 +417,3 @@ This flag is **deprecated** and **has no effect**.\n Rustdoc only supports Rust source code and Markdown input formats. If the\n file ends in `.md` or `.markdown`, `rustdoc` treats it as a Markdown file.\n Otherwise, it assumes that the input file is Rust.\n-\n-# Unstable command line arguments\n-\n-## `--nocapture`\n-\n-When this flag is used with `--test`, the output (stdout and stderr) of your tests won't be\n-captured by rustdoc. Instead, the output will be directed to your terminal,\n-as if you had run the test executable manually. This is especially useful\n-for debugging your tests!\n-\n-## `--check`\n-\n-When this flag is supplied, rustdoc will type check and lint your code, but will not generate any\n-documentation or run your doctests.\n-\n-Using this flag looks like:\n-\n-```bash\n-rustdoc -Z unstable-options --check src/lib.rs\n-```"}, {"sha": "2bc6e8fc8ae4df6606001b710e7793f585fcc4ba", "filename": "src/doc/rustdoc/src/deprecated-features.md", "status": "renamed", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fdeprecated-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fdeprecated-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fdeprecated-features.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1,4 +1,6 @@\n-# Passes\n+# Deprecated features\n+\n+## Passes\n \n Rustdoc has a concept called \"passes\". These are transformations that\n `rustdoc` runs on your documentation before producing its final output.", "previous_filename": "src/doc/rustdoc/src/passes.md"}, {"sha": "098bc1879b56f6c9a3f3f6006ba6d176e534681d", "filename": "src/doc/rustdoc/src/how-to-read-rustdoc.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-read-rustdoc.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-read-rustdoc.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fhow-to-read-rustdoc.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -26,7 +26,7 @@ At the top is some at-a-glance info and controls:\n - a button to collapse or expand the top-level documentation for that item\n   (`[+]` or `[-]`),\n - a link to the source code (`[src]`),\n-  if [configured](the-doc-attribute.html#html_no_source),\n+  if [configured](write-documentation/the-doc-attribute.html#html_no_source),\n   and present (the source may not be available if\n   the documentation was created with `cargo doc --no-deps`),\n - and the version in which the item became stable,\n@@ -52,7 +52,7 @@ For example, when looking at documentation for the crate root,\n it shows all the crates documented in the documentation bundle,\n and quick links to the modules, structs, traits, functions, and macros available\n from the current crate.\n-At the top, it displays a [configurable logo](the-doc-attribute.html#html_logo_url)\n+At the top, it displays a [configurable logo](write-documentation/the-doc-attribute.html#html_logo_url)\n alongside the current crate's name and version,\n or the current item whose documentation is being displayed.\n "}, {"sha": "bff01d7cb7c14ef5a0544ff0089e30de545133a4", "filename": "src/doc/rustdoc/src/lints.md", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -13,11 +13,11 @@ Note that, except for `missing_docs`, these lints are only available when runnin\n \n Here is the list of the lints provided by `rustdoc`:\n \n-## broken_intra_doc_links\n+## `broken_intra_doc_links`\n \n This lint **warns by default**. This lint detects when an [intra-doc link] fails to be resolved. For example:\n \n-[intra-doc link]: linking-to-items-by-name.md\n+[intra-doc link]: write-documentation/linking-to-items-by-name.md\n \n ```rust\n /// I want to link to [`Nonexistent`] but it doesn't exist!\n@@ -64,7 +64,7 @@ help: to link to the function, add parentheses\n \n ```\n \n-## private_intra_doc_links\n+## `private_intra_doc_links`\n \n This lint **warns by default**. This lint detects when [intra-doc links] from public to private items.\n For example:\n@@ -104,9 +104,9 @@ warning: public documentation for `public` links to private item `private`\n   = note: this link resolves only because you passed `--document-private-items`, but will break without\n ```\n \n-[intra-doc links]: linking-to-items-by-name.html\n+[intra-doc links]: write-documentation/linking-to-items-by-name.md\n \n-## missing_docs\n+## `missing_docs`\n \n This lint is **allowed by default**. It detects items missing documentation.\n For example:\n@@ -130,7 +130,7 @@ warning: missing documentation for a function\n \n Note that unlike other rustdoc lints, this lint is also available from `rustc` directly.\n \n-## missing_crate_level_docs\n+## `missing_crate_level_docs`\n \n This lint is **allowed by default**. It detects if there is no documentation\n at the crate root. For example:\n@@ -154,7 +154,7 @@ warning in the future. This is intended as a means to introduce new users on\n get started, without providing overwhelming warnings like `missing_docs`\n might.\n \n-## missing_doc_code_examples\n+## `missing_doc_code_examples`\n \n This lint is **allowed by default** and is **nightly-only**. It detects when a documentation block\n is missing a code example. For example:\n@@ -190,7 +190,7 @@ To fix the lint, you need to add a code example into the documentation block:\n pub fn no_code_example() {}\n ```\n \n-## private_doc_tests\n+## `private_doc_tests`\n \n This lint is **allowed by default**. It detects documentation tests when they\n are on a private item. For example:\n@@ -223,7 +223,7 @@ warning: Documentation test in private item\n    | |___________^\n ```\n \n-## invalid_codeblock_attributes\n+## `invalid_codeblock_attributes`\n \n This lint **warns by default**. It detects code block attributes in\n documentation examples that have potentially mis-typed values. For example:\n@@ -259,7 +259,7 @@ warning: unknown attribute `should-panic`. Did you mean `should_panic`?\n In the example above, the correct form is `should_panic`. This helps detect\n typo mistakes for some common attributes.\n \n-## invalid_html_tags\n+## `invalid_html_tags`\n \n This lint is **allowed by default** and is **nightly-only**. It detects unclosed\n or invalid HTML tags. For example:\n@@ -298,7 +298,7 @@ warning: unclosed HTML tag `h1`\n warning: 2 warnings emitted\n ```\n \n-## invalid_rust_codeblocks\n+## `invalid_rust_codeblocks`\n \n This lint **warns by default**. It detects Rust code blocks in documentation\n examples that are invalid (e.g. empty, not parsable as Rust). For example:\n@@ -342,7 +342,7 @@ warning: could not parse code block as Rust code\n    = note: error from rustc: unterminated character literal\n ```\n \n-## bare_urls\n+## `bare_urls`\n \n This lint is **warn-by-default**. It detects URLs which are not links.\n For example:"}, {"sha": "537ab48bbfc12a457dc3e49afb879e203cdb6754", "filename": "src/doc/rustdoc/src/unstable-features.md", "status": "modified", "additions": 46, "deletions": 5, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -22,7 +22,7 @@ As detailed in [the chapter on documentation tests][doctest-attributes], you can\n nightly, you can optionally add an error number to state that a doctest should emit a specific error\n number:\n \n-[doctest-attributes]: documentation-tests.html#attributes\n+[doctest-attributes]: write-documentation/documentation-tests.html#attributes\n \n ``````markdown\n ```compile_fail,E0044\n@@ -45,6 +45,8 @@ and enabled with a `#![feature(...)]` attribute in your crate.\n \n ### `#[doc(cfg)]`: Recording what platforms or features are required for code to be present\n \n+ * Tracking issue: [#43781](https://github.com/rust-lang/rust/issues/43781)\n+\n You can use `#[doc(cfg(...))]` to tell Rustdoc exactly which platform items appear on.\n This has two effects:\n \n@@ -86,6 +88,8 @@ Book][unstable-doc-cfg] and [its tracking issue][issue-doc-cfg].\n \n ### `doc_auto_cfg`: Automatically generate `#[doc(cfg)]`\n \n+ * Tracking issue: [#43781](https://github.com/rust-lang/rust/issues/43781)\n+\n `doc_auto_cfg` is an extension to the `#[doc(cfg)]` feature. With it, you don't need to add\n `#[doc(cfg(...)]` anymore unless you want to override the default behaviour. So if we take the\n previous source code:\n@@ -123,6 +127,8 @@ And `doc` won't show up anymore!\n \n ### Adding your trait to the \"Notable traits\" dialog\n \n+ * Tracking issue: [#45040](https://github.com/rust-lang/rust/issues/45040)\n+\n Rustdoc keeps a list of a few traits that are believed to be \"fundamental\" to\n types that implement them. These traits are intended to be the primary interface\n for their implementers, and are often most of the API available to be documented\n@@ -146,6 +152,8 @@ and [its tracking issue][issue-notable_trait].\n \n ### Exclude certain dependencies from documentation\n \n+ * Tracking issue: [#44027](https://github.com/rust-lang/rust/issues/44027)\n+\n The standard library uses several dependencies which, in turn, use several types and traits from the\n standard library. In addition, there are several compiler-internal crates that are not considered to\n be part of the official standard library, and thus would be a distraction to include in\n@@ -164,8 +172,7 @@ Book][unstable-masked] and [its tracking issue][issue-masked].\n [unstable-masked]: ../unstable-book/language-features/doc-masked.html\n [issue-masked]: https://github.com/rust-lang/rust/issues/44027\n \n-\n-## Document primitives\n+### Document primitives\n \n This is for Rust compiler internal use only.\n \n@@ -174,7 +181,7 @@ attributes. The `#[doc(primitive)]` attribute is used by the standard library to\n to generate documentation for primitive types, and requires `#![feature(rustdoc_internals)]` to\n enable.\n \n-## Document keywords\n+### Document keywords\n \n This is for Rust compiler internal use only.\n \n@@ -199,6 +206,8 @@ the flag in question to Rustdoc on the command-line. To do this from Cargo, you\n \n ### `--markdown-before-content`: include rendered Markdown before the content\n \n+ * Tracking issue: [#44027](https://github.com/rust-lang/rust/issues/44027)\n+\n Using this flag looks like this:\n \n ```bash\n@@ -241,7 +250,7 @@ attribute][doc-playground]. Please be aware that the official Rust Playground at\n https://play.rust-lang.org does not have every crate available, so if your examples require your\n crate, make sure the playground you provide has your crate available.\n \n-[doc-playground]: the-doc-attribute.html#html_playground_url\n+[doc-playground]: write-documentation/the-doc-attribute.html#html_playground_url\n \n If both `--playground-url` and `--markdown-playground-url` are present when rendering a standalone\n Markdown file, the URL given to `--markdown-playground-url` will take precedence. If both\n@@ -279,6 +288,8 @@ between compilations.\n \n ### `--resource-suffix`: modifying the name of CSS/JavaScript in crate docs\n \n+ * Tracking issue: [#54765](https://github.com/rust-lang/rust/issues/54765)\n+\n Using this flag looks like this:\n \n ```bash\n@@ -331,6 +342,24 @@ Using `index-page` option enables `enable-index-page` option as well.\n \n This feature allows the generation of a default index-page which lists the generated crates.\n \n+### `--nocapture`: disable output capture for test\n+\n+When this flag is used with `--test`, the output (stdout and stderr) of your tests won't be\n+captured by rustdoc. Instead, the output will be directed to your terminal,\n+as if you had run the test executable manually. This is especially useful\n+for debugging your tests!\n+\n+### `--check`: only checks the documentation\n+\n+When this flag is supplied, rustdoc will type check and lint your code, but will not generate any\n+documentation or run your doctests.\n+\n+Using this flag looks like:\n+\n+```bash\n+rustdoc -Z unstable-options --check src/lib.rs\n+```\n+\n ### `--static-root-path`: control how static files are loaded in HTML output\n \n Using this flag looks like this:\n@@ -348,6 +377,8 @@ renamed with `--resource-suffix` will load from the given path.\n \n ### `--persist-doctests`: persist doctest executables after running\n \n+ * Tracking issue: [#56925](https://github.com/rust-lang/rust/issues/56925)\n+\n Using this flag looks like this:\n \n ```bash\n@@ -360,6 +391,8 @@ with this option, you can keep those binaries around for farther testing.\n \n ### `--show-coverage`: calculate the percentage of items with documentation\n \n+ * Tracking issue: [#58154](https://github.com/rust-lang/rust/issues/58154)\n+\n Using this flag looks like this:\n \n ```bash\n@@ -438,6 +471,8 @@ information.\n \n ### `--enable-per-target-ignores`: allow `ignore-foo` style filters for doctests\n \n+ * Tracking issue: [#64245](https://github.com/rust-lang/rust/issues/64245)\n+\n Using this flag looks like this:\n \n ```bash\n@@ -471,6 +506,8 @@ override `ignore`.\n \n ### `--runtool`, `--runtool-arg`: program to run tests with; args to pass to it\n \n+ * Tracking issue: [#64245](https://github.com/rust-lang/rust/issues/64245)\n+\n Using these options looks like this:\n \n ```bash\n@@ -488,6 +525,8 @@ Another use case would be to run a test inside an emulator, or through a Virtual\n \n ### `--with-examples`: include examples of uses of items as documentation\n \n+ * Tracking issue: [#88791](https://github.com/rust-lang/rust/issues/88791)\n+\n This option, combined with `--scrape-examples-target-crate` and\n `--scrape-examples-output-path`, is used to implement the functionality in [RFC\n #3123](https://github.com/rust-lang/rfcs/pull/3123). Uses of an item (currently\n@@ -515,6 +554,8 @@ add the `--scrape-tests` flag.\n \n ### `--check-cfg`: check configuration flags\n \n+ * Tracking issue: [#82450](https://github.com/rust-lang/rust/issues/82450)\n+\n This flag accepts the same values as `rustc --check-cfg`, and uses it to check configuration flags.\n \n Using this flag looks like this:"}, {"sha": "5fade4e84a992d969796a9b72d6ee49f08e34082", "filename": "src/doc/rustdoc/src/website-features.md", "status": "removed", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ba14a836c7038da21f5e102aacc7e6d5964f79a6/src%2Fdoc%2Frustdoc%2Fsrc%2Fwebsite-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/ba14a836c7038da21f5e102aacc7e6d5964f79a6/src%2Fdoc%2Frustdoc%2Fsrc%2Fwebsite-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwebsite-features.md?ref=ba14a836c7038da21f5e102aacc7e6d5964f79a6", "patch": "@@ -1,25 +0,0 @@\n-# Website features\n-\n-These features are about using the website generated by `rustdoc`.\n-\n-## Custom search engines\n-\n-If you find yourself often referencing online Rust docs you might enjoy using a custom search\n-engine. This allows you to use the navigation bar directly to search a `rustdoc` website.\n-Most browsers support this feature by letting you define a URL template containing `%s`\n-which will be substituted for the search term. As an example, for the standard library you could use\n-this template:\n-\n-```text\n-https://doc.rust-lang.org/stable/std/?search=%s\n-```\n-\n-Note that this will take you to a results page listing all matches. If you want to navigate to the first\n-result right away (which is often the best match) use the following instead:\n-\n-```text\n-https://doc.rust-lang.org/stable/std/?search=%s&go_to_first=true\n-```\n-\n-This URL adds the `go_to_first=true` query parameter which can be appended to any `rustdoc` search URL\n-to automatically go to the first result."}, {"sha": "1cb5b049df4045b96b5aa7b69af88773bca9a0f9", "filename": "src/doc/rustdoc/src/write-documentation/documentation-tests.md", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fdocumentation-tests.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fdocumentation-tests.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fdocumentation-tests.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -269,7 +269,7 @@ By default, this will still hide `unused` warnings, since so many examples use p\n you can add `#![warn(unused)]` to the top of your example if you want to see unused variables or dead code warnings.\n You can also use [`#![doc(test(attr(warn(unused))))]`][test-attr] in the crate root to enable warnings globally.\n \n-[test-attr]: ./the-doc-attribute.md#testattr\n+[test-attr]: the-doc-attribute.md#testattr\n \n ## Documenting macros\n ", "previous_filename": "src/doc/rustdoc/src/documentation-tests.md"}, {"sha": "36bc312b9c99ad6835dddb32b25beda5059e491a", "filename": "src/doc/rustdoc/src/write-documentation/linking-to-items-by-name.md", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Flinking-to-items-by-name.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Flinking-to-items-by-name.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Flinking-to-items-by-name.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -35,7 +35,7 @@ link to `Option`.\n You can refer to anything in scope, and use paths, including `Self`, `self`, `super`, and\n `crate`. Associated items (functions, types, and constants) are supported, but [not for blanket\n trait implementations][#79682]. Rustdoc also supports linking to all primitives listed in\n-[the standard library documentation](../std/index.html#primitives).\n+[the standard library documentation](../../std/index.html#primitives).\n \n [#79682]: https://github.com/rust-lang/rust/pull/79682\n ", "previous_filename": "src/doc/rustdoc/src/linking-to-items-by-name.md"}, {"sha": "25ef8b5bb9141f71006ef3b0ea60370e3b301039", "filename": "src/doc/rustdoc/src/write-documentation/the-doc-attribute.md", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fthe-doc-attribute.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fthe-doc-attribute.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fthe-doc-attribute.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -38,7 +38,7 @@ but given that docs are rendered via Markdown, it will remove these newlines.\n Another use case is for including external files as documentation:\n \n ```rust,no_run\n-#[doc = include_str!(\"../README.md\")]\n+#[doc = include_str!(\"../../README.md\")]\n # fn f() {}\n ```\n \n@@ -73,7 +73,7 @@ left hand side of the docs.\n #![doc(html_logo_url = \"https://example.com/logo.jpg\")]\n ```\n \n-This will put `<a href='index.html'><img src='{}' alt='logo' width='100'></a>` into\n+This will put `<a href='../index.html'><img src='{}' alt='logo' width='100'></a>` into\n your docs, where the string for the attribute goes into the `{}`.\n \n If you don't use this attribute, there will be no logo.", "previous_filename": "src/doc/rustdoc/src/the-doc-attribute.md"}, {"sha": "35e6ccbc388078cdad1d41e45a18751119f3c6d9", "filename": "src/doc/rustdoc/src/write-documentation/what-to-include.md", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fwhat-to-include.md", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fwhat-to-include.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Fwrite-documentation%2Fwhat-to-include.md?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -122,4 +122,4 @@ Here is an example of a new theme, [Ayu].\n [API Guidelines]: https://rust-lang.github.io/api-guidelines/documentation.html#rustdoc-does-not-show-unhelpful-implementation-details-c-hidden\n [Documentation tests]: documentation-tests.md\n [on this blog]: https://blog.guillaume-gomez.fr/articles/2016-09-16+Generating+doc+with+rustdoc+and+a+custom+theme\n-[rustdoc-lints]: lints.md\n+[rustdoc-lints]: ../lints.md", "previous_filename": "src/doc/rustdoc/src/what-to-include.md"}, {"sha": "f2856690d257a91eeecdf30c6e07e1c35e830614", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1460,6 +1460,7 @@ fn init_id_map() -> FxHashMap<String, usize> {\n     map.insert(\"provided-methods\".to_owned(), 1);\n     map.insert(\"implementors\".to_owned(), 1);\n     map.insert(\"synthetic-implementors\".to_owned(), 1);\n+    map.insert(\"implementations-list\".to_owned(), 1);\n     map.insert(\"trait-implementations-list\".to_owned(), 1);\n     map.insert(\"synthetic-implementations-list\".to_owned(), 1);\n     map.insert(\"blanket-implementations-list\".to_owned(), 1);"}, {"sha": "26f29a3524b00cf03763b36d98f60623374251f8", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1065,14 +1065,15 @@ fn render_assoc_items_inner(\n     let (non_trait, traits): (Vec<_>, _) = v.iter().partition(|i| i.inner_impl().trait_.is_none());\n     if !non_trait.is_empty() {\n         let mut tmp_buf = Buffer::empty_from(w);\n-        let render_mode = match what {\n+        let (render_mode, id) = match what {\n             AssocItemRender::All => {\n                 tmp_buf.write_str(\n                     \"<h2 id=\\\"implementations\\\" class=\\\"small-section-header\\\">\\\n-                         Implementations<a href=\\\"#implementations\\\" class=\\\"anchor\\\"></a>\\\n-                    </h2>\",\n+                         Implementations\\\n+                         <a href=\\\"#implementations\\\" class=\\\"anchor\\\"></a>\\\n+                     </h2>\",\n                 );\n-                RenderMode::Normal\n+                (RenderMode::Normal, \"implementations-list\".to_owned())\n             }\n             AssocItemRender::DerefFor { trait_, type_, deref_mut_ } => {\n                 let id =\n@@ -1090,7 +1091,7 @@ fn render_assoc_items_inner(\n                     trait_ = trait_.print(cx),\n                     type_ = type_.print(cx),\n                 );\n-                RenderMode::ForDeref { mut_: deref_mut_ }\n+                (RenderMode::ForDeref { mut_: deref_mut_ }, cx.derive_id(id))\n             }\n         };\n         let mut impls_buf = Buffer::empty_from(w);\n@@ -1115,7 +1116,9 @@ fn render_assoc_items_inner(\n         }\n         if !impls_buf.is_empty() {\n             w.push_buffer(tmp_buf);\n+            write!(w, \"<div id=\\\"{}\\\">\", id);\n             w.push_buffer(impls_buf);\n+            w.write_str(\"</div>\");\n         }\n     }\n \n@@ -1146,7 +1149,8 @@ fn render_assoc_items_inner(\n             write!(\n                 w,\n                 \"<h2 id=\\\"trait-implementations\\\" class=\\\"small-section-header\\\">\\\n-                     Trait Implementations<a href=\\\"#trait-implementations\\\" class=\\\"anchor\\\"></a>\\\n+                     Trait Implementations\\\n+                     <a href=\\\"#trait-implementations\\\" class=\\\"anchor\\\"></a>\\\n                  </h2>\\\n                  <div id=\\\"trait-implementations-list\\\">{}</div>\",\n                 impls"}, {"sha": "90592335d5ddfa83cfa03112873620992a04047f", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -741,7 +741,7 @@ function hideThemeButtonState() {\n         } else {\n             addClass(innerToggle, \"will-expand\");\n             onEachLazy(document.getElementsByClassName(\"rustdoc-toggle\"), function(e) {\n-                if (e.parentNode.id !== MAIN_ID ||\n+                if (e.parentNode.id !== \"implementations-list\" ||\n                     (!hasClass(e, \"implementors-toggle\") &&\n                      !hasClass(e, \"type-contents-toggle\")))\n                 {"}, {"sha": "af76d2ea42760c7fcbc3159f8566529858abc68b", "filename": "src/test/rustdoc-gui/docblock-table-overflow.goml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fdocblock-table-overflow.goml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -12,10 +12,10 @@ assert-property: (\".top-doc .docblock table\", {\"scrollWidth\": \"1573\"})\n \n // Logically, the \".docblock\" and the \"<p>\" should have the same scroll width.\n compare-elements-property: (\n-    \"#implementations + details .docblock\",\n-    \"#implementations + details .docblock > p\",\n+    \"#implementations-list > details .docblock\",\n+    \"#implementations-list > details .docblock > p\",\n     [\"scrollWidth\"],\n )\n-assert-property: (\"#implementations + details .docblock\", {\"scrollWidth\": \"801\"})\n+assert-property: (\"#implementations-list > details .docblock\", {\"scrollWidth\": \"801\"})\n // However, since there is overflow in the <table>, its scroll width is bigger.\n-assert-property: (\"#implementations + details .docblock table\", {\"scrollWidth\": \"1573\"})\n+assert-property: (\"#implementations-list > details .docblock table\", {\"scrollWidth\": \"1573\"})"}, {"sha": "861f6928362c28e841541b3d91620b56c828fd85", "filename": "src/test/rustdoc-gui/hash-item-expansion.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fhash-item-expansion.goml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -3,9 +3,9 @@ goto: file://|DOC_PATH|/test_docs/struct.Foo.html#method.borrow\n // In the blanket implementations list, \"Borrow\" is the second one, hence the \":nth(2)\".\n assert-attribute: (\"#blanket-implementations-list > details:nth-child(2)\", {\"open\": \"\"})\n // We first check that the impl block is open by default.\n-assert-attribute: (\"#implementations + details\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list details\", {\"open\": \"\"})\n // To ensure that we will click on the currently hidden method.\n assert-text: (\".sidebar-elems section .block li > a\", \"must_use\")\n click: \".sidebar-elems section .block li > a\"\n // We check that the impl block was opened as expected so that we can see the method.\n-assert-attribute: (\"#implementations + details\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list > details\", {\"open\": \"\"})"}, {"sha": "6df2661e6c2bb800f67dc40e8878f3a2312263ba", "filename": "src/test/rustdoc-gui/impl-default-expansion.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fimpl-default-expansion.goml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1,3 +1,3 @@\n // This test ensures that the impl blocks are open by default.\n goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n-assert-attribute: (\"#main-content > details.implementors-toggle\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list details.implementors-toggle\", {\"open\": \"\"})"}, {"sha": "ee6bc3cf7675c3d1dbf4428db04f2c2a9ce73328", "filename": "src/test/rustdoc-gui/toggle-docs-mobile.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs-mobile.goml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -14,7 +14,7 @@ assert-attribute: (\".top-doc\", {\"open\": \"\"})\n // Assert the position of the toggle on the top doc block.\n assert-position: (\".top-doc summary::before\", {\"x\": 4})\n // Assert the position of the toggle on the impl block.\n-assert-position: (\"#implementations + details > summary::before\", {\"x\": 4})\n+assert-position: (\"#implementations-list > details > summary::before\", {\"x\": 4})\n // Assert the position of the toggle on a method.\n assert-position: (\n     \"#trait-implementations-list .impl-items .method-toggle > summary::before\","}, {"sha": "f98111484f315b428bc6f3632d3fbe843a304be0", "filename": "src/test/rustdoc-gui/toggle-docs.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -24,7 +24,7 @@ wait-for: 50\n assert-text: (\"#toggle-all-docs\", \"[+]\")\n // We check that all <details> are collapsed (except for the impl block ones).\n assert-attribute-false: (\"details.rustdoc-toggle:not(.implementors-toggle)\", {\"open\": \"\"}, ALL)\n-assert-attribute: (\"details.rustdoc-toggle.implementors-toggle\", {\"open\": \"\"})\n+assert-attribute: (\"#implementations-list > details.implementors-toggle\", {\"open\": \"\"})\n // We now check that the other impl blocks are collapsed.\n assert-attribute-false: (\n     \"#blanket-implementations-list > details.rustdoc-toggle.implementors-toggle\","}, {"sha": "84c9e4ac0cd8449200f19b4252e8c825a3adc312", "filename": "src/test/rustdoc/duplicate_impls/issue-33054.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fduplicate_impls%2Fissue-33054.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -1,8 +1,10 @@\n+// ignore-tidy-linelength\n+\n // @has issue_33054/impls/struct.Foo.html\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Foo'\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Bar for Foo'\n // @count - '//*[@id=\"trait-implementations-list\"]//*[@class=\"impl has-srclink\"]' 1\n-// @count - '//*[@id=\"main-content\"]/details/summary/*[@class=\"impl has-srclink\"]' 1\n+// @count - '//*[@id=\"main-content\"]/div[@id=\"implementations-list\"]/details/summary/*[@class=\"impl has-srclink\"]' 1\n // @has issue_33054/impls/bar/trait.Bar.html\n // @has - '//h3[@class=\"code-header in-band\"]' 'impl Bar for Foo'\n // @count - '//*[@class=\"struct\"]' 1"}, {"sha": "df454dae7250f5f19cb42b9dbf261fbfb65f6225", "filename": "src/test/ui/const-generics/generic_const_exprs/auxiliary/issue-94287-aux.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fauxiliary%2Fissue-94287-aux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fauxiliary%2Fissue-94287-aux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fauxiliary%2Fissue-94287-aux.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -0,0 +1,21 @@\n+#![feature(generic_const_exprs)]\n+\n+use std::str::FromStr;\n+\n+pub struct If<const CONDITION: bool>;\n+\n+pub trait True {}\n+\n+impl True for If<true> {}\n+\n+pub struct FixedI32<const FRAC: u32>;\n+\n+impl<const FRAC: u32> FromStr for FixedI32<FRAC>\n+where\n+    If<{ FRAC <= 32 }>: True,\n+{\n+    type Err = ();\n+    fn from_str(_s: &str) -> Result<Self, Self::Err> {\n+        unimplemented!()\n+    }\n+}"}, {"sha": "643126a4640a8896b0189f20bb674ab53b5f2666", "filename": "src/test/ui/const-generics/generic_const_exprs/issue-94287.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -0,0 +1,10 @@\n+// aux-build:issue-94287-aux.rs\n+// build-fail\n+\n+extern crate issue_94287_aux;\n+\n+use std::str::FromStr;\n+\n+fn main() {\n+    let _ = <issue_94287_aux::FixedI32<16>>::from_str(\"\");\n+}"}, {"sha": "c918651ba62d986d603e3df5c19d22e3e74ecc38", "filename": "src/test/ui/const-generics/generic_const_exprs/issue-94287.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fgeneric_const_exprs%2Fissue-94287.stderr?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -0,0 +1,14 @@\n+error: failed to evaluate generic const expression\n+  --> $DIR/auxiliary/issue-94287-aux.rs:15:8\n+   |\n+LL |     If<{ FRAC <= 32 }>: True,\n+   |        ^^^^^^^^^^^^^^\n+   |\n+   = note: the crate this constant originates from uses `#![feature(generic_const_exprs)]`\n+help: consider enabling this feature\n+   |\n+LL | #![feature(generic_const_exprs)]\n+   |\n+\n+error: aborting due to previous error\n+"}, {"sha": "58a373a967388cf66d7217724a79371aa964ebe9", "filename": "src/test/ui/consts/drop_box.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -0,0 +1,4 @@\n+const fn f<T>(_: Box<T>) {}\n+//~^ ERROR destructors cannot be evaluated at compile-time\n+\n+fn main() {}"}, {"sha": "b9d6581e8ecc847d4f94c710d1dcd6353429b36b", "filename": "src/test/ui/consts/drop_box.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fdrop_box.stderr?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -0,0 +1,11 @@\n+error[E0493]: destructors cannot be evaluated at compile-time\n+  --> $DIR/drop_box.rs:1:15\n+   |\n+LL | const fn f<T>(_: Box<T>) {}\n+   |               ^           - value is dropped here\n+   |               |\n+   |               constant functions cannot evaluate destructors\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0493`."}, {"sha": "c9b1649200d9cb2a8c7a21fd2983f5027f172cf8", "filename": "src/tools/linkchecker/main.rs", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftools%2Flinkchecker%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f4e0677190b82e61dc507e3e72caf89da8e5e28/src%2Ftools%2Flinkchecker%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flinkchecker%2Fmain.rs?ref=5f4e0677190b82e61dc507e3e72caf89da8e5e28", "patch": "@@ -489,16 +489,22 @@ fn is_exception(file: &Path, link: &str) -> bool {\n /// If the given HTML file contents is an HTML redirect, this returns the\n /// destination path given in the redirect.\n fn maybe_redirect(source: &str) -> Option<String> {\n-    const REDIRECT: &str = \"<p>Redirecting to <a href=\";\n+    const REDIRECT_RUSTDOC: (usize, &str) = (7, \"<p>Redirecting to <a href=\");\n+    const REDIRECT_MDBOOK: (usize, &str) = (8 - 7, \"<p>Redirecting to... <a href=\");\n \n     let mut lines = source.lines();\n-    let redirect_line = lines.nth(7)?;\n \n-    redirect_line.find(REDIRECT).map(|i| {\n-        let rest = &redirect_line[(i + REDIRECT.len() + 1)..];\n-        let pos_quote = rest.find('\"').unwrap();\n-        rest[..pos_quote].to_owned()\n-    })\n+    let mut find_redirect = |(line_rel, redirect_pattern): (usize, &str)| {\n+        let redirect_line = lines.nth(line_rel)?;\n+\n+        redirect_line.find(redirect_pattern).map(|i| {\n+            let rest = &redirect_line[(i + redirect_pattern.len() + 1)..];\n+            let pos_quote = rest.find('\"').unwrap();\n+            rest[..pos_quote].to_owned()\n+        })\n+    };\n+\n+    find_redirect(REDIRECT_RUSTDOC).or_else(|| find_redirect(REDIRECT_MDBOOK))\n }\n \n fn with_attrs_in_source<F: FnMut(&str, usize, &str)>(source: &str, attr: &str, mut f: F) {"}]}