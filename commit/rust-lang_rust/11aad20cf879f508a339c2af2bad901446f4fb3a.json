{"sha": "11aad20cf879f508a339c2af2bad901446f4fb3a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExYWFkMjBjZjg3OWY1MDhhMzM5YzJhZjJiYWQ5MDE0NDZmNGZiM2E=", "commit": {"author": {"name": "blake2-ppc", "email": "blake2-ppc", "date": "2013-07-28T21:31:53Z"}, "committer": {"name": "blake2-ppc", "email": "blake2-ppc", "date": "2013-07-29T17:43:21Z"}, "message": "std: Implement Clone and DeepClone for extern \"Rust\" fn\n\nImplement Clone and DeepClone for functions with 0 to 8 arguments.", "tree": {"sha": "988a9e9a4d8f85f5fdaabc2ac773ffafb0a096fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/988a9e9a4d8f85f5fdaabc2ac773ffafb0a096fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11aad20cf879f508a339c2af2bad901446f4fb3a", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11aad20cf879f508a339c2af2bad901446f4fb3a", "html_url": "https://github.com/rust-lang/rust/commit/11aad20cf879f508a339c2af2bad901446f4fb3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11aad20cf879f508a339c2af2bad901446f4fb3a/comments", "author": null, "committer": null, "parents": [{"sha": "27812ea5e025ed36dc80379b86bb249b33c528a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/27812ea5e025ed36dc80379b86bb249b33c528a2", "html_url": "https://github.com/rust-lang/rust/commit/27812ea5e025ed36dc80379b86bb249b33c528a2"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "bd5bfb197b2d1f23e29a60955c9a68418d5031d6", "filename": "src/libstd/clone.rs", "status": "modified", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/11aad20cf879f508a339c2af2bad901446f4fb3a/src%2Flibstd%2Fclone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11aad20cf879f508a339c2af2bad901446f4fb3a/src%2Flibstd%2Fclone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fclone.rs?ref=11aad20cf879f508a339c2af2bad901446f4fb3a", "patch": "@@ -97,6 +97,26 @@ clone_impl!(())\n clone_impl!(bool)\n clone_impl!(char)\n \n+macro_rules! extern_fn_clone(\n+    ($($A:ident),*) => (\n+        impl<$($A,)* ReturnType> Clone for extern \"Rust\" fn($($A),*) -> ReturnType {\n+            /// Return a copy of a function pointer\n+            #[inline]\n+            fn clone(&self) -> extern \"Rust\" fn($($A),*) -> ReturnType { *self }\n+        }\n+    )\n+)\n+\n+extern_fn_clone!()\n+extern_fn_clone!(A)\n+extern_fn_clone!(A, B)\n+extern_fn_clone!(A, B, C)\n+extern_fn_clone!(A, B, C, D)\n+extern_fn_clone!(A, B, C, D, E)\n+extern_fn_clone!(A, B, C, D, E, F)\n+extern_fn_clone!(A, B, C, D, E, F, G)\n+extern_fn_clone!(A, B, C, D, E, F, G, H)\n+\n /// A trait distinct from `Clone` which represents \"deep copies\" of things like\n /// managed boxes which would otherwise not be copied.\n pub trait DeepClone {\n@@ -157,6 +177,26 @@ deep_clone_impl!(())\n deep_clone_impl!(bool)\n deep_clone_impl!(char)\n \n+macro_rules! extern_fn_deep_clone(\n+    ($($A:ident),*) => (\n+        impl<$($A,)* ReturnType> DeepClone for extern \"Rust\" fn($($A),*) -> ReturnType {\n+            /// Return a copy of a function pointer\n+            #[inline]\n+            fn deep_clone(&self) -> extern \"Rust\" fn($($A),*) -> ReturnType { *self }\n+        }\n+    )\n+)\n+\n+extern_fn_deep_clone!()\n+extern_fn_deep_clone!(A)\n+extern_fn_deep_clone!(A, B)\n+extern_fn_deep_clone!(A, B, C)\n+extern_fn_deep_clone!(A, B, C, D)\n+extern_fn_deep_clone!(A, B, C, D, E)\n+extern_fn_deep_clone!(A, B, C, D, E, F)\n+extern_fn_deep_clone!(A, B, C, D, E, F, G)\n+extern_fn_deep_clone!(A, B, C, D, E, F, G, H)\n+\n #[test]\n fn test_owned_clone() {\n     let a = ~5i;\n@@ -195,3 +235,21 @@ fn test_borrowed_clone() {\n     let z: &int = (&y).clone();\n     assert_eq!(*z, 5);\n }\n+\n+#[test]\n+fn test_extern_fn_clone() {\n+    trait Empty {}\n+    impl Empty for int {}\n+\n+    fn test_fn_a() -> float { 1.0 }\n+    fn test_fn_b<T: Empty>(x: T) -> T { x }\n+    fn test_fn_c(_: int, _: float, _: ~[int], _: int, _: int, _: int) {}\n+\n+    let _ = test_fn_a.clone();\n+    let _ = test_fn_b::<int>.clone();\n+    let _ = test_fn_c.clone();\n+\n+    let _ = test_fn_a.deep_clone();\n+    let _ = test_fn_b::<int>.deep_clone();\n+    let _ = test_fn_c.deep_clone();\n+}"}]}