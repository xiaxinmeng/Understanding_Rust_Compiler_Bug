{"sha": "77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3ZDI3YzY3YzFkYWRjZTRhYmU3YTZhOTdjMGI3M2VhYTM3MDZlNjA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-02-16T12:03:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-16T12:03:42Z"}, "message": "Merge #3165\n\n3165: Fix coercion of &T to itself r=matklad a=flodiebold\n\nThe autoderef coercion logic did not handle matching placeholders. This led to\r\nsome type mismatches.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "9dd19eb756f74a875a35afb5b68296b8934c631d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9dd19eb756f74a875a35afb5b68296b8934c631d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeSS+eCRBK7hj4Ov3rIwAAdHIIAKdvERZVc2LRYcjoc794gFmo\n4W6oRQUYnm+6j2mjJ9B2uh42dftkHhJdckZht28oLhV84vBA/Ba28Mjh/c8D/8Iy\ng3CY8Psxdt9VzmAF84TofY37lc8fYXrXNHVaisZKWIu7hpfZ0mcnmHvVJlzCNiXo\nsjPE3mEnwXBKU4G3uuUi42GtywvwsasF1utdm2wMq8WxGhVjQ279YnnBVFqd7uup\n1PlEP5qW9laa/2yZOTbSjSQ/Qyp3NUaQtqpuvakqtbibPreyzjuzbIh2dW5wsOL2\n9EHzK9N8MbQgCBkg6xcvHWylxJzycTZnCKkZbVynmogxAxHA4MLRiFTpIDZJpUg=\n=aXjI\n-----END PGP SIGNATURE-----\n", "payload": "tree 9dd19eb756f74a875a35afb5b68296b8934c631d\nparent a15c8739b9a6da223e1f3a6ff6aa868913c0dbf4\nparent e14e7ffa34bf9a458681fe7490ac2d51b02ff908\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1581854622 +0000\ncommitter GitHub <noreply@github.com> 1581854622 +0000\n\nMerge #3165\n\n3165: Fix coercion of &T to itself r=matklad a=flodiebold\n\nThe autoderef coercion logic did not handle matching placeholders. This led to\r\nsome type mismatches.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "html_url": "https://github.com/rust-lang/rust/commit/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a15c8739b9a6da223e1f3a6ff6aa868913c0dbf4", "url": "https://api.github.com/repos/rust-lang/rust/commits/a15c8739b9a6da223e1f3a6ff6aa868913c0dbf4", "html_url": "https://github.com/rust-lang/rust/commit/a15c8739b9a6da223e1f3a6ff6aa868913c0dbf4"}, {"sha": "e14e7ffa34bf9a458681fe7490ac2d51b02ff908", "url": "https://api.github.com/repos/rust-lang/rust/commits/e14e7ffa34bf9a458681fe7490ac2d51b02ff908", "html_url": "https://github.com/rust-lang/rust/commit/e14e7ffa34bf9a458681fe7490ac2d51b02ff908"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "1dc842f40ec4e0ee74a430284a453d614e6e5c73", "filename": "crates/ra_hir_ty/src/infer/unify.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Funify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Funify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Finfer%2Funify.rs?ref=77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "patch": "@@ -249,6 +249,8 @@ impl InferenceTable {\n         match (ty1, ty2) {\n             (Ty::Unknown, _) | (_, Ty::Unknown) => true,\n \n+            (Ty::Placeholder(p1), Ty::Placeholder(p2)) if *p1 == *p2 => true,\n+\n             (Ty::Infer(InferTy::TypeVar(tv1)), Ty::Infer(InferTy::TypeVar(tv2)))\n             | (Ty::Infer(InferTy::IntVar(tv1)), Ty::Infer(InferTy::IntVar(tv2)))\n             | (Ty::Infer(InferTy::FloatVar(tv1)), Ty::Infer(InferTy::FloatVar(tv2)))"}, {"sha": "42330b269f1a91792a7ddbbb67341132eb7d126d", "filename": "crates/ra_hir_ty/src/tests/coercion.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77d27c67c1dadce4abe7a6a97c0b73eaa3706e60/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fcoercion.rs?ref=77d27c67c1dadce4abe7a6a97c0b73eaa3706e60", "patch": "@@ -526,3 +526,25 @@ fn test() {\n     \"###\n     );\n }\n+\n+#[test]\n+fn coerce_placeholder_ref() {\n+    // placeholders should unify, even behind references\n+    assert_snapshot!(\n+        infer_with_mismatches(r#\"\n+struct S<T> { t: T }\n+impl<TT> S<TT> {\n+    fn get(&self) -> &TT {\n+        &self.t\n+    }\n+}\n+\"#, true),\n+        @r###\"\n+    [51; 55) 'self': &S<TT>\n+    [64; 87) '{     ...     }': &TT\n+    [74; 81) '&self.t': &TT\n+    [75; 79) 'self': &S<TT>\n+    [75; 81) 'self.t': TT\n+    \"###\n+    );\n+}"}]}