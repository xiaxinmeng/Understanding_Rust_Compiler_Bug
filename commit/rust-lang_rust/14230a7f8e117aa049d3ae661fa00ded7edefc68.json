{"sha": "14230a7f8e117aa049d3ae661fa00ded7edefc68", "node_id": "C_kwDOAAsO6NoAKDE0MjMwYTdmOGUxMTdhYTA0OWQzYWU2NjFmYTAwZGVkN2VkZWZjNjg", "commit": {"author": {"name": "Markus Reiter", "email": "me@reitermark.us", "date": "2022-09-12T17:03:24Z"}, "committer": {"name": "Markus Reiter", "email": "me@reitermark.us", "date": "2022-09-12T17:46:51Z"}, "message": "Simplify `clippy` fix.", "tree": {"sha": "f52a155f67381c64bb69022804dd5d0702aa1774", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f52a155f67381c64bb69022804dd5d0702aa1774"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/14230a7f8e117aa049d3ae661fa00ded7edefc68", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJFBAABCAAvFiEEbU1eLXPTwjnhHZwHJFKTtRcCZVsFAmMfcIsRHG1lQHJlaXRl\ncm1hcmsudXMACgkQJFKTtRcCZVvCig//QSzI3ELRWy2yw9EZmDs5fDXcc0oGIjOc\nz9hgxDZ634+9zJaQEJWtm1c+wjwMEESnsyNWL+bG8nKUIIeX+dfTChx2pCajPLaT\novtHo4kH4wgPDQQW9CxI9TFrSv+jovG0fwxWLPcu8UTKDpXD9RIYY0ChIyd6BUxI\nAufkzvAxtEfCXk3RBLlRZILWZNoyYpFE4LXp7pD6no6RVNUJ9XzbQ4CuEHXjsyxs\nBbHZ3o2LcNHvI0iMREUvyXvGoRYLPz/h4WTJ2LGA93iXK2NK3UGt2A3lvjPsojdj\nO/tdNoBH9xft5x5lhro2JX/h0Dahhd1/wDe+vAk6twOt/wmlEgs0Onnp/g4O/Iwm\n1EmM6B32AMAazaxwdjiIzEaLMZRWyL8pGZE+wPRw12fXAb6DVo7NCsjDE9oeOpQG\nu77QZeYw7jtDZBVDBuxFbHfiJnAnTBi7I1qWOAhcCinlBSIOHEhwWgOf3uBcuY/J\ntlaYCkGHahgKrZXTP01WPdqCJ/cpv3njMNr/8dqfZI6LqkoNl3rlCPUCyhjuZBSn\n/uRnCFgsb9AOcwfJaE2X9LByWco55Bn3RzuFwkT6TKe7D1Gpbx3DV0m1uJFJesn9\ni8yDk5h+ydbb+YqLEDsZkHU7eaiuq3njot10usETyisaRhD8WPC/o2hIgZrMYIp5\nfi5V+6OH2kA=\n=dayX\n-----END PGP SIGNATURE-----", "payload": "tree f52a155f67381c64bb69022804dd5d0702aa1774\nparent 8c78400c541df0600132a726c7b58717b158befa\nauthor Markus Reiter <me@reitermark.us> 1663002204 +0200\ncommitter Markus Reiter <me@reitermark.us> 1663004811 +0200\n\nSimplify `clippy` fix.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/14230a7f8e117aa049d3ae661fa00ded7edefc68", "html_url": "https://github.com/rust-lang/rust/commit/14230a7f8e117aa049d3ae661fa00ded7edefc68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/14230a7f8e117aa049d3ae661fa00ded7edefc68/comments", "author": {"login": "reitermarkus", "id": 1309829, "node_id": "MDQ6VXNlcjEzMDk4Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1309829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reitermarkus", "html_url": "https://github.com/reitermarkus", "followers_url": "https://api.github.com/users/reitermarkus/followers", "following_url": "https://api.github.com/users/reitermarkus/following{/other_user}", "gists_url": "https://api.github.com/users/reitermarkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/reitermarkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reitermarkus/subscriptions", "organizations_url": "https://api.github.com/users/reitermarkus/orgs", "repos_url": "https://api.github.com/users/reitermarkus/repos", "events_url": "https://api.github.com/users/reitermarkus/events{/privacy}", "received_events_url": "https://api.github.com/users/reitermarkus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "reitermarkus", "id": 1309829, "node_id": "MDQ6VXNlcjEzMDk4Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1309829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reitermarkus", "html_url": "https://github.com/reitermarkus", "followers_url": "https://api.github.com/users/reitermarkus/followers", "following_url": "https://api.github.com/users/reitermarkus/following{/other_user}", "gists_url": "https://api.github.com/users/reitermarkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/reitermarkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reitermarkus/subscriptions", "organizations_url": "https://api.github.com/users/reitermarkus/orgs", "repos_url": "https://api.github.com/users/reitermarkus/repos", "events_url": "https://api.github.com/users/reitermarkus/events{/privacy}", "received_events_url": "https://api.github.com/users/reitermarkus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c78400c541df0600132a726c7b58717b158befa", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c78400c541df0600132a726c7b58717b158befa", "html_url": "https://github.com/rust-lang/rust/commit/8c78400c541df0600132a726c7b58717b158befa"}], "stats": {"total": 64, "additions": 23, "deletions": 41}, "files": [{"sha": "2d4e268118127d6745f02a14cbdbfbd85c942ac1", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/14230a7f8e117aa049d3ae661fa00ded7edefc68/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14230a7f8e117aa049d3ae661fa00ded7edefc68/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=14230a7f8e117aa049d3ae661fa00ded7edefc68", "patch": "@@ -214,6 +214,7 @@ symbols! {\n         IntoIterator,\n         IoRead,\n         IoWrite,\n+        IpAddr,\n         IrTyKind,\n         Is,\n         ItemContext,"}, {"sha": "4f14fc28038ad5c903559b4d3c3798f77f7476e9", "filename": "library/std/src/net/ip_addr.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/14230a7f8e117aa049d3ae661fa00ded7edefc68/library%2Fstd%2Fsrc%2Fnet%2Fip_addr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14230a7f8e117aa049d3ae661fa00ded7edefc68/library%2Fstd%2Fsrc%2Fnet%2Fip_addr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fnet%2Fip_addr.rs?ref=14230a7f8e117aa049d3ae661fa00ded7edefc68", "patch": "@@ -34,11 +34,9 @@ use super::display_buffer::DisplayBuffer;\n #[derive(Copy, Clone, Eq, PartialEq, Hash, PartialOrd, Ord)]\n pub enum IpAddr {\n     /// An IPv4 address.\n-    #[cfg_attr(not(test), rustc_diagnostic_item = \"ip_addr_variant_v4\")]\n     #[stable(feature = \"ip_addr\", since = \"1.7.0\")]\n     V4(#[stable(feature = \"ip_addr\", since = \"1.7.0\")] Ipv4Addr),\n     /// An IPv6 address.\n-    #[cfg_attr(not(test), rustc_diagnostic_item = \"ip_addr_variant_v6\")]\n     #[stable(feature = \"ip_addr\", since = \"1.7.0\")]\n     V6(#[stable(feature = \"ip_addr\", since = \"1.7.0\")] Ipv6Addr),\n }"}, {"sha": "c89784065b8be775d4ba7fc6fd967dc0b77d9f2d", "filename": "src/tools/clippy/clippy_lints/src/matches/redundant_pattern_match.rs", "status": "modified", "additions": 22, "deletions": 37, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/14230a7f8e117aa049d3ae661fa00ded7edefc68/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14230a7f8e117aa049d3ae661fa00ded7edefc68/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmatches%2Fredundant_pattern_match.rs?ref=14230a7f8e117aa049d3ae661fa00ded7edefc68", "patch": "@@ -4,15 +4,15 @@ use clippy_utils::source::snippet;\n use clippy_utils::sugg::Sugg;\n use clippy_utils::ty::{is_type_diagnostic_item, needs_ordered_drop};\n use clippy_utils::visitors::any_temporaries_need_ordered_drop;\n-use clippy_utils::{higher, is_lang_ctor, is_trait_method, match_def_path, paths};\n+use clippy_utils::{higher, is_lang_ctor, is_trait_method};\n use if_chain::if_chain;\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n-use rustc_hir::LangItem::{OptionNone, PollPending};\n+use rustc_hir::LangItem::{self, OptionSome, OptionNone, PollPending, PollReady, ResultOk, ResultErr};\n use rustc_hir::{Arm, Expr, ExprKind, Node, Pat, PatKind, QPath, UnOp};\n use rustc_lint::LateContext;\n use rustc_middle::ty::{self, subst::GenericArgKind, DefIdTree, Ty};\n-use rustc_span::{sym, Symbol, def_id::DefId};\n+use rustc_span::{sym, Symbol};\n \n pub(super) fn check<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n     if let Some(higher::WhileLet { let_pat, let_expr, .. }) = higher::WhileLet::hir(expr) {\n@@ -75,9 +75,9 @@ fn find_sugg_for_if_let<'tcx>(\n                     (\"is_some()\", op_ty)\n                 } else if Some(id) == lang_items.poll_ready_variant() {\n                     (\"is_ready()\", op_ty)\n-                } else if is_pat_variant(cx, check_pat, qpath, &paths::IPADDR_V4, Item::Diag(sym!(IpAddr), sym!(V4))) {\n+                } else if is_pat_variant(cx, check_pat, qpath, Item::Diag(sym::IpAddr, sym!(V4))) {\n                     (\"is_ipv4()\", op_ty)\n-                } else if is_pat_variant(cx, check_pat, qpath, &paths::IPADDR_V6, Item::Diag(sym!(IpAddr), sym!(V6))) {\n+                } else if is_pat_variant(cx, check_pat, qpath, Item::Diag(sym::IpAddr, sym!(V6))) {\n                     (\"is_ipv6()\", op_ty)\n                 } else {\n                     return;\n@@ -174,7 +174,6 @@ fn find_sugg_for_if_let<'tcx>(\n \n pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op: &Expr<'_>, arms: &[Arm<'_>]) {\n     if arms.len() == 2 {\n-        let lang_items = cx.tcx.lang_items();\n         let node_pair = (&arms[0].pat.kind, &arms[1].pat.kind);\n \n         let found_good_method = match node_pair {\n@@ -188,10 +187,8 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n                         arms,\n                         path_left,\n                         path_right,\n-                        &paths::RESULT_OK,\n-                        Item::Lang(lang_items.result_ok_variant()),\n-                        &paths::RESULT_ERR,\n-                        Item::Lang(lang_items.result_err_variant()),\n+                        Item::Lang(ResultOk),\n+                        Item::Lang(ResultErr),\n                         \"is_ok()\",\n                         \"is_err()\",\n                     )\n@@ -201,10 +198,8 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n                             arms,\n                             path_left,\n                             path_right,\n-                            &paths::IPADDR_V4,\n-                            Item::Diag(sym!(IpAddr), sym!(V4)),\n-                            &paths::IPADDR_V6,\n-                            Item::Diag(sym!(IpAddr), sym!(V6)),\n+                            Item::Diag(sym::IpAddr, sym!(V4)),\n+                            Item::Diag(sym::IpAddr, sym!(V6)),\n                             \"is_ipv4()\",\n                             \"is_ipv6()\",\n                         )\n@@ -224,10 +219,8 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n                         arms,\n                         path_left,\n                         path_right,\n-                        &paths::OPTION_SOME,\n-                        Item::Lang(lang_items.option_some_variant()),\n-                        &paths::OPTION_NONE,\n-                        Item::Lang(lang_items.option_none_variant()),\n+                        Item::Lang(OptionSome),\n+                        Item::Lang(OptionNone),\n                         \"is_some()\",\n                         \"is_none()\",\n                     )\n@@ -237,10 +230,8 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n                             arms,\n                             path_left,\n                             path_right,\n-                            &paths::POLL_READY,\n-                            Item::Lang(lang_items.poll_ready_variant()),\n-                            &paths::POLL_PENDING,\n-                            Item::Lang(lang_items.poll_pending_variant()),\n+                            Item::Lang(PollReady),\n+                            Item::Lang(PollPending),\n                             \"is_ready()\",\n                             \"is_pending()\",\n                         )\n@@ -278,21 +269,17 @@ pub(super) fn check_match<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, op\n \n #[derive(Clone, Copy)]\n enum Item {\n-  Lang(Option<DefId>),\n+  Lang(LangItem),\n   Diag(Symbol, Symbol),\n }\n \n-fn is_pat_variant(cx: &LateContext<'_>, pat: &Pat<'_>, path: &QPath<'_>, expected_path: &[&str], expected_item: Item) -> bool {\n+fn is_pat_variant(cx: &LateContext<'_>, pat: &Pat<'_>, path: &QPath<'_>, expected_item: Item) -> bool {\n     let Some(id) = cx.typeck_results().qpath_res(path, pat.hir_id).opt_def_id() else { return false };\n \n-    // TODO: Path matching can be removed when `IpAddr` is a diagnostic item.\n-    if match_def_path(cx, id, expected_path) {\n-        return true\n-    }\n-\n     match expected_item {\n-        Item::Lang(expected_id) => {\n-            Some(cx.tcx.parent(id)) == expected_id\n+        Item::Lang(expected_lang_item) => {\n+            let expected_id = cx.tcx.lang_items().require(expected_lang_item).unwrap();\n+            cx.tcx.parent(id) == expected_id\n         },\n         Item::Diag(expected_ty, expected_variant) => {\n             let ty = cx.typeck_results().pat_ty(pat);\n@@ -316,9 +303,7 @@ fn find_good_method_for_match<'a>(\n     arms: &[Arm<'_>],\n     path_left: &QPath<'_>,\n     path_right: &QPath<'_>,\n-    expected_path_left: &[&str],\n     expected_item_left: Item,\n-    expected_path_right: &[&str],\n     expected_item_right: Item,\n     should_be_left: &'a str,\n     should_be_right: &'a str,\n@@ -327,15 +312,15 @@ fn find_good_method_for_match<'a>(\n     let pat_right = arms[1].pat;\n \n     let body_node_pair = if (\n-        is_pat_variant(cx, pat_left, path_left, expected_path_left, expected_item_left)\n+        is_pat_variant(cx, pat_left, path_left, expected_item_left)\n     ) && (\n-        is_pat_variant(cx, pat_right, path_right, expected_path_right, expected_item_right)\n+        is_pat_variant(cx, pat_right, path_right, expected_item_right)\n     ) {\n         (&arms[0].body.kind, &arms[1].body.kind)\n     } else if (\n-        is_pat_variant(cx, pat_left, path_left, expected_path_right, expected_item_right)\n+        is_pat_variant(cx, pat_left, path_left, expected_item_right)\n     ) && (\n-        is_pat_variant(cx, pat_right, path_right, expected_path_left, expected_item_left)\n+        is_pat_variant(cx, pat_right, path_right, expected_item_left)\n     ) {\n         (&arms[1].body.kind, &arms[0].body.kind)\n     } else {"}, {"sha": "07170e2df12ab2be340c0d5affdc5d4a88641a66", "filename": "src/tools/clippy/clippy_utils/src/paths.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/14230a7f8e117aa049d3ae661fa00ded7edefc68/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14230a7f8e117aa049d3ae661fa00ded7edefc68/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fpaths.rs?ref=14230a7f8e117aa049d3ae661fa00ded7edefc68", "patch": "@@ -66,8 +66,6 @@ pub const INDEX_MUT: [&str; 3] = [\"core\", \"ops\", \"IndexMut\"];\n pub const INSERT_STR: [&str; 4] = [\"alloc\", \"string\", \"String\", \"insert_str\"];\n pub const IO_READ: [&str; 3] = [\"std\", \"io\", \"Read\"];\n pub const IO_WRITE: [&str; 3] = [\"std\", \"io\", \"Write\"];\n-pub const IPADDR_V4: [&str; 5] = [\"std\", \"net\", \"ip\", \"IpAddr\", \"V4\"];\n-pub const IPADDR_V6: [&str; 5] = [\"std\", \"net\", \"ip\", \"IpAddr\", \"V6\"];\n pub const ITER_COUNT: [&str; 6] = [\"core\", \"iter\", \"traits\", \"iterator\", \"Iterator\", \"count\"];\n pub const ITER_EMPTY: [&str; 5] = [\"core\", \"iter\", \"sources\", \"empty\", \"Empty\"];\n pub const ITER_REPEAT: [&str; 5] = [\"core\", \"iter\", \"sources\", \"repeat\", \"repeat\"];"}]}