{"sha": "ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhOWY2MTM1M2E3N2E3MDRjOWFiZjNmYjFmOGUxOWZkY2VjZmY2YTk=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-12-01T20:06:33Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-12-05T16:05:25Z"}, "message": "Add test case for symbol visibility in dylibs.", "tree": {"sha": "9a84cb6d35d4ed77b1c075453f3299780e017fc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a84cb6d35d4ed77b1c075453f3299780e017fc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "html_url": "https://github.com/rust-lang/rust/commit/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfd4910fa2c7a1487d06c7c9cb764bc31e787f12", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfd4910fa2c7a1487d06c7c9cb764bc31e787f12", "html_url": "https://github.com/rust-lang/rust/commit/bfd4910fa2c7a1487d06c7c9cb764bc31e787f12"}], "stats": {"total": 101, "additions": 101, "deletions": 0}, "files": [{"sha": "d6c31d148b3046f114592f135cb8e93c1d68e95a", "filename": "src/test/run-make/symbol-visibility/Makefile", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymbol-visibility%2FMakefile?ref=ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "patch": "@@ -0,0 +1,26 @@\n+include ../tools.mk\n+\n+all:\n+\t$(RUSTC) an_rlib.rs\n+\t$(RUSTC) a_cdylib.rs\n+\t$(RUSTC) a_rust_dylib.rs\n+\t$(RUSTC) an_executable.rs\n+\n+\t# Check that a cdylib exports its public #[no_mangle] functions\n+\t[ \"$$(nm -D $(TMPDIR)/liba_cdylib.so | grep -c public_c_function_from_cdylib)\" -eq \"1\" ]\n+\t# Check that a cdylib exports the public #[no_mangle] functions of dependencies\n+\t[ \"$$(nm -D $(TMPDIR)/liba_cdylib.so | grep -c public_c_function_from_rlib)\" -eq \"1\" ]\n+\t# Check that a cdylib DOES NOT export any public Rust functions\n+\t[ \"$$(nm -D $(TMPDIR)/liba_cdylib.so | grep -c _ZN.*h.*E)\" -eq \"0\" ]\n+\n+\t# Check that a Rust dylib exports its monomorphic functions\n+\t[ \"$$(nm -D $(TMPDIR)/liba_rust_dylib.so | grep -c public_c_function_from_rust_dylib)\" -eq \"1\" ]\n+\t[ \"$$(nm -D $(TMPDIR)/liba_rust_dylib.so | grep -c _ZN.*public_rust_function_from_rust_dylib.*E)\" -eq \"1\" ]\n+\n+\t# Check that a Rust dylib exports the monomorphic functions from its dependencies\n+\t[ \"$$(nm -D $(TMPDIR)/liba_rust_dylib.so | grep -c public_c_function_from_rlib)\" -eq \"1\" ]\n+\t[ \"$$(nm -D $(TMPDIR)/liba_rust_dylib.so | grep -c public_rust_function_from_rlib)\" -eq \"1\" ]\n+\n+\t# Check that an executable does not export any dynamic symbols\n+\t[ \"$$(nm -D $(TMPDIR)/an_executable | grep -c public_c_function_from_rlib)\" -eq \"0\" ]\n+\t[ \"$$(nm -D $(TMPDIR)/an_executable | grep -c public_rust_function_from_exe)\" -eq \"0\" ]"}, {"sha": "9a70542c06ca726c38bcfe097064430d32227573", "filename": "src/test/run-make/symbol-visibility/a_cdylib.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_cdylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_cdylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_cdylib.rs?ref=ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_type=\"cdylib\"]\n+\n+extern crate an_rlib;\n+\n+// This should not be exported\n+pub fn public_rust_function_from_cdylib() {}\n+\n+// This should be exported\n+#[no_mangle]\n+pub extern \"C\" fn public_c_function_from_cdylib() {\n+    an_rlib::public_c_function_from_rlib();\n+}"}, {"sha": "b826211c9a42afab0b1aefc0161b1e37ace56d88", "filename": "src/test/run-make/symbol-visibility/a_rust_dylib.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_rust_dylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_rust_dylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fa_rust_dylib.rs?ref=ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_type=\"dylib\"]\n+\n+extern crate an_rlib;\n+\n+// This should be exported\n+pub fn public_rust_function_from_rust_dylib() {}\n+\n+// This should be exported\n+#[no_mangle]\n+pub extern \"C\" fn public_c_function_from_rust_dylib() {}"}, {"sha": "73059c5e374f2da24a68e9b1454079048bb617ba", "filename": "src/test/run-make/symbol-visibility/an_executable.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_executable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_executable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_executable.rs?ref=ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_type=\"bin\"]\n+\n+extern crate an_rlib;\n+\n+pub fn public_rust_function_from_exe() {}\n+\n+fn main() {}"}, {"sha": "cd19500d14021f0e253fb75067c5caf4b20084a0", "filename": "src/test/run-make/symbol-visibility/an_rlib.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_rlib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_rlib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fsymbol-visibility%2Fan_rlib.rs?ref=ea9f61353a77a704c9abf3fb1f8e19fdcecff6a9", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_type=\"rlib\"]\n+\n+pub fn public_rust_function_from_rlib() {}\n+\n+#[no_mangle]\n+pub extern \"C\" fn public_c_function_from_rlib() {}"}]}