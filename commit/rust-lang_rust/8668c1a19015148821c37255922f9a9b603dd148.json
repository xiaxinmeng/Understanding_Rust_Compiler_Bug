{"sha": "8668c1a19015148821c37255922f9a9b603dd148", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2NjhjMWExOTAxNTE0ODgyMWMzNzI1NTkyMmY5YTliNjAzZGQxNDg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-10-05T13:59:52Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-11-16T15:31:55Z"}, "message": "Add some more tests", "tree": {"sha": "1c10287d2d971b3b69ac8fec7eccede1b0f1d172", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c10287d2d971b3b69ac8fec7eccede1b0f1d172"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8668c1a19015148821c37255922f9a9b603dd148", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8668c1a19015148821c37255922f9a9b603dd148", "html_url": "https://github.com/rust-lang/rust/commit/8668c1a19015148821c37255922f9a9b603dd148", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8668c1a19015148821c37255922f9a9b603dd148/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "808522894b612bca8273f20ba4cfa328622c5a97", "url": "https://api.github.com/repos/rust-lang/rust/commits/808522894b612bca8273f20ba4cfa328622c5a97", "html_url": "https://github.com/rust-lang/rust/commit/808522894b612bca8273f20ba4cfa328622c5a97"}], "stats": {"total": 91, "additions": 78, "deletions": 13}, "files": [{"sha": "41d3a184640acaf373df5ee5e72b765f034c471f", "filename": "src/test/ui/proc-macro/auxiliary/derive-helper-shadowing.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fderive-helper-shadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fderive-helper-shadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fderive-helper-shadowing.rs?ref=8668c1a19015148821c37255922f9a9b603dd148", "patch": "@@ -0,0 +1,15 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+use proc_macro::*;\n+\n+#[proc_macro_derive(GenHelperUse)]\n+pub fn derive_a(_: TokenStream) -> TokenStream {\n+    \"\n+    #[empty_helper]\n+    struct Uwu;\n+    \".parse().unwrap()\n+}"}, {"sha": "f0ca34db414d441b539f851363813f9f4ff1b83c", "filename": "src/test/ui/proc-macro/derive-helper-shadowing.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.rs?ref=8668c1a19015148821c37255922f9a9b603dd148", "patch": "@@ -1,11 +1,21 @@\n // edition:2018\n // aux-build:test-macros.rs\n+// aux-build:derive-helper-shadowing.rs\n \n #[macro_use]\n extern crate test_macros;\n+#[macro_use]\n+extern crate derive_helper_shadowing;\n \n use test_macros::empty_attr as empty_helper;\n \n+macro_rules! gen_helper_use {\n+    () => {\n+        #[empty_helper] //~ ERROR cannot find attribute `empty_helper` in this scope\n+        struct W;\n+    }\n+}\n+\n #[empty_helper] //~ ERROR `empty_helper` is ambiguous\n #[derive(Empty)]\n struct S {\n@@ -20,12 +30,25 @@ struct S {\n             // OK, no ambiguity, the non-helper attribute is not in scope here, only the helper.\n             #[empty_helper]\n             struct V;\n+\n+            gen_helper_use!();\n+\n+            #[derive(GenHelperUse)] //~ ERROR cannot find attribute `empty_helper` in this scope\n+            struct Owo;\n+\n+            use empty_helper as renamed;\n+            #[renamed] //~ ERROR cannot use a derive helper attribute through an import\n+            struct Wow;\n         }\n \n         0\n     }]\n }\n \n+// OK, no ambiguity, only the non-helper attribute is in scope.\n+#[empty_helper]\n+struct Z;\n+\n fn main() {\n     let s = S { field: [] };\n }"}, {"sha": "9048830bee24d5f14d932025c1bfe2fffed5d4c6", "filename": "src/test/ui/proc-macro/derive-helper-shadowing.stderr", "status": "modified", "additions": 40, "deletions": 13, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8668c1a19015148821c37255922f9a9b603dd148/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr?ref=8668c1a19015148821c37255922f9a9b603dd148", "patch": "@@ -1,75 +1,102 @@\n+error: cannot use a derive helper attribute through an import\n+  --> $DIR/derive-helper-shadowing.rs:40:15\n+   |\n+LL |             #[renamed]\n+   |               ^^^^^^^\n+   |\n+note: the derive helper attribute imported here\n+  --> $DIR/derive-helper-shadowing.rs:39:17\n+   |\n+LL |             use empty_helper as renamed;\n+   |                 ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cannot find attribute `empty_helper` in this scope\n+  --> $DIR/derive-helper-shadowing.rs:36:22\n+   |\n+LL |             #[derive(GenHelperUse)]\n+   |                      ^^^^^^^^^^^^\n+\n+error: cannot find attribute `empty_helper` in this scope\n+  --> $DIR/derive-helper-shadowing.rs:14:11\n+   |\n+LL |         #[empty_helper]\n+   |           ^^^^^^^^^^^^\n+...\n+LL |             gen_helper_use!();\n+   |             ------------------ in this macro invocation\n+\n error[E0659]: `empty_helper` is ambiguous (name vs any other name during import resolution)\n-  --> $DIR/derive-helper-shadowing.rs:14:13\n+  --> $DIR/derive-helper-shadowing.rs:24:13\n    |\n LL |         use empty_helper;\n    |             ^^^^^^^^^^^^ ambiguous name\n    |\n note: `empty_helper` could refer to the derive helper attribute defined here\n-  --> $DIR/derive-helper-shadowing.rs:10:10\n+  --> $DIR/derive-helper-shadowing.rs:20:10\n    |\n LL | #[derive(Empty)]\n    |          ^^^^^\n note: `empty_helper` could also refer to the attribute macro imported here\n-  --> $DIR/derive-helper-shadowing.rs:7:5\n+  --> $DIR/derive-helper-shadowing.rs:10:5\n    |\n LL | use test_macros::empty_attr as empty_helper;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `crate::empty_helper` to refer to this attribute macro unambiguously\n \n error[E0659]: `empty_helper` is ambiguous (derive helper attribute vs any other name)\n-  --> $DIR/derive-helper-shadowing.rs:9:3\n+  --> $DIR/derive-helper-shadowing.rs:19:3\n    |\n LL | #[empty_helper]\n    |   ^^^^^^^^^^^^ ambiguous name\n    |\n note: `empty_helper` could refer to the derive helper attribute defined here\n-  --> $DIR/derive-helper-shadowing.rs:10:10\n+  --> $DIR/derive-helper-shadowing.rs:20:10\n    |\n LL | #[derive(Empty)]\n    |          ^^^^^\n note: `empty_helper` could also refer to the attribute macro imported here\n-  --> $DIR/derive-helper-shadowing.rs:7:5\n+  --> $DIR/derive-helper-shadowing.rs:10:5\n    |\n LL | use test_macros::empty_attr as empty_helper;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `crate::empty_helper` to refer to this attribute macro unambiguously\n \n error[E0659]: `empty_helper` is ambiguous (derive helper attribute vs any other name)\n-  --> $DIR/derive-helper-shadowing.rs:12:7\n+  --> $DIR/derive-helper-shadowing.rs:22:7\n    |\n LL |     #[empty_helper]\n    |       ^^^^^^^^^^^^ ambiguous name\n    |\n note: `empty_helper` could refer to the derive helper attribute defined here\n-  --> $DIR/derive-helper-shadowing.rs:10:10\n+  --> $DIR/derive-helper-shadowing.rs:20:10\n    |\n LL | #[derive(Empty)]\n    |          ^^^^^\n note: `empty_helper` could also refer to the attribute macro imported here\n-  --> $DIR/derive-helper-shadowing.rs:7:5\n+  --> $DIR/derive-helper-shadowing.rs:10:5\n    |\n LL | use test_macros::empty_attr as empty_helper;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `crate::empty_helper` to refer to this attribute macro unambiguously\n \n error[E0659]: `empty_helper` is ambiguous (derive helper attribute vs any other name)\n-  --> $DIR/derive-helper-shadowing.rs:16:11\n+  --> $DIR/derive-helper-shadowing.rs:26:11\n    |\n LL |         #[empty_helper]\n    |           ^^^^^^^^^^^^ ambiguous name\n    |\n note: `empty_helper` could refer to the derive helper attribute defined here\n-  --> $DIR/derive-helper-shadowing.rs:10:10\n+  --> $DIR/derive-helper-shadowing.rs:20:10\n    |\n LL | #[derive(Empty)]\n    |          ^^^^^\n note: `empty_helper` could also refer to the attribute macro imported here\n-  --> $DIR/derive-helper-shadowing.rs:7:5\n+  --> $DIR/derive-helper-shadowing.rs:10:5\n    |\n LL | use test_macros::empty_attr as empty_helper;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `crate::empty_helper` to refer to this attribute macro unambiguously\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 7 previous errors\n \n For more information about this error, try `rustc --explain E0659`."}]}