{"sha": "27d2bd13c357bed328735da8605fce1416acc060", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3ZDJiZDEzYzM1N2JlZDMyODczNWRhODYwNWZjZTE0MTZhY2MwNjA=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2015-05-15T08:44:26Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2015-05-19T14:42:15Z"}, "message": "Make float -> int casts actually work", "tree": {"sha": "7dd6a9f596bf06262b3c49a8584c2cb02c8e7356", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7dd6a9f596bf06262b3c49a8584c2cb02c8e7356"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27d2bd13c357bed328735da8605fce1416acc060", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27d2bd13c357bed328735da8605fce1416acc060", "html_url": "https://github.com/rust-lang/rust/commit/27d2bd13c357bed328735da8605fce1416acc060", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27d2bd13c357bed328735da8605fce1416acc060/comments", "author": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32fe2e3ad452128d17ab1ce15f2c77b8cb42a3ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/32fe2e3ad452128d17ab1ce15f2c77b8cb42a3ea", "html_url": "https://github.com/rust-lang/rust/commit/32fe2e3ad452128d17ab1ce15f2c77b8cb42a3ea"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "5ca14b63bce09ad731e6588f3f8ba664df4d429f", "filename": "src/librustc_trans/trans/consts.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/27d2bd13c357bed328735da8605fce1416acc060/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27d2bd13c357bed328735da8605fce1416acc060/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs?ref=27d2bd13c357bed328735da8605fce1416acc060", "patch": "@@ -660,9 +660,11 @@ fn const_expr_unadjusted<'a, 'tcx>(cx: &CrateContext<'a, 'tcx>,\n               (CastTy::Float, CastTy::Float) => {\n                 llvm::LLVMConstFPCast(v, llty.to_ref())\n               }\n+              (CastTy::Float, CastTy::Int(IntTy::I)) => {\n+                llvm::LLVMConstFPToSI(v, llty.to_ref())\n+              }\n               (CastTy::Float, CastTy::Int(_)) => {\n-                if ty::type_is_signed(t_expr) { llvm::LLVMConstFPToSI(v, llty.to_ref()) }\n-                else { llvm::LLVMConstFPToUI(v, llty.to_ref()) }\n+                llvm::LLVMConstFPToUI(v, llty.to_ref())\n               }\n               (CastTy::Ptr(_), CastTy::Ptr(_)) | (CastTy::FnPtr, CastTy::Ptr(_))\n                     | (CastTy::RPtr(_), CastTy::Ptr(_)) => {"}, {"sha": "7c64c34fae5ce2285544a7a25a2d866c6894a429", "filename": "src/test/run-pass/cast-rfc0401.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/27d2bd13c357bed328735da8605fce1416acc060/src%2Ftest%2Frun-pass%2Fcast-rfc0401.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27d2bd13c357bed328735da8605fce1416acc060/src%2Ftest%2Frun-pass%2Fcast-rfc0401.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcast-rfc0401.rs?ref=27d2bd13c357bed328735da8605fce1416acc060", "patch": "@@ -75,7 +75,6 @@ fn main()\n     assert_eq!(9.223372036854775e18f64 as i64, 0x7ffffffffffffc00i64);\n     assert_eq!(-9.223372036854776e18f64 as i64, 0x8000000000000000u64 as i64);\n \n-\n     // addr-ptr-cast/ptr-addr-cast (thin ptr)\n     let p: *const [u8; 1] = lsz as *const [u8; 1];\n     assert_eq!(p as usize, lsz);"}]}