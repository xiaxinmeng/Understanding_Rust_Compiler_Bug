{"sha": "e32da1275300a437490dd2e37ec49d7f11e3d780", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMmRhMTI3NTMwMGE0Mzc0OTBkZDJlMzdlYzQ5ZDdmMTFlM2Q3ODA=", "commit": {"author": {"name": "CensoredUsername", "email": "cens.username@gmail.com", "date": "2016-07-06T12:54:31Z"}, "committer": {"name": "CensoredUsername", "email": "cens.username@gmail.com", "date": "2016-07-06T13:02:49Z"}, "message": "Correct inline assembly clobber formatting.\n\nFixes the formatting for inline assembly clobbers used in the book.\nAs this causes llvm to silently ignore the clobber an error is also\nadded to catch cases in which the wrong formatting was used.\nAdditionally a test case is added to confirm that this error works.", "tree": {"sha": "2fae7f4ab85685381325cfb12d81dceb0549d7ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fae7f4ab85685381325cfb12d81dceb0549d7ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e32da1275300a437490dd2e37ec49d7f11e3d780", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e32da1275300a437490dd2e37ec49d7f11e3d780", "html_url": "https://github.com/rust-lang/rust/commit/e32da1275300a437490dd2e37ec49d7f11e3d780", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e32da1275300a437490dd2e37ec49d7f11e3d780/comments", "author": {"login": "CensoredUsername", "id": 3411575, "node_id": "MDQ6VXNlcjM0MTE1NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3411575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CensoredUsername", "html_url": "https://github.com/CensoredUsername", "followers_url": "https://api.github.com/users/CensoredUsername/followers", "following_url": "https://api.github.com/users/CensoredUsername/following{/other_user}", "gists_url": "https://api.github.com/users/CensoredUsername/gists{/gist_id}", "starred_url": "https://api.github.com/users/CensoredUsername/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CensoredUsername/subscriptions", "organizations_url": "https://api.github.com/users/CensoredUsername/orgs", "repos_url": "https://api.github.com/users/CensoredUsername/repos", "events_url": "https://api.github.com/users/CensoredUsername/events{/privacy}", "received_events_url": "https://api.github.com/users/CensoredUsername/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CensoredUsername", "id": 3411575, "node_id": "MDQ6VXNlcjM0MTE1NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3411575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CensoredUsername", "html_url": "https://github.com/CensoredUsername", "followers_url": "https://api.github.com/users/CensoredUsername/followers", "following_url": "https://api.github.com/users/CensoredUsername/following{/other_user}", "gists_url": "https://api.github.com/users/CensoredUsername/gists{/gist_id}", "starred_url": "https://api.github.com/users/CensoredUsername/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CensoredUsername/subscriptions", "organizations_url": "https://api.github.com/users/CensoredUsername/orgs", "repos_url": "https://api.github.com/users/CensoredUsername/repos", "events_url": "https://api.github.com/users/CensoredUsername/events{/privacy}", "received_events_url": "https://api.github.com/users/CensoredUsername/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47380768e7debc2ee6b66e491733b89534e80988", "url": "https://api.github.com/repos/rust-lang/rust/commits/47380768e7debc2ee6b66e491733b89534e80988", "html_url": "https://github.com/rust-lang/rust/commit/47380768e7debc2ee6b66e491733b89534e80988"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "a8340d9d31e79d2fe319794ef49f90da988b7721", "filename": "src/doc/book/inline-assembly.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Fdoc%2Fbook%2Finline-assembly.md", "raw_url": "https://github.com/rust-lang/rust/raw/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Fdoc%2Fbook%2Finline-assembly.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fbook%2Finline-assembly.md?ref=e32da1275300a437490dd2e37ec49d7f11e3d780", "patch": "@@ -57,7 +57,7 @@ but you must add the right number of `:` if you skip them:\n asm!(\"xor %eax, %eax\"\n     :\n     :\n-    : \"{eax}\"\n+    : \"eax\"\n    );\n # } }\n ```\n@@ -68,7 +68,7 @@ Whitespace also doesn't matter:\n # #![feature(asm)]\n # #[cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))]\n # fn main() { unsafe {\n-asm!(\"xor %eax, %eax\" ::: \"{eax}\");\n+asm!(\"xor %eax, %eax\" ::: \"eax\");\n # } }\n ```\n \n@@ -127,7 +127,7 @@ stay valid.\n # #[cfg(any(target_arch = \"x86\", target_arch = \"x86_64\"))]\n # fn main() { unsafe {\n // Put the value 0x200 in eax\n-asm!(\"mov $$0x200, %eax\" : /* no outputs */ : /* no inputs */ : \"{eax}\");\n+asm!(\"mov $$0x200, %eax\" : /* no outputs */ : /* no inputs */ : \"eax\");\n # } }\n ```\n "}, {"sha": "9cf456062385fcce660b6595b30e20594eaa5e20", "filename": "src/libsyntax_ext/asm.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Flibsyntax_ext%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Flibsyntax_ext%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fasm.rs?ref=e32da1275300a437490dd2e37ec49d7f11e3d780", "patch": "@@ -192,7 +192,10 @@ pub fn expand_asm<'cx>(cx: &'cx mut ExtCtxt, sp: Span, tts: &[tokenstream::Token\n \n                     if OPTIONS.iter().any(|&opt| s == opt) {\n                         cx.span_warn(p.last_span, \"expected a clobber, found an option\");\n+                    } else if s.starts_with(\"{\") || s.ends_with(\"}\") {\n+                        cx.span_err(p.last_span, \"clobber should not be surrounded by braces\");\n                     }\n+\n                     clobs.push(s);\n                 }\n             }"}, {"sha": "714343a372d06477c7c1cbff9cbd658cdcc8d9b5", "filename": "src/test/compile-fail/asm-bad-clobber.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Ftest%2Fcompile-fail%2Fasm-bad-clobber.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e32da1275300a437490dd2e37ec49d7f11e3d780/src%2Ftest%2Fcompile-fail%2Fasm-bad-clobber.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fasm-bad-clobber.rs?ref=e32da1275300a437490dd2e37ec49d7f11e3d780", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// ignore-android\n+// ignore-arm\n+// ignore-aarch64\n+\n+#![feature(asm, rustc_attrs)]\n+\n+#[cfg(any(target_arch = \"x86\",\n+          target_arch = \"x86_64\"))]\n+#[rustc_error]\n+pub fn main() {\n+    unsafe {\n+        // clobber formatted as register input/output\n+        asm!(\"xor %eax, %eax\" : : : \"{eax}\");\n+        //~^ ERROR clobber should not be surrounded by braces\n+    }\n+}"}]}