{"sha": "55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1MTA4YjM3OWViYzFlNWRlNWE3YTQwYWI4ZjNhYmJmZGJiMjBiZTI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-21T17:45:13Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-21T17:45:13Z"}, "message": "Run a full build on `try` temporarily", "tree": {"sha": "b4d005731535472689c33a349c294a3dd8d4f0ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4d005731535472689c33a349c294a3dd8d4f0ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2", "html_url": "https://github.com/rust-lang/rust/commit/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ebdc36eb8e4b0fa8d8954ded3cb282951bab95d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/ebdc36eb8e4b0fa8d8954ded3cb282951bab95d3", "html_url": "https://github.com/rust-lang/rust/commit/ebdc36eb8e4b0fa8d8954ded3cb282951bab95d3"}], "stats": {"total": 296, "additions": 279, "deletions": 17}, "files": [{"sha": "603516370d9f0b9b429f63363d9b14e12edf07b4", "filename": ".azure-pipelines/try.yml", "status": "modified", "additions": 279, "deletions": 17, "changes": 296, "blob_url": "https://github.com/rust-lang/rust/blob/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2/.azure-pipelines%2Ftry.yml", "raw_url": "https://github.com/rust-lang/rust/raw/55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2/.azure-pipelines%2Ftry.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Ftry.yml?ref=55108b379ebc1e5de5a7a40ab8f3abbfdbb20be2", "patch": "@@ -1,38 +1,163 @@\n #\n-# Azure Pipelines \"try\" branch build for Rust\n+# Azure Pipelines \"auto\" branch build for Rust on Linux, macOS, and Windows.\n #\n \n pr: none\n-trigger:\n-- try\n+ trigger:\n+ - auto\n \n variables:\n - group: prod-credentials\n \n jobs:\n - job: Linux\n-  timeoutInMinutes: 600\n   pool:\n     vmImage: ubuntu-16.04\n+  steps:\n+  - template: steps/run.yml\n   strategy:\n     matrix:\n+      x86_64-gnu-llvm-6.0:\n+        IMAGE: x86_64-gnu-llvm-6.0\n+        RUST_BACKTRACE: 1\n+\n       dist-x86_64-linux:\n         IMAGE: dist-x86_64-linux\n         DEPLOY: 1\n       dist-x86_64-linux-alt:\n         IMAGE: dist-x86_64-linux\n         DEPLOY_ALT: 1\n-      test-various:\n-        IMAGE: test-various\n-  steps:\n-  - template: steps/run.yml\n+\n+     arm-android:\n+       IMAGE: arm-android\n+\n+     armhf-gnu:\n+       IMAGE: armhf-gnu\n+\n+     dist-various-1:\n+       IMAGE: dist-various-1\n+       DEPLOY: 1\n+\n+     dist-various-2:\n+       IMAGE: dist-various-2\n+       DEPLOY: 1\n+\n+     dist-aarch64-linux:\n+       IMAGE: dist-aarch64-linux\n+       DEPLOY: 1\n+\n+     dist-android:\n+       IMAGE: dist-android\n+       DEPLOY: 1\n+\n+     dist-arm-linux:\n+       IMAGE: dist-arm-linux\n+       DEPLOY: 1\n+\n+     dist-armhf-linux:\n+       IMAGE: dist-armhf-linux\n+       DEPLOY: 1\n+\n+     dist-armv7-linux:\n+       IMAGE: dist-armv7-linux\n+       DEPLOY: 1\n+\n+     dist-i586-gnu-i586-i686-musl:\n+       IMAGE: dist-i586-gnu-i586-i686-musl\n+       DEPLOY: 1\n+\n+     dist-i686-freebsd:\n+       IMAGE: dist-i686-freebsd\n+       DEPLOY: 1\n+\n+     dist-i686-linux:\n+       IMAGE: dist-i686-linux\n+       DEPLOY: 1\n+\n+     dist-mips-linux:\n+       IMAGE: dist-mips-linux\n+       DEPLOY: 1\n+\n+     dist-mips64-linux:\n+       IMAGE: dist-mips64-linux\n+       DEPLOY: 1\n+\n+     dist-mips64el-linux:\n+       IMAGE: dist-mips64el-linux\n+       DEPLOY: 1\n+\n+     dist-mipsel-linux:\n+       IMAGE: dist-mipsel-linux\n+       DEPLOY: 1\n+\n+     dist-powerpc-linux:\n+       IMAGE: dist-powerpc-linux\n+       DEPLOY: 1\n+\n+     dist-powerpc64-linux:\n+       IMAGE: dist-powerpc64-linux\n+       DEPLOY: 1\n+\n+     dist-powerpc64le-linux:\n+       IMAGE: dist-powerpc64le-linux\n+       DEPLOY: 1\n+\n+     dist-s390x-linux:\n+       IMAGE: dist-s390x-linux\n+       DEPLOY: 1\n+\n+     dist-x86_64-freebsd:\n+       IMAGE: dist-x86_64-freebsd\n+       DEPLOY: 1\n+\n+     dist-x86_64-musl:\n+       IMAGE: dist-x86_64-musl\n+       DEPLOY: 1\n+\n+     dist-x86_64-netbsd:\n+       IMAGE: dist-x86_64-netbsd\n+       DEPLOY: 1\n+\n+     asmjs:\n+       IMAGE: asmjs\n+     i686-gnu:\n+       IMAGE: i686-gnu\n+     i686-gnu-nopt:\n+       IMAGE: i686-gnu-nopt\n+     test-various:\n+       IMAGE: test-various\n+     x86_64-gnu:\n+       IMAGE: x86_64-gnu\n+     x86_64-gnu-full-bootstrap:\n+       IMAGE: x86_64-gnu-full-bootstrap\n+     x86_64-gnu-aux:\n+       IMAGE: x86_64-gnu-aux\n+     x86_64-gnu-tools:\n+       IMAGE: x86_64-gnu-tools\n+     x86_64-gnu-debug:\n+       IMAGE: x86_64-gnu-debug\n+     x86_64-gnu-nopt:\n+       IMAGE: x86_64-gnu-nopt\n+     x86_64-gnu-distcheck:\n+       IMAGE: x86_64-gnu-distcheck\n+      mingw-check:\n+        IMAGE: mingw-check\n \n - job: macOS\n-  timeoutInMinutes: 600\n   pool:\n     vmImage: macos-10.13\n+  steps:\n+  - checkout: self\n+    fetchDepth: 2\n+  - template: steps/run.yml\n   strategy:\n     matrix:\n+      # OSX builders running tests, these run the full test suite.\n+      # NO_DEBUG_ASSERTIONS=1 to make them go faster, but also do have some\n+      # runners that run `//ignore-debug` tests.\n+      #\n+      # Note that the compiler is compiled to target 10.8 here because the Xcode\n+      # version that we're using, 8.2, cannot compile LLVM for OSX 10.7.\n       x86_64-apple:\n         RUST_CHECK_TARGET: check\n         RUST_CONFIGURE_ARGS: --build=x86_64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc\n@@ -51,32 +176,169 @@ jobs:\n         NO_LLVM_ASSERTIONS: 1\n         NO_DEBUG_ASSERTIONS: 1\n         DIST_REQUIRE_ALL_TOOLS: 1\n-  steps:\n-  - template: steps/run.yml\n+\n+     dist-x86_64-apple-alt:\n+       RUST_CHECK_TARGET: dist\n+       RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --enable-lldb --set rust.jemalloc\n+       DEPLOY_ALT: 1\n+       RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+       MACOSX_DEPLOYMENT_TARGET: 10.7\n+       NO_LLVM_ASSERTIONS: 1\n+       NO_DEBUG_ASSERTIONS: 1\n+\n+     i686-apple:\n+       RUST_CHECK_TARGET: check\n+       RUST_CONFIGURE_ARGS: --build=i686-apple-darwin --set rust.jemalloc\n+       RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+       MACOSX_DEPLOYMENT_TARGET: 10.8\n+       MACOSX_STD_DEPLOYMENT_TARGET: 10.7\n+       NO_LLVM_ASSERTIONS: 1\n+       NO_DEBUG_ASSERTIONS: 1\n+\n+     dist-i686-apple:\n+       RUST_CHECK_TARGET: dist\n+       RUST_CONFIGURE_ARGS: --build=i686-apple-darwin --enable-full-tools --enable-profiler --enable-lldb --set rust.jemalloc\n+       DEPLOY: 1\n+       RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n+       MACOSX_DEPLOYMENT_TARGET: 10.7\n+       NO_LLVM_ASSERTIONS: 1\n+       NO_DEBUG_ASSERTIONS: 1\n+       DIST_REQUIRE_ALL_TOOLS: 1\n+\n+\n \n - job: Windows\n-  timeoutInMinutes: 600\n   pool:\n     vmImage: 'vs2017-win2016'\n+  steps:\n+  - template: steps/run.yml\n   strategy:\n     matrix:\n+     # 32/64 bit MSVC tests\n      x86_64-msvc-1:\n+       MSYS_BITS: 64\n        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n        SCRIPT: make ci-subset-1\n+       # FIXME(#59637)\n        NO_DEBUG_ASSERTIONS: 1\n        NO_LLVM_ASSERTIONS: 1\n      x86_64-msvc-2:\n+       MSYS_BITS: 64\n        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n        SCRIPT: make ci-subset-2\n+     i686-msvc-1:\n+       MSYS_BITS: 32\n+       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n+       SCRIPT: make ci-subset-1\n+     i686-msvc-2:\n+       MSYS_BITS: 32\n+       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n+       SCRIPT: make ci-subset-2\n+     # MSVC aux tests\n+     x86_64-msvc-aux:\n+       MSYS_BITS: 64\n+       RUST_CHECK_TARGET: check-aux EXCLUDE_CARGO=1\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc\n+     x86_64-msvc-cargo:\n+       MSYS_BITS: 64\n+       SCRIPT: python x.py test src/tools/cargotest src/tools/cargo\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc\n+       VCVARS_BAT: vcvars64.bat\n+     # MSVC tools tests\n+     x86_64-msvc-tools:\n+       MSYS_BITS: 64\n+       SCRIPT: src/ci/docker/x86_64-gnu-tools/checktools.sh x.py /tmp/toolstates.json windows\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --save-toolstates=/tmp/toolstates.json --enable-test-miri\n+\n+     # 32/64-bit MinGW builds.\n+     #\n+     # We are using MinGW with posix threads since LLVM does not compile with\n+     # the win32 threads version due to missing support for C++'s std::thread.\n+     #\n+     # Instead of relying on the MinGW version installed on appveryor we download\n+     # and install one ourselves so we won't be surprised by changes to appveyor's\n+     # build image.\n+     #\n+     # Finally, note that the downloads below are all in the `rust-lang-ci` S3\n+     # bucket, but they cleraly didn't originate there! The downloads originally\n+     # came from the mingw-w64 SourceForge download site. Unfortunately\n+     # SourceForge is notoriously flaky, so we mirror it on our own infrastructure.\n+     i686-mingw-1:\n+       MSYS_BITS: 32\n+       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n+       SCRIPT: make ci-subset-1\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n+       MINGW_DIR: mingw32\n+       # FIXME(#59637)\n+       NO_DEBUG_ASSERTIONS: 1\n+       NO_LLVM_ASSERTIONS: 1\n+     i686-mingw-2:\n+       MSYS_BITS: 32\n+       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n+       SCRIPT: make ci-subset-2\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n+       MINGW_DIR: mingw32\n+     x86_64-mingw-1:\n+       MSYS_BITS: 64\n+       SCRIPT: make ci-subset-1\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n+       MINGW_DIR: mingw64\n+       # FIXME(#59637)\n+       NO_DEBUG_ASSERTIONS: 1\n+       NO_LLVM_ASSERTIONS: 1\n+     x86_64-mingw-2:\n+       MSYS_BITS: 64\n+       SCRIPT: make ci-subset-2\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n+       MINGW_DIR: mingw64\n \n-     dist-x86_64-msvc:\n+      # 32/64 bit MSVC and GNU deployment\n+      dist-x86_64-msvc:\n+        RUST_CONFIGURE_ARGS: >\n+          --build=x86_64-pc-windows-msvc\n+          --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n+          --enable-full-tools\n+          --enable-profiler\n+        SCRIPT: python x.py dist\n+        DIST_REQUIRE_ALL_TOOLS: 1\n+        DEPLOY: 1\n+     dist-i686-msvc:\n        RUST_CONFIGURE_ARGS: >\n-         --build=x86_64-pc-windows-msvc\n-         --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n+         --build=i686-pc-windows-msvc\n+         --target=i586-pc-windows-msvc\n          --enable-full-tools\n          --enable-profiler\n        SCRIPT: python x.py dist\n        DIST_REQUIRE_ALL_TOOLS: 1\n        DEPLOY: 1\n-  steps:\n-  - template: steps/run.yml\n+     dist-i686-mingw:\n+       MSYS_BITS: 32\n+       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools\n+       SCRIPT: python x.py dist\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: i686-6.3.0-release-posix-dwarf-rt_v5-rev2.7z\n+       MINGW_DIR: mingw32\n+       DIST_REQUIRE_ALL_TOOLS: 1\n+       DEPLOY: 1\n+     dist-x86_64-mingw:\n+       MSYS_BITS: 64\n+       SCRIPT: python x.py dist\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-full-tools\n+       MINGW_URL: https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror\n+       MINGW_ARCHIVE: x86_64-6.3.0-release-posix-seh-rt_v5-rev2.7z\n+       MINGW_DIR: mingw64\n+       DIST_REQUIRE_ALL_TOOLS: 1\n+       DEPLOY: 1\n+\n+     # \"alternate\" deployment, see .travis.yml for more info\n+     dist-x86_64-msvc-alt:\n+       MSYS_BITS: 64\n+       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended --enable-profiler\n+       SCRIPT: python x.py dist\n+       DEPLOY_ALT: 1"}]}