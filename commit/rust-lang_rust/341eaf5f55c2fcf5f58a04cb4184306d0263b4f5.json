{"sha": "341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0MWVhZjVmNTVjMmZjZjVmNThhMDRjYjQxODQzMDZkMDI2M2I0ZjU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-02-04T12:18:29Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-02-04T12:18:29Z"}, "message": "Add more tests for generator resume arguments", "tree": {"sha": "b2392779d508a05ea551926beb76088e94b29b7f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2392779d508a05ea551926beb76088e94b29b7f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "html_url": "https://github.com/rust-lang/rust/commit/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "392e59500a96be718383e127d38bf74300f521c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/392e59500a96be718383e127d38bf74300f521c0", "html_url": "https://github.com/rust-lang/rust/commit/392e59500a96be718383e127d38bf74300f521c0"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "4a482d3f6df39acfc2f8b7fa2987ba9014f840d8", "filename": "src/test/ui/generator/panic-drops-resume.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fpanic-drops-resume.rs", "raw_url": "https://github.com/rust-lang/rust/raw/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fpanic-drops-resume.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Fpanic-drops-resume.rs?ref=341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "patch": "@@ -0,0 +1,35 @@\n+//! Tests that panics inside a generator will correctly drop the initial resume argument.\n+\n+// run-pass\n+\n+#![feature(generators, generator_trait)]\n+\n+use std::ops::Generator;\n+use std::panic::{catch_unwind, AssertUnwindSafe};\n+use std::pin::Pin;\n+use std::sync::atomic::{AtomicUsize, Ordering};\n+\n+static DROP: AtomicUsize = AtomicUsize::new(0);\n+\n+struct Dropper {}\n+\n+impl Drop for Dropper {\n+    fn drop(&mut self) {\n+        DROP.fetch_add(1, Ordering::SeqCst);\n+    }\n+}\n+\n+fn main() {\n+    let mut gen = |_arg| {\n+        if true {\n+            panic!();\n+        }\n+        yield ();\n+    };\n+    let mut gen = Pin::new(&mut gen);\n+\n+    assert_eq!(DROP.load(Ordering::Acquire), 0);\n+    let res = catch_unwind(AssertUnwindSafe(|| gen.as_mut().resume(Dropper {})));\n+    assert!(res.is_err());\n+    assert_eq!(DROP.load(Ordering::Acquire), 1);\n+}"}, {"sha": "87b1f1a065bc8c3099b34410267256398fb84765", "filename": "src/test/ui/generator/resume-arg-late-bound.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.rs?ref=341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "patch": "@@ -0,0 +1,17 @@\n+//! Tests that we cannot produce a generator that accepts a resume argument\n+//! with any lifetime and then stores it across a `yield`.\n+\n+#![feature(generators, generator_trait)]\n+\n+use std::ops::Generator;\n+\n+fn test(a: impl for<'a> Generator<&'a mut bool>) {}\n+\n+fn main() {\n+    let gen = |arg: &mut bool| {\n+        yield ();\n+        *arg = true;\n+    };\n+    test(gen);\n+    //~^ ERROR type mismatch in function arguments\n+}"}, {"sha": "7719d5123f4663213b110b427869341a905d802a", "filename": "src/test/ui/generator/resume-arg-late-bound.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/341eaf5f55c2fcf5f58a04cb4184306d0263b4f5/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Fresume-arg-late-bound.stderr?ref=341eaf5f55c2fcf5f58a04cb4184306d0263b4f5", "patch": "@@ -0,0 +1,15 @@\n+error[E0631]: type mismatch in function arguments\n+  --> $DIR/resume-arg-late-bound.rs:15:10\n+   |\n+LL | fn test(a: impl for<'a> Generator<&'a mut bool>) {}\n+   |    ----         ------------------------------- required by this bound in `test`\n+...\n+LL |     test(gen);\n+   |          ^^^\n+   |          |\n+   |          expected signature of `for<'a> fn(&'a mut bool) -> _`\n+   |          found signature of `fn(&mut bool) -> _`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0631`."}]}