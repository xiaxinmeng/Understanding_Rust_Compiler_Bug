{"sha": "23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzZWI4YTVjZjIwNTNmNjVkNjI5ZTBlYTZhNjVhYTk1NjBhMmY3MDg=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-09-13T11:08:57Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-09-13T11:08:57Z"}, "message": "error on failed assumptions", "tree": {"sha": "e59c00bd30cf3d293c811fad4e533b78ab8a9ede", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e59c00bd30cf3d293c811fad4e533b78ab8a9ede"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJX195JAAoJEFbW7qD8Z6xGNpYQAKz8SvBAf6whFyVtPUdeG+yB\nuEkjNKWu9tMNJmyYZtEcdRCnlTJ9WsYYiqr8UY+X6DJVt0FJZQq6FiFelSJ6c6H6\nOvv9eJHnoVq7NRDqZYT1UqmQjlaF/pBQioELEjlP429PPU7MAfrah1tkWLii3pY9\nkPTBNdFltVU8pvji0yQj65TkotZVnxmKjrB5vcuO5Sc2ec3BJqtYuFaUQouXtJWe\ntwycZegrJlfjHcD11NTY6lSBPEJb6XMNYEL6XwZPcgJJZqmuc4h+SCW3/nrMCFoH\n7ER/paC/YOenBn0WCIoezbAob9fLpN8ikbYg0fS47f3oO3aWsEA3FGwkiYsYbBHi\n45fUBKeMHbiXBt9fxwQFFf+6TU6xjS3hmUal7m//vkyjp0iYSi/oYvPzkXgLUVUc\naf4WayledlZpSrZE32n6b9JcTT2IzoagijVu6gU5GD+VZNlN/vkyh7e2aXUKJm8H\nQnJGKBc6ptq9HXwQUvWSAsSP487Cd34Qwd+12/k9v04Uby+HwD1PgJC6rmNBOoAW\n4DiqHkBoUi0XbWUGI/0nPtLj3rdndObiOtIrXh4q21DMF68p7mo/KHpWmpzqKWfi\n4Vrflv/l80as/Z4oyYo7n81TzphewZwb8tHuTSomxovKgVYDLSAJ13/CujJ3YOxB\nR/WiTK9gXroVNZCpgveM\n=8oAO\n-----END PGP SIGNATURE-----", "payload": "tree e59c00bd30cf3d293c811fad4e533b78ab8a9ede\nparent c57233abca7c2f89ea656bfc05e80d745b07369b\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1473764937 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1473764937 +0200\n\nerror on failed assumptions"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "html_url": "https://github.com/rust-lang/rust/commit/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c57233abca7c2f89ea656bfc05e80d745b07369b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c57233abca7c2f89ea656bfc05e80d745b07369b", "html_url": "https://github.com/rust-lang/rust/commit/c57233abca7c2f89ea656bfc05e80d745b07369b"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "5624734e888abd7befc99a65f333ae34d78419d9", "filename": "src/error.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/src%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/src%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ferror.rs?ref=23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "patch": "@@ -43,6 +43,7 @@ pub enum EvalError<'tcx> {\n     CalledClosureAsFunction,\n     VtableForArgumentlessMethod,\n     ModifiedConstantMemory,\n+    AssumptionNotHeld,\n }\n \n pub type EvalResult<'tcx, T> = Result<T, EvalError<'tcx>>;\n@@ -97,6 +98,8 @@ impl<'tcx> Error for EvalError<'tcx> {\n                 \"tried to call a vtable function without arguments\",\n             EvalError::ModifiedConstantMemory =>\n                 \"tried to modify constant memory\",\n+            EvalError::AssumptionNotHeld =>\n+                \"`assume` argument was false\"\n         }\n     }\n "}, {"sha": "23396e0694e1ba1d76114d998917edbad6fae9ea", "filename": "src/interpreter/terminator.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/src%2Finterpreter%2Fterminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/src%2Finterpreter%2Fterminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Finterpreter%2Fterminator.rs?ref=23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "patch": "@@ -284,8 +284,11 @@ impl<'a, 'tcx> EvalContext<'a, 'tcx> {\n             \"sub_with_overflow\" => self.intrinsic_with_overflow(mir::BinOp::Sub, &args[0], &args[1], dest, dest_layout)?,\n             \"mul_with_overflow\" => self.intrinsic_with_overflow(mir::BinOp::Mul, &args[0], &args[1], dest, dest_layout)?,\n \n-            // FIXME: turn into an assertion to catch wrong `assume` that would cause UB in llvm\n-            \"assume\" => {}\n+            \"assume\" => {\n+                if !self.memory.read_bool(args_ptrs[0])? {\n+                    return Err(EvalError::AssumptionNotHeld);\n+                }\n+            }\n \n             \"copy_nonoverlapping\" => {\n                 let elem_ty = substs.type_at(0);"}, {"sha": "69758a5d7fe8ceb8082ab9fbd5e9d7f9606f31e9", "filename": "tests/compile-fail/assume.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/tests%2Fcompile-fail%2Fassume.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23eb8a5cf2053f65d629e0ea6a65aa9560a2f708/tests%2Fcompile-fail%2Fassume.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fassume.rs?ref=23eb8a5cf2053f65d629e0ea6a65aa9560a2f708", "patch": "@@ -0,0 +1,10 @@\n+#![feature(core_intrinsics)]\n+\n+fn main() {\n+    let x = 5;\n+    unsafe {\n+        std::intrinsics::assume(x < 10);\n+        std::intrinsics::assume(x > 1);\n+        std::intrinsics::assume(x > 42); //~ ERROR: `assume` argument was false\n+    }\n+}"}]}