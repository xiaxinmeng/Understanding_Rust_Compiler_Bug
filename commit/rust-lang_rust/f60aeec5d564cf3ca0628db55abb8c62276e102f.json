{"sha": "f60aeec5d564cf3ca0628db55abb8c62276e102f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2MGFlZWM1ZDU2NGNmM2NhMDYyOGRiNTVhYmI4YzYyMjc2ZTEwMmY=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-02-18T21:37:52Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-02-19T01:57:06Z"}, "message": "Include shortcut links in markdown_links", "tree": {"sha": "4dce6a8f936d17c6c11dc010c4a54f4a0d1530d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4dce6a8f936d17c6c11dc010c4a54f4a0d1530d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f60aeec5d564cf3ca0628db55abb8c62276e102f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f60aeec5d564cf3ca0628db55abb8c62276e102f", "html_url": "https://github.com/rust-lang/rust/commit/f60aeec5d564cf3ca0628db55abb8c62276e102f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f60aeec5d564cf3ca0628db55abb8c62276e102f/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6818551c6f3a434752d0322fce03d594513b5ebd", "url": "https://api.github.com/repos/rust-lang/rust/commits/6818551c6f3a434752d0322fce03d594513b5ebd", "html_url": "https://github.com/rust-lang/rust/commit/6818551c6f3a434752d0322fce03d594513b5ebd"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "bc7d1066ba45ece0d448b87b82e70e5a658d30e1", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f60aeec5d564cf3ca0628db55abb8c62276e102f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f60aeec5d564cf3ca0628db55abb8c62276e102f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=f60aeec5d564cf3ca0628db55abb8c62276e102f", "patch": "@@ -731,18 +731,30 @@ pub fn markdown_links(md: &str) -> Vec<String> {\n     opts.insert(OPTION_ENABLE_TABLES);\n     opts.insert(OPTION_ENABLE_FOOTNOTES);\n \n-    let p = Parser::new_ext(md, opts);\n-\n-    let iter = Footnotes::new(HeadingLinks::new(p, None));\n     let mut links = vec![];\n+    let shortcut_links = RefCell::new(vec![]);\n+\n+    {\n+        let push = |_: &str, s: &str| {\n+            shortcut_links.borrow_mut().push(s.to_owned());\n+            None\n+        };\n+        let p = Parser::new_with_broken_link_callback(md, opts,\n+            Some(&push));\n \n-    for ev in iter {\n-        if let Event::Start(Tag::Link(dest, _)) = ev {\n-            debug!(\"found link: {}\", dest);\n-            links.push(dest.into_owned());\n+        let iter = Footnotes::new(HeadingLinks::new(p, None));\n+\n+        for ev in iter {\n+            if let Event::Start(Tag::Link(dest, _)) = ev {\n+                debug!(\"found link: {}\", dest);\n+                links.push(dest.into_owned());\n+            }\n         }\n     }\n \n+    let mut shortcut_links = shortcut_links.into_inner();\n+    links.extend(shortcut_links.drain(..));\n+\n     links\n }\n "}]}