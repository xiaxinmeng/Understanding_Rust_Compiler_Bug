{"sha": "c75a93023a77dc9c468519e79a1206e5b56b33b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3NWE5MzAyM2E3N2RjOWM0Njg1MTllNzlhMTIwNmU1YjU2YjMzYjk=", "commit": {"author": {"name": "Anton Golov", "email": "jesyspa@gmail.com", "date": "2021-08-20T14:26:24Z"}, "committer": {"name": "Anton Golov", "email": "jesyspa@gmail.com", "date": "2021-08-20T14:26:24Z"}, "message": "Update old box expression tests and add a new one.\n\nNew tests also check that we're not triggering this error\nover-zealously.", "tree": {"sha": "d5e73dca4a8132e01e186a7b63e4563dcd7b1fba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d5e73dca4a8132e01e186a7b63e4563dcd7b1fba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c75a93023a77dc9c468519e79a1206e5b56b33b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c75a93023a77dc9c468519e79a1206e5b56b33b9", "html_url": "https://github.com/rust-lang/rust/commit/c75a93023a77dc9c468519e79a1206e5b56b33b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c75a93023a77dc9c468519e79a1206e5b56b33b9/comments", "author": {"login": "jesyspa", "id": 543293, "node_id": "MDQ6VXNlcjU0MzI5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/543293?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesyspa", "html_url": "https://github.com/jesyspa", "followers_url": "https://api.github.com/users/jesyspa/followers", "following_url": "https://api.github.com/users/jesyspa/following{/other_user}", "gists_url": "https://api.github.com/users/jesyspa/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesyspa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesyspa/subscriptions", "organizations_url": "https://api.github.com/users/jesyspa/orgs", "repos_url": "https://api.github.com/users/jesyspa/repos", "events_url": "https://api.github.com/users/jesyspa/events{/privacy}", "received_events_url": "https://api.github.com/users/jesyspa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jesyspa", "id": 543293, "node_id": "MDQ6VXNlcjU0MzI5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/543293?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesyspa", "html_url": "https://github.com/jesyspa", "followers_url": "https://api.github.com/users/jesyspa/followers", "following_url": "https://api.github.com/users/jesyspa/following{/other_user}", "gists_url": "https://api.github.com/users/jesyspa/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesyspa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesyspa/subscriptions", "organizations_url": "https://api.github.com/users/jesyspa/orgs", "repos_url": "https://api.github.com/users/jesyspa/repos", "events_url": "https://api.github.com/users/jesyspa/events{/privacy}", "received_events_url": "https://api.github.com/users/jesyspa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8fff9596158911ad37b60ee89ea2e2c326e1ce6", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8fff9596158911ad37b60ee89ea2e2c326e1ce6", "html_url": "https://github.com/rust-lang/rust/commit/b8fff9596158911ad37b60ee89ea2e2c326e1ce6"}], "stats": {"total": 62, "additions": 36, "deletions": 26}, "files": [{"sha": "b52a95a701f540fe10fd63894420f7350b4367dd", "filename": "src/test/ui/dst/dst-rvalue.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.rs?ref=c75a93023a77dc9c468519e79a1206e5b56b33b9", "patch": "@@ -4,11 +4,9 @@\n \n pub fn main() {\n     let _x: Box<str> = box *\"hello world\";\n-    //~^ ERROR E0161\n-    //~^^ ERROR cannot move out of a shared reference\n+    //~^ ERROR E0277\n \n     let array: &[isize] = &[1, 2, 3];\n     let _x: Box<[isize]> = box *array;\n-    //~^ ERROR E0161\n-    //~^^ ERROR cannot move out of type `[isize]`, a non-copy slice\n+    //~^ ERROR E0277\n }"}, {"sha": "15830636b51fe1e5c6f22a32345384dfd51000ed", "filename": "src/test/ui/dst/dst-rvalue.stderr", "status": "modified", "additions": 12, "deletions": 22, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdst%2Fdst-rvalue.stderr?ref=c75a93023a77dc9c468519e79a1206e5b56b33b9", "patch": "@@ -1,31 +1,21 @@\n-error[E0161]: cannot move a value of type str: the size of str cannot be statically determined\n+error[E0277]: the size for values of type `str` cannot be known at compilation time\n   --> $DIR/dst-rvalue.rs:6:28\n    |\n LL |     let _x: Box<str> = box *\"hello world\";\n-   |                            ^^^^^^^^^^^^^^\n-\n-error[E0161]: cannot move a value of type [isize]: the size of [isize] cannot be statically determined\n-  --> $DIR/dst-rvalue.rs:11:32\n+   |                            ^^^^^^^^^^^^^^ doesn't have a size known at compile-time\n    |\n-LL |     let _x: Box<[isize]> = box *array;\n-   |                                ^^^^^^\n+   = help: the trait `Sized` is not implemented for `str`\n+   = note: the type of a box expression must have a statically known size\n \n-error[E0507]: cannot move out of a shared reference\n-  --> $DIR/dst-rvalue.rs:6:28\n-   |\n-LL |     let _x: Box<str> = box *\"hello world\";\n-   |                            ^^^^^^^^^^^^^^ move occurs because value has type `str`, which does not implement the `Copy` trait\n-\n-error[E0508]: cannot move out of type `[isize]`, a non-copy slice\n-  --> $DIR/dst-rvalue.rs:11:32\n+error[E0277]: the size for values of type `[isize]` cannot be known at compilation time\n+  --> $DIR/dst-rvalue.rs:10:32\n    |\n LL |     let _x: Box<[isize]> = box *array;\n-   |                                ^^^^^^\n-   |                                |\n-   |                                cannot move out of here\n-   |                                move occurs because `*array` has type `[isize]`, which does not implement the `Copy` trait\n+   |                                ^^^^^^ doesn't have a size known at compile-time\n+   |\n+   = help: the trait `Sized` is not implemented for `[isize]`\n+   = note: the type of a box expression must have a statically known size\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0161, E0507, E0508.\n-For more information about an error, try `rustc --explain E0161`.\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "cd2a82074ed420e237ca98173565f45f8585aaff", "filename": "src/test/ui/typeck/issue-87935-unsized-box-expr.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.rs?ref=c75a93023a77dc9c468519e79a1206e5b56b33b9", "patch": "@@ -0,0 +1,10 @@\n+#![feature(box_syntax)]\n+// Box expression needs to be movable, and hence has to be of a Sized type.\n+fn main() {\n+    let _x: Box<[u32]> = box { loop {} };\n+    //~^ ERROR: the size for values of type `[u32]` cannot be known at compilation time\n+\n+    // Check that a deduced size does not cause issues.\n+    let _y: Box<[u32]> = box [];\n+    let _z: Box<[u32; 0]> = box { loop {} };\n+}"}, {"sha": "9ff822352a1551ea8989a3ad3030e5c4a649c08f", "filename": "src/test/ui/typeck/issue-87935-unsized-box-expr.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c75a93023a77dc9c468519e79a1206e5b56b33b9/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-87935-unsized-box-expr.stderr?ref=c75a93023a77dc9c468519e79a1206e5b56b33b9", "patch": "@@ -0,0 +1,12 @@\n+error[E0277]: the size for values of type `[u32]` cannot be known at compilation time\n+  --> $DIR/issue-87935-unsized-box-expr.rs:4:30\n+   |\n+LL |     let _x: Box<[u32]> = box { loop {} };\n+   |                              ^^^^^^^^^^^ doesn't have a size known at compile-time\n+   |\n+   = help: the trait `Sized` is not implemented for `[u32]`\n+   = note: the type of a box expression must have a statically known size\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}]}