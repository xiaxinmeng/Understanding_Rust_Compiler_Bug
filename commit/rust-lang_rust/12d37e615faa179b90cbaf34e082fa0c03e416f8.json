{"sha": "12d37e615faa179b90cbaf34e082fa0c03e416f8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyZDM3ZTYxNWZhYTE3OWI5MGNiYWYzNGUwODJmYTBjMDNlNDE2Zjg=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2021-06-07T13:01:50Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2021-06-07T16:55:43Z"}, "message": "add the x86_64-gnu-stable job to test with stable channel\n\nDuring the 1.52 release process we had to deal with some commits that\npassed the test suite on the nightly branch but failed on the beta or\nstable branch. In that case it was due to some UI tests including the\nchannel name in the output, but other changes might also be dependent on\nthe channel.\n\nThis commit adds a new CI job that runs the Linux x86_64 test suite with\nthe stable branch, ensuring nightly changes also work as stable.", "tree": {"sha": "4f495a571ce6de53dc730b28f776d266f94573c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f495a571ce6de53dc730b28f776d266f94573c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12d37e615faa179b90cbaf34e082fa0c03e416f8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAmC+T5EACgkQPgar6Auq\n8ZyDkQ/+LLYRxqfBd5TFRAk6CSTtEbk/hRgMiRaVBEb4a6ocNEUwznp+qoezczb9\nDAmpBnkYPz/UV7/Teu2TPofpydbLw6szi7nfiVO+CYo4w0sJOabem+cnm8oDpVQ3\nM5Lof0hv755SPX4R2Hg+pdweCP4F1pINDiPf5eggor/7dMPvBGUvVsCC60sqJjh9\nKWUMY14yHU3q3Gp0KPvH7Aczii69RnoSH4siYj1jB4rUUggsnCdpz4X76MzE1Nfk\nH3VnXubANjFLy7uZr0Z6ax2bsFqUufS62g9IPeo33ZMIm9bQ05zjzcbwE/aAKsxq\nImfWJRLaKDaPQv4wwcdY2xcxCRLUNtvwCsTu+HBAd1JxlnpD76qW5BL/xUqFaCbP\nx7Ca/A/jY9qqzwTnZNyOdh3GHVzWkiJgQGCrwo+uzpwroPzd9tMTK7v431sYhbB0\nmRGJp/459y8WlXgsZ2PNNXzDj9uACDO/fKPQMzjvSeN3VISB9xXcYmJvBeiopsbV\nFOBzI2Urn9seY4uGibENQO1kcW0x2Nfs+JPOPsRAnJR+7OKJ3CcWPNal142EkHuj\n0FHA7RhtNsp32UrkkSHAjD0NCCwlCCmABve2fnYzAAJdt42B9q2BayxgIAiNf+jA\ncdJK1aUCmRlv9gAP6KOsy17j4w9Au9/MSzJhH6hxjQP5uvOPg+E=\n=92Fz\n-----END PGP SIGNATURE-----", "payload": "tree 4f495a571ce6de53dc730b28f776d266f94573c5\nparent b52bf1b41c8480326f3178d22c7d7524baf55361\nauthor Pietro Albini <pietro@pietroalbini.org> 1623070910 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1623084943 +0200\n\nadd the x86_64-gnu-stable job to test with stable channel\n\nDuring the 1.52 release process we had to deal with some commits that\npassed the test suite on the nightly branch but failed on the beta or\nstable branch. In that case it was due to some UI tests including the\nchannel name in the output, but other changes might also be dependent on\nthe channel.\n\nThis commit adds a new CI job that runs the Linux x86_64 test suite with\nthe stable branch, ensuring nightly changes also work as stable.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12d37e615faa179b90cbaf34e082fa0c03e416f8", "html_url": "https://github.com/rust-lang/rust/commit/12d37e615faa179b90cbaf34e082fa0c03e416f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12d37e615faa179b90cbaf34e082fa0c03e416f8/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b52bf1b41c8480326f3178d22c7d7524baf55361", "url": "https://api.github.com/repos/rust-lang/rust/commits/b52bf1b41c8480326f3178d22c7d7524baf55361", "html_url": "https://github.com/rust-lang/rust/commit/b52bf1b41c8480326f3178d22c7d7524baf55361"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "36362635b154552995070c1faaf9a3448ba71f4c", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/12d37e615faa179b90cbaf34e082fa0c03e416f8/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/12d37e615faa179b90cbaf34e082fa0c03e416f8/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=12d37e615faa179b90cbaf34e082fa0c03e416f8", "patch": "@@ -259,6 +259,11 @@ jobs:\n           - name: x86_64-gnu\n             os: ubuntu-latest-xl\n             env: {}\n+          - name: x86_64-gnu-stable\n+            env:\n+              IMAGE: x86_64-gnu\n+              RUST_CI_OVERRIDE_RELEASE_CHANNEL: stable\n+            os: ubuntu-latest-xl\n           - name: x86_64-gnu-aux\n             os: ubuntu-latest-xl\n             env: {}"}, {"sha": "3a47076722c3a8b5ca3a500180e43756258497cb", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=12d37e615faa179b90cbaf34e082fa0c03e416f8", "patch": "@@ -235,6 +235,7 @@ docker \\\n   --env TOOLSTATE_REPO_ACCESS_TOKEN \\\n   --env TOOLSTATE_REPO \\\n   --env TOOLSTATE_PUBLISH \\\n+  --env RUST_CI_OVERRIDE_RELEASE_CHANNEL \\\n   --env CI_JOB_NAME=\"${CI_JOB_NAME-$IMAGE}\" \\\n   --init \\\n   --rm \\"}, {"sha": "e704071e401b77398b291b7334258a9cce8aeb06", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=12d37e615faa179b90cbaf34e082fa0c03e416f8", "patch": "@@ -407,6 +407,17 @@ jobs:\n           - name: x86_64-gnu\n             <<: *job-linux-xl\n \n+          # This job ensures commits landing on nightly still pass the full\n+          # test suite on the stable channel. There are some UI tests that\n+          # depend on the channel being built (for example if they include the\n+          # channel name on the output), and this builder prevents landing\n+          # changes that would result in broken builds after a promotion.\n+          - name: x86_64-gnu-stable\n+            env:\n+              IMAGE: x86_64-gnu\n+              RUST_CI_OVERRIDE_RELEASE_CHANNEL: stable\n+            <<: *job-linux-xl\n+\n           - name: x86_64-gnu-aux\n             <<: *job-linux-xl\n "}, {"sha": "c5e225c7cd17df61bb3e49051c7002a4b6f0383a", "filename": "src/ci/run.sh", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/12d37e615faa179b90cbaf34e082fa0c03e416f8/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=12d37e615faa179b90cbaf34e082fa0c03e416f8", "patch": "@@ -65,7 +65,11 @@ fi\n # Always set the release channel for bootstrap; this is normally not important (i.e., only dist\n # builds would seem to matter) but in practice bootstrap wants to know whether we're targeting\n # master, beta, or stable with a build to determine whether to run some checks (notably toolstate).\n-export RUST_RELEASE_CHANNEL=\"$(cat \"${ci_dir}/channel\")\"\n+if [[ -z \"${RUST_CI_OVERRIDE_RELEASE_CHANNEL+x}\" ]]; then\n+    export RUST_RELEASE_CHANNEL=\"$(cat \"${ci_dir}/channel\")\"\n+else\n+    export RUST_RELEASE_CHANNEL=\"${RUST_CI_OVERRIDE_RELEASE_CHANNEL}\"\n+fi\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n \n if [ \"$DEPLOY$DEPLOY_ALT\" = \"1\" ]; then"}]}