{"sha": "0e475b5d5e712c23547c4aa344a8af55e01e40ee", "node_id": "C_kwDOAAsO6NoAKDBlNDc1YjVkNWU3MTJjMjM1NDdjNGFhMzQ0YThhZjU1ZTAxZTQwZWU", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-06-27T06:29:56Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-06-28T23:20:32Z"}, "message": "Avoid unnecessary work in `finalize_resolutions_in`.\n\nIf `module.opt_def_id()` returns `None`, we can skip most of the work.", "tree": {"sha": "b67135ae57e0a33b7fd097f1b01fa2e75291e976", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b67135ae57e0a33b7fd097f1b01fa2e75291e976"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e475b5d5e712c23547c4aa344a8af55e01e40ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e475b5d5e712c23547c4aa344a8af55e01e40ee", "html_url": "https://github.com/rust-lang/rust/commit/0e475b5d5e712c23547c4aa344a8af55e01e40ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e475b5d5e712c23547c4aa344a8af55e01e40ee/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "788ddedb0d88e40db9cd62b6163d5a471813044b", "url": "https://api.github.com/repos/rust-lang/rust/commits/788ddedb0d88e40db9cd62b6163d5a471813044b", "html_url": "https://github.com/rust-lang/rust/commit/788ddedb0d88e40db9cd62b6163d5a471813044b"}], "stats": {"total": 46, "additions": 23, "deletions": 23}, "files": [{"sha": "e6060ad46650ea9f77a80d0535e812f2196bb5ec", "filename": "compiler/rustc_resolve/src/imports.rs", "status": "modified", "additions": 23, "deletions": 23, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/0e475b5d5e712c23547c4aa344a8af55e01e40ee/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e475b5d5e712c23547c4aa344a8af55e01e40ee/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs?ref=0e475b5d5e712c23547c4aa344a8af55e01e40ee", "patch": "@@ -1090,31 +1090,31 @@ impl<'a, 'b> ImportResolver<'a, 'b> {\n         // Since import resolution is finished, globs will not define any more names.\n         *module.globs.borrow_mut() = Vec::new();\n \n-        let mut reexports = Vec::new();\n-\n-        module.for_each_child(self.r, |_, ident, _, binding| {\n-            // FIXME: Consider changing the binding inserted by `#[macro_export] macro_rules`\n-            // into the crate root to actual `NameBindingKind::Import`.\n-            if binding.is_import()\n-                || matches!(binding.kind, NameBindingKind::Res(_, _is_macro_export @ true))\n-            {\n-                let res = binding.res().expect_non_local();\n-                // Ambiguous imports are treated as errors at this point and are\n-                // not exposed to other crates (see #36837 for more details).\n-                if res != def::Res::Err && !binding.is_ambiguity() {\n-                    reexports.push(ModChild {\n-                        ident,\n-                        res,\n-                        vis: binding.vis,\n-                        span: binding.span,\n-                        macro_rules: false,\n-                    });\n+        if let Some(def_id) = module.opt_def_id() {\n+            let mut reexports = Vec::new();\n+\n+            module.for_each_child(self.r, |_, ident, _, binding| {\n+                // FIXME: Consider changing the binding inserted by `#[macro_export] macro_rules`\n+                // into the crate root to actual `NameBindingKind::Import`.\n+                if binding.is_import()\n+                    || matches!(binding.kind, NameBindingKind::Res(_, _is_macro_export @ true))\n+                {\n+                    let res = binding.res().expect_non_local();\n+                    // Ambiguous imports are treated as errors at this point and are\n+                    // not exposed to other crates (see #36837 for more details).\n+                    if res != def::Res::Err && !binding.is_ambiguity() {\n+                        reexports.push(ModChild {\n+                            ident,\n+                            res,\n+                            vis: binding.vis,\n+                            span: binding.span,\n+                            macro_rules: false,\n+                        });\n+                    }\n                 }\n-            }\n-        });\n+            });\n \n-        if !reexports.is_empty() {\n-            if let Some(def_id) = module.opt_def_id() {\n+            if !reexports.is_empty() {\n                 // Call to `expect_local` should be fine because current\n                 // code is only called for local modules.\n                 self.r.reexport_map.insert(def_id.expect_local(), reexports);"}]}