{"sha": "29e89136957b9eedf54255c8059f8a51fbd82a68", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5ZTg5MTM2OTU3YjllZWRmNTQyNTVjODA1OWY4YTUxZmJkODJhNjg=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-01-16T23:01:10Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-01-16T23:01:10Z"}, "message": "Fix bug in identifying comments\n\nFixes 1233", "tree": {"sha": "e9233fced2b6b083d4de9779434c83899450708b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9233fced2b6b083d4de9779434c83899450708b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29e89136957b9eedf54255c8059f8a51fbd82a68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29e89136957b9eedf54255c8059f8a51fbd82a68", "html_url": "https://github.com/rust-lang/rust/commit/29e89136957b9eedf54255c8059f8a51fbd82a68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29e89136957b9eedf54255c8059f8a51fbd82a68/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0218a41d73f3fa0be4f2952c4a903f91072823c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/0218a41d73f3fa0be4f2952c4a903f91072823c4", "html_url": "https://github.com/rust-lang/rust/commit/0218a41d73f3fa0be4f2952c4a903f91072823c4"}], "stats": {"total": 34, "additions": 21, "deletions": 13}, "files": [{"sha": "2fc6b8b86d25a9759e28676af514fce3d74dd048", "filename": "src/expr.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -359,9 +359,9 @@ pub fn rewrite_array<'a, I>(expr_iter: I,\n     where I: Iterator<Item = &'a ast::Expr>\n {\n     let bracket_size = if context.config.spaces_within_square_brackets {\n-        2  // \"[ \"\n+        2 // \"[ \"\n     } else {\n-        1  // \"[\"\n+        1 // \"[\"\n     };\n     let offset = offset + bracket_size;\n     let inner_context = &RewriteContext { block_indent: offset, ..*context };"}, {"sha": "d9c2a7714144099538ef1c54d12b5254c6e97edf", "filename": "src/missed_spans.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/src%2Fmissed_spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/src%2Fmissed_spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmissed_spans.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -123,16 +123,20 @@ impl<'a> FmtVisitor<'a> {\n \n                 let fix_indent = last_char.map_or(true, |rev_c| ['{', '\\n'].contains(&rev_c));\n \n-                if rewrite_next_comment && fix_indent {\n-                    if let Some('{') = last_char {\n-                        self.buffer.push_str(\"\\n\");\n+                if rewrite_next_comment {\n+                    if fix_indent {\n+                        if let Some('{') = last_char {\n+                            self.buffer.push_str(\"\\n\");\n+                        }\n+                        self.buffer.push_str(&self.block_indent.to_string(self.config));\n+                    } else {\n+                        self.buffer.push_str(\" \");\n                     }\n \n                     let comment_width = ::std::cmp::min(self.config.ideal_width,\n                                                         self.config.max_width -\n                                                         self.block_indent.width());\n \n-                    self.buffer.push_str(&self.block_indent.to_string(self.config));\n                     self.buffer.push_str(&rewrite_comment(subslice,\n                                                           false,\n                                                           comment_width,"}, {"sha": "bce05ff7a2a6f2ca8867d4970b9a1b8d579ba694", "filename": "tests/source/comment.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Fsource%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Fsource%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fcomment.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -9,6 +9,7 @@ fn test() {\n // comment\n         // comment2\n \n+    // FIXME(1275)\n     code(); /* leave this comment alone!\n              * ok? */\n "}, {"sha": "6d8da3e5445a341186b080e5d6f9511fd9e5a024", "filename": "tests/source/comment4.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Fsource%2Fcomment4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Fsource%2Fcomment4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fcomment4.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -3,6 +3,7 @@ fn test() {\n // comment\n         // comment2\n \n+    // FIXME(1275)\n     code(); /* leave this comment alone!\n              * ok? */\n "}, {"sha": "9de4366b1c495c0e3f679dda633e9a044038d02d", "filename": "tests/target/comment.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fcomment.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -9,8 +9,9 @@ fn test() {\n     // comment\n     // comment2\n \n-    code(); /* leave this comment alone!\n-             * ok? */\n+    // FIXME(1275)\n+    code(); // leave this comment alone!\n+    // ok?\n \n     // Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec a\n     // diam lectus. Sed sit amet ipsum mauris. Maecenas congue ligula ac quam\n@@ -31,8 +32,8 @@ fn test() {\n     //                                       self.config)\n     //                           .unwrap());\n \n-    funk(); //dontchangeme\n-            // or me\n+    funk(); // dontchangeme\n+    // or me\n }\n \n /// test123"}, {"sha": "fd91b5462f5a0a73553ae217ea823ec5025d3037", "filename": "tests/target/comment4.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fcomment4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fcomment4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fcomment4.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -3,8 +3,9 @@ fn test() {\n     // comment\n     // comment2\n \n+    // FIXME(1275)\n     code(); /* leave this comment alone!\n-             * ok? */\n+     * ok? */\n \n     /* Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec a\n      * diam lectus. Sed sit amet ipsum mauris. Maecenas congue ligula ac quam\n@@ -25,7 +26,7 @@ fn test() {\n     //                           .unwrap());\n \n     funk(); //dontchangeme\n-            // or me\n+    // or me\n }\n \n /// test123"}, {"sha": "84f3cf89ba4750c6d2b5905c18ae380d70f92a61", "filename": "tests/target/multiple.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fmultiple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29e89136957b9eedf54255c8059f8a51fbd82a68/tests%2Ftarget%2Fmultiple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fmultiple.rs?ref=29e89136957b9eedf54255c8059f8a51fbd82a68", "patch": "@@ -133,7 +133,7 @@ fn main() {\n                        Cell::new(42usize,\n                                  remaining_widthremaining_widthremaining_widthremaining_width),\n                        42usize);\n-    let rc = RefCell::new(42usize, remaining_width, remaining_width);  // a comment\n+    let rc = RefCell::new(42usize, remaining_width, remaining_width); // a comment\n     let x = \"Hello!!!!!!!!! abcd  abcd abcd abcd abcd abcd\\n abcd abcd abcd abcd abcd abcd abcd \\\n              abcd abcd abcd  abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd \\\n              abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd abcd \\"}]}