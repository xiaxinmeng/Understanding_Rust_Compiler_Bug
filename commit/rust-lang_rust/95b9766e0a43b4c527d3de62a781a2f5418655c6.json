{"sha": "95b9766e0a43b4c527d3de62a781a2f5418655c6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1Yjk3NjZlMGE0M2I0YzUyN2QzZGU2MmE3ODFhMmY1NDE4NjU1YzY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-11-19T12:10:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-11-19T12:10:15Z"}, "message": "Rollup merge of #66430 - dns2utf8:fix_code_selection_click_handler, r=GuillaumeGomez\n\n[doc] Fix the source code highlighting on source comments\n\nThe code would always forget the previous selection.\n\nr? @GuillaumeGomez", "tree": {"sha": "06edefda952b84bd9bc5826c0ddbbe474dd00e83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06edefda952b84bd9bc5826c0ddbbe474dd00e83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95b9766e0a43b4c527d3de62a781a2f5418655c6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd09uoCRBK7hj4Ov3rIwAAdHIIAIUDE4F6cDuLrIO4SUGe/3Ty\nTCCw5nubiuqIo077F85kL91qfOKjTfNMrMS5uGwNAuGDuMt0Ujf9UMkdjSya9/EZ\nJOLcLz2JhXTBlIoue5QUPPQ8vQqwZZnjMNdr/qNcVwjAE0bPdiQmjWkBbd5Pivka\nzdqXUrW+x3zZprp6CO7laSDK9XkYYyGqBmvcUFo0xSzHNs6lBML3hzjIms398F9j\nq7wfby/duZhiCNXFdggGrrSiRxLHgJkkLEmlCpB+eFL6pm6x9srbzXJOTRzrPeNq\nEtUtpVre/qf5io10CJ6rLRldA7bdy0n9R/buFdwTeIv7B8NZJjKKtE9grPVCdUE=\n=BUB5\n-----END PGP SIGNATURE-----\n", "payload": "tree 06edefda952b84bd9bc5826c0ddbbe474dd00e83\nparent 0b0d683805d008cd81f1c790f528bec9c48021fd\nparent 1bbb8168ec5aa2d03e1b49d5a38eda0300c67da4\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1574165415 +0100\ncommitter GitHub <noreply@github.com> 1574165415 +0100\n\nRollup merge of #66430 - dns2utf8:fix_code_selection_click_handler, r=GuillaumeGomez\n\n[doc] Fix the source code highlighting on source comments\n\nThe code would always forget the previous selection.\n\nr? @GuillaumeGomez\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95b9766e0a43b4c527d3de62a781a2f5418655c6", "html_url": "https://github.com/rust-lang/rust/commit/95b9766e0a43b4c527d3de62a781a2f5418655c6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95b9766e0a43b4c527d3de62a781a2f5418655c6/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b0d683805d008cd81f1c790f528bec9c48021fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b0d683805d008cd81f1c790f528bec9c48021fd", "html_url": "https://github.com/rust-lang/rust/commit/0b0d683805d008cd81f1c790f528bec9c48021fd"}, {"sha": "1bbb8168ec5aa2d03e1b49d5a38eda0300c67da4", "url": "https://api.github.com/repos/rust-lang/rust/commits/1bbb8168ec5aa2d03e1b49d5a38eda0300c67da4", "html_url": "https://github.com/rust-lang/rust/commit/1bbb8168ec5aa2d03e1b49d5a38eda0300c67da4"}], "stats": {"total": 61, "additions": 37, "deletions": 24}, "files": [{"sha": "197efb7cac80d02f0fefcb17e7f71dc06fdd17dc", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 37, "deletions": 24, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/95b9766e0a43b4c527d3de62a781a2f5418655c6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/95b9766e0a43b4c527d3de62a781a2f5418655c6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=95b9766e0a43b4c527d3de62a781a2f5418655c6", "patch": "@@ -396,38 +396,51 @@ function getSearchElement() {\n \n     document.onkeypress = handleShortcut;\n     document.onkeydown = handleShortcut;\n-    document.onclick = function(ev) {\n-        if (hasClass(ev.target, \"collapse-toggle\")) {\n-            collapseDocs(ev.target, \"toggle\");\n-        } else if (hasClass(ev.target.parentNode, \"collapse-toggle\")) {\n-            collapseDocs(ev.target.parentNode, \"toggle\");\n-        } else if (ev.target.tagName === \"SPAN\" && hasClass(ev.target.parentNode, \"line-numbers\")) {\n-            var prev_id = 0;\n \n-            var set_fragment = function(name) {\n-                if (browserSupportsHistoryApi()) {\n-                    history.replaceState(null, null, \"#\" + name);\n-                    highlightSourceLines();\n-                } else {\n-                    location.replace(\"#\" + name);\n-                }\n-            };\n+    var handleSourceHighlight = (function() {\n+        var prev_line_id = 0;\n \n-            var cur_id = parseInt(ev.target.id, 10);\n+        var set_fragment = function(name) {\n+            var x = window.scrollX,\n+                y = window.scrollY;\n+            if (browserSupportsHistoryApi()) {\n+                history.replaceState(null, null, \"#\" + name);\n+                highlightSourceLines();\n+            } else {\n+                location.replace(\"#\" + name);\n+            }\n+            // Prevent jumps when selecting one or many lines\n+            window.scrollTo(x, y);\n+        };\n+\n+        return function(ev) {\n+            var cur_line_id = parseInt(ev.target.id, 10);\n+            ev.preventDefault();\n \n-            if (ev.shiftKey && prev_id) {\n-                if (prev_id > cur_id) {\n-                    var tmp = prev_id;\n-                    prev_id = cur_id;\n-                    cur_id = tmp;\n+            if (ev.shiftKey && prev_line_id) {\n+                // Swap selection if needed\n+                if (prev_line_id > cur_line_id) {\n+                    var tmp = prev_line_id;\n+                    prev_line_id = cur_line_id;\n+                    cur_line_id = tmp;\n                 }\n \n-                set_fragment(prev_id + \"-\" + cur_id);\n+                set_fragment(prev_line_id + \"-\" + cur_line_id);\n             } else {\n-                prev_id = cur_id;\n+                prev_line_id = cur_line_id;\n \n-                set_fragment(cur_id);\n+                set_fragment(cur_line_id);\n             }\n+        }\n+    })();\n+\n+    document.onclick = function(ev) {\n+        if (hasClass(ev.target, \"collapse-toggle\")) {\n+            collapseDocs(ev.target, \"toggle\");\n+        } else if (hasClass(ev.target.parentNode, \"collapse-toggle\")) {\n+            collapseDocs(ev.target.parentNode, \"toggle\");\n+        } else if (ev.target.tagName === \"SPAN\" && hasClass(ev.target.parentNode, \"line-numbers\")) {\n+            handleSourceHighlight(ev);\n         } else if (hasClass(getHelpElement(), \"hidden\") === false) {\n             var help = getHelpElement();\n             var is_inside_help_popup = ev.target !== help && help.contains(ev.target);"}]}