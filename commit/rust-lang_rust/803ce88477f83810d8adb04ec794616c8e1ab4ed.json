{"sha": "803ce88477f83810d8adb04ec794616c8e1ab4ed", "node_id": "C_kwDOAAsO6NoAKDgwM2NlODg0NzdmODM4MTBkOGFkYjA0ZWM3OTQ2MTZjOGUxYWI0ZWQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-21T20:47:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-21T20:47:30Z"}, "message": "Auto merge of #10380 - Alexendoo:needless-lifetime-macro-expansion, r=xFrednet\n\nIgnore lifetimes from differing contexts in `needless_lifetimes`\n\nFixes #10379\n\nchangelog: [`needless_lifetimes`]: Don't lint signatures in macros if the lifetime is a metavariable", "tree": {"sha": "dde3c5e0a95b4341a6cc5389e60b0a28da52758b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dde3c5e0a95b4341a6cc5389e60b0a28da52758b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/803ce88477f83810d8adb04ec794616c8e1ab4ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/803ce88477f83810d8adb04ec794616c8e1ab4ed", "html_url": "https://github.com/rust-lang/rust/commit/803ce88477f83810d8adb04ec794616c8e1ab4ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/803ce88477f83810d8adb04ec794616c8e1ab4ed/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ef3cc8ca1af8df6421adf2e600b774c8e055589", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ef3cc8ca1af8df6421adf2e600b774c8e055589", "html_url": "https://github.com/rust-lang/rust/commit/5ef3cc8ca1af8df6421adf2e600b774c8e055589"}, {"sha": "09058388dec7b62680fd3d33df4b416d84975884", "url": "https://api.github.com/repos/rust-lang/rust/commits/09058388dec7b62680fd3d33df4b416d84975884", "html_url": "https://github.com/rust-lang/rust/commit/09058388dec7b62680fd3d33df4b416d84975884"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "986ffcad883db909db9f0776a73d359a0bec31f0", "filename": "clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/803ce88477f83810d8adb04ec794616c8e1ab4ed/clippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/803ce88477f83810d8adb04ec794616c8e1ab4ed/clippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flifetimes.rs?ref=803ce88477f83810d8adb04ec794616c8e1ab4ed", "patch": "@@ -144,6 +144,10 @@ fn check_fn_inner<'tcx>(\n         .filter(|param| matches!(param.kind, GenericParamKind::Type { .. }));\n \n     for typ in types {\n+        if !typ.span.eq_ctxt(span) {\n+            return;\n+        }\n+\n         for pred in generics.bounds_for_param(typ.def_id) {\n             if pred.origin == PredicateOrigin::WhereClause {\n                 // has_where_lifetimes checked that this predicate contains no lifetime.\n@@ -181,6 +185,10 @@ fn check_fn_inner<'tcx>(\n     }\n \n     if let Some((elidable_lts, usages)) = could_use_elision(cx, sig.decl, body, trait_sig, generics.params) {\n+        if usages.iter().any(|usage| !usage.ident.span.eq_ctxt(span)) {\n+            return;\n+        }\n+\n         let lts = elidable_lts\n             .iter()\n             // In principle, the result of the call to `Node::ident` could be `unwrap`ped, as `DefId` should refer to a"}, {"sha": "f0f1f9298ac65635416280a5a6600d6282af5d5c", "filename": "tests/ui/needless_lifetimes.fixed", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/803ce88477f83810d8adb04ec794616c8e1ab4ed/tests%2Fui%2Fneedless_lifetimes.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/803ce88477f83810d8adb04ec794616c8e1ab4ed/tests%2Fui%2Fneedless_lifetimes.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_lifetimes.fixed?ref=803ce88477f83810d8adb04ec794616c8e1ab4ed", "patch": "@@ -516,6 +516,16 @@ mod in_macro {\n \n     // no lint on external macro\n     macro_rules::needless_lifetime!();\n+\n+    macro_rules! expanded_lifetime {\n+        ($l:lifetime) => {\n+            fn f<$l>(arg: &$l str) -> &$l str {\n+                arg\n+            }\n+        }\n+    }\n+\n+    expanded_lifetime!('a);\n }\n \n mod issue5787 {"}, {"sha": "ddfd10430038effb10fdfe1a889835a0af6d564d", "filename": "tests/ui/needless_lifetimes.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/803ce88477f83810d8adb04ec794616c8e1ab4ed/tests%2Fui%2Fneedless_lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/803ce88477f83810d8adb04ec794616c8e1ab4ed/tests%2Fui%2Fneedless_lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_lifetimes.rs?ref=803ce88477f83810d8adb04ec794616c8e1ab4ed", "patch": "@@ -516,6 +516,16 @@ mod in_macro {\n \n     // no lint on external macro\n     macro_rules::needless_lifetime!();\n+\n+    macro_rules! expanded_lifetime {\n+        ($l:lifetime) => {\n+            fn f<$l>(arg: &$l str) -> &$l str {\n+                arg\n+            }\n+        }\n+    }\n+\n+    expanded_lifetime!('a);\n }\n \n mod issue5787 {"}]}