{"sha": "716effa34900781ddb201fbd50ee679a4964cb25", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxNmVmZmEzNDkwMDc4MWRkYjIwMWZiZDUwZWU2NzlhNDk2NGNiMjU=", "commit": {"author": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2015-01-14T23:56:17Z"}, "committer": {"name": "Andrew Paseltiner", "email": "apaseltiner@gmail.com", "date": "2015-01-15T15:16:44Z"}, "message": "support deriving `Hash` for nullary structs\n\nfixes #16530", "tree": {"sha": "e36390bee59c4326820c156686249695e51dee57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e36390bee59c4326820c156686249695e51dee57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/716effa34900781ddb201fbd50ee679a4964cb25", "comment_count": 12, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/716effa34900781ddb201fbd50ee679a4964cb25", "html_url": "https://github.com/rust-lang/rust/commit/716effa34900781ddb201fbd50ee679a4964cb25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/716effa34900781ddb201fbd50ee679a4964cb25/comments", "author": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c78ad937b4da9dd872b0a865025f3e2e885f90d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c78ad937b4da9dd872b0a865025f3e2e885f90d", "html_url": "https://github.com/rust-lang/rust/commit/1c78ad937b4da9dd872b0a865025f3e2e885f90d"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "0c3ceb2b90bf3dbf334b1b1c22de8e8cc078458c", "filename": "src/libsyntax/ext/deriving/hash.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/716effa34900781ddb201fbd50ee679a4964cb25/src%2Flibsyntax%2Fext%2Fderiving%2Fhash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/716effa34900781ddb201fbd50ee679a4964cb25/src%2Flibsyntax%2Fext%2Fderiving%2Fhash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fderiving%2Fhash.rs?ref=716effa34900781ddb201fbd50ee679a4964cb25", "patch": "@@ -63,7 +63,7 @@ pub fn expand_deriving_hash<F>(cx: &mut ExtCtxt,\n fn hash_substructure(cx: &mut ExtCtxt, trait_span: Span, substr: &Substructure) -> P<Expr> {\n     let state_expr = match substr.nonself_args {\n         [ref state_expr] => state_expr,\n-        _ => cx.span_bug(trait_span, \"incorrect number of arguments in `deriving(Hash)`\")\n+        _ => cx.span_bug(trait_span, \"incorrect number of arguments in `derive(Hash)`\")\n     };\n     let hash_ident = substr.method_ident;\n     let call_hash = |&: span, thing_expr| {\n@@ -86,16 +86,12 @@ fn hash_substructure(cx: &mut ExtCtxt, trait_span: Span, substr: &Substructure)\n \n             fs\n         }\n-        _ => cx.span_bug(trait_span, \"impossible substructure in `deriving(Hash)`\")\n+        _ => cx.span_bug(trait_span, \"impossible substructure in `derive(Hash)`\")\n     };\n \n     for &FieldInfo { ref self_, span, .. } in fields.iter() {\n         stmts.push(call_hash(span, self_.clone()));\n     }\n \n-    if stmts.len() == 0 {\n-        cx.span_bug(trait_span, \"#[derive(Hash)] needs at least one field\");\n-    }\n-\n     cx.expr_block(cx.block(trait_span, stmts, None))\n }"}, {"sha": "7e3b796235d26a25367cf348590d65cf0018cc16", "filename": "src/test/run-pass/issue-16530.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/716effa34900781ddb201fbd50ee679a4964cb25/src%2Ftest%2Frun-pass%2Fissue-16530.rs", "raw_url": "https://github.com/rust-lang/rust/raw/716effa34900781ddb201fbd50ee679a4964cb25/src%2Ftest%2Frun-pass%2Fissue-16530.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-16530.rs?ref=716effa34900781ddb201fbd50ee679a4964cb25", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::hash::{SipHasher, hash};\n+\n+#[derive(Hash)]\n+struct Empty;\n+\n+pub fn main() {\n+    assert!(hash::<_, SipHasher>(&Empty) == hash::<_, SipHasher>(&Empty));\n+}"}]}