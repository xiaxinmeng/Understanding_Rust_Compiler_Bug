{"sha": "33036159a4cf4972c8f8f149c9088c581da89f85", "node_id": "C_kwDOAAsO6NoAKDMzMDM2MTU5YTRjZjQ5NzJjOGY4ZjE0OWM5MDg4YzU4MWRhODlmODU", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2023-04-10T23:45:31Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2023-04-16T18:50:20Z"}, "message": "ci: add a runner for vanilla LLVM 16\n\nLike #107044, this will let us track compatibility with LLVM 16 going\nforward, especially after we eventually upgrade our own to the next.\n\nThis also drops `tidy` here and in `x86_64-gnu-llvm-15`, syncing with\nthat change in #106085.", "tree": {"sha": "686ac046bf0dd4395caaed13dc4a3f47dd564014", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/686ac046bf0dd4395caaed13dc4a3f47dd564014"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33036159a4cf4972c8f8f149c9088c581da89f85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33036159a4cf4972c8f8f149c9088c581da89f85", "html_url": "https://github.com/rust-lang/rust/commit/33036159a4cf4972c8f8f149c9088c581da89f85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33036159a4cf4972c8f8f149c9088c581da89f85/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a778ca1e35e4a8df95c00d800100d95e63e7722", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a778ca1e35e4a8df95c00d800100d95e63e7722", "html_url": "https://github.com/rust-lang/rust/commit/8a778ca1e35e4a8df95c00d800100d95e63e7722"}], "stats": {"total": 83, "additions": 78, "deletions": 5}, "files": [{"sha": "dacf929278ab949e939d5d1f90107639b7cae8d9", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -292,6 +292,10 @@ jobs:\n           - name: x86_64-gnu-distcheck\n             os: ubuntu-20.04-8core-32gb\n             env: {}\n+          - name: x86_64-gnu-llvm-16\n+            env:\n+              RUST_BACKTRACE: 1\n+            os: ubuntu-20.04-8core-32gb\n           - name: x86_64-gnu-llvm-15\n             env:\n               RUST_BACKTRACE: 1"}, {"sha": "c471843b8533fda11673856199ab302d1eb45cab", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-llvm-15/Dockerfile", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-15%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-15%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-15%2FDockerfile?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -2,7 +2,6 @@ FROM ubuntu:22.10\n \n ARG DEBIAN_FRONTEND=noninteractive\n \n-# NOTE: intentionally installs both python2 and python3 so we can test support for both.\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   gcc-multilib \\\n@@ -11,7 +10,6 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   file \\\n   curl \\\n   ca-certificates \\\n-  python2.7 \\\n   python3 \\\n   git \\\n   cmake \\\n@@ -63,6 +61,4 @@ ENV SCRIPT ../x.py --stage 2 test --exclude src/tools/tidy && \\\n            # work.\n            #\n            ../x.ps1 --stage 2 test tests/ui --pass=check \\\n-                             --host='' --target=i686-unknown-linux-gnu && \\\n-           # Run tidy at the very end, after all the other tests.\n-           python2.7 ../x.py --stage 2 test src/tools/tidy\n+                             --host='' --target=i686-unknown-linux-gnu"}, {"sha": "7c75d0df590830394f7387d843a555e637d32d46", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-llvm-16/Dockerfile", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-16%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-16%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-16%2FDockerfile?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -0,0 +1,64 @@\n+FROM ubuntu:23.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  gcc-multilib \\\n+  make \\\n+  ninja-build \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python3 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  gdb \\\n+  llvm-16-tools \\\n+  llvm-16-dev \\\n+  libedit-dev \\\n+  libssl-dev \\\n+  pkg-config \\\n+  zlib1g-dev \\\n+  xz-utils \\\n+  nodejs \\\n+  mingw-w64 \\\n+  && rm -rf /var/lib/apt/lists/*\n+\n+# Install powershell (universal package) so we can test x.ps1 on Linux\n+RUN curl -sL \"https://github.com/PowerShell/PowerShell/releases/download/v7.3.1/powershell_7.3.1-1.deb_amd64.deb\" > powershell.deb && \\\n+    dpkg -i powershell.deb && \\\n+    rm -f powershell.deb\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n+# We are disabling CI LLVM since this builder is intentionally using a host\n+# LLVM, rather than the typical src/llvm-project LLVM.\n+ENV NO_DOWNLOAD_CI_LLVM 1\n+\n+# Using llvm-link-shared due to libffi issues -- see #34486\n+ENV RUST_CONFIGURE_ARGS \\\n+      --build=x86_64-unknown-linux-gnu \\\n+      --llvm-root=/usr/lib/llvm-16 \\\n+      --enable-llvm-link-shared \\\n+      --set rust.thin-lto-import-instr-limit=10\n+\n+# NOTE: intentionally uses all of `x.py`, `x`, and `x.ps1` to make sure they all work on Linux.\n+ENV SCRIPT ../x.py --stage 2 test --exclude src/tools/tidy && \\\n+           # Run the `mir-opt` tests again but this time for a 32-bit target.\n+           # This enforces that tests using `// EMIT_MIR_FOR_EACH_BIT_WIDTH` have\n+           # both 32-bit and 64-bit outputs updated by the PR author, before\n+           # the PR is approved and tested for merging.\n+           # It will also detect tests lacking `// EMIT_MIR_FOR_EACH_BIT_WIDTH`,\n+           # despite having different output on 32-bit vs 64-bit targets.\n+           ../x --stage 2 test tests/mir-opt \\\n+                             --host='' --target=i686-unknown-linux-gnu && \\\n+           # Run the UI test suite again, but in `--pass=check` mode\n+           #\n+           # This is intended to make sure that both `--pass=check` continues to\n+           # work.\n+           #\n+           ../x.ps1 --stage 2 test tests/ui --pass=check \\\n+                             --host='' --target=i686-unknown-linux-gnu"}, {"sha": "8c7798aad8bdf8bc1bb6450e3948c31405a7ffdf", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -457,6 +457,11 @@ jobs:\n           - name: x86_64-gnu-distcheck\n             <<: *job-linux-8c\n \n+          - name: x86_64-gnu-llvm-16\n+            env:\n+              RUST_BACKTRACE: 1\n+            <<: *job-linux-8c\n+\n           - name: x86_64-gnu-llvm-15\n             env:\n               RUST_BACKTRACE: 1"}, {"sha": "1edd9ba9f7da6e8948516fcc0612add0b6e0b336", "filename": "tests/codegen/option-as-slice.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/tests%2Fcodegen%2Foption-as-slice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/tests%2Fcodegen%2Foption-as-slice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Foption-as-slice.rs?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -1,5 +1,7 @@\n // compile-flags: -O -Z randomize-layout=no\n // only-x86_64\n+// ignore-llvm-version: 16.0.0\n+// ^ needs https://reviews.llvm.org/D146149 in 16.0.1\n \n #![crate_type = \"lib\"]\n #![feature(option_as_slice)]"}, {"sha": "3b8280bc4a9ef592c1fc3b2e664d40cc48537a58", "filename": "tests/debuginfo/unsized.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/33036159a4cf4972c8f8f149c9088c581da89f85/tests%2Fdebuginfo%2Funsized.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33036159a4cf4972c8f8f149c9088c581da89f85/tests%2Fdebuginfo%2Funsized.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdebuginfo%2Funsized.rs?ref=33036159a4cf4972c8f8f149c9088c581da89f85", "patch": "@@ -1,4 +1,6 @@\n // compile-flags:-g\n+// ignore-gdb-version: 13.1 - 99.0\n+// ^ https://sourceware.org/bugzilla/show_bug.cgi?id=30330\n \n // === GDB TESTS ===================================================================================\n "}]}