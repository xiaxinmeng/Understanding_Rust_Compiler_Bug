{"sha": "61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxZmYyN2FhMWNjNzEwNDJhN2YzNjk5NzEzZDM4YjFkMWVkMmI0YzU=", "commit": {"author": {"name": "Philip Craig", "email": "philipjcraig@gmail.com", "date": "2019-08-27T00:34:28Z"}, "committer": {"name": "Philip Craig", "email": "philipjcraig@gmail.com", "date": "2019-08-27T00:36:27Z"}, "message": "debuginfo: always include disambiguator in type names", "tree": {"sha": "a41c629fab49d322c0999df80e5d0f50e00e0e42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a41c629fab49d322c0999df80e5d0f50e00e0e42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "html_url": "https://github.com/rust-lang/rust/commit/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/comments", "author": {"login": "philipc", "id": 330342, "node_id": "MDQ6VXNlcjMzMDM0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/330342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philipc", "html_url": "https://github.com/philipc", "followers_url": "https://api.github.com/users/philipc/followers", "following_url": "https://api.github.com/users/philipc/following{/other_user}", "gists_url": "https://api.github.com/users/philipc/gists{/gist_id}", "starred_url": "https://api.github.com/users/philipc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philipc/subscriptions", "organizations_url": "https://api.github.com/users/philipc/orgs", "repos_url": "https://api.github.com/users/philipc/repos", "events_url": "https://api.github.com/users/philipc/events{/privacy}", "received_events_url": "https://api.github.com/users/philipc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philipc", "id": 330342, "node_id": "MDQ6VXNlcjMzMDM0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/330342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philipc", "html_url": "https://github.com/philipc", "followers_url": "https://api.github.com/users/philipc/followers", "following_url": "https://api.github.com/users/philipc/following{/other_user}", "gists_url": "https://api.github.com/users/philipc/gists{/gist_id}", "starred_url": "https://api.github.com/users/philipc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philipc/subscriptions", "organizations_url": "https://api.github.com/users/philipc/orgs", "repos_url": "https://api.github.com/users/philipc/repos", "events_url": "https://api.github.com/users/philipc/events{/privacy}", "received_events_url": "https://api.github.com/users/philipc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fbe3f3e98f1cd5203b18ffacb176c70590390a63", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbe3f3e98f1cd5203b18ffacb176c70590390a63", "html_url": "https://github.com/rust-lang/rust/commit/fbe3f3e98f1cd5203b18ffacb176c70590390a63"}], "stats": {"total": 38, "additions": 18, "deletions": 20}, "files": [{"sha": "9b5ad94ecd7cbbc145f9f31b8ab405752c7a98e4", "filename": "src/librustc_codegen_ssa/debuginfo/type_names.rs", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fdebuginfo%2Ftype_names.rs?ref=61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "patch": "@@ -191,18 +191,16 @@ pub fn push_debuginfo_type_name<'tcx>(\n             visited.remove(t);\n         },\n         ty::Closure(def_id, ..) => {\n-            output.push_str(\"closure\");\n-            let disambiguator = tcx.def_key(def_id).disambiguated_data.disambiguator;\n-            if disambiguator != 0 {\n-                output.push_str(&format!(\"-{}\", disambiguator));\n-            }\n+            output.push_str(&format!(\n+                \"closure-{}\",\n+                tcx.def_key(def_id).disambiguated_data.disambiguator\n+            ));\n         }\n         ty::Generator(def_id, ..) => {\n-            output.push_str(\"generator\");\n-            let disambiguator = tcx.def_key(def_id).disambiguated_data.disambiguator;\n-            if disambiguator != 0 {\n-                output.push_str(&format!(\"-{}\", disambiguator));\n-            }\n+            output.push_str(&format!(\n+                \"generator-{}\",\n+                tcx.def_key(def_id).disambiguated_data.disambiguator\n+            ));\n         }\n         ty::Error |\n         ty::Infer(_) |"}, {"sha": "bfa7a05cad057bc661083975c768749305d14c74", "filename": "src/test/debuginfo/generator-objects.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Ftest%2Fdebuginfo%2Fgenerator-objects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Ftest%2Fdebuginfo%2Fgenerator-objects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fgenerator-objects.rs?ref=61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "patch": "@@ -10,31 +10,31 @@\n \n // gdb-command:run\n // gdb-command:print b\n-// gdb-check:$1 = generator_objects::main::generator {__0: 0x[...], <<variant>>: {__state: 0, 0: generator_objects::main::generator::Unresumed, 1: generator_objects::main::generator::Returned, 2: generator_objects::main::generator::Panicked, 3: generator_objects::main::generator::Suspend0 {[...]}, 4: generator_objects::main::generator::Suspend1 {[...]}}}\n+// gdb-check:$1 = generator_objects::main::generator-0 {__0: 0x[...], <<variant>>: {__state: 0, 0: generator_objects::main::generator-0::Unresumed, 1: generator_objects::main::generator-0::Returned, 2: generator_objects::main::generator-0::Panicked, 3: generator_objects::main::generator-0::Suspend0 {[...]}, 4: generator_objects::main::generator-0::Suspend1 {[...]}}}\n // gdb-command:continue\n // gdb-command:print b\n-// gdb-check:$2 = generator_objects::main::generator {__0: 0x[...], <<variant>>: {__state: 3, 0: generator_objects::main::generator::Unresumed, 1: generator_objects::main::generator::Returned, 2: generator_objects::main::generator::Panicked, 3: generator_objects::main::generator::Suspend0 {c: 6, d: 7}, 4: generator_objects::main::generator::Suspend1 {[...]}}}\n+// gdb-check:$2 = generator_objects::main::generator-0 {__0: 0x[...], <<variant>>: {__state: 3, 0: generator_objects::main::generator-0::Unresumed, 1: generator_objects::main::generator-0::Returned, 2: generator_objects::main::generator-0::Panicked, 3: generator_objects::main::generator-0::Suspend0 {c: 6, d: 7}, 4: generator_objects::main::generator-0::Suspend1 {[...]}}}\n // gdb-command:continue\n // gdb-command:print b\n-// gdb-check:$3 = generator_objects::main::generator {__0: 0x[...], <<variant>>: {__state: 4, 0: generator_objects::main::generator::Unresumed, 1: generator_objects::main::generator::Returned, 2: generator_objects::main::generator::Panicked, 3: generator_objects::main::generator::Suspend0 {[...]}, 4: generator_objects::main::generator::Suspend1 {c: 7, d: 8}}}\n+// gdb-check:$3 = generator_objects::main::generator-0 {__0: 0x[...], <<variant>>: {__state: 4, 0: generator_objects::main::generator-0::Unresumed, 1: generator_objects::main::generator-0::Returned, 2: generator_objects::main::generator-0::Panicked, 3: generator_objects::main::generator-0::Suspend0 {[...]}, 4: generator_objects::main::generator-0::Suspend1 {c: 7, d: 8}}}\n // gdb-command:continue\n // gdb-command:print b\n-// gdb-check:$4 = generator_objects::main::generator {__0: 0x[...], <<variant>>: {__state: 1, 0: generator_objects::main::generator::Unresumed, 1: generator_objects::main::generator::Returned, 2: generator_objects::main::generator::Panicked, 3: generator_objects::main::generator::Suspend0 {[...]}, 4: generator_objects::main::generator::Suspend1 {[...]}}}\n+// gdb-check:$4 = generator_objects::main::generator-0 {__0: 0x[...], <<variant>>: {__state: 1, 0: generator_objects::main::generator-0::Unresumed, 1: generator_objects::main::generator-0::Returned, 2: generator_objects::main::generator-0::Panicked, 3: generator_objects::main::generator-0::Suspend0 {[...]}, 4: generator_objects::main::generator-0::Suspend1 {[...]}}}\n \n // === LLDB TESTS ==================================================================================\n \n // lldb-command:run\n // lldb-command:print b\n-// lldbg-check:(generator_objects::main::generator) $0 = generator(&0x[...])\n+// lldbg-check:(generator_objects::main::generator-0) $0 = generator-0(&0x[...])\n // lldb-command:continue\n // lldb-command:print b\n-// lldbg-check:(generator_objects::main::generator) $1 = generator(&0x[...])\n+// lldbg-check:(generator_objects::main::generator-0) $1 = generator-0(&0x[...])\n // lldb-command:continue\n // lldb-command:print b\n-// lldbg-check:(generator_objects::main::generator) $2 = generator(&0x[...])\n+// lldbg-check:(generator_objects::main::generator-0) $2 = generator-0(&0x[...])\n // lldb-command:continue\n // lldb-command:print b\n-// lldbg-check:(generator_objects::main::generator) $3 = generator(&0x[...])\n+// lldbg-check:(generator_objects::main::generator-0) $3 = generator-0(&0x[...])\n \n #![feature(omit_gdb_pretty_printer_section, generators, generator_trait)]\n #![omit_gdb_pretty_printer_section]"}, {"sha": "f18e41db0e6babaae474524c1d3cdcec06bb190c", "filename": "src/test/debuginfo/issue-57822.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Ftest%2Fdebuginfo%2Fissue-57822.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5/src%2Ftest%2Fdebuginfo%2Fissue-57822.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fissue-57822.rs?ref=61ff27aa1cc71042a7f3699713d38b1d1ed2b4c5", "patch": "@@ -13,7 +13,7 @@\n // gdb-command:run\n \n // gdb-command:print g\n-// gdb-check:$1 = issue_57822::main::closure-1 (issue_57822::main::closure (1))\n+// gdb-check:$1 = issue_57822::main::closure-1 (issue_57822::main::closure-0 (1))\n \n // gdb-command:print b\n // gdb-check:$2 = issue_57822::main::generator-3 {__0: issue_57822::main::generator-2 {__0: 2, <<variant>>: {[...]}}, <<variant>>: {[...]}}\n@@ -23,7 +23,7 @@\n // lldb-command:run\n \n // lldb-command:print g\n-// lldbg-check:(issue_57822::main::closure-1) $0 = closure-1(closure(1))\n+// lldbg-check:(issue_57822::main::closure-1) $0 = closure-1(closure-0(1))\n \n // lldb-command:print b\n // lldbg-check:(issue_57822::main::generator-3) $1 = generator-3(generator-2(2))"}]}