{"sha": "7dd59fceef202e6849f575dd057bb90351362eba", "node_id": "C_kwDOAAsO6NoAKDdkZDU5ZmNlZWYyMDJlNjg0OWY1NzVkZDA1N2JiOTAzNTEzNjJlYmE", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-04-20T15:37:32Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-05-03T21:38:15Z"}, "message": "Add Drop terminator to SMIR", "tree": {"sha": "2f3ffd365eaab09475302324ee84e63704715ad6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f3ffd365eaab09475302324ee84e63704715ad6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7dd59fceef202e6849f575dd057bb90351362eba", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmRS1EcACgkQgTGiTgx5\n769fPg//ViMcOEgA7Z6ouV0IxdqTHYEHNyavf+LW+XTuhRD1/fyti2RwR4X2JAKm\nitVif+Kw4qI7+PDPoa+3efrv0iUvYeus45fONE1IU93WGVnrKG2GNJmit65qOiMH\n5QBDoVw7CiI1Kq+nQmuRtxZ2HaAMJ9I9CvwCVm6zpUbOOoXkl6D8KvClp5bxv8OY\nic5KzPWylQGMN0L9L5GgpRh2ck6u+u2rGIJRr4+Bl80J5F3HFAqP9LEO7ZBkLdPV\ngEMBsb7AtL9OZf6wXY3+s+Hg8ycY45goKtDHDo/qFSOZKQgvgYVPx0Pwdm+OLxzi\nS8xkU8TAIkdVG7dmIPkBu3vAVfOJxX0UD8QiDt8R/Y/1zZvY/RNVKifT+XzMk7gb\nDUocdL8anSGMjlXlC2WtuAEkumWE1/kg3KYPkfCih7MnlN3fTJZKj9BhXuUhemNm\nLAngKHQC2P52/f8WFF1JHRcvbFumiSLHD1Lya1VJM8oVHoDvL6rUORDyUDlZluCR\nrQPF10T21/e0ua0CMXKOiJjaMtsWqVWGnki5qT89myWMmfyIqGqoTQtLC9i1KT8H\nqCRTI107Uo2dN4EixEPx3hG5GLIzv26j3xV/AA/2ztqFUULUj1JwztBSm6AFnyHG\nzWj3w/nSSHSktovjqpyqleY3+dZKL18z/eqr75KixHJecYl/KuI=\n=sNFy\n-----END PGP SIGNATURE-----", "payload": "tree 2f3ffd365eaab09475302324ee84e63704715ad6\nparent 9b99ff76b28605ad2e2c49e369721ae400e6a665\nauthor Santiago Pastorino <spastorino@gmail.com> 1682005052 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1683149895 -0300\n\nAdd Drop terminator to SMIR\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7dd59fceef202e6849f575dd057bb90351362eba", "html_url": "https://github.com/rust-lang/rust/commit/7dd59fceef202e6849f575dd057bb90351362eba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7dd59fceef202e6849f575dd057bb90351362eba/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b99ff76b28605ad2e2c49e369721ae400e6a665", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b99ff76b28605ad2e2c49e369721ae400e6a665", "html_url": "https://github.com/rust-lang/rust/commit/9b99ff76b28605ad2e2c49e369721ae400e6a665"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "57ceb89969dd4022fc324af874abc9ba454214c4", "filename": "compiler/rustc_smir/src/rustc_smir/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7dd59fceef202e6849f575dd057bb90351362eba/compiler%2Frustc_smir%2Fsrc%2Frustc_smir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7dd59fceef202e6849f575dd057bb90351362eba/compiler%2Frustc_smir%2Fsrc%2Frustc_smir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Fsrc%2Frustc_smir%2Fmod.rs?ref=7dd59fceef202e6849f575dd057bb90351362eba", "patch": "@@ -162,7 +162,11 @@ fn rustc_terminator_to_terminator(\n         Terminate => Terminator::Abort,\n         Return => Terminator::Return,\n         Unreachable => Terminator::Unreachable,\n-        Drop { .. } => todo!(),\n+        Drop { place, target, unwind } => Terminator::Drop {\n+            place: rustc_place_to_place(place),\n+            target: target.as_usize(),\n+            unwind: rustc_unwind_to_unwind(unwind),\n+        },\n         Call { func, args, destination, target, unwind, from_hir_call: _, fn_span: _ } => {\n             Terminator::Call {\n                 func: rustc_op_to_op(func),"}, {"sha": "b3d0a83573357a3e06fc5775a3dbe75e6c25acb2", "filename": "compiler/rustc_smir/src/stable_mir/mir/body.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7dd59fceef202e6849f575dd057bb90351362eba/compiler%2Frustc_smir%2Fsrc%2Fstable_mir%2Fmir%2Fbody.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7dd59fceef202e6849f575dd057bb90351362eba/compiler%2Frustc_smir%2Fsrc%2Fstable_mir%2Fmir%2Fbody.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Fsrc%2Fstable_mir%2Fmir%2Fbody.rs?ref=7dd59fceef202e6849f575dd057bb90351362eba", "patch": "@@ -26,7 +26,7 @@ pub enum Terminator {\n     Drop {\n         place: Place,\n         target: usize,\n-        unwind: Option<usize>,\n+        unwind: UnwindAction,\n     },\n     Call {\n         func: Operand,"}, {"sha": "f89690e1d159273b1d8afb5a1aa3a33aa7930b03", "filename": "tests/ui-fulldeps/stable-mir/crate-info.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7dd59fceef202e6849f575dd057bb90351362eba/tests%2Fui-fulldeps%2Fstable-mir%2Fcrate-info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7dd59fceef202e6849f575dd057bb90351362eba/tests%2Fui-fulldeps%2Fstable-mir%2Fcrate-info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-fulldeps%2Fstable-mir%2Fcrate-info.rs?ref=7dd59fceef202e6849f575dd057bb90351362eba", "patch": "@@ -60,6 +60,15 @@ fn test_stable_mir(tcx: TyCtxt<'_>) {\n         stable_mir::mir::Terminator::Call { .. } => {}\n         other => panic!(\"{other:?}\"),\n     }\n+\n+    let drop = get_item(tcx, &items, (DefKind::Fn, \"drop\")).unwrap();\n+    let body = drop.body();\n+    assert_eq!(body.blocks.len(), 2);\n+    let block = &body.blocks[0];\n+    match &block.terminator {\n+        stable_mir::mir::Terminator::Drop { .. } => {}\n+        other => panic!(\"{other:?}\"),\n+    }\n }\n \n // Use internal API to find a function in a crate.\n@@ -131,7 +140,9 @@ fn generate_input(path: &str) -> std::io::Result<()> {\n         let x_64 = foo::bar(x);\n         let y_64 = foo::bar(y);\n         x_64.wrapping_add(y_64)\n-    }}\"#\n+    }}\n+\n+    pub fn drop(_: String) {{}}\"#\n     )?;\n     Ok(())\n }"}]}