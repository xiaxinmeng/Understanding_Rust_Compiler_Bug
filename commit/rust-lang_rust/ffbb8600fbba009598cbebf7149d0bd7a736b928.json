{"sha": "ffbb8600fbba009598cbebf7149d0bd7a736b928", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZmYmI4NjAwZmJiYTAwOTU5OGNiZWJmNzE0OWQwYmQ3YTczNmI5Mjg=", "commit": {"author": {"name": "Jonathan Turner", "email": "jturner@mozilla.com", "date": "2016-08-18T22:22:23Z"}, "committer": {"name": "Jonathan Turner", "email": "jturner@mozilla.com", "date": "2016-08-18T22:22:23Z"}, "message": "Add workaround to detect correct compiler version", "tree": {"sha": "47cb804ed5c68941aff9863fa727fca783c992dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47cb804ed5c68941aff9863fa727fca783c992dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ffbb8600fbba009598cbebf7149d0bd7a736b928", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ffbb8600fbba009598cbebf7149d0bd7a736b928", "html_url": "https://github.com/rust-lang/rust/commit/ffbb8600fbba009598cbebf7149d0bd7a736b928", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ffbb8600fbba009598cbebf7149d0bd7a736b928/comments", "author": null, "committer": null, "parents": [{"sha": "43c090ed69a624928c03ad61a29a59badf80ff7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/43c090ed69a624928c03ad61a29a59badf80ff7b", "html_url": "https://github.com/rust-lang/rust/commit/43c090ed69a624928c03ad61a29a59badf80ff7b"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "175e32125f27204bdc0db3b79628b08b1a9de19b", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ffbb8600fbba009598cbebf7149d0bd7a736b928/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffbb8600fbba009598cbebf7149d0bd7a736b928/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=ffbb8600fbba009598cbebf7149d0bd7a736b928", "patch": "@@ -38,13 +38,19 @@ fn main() {\n     // is passed (a bit janky...)\n     let target = args.windows(2).find(|w| &*w[0] == \"--target\")\n                                 .and_then(|w| w[1].to_str());\n+    let version = args.iter().find(|w| &**w == \"-vV\");\n \n     // Build scripts always use the snapshot compiler which is guaranteed to be\n     // able to produce an executable, whereas intermediate compilers may not\n     // have the standard library built yet and may not be able to produce an\n     // executable. Otherwise we just use the standard compiler we're\n     // bootstrapping with.\n-    let (rustc, libdir) = if target.is_none() {\n+    //\n+    // Also note that cargo will detect the version of the compiler to trigger\n+    // a rebuild when the compiler changes. If this happens, we want to make\n+    // sure to use the actual compiler instead of the snapshot compiler becase\n+    // that's the one that's actually changing.\n+    let (rustc, libdir) = if target.is_none() && version.is_none() {\n         (\"RUSTC_SNAPSHOT\", \"RUSTC_SNAPSHOT_LIBDIR\")\n     } else {\n         (\"RUSTC_REAL\", \"RUSTC_LIBDIR\")"}]}