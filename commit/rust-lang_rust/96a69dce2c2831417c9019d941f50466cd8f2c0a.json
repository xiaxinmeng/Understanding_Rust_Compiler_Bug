{"sha": "96a69dce2c2831417c9019d941f50466cd8f2c0a", "node_id": "C_kwDOAAsO6NoAKDk2YTY5ZGNlMmMyODMxNDE3YzkwMTlkOTQxZjUwNDY2Y2Q4ZjJjMGE", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-08-03T04:14:24Z"}, "committer": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-08-03T04:14:24Z"}, "message": "Change sized_constraints to return EarlyBinder", "tree": {"sha": "9532c1586c8a63e86ba93b0c3eead3d3301f49ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9532c1586c8a63e86ba93b0c3eead3d3301f49ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96a69dce2c2831417c9019d941f50466cd8f2c0a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96a69dce2c2831417c9019d941f50466cd8f2c0a", "html_url": "https://github.com/rust-lang/rust/commit/96a69dce2c2831417c9019d941f50466cd8f2c0a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96a69dce2c2831417c9019d941f50466cd8f2c0a/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e21624dc80a455ecbd7de6d45524becf20b35ed2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e21624dc80a455ecbd7de6d45524becf20b35ed2", "html_url": "https://github.com/rust-lang/rust/commit/e21624dc80a455ecbd7de6d45524becf20b35ed2"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "2e596b275276e3bb86478e64552b3adf03dc66d6", "filename": "compiler/rustc_middle/src/ty/adt.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fadt.rs?ref=96a69dce2c2831417c9019d941f50466cd8f2c0a", "patch": "@@ -563,7 +563,7 @@ impl<'tcx> AdtDef<'tcx> {\n     ///\n     /// Due to normalization being eager, this applies even if\n     /// the associated type is behind a pointer (e.g., issue #31299).\n-    pub fn sized_constraint(self, tcx: TyCtxt<'tcx>) -> &'tcx [Ty<'tcx>] {\n-        tcx.adt_sized_constraint(self.did()).0\n+    pub fn sized_constraint(self, tcx: TyCtxt<'tcx>) -> ty::EarlyBinder<&'tcx [Ty<'tcx>]> {\n+        ty::EarlyBinder(tcx.adt_sized_constraint(self.did()).0)\n     }\n }"}, {"sha": "52c3a38861e6531984603dc86497ea220e98bab1", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=96a69dce2c2831417c9019d941f50466cd8f2c0a", "patch": "@@ -2191,7 +2191,7 @@ impl<'tcx> Ty<'tcx> {\n \n             ty::Tuple(tys) => tys.iter().all(|ty| ty.is_trivially_sized(tcx)),\n \n-            ty::Adt(def, _substs) => def.sized_constraint(tcx).is_empty(),\n+            ty::Adt(def, _substs) => def.sized_constraint(tcx).0.is_empty(),\n \n             ty::Projection(_) | ty::Param(_) | ty::Opaque(..) => false,\n "}, {"sha": "e828b13e7459c7ba8d146a8566da462c3f6733bb", "filename": "compiler/rustc_trait_selection/src/traits/select/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs?ref=96a69dce2c2831417c9019d941f50466cd8f2c0a", "patch": "@@ -1883,7 +1883,11 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 let sized_crit = def.sized_constraint(self.tcx());\n                 // (*) binder moved here\n                 Where(obligation.predicate.rebind({\n-                    sized_crit.iter().map(|ty| EarlyBinder(*ty).subst(self.tcx(), substs)).collect()\n+                    sized_crit\n+                        .0\n+                        .iter()\n+                        .map(|ty| sized_crit.rebind(*ty).subst(self.tcx(), substs))\n+                        .collect()\n                 }))\n             }\n "}, {"sha": "29582affc2ec71b401a2c1f76054bc8521f9b462", "filename": "compiler/rustc_ty_utils/src/ty.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a69dce2c2831417c9019d941f50466cd8f2c0a/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs?ref=96a69dce2c2831417c9019d941f50466cd8f2c0a", "patch": "@@ -33,8 +33,9 @@ fn sized_constraint_for_ty<'tcx>(\n             let adt_tys = adt.sized_constraint(tcx);\n             debug!(\"sized_constraint_for_ty({:?}) intermediate = {:?}\", ty, adt_tys);\n             adt_tys\n+                .0\n                 .iter()\n-                .map(|ty| EarlyBinder(*ty).subst(tcx, substs))\n+                .map(|ty| adt_tys.rebind(*ty).subst(tcx, substs))\n                 .flat_map(|ty| sized_constraint_for_ty(tcx, adtdef, ty))\n                 .collect()\n         }"}]}