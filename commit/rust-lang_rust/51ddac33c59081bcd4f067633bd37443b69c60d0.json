{"sha": "51ddac33c59081bcd4f067633bd37443b69c60d0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxZGRhYzMzYzU5MDgxYmNkNGYwNjc2MzNiZDM3NDQzYjY5YzYwZDA=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-10-14T23:07:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-14T23:07:58Z"}, "message": "Merge pull request #3096 from otavio/use-bytecount-count\n\nutils: rewrite `count_newlines` using `bytecount::count`", "tree": {"sha": "b80fc17ff27df76c8e0540140053d3dfe5b6d7ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b80fc17ff27df76c8e0540140053d3dfe5b6d7ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51ddac33c59081bcd4f067633bd37443b69c60d0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbw8xOCRBK7hj4Ov3rIwAAdHIIAABvJ7e2Y8p9bflZLLa2382G\n3KJspbxU8RKyqqh4fPXLPKvJeiX+JW+n9ECnpkVmR/8ksXgNqM+obDMOHzEn1kby\ns9dKWiGMQ5LAXkGxAyFlnpHGkysoVZuNhQar3A5LRp6zASbqrYNHHkgyCdF0mP/m\nabIDIrQ8bDQb7QHVsOZNUYH62DCJGkStqVStzkykfi4v4DS9mvDx8IiPhgb03B9n\no8KQrf2xxV063yMxKU+i1RUmG5P7v3oVDQT7OlpttwWqBhy932tnTin1wSCcmzPh\nC6bz5rBGHpO/+8zct7jCYsKy+DWZ/H5AdIaq81VUh4VI3XyyfN7Lwbk/sqgdvgA=\n=jDnm\n-----END PGP SIGNATURE-----\n", "payload": "tree b80fc17ff27df76c8e0540140053d3dfe5b6d7ae\nparent a6ef302236dd353bd737d1196d7dc581ffc703a0\nparent e203057db055adc5a5367d35bcd5bd103a3a21e8\nauthor Nick Cameron <nrc@ncameron.org> 1539558478 +1200\ncommitter GitHub <noreply@github.com> 1539558478 +1200\n\nMerge pull request #3096 from otavio/use-bytecount-count\n\nutils: rewrite `count_newlines` using `bytecount::count`"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51ddac33c59081bcd4f067633bd37443b69c60d0", "html_url": "https://github.com/rust-lang/rust/commit/51ddac33c59081bcd4f067633bd37443b69c60d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51ddac33c59081bcd4f067633bd37443b69c60d0/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6ef302236dd353bd737d1196d7dc581ffc703a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6ef302236dd353bd737d1196d7dc581ffc703a0", "html_url": "https://github.com/rust-lang/rust/commit/a6ef302236dd353bd737d1196d7dc581ffc703a0"}, {"sha": "e203057db055adc5a5367d35bcd5bd103a3a21e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/e203057db055adc5a5367d35bcd5bd103a3a21e8", "html_url": "https://github.com/rust-lang/rust/commit/e203057db055adc5a5367d35bcd5bd103a3a21e8"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "be908dac46675e062a6c4979e46859a649ddbd08", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/51ddac33c59081bcd4f067633bd37443b69c60d0/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/51ddac33c59081bcd4f067633bd37443b69c60d0/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=51ddac33c59081bcd4f067633bd37443b69c60d0", "patch": "@@ -63,6 +63,11 @@ name = \"bitflags\"\n version = \"1.0.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"bytecount\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.2.6\"\n@@ -593,6 +598,7 @@ version = \"0.99.5\"\n dependencies = [\n  \"assert_cli 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"atty 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"bytecount 0.3.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cargo_metadata 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"derive-new 0.5.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -842,6 +848,7 @@ dependencies = [\n \"checksum backtrace 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"89a47830402e9981c5c41223151efcced65a0510c13097c769cede7efb34782a\"\n \"checksum backtrace-sys 0.1.24 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c66d56ac8dabd07f6aacdaf633f4b8262f5b3601a810a0dcddffd5c22c69daa0\"\n \"checksum bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"228047a76f468627ca71776ecdebd732a3423081fcf5125585bcd7c49886ce12\"\n+\"checksum bytecount 0.3.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f861d9ce359f56dbcb6e0c2a1cb84e52ad732cadb57b806adeb3c7668caccbd8\"\n \"checksum byteorder 1.2.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"90492c5858dd7d2e78691cfb89f90d273a2800fc11d98f60786e5d87e2f83781\"\n \"checksum cargo_metadata 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2d6809b327f87369e6f3651efd2c5a96c49847a3ed2559477ecba79014751ee1\"\n \"checksum cc 1.0.25 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f159dfd43363c4d08055a07703eb7a3406b0dac4d0584d96965a3262db3c9d16\""}, {"sha": "e42b25a21916c3494c7f4303d3c12f8de8c3e7b5", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/51ddac33c59081bcd4f067633bd37443b69c60d0/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/51ddac33c59081bcd4f067633bd37443b69c60d0/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=51ddac33c59081bcd4f067633bd37443b69c60d0", "patch": "@@ -51,6 +51,7 @@ rustc-ap-rustc_target = \"272.0.0\"\n rustc-ap-syntax = \"272.0.0\"\n rustc-ap-syntax_pos = \"272.0.0\"\n failure = \"0.1.1\"\n+bytecount = { version = \"0.3\", features = [\"simd-accel\"] }\n \n [dev-dependencies]\n assert_cli = \"0.6\""}, {"sha": "772ed8cb1417b26c4174daf0b8f8aeb78218b39a", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/51ddac33c59081bcd4f067633bd37443b69c60d0/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51ddac33c59081bcd4f067633bd37443b69c60d0/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=51ddac33c59081bcd4f067633bd37443b69c60d0", "patch": "@@ -17,6 +17,7 @@\n #[macro_use]\n extern crate derive_new;\n extern crate atty;\n+extern crate bytecount;\n extern crate diff;\n extern crate failure;\n extern crate itertools;"}, {"sha": "7ef9254a4820bfbff2125fe936c205c4365480eb", "filename": "src/utils.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/51ddac33c59081bcd4f067633bd37443b69c60d0/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51ddac33c59081bcd4f067633bd37443b69c60d0/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=51ddac33c59081bcd4f067633bd37443b69c60d0", "patch": "@@ -10,6 +10,8 @@\n \n use std::borrow::Cow;\n \n+use bytecount;\n+\n use rustc_target::spec::abi;\n use syntax::ast::{\n     self, Attribute, CrateSugar, MetaItem, MetaItemKind, NestedMetaItem, NestedMetaItemKind, Path,\n@@ -305,8 +307,8 @@ pub fn stmt_expr(stmt: &ast::Stmt) -> Option<&ast::Expr> {\n \n #[inline]\n pub fn count_newlines(input: &str) -> usize {\n-    // Using `as_bytes` to omit UTF-8 decoding\n-    input.as_bytes().iter().filter(|&&c| c == b'\\n').count()\n+    // Using bytes to omit UTF-8 decoding\n+    bytecount::count(input.as_bytes(), b'\\n')\n }\n \n // For format_missing and last_pos, need to use the source callsite (if applicable)."}]}