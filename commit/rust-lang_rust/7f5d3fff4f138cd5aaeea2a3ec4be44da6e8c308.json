{"sha": "7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "node_id": "C_kwDOAAsO6NoAKDdmNWQzZmZmNGYxMzhjZDVhYWVlYTJhM2VjNGJlNDRkYTZlOGMzMDg", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-11-24T22:07:13Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-11-24T23:24:04Z"}, "message": "Do not visit attributes in `LateResolutionVisitor`.", "tree": {"sha": "af24370806a8a65541ecd2573c66eef835cb0aae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af24370806a8a65541ecd2573c66eef835cb0aae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "html_url": "https://github.com/rust-lang/rust/commit/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae126ad282f24437d6f57909a038fbca24c1e6dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae126ad282f24437d6f57909a038fbca24c1e6dd", "html_url": "https://github.com/rust-lang/rust/commit/ae126ad282f24437d6f57909a038fbca24c1e6dd"}], "stats": {"total": 54, "additions": 32, "deletions": 22}, "files": [{"sha": "12123c946cc08efac1d0def6f0c87af535f9f174", "filename": "compiler/rustc_resolve/src/late.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate.rs?ref=7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "patch": "@@ -431,6 +431,10 @@ struct LateResolutionVisitor<'a, 'b, 'ast> {\n \n /// Walks the whole crate in DFS order, visiting each item, resolving names as it goes.\n impl<'a: 'ast, 'ast> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast> {\n+    fn visit_attribute(&mut self, _: &'ast Attribute) {\n+        // We do not want to resolve expressions that appear in attributes,\n+        // as they do not correspond to actual code.\n+    }\n     fn visit_item(&mut self, item: &'ast Item) {\n         let prev = replace(&mut self.diagnostic_metadata.current_item, Some(item));\n         // Always report errors in items we just entered."}, {"sha": "76708ea98305f2ee9637ecb7bfcefca78dbfe11a", "filename": "src/test/ui/attributes/issue-90873.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.rs?ref=7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "patch": "@@ -3,3 +3,7 @@\n //~| cannot find attribute `u` in this scope\n //~| `main` function not found in crate `issue_90873`\n //~| missing type for `static` item\n+\n+#![a={impl std::ops::Neg for i8 {}}]\n+//~^ ERROR unexpected token\n+//~| ERROR cannot find attribute `a` in this scope"}, {"sha": "d466157f04e0cd3c1f955fb69e7e2b02ed0ed5db", "filename": "src/test/ui/attributes/issue-90873.stderr", "status": "modified", "additions": 23, "deletions": 3, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fissue-90873.stderr?ref=7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "patch": "@@ -7,24 +7,44 @@ error: unexpected token: `||\n LL | #![u=||{static d=||1;}]\n    |      ^^^^^^^^^^^^^^^^^\n \n+error: unexpected token: `{\n+           impl std::ops::Neg for i8 { }\n+       }`\n+  --> $DIR/issue-90873.rs:7:6\n+   |\n+LL | #![a={impl std::ops::Neg for i8 {}}]\n+   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error: cannot find attribute `u` in this scope\n   --> $DIR/issue-90873.rs:1:4\n    |\n LL | #![u=||{static d=||1;}]\n    |    ^\n \n+error: cannot find attribute `a` in this scope\n+  --> $DIR/issue-90873.rs:7:4\n+   |\n+LL | #![a={impl std::ops::Neg for i8 {}}]\n+   |    ^\n+\n error[E0601]: `main` function not found in crate `issue_90873`\n   --> $DIR/issue-90873.rs:1:1\n    |\n-LL | #![u=||{static d=||1;}]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^ consider adding a `main` function to `$DIR/issue-90873.rs`\n+LL | / #![u=||{static d=||1;}]\n+LL | |\n+LL | |\n+LL | |\n+LL | |\n+LL | |\n+LL | | #![a={impl std::ops::Neg for i8 {}}]\n+   | |____________________________________^ consider adding a `main` function to `$DIR/issue-90873.rs`\n \n error: missing type for `static` item\n   --> $DIR/issue-90873.rs:1:16\n    |\n LL | #![u=||{static d=||1;}]\n    |                ^ help: provide a type for the item: `d: <type>`\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0601`."}, {"sha": "ac5640646a814bb84e208db725e106e91cdfd3ed", "filename": "src/test/ui/consts/issue-90878-2.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.rs?ref=7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "patch": "@@ -1,7 +1,5 @@\n  #![l=|x|[b;x ]] //~ ERROR unexpected token: `|x| [b; x]`\n //~^ ERROR cannot find attribute `l` in this scope\n-//~^^ ERROR attempt to use a non-constant value in a constant [E0435]\n-//~^^^ ERROR cannot find value `b` in this scope [E0425]\n \n // notice the space at the start,\n // we can't attach any attributes to this file because it needs to be at the start"}, {"sha": "4ccce36eedf70435d08b3986fbbd2c9105015b8c", "filename": "src/test/ui/consts/issue-90878-2.stderr", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fissue-90878-2.stderr?ref=7f5d3fff4f138cd5aaeea2a3ec4be44da6e8c308", "patch": "@@ -10,21 +10,5 @@ error: cannot find attribute `l` in this scope\n LL |  #![l=|x|[b;x ]]\n    |     ^\n \n-error[E0435]: attempt to use a non-constant value in a constant\n-  --> $DIR/issue-90878-2.rs:1:13\n-   |\n-LL |  #![l=|x|[b;x ]]\n-   |        -    ^\n-   |        |\n-   |        this would need to be a `const`\n-\n-error[E0425]: cannot find value `b` in this scope\n-  --> $DIR/issue-90878-2.rs:1:11\n-   |\n-LL |  #![l=|x|[b;x ]]\n-   |           ^ help: a local variable with a similar name exists: `x`\n-\n-error: aborting due to 4 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0425, E0435.\n-For more information about an error, try `rustc --explain E0425`."}]}