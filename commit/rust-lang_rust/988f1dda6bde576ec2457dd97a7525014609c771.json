{"sha": "988f1dda6bde576ec2457dd97a7525014609c771", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4OGYxZGRhNmJkZTU3NmVjMjQ1N2RkOTdhNzUyNTAxNDYwOWM3NzE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-03-19T17:01:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-19T17:01:14Z"}, "message": "Merge #3658\n\n3658: More direct CargoWorkspace r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "52b5e578093db49ed1822f3b4b23d94fc963337c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52b5e578093db49ed1822f3b4b23d94fc963337c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/988f1dda6bde576ec2457dd97a7525014609c771", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJec6VaCRBK7hj4Ov3rIwAAdHIIACOMGYvML345BbgeoJV8pRHY\nYD18ZSn6wmM4/MfdZupe0+Pici51LZaqWIllazB5nfyoooOkImbs4ie1be83s6wf\n9+Ioo4qVC7eyL5woW0tNnfdyAvBDbR8A3/7KFta5anX1KMV3IxlGcjhNbUqW0zI9\njFj3R6ICfaa0EIuOGurDd9utoTjTEEeeLyN1+wBlb2HiFqnA3rnwOm1eXfdCL5QQ\nLeVc1ml2aafQXKALhjO0g6/WHms/yNCBkmEkRfDgPwRsfMYg8Eg85iSdAIq+BREX\n7qDmEhHtNNE+vjyQgevwvigHa0nSqg//Eyw1NLjVEC+HK9B+tKacvUpDI80gfoY=\n=g+Iw\n-----END PGP SIGNATURE-----\n", "payload": "tree 52b5e578093db49ed1822f3b4b23d94fc963337c\nparent d013a05fee5bcf1dfff7bc3a273dd064b61bab91\nparent fc230b943b1079556e6d844bc22790ffb969da9c\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1584637274 +0000\ncommitter GitHub <noreply@github.com> 1584637274 +0000\n\nMerge #3658\n\n3658: More direct CargoWorkspace r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/988f1dda6bde576ec2457dd97a7525014609c771", "html_url": "https://github.com/rust-lang/rust/commit/988f1dda6bde576ec2457dd97a7525014609c771", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/988f1dda6bde576ec2457dd97a7525014609c771/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d013a05fee5bcf1dfff7bc3a273dd064b61bab91", "url": "https://api.github.com/repos/rust-lang/rust/commits/d013a05fee5bcf1dfff7bc3a273dd064b61bab91", "html_url": "https://github.com/rust-lang/rust/commit/d013a05fee5bcf1dfff7bc3a273dd064b61bab91"}, {"sha": "fc230b943b1079556e6d844bc22790ffb969da9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/fc230b943b1079556e6d844bc22790ffb969da9c", "html_url": "https://github.com/rust-lang/rust/commit/fc230b943b1079556e6d844bc22790ffb969da9c"}], "stats": {"total": 193, "additions": 84, "deletions": 109}, "files": [{"sha": "43dbd096a33f7e9487d04dd22a07b32b73ead093", "filename": "crates/ra_project_model/src/cargo_workspace.rs", "status": "modified", "additions": 41, "deletions": 64, "changes": 105, "blob_url": "https://github.com/rust-lang/rust/blob/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs?ref=988f1dda6bde576ec2457dd97a7525014609c771", "patch": "@@ -1,6 +1,9 @@\n //! FIXME: write short doc here\n \n-use std::path::{Path, PathBuf};\n+use std::{\n+    ops,\n+    path::{Path, PathBuf},\n+};\n \n use anyhow::{Context, Result};\n use cargo_metadata::{CargoOpt, Message, MetadataCommand, PackageId};\n@@ -24,6 +27,20 @@ pub struct CargoWorkspace {\n     workspace_root: PathBuf,\n }\n \n+impl ops::Index<Package> for CargoWorkspace {\n+    type Output = PackageData;\n+    fn index(&self, index: Package) -> &PackageData {\n+        &self.packages[index]\n+    }\n+}\n+\n+impl ops::Index<Target> for CargoWorkspace {\n+    type Output = TargetData;\n+    fn index(&self, index: Target) -> &TargetData {\n+        &self.targets[index]\n+    }\n+}\n+\n #[derive(Deserialize, Clone, Debug, PartialEq, Eq)]\n #[serde(rename_all = \"camelCase\", default)]\n pub struct CargoFeatures {\n@@ -61,15 +78,15 @@ pub struct Target(RawId);\n impl_arena_id!(Target);\n \n #[derive(Debug, Clone)]\n-struct PackageData {\n-    name: String,\n-    manifest: PathBuf,\n-    targets: Vec<Target>,\n-    is_member: bool,\n-    dependencies: Vec<PackageDependency>,\n-    edition: Edition,\n-    features: Vec<String>,\n-    out_dir: Option<PathBuf>,\n+pub struct PackageData {\n+    pub name: String,\n+    pub manifest: PathBuf,\n+    pub targets: Vec<Target>,\n+    pub is_member: bool,\n+    pub dependencies: Vec<PackageDependency>,\n+    pub edition: Edition,\n+    pub features: Vec<String>,\n+    pub out_dir: Option<PathBuf>,\n }\n \n #[derive(Debug, Clone)]\n@@ -79,12 +96,12 @@ pub struct PackageDependency {\n }\n \n #[derive(Debug, Clone)]\n-struct TargetData {\n-    pkg: Package,\n-    name: String,\n-    root: PathBuf,\n-    kind: TargetKind,\n-    is_proc_macro: bool,\n+pub struct TargetData {\n+    pub package: Package,\n+    pub name: String,\n+    pub root: PathBuf,\n+    pub kind: TargetKind,\n+    pub is_proc_macro: bool,\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq)]\n@@ -115,52 +132,9 @@ impl TargetKind {\n     }\n }\n \n-impl Package {\n-    pub fn name(self, ws: &CargoWorkspace) -> &str {\n-        ws.packages[self].name.as_str()\n-    }\n-    pub fn root(self, ws: &CargoWorkspace) -> &Path {\n-        ws.packages[self].manifest.parent().unwrap()\n-    }\n-    pub fn edition(self, ws: &CargoWorkspace) -> Edition {\n-        ws.packages[self].edition\n-    }\n-    pub fn features(self, ws: &CargoWorkspace) -> &[String] {\n-        &ws.packages[self].features\n-    }\n-    pub fn targets<'a>(self, ws: &'a CargoWorkspace) -> impl Iterator<Item = Target> + 'a {\n-        ws.packages[self].targets.iter().cloned()\n-    }\n-    #[allow(unused)]\n-    pub fn is_member(self, ws: &CargoWorkspace) -> bool {\n-        ws.packages[self].is_member\n-    }\n-    pub fn dependencies<'a>(\n-        self,\n-        ws: &'a CargoWorkspace,\n-    ) -> impl Iterator<Item = &'a PackageDependency> + 'a {\n-        ws.packages[self].dependencies.iter()\n-    }\n-    pub fn out_dir(self, ws: &CargoWorkspace) -> Option<&Path> {\n-        ws.packages[self].out_dir.as_ref().map(PathBuf::as_path)\n-    }\n-}\n-\n-impl Target {\n-    pub fn package(self, ws: &CargoWorkspace) -> Package {\n-        ws.targets[self].pkg\n-    }\n-    pub fn name(self, ws: &CargoWorkspace) -> &str {\n-        ws.targets[self].name.as_str()\n-    }\n-    pub fn root(self, ws: &CargoWorkspace) -> &Path {\n-        ws.targets[self].root.as_path()\n-    }\n-    pub fn kind(self, ws: &CargoWorkspace) -> TargetKind {\n-        ws.targets[self].kind\n-    }\n-    pub fn is_proc_macro(self, ws: &CargoWorkspace) -> bool {\n-        ws.targets[self].is_proc_macro\n+impl PackageData {\n+    pub fn root(&self) -> &Path {\n+        self.manifest.parent().unwrap()\n     }\n }\n \n@@ -219,7 +193,7 @@ impl CargoWorkspace {\n             for meta_tgt in meta_pkg.targets {\n                 let is_proc_macro = meta_tgt.kind.as_slice() == [\"proc-macro\"];\n                 let tgt = targets.alloc(TargetData {\n-                    pkg,\n+                    package: pkg,\n                     name: meta_tgt.name,\n                     root: meta_tgt.src_path.clone(),\n                     kind: TargetKind::new(meta_tgt.kind.as_slice()),\n@@ -265,7 +239,10 @@ impl CargoWorkspace {\n     }\n \n     pub fn target_by_root(&self, root: &Path) -> Option<Target> {\n-        self.packages().filter_map(|pkg| pkg.targets(self).find(|it| it.root(self) == root)).next()\n+        self.packages()\n+            .filter_map(|pkg| self[pkg].targets.iter().find(|&&it| self[it].root == root))\n+            .next()\n+            .copied()\n     }\n \n     pub fn workspace_root(&self) -> &Path {"}, {"sha": "b500a74fb650817f21383ad42f248a52cbdb1652", "filename": "crates/ra_project_model/src/lib.rs", "status": "modified", "additions": 25, "deletions": 25, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Flib.rs?ref=988f1dda6bde576ec2457dd97a7525014609c771", "patch": "@@ -138,12 +138,12 @@ impl ProjectWorkspace {\n             ProjectWorkspace::Cargo { cargo, sysroot } => {\n                 let mut roots = Vec::with_capacity(cargo.packages().len() + sysroot.crates().len());\n                 for pkg in cargo.packages() {\n-                    let root = pkg.root(&cargo).to_path_buf();\n-                    let member = pkg.is_member(&cargo);\n+                    let root = cargo[pkg].root().to_path_buf();\n+                    let member = cargo[pkg].is_member;\n                     roots.push(PackageRoot::new(root, member));\n                 }\n                 for krate in sysroot.crates() {\n-                    roots.push(PackageRoot::new(krate.root_dir(&sysroot).to_path_buf(), false))\n+                    roots.push(PackageRoot::new(sysroot[krate].root_dir().to_path_buf(), false))\n                 }\n                 roots\n             }\n@@ -164,7 +164,7 @@ impl ProjectWorkspace {\n             ProjectWorkspace::Cargo { cargo, sysroot: _sysroot } => {\n                 let mut out_dirs = Vec::with_capacity(cargo.packages().len());\n                 for pkg in cargo.packages() {\n-                    if let Some(out_dir) = pkg.out_dir(&cargo) {\n+                    if let Some(out_dir) = &cargo[pkg].out_dir {\n                         out_dirs.push(out_dir.to_path_buf());\n                     }\n                 }\n@@ -260,7 +260,7 @@ impl ProjectWorkspace {\n             ProjectWorkspace::Cargo { cargo, sysroot } => {\n                 let mut sysroot_crates = FxHashMap::default();\n                 for krate in sysroot.crates() {\n-                    if let Some(file_id) = load(krate.root(&sysroot)) {\n+                    if let Some(file_id) = load(&sysroot[krate].root) {\n                         // Crates from sysroot have `cfg(test)` disabled\n                         let cfg_options = {\n                             let mut opts = default_cfg_options.clone();\n@@ -274,7 +274,7 @@ impl ProjectWorkspace {\n                             file_id,\n                             Edition::Edition2018,\n                             Some(\n-                                CrateName::new(krate.name(&sysroot))\n+                                CrateName::new(&sysroot[krate].name)\n                                     .expect(\"Sysroot crate names should not contain dashes\"),\n                             ),\n                             cfg_options,\n@@ -285,8 +285,8 @@ impl ProjectWorkspace {\n                     }\n                 }\n                 for from in sysroot.crates() {\n-                    for to in from.deps(&sysroot) {\n-                        let name = to.name(&sysroot);\n+                    for &to in sysroot[from].deps.iter() {\n+                        let name = &sysroot[to].name;\n                         if let (Some(&from), Some(&to)) =\n                             (sysroot_crates.get(&from), sysroot_crates.get(&to))\n                         {\n@@ -309,18 +309,18 @@ impl ProjectWorkspace {\n                 // Next, create crates for each package, target pair\n                 for pkg in cargo.packages() {\n                     let mut lib_tgt = None;\n-                    for tgt in pkg.targets(&cargo) {\n-                        let root = tgt.root(&cargo);\n+                    for &tgt in cargo[pkg].targets.iter() {\n+                        let root = cargo[tgt].root.as_path();\n                         if let Some(file_id) = load(root) {\n-                            let edition = pkg.edition(&cargo);\n+                            let edition = cargo[pkg].edition;\n                             let cfg_options = {\n                                 let mut opts = default_cfg_options.clone();\n-                                opts.insert_features(pkg.features(&cargo).iter().map(Into::into));\n+                                opts.insert_features(cargo[pkg].features.iter().map(Into::into));\n                                 opts\n                             };\n                             let mut env = Env::default();\n                             let mut extern_source = ExternSource::default();\n-                            if let Some(out_dir) = pkg.out_dir(cargo) {\n+                            if let Some(out_dir) = &cargo[pkg].out_dir {\n                                 // FIXME: We probably mangle non UTF-8 paths here, figure out a better solution\n                                 env.set(\"OUT_DIR\", out_dir.to_string_lossy().to_string());\n                                 if let Some(&extern_source_id) = extern_source_roots.get(out_dir) {\n@@ -330,16 +330,16 @@ impl ProjectWorkspace {\n                             let crate_id = crate_graph.add_crate_root(\n                                 file_id,\n                                 edition,\n-                                Some(CrateName::normalize_dashes(pkg.name(&cargo))),\n+                                Some(CrateName::normalize_dashes(&cargo[pkg].name)),\n                                 cfg_options,\n                                 env,\n                                 extern_source,\n                             );\n-                            if tgt.kind(&cargo) == TargetKind::Lib {\n+                            if cargo[tgt].kind == TargetKind::Lib {\n                                 lib_tgt = Some(crate_id);\n                                 pkg_to_lib_crate.insert(pkg, crate_id);\n                             }\n-                            if tgt.is_proc_macro(&cargo) {\n+                            if cargo[tgt].is_proc_macro {\n                                 if let Some(proc_macro) = libproc_macro {\n                                     if crate_graph\n                                         .add_dep(\n@@ -351,7 +351,7 @@ impl ProjectWorkspace {\n                                     {\n                                         log::error!(\n                                             \"cyclic dependency on proc_macro for {}\",\n-                                            pkg.name(&cargo)\n+                                            &cargo[pkg].name\n                                         )\n                                     }\n                                 }\n@@ -371,15 +371,15 @@ impl ProjectWorkspace {\n                                         // For root projects with dashes in their name,\n                                         // cargo metadata does not do any normalization,\n                                         // so we do it ourselves currently\n-                                        CrateName::normalize_dashes(pkg.name(&cargo)),\n+                                        CrateName::normalize_dashes(&cargo[pkg].name),\n                                         to,\n                                     )\n                                     .is_err()\n                             {\n                                 {\n                                     log::error!(\n                                         \"cyclic dependency between targets of {}\",\n-                                        pkg.name(&cargo)\n+                                        &cargo[pkg].name\n                                     )\n                                 }\n                             }\n@@ -391,23 +391,23 @@ impl ProjectWorkspace {\n                                 .add_dep(from, CrateName::new(\"core\").unwrap(), core)\n                                 .is_err()\n                             {\n-                                log::error!(\"cyclic dependency on core for {}\", pkg.name(&cargo))\n+                                log::error!(\"cyclic dependency on core for {}\", &cargo[pkg].name)\n                             }\n                         }\n                         if let Some(alloc) = liballoc {\n                             if crate_graph\n                                 .add_dep(from, CrateName::new(\"alloc\").unwrap(), alloc)\n                                 .is_err()\n                             {\n-                                log::error!(\"cyclic dependency on alloc for {}\", pkg.name(&cargo))\n+                                log::error!(\"cyclic dependency on alloc for {}\", &cargo[pkg].name)\n                             }\n                         }\n                         if let Some(std) = libstd {\n                             if crate_graph\n                                 .add_dep(from, CrateName::new(\"std\").unwrap(), std)\n                                 .is_err()\n                             {\n-                                log::error!(\"cyclic dependency on std for {}\", pkg.name(&cargo))\n+                                log::error!(\"cyclic dependency on std for {}\", &cargo[pkg].name)\n                             }\n                         }\n                     }\n@@ -416,7 +416,7 @@ impl ProjectWorkspace {\n                 // Now add a dep edge from all targets of upstream to the lib\n                 // target of downstream.\n                 for pkg in cargo.packages() {\n-                    for dep in pkg.dependencies(&cargo) {\n+                    for dep in cargo[pkg].dependencies.iter() {\n                         if let Some(&to) = pkg_to_lib_crate.get(&dep.pkg) {\n                             for &from in pkg_crates.get(&pkg).into_iter().flatten() {\n                                 if crate_graph\n@@ -425,8 +425,8 @@ impl ProjectWorkspace {\n                                 {\n                                     log::error!(\n                                         \"cyclic dependency {} -> {}\",\n-                                        pkg.name(&cargo),\n-                                        dep.pkg.name(&cargo)\n+                                        &cargo[pkg].name,\n+                                        &cargo[dep.pkg].name\n                                     )\n                                 }\n                             }"}, {"sha": "4ac4fa14db7f2cab0b41bcd73638195b7de3c39a", "filename": "crates/ra_project_model/src/sysroot.rs", "status": "modified", "additions": 15, "deletions": 17, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Fsysroot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Fra_project_model%2Fsrc%2Fsysroot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fsysroot.rs?ref=988f1dda6bde576ec2457dd97a7525014609c771", "patch": "@@ -2,7 +2,7 @@\n \n use anyhow::{bail, Context, Result};\n use std::{\n-    env,\n+    env, ops,\n     path::{Path, PathBuf},\n     process::{Command, Output},\n };\n@@ -19,10 +19,17 @@ pub struct SysrootCrate(RawId);\n impl_arena_id!(SysrootCrate);\n \n #[derive(Debug, Clone)]\n-struct SysrootCrateData {\n-    name: String,\n-    root: PathBuf,\n-    deps: Vec<SysrootCrate>,\n+pub struct SysrootCrateData {\n+    pub name: String,\n+    pub root: PathBuf,\n+    pub deps: Vec<SysrootCrate>,\n+}\n+\n+impl ops::Index<SysrootCrate> for Sysroot {\n+    type Output = SysrootCrateData;\n+    fn index(&self, index: SysrootCrate) -> &SysrootCrateData {\n+        &self.crates[index]\n+    }\n }\n \n impl Sysroot {\n@@ -129,18 +136,9 @@ fn get_or_install_rust_src(cargo_toml: &Path) -> Result<PathBuf> {\n     Ok(src_path)\n }\n \n-impl SysrootCrate {\n-    pub fn name(self, sysroot: &Sysroot) -> &str {\n-        &sysroot.crates[self].name\n-    }\n-    pub fn root(self, sysroot: &Sysroot) -> &Path {\n-        sysroot.crates[self].root.as_path()\n-    }\n-    pub fn root_dir(self, sysroot: &Sysroot) -> &Path {\n-        self.root(sysroot).parent().unwrap()\n-    }\n-    pub fn deps<'a>(self, sysroot: &'a Sysroot) -> impl Iterator<Item = SysrootCrate> + 'a {\n-        sysroot.crates[self].deps.iter().copied()\n+impl SysrootCrateData {\n+    pub fn root_dir(&self) -> &Path {\n+        self.root.parent().unwrap()\n     }\n }\n "}, {"sha": "f87bdcec5c4a371df73e7105397c3fde61bc7c61", "filename": "crates/rust-analyzer/src/cargo_target_spec.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988f1dda6bde576ec2457dd97a7525014609c771/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs?ref=988f1dda6bde576ec2457dd97a7525014609c771", "patch": "@@ -77,9 +77,9 @@ impl CargoTargetSpec {\n             ProjectWorkspace::Cargo { cargo, .. } => {\n                 let tgt = cargo.target_by_root(&path)?;\n                 Some(CargoTargetSpec {\n-                    package: tgt.package(&cargo).name(&cargo).to_string(),\n-                    target: tgt.name(&cargo).to_string(),\n-                    target_kind: tgt.kind(&cargo),\n+                    package: cargo[cargo[tgt].package].name.clone(),\n+                    target: cargo[tgt].name.clone(),\n+                    target_kind: cargo[tgt].kind,\n                 })\n             }\n             ProjectWorkspace::Json { .. } => None,"}]}