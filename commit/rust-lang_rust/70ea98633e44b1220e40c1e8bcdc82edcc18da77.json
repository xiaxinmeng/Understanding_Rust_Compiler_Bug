{"sha": "70ea98633e44b1220e40c1e8bcdc82edcc18da77", "node_id": "C_kwDOAAsO6NoAKDcwZWE5ODYzM2U0NGIxMjIwZTQwYzFlOGJjZGM4MmVkY2MxOGRhNzc", "commit": {"author": {"name": "nidnogg", "email": "henriquevt98@gmail.com", "date": "2022-08-18T05:11:52Z"}, "committer": {"name": "nidnogg", "email": "henriquevt98@gmail.com", "date": "2022-08-22T02:22:51Z"}, "message": "Migrated Unallowed function pointer calls in interpreter/ops", "tree": {"sha": "bed016c561f7d635a419dd38b438b36e966d89d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bed016c561f7d635a419dd38b438b36e966d89d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/70ea98633e44b1220e40c1e8bcdc82edcc18da77", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/70ea98633e44b1220e40c1e8bcdc82edcc18da77", "html_url": "https://github.com/rust-lang/rust/commit/70ea98633e44b1220e40c1e8bcdc82edcc18da77", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/70ea98633e44b1220e40c1e8bcdc82edcc18da77/comments", "author": {"login": "nidnogg", "id": 17261185, "node_id": "MDQ6VXNlcjE3MjYxMTg1", "avatar_url": "https://avatars.githubusercontent.com/u/17261185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nidnogg", "html_url": "https://github.com/nidnogg", "followers_url": "https://api.github.com/users/nidnogg/followers", "following_url": "https://api.github.com/users/nidnogg/following{/other_user}", "gists_url": "https://api.github.com/users/nidnogg/gists{/gist_id}", "starred_url": "https://api.github.com/users/nidnogg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nidnogg/subscriptions", "organizations_url": "https://api.github.com/users/nidnogg/orgs", "repos_url": "https://api.github.com/users/nidnogg/repos", "events_url": "https://api.github.com/users/nidnogg/events{/privacy}", "received_events_url": "https://api.github.com/users/nidnogg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nidnogg", "id": 17261185, "node_id": "MDQ6VXNlcjE3MjYxMTg1", "avatar_url": "https://avatars.githubusercontent.com/u/17261185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nidnogg", "html_url": "https://github.com/nidnogg", "followers_url": "https://api.github.com/users/nidnogg/followers", "following_url": "https://api.github.com/users/nidnogg/following{/other_user}", "gists_url": "https://api.github.com/users/nidnogg/gists{/gist_id}", "starred_url": "https://api.github.com/users/nidnogg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nidnogg/subscriptions", "organizations_url": "https://api.github.com/users/nidnogg/orgs", "repos_url": "https://api.github.com/users/nidnogg/repos", "events_url": "https://api.github.com/users/nidnogg/events{/privacy}", "received_events_url": "https://api.github.com/users/nidnogg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6af8e46a9af03b94baec980d188798a58f3eb75c", "url": "https://api.github.com/repos/rust-lang/rust/commits/6af8e46a9af03b94baec980d188798a58f3eb75c", "html_url": "https://github.com/rust-lang/rust/commit/6af8e46a9af03b94baec980d188798a58f3eb75c"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "728d890ca60daf4cfcfc27ed805b971be2513465", "filename": "compiler/rustc_const_eval/src/errors.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ferrors.rs?ref=70ea98633e44b1220e40c1e8bcdc82edcc18da77", "patch": "@@ -95,3 +95,11 @@ pub(crate) struct MaxNumNodesExceeded {\n     pub span: Span,\n     pub s: String,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[error(const_eval::unallowed_fn_pointer_call)]\n+pub(crate) struct UnallowedFnPointerCall {\n+    #[primary_span]\n+    pub span: Span,\n+    pub kind: ConstContext,\n+}"}, {"sha": "ba7f2d072770d3cfc745c147df2c36419dfe8105", "filename": "compiler/rustc_const_eval/src/transform/check_consts/ops.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=70ea98633e44b1220e40c1e8bcdc82edcc18da77", "patch": "@@ -25,7 +25,7 @@ use rustc_trait_selection::traits::SelectionContext;\n use super::ConstCx;\n use crate::errors::{\n     MutDerefErr, NonConstOpErr, PanicNonStrErr, RawPtrToIntErr, StaticAccessErr,\n-    TransientMutBorrowErr, TransientMutBorrowErrRaw,\n+    TransientMutBorrowErr, TransientMutBorrowErrRaw, UnallowedFnPointerCall,\n };\n use crate::util::{call_kind, CallDesugaringKind, CallKind};\n \n@@ -97,10 +97,7 @@ impl<'tcx> NonConstOp<'tcx> for FnCallIndirect {\n         ccx: &ConstCx<'_, 'tcx>,\n         span: Span,\n     ) -> DiagnosticBuilder<'tcx, ErrorGuaranteed> {\n-        ccx.tcx.sess.struct_span_err(\n-            span,\n-            &format!(\"function pointer calls are not allowed in {}s\", ccx.const_kind()),\n-        )\n+        ccx.tcx.sess.create_err(UnallowedFnPointerCall { span, kind: ccx.const_kind() })\n     }\n }\n "}, {"sha": "5bd41dffdb5d02cd94cda6523aab403511201dd2", "filename": "compiler/rustc_error_messages/locales/en-US/const_eval.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/70ea98633e44b1220e40c1e8bcdc82edcc18da77/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fconst_eval.ftl?ref=70ea98633e44b1220e40c1e8bcdc82edcc18da77", "patch": "@@ -31,3 +31,5 @@ const_eval_transient_mut_borrow = mutable references are not allowed in {$kind}s\n const_eval_transient_mut_borrow_raw = raw mutable references are not allowed in {$kind}s\n \n const_evaL_max_num_nodes_exceeded = maximum number of nodes exceeded in constant {$s}\n+\n+const_eval_unallowed_fn_pointer_call = function pointer calls are not allowed in {$const_kind}s\n\\ No newline at end of file"}]}