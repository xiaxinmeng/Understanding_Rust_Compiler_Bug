{"sha": "b5bae091849dc02b7aded5026cf1e2b5497db318", "node_id": "C_kwDOAAsO6NoAKGI1YmFlMDkxODQ5ZGMwMmI3YWRlZDUwMjZjZjFlMmI1NDk3ZGIzMTg", "commit": {"author": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2021-11-02T13:21:27Z"}, "committer": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2021-11-06T17:20:15Z"}, "message": "Add `cargo dev lint` to manually run clippy on a file\n\nI found the manual run command really useful, this makes it a bit easier\nto type", "tree": {"sha": "4623b727b6da8d2f2abca11978056910b17ccb10", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4623b727b6da8d2f2abca11978056910b17ccb10"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5bae091849dc02b7aded5026cf1e2b5497db318", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5bae091849dc02b7aded5026cf1e2b5497db318", "html_url": "https://github.com/rust-lang/rust/commit/b5bae091849dc02b7aded5026cf1e2b5497db318", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5bae091849dc02b7aded5026cf1e2b5497db318/comments", "author": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107", "url": "https://api.github.com/repos/rust-lang/rust/commits/18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107", "html_url": "https://github.com/rust-lang/rust/commit/18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "59fde447547145f3093b5054112bd58dd6ec8b7e", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=b5bae091849dc02b7aded5026cf1e2b5497db318", "patch": "@@ -7,6 +7,7 @@ use std::path::PathBuf;\n \n pub mod bless;\n pub mod fmt;\n+pub mod lint;\n pub mod new_lint;\n pub mod serve;\n pub mod setup;"}, {"sha": "dfd16f7105438c3b8df74cf26b875e8491509675", "filename": "clippy_dev/src/lint.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flint.rs?ref=b5bae091849dc02b7aded5026cf1e2b5497db318", "patch": "@@ -0,0 +1,20 @@\n+use std::process::{self, Command};\n+\n+pub fn run(filename: &str) {\n+    let code = Command::new(\"cargo\")\n+        .args([\"run\", \"--bin\", \"clippy-driver\", \"--\"])\n+        .args([\"-L\", \"./target/debug\"])\n+        .args([\"-Z\", \"no-codegen\"])\n+        .args([\"--edition\", \"2021\"])\n+        .arg(filename)\n+        .env(\"__CLIPPY_INTERNAL_TESTS\", \"true\")\n+        .status()\n+        .expect(\"failed to run cargo\")\n+        .code();\n+\n+    if code.is_none() {\n+        eprintln!(\"Killed by signal\");\n+    }\n+\n+    process::exit(code.unwrap_or(1));\n+}"}, {"sha": "30a241c8ba151e1cfa3b1385156f13ddd892eb06", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5bae091849dc02b7aded5026cf1e2b5497db318/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=b5bae091849dc02b7aded5026cf1e2b5497db318", "patch": "@@ -3,7 +3,7 @@\n #![warn(rust_2018_idioms, unused_lifetimes)]\n \n use clap::{App, AppSettings, Arg, ArgMatches, SubCommand};\n-use clippy_dev::{bless, fmt, new_lint, serve, setup, update_lints};\n+use clippy_dev::{bless, fmt, lint, new_lint, serve, setup, update_lints};\n fn main() {\n     let matches = get_clap_config();\n \n@@ -55,6 +55,10 @@ fn main() {\n             let lint = matches.value_of(\"lint\");\n             serve::run(port, lint);\n         },\n+        (\"lint\", Some(matches)) => {\n+            let filename = matches.value_of(\"filename\").unwrap();\n+            lint::run(filename);\n+        },\n         _ => {},\n     }\n }\n@@ -219,5 +223,14 @@ fn get_clap_config<'a>() -> ArgMatches<'a> {\n                 )\n                 .arg(Arg::with_name(\"lint\").help(\"Which lint's page to load initially (optional)\")),\n         )\n+        .subcommand(\n+            SubCommand::with_name(\"lint\")\n+                .about(\"Manually run clippy on a file\")\n+                .arg(\n+                    Arg::with_name(\"filename\")\n+                        .required(true)\n+                        .help(\"The path to a file to lint\"),\n+                ),\n+        )\n         .get_matches()\n }"}, {"sha": "380adcaafc1941871c8df17075120deea4070eb7", "filename": "doc/adding_lints.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b5bae091849dc02b7aded5026cf1e2b5497db318/doc%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/b5bae091849dc02b7aded5026cf1e2b5497db318/doc%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Fadding_lints.md?ref=b5bae091849dc02b7aded5026cf1e2b5497db318", "patch": "@@ -157,7 +157,7 @@ Manually testing against an example file can be useful if you have added some\n your local modifications, run\n \n ```\n-env __CLIPPY_INTERNAL_TESTS=true cargo run --bin clippy-driver -- -L ./target/debug input.rs\n+cargo dev lint input.rs\n ```\n \n from the working copy root. With tests in place, let's have a look at"}]}