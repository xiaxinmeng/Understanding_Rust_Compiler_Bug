{"sha": "9125fbfd60afd9dafca843857498232503be365a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxMjVmYmZkNjBhZmQ5ZGFmY2E4NDM4NTc0OTgyMzI1MDNiZTM2NWE=", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-01T11:55:03Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-09-09T05:21:29Z"}, "message": "Do not lint for ~const Drop bounds", "tree": {"sha": "887e956f4caeba59f4b137d57d73df431729777a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/887e956f4caeba59f4b137d57d73df431729777a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9125fbfd60afd9dafca843857498232503be365a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEQ7Fl7qPq2YcWF1dqAn35M4hird0FAmE5mdkACgkQAn35M4hi\nrd1RQg/+K7pHDDtoRQ+kekOd+TmERc4XFvpbQXlH2bIwfjYuApqOIF2Q0RC/1FQ8\nz0F4SZ5owMHwM7TKTpIywmLQh6BnC4aUdRweGVf6C+K2vROXrzM+ZR32FYQrfDOS\n+RsP/2Mvkxy22dCJknlb4mrEWLsFcP5e674heNTJRkPrBgQQVjkCqz15rbQ2/TVL\ndHh04gItTewz4d6TKrambJQe5tA3ED8ADYUVgFwZyPWuWLsuCSYxQZ2BMl2Tfzy0\nxqqWGa2miB+/PvG5tKR3JifvZ+/G3o/8K2yliHSnhh1MVecbl5aocHC80jShZ8E+\nLPMau+pNRdi2DwVDpMLIqUyga+ldg3iUTUo9TVNLuKB9iEsghhE+w8SBP4cx92rM\nD/yNf33+hMvkza/XRnjlnFRdZUX36whmBPNCuuzWaGJ4N68cGDysVxTrBHRystQw\n0m05Qa4hTe9AItfAQ7KCb9oJqUBdDkWM3DhNHlkex3EcvjV4O1hiJ6i4L99nMhNZ\nudnpv38AV/8YuEw5bN6lRtLIPwL1wJQ5MNMoZA9N6X02J6coMHvjOX1jjJyik4I2\nN6DL5xQWj2h1InZsB14iJo7lkB8M0ZdoJyuLcy4hTzErY2ZTvzpu9lSFyDydV7I3\nDXkJE20gjEKBXYBDpG7UAdM+TM6V5yRY7lf4UOJCnpsglqcShfI=\n=5+2H\n-----END PGP SIGNATURE-----", "payload": "tree 887e956f4caeba59f4b137d57d73df431729777a\nparent 104e40fb740155f7dbd471f1550800ae458c672b\nauthor Deadbeef <ent3rm4n@gmail.com> 1630497303 +0000\ncommitter Deadbeef <ent3rm4n@gmail.com> 1631164889 +0000\n\nDo not lint for ~const Drop bounds\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9125fbfd60afd9dafca843857498232503be365a", "html_url": "https://github.com/rust-lang/rust/commit/9125fbfd60afd9dafca843857498232503be365a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9125fbfd60afd9dafca843857498232503be365a/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "104e40fb740155f7dbd471f1550800ae458c672b", "url": "https://api.github.com/repos/rust-lang/rust/commits/104e40fb740155f7dbd471f1550800ae458c672b", "html_url": "https://github.com/rust-lang/rust/commit/104e40fb740155f7dbd471f1550800ae458c672b"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "ac1b106f73b5287b51927de8653b83f9db8b5515", "filename": "compiler/rustc_lint/src/traits.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9125fbfd60afd9dafca843857498232503be365a/compiler%2Frustc_lint%2Fsrc%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9125fbfd60afd9dafca843857498232503be365a/compiler%2Frustc_lint%2Fsrc%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftraits.rs?ref=9125fbfd60afd9dafca843857498232503be365a", "patch": "@@ -87,13 +87,18 @@ declare_lint_pass!(\n impl<'tcx> LateLintPass<'tcx> for DropTraitConstraints {\n     fn check_item(&mut self, cx: &LateContext<'tcx>, item: &'tcx hir::Item<'tcx>) {\n         use rustc_middle::ty::PredicateKind::*;\n+        use rustc_middle::ty;\n \n         let predicates = cx.tcx.explicit_predicates_of(item.def_id);\n         for &(predicate, span) in predicates.predicates {\n             let trait_predicate = match predicate.kind().skip_binder() {\n                 Trait(trait_predicate) => trait_predicate,\n                 _ => continue,\n             };\n+            if trait_predicate.constness == ty::BoundConstness::ConstIfConst {\n+                // `~const Drop` definitely have meanings so avoid linting here.\n+                continue\n+            }\n             let def_id = trait_predicate.trait_ref.def_id;\n             if cx.tcx.lang_items().drop_trait() == Some(def_id) {\n                 // Explicitly allow `impl Drop`, a drop-guards-as-Voldemort-type pattern."}]}