{"sha": "3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "node_id": "C_kwDOAAsO6NoAKDNkMThmOTQ1Y2FiMTdjOThhMmQ0YmVkZDE3NGM0N2EyNGVjZmU4ZjQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-05T07:25:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-05T07:25:18Z"}, "message": "Auto merge of #96630 - m-ysk:fix/issue-88038, r=notriddle\n\nInclude nonexported macro_rules! macros in the doctest target\n\nFixes #88038\n\nThis PR aims to include nonexported `macro_rules!` macros in the doctest target. For more details, please see the above issue.", "tree": {"sha": "e9588af9efd9a61b21b717639027cae76649dca3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9588af9efd9a61b21b717639027cae76649dca3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "html_url": "https://github.com/rust-lang/rust/commit/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12d3f107c1634ed41a800e220ccf99b665d906d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/12d3f107c1634ed41a800e220ccf99b665d906d8", "html_url": "https://github.com/rust-lang/rust/commit/12d3f107c1634ed41a800e220ccf99b665d906d8"}, {"sha": "4698a3fb8a35994f5532d208ad060f2985ed1427", "url": "https://api.github.com/repos/rust-lang/rust/commits/4698a3fb8a35994f5532d208ad060f2985ed1427", "html_url": "https://github.com/rust-lang/rust/commit/4698a3fb8a35994f5532d208ad060f2985ed1427"}], "stats": {"total": 14, "additions": 2, "deletions": 12}, "files": [{"sha": "5d4c9ba73951a6d0026699b5cb7d8bd323dcd389", "filename": "library/core/src/internal_macros.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/library%2Fcore%2Fsrc%2Finternal_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/library%2Fcore%2Fsrc%2Finternal_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Finternal_macros.rs?ref=3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "patch": "@@ -190,7 +190,7 @@ macro_rules! impl_fn_for_zst {\n ///\n /// # Example\n ///\n-/// ```\n+/// ```ignore(cannot-test-this-because-non-exported-macro)\n /// cfg_if! {\n ///     if #[cfg(unix)] {\n ///         fn foo() { /* unix specific functionality */ }"}, {"sha": "93ccf60a1de455278d4fe6db8c2fea8891611638", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "patch": "@@ -1225,16 +1225,6 @@ impl<'a, 'hir, 'tcx> intravisit::Visitor<'hir> for HirCollector<'a, 'hir, 'tcx>\n \n     fn visit_item(&mut self, item: &'hir hir::Item<'_>) {\n         let name = match &item.kind {\n-            hir::ItemKind::Macro(ref macro_def, _) => {\n-                // FIXME(#88038): Non exported macros have historically not been tested,\n-                // but we really ought to start testing them.\n-                let def_id = item.def_id.to_def_id();\n-                if macro_def.macro_rules && !self.tcx.has_attr(def_id, sym::macro_export) {\n-                    intravisit::walk_item(self, item);\n-                    return;\n-                }\n-                item.ident.to_string()\n-            }\n             hir::ItemKind::Impl(impl_) => {\n                 rustc_hir_pretty::id_to_string(&self.map, impl_.self_ty.hir_id)\n             }"}, {"sha": "dfc70237821a1676211c3a33241adb377884f92f", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d18f945cab17c98a2d4bedd174c47a24ecfe8f4/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=3d18f945cab17c98a2d4bedd174c47a24ecfe8f4", "patch": "@@ -95,7 +95,7 @@ use crate::passes::collect_intra_doc_links;\n ///\n /// Example:\n ///\n-/// ```\n+/// ```ignore(cannot-test-this-because-non-exported-macro)\n /// let letters = map!{\"a\" => \"b\", \"c\" => \"d\"};\n /// ```\n ///"}]}