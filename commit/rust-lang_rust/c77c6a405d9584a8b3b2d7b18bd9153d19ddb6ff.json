{"sha": "c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3N2M2YTQwNWQ5NTg0YThiM2IyZDdiMThiZDkxNTNkMTlkZGI2ZmY=", "commit": {"author": {"name": "hafiz", "email": "20735482+ayazhafiz@users.noreply.github.com", "date": "2020-05-10T11:54:46Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2020-11-29T19:26:58Z"}, "message": "Compare code block line indentation with config whitespace (#4166)\n\nPreviously the indetation of a line was compared with the configured\nnumber of spaces per tab, which could cause lines that were formatted\nwith hard tabs not to be recognized as indented (\"\\t\".len() < \"    \".len()).\n\nCloses #4152", "tree": {"sha": "d882c32e03b22ab92dedbb82b084b641a3969912", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d882c32e03b22ab92dedbb82b084b641a3969912"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "html_url": "https://github.com/rust-lang/rust/commit/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff/comments", "author": {"login": "ayazhafiz", "id": 20735482, "node_id": "MDQ6VXNlcjIwNzM1NDgy", "avatar_url": "https://avatars.githubusercontent.com/u/20735482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ayazhafiz", "html_url": "https://github.com/ayazhafiz", "followers_url": "https://api.github.com/users/ayazhafiz/followers", "following_url": "https://api.github.com/users/ayazhafiz/following{/other_user}", "gists_url": "https://api.github.com/users/ayazhafiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ayazhafiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ayazhafiz/subscriptions", "organizations_url": "https://api.github.com/users/ayazhafiz/orgs", "repos_url": "https://api.github.com/users/ayazhafiz/repos", "events_url": "https://api.github.com/users/ayazhafiz/events{/privacy}", "received_events_url": "https://api.github.com/users/ayazhafiz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7ecdc16642a364725f13d472dd99b707a47954b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7ecdc16642a364725f13d472dd99b707a47954b", "html_url": "https://github.com/rust-lang/rust/commit/e7ecdc16642a364725f13d472dd99b707a47954b"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "da83b285a21c55743e4c9df9f5d478ac0c1956a6", "filename": "src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "patch": "@@ -371,6 +371,7 @@ fn format_code_block(\n         .rfind('}')\n         .unwrap_or_else(|| formatted.snippet.len());\n     let mut is_indented = true;\n+    let indent_str = Indent::from_width(config, config.tab_spaces()).to_string(config);\n     for (kind, ref line) in LineClasses::new(&formatted.snippet[FN_MAIN_PREFIX.len()..block_len]) {\n         if !is_first {\n             result.push('\\n');\n@@ -385,9 +386,8 @@ fn format_code_block(\n             // are too long, or we have failed to format code block. We will be\n             // conservative and just return `None` in this case.\n             return None;\n-        } else if line.len() > config.tab_spaces() {\n+        } else if line.len() > indent_str.len() {\n             // Make sure that the line has leading whitespaces.\n-            let indent_str = Indent::from_width(config, config.tab_spaces()).to_string(config);\n             if line.starts_with(indent_str.as_ref()) {\n                 let offset = if config.hard_tabs() {\n                     1"}, {"sha": "80f9ff5e30437971f96a4bbb305af0f994eec689", "filename": "tests/target/issue-4152.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff/tests%2Ftarget%2Fissue-4152.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff/tests%2Ftarget%2Fissue-4152.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-4152.rs?ref=c77c6a405d9584a8b3b2d7b18bd9153d19ddb6ff", "patch": "@@ -0,0 +1,18 @@\n+// rustfmt-hard_tabs: true\n+\n+macro_rules! bit {\n+\t($bool:expr) => {\n+\t\tif $bool {\n+\t\t\t1;\n+\t\t\t1\n+\t\t} else {\n+\t\t\t0;\n+\t\t\t0\n+\t\t}\n+\t};\n+}\n+macro_rules! add_one {\n+\t($vec:expr) => {{\n+\t\t$vec.push(1);\n+\t}};\n+}"}]}