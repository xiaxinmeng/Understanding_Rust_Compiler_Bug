{"sha": "c8e0f4d90b474492485e869be81b0d452dbe1926", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4ZTBmNGQ5MGI0NzQ0OTI0ODVlODY5YmU4MWIwZDQ1MmRiZTE5MjY=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-10-26T02:09:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-26T02:09:13Z"}, "message": "Rollup merge of #78295 - Alexendoo:ice-regression-tests, r=nagisa\n\nAdd some regression tests\n\nCloses #56229\nCloses #59494\nCloses #70746\nCloses #73229", "tree": {"sha": "bccaf3ca627242b41c113429e39402a65c6a0e4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bccaf3ca627242b41c113429e39402a65c6a0e4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8e0f4d90b474492485e869be81b0d452dbe1926", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfli/JCRBK7hj4Ov3rIwAAdHIIAA1WGD/Pv4tKD7M+e7Ext5us\n8BPcQ/zpLxW/j6VaFoGz5osfNlPPkwORil8YpUMotqWdSypIJIRCjXuCpA/A7fna\nmQcQRw27vC6fUFDhVS4pn92T9O5OPFIVsWJOcVHqX+sjeNNSw6YMtzf58mvjIpMl\npAcp7M+sHy4Z7bI9PBVOFIczvBH8IbIK75h+Z83IzROdOebu22ZHtNUYChJsYsPp\nN36j5aMjOktpa/un8p/To1WZNNsbQOufcT2uePRnVxSJWf+GK7ipBfOa396yr7b1\nuAQhJKdIolj4VGSnrmPYSZgNUWhFa3PxHjrHMYNhvH0X+Ny4f50fmQG1iAt3DCk=\n=ShRp\n-----END PGP SIGNATURE-----\n", "payload": "tree bccaf3ca627242b41c113429e39402a65c6a0e4b\nparent 463b6cc0e110dad1cb32887b85c2a77702e7b78f\nparent 75bbd80c098c240ffe0f97f50670e4cb66dc59c3\nauthor Dylan DPC <dylan.dpc@gmail.com> 1603678153 +0100\ncommitter GitHub <noreply@github.com> 1603678153 +0100\n\nRollup merge of #78295 - Alexendoo:ice-regression-tests, r=nagisa\n\nAdd some regression tests\n\nCloses #56229\nCloses #59494\nCloses #70746\nCloses #73229\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8e0f4d90b474492485e869be81b0d452dbe1926", "html_url": "https://github.com/rust-lang/rust/commit/c8e0f4d90b474492485e869be81b0d452dbe1926", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8e0f4d90b474492485e869be81b0d452dbe1926/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "463b6cc0e110dad1cb32887b85c2a77702e7b78f", "url": "https://api.github.com/repos/rust-lang/rust/commits/463b6cc0e110dad1cb32887b85c2a77702e7b78f", "html_url": "https://github.com/rust-lang/rust/commit/463b6cc0e110dad1cb32887b85c2a77702e7b78f"}, {"sha": "75bbd80c098c240ffe0f97f50670e4cb66dc59c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/75bbd80c098c240ffe0f97f50670e4cb66dc59c3", "html_url": "https://github.com/rust-lang/rust/commit/75bbd80c098c240ffe0f97f50670e4cb66dc59c3"}], "stats": {"total": 134, "additions": 134, "deletions": 0}, "files": [{"sha": "9e5897b98925aa3b0d63d72de0224f50096fa573", "filename": "src/test/ui/issues/issue-56229.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-56229.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-56229.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56229.rs?ref=c8e0f4d90b474492485e869be81b0d452dbe1926", "patch": "@@ -0,0 +1,35 @@\n+// check-pass\n+\n+trait Mirror {\n+    type Other;\n+}\n+\n+#[derive(Debug)]\n+struct Even(usize);\n+struct Odd;\n+\n+impl Mirror for Even {\n+    type Other = Odd;\n+}\n+\n+impl Mirror for Odd {\n+    type Other = Even;\n+}\n+\n+trait Dyn<T: Mirror>: AsRef<<T as Mirror>::Other> {}\n+\n+impl Dyn<Odd> for Even {}\n+\n+impl AsRef<Even> for Even {\n+    fn as_ref(&self) -> &Even {\n+        self\n+    }\n+}\n+\n+fn code<T: Mirror>(d: &dyn Dyn<T>) -> &T::Other {\n+    d.as_ref()\n+}\n+\n+fn main() {\n+    println!(\"{:?}\", code(&Even(22)));\n+}"}, {"sha": "06b8eb777c035198993ad7573cbf24b6f7ee7ddc", "filename": "src/test/ui/issues/issue-59494.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-59494.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-59494.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-59494.rs?ref=c8e0f4d90b474492485e869be81b0d452dbe1926", "patch": "@@ -0,0 +1,23 @@\n+fn t7p<A, B, C>(f: impl Fn(B) -> C, g: impl Fn(A) -> B) -> impl Fn(A) -> C {\n+    move |a: A| -> C { f(g(a)) }\n+}\n+\n+fn t8n<A, B, C>(f: impl Fn(A) -> B, g: impl Fn(A) -> C) -> impl Fn(A) -> (B, C)\n+where\n+    A: Copy,\n+{\n+    move |a: A| -> (B, C) {\n+        let b = a;\n+        let fa = f(a);\n+        let ga = g(b);\n+        (fa, ga)\n+    }\n+}\n+\n+fn main() {\n+    let f = |(_, _)| {};\n+    let g = |(a, _)| a;\n+    let t7 = |env| |a| |b| t7p(f, g)(((env, a), b));\n+    let t8 = t8n(t7, t7p(f, g));\n+    //~^ ERROR: expected a `Fn<(_,)>` closure, found `impl Fn<(((_, _), _),)>\n+}"}, {"sha": "e2ac5d94da1088b7c9464704a2d9a07db0cd6ba8", "filename": "src/test/ui/issues/issue-59494.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-59494.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-59494.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-59494.stderr?ref=c8e0f4d90b474492485e869be81b0d452dbe1926", "patch": "@@ -0,0 +1,14 @@\n+error[E0277]: expected a `Fn<(_,)>` closure, found `impl Fn<(((_, _), _),)>`\n+  --> $DIR/issue-59494.rs:21:22\n+   |\n+LL | fn t8n<A, B, C>(f: impl Fn(A) -> B, g: impl Fn(A) -> C) -> impl Fn(A) -> (B, C)\n+   |                                             ---------- required by this bound in `t8n`\n+...\n+LL |     let t8 = t8n(t7, t7p(f, g));\n+   |                      ^^^^^^^^^ expected an `Fn<(_,)>` closure, found `impl Fn<(((_, _), _),)>`\n+   |\n+   = help: the trait `Fn<(_,)>` is not implemented for `impl Fn<(((_, _), _),)>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "8930c15f57edcacf9d38c1a2f28f1d99d3a20814", "filename": "src/test/ui/issues/issue-70746.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-70746.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-70746.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-70746.rs?ref=c8e0f4d90b474492485e869be81b0d452dbe1926", "patch": "@@ -0,0 +1,29 @@\n+// check-pass\n+\n+pub trait Trait1 {\n+    type C;\n+}\n+\n+struct T1;\n+impl Trait1 for T1 {\n+    type C = usize;\n+}\n+pub trait Callback<T: Trait1>: FnMut(<T as Trait1>::C) {}\n+impl<T: Trait1, F: FnMut(<T as Trait1>::C)> Callback<T> for F {}\n+\n+pub struct State<T: Trait1> {\n+    callback: Option<Box<dyn Callback<T>>>,\n+}\n+impl<T: Trait1> State<T> {\n+    fn new() -> Self {\n+        Self { callback: None }\n+    }\n+    fn test_cb(&mut self, d: <T as Trait1>::C) {\n+        (self.callback.as_mut().unwrap())(d)\n+    }\n+}\n+\n+fn main() {\n+    let mut s = State::<T1>::new();\n+    s.test_cb(1);\n+}"}, {"sha": "35346199add927b76d35cd2087e245942db0d7ba", "filename": "src/test/ui/issues/issue-73229.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-73229.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8e0f4d90b474492485e869be81b0d452dbe1926/src%2Ftest%2Fui%2Fissues%2Fissue-73229.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-73229.rs?ref=c8e0f4d90b474492485e869be81b0d452dbe1926", "patch": "@@ -0,0 +1,33 @@\n+// check-pass\n+\n+fn any<T>() -> T {\n+    loop {}\n+}\n+\n+trait Foo {\n+    type V;\n+}\n+\n+trait Callback<T: Foo>: Fn(&T, &T::V) {}\n+impl<T: Foo, F: Fn(&T, &T::V)> Callback<T> for F {}\n+\n+struct Bar<T: Foo> {\n+    callback: Box<dyn Callback<T>>,\n+}\n+\n+impl<T: Foo> Bar<T> {\n+    fn event(&self) {\n+        (self.callback)(any(), any());\n+    }\n+}\n+\n+struct A;\n+struct B;\n+impl Foo for A {\n+    type V = B;\n+}\n+\n+fn main() {\n+    let foo = Bar::<A> { callback: Box::new(|_: &A, _: &B| ()) };\n+    foo.event();\n+}"}]}