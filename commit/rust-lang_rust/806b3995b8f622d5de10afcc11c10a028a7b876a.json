{"sha": "806b3995b8f622d5de10afcc11c10a028a7b876a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwNmIzOTk1YjhmNjIyZDVkZTEwYWZjYzExYzEwYTAyOGE3Yjg3NmE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-17T14:02:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-17T14:02:55Z"}, "message": "Auto merge of #88056 - erikdesjardins:revertzst, r=oli-obk\n\nRevert \"Auto merge of #83417 - erikdesjardins:enableremovezsts, r=oli-obk\"\n\nThis reverts commit 8007b506ac5da629f223b755f5a5391edd5f6d01, reversing changes made to e55c13e1099b78b1a485202fabc9c1b10b1f1d15.\n\nFixes #88043\n\nr? `@oli-obk`", "tree": {"sha": "f95ea48cdaf6dfe66c793d3d6b8025561d3809be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f95ea48cdaf6dfe66c793d3d6b8025561d3809be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/806b3995b8f622d5de10afcc11c10a028a7b876a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/806b3995b8f622d5de10afcc11c10a028a7b876a", "html_url": "https://github.com/rust-lang/rust/commit/806b3995b8f622d5de10afcc11c10a028a7b876a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/806b3995b8f622d5de10afcc11c10a028a7b876a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa8f27bf4d980023a8b245ceb25a490a18041eb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa8f27bf4d980023a8b245ceb25a490a18041eb2", "html_url": "https://github.com/rust-lang/rust/commit/aa8f27bf4d980023a8b245ceb25a490a18041eb2"}, {"sha": "b865a761cbc2cfdffbcb1f60607da73172bc9772", "url": "https://api.github.com/repos/rust-lang/rust/commits/b865a761cbc2cfdffbcb1f60607da73172bc9772", "html_url": "https://github.com/rust-lang/rust/commit/b865a761cbc2cfdffbcb1f60607da73172bc9772"}], "stats": {"total": 102, "additions": 81, "deletions": 21}, "files": [{"sha": "40b1a8a2da9fa80b45ebbb1cd41764564ed9a32d", "filename": "compiler/rustc_mir/src/transform/remove_zsts.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fremove_zsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fremove_zsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fremove_zsts.rs?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -9,6 +9,9 @@ pub struct RemoveZsts;\n \n impl<'tcx> MirPass<'tcx> for RemoveZsts {\n     fn run_pass(&self, tcx: TyCtxt<'tcx>, body: &mut Body<'tcx>) {\n+        if tcx.sess.mir_opt_level() < 3 {\n+            return;\n+        }\n         let param_env = tcx.param_env(body.source.def_id());\n         let (basic_blocks, local_decls) = body.basic_blocks_and_local_decls_mut();\n         for block in basic_blocks.iter_mut() {"}, {"sha": "c9a3de1f6ae4d7e433feea01180097354821a5de", "filename": "src/test/incremental/hashes/trait_impls.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fincremental%2Fhashes%2Ftrait_impls.rs?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -62,7 +62,7 @@ impl ChangeMethodBodyTrait for Foo {\n #[rustc_clean(cfg=\"cfail2\")]\n #[rustc_clean(cfg=\"cfail3\")]\n impl ChangeMethodBodyTrait for Foo {\n-    #[rustc_clean(except=\"hir_owner_nodes,typeck\", cfg=\"cfail2\")]\n+    #[rustc_clean(except=\"hir_owner_nodes,typeck,optimized_mir\", cfg=\"cfail2\")]\n     #[rustc_clean(cfg=\"cfail3\")]\n     fn method_name() {\n         ()"}, {"sha": "19af626c49fda0b4a681cef7bbf705e75a607cf1", "filename": "src/test/mir-opt/const_prop/control_flow_simplification.hello.ConstProp.diff", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.ConstProp.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -29,7 +29,7 @@\n       }\n   \n       bb2: {\n-          nop;                             // scope 0 at $DIR/control-flow-simplification.rs:14:6: 14:6\n+          _0 = const ();                   // scope 0 at $DIR/control-flow-simplification.rs:14:6: 14:6\n           StorageDead(_1);                 // scope 0 at $DIR/control-flow-simplification.rs:14:5: 14:6\n           return;                          // scope 0 at $DIR/control-flow-simplification.rs:15:2: 15:2\n       }"}, {"sha": "c2f75e5daeeb22179c46f4cc946d41583100efda", "filename": "src/test/mir-opt/const_prop/control_flow_simplification.hello.PreCodegen.before.mir", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.PreCodegen.before.mir", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.PreCodegen.before.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fcontrol_flow_simplification.hello.PreCodegen.before.mir?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -4,6 +4,7 @@ fn hello() -> () {\n     let mut _0: ();                      // return place in scope 0 at $DIR/control-flow-simplification.rs:11:14: 11:14\n \n     bb0: {\n+        _0 = const ();                   // scope 0 at $DIR/control-flow-simplification.rs:14:6: 14:6\n         return;                          // scope 0 at $DIR/control-flow-simplification.rs:15:2: 15:2\n     }\n }"}, {"sha": "8793af5c074d5dfb44c3ee7a2332eb2ab6d9a028", "filename": "src/test/mir-opt/remove_unneeded_drops.cannot_opt_generic.RemoveUnneededDrops.diff", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.cannot_opt_generic.RemoveUnneededDrops.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.cannot_opt_generic.RemoveUnneededDrops.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.cannot_opt_generic.RemoveUnneededDrops.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -14,6 +14,7 @@\n           StorageLive(_2);                 // scope 0 at $DIR/remove_unneeded_drops.rs:21:5: 21:12\n           StorageLive(_3);                 // scope 0 at $DIR/remove_unneeded_drops.rs:21:10: 21:11\n           _3 = move _1;                    // scope 0 at $DIR/remove_unneeded_drops.rs:21:10: 21:11\n+          nop;                             // scope 1 at $DIR/remove_unneeded_drops.rs:21:5: 21:12\n           drop(_3) -> [return: bb2, unwind: bb1]; // scope 1 at $DIR/remove_unneeded_drops.rs:21:5: 21:12\n       }\n   "}, {"sha": "2377abdb153ba9659a1fb4d301ee9c452d9a941c", "filename": "src/test/mir-opt/remove_unneeded_drops.dont_opt.RemoveUnneededDrops.diff", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.dont_opt.RemoveUnneededDrops.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.dont_opt.RemoveUnneededDrops.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.dont_opt.RemoveUnneededDrops.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -14,6 +14,7 @@\n           StorageLive(_2);                 // scope 0 at $DIR/remove_unneeded_drops.rs:9:5: 9:12\n           StorageLive(_3);                 // scope 0 at $DIR/remove_unneeded_drops.rs:9:10: 9:11\n           _3 = move _1;                    // scope 0 at $DIR/remove_unneeded_drops.rs:9:10: 9:11\n+          nop;                             // scope 1 at $DIR/remove_unneeded_drops.rs:9:5: 9:12\n           drop(_3) -> [return: bb2, unwind: bb1]; // scope 1 at $DIR/remove_unneeded_drops.rs:9:5: 9:12\n       }\n   "}, {"sha": "75bd732e3c03a8ffdfc3cc32eea45c2605f66ba9", "filename": "src/test/mir-opt/remove_unneeded_drops.opt.RemoveUnneededDrops.diff", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt.RemoveUnneededDrops.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt.RemoveUnneededDrops.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt.RemoveUnneededDrops.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -14,6 +14,7 @@\n           StorageLive(_2);                 // scope 0 at $DIR/remove_unneeded_drops.rs:4:5: 4:12\n           StorageLive(_3);                 // scope 0 at $DIR/remove_unneeded_drops.rs:4:10: 4:11\n           _3 = _1;                         // scope 0 at $DIR/remove_unneeded_drops.rs:4:10: 4:11\n+-         nop;                             // scope 1 at $DIR/remove_unneeded_drops.rs:4:5: 4:12\n -         drop(_3) -> bb1;                 // scope 1 at $DIR/remove_unneeded_drops.rs:4:5: 4:12\n -     }\n - "}, {"sha": "b3da2cfb24c75bae268602156feaac60f7ac8250", "filename": "src/test/mir-opt/remove_unneeded_drops.opt_generic_copy.RemoveUnneededDrops.diff", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt_generic_copy.RemoveUnneededDrops.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt_generic_copy.RemoveUnneededDrops.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fremove_unneeded_drops.opt_generic_copy.RemoveUnneededDrops.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -14,6 +14,7 @@\n           StorageLive(_2);                 // scope 0 at $DIR/remove_unneeded_drops.rs:14:5: 14:12\n           StorageLive(_3);                 // scope 0 at $DIR/remove_unneeded_drops.rs:14:10: 14:11\n           _3 = _1;                         // scope 0 at $DIR/remove_unneeded_drops.rs:14:10: 14:11\n+-         nop;                             // scope 1 at $DIR/remove_unneeded_drops.rs:14:5: 14:12\n -         drop(_3) -> bb1;                 // scope 1 at $DIR/remove_unneeded_drops.rs:14:5: 14:12\n -     }\n - "}, {"sha": "49a57832267d1236eb83aef708a977c3ddd1a31a", "filename": "src/test/mir-opt/simplify_locals_fixedpoint.foo.SimplifyLocals.diff", "status": "modified", "additions": 34, "deletions": 15, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_locals_fixedpoint.foo.SimplifyLocals.diff?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -9,8 +9,8 @@\n       let mut _4: isize;                   // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:22: 4:26\n       let mut _5: isize;                   // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:13: 4:20\n       let _6: u8;                          // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:18: 4:19\n--     let mut _7: bool;                    // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n--     let mut _8: u8;                      // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n+      let mut _7: bool;                    // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n+      let mut _8: u8;                      // in scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n       scope 1 {\n           debug a => _6;                   // in scope 1 at $DIR/simplify-locals-fixedpoint.rs:4:18: 4:19\n       }\n@@ -26,32 +26,51 @@\n           StorageDead(_3);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:68: 4:69\n           StorageDead(_2);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:68: 4:69\n           _5 = discriminant((_1.0: std::option::Option<u8>)); // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:13: 4:20\n-          switchInt(move _5) -> [1_isize: bb1, otherwise: bb3]; // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:13: 4:20\n+          switchInt(move _5) -> [1_isize: bb2, otherwise: bb1]; // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:13: 4:20\n       }\n   \n       bb1: {\n-          _4 = discriminant((_1.1: std::option::Option<T>)); // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:22: 4:26\n-          switchInt(move _4) -> [0_isize: bb2, otherwise: bb3]; // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:22: 4:26\n+          _0 = const ();                   // scope 0 at $DIR/simplify-locals-fixedpoint.rs:8:6: 8:6\n+          goto -> bb7;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:5: 8:6\n       }\n   \n       bb2: {\n+          _4 = discriminant((_1.1: std::option::Option<T>)); // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:22: 4:26\n+          switchInt(move _4) -> [0_isize: bb3, otherwise: bb1]; // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:22: 4:26\n+      }\n+  \n+      bb3: {\n           StorageLive(_6);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:18: 4:19\n           _6 = (((_1.0: std::option::Option<u8>) as Some).0: u8); // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:18: 4:19\n--         StorageLive(_7);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n--         StorageLive(_8);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n--         _8 = _6;                         // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n--         _7 = Gt(move _8, const 42_u8);   // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n--         StorageDead(_8);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:19: 5:20\n--         StorageDead(_7);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:7:9: 7:10\n-          goto -> bb3;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:5: 8:6\n+          StorageLive(_7);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n+          StorageLive(_8);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n+          _8 = _6;                         // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:13\n+          _7 = Gt(move _8, const 42_u8);   // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:12: 5:20\n+          StorageDead(_8);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:19: 5:20\n+          switchInt(move _7) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n       }\n   \n-      bb3: {\n+      bb4: {\n+          _0 = const ();                   // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:21: 7:10\n+          goto -> bb6;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n+      }\n+  \n+      bb5: {\n+          _0 = const ();                   // scope 0 at $DIR/simplify-locals-fixedpoint.rs:7:10: 7:10\n+          goto -> bb6;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:5:9: 7:10\n+      }\n+  \n+      bb6: {\n+          StorageDead(_7);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:7:9: 7:10\n+          goto -> bb7;                     // scope 0 at $DIR/simplify-locals-fixedpoint.rs:4:5: 8:6\n+      }\n+  \n+      bb7: {\n           StorageDead(_6);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:8:5: 8:6\n-          drop(_1) -> bb4;                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:9:1: 9:2\n+          drop(_1) -> bb8;                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:9:1: 9:2\n       }\n   \n-      bb4: {\n+      bb8: {\n           StorageDead(_1);                 // scope 0 at $DIR/simplify-locals-fixedpoint.rs:9:1: 9:2\n           return;                          // scope 0 at $DIR/simplify-locals-fixedpoint.rs:9:2: 9:2\n       }"}, {"sha": "45d018cf305c615d1dbc372f40bb15c6d66a03bf", "filename": "src/test/run-make/const_fn_mir/dump.mir", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Frun-make%2Fconst_fn_mir%2Fdump.mir", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Frun-make%2Fconst_fn_mir%2Fdump.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fconst_fn_mir%2Fdump.mir?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -12,6 +12,7 @@ fn main() -> () {\n     }\n \n     bb1: {\n+        _0 = const ();                   // scope 0 at main.rs:8:11: 10:2\n         return;                          // scope 0 at main.rs:10:2: 10:2\n     }\n }"}, {"sha": "1a6aadc662bbdb30286ef39bc87cc0be0922b4db", "filename": "src/test/ui/codegen/issue-88043-bb-does-not-have-terminator.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fcodegen%2Fissue-88043-bb-does-not-have-terminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fcodegen%2Fissue-88043-bb-does-not-have-terminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodegen%2Fissue-88043-bb-does-not-have-terminator.rs?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -0,0 +1,25 @@\n+// build-pass\n+// compile-flags: -Copt-level=0\n+\n+// Regression test for #88043: LLVM crash when the RemoveZsts mir-opt pass is enabled.\n+// We should not see the error:\n+// `Basic Block in function '_ZN4main10take_until17h0067b8a660429bc9E' does not have terminator!`\n+\n+fn bump() -> Option<usize> {\n+    unreachable!()\n+}\n+\n+fn take_until(terminate: impl Fn() -> bool) {\n+    loop {\n+        if terminate() {\n+            return;\n+        } else {\n+            bump();\n+        }\n+    }\n+}\n+\n+// CHECK-LABEL: @main\n+fn main() {\n+    take_until(|| true);\n+}"}, {"sha": "78cf25308fff9e637dd3f8cd8d8470e36876a057", "filename": "src/test/ui/consts/const-eval/panic-assoc-never-type.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.rs?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -14,4 +14,5 @@ impl PrintName {\n \n fn main() {\n     let _ = PrintName::VOID;\n+    //~^ ERROR erroneous constant used\n }"}, {"sha": "085609483098b73e8b3182828352331b76bc43ee", "filename": "src/test/ui/consts/const-eval/panic-assoc-never-type.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fpanic-assoc-never-type.stderr?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -6,6 +6,12 @@ LL |     const VOID: ! = panic!();\n    |\n    = note: this error originates in the macro `$crate::panic::panic_2015` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n-error: aborting due to previous error\n+error[E0080]: erroneous constant used\n+  --> $DIR/panic-assoc-never-type.rs:16:13\n+   |\n+LL |     let _ = PrintName::VOID;\n+   |             ^^^^^^^^^^^^^^^ referenced constant has errors\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "7f197a238e5a0f2466d9c857d23bd06154350ddf", "filename": "src/test/ui/recursion/issue-26548-recursion-via-normalize.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Frecursion%2Fissue-26548-recursion-via-normalize.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/806b3995b8f622d5de10afcc11c10a028a7b876a/src%2Ftest%2Fui%2Frecursion%2Fissue-26548-recursion-via-normalize.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frecursion%2Fissue-26548-recursion-via-normalize.stderr?ref=806b3995b8f622d5de10afcc11c10a028a7b876a", "patch": "@@ -1,7 +1,7 @@\n-error[E0391]: cycle detected when computing layout of `std::option::Option<S>`\n+error[E0391]: cycle detected when computing layout of `S`\n    |\n-   = note: ...which requires computing layout of `S`...\n-   = note: ...which again requires computing layout of `std::option::Option<S>`, completing the cycle\n+   = note: ...which requires computing layout of `std::option::Option<S>`...\n+   = note: ...which again requires computing layout of `S`, completing the cycle\n note: cycle used when optimizing MIR for `main`\n   --> $DIR/issue-26548-recursion-via-normalize.rs:15:1\n    |"}]}