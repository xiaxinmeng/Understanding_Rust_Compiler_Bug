{"sha": "967f172e256802f9bf0ad5718d9c761da18132a9", "node_id": "C_kwDOAAsO6NoAKDk2N2YxNzJlMjU2ODAyZjliZjBhZDU3MThkOWM3NjFkYTE4MTMyYTk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-20T15:18:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-20T15:18:31Z"}, "message": "Auto merge of #9635 - smoelius:fix-9386-bug, r=Jarcho\n\nFix bug introduced by #9386\n\n#9386 introduced a potential out-of-bounds array access. Specifically, a location returned by `local_assignments` could have  [`location.statement_index` equal to `mir.basic_blocks[location.block].statements.len()`](https://github.com/rust-lang/rust-clippy/blob/b8a9a507bf9e3149d287841454842116c72d66c4/clippy_utils/src/mir/mod.rs#L129), in which case the location would refer to the block terminator:\nhttps://github.com/rust-lang/rust-clippy/blob/b8a9a507bf9e3149d287841454842116c72d66c4/clippy_lints/src/dereference.rs#L1204-L1206\nI suspect the bug is not triggerable now, because of checks leading up to where it occurs. But a future code change could make it triggerable. Hence, it should be fixed.\n\nr? `@Jarcho`\n\nchangelog: none", "tree": {"sha": "052f0bbd2df748670825025af0c0c261c9928724", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/052f0bbd2df748670825025af0c0c261c9928724"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/967f172e256802f9bf0ad5718d9c761da18132a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/967f172e256802f9bf0ad5718d9c761da18132a9", "html_url": "https://github.com/rust-lang/rust/commit/967f172e256802f9bf0ad5718d9c761da18132a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/967f172e256802f9bf0ad5718d9c761da18132a9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4612fdfa7b183c778e6985c96c06f9bdebe36e2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4612fdfa7b183c778e6985c96c06f9bdebe36e2e", "html_url": "https://github.com/rust-lang/rust/commit/4612fdfa7b183c778e6985c96c06f9bdebe36e2e"}, {"sha": "524ec2e12577d652875c68c3f205e8530451ba48", "url": "https://api.github.com/repos/rust-lang/rust/commits/524ec2e12577d652875c68c3f205e8530451ba48", "html_url": "https://github.com/rust-lang/rust/commit/524ec2e12577d652875c68c3f205e8530451ba48"}], "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "a95d9f5390de3a858420ebcef41243cc39aadc70", "filename": "clippy_lints/src/dereference.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/967f172e256802f9bf0ad5718d9c761da18132a9/clippy_lints%2Fsrc%2Fdereference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/967f172e256802f9bf0ad5718d9c761da18132a9/clippy_lints%2Fsrc%2Fdereference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdereference.rs?ref=967f172e256802f9bf0ad5718d9c761da18132a9", "patch": "@@ -1192,16 +1192,16 @@ fn has_ref_mut_self_method(cx: &LateContext<'_>, trait_def_id: DefId) -> bool {\n         })\n }\n \n-fn referent_used_exactly_once<'a, 'tcx>(\n-    cx: &'a LateContext<'tcx>,\n+fn referent_used_exactly_once<'tcx>(\n+    cx: &LateContext<'tcx>,\n     possible_borrowers: &mut Vec<(LocalDefId, PossibleBorrowerMap<'tcx, 'tcx>)>,\n     reference: &Expr<'tcx>,\n ) -> bool {\n     let mir = enclosing_mir(cx.tcx, reference.hir_id);\n     if let Some(local) = expr_local(cx.tcx, reference)\n         && let [location] = *local_assignments(mir, local).as_slice()\n-        && let StatementKind::Assign(box (_, Rvalue::Ref(_, _, place))) =\n-            mir.basic_blocks[location.block].statements[location.statement_index].kind\n+        && let Some(statement) = mir.basic_blocks[location.block].statements.get(location.statement_index)\n+        && let StatementKind::Assign(box (_, Rvalue::Ref(_, _, place))) = statement.kind\n         && !place.has_deref()\n     {\n         let body_owner_local_def_id = cx.tcx.hir().enclosing_body_owner(reference.hir_id);"}, {"sha": "818e603f665e7d55422db9b3879a7dd1829a566a", "filename": "clippy_utils/src/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/967f172e256802f9bf0ad5718d9c761da18132a9/clippy_utils%2Fsrc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/967f172e256802f9bf0ad5718d9c761da18132a9/clippy_utils%2Fsrc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fmir%2Fmod.rs?ref=967f172e256802f9bf0ad5718d9c761da18132a9", "patch": "@@ -121,8 +121,7 @@ pub fn expr_local(tcx: TyCtxt<'_>, expr: &Expr<'_>) -> Option<Local> {\n     })\n }\n \n-/// Returns a vector of `mir::Location` where `local` is assigned. Each statement referred to has\n-/// kind `StatementKind::Assign`.\n+/// Returns a vector of `mir::Location` where `local` is assigned.\n pub fn local_assignments(mir: &Body<'_>, local: Local) -> Vec<Location> {\n     let mut locations = Vec::new();\n     for (block, data) in mir.basic_blocks.iter_enumerated() {"}]}