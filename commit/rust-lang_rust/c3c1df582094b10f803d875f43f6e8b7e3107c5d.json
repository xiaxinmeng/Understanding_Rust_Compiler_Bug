{"sha": "c3c1df582094b10f803d875f43f6e8b7e3107c5d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzYzFkZjU4MjA5NGIxMGY4MDNkODc1ZjQzZjZlOGI3ZTMxMDdjNWQ=", "commit": {"author": {"name": "Tom Tromey", "email": "tom@tromey.com", "date": "2017-10-03T19:28:57Z"}, "committer": {"name": "Tom Tromey", "email": "tom@tromey.com", "date": "2017-10-06T19:05:53Z"}, "message": "Implement display_hint in gdb pretty printers\n\nA few pretty-printers were returning a quoted string from their\nto_string method.  It's preferable in gdb to return a lazy string and to\nlet gdb handle the display by having a \"display_hint\" method that\nreturns \"string\" -- it lets gdb settings (like \"set print ...\") work, it\nhandles corrupted strings a bit better, and it passes the information\nalong to IDEs.", "tree": {"sha": "219fce4696f60728a31f343dc39dff7b4bf96b90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/219fce4696f60728a31f343dc39dff7b4bf96b90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3c1df582094b10f803d875f43f6e8b7e3107c5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3c1df582094b10f803d875f43f6e8b7e3107c5d", "html_url": "https://github.com/rust-lang/rust/commit/c3c1df582094b10f803d875f43f6e8b7e3107c5d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3c1df582094b10f803d875f43f6e8b7e3107c5d/comments", "author": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8feaee5b6b54c03f49481fe04a9ad9e8f659f7c", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8feaee5b6b54c03f49481fe04a9ad9e8f659f7c", "html_url": "https://github.com/rust-lang/rust/commit/a8feaee5b6b54c03f49481fe04a9ad9e8f659f7c"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "0612873e28153b445964ccaffb52021098ddf915", "filename": "src/etc/gdb_rust_pretty_printing.py", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c3c1df582094b10f803d875f43f6e8b7e3107c5d/src%2Fetc%2Fgdb_rust_pretty_printing.py", "raw_url": "https://github.com/rust-lang/rust/raw/c3c1df582094b10f803d875f43f6e8b7e3107c5d/src%2Fetc%2Fgdb_rust_pretty_printing.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_rust_pretty_printing.py?ref=c3c1df582094b10f803d875f43f6e8b7e3107c5d", "patch": "@@ -248,7 +248,10 @@ def __init__(self, val):\n     def to_string(self):\n         (length, data_ptr) = rustpp.extract_length_and_ptr_from_slice(self.__val)\n         raw_ptr = data_ptr.get_wrapped_value()\n-        return '\"%s\"' % raw_ptr.string(encoding=\"utf-8\", length=length)\n+        return raw_ptr.lazy_string(encoding=\"utf-8\", length=length)\n+\n+    def display_hint(self):\n+        return \"string\"\n \n \n class RustStdVecPrinter(object):\n@@ -278,9 +281,11 @@ def __init__(self, val):\n     def to_string(self):\n         vec = self.__val.get_child_at_index(0)\n         (length, data_ptr, cap) = rustpp.extract_length_ptr_and_cap_from_std_vec(vec)\n-        return '\"%s\"' % data_ptr.get_wrapped_value().string(encoding=\"utf-8\",\n-                                                            length=length)\n+        return data_ptr.get_wrapped_value().lazy_string(encoding=\"utf-8\",\n+                                                        length=length)\n \n+    def display_hint(self):\n+        return \"string\"\n \n class RustOsStringPrinter(object):\n     def __init__(self, val):\n@@ -294,8 +299,10 @@ def to_string(self):\n \n         (length, data_ptr, cap) = rustpp.extract_length_ptr_and_cap_from_std_vec(\n             vec)\n-        return '\"%s\"' % data_ptr.get_wrapped_value().string(length=length)\n+        return data_ptr.get_wrapped_value().lazy_string(length=length)\n \n+    def display_hint(self):\n+        return \"string\"\n \n class RustCStyleVariantPrinter(object):\n     def __init__(self, val):"}, {"sha": "2a28c895b797e2c1eab38159b0133d45c5cce8b7", "filename": "src/test/debuginfo/pretty-std.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c3c1df582094b10f803d875f43f6e8b7e3107c5d/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3c1df582094b10f803d875f43f6e8b7e3107c5d/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fpretty-std.rs?ref=c3c1df582094b10f803d875f43f6e8b7e3107c5d", "patch": "@@ -44,6 +44,10 @@\n // gdb-command: print some_string\n // gdb-check:$8 = Some = {\"IAMA optional string!\"}\n \n+// gdb-command: set print length 5\n+// gdb-command: print some_string\n+// gdb-check:$8 = Some = {\"IAMA \"...}\n+\n \n // === LLDB TESTS ==================================================================================\n "}]}