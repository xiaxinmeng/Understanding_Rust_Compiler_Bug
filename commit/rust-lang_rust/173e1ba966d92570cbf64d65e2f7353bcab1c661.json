{"sha": "173e1ba966d92570cbf64d65e2f7353bcab1c661", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3M2UxYmE5NjZkOTI1NzBjYmY2NGQ2NWUyZjczNTNiY2FiMWM2NjE=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2020-11-23T18:26:35Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-01-02T17:25:39Z"}, "message": "Fix default initialized fields in suggestion\n\nThe default value for a field type does not necessarily match the\ndefault value for that field in the struct Default.", "tree": {"sha": "15f889ec69c01d96127347adcd0441b21831d52c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15f889ec69c01d96127347adcd0441b21831d52c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/173e1ba966d92570cbf64d65e2f7353bcab1c661", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAl/wrJMACgkQHKDfKvWd\naKVbmg//dRmZlRpinLwafE6aLKskMJF8+VBeCpE4fzOqSlLp4y8xgPmwkLLZI6ko\nCf654Relp+3MUdkfBgo6UR3oJfmzty+jum71aDk3y39+a/vP6zNkdH66smu5Ewyy\nxo2Ni+mU4J6pSTC6wnbQx4EzxLXBBclxNmMb4gIILUH7BW9EqiHEODJ1JZJ45aCp\nTdisaWernVI2rqXaA7BqFICEUVXJy72hNQmiq2IOpD/mMDCiZGwuJJ0hBJRvshV4\nEw2UlxGLzZpyN36jyzV/VOmcbshCxiJLVhvyMOUP+4DdwYXZXlbp5uCz2TWdIleR\npzA56j9FBuvgxcxuDcfi7Tm4pRse5p+glBVHQfTbNUlyWd7S9F3S6/MOu4snCQbM\nO0QiLmPWAhnJFdXDamBFIK4aAb1qtge0SyQmlHMUiWQnkaY3/0jPPVMEV6iVezZw\nyPU+g/Gm2V/e21E+XiTNfu2iwAin7X/2eictqS9n7SbmiJFSeto+FzWKafWpGbpp\n42QVeotcz91LeCoMIlKSNMu9bW9Kod03W9X4GEwUjqAk2lH50vOsYsqE00vSz+Fg\nyk29ap7Ezux26ntX5nW64QpF+5V/RcWc238rF8FcvlRf6b9yVkP+7bBvzOgiVT7L\n+Lqrhx8tPcTjz99EyVsv9I3ceTZISmTVQ+HrLjbi8LWILEAUXaw=\n=mnFV\n-----END PGP SIGNATURE-----", "payload": "tree 15f889ec69c01d96127347adcd0441b21831d52c\nparent 4911ab124c481430672a3833b37075e6435ec34d\nauthor Cameron Steffen <cam.steffen94@gmail.com> 1606155995 -0600\ncommitter flip1995 <philipp.krones@embecosm.com> 1609608339 +0100\n\nFix default initialized fields in suggestion\n\nThe default value for a field type does not necessarily match the\ndefault value for that field in the struct Default.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/173e1ba966d92570cbf64d65e2f7353bcab1c661", "html_url": "https://github.com/rust-lang/rust/commit/173e1ba966d92570cbf64d65e2f7353bcab1c661", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/173e1ba966d92570cbf64d65e2f7353bcab1c661/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4911ab124c481430672a3833b37075e6435ec34d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4911ab124c481430672a3833b37075e6435ec34d", "html_url": "https://github.com/rust-lang/rust/commit/4911ab124c481430672a3833b37075e6435ec34d"}], "stats": {"total": 10, "additions": 2, "deletions": 8}, "files": [{"sha": "adcc17266d22e2ea2605a430673567305d5cf54c", "filename": "clippy_lints/src/default.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/173e1ba966d92570cbf64d65e2f7353bcab1c661/clippy_lints%2Fsrc%2Fdefault.rs", "raw_url": "https://github.com/rust-lang/rust/raw/173e1ba966d92570cbf64d65e2f7353bcab1c661/clippy_lints%2Fsrc%2Fdefault.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault.rs?ref=173e1ba966d92570cbf64d65e2f7353bcab1c661", "patch": "@@ -165,12 +165,6 @@ impl LateLintPass<'_> for Default {\n                 let stmt = &block.stmts[stmt_idx];\n \n                 if let StmtKind::Local(preceding_local) = &stmt.kind {\n-                    // filter out fields like `= Default::default()`, because the FRU already covers them\n-                    let assigned_fields = assigned_fields\n-                        .into_iter()\n-                        .filter(|(_, rhs)| !is_expr_default(rhs, cx))\n-                        .collect::<Vec<(Symbol, &Expr<'_>)>>();\n-\n                     // if all fields of the struct are not assigned, add `.. Default::default()` to the suggestion.\n                     let ext_with_default = !fields_of_type(binding_type)\n                         .iter()"}, {"sha": "9a2bc778c3ff7ba5e03faccf7d69eda2e3f61d3a", "filename": "tests/ui/field_reassign_with_default.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/173e1ba966d92570cbf64d65e2f7353bcab1c661/tests%2Fui%2Ffield_reassign_with_default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/173e1ba966d92570cbf64d65e2f7353bcab1c661/tests%2Fui%2Ffield_reassign_with_default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffield_reassign_with_default.stderr?ref=173e1ba966d92570cbf64d65e2f7353bcab1c661", "patch": "@@ -53,7 +53,7 @@ error: field assignment outside of initializer for an instance created with Defa\n LL |     a.i = Default::default();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-note: consider initializing the variable with `A::default()` and removing relevant reassignments\n+note: consider initializing the variable with `A { i: Default::default(), ..Default::default() }` and removing relevant reassignments\n   --> $DIR/field_reassign_with_default.rs:90:5\n    |\n LL |     let mut a: A = Default::default();\n@@ -65,7 +65,7 @@ error: field assignment outside of initializer for an instance created with Defa\n LL |     a.i = Default::default();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-note: consider initializing the variable with `A { j: 45, ..Default::default() }` and removing relevant reassignments\n+note: consider initializing the variable with `A { i: Default::default(), j: 45 }` and removing relevant reassignments\n   --> $DIR/field_reassign_with_default.rs:94:5\n    |\n LL |     let mut a: A = Default::default();"}]}