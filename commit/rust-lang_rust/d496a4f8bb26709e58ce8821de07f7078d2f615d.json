{"sha": "d496a4f8bb26709e58ce8821de07f7078d2f615d", "node_id": "C_kwDOAAsO6NoAKGQ0OTZhNGY4YmIyNjcwOWU1OGNlODgyMWRlMDdmNzA3OGQyZjYxNWQ", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-07T21:59:54Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-07T21:59:54Z"}, "message": "diagnostics: mention the `:` token when struct fields fail to parse", "tree": {"sha": "20912216cf48250460738b220a3955f4f56ceb9c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20912216cf48250460738b220a3955f4f56ceb9c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d496a4f8bb26709e58ce8821de07f7078d2f615d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d496a4f8bb26709e58ce8821de07f7078d2f615d", "html_url": "https://github.com/rust-lang/rust/commit/d496a4f8bb26709e58ce8821de07f7078d2f615d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d496a4f8bb26709e58ce8821de07f7078d2f615d/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f573a0c5474ad65bc9f0b0fd3a94d1b06dcfdfa", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f573a0c5474ad65bc9f0b0fd3a94d1b06dcfdfa", "html_url": "https://github.com/rust-lang/rust/commit/0f573a0c5474ad65bc9f0b0fd3a94d1b06dcfdfa"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "36d633785507cad656fbabf1bd8e85a4efb31aa0", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d496a4f8bb26709e58ce8821de07f7078d2f615d/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d496a4f8bb26709e58ce8821de07f7078d2f615d/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=d496a4f8bb26709e58ce8821de07f7078d2f615d", "patch": "@@ -3012,6 +3012,11 @@ impl<'a> Parser<'a> {\n                 }\n             };\n \n+            let is_shorthand = parsed_field.as_ref().map_or(false, |f| f.ident.span == f.expr.span);\n+            // A shorthand field can be turned into a full field with `:`.\n+            // We should point this out.\n+            self.check_or_expected(!is_shorthand, TokenType::Token(token::Colon));\n+\n             match self.expect_one_of(&[token::Comma], &[token::CloseDelim(close_delim)]) {\n                 Ok(_) => {\n                     if let Some(f) = parsed_field.or(recovery_field) {"}, {"sha": "cf5c621020fe83897be61f92d23db35de71dd859", "filename": "src/test/ui/parser/issues/issue-52496.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-52496.stderr?ref=d496a4f8bb26709e58ce8821de07f7078d2f615d", "patch": "@@ -4,11 +4,11 @@ error: float literals must have an integer part\n LL |     let _ = Foo { bar: .5, baz: 42 };\n    |                        ^^ help: must have an integer part: `0.5`\n \n-error: expected one of `,` or `}`, found `.`\n+error: expected one of `,`, `:`, or `}`, found `.`\n   --> $DIR/issue-52496.rs:8:22\n    |\n LL |     let _ = Foo { bar.into(), bat: -1, . };\n-   |             ---      ^ expected one of `,` or `}`\n+   |             ---      ^ expected one of `,`, `:`, or `}`\n    |             |\n    |             while parsing this struct\n "}, {"sha": "d526c9d0bcccac1ed79e0c04e6c5e3728ebca89a", "filename": "src/test/ui/parser/issues/issue-62973.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-62973.stderr?ref=d496a4f8bb26709e58ce8821de07f7078d2f615d", "patch": "@@ -20,11 +20,11 @@ LL |\n LL |\n    |  ^\n \n-error: expected one of `,` or `}`, found `{`\n+error: expected one of `,`, `:`, or `}`, found `{`\n   --> $DIR/issue-62973.rs:6:8\n    |\n LL | fn p() { match s { v, E { [) {) }\n-   |        ^       -       -^ expected one of `,` or `}`\n+   |        ^       -       -^ expected one of `,`, `:`, or `}`\n    |        |       |       |\n    |        |       |       help: `}` may belong here\n    |        |       while parsing this struct"}, {"sha": "451057c66a1277008483768ae886a1e97b63d7c7", "filename": "src/test/ui/parser/removed-syntax-with-2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.rs?ref=d496a4f8bb26709e58ce8821de07f7078d2f615d", "patch": "@@ -6,6 +6,6 @@ fn main() {\n \n     let a = S { foo: (), bar: () };\n     let b = S { foo: (), with a };\n-    //~^ ERROR expected one of `,` or `}`, found `a`\n+    //~^ ERROR expected one of `,`, `:`, or `}`, found `a`\n     //~| ERROR missing field `bar` in initializer of `S`\n }"}, {"sha": "c6ae1ce674ff80467a799bc50c80bcc122a209a0", "filename": "src/test/ui/parser/removed-syntax-with-2.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d496a4f8bb26709e58ce8821de07f7078d2f615d/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fremoved-syntax-with-2.stderr?ref=d496a4f8bb26709e58ce8821de07f7078d2f615d", "patch": "@@ -1,8 +1,8 @@\n-error: expected one of `,` or `}`, found `a`\n+error: expected one of `,`, `:`, or `}`, found `a`\n   --> $DIR/removed-syntax-with-2.rs:8:31\n    |\n LL |     let b = S { foo: (), with a };\n-   |             -                 ^ expected one of `,` or `}`\n+   |             -                 ^ expected one of `,`, `:`, or `}`\n    |             |\n    |             while parsing this struct\n "}]}