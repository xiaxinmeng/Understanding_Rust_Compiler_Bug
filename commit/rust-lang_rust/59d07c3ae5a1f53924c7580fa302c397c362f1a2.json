{"sha": "59d07c3ae5a1f53924c7580fa302c397c362f1a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5ZDA3YzNhZTVhMWY1MzkyNGM3NTgwZmEzMDJjMzk3YzM2MmYxYTI=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2020-09-23T21:34:44Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2020-10-16T18:15:34Z"}, "message": "Parse inline const patterns", "tree": {"sha": "2fd317439ffb2b8dd16d45a2c472d9fe3e655d8d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fd317439ffb2b8dd16d45a2c472d9fe3e655d8d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59d07c3ae5a1f53924c7580fa302c397c362f1a2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAl+J40YACgkQgTGiTgx5\n76/kHhAAnqXJcdht6JjHEzca8GNW1FbfnWP82ZqDTbYruHMdrRU9AHr8Ie6LMTUo\nocVLD0oexN09Oo+VOLdkWmSZJgZu/8DABDPHx5xBvmuFhKGbBfSdbKKYYBdo9eze\n2e6tliY74R23cf3fiWLUSmFetCe7f83z4f7E3Yi5f4zd8Cn7wkKXol/b104nK9ns\n9RbbtR+MxEKfjPHmmpDn5YYL1Qfu2WnYNkCmmaLkorOEddy0dN7XZhSSt93W1ZhW\ngVhtobRJn1ulK+qdWDvS4XZpx91EoHo2F+6lizAMl2DbWo+4i0dgVlbD2cXUZPqd\nUGO8bXbmubQ1x+WAaeFZGQ/U4SUEqfWCmCigBfp+F4GqFpYyGCBahjg248f5eUeo\nsBd8kGPv7DNJyo8I5VRQqN/6zZ1f0A/gVtOoNkBZhb6LnCAd1yKWdPi9NLJb3ufO\n4p/Y1Fdj41KnhFyluev/obXQy/AXLpK3pSf7TZxu3gRe3UWoa7Dp+wndMCcNErSl\n1BReUTZloYPJRjqxfVq9ZYw3kOSX3XUlrgq87dYm8rFxgCy2kx+z1o7DQuvl2e0n\nOO9W3k6kAwdz4qnnIwUf2X4x9gnSwgrgfPViL7WJCkCWxz1GJ2wr/TxiXeGWXOfW\nTN2rGnMt4EKMcqpWhKZDHqvx0VyXtcmIjgdSncYv90s3juH4LBs=\n=onSC\n-----END PGP SIGNATURE-----", "payload": "tree 2fd317439ffb2b8dd16d45a2c472d9fe3e655d8d\nparent c3e8d7965ccef7fe47db591ae0064af0034e3f25\nauthor Santiago Pastorino <spastorino@gmail.com> 1600896884 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1602872134 -0300\n\nParse inline const patterns\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59d07c3ae5a1f53924c7580fa302c397c362f1a2", "html_url": "https://github.com/rust-lang/rust/commit/59d07c3ae5a1f53924c7580fa302c397c362f1a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59d07c3ae5a1f53924c7580fa302c397c362f1a2/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3e8d7965ccef7fe47db591ae0064af0034e3f25", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3e8d7965ccef7fe47db591ae0064af0034e3f25", "html_url": "https://github.com/rust-lang/rust/commit/c3e8d7965ccef7fe47db591ae0064af0034e3f25"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "15db2066a30537611e7f2e84822cbbf49031de12", "filename": "compiler/rustc_parse/src/parser/pat.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/59d07c3ae5a1f53924c7580fa302c397c362f1a2/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59d07c3ae5a1f53924c7580fa302c397c362f1a2/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs?ref=59d07c3ae5a1f53924c7580fa302c397c362f1a2", "patch": "@@ -313,6 +313,9 @@ impl<'a> Parser<'a> {\n             let pat = self.parse_pat_with_range_pat(false, None)?;\n             self.sess.gated_spans.gate(sym::box_patterns, lo.to(self.prev_token.span));\n             PatKind::Box(pat)\n+        } else if self.check_inline_const() {\n+            // Parse `const pat`\n+            PatKind::Lit(self.parse_const_expr(lo.to(self.token.span))?)\n         } else if self.can_be_ident_pat() {\n             // Parse `ident @ pat`\n             // This can give false positives and parse nullary enums,"}, {"sha": "97b05b0a1f210bef61662191a33a4f627931f772", "filename": "src/test/ui/parser/inline_const/const_match_pat_parses.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Finline_const%2Fconst_match_pat_parses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Finline_const%2Fconst_match_pat_parses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Finline_const%2Fconst_match_pat_parses.rs?ref=59d07c3ae5a1f53924c7580fa302c397c362f1a2", "patch": "@@ -0,0 +1,20 @@\n+// check-pass\n+// compile-flags: -Z parse-only\n+\n+#![feature(inline_const)]\n+const MMIO_BIT1: u8 = 4;\n+const MMIO_BIT2: u8 = 5;\n+\n+fn main() {\n+    match read_mmio() {\n+        0 => {}\n+        const { 1 << MMIO_BIT1 } => println!(\"FOO\"),\n+        const { 1 << MMIO_BIT2 } => println!(\"BAR\"),\n+\n+        _ => unreachable!(),\n+    }\n+}\n+\n+fn read_mmio() -> u8 {\n+    1 << 5\n+}"}, {"sha": "7b95bc775ba9170dc2c4f5cce47aad478963f9b6", "filename": "src/test/ui/parser/issue-66357-unexpected-unreachable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.rs?ref=59d07c3ae5a1f53924c7580fa302c397c362f1a2", "patch": "@@ -13,4 +13,4 @@\n \n fn f() { |[](* }\n //~^ ERROR expected one of `,` or `:`, found `(`\n-//~| ERROR expected one of `&`, `(`, `)`, `-`, `...`, `..=`, `..`, `[`, `_`, `box`, `mut`, `ref`, `|`, identifier, or path, found `*`\n+//~| ERROR expected one of `&`, `(`, `)`, `-`, `...`, `..=`, `..`, `[`, `_`, `box`, `const`, `mut`, `ref`, `|`, identifier, or path, found `*`"}, {"sha": "5549f73920d4f5fca1f11c9bfce1cbf3dfafc1f9", "filename": "src/test/ui/parser/issue-66357-unexpected-unreachable.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/59d07c3ae5a1f53924c7580fa302c397c362f1a2/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-66357-unexpected-unreachable.stderr?ref=59d07c3ae5a1f53924c7580fa302c397c362f1a2", "patch": "@@ -4,7 +4,7 @@ error: expected one of `,` or `:`, found `(`\n LL | fn f() { |[](* }\n    |             ^ expected one of `,` or `:`\n \n-error: expected one of `&`, `(`, `)`, `-`, `...`, `..=`, `..`, `[`, `_`, `box`, `mut`, `ref`, `|`, identifier, or path, found `*`\n+error: expected one of `&`, `(`, `)`, `-`, `...`, `..=`, `..`, `[`, `_`, `box`, `const`, `mut`, `ref`, `|`, identifier, or path, found `*`\n   --> $DIR/issue-66357-unexpected-unreachable.rs:14:14\n    |\n LL | fn f() { |[](* }"}]}