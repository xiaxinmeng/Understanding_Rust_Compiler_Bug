{"sha": "1e5e290e392adbf3e16f964bacb47a853cff3bdf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNWUyOTBlMzkyYWRiZjNlMTZmOTY0YmFjYjQ3YTg1M2NmZjNiZGY=", "commit": {"author": {"name": "Jan Likar", "email": "likar.jan@gmail.com", "date": "2015-12-16T03:48:49Z"}, "committer": {"name": "Jan Likar", "email": "likar.jan@gmail.com", "date": "2015-12-16T03:48:49Z"}, "message": "Allow to pass arguments to rustfmt", "tree": {"sha": "8e83acf474a733693d9e72b82a30c6a4a7796f5e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e83acf474a733693d9e72b82a30c6a4a7796f5e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e5e290e392adbf3e16f964bacb47a853cff3bdf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e5e290e392adbf3e16f964bacb47a853cff3bdf", "html_url": "https://github.com/rust-lang/rust/commit/1e5e290e392adbf3e16f964bacb47a853cff3bdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e5e290e392adbf3e16f964bacb47a853cff3bdf/comments", "author": {"login": "JanLikar", "id": 4228250, "node_id": "MDQ6VXNlcjQyMjgyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/4228250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JanLikar", "html_url": "https://github.com/JanLikar", "followers_url": "https://api.github.com/users/JanLikar/followers", "following_url": "https://api.github.com/users/JanLikar/following{/other_user}", "gists_url": "https://api.github.com/users/JanLikar/gists{/gist_id}", "starred_url": "https://api.github.com/users/JanLikar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JanLikar/subscriptions", "organizations_url": "https://api.github.com/users/JanLikar/orgs", "repos_url": "https://api.github.com/users/JanLikar/repos", "events_url": "https://api.github.com/users/JanLikar/events{/privacy}", "received_events_url": "https://api.github.com/users/JanLikar/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JanLikar", "id": 4228250, "node_id": "MDQ6VXNlcjQyMjgyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/4228250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JanLikar", "html_url": "https://github.com/JanLikar", "followers_url": "https://api.github.com/users/JanLikar/followers", "following_url": "https://api.github.com/users/JanLikar/following{/other_user}", "gists_url": "https://api.github.com/users/JanLikar/gists{/gist_id}", "starred_url": "https://api.github.com/users/JanLikar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JanLikar/subscriptions", "organizations_url": "https://api.github.com/users/JanLikar/orgs", "repos_url": "https://api.github.com/users/JanLikar/repos", "events_url": "https://api.github.com/users/JanLikar/events{/privacy}", "received_events_url": "https://api.github.com/users/JanLikar/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "959c2e7bed6e1fb95ac4252383d5ec0cdc401af3", "url": "https://api.github.com/repos/rust-lang/rust/commits/959c2e7bed6e1fb95ac4252383d5ec0cdc401af3", "html_url": "https://github.com/rust-lang/rust/commit/959c2e7bed6e1fb95ac4252383d5ec0cdc401af3"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "f79899ff5b1b8ccb034a0a0e54c975d51d4ef752", "filename": "src/bin/cargo-fmt.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/1e5e290e392adbf3e16f964bacb47a853cff3bdf/src%2Fbin%2Fcargo-fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e5e290e392adbf3e16f964bacb47a853cff3bdf/src%2Fbin%2Fcargo-fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcargo-fmt.rs?ref=1e5e290e392adbf3e16f964bacb47a853cff3bdf", "patch": "@@ -28,7 +28,7 @@ fn main() {\n     let mut opts = getopts::Options::new();\n     opts.optflag(\"h\", \"help\", \"show this message\");\n \n-    let matches = match opts.parse(env::args().skip(1)) {\n+    let matches = match opts.parse(env::args().skip(1).take_while(|a| a != \"--\")) {\n         Ok(m) => m,\n         Err(e) => {\n             print_usage(&opts, &e.to_string());\n@@ -45,7 +45,8 @@ fn main() {\n \n fn print_usage(opts: &Options, reason: &str) {\n     let msg = format!(\"{}\\nusage: cargo fmt [options]\", reason);\n-    println!(\"{}\\nThis utility formats all bin and lib files of the current crate using rustfmt.\",\n+    println!(\"{}\\nThis utility formats all bin and lib files of the current crate using rustfmt. \\\n+              Arguments after `--` are passes to rustfmt.\",\n              opts.usage(&msg));\n }\n \n@@ -64,7 +65,15 @@ fn format_crate(opts: &Options) {\n                                .map(|t| t.path)\n                                .collect();\n \n-    format_files(&files).unwrap_or_else(|e| print_usage(opts, &e.to_string()));\n+    format_files(&files, &get_fmt_args()).unwrap_or_else(|e| print_usage(opts, &e.to_string()));\n+}\n+\n+fn get_fmt_args() -> Vec<String> {\n+    let mut args = vec![\"--write-mode=overwrite\".to_string()];\n+    // All arguments after -- are passed to rustfmt\n+    args.extend(env::args().skip_while(|a| a != \"--\").skip(1));\n+\n+    args\n }\n \n #[derive(Debug)]\n@@ -133,10 +142,10 @@ fn target_from_json(jtarget: &Json) -> Target {\n     }\n }\n \n-fn format_files(files: &Vec<PathBuf>) -> Result<(), std::io::Error> {\n+fn format_files(files: &Vec<PathBuf>, fmt_args: &Vec<String>) -> Result<(), std::io::Error> {\n     let mut command = try!(Command::new(\"rustfmt\")\n-                               .arg(\"--write-mode=overwrite\")\n                                .args(files)\n+                               .args(fmt_args)\n                                .spawn());\n     try!(command.wait());\n "}]}