{"sha": "258dbd09ba4aa868b373df7e82721ba0c40167ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1OGRiZDA5YmE0YWE4NjhiMzczZGY3ZTgyNzIxYmEwYzQwMTY3YmE=", "commit": {"author": {"name": "Palmer Cox", "email": "p@lmercox.com", "date": "2014-02-16T06:03:07Z"}, "committer": {"name": "Palmer Cox", "email": "p@lmercox.com", "date": "2014-03-05T05:22:19Z"}, "message": "Emit the uppercase variable lint for struct fields that have names with uppercase characters", "tree": {"sha": "cfc189d1cbe1ecb157cd60357bb473cfad3035be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfc189d1cbe1ecb157cd60357bb473cfad3035be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/258dbd09ba4aa868b373df7e82721ba0c40167ba", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/258dbd09ba4aa868b373df7e82721ba0c40167ba", "html_url": "https://github.com/rust-lang/rust/commit/258dbd09ba4aa868b373df7e82721ba0c40167ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/258dbd09ba4aa868b373df7e82721ba0c40167ba/comments", "author": null, "committer": null, "parents": [{"sha": "e3723dc4f1f256e5a454cafb62fd892d85767750", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3723dc4f1f256e5a454cafb62fd892d85767750", "html_url": "https://github.com/rust-lang/rust/commit/e3723dc4f1f256e5a454cafb62fd892d85767750"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "f8cf376582aab516fcb1adfb570fceb6897f9763", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/258dbd09ba4aa868b373df7e82721ba0c40167ba/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/258dbd09ba4aa868b373df7e82721ba0c40167ba/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=258dbd09ba4aa868b373df7e82721ba0c40167ba", "patch": "@@ -212,7 +212,7 @@ static lint_table: &'static [(&'static str, LintSpec)] = &[\n     (\"uppercase_variables\",\n      LintSpec {\n          lint: UppercaseVariables,\n-         desc: \"variable names should start with a lowercase character\",\n+         desc: \"variable and structure field names should start with a lowercase character\",\n          default: warn\n      }),\n \n@@ -1201,6 +1201,23 @@ fn check_pat_uppercase_variable(cx: &Context, p: &ast::Pat) {\n     }\n }\n \n+fn check_struct_uppercase_variable(cx: &Context, s: &ast::StructDef) {\n+    for sf in s.fields.iter() {\n+        match sf.node {\n+            ast::StructField_ { kind: ast::NamedField(ident, _), .. } => {\n+                let s = token::get_ident(ident);\n+                if s.get().char_at(0).is_uppercase() {\n+                    cx.span_lint(\n+                        UppercaseVariables,\n+                        sf.span,\n+                        \"structure field names should start with a lowercase character\");\n+                }\n+            }\n+            _ => {}\n+        }\n+    }\n+}\n+\n fn check_unnecessary_parens_core(cx: &Context, value: &ast::Expr, msg: &str) {\n     match value.node {\n         ast::ExprParen(_) => {\n@@ -1665,6 +1682,8 @@ impl<'a> Visitor<()> for Context<'a> {\n                         g: &ast::Generics,\n                         id: ast::NodeId,\n                         _: ()) {\n+        check_struct_uppercase_variable(self, s);\n+\n         let old_id = self.cur_struct_def_id;\n         self.cur_struct_def_id = id;\n         visit::walk_struct_def(self, s, i, g, id, ());"}, {"sha": "114d5d4fdf042f04471e6adb05c47140c6002237", "filename": "src/test/compile-fail/lint-uppercase-variables.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/258dbd09ba4aa868b373df7e82721ba0c40167ba/src%2Ftest%2Fcompile-fail%2Flint-uppercase-variables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/258dbd09ba4aa868b373df7e82721ba0c40167ba/src%2Ftest%2Fcompile-fail%2Flint-uppercase-variables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-uppercase-variables.rs?ref=258dbd09ba4aa868b373df7e82721ba0c40167ba", "patch": "@@ -13,6 +13,10 @@\n use std::io::File;\n use std::io::IoError;\n \n+struct Something {\n+    X: uint //~ ERROR structure field names should start with a lowercase character\n+}\n+\n fn test(Xx: uint) { //~ ERROR variable names should start with a lowercase character\n     println!(\"{}\", Xx);\n }\n@@ -30,5 +34,7 @@ fn main() {\n     }\n \n     test(1);\n+\n+    let _ = Something { X: 0 };\n }\n "}]}