{"sha": "eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "node_id": "C_kwDOAAsO6NoAKGViMjRhY2Y2MGQwMmVjYzBkMWYyZWY4ZmYwNDFmN2IxMDQyOWI1NDU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-25T11:58:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-25T11:58:25Z"}, "message": "Auto merge of #8165 - ebobrow:shadow_reuse_fn, r=xFrednet\n\nfix [`shadow_reuse`] false negative for if let bindings\n\nfixes #8087\n\nchangelog: trigger [`shadow_reuse`] instead of [`shadow_unrelated`] on shadowed `if let` bindings", "tree": {"sha": "cd3267d67711f5c3049e03193cc19f1b5c80ac46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd3267d67711f5c3049e03193cc19f1b5c80ac46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "html_url": "https://github.com/rust-lang/rust/commit/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8529b2a0561dcee254ee1447aa6bd5d69812b697", "url": "https://api.github.com/repos/rust-lang/rust/commits/8529b2a0561dcee254ee1447aa6bd5d69812b697", "html_url": "https://github.com/rust-lang/rust/commit/8529b2a0561dcee254ee1447aa6bd5d69812b697"}, {"sha": "1b67aa74bdcbf3939241e19dd16ff0bcc6150d94", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b67aa74bdcbf3939241e19dd16ff0bcc6150d94", "html_url": "https://github.com/rust-lang/rust/commit/1b67aa74bdcbf3939241e19dd16ff0bcc6150d94"}], "stats": {"total": 24, "additions": 19, "deletions": 5}, "files": [{"sha": "516cb939c15c62310f98666b008f67219cbebc0b", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "patch": "@@ -220,14 +220,14 @@ fn is_self_shadow(cx: &LateContext<'_>, pat: &Pat<'_>, mut expr: &Expr<'_>, hir_\n     }\n }\n \n-/// Finds the \"init\" expression for a pattern: `let <pat> = <init>;` or\n+/// Finds the \"init\" expression for a pattern: `let <pat> = <init>;` (or `if let`) or\n /// `match <init> { .., <pat> => .., .. }`\n fn find_init<'tcx>(cx: &LateContext<'tcx>, hir_id: HirId) -> Option<&'tcx Expr<'tcx>> {\n     for (_, node) in cx.tcx.hir().parent_iter(hir_id) {\n         let init = match node {\n             Node::Arm(_) | Node::Pat(_) => continue,\n             Node::Expr(expr) => match expr.kind {\n-                ExprKind::Match(e, _, _) => Some(e),\n+                ExprKind::Match(e, _, _) | ExprKind::Let(_, e, _) => Some(e),\n                 _ => None,\n             },\n             Node::Local(local) => local.init,"}, {"sha": "0321f8c4cdf84ba14f107536ba7019033d09d851", "filename": "tests/ui/shadow.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/tests%2Fui%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/tests%2Fui%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fshadow.rs?ref=eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "patch": "@@ -47,6 +47,8 @@ fn syntax() {\n     let _ = |[x]: [u32; 1]| {\n         let x = 1;\n     };\n+    let y = Some(1);\n+    if let Some(y) = y {}\n }\n \n fn negative() {"}, {"sha": "f8b9221d555871d7f6fbd4378857a619da51f41f", "filename": "tests/ui/shadow.stderr", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/tests%2Fui%2Fshadow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eb24acf60d02ecc0d1f2ef8ff041f7b10429b545/tests%2Fui%2Fshadow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fshadow.stderr?ref=eb24acf60d02ecc0d1f2ef8ff041f7b10429b545", "patch": "@@ -241,17 +241,29 @@ note: previous binding is here\n LL |     let _ = |[x]: [u32; 1]| {\n    |               ^\n \n+error: `y` is shadowed\n+  --> $DIR/shadow.rs:51:17\n+   |\n+LL |     if let Some(y) = y {}\n+   |                 ^\n+   |\n+note: previous binding is here\n+  --> $DIR/shadow.rs:50:9\n+   |\n+LL |     let y = Some(1);\n+   |         ^\n+\n error: `_b` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:85:9\n+  --> $DIR/shadow.rs:87:9\n    |\n LL |     let _b = _a;\n    |         ^^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:84:28\n+  --> $DIR/shadow.rs:86:28\n    |\n LL | pub async fn foo2(_a: i32, _b: i64) {\n    |                            ^^\n \n-error: aborting due to 21 previous errors\n+error: aborting due to 22 previous errors\n "}]}