{"sha": "8d7cf1a4cae07489c375af7bd03923012774dadd", "node_id": "C_kwDOAAsO6NoAKDhkN2NmMWE0Y2FlMDc0ODljMzc1YWY3YmQwMzkyMzAxMjc3NGRhZGQ", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2021-12-29T20:37:13Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2021-12-29T20:45:23Z"}, "message": "Fix spacing in pretty printed PatKind::Struct with no fields", "tree": {"sha": "e0f9924836244ab8e95f6c17567bd2b06d4c9d19", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e0f9924836244ab8e95f6c17567bd2b06d4c9d19"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d7cf1a4cae07489c375af7bd03923012774dadd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmHMyOMACgkQ+boUO5X/\nbYKWgw//e2L2r/Erh/R1rmLf7MDNA0rsSFE9wIs1bdkcW2DIFxwSTilofLQsxbqN\n0YFaquOqklfieFzIeDVSIz15T1Nn/XHbj3QdTAZMoNTLufPZBLH6jGWJol41BjaR\nEr3cMSIyhVJ55fxjb+7aFPHQoSDjD1VhmGo5yGtkyiaxex4myssJr/1vwUhx1bh7\nBO8pwCOdhYjylZrYWbg8MxKEzrrERnmKVAs6iv9WpZJYfLaKC+ktBxqe+K5WBsbe\ngU4buEiavQCqlfsI2SnwgW8UYP+0ftRujygmaUMosRx1Igdc5v6Ayw/ZuzmDvGuv\nxsMcKadso76zbsJiMSlKyXkgr4TGyFeBb6C2pwIWn9pActQG/wY0eTp6YMc0EbP+\nyjlNUzImuuA90MwMYsGFVftBjmo4k4gPjHz21lo9Vvcv3dhMvPW2RShjECQC1wex\nGo3JWdbad7ey0MkCYM8jhNv2Jm6hwBUcq3qof822KrSYlz8OUbRHLJJWtz7K3Au/\ndMgI9Tu7gJXrtgNCyuP/eZjz7IQdPC9aWaLpJ7vX/9j5NWEpbrkVSQWoB9vgHXS7\nJ4gjiY1h5d72+ckRxM13+gnmT4/l9SgJk9KRa0B7pQTwmdTYEv2hPIxkJk+hAPIN\nDT0V8YjdNQTpKIcL5F4XSUMXGQWk2yegZKghIb2Qf7QCZTNaSzc=\n=FDZq\n-----END PGP SIGNATURE-----", "payload": "tree e0f9924836244ab8e95f6c17567bd2b06d4c9d19\nparent df96fb166f59431e3de443835e50d5b8a7a4adb0\nauthor David Tolnay <dtolnay@gmail.com> 1640810233 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1640810723 -0800\n\nFix spacing in pretty printed PatKind::Struct with no fields\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d7cf1a4cae07489c375af7bd03923012774dadd", "html_url": "https://github.com/rust-lang/rust/commit/8d7cf1a4cae07489c375af7bd03923012774dadd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d7cf1a4cae07489c375af7bd03923012774dadd/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df96fb166f59431e3de443835e50d5b8a7a4adb0", "url": "https://api.github.com/repos/rust-lang/rust/commits/df96fb166f59431e3de443835e50d5b8a7a4adb0", "html_url": "https://github.com/rust-lang/rust/commit/df96fb166f59431e3de443835e50d5b8a7a4adb0"}], "stats": {"total": 28, "additions": 20, "deletions": 8}, "files": [{"sha": "f0676caed4665d3e104e7fc880e2aa845afe09e8", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8d7cf1a4cae07489c375af7bd03923012774dadd/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d7cf1a4cae07489c375af7bd03923012774dadd/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=8d7cf1a4cae07489c375af7bd03923012774dadd", "patch": "@@ -2460,7 +2460,11 @@ impl<'a> State<'a> {\n                     self.print_path(path, true, 0);\n                 }\n                 self.nbsp();\n-                self.word_space(\"{\");\n+                self.word(\"{\");\n+                let empty = fields.is_empty() && !etc;\n+                if !empty {\n+                    self.space();\n+                }\n                 self.commasep_cmnt(\n                     Consistent,\n                     &fields,\n@@ -2481,7 +2485,9 @@ impl<'a> State<'a> {\n                     }\n                     self.word(\"..\");\n                 }\n-                self.space();\n+                if !empty {\n+                    self.space();\n+                }\n                 self.word(\"}\");\n             }\n             PatKind::Tuple(ref elts) => {"}, {"sha": "96754cc3c8f4d2fa5ccfdfe6fa83787de46e4369", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8d7cf1a4cae07489c375af7bd03923012774dadd/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d7cf1a4cae07489c375af7bd03923012774dadd/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=8d7cf1a4cae07489c375af7bd03923012774dadd", "patch": "@@ -1874,7 +1874,11 @@ impl<'a> State<'a> {\n             PatKind::Struct(ref qpath, ref fields, etc) => {\n                 self.print_qpath(qpath, true);\n                 self.nbsp();\n-                self.word_space(\"{\");\n+                self.word(\"{\");\n+                let empty = fields.is_empty() && !etc;\n+                if !empty {\n+                    self.space();\n+                }\n                 self.commasep_cmnt(\n                     Consistent,\n                     &fields,\n@@ -1895,7 +1899,9 @@ impl<'a> State<'a> {\n                     }\n                     self.word(\"..\");\n                 }\n-                self.space();\n+                if !empty {\n+                    self.space();\n+                }\n                 self.word(\"}\");\n             }\n             PatKind::Or(ref pats) => {"}, {"sha": "c0a030a2ecbf4bed9150b95d4eb8a1f8c1f657fc", "filename": "src/test/ui/macros/stringify.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8d7cf1a4cae07489c375af7bd03923012774dadd/src%2Ftest%2Fui%2Fmacros%2Fstringify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d7cf1a4cae07489c375af7bd03923012774dadd/src%2Ftest%2Fui%2Fmacros%2Fstringify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fstringify.rs?ref=8d7cf1a4cae07489c375af7bd03923012774dadd", "patch": "@@ -661,9 +661,9 @@ fn test_pat() {\n     assert_eq!(stringify_pat!(ref mut _x @ _), \"ref mut _x @ _\");\n \n     // PatKind::Struct\n-    assert_eq!(stringify_pat!(Struct {}), \"Struct {  }\"); // FIXME\n-    assert_eq!(stringify_pat!(Struct::<u8> {}), \"Struct::<u8> {  }\");\n-    assert_eq!(stringify_pat!(Struct::<'static> {}), \"Struct::<'static> {  }\");\n+    assert_eq!(stringify_pat!(Struct {}), \"Struct {}\");\n+    assert_eq!(stringify_pat!(Struct::<u8> {}), \"Struct::<u8> {}\");\n+    assert_eq!(stringify_pat!(Struct::<'static> {}), \"Struct::<'static> {}\");\n     assert_eq!(stringify_pat!(Struct { x }), \"Struct { x }\");\n     assert_eq!(stringify_pat!(Struct { x: _x }), \"Struct { x: _x }\");\n     assert_eq!(stringify_pat!(Struct { .. }), \"Struct { .. }\");\n@@ -672,7 +672,7 @@ fn test_pat() {\n     #[rustfmt::skip] // https://github.com/rust-lang/rustfmt/issues/5151\n     assert_eq!(\n         stringify_pat!(<Struct as Trait>::Type {}),\n-        \"<Struct as Trait>::Type {  }\",\n+        \"<Struct as Trait>::Type {}\",\n     );\n \n     // PatKind::TupleStruct"}]}