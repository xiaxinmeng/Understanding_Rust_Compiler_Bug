{"sha": "d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4YTgwY2IzMWZkOGE3YTBlNmUwN2RmN2Q1YTZhZWZmNjYwOTUwN2U=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-09-28T19:26:36Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-09-28T19:26:36Z"}, "message": "rt: Add a call stub that switches to the C stack, untested as of yet", "tree": {"sha": "160a98015f9ce8ecbd9da1435a368478c5b006f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/160a98015f9ce8ecbd9da1435a368478c5b006f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "html_url": "https://github.com/rust-lang/rust/commit/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1eaaae860fb725f5afdd8912fb2200f4f9929daa", "url": "https://api.github.com/repos/rust-lang/rust/commits/1eaaae860fb725f5afdd8912fb2200f4f9929daa", "html_url": "https://github.com/rust-lang/rust/commit/1eaaae860fb725f5afdd8912fb2200f4f9929daa"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "decbd1bc17530a3e0ec450356a47cc82a992b492", "filename": "mk/rt.mk", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "patch": "@@ -37,7 +37,8 @@ RUNTIME_CS := rt/sync/timer.cpp \\\n \n RUNTIME_LL :=\n \n-RUNTIME_S := rt/arch/i386/_context.S\n+RUNTIME_S := rt/arch/i386/_context.S \\\n+             rt/arch/i386/ccall.S\n \n RUNTIME_HDR := rt/globals.h \\\n                rt/rust.h \\"}, {"sha": "7adecc4c5d282e3eef638339474ac328a248f6ca", "filename": "src/rt/arch/i386/ccall.S", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Farch%2Fi386%2Fccall.S", "raw_url": "https://github.com/rust-lang/rust/raw/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Farch%2Fi386%2Fccall.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fi386%2Fccall.S?ref=d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "patch": "@@ -0,0 +1,14 @@\n+    .text\n+\n+// upcall_call_c_stack(void (*fn)(), void *new_esp)\n+.globl _upcall_call_c_stack\n+_upcall_call_c_stack:\n+    movl %esp,%ecx          // grab esp\n+    movl 8(%esp),%eax       // save fn\n+    movl 12(%esp),%esp      // switch stack\n+    pushl %ecx              // save esp on stack\n+    calll *%eax\n+    popl %esp               // restore esp\n+    ret\n+\n+"}, {"sha": "9a225b79606f74240281bcd3f68dda9371c96f84", "filename": "src/rt/arch/i386/context.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Farch%2Fi386%2Fcontext.h", "raw_url": "https://github.com/rust-lang/rust/raw/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Farch%2Fi386%2Fcontext.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fi386%2Fcontext.h?ref=d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "patch": "@@ -37,6 +37,7 @@ class context {\n \n   void swap(context &out);\n   void call(void *f, void *arg, void *sp);\n+  void call(void *f, void *sp);\n \n   // Note that this doesn't actually adjust esp. Instead, we adjust esp when\n   // we actually do the call. This is needed for exception safety -- if the"}, {"sha": "d7caebe41a160aa3f34b5158bf0bb57ac65e83f7", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=d8a80cb31fd8a7a0e6e07df7d5a6aeff6609507e", "patch": "@@ -66,6 +66,7 @@ task_yield\n task_join\n unsupervise\n upcall_alloc_c_stack\n+upcall_call_c_stack\n upcall_cmp_type\n upcall_dynastack_alloc\n upcall_dynastack_alloc_2"}]}