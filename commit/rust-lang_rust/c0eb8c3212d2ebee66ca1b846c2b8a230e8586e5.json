{"sha": "c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwZWI4YzMyMTJkMmViZWU2NmNhMWI4NDZjMmI4YTIzMGU4NTg2ZTU=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-12-07T04:53:10Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-12-07T04:57:54Z"}, "message": "Add FmtVisitor::from_context()", "tree": {"sha": "6d564047374cb5271a48f98ae36e40e81c86ab15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d564047374cb5271a48f98ae36e40e81c86ab15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "html_url": "https://github.com/rust-lang/rust/commit/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d9a10e00e6b1f76624ec14471706525613df411", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d9a10e00e6b1f76624ec14471706525613df411", "html_url": "https://github.com/rust-lang/rust/commit/1d9a10e00e6b1f76624ec14471706525613df411"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "e014e506b05bf628ab0fc27b9fb0525b91de8356", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "patch": "@@ -629,7 +629,7 @@ pub fn rewrite_block_with_visitor(\n         return rw;\n     }\n \n-    let mut visitor = FmtVisitor::from_codemap(context.parse_session, context.config, block.span);\n+    let mut visitor = FmtVisitor::from_context(context);\n     visitor.block_indent = shape.indent;\n     visitor.is_if_else_block = context.is_if_else_block;\n     match block.rules {"}, {"sha": "95638a90fc096b5ecfe6857a6793f02fec16d7bb", "filename": "src/items.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "patch": "@@ -657,8 +657,7 @@ pub fn format_impl(\n         let open_pos = snippet.find_uncommented(\"{\")? + 1;\n \n         if !items.is_empty() || contains_comment(&snippet[open_pos..]) {\n-            let mut visitor =\n-                FmtVisitor::from_codemap(context.parse_session, context.config, item.span);\n+            let mut visitor = FmtVisitor::from_context(context);\n             visitor.block_indent = offset.block_only().block_indent(context.config);\n             visitor.last_pos = item.span.lo() + BytePos(open_pos as u32);\n \n@@ -1056,8 +1055,7 @@ pub fn format_trait(context: &RewriteContext, item: &ast::Item, offset: Indent)\n         let open_pos = snippet.find_uncommented(\"{\")? + 1;\n \n         if !trait_items.is_empty() || contains_comment(&snippet[open_pos..]) {\n-            let mut visitor =\n-                FmtVisitor::from_codemap(context.parse_session, context.config, item.span);\n+            let mut visitor = FmtVisitor::from_context(context);\n             visitor.block_indent = offset.block_only().block_indent(context.config);\n             visitor.last_pos = item.span.lo() + BytePos(open_pos as u32);\n "}, {"sha": "f2b4750460f80e553b2a87d07c32124beec51480", "filename": "src/visitor.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=c0eb8c3212d2ebee66ca1b846c2b8a230e8586e5", "patch": "@@ -531,6 +531,10 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n         self.last_pos = source!(self, span).hi();\n     }\n \n+    pub fn from_context(ctx: &'a RewriteContext) -> FmtVisitor<'a> {\n+        FmtVisitor::from_codemap(ctx.parse_session, ctx.config, ctx.snippet_provider)\n+    }\n+\n     pub fn from_codemap(\n         parse_session: &'a ParseSess,\n         config: &'a Config,"}]}