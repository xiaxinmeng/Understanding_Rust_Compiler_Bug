{"sha": "94477e3323330f531705d6968761e7e8fd6f749e", "node_id": "C_kwDOAAsO6NoAKDk0NDc3ZTMzMjMzMzBmNTMxNzA1ZDY5Njg3NjFlN2U4ZmQ2Zjc0OWU", "commit": {"author": {"name": "Martin Nordholts", "email": "enselic@gmail.com", "date": "2022-06-22T16:23:21Z"}, "committer": {"name": "Martin Nordholts", "email": "enselic@gmail.com", "date": "2022-06-22T16:24:09Z"}, "message": "Fixup missing renames from `#[main]` to `#[rustc_main]`\n\nIn fc357039f9 `#[main]` was removed and replaced with `#[rustc_main]`.\nIn some place the rename was forgotten, which makes the current code\nconfusing, because at first glance it seems that `#[main]` is still\naround. Perform the renames also in these places.", "tree": {"sha": "1be0da1ecdac5ea7142bae7dc3b064bae72fa0ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1be0da1ecdac5ea7142bae7dc3b064bae72fa0ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94477e3323330f531705d6968761e7e8fd6f749e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94477e3323330f531705d6968761e7e8fd6f749e", "html_url": "https://github.com/rust-lang/rust/commit/94477e3323330f531705d6968761e7e8fd6f749e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94477e3323330f531705d6968761e7e8fd6f749e/comments", "author": {"login": "Enselic", "id": 115040, "node_id": "MDQ6VXNlcjExNTA0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/115040?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Enselic", "html_url": "https://github.com/Enselic", "followers_url": "https://api.github.com/users/Enselic/followers", "following_url": "https://api.github.com/users/Enselic/following{/other_user}", "gists_url": "https://api.github.com/users/Enselic/gists{/gist_id}", "starred_url": "https://api.github.com/users/Enselic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Enselic/subscriptions", "organizations_url": "https://api.github.com/users/Enselic/orgs", "repos_url": "https://api.github.com/users/Enselic/repos", "events_url": "https://api.github.com/users/Enselic/events{/privacy}", "received_events_url": "https://api.github.com/users/Enselic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Enselic", "id": 115040, "node_id": "MDQ6VXNlcjExNTA0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/115040?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Enselic", "html_url": "https://github.com/Enselic", "followers_url": "https://api.github.com/users/Enselic/followers", "following_url": "https://api.github.com/users/Enselic/following{/other_user}", "gists_url": "https://api.github.com/users/Enselic/gists{/gist_id}", "starred_url": "https://api.github.com/users/Enselic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Enselic/subscriptions", "organizations_url": "https://api.github.com/users/Enselic/orgs", "repos_url": "https://api.github.com/users/Enselic/repos", "events_url": "https://api.github.com/users/Enselic/events{/privacy}", "received_events_url": "https://api.github.com/users/Enselic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ec3993ef4a4eb72bc20477fe9a4d92acd53f2c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ec3993ef4a4eb72bc20477fe9a4d92acd53f2c6", "html_url": "https://github.com/rust-lang/rust/commit/6ec3993ef4a4eb72bc20477fe9a4d92acd53f2c6"}], "stats": {"total": 23, "additions": 12, "deletions": 11}, "files": [{"sha": "3370146193a522839ec368071b341b9596981840", "filename": "compiler/rustc_ast/src/entry.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_ast%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_ast%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fentry.rs?ref=94477e3323330f531705d6968761e7e8fd6f749e", "patch": "@@ -2,7 +2,7 @@\n pub enum EntryPointType {\n     None,\n     MainNamed,\n-    MainAttr,\n+    RustcMainAttr,\n     Start,\n     OtherMain, // Not an entry point, but some other function named main\n }"}, {"sha": "a08495f7671b05c02584d6d22b36fcd33ea9d3b7", "filename": "compiler/rustc_builtin_macros/src/test_harness.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Ftest_harness.rs?ref=94477e3323330f531705d6968761e7e8fd6f749e", "patch": "@@ -147,7 +147,7 @@ fn entry_point_type(sess: &Session, item: &ast::Item, depth: usize) -> EntryPoin\n             if sess.contains_name(&item.attrs, sym::start) {\n                 EntryPointType::Start\n             } else if sess.contains_name(&item.attrs, sym::rustc_main) {\n-                EntryPointType::MainAttr\n+                EntryPointType::RustcMainAttr\n             } else if item.ident.name == sym::main {\n                 if depth == 0 {\n                     // This is a top-level function so can be 'main'\n@@ -177,12 +177,12 @@ impl<'a> MutVisitor for EntryPointCleaner<'a> {\n         let item = noop_flat_map_item(i, self).expect_one(\"noop did something\");\n         self.depth -= 1;\n \n-        // Remove any #[main] or #[start] from the AST so it doesn't\n+        // Remove any #[rustc_main] or #[start] from the AST so it doesn't\n         // clash with the one we're going to add, but mark it as\n         // #[allow(dead_code)] to avoid printing warnings.\n         let item = match entry_point_type(self.sess, &item, self.depth) {\n-            EntryPointType::MainNamed | EntryPointType::MainAttr | EntryPointType::Start => item\n-                .map(|ast::Item { id, ident, attrs, kind, vis, span, tokens }| {\n+            EntryPointType::MainNamed | EntryPointType::RustcMainAttr | EntryPointType::Start => {\n+                item.map(|ast::Item { id, ident, attrs, kind, vis, span, tokens }| {\n                     let allow_ident = Ident::new(sym::allow, self.def_site);\n                     let dc_nested =\n                         attr::mk_nested_word_item(Ident::new(sym::dead_code, self.def_site));\n@@ -197,7 +197,8 @@ impl<'a> MutVisitor for EntryPointCleaner<'a> {\n                         .collect();\n \n                     ast::Item { id, ident, attrs, kind, vis, span, tokens }\n-                }),\n+                })\n+            }\n             EntryPointType::None | EntryPointType::OtherMain => item,\n         };\n "}, {"sha": "f9e67310452a70f399d75deadfdcb89c27be54ac", "filename": "compiler/rustc_passes/src/entry.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94477e3323330f531705d6968761e7e8fd6f749e/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fentry.rs?ref=94477e3323330f531705d6968761e7e8fd6f749e", "patch": "@@ -56,7 +56,7 @@ fn entry_point_type(ctxt: &EntryContext<'_>, id: ItemId, at_root: bool) -> Entry\n     if ctxt.tcx.sess.contains_name(attrs, sym::start) {\n         EntryPointType::Start\n     } else if ctxt.tcx.sess.contains_name(attrs, sym::rustc_main) {\n-        EntryPointType::MainAttr\n+        EntryPointType::RustcMainAttr\n     } else {\n         if let Some(name) = ctxt.tcx.opt_item_name(id.def_id.to_def_id())\n             && name == sym::main {\n@@ -95,21 +95,21 @@ fn find_item(id: ItemId, ctxt: &mut EntryContext<'_>) {\n         EntryPointType::OtherMain => {\n             ctxt.non_main_fns.push(ctxt.tcx.def_span(id.def_id));\n         }\n-        EntryPointType::MainAttr => {\n+        EntryPointType::RustcMainAttr => {\n             if ctxt.attr_main_fn.is_none() {\n                 ctxt.attr_main_fn = Some((id.def_id, ctxt.tcx.def_span(id.def_id.to_def_id())));\n             } else {\n                 struct_span_err!(\n                     ctxt.tcx.sess,\n                     ctxt.tcx.def_span(id.def_id.to_def_id()),\n                     E0137,\n-                    \"multiple functions with a `#[main]` attribute\"\n+                    \"multiple functions with a `#[rustc_main]` attribute\"\n                 )\n                 .span_label(\n                     ctxt.tcx.def_span(id.def_id.to_def_id()),\n-                    \"additional `#[main]` function\",\n+                    \"additional `#[rustc_main]` function\",\n                 )\n-                .span_label(ctxt.attr_main_fn.unwrap().1, \"first `#[main]` function\")\n+                .span_label(ctxt.attr_main_fn.unwrap().1, \"first `#[rustc_main]` function\")\n                 .emit();\n             }\n         }"}]}