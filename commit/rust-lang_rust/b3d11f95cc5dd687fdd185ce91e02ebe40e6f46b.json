{"sha": "b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzZDExZjk1Y2M1ZGQ2ODdmZGQxODVjZTkxZTAyZWJlNDBlNmY0NmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-04T20:00:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-04T20:00:57Z"}, "message": "Auto merge of #86598 - yoshuawuyts:poll-method-docs, r=JohnTitor\n\nAdd examples to the various methods of `core::task::Poll`\n\nThis improves the documentation of the various methods of [`core::task::Poll`](https://doc.rust-lang.org/std/task/enum.Poll.html). These currently have fairly simple docs with no examples. This PR changes these methods to be closer to `core::option::Option` and adds usage examples (and importantly: tests!) to `Poll`'s methods.\n\ncc/ `@rust-lang/wg-async-foundations`\n\n## Screenshots\n\n<details>\n<summary>View generated rustdoc page</summary>\n<image src=\"https://user-images.githubusercontent.com/2467194/123286616-59ee9b00-d50e-11eb-9e02-40269070f904.png\" alt=\"Poll in core::task\"></details>", "tree": {"sha": "c51c621edcb81bc07d8ac0b8c87275145aa55aa9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c51c621edcb81bc07d8ac0b8c87275145aa55aa9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b", "html_url": "https://github.com/rust-lang/rust/commit/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23c652dfe3043369e6f23a79f8efb77f391c0e64", "url": "https://api.github.com/repos/rust-lang/rust/commits/23c652dfe3043369e6f23a79f8efb77f391c0e64", "html_url": "https://github.com/rust-lang/rust/commit/23c652dfe3043369e6f23a79f8efb77f391c0e64"}, {"sha": "a06ee821b7fd181ceaa9641e481e78f3189f434b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a06ee821b7fd181ceaa9641e481e78f3189f434b", "html_url": "https://github.com/rust-lang/rust/commit/a06ee821b7fd181ceaa9641e481e78f3189f434b"}], "stats": {"total": 107, "additions": 100, "deletions": 7}, "files": [{"sha": "fc0a4e747973a15c48299b5b5b8d7548d8d61edb", "filename": "library/core/src/task/poll.rs", "status": "modified", "additions": 100, "deletions": 7, "changes": 107, "blob_url": "https://github.com/rust-lang/rust/blob/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b/library%2Fcore%2Fsrc%2Ftask%2Fpoll.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b/library%2Fcore%2Fsrc%2Ftask%2Fpoll.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Ftask%2Fpoll.rs?ref=b3d11f95cc5dd687fdd185ce91e02ebe40e6f46b", "patch": "@@ -26,7 +26,21 @@ pub enum Poll<T> {\n }\n \n impl<T> Poll<T> {\n-    /// Changes the ready value of this `Poll` with the closure provided.\n+    /// Maps a `Poll<T>` to `Poll<U>` by applying a function to a contained value.\n+    ///\n+    /// # Examples\n+    ///\n+    /// Converts a `Poll<`[`String`]`>` into an `Poll<`[`usize`]`>`, consuming the original:\n+    ///\n+    /// [`String`]: ../../std/string/struct.String.html\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let poll_some_string = Poll::Ready(String::from(\"Hello, World!\"));\n+    /// // `Poll::map` takes self *by value*, consuming `poll_some_string`\n+    /// let poll_some_len = poll_some_string.map(|s| s.len());\n+    ///\n+    /// assert_eq!(poll_some_len, Poll::Ready(13));\n+    /// ```\n     #[stable(feature = \"futures_api\", since = \"1.36.0\")]\n     pub fn map<U, F>(self, f: F) -> Poll<U>\n     where\n@@ -38,15 +52,39 @@ impl<T> Poll<T> {\n         }\n     }\n \n-    /// Returns `true` if this is `Poll::Ready`\n+    /// Returns `true` if the poll is a [`Poll::Ready`] value.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let x: Poll<u32> = Poll::Ready(2);\n+    /// assert_eq!(x.is_ready(), true);\n+    ///\n+    /// let x: Poll<u32> = Poll::Pending;\n+    /// assert_eq!(x.is_ready(), false);\n+    /// ```\n     #[inline]\n     #[rustc_const_stable(feature = \"const_poll\", since = \"1.49.0\")]\n     #[stable(feature = \"futures_api\", since = \"1.36.0\")]\n     pub const fn is_ready(&self) -> bool {\n         matches!(*self, Poll::Ready(_))\n     }\n \n-    /// Returns `true` if this is `Poll::Pending`\n+    /// Returns `true` if the poll is a [`Pending`] value.\n+    ///\n+    /// [`Pending`]: Poll::Pending\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let x: Poll<u32> = Poll::Ready(2);\n+    /// assert_eq!(x.is_pending(), false);\n+    ///\n+    /// let x: Poll<u32> = Poll::Pending;\n+    /// assert_eq!(x.is_pending(), true);\n+    /// ```\n     #[inline]\n     #[rustc_const_stable(feature = \"const_poll\", since = \"1.49.0\")]\n     #[stable(feature = \"futures_api\", since = \"1.36.0\")]\n@@ -56,7 +94,20 @@ impl<T> Poll<T> {\n }\n \n impl<T, E> Poll<Result<T, E>> {\n-    /// Changes the success value of this `Poll` with the closure provided.\n+    /// Maps a `Poll<Result<T, E>>` to `Poll<Result<U, E>>` by applying a\n+    /// function to a contained `Poll::Ready(Ok)` value, leaving all other\n+    /// variants untouched.\n+    ///\n+    /// This function can be used to compose the results of two functions.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let res: Poll<Result<u8, _>> = Poll::Ready(\"12\".parse());\n+    /// let squared = res.map_ok(|n| n * n);\n+    /// assert_eq!(squared, Poll::Ready(Ok(144)));\n+    /// ```\n     #[stable(feature = \"futures_api\", since = \"1.36.0\")]\n     pub fn map_ok<U, F>(self, f: F) -> Poll<Result<U, E>>\n     where\n@@ -69,7 +120,21 @@ impl<T, E> Poll<Result<T, E>> {\n         }\n     }\n \n-    /// Changes the error value of this `Poll` with the closure provided.\n+    /// Maps a `Poll::Ready<Result<T, E>>` to `Poll::Ready<Result<T, F>>` by\n+    /// applying a function to a contained `Poll::Ready(Err)` value, leaving all other\n+    /// variants untouched.\n+    ///\n+    /// This function can be used to pass through a successful result while handling\n+    /// an error.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let res: Poll<Result<u8, _>> = Poll::Ready(\"oops\".parse());\n+    /// let res = res.map_err(|_| 0_u8);\n+    /// assert_eq!(res, Poll::Ready(Err(0)));\n+    /// ```\n     #[stable(feature = \"futures_api\", since = \"1.36.0\")]\n     pub fn map_err<U, F>(self, f: F) -> Poll<Result<T, U>>\n     where\n@@ -84,7 +149,20 @@ impl<T, E> Poll<Result<T, E>> {\n }\n \n impl<T, E> Poll<Option<Result<T, E>>> {\n-    /// Changes the success value of this `Poll` with the closure provided.\n+    /// Maps a `Poll<Option<Result<T, E>>>` to `Poll<Option<Result<U, E>>>` by\n+    /// applying a function to a contained `Poll::Ready(Some(Ok))` value,\n+    /// leaving all other variants untouched.\n+    ///\n+    /// This function can be used to compose the results of two functions.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let res: Poll<Option<Result<u8, _>>> = Poll::Ready(Some(\"12\".parse()));\n+    /// let squared = res.map_ok(|n| n * n);\n+    /// assert_eq!(squared, Poll::Ready(Some(Ok(144))));\n+    /// ```\n     #[stable(feature = \"poll_map\", since = \"1.51.0\")]\n     pub fn map_ok<U, F>(self, f: F) -> Poll<Option<Result<U, E>>>\n     where\n@@ -98,7 +176,22 @@ impl<T, E> Poll<Option<Result<T, E>>> {\n         }\n     }\n \n-    /// Changes the error value of this `Poll` with the closure provided.\n+    /// Maps a `Poll::Ready<Option<Result<T, E>>>` to\n+    /// `Poll::Ready<Option<Result<T, F>>>` by applying a function to a\n+    /// contained `Poll::Ready(Some(Err))` value, leaving all other variants\n+    /// untouched.\n+    ///\n+    /// This function can be used to pass through a successful result while handling\n+    /// an error.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # use core::task::Poll;\n+    /// let res: Poll<Option<Result<u8, _>>> = Poll::Ready(Some(\"oops\".parse()));\n+    /// let res = res.map_err(|_| 0_u8);\n+    /// assert_eq!(res, Poll::Ready(Some(Err(0))));\n+    /// ```\n     #[stable(feature = \"poll_map\", since = \"1.51.0\")]\n     pub fn map_err<U, F>(self, f: F) -> Poll<Option<Result<T, U>>>\n     where"}]}