{"sha": "a1e25a957ed616e2ed4deae80967925bb25554af", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExZTI1YTk1N2VkNjE2ZTJlZDRkZWFlODA5Njc5MjViYjI1NTU0YWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-10T16:27:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-10T16:27:18Z"}, "message": "Auto merge of #6794 - camsteffen:needless-borrowed-ref, r=flip1995\n\nImprove needless_borrowed_ref docs\n\nchangelog: none\n\nI think \"borrowed ref\" is a confusing description for this lint. Destructuring a reference is the opposite of borrowing. So I updated the wording throughout the docs. Unfortunately this nit applies to the name of the lint itself, but I won't bother changing that. One motivation for these changes is to clarify the difference between this lint and `needless_borrow` (they are actually quite different). Let me know if I need to clarify anything or if you disagree with any changes.", "tree": {"sha": "db7407e5d7d1595533ff67563fda9f5ec2c7ca0b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db7407e5d7d1595533ff67563fda9f5ec2c7ca0b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1e25a957ed616e2ed4deae80967925bb25554af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1e25a957ed616e2ed4deae80967925bb25554af", "html_url": "https://github.com/rust-lang/rust/commit/a1e25a957ed616e2ed4deae80967925bb25554af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1e25a957ed616e2ed4deae80967925bb25554af/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb27517e01e34acf21bbf6273822169f54a53987", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb27517e01e34acf21bbf6273822169f54a53987", "html_url": "https://github.com/rust-lang/rust/commit/fb27517e01e34acf21bbf6273822169f54a53987"}, {"sha": "5dbd45cbc1c213a4e796a85b281f5bc397bf9000", "url": "https://api.github.com/repos/rust-lang/rust/commits/5dbd45cbc1c213a4e796a85b281f5bc397bf9000", "html_url": "https://github.com/rust-lang/rust/commit/5dbd45cbc1c213a4e796a85b281f5bc397bf9000"}], "stats": {"total": 47, "additions": 18, "deletions": 29}, "files": [{"sha": "f449f397e7d6163e4f81ce25475ad21c3ac59e69", "filename": "clippy_lints/src/needless_borrowed_ref.rs", "status": "modified", "additions": 18, "deletions": 29, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/a1e25a957ed616e2ed4deae80967925bb25554af/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1e25a957ed616e2ed4deae80967925bb25554af/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs?ref=a1e25a957ed616e2ed4deae80967925bb25554af", "patch": "@@ -1,7 +1,3 @@\n-//! Checks for useless borrowed references.\n-//!\n-//! This lint is **warn** by default\n-\n use crate::utils::{snippet_with_applicability, span_lint_and_then};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n@@ -10,44 +6,37 @@ use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n declare_clippy_lint! {\n-    /// **What it does:** Checks for useless borrowed references.\n-    ///\n-    /// **Why is this bad?** It is mostly useless and make the code look more\n-    /// complex than it\n-    /// actually is.\n+    /// **What it does:** Checks for bindings that destructure a reference and borrow the inner\n+    /// value with `&ref`.\n     ///\n-    /// **Known problems:** It seems that the `&ref` pattern is sometimes useful.\n-    /// For instance in the following snippet:\n-    /// ```rust,ignore\n-    /// enum Animal {\n-    ///     Cat(u64),\n-    ///     Dog(u64),\n-    /// }\n+    /// **Why is this bad?** This pattern has no effect in almost all cases.\n     ///\n-    /// fn foo(a: &Animal, b: &Animal) {\n+    /// **Known problems:** In some cases, `&ref` is needed to avoid a lifetime mismatch error.\n+    /// Example:\n+    /// ```rust\n+    /// fn foo(a: &Option<String>, b: &Option<String>) {\n     ///     match (a, b) {\n-    ///         (&Animal::Cat(v), k) | (k, &Animal::Cat(v)) => (), // lifetime mismatch error\n-    ///         (&Animal::Dog(ref c), &Animal::Dog(_)) => ()\n-    ///     }\n+    ///         (None, &ref c) | (&ref c, None) => (),\n+    ///         (&Some(ref c), _) => (),\n+    ///     };\n     /// }\n     /// ```\n-    /// There is a lifetime mismatch error for `k` (indeed a and b have distinct\n-    /// lifetime).\n-    /// This can be fixed by using the `&ref` pattern.\n-    /// However, the code can also be fixed by much cleaner ways\n     ///\n     /// **Example:**\n+    /// Bad:\n     /// ```rust\n     /// let mut v = Vec::<String>::new();\n     /// let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n     /// ```\n-    /// This closure takes a reference on something that has been matched as a\n-    /// reference and\n-    /// de-referenced.\n-    /// As such, it could just be |a| a.is_empty()\n+    ///\n+    /// Good:\n+    /// ```rust\n+    /// let mut v = Vec::<String>::new();\n+    /// let _ = v.iter_mut().filter(|a| a.is_empty());\n+    /// ```\n     pub NEEDLESS_BORROWED_REFERENCE,\n     complexity,\n-    \"taking a needless borrowed reference\"\n+    \"destructuring a reference and borrowing the inner value\"\n }\n \n declare_lint_pass!(NeedlessBorrowedRef => [NEEDLESS_BORROWED_REFERENCE]);"}]}