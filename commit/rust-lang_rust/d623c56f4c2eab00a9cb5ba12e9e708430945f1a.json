{"sha": "d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2MjNjNTZmNGMyZWFiMDBhOWNiNWJhMTJlOWU3MDg0MzA5NDVmMWE=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-30T17:18:49Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-11-12T10:06:11Z"}, "message": "ci: extract running the build into a script", "tree": {"sha": "f0818a00a5064ee904d3efdd08d1afb2522ecce2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f0818a00a5064ee904d3efdd08d1afb2522ecce2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl3KhBYACgkQPgar6Auq\n8ZyFWQ/9EwFuTZWc7akd6DPESsME9dHXXS/mAUAlOLJ0J6fZPXRAvvC8GvK9SlUU\nITk4yQWpzwCS8nJRKH+4FqCJaDqpJ9y1Zdl0e6UFCtZap+TjBkzXszj+QpO+kJQ6\nA2eIgTtR8oiy78UsvcUilIKyOPZtqdT7qQ3ZppTLCcM3QLrcy6GN82BBtZo5lf5y\nOpA8JpbJknxFklojrAROaLbe6G5WMtbdJRzpS3MwkpHaz+OctJMDFJKQgbjWi4pA\nS5xT2rfYgjh5R8haS3mF2b1ks4xOU11Gg+8DFGFw6fXFIhjwAHSElrlLech5mHSp\nGFzkBDC6Wj3CFRE/NqNNcdcykXcsED+gBTJbErPvMnMlA5RxKwThBy5yWo+L/zQK\nEs4w7j3QQcikdE5i+UBCXLGYqvNtBdSkOo4N+gXU7MGDFgLBltz2D7N8uJ0KBgdh\naqTG3/6GRrKvMi5W64UuN08TJmS4AhoHgHLF06bay6Jhum6570mMp1l+w9R2+bnB\nBbuTH0zA6hN9Q9GTGOKVyQIRjqp/Tsy6FzY6x04xcw2A/TIh8cMc6YqoHnQzxn7X\nxN2oyv3B5WIF3C/aonSFiSZHR/e802XCpVJOZC4GCPMVUpDdr6PdJG6lDoCKVOBn\nmJnw55Brjg4RbV6A4odRJi58gCuUCuKfcEpEF4TTr1Pi2nMTNjk=\n=LhU6\n-----END PGP SIGNATURE-----", "payload": "tree f0818a00a5064ee904d3efdd08d1afb2522ecce2\nparent 6104aa77eb97050c3b302a0d13934040de84cda9\nauthor Pietro Albini <pietro@pietroalbini.org> 1572455929 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1573553171 +0100\n\nci: extract running the build into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "html_url": "https://github.com/rust-lang/rust/commit/d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d623c56f4c2eab00a9cb5ba12e9e708430945f1a/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6104aa77eb97050c3b302a0d13934040de84cda9", "url": "https://api.github.com/repos/rust-lang/rust/commits/6104aa77eb97050c3b302a0d13934040de84cda9", "html_url": "https://github.com/rust-lang/rust/commit/6104aa77eb97050c3b302a0d13934040de84cda9"}], "stats": {"total": 36, "additions": 22, "deletions": 14}, "files": [{"sha": "fe2bee507152db17992e87e0c07367ce92a394ed", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 1, "deletions": 14, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d623c56f4c2eab00a9cb5ba12e9e708430945f1a/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d623c56f4c2eab00a9cb5ba12e9e708430945f1a/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "patch": "@@ -150,22 +150,9 @@ steps:\n   condition: and(succeeded(), not(variables.SKIP_JOB), eq(variables['IMAGE'], 'mingw-check'))\n   displayName: Verify the publish_toolstate script works\n \n-- bash: |\n-    set -e\n-    # Remove any preexisting rustup installation since it can interfere\n-    # with the cargotest step and its auto-detection of things like Clippy in\n-    # the environment\n-    rustup self uninstall -y || true\n-    if [ \"$IMAGE\" = \"\" ]; then\n-      src/ci/run.sh\n-    else\n-      src/ci/docker/run.sh $IMAGE\n-    fi\n-  #timeoutInMinutes: 180\n+- bash: src/ci/scripts/run-build-from-ci.sh\n   timeoutInMinutes: 600\n   env:\n-    CI: true\n-    SRC: .\n     AWS_ACCESS_KEY_ID: $(SCCACHE_AWS_ACCESS_KEY_ID)\n     AWS_SECRET_ACCESS_KEY: $(SCCACHE_AWS_SECRET_ACCESS_KEY)\n     TOOLSTATE_REPO_ACCESS_TOKEN: $(TOOLSTATE_REPO_ACCESS_TOKEN)"}, {"sha": "c02117f459de0463adb7f619398a3140dc3a05ea", "filename": "src/ci/scripts/run-build-from-ci.sh", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d623c56f4c2eab00a9cb5ba12e9e708430945f1a/src%2Fci%2Fscripts%2Frun-build-from-ci.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d623c56f4c2eab00a9cb5ba12e9e708430945f1a/src%2Fci%2Fscripts%2Frun-build-from-ci.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Frun-build-from-ci.sh?ref=d623c56f4c2eab00a9cb5ba12e9e708430945f1a", "patch": "@@ -0,0 +1,21 @@\n+#!/bin/bash\n+# Start the CI build. You shouldn't run this locally: call either src/ci/run.sh\n+# or src/ci/docker/run.sh instead.\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+export CI=\"true\"\n+export SRC=.\n+\n+# Remove any preexisting rustup installation since it can interfere\n+# with the cargotest step and its auto-detection of things like Clippy in\n+# the environment\n+rustup self uninstall -y || true\n+if [ -z \"${IMAGE+x}\" ]; then\n+    src/ci/run.sh\n+else\n+    src/ci/docker/run.sh \"${IMAGE}\"\n+fi"}]}