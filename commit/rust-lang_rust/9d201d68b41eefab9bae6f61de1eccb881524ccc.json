{"sha": "9d201d68b41eefab9bae6f61de1eccb881524ccc", "node_id": "C_kwDOAAsO6NoAKDlkMjAxZDY4YjQxZWVmYWI5YmFlNmY2MWRlMWVjY2I4ODE1MjRjY2M", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-06-09T07:17:46Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2022-06-09T07:17:46Z"}, "message": "Fix `#[expect]` for `default_numeric_fallback`", "tree": {"sha": "4bd837da98ce01869085be1e2eea3c6453ba50c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bd837da98ce01869085be1e2eea3c6453ba50c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d201d68b41eefab9bae6f61de1eccb881524ccc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEwgBEOx3xlHwII7PG9cWdDmaeUwIFAmKhnpoACgkQ9cWdDmae\nUwIOVA/9EORnCF3q9FszN9Il81ZyTc1Tvb8ZwJ/uRepdelKh3ZmZBFNBkgc0jsfV\nHNJx2YiU+YoGK85L5GzZyCrOtpvnK0xFYRqObMDzcH4kFEk8Z8A8mpZSeNuTphs4\nNBhqUtWzIq54fDKcUiTOH9Ox4WC8cx6jrdxteboVdx9nc5Q97VQt2IFLLp5/fT1q\nz/W/WSjkvh4vSHQsirSlS6pBh/9lUNZKNz3Tt0iqPKvCtaXJYNgerGdr8fl02yxs\nHfqqIDQmTn/zxgG73CNEN8ZEuLPUkndakQMbfmqcYYmFuO38P1fcrTbGYw9lyZgH\nPfIl340nKuDs7p8tk6/3Q4BaBbhgrOFWz/bvmicS47F8DGlPUeBqLfsf0ChbwQyD\neYV22xNfme5UGTiSNg2eONA+1SYZ2dQIl2j9kBPnp1fQBTqtyzBFWKL7LvnD9tky\n2V58IP5BjvzStEW1sWsyiqD2mTkPEceTg4WtO4SDpUph2N23oSrgn2SZboTaMSCk\nwixNT7rICFzt0PITnkPxOc/Pd5WBbIVkiyZS8VfcmX495j0nhp+U9+EvNJJ6r37T\n1/0cXBKoAt4Pitq1cKApERB1E+m9Erw+UVWWtX0QKIS5IVBcjcTRvfDmRdtTtZM9\n+QETQiqPpYvTOL4vsLronPRH0QFcLd6hrgkG8S1QDtyoVad8e6E=\n=bCYK\n-----END PGP SIGNATURE-----", "payload": "tree 4bd837da98ce01869085be1e2eea3c6453ba50c2\nparent 8db734990be40e2acd59c2b20bf6e02343830fd6\nauthor xFrednet <xFrednet@gmail.com> 1654759066 +0200\ncommitter xFrednet <xFrednet@gmail.com> 1654759066 +0200\n\nFix `#[expect]` for `default_numeric_fallback`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d201d68b41eefab9bae6f61de1eccb881524ccc", "html_url": "https://github.com/rust-lang/rust/commit/9d201d68b41eefab9bae6f61de1eccb881524ccc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d201d68b41eefab9bae6f61de1eccb881524ccc/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8db734990be40e2acd59c2b20bf6e02343830fd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/8db734990be40e2acd59c2b20bf6e02343830fd6", "html_url": "https://github.com/rust-lang/rust/commit/8db734990be40e2acd59c2b20bf6e02343830fd6"}], "stats": {"total": 77, "additions": 45, "deletions": 32}, "files": [{"sha": "fb418a3251f588c4cc58dbb5d8da10c88ffc96bf", "filename": "clippy_lints/src/default_numeric_fallback.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9d201d68b41eefab9bae6f61de1eccb881524ccc/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d201d68b41eefab9bae6f61de1eccb881524ccc/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs?ref=9d201d68b41eefab9bae6f61de1eccb881524ccc", "patch": "@@ -1,4 +1,4 @@\n-use clippy_utils::diagnostics::span_lint_and_sugg;\n+use clippy_utils::diagnostics::span_lint_hir_and_then;\n use clippy_utils::numeric_literal;\n use clippy_utils::source::snippet_opt;\n use if_chain::if_chain;\n@@ -76,7 +76,7 @@ impl<'a, 'tcx> NumericFallbackVisitor<'a, 'tcx> {\n     }\n \n     /// Check whether a passed literal has potential to cause fallback or not.\n-    fn check_lit(&self, lit: &Lit, lit_ty: Ty<'tcx>) {\n+    fn check_lit(&self, lit: &Lit, lit_ty: Ty<'tcx>, emit_hir_id: HirId) {\n         if_chain! {\n                 if !in_external_macro(self.cx.sess(), lit.span);\n                 if let Some(ty_bound) = self.ty_bounds.last();\n@@ -101,14 +101,15 @@ impl<'a, 'tcx> NumericFallbackVisitor<'a, 'tcx> {\n                         }\n                     };\n                     let sugg = numeric_literal::format(&src, Some(suffix), is_float);\n-                    span_lint_and_sugg(\n+                    span_lint_hir_and_then(\n                         self.cx,\n                         DEFAULT_NUMERIC_FALLBACK,\n+                        emit_hir_id,\n                         lit.span,\n                         \"default numeric fallback might occur\",\n-                        \"consider adding suffix\",\n-                        sugg,\n-                        Applicability::MaybeIncorrect,\n+                        |diag| {\n+                            diag.span_suggestion(lit.span, \"consider adding suffix\", sugg, Applicability::MaybeIncorrect);\n+                        }\n                     );\n                 }\n         }\n@@ -179,7 +180,7 @@ impl<'a, 'tcx> Visitor<'tcx> for NumericFallbackVisitor<'a, 'tcx> {\n \n             ExprKind::Lit(lit) => {\n                 let ty = self.cx.typeck_results().expr_ty(expr);\n-                self.check_lit(lit, ty);\n+                self.check_lit(lit, ty, expr.hir_id);\n                 return;\n             },\n "}, {"sha": "55451cf2f7d0fa972bc40a7d48d8709952bdae6e", "filename": "tests/ui/default_numeric_fallback_i32.fixed", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed?ref=9d201d68b41eefab9bae6f61de1eccb881524ccc", "patch": "@@ -1,6 +1,7 @@\n // run-rustfix\n // aux-build:macro_rules.rs\n \n+#![feature(lint_reasons)]\n #![warn(clippy::default_numeric_fallback)]\n #![allow(\n     unused,\n@@ -173,4 +174,9 @@ mod in_macro {\n     }\n }\n \n+fn check_expect_suppression() {\n+    #[expect(clippy::default_numeric_fallback)]\n+    let x = 21;\n+}\n+\n fn main() {}"}, {"sha": "62d72f2febaaa4fc75c7d80a707fa9e75f475588", "filename": "tests/ui/default_numeric_fallback_i32.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.rs?ref=9d201d68b41eefab9bae6f61de1eccb881524ccc", "patch": "@@ -1,6 +1,7 @@\n // run-rustfix\n // aux-build:macro_rules.rs\n \n+#![feature(lint_reasons)]\n #![warn(clippy::default_numeric_fallback)]\n #![allow(\n     unused,\n@@ -173,4 +174,9 @@ mod in_macro {\n     }\n }\n \n+fn check_expect_suppression() {\n+    #[expect(clippy::default_numeric_fallback)]\n+    let x = 21;\n+}\n+\n fn main() {}"}, {"sha": "f7c5e724c403cdc4a85658800e89e377b106c62e", "filename": "tests/ui/default_numeric_fallback_i32.stderr", "status": "modified", "additions": 25, "deletions": 25, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9d201d68b41eefab9bae6f61de1eccb881524ccc/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr?ref=9d201d68b41eefab9bae6f61de1eccb881524ccc", "patch": "@@ -1,151 +1,151 @@\n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:20:17\n+  --> $DIR/default_numeric_fallback_i32.rs:21:17\n    |\n LL |         let x = 22;\n    |                 ^^ help: consider adding suffix: `22_i32`\n    |\n    = note: `-D clippy::default-numeric-fallback` implied by `-D warnings`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:21:18\n+  --> $DIR/default_numeric_fallback_i32.rs:22:18\n    |\n LL |         let x = [1, 2, 3];\n    |                  ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:21:21\n+  --> $DIR/default_numeric_fallback_i32.rs:22:21\n    |\n LL |         let x = [1, 2, 3];\n    |                     ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:21:24\n+  --> $DIR/default_numeric_fallback_i32.rs:22:24\n    |\n LL |         let x = [1, 2, 3];\n    |                        ^ help: consider adding suffix: `3_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:22:28\n+  --> $DIR/default_numeric_fallback_i32.rs:23:28\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                            ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:22:31\n+  --> $DIR/default_numeric_fallback_i32.rs:23:31\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                               ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:22:44\n+  --> $DIR/default_numeric_fallback_i32.rs:23:44\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                                            ^ help: consider adding suffix: `3_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:22:47\n+  --> $DIR/default_numeric_fallback_i32.rs:23:47\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                                               ^ help: consider adding suffix: `4_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:23:23\n+  --> $DIR/default_numeric_fallback_i32.rs:24:23\n    |\n LL |         let x = match 1 {\n    |                       ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:24:13\n+  --> $DIR/default_numeric_fallback_i32.rs:25:13\n    |\n LL |             1 => 1,\n    |             ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:24:18\n+  --> $DIR/default_numeric_fallback_i32.rs:25:18\n    |\n LL |             1 => 1,\n    |                  ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:25:18\n+  --> $DIR/default_numeric_fallback_i32.rs:26:18\n    |\n LL |             _ => 2,\n    |                  ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:42:21\n+  --> $DIR/default_numeric_fallback_i32.rs:43:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:50:21\n+  --> $DIR/default_numeric_fallback_i32.rs:51:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:56:21\n+  --> $DIR/default_numeric_fallback_i32.rs:57:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:68:9\n+  --> $DIR/default_numeric_fallback_i32.rs:69:9\n    |\n LL |         1\n    |         ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:74:27\n+  --> $DIR/default_numeric_fallback_i32.rs:75:27\n    |\n LL |         let f = || -> _ { 1 };\n    |                           ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:78:29\n+  --> $DIR/default_numeric_fallback_i32.rs:79:29\n    |\n LL |         let f = || -> i32 { 1 };\n    |                             ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:92:21\n+  --> $DIR/default_numeric_fallback_i32.rs:93:21\n    |\n LL |         generic_arg(1);\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:95:32\n+  --> $DIR/default_numeric_fallback_i32.rs:96:32\n    |\n LL |         let x: _ = generic_arg(1);\n    |                                ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:113:28\n+  --> $DIR/default_numeric_fallback_i32.rs:114:28\n    |\n LL |         GenericStruct { x: 1 };\n    |                            ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:116:36\n+  --> $DIR/default_numeric_fallback_i32.rs:117:36\n    |\n LL |         let _ = GenericStruct { x: 1 };\n    |                                    ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:134:24\n+  --> $DIR/default_numeric_fallback_i32.rs:135:24\n    |\n LL |         GenericEnum::X(1);\n    |                        ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:154:23\n+  --> $DIR/default_numeric_fallback_i32.rs:155:23\n    |\n LL |         s.generic_arg(1);\n    |                       ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:161:21\n+  --> $DIR/default_numeric_fallback_i32.rs:162:21\n    |\n LL |             let x = 22;\n    |                     ^^ help: consider adding suffix: `22_i32`"}]}