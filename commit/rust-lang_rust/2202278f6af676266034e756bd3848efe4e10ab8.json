{"sha": "2202278f6af676266034e756bd3848efe4e10ab8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyMDIyNzhmNmFmNjc2MjY2MDM0ZTc1NmJkMzg0OGVmZTRlMTBhYjg=", "commit": {"author": {"name": "Vytautas Astrauskas", "email": "astrauv@amazon.com", "date": "2020-04-06T23:30:30Z"}, "committer": {"name": "Vytautas Astrauskas", "email": "astrauv@amazon.com", "date": "2020-04-27T21:23:32Z"}, "message": "Fix pthread_self.", "tree": {"sha": "fffa32b5484a6f32c68703496a2d73fb42fd682f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fffa32b5484a6f32c68703496a2d73fb42fd682f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2202278f6af676266034e756bd3848efe4e10ab8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2202278f6af676266034e756bd3848efe4e10ab8", "html_url": "https://github.com/rust-lang/rust/commit/2202278f6af676266034e756bd3848efe4e10ab8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2202278f6af676266034e756bd3848efe4e10ab8/comments", "author": null, "committer": null, "parents": [{"sha": "b04bf8a51480c05fc9984476a78f07b927f2672f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b04bf8a51480c05fc9984476a78f07b927f2672f", "html_url": "https://github.com/rust-lang/rust/commit/b04bf8a51480c05fc9984476a78f07b927f2672f"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "4cd3b84991128bd958205d74c7c7a729eb8c508c", "filename": "src/shims/foreign_items/posix.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2202278f6af676266034e756bd3848efe4e10ab8/src%2Fshims%2Fforeign_items%2Fposix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2202278f6af676266034e756bd3848efe4e10ab8/src%2Fshims%2Fforeign_items%2Fposix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fforeign_items%2Fposix.rs?ref=2202278f6af676266034e756bd3848efe4e10ab8", "patch": "@@ -329,6 +329,10 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                 let result = this.pthread_detach(args[0])?;\n                 this.write_scalar(Scalar::from_i32(result), dest)?;\n             }\n+            \"pthread_self\" => {\n+                assert_eq!(args.len(), 0);\n+                this.pthread_self(dest)?;\n+            }\n             \"prctl\" => {\n                 assert_eq!(args.len(), 5);\n                 let result = this.prctl(args[0], args[1], args[2], args[3], args[4])?;\n@@ -356,7 +360,6 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n             // These shims are enabled only when the caller is in the standard library.\n             | \"pthread_attr_init\"\n             | \"pthread_attr_destroy\"\n-            | \"pthread_self\"\n             | \"pthread_attr_setstacksize\"\n             | \"pthread_condattr_init\"\n             | \"pthread_condattr_setclock\""}, {"sha": "fc733d7f5c9f282e0c8e8f8b2c6e38fc5150da82", "filename": "src/shims/threads.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2202278f6af676266034e756bd3848efe4e10ab8/src%2Fshims%2Fthreads.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2202278f6af676266034e756bd3848efe4e10ab8/src%2Fshims%2Fthreads.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fthreads.rs?ref=2202278f6af676266034e756bd3848efe4e10ab8", "patch": "@@ -81,6 +81,12 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n \n         Ok(0)\n     }\n+    fn pthread_self(&mut self, dest: PlaceTy<'tcx, Tag>) -> InterpResult<'tcx> {\n+        let this = self.eval_context_mut();\n+\n+        let thread_id = this.get_active_thread()?;\n+        this.write_scalar(Scalar::from_uint(thread_id.index() as u128, dest.layout.size), dest)\n+    }\n     fn prctl(\n         &mut self,\n         option: OpTy<'tcx, Tag>,"}]}