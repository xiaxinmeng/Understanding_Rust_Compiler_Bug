{"sha": "069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "node_id": "C_kwDOAAsO6NoAKDA2OWQ4ZmRiNzFhOWE0NmE3NjU1MmU4ZWVhN2Q0MjdiNGQ2ZjA4YTE", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-06-05T16:25:46Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-06-12T00:42:23Z"}, "message": "test for Stacked Borrows error during vtable validation", "tree": {"sha": "f4faf97ea4aaf86f478e961477689686a49ae939", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4faf97ea4aaf86f478e961477689686a49ae939"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "html_url": "https://github.com/rust-lang/rust/commit/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ada7b72a879d79aaa06f0a2a95edd520615da1a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ada7b72a879d79aaa06f0a2a95edd520615da1a2", "html_url": "https://github.com/rust-lang/rust/commit/ada7b72a879d79aaa06f0a2a95edd520615da1a2"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "dd9ba1dfb2bda6a9da23f74f0953e3c5fdaa0981", "filename": "tests/fail/stacked_borrows/vtable.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1/tests%2Ffail%2Fstacked_borrows%2Fvtable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1/tests%2Ffail%2Fstacked_borrows%2Fvtable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ffail%2Fstacked_borrows%2Fvtable.rs?ref=069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "patch": "@@ -0,0 +1,19 @@\n+// error-pattern: vtable pointer does not have permission\n+#![feature(ptr_metadata)]\n+\n+trait Foo {}\n+\n+impl Foo for u32 {}\n+\n+fn uwu(thin: *const (), meta: &'static ()) -> *const dyn Foo {\n+    core::ptr::from_raw_parts(thin, unsafe { core::mem::transmute(meta) })\n+}\n+\n+fn main() {\n+    unsafe {\n+        let orig = 1_u32;\n+        let x = &orig as &dyn Foo;\n+        let (ptr, meta) = (x as *const dyn Foo).to_raw_parts();\n+        let _ = uwu(ptr, core::mem::transmute(meta));\n+    }\n+}"}, {"sha": "ac3d71045f0cc07f44be32ddb0cc7e9d5eb3ead7", "filename": "tests/fail/stacked_borrows/vtable.stderr", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1/tests%2Ffail%2Fstacked_borrows%2Fvtable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/069d8fdb71a9a46a76552e8eea7d427b4d6f08a1/tests%2Ffail%2Fstacked_borrows%2Fvtable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ffail%2Fstacked_borrows%2Fvtable.stderr?ref=069d8fdb71a9a46a76552e8eea7d427b4d6f08a1", "patch": "@@ -0,0 +1,25 @@\n+error: Undefined Behavior: type validation failed: encountered vtable pointer does not have permission to read drop function pointer\n+  --> RUSTLIB/core/src/ptr/metadata.rs:LL:CC\n+   |\n+LL |     unsafe { PtrRepr { components: PtrComponents { data_address, metadata } }.const_ptr }\n+   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered vtable pointer does not have permission to read drop function pointer\n+   |\n+   = help: this indicates a bug in the program: it performed an invalid operation, and caused Undefined Behavior\n+   = help: see https://doc.rust-lang.org/nightly/reference/behavior-considered-undefined.html for further information\n+           \n+   = note: inside `std::ptr::from_raw_parts::<dyn Foo>` at RUSTLIB/core/src/ptr/metadata.rs:LL:CC\n+note: inside `uwu` at $DIR/vtable.rs:LL:CC\n+  --> $DIR/vtable.rs:LL:CC\n+   |\n+LL |     core::ptr::from_raw_parts(thin, unsafe { core::mem::transmute(meta) })\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+note: inside `main` at $DIR/vtable.rs:LL:CC\n+  --> $DIR/vtable.rs:LL:CC\n+   |\n+LL |         let _ = uwu(ptr, core::mem::transmute(meta));\n+   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+note: some details are omitted, run with `MIRIFLAGS=-Zmiri-backtrace=full` for a verbose backtrace\n+\n+error: aborting due to previous error\n+"}]}