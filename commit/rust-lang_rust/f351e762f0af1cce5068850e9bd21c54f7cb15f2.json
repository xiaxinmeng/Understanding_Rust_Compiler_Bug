{"sha": "f351e762f0af1cce5068850e9bd21c54f7cb15f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzNTFlNzYyZjBhZjFjY2U1MDY4ODUwZTliZDIxYzU0ZjdjYjE1ZjI=", "commit": {"author": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2015-08-08T02:08:28Z"}, "committer": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2015-08-08T02:08:28Z"}, "message": "Fix the diagnostic for fat pointer to usize casts.\n\nFixes #27450.", "tree": {"sha": "0da9bb54eb17366c67159b1909b8a90129e54923", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0da9bb54eb17366c67159b1909b8a90129e54923"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f351e762f0af1cce5068850e9bd21c54f7cb15f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f351e762f0af1cce5068850e9bd21c54f7cb15f2", "html_url": "https://github.com/rust-lang/rust/commit/f351e762f0af1cce5068850e9bd21c54f7cb15f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f351e762f0af1cce5068850e9bd21c54f7cb15f2/comments", "author": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5d90d98402475b6e154ce216f9efcb80da1a747", "url": "https://api.github.com/repos/rust-lang/rust/commits/e5d90d98402475b6e154ce216f9efcb80da1a747", "html_url": "https://github.com/rust-lang/rust/commit/e5d90d98402475b6e154ce216f9efcb80da1a747"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "b40be59ecbeb3ff59561890a71509d411f107751", "filename": "src/librustc_typeck/check/cast.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcast.rs?ref=f351e762f0af1cce5068850e9bd21c54f7cb15f2", "patch": "@@ -100,6 +100,7 @@ enum CastError {\n     DifferingKinds,\n     IllegalCast,\n     NeedViaPtr,\n+    NeedViaThinPtr,\n     NeedViaInt,\n     NeedViaUsize,\n     NonScalar,\n@@ -120,6 +121,7 @@ impl<'tcx> CastCheck<'tcx> {\n                              e: CastError) {\n         match e {\n             CastError::NeedViaPtr |\n+            CastError::NeedViaThinPtr |\n             CastError::NeedViaInt |\n             CastError::NeedViaUsize => {\n                 fcx.type_error_message(self.span, |actual| {\n@@ -130,6 +132,7 @@ impl<'tcx> CastCheck<'tcx> {\n                 fcx.ccx.tcx.sess.fileline_help(self.span,\n                     &format!(\"cast through {} first\", match e {\n                         CastError::NeedViaPtr => \"a raw pointer\",\n+                        CastError::NeedViaThinPtr => \"a thin pointer\",\n                         CastError::NeedViaInt => \"an integer\",\n                         CastError::NeedViaUsize => \"a usize\",\n                         _ => unreachable!()\n@@ -324,7 +327,7 @@ impl<'tcx> CastCheck<'tcx> {\n         if fcx.type_is_known_to_be_sized(m_expr.ty, self.span) {\n             Ok(CastKind::PtrAddrCast)\n         } else {\n-            Err(CastError::NeedViaPtr)\n+            Err(CastError::NeedViaThinPtr)\n         }\n     }\n "}, {"sha": "4603ed00347343eb8e4d4dc29ec2a40085cc0284", "filename": "src/test/compile-fail/cast-rfc0401.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Ftest%2Fcompile-fail%2Fcast-rfc0401.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Ftest%2Fcompile-fail%2Fcast-rfc0401.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcast-rfc0401.rs?ref=f351e762f0af1cce5068850e9bd21c54f7cb15f2", "patch": "@@ -96,7 +96,7 @@ fn main()\n     let _ = &f as *const f64; //~ ERROR casting\n     let _ = fat_v as usize;\n     //~^ ERROR casting\n-    //~^^ HELP through a raw pointer first\n+    //~^^ HELP through a thin pointer first\n \n     let a : *const str = \"hello\";\n     let _ = a as *const Foo;"}, {"sha": "1c462779b433c707541e1bd19d0fafef17fb3f99", "filename": "src/test/compile-fail/fat-ptr-cast.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Ftest%2Fcompile-fail%2Ffat-ptr-cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f351e762f0af1cce5068850e9bd21c54f7cb15f2/src%2Ftest%2Fcompile-fail%2Ffat-ptr-cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffat-ptr-cast.rs?ref=f351e762f0af1cce5068850e9bd21c54f7cb15f2", "patch": "@@ -21,7 +21,7 @@ fn main() {\n     b as usize; //~ ERROR non-scalar cast\n     p as usize;\n     //~^ ERROR casting\n-    //~^^ HELP cast through a raw pointer\n+    //~^^ HELP cast through a thin pointer\n \n     // #22955\n     q as *const [i32]; //~ ERROR casting"}]}