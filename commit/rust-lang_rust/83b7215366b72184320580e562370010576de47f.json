{"sha": "83b7215366b72184320580e562370010576de47f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzYjcyMTUzNjZiNzIxODQzMjA1ODBlNTYyMzcwMDEwNTc2ZGU0N2Y=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-28T23:52:11Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-28T23:55:07Z"}, "message": "Cleanup attribute code. Issue #487", "tree": {"sha": "b353869e9f50f37c8e956c51025a3cb03993d2f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b353869e9f50f37c8e956c51025a3cb03993d2f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/83b7215366b72184320580e562370010576de47f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/83b7215366b72184320580e562370010576de47f", "html_url": "https://github.com/rust-lang/rust/commit/83b7215366b72184320580e562370010576de47f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/83b7215366b72184320580e562370010576de47f/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82a74fcb3f0c30f324cc02f27705b0120231e243", "url": "https://api.github.com/repos/rust-lang/rust/commits/82a74fcb3f0c30f324cc02f27705b0120231e243", "html_url": "https://github.com/rust-lang/rust/commit/82a74fcb3f0c30f324cc02f27705b0120231e243"}], "stats": {"total": 28, "additions": 16, "deletions": 12}, "files": [{"sha": "4649038d51d231f01e4d356a8448618d986e2fc0", "filename": "src/comp/metadata/creader.rs", "status": "modified", "additions": 15, "deletions": 11, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcreader.rs?ref=83b7215366b72184320580e562370010576de47f", "patch": "@@ -56,20 +56,24 @@ fn find_library_crate(&session::session sess, &ast::ident ident,\n                       &vec[@ast::meta_item] metas,\n                       &vec[str] library_search_paths) ->\n    option::t[tup(str, vec[u8])] {\n-    let str crate_name = ident;\n-    for (@ast::meta_item mi in metas) {\n-        alt (mi.node) {\n-            case (ast::meta_name_value(?name, ?value)) {\n-                if (name == \"name\") {\n-                    crate_name = value;\n-                    break;\n+\n+    auto crate_name = {\n+        auto name_items = attr::find_meta_items_by_name(metas, \"name\");\n+        alt (vec::last(name_items)) {\n+            case (some(?i)) {\n+                alt (i.node) {\n+                    case (ast::meta_name_value(_, ?v)) { v }\n+                    case (_) {\n+                        // FIXME: Probably want a warning here since the user\n+                        // is using the wrong type of meta item\n+                        ident\n+                    }\n                 }\n             }\n-            case (_) {\n-                // FIXME (#487)\n-            }\n+            case (none) { ident }\n         }\n-    }\n+    };\n+\n     auto nn = default_native_lib_naming(sess);\n     let str prefix = nn.prefix + crate_name;\n     // FIXME: we could probably use a 'glob' function in std::fs but it will"}, {"sha": "8247d3102e3ee29ccb95fbd08ec2ee516b135a75", "filename": "src/comp/metadata/encoder.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fencoder.rs?ref=83b7215366b72184320580e562370010576de47f", "patch": "@@ -415,7 +415,6 @@ fn write_int(&io::writer writer, &int n) {\n }\n \n fn encode_meta_item(&ebml::writer ebml_w, &meta_item mi) {\n-    // FIXME (#487): Support all forms of meta item\n     alt (mi.node) {\n         case (meta_word(?name)) {\n             ebml::start_tag(ebml_w, tag_meta_item_word);"}, {"sha": "1c15e9d8d2513e98e1d2879e2b68e0b18c795789", "filename": "src/comp/middle/attr.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmiddle%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/83b7215366b72184320580e562370010576de47f/src%2Fcomp%2Fmiddle%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fattr.rs?ref=83b7215366b72184320580e562370010576de47f", "patch": "@@ -7,6 +7,7 @@ import front::ast;\n export attr_metas;\n export find_linkage_metas;\n export find_attrs_by_name;\n+export find_meta_items_by_name;\n export contains;\n export sort_meta_items;\n "}]}