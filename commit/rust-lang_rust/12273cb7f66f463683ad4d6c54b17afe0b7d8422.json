{"sha": "12273cb7f66f463683ad4d6c54b17afe0b7d8422", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyMjczY2I3ZjY2ZjQ2MzY4M2FkNGQ2YzU0YjE3YWZlMGI3ZDg0MjI=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-10-30T21:08:53Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-10-30T21:35:54Z"}, "message": "Make init_locking return a reference to the initialized data", "tree": {"sha": "5a2f502cefbbabf44bbd4eb6f85597bc91357412", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a2f502cefbbabf44bbd4eb6f85597bc91357412"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12273cb7f66f463683ad4d6c54b17afe0b7d8422", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAl26AjsACgkQiMlBzaHU\nZDJ3zQ/9FCSRN+xC74G+0w4YvKlQ6ja4yg3D0T9a1wCu8JHsl/Cfhy3gyPnbK7mr\naGX6dQGOObUjnI9HiL8PrLlpHTDPPVshw9qF6WZhjMR+Ac3AGAyaSM82Pahyj6es\ngmTX7cePSiIGOpRoB3oY5Pbuvr2xrOzNqLVu0TgxpXxzCbqK8mjkGjXc4MvHtibS\nJjnNaYghKq6Ua3eJbRt7dAOBv1H1HQcv5fraP3Kv9UFM/tIdphARfuGXLQBSJ2vK\n7rogZiInhYbOpeODYgKyNTEdvJzLb5XUNpKJVKlScqxEEXO5zRULetRqg6oJB+fP\nFtxJud4ZAXLnMNLKHFXgCssmYsoX6STm/38EjkViqY0zXdGiMjNiVIy86151bv2l\n0KmhUMbdLcxGQSOlZYUXrc5chDi/15bjGguc5cglLJcL1FyvXpHHuVYK+7vQaruK\nqiGLfQr0sQXnP8/UXiVAz+MZJT2pV5OV8Un51NkI/lAFTvD/pId2LkgD6t5o78FK\nHMlRvn0BD1zb59H5f2rLpgm7aFqiGAdvVOE6t1+RAYCnSAy2jr2xxiS6tx2pa8Xl\nwb81CTG1UetdbSnUgL2FrV4AjRJ6pACcTH41mMy7nRQK/mfBb2ZdmQOy4uOXGaoM\n5aC+/1kqju+0oQFGpAPuefhkyEE+mbur1jreiN97RpZ6FLI2mLU=\n=imHe\n-----END PGP SIGNATURE-----", "payload": "tree 5a2f502cefbbabf44bbd4eb6f85597bc91357412\nparent a6ac22e7e880914826b7b036bcfc6e748a78904d\nauthor Santiago Pastorino <spastorino@gmail.com> 1572469733 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1572471354 -0300\n\nMake init_locking return a reference to the initialized data\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12273cb7f66f463683ad4d6c54b17afe0b7d8422", "html_url": "https://github.com/rust-lang/rust/commit/12273cb7f66f463683ad4d6c54b17afe0b7d8422", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12273cb7f66f463683ad4d6c54b17afe0b7d8422/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6ac22e7e880914826b7b036bcfc6e748a78904d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6ac22e7e880914826b7b036bcfc6e748a78904d", "html_url": "https://github.com/rust-lang/rust/commit/a6ac22e7e880914826b7b036bcfc6e748a78904d"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "d111471f53d7d80ad863ca0840423acf914238a2", "filename": "src/librustc_data_structures/sync.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/12273cb7f66f463683ad4d6c54b17afe0b7d8422/src%2Flibrustc_data_structures%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12273cb7f66f463683ad4d6c54b17afe0b7d8422/src%2Flibrustc_data_structures%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fsync.rs?ref=12273cb7f66f463683ad4d6c54b17afe0b7d8422", "patch": "@@ -497,13 +497,15 @@ impl<T> Once<T> {\n     /// If the value was already initialized the closure is not called and `false` is returned,\n     /// otherwise if the value from the closure initializes the inner value, `true` is returned\n     #[inline]\n-    pub fn init_locking<F: FnOnce() -> T>(&self, f: F) -> bool {\n-        let mut lock = self.0.lock();\n-        if lock.is_some() {\n-            return false;\n+    pub fn init_locking<F: FnOnce() -> T>(&self, f: F) -> &T {\n+        {\n+            let mut lock = self.0.lock();\n+            if lock.is_none() {\n+                *lock = Some(f());\n+            }\n         }\n-        *lock = Some(f());\n-        true\n+\n+        self.borrow()\n     }\n \n     /// Tries to initialize the inner value by calling the closure without ensuring that no-one"}, {"sha": "c5954e1ea1d9830e2433ef64e8e4bff57e16abb0", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/12273cb7f66f463683ad4d6c54b17afe0b7d8422/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/12273cb7f66f463683ad4d6c54b17afe0b7d8422/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=12273cb7f66f463683ad4d6c54b17afe0b7d8422", "patch": "@@ -1351,9 +1351,7 @@ impl<'a, 'tcx> CrateMetadata {\n                     translated_source_file: local_version,\n                 }\n             }).collect()\n-        });\n-\n-        self.source_map_import_info.borrow()\n+        })\n     }\n \n     /// Get the `DepNodeIndex` corresponding this crate. The result of this"}]}