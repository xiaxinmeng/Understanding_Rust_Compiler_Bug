{"sha": "4c9995a3f9e7c9aa23fe3c1513904746c571b90b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjOTk5NWEzZjllN2M5YWEyM2ZlM2MxNTEzOTA0NzQ2YzU3MWI5MGI=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-01-01T18:13:50Z"}, "committer": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-01-04T18:34:27Z"}, "message": "Simpliy block creation in MirContext", "tree": {"sha": "877275362bde775ca47a60cc7658634147f1c887", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/877275362bde775ca47a60cc7658634147f1c887"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c9995a3f9e7c9aa23fe3c1513904746c571b90b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c9995a3f9e7c9aa23fe3c1513904746c571b90b", "html_url": "https://github.com/rust-lang/rust/commit/4c9995a3f9e7c9aa23fe3c1513904746c571b90b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c9995a3f9e7c9aa23fe3c1513904746c571b90b/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37dd9f6c7b488506c9482c6a296122dce8a3c207", "url": "https://api.github.com/repos/rust-lang/rust/commits/37dd9f6c7b488506c9482c6a296122dce8a3c207", "html_url": "https://github.com/rust-lang/rust/commit/37dd9f6c7b488506c9482c6a296122dce8a3c207"}], "stats": {"total": 14, "additions": 3, "deletions": 11}, "files": [{"sha": "9e2c7797b53529b115e6add2c0c8550c4c198c04", "filename": "src/librustc_trans/mir/mod.rs", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4c9995a3f9e7c9aa23fe3c1513904746c571b90b/src%2Flibrustc_trans%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c9995a3f9e7c9aa23fe3c1513904746c571b90b/src%2Flibrustc_trans%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fmir%2Fmod.rs?ref=4c9995a3f9e7c9aa23fe3c1513904746c571b90b", "patch": "@@ -31,7 +31,6 @@ use syntax::symbol::keywords;\n use syntax::abi::Abi;\n \n use std::iter;\n-use std::ffi::CString;\n \n use rustc_data_structures::bitvec::BitVector;\n use rustc_data_structures::indexed_vec::{IndexVec, Idx};\n@@ -218,17 +217,10 @@ pub fn trans_mir<'a, 'tcx: 'a>(\n     // Allocate a `Block` for every basic block\n     let block_bcxs: IndexVec<mir::BasicBlock, BasicBlockRef> =\n         mir.basic_blocks().indices().map(|bb| {\n-            let name = if bb == mir::START_BLOCK {\n-                CString::new(\"start\").unwrap()\n+            if bb == mir::START_BLOCK {\n+                bcx.build_new_block(\"start\").llbb()\n             } else {\n-                CString::new(format!(\"{:?}\", bb)).unwrap()\n-            };\n-            unsafe {\n-                llvm::LLVMAppendBasicBlockInContext(\n-                    ccx.llcx(),\n-                    llfn,\n-                    name.as_ptr()\n-                )\n+                bcx.build_new_block(&format!(\"{:?}\", bb)).llbb()\n             }\n         }).collect();\n "}]}