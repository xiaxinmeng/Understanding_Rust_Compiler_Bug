{"sha": "7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "node_id": "C_kwDOAAsO6NoAKDdlN2RmYjgzZGMxZmU2M2QxY2UxNDEwMTMzOWY1ZWVlNWI3NjE1OWQ", "commit": {"author": {"name": "chenyukang", "email": "moorekang@gmail.com", "date": "2022-08-30T02:03:02Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-09-09T01:51:21Z"}, "message": "fix #101097, avoid infinite loop in fn arguments checking", "tree": {"sha": "23203ea78337715c40a9da918fd339bdf3ff060a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23203ea78337715c40a9da918fd339bdf3ff060a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "html_url": "https://github.com/rust-lang/rust/commit/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50e5d03e16790400f0c5b6ce6d3a27f6a71c5298", "url": "https://api.github.com/repos/rust-lang/rust/commits/50e5d03e16790400f0c5b6ce6d3a27f6a71c5298", "html_url": "https://github.com/rust-lang/rust/commit/50e5d03e16790400f0c5b6ce6d3a27f6a71c5298"}], "stats": {"total": 193, "additions": 187, "deletions": 6}, "files": [{"sha": "fc83994caf53966aff1ba74745ca44856349f233", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/arg_matrix.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Farg_matrix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Farg_matrix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Farg_matrix.rs?ref=7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "patch": "@@ -236,8 +236,8 @@ impl<'tcx> ArgMatrix<'tcx> {\n                             if matches!(c, Compatibility::Compatible) { Some(i) } else { None }\n                         })\n                         .collect();\n-                if compat.len() != 1 {\n-                    // this could go into multiple slots, don't bother exploring both\n+                if compat.len() < 1 {\n+                    // try to find a cycle even when this could go into multiple slots, see #101097\n                     is_cycle = false;\n                     break;\n                 }"}, {"sha": "df02a312cf11c1a79756f087acafcfa8f2884b26", "filename": "src/test/ui/argument-suggestions/issue-100478.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-100478.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-100478.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-100478.stderr?ref=7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "patch": "@@ -15,7 +15,7 @@ LL | fn three_diff(_a: T1, _b: T2, _c: T3) {}\n help: provide the arguments\n    |\n LL |     three_diff(/* T1 */, T2::new(0), /* T3 */);\n-   |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+   |               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n error[E0308]: arguments to this function are incorrect\n   --> $DIR/issue-100478.rs:35:5\n@@ -35,7 +35,7 @@ LL | fn four_shuffle(_a: T1, _b: T2, _c: T3, _d: T4) {}\n help: did you mean\n    |\n LL |     four_shuffle(T1::default(), T2::default(), T3::default(), T4::default());\n-   |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+   |                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n error[E0308]: arguments to this function are incorrect\n   --> $DIR/issue-100478.rs:36:5\n@@ -54,7 +54,7 @@ LL | fn four_shuffle(_a: T1, _b: T2, _c: T3, _d: T4) {}\n help: swap these arguments\n    |\n LL |     four_shuffle(T1::default(), T2::default(), T3::default(), /* T4 */);\n-   |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+   |                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n error[E0061]: this function takes 8 arguments but 7 arguments were supplied\n   --> $DIR/issue-100478.rs:47:5\n@@ -73,7 +73,7 @@ LL | fn foo(p1: T1, p2: Arc<T2>, p3: T3, p4: Arc<T4>, p5: T5, p6: T6, p7: T7, p8\n help: provide the argument\n    |\n LL |     foo(p1, /* Arc<T2> */, p3, p4, p5, p6, p7, p8);\n-   |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+   |        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n error: aborting due to 4 previous errors\n "}, {"sha": "7994d3cd9959cb469d9aa33cd269667c732a2926", "filename": "src/test/ui/argument-suggestions/issue-101097.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.rs?ref=7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "patch": "@@ -0,0 +1,21 @@\n+struct A;\n+struct B;\n+struct C;\n+struct D;\n+\n+fn f(\n+    a1: A,\n+    a2: A,\n+    b1: B,\n+    b2: B,\n+    c1: C,\n+    c2: C,\n+) {}\n+\n+fn main() {\n+    f(C, A, A, A, B, B, C); //~ ERROR this function takes 6 arguments but 7 arguments were supplied [E0061]\n+    f(C, C, A, A, B, B);  //~ ERROR arguments to this function are incorrect [E0308]\n+    f(A, A, D, D, B, B);  //~ arguments to this function are incorrect [E0308]\n+    f(C, C, B, B, A, A);  //~ arguments to this function are incorrect [E0308]\n+    f(C, C, A, B, A, A);  //~ arguments to this function are incorrect [E0308]\n+}"}, {"sha": "096f8c226f2aac19a1b7688a0315d0cd33a79824", "filename": "src/test/ui/argument-suggestions/issue-101097.stderr", "status": "added", "additions": 160, "deletions": 0, "changes": 160, "blob_url": "https://github.com/rust-lang/rust/blob/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e7dfb83dc1fe63d1ce14101339f5eee5b76159d/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fargument-suggestions%2Fissue-101097.stderr?ref=7e7dfb83dc1fe63d1ce14101339f5eee5b76159d", "patch": "@@ -0,0 +1,160 @@\n+error[E0061]: this function takes 6 arguments but 7 arguments were supplied\n+  --> $DIR/issue-101097.rs:16:5\n+   |\n+LL |     f(C, A, A, A, B, B, C);\n+   |     ^ -     -  -  - expected `C`, found `B`\n+   |       |     |  |\n+   |       |     |  argument of type `A` unexpected\n+   |       |     expected `B`, found `A`\n+   |       expected `A`, found `C`\n+   |\n+note: function defined here\n+  --> $DIR/issue-101097.rs:6:4\n+   |\n+LL | fn f(\n+   |    ^\n+LL |     a1: A,\n+   |     -----\n+LL |     a2: A,\n+   |     -----\n+LL |     b1: B,\n+   |     -----\n+LL |     b2: B,\n+   |     -----\n+LL |     c1: C,\n+   |     -----\n+LL |     c2: C,\n+   |     -----\n+help: did you mean\n+   |\n+LL |     f(A, A, B, B, C, C);\n+   |      ~~~~~~~~~~~~~~~~~~\n+\n+error[E0308]: arguments to this function are incorrect\n+  --> $DIR/issue-101097.rs:17:5\n+   |\n+LL |     f(C, C, A, A, B, B);\n+   |     ^\n+   |\n+note: function defined here\n+  --> $DIR/issue-101097.rs:6:4\n+   |\n+LL | fn f(\n+   |    ^\n+LL |     a1: A,\n+   |     -----\n+LL |     a2: A,\n+   |     -----\n+LL |     b1: B,\n+   |     -----\n+LL |     b2: B,\n+   |     -----\n+LL |     c1: C,\n+   |     -----\n+LL |     c2: C,\n+   |     -----\n+help: did you mean\n+   |\n+LL |     f(A, A, B, B, C, C);\n+   |      ~~~~~~~~~~~~~~~~~~\n+\n+error[E0308]: arguments to this function are incorrect\n+  --> $DIR/issue-101097.rs:18:5\n+   |\n+LL |     f(A, A, D, D, B, B);\n+   |     ^       -  -  ---- two arguments of type `C` and `C` are missing\n+   |             |  |\n+   |             |  argument of type `D` unexpected\n+   |             argument of type `D` unexpected\n+   |\n+note: function defined here\n+  --> $DIR/issue-101097.rs:6:4\n+   |\n+LL | fn f(\n+   |    ^\n+LL |     a1: A,\n+   |     -----\n+LL |     a2: A,\n+   |     -----\n+LL |     b1: B,\n+   |     -----\n+LL |     b2: B,\n+   |     -----\n+LL |     c1: C,\n+   |     -----\n+LL |     c2: C,\n+   |     -----\n+help: did you mean\n+   |\n+LL |     f(A, A, B, B, /* C */, /* C */);\n+   |      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+error[E0308]: arguments to this function are incorrect\n+  --> $DIR/issue-101097.rs:19:5\n+   |\n+LL |     f(C, C, B, B, A, A);\n+   |     ^ -  -        -  - expected `C`, found `A`\n+   |       |  |        |\n+   |       |  |        expected `C`, found `A`\n+   |       |  expected `A`, found `C`\n+   |       expected `A`, found `C`\n+   |\n+note: function defined here\n+  --> $DIR/issue-101097.rs:6:4\n+   |\n+LL | fn f(\n+   |    ^\n+LL |     a1: A,\n+   |     -----\n+LL |     a2: A,\n+   |     -----\n+LL |     b1: B,\n+   |     -----\n+LL |     b2: B,\n+   |     -----\n+LL |     c1: C,\n+   |     -----\n+LL |     c2: C,\n+   |     -----\n+help: did you mean\n+   |\n+LL |     f(A, A, B, B, C, C);\n+   |      ~~~~~~~~~~~~~~~~~~\n+\n+error[E0308]: arguments to this function are incorrect\n+  --> $DIR/issue-101097.rs:20:5\n+   |\n+LL |     f(C, C, A, B, A, A);\n+   |     ^ -  -  -     -  - expected `C`, found `A`\n+   |       |  |  |     |\n+   |       |  |  |     expected `C`, found `A`\n+   |       |  |  expected struct `B`, found struct `A`\n+   |       |  expected `A`, found `C`\n+   |       expected `A`, found `C`\n+   |\n+note: function defined here\n+  --> $DIR/issue-101097.rs:6:4\n+   |\n+LL | fn f(\n+   |    ^\n+LL |     a1: A,\n+   |     -----\n+LL |     a2: A,\n+   |     -----\n+LL |     b1: B,\n+   |     -----\n+LL |     b2: B,\n+   |     -----\n+LL |     c1: C,\n+   |     -----\n+LL |     c2: C,\n+   |     -----\n+help: did you mean\n+   |\n+LL |     f(A, A, /* B */, B, C, C);\n+   |      ~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0061, E0308.\n+For more information about an error, try `rustc --explain E0061`."}]}