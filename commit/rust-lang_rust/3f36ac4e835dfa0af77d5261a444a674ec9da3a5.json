{"sha": "3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmMzZhYzRlODM1ZGZhMGFmNzdkNTI2MWE0NDRhNjc0ZWM5ZGEzYTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-03-25T09:05:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-03-25T09:05:00Z"}, "message": "Auto merge of #59242 - euclio:asm-ice, r=nagisa\n\nmake asm diagnostic instruction optional\n\n`DiagnosticInfoInlineAsm::getInstruction` may return a null pointer, so\nthe instruction shouldn't be blindly unwrapped.\n\nReopening from #55193. I was unable to trigger the assertion on Windows after rebasing.\n\nFixes #23458.\nFixes #55216.", "tree": {"sha": "2a7f9b1a0749ac5f62e2b70c2840dd5d2bb1c82c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a7f9b1a0749ac5f62e2b70c2840dd5d2bb1c82c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "html_url": "https://github.com/rust-lang/rust/commit/3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60eca54a7ce931c590801048f54ac0b2d2cd5067", "url": "https://api.github.com/repos/rust-lang/rust/commits/60eca54a7ce931c590801048f54ac0b2d2cd5067", "html_url": "https://github.com/rust-lang/rust/commit/60eca54a7ce931c590801048f54ac0b2d2cd5067"}, {"sha": "4728433c9ec07814b15868cb092afa2d60963cee", "url": "https://api.github.com/repos/rust-lang/rust/commits/4728433c9ec07814b15868cb092afa2d60963cee", "html_url": "https://github.com/rust-lang/rust/commit/4728433c9ec07814b15868cb092afa2d60963cee"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "04e65ac4233002b3796957ebdd3443a54928cbb8", "filename": "src/librustc_codegen_llvm/llvm/diagnostic.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Flibrustc_codegen_llvm%2Fllvm%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Flibrustc_codegen_llvm%2Fllvm%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fdiagnostic.rs?ref=3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "patch": "@@ -88,7 +88,7 @@ impl OptimizationDiagnostic<'ll> {\n pub struct InlineAsmDiagnostic<'ll> {\n     pub cookie: c_uint,\n     pub message: &'ll Twine,\n-    pub instruction: &'ll Value,\n+    pub instruction: Option<&'ll Value>,\n }\n \n impl InlineAsmDiagnostic<'ll> {\n@@ -107,7 +107,7 @@ impl InlineAsmDiagnostic<'ll> {\n         InlineAsmDiagnostic {\n             cookie,\n             message: message.unwrap(),\n-            instruction: instruction.unwrap(),\n+            instruction,\n         }\n     }\n }"}, {"sha": "90b3f1f9714b216c5cec4c50ec4e0133df181129", "filename": "src/test/ui/issues/issue-23458.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Ftest%2Fui%2Fissues%2Fissue-23458.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Ftest%2Fui%2Fissues%2Fissue-23458.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-23458.rs?ref=3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "patch": "@@ -0,0 +1,10 @@\n+#![feature(asm)]\n+\n+// only-x86_64\n+\n+fn main() {\n+    unsafe {\n+        asm!(\"int $3\"); //~ ERROR too few operands for instruction\n+                        //~| ERROR invalid operand in inline asm\n+    }\n+}"}, {"sha": "aff0f82af6fdce567ca2bbcc8d13c23096bdafdb", "filename": "src/test/ui/issues/issue-23458.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Ftest%2Fui%2Fissues%2Fissue-23458.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3f36ac4e835dfa0af77d5261a444a674ec9da3a5/src%2Ftest%2Fui%2Fissues%2Fissue-23458.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-23458.stderr?ref=3f36ac4e835dfa0af77d5261a444a674ec9da3a5", "patch": "@@ -0,0 +1,17 @@\n+error: invalid operand in inline asm: 'int $3'\n+  --> $DIR/issue-23458.rs:7:9\n+   |\n+LL |         asm!(\"int $3\");\n+   |         ^^^^^^^^^^^^^^^\n+\n+error: <inline asm>:1:2: error: too few operands for instruction\n+        int \n+        ^\n+\n+  --> $DIR/issue-23458.rs:7:9\n+   |\n+LL |         asm!(\"int $3\");\n+   |         ^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}