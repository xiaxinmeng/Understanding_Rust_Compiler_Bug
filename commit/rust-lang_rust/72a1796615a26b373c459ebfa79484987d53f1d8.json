{"sha": "72a1796615a26b373c459ebfa79484987d53f1d8", "node_id": "C_kwDOAAsO6NoAKDcyYTE3OTY2MTVhMjZiMzczYzQ1OWViZmE3OTQ4NDk4N2Q1M2YxZDg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-18T02:09:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-05-18T02:09:55Z"}, "message": "Auto merge of #14819 - weihanglo:divided-by-zero, r=lnicola\n\nfix(analysis-stats): divided by zero error\n\n## What does this PR try to resolve?\n\n2023-05-15 rust-analyzer suffers from\n\n```\n thread 'main' panicked at 'attempt to divide by zero', crates/rust-analyzer/src/cli/analysis_stats.rs:230:56\n```\n\nThis commit <https://github.com/rust-lang/rust-analyzer/pull/14808/commits/51e8b8ff14de3507d5e21d80b750577da52b6fdd> might be the culprit.\n\nThis PR uses `percentage` function to avoid the classic \u201cdivision by zero\u201d bug.\n\n## Reproducer\n\n```console\ncargo new ra-test\npushd ra-test\necho \"pub type Foo = u32;\" >> src/lib.rs\nrust-analyzer analysis-stats .\n```", "tree": {"sha": "17c1c8521a250a556ff26146b438a692ca142781", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/17c1c8521a250a556ff26146b438a692ca142781"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/72a1796615a26b373c459ebfa79484987d53f1d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/72a1796615a26b373c459ebfa79484987d53f1d8", "html_url": "https://github.com/rust-lang/rust/commit/72a1796615a26b373c459ebfa79484987d53f1d8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/72a1796615a26b373c459ebfa79484987d53f1d8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d0768aad62e13ec63cba9d857c8b3fe7657dfb33", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0768aad62e13ec63cba9d857c8b3fe7657dfb33", "html_url": "https://github.com/rust-lang/rust/commit/d0768aad62e13ec63cba9d857c8b3fe7657dfb33"}, {"sha": "77be56b691c9a2d9739d9b4e360cae148b0e0972", "url": "https://api.github.com/repos/rust-lang/rust/commits/77be56b691c9a2d9739d9b4e360cae148b0e0972", "html_url": "https://github.com/rust-lang/rust/commit/77be56b691c9a2d9739d9b4e360cae148b0e0972"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "f7f49188662a7fa0345fc6f96aad0e9e1f653d77", "filename": "crates/rust-analyzer/src/cli/analysis_stats.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/72a1796615a26b373c459ebfa79484987d53f1d8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72a1796615a26b373c459ebfa79484987d53f1d8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs?ref=72a1796615a26b373c459ebfa79484987d53f1d8", "patch": "@@ -227,7 +227,7 @@ impl flags::AnalysisStats {\n             fail += 1;\n         }\n         eprintln!(\"{:<20} {}\", \"Data layouts:\", sw.elapsed());\n-        eprintln!(\"Failed data layouts: {fail} ({}%)\", fail * 100 / all);\n+        eprintln!(\"Failed data layouts: {fail} ({}%)\", percentage(fail, all));\n         report_metric(\"failed data layouts\", fail, \"#\");\n     }\n \n@@ -254,7 +254,7 @@ impl flags::AnalysisStats {\n             fail += 1;\n         }\n         eprintln!(\"{:<20} {}\", \"Const evaluation:\", sw.elapsed());\n-        eprintln!(\"Failed const evals: {fail} ({}%)\", fail * 100 / all);\n+        eprintln!(\"Failed const evals: {fail} ({}%)\", percentage(fail, all));\n         report_metric(\"failed const evals\", fail, \"#\");\n     }\n \n@@ -280,7 +280,7 @@ impl flags::AnalysisStats {\n             fail += 1;\n         }\n         eprintln!(\"{:<20} {}\", \"MIR lowering:\", sw.elapsed());\n-        eprintln!(\"Mir failed bodies: {fail} ({}%)\", fail * 100 / all);\n+        eprintln!(\"Mir failed bodies: {fail} ({}%)\", percentage(fail, all));\n         report_metric(\"mir failed bodies\", fail, \"#\");\n     }\n "}]}