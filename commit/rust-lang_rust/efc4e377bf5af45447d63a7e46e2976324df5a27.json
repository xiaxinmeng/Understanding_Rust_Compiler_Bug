{"sha": "efc4e377bf5af45447d63a7e46e2976324df5a27", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmYzRlMzc3YmY1YWY0NTQ0N2Q2M2E3ZTQ2ZTI5NzYzMjRkZjVhMjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-04T16:48:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-04T16:48:50Z"}, "message": "Auto merge of #85806 - ATiltedTree:android-ndk-beta, r=petrochenkov\n\nSupport Android ndk versions `r23-beta3` and up\n\nSince android ndk version `r23-beta3`, `libgcc` has been replaced with `libunwind`. This moves the linking of `libgcc`/`libunwind` into the `unwind` crate where we check if the system compiler can find `libunwind` and fall back to `libgcc` if needed.", "tree": {"sha": "1a68709547b5732d35a359efeb0606077c8ae342", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a68709547b5732d35a359efeb0606077c8ae342"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/efc4e377bf5af45447d63a7e46e2976324df5a27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/efc4e377bf5af45447d63a7e46e2976324df5a27", "html_url": "https://github.com/rust-lang/rust/commit/efc4e377bf5af45447d63a7e46e2976324df5a27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/efc4e377bf5af45447d63a7e46e2976324df5a27/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "595088d602049d821bf9a217f2d79aea40715208", "url": "https://api.github.com/repos/rust-lang/rust/commits/595088d602049d821bf9a217f2d79aea40715208", "html_url": "https://github.com/rust-lang/rust/commit/595088d602049d821bf9a217f2d79aea40715208"}, {"sha": "b271f2bd75df8d12f269a618e6f35e4e3c05667a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b271f2bd75df8d12f269a618e6f35e4e3c05667a", "html_url": "https://github.com/rust-lang/rust/commit/b271f2bd75df8d12f269a618e6f35e4e3c05667a"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "5c1736c692e4848fccf84262a710cfdc8d699c15", "filename": "Cargo.lock", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/efc4e377bf5af45447d63a7e46e2976324df5a27/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/efc4e377bf5af45447d63a7e46e2976324df5a27/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=efc4e377bf5af45447d63a7e46e2976324df5a27", "patch": "@@ -652,9 +652,9 @@ dependencies = [\n \n [[package]]\n name = \"compiler_builtins\"\n-version = \"0.1.43\"\n+version = \"0.1.45\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"65af2dcae4779003dfa91aedc6ade7bdc7ba685944e50a8b4f9380df376a4466\"\n+checksum = \"787187ae221adfcda34b03006f1617099e4ae26b50e5a4db282496014ab75837\"\n dependencies = [\n  \"cc\",\n  \"rustc-std-workspace-core\","}, {"sha": "415d874c7faa64740ccd473cf493f1a661826ac6", "filename": "library/std/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Fstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Fstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2FCargo.toml?ref=efc4e377bf5af45447d63a7e46e2976324df5a27", "patch": "@@ -17,7 +17,7 @@ panic_unwind = { path = \"../panic_unwind\", optional = true }\n panic_abort = { path = \"../panic_abort\" }\n core = { path = \"../core\" }\n libc = { version = \"0.2.93\", default-features = false, features = ['rustc-dep-of-std'] }\n-compiler_builtins = { version = \"0.1.43\" }\n+compiler_builtins = { version = \"0.1.44\" }\n profiler_builtins = { path = \"../profiler_builtins\", optional = true }\n unwind = { path = \"../unwind\" }\n hashbrown = { version = \"0.11\", default-features = false, features = ['rustc-dep-of-std'] }"}, {"sha": "ca9cc8ca7ba391259529d6c9c4c7b7ccc35ab235", "filename": "library/std/src/sys/unix/mod.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs?ref=efc4e377bf5af45447d63a7e46e2976324df5a27", "patch": "@@ -210,7 +210,6 @@ cfg_if::cfg_if! {\n     if #[cfg(target_os = \"android\")] {\n         #[link(name = \"dl\")]\n         #[link(name = \"log\")]\n-        #[link(name = \"gcc\")]\n         extern \"C\" {}\n     } else if #[cfg(target_os = \"freebsd\")] {\n         #[link(name = \"execinfo\")]"}, {"sha": "0529d24a27408002b3b36c500c9b87b8cd925d62", "filename": "library/unwind/build.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Funwind%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/efc4e377bf5af45447d63a7e46e2976324df5a27/library%2Funwind%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Funwind%2Fbuild.rs?ref=efc4e377bf5af45447d63a7e46e2976324df5a27", "patch": "@@ -20,6 +20,20 @@ fn main() {\n         // linking for Linux is handled in lib.rs\n         if target.contains(\"musl\") {\n             llvm_libunwind::compile();\n+        } else if target.contains(\"android\") {\n+            let build = cc::Build::new();\n+\n+            // Since ndk r23 beta 3 `libgcc` was replaced with `libunwind` thus\n+            // check if we have `libunwind` available and if so use it. Otherwise\n+            // fall back to `libgcc` to support older ndk versions.\n+            let has_unwind =\n+                build.is_flag_supported(\"-lunwind\").expect(\"Unable to invoke compiler\");\n+\n+            if has_unwind {\n+                println!(\"cargo:rustc-link-lib=unwind\");\n+            } else {\n+                println!(\"cargo:rustc-link-lib=gcc\");\n+            }\n         }\n     } else if target.contains(\"freebsd\") {\n         println!(\"cargo:rustc-link-lib=gcc_s\");"}]}