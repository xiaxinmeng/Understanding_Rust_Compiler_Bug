{"sha": "edbbb104772a89089a08f0846623fb52e445c08c", "node_id": "C_kwDOAAsO6NoAKGVkYmJiMTA0NzcyYTg5MDg5YTA4ZjA4NDY2MjNmYjUyZTQ0NWMwOGM", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-06T15:26:02Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-06T16:26:52Z"}, "message": "make uninit_mask a unit test", "tree": {"sha": "591d223ea716569bf7f7f714dc510e4a4f9fe024", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/591d223ea716569bf7f7f714dc510e4a4f9fe024"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edbbb104772a89089a08f0846623fb52e445c08c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edbbb104772a89089a08f0846623fb52e445c08c", "html_url": "https://github.com/rust-lang/rust/commit/edbbb104772a89089a08f0846623fb52e445c08c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edbbb104772a89089a08f0846623fb52e445c08c/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b7f6b98c77e5524a007062368f2899932a425a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b7f6b98c77e5524a007062368f2899932a425a0", "html_url": "https://github.com/rust-lang/rust/commit/6b7f6b98c77e5524a007062368f2899932a425a0"}], "stats": {"total": 51, "additions": 22, "deletions": 29}, "files": [{"sha": "09a2c3aa5e2e2d9b3cc9d4037ae99b7c81a2d240", "filename": "compiler/rustc_middle/src/mir/interpret/allocation.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation.rs?ref=edbbb104772a89089a08f0846623fb52e445c08c", "patch": "@@ -2,6 +2,8 @@\n \n mod init_mask;\n mod provenance_map;\n+#[cfg(test)]\n+mod tests;\n \n use std::borrow::Cow;\n use std::fmt;"}, {"sha": "d88a0c19e5937a5ce804c0ca2162aa86183df0e6", "filename": "compiler/rustc_middle/src/mir/interpret/allocation/init_mask.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Finit_mask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Finit_mask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Finit_mask.rs?ref=edbbb104772a89089a08f0846623fb52e445c08c", "patch": "@@ -150,7 +150,7 @@ impl InitMask {\n     }\n \n     #[inline]\n-    fn get(&self, i: Size) -> bool {\n+    pub fn get(&self, i: Size) -> bool {\n         let (block, bit) = Self::bit_index(i);\n         (self.blocks[block] & (1 << bit)) != 0\n     }"}, {"sha": "c9c3c50c5371e92be300050e09a213dc2defca4b", "filename": "compiler/rustc_middle/src/mir/interpret/allocation/tests.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/edbbb104772a89089a08f0846623fb52e445c08c/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Finterpret%2Fallocation%2Ftests.rs?ref=edbbb104772a89089a08f0846623fb52e445c08c", "patch": "@@ -0,0 +1,19 @@\n+use super::*;\n+\n+#[test]\n+fn uninit_mask() {\n+    let mut mask = InitMask::new(Size::from_bytes(500), false);\n+    assert!(!mask.get(Size::from_bytes(499)));\n+    mask.set_range(alloc_range(Size::from_bytes(499), Size::from_bytes(1)), true);\n+    assert!(mask.get(Size::from_bytes(499)));\n+    mask.set_range((100..256).into(), true);\n+    for i in 0..100 {\n+        assert!(!mask.get(Size::from_bytes(i)), \"{i} should not be set\");\n+    }\n+    for i in 100..256 {\n+        assert!(mask.get(Size::from_bytes(i)), \"{i} should be set\");\n+    }\n+    for i in 256..499 {\n+        assert!(!mask.get(Size::from_bytes(i)), \"{i} should not be set\");\n+    }\n+}"}, {"sha": "84ce291016aafbeee2d614356b5f0e841b4aeb2c", "filename": "src/test/ui-fulldeps/uninit_mask.rs", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/6b7f6b98c77e5524a007062368f2899932a425a0/src%2Ftest%2Fui-fulldeps%2Funinit_mask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7f6b98c77e5524a007062368f2899932a425a0/src%2Ftest%2Fui-fulldeps%2Funinit_mask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Funinit_mask.rs?ref=6b7f6b98c77e5524a007062368f2899932a425a0", "patch": "@@ -1,28 +0,0 @@\n-// run-pass\n-// ignore-cross-compile\n-// ignore-stage1\n-\n-#![feature(rustc_private)]\n-\n-extern crate rustc_middle;\n-extern crate rustc_target;\n-\n-use rustc_middle::mir::interpret::InitMask;\n-use rustc_target::abi::Size;\n-\n-fn main() {\n-    let mut mask = InitMask::new(Size::from_bytes(500), false);\n-    assert!(!mask.get(Size::from_bytes(499)));\n-    mask.set(Size::from_bytes(499), true);\n-    assert!(mask.get(Size::from_bytes(499)));\n-    mask.set_range_inbounds(Size::from_bytes(100), Size::from_bytes(256), true);\n-    for i in 0..100 {\n-        assert!(!mask.get(Size::from_bytes(i)));\n-    }\n-    for i in 100..256 {\n-        assert!(mask.get(Size::from_bytes(i)));\n-    }\n-    for i in 256..499 {\n-        assert!(!mask.get(Size::from_bytes(i)));\n-    }\n-}"}]}