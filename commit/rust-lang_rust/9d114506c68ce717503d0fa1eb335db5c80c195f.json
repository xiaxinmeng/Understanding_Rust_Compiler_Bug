{"sha": "9d114506c68ce717503d0fa1eb335db5c80c195f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkMTE0NTA2YzY4Y2U3MTc1MDNkMGZhMWViMzM1ZGI1YzgwYzE5NWY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-31T14:14:44Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-11-05T09:22:08Z"}, "message": "Rename lint to non_autolinks", "tree": {"sha": "1b07331f6db8d84c9a6b9eb6fdf00c1d8ce22582", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b07331f6db8d84c9a6b9eb6fdf00c1d8ce22582"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d114506c68ce717503d0fa1eb335db5c80c195f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d114506c68ce717503d0fa1eb335db5c80c195f", "html_url": "https://github.com/rust-lang/rust/commit/9d114506c68ce717503d0fa1eb335db5c80c195f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d114506c68ce717503d0fa1eb335db5c80c195f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6be97e225099cc59dc63f6fc01af7c525d0334df", "url": "https://api.github.com/repos/rust-lang/rust/commits/6be97e225099cc59dc63f6fc01af7c525d0334df", "html_url": "https://github.com/rust-lang/rust/commit/6be97e225099cc59dc63f6fc01af7c525d0334df"}], "stats": {"total": 75, "additions": 38, "deletions": 37}, "files": [{"sha": "24bfdad970a1c4cb0f0d0a24b9a8ceee3346d484", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -69,7 +69,7 @@ use rustc_middle::ty::TyCtxt;\n use rustc_session::lint::builtin::{\n     BARE_TRAIT_OBJECTS, BROKEN_INTRA_DOC_LINKS, ELIDED_LIFETIMES_IN_PATHS,\n     EXPLICIT_OUTLIVES_REQUIREMENTS, INVALID_CODEBLOCK_ATTRIBUTES, INVALID_HTML_TAGS,\n-    MISSING_DOC_CODE_EXAMPLES, PRIVATE_DOC_TESTS, URL_IMPROVEMENTS,\n+    MISSING_DOC_CODE_EXAMPLES, NON_AUTOLINKS, PRIVATE_DOC_TESTS,\n };\n use rustc_span::symbol::{Ident, Symbol};\n use rustc_span::Span;\n@@ -313,7 +313,7 @@ fn register_builtins(store: &mut LintStore, no_interleave_lints: bool) {\n \n     add_lint_group!(\n         \"rustdoc\",\n-        URL_IMPROVEMENTS,\n+        NON_AUTOLINKS,\n         BROKEN_INTRA_DOC_LINKS,\n         PRIVATE_INTRA_DOC_LINKS,\n         INVALID_CODEBLOCK_ATTRIBUTES,"}, {"sha": "ff7a145c2668d8810f6b34d8c7612f9323cd3f5d", "filename": "compiler/rustc_lint_defs/src/builtin.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -1891,12 +1891,12 @@ declare_lint! {\n }\n \n declare_lint! {\n-    /// The `url_improvements` lint detects when a URL could be written using\n+    /// The `non_autolinks` lint detects when a URL could be written using\n     /// only angle brackets. This is a `rustdoc` only lint, see the\n     /// documentation in the [rustdoc book].\n     ///\n-    /// [rustdoc book]: ../../../rustdoc/lints.html#url_improvements\n-    pub URL_IMPROVEMENTS,\n+    /// [rustdoc book]: ../../../rustdoc/lints.html#non_autolinks\n+    pub NON_AUTOLINKS,\n     Warn,\n     \"detects URLs that could be written using only angle brackets\"\n }\n@@ -2806,7 +2806,7 @@ declare_lint_pass! {\n         MISSING_DOC_CODE_EXAMPLES,\n         INVALID_HTML_TAGS,\n         PRIVATE_DOC_TESTS,\n-        URL_IMPROVEMENTS,\n+        NON_AUTOLINKS,\n         WHERE_CLAUSES_OBJECT_SAFETY,\n         PROC_MACRO_DERIVE_RESOLUTION_FALLBACK,\n         MACRO_USE_EXTERN_CRATE,"}, {"sha": "069e6e7e7188155c57a86eff003d5e73210e66e7", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -287,7 +287,7 @@ pub mod primitive;\n     unused_imports,\n     unsafe_op_in_unsafe_fn\n )]\n-#[cfg_attr(not(bootstrap), allow(url_improvements))]\n+#[cfg_attr(not(bootstrap), allow(non_autolinks))]\n // FIXME: This annotation should be moved into rust-lang/stdarch after clashing_extern_declarations is\n // merged. It currently cannot because bootstrap fails as the lint hasn't been defined yet.\n #[allow(clashing_extern_declarations)]"}, {"sha": "41292b3d8384118aa15d287a6d962583810bd614", "filename": "src/doc/rustdoc/src/lints.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Flints.md?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -286,7 +286,7 @@ warning: unclosed HTML tag `h1`\n warning: 2 warnings emitted\n ```\n \n-## url_improvements\n+## non_autolinks\n \n This lint is **nightly-only** and **warns by default**. It detects links which\n could use the \"automatic\" link syntax. For example:\n@@ -309,7 +309,7 @@ warning: this URL is not a hyperlink\n 1 | /// http://example.org\n   |     ^^^^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://example.org>`\n   |\n-  = note: `#[warn(url_improvements)]` on by default\n+  = note: `#[warn(non_autolinks)]` on by default\n \n warning: unneeded long form for URL\n  --> foo.rs:2:5"}, {"sha": "5cb7a32cf0cbc4a09f931c970f82d1c6a7056a61", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -330,7 +330,7 @@ pub fn run_core(\n     let invalid_codeblock_attributes_name = rustc_lint::builtin::INVALID_CODEBLOCK_ATTRIBUTES.name;\n     let invalid_html_tags = rustc_lint::builtin::INVALID_HTML_TAGS.name;\n     let renamed_and_removed_lints = rustc_lint::builtin::RENAMED_AND_REMOVED_LINTS.name;\n-    let url_improvements = rustc_lint::builtin::URL_IMPROVEMENTS.name;\n+    let non_autolinks = rustc_lint::builtin::NON_AUTOLINKS.name;\n     let unknown_lints = rustc_lint::builtin::UNKNOWN_LINTS.name;\n \n     // In addition to those specific lints, we also need to allow those given through\n@@ -345,7 +345,7 @@ pub fn run_core(\n         invalid_html_tags.to_owned(),\n         renamed_and_removed_lints.to_owned(),\n         unknown_lints.to_owned(),\n-        url_improvements.to_owned(),\n+        non_autolinks.to_owned(),\n     ];\n \n     let (lint_opts, lint_caps) = init_lints(lints_to_show, lint_opts, |lint| {"}, {"sha": "047a73835c8ebe96390d05dbe3309aac9d70b3f5", "filename": "src/librustdoc/passes/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fpasses%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fpasses%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fmod.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -11,8 +11,8 @@ use crate::core::DocContext;\n mod stripper;\n pub use stripper::*;\n \n-mod url_improvements;\n-pub use self::url_improvements::CHECK_URL_IMPROVEMENTS;\n+mod non_autolinks;\n+pub use self::non_autolinks::CHECK_NON_AUTOLINKS;\n \n mod collapse_docs;\n pub use self::collapse_docs::COLLAPSE_DOCS;\n@@ -93,7 +93,7 @@ pub const PASSES: &[Pass] = &[\n     COLLECT_TRAIT_IMPLS,\n     CALCULATE_DOC_COVERAGE,\n     CHECK_INVALID_HTML_TAGS,\n-    CHECK_URL_IMPROVEMENTS,\n+    CHECK_NON_AUTOLINKS,\n ];\n \n /// The list of passes run by default.\n@@ -109,7 +109,7 @@ pub const DEFAULT_PASSES: &[ConditionalPass] = &[\n     ConditionalPass::always(CHECK_CODE_BLOCK_SYNTAX),\n     ConditionalPass::always(CHECK_INVALID_HTML_TAGS),\n     ConditionalPass::always(PROPAGATE_DOC_CFG),\n-    ConditionalPass::always(CHECK_URL_IMPROVEMENTS),\n+    ConditionalPass::always(CHECK_NON_AUTOLINKS),\n ];\n \n /// The list of default passes run when `--doc-coverage` is passed to rustdoc."}, {"sha": "4a8fc7fc6181e50fb7e3408e6812610f7baf4e47", "filename": "src/librustdoc/passes/non_autolinks.rs", "status": "renamed", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fpasses%2Fnon_autolinks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Flibrustdoc%2Fpasses%2Fnon_autolinks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fnon_autolinks.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -10,9 +10,9 @@ use rustc_errors::Applicability;\n use rustc_feature::UnstableFeatures;\n use rustc_session::lint;\n \n-pub const CHECK_URL_IMPROVEMENTS: Pass = Pass {\n-    name: \"check-url-improvements\",\n-    run: check_url_improvements,\n+pub const CHECK_NON_AUTOLINKS: Pass = Pass {\n+    name: \"check-non-autolinks\",\n+    run: check_non_autolinks,\n     description: \"detects URLS that could be written using angle brackets\",\n };\n \n@@ -23,14 +23,14 @@ const URL_REGEX: &str = concat!(\n     r\"\\b([-a-zA-Z0-9@:%_\\+.~#?&/=]*)\"      // optional query or url fragments\n );\n \n-struct UrlImprovementsLinter<'a, 'tcx> {\n+struct NonAutolinksLinter<'a, 'tcx> {\n     cx: &'a DocContext<'tcx>,\n     regex: Regex,\n }\n \n-impl<'a, 'tcx> UrlImprovementsLinter<'a, 'tcx> {\n+impl<'a, 'tcx> NonAutolinksLinter<'a, 'tcx> {\n     fn new(cx: &'a DocContext<'tcx>) -> Self {\n-        UrlImprovementsLinter { cx, regex: Regex::new(URL_REGEX).expect(\"failed to build regex\") }\n+        Self { cx, regex: Regex::new(URL_REGEX).expect(\"failed to build regex\") }\n     }\n \n     fn find_raw_urls(\n@@ -53,17 +53,17 @@ impl<'a, 'tcx> UrlImprovementsLinter<'a, 'tcx> {\n     }\n }\n \n-pub fn check_url_improvements(krate: Crate, cx: &DocContext<'_>) -> Crate {\n+pub fn check_non_autolinks(krate: Crate, cx: &DocContext<'_>) -> Crate {\n     if !UnstableFeatures::from_environment().is_nightly_build() {\n         krate\n     } else {\n-        let mut coll = UrlImprovementsLinter::new(cx);\n+        let mut coll = NonAutolinksLinter::new(cx);\n \n         coll.fold_crate(krate)\n     }\n }\n \n-impl<'a, 'tcx> DocFolder for UrlImprovementsLinter<'a, 'tcx> {\n+impl<'a, 'tcx> DocFolder for NonAutolinksLinter<'a, 'tcx> {\n     fn fold_item(&mut self, item: Item) -> Option<Item> {\n         let hir_id = match self.cx.as_local_hir_id(item.def_id) {\n             Some(hir_id) => hir_id,\n@@ -78,7 +78,7 @@ impl<'a, 'tcx> DocFolder for UrlImprovementsLinter<'a, 'tcx> {\n                 let sp = super::source_span_for_markdown_range(cx, &dox, &range, &item.attrs)\n                     .or_else(|| span_of_attrs(&item.attrs))\n                     .unwrap_or(item.source.span());\n-                cx.tcx.struct_span_lint_hir(lint::builtin::URL_IMPROVEMENTS, hir_id, sp, |lint| {\n+                cx.tcx.struct_span_lint_hir(lint::builtin::NON_AUTOLINKS, hir_id, sp, |lint| {\n                     lint.build(msg)\n                         .span_suggestion(\n                             sp,\n@@ -103,7 +103,8 @@ impl<'a, 'tcx> DocFolder for UrlImprovementsLinter<'a, 'tcx> {\n                                 Event::End(Tag::Link(_, url, _)) => {\n                                     // NOTE: links cannot be nested, so we don't need to\n                                     // check `kind`\n-                                    if url.as_ref() == title && !ignore && self.regex.matches(url) {\n+                                    if url.as_ref() == title && !ignore && self.regex.is_match(&url)\n+                                    {\n                                         report_diag(\n                                             self.cx,\n                                             \"unneeded long form for URL\",", "previous_filename": "src/librustdoc/passes/url_improvements.rs"}, {"sha": "8531583d38a659bc360d966ca321c1903ece53b1", "filename": "src/test/rustdoc-ui/url-improvements.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Furl-improvements.rs?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -1,11 +1,11 @@\n-#![deny(url_improvements)]\n+#![deny(non_autolinks)]\n \n-/// [http://a.com](http://a.com)\n+/// [http://aa.com](http://aa.com)\n //~^ ERROR unneeded long form for URL\n-/// [http://b.com]\n+/// [http://bb.com]\n //~^ ERROR unneeded long form for URL\n ///\n-/// [http://b.com]: http://b.com\n+/// [http://bb.com]: http://bb.com\n ///\n /// [http://c.com][http://c.com]\n pub fn a() {}\n@@ -59,7 +59,7 @@ pub fn c() {}\n /// [should_not.lint](should_not.lint)\n pub fn everything_is_fine_here() {}\n \n-#[allow(url_improvements)]\n+#[allow(non_autolinks)]\n pub mod foo {\n     /// https://somewhere.com/a?hello=12&bye=11#xyz\n     pub fn bar() {}"}, {"sha": "70ad4b06a515d087cfaa04873f46ceb17c231ba3", "filename": "src/test/rustdoc-ui/url-improvements.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Ftest%2Frustdoc-ui%2Furl-improvements.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9d114506c68ce717503d0fa1eb335db5c80c195f/src%2Ftest%2Frustdoc-ui%2Furl-improvements.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Furl-improvements.stderr?ref=9d114506c68ce717503d0fa1eb335db5c80c195f", "patch": "@@ -1,20 +1,20 @@\n error: unneeded long form for URL\n   --> $DIR/url-improvements.rs:3:5\n    |\n-LL | /// [http://a.com](http://a.com)\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://a.com>`\n+LL | /// [http://aa.com](http://aa.com)\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://aa.com>`\n    |\n note: the lint level is defined here\n   --> $DIR/url-improvements.rs:1:9\n    |\n-LL | #![deny(url_improvements)]\n-   |         ^^^^^^^^^^^^^^^^\n+LL | #![deny(non_autolinks)]\n+   |         ^^^^^^^^^^^^^\n \n error: unneeded long form for URL\n   --> $DIR/url-improvements.rs:5:5\n    |\n-LL | /// [http://b.com]\n-   |     ^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://b.com>`\n+LL | /// [http://bb.com]\n+   |     ^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://bb.com>`\n \n error: this URL is not a hyperlink\n   --> $DIR/url-improvements.rs:13:5"}]}